function n0e(e,n){for(var a=0;a<n.length;a++){const o=n[a];if(typeof o!="string"&&!Array.isArray(o)){for(const d in o)if(d!=="default"&&!(d in e)){const p=Object.getOwnPropertyDescriptor(o,d);p&&Object.defineProperty(e,d,p.get?p:{enumerable:!0,get:()=>o[d]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function a(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(d){if(d.ep)return;d.ep=!0;const p=a(d);fetch(d.href,p)}})();var Id=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ar(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var IY={exports:{}},Sw={},OY={exports:{}},Nn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x_=Symbol.for("react.element"),r0e=Symbol.for("react.portal"),i0e=Symbol.for("react.fragment"),a0e=Symbol.for("react.strict_mode"),s0e=Symbol.for("react.profiler"),o0e=Symbol.for("react.provider"),c0e=Symbol.for("react.context"),l0e=Symbol.for("react.forward_ref"),d0e=Symbol.for("react.suspense"),u0e=Symbol.for("react.memo"),h0e=Symbol.for("react.lazy"),F$=Symbol.iterator;function p0e(e){return e===null||typeof e!="object"?null:(e=F$&&e[F$]||e["@@iterator"],typeof e=="function"?e:null)}var PY={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},DY=Object.assign,kY={};function Dm(e,n,a){this.props=e,this.context=n,this.refs=kY,this.updater=a||PY}Dm.prototype.isReactComponent={};Dm.prototype.setState=function(e,n){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")};Dm.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function jY(){}jY.prototype=Dm.prototype;function nk(e,n,a){this.props=e,this.context=n,this.refs=kY,this.updater=a||PY}var rk=nk.prototype=new jY;rk.constructor=nk;DY(rk,Dm.prototype);rk.isPureReactComponent=!0;var V$=Array.isArray,LY=Object.prototype.hasOwnProperty,ik={current:null},MY={key:!0,ref:!0,__self:!0,__source:!0};function UY(e,n,a){var o,d={},p=null,m=null;if(n!=null)for(o in n.ref!==void 0&&(m=n.ref),n.key!==void 0&&(p=""+n.key),n)LY.call(n,o)&&!MY.hasOwnProperty(o)&&(d[o]=n[o]);var y=arguments.length-2;if(y===1)d.children=a;else if(1<y){for(var b=Array(y),E=0;E<y;E++)b[E]=arguments[E+2];d.children=b}if(e&&e.defaultProps)for(o in y=e.defaultProps,y)d[o]===void 0&&(d[o]=y[o]);return{$$typeof:x_,type:e,key:p,ref:m,props:d,_owner:ik.current}}function f0e(e,n){return{$$typeof:x_,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function ak(e){return typeof e=="object"&&e!==null&&e.$$typeof===x_}function m0e(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(a){return n[a]})}var B$=/\/+/g;function sO(e,n){return typeof e=="object"&&e!==null&&e.key!=null?m0e(""+e.key):n.toString(36)}function Sx(e,n,a,o,d){var p=typeof e;(p==="undefined"||p==="boolean")&&(e=null);var m=!1;if(e===null)m=!0;else switch(p){case"string":case"number":m=!0;break;case"object":switch(e.$$typeof){case x_:case r0e:m=!0}}if(m)return m=e,d=d(m),e=o===""?"."+sO(m,0):o,V$(d)?(a="",e!=null&&(a=e.replace(B$,"$&/")+"/"),Sx(d,n,a,"",function(E){return E})):d!=null&&(ak(d)&&(d=f0e(d,a+(!d.key||m&&m.key===d.key?"":(""+d.key).replace(B$,"$&/")+"/")+e)),n.push(d)),1;if(m=0,o=o===""?".":o+":",V$(e))for(var y=0;y<e.length;y++){p=e[y];var b=o+sO(p,y);m+=Sx(p,n,a,b,d)}else if(b=p0e(e),typeof b=="function")for(e=b.call(e),y=0;!(p=e.next()).done;)p=p.value,b=o+sO(p,y++),m+=Sx(p,n,a,b,d);else if(p==="object")throw n=String(e),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return m}function GE(e,n,a){if(e==null)return e;var o=[],d=0;return Sx(e,o,"","",function(p){return n.call(a,p,d++)}),o}function g0e(e){if(e._status===-1){var n=e._result;n=n(),n.then(function(a){(e._status===0||e._status===-1)&&(e._status=1,e._result=a)},function(a){(e._status===0||e._status===-1)&&(e._status=2,e._result=a)}),e._status===-1&&(e._status=0,e._result=n)}if(e._status===1)return e._result.default;throw e._result}var Aa={current:null},wx={transition:null},v0e={ReactCurrentDispatcher:Aa,ReactCurrentBatchConfig:wx,ReactCurrentOwner:ik};function FY(){throw Error("act(...) is not supported in production builds of React.")}Nn.Children={map:GE,forEach:function(e,n,a){GE(e,function(){n.apply(this,arguments)},a)},count:function(e){var n=0;return GE(e,function(){n++}),n},toArray:function(e){return GE(e,function(n){return n})||[]},only:function(e){if(!ak(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Nn.Component=Dm;Nn.Fragment=i0e;Nn.Profiler=s0e;Nn.PureComponent=nk;Nn.StrictMode=a0e;Nn.Suspense=d0e;Nn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=v0e;Nn.act=FY;Nn.cloneElement=function(e,n,a){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=DY({},e.props),d=e.key,p=e.ref,m=e._owner;if(n!=null){if(n.ref!==void 0&&(p=n.ref,m=ik.current),n.key!==void 0&&(d=""+n.key),e.type&&e.type.defaultProps)var y=e.type.defaultProps;for(b in n)LY.call(n,b)&&!MY.hasOwnProperty(b)&&(o[b]=n[b]===void 0&&y!==void 0?y[b]:n[b])}var b=arguments.length-2;if(b===1)o.children=a;else if(1<b){y=Array(b);for(var E=0;E<b;E++)y[E]=arguments[E+2];o.children=y}return{$$typeof:x_,type:e.type,key:d,ref:p,props:o,_owner:m}};Nn.createContext=function(e){return e={$$typeof:c0e,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:o0e,_context:e},e.Consumer=e};Nn.createElement=UY;Nn.createFactory=function(e){var n=UY.bind(null,e);return n.type=e,n};Nn.createRef=function(){return{current:null}};Nn.forwardRef=function(e){return{$$typeof:l0e,render:e}};Nn.isValidElement=ak;Nn.lazy=function(e){return{$$typeof:h0e,_payload:{_status:-1,_result:e},_init:g0e}};Nn.memo=function(e,n){return{$$typeof:u0e,type:e,compare:n===void 0?null:n}};Nn.startTransition=function(e){var n=wx.transition;wx.transition={};try{e()}finally{wx.transition=n}};Nn.unstable_act=FY;Nn.useCallback=function(e,n){return Aa.current.useCallback(e,n)};Nn.useContext=function(e){return Aa.current.useContext(e)};Nn.useDebugValue=function(){};Nn.useDeferredValue=function(e){return Aa.current.useDeferredValue(e)};Nn.useEffect=function(e,n){return Aa.current.useEffect(e,n)};Nn.useId=function(){return Aa.current.useId()};Nn.useImperativeHandle=function(e,n,a){return Aa.current.useImperativeHandle(e,n,a)};Nn.useInsertionEffect=function(e,n){return Aa.current.useInsertionEffect(e,n)};Nn.useLayoutEffect=function(e,n){return Aa.current.useLayoutEffect(e,n)};Nn.useMemo=function(e,n){return Aa.current.useMemo(e,n)};Nn.useReducer=function(e,n,a){return Aa.current.useReducer(e,n,a)};Nn.useRef=function(e){return Aa.current.useRef(e)};Nn.useState=function(e){return Aa.current.useState(e)};Nn.useSyncExternalStore=function(e,n,a){return Aa.current.useSyncExternalStore(e,n,a)};Nn.useTransition=function(){return Aa.current.useTransition()};Nn.version="18.3.1";OY.exports=Nn;var Y=OY.exports;const me=ar(Y),y0e=n0e({__proto__:null,default:me},[Y]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _0e=Y,b0e=Symbol.for("react.element"),E0e=Symbol.for("react.fragment"),x0e=Object.prototype.hasOwnProperty,S0e=_0e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,w0e={key:!0,ref:!0,__self:!0,__source:!0};function VY(e,n,a){var o,d={},p=null,m=null;a!==void 0&&(p=""+a),n.key!==void 0&&(p=""+n.key),n.ref!==void 0&&(m=n.ref);for(o in n)x0e.call(n,o)&&!w0e.hasOwnProperty(o)&&(d[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps,n)d[o]===void 0&&(d[o]=n[o]);return{$$typeof:b0e,type:e,key:p,ref:m,props:d,_owner:S0e.current}}Sw.Fragment=E0e;Sw.jsx=VY;Sw.jsxs=VY;IY.exports=Sw;var l=IY.exports,g1={},BY={exports:{}},Ns={},GY={exports:{}},WY={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(ae,de){var xe=ae.length;ae.push(de);e:for(;0<xe;){var Ue=xe-1>>>1,Me=ae[Ue];if(0<d(Me,de))ae[Ue]=de,ae[xe]=Me,xe=Ue;else break e}}function a(ae){return ae.length===0?null:ae[0]}function o(ae){if(ae.length===0)return null;var de=ae[0],xe=ae.pop();if(xe!==de){ae[0]=xe;e:for(var Ue=0,Me=ae.length,et=Me>>>1;Ue<et;){var Re=2*(Ue+1)-1,nt=ae[Re],ut=Re+1,Kt=ae[ut];if(0>d(nt,xe))ut<Me&&0>d(Kt,nt)?(ae[Ue]=Kt,ae[ut]=xe,Ue=ut):(ae[Ue]=nt,ae[Re]=xe,Ue=Re);else if(ut<Me&&0>d(Kt,xe))ae[Ue]=Kt,ae[ut]=xe,Ue=ut;else break e}}return de}function d(ae,de){var xe=ae.sortIndex-de.sortIndex;return xe!==0?xe:ae.id-de.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;e.unstable_now=function(){return p.now()}}else{var m=Date,y=m.now();e.unstable_now=function(){return m.now()-y}}var b=[],E=[],T=1,w=null,N=3,D=!1,A=!1,k=!1,O=typeof setTimeout=="function"?setTimeout:null,F=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(ae){for(var de=a(E);de!==null;){if(de.callback===null)o(E);else if(de.startTime<=ae)o(E),de.sortIndex=de.expirationTime,n(b,de);else break;de=a(E)}}function H(ae){if(k=!1,V(ae),!A)if(a(b)!==null)A=!0,he(B);else{var de=a(E);de!==null&&be(H,de.startTime-ae)}}function B(ae,de){A=!1,k&&(k=!1,F(Q),Q=-1),D=!0;var xe=N;try{for(V(de),w=a(b);w!==null&&(!(w.expirationTime>de)||ae&&!ne());){var Ue=w.callback;if(typeof Ue=="function"){w.callback=null,N=w.priorityLevel;var Me=Ue(w.expirationTime<=de);de=e.unstable_now(),typeof Me=="function"?w.callback=Me:w===a(b)&&o(b),V(de)}else o(b);w=a(b)}if(w!==null)var et=!0;else{var Re=a(E);Re!==null&&be(H,Re.startTime-de),et=!1}return et}finally{w=null,N=xe,D=!1}}var z=!1,q=null,Q=-1,ee=5,oe=-1;function ne(){return!(e.unstable_now()-oe<ee)}function ue(){if(q!==null){var ae=e.unstable_now();oe=ae;var de=!0;try{de=q(!0,ae)}finally{de?Se():(z=!1,q=null)}}else z=!1}var Se;if(typeof M=="function")Se=function(){M(ue)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,we=fe.port2;fe.port1.onmessage=ue,Se=function(){we.postMessage(null)}}else Se=function(){O(ue,0)};function he(ae){q=ae,z||(z=!0,Se())}function be(ae,de){Q=O(function(){ae(e.unstable_now())},de)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ae){ae.callback=null},e.unstable_continueExecution=function(){A||D||(A=!0,he(B))},e.unstable_forceFrameRate=function(ae){0>ae||125<ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<ae?Math.floor(1e3/ae):5},e.unstable_getCurrentPriorityLevel=function(){return N},e.unstable_getFirstCallbackNode=function(){return a(b)},e.unstable_next=function(ae){switch(N){case 1:case 2:case 3:var de=3;break;default:de=N}var xe=N;N=de;try{return ae()}finally{N=xe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ae,de){switch(ae){case 1:case 2:case 3:case 4:case 5:break;default:ae=3}var xe=N;N=ae;try{return de()}finally{N=xe}},e.unstable_scheduleCallback=function(ae,de,xe){var Ue=e.unstable_now();switch(typeof xe=="object"&&xe!==null?(xe=xe.delay,xe=typeof xe=="number"&&0<xe?Ue+xe:Ue):xe=Ue,ae){case 1:var Me=-1;break;case 2:Me=250;break;case 5:Me=1073741823;break;case 4:Me=1e4;break;default:Me=5e3}return Me=xe+Me,ae={id:T++,callback:de,priorityLevel:ae,startTime:xe,expirationTime:Me,sortIndex:-1},xe>Ue?(ae.sortIndex=xe,n(E,ae),a(b)===null&&ae===a(E)&&(k?(F(Q),Q=-1):k=!0,be(H,xe-Ue))):(ae.sortIndex=Me,n(b,ae),A||D||(A=!0,he(B))),ae},e.unstable_shouldYield=ne,e.unstable_wrapCallback=function(ae){var de=N;return function(){var xe=N;N=de;try{return ae.apply(this,arguments)}finally{N=xe}}}})(WY);GY.exports=WY;var T0e=GY.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C0e=Y,Cs=T0e;function rt(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var $Y=new Set,_y={};function Gh(e,n){Zf(e,n),Zf(e+"Capture",n)}function Zf(e,n){for(_y[e]=n,e=0;e<n.length;e++)$Y.add(n[e])}var Rl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v1=Object.prototype.hasOwnProperty,N0e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,G$={},W$={};function R0e(e){return v1.call(W$,e)?!0:v1.call(G$,e)?!1:N0e.test(e)?W$[e]=!0:(G$[e]=!0,!1)}function A0e(e,n,a,o){if(a!==null&&a.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return o?!1:a!==null?!a.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function I0e(e,n,a,o){if(n===null||typeof n>"u"||A0e(e,n,a,o))return!0;if(o)return!1;if(a!==null)switch(a.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Ia(e,n,a,o,d,p,m){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=o,this.attributeNamespace=d,this.mustUseProperty=a,this.propertyName=e,this.type=n,this.sanitizeURL=p,this.removeEmptyString=m}var Xi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Xi[e]=new Ia(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];Xi[n]=new Ia(n,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Xi[e]=new Ia(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Xi[e]=new Ia(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Xi[e]=new Ia(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Xi[e]=new Ia(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Xi[e]=new Ia(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Xi[e]=new Ia(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Xi[e]=new Ia(e,5,!1,e.toLowerCase(),null,!1,!1)});var sk=/[\-:]([a-z])/g;function ok(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(sk,ok);Xi[n]=new Ia(n,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(sk,ok);Xi[n]=new Ia(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(sk,ok);Xi[n]=new Ia(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Xi[e]=new Ia(e,1,!1,e.toLowerCase(),null,!1,!1)});Xi.xlinkHref=new Ia("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Xi[e]=new Ia(e,1,!1,e.toLowerCase(),null,!0,!0)});function ck(e,n,a,o){var d=Xi.hasOwnProperty(n)?Xi[n]:null;(d!==null?d.type!==0:o||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(I0e(n,a,d,o)&&(a=null),o||d===null?R0e(n)&&(a===null?e.removeAttribute(n):e.setAttribute(n,""+a)):d.mustUseProperty?e[d.propertyName]=a===null?d.type===3?!1:"":a:(n=d.attributeName,o=d.attributeNamespace,a===null?e.removeAttribute(n):(d=d.type,a=d===3||d===4&&a===!0?"":""+a,o?e.setAttributeNS(o,n,a):e.setAttribute(n,a))))}var Ll=C0e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,WE=Symbol.for("react.element"),Cf=Symbol.for("react.portal"),Nf=Symbol.for("react.fragment"),lk=Symbol.for("react.strict_mode"),y1=Symbol.for("react.profiler"),HY=Symbol.for("react.provider"),zY=Symbol.for("react.context"),dk=Symbol.for("react.forward_ref"),_1=Symbol.for("react.suspense"),b1=Symbol.for("react.suspense_list"),uk=Symbol.for("react.memo"),Sd=Symbol.for("react.lazy"),KY=Symbol.for("react.offscreen"),$$=Symbol.iterator;function Ov(e){return e===null||typeof e!="object"?null:(e=$$&&e[$$]||e["@@iterator"],typeof e=="function"?e:null)}var Wr=Object.assign,oO;function Qv(e){if(oO===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);oO=n&&n[1]||""}return`
`+oO+e}var cO=!1;function lO(e,n){if(!e||cO)return"";cO=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(E){var o=E}Reflect.construct(e,[],n)}else{try{n.call()}catch(E){o=E}e.call(n.prototype)}else{try{throw Error()}catch(E){o=E}e()}}catch(E){if(E&&o&&typeof E.stack=="string"){for(var d=E.stack.split(`
`),p=o.stack.split(`
`),m=d.length-1,y=p.length-1;1<=m&&0<=y&&d[m]!==p[y];)y--;for(;1<=m&&0<=y;m--,y--)if(d[m]!==p[y]){if(m!==1||y!==1)do if(m--,y--,0>y||d[m]!==p[y]){var b=`
`+d[m].replace(" at new "," at ");return e.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",e.displayName)),b}while(1<=m&&0<=y);break}}}finally{cO=!1,Error.prepareStackTrace=a}return(e=e?e.displayName||e.name:"")?Qv(e):""}function O0e(e){switch(e.tag){case 5:return Qv(e.type);case 16:return Qv("Lazy");case 13:return Qv("Suspense");case 19:return Qv("SuspenseList");case 0:case 2:case 15:return e=lO(e.type,!1),e;case 11:return e=lO(e.type.render,!1),e;case 1:return e=lO(e.type,!0),e;default:return""}}function E1(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Nf:return"Fragment";case Cf:return"Portal";case y1:return"Profiler";case lk:return"StrictMode";case _1:return"Suspense";case b1:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case zY:return(e.displayName||"Context")+".Consumer";case HY:return(e._context.displayName||"Context")+".Provider";case dk:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case uk:return n=e.displayName||null,n!==null?n:E1(e.type)||"Memo";case Sd:n=e._payload,e=e._init;try{return E1(e(n))}catch{}}return null}function P0e(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=n.render,e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E1(n);case 8:return n===lk?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Kd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function YY(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function D0e(e){var n=YY(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),o=""+e[n];if(!e.hasOwnProperty(n)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var d=a.get,p=a.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return d.call(this)},set:function(m){o=""+m,p.call(this,m)}}),Object.defineProperty(e,n,{enumerable:a.enumerable}),{getValue:function(){return o},setValue:function(m){o=""+m},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function $E(e){e._valueTracker||(e._valueTracker=D0e(e))}function qY(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var a=n.getValue(),o="";return e&&(o=YY(e)?e.checked?"true":"false":e.value),e=o,e!==a?(n.setValue(e),!0):!1}function Gx(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function x1(e,n){var a=n.checked;return Wr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??e._wrapperState.initialChecked})}function H$(e,n){var a=n.defaultValue==null?"":n.defaultValue,o=n.checked!=null?n.checked:n.defaultChecked;a=Kd(n.value!=null?n.value:a),e._wrapperState={initialChecked:o,initialValue:a,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function XY(e,n){n=n.checked,n!=null&&ck(e,"checked",n,!1)}function S1(e,n){XY(e,n);var a=Kd(n.value),o=n.type;if(a!=null)o==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+a):e.value!==""+a&&(e.value=""+a);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}n.hasOwnProperty("value")?w1(e,n.type,a):n.hasOwnProperty("defaultValue")&&w1(e,n.type,Kd(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(e.defaultChecked=!!n.defaultChecked)}function z$(e,n,a){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var o=n.type;if(!(o!=="submit"&&o!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+e._wrapperState.initialValue,a||n===e.value||(e.value=n),e.defaultValue=n}a=e.name,a!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,a!==""&&(e.name=a)}function w1(e,n,a){(n!=="number"||Gx(e.ownerDocument)!==e)&&(a==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+a&&(e.defaultValue=""+a))}var Zv=Array.isArray;function Bf(e,n,a,o){if(e=e.options,n){n={};for(var d=0;d<a.length;d++)n["$"+a[d]]=!0;for(a=0;a<e.length;a++)d=n.hasOwnProperty("$"+e[a].value),e[a].selected!==d&&(e[a].selected=d),d&&o&&(e[a].defaultSelected=!0)}else{for(a=""+Kd(a),n=null,d=0;d<e.length;d++){if(e[d].value===a){e[d].selected=!0,o&&(e[d].defaultSelected=!0);return}n!==null||e[d].disabled||(n=e[d])}n!==null&&(n.selected=!0)}}function T1(e,n){if(n.dangerouslySetInnerHTML!=null)throw Error(rt(91));return Wr({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function K$(e,n){var a=n.value;if(a==null){if(a=n.children,n=n.defaultValue,a!=null){if(n!=null)throw Error(rt(92));if(Zv(a)){if(1<a.length)throw Error(rt(93));a=a[0]}n=a}n==null&&(n=""),a=n}e._wrapperState={initialValue:Kd(a)}}function JY(e,n){var a=Kd(n.value),o=Kd(n.defaultValue);a!=null&&(a=""+a,a!==e.value&&(e.value=a),n.defaultValue==null&&e.defaultValue!==a&&(e.defaultValue=a)),o!=null&&(e.defaultValue=""+o)}function Y$(e){var n=e.textContent;n===e._wrapperState.initialValue&&n!==""&&n!==null&&(e.value=n)}function QY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function C1(e,n){return e==null||e==="http://www.w3.org/1999/xhtml"?QY(n):e==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var HE,ZY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,a,o,d){MSApp.execUnsafeLocalFunction(function(){return e(n,a,o,d)})}:e}(function(e,n){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=n;else{for(HE=HE||document.createElement("div"),HE.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=HE.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}});function by(e,n){if(n){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=n;return}}e.textContent=n}var iy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},k0e=["Webkit","ms","Moz","O"];Object.keys(iy).forEach(function(e){k0e.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),iy[n]=iy[e]})});function eq(e,n,a){return n==null||typeof n=="boolean"||n===""?"":a||typeof n!="number"||n===0||iy.hasOwnProperty(e)&&iy[e]?(""+n).trim():n+"px"}function tq(e,n){e=e.style;for(var a in n)if(n.hasOwnProperty(a)){var o=a.indexOf("--")===0,d=eq(a,n[a],o);a==="float"&&(a="cssFloat"),o?e.setProperty(a,d):e[a]=d}}var j0e=Wr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function N1(e,n){if(n){if(j0e[e]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(rt(137,e));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(rt(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(rt(61))}if(n.style!=null&&typeof n.style!="object")throw Error(rt(62))}}function R1(e,n){if(e.indexOf("-")===-1)return typeof n.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var A1=null;function hk(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var I1=null,Gf=null,Wf=null;function q$(e){if(e=T_(e)){if(typeof I1!="function")throw Error(rt(280));var n=e.stateNode;n&&(n=Rw(n),I1(e.stateNode,e.type,n))}}function nq(e){Gf?Wf?Wf.push(e):Wf=[e]:Gf=e}function rq(){if(Gf){var e=Gf,n=Wf;if(Wf=Gf=null,q$(e),n)for(e=0;e<n.length;e++)q$(n[e])}}function iq(e,n){return e(n)}function aq(){}var dO=!1;function sq(e,n,a){if(dO)return e(n,a);dO=!0;try{return iq(e,n,a)}finally{dO=!1,(Gf!==null||Wf!==null)&&(aq(),rq())}}function Ey(e,n){var a=e.stateNode;if(a===null)return null;var o=Rw(a);if(o===null)return null;a=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(rt(231,n,typeof a));return a}var O1=!1;if(Rl)try{var Pv={};Object.defineProperty(Pv,"passive",{get:function(){O1=!0}}),window.addEventListener("test",Pv,Pv),window.removeEventListener("test",Pv,Pv)}catch{O1=!1}function L0e(e,n,a,o,d,p,m,y,b){var E=Array.prototype.slice.call(arguments,3);try{n.apply(a,E)}catch(T){this.onError(T)}}var ay=!1,Wx=null,$x=!1,P1=null,M0e={onError:function(e){ay=!0,Wx=e}};function U0e(e,n,a,o,d,p,m,y,b){ay=!1,Wx=null,L0e.apply(M0e,arguments)}function F0e(e,n,a,o,d,p,m,y,b){if(U0e.apply(this,arguments),ay){if(ay){var E=Wx;ay=!1,Wx=null}else throw Error(rt(198));$x||($x=!0,P1=E)}}function Wh(e){var n=e,a=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,n.flags&4098&&(a=n.return),e=n.return;while(e)}return n.tag===3?a:null}function oq(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function X$(e){if(Wh(e)!==e)throw Error(rt(188))}function V0e(e){var n=e.alternate;if(!n){if(n=Wh(e),n===null)throw Error(rt(188));return n!==e?null:e}for(var a=e,o=n;;){var d=a.return;if(d===null)break;var p=d.alternate;if(p===null){if(o=d.return,o!==null){a=o;continue}break}if(d.child===p.child){for(p=d.child;p;){if(p===a)return X$(d),e;if(p===o)return X$(d),n;p=p.sibling}throw Error(rt(188))}if(a.return!==o.return)a=d,o=p;else{for(var m=!1,y=d.child;y;){if(y===a){m=!0,a=d,o=p;break}if(y===o){m=!0,o=d,a=p;break}y=y.sibling}if(!m){for(y=p.child;y;){if(y===a){m=!0,a=p,o=d;break}if(y===o){m=!0,o=p,a=d;break}y=y.sibling}if(!m)throw Error(rt(189))}}if(a.alternate!==o)throw Error(rt(190))}if(a.tag!==3)throw Error(rt(188));return a.stateNode.current===a?e:n}function cq(e){return e=V0e(e),e!==null?lq(e):null}function lq(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var n=lq(e);if(n!==null)return n;e=e.sibling}return null}var dq=Cs.unstable_scheduleCallback,J$=Cs.unstable_cancelCallback,B0e=Cs.unstable_shouldYield,G0e=Cs.unstable_requestPaint,ei=Cs.unstable_now,W0e=Cs.unstable_getCurrentPriorityLevel,pk=Cs.unstable_ImmediatePriority,uq=Cs.unstable_UserBlockingPriority,Hx=Cs.unstable_NormalPriority,$0e=Cs.unstable_LowPriority,hq=Cs.unstable_IdlePriority,ww=null,Bc=null;function H0e(e){if(Bc&&typeof Bc.onCommitFiberRoot=="function")try{Bc.onCommitFiberRoot(ww,e,void 0,(e.current.flags&128)===128)}catch{}}var ec=Math.clz32?Math.clz32:Y0e,z0e=Math.log,K0e=Math.LN2;function Y0e(e){return e>>>=0,e===0?32:31-(z0e(e)/K0e|0)|0}var zE=64,KE=4194304;function ey(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function zx(e,n){var a=e.pendingLanes;if(a===0)return 0;var o=0,d=e.suspendedLanes,p=e.pingedLanes,m=a&268435455;if(m!==0){var y=m&~d;y!==0?o=ey(y):(p&=m,p!==0&&(o=ey(p)))}else m=a&~d,m!==0?o=ey(m):p!==0&&(o=ey(p));if(o===0)return 0;if(n!==0&&n!==o&&!(n&d)&&(d=o&-o,p=n&-n,d>=p||d===16&&(p&4194240)!==0))return n;if(o&4&&(o|=a&16),n=e.entangledLanes,n!==0)for(e=e.entanglements,n&=o;0<n;)a=31-ec(n),d=1<<a,o|=e[a],n&=~d;return o}function q0e(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function X0e(e,n){for(var a=e.suspendedLanes,o=e.pingedLanes,d=e.expirationTimes,p=e.pendingLanes;0<p;){var m=31-ec(p),y=1<<m,b=d[m];b===-1?(!(y&a)||y&o)&&(d[m]=q0e(y,n)):b<=n&&(e.expiredLanes|=y),p&=~y}}function D1(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function pq(){var e=zE;return zE<<=1,!(zE&4194240)&&(zE=64),e}function uO(e){for(var n=[],a=0;31>a;a++)n.push(e);return n}function S_(e,n,a){e.pendingLanes|=n,n!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,n=31-ec(n),e[n]=a}function J0e(e,n){var a=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<a;){var d=31-ec(a),p=1<<d;n[d]=0,o[d]=-1,e[d]=-1,a&=~p}}function fk(e,n){var a=e.entangledLanes|=n;for(e=e.entanglements;a;){var o=31-ec(a),d=1<<o;d&n|e[o]&n&&(e[o]|=n),a&=~d}}var Jn=0;function fq(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var mq,mk,gq,vq,yq,k1=!1,YE=[],Ld=null,Md=null,Ud=null,xy=new Map,Sy=new Map,Cd=[],Q0e="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Q$(e,n){switch(e){case"focusin":case"focusout":Ld=null;break;case"dragenter":case"dragleave":Md=null;break;case"mouseover":case"mouseout":Ud=null;break;case"pointerover":case"pointerout":xy.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Sy.delete(n.pointerId)}}function Dv(e,n,a,o,d,p){return e===null||e.nativeEvent!==p?(e={blockedOn:n,domEventName:a,eventSystemFlags:o,nativeEvent:p,targetContainers:[d]},n!==null&&(n=T_(n),n!==null&&mk(n)),e):(e.eventSystemFlags|=o,n=e.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),e)}function Z0e(e,n,a,o,d){switch(n){case"focusin":return Ld=Dv(Ld,e,n,a,o,d),!0;case"dragenter":return Md=Dv(Md,e,n,a,o,d),!0;case"mouseover":return Ud=Dv(Ud,e,n,a,o,d),!0;case"pointerover":var p=d.pointerId;return xy.set(p,Dv(xy.get(p)||null,e,n,a,o,d)),!0;case"gotpointercapture":return p=d.pointerId,Sy.set(p,Dv(Sy.get(p)||null,e,n,a,o,d)),!0}return!1}function _q(e){var n=hh(e.target);if(n!==null){var a=Wh(n);if(a!==null){if(n=a.tag,n===13){if(n=oq(a),n!==null){e.blockedOn=n,yq(e.priority,function(){gq(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Tx(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var a=j1(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(a===null){a=e.nativeEvent;var o=new a.constructor(a.type,a);A1=o,a.target.dispatchEvent(o),A1=null}else return n=T_(a),n!==null&&mk(n),e.blockedOn=a,!1;n.shift()}return!0}function Z$(e,n,a){Tx(e)&&a.delete(n)}function ebe(){k1=!1,Ld!==null&&Tx(Ld)&&(Ld=null),Md!==null&&Tx(Md)&&(Md=null),Ud!==null&&Tx(Ud)&&(Ud=null),xy.forEach(Z$),Sy.forEach(Z$)}function kv(e,n){e.blockedOn===n&&(e.blockedOn=null,k1||(k1=!0,Cs.unstable_scheduleCallback(Cs.unstable_NormalPriority,ebe)))}function wy(e){function n(d){return kv(d,e)}if(0<YE.length){kv(YE[0],e);for(var a=1;a<YE.length;a++){var o=YE[a];o.blockedOn===e&&(o.blockedOn=null)}}for(Ld!==null&&kv(Ld,e),Md!==null&&kv(Md,e),Ud!==null&&kv(Ud,e),xy.forEach(n),Sy.forEach(n),a=0;a<Cd.length;a++)o=Cd[a],o.blockedOn===e&&(o.blockedOn=null);for(;0<Cd.length&&(a=Cd[0],a.blockedOn===null);)_q(a),a.blockedOn===null&&Cd.shift()}var $f=Ll.ReactCurrentBatchConfig,Kx=!0;function tbe(e,n,a,o){var d=Jn,p=$f.transition;$f.transition=null;try{Jn=1,gk(e,n,a,o)}finally{Jn=d,$f.transition=p}}function nbe(e,n,a,o){var d=Jn,p=$f.transition;$f.transition=null;try{Jn=4,gk(e,n,a,o)}finally{Jn=d,$f.transition=p}}function gk(e,n,a,o){if(Kx){var d=j1(e,n,a,o);if(d===null)EO(e,n,o,Yx,a),Q$(e,o);else if(Z0e(d,e,n,a,o))o.stopPropagation();else if(Q$(e,o),n&4&&-1<Q0e.indexOf(e)){for(;d!==null;){var p=T_(d);if(p!==null&&mq(p),p=j1(e,n,a,o),p===null&&EO(e,n,o,Yx,a),p===d)break;d=p}d!==null&&o.stopPropagation()}else EO(e,n,o,null,a)}}var Yx=null;function j1(e,n,a,o){if(Yx=null,e=hk(o),e=hh(e),e!==null)if(n=Wh(e),n===null)e=null;else if(a=n.tag,a===13){if(e=oq(n),e!==null)return e;e=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return Yx=e,null}function bq(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(W0e()){case pk:return 1;case uq:return 4;case Hx:case $0e:return 16;case hq:return 536870912;default:return 16}default:return 16}}var Od=null,vk=null,Cx=null;function Eq(){if(Cx)return Cx;var e,n=vk,a=n.length,o,d="value"in Od?Od.value:Od.textContent,p=d.length;for(e=0;e<a&&n[e]===d[e];e++);var m=a-e;for(o=1;o<=m&&n[a-o]===d[p-o];o++);return Cx=d.slice(e,1<o?1-o:void 0)}function Nx(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function qE(){return!0}function eH(){return!1}function Rs(e){function n(a,o,d,p,m){this._reactName=a,this._targetInst=d,this.type=o,this.nativeEvent=p,this.target=m,this.currentTarget=null;for(var y in e)e.hasOwnProperty(y)&&(a=e[y],this[y]=a?a(p):p[y]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?qE:eH,this.isPropagationStopped=eH,this}return Wr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=qE)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=qE)},persist:function(){},isPersistent:qE}),n}var km={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yk=Rs(km),w_=Wr({},km,{view:0,detail:0}),rbe=Rs(w_),hO,pO,jv,Tw=Wr({},w_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_k,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==jv&&(jv&&e.type==="mousemove"?(hO=e.screenX-jv.screenX,pO=e.screenY-jv.screenY):pO=hO=0,jv=e),hO)},movementY:function(e){return"movementY"in e?e.movementY:pO}}),tH=Rs(Tw),ibe=Wr({},Tw,{dataTransfer:0}),abe=Rs(ibe),sbe=Wr({},w_,{relatedTarget:0}),fO=Rs(sbe),obe=Wr({},km,{animationName:0,elapsedTime:0,pseudoElement:0}),cbe=Rs(obe),lbe=Wr({},km,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),dbe=Rs(lbe),ube=Wr({},km,{data:0}),nH=Rs(ube),hbe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pbe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fbe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mbe(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=fbe[e])?!!n[e]:!1}function _k(){return mbe}var gbe=Wr({},w_,{key:function(e){if(e.key){var n=hbe[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=Nx(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?pbe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_k,charCode:function(e){return e.type==="keypress"?Nx(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Nx(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),vbe=Rs(gbe),ybe=Wr({},Tw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rH=Rs(ybe),_be=Wr({},w_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_k}),bbe=Rs(_be),Ebe=Wr({},km,{propertyName:0,elapsedTime:0,pseudoElement:0}),xbe=Rs(Ebe),Sbe=Wr({},Tw,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),wbe=Rs(Sbe),Tbe=[9,13,27,32],bk=Rl&&"CompositionEvent"in window,sy=null;Rl&&"documentMode"in document&&(sy=document.documentMode);var Cbe=Rl&&"TextEvent"in window&&!sy,xq=Rl&&(!bk||sy&&8<sy&&11>=sy),iH=" ",aH=!1;function Sq(e,n){switch(e){case"keyup":return Tbe.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wq(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Rf=!1;function Nbe(e,n){switch(e){case"compositionend":return wq(n);case"keypress":return n.which!==32?null:(aH=!0,iH);case"textInput":return e=n.data,e===iH&&aH?null:e;default:return null}}function Rbe(e,n){if(Rf)return e==="compositionend"||!bk&&Sq(e,n)?(e=Eq(),Cx=vk=Od=null,Rf=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return xq&&n.locale!=="ko"?null:n.data;default:return null}}var Abe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sH(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!Abe[e.type]:n==="textarea"}function Tq(e,n,a,o){nq(o),n=qx(n,"onChange"),0<n.length&&(a=new yk("onChange","change",null,a,o),e.push({event:a,listeners:n}))}var oy=null,Ty=null;function Ibe(e){Lq(e,0)}function Cw(e){var n=Of(e);if(qY(n))return e}function Obe(e,n){if(e==="change")return n}var Cq=!1;if(Rl){var mO;if(Rl){var gO="oninput"in document;if(!gO){var oH=document.createElement("div");oH.setAttribute("oninput","return;"),gO=typeof oH.oninput=="function"}mO=gO}else mO=!1;Cq=mO&&(!document.documentMode||9<document.documentMode)}function cH(){oy&&(oy.detachEvent("onpropertychange",Nq),Ty=oy=null)}function Nq(e){if(e.propertyName==="value"&&Cw(Ty)){var n=[];Tq(n,Ty,e,hk(e)),sq(Ibe,n)}}function Pbe(e,n,a){e==="focusin"?(cH(),oy=n,Ty=a,oy.attachEvent("onpropertychange",Nq)):e==="focusout"&&cH()}function Dbe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Cw(Ty)}function kbe(e,n){if(e==="click")return Cw(n)}function jbe(e,n){if(e==="input"||e==="change")return Cw(n)}function Lbe(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var rc=typeof Object.is=="function"?Object.is:Lbe;function Cy(e,n){if(rc(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var a=Object.keys(e),o=Object.keys(n);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var d=a[o];if(!v1.call(n,d)||!rc(e[d],n[d]))return!1}return!0}function lH(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dH(e,n){var a=lH(e);e=0;for(var o;a;){if(a.nodeType===3){if(o=e+a.textContent.length,e<=n&&o>=n)return{node:a,offset:n-e};e=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=lH(a)}}function Rq(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?Rq(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function Aq(){for(var e=window,n=Gx();n instanceof e.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)e=n.contentWindow;else break;n=Gx(e.document)}return n}function Ek(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function Mbe(e){var n=Aq(),a=e.focusedElem,o=e.selectionRange;if(n!==a&&a&&a.ownerDocument&&Rq(a.ownerDocument.documentElement,a)){if(o!==null&&Ek(a)){if(n=o.start,e=o.end,e===void 0&&(e=n),"selectionStart"in a)a.selectionStart=n,a.selectionEnd=Math.min(e,a.value.length);else if(e=(n=a.ownerDocument||document)&&n.defaultView||window,e.getSelection){e=e.getSelection();var d=a.textContent.length,p=Math.min(o.start,d);o=o.end===void 0?p:Math.min(o.end,d),!e.extend&&p>o&&(d=o,o=p,p=d),d=dH(a,p);var m=dH(a,o);d&&m&&(e.rangeCount!==1||e.anchorNode!==d.node||e.anchorOffset!==d.offset||e.focusNode!==m.node||e.focusOffset!==m.offset)&&(n=n.createRange(),n.setStart(d.node,d.offset),e.removeAllRanges(),p>o?(e.addRange(n),e.extend(m.node,m.offset)):(n.setEnd(m.node,m.offset),e.addRange(n)))}}for(n=[],e=a;e=e.parentNode;)e.nodeType===1&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<n.length;a++)e=n[a],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Ube=Rl&&"documentMode"in document&&11>=document.documentMode,Af=null,L1=null,cy=null,M1=!1;function uH(e,n,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;M1||Af==null||Af!==Gx(o)||(o=Af,"selectionStart"in o&&Ek(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),cy&&Cy(cy,o)||(cy=o,o=qx(L1,"onSelect"),0<o.length&&(n=new yk("onSelect","select",null,n,a),e.push({event:n,listeners:o}),n.target=Af)))}function XE(e,n){var a={};return a[e.toLowerCase()]=n.toLowerCase(),a["Webkit"+e]="webkit"+n,a["Moz"+e]="moz"+n,a}var If={animationend:XE("Animation","AnimationEnd"),animationiteration:XE("Animation","AnimationIteration"),animationstart:XE("Animation","AnimationStart"),transitionend:XE("Transition","TransitionEnd")},vO={},Iq={};Rl&&(Iq=document.createElement("div").style,"AnimationEvent"in window||(delete If.animationend.animation,delete If.animationiteration.animation,delete If.animationstart.animation),"TransitionEvent"in window||delete If.transitionend.transition);function Nw(e){if(vO[e])return vO[e];if(!If[e])return e;var n=If[e],a;for(a in n)if(n.hasOwnProperty(a)&&a in Iq)return vO[e]=n[a];return e}var Oq=Nw("animationend"),Pq=Nw("animationiteration"),Dq=Nw("animationstart"),kq=Nw("transitionend"),jq=new Map,hH="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jd(e,n){jq.set(e,n),Gh(n,[e])}for(var yO=0;yO<hH.length;yO++){var _O=hH[yO],Fbe=_O.toLowerCase(),Vbe=_O[0].toUpperCase()+_O.slice(1);Jd(Fbe,"on"+Vbe)}Jd(Oq,"onAnimationEnd");Jd(Pq,"onAnimationIteration");Jd(Dq,"onAnimationStart");Jd("dblclick","onDoubleClick");Jd("focusin","onFocus");Jd("focusout","onBlur");Jd(kq,"onTransitionEnd");Zf("onMouseEnter",["mouseout","mouseover"]);Zf("onMouseLeave",["mouseout","mouseover"]);Zf("onPointerEnter",["pointerout","pointerover"]);Zf("onPointerLeave",["pointerout","pointerover"]);Gh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ty="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bbe=new Set("cancel close invalid load scroll toggle".split(" ").concat(ty));function pH(e,n,a){var o=e.type||"unknown-event";e.currentTarget=a,F0e(o,n,void 0,e),e.currentTarget=null}function Lq(e,n){n=(n&4)!==0;for(var a=0;a<e.length;a++){var o=e[a],d=o.event;o=o.listeners;e:{var p=void 0;if(n)for(var m=o.length-1;0<=m;m--){var y=o[m],b=y.instance,E=y.currentTarget;if(y=y.listener,b!==p&&d.isPropagationStopped())break e;pH(d,y,E),p=b}else for(m=0;m<o.length;m++){if(y=o[m],b=y.instance,E=y.currentTarget,y=y.listener,b!==p&&d.isPropagationStopped())break e;pH(d,y,E),p=b}}}if($x)throw e=P1,$x=!1,P1=null,e}function Sr(e,n){var a=n[G1];a===void 0&&(a=n[G1]=new Set);var o=e+"__bubble";a.has(o)||(Mq(n,e,2,!1),a.add(o))}function bO(e,n,a){var o=0;n&&(o|=4),Mq(a,e,o,n)}var JE="_reactListening"+Math.random().toString(36).slice(2);function Ny(e){if(!e[JE]){e[JE]=!0,$Y.forEach(function(a){a!=="selectionchange"&&(Bbe.has(a)||bO(a,!1,e),bO(a,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[JE]||(n[JE]=!0,bO("selectionchange",!1,n))}}function Mq(e,n,a,o){switch(bq(n)){case 1:var d=tbe;break;case 4:d=nbe;break;default:d=gk}a=d.bind(null,n,a,e),d=void 0,!O1||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),o?d!==void 0?e.addEventListener(n,a,{capture:!0,passive:d}):e.addEventListener(n,a,!0):d!==void 0?e.addEventListener(n,a,{passive:d}):e.addEventListener(n,a,!1)}function EO(e,n,a,o,d){var p=o;if(!(n&1)&&!(n&2)&&o!==null)e:for(;;){if(o===null)return;var m=o.tag;if(m===3||m===4){var y=o.stateNode.containerInfo;if(y===d||y.nodeType===8&&y.parentNode===d)break;if(m===4)for(m=o.return;m!==null;){var b=m.tag;if((b===3||b===4)&&(b=m.stateNode.containerInfo,b===d||b.nodeType===8&&b.parentNode===d))return;m=m.return}for(;y!==null;){if(m=hh(y),m===null)return;if(b=m.tag,b===5||b===6){o=p=m;continue e}y=y.parentNode}}o=o.return}sq(function(){var E=p,T=hk(a),w=[];e:{var N=jq.get(e);if(N!==void 0){var D=yk,A=e;switch(e){case"keypress":if(Nx(a)===0)break e;case"keydown":case"keyup":D=vbe;break;case"focusin":A="focus",D=fO;break;case"focusout":A="blur",D=fO;break;case"beforeblur":case"afterblur":D=fO;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":D=tH;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":D=abe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":D=bbe;break;case Oq:case Pq:case Dq:D=cbe;break;case kq:D=xbe;break;case"scroll":D=rbe;break;case"wheel":D=wbe;break;case"copy":case"cut":case"paste":D=dbe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":D=rH}var k=(n&4)!==0,O=!k&&e==="scroll",F=k?N!==null?N+"Capture":null:N;k=[];for(var M=E,V;M!==null;){V=M;var H=V.stateNode;if(V.tag===5&&H!==null&&(V=H,F!==null&&(H=Ey(M,F),H!=null&&k.push(Ry(M,H,V)))),O)break;M=M.return}0<k.length&&(N=new D(N,A,null,a,T),w.push({event:N,listeners:k}))}}if(!(n&7)){e:{if(N=e==="mouseover"||e==="pointerover",D=e==="mouseout"||e==="pointerout",N&&a!==A1&&(A=a.relatedTarget||a.fromElement)&&(hh(A)||A[Al]))break e;if((D||N)&&(N=T.window===T?T:(N=T.ownerDocument)?N.defaultView||N.parentWindow:window,D?(A=a.relatedTarget||a.toElement,D=E,A=A?hh(A):null,A!==null&&(O=Wh(A),A!==O||A.tag!==5&&A.tag!==6)&&(A=null)):(D=null,A=E),D!==A)){if(k=tH,H="onMouseLeave",F="onMouseEnter",M="mouse",(e==="pointerout"||e==="pointerover")&&(k=rH,H="onPointerLeave",F="onPointerEnter",M="pointer"),O=D==null?N:Of(D),V=A==null?N:Of(A),N=new k(H,M+"leave",D,a,T),N.target=O,N.relatedTarget=V,H=null,hh(T)===E&&(k=new k(F,M+"enter",A,a,T),k.target=V,k.relatedTarget=O,H=k),O=H,D&&A)t:{for(k=D,F=A,M=0,V=k;V;V=yf(V))M++;for(V=0,H=F;H;H=yf(H))V++;for(;0<M-V;)k=yf(k),M--;for(;0<V-M;)F=yf(F),V--;for(;M--;){if(k===F||F!==null&&k===F.alternate)break t;k=yf(k),F=yf(F)}k=null}else k=null;D!==null&&fH(w,N,D,k,!1),A!==null&&O!==null&&fH(w,O,A,k,!0)}}e:{if(N=E?Of(E):window,D=N.nodeName&&N.nodeName.toLowerCase(),D==="select"||D==="input"&&N.type==="file")var B=Obe;else if(sH(N))if(Cq)B=jbe;else{B=Dbe;var z=Pbe}else(D=N.nodeName)&&D.toLowerCase()==="input"&&(N.type==="checkbox"||N.type==="radio")&&(B=kbe);if(B&&(B=B(e,E))){Tq(w,B,a,T);break e}z&&z(e,N,E),e==="focusout"&&(z=N._wrapperState)&&z.controlled&&N.type==="number"&&w1(N,"number",N.value)}switch(z=E?Of(E):window,e){case"focusin":(sH(z)||z.contentEditable==="true")&&(Af=z,L1=E,cy=null);break;case"focusout":cy=L1=Af=null;break;case"mousedown":M1=!0;break;case"contextmenu":case"mouseup":case"dragend":M1=!1,uH(w,a,T);break;case"selectionchange":if(Ube)break;case"keydown":case"keyup":uH(w,a,T)}var q;if(bk)e:{switch(e){case"compositionstart":var Q="onCompositionStart";break e;case"compositionend":Q="onCompositionEnd";break e;case"compositionupdate":Q="onCompositionUpdate";break e}Q=void 0}else Rf?Sq(e,a)&&(Q="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Q="onCompositionStart");Q&&(xq&&a.locale!=="ko"&&(Rf||Q!=="onCompositionStart"?Q==="onCompositionEnd"&&Rf&&(q=Eq()):(Od=T,vk="value"in Od?Od.value:Od.textContent,Rf=!0)),z=qx(E,Q),0<z.length&&(Q=new nH(Q,e,null,a,T),w.push({event:Q,listeners:z}),q?Q.data=q:(q=wq(a),q!==null&&(Q.data=q)))),(q=Cbe?Nbe(e,a):Rbe(e,a))&&(E=qx(E,"onBeforeInput"),0<E.length&&(T=new nH("onBeforeInput","beforeinput",null,a,T),w.push({event:T,listeners:E}),T.data=q))}Lq(w,n)})}function Ry(e,n,a){return{instance:e,listener:n,currentTarget:a}}function qx(e,n){for(var a=n+"Capture",o=[];e!==null;){var d=e,p=d.stateNode;d.tag===5&&p!==null&&(d=p,p=Ey(e,a),p!=null&&o.unshift(Ry(e,p,d)),p=Ey(e,n),p!=null&&o.push(Ry(e,p,d))),e=e.return}return o}function yf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function fH(e,n,a,o,d){for(var p=n._reactName,m=[];a!==null&&a!==o;){var y=a,b=y.alternate,E=y.stateNode;if(b!==null&&b===o)break;y.tag===5&&E!==null&&(y=E,d?(b=Ey(a,p),b!=null&&m.unshift(Ry(a,b,y))):d||(b=Ey(a,p),b!=null&&m.push(Ry(a,b,y)))),a=a.return}m.length!==0&&e.push({event:n,listeners:m})}var Gbe=/\r\n?/g,Wbe=/\u0000|\uFFFD/g;function mH(e){return(typeof e=="string"?e:""+e).replace(Gbe,`
`).replace(Wbe,"")}function QE(e,n,a){if(n=mH(n),mH(e)!==n&&a)throw Error(rt(425))}function Xx(){}var U1=null,F1=null;function V1(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var B1=typeof setTimeout=="function"?setTimeout:void 0,$be=typeof clearTimeout=="function"?clearTimeout:void 0,gH=typeof Promise=="function"?Promise:void 0,Hbe=typeof queueMicrotask=="function"?queueMicrotask:typeof gH<"u"?function(e){return gH.resolve(null).then(e).catch(zbe)}:B1;function zbe(e){setTimeout(function(){throw e})}function xO(e,n){var a=n,o=0;do{var d=a.nextSibling;if(e.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"){if(o===0){e.removeChild(d),wy(n);return}o--}else a!=="$"&&a!=="$?"&&a!=="$!"||o++;a=d}while(a);wy(n)}function Fd(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return e}function vH(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(n===0)return e;n--}else a==="/$"&&n++}e=e.previousSibling}return null}var jm=Math.random().toString(36).slice(2),Mc="__reactFiber$"+jm,Ay="__reactProps$"+jm,Al="__reactContainer$"+jm,G1="__reactEvents$"+jm,Kbe="__reactListeners$"+jm,Ybe="__reactHandles$"+jm;function hh(e){var n=e[Mc];if(n)return n;for(var a=e.parentNode;a;){if(n=a[Al]||a[Mc]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(e=vH(e);e!==null;){if(a=e[Mc])return a;e=vH(e)}return n}e=a,a=e.parentNode}return null}function T_(e){return e=e[Mc]||e[Al],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Of(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(rt(33))}function Rw(e){return e[Ay]||null}var W1=[],Pf=-1;function Qd(e){return{current:e}}function Cr(e){0>Pf||(e.current=W1[Pf],W1[Pf]=null,Pf--)}function pr(e,n){Pf++,W1[Pf]=e.current,e.current=n}var Yd={},pa=Qd(Yd),Qa=Qd(!1),Rh=Yd;function em(e,n){var a=e.type.contextTypes;if(!a)return Yd;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===n)return o.__reactInternalMemoizedMaskedChildContext;var d={},p;for(p in a)d[p]=n[p];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=d),d}function Za(e){return e=e.childContextTypes,e!=null}function Jx(){Cr(Qa),Cr(pa)}function yH(e,n,a){if(pa.current!==Yd)throw Error(rt(168));pr(pa,n),pr(Qa,a)}function Uq(e,n,a){var o=e.stateNode;if(n=n.childContextTypes,typeof o.getChildContext!="function")return a;o=o.getChildContext();for(var d in o)if(!(d in n))throw Error(rt(108,P0e(e)||"Unknown",d));return Wr({},a,o)}function Qx(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Yd,Rh=pa.current,pr(pa,e),pr(Qa,Qa.current),!0}function _H(e,n,a){var o=e.stateNode;if(!o)throw Error(rt(169));a?(e=Uq(e,n,Rh),o.__reactInternalMemoizedMergedChildContext=e,Cr(Qa),Cr(pa),pr(pa,e)):Cr(Qa),pr(Qa,a)}var gl=null,Aw=!1,SO=!1;function Fq(e){gl===null?gl=[e]:gl.push(e)}function qbe(e){Aw=!0,Fq(e)}function Zd(){if(!SO&&gl!==null){SO=!0;var e=0,n=Jn;try{var a=gl;for(Jn=1;e<a.length;e++){var o=a[e];do o=o(!0);while(o!==null)}gl=null,Aw=!1}catch(d){throw gl!==null&&(gl=gl.slice(e+1)),dq(pk,Zd),d}finally{Jn=n,SO=!1}}return null}var Df=[],kf=0,Zx=null,eS=0,ro=[],io=0,Ah=null,vl=1,yl="";function ah(e,n){Df[kf++]=eS,Df[kf++]=Zx,Zx=e,eS=n}function Vq(e,n,a){ro[io++]=vl,ro[io++]=yl,ro[io++]=Ah,Ah=e;var o=vl;e=yl;var d=32-ec(o)-1;o&=~(1<<d),a+=1;var p=32-ec(n)+d;if(30<p){var m=d-d%5;p=(o&(1<<m)-1).toString(32),o>>=m,d-=m,vl=1<<32-ec(n)+d|a<<d|o,yl=p+e}else vl=1<<p|a<<d|o,yl=e}function xk(e){e.return!==null&&(ah(e,1),Vq(e,1,0))}function Sk(e){for(;e===Zx;)Zx=Df[--kf],Df[kf]=null,eS=Df[--kf],Df[kf]=null;for(;e===Ah;)Ah=ro[--io],ro[io]=null,yl=ro[--io],ro[io]=null,vl=ro[--io],ro[io]=null}var Ts=null,ws=null,kr=!1,Jo=null;function Bq(e,n){var a=so(5,null,null,0);a.elementType="DELETED",a.stateNode=n,a.return=e,n=e.deletions,n===null?(e.deletions=[a],e.flags|=16):n.push(a)}function bH(e,n){switch(e.tag){case 5:var a=e.type;return n=n.nodeType!==1||a.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(e.stateNode=n,Ts=e,ws=Fd(n.firstChild),!0):!1;case 6:return n=e.pendingProps===""||n.nodeType!==3?null:n,n!==null?(e.stateNode=n,Ts=e,ws=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(a=Ah!==null?{id:vl,overflow:yl}:null,e.memoizedState={dehydrated:n,treeContext:a,retryLane:1073741824},a=so(18,null,null,0),a.stateNode=n,a.return=e,e.child=a,Ts=e,ws=null,!0):!1;default:return!1}}function $1(e){return(e.mode&1)!==0&&(e.flags&128)===0}function H1(e){if(kr){var n=ws;if(n){var a=n;if(!bH(e,n)){if($1(e))throw Error(rt(418));n=Fd(a.nextSibling);var o=Ts;n&&bH(e,n)?Bq(o,a):(e.flags=e.flags&-4097|2,kr=!1,Ts=e)}}else{if($1(e))throw Error(rt(418));e.flags=e.flags&-4097|2,kr=!1,Ts=e}}}function EH(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ts=e}function ZE(e){if(e!==Ts)return!1;if(!kr)return EH(e),kr=!0,!1;var n;if((n=e.tag!==3)&&!(n=e.tag!==5)&&(n=e.type,n=n!=="head"&&n!=="body"&&!V1(e.type,e.memoizedProps)),n&&(n=ws)){if($1(e))throw Gq(),Error(rt(418));for(;n;)Bq(e,n),n=Fd(n.nextSibling)}if(EH(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(rt(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"){if(n===0){ws=Fd(e.nextSibling);break e}n--}else a!=="$"&&a!=="$!"&&a!=="$?"||n++}e=e.nextSibling}ws=null}}else ws=Ts?Fd(e.stateNode.nextSibling):null;return!0}function Gq(){for(var e=ws;e;)e=Fd(e.nextSibling)}function tm(){ws=Ts=null,kr=!1}function wk(e){Jo===null?Jo=[e]:Jo.push(e)}var Xbe=Ll.ReactCurrentBatchConfig;function Lv(e,n,a){if(e=a.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(rt(309));var o=a.stateNode}if(!o)throw Error(rt(147,e));var d=o,p=""+e;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===p?n.ref:(n=function(m){var y=d.refs;m===null?delete y[p]:y[p]=m},n._stringRef=p,n)}if(typeof e!="string")throw Error(rt(284));if(!a._owner)throw Error(rt(290,e))}return e}function ex(e,n){throw e=Object.prototype.toString.call(n),Error(rt(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function xH(e){var n=e._init;return n(e._payload)}function Wq(e){function n(F,M){if(e){var V=F.deletions;V===null?(F.deletions=[M],F.flags|=16):V.push(M)}}function a(F,M){if(!e)return null;for(;M!==null;)n(F,M),M=M.sibling;return null}function o(F,M){for(F=new Map;M!==null;)M.key!==null?F.set(M.key,M):F.set(M.index,M),M=M.sibling;return F}function d(F,M){return F=Wd(F,M),F.index=0,F.sibling=null,F}function p(F,M,V){return F.index=V,e?(V=F.alternate,V!==null?(V=V.index,V<M?(F.flags|=2,M):V):(F.flags|=2,M)):(F.flags|=1048576,M)}function m(F){return e&&F.alternate===null&&(F.flags|=2),F}function y(F,M,V,H){return M===null||M.tag!==6?(M=IO(V,F.mode,H),M.return=F,M):(M=d(M,V),M.return=F,M)}function b(F,M,V,H){var B=V.type;return B===Nf?T(F,M,V.props.children,H,V.key):M!==null&&(M.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===Sd&&xH(B)===M.type)?(H=d(M,V.props),H.ref=Lv(F,M,V),H.return=F,H):(H=kx(V.type,V.key,V.props,null,F.mode,H),H.ref=Lv(F,M,V),H.return=F,H)}function E(F,M,V,H){return M===null||M.tag!==4||M.stateNode.containerInfo!==V.containerInfo||M.stateNode.implementation!==V.implementation?(M=OO(V,F.mode,H),M.return=F,M):(M=d(M,V.children||[]),M.return=F,M)}function T(F,M,V,H,B){return M===null||M.tag!==7?(M=Sh(V,F.mode,H,B),M.return=F,M):(M=d(M,V),M.return=F,M)}function w(F,M,V){if(typeof M=="string"&&M!==""||typeof M=="number")return M=IO(""+M,F.mode,V),M.return=F,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case WE:return V=kx(M.type,M.key,M.props,null,F.mode,V),V.ref=Lv(F,null,M),V.return=F,V;case Cf:return M=OO(M,F.mode,V),M.return=F,M;case Sd:var H=M._init;return w(F,H(M._payload),V)}if(Zv(M)||Ov(M))return M=Sh(M,F.mode,V,null),M.return=F,M;ex(F,M)}return null}function N(F,M,V,H){var B=M!==null?M.key:null;if(typeof V=="string"&&V!==""||typeof V=="number")return B!==null?null:y(F,M,""+V,H);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case WE:return V.key===B?b(F,M,V,H):null;case Cf:return V.key===B?E(F,M,V,H):null;case Sd:return B=V._init,N(F,M,B(V._payload),H)}if(Zv(V)||Ov(V))return B!==null?null:T(F,M,V,H,null);ex(F,V)}return null}function D(F,M,V,H,B){if(typeof H=="string"&&H!==""||typeof H=="number")return F=F.get(V)||null,y(M,F,""+H,B);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case WE:return F=F.get(H.key===null?V:H.key)||null,b(M,F,H,B);case Cf:return F=F.get(H.key===null?V:H.key)||null,E(M,F,H,B);case Sd:var z=H._init;return D(F,M,V,z(H._payload),B)}if(Zv(H)||Ov(H))return F=F.get(V)||null,T(M,F,H,B,null);ex(M,H)}return null}function A(F,M,V,H){for(var B=null,z=null,q=M,Q=M=0,ee=null;q!==null&&Q<V.length;Q++){q.index>Q?(ee=q,q=null):ee=q.sibling;var oe=N(F,q,V[Q],H);if(oe===null){q===null&&(q=ee);break}e&&q&&oe.alternate===null&&n(F,q),M=p(oe,M,Q),z===null?B=oe:z.sibling=oe,z=oe,q=ee}if(Q===V.length)return a(F,q),kr&&ah(F,Q),B;if(q===null){for(;Q<V.length;Q++)q=w(F,V[Q],H),q!==null&&(M=p(q,M,Q),z===null?B=q:z.sibling=q,z=q);return kr&&ah(F,Q),B}for(q=o(F,q);Q<V.length;Q++)ee=D(q,F,Q,V[Q],H),ee!==null&&(e&&ee.alternate!==null&&q.delete(ee.key===null?Q:ee.key),M=p(ee,M,Q),z===null?B=ee:z.sibling=ee,z=ee);return e&&q.forEach(function(ne){return n(F,ne)}),kr&&ah(F,Q),B}function k(F,M,V,H){var B=Ov(V);if(typeof B!="function")throw Error(rt(150));if(V=B.call(V),V==null)throw Error(rt(151));for(var z=B=null,q=M,Q=M=0,ee=null,oe=V.next();q!==null&&!oe.done;Q++,oe=V.next()){q.index>Q?(ee=q,q=null):ee=q.sibling;var ne=N(F,q,oe.value,H);if(ne===null){q===null&&(q=ee);break}e&&q&&ne.alternate===null&&n(F,q),M=p(ne,M,Q),z===null?B=ne:z.sibling=ne,z=ne,q=ee}if(oe.done)return a(F,q),kr&&ah(F,Q),B;if(q===null){for(;!oe.done;Q++,oe=V.next())oe=w(F,oe.value,H),oe!==null&&(M=p(oe,M,Q),z===null?B=oe:z.sibling=oe,z=oe);return kr&&ah(F,Q),B}for(q=o(F,q);!oe.done;Q++,oe=V.next())oe=D(q,F,Q,oe.value,H),oe!==null&&(e&&oe.alternate!==null&&q.delete(oe.key===null?Q:oe.key),M=p(oe,M,Q),z===null?B=oe:z.sibling=oe,z=oe);return e&&q.forEach(function(ue){return n(F,ue)}),kr&&ah(F,Q),B}function O(F,M,V,H){if(typeof V=="object"&&V!==null&&V.type===Nf&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case WE:e:{for(var B=V.key,z=M;z!==null;){if(z.key===B){if(B=V.type,B===Nf){if(z.tag===7){a(F,z.sibling),M=d(z,V.props.children),M.return=F,F=M;break e}}else if(z.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===Sd&&xH(B)===z.type){a(F,z.sibling),M=d(z,V.props),M.ref=Lv(F,z,V),M.return=F,F=M;break e}a(F,z);break}else n(F,z);z=z.sibling}V.type===Nf?(M=Sh(V.props.children,F.mode,H,V.key),M.return=F,F=M):(H=kx(V.type,V.key,V.props,null,F.mode,H),H.ref=Lv(F,M,V),H.return=F,F=H)}return m(F);case Cf:e:{for(z=V.key;M!==null;){if(M.key===z)if(M.tag===4&&M.stateNode.containerInfo===V.containerInfo&&M.stateNode.implementation===V.implementation){a(F,M.sibling),M=d(M,V.children||[]),M.return=F,F=M;break e}else{a(F,M);break}else n(F,M);M=M.sibling}M=OO(V,F.mode,H),M.return=F,F=M}return m(F);case Sd:return z=V._init,O(F,M,z(V._payload),H)}if(Zv(V))return A(F,M,V,H);if(Ov(V))return k(F,M,V,H);ex(F,V)}return typeof V=="string"&&V!==""||typeof V=="number"?(V=""+V,M!==null&&M.tag===6?(a(F,M.sibling),M=d(M,V),M.return=F,F=M):(a(F,M),M=IO(V,F.mode,H),M.return=F,F=M),m(F)):a(F,M)}return O}var nm=Wq(!0),$q=Wq(!1),tS=Qd(null),nS=null,jf=null,Tk=null;function Ck(){Tk=jf=nS=null}function Nk(e){var n=tS.current;Cr(tS),e._currentValue=n}function z1(e,n,a){for(;e!==null;){var o=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),e===a)break;e=e.return}}function Hf(e,n){nS=e,Tk=jf=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&n&&(Ya=!0),e.firstContext=null)}function fo(e){var n=e._currentValue;if(Tk!==e)if(e={context:e,memoizedValue:n,next:null},jf===null){if(nS===null)throw Error(rt(308));jf=e,nS.dependencies={lanes:0,firstContext:e}}else jf=jf.next=e;return n}var ph=null;function Rk(e){ph===null?ph=[e]:ph.push(e)}function Hq(e,n,a,o){var d=n.interleaved;return d===null?(a.next=a,Rk(n)):(a.next=d.next,d.next=a),n.interleaved=a,Il(e,o)}function Il(e,n){e.lanes|=n;var a=e.alternate;for(a!==null&&(a.lanes|=n),a=e,e=e.return;e!==null;)e.childLanes|=n,a=e.alternate,a!==null&&(a.childLanes|=n),a=e,e=e.return;return a.tag===3?a.stateNode:null}var wd=!1;function Ak(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zq(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Sl(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function Vd(e,n,a){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,Un&2){var d=o.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),o.pending=n,Il(e,a)}return d=o.interleaved,d===null?(n.next=n,Rk(o)):(n.next=d.next,d.next=n),o.interleaved=n,Il(e,a)}function Rx(e,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194240)!==0)){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,fk(e,a)}}function SH(e,n){var a=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var d=null,p=null;if(a=a.firstBaseUpdate,a!==null){do{var m={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};p===null?d=p=m:p=p.next=m,a=a.next}while(a!==null);p===null?d=p=n:p=p.next=n}else d=p=n;a={baseState:o.baseState,firstBaseUpdate:d,lastBaseUpdate:p,shared:o.shared,effects:o.effects},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=n:e.next=n,a.lastBaseUpdate=n}function rS(e,n,a,o){var d=e.updateQueue;wd=!1;var p=d.firstBaseUpdate,m=d.lastBaseUpdate,y=d.shared.pending;if(y!==null){d.shared.pending=null;var b=y,E=b.next;b.next=null,m===null?p=E:m.next=E,m=b;var T=e.alternate;T!==null&&(T=T.updateQueue,y=T.lastBaseUpdate,y!==m&&(y===null?T.firstBaseUpdate=E:y.next=E,T.lastBaseUpdate=b))}if(p!==null){var w=d.baseState;m=0,T=E=b=null,y=p;do{var N=y.lane,D=y.eventTime;if((o&N)===N){T!==null&&(T=T.next={eventTime:D,lane:0,tag:y.tag,payload:y.payload,callback:y.callback,next:null});e:{var A=e,k=y;switch(N=n,D=a,k.tag){case 1:if(A=k.payload,typeof A=="function"){w=A.call(D,w,N);break e}w=A;break e;case 3:A.flags=A.flags&-65537|128;case 0:if(A=k.payload,N=typeof A=="function"?A.call(D,w,N):A,N==null)break e;w=Wr({},w,N);break e;case 2:wd=!0}}y.callback!==null&&y.lane!==0&&(e.flags|=64,N=d.effects,N===null?d.effects=[y]:N.push(y))}else D={eventTime:D,lane:N,tag:y.tag,payload:y.payload,callback:y.callback,next:null},T===null?(E=T=D,b=w):T=T.next=D,m|=N;if(y=y.next,y===null){if(y=d.shared.pending,y===null)break;N=y,y=N.next,N.next=null,d.lastBaseUpdate=N,d.shared.pending=null}}while(!0);if(T===null&&(b=w),d.baseState=b,d.firstBaseUpdate=E,d.lastBaseUpdate=T,n=d.shared.interleaved,n!==null){d=n;do m|=d.lane,d=d.next;while(d!==n)}else p===null&&(d.shared.lanes=0);Oh|=m,e.lanes=m,e.memoizedState=w}}function wH(e,n,a){if(e=n.effects,n.effects=null,e!==null)for(n=0;n<e.length;n++){var o=e[n],d=o.callback;if(d!==null){if(o.callback=null,o=a,typeof d!="function")throw Error(rt(191,d));d.call(o)}}}var C_={},Gc=Qd(C_),Iy=Qd(C_),Oy=Qd(C_);function fh(e){if(e===C_)throw Error(rt(174));return e}function Ik(e,n){switch(pr(Oy,n),pr(Iy,e),pr(Gc,C_),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:C1(null,"");break;default:e=e===8?n.parentNode:n,n=e.namespaceURI||null,e=e.tagName,n=C1(n,e)}Cr(Gc),pr(Gc,n)}function rm(){Cr(Gc),Cr(Iy),Cr(Oy)}function Kq(e){fh(Oy.current);var n=fh(Gc.current),a=C1(n,e.type);n!==a&&(pr(Iy,e),pr(Gc,a))}function Ok(e){Iy.current===e&&(Cr(Gc),Cr(Iy))}var Br=Qd(0);function iS(e){for(var n=e;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var wO=[];function Pk(){for(var e=0;e<wO.length;e++)wO[e]._workInProgressVersionPrimary=null;wO.length=0}var Ax=Ll.ReactCurrentDispatcher,TO=Ll.ReactCurrentBatchConfig,Ih=0,Gr=null,vi=null,Oi=null,aS=!1,ly=!1,Py=0,Jbe=0;function ia(){throw Error(rt(321))}function Dk(e,n){if(n===null)return!1;for(var a=0;a<n.length&&a<e.length;a++)if(!rc(e[a],n[a]))return!1;return!0}function kk(e,n,a,o,d,p){if(Ih=p,Gr=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,Ax.current=e===null||e.memoizedState===null?tEe:nEe,e=a(o,d),ly){p=0;do{if(ly=!1,Py=0,25<=p)throw Error(rt(301));p+=1,Oi=vi=null,n.updateQueue=null,Ax.current=rEe,e=a(o,d)}while(ly)}if(Ax.current=sS,n=vi!==null&&vi.next!==null,Ih=0,Oi=vi=Gr=null,aS=!1,n)throw Error(rt(300));return e}function jk(){var e=Py!==0;return Py=0,e}function jc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?Gr.memoizedState=Oi=e:Oi=Oi.next=e,Oi}function mo(){if(vi===null){var e=Gr.alternate;e=e!==null?e.memoizedState:null}else e=vi.next;var n=Oi===null?Gr.memoizedState:Oi.next;if(n!==null)Oi=n,vi=e;else{if(e===null)throw Error(rt(310));vi=e,e={memoizedState:vi.memoizedState,baseState:vi.baseState,baseQueue:vi.baseQueue,queue:vi.queue,next:null},Oi===null?Gr.memoizedState=Oi=e:Oi=Oi.next=e}return Oi}function Dy(e,n){return typeof n=="function"?n(e):n}function CO(e){var n=mo(),a=n.queue;if(a===null)throw Error(rt(311));a.lastRenderedReducer=e;var o=vi,d=o.baseQueue,p=a.pending;if(p!==null){if(d!==null){var m=d.next;d.next=p.next,p.next=m}o.baseQueue=d=p,a.pending=null}if(d!==null){p=d.next,o=o.baseState;var y=m=null,b=null,E=p;do{var T=E.lane;if((Ih&T)===T)b!==null&&(b=b.next={lane:0,action:E.action,hasEagerState:E.hasEagerState,eagerState:E.eagerState,next:null}),o=E.hasEagerState?E.eagerState:e(o,E.action);else{var w={lane:T,action:E.action,hasEagerState:E.hasEagerState,eagerState:E.eagerState,next:null};b===null?(y=b=w,m=o):b=b.next=w,Gr.lanes|=T,Oh|=T}E=E.next}while(E!==null&&E!==p);b===null?m=o:b.next=y,rc(o,n.memoizedState)||(Ya=!0),n.memoizedState=o,n.baseState=m,n.baseQueue=b,a.lastRenderedState=o}if(e=a.interleaved,e!==null){d=e;do p=d.lane,Gr.lanes|=p,Oh|=p,d=d.next;while(d!==e)}else d===null&&(a.lanes=0);return[n.memoizedState,a.dispatch]}function NO(e){var n=mo(),a=n.queue;if(a===null)throw Error(rt(311));a.lastRenderedReducer=e;var o=a.dispatch,d=a.pending,p=n.memoizedState;if(d!==null){a.pending=null;var m=d=d.next;do p=e(p,m.action),m=m.next;while(m!==d);rc(p,n.memoizedState)||(Ya=!0),n.memoizedState=p,n.baseQueue===null&&(n.baseState=p),a.lastRenderedState=p}return[p,o]}function Yq(){}function qq(e,n){var a=Gr,o=mo(),d=n(),p=!rc(o.memoizedState,d);if(p&&(o.memoizedState=d,Ya=!0),o=o.queue,Lk(Qq.bind(null,a,o,e),[e]),o.getSnapshot!==n||p||Oi!==null&&Oi.memoizedState.tag&1){if(a.flags|=2048,ky(9,Jq.bind(null,a,o,d,n),void 0,null),Di===null)throw Error(rt(349));Ih&30||Xq(a,n,d)}return d}function Xq(e,n,a){e.flags|=16384,e={getSnapshot:n,value:a},n=Gr.updateQueue,n===null?(n={lastEffect:null,stores:null},Gr.updateQueue=n,n.stores=[e]):(a=n.stores,a===null?n.stores=[e]:a.push(e))}function Jq(e,n,a,o){n.value=a,n.getSnapshot=o,Zq(n)&&eX(e)}function Qq(e,n,a){return a(function(){Zq(n)&&eX(e)})}function Zq(e){var n=e.getSnapshot;e=e.value;try{var a=n();return!rc(e,a)}catch{return!0}}function eX(e){var n=Il(e,1);n!==null&&tc(n,e,1,-1)}function TH(e){var n=jc();return typeof e=="function"&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dy,lastRenderedState:e},n.queue=e,e=e.dispatch=eEe.bind(null,Gr,e),[n.memoizedState,e]}function ky(e,n,a,o){return e={tag:e,create:n,destroy:a,deps:o,next:null},n=Gr.updateQueue,n===null?(n={lastEffect:null,stores:null},Gr.updateQueue=n,n.lastEffect=e.next=e):(a=n.lastEffect,a===null?n.lastEffect=e.next=e:(o=a.next,a.next=e,e.next=o,n.lastEffect=e)),e}function tX(){return mo().memoizedState}function Ix(e,n,a,o){var d=jc();Gr.flags|=e,d.memoizedState=ky(1|n,a,void 0,o===void 0?null:o)}function Iw(e,n,a,o){var d=mo();o=o===void 0?null:o;var p=void 0;if(vi!==null){var m=vi.memoizedState;if(p=m.destroy,o!==null&&Dk(o,m.deps)){d.memoizedState=ky(n,a,p,o);return}}Gr.flags|=e,d.memoizedState=ky(1|n,a,p,o)}function CH(e,n){return Ix(8390656,8,e,n)}function Lk(e,n){return Iw(2048,8,e,n)}function nX(e,n){return Iw(4,2,e,n)}function rX(e,n){return Iw(4,4,e,n)}function iX(e,n){if(typeof n=="function")return e=e(),n(e),function(){n(null)};if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function aX(e,n,a){return a=a!=null?a.concat([e]):null,Iw(4,4,iX.bind(null,n,e),a)}function Mk(){}function sX(e,n){var a=mo();n=n===void 0?null:n;var o=a.memoizedState;return o!==null&&n!==null&&Dk(n,o[1])?o[0]:(a.memoizedState=[e,n],e)}function oX(e,n){var a=mo();n=n===void 0?null:n;var o=a.memoizedState;return o!==null&&n!==null&&Dk(n,o[1])?o[0]:(e=e(),a.memoizedState=[e,n],e)}function cX(e,n,a){return Ih&21?(rc(a,n)||(a=pq(),Gr.lanes|=a,Oh|=a,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,Ya=!0),e.memoizedState=a)}function Qbe(e,n){var a=Jn;Jn=a!==0&&4>a?a:4,e(!0);var o=TO.transition;TO.transition={};try{e(!1),n()}finally{Jn=a,TO.transition=o}}function lX(){return mo().memoizedState}function Zbe(e,n,a){var o=Gd(e);if(a={lane:o,action:a,hasEagerState:!1,eagerState:null,next:null},dX(e))uX(n,a);else if(a=Hq(e,n,a,o),a!==null){var d=Na();tc(a,e,o,d),hX(a,n,o)}}function eEe(e,n,a){var o=Gd(e),d={lane:o,action:a,hasEagerState:!1,eagerState:null,next:null};if(dX(e))uX(n,d);else{var p=e.alternate;if(e.lanes===0&&(p===null||p.lanes===0)&&(p=n.lastRenderedReducer,p!==null))try{var m=n.lastRenderedState,y=p(m,a);if(d.hasEagerState=!0,d.eagerState=y,rc(y,m)){var b=n.interleaved;b===null?(d.next=d,Rk(n)):(d.next=b.next,b.next=d),n.interleaved=d;return}}catch{}finally{}a=Hq(e,n,d,o),a!==null&&(d=Na(),tc(a,e,o,d),hX(a,n,o))}}function dX(e){var n=e.alternate;return e===Gr||n!==null&&n===Gr}function uX(e,n){ly=aS=!0;var a=e.pending;a===null?n.next=n:(n.next=a.next,a.next=n),e.pending=n}function hX(e,n,a){if(a&4194240){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,fk(e,a)}}var sS={readContext:fo,useCallback:ia,useContext:ia,useEffect:ia,useImperativeHandle:ia,useInsertionEffect:ia,useLayoutEffect:ia,useMemo:ia,useReducer:ia,useRef:ia,useState:ia,useDebugValue:ia,useDeferredValue:ia,useTransition:ia,useMutableSource:ia,useSyncExternalStore:ia,useId:ia,unstable_isNewReconciler:!1},tEe={readContext:fo,useCallback:function(e,n){return jc().memoizedState=[e,n===void 0?null:n],e},useContext:fo,useEffect:CH,useImperativeHandle:function(e,n,a){return a=a!=null?a.concat([e]):null,Ix(4194308,4,iX.bind(null,n,e),a)},useLayoutEffect:function(e,n){return Ix(4194308,4,e,n)},useInsertionEffect:function(e,n){return Ix(4,2,e,n)},useMemo:function(e,n){var a=jc();return n=n===void 0?null:n,e=e(),a.memoizedState=[e,n],e},useReducer:function(e,n,a){var o=jc();return n=a!==void 0?a(n):n,o.memoizedState=o.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},o.queue=e,e=e.dispatch=Zbe.bind(null,Gr,e),[o.memoizedState,e]},useRef:function(e){var n=jc();return e={current:e},n.memoizedState=e},useState:TH,useDebugValue:Mk,useDeferredValue:function(e){return jc().memoizedState=e},useTransition:function(){var e=TH(!1),n=e[0];return e=Qbe.bind(null,e[1]),jc().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,a){var o=Gr,d=jc();if(kr){if(a===void 0)throw Error(rt(407));a=a()}else{if(a=n(),Di===null)throw Error(rt(349));Ih&30||Xq(o,n,a)}d.memoizedState=a;var p={value:a,getSnapshot:n};return d.queue=p,CH(Qq.bind(null,o,p,e),[e]),o.flags|=2048,ky(9,Jq.bind(null,o,p,a,n),void 0,null),a},useId:function(){var e=jc(),n=Di.identifierPrefix;if(kr){var a=yl,o=vl;a=(o&~(1<<32-ec(o)-1)).toString(32)+a,n=":"+n+"R"+a,a=Py++,0<a&&(n+="H"+a.toString(32)),n+=":"}else a=Jbe++,n=":"+n+"r"+a.toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},nEe={readContext:fo,useCallback:sX,useContext:fo,useEffect:Lk,useImperativeHandle:aX,useInsertionEffect:nX,useLayoutEffect:rX,useMemo:oX,useReducer:CO,useRef:tX,useState:function(){return CO(Dy)},useDebugValue:Mk,useDeferredValue:function(e){var n=mo();return cX(n,vi.memoizedState,e)},useTransition:function(){var e=CO(Dy)[0],n=mo().memoizedState;return[e,n]},useMutableSource:Yq,useSyncExternalStore:qq,useId:lX,unstable_isNewReconciler:!1},rEe={readContext:fo,useCallback:sX,useContext:fo,useEffect:Lk,useImperativeHandle:aX,useInsertionEffect:nX,useLayoutEffect:rX,useMemo:oX,useReducer:NO,useRef:tX,useState:function(){return NO(Dy)},useDebugValue:Mk,useDeferredValue:function(e){var n=mo();return vi===null?n.memoizedState=e:cX(n,vi.memoizedState,e)},useTransition:function(){var e=NO(Dy)[0],n=mo().memoizedState;return[e,n]},useMutableSource:Yq,useSyncExternalStore:qq,useId:lX,unstable_isNewReconciler:!1};function Ko(e,n){if(e&&e.defaultProps){n=Wr({},n),e=e.defaultProps;for(var a in e)n[a]===void 0&&(n[a]=e[a]);return n}return n}function K1(e,n,a,o){n=e.memoizedState,a=a(o,n),a=a==null?n:Wr({},n,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Ow={isMounted:function(e){return(e=e._reactInternals)?Wh(e)===e:!1},enqueueSetState:function(e,n,a){e=e._reactInternals;var o=Na(),d=Gd(e),p=Sl(o,d);p.payload=n,a!=null&&(p.callback=a),n=Vd(e,p,d),n!==null&&(tc(n,e,d,o),Rx(n,e,d))},enqueueReplaceState:function(e,n,a){e=e._reactInternals;var o=Na(),d=Gd(e),p=Sl(o,d);p.tag=1,p.payload=n,a!=null&&(p.callback=a),n=Vd(e,p,d),n!==null&&(tc(n,e,d,o),Rx(n,e,d))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var a=Na(),o=Gd(e),d=Sl(a,o);d.tag=2,n!=null&&(d.callback=n),n=Vd(e,d,o),n!==null&&(tc(n,e,o,a),Rx(n,e,o))}};function NH(e,n,a,o,d,p,m){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,p,m):n.prototype&&n.prototype.isPureReactComponent?!Cy(a,o)||!Cy(d,p):!0}function pX(e,n,a){var o=!1,d=Yd,p=n.contextType;return typeof p=="object"&&p!==null?p=fo(p):(d=Za(n)?Rh:pa.current,o=n.contextTypes,p=(o=o!=null)?em(e,d):Yd),n=new n(a,p),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Ow,e.stateNode=n,n._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=d,e.__reactInternalMemoizedMaskedChildContext=p),n}function RH(e,n,a,o){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,o),n.state!==e&&Ow.enqueueReplaceState(n,n.state,null)}function Y1(e,n,a,o){var d=e.stateNode;d.props=a,d.state=e.memoizedState,d.refs={},Ak(e);var p=n.contextType;typeof p=="object"&&p!==null?d.context=fo(p):(p=Za(n)?Rh:pa.current,d.context=em(e,p)),d.state=e.memoizedState,p=n.getDerivedStateFromProps,typeof p=="function"&&(K1(e,n,p,a),d.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(n=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),n!==d.state&&Ow.enqueueReplaceState(d,d.state,null),rS(e,a,d,o),d.state=e.memoizedState),typeof d.componentDidMount=="function"&&(e.flags|=4194308)}function im(e,n){try{var a="",o=n;do a+=O0e(o),o=o.return;while(o);var d=a}catch(p){d=`
Error generating stack: `+p.message+`
`+p.stack}return{value:e,source:n,stack:d,digest:null}}function RO(e,n,a){return{value:e,source:null,stack:a??null,digest:n??null}}function q1(e,n){try{console.error(n.value)}catch(a){setTimeout(function(){throw a})}}var iEe=typeof WeakMap=="function"?WeakMap:Map;function fX(e,n,a){a=Sl(-1,a),a.tag=3,a.payload={element:null};var o=n.value;return a.callback=function(){cS||(cS=!0,aP=o),q1(e,n)},a}function mX(e,n,a){a=Sl(-1,a),a.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var d=n.value;a.payload=function(){return o(d)},a.callback=function(){q1(e,n)}}var p=e.stateNode;return p!==null&&typeof p.componentDidCatch=="function"&&(a.callback=function(){q1(e,n),typeof o!="function"&&(Bd===null?Bd=new Set([this]):Bd.add(this));var m=n.stack;this.componentDidCatch(n.value,{componentStack:m!==null?m:""})}),a}function AH(e,n,a){var o=e.pingCache;if(o===null){o=e.pingCache=new iEe;var d=new Set;o.set(n,d)}else d=o.get(n),d===void 0&&(d=new Set,o.set(n,d));d.has(a)||(d.add(a),e=yEe.bind(null,e,n,a),n.then(e,e))}function IH(e){do{var n;if((n=e.tag===13)&&(n=e.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return e;e=e.return}while(e!==null);return null}function OH(e,n,a,o,d){return e.mode&1?(e.flags|=65536,e.lanes=d,e):(e===n?e.flags|=65536:(e.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(n=Sl(-1,1),n.tag=2,Vd(a,n,1))),a.lanes|=1),e)}var aEe=Ll.ReactCurrentOwner,Ya=!1;function Ta(e,n,a,o){n.child=e===null?$q(n,null,a,o):nm(n,e.child,a,o)}function PH(e,n,a,o,d){a=a.render;var p=n.ref;return Hf(n,d),o=kk(e,n,a,o,p,d),a=jk(),e!==null&&!Ya?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~d,Ol(e,n,d)):(kr&&a&&xk(n),n.flags|=1,Ta(e,n,o,d),n.child)}function DH(e,n,a,o,d){if(e===null){var p=a.type;return typeof p=="function"&&!Hk(p)&&p.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(n.tag=15,n.type=p,gX(e,n,p,o,d)):(e=kx(a.type,null,o,n,n.mode,d),e.ref=n.ref,e.return=n,n.child=e)}if(p=e.child,!(e.lanes&d)){var m=p.memoizedProps;if(a=a.compare,a=a!==null?a:Cy,a(m,o)&&e.ref===n.ref)return Ol(e,n,d)}return n.flags|=1,e=Wd(p,o),e.ref=n.ref,e.return=n,n.child=e}function gX(e,n,a,o,d){if(e!==null){var p=e.memoizedProps;if(Cy(p,o)&&e.ref===n.ref)if(Ya=!1,n.pendingProps=o=p,(e.lanes&d)!==0)e.flags&131072&&(Ya=!0);else return n.lanes=e.lanes,Ol(e,n,d)}return X1(e,n,a,o,d)}function vX(e,n,a){var o=n.pendingProps,d=o.children,p=e!==null?e.memoizedState:null;if(o.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},pr(Mf,_s),_s|=a;else{if(!(a&1073741824))return e=p!==null?p.baseLanes|a:a,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,pr(Mf,_s),_s|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=p!==null?p.baseLanes:a,pr(Mf,_s),_s|=o}else p!==null?(o=p.baseLanes|a,n.memoizedState=null):o=a,pr(Mf,_s),_s|=o;return Ta(e,n,d,a),n.child}function yX(e,n){var a=n.ref;(e===null&&a!==null||e!==null&&e.ref!==a)&&(n.flags|=512,n.flags|=2097152)}function X1(e,n,a,o,d){var p=Za(a)?Rh:pa.current;return p=em(n,p),Hf(n,d),a=kk(e,n,a,o,p,d),o=jk(),e!==null&&!Ya?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~d,Ol(e,n,d)):(kr&&o&&xk(n),n.flags|=1,Ta(e,n,a,d),n.child)}function kH(e,n,a,o,d){if(Za(a)){var p=!0;Qx(n)}else p=!1;if(Hf(n,d),n.stateNode===null)Ox(e,n),pX(n,a,o),Y1(n,a,o,d),o=!0;else if(e===null){var m=n.stateNode,y=n.memoizedProps;m.props=y;var b=m.context,E=a.contextType;typeof E=="object"&&E!==null?E=fo(E):(E=Za(a)?Rh:pa.current,E=em(n,E));var T=a.getDerivedStateFromProps,w=typeof T=="function"||typeof m.getSnapshotBeforeUpdate=="function";w||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(y!==o||b!==E)&&RH(n,m,o,E),wd=!1;var N=n.memoizedState;m.state=N,rS(n,o,m,d),b=n.memoizedState,y!==o||N!==b||Qa.current||wd?(typeof T=="function"&&(K1(n,a,T,o),b=n.memoizedState),(y=wd||NH(n,a,y,o,N,b,E))?(w||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(n.flags|=4194308)):(typeof m.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=b),m.props=o,m.state=b,m.context=E,o=y):(typeof m.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{m=n.stateNode,zq(e,n),y=n.memoizedProps,E=n.type===n.elementType?y:Ko(n.type,y),m.props=E,w=n.pendingProps,N=m.context,b=a.contextType,typeof b=="object"&&b!==null?b=fo(b):(b=Za(a)?Rh:pa.current,b=em(n,b));var D=a.getDerivedStateFromProps;(T=typeof D=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(y!==w||N!==b)&&RH(n,m,o,b),wd=!1,N=n.memoizedState,m.state=N,rS(n,o,m,d);var A=n.memoizedState;y!==w||N!==A||Qa.current||wd?(typeof D=="function"&&(K1(n,a,D,o),A=n.memoizedState),(E=wd||NH(n,a,E,o,N,A,b)||!1)?(T||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(o,A,b),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(o,A,b)),typeof m.componentDidUpdate=="function"&&(n.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof m.componentDidUpdate!="function"||y===e.memoizedProps&&N===e.memoizedState||(n.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&N===e.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=A),m.props=o,m.state=A,m.context=b,o=E):(typeof m.componentDidUpdate!="function"||y===e.memoizedProps&&N===e.memoizedState||(n.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&N===e.memoizedState||(n.flags|=1024),o=!1)}return J1(e,n,a,o,p,d)}function J1(e,n,a,o,d,p){yX(e,n);var m=(n.flags&128)!==0;if(!o&&!m)return d&&_H(n,a,!1),Ol(e,n,p);o=n.stateNode,aEe.current=n;var y=m&&typeof a.getDerivedStateFromError!="function"?null:o.render();return n.flags|=1,e!==null&&m?(n.child=nm(n,e.child,null,p),n.child=nm(n,null,y,p)):Ta(e,n,y,p),n.memoizedState=o.state,d&&_H(n,a,!0),n.child}function _X(e){var n=e.stateNode;n.pendingContext?yH(e,n.pendingContext,n.pendingContext!==n.context):n.context&&yH(e,n.context,!1),Ik(e,n.containerInfo)}function jH(e,n,a,o,d){return tm(),wk(d),n.flags|=256,Ta(e,n,a,o),n.child}var Q1={dehydrated:null,treeContext:null,retryLane:0};function Z1(e){return{baseLanes:e,cachePool:null,transitions:null}}function bX(e,n,a){var o=n.pendingProps,d=Br.current,p=!1,m=(n.flags&128)!==0,y;if((y=m)||(y=e!==null&&e.memoizedState===null?!1:(d&2)!==0),y?(p=!0,n.flags&=-129):(e===null||e.memoizedState!==null)&&(d|=1),pr(Br,d&1),e===null)return H1(n),e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(n.mode&1?e.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(m=o.children,e=o.fallback,p?(o=n.mode,p=n.child,m={mode:"hidden",children:m},!(o&1)&&p!==null?(p.childLanes=0,p.pendingProps=m):p=kw(m,o,0,null),e=Sh(e,o,a,null),p.return=n,e.return=n,p.sibling=e,n.child=p,n.child.memoizedState=Z1(a),n.memoizedState=Q1,e):Uk(n,m));if(d=e.memoizedState,d!==null&&(y=d.dehydrated,y!==null))return sEe(e,n,m,o,y,d,a);if(p){p=o.fallback,m=n.mode,d=e.child,y=d.sibling;var b={mode:"hidden",children:o.children};return!(m&1)&&n.child!==d?(o=n.child,o.childLanes=0,o.pendingProps=b,n.deletions=null):(o=Wd(d,b),o.subtreeFlags=d.subtreeFlags&14680064),y!==null?p=Wd(y,p):(p=Sh(p,m,a,null),p.flags|=2),p.return=n,o.return=n,o.sibling=p,n.child=o,o=p,p=n.child,m=e.child.memoizedState,m=m===null?Z1(a):{baseLanes:m.baseLanes|a,cachePool:null,transitions:m.transitions},p.memoizedState=m,p.childLanes=e.childLanes&~a,n.memoizedState=Q1,o}return p=e.child,e=p.sibling,o=Wd(p,{mode:"visible",children:o.children}),!(n.mode&1)&&(o.lanes=a),o.return=n,o.sibling=null,e!==null&&(a=n.deletions,a===null?(n.deletions=[e],n.flags|=16):a.push(e)),n.child=o,n.memoizedState=null,o}function Uk(e,n){return n=kw({mode:"visible",children:n},e.mode,0,null),n.return=e,e.child=n}function tx(e,n,a,o){return o!==null&&wk(o),nm(n,e.child,null,a),e=Uk(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function sEe(e,n,a,o,d,p,m){if(a)return n.flags&256?(n.flags&=-257,o=RO(Error(rt(422))),tx(e,n,m,o)):n.memoizedState!==null?(n.child=e.child,n.flags|=128,null):(p=o.fallback,d=n.mode,o=kw({mode:"visible",children:o.children},d,0,null),p=Sh(p,d,m,null),p.flags|=2,o.return=n,p.return=n,o.sibling=p,n.child=o,n.mode&1&&nm(n,e.child,null,m),n.child.memoizedState=Z1(m),n.memoizedState=Q1,p);if(!(n.mode&1))return tx(e,n,m,null);if(d.data==="$!"){if(o=d.nextSibling&&d.nextSibling.dataset,o)var y=o.dgst;return o=y,p=Error(rt(419)),o=RO(p,o,void 0),tx(e,n,m,o)}if(y=(m&e.childLanes)!==0,Ya||y){if(o=Di,o!==null){switch(m&-m){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(o.suspendedLanes|m)?0:d,d!==0&&d!==p.retryLane&&(p.retryLane=d,Il(e,d),tc(o,e,d,-1))}return $k(),o=RO(Error(rt(421))),tx(e,n,m,o)}return d.data==="$?"?(n.flags|=128,n.child=e.child,n=_Ee.bind(null,e),d._reactRetry=n,null):(e=p.treeContext,ws=Fd(d.nextSibling),Ts=n,kr=!0,Jo=null,e!==null&&(ro[io++]=vl,ro[io++]=yl,ro[io++]=Ah,vl=e.id,yl=e.overflow,Ah=n),n=Uk(n,o.children),n.flags|=4096,n)}function LH(e,n,a){e.lanes|=n;var o=e.alternate;o!==null&&(o.lanes|=n),z1(e.return,n,a)}function AO(e,n,a,o,d){var p=e.memoizedState;p===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:d}:(p.isBackwards=n,p.rendering=null,p.renderingStartTime=0,p.last=o,p.tail=a,p.tailMode=d)}function EX(e,n,a){var o=n.pendingProps,d=o.revealOrder,p=o.tail;if(Ta(e,n,o.children,a),o=Br.current,o&2)o=o&1|2,n.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&LH(e,a,n);else if(e.tag===19)LH(e,a,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if(pr(Br,o),!(n.mode&1))n.memoizedState=null;else switch(d){case"forwards":for(a=n.child,d=null;a!==null;)e=a.alternate,e!==null&&iS(e)===null&&(d=a),a=a.sibling;a=d,a===null?(d=n.child,n.child=null):(d=a.sibling,a.sibling=null),AO(n,!1,d,a,p);break;case"backwards":for(a=null,d=n.child,n.child=null;d!==null;){if(e=d.alternate,e!==null&&iS(e)===null){n.child=d;break}e=d.sibling,d.sibling=a,a=d,d=e}AO(n,!0,a,null,p);break;case"together":AO(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Ox(e,n){!(n.mode&1)&&e!==null&&(e.alternate=null,n.alternate=null,n.flags|=2)}function Ol(e,n,a){if(e!==null&&(n.dependencies=e.dependencies),Oh|=n.lanes,!(a&n.childLanes))return null;if(e!==null&&n.child!==e.child)throw Error(rt(153));if(n.child!==null){for(e=n.child,a=Wd(e,e.pendingProps),n.child=a,a.return=n;e.sibling!==null;)e=e.sibling,a=a.sibling=Wd(e,e.pendingProps),a.return=n;a.sibling=null}return n.child}function oEe(e,n,a){switch(n.tag){case 3:_X(n),tm();break;case 5:Kq(n);break;case 1:Za(n.type)&&Qx(n);break;case 4:Ik(n,n.stateNode.containerInfo);break;case 10:var o=n.type._context,d=n.memoizedProps.value;pr(tS,o._currentValue),o._currentValue=d;break;case 13:if(o=n.memoizedState,o!==null)return o.dehydrated!==null?(pr(Br,Br.current&1),n.flags|=128,null):a&n.child.childLanes?bX(e,n,a):(pr(Br,Br.current&1),e=Ol(e,n,a),e!==null?e.sibling:null);pr(Br,Br.current&1);break;case 19:if(o=(a&n.childLanes)!==0,e.flags&128){if(o)return EX(e,n,a);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),pr(Br,Br.current),o)break;return null;case 22:case 23:return n.lanes=0,vX(e,n,a)}return Ol(e,n,a)}var xX,eP,SX,wX;xX=function(e,n){for(var a=n.child;a!==null;){if(a.tag===5||a.tag===6)e.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};eP=function(){};SX=function(e,n,a,o){var d=e.memoizedProps;if(d!==o){e=n.stateNode,fh(Gc.current);var p=null;switch(a){case"input":d=x1(e,d),o=x1(e,o),p=[];break;case"select":d=Wr({},d,{value:void 0}),o=Wr({},o,{value:void 0}),p=[];break;case"textarea":d=T1(e,d),o=T1(e,o),p=[];break;default:typeof d.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=Xx)}N1(a,o);var m;a=null;for(E in d)if(!o.hasOwnProperty(E)&&d.hasOwnProperty(E)&&d[E]!=null)if(E==="style"){var y=d[E];for(m in y)y.hasOwnProperty(m)&&(a||(a={}),a[m]="")}else E!=="dangerouslySetInnerHTML"&&E!=="children"&&E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(_y.hasOwnProperty(E)?p||(p=[]):(p=p||[]).push(E,null));for(E in o){var b=o[E];if(y=d!=null?d[E]:void 0,o.hasOwnProperty(E)&&b!==y&&(b!=null||y!=null))if(E==="style")if(y){for(m in y)!y.hasOwnProperty(m)||b&&b.hasOwnProperty(m)||(a||(a={}),a[m]="");for(m in b)b.hasOwnProperty(m)&&y[m]!==b[m]&&(a||(a={}),a[m]=b[m])}else a||(p||(p=[]),p.push(E,a)),a=b;else E==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,y=y?y.__html:void 0,b!=null&&y!==b&&(p=p||[]).push(E,b)):E==="children"?typeof b!="string"&&typeof b!="number"||(p=p||[]).push(E,""+b):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&(_y.hasOwnProperty(E)?(b!=null&&E==="onScroll"&&Sr("scroll",e),p||y===b||(p=[])):(p=p||[]).push(E,b))}a&&(p=p||[]).push("style",a);var E=p;(n.updateQueue=E)&&(n.flags|=4)}};wX=function(e,n,a,o){a!==o&&(n.flags|=4)};function Mv(e,n){if(!kr)switch(e.tailMode){case"hidden":n=e.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function aa(e){var n=e.alternate!==null&&e.alternate.child===e.child,a=0,o=0;if(n)for(var d=e.child;d!==null;)a|=d.lanes|d.childLanes,o|=d.subtreeFlags&14680064,o|=d.flags&14680064,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)a|=d.lanes|d.childLanes,o|=d.subtreeFlags,o|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=o,e.childLanes=a,n}function cEe(e,n,a){var o=n.pendingProps;switch(Sk(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return aa(n),null;case 1:return Za(n.type)&&Jx(),aa(n),null;case 3:return o=n.stateNode,rm(),Cr(Qa),Cr(pa),Pk(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(ZE(n)?n.flags|=4:e===null||e.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Jo!==null&&(cP(Jo),Jo=null))),eP(e,n),aa(n),null;case 5:Ok(n);var d=fh(Oy.current);if(a=n.type,e!==null&&n.stateNode!=null)SX(e,n,a,o,d),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!o){if(n.stateNode===null)throw Error(rt(166));return aa(n),null}if(e=fh(Gc.current),ZE(n)){o=n.stateNode,a=n.type;var p=n.memoizedProps;switch(o[Mc]=n,o[Ay]=p,e=(n.mode&1)!==0,a){case"dialog":Sr("cancel",o),Sr("close",o);break;case"iframe":case"object":case"embed":Sr("load",o);break;case"video":case"audio":for(d=0;d<ty.length;d++)Sr(ty[d],o);break;case"source":Sr("error",o);break;case"img":case"image":case"link":Sr("error",o),Sr("load",o);break;case"details":Sr("toggle",o);break;case"input":H$(o,p),Sr("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!p.multiple},Sr("invalid",o);break;case"textarea":K$(o,p),Sr("invalid",o)}N1(a,p),d=null;for(var m in p)if(p.hasOwnProperty(m)){var y=p[m];m==="children"?typeof y=="string"?o.textContent!==y&&(p.suppressHydrationWarning!==!0&&QE(o.textContent,y,e),d=["children",y]):typeof y=="number"&&o.textContent!==""+y&&(p.suppressHydrationWarning!==!0&&QE(o.textContent,y,e),d=["children",""+y]):_y.hasOwnProperty(m)&&y!=null&&m==="onScroll"&&Sr("scroll",o)}switch(a){case"input":$E(o),z$(o,p,!0);break;case"textarea":$E(o),Y$(o);break;case"select":case"option":break;default:typeof p.onClick=="function"&&(o.onclick=Xx)}o=d,n.updateQueue=o,o!==null&&(n.flags|=4)}else{m=d.nodeType===9?d:d.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=QY(a)),e==="http://www.w3.org/1999/xhtml"?a==="script"?(e=m.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=m.createElement(a,{is:o.is}):(e=m.createElement(a),a==="select"&&(m=e,o.multiple?m.multiple=!0:o.size&&(m.size=o.size))):e=m.createElementNS(e,a),e[Mc]=n,e[Ay]=o,xX(e,n,!1,!1),n.stateNode=e;e:{switch(m=R1(a,o),a){case"dialog":Sr("cancel",e),Sr("close",e),d=o;break;case"iframe":case"object":case"embed":Sr("load",e),d=o;break;case"video":case"audio":for(d=0;d<ty.length;d++)Sr(ty[d],e);d=o;break;case"source":Sr("error",e),d=o;break;case"img":case"image":case"link":Sr("error",e),Sr("load",e),d=o;break;case"details":Sr("toggle",e),d=o;break;case"input":H$(e,o),d=x1(e,o),Sr("invalid",e);break;case"option":d=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},d=Wr({},o,{value:void 0}),Sr("invalid",e);break;case"textarea":K$(e,o),d=T1(e,o),Sr("invalid",e);break;default:d=o}N1(a,d),y=d;for(p in y)if(y.hasOwnProperty(p)){var b=y[p];p==="style"?tq(e,b):p==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&ZY(e,b)):p==="children"?typeof b=="string"?(a!=="textarea"||b!=="")&&by(e,b):typeof b=="number"&&by(e,""+b):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(_y.hasOwnProperty(p)?b!=null&&p==="onScroll"&&Sr("scroll",e):b!=null&&ck(e,p,b,m))}switch(a){case"input":$E(e),z$(e,o,!1);break;case"textarea":$E(e),Y$(e);break;case"option":o.value!=null&&e.setAttribute("value",""+Kd(o.value));break;case"select":e.multiple=!!o.multiple,p=o.value,p!=null?Bf(e,!!o.multiple,p,!1):o.defaultValue!=null&&Bf(e,!!o.multiple,o.defaultValue,!0);break;default:typeof d.onClick=="function"&&(e.onclick=Xx)}switch(a){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return aa(n),null;case 6:if(e&&n.stateNode!=null)wX(e,n,e.memoizedProps,o);else{if(typeof o!="string"&&n.stateNode===null)throw Error(rt(166));if(a=fh(Oy.current),fh(Gc.current),ZE(n)){if(o=n.stateNode,a=n.memoizedProps,o[Mc]=n,(p=o.nodeValue!==a)&&(e=Ts,e!==null))switch(e.tag){case 3:QE(o.nodeValue,a,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&QE(o.nodeValue,a,(e.mode&1)!==0)}p&&(n.flags|=4)}else o=(a.nodeType===9?a:a.ownerDocument).createTextNode(o),o[Mc]=n,n.stateNode=o}return aa(n),null;case 13:if(Cr(Br),o=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(kr&&ws!==null&&n.mode&1&&!(n.flags&128))Gq(),tm(),n.flags|=98560,p=!1;else if(p=ZE(n),o!==null&&o.dehydrated!==null){if(e===null){if(!p)throw Error(rt(318));if(p=n.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(rt(317));p[Mc]=n}else tm(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;aa(n),p=!1}else Jo!==null&&(cP(Jo),Jo=null),p=!0;if(!p)return n.flags&65536?n:null}return n.flags&128?(n.lanes=a,n):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(n.child.flags|=8192,n.mode&1&&(e===null||Br.current&1?_i===0&&(_i=3):$k())),n.updateQueue!==null&&(n.flags|=4),aa(n),null);case 4:return rm(),eP(e,n),e===null&&Ny(n.stateNode.containerInfo),aa(n),null;case 10:return Nk(n.type._context),aa(n),null;case 17:return Za(n.type)&&Jx(),aa(n),null;case 19:if(Cr(Br),p=n.memoizedState,p===null)return aa(n),null;if(o=(n.flags&128)!==0,m=p.rendering,m===null)if(o)Mv(p,!1);else{if(_i!==0||e!==null&&e.flags&128)for(e=n.child;e!==null;){if(m=iS(e),m!==null){for(n.flags|=128,Mv(p,!1),o=m.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),n.subtreeFlags=0,o=a,a=n.child;a!==null;)p=a,e=o,p.flags&=14680066,m=p.alternate,m===null?(p.childLanes=0,p.lanes=e,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=m.childLanes,p.lanes=m.lanes,p.child=m.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=m.memoizedProps,p.memoizedState=m.memoizedState,p.updateQueue=m.updateQueue,p.type=m.type,e=m.dependencies,p.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),a=a.sibling;return pr(Br,Br.current&1|2),n.child}e=e.sibling}p.tail!==null&&ei()>am&&(n.flags|=128,o=!0,Mv(p,!1),n.lanes=4194304)}else{if(!o)if(e=iS(m),e!==null){if(n.flags|=128,o=!0,a=e.updateQueue,a!==null&&(n.updateQueue=a,n.flags|=4),Mv(p,!0),p.tail===null&&p.tailMode==="hidden"&&!m.alternate&&!kr)return aa(n),null}else 2*ei()-p.renderingStartTime>am&&a!==1073741824&&(n.flags|=128,o=!0,Mv(p,!1),n.lanes=4194304);p.isBackwards?(m.sibling=n.child,n.child=m):(a=p.last,a!==null?a.sibling=m:n.child=m,p.last=m)}return p.tail!==null?(n=p.tail,p.rendering=n,p.tail=n.sibling,p.renderingStartTime=ei(),n.sibling=null,a=Br.current,pr(Br,o?a&1|2:a&1),n):(aa(n),null);case 22:case 23:return Wk(),o=n.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(n.flags|=8192),o&&n.mode&1?_s&1073741824&&(aa(n),n.subtreeFlags&6&&(n.flags|=8192)):aa(n),null;case 24:return null;case 25:return null}throw Error(rt(156,n.tag))}function lEe(e,n){switch(Sk(n),n.tag){case 1:return Za(n.type)&&Jx(),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return rm(),Cr(Qa),Cr(pa),Pk(),e=n.flags,e&65536&&!(e&128)?(n.flags=e&-65537|128,n):null;case 5:return Ok(n),null;case 13:if(Cr(Br),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(rt(340));tm()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return Cr(Br),null;case 4:return rm(),null;case 10:return Nk(n.type._context),null;case 22:case 23:return Wk(),null;case 24:return null;default:return null}}var nx=!1,oa=!1,dEe=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function Lf(e,n){var a=e.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(o){Yr(e,n,o)}else a.current=null}function tP(e,n,a){try{a()}catch(o){Yr(e,n,o)}}var MH=!1;function uEe(e,n){if(U1=Kx,e=Aq(),Ek(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var d=o.anchorOffset,p=o.focusNode;o=o.focusOffset;try{a.nodeType,p.nodeType}catch{a=null;break e}var m=0,y=-1,b=-1,E=0,T=0,w=e,N=null;t:for(;;){for(var D;w!==a||d!==0&&w.nodeType!==3||(y=m+d),w!==p||o!==0&&w.nodeType!==3||(b=m+o),w.nodeType===3&&(m+=w.nodeValue.length),(D=w.firstChild)!==null;)N=w,w=D;for(;;){if(w===e)break t;if(N===a&&++E===d&&(y=m),N===p&&++T===o&&(b=m),(D=w.nextSibling)!==null)break;w=N,N=w.parentNode}w=D}a=y===-1||b===-1?null:{start:y,end:b}}else a=null}a=a||{start:0,end:0}}else a=null;for(F1={focusedElem:e,selectionRange:a},Kx=!1,Ct=n;Ct!==null;)if(n=Ct,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,Ct=e;else for(;Ct!==null;){n=Ct;try{var A=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(A!==null){var k=A.memoizedProps,O=A.memoizedState,F=n.stateNode,M=F.getSnapshotBeforeUpdate(n.elementType===n.type?k:Ko(n.type,k),O);F.__reactInternalSnapshotBeforeUpdate=M}break;case 3:var V=n.stateNode.containerInfo;V.nodeType===1?V.textContent="":V.nodeType===9&&V.documentElement&&V.removeChild(V.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(rt(163))}}catch(H){Yr(n,n.return,H)}if(e=n.sibling,e!==null){e.return=n.return,Ct=e;break}Ct=n.return}return A=MH,MH=!1,A}function dy(e,n,a){var o=n.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&e)===e){var p=d.destroy;d.destroy=void 0,p!==void 0&&tP(n,a,p)}d=d.next}while(d!==o)}}function Pw(e,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var o=a.create;a.destroy=o()}a=a.next}while(a!==n)}}function nP(e){var n=e.ref;if(n!==null){var a=e.stateNode;switch(e.tag){case 5:e=a;break;default:e=a}typeof n=="function"?n(e):n.current=e}}function TX(e){var n=e.alternate;n!==null&&(e.alternate=null,TX(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&(delete n[Mc],delete n[Ay],delete n[G1],delete n[Kbe],delete n[Ybe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function CX(e){return e.tag===5||e.tag===3||e.tag===4}function UH(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||CX(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function rP(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.nodeType===8?a.parentNode.insertBefore(e,n):a.insertBefore(e,n):(a.nodeType===8?(n=a.parentNode,n.insertBefore(e,a)):(n=a,n.appendChild(e)),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=Xx));else if(o!==4&&(e=e.child,e!==null))for(rP(e,n,a),e=e.sibling;e!==null;)rP(e,n,a),e=e.sibling}function iP(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.insertBefore(e,n):a.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(iP(e,n,a),e=e.sibling;e!==null;)iP(e,n,a),e=e.sibling}var zi=null,Yo=!1;function Ed(e,n,a){for(a=a.child;a!==null;)NX(e,n,a),a=a.sibling}function NX(e,n,a){if(Bc&&typeof Bc.onCommitFiberUnmount=="function")try{Bc.onCommitFiberUnmount(ww,a)}catch{}switch(a.tag){case 5:oa||Lf(a,n);case 6:var o=zi,d=Yo;zi=null,Ed(e,n,a),zi=o,Yo=d,zi!==null&&(Yo?(e=zi,a=a.stateNode,e.nodeType===8?e.parentNode.removeChild(a):e.removeChild(a)):zi.removeChild(a.stateNode));break;case 18:zi!==null&&(Yo?(e=zi,a=a.stateNode,e.nodeType===8?xO(e.parentNode,a):e.nodeType===1&&xO(e,a),wy(e)):xO(zi,a.stateNode));break;case 4:o=zi,d=Yo,zi=a.stateNode.containerInfo,Yo=!0,Ed(e,n,a),zi=o,Yo=d;break;case 0:case 11:case 14:case 15:if(!oa&&(o=a.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){d=o=o.next;do{var p=d,m=p.destroy;p=p.tag,m!==void 0&&(p&2||p&4)&&tP(a,n,m),d=d.next}while(d!==o)}Ed(e,n,a);break;case 1:if(!oa&&(Lf(a,n),o=a.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=a.memoizedProps,o.state=a.memoizedState,o.componentWillUnmount()}catch(y){Yr(a,n,y)}Ed(e,n,a);break;case 21:Ed(e,n,a);break;case 22:a.mode&1?(oa=(o=oa)||a.memoizedState!==null,Ed(e,n,a),oa=o):Ed(e,n,a);break;default:Ed(e,n,a)}}function FH(e){var n=e.updateQueue;if(n!==null){e.updateQueue=null;var a=e.stateNode;a===null&&(a=e.stateNode=new dEe),n.forEach(function(o){var d=bEe.bind(null,e,o);a.has(o)||(a.add(o),o.then(d,d))})}}function $o(e,n){var a=n.deletions;if(a!==null)for(var o=0;o<a.length;o++){var d=a[o];try{var p=e,m=n,y=m;e:for(;y!==null;){switch(y.tag){case 5:zi=y.stateNode,Yo=!1;break e;case 3:zi=y.stateNode.containerInfo,Yo=!0;break e;case 4:zi=y.stateNode.containerInfo,Yo=!0;break e}y=y.return}if(zi===null)throw Error(rt(160));NX(p,m,d),zi=null,Yo=!1;var b=d.alternate;b!==null&&(b.return=null),d.return=null}catch(E){Yr(d,n,E)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)RX(n,e),n=n.sibling}function RX(e,n){var a=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if($o(n,e),Pc(e),o&4){try{dy(3,e,e.return),Pw(3,e)}catch(k){Yr(e,e.return,k)}try{dy(5,e,e.return)}catch(k){Yr(e,e.return,k)}}break;case 1:$o(n,e),Pc(e),o&512&&a!==null&&Lf(a,a.return);break;case 5:if($o(n,e),Pc(e),o&512&&a!==null&&Lf(a,a.return),e.flags&32){var d=e.stateNode;try{by(d,"")}catch(k){Yr(e,e.return,k)}}if(o&4&&(d=e.stateNode,d!=null)){var p=e.memoizedProps,m=a!==null?a.memoizedProps:p,y=e.type,b=e.updateQueue;if(e.updateQueue=null,b!==null)try{y==="input"&&p.type==="radio"&&p.name!=null&&XY(d,p),R1(y,m);var E=R1(y,p);for(m=0;m<b.length;m+=2){var T=b[m],w=b[m+1];T==="style"?tq(d,w):T==="dangerouslySetInnerHTML"?ZY(d,w):T==="children"?by(d,w):ck(d,T,w,E)}switch(y){case"input":S1(d,p);break;case"textarea":JY(d,p);break;case"select":var N=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!p.multiple;var D=p.value;D!=null?Bf(d,!!p.multiple,D,!1):N!==!!p.multiple&&(p.defaultValue!=null?Bf(d,!!p.multiple,p.defaultValue,!0):Bf(d,!!p.multiple,p.multiple?[]:"",!1))}d[Ay]=p}catch(k){Yr(e,e.return,k)}}break;case 6:if($o(n,e),Pc(e),o&4){if(e.stateNode===null)throw Error(rt(162));d=e.stateNode,p=e.memoizedProps;try{d.nodeValue=p}catch(k){Yr(e,e.return,k)}}break;case 3:if($o(n,e),Pc(e),o&4&&a!==null&&a.memoizedState.isDehydrated)try{wy(n.containerInfo)}catch(k){Yr(e,e.return,k)}break;case 4:$o(n,e),Pc(e);break;case 13:$o(n,e),Pc(e),d=e.child,d.flags&8192&&(p=d.memoizedState!==null,d.stateNode.isHidden=p,!p||d.alternate!==null&&d.alternate.memoizedState!==null||(Bk=ei())),o&4&&FH(e);break;case 22:if(T=a!==null&&a.memoizedState!==null,e.mode&1?(oa=(E=oa)||T,$o(n,e),oa=E):$o(n,e),Pc(e),o&8192){if(E=e.memoizedState!==null,(e.stateNode.isHidden=E)&&!T&&e.mode&1)for(Ct=e,T=e.child;T!==null;){for(w=Ct=T;Ct!==null;){switch(N=Ct,D=N.child,N.tag){case 0:case 11:case 14:case 15:dy(4,N,N.return);break;case 1:Lf(N,N.return);var A=N.stateNode;if(typeof A.componentWillUnmount=="function"){o=N,a=N.return;try{n=o,A.props=n.memoizedProps,A.state=n.memoizedState,A.componentWillUnmount()}catch(k){Yr(o,a,k)}}break;case 5:Lf(N,N.return);break;case 22:if(N.memoizedState!==null){BH(w);continue}}D!==null?(D.return=N,Ct=D):BH(w)}T=T.sibling}e:for(T=null,w=e;;){if(w.tag===5){if(T===null){T=w;try{d=w.stateNode,E?(p=d.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none"):(y=w.stateNode,b=w.memoizedProps.style,m=b!=null&&b.hasOwnProperty("display")?b.display:null,y.style.display=eq("display",m))}catch(k){Yr(e,e.return,k)}}}else if(w.tag===6){if(T===null)try{w.stateNode.nodeValue=E?"":w.memoizedProps}catch(k){Yr(e,e.return,k)}}else if((w.tag!==22&&w.tag!==23||w.memoizedState===null||w===e)&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===e)break e;for(;w.sibling===null;){if(w.return===null||w.return===e)break e;T===w&&(T=null),w=w.return}T===w&&(T=null),w.sibling.return=w.return,w=w.sibling}}break;case 19:$o(n,e),Pc(e),o&4&&FH(e);break;case 21:break;default:$o(n,e),Pc(e)}}function Pc(e){var n=e.flags;if(n&2){try{e:{for(var a=e.return;a!==null;){if(CX(a)){var o=a;break e}a=a.return}throw Error(rt(160))}switch(o.tag){case 5:var d=o.stateNode;o.flags&32&&(by(d,""),o.flags&=-33);var p=UH(e);iP(e,p,d);break;case 3:case 4:var m=o.stateNode.containerInfo,y=UH(e);rP(e,y,m);break;default:throw Error(rt(161))}}catch(b){Yr(e,e.return,b)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function hEe(e,n,a){Ct=e,AX(e)}function AX(e,n,a){for(var o=(e.mode&1)!==0;Ct!==null;){var d=Ct,p=d.child;if(d.tag===22&&o){var m=d.memoizedState!==null||nx;if(!m){var y=d.alternate,b=y!==null&&y.memoizedState!==null||oa;y=nx;var E=oa;if(nx=m,(oa=b)&&!E)for(Ct=d;Ct!==null;)m=Ct,b=m.child,m.tag===22&&m.memoizedState!==null?GH(d):b!==null?(b.return=m,Ct=b):GH(d);for(;p!==null;)Ct=p,AX(p),p=p.sibling;Ct=d,nx=y,oa=E}VH(e)}else d.subtreeFlags&8772&&p!==null?(p.return=d,Ct=p):VH(e)}}function VH(e){for(;Ct!==null;){var n=Ct;if(n.flags&8772){var a=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:oa||Pw(5,n);break;case 1:var o=n.stateNode;if(n.flags&4&&!oa)if(a===null)o.componentDidMount();else{var d=n.elementType===n.type?a.memoizedProps:Ko(n.type,a.memoizedProps);o.componentDidUpdate(d,a.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var p=n.updateQueue;p!==null&&wH(n,p,o);break;case 3:var m=n.updateQueue;if(m!==null){if(a=null,n.child!==null)switch(n.child.tag){case 5:a=n.child.stateNode;break;case 1:a=n.child.stateNode}wH(n,m,a)}break;case 5:var y=n.stateNode;if(a===null&&n.flags&4){a=y;var b=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&a.focus();break;case"img":b.src&&(a.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var E=n.alternate;if(E!==null){var T=E.memoizedState;if(T!==null){var w=T.dehydrated;w!==null&&wy(w)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(rt(163))}oa||n.flags&512&&nP(n)}catch(N){Yr(n,n.return,N)}}if(n===e){Ct=null;break}if(a=n.sibling,a!==null){a.return=n.return,Ct=a;break}Ct=n.return}}function BH(e){for(;Ct!==null;){var n=Ct;if(n===e){Ct=null;break}var a=n.sibling;if(a!==null){a.return=n.return,Ct=a;break}Ct=n.return}}function GH(e){for(;Ct!==null;){var n=Ct;try{switch(n.tag){case 0:case 11:case 15:var a=n.return;try{Pw(4,n)}catch(b){Yr(n,a,b)}break;case 1:var o=n.stateNode;if(typeof o.componentDidMount=="function"){var d=n.return;try{o.componentDidMount()}catch(b){Yr(n,d,b)}}var p=n.return;try{nP(n)}catch(b){Yr(n,p,b)}break;case 5:var m=n.return;try{nP(n)}catch(b){Yr(n,m,b)}}}catch(b){Yr(n,n.return,b)}if(n===e){Ct=null;break}var y=n.sibling;if(y!==null){y.return=n.return,Ct=y;break}Ct=n.return}}var pEe=Math.ceil,oS=Ll.ReactCurrentDispatcher,Fk=Ll.ReactCurrentOwner,uo=Ll.ReactCurrentBatchConfig,Un=0,Di=null,ci=null,qi=0,_s=0,Mf=Qd(0),_i=0,jy=null,Oh=0,Dw=0,Vk=0,uy=null,Ka=null,Bk=0,am=1/0,ml=null,cS=!1,aP=null,Bd=null,rx=!1,Pd=null,lS=0,hy=0,sP=null,Px=-1,Dx=0;function Na(){return Un&6?ei():Px!==-1?Px:Px=ei()}function Gd(e){return e.mode&1?Un&2&&qi!==0?qi&-qi:Xbe.transition!==null?(Dx===0&&(Dx=pq()),Dx):(e=Jn,e!==0||(e=window.event,e=e===void 0?16:bq(e.type)),e):1}function tc(e,n,a,o){if(50<hy)throw hy=0,sP=null,Error(rt(185));S_(e,a,o),(!(Un&2)||e!==Di)&&(e===Di&&(!(Un&2)&&(Dw|=a),_i===4&&Nd(e,qi)),es(e,o),a===1&&Un===0&&!(n.mode&1)&&(am=ei()+500,Aw&&Zd()))}function es(e,n){var a=e.callbackNode;X0e(e,n);var o=zx(e,e===Di?qi:0);if(o===0)a!==null&&J$(a),e.callbackNode=null,e.callbackPriority=0;else if(n=o&-o,e.callbackPriority!==n){if(a!=null&&J$(a),n===1)e.tag===0?qbe(WH.bind(null,e)):Fq(WH.bind(null,e)),Hbe(function(){!(Un&6)&&Zd()}),a=null;else{switch(fq(o)){case 1:a=pk;break;case 4:a=uq;break;case 16:a=Hx;break;case 536870912:a=hq;break;default:a=Hx}a=MX(a,IX.bind(null,e))}e.callbackPriority=n,e.callbackNode=a}}function IX(e,n){if(Px=-1,Dx=0,Un&6)throw Error(rt(327));var a=e.callbackNode;if(zf()&&e.callbackNode!==a)return null;var o=zx(e,e===Di?qi:0);if(o===0)return null;if(o&30||o&e.expiredLanes||n)n=dS(e,o);else{n=o;var d=Un;Un|=2;var p=PX();(Di!==e||qi!==n)&&(ml=null,am=ei()+500,xh(e,n));do try{gEe();break}catch(y){OX(e,y)}while(!0);Ck(),oS.current=p,Un=d,ci!==null?n=0:(Di=null,qi=0,n=_i)}if(n!==0){if(n===2&&(d=D1(e),d!==0&&(o=d,n=oP(e,d))),n===1)throw a=jy,xh(e,0),Nd(e,o),es(e,ei()),a;if(n===6)Nd(e,o);else{if(d=e.current.alternate,!(o&30)&&!fEe(d)&&(n=dS(e,o),n===2&&(p=D1(e),p!==0&&(o=p,n=oP(e,p))),n===1))throw a=jy,xh(e,0),Nd(e,o),es(e,ei()),a;switch(e.finishedWork=d,e.finishedLanes=o,n){case 0:case 1:throw Error(rt(345));case 2:sh(e,Ka,ml);break;case 3:if(Nd(e,o),(o&130023424)===o&&(n=Bk+500-ei(),10<n)){if(zx(e,0)!==0)break;if(d=e.suspendedLanes,(d&o)!==o){Na(),e.pingedLanes|=e.suspendedLanes&d;break}e.timeoutHandle=B1(sh.bind(null,e,Ka,ml),n);break}sh(e,Ka,ml);break;case 4:if(Nd(e,o),(o&4194240)===o)break;for(n=e.eventTimes,d=-1;0<o;){var m=31-ec(o);p=1<<m,m=n[m],m>d&&(d=m),o&=~p}if(o=d,o=ei()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*pEe(o/1960))-o,10<o){e.timeoutHandle=B1(sh.bind(null,e,Ka,ml),o);break}sh(e,Ka,ml);break;case 5:sh(e,Ka,ml);break;default:throw Error(rt(329))}}}return es(e,ei()),e.callbackNode===a?IX.bind(null,e):null}function oP(e,n){var a=uy;return e.current.memoizedState.isDehydrated&&(xh(e,n).flags|=256),e=dS(e,n),e!==2&&(n=Ka,Ka=a,n!==null&&cP(n)),e}function cP(e){Ka===null?Ka=e:Ka.push.apply(Ka,e)}function fEe(e){for(var n=e;;){if(n.flags&16384){var a=n.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var o=0;o<a.length;o++){var d=a[o],p=d.getSnapshot;d=d.value;try{if(!rc(p(),d))return!1}catch{return!1}}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Nd(e,n){for(n&=~Vk,n&=~Dw,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var a=31-ec(n),o=1<<a;e[a]=-1,n&=~o}}function WH(e){if(Un&6)throw Error(rt(327));zf();var n=zx(e,0);if(!(n&1))return es(e,ei()),null;var a=dS(e,n);if(e.tag!==0&&a===2){var o=D1(e);o!==0&&(n=o,a=oP(e,o))}if(a===1)throw a=jy,xh(e,0),Nd(e,n),es(e,ei()),a;if(a===6)throw Error(rt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,sh(e,Ka,ml),es(e,ei()),null}function Gk(e,n){var a=Un;Un|=1;try{return e(n)}finally{Un=a,Un===0&&(am=ei()+500,Aw&&Zd())}}function Ph(e){Pd!==null&&Pd.tag===0&&!(Un&6)&&zf();var n=Un;Un|=1;var a=uo.transition,o=Jn;try{if(uo.transition=null,Jn=1,e)return e()}finally{Jn=o,uo.transition=a,Un=n,!(Un&6)&&Zd()}}function Wk(){_s=Mf.current,Cr(Mf)}function xh(e,n){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;if(a!==-1&&(e.timeoutHandle=-1,$be(a)),ci!==null)for(a=ci.return;a!==null;){var o=a;switch(Sk(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&Jx();break;case 3:rm(),Cr(Qa),Cr(pa),Pk();break;case 5:Ok(o);break;case 4:rm();break;case 13:Cr(Br);break;case 19:Cr(Br);break;case 10:Nk(o.type._context);break;case 22:case 23:Wk()}a=a.return}if(Di=e,ci=e=Wd(e.current,null),qi=_s=n,_i=0,jy=null,Vk=Dw=Oh=0,Ka=uy=null,ph!==null){for(n=0;n<ph.length;n++)if(a=ph[n],o=a.interleaved,o!==null){a.interleaved=null;var d=o.next,p=a.pending;if(p!==null){var m=p.next;p.next=d,o.next=m}a.pending=o}ph=null}return e}function OX(e,n){do{var a=ci;try{if(Ck(),Ax.current=sS,aS){for(var o=Gr.memoizedState;o!==null;){var d=o.queue;d!==null&&(d.pending=null),o=o.next}aS=!1}if(Ih=0,Oi=vi=Gr=null,ly=!1,Py=0,Fk.current=null,a===null||a.return===null){_i=1,jy=n,ci=null;break}e:{var p=e,m=a.return,y=a,b=n;if(n=qi,y.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var E=b,T=y,w=T.tag;if(!(T.mode&1)&&(w===0||w===11||w===15)){var N=T.alternate;N?(T.updateQueue=N.updateQueue,T.memoizedState=N.memoizedState,T.lanes=N.lanes):(T.updateQueue=null,T.memoizedState=null)}var D=IH(m);if(D!==null){D.flags&=-257,OH(D,m,y,p,n),D.mode&1&&AH(p,E,n),n=D,b=E;var A=n.updateQueue;if(A===null){var k=new Set;k.add(b),n.updateQueue=k}else A.add(b);break e}else{if(!(n&1)){AH(p,E,n),$k();break e}b=Error(rt(426))}}else if(kr&&y.mode&1){var O=IH(m);if(O!==null){!(O.flags&65536)&&(O.flags|=256),OH(O,m,y,p,n),wk(im(b,y));break e}}p=b=im(b,y),_i!==4&&(_i=2),uy===null?uy=[p]:uy.push(p),p=m;do{switch(p.tag){case 3:p.flags|=65536,n&=-n,p.lanes|=n;var F=fX(p,b,n);SH(p,F);break e;case 1:y=b;var M=p.type,V=p.stateNode;if(!(p.flags&128)&&(typeof M.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(Bd===null||!Bd.has(V)))){p.flags|=65536,n&=-n,p.lanes|=n;var H=mX(p,y,n);SH(p,H);break e}}p=p.return}while(p!==null)}kX(a)}catch(B){n=B,ci===a&&a!==null&&(ci=a=a.return);continue}break}while(!0)}function PX(){var e=oS.current;return oS.current=sS,e===null?sS:e}function $k(){(_i===0||_i===3||_i===2)&&(_i=4),Di===null||!(Oh&268435455)&&!(Dw&268435455)||Nd(Di,qi)}function dS(e,n){var a=Un;Un|=2;var o=PX();(Di!==e||qi!==n)&&(ml=null,xh(e,n));do try{mEe();break}catch(d){OX(e,d)}while(!0);if(Ck(),Un=a,oS.current=o,ci!==null)throw Error(rt(261));return Di=null,qi=0,_i}function mEe(){for(;ci!==null;)DX(ci)}function gEe(){for(;ci!==null&&!B0e();)DX(ci)}function DX(e){var n=LX(e.alternate,e,_s);e.memoizedProps=e.pendingProps,n===null?kX(e):ci=n,Fk.current=null}function kX(e){var n=e;do{var a=n.alternate;if(e=n.return,n.flags&32768){if(a=lEe(a,n),a!==null){a.flags&=32767,ci=a;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{_i=6,ci=null;return}}else if(a=cEe(a,n,_s),a!==null){ci=a;return}if(n=n.sibling,n!==null){ci=n;return}ci=n=e}while(n!==null);_i===0&&(_i=5)}function sh(e,n,a){var o=Jn,d=uo.transition;try{uo.transition=null,Jn=1,vEe(e,n,a,o)}finally{uo.transition=d,Jn=o}return null}function vEe(e,n,a,o){do zf();while(Pd!==null);if(Un&6)throw Error(rt(327));a=e.finishedWork;var d=e.finishedLanes;if(a===null)return null;if(e.finishedWork=null,e.finishedLanes=0,a===e.current)throw Error(rt(177));e.callbackNode=null,e.callbackPriority=0;var p=a.lanes|a.childLanes;if(J0e(e,p),e===Di&&(ci=Di=null,qi=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||rx||(rx=!0,MX(Hx,function(){return zf(),null})),p=(a.flags&15990)!==0,a.subtreeFlags&15990||p){p=uo.transition,uo.transition=null;var m=Jn;Jn=1;var y=Un;Un|=4,Fk.current=null,uEe(e,a),RX(a,e),Mbe(F1),Kx=!!U1,F1=U1=null,e.current=a,hEe(a),G0e(),Un=y,Jn=m,uo.transition=p}else e.current=a;if(rx&&(rx=!1,Pd=e,lS=d),p=e.pendingLanes,p===0&&(Bd=null),H0e(a.stateNode),es(e,ei()),n!==null)for(o=e.onRecoverableError,a=0;a<n.length;a++)d=n[a],o(d.value,{componentStack:d.stack,digest:d.digest});if(cS)throw cS=!1,e=aP,aP=null,e;return lS&1&&e.tag!==0&&zf(),p=e.pendingLanes,p&1?e===sP?hy++:(hy=0,sP=e):hy=0,Zd(),null}function zf(){if(Pd!==null){var e=fq(lS),n=uo.transition,a=Jn;try{if(uo.transition=null,Jn=16>e?16:e,Pd===null)var o=!1;else{if(e=Pd,Pd=null,lS=0,Un&6)throw Error(rt(331));var d=Un;for(Un|=4,Ct=e.current;Ct!==null;){var p=Ct,m=p.child;if(Ct.flags&16){var y=p.deletions;if(y!==null){for(var b=0;b<y.length;b++){var E=y[b];for(Ct=E;Ct!==null;){var T=Ct;switch(T.tag){case 0:case 11:case 15:dy(8,T,p)}var w=T.child;if(w!==null)w.return=T,Ct=w;else for(;Ct!==null;){T=Ct;var N=T.sibling,D=T.return;if(TX(T),T===E){Ct=null;break}if(N!==null){N.return=D,Ct=N;break}Ct=D}}}var A=p.alternate;if(A!==null){var k=A.child;if(k!==null){A.child=null;do{var O=k.sibling;k.sibling=null,k=O}while(k!==null)}}Ct=p}}if(p.subtreeFlags&2064&&m!==null)m.return=p,Ct=m;else e:for(;Ct!==null;){if(p=Ct,p.flags&2048)switch(p.tag){case 0:case 11:case 15:dy(9,p,p.return)}var F=p.sibling;if(F!==null){F.return=p.return,Ct=F;break e}Ct=p.return}}var M=e.current;for(Ct=M;Ct!==null;){m=Ct;var V=m.child;if(m.subtreeFlags&2064&&V!==null)V.return=m,Ct=V;else e:for(m=M;Ct!==null;){if(y=Ct,y.flags&2048)try{switch(y.tag){case 0:case 11:case 15:Pw(9,y)}}catch(B){Yr(y,y.return,B)}if(y===m){Ct=null;break e}var H=y.sibling;if(H!==null){H.return=y.return,Ct=H;break e}Ct=y.return}}if(Un=d,Zd(),Bc&&typeof Bc.onPostCommitFiberRoot=="function")try{Bc.onPostCommitFiberRoot(ww,e)}catch{}o=!0}return o}finally{Jn=a,uo.transition=n}}return!1}function $H(e,n,a){n=im(a,n),n=fX(e,n,1),e=Vd(e,n,1),n=Na(),e!==null&&(S_(e,1,n),es(e,n))}function Yr(e,n,a){if(e.tag===3)$H(e,e,a);else for(;n!==null;){if(n.tag===3){$H(n,e,a);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(Bd===null||!Bd.has(o))){e=im(a,e),e=mX(n,e,1),n=Vd(n,e,1),e=Na(),n!==null&&(S_(n,1,e),es(n,e));break}}n=n.return}}function yEe(e,n,a){var o=e.pingCache;o!==null&&o.delete(n),n=Na(),e.pingedLanes|=e.suspendedLanes&a,Di===e&&(qi&a)===a&&(_i===4||_i===3&&(qi&130023424)===qi&&500>ei()-Bk?xh(e,0):Vk|=a),es(e,n)}function jX(e,n){n===0&&(e.mode&1?(n=KE,KE<<=1,!(KE&130023424)&&(KE=4194304)):n=1);var a=Na();e=Il(e,n),e!==null&&(S_(e,n,a),es(e,a))}function _Ee(e){var n=e.memoizedState,a=0;n!==null&&(a=n.retryLane),jX(e,a)}function bEe(e,n){var a=0;switch(e.tag){case 13:var o=e.stateNode,d=e.memoizedState;d!==null&&(a=d.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(rt(314))}o!==null&&o.delete(n),jX(e,a)}var LX;LX=function(e,n,a){if(e!==null)if(e.memoizedProps!==n.pendingProps||Qa.current)Ya=!0;else{if(!(e.lanes&a)&&!(n.flags&128))return Ya=!1,oEe(e,n,a);Ya=!!(e.flags&131072)}else Ya=!1,kr&&n.flags&1048576&&Vq(n,eS,n.index);switch(n.lanes=0,n.tag){case 2:var o=n.type;Ox(e,n),e=n.pendingProps;var d=em(n,pa.current);Hf(n,a),d=kk(null,n,o,e,d,a);var p=jk();return n.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Za(o)?(p=!0,Qx(n)):p=!1,n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,Ak(n),d.updater=Ow,n.stateNode=d,d._reactInternals=n,Y1(n,o,e,a),n=J1(null,n,o,!0,p,a)):(n.tag=0,kr&&p&&xk(n),Ta(null,n,d,a),n=n.child),n;case 16:o=n.elementType;e:{switch(Ox(e,n),e=n.pendingProps,d=o._init,o=d(o._payload),n.type=o,d=n.tag=xEe(o),e=Ko(o,e),d){case 0:n=X1(null,n,o,e,a);break e;case 1:n=kH(null,n,o,e,a);break e;case 11:n=PH(null,n,o,e,a);break e;case 14:n=DH(null,n,o,Ko(o.type,e),a);break e}throw Error(rt(306,o,""))}return n;case 0:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:Ko(o,d),X1(e,n,o,d,a);case 1:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:Ko(o,d),kH(e,n,o,d,a);case 3:e:{if(_X(n),e===null)throw Error(rt(387));o=n.pendingProps,p=n.memoizedState,d=p.element,zq(e,n),rS(n,o,null,a);var m=n.memoizedState;if(o=m.element,p.isDehydrated)if(p={element:o,isDehydrated:!1,cache:m.cache,pendingSuspenseBoundaries:m.pendingSuspenseBoundaries,transitions:m.transitions},n.updateQueue.baseState=p,n.memoizedState=p,n.flags&256){d=im(Error(rt(423)),n),n=jH(e,n,o,a,d);break e}else if(o!==d){d=im(Error(rt(424)),n),n=jH(e,n,o,a,d);break e}else for(ws=Fd(n.stateNode.containerInfo.firstChild),Ts=n,kr=!0,Jo=null,a=$q(n,null,o,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(tm(),o===d){n=Ol(e,n,a);break e}Ta(e,n,o,a)}n=n.child}return n;case 5:return Kq(n),e===null&&H1(n),o=n.type,d=n.pendingProps,p=e!==null?e.memoizedProps:null,m=d.children,V1(o,d)?m=null:p!==null&&V1(o,p)&&(n.flags|=32),yX(e,n),Ta(e,n,m,a),n.child;case 6:return e===null&&H1(n),null;case 13:return bX(e,n,a);case 4:return Ik(n,n.stateNode.containerInfo),o=n.pendingProps,e===null?n.child=nm(n,null,o,a):Ta(e,n,o,a),n.child;case 11:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:Ko(o,d),PH(e,n,o,d,a);case 7:return Ta(e,n,n.pendingProps,a),n.child;case 8:return Ta(e,n,n.pendingProps.children,a),n.child;case 12:return Ta(e,n,n.pendingProps.children,a),n.child;case 10:e:{if(o=n.type._context,d=n.pendingProps,p=n.memoizedProps,m=d.value,pr(tS,o._currentValue),o._currentValue=m,p!==null)if(rc(p.value,m)){if(p.children===d.children&&!Qa.current){n=Ol(e,n,a);break e}}else for(p=n.child,p!==null&&(p.return=n);p!==null;){var y=p.dependencies;if(y!==null){m=p.child;for(var b=y.firstContext;b!==null;){if(b.context===o){if(p.tag===1){b=Sl(-1,a&-a),b.tag=2;var E=p.updateQueue;if(E!==null){E=E.shared;var T=E.pending;T===null?b.next=b:(b.next=T.next,T.next=b),E.pending=b}}p.lanes|=a,b=p.alternate,b!==null&&(b.lanes|=a),z1(p.return,a,n),y.lanes|=a;break}b=b.next}}else if(p.tag===10)m=p.type===n.type?null:p.child;else if(p.tag===18){if(m=p.return,m===null)throw Error(rt(341));m.lanes|=a,y=m.alternate,y!==null&&(y.lanes|=a),z1(m,a,n),m=p.sibling}else m=p.child;if(m!==null)m.return=p;else for(m=p;m!==null;){if(m===n){m=null;break}if(p=m.sibling,p!==null){p.return=m.return,m=p;break}m=m.return}p=m}Ta(e,n,d.children,a),n=n.child}return n;case 9:return d=n.type,o=n.pendingProps.children,Hf(n,a),d=fo(d),o=o(d),n.flags|=1,Ta(e,n,o,a),n.child;case 14:return o=n.type,d=Ko(o,n.pendingProps),d=Ko(o.type,d),DH(e,n,o,d,a);case 15:return gX(e,n,n.type,n.pendingProps,a);case 17:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:Ko(o,d),Ox(e,n),n.tag=1,Za(o)?(e=!0,Qx(n)):e=!1,Hf(n,a),pX(n,o,d),Y1(n,o,d,a),J1(null,n,o,!0,e,a);case 19:return EX(e,n,a);case 22:return vX(e,n,a)}throw Error(rt(156,n.tag))};function MX(e,n){return dq(e,n)}function EEe(e,n,a,o){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function so(e,n,a,o){return new EEe(e,n,a,o)}function Hk(e){return e=e.prototype,!(!e||!e.isReactComponent)}function xEe(e){if(typeof e=="function")return Hk(e)?1:0;if(e!=null){if(e=e.$$typeof,e===dk)return 11;if(e===uk)return 14}return 2}function Wd(e,n){var a=e.alternate;return a===null?(a=so(e.tag,n,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=n,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&14680064,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,n=e.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a}function kx(e,n,a,o,d,p){var m=2;if(o=e,typeof e=="function")Hk(e)&&(m=1);else if(typeof e=="string")m=5;else e:switch(e){case Nf:return Sh(a.children,d,p,n);case lk:m=8,d|=8;break;case y1:return e=so(12,a,n,d|2),e.elementType=y1,e.lanes=p,e;case _1:return e=so(13,a,n,d),e.elementType=_1,e.lanes=p,e;case b1:return e=so(19,a,n,d),e.elementType=b1,e.lanes=p,e;case KY:return kw(a,d,p,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case HY:m=10;break e;case zY:m=9;break e;case dk:m=11;break e;case uk:m=14;break e;case Sd:m=16,o=null;break e}throw Error(rt(130,e==null?e:typeof e,""))}return n=so(m,a,n,d),n.elementType=e,n.type=o,n.lanes=p,n}function Sh(e,n,a,o){return e=so(7,e,o,n),e.lanes=a,e}function kw(e,n,a,o){return e=so(22,e,o,n),e.elementType=KY,e.lanes=a,e.stateNode={isHidden:!1},e}function IO(e,n,a){return e=so(6,e,null,n),e.lanes=a,e}function OO(e,n,a){return n=so(4,e.children!==null?e.children:[],e.key,n),n.lanes=a,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function SEe(e,n,a,o,d){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=uO(0),this.expirationTimes=uO(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uO(0),this.identifierPrefix=o,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function zk(e,n,a,o,d,p,m,y,b){return e=new SEe(e,n,a,y,b),n===1?(n=1,p===!0&&(n|=8)):n=0,p=so(3,null,null,n),e.current=p,p.stateNode=e,p.memoizedState={element:o,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ak(p),e}function wEe(e,n,a){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Cf,key:o==null?null:""+o,children:e,containerInfo:n,implementation:a}}function UX(e){if(!e)return Yd;e=e._reactInternals;e:{if(Wh(e)!==e||e.tag!==1)throw Error(rt(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Za(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(rt(171))}if(e.tag===1){var a=e.type;if(Za(a))return Uq(e,a,n)}return n}function FX(e,n,a,o,d,p,m,y,b){return e=zk(a,o,!0,e,d,p,m,y,b),e.context=UX(null),a=e.current,o=Na(),d=Gd(a),p=Sl(o,d),p.callback=n??null,Vd(a,p,d),e.current.lanes=d,S_(e,d,o),es(e,o),e}function jw(e,n,a,o){var d=n.current,p=Na(),m=Gd(d);return a=UX(a),n.context===null?n.context=a:n.pendingContext=a,n=Sl(p,m),n.payload={element:e},o=o===void 0?null:o,o!==null&&(n.callback=o),e=Vd(d,n,m),e!==null&&(tc(e,d,m,p),Rx(e,d,m)),m}function uS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function HH(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<n?a:n}}function Kk(e,n){HH(e,n),(e=e.alternate)&&HH(e,n)}function TEe(){return null}var VX=typeof reportError=="function"?reportError:function(e){console.error(e)};function Yk(e){this._internalRoot=e}Lw.prototype.render=Yk.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(rt(409));jw(e,n,null,null)};Lw.prototype.unmount=Yk.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;Ph(function(){jw(null,e,null,null)}),n[Al]=null}};function Lw(e){this._internalRoot=e}Lw.prototype.unstable_scheduleHydration=function(e){if(e){var n=vq();e={blockedOn:null,target:e,priority:n};for(var a=0;a<Cd.length&&n!==0&&n<Cd[a].priority;a++);Cd.splice(a,0,e),a===0&&_q(e)}};function qk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Mw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function zH(){}function CEe(e,n,a,o,d){if(d){if(typeof o=="function"){var p=o;o=function(){var E=uS(m);p.call(E)}}var m=FX(n,o,e,0,null,!1,!1,"",zH);return e._reactRootContainer=m,e[Al]=m.current,Ny(e.nodeType===8?e.parentNode:e),Ph(),m}for(;d=e.lastChild;)e.removeChild(d);if(typeof o=="function"){var y=o;o=function(){var E=uS(b);y.call(E)}}var b=zk(e,0,!1,null,null,!1,!1,"",zH);return e._reactRootContainer=b,e[Al]=b.current,Ny(e.nodeType===8?e.parentNode:e),Ph(function(){jw(n,b,a,o)}),b}function Uw(e,n,a,o,d){var p=a._reactRootContainer;if(p){var m=p;if(typeof d=="function"){var y=d;d=function(){var b=uS(m);y.call(b)}}jw(n,m,e,d)}else m=CEe(a,n,e,d,o);return uS(m)}mq=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var a=ey(n.pendingLanes);a!==0&&(fk(n,a|1),es(n,ei()),!(Un&6)&&(am=ei()+500,Zd()))}break;case 13:Ph(function(){var o=Il(e,1);if(o!==null){var d=Na();tc(o,e,1,d)}}),Kk(e,1)}};mk=function(e){if(e.tag===13){var n=Il(e,134217728);if(n!==null){var a=Na();tc(n,e,134217728,a)}Kk(e,134217728)}};gq=function(e){if(e.tag===13){var n=Gd(e),a=Il(e,n);if(a!==null){var o=Na();tc(a,e,n,o)}Kk(e,n)}};vq=function(){return Jn};yq=function(e,n){var a=Jn;try{return Jn=e,n()}finally{Jn=a}};I1=function(e,n,a){switch(n){case"input":if(S1(e,a),n=a.name,a.type==="radio"&&n!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<a.length;n++){var o=a[n];if(o!==e&&o.form===e.form){var d=Rw(o);if(!d)throw Error(rt(90));qY(o),S1(o,d)}}}break;case"textarea":JY(e,a);break;case"select":n=a.value,n!=null&&Bf(e,!!a.multiple,n,!1)}};iq=Gk;aq=Ph;var NEe={usingClientEntryPoint:!1,Events:[T_,Of,Rw,nq,rq,Gk]},Uv={findFiberByHostInstance:hh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},REe={bundleType:Uv.bundleType,version:Uv.version,rendererPackageName:Uv.rendererPackageName,rendererConfig:Uv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ll.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=cq(e),e===null?null:e.stateNode},findFiberByHostInstance:Uv.findFiberByHostInstance||TEe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ix=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ix.isDisabled&&ix.supportsFiber)try{ww=ix.inject(REe),Bc=ix}catch{}}Ns.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NEe;Ns.createPortal=function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qk(n))throw Error(rt(200));return wEe(e,n,null,a)};Ns.createRoot=function(e,n){if(!qk(e))throw Error(rt(299));var a=!1,o="",d=VX;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),n=zk(e,1,!1,null,null,a,!1,o,d),e[Al]=n.current,Ny(e.nodeType===8?e.parentNode:e),new Yk(n)};Ns.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(rt(188)):(e=Object.keys(e).join(","),Error(rt(268,e)));return e=cq(n),e=e===null?null:e.stateNode,e};Ns.flushSync=function(e){return Ph(e)};Ns.hydrate=function(e,n,a){if(!Mw(n))throw Error(rt(200));return Uw(null,e,n,!0,a)};Ns.hydrateRoot=function(e,n,a){if(!qk(e))throw Error(rt(405));var o=a!=null&&a.hydratedSources||null,d=!1,p="",m=VX;if(a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(p=a.identifierPrefix),a.onRecoverableError!==void 0&&(m=a.onRecoverableError)),n=FX(n,null,e,1,a??null,d,!1,p,m),e[Al]=n.current,Ny(e),o)for(e=0;e<o.length;e++)a=o[e],d=a._getVersion,d=d(a._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[a,d]:n.mutableSourceEagerHydrationData.push(a,d);return new Lw(n)};Ns.render=function(e,n,a){if(!Mw(n))throw Error(rt(200));return Uw(null,e,n,!1,a)};Ns.unmountComponentAtNode=function(e){if(!Mw(e))throw Error(rt(40));return e._reactRootContainer?(Ph(function(){Uw(null,null,e,!1,function(){e._reactRootContainer=null,e[Al]=null})}),!0):!1};Ns.unstable_batchedUpdates=Gk;Ns.unstable_renderSubtreeIntoContainer=function(e,n,a,o){if(!Mw(a))throw Error(rt(200));if(e==null||e._reactInternals===void 0)throw Error(rt(38));return Uw(e,n,a,!1,o)};Ns.version="18.3.1-next-f1338f8080-20240426";function BX(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(BX)}catch(e){console.error(e)}}BX(),BY.exports=Ns;var AEe=BY.exports,KH=AEe;g1.createRoot=KH.createRoot,g1.hydrateRoot=KH.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ly(){return Ly=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Ly.apply(this,arguments)}var Dd;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Dd||(Dd={}));const YH="popstate";function IEe(e){e===void 0&&(e={});function n(o,d){let{pathname:p,search:m,hash:y}=o.location;return lP("",{pathname:p,search:m,hash:y},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function a(o,d){return typeof d=="string"?d:hS(d)}return PEe(n,a,null,e)}function ti(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function Xk(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function OEe(){return Math.random().toString(36).substr(2,8)}function qH(e,n){return{usr:e.state,key:e.key,idx:n}}function lP(e,n,a,o){return a===void 0&&(a=null),Ly({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof n=="string"?Lm(n):n,{state:a,key:n&&n.key||o||OEe()})}function hS(e){let{pathname:n="/",search:a="",hash:o=""}=e;return a&&a!=="?"&&(n+=a.charAt(0)==="?"?a:"?"+a),o&&o!=="#"&&(n+=o.charAt(0)==="#"?o:"#"+o),n}function Lm(e){let n={};if(e){let a=e.indexOf("#");a>=0&&(n.hash=e.substr(a),e=e.substr(0,a));let o=e.indexOf("?");o>=0&&(n.search=e.substr(o),e=e.substr(0,o)),e&&(n.pathname=e)}return n}function PEe(e,n,a,o){o===void 0&&(o={});let{window:d=document.defaultView,v5Compat:p=!1}=o,m=d.history,y=Dd.Pop,b=null,E=T();E==null&&(E=0,m.replaceState(Ly({},m.state,{idx:E}),""));function T(){return(m.state||{idx:null}).idx}function w(){y=Dd.Pop;let O=T(),F=O==null?null:O-E;E=O,b&&b({action:y,location:k.location,delta:F})}function N(O,F){y=Dd.Push;let M=lP(k.location,O,F);E=T()+1;let V=qH(M,E),H=k.createHref(M);try{m.pushState(V,"",H)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;d.location.assign(H)}p&&b&&b({action:y,location:k.location,delta:1})}function D(O,F){y=Dd.Replace;let M=lP(k.location,O,F);E=T();let V=qH(M,E),H=k.createHref(M);m.replaceState(V,"",H),p&&b&&b({action:y,location:k.location,delta:0})}function A(O){let F=d.location.origin!=="null"?d.location.origin:d.location.href,M=typeof O=="string"?O:hS(O);return M=M.replace(/ $/,"%20"),ti(F,"No window.location.(origin|href) available to create URL for href: "+M),new URL(M,F)}let k={get action(){return y},get location(){return e(d,m)},listen(O){if(b)throw new Error("A history only accepts one active listener");return d.addEventListener(YH,w),b=O,()=>{d.removeEventListener(YH,w),b=null}},createHref(O){return n(d,O)},createURL:A,encodeLocation(O){let F=A(O);return{pathname:F.pathname,search:F.search,hash:F.hash}},push:N,replace:D,go(O){return m.go(O)}};return k}var XH;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(XH||(XH={}));function DEe(e,n,a){return a===void 0&&(a="/"),kEe(e,n,a)}function kEe(e,n,a,o){let d=typeof n=="string"?Lm(n):n,p=Jk(d.pathname||"/",a);if(p==null)return null;let m=GX(e);jEe(m);let y=null;for(let b=0;y==null&&b<m.length;++b){let E=KEe(p);y=$Ee(m[b],E)}return y}function GX(e,n,a,o){n===void 0&&(n=[]),a===void 0&&(a=[]),o===void 0&&(o="");let d=(p,m,y)=>{let b={relativePath:y===void 0?p.path||"":y,caseSensitive:p.caseSensitive===!0,childrenIndex:m,route:p};b.relativePath.startsWith("/")&&(ti(b.relativePath.startsWith(o),'Absolute route path "'+b.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),b.relativePath=b.relativePath.slice(o.length));let E=$d([o,b.relativePath]),T=a.concat(b);p.children&&p.children.length>0&&(ti(p.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+E+'".')),GX(p.children,n,T,E)),!(p.path==null&&!p.index)&&n.push({path:E,score:GEe(E,p.index),routesMeta:T})};return e.forEach((p,m)=>{var y;if(p.path===""||!((y=p.path)!=null&&y.includes("?")))d(p,m);else for(let b of WX(p.path))d(p,m,b)}),n}function WX(e){let n=e.split("/");if(n.length===0)return[];let[a,...o]=n,d=a.endsWith("?"),p=a.replace(/\?$/,"");if(o.length===0)return d?[p,""]:[p];let m=WX(o.join("/")),y=[];return y.push(...m.map(b=>b===""?p:[p,b].join("/"))),d&&y.push(...m),y.map(b=>e.startsWith("/")&&b===""?"/":b)}function jEe(e){e.sort((n,a)=>n.score!==a.score?a.score-n.score:WEe(n.routesMeta.map(o=>o.childrenIndex),a.routesMeta.map(o=>o.childrenIndex)))}const LEe=/^:[\w-]+$/,MEe=3,UEe=2,FEe=1,VEe=10,BEe=-2,JH=e=>e==="*";function GEe(e,n){let a=e.split("/"),o=a.length;return a.some(JH)&&(o+=BEe),n&&(o+=UEe),a.filter(d=>!JH(d)).reduce((d,p)=>d+(LEe.test(p)?MEe:p===""?FEe:VEe),o)}function WEe(e,n){return e.length===n.length&&e.slice(0,-1).every((o,d)=>o===n[d])?e[e.length-1]-n[n.length-1]:0}function $Ee(e,n,a){let{routesMeta:o}=e,d={},p="/",m=[];for(let y=0;y<o.length;++y){let b=o[y],E=y===o.length-1,T=p==="/"?n:n.slice(p.length)||"/",w=HEe({path:b.relativePath,caseSensitive:b.caseSensitive,end:E},T),N=b.route;if(!w)return null;Object.assign(d,w.params),m.push({params:d,pathname:$d([p,w.pathname]),pathnameBase:QEe($d([p,w.pathnameBase])),route:N}),w.pathnameBase!=="/"&&(p=$d([p,w.pathnameBase]))}return m}function HEe(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[a,o]=zEe(e.path,e.caseSensitive,e.end),d=n.match(a);if(!d)return null;let p=d[0],m=p.replace(/(.)\/+$/,"$1"),y=d.slice(1);return{params:o.reduce((E,T,w)=>{let{paramName:N,isOptional:D}=T;if(N==="*"){let k=y[w]||"";m=p.slice(0,p.length-k.length).replace(/(.)\/+$/,"$1")}const A=y[w];return D&&!A?E[N]=void 0:E[N]=(A||"").replace(/%2F/g,"/"),E},{}),pathname:p,pathnameBase:m,pattern:e}}function zEe(e,n,a){n===void 0&&(n=!1),a===void 0&&(a=!0),Xk(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let o=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,y,b)=>(o.push({paramName:y,isOptional:b!=null}),b?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(o.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,n?void 0:"i"),o]}function KEe(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Xk(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),e}}function Jk(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let a=n.endsWith("/")?n.length-1:n.length,o=e.charAt(a);return o&&o!=="/"?null:e.slice(a)||"/"}const YEe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qEe=e=>YEe.test(e);function XEe(e,n){n===void 0&&(n="/");let{pathname:a,search:o="",hash:d=""}=typeof e=="string"?Lm(e):e,p;if(a)if(qEe(a))p=a;else{if(a.includes("//")){let m=a;a=a.replace(/\/\/+/g,"/"),Xk(!1,"Pathnames cannot have embedded double slashes - normalizing "+(m+" -> "+a))}a.startsWith("/")?p=QH(a.substring(1),"/"):p=QH(a,n)}else p=n;return{pathname:p,search:ZEe(o),hash:exe(d)}}function QH(e,n){let a=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?a.length>1&&a.pop():d!=="."&&a.push(d)}),a.length>1?a.join("/"):"/"}function PO(e,n,a,o){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function JEe(e){return e.filter((n,a)=>a===0||n.route.path&&n.route.path.length>0)}function Qk(e,n){let a=JEe(e);return n?a.map((o,d)=>d===a.length-1?o.pathname:o.pathnameBase):a.map(o=>o.pathnameBase)}function Zk(e,n,a,o){o===void 0&&(o=!1);let d;typeof e=="string"?d=Lm(e):(d=Ly({},e),ti(!d.pathname||!d.pathname.includes("?"),PO("?","pathname","search",d)),ti(!d.pathname||!d.pathname.includes("#"),PO("#","pathname","hash",d)),ti(!d.search||!d.search.includes("#"),PO("#","search","hash",d)));let p=e===""||d.pathname==="",m=p?"/":d.pathname,y;if(m==null)y=a;else{let w=n.length-1;if(!o&&m.startsWith("..")){let N=m.split("/");for(;N[0]==="..";)N.shift(),w-=1;d.pathname=N.join("/")}y=w>=0?n[w]:"/"}let b=XEe(d,y),E=m&&m!=="/"&&m.endsWith("/"),T=(p||m===".")&&a.endsWith("/");return!b.pathname.endsWith("/")&&(E||T)&&(b.pathname+="/"),b}const $d=e=>e.join("/").replace(/\/\/+/g,"/"),QEe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),ZEe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,exe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function txe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const $X=["post","put","patch","delete"];new Set($X);const nxe=["get",...$X];new Set(nxe);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function My(){return My=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},My.apply(this,arguments)}const e2=Y.createContext(null),rxe=Y.createContext(null),eu=Y.createContext(null),Fw=Y.createContext(null),Ml=Y.createContext({outlet:null,matches:[],isDataRoute:!1}),HX=Y.createContext(null);function ixe(e,n){let{relative:a}=n===void 0?{}:n;Mm()||ti(!1);let{basename:o,navigator:d}=Y.useContext(eu),{hash:p,pathname:m,search:y}=KX(e,{relative:a}),b=m;return o!=="/"&&(b=m==="/"?o:$d([o,m])),d.createHref({pathname:b,search:y,hash:p})}function Mm(){return Y.useContext(Fw)!=null}function Ul(){return Mm()||ti(!1),Y.useContext(Fw).location}function zX(e){Y.useContext(eu).static||Y.useLayoutEffect(e)}function As(){let{isDataRoute:e}=Y.useContext(Ml);return e?vxe():axe()}function axe(){Mm()||ti(!1);let e=Y.useContext(e2),{basename:n,future:a,navigator:o}=Y.useContext(eu),{matches:d}=Y.useContext(Ml),{pathname:p}=Ul(),m=JSON.stringify(Qk(d,a.v7_relativeSplatPath)),y=Y.useRef(!1);return zX(()=>{y.current=!0}),Y.useCallback(function(E,T){if(T===void 0&&(T={}),!y.current)return;if(typeof E=="number"){o.go(E);return}let w=Zk(E,JSON.parse(m),p,T.relative==="path");e==null&&n!=="/"&&(w.pathname=w.pathname==="/"?n:$d([n,w.pathname])),(T.replace?o.replace:o.push)(w,T.state,T)},[n,o,m,p,e])}function Vw(){let{matches:e}=Y.useContext(Ml),n=e[e.length-1];return n?n.params:{}}function KX(e,n){let{relative:a}=n===void 0?{}:n,{future:o}=Y.useContext(eu),{matches:d}=Y.useContext(Ml),{pathname:p}=Ul(),m=JSON.stringify(Qk(d,o.v7_relativeSplatPath));return Y.useMemo(()=>Zk(e,JSON.parse(m),p,a==="path"),[e,m,p,a])}function sxe(e,n){return oxe(e,n)}function oxe(e,n,a,o){Mm()||ti(!1);let{navigator:d}=Y.useContext(eu),{matches:p}=Y.useContext(Ml),m=p[p.length-1],y=m?m.params:{};m&&m.pathname;let b=m?m.pathnameBase:"/";m&&m.route;let E=Ul(),T;if(n){var w;let O=typeof n=="string"?Lm(n):n;b==="/"||(w=O.pathname)!=null&&w.startsWith(b)||ti(!1),T=O}else T=E;let N=T.pathname||"/",D=N;if(b!=="/"){let O=b.replace(/^\//,"").split("/");D="/"+N.replace(/^\//,"").split("/").slice(O.length).join("/")}let A=DEe(e,{pathname:D}),k=hxe(A&&A.map(O=>Object.assign({},O,{params:Object.assign({},y,O.params),pathname:$d([b,d.encodeLocation?d.encodeLocation(O.pathname).pathname:O.pathname]),pathnameBase:O.pathnameBase==="/"?b:$d([b,d.encodeLocation?d.encodeLocation(O.pathnameBase).pathname:O.pathnameBase])})),p,a,o);return n&&k?Y.createElement(Fw.Provider,{value:{location:My({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:Dd.Pop}},k):k}function cxe(){let e=gxe(),n=txe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),a=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Y.createElement(Y.Fragment,null,Y.createElement("h2",null,"Unexpected Application Error!"),Y.createElement("h3",{style:{fontStyle:"italic"}},n),a?Y.createElement("pre",{style:d},a):null,null)}const lxe=Y.createElement(cxe,null);class dxe extends Y.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,a){return a.location!==n.location||a.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:a.error,location:a.location,revalidation:n.revalidation||a.revalidation}}componentDidCatch(n,a){console.error("React Router caught the following error during render",n,a)}render(){return this.state.error!==void 0?Y.createElement(Ml.Provider,{value:this.props.routeContext},Y.createElement(HX.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function uxe(e){let{routeContext:n,match:a,children:o}=e,d=Y.useContext(e2);return d&&d.static&&d.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=a.route.id),Y.createElement(Ml.Provider,{value:n},o)}function hxe(e,n,a,o){var d;if(n===void 0&&(n=[]),a===void 0&&(a=null),o===void 0&&(o=null),e==null){var p;if(!a)return null;if(a.errors)e=a.matches;else if((p=o)!=null&&p.v7_partialHydration&&n.length===0&&!a.initialized&&a.matches.length>0)e=a.matches;else return null}let m=e,y=(d=a)==null?void 0:d.errors;if(y!=null){let T=m.findIndex(w=>w.route.id&&(y==null?void 0:y[w.route.id])!==void 0);T>=0||ti(!1),m=m.slice(0,Math.min(m.length,T+1))}let b=!1,E=-1;if(a&&o&&o.v7_partialHydration)for(let T=0;T<m.length;T++){let w=m[T];if((w.route.HydrateFallback||w.route.hydrateFallbackElement)&&(E=T),w.route.id){let{loaderData:N,errors:D}=a,A=w.route.loader&&N[w.route.id]===void 0&&(!D||D[w.route.id]===void 0);if(w.route.lazy||A){b=!0,E>=0?m=m.slice(0,E+1):m=[m[0]];break}}}return m.reduceRight((T,w,N)=>{let D,A=!1,k=null,O=null;a&&(D=y&&w.route.id?y[w.route.id]:void 0,k=w.route.errorElement||lxe,b&&(E<0&&N===0?(yxe("route-fallback"),A=!0,O=null):E===N&&(A=!0,O=w.route.hydrateFallbackElement||null)));let F=n.concat(m.slice(0,N+1)),M=()=>{let V;return D?V=k:A?V=O:w.route.Component?V=Y.createElement(w.route.Component,null):w.route.element?V=w.route.element:V=T,Y.createElement(uxe,{match:w,routeContext:{outlet:T,matches:F,isDataRoute:a!=null},children:V})};return a&&(w.route.ErrorBoundary||w.route.errorElement||N===0)?Y.createElement(dxe,{location:a.location,revalidation:a.revalidation,component:k,error:D,children:M(),routeContext:{outlet:null,matches:F,isDataRoute:!0}}):M()},null)}var YX=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(YX||{}),qX=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(qX||{});function pxe(e){let n=Y.useContext(e2);return n||ti(!1),n}function fxe(e){let n=Y.useContext(rxe);return n||ti(!1),n}function mxe(e){let n=Y.useContext(Ml);return n||ti(!1),n}function XX(e){let n=mxe(),a=n.matches[n.matches.length-1];return a.route.id||ti(!1),a.route.id}function gxe(){var e;let n=Y.useContext(HX),a=fxe(),o=XX();return n!==void 0?n:(e=a.errors)==null?void 0:e[o]}function vxe(){let{router:e}=pxe(YX.UseNavigateStable),n=XX(qX.UseNavigateStable),a=Y.useRef(!1);return zX(()=>{a.current=!0}),Y.useCallback(function(d,p){p===void 0&&(p={}),a.current&&(typeof d=="number"?e.navigate(d):e.navigate(d,My({fromRouteId:n},p)))},[e,n])}const ZH={};function yxe(e,n,a){ZH[e]||(ZH[e]=!0)}function _xe(e,n){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function xs(e){let{to:n,replace:a,state:o,relative:d}=e;Mm()||ti(!1);let{future:p,static:m}=Y.useContext(eu),{matches:y}=Y.useContext(Ml),{pathname:b}=Ul(),E=As(),T=Zk(n,Qk(y,p.v7_relativeSplatPath),b,d==="path"),w=JSON.stringify(T);return Y.useEffect(()=>E(JSON.parse(w),{replace:a,state:o,relative:d}),[E,w,d,a,o]),null}function Dr(e){ti(!1)}function bxe(e){let{basename:n="/",children:a=null,location:o,navigationType:d=Dd.Pop,navigator:p,static:m=!1,future:y}=e;Mm()&&ti(!1);let b=n.replace(/^\/*/,"/"),E=Y.useMemo(()=>({basename:b,navigator:p,static:m,future:My({v7_relativeSplatPath:!1},y)}),[b,y,p,m]);typeof o=="string"&&(o=Lm(o));let{pathname:T="/",search:w="",hash:N="",state:D=null,key:A="default"}=o,k=Y.useMemo(()=>{let O=Jk(T,b);return O==null?null:{location:{pathname:O,search:w,hash:N,state:D,key:A},navigationType:d}},[b,T,w,N,D,A,d]);return k==null?null:Y.createElement(eu.Provider,{value:E},Y.createElement(Fw.Provider,{children:a,value:k}))}function Exe(e){let{children:n,location:a}=e;return sxe(dP(n),a)}new Promise(()=>{});function dP(e,n){n===void 0&&(n=[]);let a=[];return Y.Children.forEach(e,(o,d)=>{if(!Y.isValidElement(o))return;let p=[...n,d];if(o.type===Y.Fragment){a.push.apply(a,dP(o.props.children,p));return}o.type!==Dr&&ti(!1),!o.props.index||!o.props.children||ti(!1);let m={id:o.props.id||p.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(m.children=dP(o.props.children,p)),a.push(m)}),a}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uP(){return uP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},uP.apply(this,arguments)}function xxe(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,p;for(p=0;p<o.length;p++)d=o[p],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}function Sxe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function wxe(e,n){return e.button===0&&(!n||n==="_self")&&!Sxe(e)}function hP(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((n,a)=>{let o=e[a];return n.concat(Array.isArray(o)?o.map(d=>[a,d]):[[a,o]])},[]))}function Txe(e,n){let a=hP(e);return n&&n.forEach((o,d)=>{a.has(d)||n.getAll(d).forEach(p=>{a.append(d,p)})}),a}const Cxe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Nxe="6";try{window.__reactRouterVersion=Nxe}catch{}const Rxe="startTransition",e7=y0e[Rxe];function Axe(e){let{basename:n,children:a,future:o,window:d}=e,p=Y.useRef();p.current==null&&(p.current=IEe({window:d,v5Compat:!0}));let m=p.current,[y,b]=Y.useState({action:m.action,location:m.location}),{v7_startTransition:E}=o||{},T=Y.useCallback(w=>{E&&e7?e7(()=>b(w)):b(w)},[b,E]);return Y.useLayoutEffect(()=>m.listen(T),[m,T]),Y.useEffect(()=>_xe(o),[o]),Y.createElement(bxe,{basename:n,children:a,location:y.location,navigationType:y.action,navigator:m,future:o})}const Ixe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Oxe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,un=Y.forwardRef(function(n,a){let{onClick:o,relative:d,reloadDocument:p,replace:m,state:y,target:b,to:E,preventScrollReset:T,viewTransition:w}=n,N=xxe(n,Cxe),{basename:D}=Y.useContext(eu),A,k=!1;if(typeof E=="string"&&Oxe.test(E)&&(A=E,Ixe))try{let V=new URL(window.location.href),H=E.startsWith("//")?new URL(V.protocol+E):new URL(E),B=Jk(H.pathname,D);H.origin===V.origin&&B!=null?E=B+H.search+H.hash:k=!0}catch{}let O=ixe(E,{relative:d}),F=Pxe(E,{replace:m,state:y,target:b,preventScrollReset:T,relative:d,viewTransition:w});function M(V){o&&o(V),V.defaultPrevented||F(V)}return Y.createElement("a",uP({},N,{href:A||O,onClick:k||p?o:M,ref:a,target:b}))});var t7;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(t7||(t7={}));var n7;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(n7||(n7={}));function Pxe(e,n){let{target:a,replace:o,state:d,preventScrollReset:p,relative:m,viewTransition:y}=n===void 0?{}:n,b=As(),E=Ul(),T=KX(e,{relative:m});return Y.useCallback(w=>{if(wxe(w,a)){w.preventDefault();let N=o!==void 0?o:hS(E)===hS(T);b(e,{replace:N,state:d,preventScrollReset:p,relative:m,viewTransition:y})}},[E,b,T,o,d,a,e,p,m,y])}function Dxe(e){let n=Y.useRef(hP(e)),a=Y.useRef(!1),o=Ul(),d=Y.useMemo(()=>Txe(o.search,a.current?null:n.current),[o.search]),p=As(),m=Y.useCallback((y,b)=>{const E=hP(typeof y=="function"?y(d):y);a.current=!0,p("?"+E,b)},[p,d]);return[d,m]}let kxe={data:""},jxe=e=>{if(typeof window=="object"){let n=(e?e.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return n.nonce=window.__nonce__,n.parentNode||(e||document.head).appendChild(n),n.firstChild}return e||kxe},Lxe=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Mxe=/\/\*[^]*?\*\/|  +/g,r7=/\n+/g,Rd=(e,n)=>{let a="",o="",d="";for(let p in e){let m=e[p];p[0]=="@"?p[1]=="i"?a=p+" "+m+";":o+=p[1]=="f"?Rd(m,p):p+"{"+Rd(m,p[1]=="k"?"":n)+"}":typeof m=="object"?o+=Rd(m,n?n.replace(/([^,])+/g,y=>p.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,b=>/&/.test(b)?b.replace(/&/g,y):y?y+" "+b:b)):p):m!=null&&(p=/^--/.test(p)?p:p.replace(/[A-Z]/g,"-$&").toLowerCase(),d+=Rd.p?Rd.p(p,m):p+":"+m+";")}return a+(n&&d?n+"{"+d+"}":d)+o},hl={},JX=e=>{if(typeof e=="object"){let n="";for(let a in e)n+=a+JX(e[a]);return n}return e},Uxe=(e,n,a,o,d)=>{let p=JX(e),m=hl[p]||(hl[p]=(b=>{let E=0,T=11;for(;E<b.length;)T=101*T+b.charCodeAt(E++)>>>0;return"go"+T})(p));if(!hl[m]){let b=p!==e?e:(E=>{let T,w,N=[{}];for(;T=Lxe.exec(E.replace(Mxe,""));)T[4]?N.shift():T[3]?(w=T[3].replace(r7," ").trim(),N.unshift(N[0][w]=N[0][w]||{})):N[0][T[1]]=T[2].replace(r7," ").trim();return N[0]})(e);hl[m]=Rd(d?{["@keyframes "+m]:b}:b,a?"":"."+m)}let y=a&&hl.g?hl.g:null;return a&&(hl.g=hl[m]),((b,E,T,w)=>{w?E.data=E.data.replace(w,b):E.data.indexOf(b)===-1&&(E.data=T?b+E.data:E.data+b)})(hl[m],n,o,y),m},Fxe=(e,n,a)=>e.reduce((o,d,p)=>{let m=n[p];if(m&&m.call){let y=m(a),b=y&&y.props&&y.props.className||/^go/.test(y)&&y;m=b?"."+b:y&&typeof y=="object"?y.props?"":Rd(y,""):y===!1?"":y}return o+d+(m??"")},"");function Bw(e){let n=this||{},a=e.call?e(n.p):e;return Uxe(a.unshift?a.raw?Fxe(a,[].slice.call(arguments,1),n.p):a.reduce((o,d)=>Object.assign(o,d&&d.call?d(n.p):d),{}):a,jxe(n.target),n.g,n.o,n.k)}let QX,pP,fP;Bw.bind({g:1});let Pl=Bw.bind({k:1});function Vxe(e,n,a,o){Rd.p=n,QX=e,pP=a,fP=o}function tu(e,n){let a=this||{};return function(){let o=arguments;function d(p,m){let y=Object.assign({},p),b=y.className||d.className;a.p=Object.assign({theme:pP&&pP()},y),a.o=/ *go\d+/.test(b),y.className=Bw.apply(a,o)+(b?" "+b:"");let E=e;return e[0]&&(E=y.as||e,delete y.as),fP&&E[0]&&fP(y),QX(E,y)}return d}}var Bxe=e=>typeof e=="function",pS=(e,n)=>Bxe(e)?e(n):e,Gxe=(()=>{let e=0;return()=>(++e).toString()})(),ZX=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let n=matchMedia("(prefers-reduced-motion: reduce)");e=!n||n.matches}return e}})(),Wxe=20,t2="default",eJ=(e,n)=>{let{toastLimit:a}=e.settings;switch(n.type){case 0:return{...e,toasts:[n.toast,...e.toasts].slice(0,a)};case 1:return{...e,toasts:e.toasts.map(m=>m.id===n.toast.id?{...m,...n.toast}:m)};case 2:let{toast:o}=n;return eJ(e,{type:e.toasts.find(m=>m.id===o.id)?1:0,toast:o});case 3:let{toastId:d}=n;return{...e,toasts:e.toasts.map(m=>m.id===d||d===void 0?{...m,dismissed:!0,visible:!1}:m)};case 4:return n.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(m=>m.id!==n.toastId)};case 5:return{...e,pausedAt:n.time};case 6:let p=n.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(m=>({...m,pauseDuration:m.pauseDuration+p}))}}},jx=[],tJ={toasts:[],pausedAt:void 0,settings:{toastLimit:Wxe}},Uc={},nJ=(e,n=t2)=>{Uc[n]=eJ(Uc[n]||tJ,e),jx.forEach(([a,o])=>{a===n&&o(Uc[n])})},rJ=e=>Object.keys(Uc).forEach(n=>nJ(e,n)),$xe=e=>Object.keys(Uc).find(n=>Uc[n].toasts.some(a=>a.id===e)),Gw=(e=t2)=>n=>{nJ(n,e)},Hxe={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},zxe=(e={},n=t2)=>{let[a,o]=Y.useState(Uc[n]||tJ),d=Y.useRef(Uc[n]);Y.useEffect(()=>(d.current!==Uc[n]&&o(Uc[n]),jx.push([n,o]),()=>{let m=jx.findIndex(([y])=>y===n);m>-1&&jx.splice(m,1)}),[n]);let p=a.toasts.map(m=>{var y,b,E;return{...e,...e[m.type],...m,removeDelay:m.removeDelay||((y=e[m.type])==null?void 0:y.removeDelay)||(e==null?void 0:e.removeDelay),duration:m.duration||((b=e[m.type])==null?void 0:b.duration)||(e==null?void 0:e.duration)||Hxe[m.type],style:{...e.style,...(E=e[m.type])==null?void 0:E.style,...m.style}}});return{...a,toasts:p}},Kxe=(e,n="blank",a)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:n,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...a,id:(a==null?void 0:a.id)||Gxe()}),N_=e=>(n,a)=>{let o=Kxe(n,e,a);return Gw(o.toasterId||$xe(o.id))({type:2,toast:o}),o.id},yi=(e,n)=>N_("blank")(e,n);yi.error=N_("error");yi.success=N_("success");yi.loading=N_("loading");yi.custom=N_("custom");yi.dismiss=(e,n)=>{let a={type:3,toastId:e};n?Gw(n)(a):rJ(a)};yi.dismissAll=e=>yi.dismiss(void 0,e);yi.remove=(e,n)=>{let a={type:4,toastId:e};n?Gw(n)(a):rJ(a)};yi.removeAll=e=>yi.remove(void 0,e);yi.promise=(e,n,a)=>{let o=yi.loading(n.loading,{...a,...a==null?void 0:a.loading});return typeof e=="function"&&(e=e()),e.then(d=>{let p=n.success?pS(n.success,d):void 0;return p?yi.success(p,{id:o,...a,...a==null?void 0:a.success}):yi.dismiss(o),d}).catch(d=>{let p=n.error?pS(n.error,d):void 0;p?yi.error(p,{id:o,...a,...a==null?void 0:a.error}):yi.dismiss(o)}),e};var Yxe=1e3,qxe=(e,n="default")=>{let{toasts:a,pausedAt:o}=zxe(e,n),d=Y.useRef(new Map).current,p=Y.useCallback((w,N=Yxe)=>{if(d.has(w))return;let D=setTimeout(()=>{d.delete(w),m({type:4,toastId:w})},N);d.set(w,D)},[]);Y.useEffect(()=>{if(o)return;let w=Date.now(),N=a.map(D=>{if(D.duration===1/0)return;let A=(D.duration||0)+D.pauseDuration-(w-D.createdAt);if(A<0){D.visible&&yi.dismiss(D.id);return}return setTimeout(()=>yi.dismiss(D.id,n),A)});return()=>{N.forEach(D=>D&&clearTimeout(D))}},[a,o,n]);let m=Y.useCallback(Gw(n),[n]),y=Y.useCallback(()=>{m({type:5,time:Date.now()})},[m]),b=Y.useCallback((w,N)=>{m({type:1,toast:{id:w,height:N}})},[m]),E=Y.useCallback(()=>{o&&m({type:6,time:Date.now()})},[o,m]),T=Y.useCallback((w,N)=>{let{reverseOrder:D=!1,gutter:A=8,defaultPosition:k}=N||{},O=a.filter(V=>(V.position||k)===(w.position||k)&&V.height),F=O.findIndex(V=>V.id===w.id),M=O.filter((V,H)=>H<F&&V.visible).length;return O.filter(V=>V.visible).slice(...D?[M+1]:[0,M]).reduce((V,H)=>V+(H.height||0)+A,0)},[a]);return Y.useEffect(()=>{a.forEach(w=>{if(w.dismissed)p(w.id,w.removeDelay);else{let N=d.get(w.id);N&&(clearTimeout(N),d.delete(w.id))}})},[a,p]),{toasts:a,handlers:{updateHeight:b,startPause:y,endPause:E,calculateOffset:T}}},Xxe=Pl`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Jxe=Pl`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Qxe=Pl`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Zxe=tu("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Xxe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Jxe} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Qxe} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,eSe=Pl`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,tSe=tu("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${eSe} 1s linear infinite;
`,nSe=Pl`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,rSe=Pl`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,iSe=tu("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${nSe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${rSe} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,aSe=tu("div")`
  position: absolute;
`,sSe=tu("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,oSe=Pl`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,cSe=tu("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${oSe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,lSe=({toast:e})=>{let{icon:n,type:a,iconTheme:o}=e;return n!==void 0?typeof n=="string"?Y.createElement(cSe,null,n):n:a==="blank"?null:Y.createElement(sSe,null,Y.createElement(tSe,{...o}),a!=="loading"&&Y.createElement(aSe,null,a==="error"?Y.createElement(Zxe,{...o}):Y.createElement(iSe,{...o})))},dSe=e=>`
0% {transform: translate3d(0,${e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,uSe=e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${e*-150}%,-1px) scale(.6); opacity:0;}
`,hSe="0%{opacity:0;} 100%{opacity:1;}",pSe="0%{opacity:1;} 100%{opacity:0;}",fSe=tu("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,mSe=tu("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,gSe=(e,n)=>{let a=e.includes("top")?1:-1,[o,d]=ZX()?[hSe,pSe]:[dSe(a),uSe(a)];return{animation:n?`${Pl(o)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Pl(d)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},vSe=Y.memo(({toast:e,position:n,style:a,children:o})=>{let d=e.height?gSe(e.position||n||"top-center",e.visible):{opacity:0},p=Y.createElement(lSe,{toast:e}),m=Y.createElement(mSe,{...e.ariaProps},pS(e.message,e));return Y.createElement(fSe,{className:e.className,style:{...d,...a,...e.style}},typeof o=="function"?o({icon:p,message:m}):Y.createElement(Y.Fragment,null,p,m))});Vxe(Y.createElement);var ySe=({id:e,className:n,style:a,onHeightUpdate:o,children:d})=>{let p=Y.useCallback(m=>{if(m){let y=()=>{let b=m.getBoundingClientRect().height;o(e,b)};y(),new MutationObserver(y).observe(m,{subtree:!0,childList:!0,characterData:!0})}},[e,o]);return Y.createElement("div",{ref:p,className:n,style:a},d)},_Se=(e,n)=>{let a=e.includes("top"),o=a?{top:0}:{bottom:0},d=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ZX()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${n*(a?1:-1)}px)`,...o,...d}},bSe=Bw`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,ax=16,ESe=({reverseOrder:e,position:n="top-center",toastOptions:a,gutter:o,children:d,toasterId:p,containerStyle:m,containerClassName:y})=>{let{toasts:b,handlers:E}=qxe(a,p);return Y.createElement("div",{"data-rht-toaster":p||"",style:{position:"fixed",zIndex:9999,top:ax,left:ax,right:ax,bottom:ax,pointerEvents:"none",...m},className:y,onMouseEnter:E.startPause,onMouseLeave:E.endPause},b.map(T=>{let w=T.position||n,N=E.calculateOffset(T,{reverseOrder:e,gutter:o,defaultPosition:n}),D=_Se(w,N);return Y.createElement(ySe,{id:T.id,key:T.id,onHeightUpdate:E.updateHeight,className:T.visible?bSe:"",style:D},T.type==="custom"?pS(T.message,T):d?d(T):Y.createElement(vSe,{toast:T,position:w}))}))},it=yi;function iJ(e,n){return function(){return e.apply(n,arguments)}}const{toString:xSe}=Object.prototype,{getPrototypeOf:n2}=Object,{iterator:Ww,toStringTag:aJ}=Symbol,$w=(e=>n=>{const a=xSe.call(n);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),ac=e=>(e=e.toLowerCase(),n=>$w(n)===e),Hw=e=>n=>typeof n===e,{isArray:Um}=Array,sm=Hw("undefined");function R_(e){return e!==null&&!sm(e)&&e.constructor!==null&&!sm(e.constructor)&&ts(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const sJ=ac("ArrayBuffer");function SSe(e){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(e):n=e&&e.buffer&&sJ(e.buffer),n}const wSe=Hw("string"),ts=Hw("function"),oJ=Hw("number"),A_=e=>e!==null&&typeof e=="object",TSe=e=>e===!0||e===!1,Lx=e=>{if($w(e)!=="object")return!1;const n=n2(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(aJ in e)&&!(Ww in e)},CSe=e=>{if(!A_(e)||R_(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},NSe=ac("Date"),RSe=ac("File"),ASe=ac("Blob"),ISe=ac("FileList"),OSe=e=>A_(e)&&ts(e.pipe),PSe=e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||ts(e.append)&&((n=$w(e))==="formdata"||n==="object"&&ts(e.toString)&&e.toString()==="[object FormData]"))},DSe=ac("URLSearchParams"),[kSe,jSe,LSe,MSe]=["ReadableStream","Request","Response","Headers"].map(ac),USe=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function I_(e,n,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let o,d;if(typeof e!="object"&&(e=[e]),Um(e))for(o=0,d=e.length;o<d;o++)n.call(null,e[o],o,e);else{if(R_(e))return;const p=a?Object.getOwnPropertyNames(e):Object.keys(e),m=p.length;let y;for(o=0;o<m;o++)y=p[o],n.call(null,e[y],y,e)}}function cJ(e,n){if(R_(e))return null;n=n.toLowerCase();const a=Object.keys(e);let o=a.length,d;for(;o-- >0;)if(d=a[o],n===d.toLowerCase())return d;return null}const mh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,lJ=e=>!sm(e)&&e!==mh;function mP(){const{caseless:e,skipUndefined:n}=lJ(this)&&this||{},a={},o=(d,p)=>{const m=e&&cJ(a,p)||p;Lx(a[m])&&Lx(d)?a[m]=mP(a[m],d):Lx(d)?a[m]=mP({},d):Um(d)?a[m]=d.slice():(!n||!sm(d))&&(a[m]=d)};for(let d=0,p=arguments.length;d<p;d++)arguments[d]&&I_(arguments[d],o);return a}const FSe=(e,n,a,{allOwnKeys:o}={})=>(I_(n,(d,p)=>{a&&ts(d)?e[p]=iJ(d,a):e[p]=d},{allOwnKeys:o}),e),VSe=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),BSe=(e,n,a,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),a&&Object.assign(e.prototype,a)},GSe=(e,n,a,o)=>{let d,p,m;const y={};if(n=n||{},e==null)return n;do{for(d=Object.getOwnPropertyNames(e),p=d.length;p-- >0;)m=d[p],(!o||o(m,e,n))&&!y[m]&&(n[m]=e[m],y[m]=!0);e=a!==!1&&n2(e)}while(e&&(!a||a(e,n))&&e!==Object.prototype);return n},WSe=(e,n,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=n.length;const o=e.indexOf(n,a);return o!==-1&&o===a},$Se=e=>{if(!e)return null;if(Um(e))return e;let n=e.length;if(!oJ(n))return null;const a=new Array(n);for(;n-- >0;)a[n]=e[n];return a},HSe=(e=>n=>e&&n instanceof e)(typeof Uint8Array<"u"&&n2(Uint8Array)),zSe=(e,n)=>{const o=(e&&e[Ww]).call(e);let d;for(;(d=o.next())&&!d.done;){const p=d.value;n.call(e,p[0],p[1])}},KSe=(e,n)=>{let a;const o=[];for(;(a=e.exec(n))!==null;)o.push(a);return o},YSe=ac("HTMLFormElement"),qSe=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,o,d){return o.toUpperCase()+d}),i7=(({hasOwnProperty:e})=>(n,a)=>e.call(n,a))(Object.prototype),XSe=ac("RegExp"),dJ=(e,n)=>{const a=Object.getOwnPropertyDescriptors(e),o={};I_(a,(d,p)=>{let m;(m=n(d,p,e))!==!1&&(o[p]=m||d)}),Object.defineProperties(e,o)},JSe=e=>{dJ(e,(n,a)=>{if(ts(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const o=e[a];if(ts(o)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},QSe=(e,n)=>{const a={},o=d=>{d.forEach(p=>{a[p]=!0})};return Um(e)?o(e):o(String(e).split(n)),a},ZSe=()=>{},ewe=(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n;function twe(e){return!!(e&&ts(e.append)&&e[aJ]==="FormData"&&e[Ww])}const nwe=e=>{const n=new Array(10),a=(o,d)=>{if(A_(o)){if(n.indexOf(o)>=0)return;if(R_(o))return o;if(!("toJSON"in o)){n[d]=o;const p=Um(o)?[]:{};return I_(o,(m,y)=>{const b=a(m,d+1);!sm(b)&&(p[y]=b)}),n[d]=void 0,p}}return o};return a(e,0)},rwe=ac("AsyncFunction"),iwe=e=>e&&(A_(e)||ts(e))&&ts(e.then)&&ts(e.catch),uJ=((e,n)=>e?setImmediate:n?((a,o)=>(mh.addEventListener("message",({source:d,data:p})=>{d===mh&&p===a&&o.length&&o.shift()()},!1),d=>{o.push(d),mh.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",ts(mh.postMessage)),awe=typeof queueMicrotask<"u"?queueMicrotask.bind(mh):typeof process<"u"&&process.nextTick||uJ,swe=e=>e!=null&&ts(e[Ww]),Le={isArray:Um,isArrayBuffer:sJ,isBuffer:R_,isFormData:PSe,isArrayBufferView:SSe,isString:wSe,isNumber:oJ,isBoolean:TSe,isObject:A_,isPlainObject:Lx,isEmptyObject:CSe,isReadableStream:kSe,isRequest:jSe,isResponse:LSe,isHeaders:MSe,isUndefined:sm,isDate:NSe,isFile:RSe,isBlob:ASe,isRegExp:XSe,isFunction:ts,isStream:OSe,isURLSearchParams:DSe,isTypedArray:HSe,isFileList:ISe,forEach:I_,merge:mP,extend:FSe,trim:USe,stripBOM:VSe,inherits:BSe,toFlatObject:GSe,kindOf:$w,kindOfTest:ac,endsWith:WSe,toArray:$Se,forEachEntry:zSe,matchAll:KSe,isHTMLForm:YSe,hasOwnProperty:i7,hasOwnProp:i7,reduceDescriptors:dJ,freezeMethods:JSe,toObjectSet:QSe,toCamelCase:qSe,noop:ZSe,toFiniteNumber:ewe,findKey:cJ,global:mh,isContextDefined:lJ,isSpecCompliantForm:twe,toJSONObject:nwe,isAsyncFn:rwe,isThenable:iwe,setImmediate:uJ,asap:awe,isIterable:swe};function pn(e,n,a,o,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),a&&(this.config=a),o&&(this.request=o),d&&(this.response=d,this.status=d.status?d.status:null)}Le.inherits(pn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Le.toJSONObject(this.config),code:this.code,status:this.status}}});const hJ=pn.prototype,pJ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{pJ[e]={value:e}});Object.defineProperties(pn,pJ);Object.defineProperty(hJ,"isAxiosError",{value:!0});pn.from=(e,n,a,o,d,p)=>{const m=Object.create(hJ);Le.toFlatObject(e,m,function(T){return T!==Error.prototype},E=>E!=="isAxiosError");const y=e&&e.message?e.message:"Error",b=n==null&&e?e.code:n;return pn.call(m,y,b,a,o,d),e&&m.cause==null&&Object.defineProperty(m,"cause",{value:e,configurable:!0}),m.name=e&&e.name||"Error",p&&Object.assign(m,p),m};const owe=null;function gP(e){return Le.isPlainObject(e)||Le.isArray(e)}function fJ(e){return Le.endsWith(e,"[]")?e.slice(0,-2):e}function a7(e,n,a){return e?e.concat(n).map(function(d,p){return d=fJ(d),!a&&p?"["+d+"]":d}).join(a?".":""):n}function cwe(e){return Le.isArray(e)&&!e.some(gP)}const lwe=Le.toFlatObject(Le,{},null,function(n){return/^is[A-Z]/.test(n)});function zw(e,n,a){if(!Le.isObject(e))throw new TypeError("target must be an object");n=n||new FormData,a=Le.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(k,O){return!Le.isUndefined(O[k])});const o=a.metaTokens,d=a.visitor||T,p=a.dots,m=a.indexes,b=(a.Blob||typeof Blob<"u"&&Blob)&&Le.isSpecCompliantForm(n);if(!Le.isFunction(d))throw new TypeError("visitor must be a function");function E(A){if(A===null)return"";if(Le.isDate(A))return A.toISOString();if(Le.isBoolean(A))return A.toString();if(!b&&Le.isBlob(A))throw new pn("Blob is not supported. Use a Buffer instead.");return Le.isArrayBuffer(A)||Le.isTypedArray(A)?b&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function T(A,k,O){let F=A;if(A&&!O&&typeof A=="object"){if(Le.endsWith(k,"{}"))k=o?k:k.slice(0,-2),A=JSON.stringify(A);else if(Le.isArray(A)&&cwe(A)||(Le.isFileList(A)||Le.endsWith(k,"[]"))&&(F=Le.toArray(A)))return k=fJ(k),F.forEach(function(V,H){!(Le.isUndefined(V)||V===null)&&n.append(m===!0?a7([k],H,p):m===null?k:k+"[]",E(V))}),!1}return gP(A)?!0:(n.append(a7(O,k,p),E(A)),!1)}const w=[],N=Object.assign(lwe,{defaultVisitor:T,convertValue:E,isVisitable:gP});function D(A,k){if(!Le.isUndefined(A)){if(w.indexOf(A)!==-1)throw Error("Circular reference detected in "+k.join("."));w.push(A),Le.forEach(A,function(F,M){(!(Le.isUndefined(F)||F===null)&&d.call(n,F,Le.isString(M)?M.trim():M,k,N))===!0&&D(F,k?k.concat(M):[M])}),w.pop()}}if(!Le.isObject(e))throw new TypeError("data must be an object");return D(e),n}function s7(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return n[o]})}function r2(e,n){this._pairs=[],e&&zw(e,this,n)}const mJ=r2.prototype;mJ.append=function(n,a){this._pairs.push([n,a])};mJ.toString=function(n){const a=n?function(o){return n.call(this,o,s7)}:s7;return this._pairs.map(function(d){return a(d[0])+"="+a(d[1])},"").join("&")};function dwe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function gJ(e,n,a){if(!n)return e;const o=a&&a.encode||dwe;Le.isFunction(a)&&(a={serialize:a});const d=a&&a.serialize;let p;if(d?p=d(n,a):p=Le.isURLSearchParams(n)?n.toString():new r2(n,a).toString(o),p){const m=e.indexOf("#");m!==-1&&(e=e.slice(0,m)),e+=(e.indexOf("?")===-1?"?":"&")+p}return e}class o7{constructor(){this.handlers=[]}use(n,a,o){return this.handlers.push({fulfilled:n,rejected:a,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){Le.forEach(this.handlers,function(o){o!==null&&n(o)})}}const vJ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},uwe=typeof URLSearchParams<"u"?URLSearchParams:r2,hwe=typeof FormData<"u"?FormData:null,pwe=typeof Blob<"u"?Blob:null,fwe={isBrowser:!0,classes:{URLSearchParams:uwe,FormData:hwe,Blob:pwe},protocols:["http","https","file","blob","url","data"]},i2=typeof window<"u"&&typeof document<"u",vP=typeof navigator=="object"&&navigator||void 0,mwe=i2&&(!vP||["ReactNative","NativeScript","NS"].indexOf(vP.product)<0),gwe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",vwe=i2&&window.location.href||"http://localhost",ywe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:i2,hasStandardBrowserEnv:mwe,hasStandardBrowserWebWorkerEnv:gwe,navigator:vP,origin:vwe},Symbol.toStringTag,{value:"Module"})),da={...ywe,...fwe};function _we(e,n){return zw(e,new da.classes.URLSearchParams,{visitor:function(a,o,d,p){return da.isNode&&Le.isBuffer(a)?(this.append(o,a.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)},...n})}function bwe(e){return Le.matchAll(/\w+|\[(\w*)]/g,e).map(n=>n[0]==="[]"?"":n[1]||n[0])}function Ewe(e){const n={},a=Object.keys(e);let o;const d=a.length;let p;for(o=0;o<d;o++)p=a[o],n[p]=e[p];return n}function yJ(e){function n(a,o,d,p){let m=a[p++];if(m==="__proto__")return!0;const y=Number.isFinite(+m),b=p>=a.length;return m=!m&&Le.isArray(d)?d.length:m,b?(Le.hasOwnProp(d,m)?d[m]=[d[m],o]:d[m]=o,!y):((!d[m]||!Le.isObject(d[m]))&&(d[m]=[]),n(a,o,d[m],p)&&Le.isArray(d[m])&&(d[m]=Ewe(d[m])),!y)}if(Le.isFormData(e)&&Le.isFunction(e.entries)){const a={};return Le.forEachEntry(e,(o,d)=>{n(bwe(o),d,a,0)}),a}return null}function xwe(e,n,a){if(Le.isString(e))try{return(n||JSON.parse)(e),Le.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(a||JSON.stringify)(e)}const O_={transitional:vJ,adapter:["xhr","http","fetch"],transformRequest:[function(n,a){const o=a.getContentType()||"",d=o.indexOf("application/json")>-1,p=Le.isObject(n);if(p&&Le.isHTMLForm(n)&&(n=new FormData(n)),Le.isFormData(n))return d?JSON.stringify(yJ(n)):n;if(Le.isArrayBuffer(n)||Le.isBuffer(n)||Le.isStream(n)||Le.isFile(n)||Le.isBlob(n)||Le.isReadableStream(n))return n;if(Le.isArrayBufferView(n))return n.buffer;if(Le.isURLSearchParams(n))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let y;if(p){if(o.indexOf("application/x-www-form-urlencoded")>-1)return _we(n,this.formSerializer).toString();if((y=Le.isFileList(n))||o.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return zw(y?{"files[]":n}:n,b&&new b,this.formSerializer)}}return p||d?(a.setContentType("application/json",!1),xwe(n)):n}],transformResponse:[function(n){const a=this.transitional||O_.transitional,o=a&&a.forcedJSONParsing,d=this.responseType==="json";if(Le.isResponse(n)||Le.isReadableStream(n))return n;if(n&&Le.isString(n)&&(o&&!this.responseType||d)){const m=!(a&&a.silentJSONParsing)&&d;try{return JSON.parse(n,this.parseReviver)}catch(y){if(m)throw y.name==="SyntaxError"?pn.from(y,pn.ERR_BAD_RESPONSE,this,null,this.response):y}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:da.classes.FormData,Blob:da.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Le.forEach(["delete","get","head","post","put","patch"],e=>{O_.headers[e]={}});const Swe=Le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wwe=e=>{const n={};let a,o,d;return e&&e.split(`
`).forEach(function(m){d=m.indexOf(":"),a=m.substring(0,d).trim().toLowerCase(),o=m.substring(d+1).trim(),!(!a||n[a]&&Swe[a])&&(a==="set-cookie"?n[a]?n[a].push(o):n[a]=[o]:n[a]=n[a]?n[a]+", "+o:o)}),n},c7=Symbol("internals");function Fv(e){return e&&String(e).trim().toLowerCase()}function Mx(e){return e===!1||e==null?e:Le.isArray(e)?e.map(Mx):String(e)}function Twe(e){const n=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=a.exec(e);)n[o[1]]=o[2];return n}const Cwe=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function DO(e,n,a,o,d){if(Le.isFunction(o))return o.call(this,n,a);if(d&&(n=a),!!Le.isString(n)){if(Le.isString(o))return n.indexOf(o)!==-1;if(Le.isRegExp(o))return o.test(n)}}function Nwe(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,a,o)=>a.toUpperCase()+o)}function Rwe(e,n){const a=Le.toCamelCase(" "+n);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+a,{value:function(d,p,m){return this[o].call(this,n,d,p,m)},configurable:!0})})}let ns=class{constructor(n){n&&this.set(n)}set(n,a,o){const d=this;function p(y,b,E){const T=Fv(b);if(!T)throw new Error("header name must be a non-empty string");const w=Le.findKey(d,T);(!w||d[w]===void 0||E===!0||E===void 0&&d[w]!==!1)&&(d[w||b]=Mx(y))}const m=(y,b)=>Le.forEach(y,(E,T)=>p(E,T,b));if(Le.isPlainObject(n)||n instanceof this.constructor)m(n,a);else if(Le.isString(n)&&(n=n.trim())&&!Cwe(n))m(wwe(n),a);else if(Le.isObject(n)&&Le.isIterable(n)){let y={},b,E;for(const T of n){if(!Le.isArray(T))throw TypeError("Object iterator must return a key-value pair");y[E=T[0]]=(b=y[E])?Le.isArray(b)?[...b,T[1]]:[b,T[1]]:T[1]}m(y,a)}else n!=null&&p(a,n,o);return this}get(n,a){if(n=Fv(n),n){const o=Le.findKey(this,n);if(o){const d=this[o];if(!a)return d;if(a===!0)return Twe(d);if(Le.isFunction(a))return a.call(this,d,o);if(Le.isRegExp(a))return a.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,a){if(n=Fv(n),n){const o=Le.findKey(this,n);return!!(o&&this[o]!==void 0&&(!a||DO(this,this[o],o,a)))}return!1}delete(n,a){const o=this;let d=!1;function p(m){if(m=Fv(m),m){const y=Le.findKey(o,m);y&&(!a||DO(o,o[y],y,a))&&(delete o[y],d=!0)}}return Le.isArray(n)?n.forEach(p):p(n),d}clear(n){const a=Object.keys(this);let o=a.length,d=!1;for(;o--;){const p=a[o];(!n||DO(this,this[p],p,n,!0))&&(delete this[p],d=!0)}return d}normalize(n){const a=this,o={};return Le.forEach(this,(d,p)=>{const m=Le.findKey(o,p);if(m){a[m]=Mx(d),delete a[p];return}const y=n?Nwe(p):String(p).trim();y!==p&&delete a[p],a[y]=Mx(d),o[y]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const a=Object.create(null);return Le.forEach(this,(o,d)=>{o!=null&&o!==!1&&(a[d]=n&&Le.isArray(o)?o.join(", "):o)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,a])=>n+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...a){const o=new this(n);return a.forEach(d=>o.set(d)),o}static accessor(n){const o=(this[c7]=this[c7]={accessors:{}}).accessors,d=this.prototype;function p(m){const y=Fv(m);o[y]||(Rwe(d,m),o[y]=!0)}return Le.isArray(n)?n.forEach(p):p(n),this}};ns.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Le.reduceDescriptors(ns.prototype,({value:e},n)=>{let a=n[0].toUpperCase()+n.slice(1);return{get:()=>e,set(o){this[a]=o}}});Le.freezeMethods(ns);function kO(e,n){const a=this||O_,o=n||a,d=ns.from(o.headers);let p=o.data;return Le.forEach(e,function(y){p=y.call(a,p,d.normalize(),n?n.status:void 0)}),d.normalize(),p}function _J(e){return!!(e&&e.__CANCEL__)}function Fm(e,n,a){pn.call(this,e??"canceled",pn.ERR_CANCELED,n,a),this.name="CanceledError"}Le.inherits(Fm,pn,{__CANCEL__:!0});function bJ(e,n,a){const o=a.config.validateStatus;!a.status||!o||o(a.status)?e(a):n(new pn("Request failed with status code "+a.status,[pn.ERR_BAD_REQUEST,pn.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function Awe(e){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return n&&n[1]||""}function Iwe(e,n){e=e||10;const a=new Array(e),o=new Array(e);let d=0,p=0,m;return n=n!==void 0?n:1e3,function(b){const E=Date.now(),T=o[p];m||(m=E),a[d]=b,o[d]=E;let w=p,N=0;for(;w!==d;)N+=a[w++],w=w%e;if(d=(d+1)%e,d===p&&(p=(p+1)%e),E-m<n)return;const D=T&&E-T;return D?Math.round(N*1e3/D):void 0}}function Owe(e,n){let a=0,o=1e3/n,d,p;const m=(E,T=Date.now())=>{a=T,d=null,p&&(clearTimeout(p),p=null),e(...E)};return[(...E)=>{const T=Date.now(),w=T-a;w>=o?m(E,T):(d=E,p||(p=setTimeout(()=>{p=null,m(d)},o-w)))},()=>d&&m(d)]}const fS=(e,n,a=3)=>{let o=0;const d=Iwe(50,250);return Owe(p=>{const m=p.loaded,y=p.lengthComputable?p.total:void 0,b=m-o,E=d(b),T=m<=y;o=m;const w={loaded:m,total:y,progress:y?m/y:void 0,bytes:b,rate:E||void 0,estimated:E&&y&&T?(y-m)/E:void 0,event:p,lengthComputable:y!=null,[n?"download":"upload"]:!0};e(w)},a)},l7=(e,n)=>{const a=e!=null;return[o=>n[0]({lengthComputable:a,total:e,loaded:o}),n[1]]},d7=e=>(...n)=>Le.asap(()=>e(...n)),Pwe=da.hasStandardBrowserEnv?((e,n)=>a=>(a=new URL(a,da.origin),e.protocol===a.protocol&&e.host===a.host&&(n||e.port===a.port)))(new URL(da.origin),da.navigator&&/(msie|trident)/i.test(da.navigator.userAgent)):()=>!0,Dwe=da.hasStandardBrowserEnv?{write(e,n,a,o,d,p,m){if(typeof document>"u")return;const y=[`${e}=${encodeURIComponent(n)}`];Le.isNumber(a)&&y.push(`expires=${new Date(a).toUTCString()}`),Le.isString(o)&&y.push(`path=${o}`),Le.isString(d)&&y.push(`domain=${d}`),p===!0&&y.push("secure"),Le.isString(m)&&y.push(`SameSite=${m}`),document.cookie=y.join("; ")},read(e){if(typeof document>"u")return null;const n=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return n?decodeURIComponent(n[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function kwe(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function jwe(e,n){return n?e.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):e}function EJ(e,n,a){let o=!kwe(n);return e&&(o||a==!1)?jwe(e,n):n}const u7=e=>e instanceof ns?{...e}:e;function Dh(e,n){n=n||{};const a={};function o(E,T,w,N){return Le.isPlainObject(E)&&Le.isPlainObject(T)?Le.merge.call({caseless:N},E,T):Le.isPlainObject(T)?Le.merge({},T):Le.isArray(T)?T.slice():T}function d(E,T,w,N){if(Le.isUndefined(T)){if(!Le.isUndefined(E))return o(void 0,E,w,N)}else return o(E,T,w,N)}function p(E,T){if(!Le.isUndefined(T))return o(void 0,T)}function m(E,T){if(Le.isUndefined(T)){if(!Le.isUndefined(E))return o(void 0,E)}else return o(void 0,T)}function y(E,T,w){if(w in n)return o(E,T);if(w in e)return o(void 0,E)}const b={url:p,method:p,data:p,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,withXSRFToken:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:y,headers:(E,T,w)=>d(u7(E),u7(T),w,!0)};return Le.forEach(Object.keys({...e,...n}),function(T){const w=b[T]||d,N=w(e[T],n[T],T);Le.isUndefined(N)&&w!==y||(a[T]=N)}),a}const xJ=e=>{const n=Dh({},e);let{data:a,withXSRFToken:o,xsrfHeaderName:d,xsrfCookieName:p,headers:m,auth:y}=n;if(n.headers=m=ns.from(m),n.url=gJ(EJ(n.baseURL,n.url,n.allowAbsoluteUrls),e.params,e.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),Le.isFormData(a)){if(da.hasStandardBrowserEnv||da.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if(Le.isFunction(a.getHeaders)){const b=a.getHeaders(),E=["content-type","content-length"];Object.entries(b).forEach(([T,w])=>{E.includes(T.toLowerCase())&&m.set(T,w)})}}if(da.hasStandardBrowserEnv&&(o&&Le.isFunction(o)&&(o=o(n)),o||o!==!1&&Pwe(n.url))){const b=d&&p&&Dwe.read(p);b&&m.set(d,b)}return n},Lwe=typeof XMLHttpRequest<"u",Mwe=Lwe&&function(e){return new Promise(function(a,o){const d=xJ(e);let p=d.data;const m=ns.from(d.headers).normalize();let{responseType:y,onUploadProgress:b,onDownloadProgress:E}=d,T,w,N,D,A;function k(){D&&D(),A&&A(),d.cancelToken&&d.cancelToken.unsubscribe(T),d.signal&&d.signal.removeEventListener("abort",T)}let O=new XMLHttpRequest;O.open(d.method.toUpperCase(),d.url,!0),O.timeout=d.timeout;function F(){if(!O)return;const V=ns.from("getAllResponseHeaders"in O&&O.getAllResponseHeaders()),B={data:!y||y==="text"||y==="json"?O.responseText:O.response,status:O.status,statusText:O.statusText,headers:V,config:e,request:O};bJ(function(q){a(q),k()},function(q){o(q),k()},B),O=null}"onloadend"in O?O.onloadend=F:O.onreadystatechange=function(){!O||O.readyState!==4||O.status===0&&!(O.responseURL&&O.responseURL.indexOf("file:")===0)||setTimeout(F)},O.onabort=function(){O&&(o(new pn("Request aborted",pn.ECONNABORTED,e,O)),O=null)},O.onerror=function(H){const B=H&&H.message?H.message:"Network Error",z=new pn(B,pn.ERR_NETWORK,e,O);z.event=H||null,o(z),O=null},O.ontimeout=function(){let H=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const B=d.transitional||vJ;d.timeoutErrorMessage&&(H=d.timeoutErrorMessage),o(new pn(H,B.clarifyTimeoutError?pn.ETIMEDOUT:pn.ECONNABORTED,e,O)),O=null},p===void 0&&m.setContentType(null),"setRequestHeader"in O&&Le.forEach(m.toJSON(),function(H,B){O.setRequestHeader(B,H)}),Le.isUndefined(d.withCredentials)||(O.withCredentials=!!d.withCredentials),y&&y!=="json"&&(O.responseType=d.responseType),E&&([N,A]=fS(E,!0),O.addEventListener("progress",N)),b&&O.upload&&([w,D]=fS(b),O.upload.addEventListener("progress",w),O.upload.addEventListener("loadend",D)),(d.cancelToken||d.signal)&&(T=V=>{O&&(o(!V||V.type?new Fm(null,e,O):V),O.abort(),O=null)},d.cancelToken&&d.cancelToken.subscribe(T),d.signal&&(d.signal.aborted?T():d.signal.addEventListener("abort",T)));const M=Awe(d.url);if(M&&da.protocols.indexOf(M)===-1){o(new pn("Unsupported protocol "+M+":",pn.ERR_BAD_REQUEST,e));return}O.send(p||null)})},Uwe=(e,n)=>{const{length:a}=e=e?e.filter(Boolean):[];if(n||a){let o=new AbortController,d;const p=function(E){if(!d){d=!0,y();const T=E instanceof Error?E:this.reason;o.abort(T instanceof pn?T:new Fm(T instanceof Error?T.message:T))}};let m=n&&setTimeout(()=>{m=null,p(new pn(`timeout ${n} of ms exceeded`,pn.ETIMEDOUT))},n);const y=()=>{e&&(m&&clearTimeout(m),m=null,e.forEach(E=>{E.unsubscribe?E.unsubscribe(p):E.removeEventListener("abort",p)}),e=null)};e.forEach(E=>E.addEventListener("abort",p));const{signal:b}=o;return b.unsubscribe=()=>Le.asap(y),b}},Fwe=function*(e,n){let a=e.byteLength;if(a<n){yield e;return}let o=0,d;for(;o<a;)d=o+n,yield e.slice(o,d),o=d},Vwe=async function*(e,n){for await(const a of Bwe(e))yield*Fwe(a,n)},Bwe=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const n=e.getReader();try{for(;;){const{done:a,value:o}=await n.read();if(a)break;yield o}}finally{await n.cancel()}},h7=(e,n,a,o)=>{const d=Vwe(e,n);let p=0,m,y=b=>{m||(m=!0,o&&o(b))};return new ReadableStream({async pull(b){try{const{done:E,value:T}=await d.next();if(E){y(),b.close();return}let w=T.byteLength;if(a){let N=p+=w;a(N)}b.enqueue(new Uint8Array(T))}catch(E){throw y(E),E}},cancel(b){return y(b),d.return()}},{highWaterMark:2})},p7=64*1024,{isFunction:sx}=Le,Gwe=(({Request:e,Response:n})=>({Request:e,Response:n}))(Le.global),{ReadableStream:f7,TextEncoder:m7}=Le.global,g7=(e,...n)=>{try{return!!e(...n)}catch{return!1}},Wwe=e=>{e=Le.merge.call({skipUndefined:!0},Gwe,e);const{fetch:n,Request:a,Response:o}=e,d=n?sx(n):typeof fetch=="function",p=sx(a),m=sx(o);if(!d)return!1;const y=d&&sx(f7),b=d&&(typeof m7=="function"?(A=>k=>A.encode(k))(new m7):async A=>new Uint8Array(await new a(A).arrayBuffer())),E=p&&y&&g7(()=>{let A=!1;const k=new a(da.origin,{body:new f7,method:"POST",get duplex(){return A=!0,"half"}}).headers.has("Content-Type");return A&&!k}),T=m&&y&&g7(()=>Le.isReadableStream(new o("").body)),w={stream:T&&(A=>A.body)};d&&["text","arrayBuffer","blob","formData","stream"].forEach(A=>{!w[A]&&(w[A]=(k,O)=>{let F=k&&k[A];if(F)return F.call(k);throw new pn(`Response type '${A}' is not supported`,pn.ERR_NOT_SUPPORT,O)})});const N=async A=>{if(A==null)return 0;if(Le.isBlob(A))return A.size;if(Le.isSpecCompliantForm(A))return(await new a(da.origin,{method:"POST",body:A}).arrayBuffer()).byteLength;if(Le.isArrayBufferView(A)||Le.isArrayBuffer(A))return A.byteLength;if(Le.isURLSearchParams(A)&&(A=A+""),Le.isString(A))return(await b(A)).byteLength},D=async(A,k)=>{const O=Le.toFiniteNumber(A.getContentLength());return O??N(k)};return async A=>{let{url:k,method:O,data:F,signal:M,cancelToken:V,timeout:H,onDownloadProgress:B,onUploadProgress:z,responseType:q,headers:Q,withCredentials:ee="same-origin",fetchOptions:oe}=xJ(A),ne=n||fetch;q=q?(q+"").toLowerCase():"text";let ue=Uwe([M,V&&V.toAbortSignal()],H),Se=null;const fe=ue&&ue.unsubscribe&&(()=>{ue.unsubscribe()});let we;try{if(z&&E&&O!=="get"&&O!=="head"&&(we=await D(Q,F))!==0){let Ue=new a(k,{method:"POST",body:F,duplex:"half"}),Me;if(Le.isFormData(F)&&(Me=Ue.headers.get("content-type"))&&Q.setContentType(Me),Ue.body){const[et,Re]=l7(we,fS(d7(z)));F=h7(Ue.body,p7,et,Re)}}Le.isString(ee)||(ee=ee?"include":"omit");const he=p&&"credentials"in a.prototype,be={...oe,signal:ue,method:O.toUpperCase(),headers:Q.normalize().toJSON(),body:F,duplex:"half",credentials:he?ee:void 0};Se=p&&new a(k,be);let ae=await(p?ne(Se,oe):ne(k,be));const de=T&&(q==="stream"||q==="response");if(T&&(B||de&&fe)){const Ue={};["status","statusText","headers"].forEach(nt=>{Ue[nt]=ae[nt]});const Me=Le.toFiniteNumber(ae.headers.get("content-length")),[et,Re]=B&&l7(Me,fS(d7(B),!0))||[];ae=new o(h7(ae.body,p7,et,()=>{Re&&Re(),fe&&fe()}),Ue)}q=q||"text";let xe=await w[Le.findKey(w,q)||"text"](ae,A);return!de&&fe&&fe(),await new Promise((Ue,Me)=>{bJ(Ue,Me,{data:xe,headers:ns.from(ae.headers),status:ae.status,statusText:ae.statusText,config:A,request:Se})})}catch(he){throw fe&&fe(),he&&he.name==="TypeError"&&/Load failed|fetch/i.test(he.message)?Object.assign(new pn("Network Error",pn.ERR_NETWORK,A,Se),{cause:he.cause||he}):pn.from(he,he&&he.code,A,Se)}}},$we=new Map,SJ=e=>{let n=e&&e.env||{};const{fetch:a,Request:o,Response:d}=n,p=[o,d,a];let m=p.length,y=m,b,E,T=$we;for(;y--;)b=p[y],E=T.get(b),E===void 0&&T.set(b,E=y?new Map:Wwe(n)),T=E;return E};SJ();const a2={http:owe,xhr:Mwe,fetch:{get:SJ}};Le.forEach(a2,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const v7=e=>`- ${e}`,Hwe=e=>Le.isFunction(e)||e===null||e===!1;function zwe(e,n){e=Le.isArray(e)?e:[e];const{length:a}=e;let o,d;const p={};for(let m=0;m<a;m++){o=e[m];let y;if(d=o,!Hwe(o)&&(d=a2[(y=String(o)).toLowerCase()],d===void 0))throw new pn(`Unknown adapter '${y}'`);if(d&&(Le.isFunction(d)||(d=d.get(n))))break;p[y||"#"+m]=d}if(!d){const m=Object.entries(p).map(([b,E])=>`adapter ${b} `+(E===!1?"is not supported by the environment":"is not available in the build"));let y=a?m.length>1?`since :
`+m.map(v7).join(`
`):" "+v7(m[0]):"as no adapter specified";throw new pn("There is no suitable adapter to dispatch the request "+y,"ERR_NOT_SUPPORT")}return d}const wJ={getAdapter:zwe,adapters:a2};function jO(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Fm(null,e)}function y7(e){return jO(e),e.headers=ns.from(e.headers),e.data=kO.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),wJ.getAdapter(e.adapter||O_.adapter,e)(e).then(function(o){return jO(e),o.data=kO.call(e,e.transformResponse,o),o.headers=ns.from(o.headers),o},function(o){return _J(o)||(jO(e),o&&o.response&&(o.response.data=kO.call(e,e.transformResponse,o.response),o.response.headers=ns.from(o.response.headers))),Promise.reject(o)})}const TJ="1.13.2",Kw={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{Kw[e]=function(o){return typeof o===e||"a"+(n<1?"n ":" ")+e}});const _7={};Kw.transitional=function(n,a,o){function d(p,m){return"[Axios v"+TJ+"] Transitional option '"+p+"'"+m+(o?". "+o:"")}return(p,m,y)=>{if(n===!1)throw new pn(d(m," has been removed"+(a?" in "+a:"")),pn.ERR_DEPRECATED);return a&&!_7[m]&&(_7[m]=!0,console.warn(d(m," has been deprecated since v"+a+" and will be removed in the near future"))),n?n(p,m,y):!0}};Kw.spelling=function(n){return(a,o)=>(console.warn(`${o} is likely a misspelling of ${n}`),!0)};function Kwe(e,n,a){if(typeof e!="object")throw new pn("options must be an object",pn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let d=o.length;for(;d-- >0;){const p=o[d],m=n[p];if(m){const y=e[p],b=y===void 0||m(y,p,e);if(b!==!0)throw new pn("option "+p+" must be "+b,pn.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new pn("Unknown option "+p,pn.ERR_BAD_OPTION)}}const Ux={assertOptions:Kwe,validators:Kw},Dc=Ux.validators;let wh=class{constructor(n){this.defaults=n||{},this.interceptors={request:new o7,response:new o7}}async request(n,a){try{return await this._request(n,a)}catch(o){if(o instanceof Error){let d={};Error.captureStackTrace?Error.captureStackTrace(d):d=new Error;const p=d.stack?d.stack.replace(/^.+\n/,""):"";try{o.stack?p&&!String(o.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+p):o.stack=p}catch{}}throw o}}_request(n,a){typeof n=="string"?(a=a||{},a.url=n):a=n||{},a=Dh(this.defaults,a);const{transitional:o,paramsSerializer:d,headers:p}=a;o!==void 0&&Ux.assertOptions(o,{silentJSONParsing:Dc.transitional(Dc.boolean),forcedJSONParsing:Dc.transitional(Dc.boolean),clarifyTimeoutError:Dc.transitional(Dc.boolean)},!1),d!=null&&(Le.isFunction(d)?a.paramsSerializer={serialize:d}:Ux.assertOptions(d,{encode:Dc.function,serialize:Dc.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),Ux.assertOptions(a,{baseUrl:Dc.spelling("baseURL"),withXsrfToken:Dc.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let m=p&&Le.merge(p.common,p[a.method]);p&&Le.forEach(["delete","get","head","post","put","patch","common"],A=>{delete p[A]}),a.headers=ns.concat(m,p);const y=[];let b=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(a)===!1||(b=b&&k.synchronous,y.unshift(k.fulfilled,k.rejected))});const E=[];this.interceptors.response.forEach(function(k){E.push(k.fulfilled,k.rejected)});let T,w=0,N;if(!b){const A=[y7.bind(this),void 0];for(A.unshift(...y),A.push(...E),N=A.length,T=Promise.resolve(a);w<N;)T=T.then(A[w++],A[w++]);return T}N=y.length;let D=a;for(;w<N;){const A=y[w++],k=y[w++];try{D=A(D)}catch(O){k.call(this,O);break}}try{T=y7.call(this,D)}catch(A){return Promise.reject(A)}for(w=0,N=E.length;w<N;)T=T.then(E[w++],E[w++]);return T}getUri(n){n=Dh(this.defaults,n);const a=EJ(n.baseURL,n.url,n.allowAbsoluteUrls);return gJ(a,n.params,n.paramsSerializer)}};Le.forEach(["delete","get","head","options"],function(n){wh.prototype[n]=function(a,o){return this.request(Dh(o||{},{method:n,url:a,data:(o||{}).data}))}});Le.forEach(["post","put","patch"],function(n){function a(o){return function(p,m,y){return this.request(Dh(y||{},{method:n,headers:o?{"Content-Type":"multipart/form-data"}:{},url:p,data:m}))}}wh.prototype[n]=a(),wh.prototype[n+"Form"]=a(!0)});let Ywe=class CJ{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(p){a=p});const o=this;this.promise.then(d=>{if(!o._listeners)return;let p=o._listeners.length;for(;p-- >0;)o._listeners[p](d);o._listeners=null}),this.promise.then=d=>{let p;const m=new Promise(y=>{o.subscribe(y),p=y}).then(d);return m.cancel=function(){o.unsubscribe(p)},m},n(function(p,m,y){o.reason||(o.reason=new Fm(p,m,y),a(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const a=this._listeners.indexOf(n);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const n=new AbortController,a=o=>{n.abort(o)};return this.subscribe(a),n.signal.unsubscribe=()=>this.unsubscribe(a),n.signal}static source(){let n;return{token:new CJ(function(d){n=d}),cancel:n}}};function qwe(e){return function(a){return e.apply(null,a)}}function Xwe(e){return Le.isObject(e)&&e.isAxiosError===!0}const yP={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(yP).forEach(([e,n])=>{yP[n]=e});function NJ(e){const n=new wh(e),a=iJ(wh.prototype.request,n);return Le.extend(a,wh.prototype,n,{allOwnKeys:!0}),Le.extend(a,n,null,{allOwnKeys:!0}),a.create=function(d){return NJ(Dh(e,d))},a}const Mn=NJ(O_);Mn.Axios=wh;Mn.CanceledError=Fm;Mn.CancelToken=Ywe;Mn.isCancel=_J;Mn.VERSION=TJ;Mn.toFormData=zw;Mn.AxiosError=pn;Mn.Cancel=Mn.CanceledError;Mn.all=function(n){return Promise.all(n)};Mn.spread=qwe;Mn.isAxiosError=Xwe;Mn.mergeConfig=Dh;Mn.AxiosHeaders=ns;Mn.formToJSON=e=>yJ(Le.isHTMLForm(e)?new FormData(e):e);Mn.getAdapter=wJ.getAdapter;Mn.HttpStatusCode=yP;Mn.default=Mn;const{Axios:xKe,AxiosError:SKe,CanceledError:wKe,isCancel:TKe,CancelToken:CKe,VERSION:NKe,all:RKe,Cancel:AKe,isAxiosError:IKe,spread:OKe,toFormData:PKe,AxiosHeaders:DKe,HttpStatusCode:kKe,formToJSON:jKe,getAdapter:LKe,mergeConfig:MKe}=Mn,dt=Mn.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});dt.interceptors.request.use(e=>{const n=localStorage.getItem("token");return n&&(e.headers.Authorization=`Bearer ${n}`),e});dt.interceptors.response.use(e=>e,e=>{var n;return((n=e.response)==null?void 0:n.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});const Th={uploadReport:e=>dt.post("/health/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),getReports:()=>dt.get("/health/reports"),getReport:e=>dt.get(`/health/reports/${e}`),getDashboard:()=>dt.get("/health/dashboard"),getHistory:e=>dt.get("/health/history",{params:{reportType:e}}),compareReport:e=>dt.get(`/health/reports/${e}/compare`),chatAboutReport:(e,n,a)=>dt.post(`/health/reports/${e}/chat`,{message:n,chatHistory:a}),askAI:e=>dt.post("/health/ai-chat",e)},qa={getAll:e=>dt.get("/doctors",{params:e}),getById:e=>dt.get(`/doctors/${e}`),getRecommended:e=>dt.get("/doctors/recommended",{params:{specializations:e}}),bookAppointment:e=>dt.post("/doctors/book",e),getAppointments:()=>dt.get("/doctors/appointments"),getAppointment:e=>dt.get(`/doctors/appointments/${e}`),startConsultation:e=>dt.post(`/doctors/appointments/${e}/start`),endConsultation:e=>dt.post(`/doctors/appointments/${e}/end`),getConsultationSummary:e=>dt.get(`/doctors/appointments/${e}/summary`),submitReview:(e,n)=>dt.post(`/doctors/appointments/${e}/review`,n),downloadPrescription:e=>dt.get(`/doctors/appointments/${e}/prescription`,{responseType:"blob"}),getDashboard:()=>dt.get("/doctors/me/dashboard"),getMyProfile:()=>dt.get("/doctors/me/profile"),updateMyProfile:e=>dt.put("/doctors/me/profile",e),getMyAppointments:e=>dt.get("/doctors/me/appointments",{params:e}),updateAppointmentStatus:(e,n)=>dt.patch(`/doctors/me/appointments/${e}`,n),getPatientProfile:(e,n)=>dt.get(`/doctors/patient/${e}`,{params:{appointmentId:n}}),getDoctorAppointments:(e,n)=>dt.get(`/doctors/${e}/appointments`,{params:{status:n}}),getMyAvailability:()=>dt.get("/doctors/me/availability"),updateMyAvailability:e=>dt.put("/doctors/me/availability",e),generateTimeSlots:()=>dt.post("/doctors/me/generate-slots"),getDoctorAvailableSlots:(e,n)=>dt.get(`/doctors/${e}/available-slots`,{params:{date:n}}),checkSlotAvailability:(e,n,a)=>dt.get(`/doctors/${e}/check-slot`,{params:{date:n,timeSlot:a}})},Sf={connectDevice:(e,n)=>dt.post("/wearables/connect",{deviceType:e,deviceName:n}),disconnectDevice:e=>dt.post(`/wearables/disconnect/${e}`),getDevices:()=>dt.get("/wearables/devices"),syncMetrics:(e,n)=>dt.post("/wearables/sync",{deviceType:e,metrics:n}),addHeartRate:(e,n,a)=>dt.post("/wearables/heart-rate",{deviceType:e,bpm:n,type:a}),addSleepData:(e,n)=>dt.post("/wearables/sleep",{deviceType:e,sleepData:n}),getDashboard:()=>dt.get("/wearables/dashboard"),generateDemoData:e=>dt.post("/wearables/demo-data",{deviceType:e})},Fx={getStats:()=>dt.get("/admin/stats"),getUsers:e=>dt.get("/admin/users",{params:e}),getUserDetails:e=>dt.get(`/admin/users/${e}`),updateUserStatus:(e,n)=>dt.patch(`/admin/users/${e}/status`,{isActive:n}),getReports:e=>dt.get("/admin/reports",{params:e}),getDeficiencyRules:()=>dt.get("/admin/deficiency-rules"),createDeficiencyRule:e=>dt.post("/admin/deficiency-rules",e),updateDeficiencyRule:(e,n)=>dt.put(`/admin/deficiency-rules/${e}`,n),deleteDeficiencyRule:e=>dt.delete(`/admin/deficiency-rules/${e}`),getSupplements:()=>dt.get("/admin/supplements"),createSupplement:e=>dt.post("/admin/supplements",e),updateSupplement:(e,n)=>dt.put(`/admin/supplements/${e}`,n),deleteSupplement:e=>dt.delete(`/admin/supplements/${e}`),getDietPlans:e=>dt.get("/admin/diet-plans",{params:e}),createDietPlan:e=>dt.post("/admin/diet-plans",e),updateDietPlan:(e,n)=>dt.put(`/admin/diet-plans/${e}`,n),approveDietPlan:(e,n)=>dt.patch(`/admin/diet-plans/${e}/approve`,{status:n}),deleteDietPlan:e=>dt.delete(`/admin/diet-plans/${e}`),getDoctors:e=>dt.get("/admin/doctors",{params:e}),createDoctor:e=>dt.post("/admin/doctors",e),updateDoctor:(e,n)=>dt.put(`/admin/doctors/${e}`,n),approveDoctor:e=>dt.patch(`/admin/doctors/${e}/approve`),rejectDoctor:(e,n)=>dt.patch(`/admin/doctors/${e}/reject`,{reason:n}),deleteDoctor:e=>dt.delete(`/admin/doctors/${e}`),toggleDoctorVisibility:e=>dt.patch(`/admin/doctors/${e}/visibility`),getDoctorScheduleOverview:e=>dt.get(`/admin/doctors/${e}/schedule-overview`)},Jwe={getSubscription:()=>dt.get("/auth/subscription")},Qwe={analyzeFood:e=>dt.post("/nutrition/analyze-food",{foodDescription:e}),logMeal:e=>dt.post("/nutrition/log-meal",e),getTodayLogs:()=>dt.get("/nutrition/logs/today"),getDailySummary:e=>dt.get("/nutrition/summary/daily",{params:{date:e}}),getGoals:()=>dt.get("/nutrition/goals"),updateGoals:e=>dt.put("/nutrition/goals",e)},RJ=Y.createContext(),fa=()=>Y.useContext(RJ),Zwe=({children:e})=>{const[n,a]=Y.useState(null),[o,d]=Y.useState(!0);Y.useEffect(()=>{const k=localStorage.getItem("token"),O=localStorage.getItem("user");k&&O&&(a(JSON.parse(O)),dt.defaults.headers.common.Authorization=`Bearer ${k}`),d(!1)},[]);const p=async(k,O)=>{const M=k.includes("@")?{email:k,password:O}:{phone:k,password:O},{data:V}=await dt.post("/auth/login",M);return localStorage.setItem("token",V.token),localStorage.setItem("user",JSON.stringify(V)),dt.defaults.headers.common.Authorization=`Bearer ${V.token}`,a(V),V},m=async(k,O,F,M={},V=null)=>{const{data:H}=await dt.post("/auth/register",{name:k,email:O,password:F,profile:M,nutritionGoal:V});return localStorage.setItem("token",H.token),localStorage.setItem("user",JSON.stringify(H)),dt.defaults.headers.common.Authorization=`Bearer ${H.token}`,a(H),H},y=async k=>{const{data:O}=await dt.post("/auth/register/doctor",k);return localStorage.setItem("token",O.token),localStorage.setItem("user",JSON.stringify(O)),dt.defaults.headers.common.Authorization=`Bearer ${O.token}`,a(O),O},b=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),delete dt.defaults.headers.common.Authorization,a(null)},E=k=>{a(k),localStorage.setItem("user",JSON.stringify(k))},T=()=>(n==null?void 0:n.role)==="admin",w=()=>(n==null?void 0:n.role)==="doctor",N=()=>(n==null?void 0:n.role)==="patient"||(n==null?void 0:n.role)==="client",D=()=>{var k;return((k=n==null?void 0:n.doctorProfile)==null?void 0:k.approvalStatus)==="approved"},A=()=>{var k;return((k=n==null?void 0:n.subscription)==null?void 0:k.status)==="active"};return l.jsx(RJ.Provider,{value:{user:n,login:p,register:m,registerDoctor:y,logout:b,updateUser:E,loading:o,isAdmin:T,isDoctor:w,isPatient:N,isDoctorApproved:D,isSubscribed:A},children:e})};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var eTe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tTe=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Je=(e,n)=>{const a=Y.forwardRef(({color:o="currentColor",size:d=24,strokeWidth:p=2,absoluteStrokeWidth:m,className:y="",children:b,...E},T)=>Y.createElement("svg",{ref:T,...eTe,width:d,height:d,stroke:o,strokeWidth:m?Number(p)*24/Number(d):p,className:["lucide",`lucide-${tTe(e)}`,y].join(" "),...E},[...n.map(([w,N])=>Y.createElement(w,N)),...Array.isArray(b)?b:[b]]));return a.displayName=`${e}`,a};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=Je("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=Je("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yw=Je("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nc=Je("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oo=Je("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=Je("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nTe=Je("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AJ=Je("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rTe=Je("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iTe=Je("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aTe=Je("Bone",[["path",{d:"M17 10c.7-.7 1.69 0 2.5 0a2.5 2.5 0 1 0 0-5 .5.5 0 0 1-.5-.5 2.5 2.5 0 1 0-5 0c0 .81.7 1.8 0 2.5l-7 7c-.7.7-1.69 0-2.5 0a2.5 2.5 0 0 0 0 5c.28 0 .5.22.5.5a2.5 2.5 0 1 0 5 0c0-.81-.7-1.8 0-2.5Z",key:"w610uw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sTe=Je("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LO=Je("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oTe=Je("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ki=Je("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s2=Je("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=Je("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=Je("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o2=Je("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cTe=Je("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lTe=Je("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dTe=Je("Cigarette",[["path",{d:"M18 12H2v4h16",key:"2rt1hm"}],["path",{d:"M22 12v4",key:"142cbu"}],["path",{d:"M7 12v4",key:"jqww69"}],["path",{d:"M18 8c0-2.5-2-2.5-2-5",key:"1il607"}],["path",{d:"M22 8c0-2.5-2-2.5-2-5",key:"1gah44"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ic=Je("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uTe=Je("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hTe=Je("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pTe=Je("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IJ=Je("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _P=Je("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OJ=Je("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b7=Je("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qw=Je("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bP=Je("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PJ=Je("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xw=Je("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=Je("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vx=Je("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DJ=Je("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mS=Je("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pi=Je("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fTe=Je("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jw=Je("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mTe=Je("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gS=Je("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gTe=Je("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const py=Je("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E7=Je("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EP=Je("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c2=Je("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P_=Je("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xP=Je("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vTe=Je("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x7=Je("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D_=Je("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kJ=Je("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jJ=Je("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l2=Je("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yTe=Je("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vm=Je("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Te=Je("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bTe=Je("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ETe=Je("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d2=Je("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qw=Je("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wc=Je("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xTe=Je("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const STe=Je("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wTe=Je("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LJ=Je("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S7=Je("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uy=Je("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bm=Je("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gm=Je("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TTe=Je("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vS=Je("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MJ=Je("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kh=Je("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zc=Je("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UJ=Je("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FJ=Je("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jh=Je("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SP=Je("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VJ=Je("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=Je("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=Je("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BJ=Je("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=Je("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const om=Je("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=Je("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wP=Je("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hd=Je("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CTe=Je("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NTe=Je("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=Je("Watch",[["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["polyline",{points:"12 10 12 12 13 13",key:"19dquz"}],["path",{d:"m16.13 7.66-.81-4.05a2 2 0 0 0-2-1.61h-2.68a2 2 0 0 0-2 1.61l-.78 4.05",key:"18k57s"}],["path",{d:"m7.88 16.36.8 4a2 2 0 0 0 2 1.61h2.72a2 2 0 0 0 2-1.61l.81-4.05",key:"16ny36"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RTe=Je("Wine",[["path",{d:"M8 22h8",key:"rmew8v"}],["path",{d:"M7 10h10",key:"1101jm"}],["path",{d:"M12 15v7",key:"t2xh3l"}],["path",{d:"M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z",key:"10ffi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GJ=Je("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=Je("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u2=Je("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function ATe(){const[e,n]=Y.useState(""),[a,o]=Y.useState({x:0,y:0}),[d,p]=Y.useState(!1),m=As();Y.useEffect(()=>{const b=()=>{const E=window.getSelection(),T=E.toString().trim();if(T.length>0){const N=E.getRangeAt(0).getBoundingClientRect();n(T),o({x:N.left+N.width/2,y:N.top-10}),p(!0)}else p(!1)};return document.addEventListener("mouseup",b),document.addEventListener("touchend",b),()=>{document.removeEventListener("mouseup",b),document.removeEventListener("touchend",b)}},[]);const y=()=>{m("/ai-chat",{state:{selectedText:e}}),p(!1)};return d?l.jsx("div",{className:"fixed z-50 animate-fade-in",style:{left:`${a.x}px`,top:`${a.y}px`,transform:"translate(-50%, -100%)"},children:l.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow-lg hover:shadow-xl transition-all text-sm font-medium",children:[l.jsx(D_,{className:"w-4 h-4"}),"Ask AI"]})}):null}function ITe(){const e=Ul(),n=As(),{user:a,logout:o}=fa(),[d,p]=Y.useState(!1);Y.useEffect(()=>{const T=()=>{const D=document.querySelectorAll(".fixed.inset-0");let A=!1;D.forEach(O=>{const F=O.textContent;(F.includes("Add Meal")||F.includes("Edit Meal"))&&(A=!0)}),A=A||d;const k=document.querySelector(".mobile-bottom-nav-container");k&&(A?k.classList.add("hidden"):k.classList.remove("hidden"))};T();const w=setTimeout(T,100),N=new MutationObserver(T);return N.observe(document.body,{childList:!0,subtree:!0}),()=>{clearTimeout(w),N.disconnect()}},[d]);const m=[{path:"/dashboard",icon:Jw,label:"Home"},{path:"/ai-chat",icon:D_,label:"AI"},{path:"/nutrition",icon:Lh,label:"Nutrition",isCenter:!0},{path:"/upload",icon:li,label:"Reports"}],y=[{path:"/profile",icon:Gm,label:"Profile"},{path:"/wearables",icon:_l,label:"Wearables",comingSoon:!0},{path:"/diet-plan",icon:Pi,label:"Diet Plan"},{path:"#appointment",icon:ki,label:"Appointment",comingSoon:!0}],b=T=>e.pathname===T,E=()=>{o(),it.success("Logged out successfully"),n("/login"),p(!1)};return l.jsxs(l.Fragment,{children:[d&&l.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>p(!1)}),d&&l.jsxs("div",{className:"fixed bottom-24 right-4 bg-white rounded-2xl shadow-2xl z-50 w-56 overflow-hidden animate-fade-in",children:[l.jsx("div",{className:"p-4 border-b border-[#E5DFD3]",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h3",{className:"font-semibold text-[#2C2416]",children:"Menu"}),l.jsx("button",{onClick:()=>p(!1),className:"text-[#5C4F3D] hover:text-[#2C2416]",children:l.jsx(ha,{className:"w-5 h-5"})})]})}),l.jsxs("div",{className:"space-y-1 p-2",children:[y.map(T=>{const w=T.icon,N=b(T.path);return T.comingSoon?l.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-3 text-[#5C4F3D] bg-[#F5F1EA] rounded-xl opacity-60 cursor-not-allowed text-sm",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(w,{className:"w-5 h-5"}),l.jsx("span",{children:T.label})]}),l.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full font-medium",children:"Soon"})]},T.label):T.path==="#appointment"?l.jsxs("button",{onClick:()=>{it.info("Appointment coming soon"),p(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-[#5C4F3D] hover:bg-[#F5F1EA] rounded-xl transition-colors text-sm",children:[l.jsx(w,{className:"w-5 h-5"}),l.jsx("span",{children:T.label})]},T.label):l.jsxs(un,{to:T.path,onClick:()=>p(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-colors text-sm ${N?"bg-[#F5F1EA] text-[#8B7355] font-medium":"text-[#5C4F3D] hover:bg-[#F5F1EA]"}`,children:[l.jsx(w,{className:"w-5 h-5"}),l.jsx("span",{children:T.label})]},T.path)}),l.jsx("div",{className:"border-t border-[#E5DFD3] my-2"}),l.jsx("div",{className:"px-4 py-2 text-xs text-[#5C4F3D] font-medium",children:a==null?void 0:a.name}),l.jsxs("button",{onClick:E,className:"w-full flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 rounded-xl transition-colors text-sm font-medium",children:[l.jsx(c2,{className:"w-5 h-5"}),l.jsx("span",{children:"Logout"})]})]})]}),l.jsx("nav",{className:"mobile-bottom-nav-container",children:l.jsxs("div",{className:"mobile-bottom-nav",children:[m.map(T=>{const w=T.icon,N=b(T.path);return T.isCenter?l.jsx(un,{to:T.path,className:"nav-center-fab","aria-label":T.label,title:T.label,children:l.jsx(w,{className:"w-7 h-7"})},T.path):l.jsx(un,{to:T.path,className:`nav-item-modern ${N?"active":""}`,"aria-label":T.label,title:T.label,children:l.jsx(w,{className:"w-5 h-5"})},T.path)}),l.jsx("button",{onClick:()=>p(!d),className:`nav-item-modern ${d?"active":""}`,"aria-label":"More options",title:"More options",children:l.jsx(_Te,{className:"w-5 h-5"})})]})})]})}const OTe=[{path:"/dashboard",icon:Jw,label:"Dashboard"},{path:"/ai-chat",icon:D_,label:"AI Assistant"},{path:"/upload",icon:li,label:"My Reports"},{path:"/nutrition",icon:Lh,label:"Nutrition"},{path:"/diet-plan",icon:nc,label:"Diet Plan"},{path:"/profile",icon:Gm,label:"Profile"},{path:"/doctors",icon:ki,label:"Appointments",comingSoon:!0},{path:"/wearables",icon:_l,label:"Devices",comingSoon:!0}],PTe=[{path:"/doctor/dashboard",icon:Jw,label:"Dashboard"},{path:"/doctor/availability",icon:ic,label:"Manage Slots"},{path:"/profile",icon:Gm,label:"Profile"}],DTe=[{path:"/admin",icon:Jw,label:"Dashboard"},{path:"/profile",icon:Gm,label:"Settings"}];function wa({children:e,isAdmin:n,isDoctor:a}){var k,O,F,M,V,H;const{user:o,logout:d,isAdmin:p,isDoctor:m}=fa(),y=Ul(),b=As(),[E,T]=Y.useState(!1),w=()=>{d(),b("/")};let N=OTe,D="/dashboard",A="Patient Portal";return p()||n?(N=DTe,D="/admin",A="Admin Panel"):(m()||a)&&(N=PTe,D="/doctor/dashboard",A=((k=o==null?void 0:o.doctorProfile)==null?void 0:k.specialization)||"Doctor Portal"),l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsx("aside",{className:`fixed inset-y-0 right-0 lg:left-0 lg:right-auto z-50 w-64 bg-white shadow-lg lg:shadow-sm transform transition-transform duration-300 hidden lg:flex lg:flex-col ${E?"translate-x-0":"translate-x-full lg:translate-x-0"}`,style:{borderRight:"2px solid #E5DFD3",borderLeft:"2px solid #E5DFD3"},children:l.jsxs("div",{className:"flex flex-col h-full",children:[l.jsx("div",{className:"p-6 shrink-0",style:{borderBottom:"1px solid #E5DFD3"},children:l.jsxs(un,{to:D,className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(ir,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-bold",style:{color:"#2C2416"},children:"HealthAI"}),l.jsx("p",{className:"text-xs",style:{color:"#5C4F3D"},children:A})]})]})}),l.jsx("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:N.map(({path:B,icon:z,label:q,comingSoon:Q})=>Q?l.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all cursor-not-allowed relative",style:{color:"#5C4F3D",opacity:.6},children:[l.jsx(z,{className:"w-5 h-5"}),l.jsx("span",{children:q}),l.jsx("span",{className:"ml-auto text-xs px-2 py-0.5 rounded-full font-semibold",style:{backgroundColor:"#8B7355",color:"white"},children:"Soon"})]},B):l.jsxs(un,{to:B,onClick:()=>T(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${y.pathname===B?"border":""}`,style:y.pathname===B?{backgroundColor:"#F5F1EA",color:"#8B7355",borderColor:"#E5DFD3"}:{color:"#5C4F3D"},onMouseEnter:ee=>{y.pathname!==B&&(ee.currentTarget.style.backgroundColor="#F5F1EA",ee.currentTarget.style.color="#2C2416")},onMouseLeave:ee=>{y.pathname!==B&&(ee.currentTarget.style.backgroundColor="transparent",ee.currentTarget.style.color="#5C4F3D")},children:[l.jsx(z,{className:"w-5 h-5"}),l.jsx("span",{children:q})]},B))}),l.jsx("div",{className:"p-4 shrink-0",style:{borderTop:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl",style:{backgroundColor:"#F5F1EA"},children:[l.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shrink-0",style:{backgroundColor:"#8B7355"},children:l.jsx("span",{className:"text-white font-bold",children:(F=(O=o==null?void 0:o.name)==null?void 0:O[0])==null?void 0:F.toUpperCase()})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm font-medium truncate",style:{color:"#2C2416"},children:m()?`Dr. ${o==null?void 0:o.name}`:o==null?void 0:o.name}),l.jsx("p",{className:"text-xs truncate",style:{color:"#5C4F3D"},children:o==null?void 0:o.email})]}),l.jsx("button",{onClick:w,className:"p-2 rounded-lg transition-all shrink-0",style:{color:"#5C4F3D"},onMouseEnter:B=>{B.currentTarget.style.color="#dc2626",B.currentTarget.style.backgroundColor="#fee2e2"},onMouseLeave:B=>{B.currentTarget.style.color="#5C4F3D",B.currentTarget.style.backgroundColor="transparent"},title:"Logout",children:l.jsx(c2,{className:"w-5 h-5"})})]})})]})}),E&&l.jsx("div",{className:"fixed inset-0 bg-black/20 z-40 lg:hidden",onClick:()=>T(!1)}),l.jsxs("div",{className:"flex-1 flex flex-col min-h-screen lg:ml-64",children:[l.jsx("header",{className:"sticky top-0 z-30 bg-white/80 backdrop-blur-xl",style:{borderBottom:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"flex items-center justify-between px-3 md:px-4 lg:px-8 py-3 md:py-4",children:[l.jsxs("div",{className:"flex items-center gap-2 md:gap-4 flex-1 md:flex-none",children:[l.jsxs(un,{to:D,className:"lg:hidden flex items-center gap-2 flex-shrink-0",children:[l.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(ir,{className:"w-5 h-5 text-white"})}),l.jsx("span",{className:"text-sm font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsx("h1",{className:"text-base md:text-lg font-semibold hidden sm:block",style:{color:"#2C2416"},children:((M=N.find(B=>B.path===y.pathname))==null?void 0:M.label)||"Dashboard"})]}),l.jsxs("div",{className:"flex items-center gap-2 md:gap-3 overflow-hidden",children:[l.jsx("div",{className:"hidden md:flex items-center",children:l.jsxs("div",{className:"relative",children:[l.jsx(Uy,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"text",placeholder:"Search...",className:"w-48 pl-10 pr-4 py-2 rounded-xl text-sm focus:outline-none",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"}})]})}),l.jsxs("button",{className:"relative p-2 rounded-xl transition-all flex-shrink-0",style:{color:"#5C4F3D"},children:[l.jsx(iTe,{className:"w-5 h-5"}),l.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"})]}),l.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#8B7355"},children:l.jsx("span",{className:"text-white font-bold text-sm",children:(H=(V=o==null?void 0:o.name)==null?void 0:V[0])==null?void 0:H.toUpperCase()})})]})]})}),l.jsx("main",{className:"flex-1 p-3 md:p-4 lg:p-8 main-content-mobile overflow-x-hidden w-full",children:e}),!p()&&!m()&&!n&&!a&&l.jsx(ITe,{})]}),y.pathname!=="/ai-chat"&&l.jsx(ATe,{})]})}function kTe(){const[e,n]=Y.useState(null),[a,o]=Y.useState(!1),[d,p]=Y.useState(!1);Y.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches){p(!0);return}const b=T=>{T.preventDefault(),n(T);const N=window.innerWidth<768?500:3e3,D=setTimeout(()=>{o(!0)},N);return()=>clearTimeout(D)},E=()=>{p(!0),o(!1),n(null),it.success("App installed successfully!")};return window.addEventListener("beforeinstallprompt",b),window.addEventListener("appinstalled",E),()=>{window.removeEventListener("beforeinstallprompt",b),window.removeEventListener("appinstalled",E)}},[]);const m=async()=>{if(!e)return;e.prompt();const{outcome:b}=await e.userChoice;b==="accepted"&&it.success("Installing HealthAI app..."),n(null),o(!1)},y=()=>{o(!1)};return d||!a||!e?null:l.jsx("div",{className:"fixed bottom-24 md:bottom-8 right-4 md:right-8 z-40 animate-slide-up",children:l.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-[#E5DFD3] p-4 md:p-6 max-w-sm",children:[l.jsxs("div",{className:"flex items-start justify-between mb-3",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center flex-shrink-0",children:l.jsx(OJ,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold text-[#2C2416] text-sm md:text-base",children:"Install HealthAI"}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Add to your home screen"})]})]}),l.jsx("button",{onClick:y,className:"text-[#5C4F3D] hover:text-[#2C2416] flex-shrink-0",children:l.jsx(ha,{className:"w-5 h-5"})})]}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D] mb-4",children:"Get quick access to your health data and features offline"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:m,className:"flex-1 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all text-sm md:text-base",children:"Install"}),l.jsx("button",{onClick:y,className:"flex-1 px-4 py-2 bg-[#F5F1EA] text-[#2C2416] rounded-xl font-medium hover:bg-[#E5DFD3] transition-all text-sm md:text-base",children:"Later"})]})]})})}const jTe=()=>{const[e,n]=Y.useState(!1),[a,o]=Y.useState(!1),d=Y.useRef(null);return Y.useEffect(()=>{const p=m=>{d.current&&!d.current.contains(m.target)&&o(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]),l.jsx("header",{className:"fixed top-5 z-50 left-1/2 -translate-x-1/2 w-[calc(100%-200px)] max-w-5xl max-md:w-[calc(100%-40px)]",children:l.jsx("div",{className:"bg-white/50 backdrop-blur-3xl rounded-[28px] border border-white/60 shadow-2xl shadow-black/10",children:l.jsxs("div",{className:"px-6 lg:px-8",children:[l.jsxs("div",{className:"flex items-center justify-between h-16",children:[l.jsxs("nav",{className:"hidden lg:flex items-center gap-6",children:[l.jsx("a",{href:"#features",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Features"}),l.jsx("a",{href:"#showcase",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Showcase"})]}),l.jsx(un,{to:"/",className:"absolute left-1/2 -translate-x-1/2",children:l.jsx("span",{className:"text-xl lg:text-2xl font-serif text-[#2C2416]",children:"HealthAI"})}),l.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[l.jsx("a",{href:"#testimonials",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Testimonials"}),l.jsx("a",{href:"#faq",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"FAQ"}),l.jsxs("div",{className:"relative",ref:d,children:[l.jsx("button",{onClick:()=>o(!a),className:"w-10 h-10 rounded-full bg-[#8B7355] flex items-center justify-center hover:bg-[#6F5A43] transition-colors ml-2",children:l.jsx(Kc,{className:"w-5 h-5 text-white"})}),a&&l.jsxs("div",{className:"absolute right-0 mt-3 w-48 bg-white/90 backdrop-blur-2xl rounded-2xl shadow-xl border border-white/40 py-2 animate-fade-in",children:[l.jsx(un,{to:"/login",className:"block px-6 py-3 text-sm text-[#5C4F3D] hover:bg-[#F5F1EA]/50 transition-colors font-medium",onClick:()=>o(!1),children:"Sign In"}),l.jsx(un,{to:"/register",className:"block px-6 py-3 text-sm text-[#5C4F3D] hover:bg-[#F5F1EA]/50 transition-colors font-medium",onClick:()=>o(!1),children:"Get Started"})]})]})]}),l.jsx("button",{className:"lg:hidden p-2 text-[#5C4F3D] ml-auto",onClick:()=>n(!e),children:e?l.jsx(ha,{className:"w-6 h-6"}):l.jsx(vTe,{className:"w-6 h-6"})})]}),e&&l.jsx("div",{className:"lg:hidden py-6 border-t border-white/20",children:l.jsxs("nav",{className:"flex flex-col gap-4",children:[l.jsx("a",{href:"#features",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Features"}),l.jsx("a",{href:"#showcase",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Showcase"}),l.jsx("a",{href:"#testimonials",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Testimonials"}),l.jsx("a",{href:"#faq",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"FAQ"}),l.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t border-white/20",children:[l.jsx(un,{to:"/login",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Sign In"}),l.jsx(un,{to:"/register",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Get Started"})]})]})})]})})})},LTe=()=>l.jsxs("div",{className:"relative min-h-screen flex items-center overflow-hidden bg-[#F5F1EA]",children:[l.jsxs("div",{className:"absolute inset-0 z-0",children:[l.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover",children:[l.jsx("source",{src:"https://cdn.shopify.com/videos/c/o/v/dcb48db72fdb4641a2af2df51c03aad5.mp4",type:"video/mp4"}),l.jsx("img",{src:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=1920&h=1080&fit=crop",alt:"Healthcare",className:"w-full h-full object-cover"})]}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/70 via-white/30 to-transparent lg:from-white/60 lg:via-white/20 lg:to-transparent"})]}),l.jsx("div",{className:"relative z-10 w-full max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-32",children:l.jsxs("div",{className:"max-w-xl lg:max-w-2xl text-center lg:text-left",children:[l.jsx("p",{className:"text-xs sm:text-sm uppercase tracking-[0.2em] text-black mb-6 font-medium",children:"SMART NUTRITION TRACKING"}),l.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-serif text-black mb-6 leading-[1.1]",children:["Track calories.",l.jsx("br",{}),l.jsx("span",{className:"italic",children:"Naturally"})," healthy."]}),l.jsx("p",{className:"text-base sm:text-lg md:text-xl text-black mb-10 leading-relaxed max-w-lg",children:"Discover nutrition tracking that works with you. AI-powered insights, personalized meal plans, effortless calorie counting."}),l.jsxs(un,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-[#8B7355] text-white rounded-full font-medium hover:bg-[#6F5A43] transition-all group shadow-lg",children:["Start Tracking",l.jsx(ao,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})}),l.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 z-10",children:[l.jsx("span",{className:"text-xs uppercase tracking-wider text-black font-medium",children:"SCROLL"}),l.jsx("div",{className:"w-px h-12 bg-black/30"})]})]}),MTe=()=>{const e=[{icon:ir,title:"Calorie Tracking",description:"Effortless daily tracking"},{icon:Xa,title:"Progress Analytics",description:"Real-time health insights"},{icon:jh,title:"Goal Setting",description:"Personalized targets"},{icon:Pi,title:"Wellness Plans",description:"AI-powered recommendations"}];return l.jsx("section",{id:"features",className:"py-20 bg-[#F5F1EA]",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12",children:e.map((n,a)=>{const o=n.icon;return l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-6",children:l.jsx(o,{className:"w-12 h-12 text-[#8B7355] stroke-[1.5]"})}),l.jsx("h3",{className:"text-lg font-serif text-[#2C2416] mb-2",children:n.title}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:n.description})]},a)})})})})},UTe=()=>l.jsx("section",{className:"bg-[#8B7355] py-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[l.jsxs("div",{className:"relative rounded-3xl overflow-hidden group",children:[l.jsx("img",{src:"https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=800&h=600&fit=crop",alt:"AI-Powered Nutrition",className:"w-full h-full object-cover min-h-[400px]"}),l.jsxs("div",{className:"absolute bottom-8 left-8 right-8 bg-white/95 backdrop-blur-sm rounded-2xl p-6",children:[l.jsx("h3",{className:"text-2xl font-serif text-[#2C2416] mb-2",children:"AI-Powered Nutrition"}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:"Smart meal recognition and instant calorie calculation with advanced AI technology."})]})]}),l.jsxs("div",{className:"flex flex-col gap-8",children:[l.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-[#E5DFD3] p-8",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-2xl font-serif text-[#2C2416] mb-2",children:"Track Everything"}),l.jsx("h4",{className:"text-xl font-serif text-[#2C2416] mb-4",children:"Achieve Anything"}),l.jsxs("ul",{className:"space-y-2 text-sm text-[#5C4F3D]",children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Calorie & Macro Tracking"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Meal Planning & Recipes"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Progress Analytics"]})]})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300&h=400&fit=crop",alt:"Healthy Food",className:"w-48 h-64 object-cover rounded-2xl"})})]})}),l.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-[#E5DFD3] p-8",children:l.jsxs("div",{className:"flex items-center gap-6",children:[l.jsx("div",{className:"flex-shrink-0",children:l.jsx("div",{className:"w-16 h-16 rounded-full bg-white flex items-center justify-center",children:l.jsx(MJ,{className:"w-8 h-8 text-[#8B7355]"})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-xl font-serif text-[#2C2416] mb-2",children:"Mobile App"}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:"Track on-the-go with our iOS & Android app"})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=200&h=200&fit=crop",alt:"Mobile App",className:"w-32 h-32 object-cover rounded-xl"})})]})})]})]})})}),FTe=()=>{const e=[{icon:ir,title:"Smart Tracking",description:"AI-powered meal recognition and logging"},{icon:Xa,title:"Progress Insights",description:"Real-time analytics and trends"},{icon:jh,title:"Goal Achievement",description:"Personalized nutrition targets"},{icon:om,title:"Expert Support",description:"Nutritionist-approved guidance"}];return l.jsx("section",{className:"bg-[#F5F1EA] py-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsxs("div",{className:"grid lg:grid-cols-2 gap-16 items-center",children:[l.jsx("div",{className:"relative",children:l.jsx("div",{className:"rounded-3xl overflow-hidden",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1498837167922-ddd27525d352?w=800&h=1000&fit=crop",alt:"Healthy Nutrition",className:"w-full h-full object-cover"})})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm uppercase tracking-[0.2em] text-[#8B7355] mb-4 font-medium",children:"WHY HEALTHAI"}),l.jsxs("h2",{className:"text-4xl md:text-5xl font-serif text-[#2C2416] mb-6 leading-tight",children:["Nutrition that",l.jsx("br",{}),"works for you."]}),l.jsx("p",{className:"text-lg text-[#5C4F3D] mb-8 leading-relaxed",children:"We believe nutrition tracking should be simple, not stressful. Every feature is designed with your health goals in mind, powered by AI for effortless tracking."}),l.jsx("div",{className:"grid grid-cols-2 gap-6",children:e.map((n,a)=>{const o=n.icon;return l.jsxs("div",{className:"bg-white rounded-2xl p-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-full bg-[#F5F1EA] flex items-center justify-center mb-4",children:l.jsx(o,{className:"w-6 h-6 text-[#8B7355]"})}),l.jsx("h3",{className:"text-base font-serif text-[#2C2416] mb-2",children:n.title}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:n.description})]},a)})})]})]})})})},VTe=()=>{const[e,n]=Y.useState(0),a=Y.useRef(null),o=[{title:"Track Your Health Metrics",description:"Monitor vital signs, lab results, and health trends all in one place with AI-powered insights.",phoneScreen:"dashboard",cards:[{icon:Pi,title:"Heart Rate",value:"72 bpm",color:"rose",position:"left-top"},{icon:ir,title:"Blood Pressure",value:"120/80",color:"blue",position:"left-bottom"},{icon:Xa,title:"Health Score",value:"85/100",color:"emerald",position:"right-top"},{icon:Qw,title:"Vitamin D",value:"45 ng/mL",color:"amber",position:"right-bottom"}]},{title:"Smart Nutrition Tracking",description:"Track your meals and get actionable feedback that helps you build a better relationship with food.",phoneScreen:"nutrition",cards:[{icon:Lh,title:"Today's Meals",value:"3 logged",color:"emerald",position:"left-top"},{icon:ir,title:"Calories",value:"1,850 kcal",color:"orange",position:"left-bottom"},{icon:Xa,title:"Protein",value:"95g",color:"blue",position:"right-top"},{icon:Pi,title:"Macro Balance",value:"Optimal",color:"purple",position:"right-bottom"}]},{title:"AI-Powered Health Insights",description:"Get personalized recommendations based on your medical reports and wearable data.",phoneScreen:"ai-chat",cards:[{icon:D_,title:"AI Assistant",value:"24/7 Available",color:"cyan",position:"left-top"},{icon:Xa,title:"Insights",value:"12 new",color:"indigo",position:"left-bottom"},{icon:ki,title:"Reminders",value:"5 today",color:"pink",position:"right-top"},{icon:Pi,title:"Health Tips",value:"Updated",color:"red",position:"right-bottom"}]},{title:"Sleep & Recovery Tracking",description:"Improve your sleep by understanding patterns, identifying disruptions, and building habits.",phoneScreen:"sleep",cards:[{icon:Vm,title:"Sleep Quality",value:"85%",color:"indigo",position:"left-top"},{icon:ir,title:"Sleep Duration",value:"7h 45m",color:"blue",position:"left-bottom"},{icon:Xa,title:"Deep Sleep",value:"2h 15m",color:"purple",position:"right-top"},{icon:Pi,title:"REM Sleep",value:"1h 30m",color:"pink",position:"right-bottom"}]}];Y.useEffect(()=>{const y=()=>{if(!a.current)return;const b=a.current,{top:E,height:T}=b.getBoundingClientRect(),w=window.innerHeight,N=(w/2-E)/(T-w/2),D=Math.max(0,Math.min(1,N)),A=Math.floor(D*o.length),k=Math.min(A,o.length-1);n(k)};return window.addEventListener("scroll",y),y(),()=>window.removeEventListener("scroll",y)},[o.length]);const d=y=>({"left-top":"left-[1%] sm:left-[3%] md:left-[8%] top-[8%] sm:top-[10%] md:top-[12%]","left-bottom":"left-[1%] sm:left-[5%] md:left-[10%] bottom-[12%] sm:bottom-[15%] md:bottom-[18%]","right-top":"right-[1%] sm:right-[3%] md:right-[8%] top-[14%] sm:top-[16%] md:top-[18%]","right-bottom":"right-[1%] sm:right-[5%] md:right-[10%] bottom-[6%] sm:bottom-[9%] md:bottom-[12%]"})[y]||"left-[10%] top-[20%]",p=(y,b)=>({"left-top":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 translate-y-16 scale-75","left-bottom":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 -translate-y-16 scale-75","right-top":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 translate-y-16 scale-75","right-bottom":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 -translate-y-16 scale-75"})[y],m=y=>({dashboard:"from-blue-500 to-cyan-500",nutrition:"from-emerald-500 to-green-500","ai-chat":"from-purple-500 to-pink-500",sleep:"from-indigo-500 to-blue-500"})[y]||"from-cyan-500 to-blue-500";return l.jsx("div",{id:"showcase",ref:a,className:"relative bg-[#F5F1EA]",style:{height:`${o.length*100}vh`},children:l.jsx("div",{className:"sticky top-0 h-screen flex items-center justify-center overflow-hidden pt-20 sm:pt-24 px-2 sm:px-4",children:l.jsx("div",{className:"relative w-full max-w-7xl mx-auto",children:l.jsxs("div",{className:"relative flex flex-col items-center",children:[l.jsxs("div",{className:"text-center mb-8 sm:mb-12 max-w-2xl px-4 transition-all duration-700 transform relative z-30",children:[l.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-serif text-[#2C2416] mb-3 sm:mb-4 leading-tight",children:o[e].title}),l.jsx("p",{className:"text-[#5C4F3D] text-sm sm:text-base md:text-lg leading-relaxed",children:o[e].description})]}),l.jsx("div",{className:"absolute inset-0 pointer-events-none z-10",children:o[e].cards.map((y,b)=>{const E=y.icon,T={rose:{bg:"bg-rose-50",icon:"text-rose-500",value:"text-rose-600",border:"border-rose-100"},blue:{bg:"bg-blue-50",icon:"text-blue-500",value:"text-blue-600",border:"border-blue-100"},emerald:{bg:"bg-emerald-50",icon:"text-emerald-500",value:"text-emerald-600",border:"border-emerald-100"},amber:{bg:"bg-amber-50",icon:"text-amber-500",value:"text-amber-600",border:"border-amber-100"},orange:{bg:"bg-orange-50",icon:"text-orange-500",value:"text-orange-600",border:"border-orange-100"},purple:{bg:"bg-purple-50",icon:"text-purple-500",value:"text-purple-600",border:"border-purple-100"},cyan:{bg:"bg-cyan-50",icon:"text-cyan-500",value:"text-cyan-600",border:"border-cyan-100"},indigo:{bg:"bg-indigo-50",icon:"text-indigo-500",value:"text-indigo-600",border:"border-indigo-100"},pink:{bg:"bg-pink-50",icon:"text-pink-500",value:"text-pink-600",border:"border-pink-100"},red:{bg:"bg-red-50",icon:"text-red-500",value:"text-red-600",border:"border-red-100"}},w=T[y.color]||T.blue;return l.jsx("div",{className:`absolute ${d(y.position)} ${p(y.position,!0)} 
                      transition-all duration-1000 ease-out`,style:{transitionDelay:`${b*150}ms`},children:l.jsxs("div",{className:`bg-white rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-4 md:p-6 border ${w.border} 
                      hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 w-32 sm:w-40 md:w-48`,children:[l.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-lg sm:rounded-xl ${w.bg} flex items-center justify-center mb-2 sm:mb-3`,children:l.jsx(E,{className:`w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 ${w.icon}`,strokeWidth:2})}),l.jsx("h4",{className:"text-[#2C2416] font-medium text-xs sm:text-sm md:text-base mb-1 leading-tight",children:y.title}),l.jsx("p",{className:`${w.value} font-bold text-base sm:text-lg md:text-xl`,children:y.value})]})},b)})}),l.jsxs("div",{className:"relative transform perspective-1000 z-20",children:[l.jsxs("div",{className:"relative w-[240px] sm:w-[280px] md:w-[320px] lg:w-[340px] h-[480px] sm:h-[560px] md:h-[640px] lg:h-[680px] bg-slate-900 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] p-2 sm:p-3 shadow-2xl",children:[l.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-28 sm:w-32 md:w-36 h-5 sm:h-6 md:h-7 bg-slate-900 rounded-b-2xl sm:rounded-b-3xl z-10"}),l.jsx("div",{className:"relative w-full h-full bg-white rounded-[2rem] sm:rounded-[2.5rem] md:rounded-[3rem] overflow-hidden",children:l.jsxs("div",{className:`absolute inset-0 bg-gradient-to-br ${m(o[e].phoneScreen)} 
                    transition-all duration-1000 ease-in-out`,children:[l.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-5 md:px-6 pt-2 sm:pt-3 text-white text-[10px] sm:text-xs",children:[l.jsx("span",{children:"9:41"}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-3 h-2 sm:w-4 sm:h-3 border border-white rounded-sm"}),l.jsx("div",{className:"w-0.5 h-2 sm:w-1 sm:h-3 bg-white rounded-sm"})]})]}),l.jsxs("div",{className:"px-4 sm:px-5 md:px-6 pt-6 sm:pt-7 md:pt-8",children:[l.jsxs("h3",{className:"text-white text-lg sm:text-xl md:text-2xl font-bold",children:[o[e].phoneScreen==="dashboard"&&"Dashboard",o[e].phoneScreen==="nutrition"&&"Nutrition",o[e].phoneScreen==="ai-chat"&&"AI Assistant",o[e].phoneScreen==="sleep"&&"Sleep"]}),l.jsx("p",{className:"text-white/80 text-[10px] sm:text-xs md:text-sm mt-1",children:new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsx("div",{className:`absolute inset-x-4 sm:inset-x-5 md:inset-x-6 top-24 sm:top-28 md:top-32 bottom-4 sm:bottom-5 md:bottom-6 bg-white/10 backdrop-blur-md rounded-2xl sm:rounded-3xl border border-white/20 p-4 sm:p-5 md:p-6 \r
                      transition-all duration-1000 shadow-inner`,children:l.jsx("div",{className:"space-y-3 sm:space-y-4",children:[1,2,3].map(y=>l.jsx("div",{className:"bg-white/20 rounded-xl sm:rounded-2xl h-14 sm:h-16 md:h-20 animate-pulse shadow-lg",style:{animationDelay:`${y*200}ms`,animationDuration:"2s"}},y))})})]})})]}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-slate-900/10 to-slate-900/30 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] -z-10 blur-2xl sm:blur-3xl transform scale-105"})]})]})})})})},BTe=()=>l.jsx("section",{className:"py-20 md:py-32 bg-white",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"mb-8 rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] flex items-center justify-center",children:[l.jsxs("div",{className:"relative z-10 text-center px-8 py-16",children:[l.jsxs("h2",{className:"text-4xl md:text-5xl lg:text-6xl font-serif text-white mb-6 leading-tight",children:["Access personalized",l.jsx("br",{}),"nutrition tracking"]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 mt-8",children:[l.jsxs(un,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-white text-[#8B7355] rounded-full font-medium hover:bg-[#F5F1EA] transition-all shadow-lg",children:["Get started",l.jsx(ao,{className:"w-5 h-5"})]}),l.jsx("button",{className:"inline-flex items-center gap-2 px-8 py-4 bg-white/20 backdrop-blur-md text-white rounded-full font-medium hover:bg-white/30 transition-all border border-white/30",children:"See if I'm eligible"})]})]}),l.jsx("svg",{className:"absolute bottom-0 left-0 w-full h-32 opacity-20",viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:l.jsx("path",{d:"M0,50 Q300,10 600,50 T1200,50 L1200,120 L0,120 Z",fill:"currentColor",className:"text-[#6F5A43]"})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[l.jsx("div",{className:"rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] p-8 md:p-12",children:l.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 h-full flex flex-col justify-between shadow-2xl",children:[l.jsxs("div",{children:[l.jsxs("h3",{className:"text-3xl md:text-4xl font-serif text-white mb-4 leading-tight",children:["Track your health,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"stay on track"})]}),l.jsx("p",{className:"text-white/90 text-base mb-6",children:"Monitor your daily nutrition intake with AI-powered insights to help you maintain optimal health."}),l.jsxs(un,{to:"/register",className:"inline-flex items-center text-white font-medium hover:gap-3 gap-2 transition-all",children:["Get started ",l.jsx(ao,{className:"w-5 h-5"})]})]}),l.jsx("div",{className:"mt-8 flex items-center justify-center",children:l.jsx("div",{className:"w-32 h-32 rounded-2xl bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/20",children:l.jsx(ir,{className:"w-16 h-16 text-white"})})})]})}),l.jsx("div",{className:"rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] p-8 md:p-12",children:l.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 h-full flex flex-col justify-between shadow-2xl",children:[l.jsxs("div",{children:[l.jsxs("h3",{className:"text-3xl md:text-4xl font-serif text-white mb-4 leading-tight",children:["Eat healthy,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"get strong"})]}),l.jsx("p",{className:"text-white/90 text-base mb-6",children:"Find nutritional, protein-packed meal plans to help you maintain muscle mass and achieve your goals."}),l.jsxs("button",{className:"inline-flex items-center text-white font-medium hover:gap-3 gap-2 transition-all",children:[l.jsx("span",{className:"w-5 h-5 rounded-full border border-white flex items-center justify-center",children:l.jsx("span",{className:"text-xs",children:"i"})}),"Learn more about nutrition"]})]}),l.jsx("div",{className:"mt-8 grid grid-cols-4 gap-2",children:[...Array(8)].map((e,n)=>l.jsx("div",{className:"aspect-square rounded-lg bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/10",children:l.jsx(nc,{className:"w-6 h-6 text-white/60"})},n))})]})})]}),l.jsx("div",{className:"mt-8 rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[400px] p-8 md:p-12",children:l.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 md:p-12 border border-white/20 shadow-2xl",children:l.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[l.jsxs("h3",{className:"text-3xl md:text-5xl font-serif text-white mb-4 leading-tight",children:["It's more than a plan,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"it's personal"})]}),l.jsx("p",{className:"text-white/90 text-base mb-8 max-w-2xl mx-auto",children:"A healthcare provider will review your information, so that they can combine guidance on nutrition, activity, sleep, and more into a plan designed around your body's needs."}),l.jsx(un,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-white text-[#8B7355] rounded-full font-medium hover:bg-[#F5F1EA] transition-all shadow-lg",children:"Get started"})]})})})]})});function GTe(){const[e,n]=Y.useState(0),a=[{stars:5,quote:"HealthAI identified my vitamin D deficiency that my doctor missed. The personalized nutrition plan has completely transformed my energy levels and overall health. I feel like I have a personal health advisor in my pocket.",author:"Sarah Johnson",role:"Marketing Manager",location:"San Francisco",image:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face"},{stars:5,quote:"As a busy professional, I never had time to properly analyze my health reports. HealthAI does it instantly and gives me actionable insights. The doctor recommendations were spot-on and saved me months of searching.",author:"Michael Chen",role:"Software Engineer",location:"Seattle",image:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face"},{stars:5,quote:"The AI analysis caught early signs of metabolic issues that could have become serious. The preventive care recommendations and supplement guidance have been life-changing. This is the future of healthcare.",author:"Emily Rodriguez",role:"Fitness Instructor",location:"Austin",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face"}],o=()=>n(p=>(p+1)%a.length),d=()=>n(p=>(p-1+a.length)%a.length);return l.jsx("section",{id:"testimonials",className:"py-20 md:py-32 bg-[#F5F1EA]",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[l.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#8B7355]"}),l.jsx("span",{className:"text-sm uppercase tracking-wider text-[#5C4F3D] font-medium",children:"Testimonials"})]}),l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-[#2C2416] mb-6",children:"Hear from our users"}),l.jsx("p",{className:"text-lg text-[#5C4F3D]",children:"Join thousands who've transformed their health with AI-powered insights."})]}),l.jsxs("div",{className:"max-w-4xl mx-auto",children:[l.jsxs("div",{className:"relative bg-white/60 backdrop-blur-sm rounded-3xl p-8 md:p-12 shadow-xl border border-[#E5DFD3]",children:[l.jsx(xTe,{className:"absolute top-8 right-8 w-16 h-16 text-[#8B7355]/20"}),l.jsx("div",{className:"flex gap-1 mb-6",children:[...Array(a[e].stars)].map((p,m)=>l.jsx(zc,{className:"w-5 h-5 fill-amber-400 text-amber-400"},m))}),l.jsxs("blockquote",{className:"text-xl md:text-2xl text-[#2C2416] leading-relaxed mb-8 font-serif",children:['"',a[e].quote,'"']}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("img",{src:a[e].image,alt:a[e].author,className:"w-14 h-14 rounded-full object-cover border-2 border-[#E5DFD3]"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-[#2C2416]",children:a[e].author}),l.jsxs("p",{className:"text-sm text-[#5C4F3D]",children:[a[e].role,"  ",a[e].location]})]})]})]}),l.jsxs("div",{className:"flex items-center justify-center gap-4 mt-8",children:[l.jsx("button",{onClick:d,className:"w-12 h-12 rounded-full border border-[#E5DFD3] bg-white/60 hover:bg-white transition-colors flex items-center justify-center",children:l.jsx(oo,{className:"w-5 h-5 text-[#2C2416]"})}),l.jsx("div",{className:"flex gap-2",children:a.map((p,m)=>l.jsx("button",{onClick:()=>n(m),className:`w-2.5 h-2.5 rounded-full transition-colors ${m===e?"bg-[#8B7355]":"bg-[#E5DFD3] hover:bg-[#8B7355]/50"}`},m))}),l.jsx("button",{onClick:o,className:"w-12 h-12 rounded-full border border-[#E5DFD3] bg-white/60 hover:bg-white transition-colors flex items-center justify-center",children:l.jsx(ao,{className:"w-5 h-5 text-[#2C2416]"})})]})]})]})})}function WTe(){const[e,n]=Y.useState(0),a=[{question:"What types of health reports can I upload?",answer:"HealthAI supports all common medical report formats including blood tests, lab results, imaging reports, and general health checkups. You can upload PDFs, images, or even photos of paper reports. Our AI can extract and analyze data from virtually any medical document."},{question:"How accurate is the AI analysis?",answer:"Our AI has been trained on millions of medical records and achieves 98% accuracy in data extraction and analysis. However, our insights are meant to supplement, not replace, professional medical advice. We always recommend consulting with healthcare professionals for serious health concerns."},{question:"Is my health data secure and private?",answer:"Absolutely. We use bank-level encryption to protect your data and are fully HIPAA compliant. Your health information is never shared with third parties without your explicit consent. You have complete control over your data and can delete it at any time."},{question:"Can I connect with real doctors through the platform?",answer:"Yes! Based on your AI analysis, we recommend verified healthcare professionals who specialize in your specific health needs. Our network includes thousands of doctors, specialists, and healthcare providers who understand our AI insights."},{question:"What if I don't have any medical reports?",answer:"No problem! You can start by taking our comprehensive health assessment, or we can help you understand what tests to request from your doctor. We also provide guidance on essential health screenings based on your age, gender, and health goals."},{question:"Can I cancel my subscription anytime?",answer:"Yes, you can cancel your subscription at any time with no penalties or fees. If you cancel mid-cycle, you'll continue to have access to all features until the end of your billing period. We also offer a 30-day money-back guarantee for new subscribers."}];return l.jsx("section",{id:"faq",className:"py-20 md:py-32 bg-white",children:l.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center mb-16",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[l.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#8B7355]"}),l.jsx("span",{className:"text-sm uppercase tracking-wider text-[#5C4F3D] font-medium",children:"FAQ"})]}),l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-[#2C2416] mb-6",children:"Got questions?"}),l.jsx("p",{className:"text-lg text-[#5C4F3D]",children:"We've got answers. If you can't find what you're looking for, chat with our team."})]}),l.jsx("div",{className:"space-y-4",children:a.map((o,d)=>l.jsxs("div",{className:"border border-[#E5DFD3] rounded-xl overflow-hidden bg-white/60 backdrop-blur-sm",children:[l.jsxs("button",{onClick:()=>n(e===d?null:d),className:"w-full flex items-center justify-between p-6 text-left",children:[l.jsx("span",{className:"text-lg font-medium text-[#2C2416] pr-4",children:o.question}),l.jsx(o2,{className:`w-5 h-5 text-[#5C4F3D] shrink-0 transition-transform duration-200 ${e===d?"rotate-180":""}`})]}),l.jsx("div",{className:`overflow-hidden transition-all duration-200 ${e===d?"max-h-96":"max-h-0"}`,children:l.jsx("p",{className:"px-6 pb-6 text-[#5C4F3D] leading-relaxed",children:o.answer})})]},d))})]})})}function $Te(){return l.jsx("section",{className:"py-20 md:py-32 bg-[#8B7355]",children:l.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-white mb-6",children:"Ready to transform your health with AI?"}),l.jsx("p",{className:"text-lg text-white/90 mb-10 max-w-2xl mx-auto",children:"Join 10,000+ people who've made the switch to proactive, AI-powered healthcare. Your future self will thank you."}),l.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[l.jsxs(un,{to:"/register",className:"bg-white text-[#8B7355] hover:bg-[#F5F1EA] rounded-full px-8 py-4 text-base font-medium transition-all inline-flex items-center gap-2 shadow-lg",children:["Start your free analysis",l.jsx(ao,{className:"w-5 h-5"})]}),l.jsx(un,{to:"/login",className:"rounded-full px-8 py-4 text-base font-medium border-2 border-white/40 text-white hover:bg-white/10 bg-transparent transition-all backdrop-blur-sm",children:"Talk to our team"})]}),l.jsx("p",{className:"text-sm text-white/80 mt-6",children:"Free forever plan  No credit card required  Cancel anytime"})]})})}function HTe(){return l.jsx("footer",{className:"bg-[#2C2416] text-white py-16",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8 mb-12",children:[l.jsxs("div",{className:"col-span-2 lg:col-span-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx("div",{className:"w-8 h-8 bg-[#8B7355] rounded-xl flex items-center justify-center",children:l.jsx(ir,{className:"w-5 h-5 text-white"})}),l.jsx("span",{className:"font-serif text-xl",children:"HealthAI"})]}),l.jsx("p",{className:"text-white/60 text-sm mb-4",children:"AI-powered health insights for better living."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Product"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Features"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Pricing"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Mobile App"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"API"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"About"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Blog"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Careers"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Press"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Resources"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Help Center"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Health Guides"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Find a Doctor"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Partner with Us"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Privacy Policy"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Terms of Service"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"HIPAA Compliance"})})]})]})]}),l.jsxs("div",{className:"pt-8 border-t border-white/10 flex flex-col md:flex-row items-center justify-between gap-4",children:[l.jsx("p",{className:"text-sm text-white/60",children:" 2024 HealthAI. All rights reserved."}),l.jsx("p",{className:"text-sm text-white/60",children:"Made with  for better health"})]})]})})}function zTe(){return l.jsxs("div",{className:"min-h-screen bg-[#F5F1EA]",children:[l.jsx(jTe,{}),l.jsx(LTe,{}),l.jsx(MTe,{}),l.jsx(UTe,{}),l.jsx(FTe,{}),l.jsx(BTe,{}),l.jsx(VTe,{}),l.jsx(GTe,{}),l.jsx(WTe,{}),l.jsx($Te,{}),l.jsx(HTe,{})]})}function KTe(){const[e,n]=Y.useState(""),[a,o]=Y.useState(""),[d,p]=Y.useState(!1),[m,y]=Y.useState(!1),{login:b}=fa(),E=As(),T=async w=>{var N,D;w.preventDefault(),y(!0);try{const A=await b(e,a);it.success("Welcome back!"),E(A.role==="admin"?"/admin":A.role==="doctor"?"/doctor/dashboard":"/dashboard")}catch(A){it.error(((D=(N=A.response)==null?void 0:N.data)==null?void 0:D.message)||"Login failed")}finally{y(!1)}};return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center w-full p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(ir,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Welcome to HealthAI"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Your AI-powered health companion for smarter healthcare decisions."})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(ir,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Sign In"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Access your health dashboard"})]}),l.jsxs("form",{onSubmit:T,className:"space-y-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Email Address"}),l.jsxs("div",{className:"relative",children:[l.jsx(P_,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"email",value:e,onChange:w=>n(w.target.value),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"you@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Password"}),l.jsxs("div",{className:"relative",children:[l.jsx(EP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:d?"text":"password",value:a,onChange:w=>o(w.target.value),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0}),l.jsx("button",{type:"button",onClick:()=>p(!d),className:"absolute right-4 top-1/2 -translate-y-1/2",style:{color:"#5C4F3D"},children:d?l.jsx(PJ,{className:"w-5 h-5"}):l.jsx(Xw,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded",style:{borderColor:"#E5DFD3"}}),l.jsx("span",{className:"text-sm",style:{color:"#5C4F3D"},children:"Remember me"})]}),l.jsx("a",{href:"#",className:"text-sm font-medium",style:{color:"#8B7355"},children:"Forgot password?"})]}),l.jsx("button",{type:"submit",disabled:m,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",style:{backgroundColor:"#8B7355"},children:m?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:["Sign In ",l.jsx(ao,{className:"w-5 h-5"})]})})]}),l.jsxs("p",{className:"text-center mt-8",style:{color:"#5C4F3D"},children:["Don't have an account?"," ",l.jsx(un,{to:"/register",className:"font-semibold",style:{color:"#8B7355"},children:"Create one"})]}),l.jsx("div",{className:"mt-6 text-center",children:l.jsx(un,{to:"/register/doctor",className:"text-sm",style:{color:"#5C4F3D"},children:"Register as a Doctor "})})]})})]})}function YTe(){const[e,n]=Y.useState(1),[a,o]=Y.useState(null),[d,p]=Y.useState({name:"",email:"",password:"",confirmPassword:"",age:"",gender:"",height:"",weight:"",bloodGroup:"",dietaryPreference:"non-vegetarian",activityLevel:"sedentary",chronicConditions:[],allergies:[],currentMedications:[],smoker:!1,smokingFrequency:"",alcohol:!1,alcoholFrequency:"",sleepHours:"7",stressLevel:"moderate",waterIntake:"8",nutritionGoal:"general_health",targetWeight:"",weeklyGoal:"0.5"}),[m,y]=Y.useState(!1),[b,E]=Y.useState(!1),[T,w]=Y.useState(""),[N,D]=Y.useState(""),[A,k]=Y.useState(""),{register:O}=fa(),F=As(),M=ee=>{o(ee),ee==="doctor"?F("/register/doctor"):n(2)},V=async ee=>{var oe,ne;if(ee.preventDefault(),d.password!==d.confirmPassword){it.error("Passwords do not match");return}if(!d.age||!d.gender){it.error("Please provide your age and gender");return}E(!0);try{const ue={age:parseInt(d.age),gender:d.gender,height:d.height?parseFloat(d.height):void 0,weight:d.weight?parseFloat(d.weight):void 0,bloodGroup:d.bloodGroup||void 0,dietaryPreference:d.dietaryPreference,activityLevel:d.activityLevel,medicalHistory:{conditions:d.chronicConditions,currentMedications:d.currentMedications},lifestyle:{smoker:d.smoker,smokingFrequency:d.smokingFrequency,alcohol:d.alcohol,alcoholFrequency:d.alcoholFrequency,sleepHours:parseInt(d.sleepHours),stressLevel:d.stressLevel,waterIntake:parseInt(d.waterIntake)},allergies:d.allergies},Se={goal:d.nutritionGoal,targetWeight:d.targetWeight?parseFloat(d.targetWeight):null,weeklyGoal:parseFloat(d.weeklyGoal)};await O(d.name,d.email,d.password,ue,Se),it.success("Account created successfully! Your personalized nutrition plan is ready."),F("/dashboard")}catch(ue){it.error(((ne=(oe=ue.response)==null?void 0:oe.data)==null?void 0:ne.message)||"Registration failed")}finally{E(!1)}},H=()=>{if(e===2){if(!d.name||!d.email||!d.password||!d.age||!d.gender){it.error("Please fill in all required fields");return}if(d.password!==d.confirmPassword){it.error("Passwords do not match");return}}if(e===3&&(!d.height||!d.weight)){it.error("Please provide your height and weight for accurate nutrition calculations");return}n(e+1)},B=()=>n(e-1),z=(ee,oe)=>{p(ne=>({...ne,[ee]:ne[ee].includes(oe)?ne[ee].filter(ue=>ue!==oe):[...ne[ee],oe]}))},q=(ee,oe)=>{oe&&!d[ee].includes(oe)&&p(ne=>({...ne,[ee]:[...ne[ee],oe]}))},Q=(ee,oe)=>{p(ne=>({...ne,[ee]:ne[ee].filter(ue=>ue!==oe)}))};if(e===1)return l.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:"#F5F1EA"},children:l.jsxs("div",{className:"w-full max-w-2xl",children:[l.jsxs("div",{className:"flex items-center justify-center gap-3 mb-8",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(ir,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Join HealthAI"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Choose how you want to use our platform"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("button",{onClick:()=>M("patient"),className:"bg-white rounded-2xl p-8 text-left hover:shadow-lg transition-all group",style:{border:"2px solid #E5DFD3"},children:[l.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mb-4 transition-colors",style:{backgroundColor:"#F5F1EA"},children:l.jsx(Pi,{className:"w-8 h-8 transition-colors",style:{color:"#8B7355"}})}),l.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"#2C2416"},children:"I am a Patient"}),l.jsx("p",{className:"text-sm mb-4",style:{color:"#5C4F3D"},children:"Upload health reports, get AI-powered insights, personalized diet plans, and connect with doctors."}),l.jsxs("ul",{className:"text-sm space-y-2",style:{color:"#5C4F3D"},children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"AI Health Report Analysis"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Personalized Diet Plans"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Video Consultations"]})]}),l.jsxs("div",{className:"mt-6 flex items-center font-medium",style:{color:"#8B7355"},children:["Get Started ",l.jsx(ao,{className:"w-4 h-4 ml-2"})]})]}),l.jsxs("button",{onClick:()=>M("doctor"),className:"bg-white rounded-2xl p-8 text-left hover:shadow-lg transition-all group",style:{border:"2px solid #E5DFD3"},children:[l.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mb-4 transition-colors",style:{backgroundColor:"#F5F1EA"},children:l.jsx(UJ,{className:"w-8 h-8 transition-colors",style:{color:"#8B7355"}})}),l.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"#2C2416"},children:"I am a Doctor"}),l.jsx("p",{className:"text-sm mb-4",style:{color:"#5C4F3D"},children:"Join our platform to provide consultations, manage appointments, and help patients."}),l.jsxs("ul",{className:"text-sm space-y-2",style:{color:"#5C4F3D"},children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Manage Your Schedule"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Video Consultations"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"View Patient Reports"]})]}),l.jsxs("div",{className:"mt-6 flex items-center font-medium",style:{color:"#8B7355"},children:["Apply Now ",l.jsx(ao,{className:"w-4 h-4 ml-2"})]})]})]}),l.jsxs("p",{className:"text-center mt-8",style:{color:"#5C4F3D"},children:["Already have an account?"," ",l.jsx(un,{to:"/login",className:"font-semibold",style:{color:"#8B7355"},children:"Sign in"})]})]})});if(e===2)return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(Pi,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Your Health Journey Starts Here"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Get personalized health insights, diet plans, and supplement recommendations based on your unique profile."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("button",{onClick:()=>n(1),className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(oo,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Basic Information"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 1 of 4 - Let's start with the basics"})]}),l.jsxs("form",{onSubmit:ee=>{ee.preventDefault(),H()},className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Full Name *"}),l.jsxs("div",{className:"relative",children:[l.jsx(Kc,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"text",value:d.name,onChange:ee=>p({...d,name:ee.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"John Doe",required:!0})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Age *"}),l.jsx("input",{type:"number",value:d.age,onChange:ee=>p({...d,age:ee.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"25",min:"1",max:"120",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Gender *"}),l.jsxs("select",{value:d.gender,onChange:ee=>p({...d,gender:ee.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"",children:"Select"}),l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Email Address *"}),l.jsxs("div",{className:"relative",children:[l.jsx(P_,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"email",value:d.email,onChange:ee=>p({...d,email:ee.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"you@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Password *"}),l.jsxs("div",{className:"relative",children:[l.jsx(EP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:m?"text":"password",value:d.password,onChange:ee=>p({...d,password:ee.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0}),l.jsx("button",{type:"button",onClick:()=>y(!m),className:"absolute right-4 top-1/2 -translate-y-1/2",style:{color:"#5C4F3D"},children:m?l.jsx(PJ,{className:"w-5 h-5"}):l.jsx(Xw,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Confirm Password *"}),l.jsxs("div",{className:"relative",children:[l.jsx(EP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"password",value:d.confirmPassword,onChange:ee=>p({...d,confirmPassword:ee.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0})]})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(ao,{className:"w-5 h-5"})]})]}),l.jsxs("p",{className:"text-center mt-6",style:{color:"#5C4F3D"},children:["Already have an account?"," ",l.jsx(un,{to:"/login",className:"font-semibold",style:{color:"#8B7355"},children:"Sign in"})]})]})})]});if(e===3)return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(S7,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Health Profile"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Help us calculate your personalized nutrition goals based on your body metrics."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(oo,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Health Profile"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 2 of 4 - Your body metrics"})]}),l.jsxs("form",{onSubmit:ee=>{ee.preventDefault(),H()},className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Height (cm) *"}),l.jsxs("div",{className:"relative",children:[l.jsx(wTe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"number",value:d.height,onChange:ee=>p({...d,height:ee.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"170",min:"100",max:"250",step:"0.1",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Weight (kg) *"}),l.jsxs("div",{className:"relative",children:[l.jsx(S7,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"number",value:d.weight,onChange:ee=>p({...d,weight:ee.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"70",min:"30",max:"300",step:"0.1",required:!0})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Blood Group"}),l.jsxs("div",{className:"relative",children:[l.jsx(b7,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsxs("select",{value:d.bloodGroup,onChange:ee=>p({...d,bloodGroup:ee.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select (Optional)"}),l.jsx("option",{value:"A+",children:"A+"}),l.jsx("option",{value:"A-",children:"A-"}),l.jsx("option",{value:"B+",children:"B+"}),l.jsx("option",{value:"B-",children:"B-"}),l.jsx("option",{value:"AB+",children:"AB+"}),l.jsx("option",{value:"AB-",children:"AB-"}),l.jsx("option",{value:"O+",children:"O+"}),l.jsx("option",{value:"O-",children:"O-"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Dietary Preference *"}),l.jsxs("select",{value:d.dietaryPreference,onChange:ee=>p({...d,dietaryPreference:ee.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]}),l.jsx("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:"This helps us recommend suitable diet plans"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Activity Level *"}),l.jsxs("select",{value:d.activityLevel,onChange:ee=>p({...d,activityLevel:ee.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),l.jsx("option",{value:"lightly_active",children:"Lightly Active (1-3 days/week)"}),l.jsx("option",{value:"moderately_active",children:"Moderately Active (3-5 days/week)"}),l.jsx("option",{value:"very_active",children:"Very Active (6-7 days/week)"}),l.jsx("option",{value:"extremely_active",children:"Extremely Active (Athlete)"})]}),l.jsx("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:"Used to calculate your daily calorie needs"})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(ao,{className:"w-5 h-5"})]})]})]})})]});if(e===4){const ee=["Diabetes","Hypertension","Thyroid","Asthma","Heart Disease","Arthritis"],oe=["Peanuts","Dairy","Gluten","Shellfish","Eggs","Soy"];return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(Pi,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Lifestyle & Health History"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Help us understand your lifestyle and medical background for better recommendations."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:l.jsxs("div",{className:"w-full max-w-md py-8",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(oo,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Lifestyle & Medical History"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 3 of 4 - Optional but recommended"})]}),l.jsxs("form",{onSubmit:ne=>{ne.preventDefault(),H()},className:"space-y-6",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4",style:{border:"1px solid #E5DFD3"},children:[l.jsx("h3",{className:"font-semibold mb-4",style:{color:"#2C2416"},children:"Lifestyle Habits"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(dTe,{className:"w-4 h-4"}),"Do you smoke?"]}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:!d.smoker,onChange:()=>p({...d,smoker:!1,smokingFrequency:""}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"No"})]}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:d.smoker,onChange:()=>p({...d,smoker:!0}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"Yes"})]})]}),d.smoker&&l.jsxs("select",{value:d.smokingFrequency,onChange:ne=>p({...d,smokingFrequency:ne.target.value}),className:"mt-2 w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select frequency"}),l.jsx("option",{value:"occasional",children:"Occasional (1-2 times/week)"}),l.jsx("option",{value:"regular",children:"Regular (3-6 times/week)"}),l.jsx("option",{value:"heavy",children:"Heavy (Daily)"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(RTe,{className:"w-4 h-4"}),"Do you consume alcohol?"]}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:!d.alcohol,onChange:()=>p({...d,alcohol:!1,alcoholFrequency:""}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"No"})]}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:d.alcohol,onChange:()=>p({...d,alcohol:!0}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"Yes"})]})]}),d.alcohol&&l.jsxs("select",{value:d.alcoholFrequency,onChange:ne=>p({...d,alcoholFrequency:ne.target.value}),className:"mt-2 w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select frequency"}),l.jsx("option",{value:"occasional",children:"Occasional (1-2 drinks/week)"}),l.jsx("option",{value:"moderate",children:"Moderate (3-7 drinks/week)"}),l.jsx("option",{value:"heavy",children:"Heavy (8+ drinks/week)"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(Vm,{className:"w-4 h-4"}),"Average sleep hours per night: ",d.sleepHours,"h"]}),l.jsx("input",{type:"range",min:"4",max:"12",value:d.sleepHours,onChange:ne=>p({...d,sleepHours:ne.target.value}),className:"w-full"}),l.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"#5C4F3D"},children:[l.jsx("span",{children:"4h"}),l.jsx("span",{children:"12h"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(b7,{className:"w-4 h-4"}),"Water intake (glasses/day): ",d.waterIntake]}),l.jsx("input",{type:"range",min:"1",max:"15",value:d.waterIntake,onChange:ne=>p({...d,waterIntake:ne.target.value}),className:"w-full"}),l.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"#5C4F3D"},children:[l.jsx("span",{children:"1"}),l.jsx("span",{children:"15"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Stress Level"}),l.jsxs("select",{value:d.stressLevel,onChange:ne=>p({...d,stressLevel:ne.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"low",children:"Low"}),l.jsx("option",{value:"moderate",children:"Moderate"}),l.jsx("option",{value:"high",children:"High"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4",style:{border:"1px solid #E5DFD3"},children:[l.jsx("h3",{className:"font-semibold mb-4",style:{color:"#2C2416"},children:"Medical History (Optional)"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Chronic Conditions"}),l.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:ee.map(ne=>l.jsx("button",{type:"button",onClick:()=>z("chronicConditions",ne),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${d.chronicConditions.includes(ne)?"text-white":""}`,style:{backgroundColor:d.chronicConditions.includes(ne)?"#8B7355":"#F5F1EA",color:d.chronicConditions.includes(ne)?"white":"#5C4F3D"},children:ne},ne))}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:T,onChange:ne=>w(ne.target.value),placeholder:"Add custom condition",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:ne=>{ne.key==="Enter"&&(ne.preventDefault(),q("chronicConditions",T),w(""))}}),l.jsx("button",{type:"button",onClick:()=>{q("chronicConditions",T),w("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Wc,{className:"w-4 h-4"})})]}),d.chronicConditions.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.chronicConditions.map(ne=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[ne,l.jsx("button",{type:"button",onClick:()=>Q("chronicConditions",ne),children:l.jsx(ha,{className:"w-3 h-3"})})]},ne))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Allergies"}),l.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:oe.map(ne=>l.jsx("button",{type:"button",onClick:()=>z("allergies",ne),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors",style:{backgroundColor:d.allergies.includes(ne)?"#8B7355":"#F5F1EA",color:d.allergies.includes(ne)?"white":"#5C4F3D"},children:ne},ne))}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:A,onChange:ne=>k(ne.target.value),placeholder:"Add custom allergy",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:ne=>{ne.key==="Enter"&&(ne.preventDefault(),q("allergies",A),k(""))}}),l.jsx("button",{type:"button",onClick:()=>{q("allergies",A),k("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Wc,{className:"w-4 h-4"})})]}),d.allergies.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.allergies.map(ne=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[ne,l.jsx("button",{type:"button",onClick:()=>Q("allergies",ne),children:l.jsx(ha,{className:"w-3 h-3"})})]},ne))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Current Medications"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:N,onChange:ne=>D(ne.target.value),placeholder:"Add medication",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:ne=>{ne.key==="Enter"&&(ne.preventDefault(),q("currentMedications",N),D(""))}}),l.jsx("button",{type:"button",onClick:()=>{q("currentMedications",N),D("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Wc,{className:"w-4 h-4"})})]}),d.currentMedications.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.currentMedications.map(ne=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[ne,l.jsx("button",{type:"button",onClick:()=>Q("currentMedications",ne),children:l.jsx(ha,{className:"w-3 h-3"})})]},ne))})]})]})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(ao,{className:"w-5 h-5"})]})]})]})})]})}if(e===5){const oe=(()=>{if(!d.targetWeight||!d.weight)return null;const ne=Math.abs(parseFloat(d.targetWeight)-parseFloat(d.weight));return Math.ceil(ne/parseFloat(d.weeklyGoal))})();return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(jh,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Set Your Goals"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"We'll calculate your personalized nutrition plan based on your goals."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:l.jsxs("div",{className:"w-full max-w-md py-8",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(oo,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Your Nutrition Goals"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 4 of 4 - Almost done!"})]}),l.jsxs("form",{onSubmit:V,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-3",style:{color:"#2C2416"},children:"What's your primary goal?"}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"weight_loss"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="weight_loss"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="weight_loss"?"#F5F1EA":"white"},children:[l.jsx(VJ,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="weight_loss"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Weight Loss"})]}),l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"weight_gain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="weight_gain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="weight_gain"?"#F5F1EA":"white"},children:[l.jsx(Xa,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="weight_gain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Weight Gain"})]}),l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"muscle_gain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="muscle_gain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="muscle_gain"?"#F5F1EA":"white"},children:[l.jsx(bP,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="muscle_gain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Muscle Gain"})]}),l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"maintain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="maintain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="maintain"?"#F5F1EA":"white"},children:[l.jsx(l2,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="maintain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Maintain"})]}),l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"general_health"}),className:"p-4 rounded-xl border-2 transition-all col-span-2",style:{borderColor:d.nutritionGoal==="general_health"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="general_health"?"#F5F1EA":"white"},children:[l.jsx(Pi,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="general_health"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"General Health"})]})]})]}),(d.nutritionGoal==="weight_loss"||d.nutritionGoal==="weight_gain")&&l.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-4",style:{border:"1px solid #E5DFD3"},children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Target Weight (kg)"}),l.jsx("input",{type:"number",value:d.targetWeight,onChange:ne=>p({...d,targetWeight:ne.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:d.weight,min:"30",max:"300",step:"0.1"}),l.jsxs("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:["Current: ",d.weight," kg"]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Weekly Goal"}),l.jsxs("select",{value:d.weeklyGoal,onChange:ne=>p({...d,weeklyGoal:ne.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"0.25",children:"0.25 kg/week (Slow & Steady)"}),l.jsx("option",{value:"0.5",children:"0.5 kg/week (Recommended)"}),l.jsx("option",{value:"1",children:"1 kg/week (Aggressive)"})]})]}),oe&&l.jsx("div",{className:"rounded-lg p-3",style:{backgroundColor:"#F5F1EA"},children:l.jsxs("p",{className:"text-sm",style:{color:"#8B7355"},children:[l.jsx("strong",{children:"Estimated time:"})," ",oe," weeks (",Math.ceil(oe/4)," months)"]})})]}),l.jsx("div",{className:"rounded-xl p-4",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3"},children:l.jsxs("p",{className:"text-sm",style:{color:"#5C4F3D"},children:[l.jsx("strong",{style:{color:"#2C2416"},children:"What happens next?"})," We'll calculate your personalized daily calorie and macro goals based on your profile and goals. You can adjust these anytime from your nutrition dashboard."]})}),l.jsx("button",{type:"submit",disabled:b,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",style:{backgroundColor:"#8B7355"},children:b?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:["Create Account & Calculate Goals ",l.jsx(ao,{className:"w-5 h-5"})]})})]})]})})]})}return null}const qTe=["General Physician","Cardiologist","Dermatologist","Endocrinologist","Gastroenterologist","Neurologist","Nutritionist","Oncologist","Orthopedic","Pediatrician","Psychiatrist","Pulmonologist"],w7=[{id:"license",name:"Medical License",description:"Valid medical license certificate"},{id:"degree",name:"Medical Degree",description:"MBBS/MD or equivalent degree certificate"},{id:"id_proof",name:"ID Proof",description:"Government issued ID (Aadhar/Passport)"}];function XTe(){const{registerDoctor:e}=fa(),n=As(),[a,o]=Y.useState(!1),[d,p]=Y.useState(1),[m,y]=Y.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",specialization:"",qualifications:"",experience:"",hospital:"",licenseNumber:"",consultationFee:"",bio:""}),[b,E]=Y.useState({}),T=A=>{y({...m,[A.target.name]:A.target.value})},w=(A,k)=>{k&&E(O=>({...O,[A]:{file:k,name:k.name,size:(k.size/1024).toFixed(1)+" KB"}}))},N=A=>{E(k=>{const O={...k};return delete O[A],O})},D=async A=>{var O,F;if(A.preventDefault(),m.password!==m.confirmPassword){it.error("Passwords do not match");return}const k=w7.filter(M=>!b[M.id]);if(k.length>0){it.error(`Please upload: ${k.map(M=>M.name).join(", ")}`);return}o(!0);try{const M=Object.entries(b).map(([V,H])=>({name:H.name,type:V,url:`pending_upload_${V}`}));await e({...m,qualifications:m.qualifications.split(",").map(V=>V.trim()).filter(Boolean),experience:parseInt(m.experience),consultationFee:parseInt(m.consultationFee)||500,documents:M}),it.success("Registration successful! Your profile is pending approval."),n("/doctor/dashboard")}catch(M){it.error(((F=(O=M.response)==null?void 0:O.data)==null?void 0:F.message)||"Registration failed")}finally{o(!1)}};return l.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:l.jsxs("div",{className:"w-full max-w-2xl",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsxs(un,{to:"/",className:"inline-flex items-center gap-2 mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center",children:l.jsx(ir,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold text-slate-800",children:"HealthAI"})]}),l.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Doctor Registration"}),l.jsx("p",{className:"text-slate-500",children:"Join our platform and connect with patients"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 shadow-sm",children:[l.jsx("div",{className:"flex items-center justify-center gap-4 mb-8",children:[1,2,3].map(A=>l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold ${d>=A?"bg-cyan-500 text-white":"bg-slate-200 text-slate-400"}`,children:A}),l.jsx("span",{className:`text-sm hidden sm:block ${d>=A?"text-cyan-600 font-medium":"text-slate-400"}`,children:A===1?"Account":A===2?"Professional":"Documents"}),A<3&&l.jsx("div",{className:`w-8 h-1 rounded ${d>A?"bg-cyan-500":"bg-slate-200"}`})]},A))}),l.jsxs("form",{onSubmit:D,children:[d===1&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",name:"name",value:m.name,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"Dr. John Smith",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",name:"email",value:m.email,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"doctor@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone"}),l.jsx("input",{type:"tel",name:"phone",value:m.phone,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"+91 98765 43210"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),l.jsx("input",{type:"password",name:"password",value:m.password,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0,minLength:6})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm Password"}),l.jsx("input",{type:"password",name:"confirmPassword",value:m.confirmPassword,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0})]})]}),l.jsx("button",{type:"button",onClick:()=>p(2),className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all mt-4",children:"Continue "})]}),d===2&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Specialization"}),l.jsxs("select",{name:"specialization",value:m.specialization,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:outline-none",required:!0,children:[l.jsx("option",{value:"",children:"Select specialization"}),qTe.map(A=>l.jsx("option",{value:A,children:A},A))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Experience (years)"}),l.jsx("input",{type:"number",name:"experience",value:m.experience,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"5",required:!0,min:0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Medical License Number"}),l.jsx("input",{type:"text",name:"licenseNumber",value:m.licenseNumber,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MCI-12345",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Qualifications (comma separated)"}),l.jsx("input",{type:"text",name:"qualifications",value:m.qualifications,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MBBS, MD, FRCP"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Hospital/Clinic"}),l.jsx("input",{type:"text",name:"hospital",value:m.hospital,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"City Hospital"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consultation Fee ()"}),l.jsx("input",{type:"number",name:"consultationFee",value:m.consultationFee,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"500",min:0})]})]}),l.jsxs("div",{className:"flex gap-3 mt-4",children:[l.jsxs("button",{type:"button",onClick:()=>p(1),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[l.jsx(oo,{className:"w-4 h-4"})," Back"]}),l.jsx("button",{type:"button",onClick:()=>p(3),className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:"Continue "})]})]}),d===3&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:l.jsxs("p",{className:"text-sm text-amber-800",children:[l.jsx("strong",{children:"Important:"})," Please upload clear copies of the following documents. These will be reviewed by our admin team before your profile is approved."]})}),w7.map(A=>l.jsxs("div",{className:"border border-slate-200 rounded-xl p-4",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{children:[l.jsxs("h4",{className:"font-medium text-slate-800",children:[A.name," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("p",{className:"text-sm text-slate-500",children:A.description})]}),b[A.id]?l.jsx(ua,{className:"w-5 h-5 text-green-500"}):null]}),b[A.id]?l.jsxs("div",{className:"mt-3 flex items-center justify-between bg-slate-50 rounded-lg p-3",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(li,{className:"w-5 h-5 text-cyan-500"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-slate-700",children:b[A.id].name}),l.jsx("p",{className:"text-xs text-slate-500",children:b[A.id].size})]})]}),l.jsx("button",{type:"button",onClick:()=>N(A.id),className:"p-1 text-slate-400 hover:text-red-500",children:l.jsx(ha,{className:"w-4 h-4"})})]}):l.jsxs("label",{className:"mt-3 flex items-center justify-center gap-2 p-4 border-2 border-dashed border-slate-200 rounded-lg cursor-pointer hover:border-cyan-500 hover:bg-cyan-50 transition-all",children:[l.jsx(co,{className:"w-5 h-5 text-slate-400"}),l.jsx("span",{className:"text-sm text-slate-500",children:"Click to upload"}),l.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:k=>w(A.id,k.target.files[0])})]})]},A.id)),l.jsxs("div",{className:"flex gap-3 mt-6",children:[l.jsxs("button",{type:"button",onClick:()=>p(2),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[l.jsx(oo,{className:"w-4 h-4"})," Back"]}),l.jsx("button",{type:"submit",disabled:a,className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:a?"Submitting...":"Submit Application"})]})]})]}),l.jsxs("p",{className:"text-center text-slate-500 mt-6",children:["Already have an account? ",l.jsx(un,{to:"/login",className:"text-cyan-600 hover:text-cyan-700 font-medium",children:"Sign in"})]})]}),l.jsxs("p",{className:"text-center text-sm text-slate-500 mt-6 flex items-center justify-center gap-2",children:[l.jsx(UJ,{className:"w-4 h-4"}),"Your profile will be reviewed by our admin team before being listed."]})]})})}const Vv="healthai_cache_",JTe=5*60*1e3,Lc={set(e,n,a=JTe){try{const o={value:n,expiry:Date.now()+a};localStorage.setItem(Vv+e,JSON.stringify(o))}catch(o){console.error("Cache set error:",o)}},get(e){try{const n=localStorage.getItem(Vv+e);if(!n)return null;const a=JSON.parse(n);return Date.now()>a.expiry?(this.delete(e),null):a.value}catch(n){return console.error("Cache get error:",n),null}},delete(e){try{localStorage.removeItem(Vv+e)}catch(n){console.error("Cache delete error:",n)}},clear(){try{Object.keys(localStorage).forEach(n=>{n.startsWith(Vv)&&localStorage.removeItem(n)})}catch(e){console.error("Cache clear error:",e)}},cleanup(){try{Object.keys(localStorage).forEach(n=>{if(n.startsWith(Vv)){const a=localStorage.getItem(n);if(a){const o=JSON.parse(a);Date.now()>o.expiry&&localStorage.removeItem(n)}}})}catch(e){console.error("Cache cleanup error:",e)}}};Lc.cleanup();setInterval(()=>Lc.cleanup(),5*60*1e3);const WJ=Y.createContext(),QTe=()=>{const e=Y.useContext(WJ);if(!e)throw new Error("useData must be used within DataProvider");return e},ZTe=({children:e})=>{const[n,a]=Y.useState(null),[o,d]=Y.useState(null),[p,m]=Y.useState(null),[y,b]=Y.useState({dashboard:!1,wearable:!1,nutrition:!1}),E=Y.useCallback(async(A=!1)=>{if(!A){const k=Lc.get("dashboard");if(k)return a(k),k}b(k=>({...k,dashboard:!0}));try{const O=(await Th.getDashboard()).data;return a(O),Lc.set("dashboard",O,3*60*1e3),O}catch(k){throw console.error("Failed to fetch dashboard:",k),k}finally{b(k=>({...k,dashboard:!1}))}},[]),T=Y.useCallback(async(A=!1)=>{if(!A){const k=Lc.get("wearable");if(k)return d(k),k}b(k=>({...k,wearable:!0}));try{const O=(await Sf.getDashboard()).data;return d(O),Lc.set("wearable",O,2*60*1e3),O}catch(k){console.error("Failed to fetch wearable:",k);const O={connected:!1};return d(O),O}finally{b(k=>({...k,wearable:!1}))}},[]),w=Y.useCallback(async(A,k=!1)=>{var F;const O=`nutrition_${A}`;if(!k){const M=Lc.get(O);if(M)return m(M),M}b(M=>({...M,nutrition:!0}));try{const V=((F=(await Qwe.getDailySummary(A)).data)==null?void 0:F.summary)||null;return m(V),V&&Lc.set(O,V,5*60*1e3),V}catch(M){return console.error("Failed to fetch nutrition:",M),m(null),null}finally{b(M=>({...M,nutrition:!1}))}},[]),N=Y.useCallback((A=[])=>{A.length===0?(Lc.clear(),a(null),d(null),m(null)):A.forEach(k=>{Lc.delete(k),k==="dashboard"&&a(null),k==="wearable"&&d(null),k.startsWith("nutrition_")&&m(null)})},[]),D={dashboardData:n,wearableData:o,nutritionData:p,loading:y,fetchDashboard:E,fetchWearable:T,fetchNutrition:w,invalidateCache:N};return l.jsx(WJ.Provider,{value:D,children:e})};function $J(e){var n,a,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(n=0;n<d;n++)e[n]&&(a=$J(e[n]))&&(o&&(o+=" "),o+=a)}else for(a in e)e[a]&&(o&&(o+=" "),o+=a);return o}function On(){for(var e,n,a=0,o="",d=arguments.length;a<d;a++)(e=arguments[a])&&(n=$J(e))&&(o&&(o+=" "),o+=n);return o}var eCe=Array.isArray,rs=eCe,tCe=typeof Id=="object"&&Id&&Id.Object===Object&&Id,HJ=tCe,nCe=HJ,rCe=typeof self=="object"&&self&&self.Object===Object&&self,iCe=nCe||rCe||Function("return this")(),Xc=iCe,aCe=Xc,sCe=aCe.Symbol,k_=sCe,T7=k_,zJ=Object.prototype,oCe=zJ.hasOwnProperty,cCe=zJ.toString,Bv=T7?T7.toStringTag:void 0;function lCe(e){var n=oCe.call(e,Bv),a=e[Bv];try{e[Bv]=void 0;var o=!0}catch{}var d=cCe.call(e);return o&&(n?e[Bv]=a:delete e[Bv]),d}var dCe=lCe,uCe=Object.prototype,hCe=uCe.toString;function pCe(e){return hCe.call(e)}var fCe=pCe,C7=k_,mCe=dCe,gCe=fCe,vCe="[object Null]",yCe="[object Undefined]",N7=C7?C7.toStringTag:void 0;function _Ce(e){return e==null?e===void 0?yCe:vCe:N7&&N7 in Object(e)?mCe(e):gCe(e)}var Fl=_Ce;function bCe(e){return e!=null&&typeof e=="object"}var Vl=bCe,ECe=Fl,xCe=Vl,SCe="[object Symbol]";function wCe(e){return typeof e=="symbol"||xCe(e)&&ECe(e)==SCe}var Wm=wCe,TCe=rs,CCe=Wm,NCe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,RCe=/^\w*$/;function ACe(e,n){if(TCe(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||CCe(e)?!0:RCe.test(e)||!NCe.test(e)||n!=null&&e in Object(n)}var h2=ACe;function ICe(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}var nu=ICe;const $m=ar(nu);var OCe=Fl,PCe=nu,DCe="[object AsyncFunction]",kCe="[object Function]",jCe="[object GeneratorFunction]",LCe="[object Proxy]";function MCe(e){if(!PCe(e))return!1;var n=OCe(e);return n==kCe||n==jCe||n==DCe||n==LCe}var p2=MCe;const hn=ar(p2);var UCe=Xc,FCe=UCe["__core-js_shared__"],VCe=FCe,MO=VCe,R7=function(){var e=/[^.]+$/.exec(MO&&MO.keys&&MO.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function BCe(e){return!!R7&&R7 in e}var GCe=BCe,WCe=Function.prototype,$Ce=WCe.toString;function HCe(e){if(e!=null){try{return $Ce.call(e)}catch{}try{return e+""}catch{}}return""}var KJ=HCe,zCe=p2,KCe=GCe,YCe=nu,qCe=KJ,XCe=/[\\^$.*+?()[\]{}|]/g,JCe=/^\[object .+?Constructor\]$/,QCe=Function.prototype,ZCe=Object.prototype,eNe=QCe.toString,tNe=ZCe.hasOwnProperty,nNe=RegExp("^"+eNe.call(tNe).replace(XCe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function rNe(e){if(!YCe(e)||KCe(e))return!1;var n=zCe(e)?nNe:JCe;return n.test(qCe(e))}var iNe=rNe;function aNe(e,n){return e==null?void 0:e[n]}var sNe=aNe,oNe=iNe,cNe=sNe;function lNe(e,n){var a=cNe(e,n);return oNe(a)?a:void 0}var $h=lNe,dNe=$h,uNe=dNe(Object,"create"),Zw=uNe,A7=Zw;function hNe(){this.__data__=A7?A7(null):{},this.size=0}var pNe=hNe;function fNe(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}var mNe=fNe,gNe=Zw,vNe="__lodash_hash_undefined__",yNe=Object.prototype,_Ne=yNe.hasOwnProperty;function bNe(e){var n=this.__data__;if(gNe){var a=n[e];return a===vNe?void 0:a}return _Ne.call(n,e)?n[e]:void 0}var ENe=bNe,xNe=Zw,SNe=Object.prototype,wNe=SNe.hasOwnProperty;function TNe(e){var n=this.__data__;return xNe?n[e]!==void 0:wNe.call(n,e)}var CNe=TNe,NNe=Zw,RNe="__lodash_hash_undefined__";function ANe(e,n){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=NNe&&n===void 0?RNe:n,this}var INe=ANe,ONe=pNe,PNe=mNe,DNe=ENe,kNe=CNe,jNe=INe;function Hm(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Hm.prototype.clear=ONe;Hm.prototype.delete=PNe;Hm.prototype.get=DNe;Hm.prototype.has=kNe;Hm.prototype.set=jNe;var LNe=Hm;function MNe(){this.__data__=[],this.size=0}var UNe=MNe;function FNe(e,n){return e===n||e!==e&&n!==n}var f2=FNe,VNe=f2;function BNe(e,n){for(var a=e.length;a--;)if(VNe(e[a][0],n))return a;return-1}var eT=BNe,GNe=eT,WNe=Array.prototype,$Ne=WNe.splice;function HNe(e){var n=this.__data__,a=GNe(n,e);if(a<0)return!1;var o=n.length-1;return a==o?n.pop():$Ne.call(n,a,1),--this.size,!0}var zNe=HNe,KNe=eT;function YNe(e){var n=this.__data__,a=KNe(n,e);return a<0?void 0:n[a][1]}var qNe=YNe,XNe=eT;function JNe(e){return XNe(this.__data__,e)>-1}var QNe=JNe,ZNe=eT;function eRe(e,n){var a=this.__data__,o=ZNe(a,e);return o<0?(++this.size,a.push([e,n])):a[o][1]=n,this}var tRe=eRe,nRe=UNe,rRe=zNe,iRe=qNe,aRe=QNe,sRe=tRe;function zm(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}zm.prototype.clear=nRe;zm.prototype.delete=rRe;zm.prototype.get=iRe;zm.prototype.has=aRe;zm.prototype.set=sRe;var tT=zm,oRe=$h,cRe=Xc,lRe=oRe(cRe,"Map"),m2=lRe,I7=LNe,dRe=tT,uRe=m2;function hRe(){this.size=0,this.__data__={hash:new I7,map:new(uRe||dRe),string:new I7}}var pRe=hRe;function fRe(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}var mRe=fRe,gRe=mRe;function vRe(e,n){var a=e.__data__;return gRe(n)?a[typeof n=="string"?"string":"hash"]:a.map}var nT=vRe,yRe=nT;function _Re(e){var n=yRe(this,e).delete(e);return this.size-=n?1:0,n}var bRe=_Re,ERe=nT;function xRe(e){return ERe(this,e).get(e)}var SRe=xRe,wRe=nT;function TRe(e){return wRe(this,e).has(e)}var CRe=TRe,NRe=nT;function RRe(e,n){var a=NRe(this,e),o=a.size;return a.set(e,n),this.size+=a.size==o?0:1,this}var ARe=RRe,IRe=pRe,ORe=bRe,PRe=SRe,DRe=CRe,kRe=ARe;function Km(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Km.prototype.clear=IRe;Km.prototype.delete=ORe;Km.prototype.get=PRe;Km.prototype.has=DRe;Km.prototype.set=kRe;var g2=Km,YJ=g2,jRe="Expected a function";function v2(e,n){if(typeof e!="function"||n!=null&&typeof n!="function")throw new TypeError(jRe);var a=function(){var o=arguments,d=n?n.apply(this,o):o[0],p=a.cache;if(p.has(d))return p.get(d);var m=e.apply(this,o);return a.cache=p.set(d,m)||p,m};return a.cache=new(v2.Cache||YJ),a}v2.Cache=YJ;var qJ=v2;const LRe=ar(qJ);var MRe=qJ,URe=500;function FRe(e){var n=MRe(e,function(o){return a.size===URe&&a.clear(),o}),a=n.cache;return n}var VRe=FRe,BRe=VRe,GRe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,WRe=/\\(\\)?/g,$Re=BRe(function(e){var n=[];return e.charCodeAt(0)===46&&n.push(""),e.replace(GRe,function(a,o,d,p){n.push(d?p.replace(WRe,"$1"):o||a)}),n}),HRe=$Re;function zRe(e,n){for(var a=-1,o=e==null?0:e.length,d=Array(o);++a<o;)d[a]=n(e[a],a,e);return d}var y2=zRe,O7=k_,KRe=y2,YRe=rs,qRe=Wm,P7=O7?O7.prototype:void 0,D7=P7?P7.toString:void 0;function XJ(e){if(typeof e=="string")return e;if(YRe(e))return KRe(e,XJ)+"";if(qRe(e))return D7?D7.call(e):"";var n=e+"";return n=="0"&&1/e==-1/0?"-0":n}var XRe=XJ,JRe=XRe;function QRe(e){return e==null?"":JRe(e)}var JJ=QRe,ZRe=rs,eAe=h2,tAe=HRe,nAe=JJ;function rAe(e,n){return ZRe(e)?e:eAe(e,n)?[e]:tAe(nAe(e))}var QJ=rAe,iAe=Wm;function aAe(e){if(typeof e=="string"||iAe(e))return e;var n=e+"";return n=="0"&&1/e==-1/0?"-0":n}var rT=aAe,sAe=QJ,oAe=rT;function cAe(e,n){n=sAe(n,e);for(var a=0,o=n.length;e!=null&&a<o;)e=e[oAe(n[a++])];return a&&a==o?e:void 0}var _2=cAe,lAe=_2;function dAe(e,n,a){var o=e==null?void 0:lAe(e,n);return o===void 0?a:o}var ZJ=dAe;const ho=ar(ZJ);function uAe(e){return e==null}var hAe=uAe;const _n=ar(hAe);var pAe=Fl,fAe=rs,mAe=Vl,gAe="[object String]";function vAe(e){return typeof e=="string"||!fAe(e)&&mAe(e)&&pAe(e)==gAe}var yAe=vAe;const Mh=ar(yAe);var eQ={exports:{}},Qn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b2=Symbol.for("react.element"),E2=Symbol.for("react.portal"),iT=Symbol.for("react.fragment"),aT=Symbol.for("react.strict_mode"),sT=Symbol.for("react.profiler"),oT=Symbol.for("react.provider"),cT=Symbol.for("react.context"),_Ae=Symbol.for("react.server_context"),lT=Symbol.for("react.forward_ref"),dT=Symbol.for("react.suspense"),uT=Symbol.for("react.suspense_list"),hT=Symbol.for("react.memo"),pT=Symbol.for("react.lazy"),bAe=Symbol.for("react.offscreen"),tQ;tQ=Symbol.for("react.module.reference");function yo(e){if(typeof e=="object"&&e!==null){var n=e.$$typeof;switch(n){case b2:switch(e=e.type,e){case iT:case sT:case aT:case dT:case uT:return e;default:switch(e=e&&e.$$typeof,e){case _Ae:case cT:case lT:case pT:case hT:case oT:return e;default:return n}}case E2:return n}}}Qn.ContextConsumer=cT;Qn.ContextProvider=oT;Qn.Element=b2;Qn.ForwardRef=lT;Qn.Fragment=iT;Qn.Lazy=pT;Qn.Memo=hT;Qn.Portal=E2;Qn.Profiler=sT;Qn.StrictMode=aT;Qn.Suspense=dT;Qn.SuspenseList=uT;Qn.isAsyncMode=function(){return!1};Qn.isConcurrentMode=function(){return!1};Qn.isContextConsumer=function(e){return yo(e)===cT};Qn.isContextProvider=function(e){return yo(e)===oT};Qn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===b2};Qn.isForwardRef=function(e){return yo(e)===lT};Qn.isFragment=function(e){return yo(e)===iT};Qn.isLazy=function(e){return yo(e)===pT};Qn.isMemo=function(e){return yo(e)===hT};Qn.isPortal=function(e){return yo(e)===E2};Qn.isProfiler=function(e){return yo(e)===sT};Qn.isStrictMode=function(e){return yo(e)===aT};Qn.isSuspense=function(e){return yo(e)===dT};Qn.isSuspenseList=function(e){return yo(e)===uT};Qn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===iT||e===sT||e===aT||e===dT||e===uT||e===bAe||typeof e=="object"&&e!==null&&(e.$$typeof===pT||e.$$typeof===hT||e.$$typeof===oT||e.$$typeof===cT||e.$$typeof===lT||e.$$typeof===tQ||e.getModuleId!==void 0)};Qn.typeOf=yo;eQ.exports=Qn;var EAe=eQ.exports,xAe=Fl,SAe=Vl,wAe="[object Number]";function TAe(e){return typeof e=="number"||SAe(e)&&xAe(e)==wAe}var nQ=TAe;const CAe=ar(nQ);var NAe=nQ;function RAe(e){return NAe(e)&&e!=+e}var AAe=RAe;const Ym=ar(AAe);var Zo=function(n){return n===0?0:n>0?1:-1},vh=function(n){return Mh(n)&&n.indexOf("%")===n.length-1},ct=function(n){return CAe(n)&&!Ym(n)},IAe=function(n){return _n(n)},bi=function(n){return ct(n)||Mh(n)},OAe=0,qm=function(n){var a=++OAe;return"".concat(n||"").concat(a)},Uh=function(n,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!ct(n)&&!Mh(n))return o;var p;if(vh(n)){var m=n.indexOf("%");p=a*parseFloat(n.slice(0,m))/100}else p=+n;return Ym(p)&&(p=o),d&&p>a&&(p=a),p},Ad=function(n){if(!n)return null;var a=Object.keys(n);return a&&a.length?n[a[0]]:null},PAe=function(n){if(!Array.isArray(n))return!1;for(var a=n.length,o={},d=0;d<a;d++)if(!o[n[d]])o[n[d]]=!0;else return!0;return!1},Ki=function(n,a){return ct(n)&&ct(a)?function(o){return n+o*(a-n)}:function(){return a}};function yS(e,n,a){return!e||!e.length?null:e.find(function(o){return o&&(typeof n=="function"?n(o):ho(o,n))===a})}var DAe=function(n,a){return ct(n)&&ct(a)?n-a:Mh(n)&&Mh(a)?n.localeCompare(a):n instanceof Date&&a instanceof Date?n.getTime()-a.getTime():String(n).localeCompare(String(a))};function Kf(e,n){for(var a in e)if({}.hasOwnProperty.call(e,a)&&(!{}.hasOwnProperty.call(n,a)||e[a]!==n[a]))return!1;for(var o in n)if({}.hasOwnProperty.call(n,o)&&!{}.hasOwnProperty.call(e,o))return!1;return!0}function TP(e){"@babel/helpers - typeof";return TP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},TP(e)}var kAe=["viewBox","children"],jAe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],k7=["points","pathLength"],UO={svg:kAe,polygon:k7,polyline:k7},x2=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],_S=function(n,a){if(!n||typeof n=="function"||typeof n=="boolean")return null;var o=n;if(Y.isValidElement(n)&&(o=n.props),!$m(o))return null;var d={};return Object.keys(o).forEach(function(p){x2.includes(p)&&(d[p]=a||function(m){return o[p](o,m)})}),d},LAe=function(n,a,o){return function(d){return n(a,o,d),null}},bS=function(n,a,o){if(!$m(n)||TP(n)!=="object")return null;var d=null;return Object.keys(n).forEach(function(p){var m=n[p];x2.includes(p)&&typeof m=="function"&&(d||(d={}),d[p]=LAe(m,a,o))}),d},MAe=["children"],UAe=["children"];function j7(e,n){if(e==null)return{};var a=FAe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function FAe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function CP(e){"@babel/helpers - typeof";return CP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},CP(e)}var L7={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},wl=function(n){return typeof n=="string"?n:n?n.displayName||n.name||"Component":""},M7=null,FO=null,S2=function e(n){if(n===M7&&Array.isArray(FO))return FO;var a=[];return Y.Children.forEach(n,function(o){_n(o)||(EAe.isFragment(o)?a=a.concat(e(o.props.children)):a.push(o))}),FO=a,M7=n,a};function po(e,n){var a=[],o=[];return Array.isArray(n)?o=n.map(function(d){return wl(d)}):o=[wl(n)],S2(e).forEach(function(d){var p=ho(d,"type.displayName")||ho(d,"type.name");o.indexOf(p)!==-1&&a.push(d)}),a}function bs(e,n){var a=po(e,n);return a&&a[0]}var U7=function(n){if(!n||!n.props)return!1;var a=n.props,o=a.width,d=a.height;return!(!ct(o)||o<=0||!ct(d)||d<=0)},VAe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],BAe=function(n){return n&&n.type&&Mh(n.type)&&VAe.indexOf(n.type)>=0},rQ=function(n){return n&&CP(n)==="object"&&"clipDot"in n},GAe=function(n,a,o,d){var p,m=(p=UO==null?void 0:UO[d])!==null&&p!==void 0?p:[];return a.startsWith("data-")||!hn(n)&&(d&&m.includes(a)||jAe.includes(a))||o&&x2.includes(a)},vn=function(n,a,o){if(!n||typeof n=="function"||typeof n=="boolean")return null;var d=n;if(Y.isValidElement(n)&&(d=n.props),!$m(d))return null;var p={};return Object.keys(d).forEach(function(m){var y;GAe((y=d)===null||y===void 0?void 0:y[m],m,a,o)&&(p[m]=d[m])}),p},NP=function e(n,a){if(n===a)return!0;var o=Y.Children.count(n);if(o!==Y.Children.count(a))return!1;if(o===0)return!0;if(o===1)return F7(Array.isArray(n)?n[0]:n,Array.isArray(a)?a[0]:a);for(var d=0;d<o;d++){var p=n[d],m=a[d];if(Array.isArray(p)||Array.isArray(m)){if(!e(p,m))return!1}else if(!F7(p,m))return!1}return!0},F7=function(n,a){if(_n(n)&&_n(a))return!0;if(!_n(n)&&!_n(a)){var o=n.props||{},d=o.children,p=j7(o,MAe),m=a.props||{},y=m.children,b=j7(m,UAe);return d&&y?Kf(p,b)&&NP(d,y):!d&&!y?Kf(p,b):!1}return!1},V7=function(n,a){var o=[],d={};return S2(n).forEach(function(p,m){if(BAe(p))o.push(p);else if(p){var y=wl(p.type),b=a[y]||{},E=b.handler,T=b.once;if(E&&(!T||!d[y])){var w=E(p,y,m);o.push(w),d[y]=!0}}}),o},WAe=function(n){var a=n&&n.type;return a&&L7[a]?L7[a]:null},$Ae=function(n,a){return S2(a).indexOf(n)},HAe=["children","width","height","viewBox","className","style","title","desc"];function RP(){return RP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},RP.apply(this,arguments)}function zAe(e,n){if(e==null)return{};var a=KAe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function KAe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function AP(e){var n=e.children,a=e.width,o=e.height,d=e.viewBox,p=e.className,m=e.style,y=e.title,b=e.desc,E=zAe(e,HAe),T=d||{width:a,height:o,x:0,y:0},w=On("recharts-surface",p);return me.createElement("svg",RP({},vn(E,!0,"svg"),{className:w,width:a,height:o,style:m,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height)}),me.createElement("title",null,y),me.createElement("desc",null,b),n)}var YAe=["children","className"];function IP(){return IP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},IP.apply(this,arguments)}function qAe(e,n){if(e==null)return{};var a=XAe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function XAe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var fr=me.forwardRef(function(e,n){var a=e.children,o=e.className,d=qAe(e,YAe),p=On("recharts-layer",o);return me.createElement("g",IP({className:p},vn(d,!0),{ref:n}),a)}),Tl=function(n,a){for(var o=arguments.length,d=new Array(o>2?o-2:0),p=2;p<o;p++)d[p-2]=arguments[p]};function JAe(e,n,a){var o=-1,d=e.length;n<0&&(n=-n>d?0:d+n),a=a>d?d:a,a<0&&(a+=d),d=n>a?0:a-n>>>0,n>>>=0;for(var p=Array(d);++o<d;)p[o]=e[o+n];return p}var QAe=JAe,ZAe=QAe;function eIe(e,n,a){var o=e.length;return a=a===void 0?o:a,!n&&a>=o?e:ZAe(e,n,a)}var tIe=eIe,nIe="\\ud800-\\udfff",rIe="\\u0300-\\u036f",iIe="\\ufe20-\\ufe2f",aIe="\\u20d0-\\u20ff",sIe=rIe+iIe+aIe,oIe="\\ufe0e\\ufe0f",cIe="\\u200d",lIe=RegExp("["+cIe+nIe+sIe+oIe+"]");function dIe(e){return lIe.test(e)}var iQ=dIe;function uIe(e){return e.split("")}var hIe=uIe,aQ="\\ud800-\\udfff",pIe="\\u0300-\\u036f",fIe="\\ufe20-\\ufe2f",mIe="\\u20d0-\\u20ff",gIe=pIe+fIe+mIe,vIe="\\ufe0e\\ufe0f",yIe="["+aQ+"]",OP="["+gIe+"]",PP="\\ud83c[\\udffb-\\udfff]",_Ie="(?:"+OP+"|"+PP+")",sQ="[^"+aQ+"]",oQ="(?:\\ud83c[\\udde6-\\uddff]){2}",cQ="[\\ud800-\\udbff][\\udc00-\\udfff]",bIe="\\u200d",lQ=_Ie+"?",dQ="["+vIe+"]?",EIe="(?:"+bIe+"(?:"+[sQ,oQ,cQ].join("|")+")"+dQ+lQ+")*",xIe=dQ+lQ+EIe,SIe="(?:"+[sQ+OP+"?",OP,oQ,cQ,yIe].join("|")+")",wIe=RegExp(PP+"(?="+PP+")|"+SIe+xIe,"g");function TIe(e){return e.match(wIe)||[]}var CIe=TIe,NIe=hIe,RIe=iQ,AIe=CIe;function IIe(e){return RIe(e)?AIe(e):NIe(e)}var OIe=IIe,PIe=tIe,DIe=iQ,kIe=OIe,jIe=JJ;function LIe(e){return function(n){n=jIe(n);var a=DIe(n)?kIe(n):void 0,o=a?a[0]:n.charAt(0),d=a?PIe(a,1).join(""):n.slice(1);return o[e]()+d}}var MIe=LIe,UIe=MIe,FIe=UIe("toUpperCase"),VIe=FIe;const fT=ar(VIe);function hr(e){return function(){return e}}const uQ=Math.cos,ES=Math.sin,sc=Math.sqrt,xS=Math.PI,mT=2*xS,DP=Math.PI,kP=2*DP,oh=1e-6,BIe=kP-oh;function hQ(e){this._+=e[0];for(let n=1,a=e.length;n<a;++n)this._+=arguments[n]+e[n]}function GIe(e){let n=Math.floor(e);if(!(n>=0))throw new Error(`invalid digits: ${e}`);if(n>15)return hQ;const a=10**n;return function(o){this._+=o[0];for(let d=1,p=o.length;d<p;++d)this._+=Math.round(arguments[d]*a)/a+o[d]}}class WIe{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?hQ:GIe(n)}moveTo(n,a){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+a}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,a){this._append`L${this._x1=+n},${this._y1=+a}`}quadraticCurveTo(n,a,o,d){this._append`Q${+n},${+a},${this._x1=+o},${this._y1=+d}`}bezierCurveTo(n,a,o,d,p,m){this._append`C${+n},${+a},${+o},${+d},${this._x1=+p},${this._y1=+m}`}arcTo(n,a,o,d,p){if(n=+n,a=+a,o=+o,d=+d,p=+p,p<0)throw new Error(`negative radius: ${p}`);let m=this._x1,y=this._y1,b=o-n,E=d-a,T=m-n,w=y-a,N=T*T+w*w;if(this._x1===null)this._append`M${this._x1=n},${this._y1=a}`;else if(N>oh)if(!(Math.abs(w*b-E*T)>oh)||!p)this._append`L${this._x1=n},${this._y1=a}`;else{let D=o-m,A=d-y,k=b*b+E*E,O=D*D+A*A,F=Math.sqrt(k),M=Math.sqrt(N),V=p*Math.tan((DP-Math.acos((k+N-O)/(2*F*M)))/2),H=V/M,B=V/F;Math.abs(H-1)>oh&&this._append`L${n+H*T},${a+H*w}`,this._append`A${p},${p},0,0,${+(w*D>T*A)},${this._x1=n+B*b},${this._y1=a+B*E}`}}arc(n,a,o,d,p,m){if(n=+n,a=+a,o=+o,m=!!m,o<0)throw new Error(`negative radius: ${o}`);let y=o*Math.cos(d),b=o*Math.sin(d),E=n+y,T=a+b,w=1^m,N=m?d-p:p-d;this._x1===null?this._append`M${E},${T}`:(Math.abs(this._x1-E)>oh||Math.abs(this._y1-T)>oh)&&this._append`L${E},${T}`,o&&(N<0&&(N=N%kP+kP),N>BIe?this._append`A${o},${o},0,1,${w},${n-y},${a-b}A${o},${o},0,1,${w},${this._x1=E},${this._y1=T}`:N>oh&&this._append`A${o},${o},0,${+(N>=DP)},${w},${this._x1=n+o*Math.cos(p)},${this._y1=a+o*Math.sin(p)}`)}rect(n,a,o,d){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+a}h${o=+o}v${+d}h${-o}Z`}toString(){return this._}}function w2(e){let n=3;return e.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const o=Math.floor(a);if(!(o>=0))throw new RangeError(`invalid digits: ${a}`);n=o}return e},()=>new WIe(n)}function T2(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function pQ(e){this._context=e}pQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:this._context.lineTo(e,n);break}}};function gT(e){return new pQ(e)}function fQ(e){return e[0]}function mQ(e){return e[1]}function gQ(e,n){var a=hr(!0),o=null,d=gT,p=null,m=w2(y);e=typeof e=="function"?e:e===void 0?fQ:hr(e),n=typeof n=="function"?n:n===void 0?mQ:hr(n);function y(b){var E,T=(b=T2(b)).length,w,N=!1,D;for(o==null&&(p=d(D=m())),E=0;E<=T;++E)!(E<T&&a(w=b[E],E,b))===N&&((N=!N)?p.lineStart():p.lineEnd()),N&&p.point(+e(w,E,b),+n(w,E,b));if(D)return p=null,D+""||null}return y.x=function(b){return arguments.length?(e=typeof b=="function"?b:hr(+b),y):e},y.y=function(b){return arguments.length?(n=typeof b=="function"?b:hr(+b),y):n},y.defined=function(b){return arguments.length?(a=typeof b=="function"?b:hr(!!b),y):a},y.curve=function(b){return arguments.length?(d=b,o!=null&&(p=d(o)),y):d},y.context=function(b){return arguments.length?(b==null?o=p=null:p=d(o=b),y):o},y}function ox(e,n,a){var o=null,d=hr(!0),p=null,m=gT,y=null,b=w2(E);e=typeof e=="function"?e:e===void 0?fQ:hr(+e),n=typeof n=="function"?n:hr(n===void 0?0:+n),a=typeof a=="function"?a:a===void 0?mQ:hr(+a);function E(w){var N,D,A,k=(w=T2(w)).length,O,F=!1,M,V=new Array(k),H=new Array(k);for(p==null&&(y=m(M=b())),N=0;N<=k;++N){if(!(N<k&&d(O=w[N],N,w))===F)if(F=!F)D=N,y.areaStart(),y.lineStart();else{for(y.lineEnd(),y.lineStart(),A=N-1;A>=D;--A)y.point(V[A],H[A]);y.lineEnd(),y.areaEnd()}F&&(V[N]=+e(O,N,w),H[N]=+n(O,N,w),y.point(o?+o(O,N,w):V[N],a?+a(O,N,w):H[N]))}if(M)return y=null,M+""||null}function T(){return gQ().defined(d).curve(m).context(p)}return E.x=function(w){return arguments.length?(e=typeof w=="function"?w:hr(+w),o=null,E):e},E.x0=function(w){return arguments.length?(e=typeof w=="function"?w:hr(+w),E):e},E.x1=function(w){return arguments.length?(o=w==null?null:typeof w=="function"?w:hr(+w),E):o},E.y=function(w){return arguments.length?(n=typeof w=="function"?w:hr(+w),a=null,E):n},E.y0=function(w){return arguments.length?(n=typeof w=="function"?w:hr(+w),E):n},E.y1=function(w){return arguments.length?(a=w==null?null:typeof w=="function"?w:hr(+w),E):a},E.lineX0=E.lineY0=function(){return T().x(e).y(n)},E.lineY1=function(){return T().x(e).y(a)},E.lineX1=function(){return T().x(o).y(n)},E.defined=function(w){return arguments.length?(d=typeof w=="function"?w:hr(!!w),E):d},E.curve=function(w){return arguments.length?(m=w,p!=null&&(y=m(p)),E):m},E.context=function(w){return arguments.length?(w==null?p=y=null:y=m(p=w),E):p},E}class vQ{constructor(n,a){this._context=n,this._x=a}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(n,a){switch(n=+n,a=+a,this._point){case 0:{this._point=1,this._line?this._context.lineTo(n,a):this._context.moveTo(n,a);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+n)/2,this._y0,this._x0,a,n,a):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+a)/2,n,this._y0,n,a);break}}this._x0=n,this._y0=a}}function $Ie(e){return new vQ(e,!0)}function HIe(e){return new vQ(e,!1)}const C2={draw(e,n){const a=sc(n/xS);e.moveTo(a,0),e.arc(0,0,a,0,mT)}},zIe={draw(e,n){const a=sc(n/5)/2;e.moveTo(-3*a,-a),e.lineTo(-a,-a),e.lineTo(-a,-3*a),e.lineTo(a,-3*a),e.lineTo(a,-a),e.lineTo(3*a,-a),e.lineTo(3*a,a),e.lineTo(a,a),e.lineTo(a,3*a),e.lineTo(-a,3*a),e.lineTo(-a,a),e.lineTo(-3*a,a),e.closePath()}},yQ=sc(1/3),KIe=yQ*2,YIe={draw(e,n){const a=sc(n/KIe),o=a*yQ;e.moveTo(0,-a),e.lineTo(o,0),e.lineTo(0,a),e.lineTo(-o,0),e.closePath()}},qIe={draw(e,n){const a=sc(n),o=-a/2;e.rect(o,o,a,a)}},XIe=.8908130915292852,_Q=ES(xS/10)/ES(7*xS/10),JIe=ES(mT/10)*_Q,QIe=-uQ(mT/10)*_Q,ZIe={draw(e,n){const a=sc(n*XIe),o=JIe*a,d=QIe*a;e.moveTo(0,-a),e.lineTo(o,d);for(let p=1;p<5;++p){const m=mT*p/5,y=uQ(m),b=ES(m);e.lineTo(b*a,-y*a),e.lineTo(y*o-b*d,b*o+y*d)}e.closePath()}},VO=sc(3),eOe={draw(e,n){const a=-sc(n/(VO*3));e.moveTo(0,a*2),e.lineTo(-VO*a,-a),e.lineTo(VO*a,-a),e.closePath()}},Qs=-.5,Zs=sc(3)/2,jP=1/sc(12),tOe=(jP/2+1)*3,nOe={draw(e,n){const a=sc(n/tOe),o=a/2,d=a*jP,p=o,m=a*jP+a,y=-p,b=m;e.moveTo(o,d),e.lineTo(p,m),e.lineTo(y,b),e.lineTo(Qs*o-Zs*d,Zs*o+Qs*d),e.lineTo(Qs*p-Zs*m,Zs*p+Qs*m),e.lineTo(Qs*y-Zs*b,Zs*y+Qs*b),e.lineTo(Qs*o+Zs*d,Qs*d-Zs*o),e.lineTo(Qs*p+Zs*m,Qs*m-Zs*p),e.lineTo(Qs*y+Zs*b,Qs*b-Zs*y),e.closePath()}};function rOe(e,n){let a=null,o=w2(d);e=typeof e=="function"?e:hr(e||C2),n=typeof n=="function"?n:hr(n===void 0?64:+n);function d(){let p;if(a||(a=p=o()),e.apply(this,arguments).draw(a,+n.apply(this,arguments)),p)return a=null,p+""||null}return d.type=function(p){return arguments.length?(e=typeof p=="function"?p:hr(p),d):e},d.size=function(p){return arguments.length?(n=typeof p=="function"?p:hr(+p),d):n},d.context=function(p){return arguments.length?(a=p??null,d):a},d}function SS(){}function wS(e,n,a){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+n)/6,(e._y0+4*e._y1+a)/6)}function bQ(e){this._context=e}bQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:wS(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:wS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function iOe(e){return new bQ(e)}function EQ(e){this._context=e}EQ.prototype={areaStart:SS,areaEnd:SS,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._x2=e,this._y2=n;break;case 1:this._point=2,this._x3=e,this._y3=n;break;case 2:this._point=3,this._x4=e,this._y4=n,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+n)/6);break;default:wS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function aOe(e){return new EQ(e)}function xQ(e){this._context=e}xQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var a=(this._x0+4*this._x1+e)/6,o=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(a,o):this._context.moveTo(a,o);break;case 3:this._point=4;default:wS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function sOe(e){return new xQ(e)}function SQ(e){this._context=e}SQ.prototype={areaStart:SS,areaEnd:SS,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,n){e=+e,n=+n,this._point?this._context.lineTo(e,n):(this._point=1,this._context.moveTo(e,n))}};function oOe(e){return new SQ(e)}function B7(e){return e<0?-1:1}function G7(e,n,a){var o=e._x1-e._x0,d=n-e._x1,p=(e._y1-e._y0)/(o||d<0&&-0),m=(a-e._y1)/(d||o<0&&-0),y=(p*d+m*o)/(o+d);return(B7(p)+B7(m))*Math.min(Math.abs(p),Math.abs(m),.5*Math.abs(y))||0}function W7(e,n){var a=e._x1-e._x0;return a?(3*(e._y1-e._y0)/a-n)/2:n}function BO(e,n,a){var o=e._x0,d=e._y0,p=e._x1,m=e._y1,y=(p-o)/3;e._context.bezierCurveTo(o+y,d+y*n,p-y,m-y*a,p,m)}function TS(e){this._context=e}TS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:BO(this,this._t0,W7(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){var a=NaN;if(e=+e,n=+n,!(e===this._x1&&n===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,BO(this,W7(this,a=G7(this,e,n)),a);break;default:BO(this,this._t0,a=G7(this,e,n));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n,this._t0=a}}};function wQ(e){this._context=new TQ(e)}(wQ.prototype=Object.create(TS.prototype)).point=function(e,n){TS.prototype.point.call(this,n,e)};function TQ(e){this._context=e}TQ.prototype={moveTo:function(e,n){this._context.moveTo(n,e)},closePath:function(){this._context.closePath()},lineTo:function(e,n){this._context.lineTo(n,e)},bezierCurveTo:function(e,n,a,o,d,p){this._context.bezierCurveTo(n,e,o,a,p,d)}};function cOe(e){return new TS(e)}function lOe(e){return new wQ(e)}function CQ(e){this._context=e}CQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,n=this._y,a=e.length;if(a)if(this._line?this._context.lineTo(e[0],n[0]):this._context.moveTo(e[0],n[0]),a===2)this._context.lineTo(e[1],n[1]);else for(var o=$7(e),d=$7(n),p=0,m=1;m<a;++p,++m)this._context.bezierCurveTo(o[0][p],d[0][p],o[1][p],d[1][p],e[m],n[m]);(this._line||this._line!==0&&a===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,n){this._x.push(+e),this._y.push(+n)}};function $7(e){var n,a=e.length-1,o,d=new Array(a),p=new Array(a),m=new Array(a);for(d[0]=0,p[0]=2,m[0]=e[0]+2*e[1],n=1;n<a-1;++n)d[n]=1,p[n]=4,m[n]=4*e[n]+2*e[n+1];for(d[a-1]=2,p[a-1]=7,m[a-1]=8*e[a-1]+e[a],n=1;n<a;++n)o=d[n]/p[n-1],p[n]-=o,m[n]-=o*m[n-1];for(d[a-1]=m[a-1]/p[a-1],n=a-2;n>=0;--n)d[n]=(m[n]-d[n+1])/p[n];for(p[a-1]=(e[a]+d[a-1])/2,n=0;n<a-1;++n)p[n]=2*e[n+1]-d[n+1];return[d,p]}function dOe(e){return new CQ(e)}function vT(e,n){this._context=e,this._t=n}vT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(e,n);else{var a=this._x*(1-this._t)+e*this._t;this._context.lineTo(a,this._y),this._context.lineTo(a,n)}break}}this._x=e,this._y=n}};function uOe(e){return new vT(e,.5)}function hOe(e){return new vT(e,0)}function pOe(e){return new vT(e,1)}function cm(e,n){if((m=e.length)>1)for(var a=1,o,d,p=e[n[0]],m,y=p.length;a<m;++a)for(d=p,p=e[n[a]],o=0;o<y;++o)p[o][1]+=p[o][0]=isNaN(d[o][1])?d[o][0]:d[o][1]}function LP(e){for(var n=e.length,a=new Array(n);--n>=0;)a[n]=n;return a}function fOe(e,n){return e[n]}function mOe(e){const n=[];return n.key=e,n}function gOe(){var e=hr([]),n=LP,a=cm,o=fOe;function d(p){var m=Array.from(e.apply(this,arguments),mOe),y,b=m.length,E=-1,T;for(const w of p)for(y=0,++E;y<b;++y)(m[y][E]=[0,+o(w,m[y].key,E,p)]).data=w;for(y=0,T=T2(n(m));y<b;++y)m[T[y]].index=y;return a(m,T),m}return d.keys=function(p){return arguments.length?(e=typeof p=="function"?p:hr(Array.from(p)),d):e},d.value=function(p){return arguments.length?(o=typeof p=="function"?p:hr(+p),d):o},d.order=function(p){return arguments.length?(n=p==null?LP:typeof p=="function"?p:hr(Array.from(p)),d):n},d.offset=function(p){return arguments.length?(a=p??cm,d):a},d}function vOe(e,n){if((o=e.length)>0){for(var a,o,d=0,p=e[0].length,m;d<p;++d){for(m=a=0;a<o;++a)m+=e[a][d][1]||0;if(m)for(a=0;a<o;++a)e[a][d][1]/=m}cm(e,n)}}function yOe(e,n){if((d=e.length)>0){for(var a=0,o=e[n[0]],d,p=o.length;a<p;++a){for(var m=0,y=0;m<d;++m)y+=e[m][a][1]||0;o[a][1]+=o[a][0]=-y/2}cm(e,n)}}function _Oe(e,n){if(!(!((m=e.length)>0)||!((p=(d=e[n[0]]).length)>0))){for(var a=0,o=1,d,p,m;o<p;++o){for(var y=0,b=0,E=0;y<m;++y){for(var T=e[n[y]],w=T[o][1]||0,N=T[o-1][1]||0,D=(w-N)/2,A=0;A<y;++A){var k=e[n[A]],O=k[o][1]||0,F=k[o-1][1]||0;D+=O-F}b+=w,E+=D*w}d[o-1][1]+=d[o-1][0]=a,b&&(a-=E/b)}d[o-1][1]+=d[o-1][0]=a,cm(e,n)}}function Fy(e){"@babel/helpers - typeof";return Fy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Fy(e)}var bOe=["type","size","sizeType"];function MP(){return MP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},MP.apply(this,arguments)}function H7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function z7(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?H7(Object(a),!0).forEach(function(o){EOe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function EOe(e,n,a){return n=xOe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function xOe(e){var n=SOe(e,"string");return Fy(n)=="symbol"?n:n+""}function SOe(e,n){if(Fy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Fy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function wOe(e,n){if(e==null)return{};var a=TOe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function TOe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var NQ={symbolCircle:C2,symbolCross:zIe,symbolDiamond:YIe,symbolSquare:qIe,symbolStar:ZIe,symbolTriangle:eOe,symbolWye:nOe},COe=Math.PI/180,NOe=function(n){var a="symbol".concat(fT(n));return NQ[a]||C2},ROe=function(n,a,o){if(a==="area")return n;switch(o){case"cross":return 5*n*n/9;case"diamond":return .5*n*n/Math.sqrt(3);case"square":return n*n;case"star":{var d=18*COe;return 1.25*n*n*(Math.tan(d)-Math.tan(d*2)*Math.pow(Math.tan(d),2))}case"triangle":return Math.sqrt(3)*n*n/4;case"wye":return(21-10*Math.sqrt(3))*n*n/8;default:return Math.PI*n*n/4}},AOe=function(n,a){NQ["symbol".concat(fT(n))]=a},N2=function(n){var a=n.type,o=a===void 0?"circle":a,d=n.size,p=d===void 0?64:d,m=n.sizeType,y=m===void 0?"area":m,b=wOe(n,bOe),E=z7(z7({},b),{},{type:o,size:p,sizeType:y}),T=function(){var O=NOe(o),F=rOe().type(O).size(ROe(p,y,o));return F()},w=E.className,N=E.cx,D=E.cy,A=vn(E,!0);return N===+N&&D===+D&&p===+p?me.createElement("path",MP({},A,{className:On("recharts-symbols",w),transform:"translate(".concat(N,", ").concat(D,")"),d:T()})):null};N2.registerSymbol=AOe;function lm(e){"@babel/helpers - typeof";return lm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},lm(e)}function UP(){return UP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},UP.apply(this,arguments)}function K7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function IOe(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?K7(Object(a),!0).forEach(function(o){Vy(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):K7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function OOe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function POe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,AQ(o.key),o)}}function DOe(e,n,a){return n&&POe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function kOe(e,n,a){return n=CS(n),jOe(e,RQ()?Reflect.construct(n,a||[],CS(e).constructor):n.apply(e,a))}function jOe(e,n){if(n&&(lm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LOe(e)}function LOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function RQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(RQ=function(){return!!e})()}function CS(e){return CS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},CS(e)}function MOe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&FP(e,n)}function FP(e,n){return FP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},FP(e,n)}function Vy(e,n,a){return n=AQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function AQ(e){var n=UOe(e,"string");return lm(n)=="symbol"?n:n+""}function UOe(e,n){if(lm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(lm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var eo=32,R2=function(e){function n(){return OOe(this,n),kOe(this,n,arguments)}return MOe(n,e),DOe(n,[{key:"renderIcon",value:function(o){var d=this.props.inactiveColor,p=eo/2,m=eo/6,y=eo/3,b=o.inactive?d:o.color;if(o.type==="plainline")return me.createElement("line",{strokeWidth:4,fill:"none",stroke:b,strokeDasharray:o.payload.strokeDasharray,x1:0,y1:p,x2:eo,y2:p,className:"recharts-legend-icon"});if(o.type==="line")return me.createElement("path",{strokeWidth:4,fill:"none",stroke:b,d:"M0,".concat(p,"h").concat(y,`
            A`).concat(m,",").concat(m,",0,1,1,").concat(2*y,",").concat(p,`
            H`).concat(eo,"M").concat(2*y,",").concat(p,`
            A`).concat(m,",").concat(m,",0,1,1,").concat(y,",").concat(p),className:"recharts-legend-icon"});if(o.type==="rect")return me.createElement("path",{stroke:"none",fill:b,d:"M0,".concat(eo/8,"h").concat(eo,"v").concat(eo*3/4,"h").concat(-eo,"z"),className:"recharts-legend-icon"});if(me.isValidElement(o.legendIcon)){var E=IOe({},o);return delete E.legendIcon,me.cloneElement(o.legendIcon,E)}return me.createElement(N2,{fill:b,cx:p,cy:p,size:eo,sizeType:"diameter",type:o.type})}},{key:"renderItems",value:function(){var o=this,d=this.props,p=d.payload,m=d.iconSize,y=d.layout,b=d.formatter,E=d.inactiveColor,T={x:0,y:0,width:eo,height:eo},w={display:y==="horizontal"?"inline-block":"block",marginRight:10},N={display:"inline-block",verticalAlign:"middle",marginRight:4};return p.map(function(D,A){var k=D.formatter||b,O=On(Vy(Vy({"recharts-legend-item":!0},"legend-item-".concat(A),!0),"inactive",D.inactive));if(D.type==="none")return null;var F=hn(D.value)?null:D.value;Tl(!hn(D.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var M=D.inactive?E:D.color;return me.createElement("li",UP({className:O,style:w,key:"legend-item-".concat(A)},bS(o.props,D,A)),me.createElement(AP,{width:m,height:m,viewBox:T,style:N},o.renderIcon(D)),me.createElement("span",{className:"recharts-legend-item-text",style:{color:M}},k?k(F,D,A):F))})}},{key:"render",value:function(){var o=this.props,d=o.payload,p=o.layout,m=o.align;if(!d||!d.length)return null;var y={padding:0,margin:0,textAlign:p==="horizontal"?m:"left"};return me.createElement("ul",{className:"recharts-default-legend",style:y},this.renderItems())}}])}(Y.PureComponent);Vy(R2,"displayName","Legend");Vy(R2,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var FOe=tT;function VOe(){this.__data__=new FOe,this.size=0}var BOe=VOe;function GOe(e){var n=this.__data__,a=n.delete(e);return this.size=n.size,a}var WOe=GOe;function $Oe(e){return this.__data__.get(e)}var HOe=$Oe;function zOe(e){return this.__data__.has(e)}var KOe=zOe,YOe=tT,qOe=m2,XOe=g2,JOe=200;function QOe(e,n){var a=this.__data__;if(a instanceof YOe){var o=a.__data__;if(!qOe||o.length<JOe-1)return o.push([e,n]),this.size=++a.size,this;a=this.__data__=new XOe(o)}return a.set(e,n),this.size=a.size,this}var ZOe=QOe,e1e=tT,t1e=BOe,n1e=WOe,r1e=HOe,i1e=KOe,a1e=ZOe;function Xm(e){var n=this.__data__=new e1e(e);this.size=n.size}Xm.prototype.clear=t1e;Xm.prototype.delete=n1e;Xm.prototype.get=r1e;Xm.prototype.has=i1e;Xm.prototype.set=a1e;var IQ=Xm,s1e="__lodash_hash_undefined__";function o1e(e){return this.__data__.set(e,s1e),this}var c1e=o1e;function l1e(e){return this.__data__.has(e)}var d1e=l1e,u1e=g2,h1e=c1e,p1e=d1e;function NS(e){var n=-1,a=e==null?0:e.length;for(this.__data__=new u1e;++n<a;)this.add(e[n])}NS.prototype.add=NS.prototype.push=h1e;NS.prototype.has=p1e;var OQ=NS;function f1e(e,n){for(var a=-1,o=e==null?0:e.length;++a<o;)if(n(e[a],a,e))return!0;return!1}var PQ=f1e;function m1e(e,n){return e.has(n)}var DQ=m1e,g1e=OQ,v1e=PQ,y1e=DQ,_1e=1,b1e=2;function E1e(e,n,a,o,d,p){var m=a&_1e,y=e.length,b=n.length;if(y!=b&&!(m&&b>y))return!1;var E=p.get(e),T=p.get(n);if(E&&T)return E==n&&T==e;var w=-1,N=!0,D=a&b1e?new g1e:void 0;for(p.set(e,n),p.set(n,e);++w<y;){var A=e[w],k=n[w];if(o)var O=m?o(k,A,w,n,e,p):o(A,k,w,e,n,p);if(O!==void 0){if(O)continue;N=!1;break}if(D){if(!v1e(n,function(F,M){if(!y1e(D,M)&&(A===F||d(A,F,a,o,p)))return D.push(M)})){N=!1;break}}else if(!(A===k||d(A,k,a,o,p))){N=!1;break}}return p.delete(e),p.delete(n),N}var kQ=E1e,x1e=Xc,S1e=x1e.Uint8Array,w1e=S1e;function T1e(e){var n=-1,a=Array(e.size);return e.forEach(function(o,d){a[++n]=[d,o]}),a}var C1e=T1e;function N1e(e){var n=-1,a=Array(e.size);return e.forEach(function(o){a[++n]=o}),a}var A2=N1e,Y7=k_,q7=w1e,R1e=f2,A1e=kQ,I1e=C1e,O1e=A2,P1e=1,D1e=2,k1e="[object Boolean]",j1e="[object Date]",L1e="[object Error]",M1e="[object Map]",U1e="[object Number]",F1e="[object RegExp]",V1e="[object Set]",B1e="[object String]",G1e="[object Symbol]",W1e="[object ArrayBuffer]",$1e="[object DataView]",X7=Y7?Y7.prototype:void 0,GO=X7?X7.valueOf:void 0;function H1e(e,n,a,o,d,p,m){switch(a){case $1e:if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)return!1;e=e.buffer,n=n.buffer;case W1e:return!(e.byteLength!=n.byteLength||!p(new q7(e),new q7(n)));case k1e:case j1e:case U1e:return R1e(+e,+n);case L1e:return e.name==n.name&&e.message==n.message;case F1e:case B1e:return e==n+"";case M1e:var y=I1e;case V1e:var b=o&P1e;if(y||(y=O1e),e.size!=n.size&&!b)return!1;var E=m.get(e);if(E)return E==n;o|=D1e,m.set(e,n);var T=A1e(y(e),y(n),o,d,p,m);return m.delete(e),T;case G1e:if(GO)return GO.call(e)==GO.call(n)}return!1}var z1e=H1e;function K1e(e,n){for(var a=-1,o=n.length,d=e.length;++a<o;)e[d+a]=n[a];return e}var jQ=K1e,Y1e=jQ,q1e=rs;function X1e(e,n,a){var o=n(e);return q1e(e)?o:Y1e(o,a(e))}var J1e=X1e;function Q1e(e,n){for(var a=-1,o=e==null?0:e.length,d=0,p=[];++a<o;){var m=e[a];n(m,a,e)&&(p[d++]=m)}return p}var Z1e=Q1e;function ePe(){return[]}var tPe=ePe,nPe=Z1e,rPe=tPe,iPe=Object.prototype,aPe=iPe.propertyIsEnumerable,J7=Object.getOwnPropertySymbols,sPe=J7?function(e){return e==null?[]:(e=Object(e),nPe(J7(e),function(n){return aPe.call(e,n)}))}:rPe,oPe=sPe;function cPe(e,n){for(var a=-1,o=Array(e);++a<e;)o[a]=n(a);return o}var lPe=cPe,dPe=Fl,uPe=Vl,hPe="[object Arguments]";function pPe(e){return uPe(e)&&dPe(e)==hPe}var fPe=pPe,Q7=fPe,mPe=Vl,LQ=Object.prototype,gPe=LQ.hasOwnProperty,vPe=LQ.propertyIsEnumerable,yPe=Q7(function(){return arguments}())?Q7:function(e){return mPe(e)&&gPe.call(e,"callee")&&!vPe.call(e,"callee")},I2=yPe,RS={exports:{}};function _Pe(){return!1}var bPe=_Pe;RS.exports;(function(e,n){var a=Xc,o=bPe,d=n&&!n.nodeType&&n,p=d&&!0&&e&&!e.nodeType&&e,m=p&&p.exports===d,y=m?a.Buffer:void 0,b=y?y.isBuffer:void 0,E=b||o;e.exports=E})(RS,RS.exports);var MQ=RS.exports,EPe=9007199254740991,xPe=/^(?:0|[1-9]\d*)$/;function SPe(e,n){var a=typeof e;return n=n??EPe,!!n&&(a=="number"||a!="symbol"&&xPe.test(e))&&e>-1&&e%1==0&&e<n}var O2=SPe,wPe=9007199254740991;function TPe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=wPe}var P2=TPe,CPe=Fl,NPe=P2,RPe=Vl,APe="[object Arguments]",IPe="[object Array]",OPe="[object Boolean]",PPe="[object Date]",DPe="[object Error]",kPe="[object Function]",jPe="[object Map]",LPe="[object Number]",MPe="[object Object]",UPe="[object RegExp]",FPe="[object Set]",VPe="[object String]",BPe="[object WeakMap]",GPe="[object ArrayBuffer]",WPe="[object DataView]",$Pe="[object Float32Array]",HPe="[object Float64Array]",zPe="[object Int8Array]",KPe="[object Int16Array]",YPe="[object Int32Array]",qPe="[object Uint8Array]",XPe="[object Uint8ClampedArray]",JPe="[object Uint16Array]",QPe="[object Uint32Array]",wr={};wr[$Pe]=wr[HPe]=wr[zPe]=wr[KPe]=wr[YPe]=wr[qPe]=wr[XPe]=wr[JPe]=wr[QPe]=!0;wr[APe]=wr[IPe]=wr[GPe]=wr[OPe]=wr[WPe]=wr[PPe]=wr[DPe]=wr[kPe]=wr[jPe]=wr[LPe]=wr[MPe]=wr[UPe]=wr[FPe]=wr[VPe]=wr[BPe]=!1;function ZPe(e){return RPe(e)&&NPe(e.length)&&!!wr[CPe(e)]}var eDe=ZPe;function tDe(e){return function(n){return e(n)}}var UQ=tDe,AS={exports:{}};AS.exports;(function(e,n){var a=HJ,o=n&&!n.nodeType&&n,d=o&&!0&&e&&!e.nodeType&&e,p=d&&d.exports===o,m=p&&a.process,y=function(){try{var b=d&&d.require&&d.require("util").types;return b||m&&m.binding&&m.binding("util")}catch{}}();e.exports=y})(AS,AS.exports);var nDe=AS.exports,rDe=eDe,iDe=UQ,Z7=nDe,ez=Z7&&Z7.isTypedArray,aDe=ez?iDe(ez):rDe,FQ=aDe,sDe=lPe,oDe=I2,cDe=rs,lDe=MQ,dDe=O2,uDe=FQ,hDe=Object.prototype,pDe=hDe.hasOwnProperty;function fDe(e,n){var a=cDe(e),o=!a&&oDe(e),d=!a&&!o&&lDe(e),p=!a&&!o&&!d&&uDe(e),m=a||o||d||p,y=m?sDe(e.length,String):[],b=y.length;for(var E in e)(n||pDe.call(e,E))&&!(m&&(E=="length"||d&&(E=="offset"||E=="parent")||p&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||dDe(E,b)))&&y.push(E);return y}var mDe=fDe,gDe=Object.prototype;function vDe(e){var n=e&&e.constructor,a=typeof n=="function"&&n.prototype||gDe;return e===a}var yDe=vDe;function _De(e,n){return function(a){return e(n(a))}}var VQ=_De,bDe=VQ,EDe=bDe(Object.keys,Object),xDe=EDe,SDe=yDe,wDe=xDe,TDe=Object.prototype,CDe=TDe.hasOwnProperty;function NDe(e){if(!SDe(e))return wDe(e);var n=[];for(var a in Object(e))CDe.call(e,a)&&a!="constructor"&&n.push(a);return n}var RDe=NDe,ADe=p2,IDe=P2;function ODe(e){return e!=null&&IDe(e.length)&&!ADe(e)}var j_=ODe,PDe=mDe,DDe=RDe,kDe=j_;function jDe(e){return kDe(e)?PDe(e):DDe(e)}var yT=jDe,LDe=J1e,MDe=oPe,UDe=yT;function FDe(e){return LDe(e,UDe,MDe)}var VDe=FDe,tz=VDe,BDe=1,GDe=Object.prototype,WDe=GDe.hasOwnProperty;function $De(e,n,a,o,d,p){var m=a&BDe,y=tz(e),b=y.length,E=tz(n),T=E.length;if(b!=T&&!m)return!1;for(var w=b;w--;){var N=y[w];if(!(m?N in n:WDe.call(n,N)))return!1}var D=p.get(e),A=p.get(n);if(D&&A)return D==n&&A==e;var k=!0;p.set(e,n),p.set(n,e);for(var O=m;++w<b;){N=y[w];var F=e[N],M=n[N];if(o)var V=m?o(M,F,N,n,e,p):o(F,M,N,e,n,p);if(!(V===void 0?F===M||d(F,M,a,o,p):V)){k=!1;break}O||(O=N=="constructor")}if(k&&!O){var H=e.constructor,B=n.constructor;H!=B&&"constructor"in e&&"constructor"in n&&!(typeof H=="function"&&H instanceof H&&typeof B=="function"&&B instanceof B)&&(k=!1)}return p.delete(e),p.delete(n),k}var HDe=$De,zDe=$h,KDe=Xc,YDe=zDe(KDe,"DataView"),qDe=YDe,XDe=$h,JDe=Xc,QDe=XDe(JDe,"Promise"),ZDe=QDe,eke=$h,tke=Xc,nke=eke(tke,"Set"),BQ=nke,rke=$h,ike=Xc,ake=rke(ike,"WeakMap"),ske=ake,VP=qDe,BP=m2,GP=ZDe,WP=BQ,$P=ske,GQ=Fl,Jm=KJ,nz="[object Map]",oke="[object Object]",rz="[object Promise]",iz="[object Set]",az="[object WeakMap]",sz="[object DataView]",cke=Jm(VP),lke=Jm(BP),dke=Jm(GP),uke=Jm(WP),hke=Jm($P),ch=GQ;(VP&&ch(new VP(new ArrayBuffer(1)))!=sz||BP&&ch(new BP)!=nz||GP&&ch(GP.resolve())!=rz||WP&&ch(new WP)!=iz||$P&&ch(new $P)!=az)&&(ch=function(e){var n=GQ(e),a=n==oke?e.constructor:void 0,o=a?Jm(a):"";if(o)switch(o){case cke:return sz;case lke:return nz;case dke:return rz;case uke:return iz;case hke:return az}return n});var pke=ch,WO=IQ,fke=kQ,mke=z1e,gke=HDe,oz=pke,cz=rs,lz=MQ,vke=FQ,yke=1,dz="[object Arguments]",uz="[object Array]",cx="[object Object]",_ke=Object.prototype,hz=_ke.hasOwnProperty;function bke(e,n,a,o,d,p){var m=cz(e),y=cz(n),b=m?uz:oz(e),E=y?uz:oz(n);b=b==dz?cx:b,E=E==dz?cx:E;var T=b==cx,w=E==cx,N=b==E;if(N&&lz(e)){if(!lz(n))return!1;m=!0,T=!1}if(N&&!T)return p||(p=new WO),m||vke(e)?fke(e,n,a,o,d,p):mke(e,n,b,a,o,d,p);if(!(a&yke)){var D=T&&hz.call(e,"__wrapped__"),A=w&&hz.call(n,"__wrapped__");if(D||A){var k=D?e.value():e,O=A?n.value():n;return p||(p=new WO),d(k,O,a,o,p)}}return N?(p||(p=new WO),gke(e,n,a,o,d,p)):!1}var Eke=bke,xke=Eke,pz=Vl;function WQ(e,n,a,o,d){return e===n?!0:e==null||n==null||!pz(e)&&!pz(n)?e!==e&&n!==n:xke(e,n,a,o,WQ,d)}var D2=WQ,Ske=IQ,wke=D2,Tke=1,Cke=2;function Nke(e,n,a,o){var d=a.length,p=d,m=!o;if(e==null)return!p;for(e=Object(e);d--;){var y=a[d];if(m&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++d<p;){y=a[d];var b=y[0],E=e[b],T=y[1];if(m&&y[2]){if(E===void 0&&!(b in e))return!1}else{var w=new Ske;if(o)var N=o(E,T,b,e,n,w);if(!(N===void 0?wke(T,E,Tke|Cke,o,w):N))return!1}}return!0}var Rke=Nke,Ake=nu;function Ike(e){return e===e&&!Ake(e)}var $Q=Ike,Oke=$Q,Pke=yT;function Dke(e){for(var n=Pke(e),a=n.length;a--;){var o=n[a],d=e[o];n[a]=[o,d,Oke(d)]}return n}var kke=Dke;function jke(e,n){return function(a){return a==null?!1:a[e]===n&&(n!==void 0||e in Object(a))}}var HQ=jke,Lke=Rke,Mke=kke,Uke=HQ;function Fke(e){var n=Mke(e);return n.length==1&&n[0][2]?Uke(n[0][0],n[0][1]):function(a){return a===e||Lke(a,e,n)}}var Vke=Fke;function Bke(e,n){return e!=null&&n in Object(e)}var Gke=Bke,Wke=QJ,$ke=I2,Hke=rs,zke=O2,Kke=P2,Yke=rT;function qke(e,n,a){n=Wke(n,e);for(var o=-1,d=n.length,p=!1;++o<d;){var m=Yke(n[o]);if(!(p=e!=null&&a(e,m)))break;e=e[m]}return p||++o!=d?p:(d=e==null?0:e.length,!!d&&Kke(d)&&zke(m,d)&&(Hke(e)||$ke(e)))}var Xke=qke,Jke=Gke,Qke=Xke;function Zke(e,n){return e!=null&&Qke(e,n,Jke)}var e2e=Zke,t2e=D2,n2e=ZJ,r2e=e2e,i2e=h2,a2e=$Q,s2e=HQ,o2e=rT,c2e=1,l2e=2;function d2e(e,n){return i2e(e)&&a2e(n)?s2e(o2e(e),n):function(a){var o=n2e(a,e);return o===void 0&&o===n?r2e(a,e):t2e(n,o,c2e|l2e)}}var u2e=d2e;function h2e(e){return e}var Qm=h2e;function p2e(e){return function(n){return n==null?void 0:n[e]}}var f2e=p2e,m2e=_2;function g2e(e){return function(n){return m2e(n,e)}}var v2e=g2e,y2e=f2e,_2e=v2e,b2e=h2,E2e=rT;function x2e(e){return b2e(e)?y2e(E2e(e)):_2e(e)}var S2e=x2e,w2e=Vke,T2e=u2e,C2e=Qm,N2e=rs,R2e=S2e;function A2e(e){return typeof e=="function"?e:e==null?C2e:typeof e=="object"?N2e(e)?T2e(e[0],e[1]):w2e(e):R2e(e)}var ru=A2e;function I2e(e,n,a,o){for(var d=e.length,p=a+(o?1:-1);o?p--:++p<d;)if(n(e[p],p,e))return p;return-1}var zQ=I2e;function O2e(e){return e!==e}var P2e=O2e;function D2e(e,n,a){for(var o=a-1,d=e.length;++o<d;)if(e[o]===n)return o;return-1}var k2e=D2e,j2e=zQ,L2e=P2e,M2e=k2e;function U2e(e,n,a){return n===n?M2e(e,n,a):j2e(e,L2e,a)}var F2e=U2e,V2e=F2e;function B2e(e,n){var a=e==null?0:e.length;return!!a&&V2e(e,n,0)>-1}var G2e=B2e;function W2e(e,n,a){for(var o=-1,d=e==null?0:e.length;++o<d;)if(a(n,e[o]))return!0;return!1}var $2e=W2e;function H2e(){}var z2e=H2e,$O=BQ,K2e=z2e,Y2e=A2,q2e=1/0,X2e=$O&&1/Y2e(new $O([,-0]))[1]==q2e?function(e){return new $O(e)}:K2e,J2e=X2e,Q2e=OQ,Z2e=G2e,eje=$2e,tje=DQ,nje=J2e,rje=A2,ije=200;function aje(e,n,a){var o=-1,d=Z2e,p=e.length,m=!0,y=[],b=y;if(a)m=!1,d=eje;else if(p>=ije){var E=n?null:nje(e);if(E)return rje(E);m=!1,d=tje,b=new Q2e}else b=n?[]:y;e:for(;++o<p;){var T=e[o],w=n?n(T):T;if(T=a||T!==0?T:0,m&&w===w){for(var N=b.length;N--;)if(b[N]===w)continue e;n&&b.push(w),y.push(T)}else d(b,w,a)||(b!==y&&b.push(w),y.push(T))}return y}var sje=aje,oje=ru,cje=sje;function lje(e,n){return e&&e.length?cje(e,oje(n)):[]}var dje=lje;const fz=ar(dje);function KQ(e,n,a){return n===!0?fz(e,a):hn(n)?fz(e,n):e}function dm(e){"@babel/helpers - typeof";return dm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},dm(e)}var uje=["ref"];function mz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function pl(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?mz(Object(a),!0).forEach(function(o){_T(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function hje(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function gz(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,qQ(o.key),o)}}function pje(e,n,a){return n&&gz(e.prototype,n),a&&gz(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function fje(e,n,a){return n=IS(n),mje(e,YQ()?Reflect.construct(n,a||[],IS(e).constructor):n.apply(e,a))}function mje(e,n){if(n&&(dm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gje(e)}function gje(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function YQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(YQ=function(){return!!e})()}function IS(e){return IS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},IS(e)}function vje(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&HP(e,n)}function HP(e,n){return HP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},HP(e,n)}function _T(e,n,a){return n=qQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function qQ(e){var n=yje(e,"string");return dm(n)=="symbol"?n:n+""}function yje(e,n){if(dm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(dm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function _je(e,n){if(e==null)return{};var a=bje(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function bje(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function Eje(e){return e.value}function xje(e,n){if(me.isValidElement(e))return me.cloneElement(e,n);if(typeof e=="function")return me.createElement(e,n);n.ref;var a=_je(n,uje);return me.createElement(R2,a)}var vz=1,Yf=function(e){function n(){var a;hje(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=fje(this,n,[].concat(d)),_T(a,"lastBoundingBox",{width:-1,height:-1}),a}return vje(n,e),pje(n,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();return o.height=this.wrapperNode.offsetHeight,o.width=this.wrapperNode.offsetWidth,o}return null}},{key:"updateBBox",value:function(){var o=this.props.onBBoxUpdate,d=this.getBBox();d?(Math.abs(d.width-this.lastBoundingBox.width)>vz||Math.abs(d.height-this.lastBoundingBox.height)>vz)&&(this.lastBoundingBox.width=d.width,this.lastBoundingBox.height=d.height,o&&o(d)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,o&&o(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?pl({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(o){var d=this.props,p=d.layout,m=d.align,y=d.verticalAlign,b=d.margin,E=d.chartWidth,T=d.chartHeight,w,N;if(!o||(o.left===void 0||o.left===null)&&(o.right===void 0||o.right===null))if(m==="center"&&p==="vertical"){var D=this.getBBoxSnapshot();w={left:((E||0)-D.width)/2}}else w=m==="right"?{right:b&&b.right||0}:{left:b&&b.left||0};if(!o||(o.top===void 0||o.top===null)&&(o.bottom===void 0||o.bottom===null))if(y==="middle"){var A=this.getBBoxSnapshot();N={top:((T||0)-A.height)/2}}else N=y==="bottom"?{bottom:b&&b.bottom||0}:{top:b&&b.top||0};return pl(pl({},w),N)}},{key:"render",value:function(){var o=this,d=this.props,p=d.content,m=d.width,y=d.height,b=d.wrapperStyle,E=d.payloadUniqBy,T=d.payload,w=pl(pl({position:"absolute",width:m||"auto",height:y||"auto"},this.getDefaultPosition(b)),b);return me.createElement("div",{className:"recharts-legend-wrapper",style:w,ref:function(D){o.wrapperNode=D}},xje(p,pl(pl({},this.props),{},{payload:KQ(T,E,Eje)})))}}],[{key:"getWithHeight",value:function(o,d){var p=pl(pl({},this.defaultProps),o.props),m=p.layout;return m==="vertical"&&ct(o.props.height)?{height:o.props.height}:m==="horizontal"?{width:o.props.width||d}:null}}])}(Y.PureComponent);_T(Yf,"displayName","Legend");_T(Yf,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var yz=k_,Sje=I2,wje=rs,_z=yz?yz.isConcatSpreadable:void 0;function Tje(e){return wje(e)||Sje(e)||!!(_z&&e&&e[_z])}var Cje=Tje,Nje=jQ,Rje=Cje;function XQ(e,n,a,o,d){var p=-1,m=e.length;for(a||(a=Rje),d||(d=[]);++p<m;){var y=e[p];n>0&&a(y)?n>1?XQ(y,n-1,a,o,d):Nje(d,y):o||(d[d.length]=y)}return d}var JQ=XQ;function Aje(e){return function(n,a,o){for(var d=-1,p=Object(n),m=o(n),y=m.length;y--;){var b=m[e?y:++d];if(a(p[b],b,p)===!1)break}return n}}var Ije=Aje,Oje=Ije,Pje=Oje(),Dje=Pje,kje=Dje,jje=yT;function Lje(e,n){return e&&kje(e,n,jje)}var QQ=Lje,Mje=j_;function Uje(e,n){return function(a,o){if(a==null)return a;if(!Mje(a))return e(a,o);for(var d=a.length,p=n?d:-1,m=Object(a);(n?p--:++p<d)&&o(m[p],p,m)!==!1;);return a}}var Fje=Uje,Vje=QQ,Bje=Fje,Gje=Bje(Vje),k2=Gje,Wje=k2,$je=j_;function Hje(e,n){var a=-1,o=$je(e)?Array(e.length):[];return Wje(e,function(d,p,m){o[++a]=n(d,p,m)}),o}var ZQ=Hje;function zje(e,n){var a=e.length;for(e.sort(n);a--;)e[a]=e[a].value;return e}var Kje=zje,bz=Wm;function Yje(e,n){if(e!==n){var a=e!==void 0,o=e===null,d=e===e,p=bz(e),m=n!==void 0,y=n===null,b=n===n,E=bz(n);if(!y&&!E&&!p&&e>n||p&&m&&b&&!y&&!E||o&&m&&b||!a&&b||!d)return 1;if(!o&&!p&&!E&&e<n||E&&a&&d&&!o&&!p||y&&a&&d||!m&&d||!b)return-1}return 0}var qje=Yje,Xje=qje;function Jje(e,n,a){for(var o=-1,d=e.criteria,p=n.criteria,m=d.length,y=a.length;++o<m;){var b=Xje(d[o],p[o]);if(b){if(o>=y)return b;var E=a[o];return b*(E=="desc"?-1:1)}}return e.index-n.index}var Qje=Jje,HO=y2,Zje=_2,eLe=ru,tLe=ZQ,nLe=Kje,rLe=UQ,iLe=Qje,aLe=Qm,sLe=rs;function oLe(e,n,a){n.length?n=HO(n,function(p){return sLe(p)?function(m){return Zje(m,p.length===1?p[0]:p)}:p}):n=[aLe];var o=-1;n=HO(n,rLe(eLe));var d=tLe(e,function(p,m,y){var b=HO(n,function(E){return E(p)});return{criteria:b,index:++o,value:p}});return nLe(d,function(p,m){return iLe(p,m,a)})}var cLe=oLe;function lLe(e,n,a){switch(a.length){case 0:return e.call(n);case 1:return e.call(n,a[0]);case 2:return e.call(n,a[0],a[1]);case 3:return e.call(n,a[0],a[1],a[2])}return e.apply(n,a)}var dLe=lLe,uLe=dLe,Ez=Math.max;function hLe(e,n,a){return n=Ez(n===void 0?e.length-1:n,0),function(){for(var o=arguments,d=-1,p=Ez(o.length-n,0),m=Array(p);++d<p;)m[d]=o[n+d];d=-1;for(var y=Array(n+1);++d<n;)y[d]=o[d];return y[n]=a(m),uLe(e,this,y)}}var pLe=hLe;function fLe(e){return function(){return e}}var mLe=fLe,gLe=$h,vLe=function(){try{var e=gLe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),eZ=vLe,yLe=mLe,xz=eZ,_Le=Qm,bLe=xz?function(e,n){return xz(e,"toString",{configurable:!0,enumerable:!1,value:yLe(n),writable:!0})}:_Le,ELe=bLe,xLe=800,SLe=16,wLe=Date.now;function TLe(e){var n=0,a=0;return function(){var o=wLe(),d=SLe-(o-a);if(a=o,d>0){if(++n>=xLe)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}var CLe=TLe,NLe=ELe,RLe=CLe,ALe=RLe(NLe),ILe=ALe,OLe=Qm,PLe=pLe,DLe=ILe;function kLe(e,n){return DLe(PLe(e,n,OLe),e+"")}var jLe=kLe,LLe=f2,MLe=j_,ULe=O2,FLe=nu;function VLe(e,n,a){if(!FLe(a))return!1;var o=typeof n;return(o=="number"?MLe(a)&&ULe(n,a.length):o=="string"&&n in a)?LLe(a[n],e):!1}var bT=VLe,BLe=JQ,GLe=cLe,WLe=jLe,Sz=bT,$Le=WLe(function(e,n){if(e==null)return[];var a=n.length;return a>1&&Sz(e,n[0],n[1])?n=[]:a>2&&Sz(n[0],n[1],n[2])&&(n=[n[0]]),GLe(e,BLe(n,1),[])}),HLe=$Le;const j2=ar(HLe);function By(e){"@babel/helpers - typeof";return By=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},By(e)}function zP(){return zP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},zP.apply(this,arguments)}function zLe(e,n){return XLe(e)||qLe(e,n)||YLe(e,n)||KLe()}function KLe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YLe(e,n){if(e){if(typeof e=="string")return wz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return wz(e,n)}}function wz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function qLe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function XLe(e){if(Array.isArray(e))return e}function Tz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function zO(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Tz(Object(a),!0).forEach(function(o){JLe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Tz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function JLe(e,n,a){return n=QLe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function QLe(e){var n=ZLe(e,"string");return By(n)=="symbol"?n:n+""}function ZLe(e,n){if(By(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(By(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function eMe(e){return Array.isArray(e)&&bi(e[0])&&bi(e[1])?e.join(" ~ "):e}var tMe=function(n){var a=n.separator,o=a===void 0?" : ":a,d=n.contentStyle,p=d===void 0?{}:d,m=n.itemStyle,y=m===void 0?{}:m,b=n.labelStyle,E=b===void 0?{}:b,T=n.payload,w=n.formatter,N=n.itemSorter,D=n.wrapperClassName,A=n.labelClassName,k=n.label,O=n.labelFormatter,F=n.accessibilityLayer,M=F===void 0?!1:F,V=function(){if(T&&T.length){var ue={padding:0,margin:0},Se=(N?j2(T,N):T).map(function(fe,we){if(fe.type==="none")return null;var he=zO({display:"block",paddingTop:4,paddingBottom:4,color:fe.color||"#000"},y),be=fe.formatter||w||eMe,ae=fe.value,de=fe.name,xe=ae,Ue=de;if(be&&xe!=null&&Ue!=null){var Me=be(ae,de,fe,we,T);if(Array.isArray(Me)){var et=zLe(Me,2);xe=et[0],Ue=et[1]}else xe=Me}return me.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(we),style:he},bi(Ue)?me.createElement("span",{className:"recharts-tooltip-item-name"},Ue):null,bi(Ue)?me.createElement("span",{className:"recharts-tooltip-item-separator"},o):null,me.createElement("span",{className:"recharts-tooltip-item-value"},xe),me.createElement("span",{className:"recharts-tooltip-item-unit"},fe.unit||""))});return me.createElement("ul",{className:"recharts-tooltip-item-list",style:ue},Se)}return null},H=zO({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},p),B=zO({margin:0},E),z=!_n(k),q=z?k:"",Q=On("recharts-default-tooltip",D),ee=On("recharts-tooltip-label",A);z&&O&&T!==void 0&&T!==null&&(q=O(k,T));var oe=M?{role:"status","aria-live":"assertive"}:{};return me.createElement("div",zP({className:Q,style:H},oe),me.createElement("p",{className:ee,style:B},me.isValidElement(q)?q:"".concat(q)),V())};function Gy(e){"@babel/helpers - typeof";return Gy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Gy(e)}function lx(e,n,a){return n=nMe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function nMe(e){var n=rMe(e,"string");return Gy(n)=="symbol"?n:n+""}function rMe(e,n){if(Gy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Gy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Gv="recharts-tooltip-wrapper",iMe={visibility:"hidden"};function aMe(e){var n=e.coordinate,a=e.translateX,o=e.translateY;return On(Gv,lx(lx(lx(lx({},"".concat(Gv,"-right"),ct(a)&&n&&ct(n.x)&&a>=n.x),"".concat(Gv,"-left"),ct(a)&&n&&ct(n.x)&&a<n.x),"".concat(Gv,"-bottom"),ct(o)&&n&&ct(n.y)&&o>=n.y),"".concat(Gv,"-top"),ct(o)&&n&&ct(n.y)&&o<n.y))}function Cz(e){var n=e.allowEscapeViewBox,a=e.coordinate,o=e.key,d=e.offsetTopLeft,p=e.position,m=e.reverseDirection,y=e.tooltipDimension,b=e.viewBox,E=e.viewBoxDimension;if(p&&ct(p[o]))return p[o];var T=a[o]-y-d,w=a[o]+d;if(n[o])return m[o]?T:w;if(m[o]){var N=T,D=b[o];return N<D?Math.max(w,b[o]):Math.max(T,b[o])}var A=w+y,k=b[o]+E;return A>k?Math.max(T,b[o]):Math.max(w,b[o])}function sMe(e){var n=e.translateX,a=e.translateY,o=e.useTranslate3d;return{transform:o?"translate3d(".concat(n,"px, ").concat(a,"px, 0)"):"translate(".concat(n,"px, ").concat(a,"px)")}}function oMe(e){var n=e.allowEscapeViewBox,a=e.coordinate,o=e.offsetTopLeft,d=e.position,p=e.reverseDirection,m=e.tooltipBox,y=e.useTranslate3d,b=e.viewBox,E,T,w;return m.height>0&&m.width>0&&a?(T=Cz({allowEscapeViewBox:n,coordinate:a,key:"x",offsetTopLeft:o,position:d,reverseDirection:p,tooltipDimension:m.width,viewBox:b,viewBoxDimension:b.width}),w=Cz({allowEscapeViewBox:n,coordinate:a,key:"y",offsetTopLeft:o,position:d,reverseDirection:p,tooltipDimension:m.height,viewBox:b,viewBoxDimension:b.height}),E=sMe({translateX:T,translateY:w,useTranslate3d:y})):E=iMe,{cssProperties:E,cssClasses:aMe({translateX:T,translateY:w,coordinate:a})}}function um(e){"@babel/helpers - typeof";return um=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},um(e)}function Nz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Rz(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Nz(Object(a),!0).forEach(function(o){YP(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Nz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function cMe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function lMe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,nZ(o.key),o)}}function dMe(e,n,a){return n&&lMe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function uMe(e,n,a){return n=OS(n),hMe(e,tZ()?Reflect.construct(n,a||[],OS(e).constructor):n.apply(e,a))}function hMe(e,n){if(n&&(um(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pMe(e)}function pMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tZ=function(){return!!e})()}function OS(e){return OS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},OS(e)}function fMe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&KP(e,n)}function KP(e,n){return KP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},KP(e,n)}function YP(e,n,a){return n=nZ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function nZ(e){var n=mMe(e,"string");return um(n)=="symbol"?n:n+""}function mMe(e,n){if(um(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(um(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Az=1,gMe=function(e){function n(){var a;cMe(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=uMe(this,n,[].concat(d)),YP(a,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),YP(a,"handleKeyDown",function(m){if(m.key==="Escape"){var y,b,E,T;a.setState({dismissed:!0,dismissedAtCoordinate:{x:(y=(b=a.props.coordinate)===null||b===void 0?void 0:b.x)!==null&&y!==void 0?y:0,y:(E=(T=a.props.coordinate)===null||T===void 0?void 0:T.y)!==null&&E!==void 0?E:0}})}}),a}return fMe(n,e),dMe(n,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();(Math.abs(o.width-this.state.lastBoundingBox.width)>Az||Math.abs(o.height-this.state.lastBoundingBox.height)>Az)&&this.setState({lastBoundingBox:{width:o.width,height:o.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var o,d;this.props.active&&this.updateBBox(),this.state.dismissed&&(((o=this.props.coordinate)===null||o===void 0?void 0:o.x)!==this.state.dismissedAtCoordinate.x||((d=this.props.coordinate)===null||d===void 0?void 0:d.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var o=this,d=this.props,p=d.active,m=d.allowEscapeViewBox,y=d.animationDuration,b=d.animationEasing,E=d.children,T=d.coordinate,w=d.hasPayload,N=d.isAnimationActive,D=d.offset,A=d.position,k=d.reverseDirection,O=d.useTranslate3d,F=d.viewBox,M=d.wrapperStyle,V=oMe({allowEscapeViewBox:m,coordinate:T,offsetTopLeft:D,position:A,reverseDirection:k,tooltipBox:this.state.lastBoundingBox,useTranslate3d:O,viewBox:F}),H=V.cssClasses,B=V.cssProperties,z=Rz(Rz({transition:N&&p?"transform ".concat(y,"ms ").concat(b):void 0},B),{},{pointerEvents:"none",visibility:!this.state.dismissed&&p&&w?"visible":"hidden",position:"absolute",top:0,left:0},M);return me.createElement("div",{tabIndex:-1,className:H,style:z,ref:function(Q){o.wrapperNode=Q}},E)}}])}(Y.PureComponent),vMe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Hh={isSsr:vMe()};function hm(e){"@babel/helpers - typeof";return hm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},hm(e)}function Iz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Oz(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Iz(Object(a),!0).forEach(function(o){L2(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Iz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function yMe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _Me(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,iZ(o.key),o)}}function bMe(e,n,a){return n&&_Me(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function EMe(e,n,a){return n=PS(n),xMe(e,rZ()?Reflect.construct(n,a||[],PS(e).constructor):n.apply(e,a))}function xMe(e,n){if(n&&(hm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SMe(e)}function SMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rZ=function(){return!!e})()}function PS(e){return PS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},PS(e)}function wMe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&qP(e,n)}function qP(e,n){return qP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},qP(e,n)}function L2(e,n,a){return n=iZ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function iZ(e){var n=TMe(e,"string");return hm(n)=="symbol"?n:n+""}function TMe(e,n){if(hm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(hm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function CMe(e){return e.dataKey}function NMe(e,n){return me.isValidElement(e)?me.cloneElement(e,n):typeof e=="function"?me.createElement(e,n):me.createElement(tMe,n)}var Es=function(e){function n(){return yMe(this,n),EMe(this,n,arguments)}return wMe(n,e),bMe(n,[{key:"render",value:function(){var o=this,d=this.props,p=d.active,m=d.allowEscapeViewBox,y=d.animationDuration,b=d.animationEasing,E=d.content,T=d.coordinate,w=d.filterNull,N=d.isAnimationActive,D=d.offset,A=d.payload,k=d.payloadUniqBy,O=d.position,F=d.reverseDirection,M=d.useTranslate3d,V=d.viewBox,H=d.wrapperStyle,B=A??[];w&&B.length&&(B=KQ(A.filter(function(q){return q.value!=null&&(q.hide!==!0||o.props.includeHidden)}),k,CMe));var z=B.length>0;return me.createElement(gMe,{allowEscapeViewBox:m,animationDuration:y,animationEasing:b,isAnimationActive:N,active:p,coordinate:T,hasPayload:z,offset:D,position:O,reverseDirection:F,useTranslate3d:M,viewBox:V,wrapperStyle:H},NMe(E,Oz(Oz({},this.props),{},{payload:B})))}}])}(Y.PureComponent);L2(Es,"displayName","Tooltip");L2(Es,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Hh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var RMe=Xc,AMe=function(){return RMe.Date.now()},IMe=AMe,OMe=/\s/;function PMe(e){for(var n=e.length;n--&&OMe.test(e.charAt(n)););return n}var DMe=PMe,kMe=DMe,jMe=/^\s+/;function LMe(e){return e&&e.slice(0,kMe(e)+1).replace(jMe,"")}var MMe=LMe,UMe=MMe,Pz=nu,FMe=Wm,Dz=NaN,VMe=/^[-+]0x[0-9a-f]+$/i,BMe=/^0b[01]+$/i,GMe=/^0o[0-7]+$/i,WMe=parseInt;function $Me(e){if(typeof e=="number")return e;if(FMe(e))return Dz;if(Pz(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=Pz(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=UMe(e);var a=BMe.test(e);return a||GMe.test(e)?WMe(e.slice(2),a?2:8):VMe.test(e)?Dz:+e}var aZ=$Me,HMe=nu,KO=IMe,kz=aZ,zMe="Expected a function",KMe=Math.max,YMe=Math.min;function qMe(e,n,a){var o,d,p,m,y,b,E=0,T=!1,w=!1,N=!0;if(typeof e!="function")throw new TypeError(zMe);n=kz(n)||0,HMe(a)&&(T=!!a.leading,w="maxWait"in a,p=w?KMe(kz(a.maxWait)||0,n):p,N="trailing"in a?!!a.trailing:N);function D(z){var q=o,Q=d;return o=d=void 0,E=z,m=e.apply(Q,q),m}function A(z){return E=z,y=setTimeout(F,n),T?D(z):m}function k(z){var q=z-b,Q=z-E,ee=n-q;return w?YMe(ee,p-Q):ee}function O(z){var q=z-b,Q=z-E;return b===void 0||q>=n||q<0||w&&Q>=p}function F(){var z=KO();if(O(z))return M(z);y=setTimeout(F,k(z))}function M(z){return y=void 0,N&&o?D(z):(o=d=void 0,m)}function V(){y!==void 0&&clearTimeout(y),E=0,o=b=d=y=void 0}function H(){return y===void 0?m:M(KO())}function B(){var z=KO(),q=O(z);if(o=arguments,d=this,b=z,q){if(y===void 0)return A(b);if(w)return clearTimeout(y),y=setTimeout(F,n),D(b)}return y===void 0&&(y=setTimeout(F,n)),m}return B.cancel=V,B.flush=H,B}var XMe=qMe,JMe=XMe,QMe=nu,ZMe="Expected a function";function eUe(e,n,a){var o=!0,d=!0;if(typeof e!="function")throw new TypeError(ZMe);return QMe(a)&&(o="leading"in a?!!a.leading:o,d="trailing"in a?!!a.trailing:d),JMe(e,n,{leading:o,maxWait:n,trailing:d})}var tUe=eUe;const sZ=ar(tUe);function Wy(e){"@babel/helpers - typeof";return Wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Wy(e)}function jz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function dx(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?jz(Object(a),!0).forEach(function(o){nUe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):jz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function nUe(e,n,a){return n=rUe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function rUe(e){var n=iUe(e,"string");return Wy(n)=="symbol"?n:n+""}function iUe(e,n){if(Wy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Wy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function aUe(e,n){return lUe(e)||cUe(e,n)||oUe(e,n)||sUe()}function sUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oUe(e,n){if(e){if(typeof e=="string")return Lz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Lz(e,n)}}function Lz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function cUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function lUe(e){if(Array.isArray(e))return e}var DS=Y.forwardRef(function(e,n){var a=e.aspect,o=e.initialDimension,d=o===void 0?{width:-1,height:-1}:o,p=e.width,m=p===void 0?"100%":p,y=e.height,b=y===void 0?"100%":y,E=e.minWidth,T=E===void 0?0:E,w=e.minHeight,N=e.maxHeight,D=e.children,A=e.debounce,k=A===void 0?0:A,O=e.id,F=e.className,M=e.onResize,V=e.style,H=V===void 0?{}:V,B=Y.useRef(null),z=Y.useRef();z.current=M,Y.useImperativeHandle(n,function(){return Object.defineProperty(B.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),B.current},configurable:!0})});var q=Y.useState({containerWidth:d.width,containerHeight:d.height}),Q=aUe(q,2),ee=Q[0],oe=Q[1],ne=Y.useCallback(function(Se,fe){oe(function(we){var he=Math.round(Se),be=Math.round(fe);return we.containerWidth===he&&we.containerHeight===be?we:{containerWidth:he,containerHeight:be}})},[]);Y.useEffect(function(){var Se=function(de){var xe,Ue=de[0].contentRect,Me=Ue.width,et=Ue.height;ne(Me,et),(xe=z.current)===null||xe===void 0||xe.call(z,Me,et)};k>0&&(Se=sZ(Se,k,{trailing:!0,leading:!1}));var fe=new ResizeObserver(Se),we=B.current.getBoundingClientRect(),he=we.width,be=we.height;return ne(he,be),fe.observe(B.current),function(){fe.disconnect()}},[ne,k]);var ue=Y.useMemo(function(){var Se=ee.containerWidth,fe=ee.containerHeight;if(Se<0||fe<0)return null;Tl(vh(m)||vh(b),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,m,b),Tl(!a||a>0,"The aspect(%s) must be greater than zero.",a);var we=vh(m)?Se:m,he=vh(b)?fe:b;a&&a>0&&(we?he=we/a:he&&(we=he*a),N&&he>N&&(he=N)),Tl(we>0||he>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,we,he,m,b,T,w,a);var be=!Array.isArray(D)&&wl(D.type).endsWith("Chart");return me.Children.map(D,function(ae){return me.isValidElement(ae)?Y.cloneElement(ae,dx({width:we,height:he},be?{style:dx({height:"100%",width:"100%",maxHeight:he,maxWidth:we},ae.props.style)}:{})):ae})},[a,D,b,N,w,T,ee,m]);return me.createElement("div",{id:O?"".concat(O):void 0,className:On("recharts-responsive-container",F),style:dx(dx({},H),{},{width:m,height:b,minWidth:T,minHeight:w,maxHeight:N}),ref:B},ue)}),oZ=function(n){return null};oZ.displayName="Cell";function $y(e){"@babel/helpers - typeof";return $y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$y(e)}function Mz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function XP(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Mz(Object(a),!0).forEach(function(o){dUe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Mz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function dUe(e,n,a){return n=uUe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function uUe(e){var n=hUe(e,"string");return $y(n)=="symbol"?n:n+""}function hUe(e,n){if($y(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if($y(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var _f={widthCache:{},cacheCount:0},pUe=2e3,fUe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},Uz="recharts_measurement_span";function mUe(e){var n=XP({},e);return Object.keys(n).forEach(function(a){n[a]||delete n[a]}),n}var fy=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n==null||Hh.isSsr)return{width:0,height:0};var o=mUe(a),d=JSON.stringify({text:n,copyStyle:o});if(_f.widthCache[d])return _f.widthCache[d];try{var p=document.getElementById(Uz);p||(p=document.createElement("span"),p.setAttribute("id",Uz),p.setAttribute("aria-hidden","true"),document.body.appendChild(p));var m=XP(XP({},fUe),o);Object.assign(p.style,m),p.textContent="".concat(n);var y=p.getBoundingClientRect(),b={width:y.width,height:y.height};return _f.widthCache[d]=b,++_f.cacheCount>pUe&&(_f.cacheCount=0,_f.widthCache={}),b}catch{return{width:0,height:0}}},gUe=function(n){return{top:n.top+window.scrollY-document.documentElement.clientTop,left:n.left+window.scrollX-document.documentElement.clientLeft}};function Hy(e){"@babel/helpers - typeof";return Hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Hy(e)}function kS(e,n){return bUe(e)||_Ue(e,n)||yUe(e,n)||vUe()}function vUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yUe(e,n){if(e){if(typeof e=="string")return Fz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fz(e,n)}}function Fz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function _Ue(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n===0){if(Object(a)!==a)return;b=!1}else for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function bUe(e){if(Array.isArray(e))return e}function EUe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Vz(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,SUe(o.key),o)}}function xUe(e,n,a){return n&&Vz(e.prototype,n),a&&Vz(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function SUe(e){var n=wUe(e,"string");return Hy(n)=="symbol"?n:n+""}function wUe(e,n){if(Hy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Hy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Bz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Gz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,TUe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,CUe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,cZ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},NUe=Object.keys(cZ),Uf="NaN";function RUe(e,n){return e*cZ[n]}var ux=function(){function e(n,a){EUe(this,e),this.num=n,this.unit=a,this.num=n,this.unit=a,Number.isNaN(n)&&(this.unit=""),a!==""&&!TUe.test(a)&&(this.num=NaN,this.unit=""),NUe.includes(a)&&(this.num=RUe(n,a),this.unit="px")}return xUe(e,[{key:"add",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num+a.num,this.unit)}},{key:"subtract",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num-a.num,this.unit)}},{key:"multiply",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num*a.num,this.unit||a.unit)}},{key:"divide",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num/a.num,this.unit||a.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(a){var o,d=(o=CUe.exec(a))!==null&&o!==void 0?o:[],p=kS(d,3),m=p[1],y=p[2];return new e(parseFloat(m),y??"")}}])}();function lZ(e){if(e.includes(Uf))return Uf;for(var n=e;n.includes("*")||n.includes("/");){var a,o=(a=Bz.exec(n))!==null&&a!==void 0?a:[],d=kS(o,4),p=d[1],m=d[2],y=d[3],b=ux.parse(p??""),E=ux.parse(y??""),T=m==="*"?b.multiply(E):b.divide(E);if(T.isNaN())return Uf;n=n.replace(Bz,T.toString())}for(;n.includes("+")||/.-\d+(?:\.\d+)?/.test(n);){var w,N=(w=Gz.exec(n))!==null&&w!==void 0?w:[],D=kS(N,4),A=D[1],k=D[2],O=D[3],F=ux.parse(A??""),M=ux.parse(O??""),V=k==="+"?F.add(M):F.subtract(M);if(V.isNaN())return Uf;n=n.replace(Gz,V.toString())}return n}var Wz=/\(([^()]*)\)/;function AUe(e){for(var n=e;n.includes("(");){var a=Wz.exec(n),o=kS(a,2),d=o[1];n=n.replace(Wz,lZ(d))}return n}function IUe(e){var n=e.replace(/\s+/g,"");return n=AUe(n),n=lZ(n),n}function OUe(e){try{return IUe(e)}catch{return Uf}}function YO(e){var n=OUe(e.slice(5,-1));return n===Uf?"":n}var PUe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],DUe=["dx","dy","angle","className","breakAll"];function JP(){return JP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},JP.apply(this,arguments)}function $z(e,n){if(e==null)return{};var a=kUe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function kUe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function Hz(e,n){return UUe(e)||MUe(e,n)||LUe(e,n)||jUe()}function jUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LUe(e,n){if(e){if(typeof e=="string")return zz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return zz(e,n)}}function zz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function MUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n===0){if(Object(a)!==a)return;b=!1}else for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function UUe(e){if(Array.isArray(e))return e}var dZ=/[ \f\n\r\t\v\u2028\u2029]+/,uZ=function(n){var a=n.children,o=n.breakAll,d=n.style;try{var p=[];_n(a)||(o?p=a.toString().split(""):p=a.toString().split(dZ));var m=p.map(function(b){return{word:b,width:fy(b,d).width}}),y=o?0:fy("",d).width;return{wordsWithComputedWidth:m,spaceWidth:y}}catch{return null}},FUe=function(n,a,o,d,p){var m=n.maxLines,y=n.children,b=n.style,E=n.breakAll,T=ct(m),w=y,N=function(){var we=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return we.reduce(function(he,be){var ae=be.word,de=be.width,xe=he[he.length-1];if(xe&&(d==null||p||xe.width+de+o<Number(d)))xe.words.push(ae),xe.width+=de+o;else{var Ue={words:[ae],width:de};he.push(Ue)}return he},[])},D=N(a),A=function(we){return we.reduce(function(he,be){return he.width>be.width?he:be})};if(!T)return D;for(var k="",O=function(we){var he=w.slice(0,we),be=uZ({breakAll:E,style:b,children:he+k}).wordsWithComputedWidth,ae=N(be),de=ae.length>m||A(ae).width>Number(d);return[de,ae]},F=0,M=w.length-1,V=0,H;F<=M&&V<=w.length-1;){var B=Math.floor((F+M)/2),z=B-1,q=O(z),Q=Hz(q,2),ee=Q[0],oe=Q[1],ne=O(B),ue=Hz(ne,1),Se=ue[0];if(!ee&&!Se&&(F=B+1),ee&&Se&&(M=B-1),!ee&&Se){H=oe;break}V++}return H||D},Kz=function(n){var a=_n(n)?[]:n.toString().split(dZ);return[{words:a}]},VUe=function(n){var a=n.width,o=n.scaleToFit,d=n.children,p=n.style,m=n.breakAll,y=n.maxLines;if((a||o)&&!Hh.isSsr){var b,E,T=uZ({breakAll:m,children:d,style:p});if(T){var w=T.wordsWithComputedWidth,N=T.spaceWidth;b=w,E=N}else return Kz(d);return FUe({breakAll:m,children:d,maxLines:y,style:p},b,E,a,o)}return Kz(d)},Yz="#808080",jS=function(n){var a=n.x,o=a===void 0?0:a,d=n.y,p=d===void 0?0:d,m=n.lineHeight,y=m===void 0?"1em":m,b=n.capHeight,E=b===void 0?"0.71em":b,T=n.scaleToFit,w=T===void 0?!1:T,N=n.textAnchor,D=N===void 0?"start":N,A=n.verticalAnchor,k=A===void 0?"end":A,O=n.fill,F=O===void 0?Yz:O,M=$z(n,PUe),V=Y.useMemo(function(){return VUe({breakAll:M.breakAll,children:M.children,maxLines:M.maxLines,scaleToFit:w,style:M.style,width:M.width})},[M.breakAll,M.children,M.maxLines,w,M.style,M.width]),H=M.dx,B=M.dy,z=M.angle,q=M.className,Q=M.breakAll,ee=$z(M,DUe);if(!bi(o)||!bi(p))return null;var oe=o+(ct(H)?H:0),ne=p+(ct(B)?B:0),ue;switch(k){case"start":ue=YO("calc(".concat(E,")"));break;case"middle":ue=YO("calc(".concat((V.length-1)/2," * -").concat(y," + (").concat(E," / 2))"));break;default:ue=YO("calc(".concat(V.length-1," * -").concat(y,")"));break}var Se=[];if(w){var fe=V[0].width,we=M.width;Se.push("scale(".concat((ct(we)?we/fe:1)/fe,")"))}return z&&Se.push("rotate(".concat(z,", ").concat(oe,", ").concat(ne,")")),Se.length&&(ee.transform=Se.join(" ")),me.createElement("text",JP({},vn(ee,!0),{x:oe,y:ne,className:On("recharts-text",q),textAnchor:D,fill:F.includes("url")?Yz:F}),V.map(function(he,be){var ae=he.words.join(Q?"":" ");return me.createElement("tspan",{x:oe,dy:be===0?ue:y,key:"".concat(ae,"-").concat(be)},ae)}))};function zd(e,n){return e==null||n==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function BUe(e,n){return e==null||n==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function M2(e){let n,a,o;e.length!==2?(n=zd,a=(y,b)=>zd(e(y),b),o=(y,b)=>e(y)-b):(n=e===zd||e===BUe?e:GUe,a=e,o=e);function d(y,b,E=0,T=y.length){if(E<T){if(n(b,b)!==0)return T;do{const w=E+T>>>1;a(y[w],b)<0?E=w+1:T=w}while(E<T)}return E}function p(y,b,E=0,T=y.length){if(E<T){if(n(b,b)!==0)return T;do{const w=E+T>>>1;a(y[w],b)<=0?E=w+1:T=w}while(E<T)}return E}function m(y,b,E=0,T=y.length){const w=d(y,b,E,T-1);return w>E&&o(y[w-1],b)>-o(y[w],b)?w-1:w}return{left:d,center:m,right:p}}function GUe(){return 0}function hZ(e){return e===null?NaN:+e}function*WUe(e,n){for(let a of e)a!=null&&(a=+a)>=a&&(yield a)}const $Ue=M2(zd),L_=$Ue.right;M2(hZ).center;class qz extends Map{constructor(n,a=KUe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:a}}),n!=null)for(const[o,d]of n)this.set(o,d)}get(n){return super.get(Xz(this,n))}has(n){return super.has(Xz(this,n))}set(n,a){return super.set(HUe(this,n),a)}delete(n){return super.delete(zUe(this,n))}}function Xz({_intern:e,_key:n},a){const o=n(a);return e.has(o)?e.get(o):a}function HUe({_intern:e,_key:n},a){const o=n(a);return e.has(o)?e.get(o):(e.set(o,a),a)}function zUe({_intern:e,_key:n},a){const o=n(a);return e.has(o)&&(a=e.get(o),e.delete(o)),a}function KUe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function YUe(e=zd){if(e===zd)return pZ;if(typeof e!="function")throw new TypeError("compare is not a function");return(n,a)=>{const o=e(n,a);return o||o===0?o:(e(a,a)===0)-(e(n,n)===0)}}function pZ(e,n){return(e==null||!(e>=e))-(n==null||!(n>=n))||(e<n?-1:e>n?1:0)}const qUe=Math.sqrt(50),XUe=Math.sqrt(10),JUe=Math.sqrt(2);function LS(e,n,a){const o=(n-e)/Math.max(0,a),d=Math.floor(Math.log10(o)),p=o/Math.pow(10,d),m=p>=qUe?10:p>=XUe?5:p>=JUe?2:1;let y,b,E;return d<0?(E=Math.pow(10,-d)/m,y=Math.round(e*E),b=Math.round(n*E),y/E<e&&++y,b/E>n&&--b,E=-E):(E=Math.pow(10,d)*m,y=Math.round(e/E),b=Math.round(n/E),y*E<e&&++y,b*E>n&&--b),b<y&&.5<=a&&a<2?LS(e,n,a*2):[y,b,E]}function QP(e,n,a){if(n=+n,e=+e,a=+a,!(a>0))return[];if(e===n)return[e];const o=n<e,[d,p,m]=o?LS(n,e,a):LS(e,n,a);if(!(p>=d))return[];const y=p-d+1,b=new Array(y);if(o)if(m<0)for(let E=0;E<y;++E)b[E]=(p-E)/-m;else for(let E=0;E<y;++E)b[E]=(p-E)*m;else if(m<0)for(let E=0;E<y;++E)b[E]=(d+E)/-m;else for(let E=0;E<y;++E)b[E]=(d+E)*m;return b}function ZP(e,n,a){return n=+n,e=+e,a=+a,LS(e,n,a)[2]}function eD(e,n,a){n=+n,e=+e,a=+a;const o=n<e,d=o?ZP(n,e,a):ZP(e,n,a);return(o?-1:1)*(d<0?1/-d:d)}function Jz(e,n){let a;for(const o of e)o!=null&&(a<o||a===void 0&&o>=o)&&(a=o);return a}function Qz(e,n){let a;for(const o of e)o!=null&&(a>o||a===void 0&&o>=o)&&(a=o);return a}function fZ(e,n,a=0,o=1/0,d){if(n=Math.floor(n),a=Math.floor(Math.max(0,a)),o=Math.floor(Math.min(e.length-1,o)),!(a<=n&&n<=o))return e;for(d=d===void 0?pZ:YUe(d);o>a;){if(o-a>600){const b=o-a+1,E=n-a+1,T=Math.log(b),w=.5*Math.exp(2*T/3),N=.5*Math.sqrt(T*w*(b-w)/b)*(E-b/2<0?-1:1),D=Math.max(a,Math.floor(n-E*w/b+N)),A=Math.min(o,Math.floor(n+(b-E)*w/b+N));fZ(e,n,D,A,d)}const p=e[n];let m=a,y=o;for(Wv(e,a,n),d(e[o],p)>0&&Wv(e,a,o);m<y;){for(Wv(e,m,y),++m,--y;d(e[m],p)<0;)++m;for(;d(e[y],p)>0;)--y}d(e[a],p)===0?Wv(e,a,y):(++y,Wv(e,y,o)),y<=n&&(a=y+1),n<=y&&(o=y-1)}return e}function Wv(e,n,a){const o=e[n];e[n]=e[a],e[a]=o}function QUe(e,n,a){if(e=Float64Array.from(WUe(e)),!(!(o=e.length)||isNaN(n=+n))){if(n<=0||o<2)return Qz(e);if(n>=1)return Jz(e);var o,d=(o-1)*n,p=Math.floor(d),m=Jz(fZ(e,p).subarray(0,p+1)),y=Qz(e.subarray(p+1));return m+(y-m)*(d-p)}}function ZUe(e,n,a=hZ){if(!(!(o=e.length)||isNaN(n=+n))){if(n<=0||o<2)return+a(e[0],0,e);if(n>=1)return+a(e[o-1],o-1,e);var o,d=(o-1)*n,p=Math.floor(d),m=+a(e[p],p,e),y=+a(e[p+1],p+1,e);return m+(y-m)*(d-p)}}function e5e(e,n,a){e=+e,n=+n,a=(d=arguments.length)<2?(n=e,e=0,1):d<3?1:+a;for(var o=-1,d=Math.max(0,Math.ceil((n-e)/a))|0,p=new Array(d);++o<d;)p[o]=e+o*a;return p}function _o(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function Bl(e,n){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof n=="function"?this.interpolator(n):this.range(n);break}}return this}const tD=Symbol("implicit");function U2(){var e=new qz,n=[],a=[],o=tD;function d(p){let m=e.get(p);if(m===void 0){if(o!==tD)return o;e.set(p,m=n.push(p)-1)}return a[m%a.length]}return d.domain=function(p){if(!arguments.length)return n.slice();n=[],e=new qz;for(const m of p)e.has(m)||e.set(m,n.push(m)-1);return d},d.range=function(p){return arguments.length?(a=Array.from(p),d):a.slice()},d.unknown=function(p){return arguments.length?(o=p,d):o},d.copy=function(){return U2(n,a).unknown(o)},_o.apply(d,arguments),d}function zy(){var e=U2().unknown(void 0),n=e.domain,a=e.range,o=0,d=1,p,m,y=!1,b=0,E=0,T=.5;delete e.unknown;function w(){var N=n().length,D=d<o,A=D?d:o,k=D?o:d;p=(k-A)/Math.max(1,N-b+E*2),y&&(p=Math.floor(p)),A+=(k-A-p*(N-b))*T,m=p*(1-b),y&&(A=Math.round(A),m=Math.round(m));var O=e5e(N).map(function(F){return A+p*F});return a(D?O.reverse():O)}return e.domain=function(N){return arguments.length?(n(N),w()):n()},e.range=function(N){return arguments.length?([o,d]=N,o=+o,d=+d,w()):[o,d]},e.rangeRound=function(N){return[o,d]=N,o=+o,d=+d,y=!0,w()},e.bandwidth=function(){return m},e.step=function(){return p},e.round=function(N){return arguments.length?(y=!!N,w()):y},e.padding=function(N){return arguments.length?(b=Math.min(1,E=+N),w()):b},e.paddingInner=function(N){return arguments.length?(b=Math.min(1,N),w()):b},e.paddingOuter=function(N){return arguments.length?(E=+N,w()):E},e.align=function(N){return arguments.length?(T=Math.max(0,Math.min(1,N)),w()):T},e.copy=function(){return zy(n(),[o,d]).round(y).paddingInner(b).paddingOuter(E).align(T)},_o.apply(w(),arguments)}function mZ(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return mZ(n())},e}function my(){return mZ(zy.apply(null,arguments).paddingInner(1))}function F2(e,n,a){e.prototype=n.prototype=a,a.constructor=e}function gZ(e,n){var a=Object.create(e.prototype);for(var o in n)a[o]=n[o];return a}function M_(){}var Ky=.7,MS=1/Ky,qf="\\s*([+-]?\\d+)\\s*",Yy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",$c="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",t5e=/^#([0-9a-f]{3,8})$/,n5e=new RegExp(`^rgb\\(${qf},${qf},${qf}\\)$`),r5e=new RegExp(`^rgb\\(${$c},${$c},${$c}\\)$`),i5e=new RegExp(`^rgba\\(${qf},${qf},${qf},${Yy}\\)$`),a5e=new RegExp(`^rgba\\(${$c},${$c},${$c},${Yy}\\)$`),s5e=new RegExp(`^hsl\\(${Yy},${$c},${$c}\\)$`),o5e=new RegExp(`^hsla\\(${Yy},${$c},${$c},${Yy}\\)$`),Zz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};F2(M_,qy,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:eK,formatHex:eK,formatHex8:c5e,formatHsl:l5e,formatRgb:tK,toString:tK});function eK(){return this.rgb().formatHex()}function c5e(){return this.rgb().formatHex8()}function l5e(){return vZ(this).formatHsl()}function tK(){return this.rgb().formatRgb()}function qy(e){var n,a;return e=(e+"").trim().toLowerCase(),(n=t5e.exec(e))?(a=n[1].length,n=parseInt(n[1],16),a===6?nK(n):a===3?new Ja(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):a===8?hx(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):a===4?hx(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=n5e.exec(e))?new Ja(n[1],n[2],n[3],1):(n=r5e.exec(e))?new Ja(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=i5e.exec(e))?hx(n[1],n[2],n[3],n[4]):(n=a5e.exec(e))?hx(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=s5e.exec(e))?aK(n[1],n[2]/100,n[3]/100,1):(n=o5e.exec(e))?aK(n[1],n[2]/100,n[3]/100,n[4]):Zz.hasOwnProperty(e)?nK(Zz[e]):e==="transparent"?new Ja(NaN,NaN,NaN,0):null}function nK(e){return new Ja(e>>16&255,e>>8&255,e&255,1)}function hx(e,n,a,o){return o<=0&&(e=n=a=NaN),new Ja(e,n,a,o)}function d5e(e){return e instanceof M_||(e=qy(e)),e?(e=e.rgb(),new Ja(e.r,e.g,e.b,e.opacity)):new Ja}function nD(e,n,a,o){return arguments.length===1?d5e(e):new Ja(e,n,a,o??1)}function Ja(e,n,a,o){this.r=+e,this.g=+n,this.b=+a,this.opacity=+o}F2(Ja,nD,gZ(M_,{brighter(e){return e=e==null?MS:Math.pow(MS,e),new Ja(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ky:Math.pow(Ky,e),new Ja(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ja(Ch(this.r),Ch(this.g),Ch(this.b),US(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rK,formatHex:rK,formatHex8:u5e,formatRgb:iK,toString:iK}));function rK(){return`#${yh(this.r)}${yh(this.g)}${yh(this.b)}`}function u5e(){return`#${yh(this.r)}${yh(this.g)}${yh(this.b)}${yh((isNaN(this.opacity)?1:this.opacity)*255)}`}function iK(){const e=US(this.opacity);return`${e===1?"rgb(":"rgba("}${Ch(this.r)}, ${Ch(this.g)}, ${Ch(this.b)}${e===1?")":`, ${e})`}`}function US(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ch(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function yh(e){return e=Ch(e),(e<16?"0":"")+e.toString(16)}function aK(e,n,a,o){return o<=0?e=n=a=NaN:a<=0||a>=1?e=n=NaN:n<=0&&(e=NaN),new Qo(e,n,a,o)}function vZ(e){if(e instanceof Qo)return new Qo(e.h,e.s,e.l,e.opacity);if(e instanceof M_||(e=qy(e)),!e)return new Qo;if(e instanceof Qo)return e;e=e.rgb();var n=e.r/255,a=e.g/255,o=e.b/255,d=Math.min(n,a,o),p=Math.max(n,a,o),m=NaN,y=p-d,b=(p+d)/2;return y?(n===p?m=(a-o)/y+(a<o)*6:a===p?m=(o-n)/y+2:m=(n-a)/y+4,y/=b<.5?p+d:2-p-d,m*=60):y=b>0&&b<1?0:m,new Qo(m,y,b,e.opacity)}function h5e(e,n,a,o){return arguments.length===1?vZ(e):new Qo(e,n,a,o??1)}function Qo(e,n,a,o){this.h=+e,this.s=+n,this.l=+a,this.opacity=+o}F2(Qo,h5e,gZ(M_,{brighter(e){return e=e==null?MS:Math.pow(MS,e),new Qo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ky:Math.pow(Ky,e),new Qo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,a=this.l,o=a+(a<.5?a:1-a)*n,d=2*a-o;return new Ja(qO(e>=240?e-240:e+120,d,o),qO(e,d,o),qO(e<120?e+240:e-120,d,o),this.opacity)},clamp(){return new Qo(sK(this.h),px(this.s),px(this.l),US(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=US(this.opacity);return`${e===1?"hsl(":"hsla("}${sK(this.h)}, ${px(this.s)*100}%, ${px(this.l)*100}%${e===1?")":`, ${e})`}`}}));function sK(e){return e=(e||0)%360,e<0?e+360:e}function px(e){return Math.max(0,Math.min(1,e||0))}function qO(e,n,a){return(e<60?n+(a-n)*e/60:e<180?a:e<240?n+(a-n)*(240-e)/60:n)*255}const V2=e=>()=>e;function p5e(e,n){return function(a){return e+a*n}}function f5e(e,n,a){return e=Math.pow(e,a),n=Math.pow(n,a)-e,a=1/a,function(o){return Math.pow(e+o*n,a)}}function m5e(e){return(e=+e)==1?yZ:function(n,a){return a-n?f5e(n,a,e):V2(isNaN(n)?a:n)}}function yZ(e,n){var a=n-e;return a?p5e(e,a):V2(isNaN(e)?n:e)}const oK=function e(n){var a=m5e(n);function o(d,p){var m=a((d=nD(d)).r,(p=nD(p)).r),y=a(d.g,p.g),b=a(d.b,p.b),E=yZ(d.opacity,p.opacity);return function(T){return d.r=m(T),d.g=y(T),d.b=b(T),d.opacity=E(T),d+""}}return o.gamma=e,o}(1);function g5e(e,n){n||(n=[]);var a=e?Math.min(n.length,e.length):0,o=n.slice(),d;return function(p){for(d=0;d<a;++d)o[d]=e[d]*(1-p)+n[d]*p;return o}}function v5e(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function y5e(e,n){var a=n?n.length:0,o=e?Math.min(a,e.length):0,d=new Array(o),p=new Array(a),m;for(m=0;m<o;++m)d[m]=Zm(e[m],n[m]);for(;m<a;++m)p[m]=n[m];return function(y){for(m=0;m<o;++m)p[m]=d[m](y);return p}}function _5e(e,n){var a=new Date;return e=+e,n=+n,function(o){return a.setTime(e*(1-o)+n*o),a}}function FS(e,n){return e=+e,n=+n,function(a){return e*(1-a)+n*a}}function b5e(e,n){var a={},o={},d;(e===null||typeof e!="object")&&(e={}),(n===null||typeof n!="object")&&(n={});for(d in n)d in e?a[d]=Zm(e[d],n[d]):o[d]=n[d];return function(p){for(d in a)o[d]=a[d](p);return o}}var rD=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,XO=new RegExp(rD.source,"g");function E5e(e){return function(){return e}}function x5e(e){return function(n){return e(n)+""}}function S5e(e,n){var a=rD.lastIndex=XO.lastIndex=0,o,d,p,m=-1,y=[],b=[];for(e=e+"",n=n+"";(o=rD.exec(e))&&(d=XO.exec(n));)(p=d.index)>a&&(p=n.slice(a,p),y[m]?y[m]+=p:y[++m]=p),(o=o[0])===(d=d[0])?y[m]?y[m]+=d:y[++m]=d:(y[++m]=null,b.push({i:m,x:FS(o,d)})),a=XO.lastIndex;return a<n.length&&(p=n.slice(a),y[m]?y[m]+=p:y[++m]=p),y.length<2?b[0]?x5e(b[0].x):E5e(n):(n=b.length,function(E){for(var T=0,w;T<n;++T)y[(w=b[T]).i]=w.x(E);return y.join("")})}function Zm(e,n){var a=typeof n,o;return n==null||a==="boolean"?V2(n):(a==="number"?FS:a==="string"?(o=qy(n))?(n=o,oK):S5e:n instanceof qy?oK:n instanceof Date?_5e:v5e(n)?g5e:Array.isArray(n)?y5e:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?b5e:FS)(e,n)}function B2(e,n){return e=+e,n=+n,function(a){return Math.round(e*(1-a)+n*a)}}function w5e(e,n){n===void 0&&(n=e,e=Zm);for(var a=0,o=n.length-1,d=n[0],p=new Array(o<0?0:o);a<o;)p[a]=e(d,d=n[++a]);return function(m){var y=Math.max(0,Math.min(o-1,Math.floor(m*=o)));return p[y](m-y)}}function T5e(e){return function(){return e}}function VS(e){return+e}var cK=[0,1];function Ca(e){return e}function iD(e,n){return(n-=e=+e)?function(a){return(a-e)/n}:T5e(isNaN(n)?NaN:.5)}function C5e(e,n){var a;return e>n&&(a=e,e=n,n=a),function(o){return Math.max(e,Math.min(n,o))}}function N5e(e,n,a){var o=e[0],d=e[1],p=n[0],m=n[1];return d<o?(o=iD(d,o),p=a(m,p)):(o=iD(o,d),p=a(p,m)),function(y){return p(o(y))}}function R5e(e,n,a){var o=Math.min(e.length,n.length)-1,d=new Array(o),p=new Array(o),m=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++m<o;)d[m]=iD(e[m],e[m+1]),p[m]=a(n[m],n[m+1]);return function(y){var b=L_(e,y,1,o)-1;return p[b](d[b](y))}}function U_(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ET(){var e=cK,n=cK,a=Zm,o,d,p,m=Ca,y,b,E;function T(){var N=Math.min(e.length,n.length);return m!==Ca&&(m=C5e(e[0],e[N-1])),y=N>2?R5e:N5e,b=E=null,w}function w(N){return N==null||isNaN(N=+N)?p:(b||(b=y(e.map(o),n,a)))(o(m(N)))}return w.invert=function(N){return m(d((E||(E=y(n,e.map(o),FS)))(N)))},w.domain=function(N){return arguments.length?(e=Array.from(N,VS),T()):e.slice()},w.range=function(N){return arguments.length?(n=Array.from(N),T()):n.slice()},w.rangeRound=function(N){return n=Array.from(N),a=B2,T()},w.clamp=function(N){return arguments.length?(m=N?!0:Ca,T()):m!==Ca},w.interpolate=function(N){return arguments.length?(a=N,T()):a},w.unknown=function(N){return arguments.length?(p=N,w):p},function(N,D){return o=N,d=D,T()}}function G2(){return ET()(Ca,Ca)}function A5e(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function BS(e,n){if((a=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var a,o=e.slice(0,a);return[o.length>1?o[0]+o.slice(2):o,+e.slice(a+1)]}function pm(e){return e=BS(Math.abs(e)),e?e[1]:NaN}function I5e(e,n){return function(a,o){for(var d=a.length,p=[],m=0,y=e[0],b=0;d>0&&y>0&&(b+y+1>o&&(y=Math.max(1,o-b)),p.push(a.substring(d-=y,d+y)),!((b+=y+1)>o));)y=e[m=(m+1)%e.length];return p.reverse().join(n)}}function O5e(e){return function(n){return n.replace(/[0-9]/g,function(a){return e[+a]})}}var P5e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Xy(e){if(!(n=P5e.exec(e)))throw new Error("invalid format: "+e);var n;return new W2({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}Xy.prototype=W2.prototype;function W2(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}W2.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function D5e(e){e:for(var n=e.length,a=1,o=-1,d;a<n;++a)switch(e[a]){case".":o=d=a;break;case"0":o===0&&(o=a),d=a;break;default:if(!+e[a])break e;o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(d+1):e}var _Z;function k5e(e,n){var a=BS(e,n);if(!a)return e+"";var o=a[0],d=a[1],p=d-(_Z=Math.max(-8,Math.min(8,Math.floor(d/3)))*3)+1,m=o.length;return p===m?o:p>m?o+new Array(p-m+1).join("0"):p>0?o.slice(0,p)+"."+o.slice(p):"0."+new Array(1-p).join("0")+BS(e,Math.max(0,n+p-1))[0]}function lK(e,n){var a=BS(e,n);if(!a)return e+"";var o=a[0],d=a[1];return d<0?"0."+new Array(-d).join("0")+o:o.length>d+1?o.slice(0,d+1)+"."+o.slice(d+1):o+new Array(d-o.length+2).join("0")}const dK={"%":(e,n)=>(e*100).toFixed(n),b:e=>Math.round(e).toString(2),c:e=>e+"",d:A5e,e:(e,n)=>e.toExponential(n),f:(e,n)=>e.toFixed(n),g:(e,n)=>e.toPrecision(n),o:e=>Math.round(e).toString(8),p:(e,n)=>lK(e*100,n),r:lK,s:k5e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function uK(e){return e}var hK=Array.prototype.map,pK=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function j5e(e){var n=e.grouping===void 0||e.thousands===void 0?uK:I5e(hK.call(e.grouping,Number),e.thousands+""),a=e.currency===void 0?"":e.currency[0]+"",o=e.currency===void 0?"":e.currency[1]+"",d=e.decimal===void 0?".":e.decimal+"",p=e.numerals===void 0?uK:O5e(hK.call(e.numerals,String)),m=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"":e.minus+"",b=e.nan===void 0?"NaN":e.nan+"";function E(w){w=Xy(w);var N=w.fill,D=w.align,A=w.sign,k=w.symbol,O=w.zero,F=w.width,M=w.comma,V=w.precision,H=w.trim,B=w.type;B==="n"?(M=!0,B="g"):dK[B]||(V===void 0&&(V=12),H=!0,B="g"),(O||N==="0"&&D==="=")&&(O=!0,N="0",D="=");var z=k==="$"?a:k==="#"&&/[boxX]/.test(B)?"0"+B.toLowerCase():"",q=k==="$"?o:/[%p]/.test(B)?m:"",Q=dK[B],ee=/[defgprs%]/.test(B);V=V===void 0?6:/[gprs]/.test(B)?Math.max(1,Math.min(21,V)):Math.max(0,Math.min(20,V));function oe(ne){var ue=z,Se=q,fe,we,he;if(B==="c")Se=Q(ne)+Se,ne="";else{ne=+ne;var be=ne<0||1/ne<0;if(ne=isNaN(ne)?b:Q(Math.abs(ne),V),H&&(ne=D5e(ne)),be&&+ne==0&&A!=="+"&&(be=!1),ue=(be?A==="("?A:y:A==="-"||A==="("?"":A)+ue,Se=(B==="s"?pK[8+_Z/3]:"")+Se+(be&&A==="("?")":""),ee){for(fe=-1,we=ne.length;++fe<we;)if(he=ne.charCodeAt(fe),48>he||he>57){Se=(he===46?d+ne.slice(fe+1):ne.slice(fe))+Se,ne=ne.slice(0,fe);break}}}M&&!O&&(ne=n(ne,1/0));var ae=ue.length+ne.length+Se.length,de=ae<F?new Array(F-ae+1).join(N):"";switch(M&&O&&(ne=n(de+ne,de.length?F-Se.length:1/0),de=""),D){case"<":ne=ue+ne+Se+de;break;case"=":ne=ue+de+ne+Se;break;case"^":ne=de.slice(0,ae=de.length>>1)+ue+ne+Se+de.slice(ae);break;default:ne=de+ue+ne+Se;break}return p(ne)}return oe.toString=function(){return w+""},oe}function T(w,N){var D=E((w=Xy(w),w.type="f",w)),A=Math.max(-8,Math.min(8,Math.floor(pm(N)/3)))*3,k=Math.pow(10,-A),O=pK[8+A/3];return function(F){return D(k*F)+O}}return{format:E,formatPrefix:T}}var fx,$2,bZ;L5e({thousands:",",grouping:[3],currency:["$",""]});function L5e(e){return fx=j5e(e),$2=fx.format,bZ=fx.formatPrefix,fx}function M5e(e){return Math.max(0,-pm(Math.abs(e)))}function U5e(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(pm(n)/3)))*3-pm(Math.abs(e)))}function F5e(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,pm(n)-pm(e))+1}function EZ(e,n,a,o){var d=eD(e,n,a),p;switch(o=Xy(o??",f"),o.type){case"s":{var m=Math.max(Math.abs(e),Math.abs(n));return o.precision==null&&!isNaN(p=U5e(d,m))&&(o.precision=p),bZ(o,m)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(p=F5e(d,Math.max(Math.abs(e),Math.abs(n))))&&(o.precision=p-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(p=M5e(d))&&(o.precision=p-(o.type==="%")*2);break}}return $2(o)}function iu(e){var n=e.domain;return e.ticks=function(a){var o=n();return QP(o[0],o[o.length-1],a??10)},e.tickFormat=function(a,o){var d=n();return EZ(d[0],d[d.length-1],a??10,o)},e.nice=function(a){a==null&&(a=10);var o=n(),d=0,p=o.length-1,m=o[d],y=o[p],b,E,T=10;for(y<m&&(E=m,m=y,y=E,E=d,d=p,p=E);T-- >0;){if(E=ZP(m,y,a),E===b)return o[d]=m,o[p]=y,n(o);if(E>0)m=Math.floor(m/E)*E,y=Math.ceil(y/E)*E;else if(E<0)m=Math.ceil(m*E)/E,y=Math.floor(y*E)/E;else break;b=E}return e},e}function GS(){var e=G2();return e.copy=function(){return U_(e,GS())},_o.apply(e,arguments),iu(e)}function xZ(e){var n;function a(o){return o==null||isNaN(o=+o)?n:o}return a.invert=a,a.domain=a.range=function(o){return arguments.length?(e=Array.from(o,VS),a):e.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return xZ(e).unknown(n)},e=arguments.length?Array.from(e,VS):[0,1],iu(a)}function SZ(e,n){e=e.slice();var a=0,o=e.length-1,d=e[a],p=e[o],m;return p<d&&(m=a,a=o,o=m,m=d,d=p,p=m),e[a]=n.floor(d),e[o]=n.ceil(p),e}function fK(e){return Math.log(e)}function mK(e){return Math.exp(e)}function V5e(e){return-Math.log(-e)}function B5e(e){return-Math.exp(-e)}function G5e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function W5e(e){return e===10?G5e:e===Math.E?Math.exp:n=>Math.pow(e,n)}function $5e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),n=>Math.log(n)/e)}function gK(e){return(n,a)=>-e(-n,a)}function H2(e){const n=e(fK,mK),a=n.domain;let o=10,d,p;function m(){return d=$5e(o),p=W5e(o),a()[0]<0?(d=gK(d),p=gK(p),e(V5e,B5e)):e(fK,mK),n}return n.base=function(y){return arguments.length?(o=+y,m()):o},n.domain=function(y){return arguments.length?(a(y),m()):a()},n.ticks=y=>{const b=a();let E=b[0],T=b[b.length-1];const w=T<E;w&&([E,T]=[T,E]);let N=d(E),D=d(T),A,k;const O=y==null?10:+y;let F=[];if(!(o%1)&&D-N<O){if(N=Math.floor(N),D=Math.ceil(D),E>0){for(;N<=D;++N)for(A=1;A<o;++A)if(k=N<0?A/p(-N):A*p(N),!(k<E)){if(k>T)break;F.push(k)}}else for(;N<=D;++N)for(A=o-1;A>=1;--A)if(k=N>0?A/p(-N):A*p(N),!(k<E)){if(k>T)break;F.push(k)}F.length*2<O&&(F=QP(E,T,O))}else F=QP(N,D,Math.min(D-N,O)).map(p);return w?F.reverse():F},n.tickFormat=(y,b)=>{if(y==null&&(y=10),b==null&&(b=o===10?"s":","),typeof b!="function"&&(!(o%1)&&(b=Xy(b)).precision==null&&(b.trim=!0),b=$2(b)),y===1/0)return b;const E=Math.max(1,o*y/n.ticks().length);return T=>{let w=T/p(Math.round(d(T)));return w*o<o-.5&&(w*=o),w<=E?b(T):""}},n.nice=()=>a(SZ(a(),{floor:y=>p(Math.floor(d(y))),ceil:y=>p(Math.ceil(d(y)))})),n}function wZ(){const e=H2(ET()).domain([1,10]);return e.copy=()=>U_(e,wZ()).base(e.base()),_o.apply(e,arguments),e}function vK(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function yK(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function z2(e){var n=1,a=e(vK(n),yK(n));return a.constant=function(o){return arguments.length?e(vK(n=+o),yK(n)):n},iu(a)}function TZ(){var e=z2(ET());return e.copy=function(){return U_(e,TZ()).constant(e.constant())},_o.apply(e,arguments)}function _K(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function H5e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function z5e(e){return e<0?-e*e:e*e}function K2(e){var n=e(Ca,Ca),a=1;function o(){return a===1?e(Ca,Ca):a===.5?e(H5e,z5e):e(_K(a),_K(1/a))}return n.exponent=function(d){return arguments.length?(a=+d,o()):a},iu(n)}function Y2(){var e=K2(ET());return e.copy=function(){return U_(e,Y2()).exponent(e.exponent())},_o.apply(e,arguments),e}function K5e(){return Y2.apply(null,arguments).exponent(.5)}function bK(e){return Math.sign(e)*e*e}function Y5e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function CZ(){var e=G2(),n=[0,1],a=!1,o;function d(p){var m=Y5e(e(p));return isNaN(m)?o:a?Math.round(m):m}return d.invert=function(p){return e.invert(bK(p))},d.domain=function(p){return arguments.length?(e.domain(p),d):e.domain()},d.range=function(p){return arguments.length?(e.range((n=Array.from(p,VS)).map(bK)),d):n.slice()},d.rangeRound=function(p){return d.range(p).round(!0)},d.round=function(p){return arguments.length?(a=!!p,d):a},d.clamp=function(p){return arguments.length?(e.clamp(p),d):e.clamp()},d.unknown=function(p){return arguments.length?(o=p,d):o},d.copy=function(){return CZ(e.domain(),n).round(a).clamp(e.clamp()).unknown(o)},_o.apply(d,arguments),iu(d)}function NZ(){var e=[],n=[],a=[],o;function d(){var m=0,y=Math.max(1,n.length);for(a=new Array(y-1);++m<y;)a[m-1]=ZUe(e,m/y);return p}function p(m){return m==null||isNaN(m=+m)?o:n[L_(a,m)]}return p.invertExtent=function(m){var y=n.indexOf(m);return y<0?[NaN,NaN]:[y>0?a[y-1]:e[0],y<a.length?a[y]:e[e.length-1]]},p.domain=function(m){if(!arguments.length)return e.slice();e=[];for(let y of m)y!=null&&!isNaN(y=+y)&&e.push(y);return e.sort(zd),d()},p.range=function(m){return arguments.length?(n=Array.from(m),d()):n.slice()},p.unknown=function(m){return arguments.length?(o=m,p):o},p.quantiles=function(){return a.slice()},p.copy=function(){return NZ().domain(e).range(n).unknown(o)},_o.apply(p,arguments)}function RZ(){var e=0,n=1,a=1,o=[.5],d=[0,1],p;function m(b){return b!=null&&b<=b?d[L_(o,b,0,a)]:p}function y(){var b=-1;for(o=new Array(a);++b<a;)o[b]=((b+1)*n-(b-a)*e)/(a+1);return m}return m.domain=function(b){return arguments.length?([e,n]=b,e=+e,n=+n,y()):[e,n]},m.range=function(b){return arguments.length?(a=(d=Array.from(b)).length-1,y()):d.slice()},m.invertExtent=function(b){var E=d.indexOf(b);return E<0?[NaN,NaN]:E<1?[e,o[0]]:E>=a?[o[a-1],n]:[o[E-1],o[E]]},m.unknown=function(b){return arguments.length&&(p=b),m},m.thresholds=function(){return o.slice()},m.copy=function(){return RZ().domain([e,n]).range(d).unknown(p)},_o.apply(iu(m),arguments)}function AZ(){var e=[.5],n=[0,1],a,o=1;function d(p){return p!=null&&p<=p?n[L_(e,p,0,o)]:a}return d.domain=function(p){return arguments.length?(e=Array.from(p),o=Math.min(e.length,n.length-1),d):e.slice()},d.range=function(p){return arguments.length?(n=Array.from(p),o=Math.min(e.length,n.length-1),d):n.slice()},d.invertExtent=function(p){var m=n.indexOf(p);return[e[m-1],e[m]]},d.unknown=function(p){return arguments.length?(a=p,d):a},d.copy=function(){return AZ().domain(e).range(n).unknown(a)},_o.apply(d,arguments)}const JO=new Date,QO=new Date;function Ei(e,n,a,o){function d(p){return e(p=arguments.length===0?new Date:new Date(+p)),p}return d.floor=p=>(e(p=new Date(+p)),p),d.ceil=p=>(e(p=new Date(p-1)),n(p,1),e(p),p),d.round=p=>{const m=d(p),y=d.ceil(p);return p-m<y-p?m:y},d.offset=(p,m)=>(n(p=new Date(+p),m==null?1:Math.floor(m)),p),d.range=(p,m,y)=>{const b=[];if(p=d.ceil(p),y=y==null?1:Math.floor(y),!(p<m)||!(y>0))return b;let E;do b.push(E=new Date(+p)),n(p,y),e(p);while(E<p&&p<m);return b},d.filter=p=>Ei(m=>{if(m>=m)for(;e(m),!p(m);)m.setTime(m-1)},(m,y)=>{if(m>=m)if(y<0)for(;++y<=0;)for(;n(m,-1),!p(m););else for(;--y>=0;)for(;n(m,1),!p(m););}),a&&(d.count=(p,m)=>(JO.setTime(+p),QO.setTime(+m),e(JO),e(QO),Math.floor(a(JO,QO))),d.every=p=>(p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?d.filter(o?m=>o(m)%p===0:m=>d.count(0,m)%p===0):d)),d}const WS=Ei(()=>{},(e,n)=>{e.setTime(+e+n)},(e,n)=>n-e);WS.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ei(n=>{n.setTime(Math.floor(n/e)*e)},(n,a)=>{n.setTime(+n+a*e)},(n,a)=>(a-n)/e):WS);WS.range;const bl=1e3,lo=bl*60,El=lo*60,Dl=El*24,q2=Dl*7,EK=Dl*30,ZO=Dl*365,_h=Ei(e=>{e.setTime(e-e.getMilliseconds())},(e,n)=>{e.setTime(+e+n*bl)},(e,n)=>(n-e)/bl,e=>e.getUTCSeconds());_h.range;const X2=Ei(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*bl)},(e,n)=>{e.setTime(+e+n*lo)},(e,n)=>(n-e)/lo,e=>e.getMinutes());X2.range;const J2=Ei(e=>{e.setUTCSeconds(0,0)},(e,n)=>{e.setTime(+e+n*lo)},(e,n)=>(n-e)/lo,e=>e.getUTCMinutes());J2.range;const Q2=Ei(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*bl-e.getMinutes()*lo)},(e,n)=>{e.setTime(+e+n*El)},(e,n)=>(n-e)/El,e=>e.getHours());Q2.range;const Z2=Ei(e=>{e.setUTCMinutes(0,0,0)},(e,n)=>{e.setTime(+e+n*El)},(e,n)=>(n-e)/El,e=>e.getUTCHours());Z2.range;const F_=Ei(e=>e.setHours(0,0,0,0),(e,n)=>e.setDate(e.getDate()+n),(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*lo)/Dl,e=>e.getDate()-1);F_.range;const xT=Ei(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/Dl,e=>e.getUTCDate()-1);xT.range;const IZ=Ei(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/Dl,e=>Math.floor(e/Dl));IZ.range;function zh(e){return Ei(n=>{n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},(n,a)=>{n.setDate(n.getDate()+a*7)},(n,a)=>(a-n-(a.getTimezoneOffset()-n.getTimezoneOffset())*lo)/q2)}const ST=zh(0),$S=zh(1),q5e=zh(2),X5e=zh(3),fm=zh(4),J5e=zh(5),Q5e=zh(6);ST.range;$S.range;q5e.range;X5e.range;fm.range;J5e.range;Q5e.range;function Kh(e){return Ei(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCDate(n.getUTCDate()+a*7)},(n,a)=>(a-n)/q2)}const wT=Kh(0),HS=Kh(1),Z5e=Kh(2),e3e=Kh(3),mm=Kh(4),t3e=Kh(5),n3e=Kh(6);wT.range;HS.range;Z5e.range;e3e.range;mm.range;t3e.range;n3e.range;const ej=Ei(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,n)=>{e.setMonth(e.getMonth()+n)},(e,n)=>n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12,e=>e.getMonth());ej.range;const tj=Ei(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCMonth(e.getUTCMonth()+n)},(e,n)=>n.getUTCMonth()-e.getUTCMonth()+(n.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());tj.range;const kl=Ei(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n)},(e,n)=>n.getFullYear()-e.getFullYear(),e=>e.getFullYear());kl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ei(n=>{n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,a)=>{n.setFullYear(n.getFullYear()+a*e)});kl.range;const jl=Ei(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n)},(e,n)=>n.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());jl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ei(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCFullYear(n.getUTCFullYear()+a*e)});jl.range;function OZ(e,n,a,o,d,p){const m=[[_h,1,bl],[_h,5,5*bl],[_h,15,15*bl],[_h,30,30*bl],[p,1,lo],[p,5,5*lo],[p,15,15*lo],[p,30,30*lo],[d,1,El],[d,3,3*El],[d,6,6*El],[d,12,12*El],[o,1,Dl],[o,2,2*Dl],[a,1,q2],[n,1,EK],[n,3,3*EK],[e,1,ZO]];function y(E,T,w){const N=T<E;N&&([E,T]=[T,E]);const D=w&&typeof w.range=="function"?w:b(E,T,w),A=D?D.range(E,+T+1):[];return N?A.reverse():A}function b(E,T,w){const N=Math.abs(T-E)/w,D=M2(([,,O])=>O).right(m,N);if(D===m.length)return e.every(eD(E/ZO,T/ZO,w));if(D===0)return WS.every(Math.max(eD(E,T,w),1));const[A,k]=m[N/m[D-1][2]<m[D][2]/N?D-1:D];return A.every(k)}return[y,b]}const[r3e,i3e]=OZ(jl,tj,wT,IZ,Z2,J2),[a3e,s3e]=OZ(kl,ej,ST,F_,Q2,X2);function e1(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function t1(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function $v(e,n,a){return{y:e,m:n,d:a,H:0,M:0,S:0,L:0}}function o3e(e){var n=e.dateTime,a=e.date,o=e.time,d=e.periods,p=e.days,m=e.shortDays,y=e.months,b=e.shortMonths,E=Hv(d),T=zv(d),w=Hv(p),N=zv(p),D=Hv(m),A=zv(m),k=Hv(y),O=zv(y),F=Hv(b),M=zv(b),V={a:be,A:ae,b:de,B:xe,c:null,d:NK,e:NK,f:I3e,g:V3e,G:G3e,H:N3e,I:R3e,j:A3e,L:PZ,m:O3e,M:P3e,p:Ue,q:Me,Q:IK,s:OK,S:D3e,u:k3e,U:j3e,V:L3e,w:M3e,W:U3e,x:null,X:null,y:F3e,Y:B3e,Z:W3e,"%":AK},H={a:et,A:Re,b:nt,B:ut,c:null,d:RK,e:RK,f:K3e,g:r4e,G:a4e,H:$3e,I:H3e,j:z3e,L:kZ,m:Y3e,M:q3e,p:Kt,q:Rn,Q:IK,s:OK,S:X3e,u:J3e,U:Q3e,V:Z3e,w:e4e,W:t4e,x:null,X:null,y:n4e,Y:i4e,Z:s4e,"%":AK},B={a:oe,A:ne,b:ue,B:Se,c:fe,d:TK,e:TK,f:S3e,g:wK,G:SK,H:CK,I:CK,j:_3e,L:x3e,m:y3e,M:b3e,p:ee,q:v3e,Q:T3e,s:C3e,S:E3e,u:h3e,U:p3e,V:f3e,w:u3e,W:m3e,x:we,X:he,y:wK,Y:SK,Z:g3e,"%":w3e};V.x=z(a,V),V.X=z(o,V),V.c=z(n,V),H.x=z(a,H),H.X=z(o,H),H.c=z(n,H);function z(Pe,lt){return function(Et){var Ae=[],wt=-1,Xe=0,$t=Pe.length,At,ye,Qe;for(Et instanceof Date||(Et=new Date(+Et));++wt<$t;)Pe.charCodeAt(wt)===37&&(Ae.push(Pe.slice(Xe,wt)),(ye=xK[At=Pe.charAt(++wt)])!=null?At=Pe.charAt(++wt):ye=At==="e"?" ":"0",(Qe=lt[At])&&(At=Qe(Et,ye)),Ae.push(At),Xe=wt+1);return Ae.push(Pe.slice(Xe,wt)),Ae.join("")}}function q(Pe,lt){return function(Et){var Ae=$v(1900,void 0,1),wt=Q(Ae,Pe,Et+="",0),Xe,$t;if(wt!=Et.length)return null;if("Q"in Ae)return new Date(Ae.Q);if("s"in Ae)return new Date(Ae.s*1e3+("L"in Ae?Ae.L:0));if(lt&&!("Z"in Ae)&&(Ae.Z=0),"p"in Ae&&(Ae.H=Ae.H%12+Ae.p*12),Ae.m===void 0&&(Ae.m="q"in Ae?Ae.q:0),"V"in Ae){if(Ae.V<1||Ae.V>53)return null;"w"in Ae||(Ae.w=1),"Z"in Ae?(Xe=t1($v(Ae.y,0,1)),$t=Xe.getUTCDay(),Xe=$t>4||$t===0?HS.ceil(Xe):HS(Xe),Xe=xT.offset(Xe,(Ae.V-1)*7),Ae.y=Xe.getUTCFullYear(),Ae.m=Xe.getUTCMonth(),Ae.d=Xe.getUTCDate()+(Ae.w+6)%7):(Xe=e1($v(Ae.y,0,1)),$t=Xe.getDay(),Xe=$t>4||$t===0?$S.ceil(Xe):$S(Xe),Xe=F_.offset(Xe,(Ae.V-1)*7),Ae.y=Xe.getFullYear(),Ae.m=Xe.getMonth(),Ae.d=Xe.getDate()+(Ae.w+6)%7)}else("W"in Ae||"U"in Ae)&&("w"in Ae||(Ae.w="u"in Ae?Ae.u%7:"W"in Ae?1:0),$t="Z"in Ae?t1($v(Ae.y,0,1)).getUTCDay():e1($v(Ae.y,0,1)).getDay(),Ae.m=0,Ae.d="W"in Ae?(Ae.w+6)%7+Ae.W*7-($t+5)%7:Ae.w+Ae.U*7-($t+6)%7);return"Z"in Ae?(Ae.H+=Ae.Z/100|0,Ae.M+=Ae.Z%100,t1(Ae)):e1(Ae)}}function Q(Pe,lt,Et,Ae){for(var wt=0,Xe=lt.length,$t=Et.length,At,ye;wt<Xe;){if(Ae>=$t)return-1;if(At=lt.charCodeAt(wt++),At===37){if(At=lt.charAt(wt++),ye=B[At in xK?lt.charAt(wt++):At],!ye||(Ae=ye(Pe,Et,Ae))<0)return-1}else if(At!=Et.charCodeAt(Ae++))return-1}return Ae}function ee(Pe,lt,Et){var Ae=E.exec(lt.slice(Et));return Ae?(Pe.p=T.get(Ae[0].toLowerCase()),Et+Ae[0].length):-1}function oe(Pe,lt,Et){var Ae=D.exec(lt.slice(Et));return Ae?(Pe.w=A.get(Ae[0].toLowerCase()),Et+Ae[0].length):-1}function ne(Pe,lt,Et){var Ae=w.exec(lt.slice(Et));return Ae?(Pe.w=N.get(Ae[0].toLowerCase()),Et+Ae[0].length):-1}function ue(Pe,lt,Et){var Ae=F.exec(lt.slice(Et));return Ae?(Pe.m=M.get(Ae[0].toLowerCase()),Et+Ae[0].length):-1}function Se(Pe,lt,Et){var Ae=k.exec(lt.slice(Et));return Ae?(Pe.m=O.get(Ae[0].toLowerCase()),Et+Ae[0].length):-1}function fe(Pe,lt,Et){return Q(Pe,n,lt,Et)}function we(Pe,lt,Et){return Q(Pe,a,lt,Et)}function he(Pe,lt,Et){return Q(Pe,o,lt,Et)}function be(Pe){return m[Pe.getDay()]}function ae(Pe){return p[Pe.getDay()]}function de(Pe){return b[Pe.getMonth()]}function xe(Pe){return y[Pe.getMonth()]}function Ue(Pe){return d[+(Pe.getHours()>=12)]}function Me(Pe){return 1+~~(Pe.getMonth()/3)}function et(Pe){return m[Pe.getUTCDay()]}function Re(Pe){return p[Pe.getUTCDay()]}function nt(Pe){return b[Pe.getUTCMonth()]}function ut(Pe){return y[Pe.getUTCMonth()]}function Kt(Pe){return d[+(Pe.getUTCHours()>=12)]}function Rn(Pe){return 1+~~(Pe.getUTCMonth()/3)}return{format:function(Pe){var lt=z(Pe+="",V);return lt.toString=function(){return Pe},lt},parse:function(Pe){var lt=q(Pe+="",!1);return lt.toString=function(){return Pe},lt},utcFormat:function(Pe){var lt=z(Pe+="",H);return lt.toString=function(){return Pe},lt},utcParse:function(Pe){var lt=q(Pe+="",!0);return lt.toString=function(){return Pe},lt}}}var xK={"-":"",_:" ",0:"0"},ji=/^\s*\d+/,c3e=/^%/,l3e=/[\\^$*+?|[\]().{}]/g;function Bn(e,n,a){var o=e<0?"-":"",d=(o?-e:e)+"",p=d.length;return o+(p<a?new Array(a-p+1).join(n)+d:d)}function d3e(e){return e.replace(l3e,"\\$&")}function Hv(e){return new RegExp("^(?:"+e.map(d3e).join("|")+")","i")}function zv(e){return new Map(e.map((n,a)=>[n.toLowerCase(),a]))}function u3e(e,n,a){var o=ji.exec(n.slice(a,a+1));return o?(e.w=+o[0],a+o[0].length):-1}function h3e(e,n,a){var o=ji.exec(n.slice(a,a+1));return o?(e.u=+o[0],a+o[0].length):-1}function p3e(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.U=+o[0],a+o[0].length):-1}function f3e(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.V=+o[0],a+o[0].length):-1}function m3e(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.W=+o[0],a+o[0].length):-1}function SK(e,n,a){var o=ji.exec(n.slice(a,a+4));return o?(e.y=+o[0],a+o[0].length):-1}function wK(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.y=+o[0]+(+o[0]>68?1900:2e3),a+o[0].length):-1}function g3e(e,n,a){var o=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(a,a+6));return o?(e.Z=o[1]?0:-(o[2]+(o[3]||"00")),a+o[0].length):-1}function v3e(e,n,a){var o=ji.exec(n.slice(a,a+1));return o?(e.q=o[0]*3-3,a+o[0].length):-1}function y3e(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.m=o[0]-1,a+o[0].length):-1}function TK(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.d=+o[0],a+o[0].length):-1}function _3e(e,n,a){var o=ji.exec(n.slice(a,a+3));return o?(e.m=0,e.d=+o[0],a+o[0].length):-1}function CK(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.H=+o[0],a+o[0].length):-1}function b3e(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.M=+o[0],a+o[0].length):-1}function E3e(e,n,a){var o=ji.exec(n.slice(a,a+2));return o?(e.S=+o[0],a+o[0].length):-1}function x3e(e,n,a){var o=ji.exec(n.slice(a,a+3));return o?(e.L=+o[0],a+o[0].length):-1}function S3e(e,n,a){var o=ji.exec(n.slice(a,a+6));return o?(e.L=Math.floor(o[0]/1e3),a+o[0].length):-1}function w3e(e,n,a){var o=c3e.exec(n.slice(a,a+1));return o?a+o[0].length:-1}function T3e(e,n,a){var o=ji.exec(n.slice(a));return o?(e.Q=+o[0],a+o[0].length):-1}function C3e(e,n,a){var o=ji.exec(n.slice(a));return o?(e.s=+o[0],a+o[0].length):-1}function NK(e,n){return Bn(e.getDate(),n,2)}function N3e(e,n){return Bn(e.getHours(),n,2)}function R3e(e,n){return Bn(e.getHours()%12||12,n,2)}function A3e(e,n){return Bn(1+F_.count(kl(e),e),n,3)}function PZ(e,n){return Bn(e.getMilliseconds(),n,3)}function I3e(e,n){return PZ(e,n)+"000"}function O3e(e,n){return Bn(e.getMonth()+1,n,2)}function P3e(e,n){return Bn(e.getMinutes(),n,2)}function D3e(e,n){return Bn(e.getSeconds(),n,2)}function k3e(e){var n=e.getDay();return n===0?7:n}function j3e(e,n){return Bn(ST.count(kl(e)-1,e),n,2)}function DZ(e){var n=e.getDay();return n>=4||n===0?fm(e):fm.ceil(e)}function L3e(e,n){return e=DZ(e),Bn(fm.count(kl(e),e)+(kl(e).getDay()===4),n,2)}function M3e(e){return e.getDay()}function U3e(e,n){return Bn($S.count(kl(e)-1,e),n,2)}function F3e(e,n){return Bn(e.getFullYear()%100,n,2)}function V3e(e,n){return e=DZ(e),Bn(e.getFullYear()%100,n,2)}function B3e(e,n){return Bn(e.getFullYear()%1e4,n,4)}function G3e(e,n){var a=e.getDay();return e=a>=4||a===0?fm(e):fm.ceil(e),Bn(e.getFullYear()%1e4,n,4)}function W3e(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Bn(n/60|0,"0",2)+Bn(n%60,"0",2)}function RK(e,n){return Bn(e.getUTCDate(),n,2)}function $3e(e,n){return Bn(e.getUTCHours(),n,2)}function H3e(e,n){return Bn(e.getUTCHours()%12||12,n,2)}function z3e(e,n){return Bn(1+xT.count(jl(e),e),n,3)}function kZ(e,n){return Bn(e.getUTCMilliseconds(),n,3)}function K3e(e,n){return kZ(e,n)+"000"}function Y3e(e,n){return Bn(e.getUTCMonth()+1,n,2)}function q3e(e,n){return Bn(e.getUTCMinutes(),n,2)}function X3e(e,n){return Bn(e.getUTCSeconds(),n,2)}function J3e(e){var n=e.getUTCDay();return n===0?7:n}function Q3e(e,n){return Bn(wT.count(jl(e)-1,e),n,2)}function jZ(e){var n=e.getUTCDay();return n>=4||n===0?mm(e):mm.ceil(e)}function Z3e(e,n){return e=jZ(e),Bn(mm.count(jl(e),e)+(jl(e).getUTCDay()===4),n,2)}function e4e(e){return e.getUTCDay()}function t4e(e,n){return Bn(HS.count(jl(e)-1,e),n,2)}function n4e(e,n){return Bn(e.getUTCFullYear()%100,n,2)}function r4e(e,n){return e=jZ(e),Bn(e.getUTCFullYear()%100,n,2)}function i4e(e,n){return Bn(e.getUTCFullYear()%1e4,n,4)}function a4e(e,n){var a=e.getUTCDay();return e=a>=4||a===0?mm(e):mm.ceil(e),Bn(e.getUTCFullYear()%1e4,n,4)}function s4e(){return"+0000"}function AK(){return"%"}function IK(e){return+e}function OK(e){return Math.floor(+e/1e3)}var bf,LZ,MZ;o4e({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function o4e(e){return bf=o3e(e),LZ=bf.format,bf.parse,MZ=bf.utcFormat,bf.utcParse,bf}function c4e(e){return new Date(e)}function l4e(e){return e instanceof Date?+e:+new Date(+e)}function nj(e,n,a,o,d,p,m,y,b,E){var T=G2(),w=T.invert,N=T.domain,D=E(".%L"),A=E(":%S"),k=E("%I:%M"),O=E("%I %p"),F=E("%a %d"),M=E("%b %d"),V=E("%B"),H=E("%Y");function B(z){return(b(z)<z?D:y(z)<z?A:m(z)<z?k:p(z)<z?O:o(z)<z?d(z)<z?F:M:a(z)<z?V:H)(z)}return T.invert=function(z){return new Date(w(z))},T.domain=function(z){return arguments.length?N(Array.from(z,l4e)):N().map(c4e)},T.ticks=function(z){var q=N();return e(q[0],q[q.length-1],z??10)},T.tickFormat=function(z,q){return q==null?B:E(q)},T.nice=function(z){var q=N();return(!z||typeof z.range!="function")&&(z=n(q[0],q[q.length-1],z??10)),z?N(SZ(q,z)):T},T.copy=function(){return U_(T,nj(e,n,a,o,d,p,m,y,b,E))},T}function d4e(){return _o.apply(nj(a3e,s3e,kl,ej,ST,F_,Q2,X2,_h,LZ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function u4e(){return _o.apply(nj(r3e,i3e,jl,tj,wT,xT,Z2,J2,_h,MZ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function TT(){var e=0,n=1,a,o,d,p,m=Ca,y=!1,b;function E(w){return w==null||isNaN(w=+w)?b:m(d===0?.5:(w=(p(w)-a)*d,y?Math.max(0,Math.min(1,w)):w))}E.domain=function(w){return arguments.length?([e,n]=w,a=p(e=+e),o=p(n=+n),d=a===o?0:1/(o-a),E):[e,n]},E.clamp=function(w){return arguments.length?(y=!!w,E):y},E.interpolator=function(w){return arguments.length?(m=w,E):m};function T(w){return function(N){var D,A;return arguments.length?([D,A]=N,m=w(D,A),E):[m(0),m(1)]}}return E.range=T(Zm),E.rangeRound=T(B2),E.unknown=function(w){return arguments.length?(b=w,E):b},function(w){return p=w,a=w(e),o=w(n),d=a===o?0:1/(o-a),E}}function au(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function UZ(){var e=iu(TT()(Ca));return e.copy=function(){return au(e,UZ())},Bl.apply(e,arguments)}function FZ(){var e=H2(TT()).domain([1,10]);return e.copy=function(){return au(e,FZ()).base(e.base())},Bl.apply(e,arguments)}function VZ(){var e=z2(TT());return e.copy=function(){return au(e,VZ()).constant(e.constant())},Bl.apply(e,arguments)}function rj(){var e=K2(TT());return e.copy=function(){return au(e,rj()).exponent(e.exponent())},Bl.apply(e,arguments)}function h4e(){return rj.apply(null,arguments).exponent(.5)}function BZ(){var e=[],n=Ca;function a(o){if(o!=null&&!isNaN(o=+o))return n((L_(e,o,1)-1)/(e.length-1))}return a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let d of o)d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(zd),a},a.interpolator=function(o){return arguments.length?(n=o,a):n},a.range=function(){return e.map((o,d)=>n(d/(e.length-1)))},a.quantiles=function(o){return Array.from({length:o+1},(d,p)=>QUe(e,p/o))},a.copy=function(){return BZ(n).domain(e)},Bl.apply(a,arguments)}function CT(){var e=0,n=.5,a=1,o=1,d,p,m,y,b,E=Ca,T,w=!1,N;function D(k){return isNaN(k=+k)?N:(k=.5+((k=+T(k))-p)*(o*k<o*p?y:b),E(w?Math.max(0,Math.min(1,k)):k))}D.domain=function(k){return arguments.length?([e,n,a]=k,d=T(e=+e),p=T(n=+n),m=T(a=+a),y=d===p?0:.5/(p-d),b=p===m?0:.5/(m-p),o=p<d?-1:1,D):[e,n,a]},D.clamp=function(k){return arguments.length?(w=!!k,D):w},D.interpolator=function(k){return arguments.length?(E=k,D):E};function A(k){return function(O){var F,M,V;return arguments.length?([F,M,V]=O,E=w5e(k,[F,M,V]),D):[E(0),E(.5),E(1)]}}return D.range=A(Zm),D.rangeRound=A(B2),D.unknown=function(k){return arguments.length?(N=k,D):N},function(k){return T=k,d=k(e),p=k(n),m=k(a),y=d===p?0:.5/(p-d),b=p===m?0:.5/(m-p),o=p<d?-1:1,D}}function GZ(){var e=iu(CT()(Ca));return e.copy=function(){return au(e,GZ())},Bl.apply(e,arguments)}function WZ(){var e=H2(CT()).domain([.1,1,10]);return e.copy=function(){return au(e,WZ()).base(e.base())},Bl.apply(e,arguments)}function $Z(){var e=z2(CT());return e.copy=function(){return au(e,$Z()).constant(e.constant())},Bl.apply(e,arguments)}function ij(){var e=K2(CT());return e.copy=function(){return au(e,ij()).exponent(e.exponent())},Bl.apply(e,arguments)}function p4e(){return ij.apply(null,arguments).exponent(.5)}const PK=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:zy,scaleDiverging:GZ,scaleDivergingLog:WZ,scaleDivergingPow:ij,scaleDivergingSqrt:p4e,scaleDivergingSymlog:$Z,scaleIdentity:xZ,scaleImplicit:tD,scaleLinear:GS,scaleLog:wZ,scaleOrdinal:U2,scalePoint:my,scalePow:Y2,scaleQuantile:NZ,scaleQuantize:RZ,scaleRadial:CZ,scaleSequential:UZ,scaleSequentialLog:FZ,scaleSequentialPow:rj,scaleSequentialQuantile:BZ,scaleSequentialSqrt:h4e,scaleSequentialSymlog:VZ,scaleSqrt:K5e,scaleSymlog:TZ,scaleThreshold:AZ,scaleTime:d4e,scaleUtc:u4e,tickFormat:EZ},Symbol.toStringTag,{value:"Module"}));var f4e=Wm;function m4e(e,n,a){for(var o=-1,d=e.length;++o<d;){var p=e[o],m=n(p);if(m!=null&&(y===void 0?m===m&&!f4e(m):a(m,y)))var y=m,b=p}return b}var HZ=m4e;function g4e(e,n){return e>n}var v4e=g4e,y4e=HZ,_4e=v4e,b4e=Qm;function E4e(e){return e&&e.length?y4e(e,b4e,_4e):void 0}var x4e=E4e;const kd=ar(x4e);function S4e(e,n){return e<n}var w4e=S4e,T4e=HZ,C4e=w4e,N4e=Qm;function R4e(e){return e&&e.length?T4e(e,N4e,C4e):void 0}var A4e=R4e;const NT=ar(A4e);var I4e=y2,O4e=ru,P4e=ZQ,D4e=rs;function k4e(e,n){var a=D4e(e)?I4e:P4e;return a(e,O4e(n))}var j4e=k4e,L4e=JQ,M4e=j4e;function U4e(e,n){return L4e(M4e(e,n),1)}var F4e=U4e;const V4e=ar(F4e);var B4e=D2;function G4e(e,n){return B4e(e,n)}var W4e=G4e;const gm=ar(W4e);var eg=1e9,$4e={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},sj,jr=!0,vo="[DecimalError] ",Nh=vo+"Invalid argument: ",aj=vo+"Exponent out of range: ",tg=Math.floor,lh=Math.pow,H4e=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ss,Ii=1e7,Tr=7,zZ=9007199254740991,zS=tg(zZ/Tr),Nt={};Nt.absoluteValue=Nt.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Nt.comparedTo=Nt.cmp=function(e){var n,a,o,d,p=this;if(e=new p.constructor(e),p.s!==e.s)return p.s||-e.s;if(p.e!==e.e)return p.e>e.e^p.s<0?1:-1;for(o=p.d.length,d=e.d.length,n=0,a=o<d?o:d;n<a;++n)if(p.d[n]!==e.d[n])return p.d[n]>e.d[n]^p.s<0?1:-1;return o===d?0:o>d^p.s<0?1:-1};Nt.decimalPlaces=Nt.dp=function(){var e=this,n=e.d.length-1,a=(n-e.e)*Tr;if(n=e.d[n],n)for(;n%10==0;n/=10)a--;return a<0?0:a};Nt.dividedBy=Nt.div=function(e){return Cl(this,new this.constructor(e))};Nt.dividedToIntegerBy=Nt.idiv=function(e){var n=this,a=n.constructor;return ur(Cl(n,new a(e),0,1),a.precision)};Nt.equals=Nt.eq=function(e){return!this.cmp(e)};Nt.exponent=function(){return di(this)};Nt.greaterThan=Nt.gt=function(e){return this.cmp(e)>0};Nt.greaterThanOrEqualTo=Nt.gte=function(e){return this.cmp(e)>=0};Nt.isInteger=Nt.isint=function(){return this.e>this.d.length-2};Nt.isNegative=Nt.isneg=function(){return this.s<0};Nt.isPositive=Nt.ispos=function(){return this.s>0};Nt.isZero=function(){return this.s===0};Nt.lessThan=Nt.lt=function(e){return this.cmp(e)<0};Nt.lessThanOrEqualTo=Nt.lte=function(e){return this.cmp(e)<1};Nt.logarithm=Nt.log=function(e){var n,a=this,o=a.constructor,d=o.precision,p=d+5;if(e===void 0)e=new o(10);else if(e=new o(e),e.s<1||e.eq(Ss))throw Error(vo+"NaN");if(a.s<1)throw Error(vo+(a.s?"NaN":"-Infinity"));return a.eq(Ss)?new o(0):(jr=!1,n=Cl(Jy(a,p),Jy(e,p),p),jr=!0,ur(n,d))};Nt.minus=Nt.sub=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?qZ(n,e):KZ(n,(e.s=-e.s,e))};Nt.modulo=Nt.mod=function(e){var n,a=this,o=a.constructor,d=o.precision;if(e=new o(e),!e.s)throw Error(vo+"NaN");return a.s?(jr=!1,n=Cl(a,e,0,1).times(e),jr=!0,a.minus(n)):ur(new o(a),d)};Nt.naturalExponential=Nt.exp=function(){return YZ(this)};Nt.naturalLogarithm=Nt.ln=function(){return Jy(this)};Nt.negated=Nt.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Nt.plus=Nt.add=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?KZ(n,e):qZ(n,(e.s=-e.s,e))};Nt.precision=Nt.sd=function(e){var n,a,o,d=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Nh+e);if(n=di(d)+1,o=d.d.length-1,a=o*Tr+1,o=d.d[o],o){for(;o%10==0;o/=10)a--;for(o=d.d[0];o>=10;o/=10)a++}return e&&n>a?n:a};Nt.squareRoot=Nt.sqrt=function(){var e,n,a,o,d,p,m,y=this,b=y.constructor;if(y.s<1){if(!y.s)return new b(0);throw Error(vo+"NaN")}for(e=di(y),jr=!1,d=Math.sqrt(+y),d==0||d==1/0?(n=Fc(y.d),(n.length+e)%2==0&&(n+="0"),d=Math.sqrt(n),e=tg((e+1)/2)-(e<0||e%2),d==1/0?n="5e"+e:(n=d.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),o=new b(n)):o=new b(d.toString()),a=b.precision,d=m=a+3;;)if(p=o,o=p.plus(Cl(y,p,m+2)).times(.5),Fc(p.d).slice(0,m)===(n=Fc(o.d)).slice(0,m)){if(n=n.slice(m-3,m+1),d==m&&n=="4999"){if(ur(p,a+1,0),p.times(p).eq(y)){o=p;break}}else if(n!="9999")break;m+=4}return jr=!0,ur(o,a)};Nt.times=Nt.mul=function(e){var n,a,o,d,p,m,y,b,E,T=this,w=T.constructor,N=T.d,D=(e=new w(e)).d;if(!T.s||!e.s)return new w(0);for(e.s*=T.s,a=T.e+e.e,b=N.length,E=D.length,b<E&&(p=N,N=D,D=p,m=b,b=E,E=m),p=[],m=b+E,o=m;o--;)p.push(0);for(o=E;--o>=0;){for(n=0,d=b+o;d>o;)y=p[d]+D[o]*N[d-o-1]+n,p[d--]=y%Ii|0,n=y/Ii|0;p[d]=(p[d]+n)%Ii|0}for(;!p[--m];)p.pop();return n?++a:p.shift(),e.d=p,e.e=a,jr?ur(e,w.precision):e};Nt.toDecimalPlaces=Nt.todp=function(e,n){var a=this,o=a.constructor;return a=new o(a),e===void 0?a:(Yc(e,0,eg),n===void 0?n=o.rounding:Yc(n,0,8),ur(a,e+di(a)+1,n))};Nt.toExponential=function(e,n){var a,o=this,d=o.constructor;return e===void 0?a=Fh(o,!0):(Yc(e,0,eg),n===void 0?n=d.rounding:Yc(n,0,8),o=ur(new d(o),e+1,n),a=Fh(o,!0,e+1)),a};Nt.toFixed=function(e,n){var a,o,d=this,p=d.constructor;return e===void 0?Fh(d):(Yc(e,0,eg),n===void 0?n=p.rounding:Yc(n,0,8),o=ur(new p(d),e+di(d)+1,n),a=Fh(o.abs(),!1,e+di(o)+1),d.isneg()&&!d.isZero()?"-"+a:a)};Nt.toInteger=Nt.toint=function(){var e=this,n=e.constructor;return ur(new n(e),di(e)+1,n.rounding)};Nt.toNumber=function(){return+this};Nt.toPower=Nt.pow=function(e){var n,a,o,d,p,m,y=this,b=y.constructor,E=12,T=+(e=new b(e));if(!e.s)return new b(Ss);if(y=new b(y),!y.s){if(e.s<1)throw Error(vo+"Infinity");return y}if(y.eq(Ss))return y;if(o=b.precision,e.eq(Ss))return ur(y,o);if(n=e.e,a=e.d.length-1,m=n>=a,p=y.s,m){if((a=T<0?-T:T)<=zZ){for(d=new b(Ss),n=Math.ceil(o/Tr+4),jr=!1;a%2&&(d=d.times(y),kK(d.d,n)),a=tg(a/2),a!==0;)y=y.times(y),kK(y.d,n);return jr=!0,e.s<0?new b(Ss).div(d):ur(d,o)}}else if(p<0)throw Error(vo+"NaN");return p=p<0&&e.d[Math.max(n,a)]&1?-1:1,y.s=1,jr=!1,d=e.times(Jy(y,o+E)),jr=!0,d=YZ(d),d.s=p,d};Nt.toPrecision=function(e,n){var a,o,d=this,p=d.constructor;return e===void 0?(a=di(d),o=Fh(d,a<=p.toExpNeg||a>=p.toExpPos)):(Yc(e,1,eg),n===void 0?n=p.rounding:Yc(n,0,8),d=ur(new p(d),e,n),a=di(d),o=Fh(d,e<=a||a<=p.toExpNeg,e)),o};Nt.toSignificantDigits=Nt.tosd=function(e,n){var a=this,o=a.constructor;return e===void 0?(e=o.precision,n=o.rounding):(Yc(e,1,eg),n===void 0?n=o.rounding:Yc(n,0,8)),ur(new o(a),e,n)};Nt.toString=Nt.valueOf=Nt.val=Nt.toJSON=Nt[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,n=di(e),a=e.constructor;return Fh(e,n<=a.toExpNeg||n>=a.toExpPos)};function KZ(e,n){var a,o,d,p,m,y,b,E,T=e.constructor,w=T.precision;if(!e.s||!n.s)return n.s||(n=new T(e)),jr?ur(n,w):n;if(b=e.d,E=n.d,m=e.e,d=n.e,b=b.slice(),p=m-d,p){for(p<0?(o=b,p=-p,y=E.length):(o=E,d=m,y=b.length),m=Math.ceil(w/Tr),y=m>y?m+1:y+1,p>y&&(p=y,o.length=1),o.reverse();p--;)o.push(0);o.reverse()}for(y=b.length,p=E.length,y-p<0&&(p=y,o=E,E=b,b=o),a=0;p;)a=(b[--p]=b[p]+E[p]+a)/Ii|0,b[p]%=Ii;for(a&&(b.unshift(a),++d),y=b.length;b[--y]==0;)b.pop();return n.d=b,n.e=d,jr?ur(n,w):n}function Yc(e,n,a){if(e!==~~e||e<n||e>a)throw Error(Nh+e)}function Fc(e){var n,a,o,d=e.length-1,p="",m=e[0];if(d>0){for(p+=m,n=1;n<d;n++)o=e[n]+"",a=Tr-o.length,a&&(p+=Td(a)),p+=o;m=e[n],o=m+"",a=Tr-o.length,a&&(p+=Td(a))}else if(m===0)return"0";for(;m%10===0;)m/=10;return p+m}var Cl=function(){function e(o,d){var p,m=0,y=o.length;for(o=o.slice();y--;)p=o[y]*d+m,o[y]=p%Ii|0,m=p/Ii|0;return m&&o.unshift(m),o}function n(o,d,p,m){var y,b;if(p!=m)b=p>m?1:-1;else for(y=b=0;y<p;y++)if(o[y]!=d[y]){b=o[y]>d[y]?1:-1;break}return b}function a(o,d,p){for(var m=0;p--;)o[p]-=m,m=o[p]<d[p]?1:0,o[p]=m*Ii+o[p]-d[p];for(;!o[0]&&o.length>1;)o.shift()}return function(o,d,p,m){var y,b,E,T,w,N,D,A,k,O,F,M,V,H,B,z,q,Q,ee=o.constructor,oe=o.s==d.s?1:-1,ne=o.d,ue=d.d;if(!o.s)return new ee(o);if(!d.s)throw Error(vo+"Division by zero");for(b=o.e-d.e,q=ue.length,B=ne.length,D=new ee(oe),A=D.d=[],E=0;ue[E]==(ne[E]||0);)++E;if(ue[E]>(ne[E]||0)&&--b,p==null?M=p=ee.precision:m?M=p+(di(o)-di(d))+1:M=p,M<0)return new ee(0);if(M=M/Tr+2|0,E=0,q==1)for(T=0,ue=ue[0],M++;(E<B||T)&&M--;E++)V=T*Ii+(ne[E]||0),A[E]=V/ue|0,T=V%ue|0;else{for(T=Ii/(ue[0]+1)|0,T>1&&(ue=e(ue,T),ne=e(ne,T),q=ue.length,B=ne.length),H=q,k=ne.slice(0,q),O=k.length;O<q;)k[O++]=0;Q=ue.slice(),Q.unshift(0),z=ue[0],ue[1]>=Ii/2&&++z;do T=0,y=n(ue,k,q,O),y<0?(F=k[0],q!=O&&(F=F*Ii+(k[1]||0)),T=F/z|0,T>1?(T>=Ii&&(T=Ii-1),w=e(ue,T),N=w.length,O=k.length,y=n(w,k,N,O),y==1&&(T--,a(w,q<N?Q:ue,N))):(T==0&&(y=T=1),w=ue.slice()),N=w.length,N<O&&w.unshift(0),a(k,w,O),y==-1&&(O=k.length,y=n(ue,k,q,O),y<1&&(T++,a(k,q<O?Q:ue,O))),O=k.length):y===0&&(T++,k=[0]),A[E++]=T,y&&k[0]?k[O++]=ne[H]||0:(k=[ne[H]],O=1);while((H++<B||k[0]!==void 0)&&M--)}return A[0]||A.shift(),D.e=b,ur(D,m?p+di(D)+1:p)}}();function YZ(e,n){var a,o,d,p,m,y,b=0,E=0,T=e.constructor,w=T.precision;if(di(e)>16)throw Error(aj+di(e));if(!e.s)return new T(Ss);for(jr=!1,y=w,m=new T(.03125);e.abs().gte(.1);)e=e.times(m),E+=5;for(o=Math.log(lh(2,E))/Math.LN10*2+5|0,y+=o,a=d=p=new T(Ss),T.precision=y;;){if(d=ur(d.times(e),y),a=a.times(++b),m=p.plus(Cl(d,a,y)),Fc(m.d).slice(0,y)===Fc(p.d).slice(0,y)){for(;E--;)p=ur(p.times(p),y);return T.precision=w,n==null?(jr=!0,ur(p,w)):p}p=m}}function di(e){for(var n=e.e*Tr,a=e.d[0];a>=10;a/=10)n++;return n}function n1(e,n,a){if(n>e.LN10.sd())throw jr=!0,a&&(e.precision=a),Error(vo+"LN10 precision limit exceeded");return ur(new e(e.LN10),n)}function Td(e){for(var n="";e--;)n+="0";return n}function Jy(e,n){var a,o,d,p,m,y,b,E,T,w=1,N=10,D=e,A=D.d,k=D.constructor,O=k.precision;if(D.s<1)throw Error(vo+(D.s?"NaN":"-Infinity"));if(D.eq(Ss))return new k(0);if(n==null?(jr=!1,E=O):E=n,D.eq(10))return n==null&&(jr=!0),n1(k,E);if(E+=N,k.precision=E,a=Fc(A),o=a.charAt(0),p=di(D),Math.abs(p)<15e14){for(;o<7&&o!=1||o==1&&a.charAt(1)>3;)D=D.times(e),a=Fc(D.d),o=a.charAt(0),w++;p=di(D),o>1?(D=new k("0."+a),p++):D=new k(o+"."+a.slice(1))}else return b=n1(k,E+2,O).times(p+""),D=Jy(new k(o+"."+a.slice(1)),E-N).plus(b),k.precision=O,n==null?(jr=!0,ur(D,O)):D;for(y=m=D=Cl(D.minus(Ss),D.plus(Ss),E),T=ur(D.times(D),E),d=3;;){if(m=ur(m.times(T),E),b=y.plus(Cl(m,new k(d),E)),Fc(b.d).slice(0,E)===Fc(y.d).slice(0,E))return y=y.times(2),p!==0&&(y=y.plus(n1(k,E+2,O).times(p+""))),y=Cl(y,new k(w),E),k.precision=O,n==null?(jr=!0,ur(y,O)):y;y=b,d+=2}}function DK(e,n){var a,o,d;for((a=n.indexOf("."))>-1&&(n=n.replace(".","")),(o=n.search(/e/i))>0?(a<0&&(a=o),a+=+n.slice(o+1),n=n.substring(0,o)):a<0&&(a=n.length),o=0;n.charCodeAt(o)===48;)++o;for(d=n.length;n.charCodeAt(d-1)===48;)--d;if(n=n.slice(o,d),n){if(d-=o,a=a-o-1,e.e=tg(a/Tr),e.d=[],o=(a+1)%Tr,a<0&&(o+=Tr),o<d){for(o&&e.d.push(+n.slice(0,o)),d-=Tr;o<d;)e.d.push(+n.slice(o,o+=Tr));n=n.slice(o),o=Tr-n.length}else o-=d;for(;o--;)n+="0";if(e.d.push(+n),jr&&(e.e>zS||e.e<-zS))throw Error(aj+a)}else e.s=0,e.e=0,e.d=[0];return e}function ur(e,n,a){var o,d,p,m,y,b,E,T,w=e.d;for(m=1,p=w[0];p>=10;p/=10)m++;if(o=n-m,o<0)o+=Tr,d=n,E=w[T=0];else{if(T=Math.ceil((o+1)/Tr),p=w.length,T>=p)return e;for(E=p=w[T],m=1;p>=10;p/=10)m++;o%=Tr,d=o-Tr+m}if(a!==void 0&&(p=lh(10,m-d-1),y=E/p%10|0,b=n<0||w[T+1]!==void 0||E%p,b=a<4?(y||b)&&(a==0||a==(e.s<0?3:2)):y>5||y==5&&(a==4||b||a==6&&(o>0?d>0?E/lh(10,m-d):0:w[T-1])%10&1||a==(e.s<0?8:7))),n<1||!w[0])return b?(p=di(e),w.length=1,n=n-p-1,w[0]=lh(10,(Tr-n%Tr)%Tr),e.e=tg(-n/Tr)||0):(w.length=1,w[0]=e.e=e.s=0),e;if(o==0?(w.length=T,p=1,T--):(w.length=T+1,p=lh(10,Tr-o),w[T]=d>0?(E/lh(10,m-d)%lh(10,d)|0)*p:0),b)for(;;)if(T==0){(w[0]+=p)==Ii&&(w[0]=1,++e.e);break}else{if(w[T]+=p,w[T]!=Ii)break;w[T--]=0,p=1}for(o=w.length;w[--o]===0;)w.pop();if(jr&&(e.e>zS||e.e<-zS))throw Error(aj+di(e));return e}function qZ(e,n){var a,o,d,p,m,y,b,E,T,w,N=e.constructor,D=N.precision;if(!e.s||!n.s)return n.s?n.s=-n.s:n=new N(e),jr?ur(n,D):n;if(b=e.d,w=n.d,o=n.e,E=e.e,b=b.slice(),m=E-o,m){for(T=m<0,T?(a=b,m=-m,y=w.length):(a=w,o=E,y=b.length),d=Math.max(Math.ceil(D/Tr),y)+2,m>d&&(m=d,a.length=1),a.reverse(),d=m;d--;)a.push(0);a.reverse()}else{for(d=b.length,y=w.length,T=d<y,T&&(y=d),d=0;d<y;d++)if(b[d]!=w[d]){T=b[d]<w[d];break}m=0}for(T&&(a=b,b=w,w=a,n.s=-n.s),y=b.length,d=w.length-y;d>0;--d)b[y++]=0;for(d=w.length;d>m;){if(b[--d]<w[d]){for(p=d;p&&b[--p]===0;)b[p]=Ii-1;--b[p],b[d]+=Ii}b[d]-=w[d]}for(;b[--y]===0;)b.pop();for(;b[0]===0;b.shift())--o;return b[0]?(n.d=b,n.e=o,jr?ur(n,D):n):new N(0)}function Fh(e,n,a){var o,d=di(e),p=Fc(e.d),m=p.length;return n?(a&&(o=a-m)>0?p=p.charAt(0)+"."+p.slice(1)+Td(o):m>1&&(p=p.charAt(0)+"."+p.slice(1)),p=p+(d<0?"e":"e+")+d):d<0?(p="0."+Td(-d-1)+p,a&&(o=a-m)>0&&(p+=Td(o))):d>=m?(p+=Td(d+1-m),a&&(o=a-d-1)>0&&(p=p+"."+Td(o))):((o=d+1)<m&&(p=p.slice(0,o)+"."+p.slice(o)),a&&(o=a-m)>0&&(d+1===m&&(p+="."),p+=Td(o))),e.s<0?"-"+p:p}function kK(e,n){if(e.length>n)return e.length=n,!0}function XZ(e){var n,a,o;function d(p){var m=this;if(!(m instanceof d))return new d(p);if(m.constructor=d,p instanceof d){m.s=p.s,m.e=p.e,m.d=(p=p.d)?p.slice():p;return}if(typeof p=="number"){if(p*0!==0)throw Error(Nh+p);if(p>0)m.s=1;else if(p<0)p=-p,m.s=-1;else{m.s=0,m.e=0,m.d=[0];return}if(p===~~p&&p<1e7){m.e=0,m.d=[p];return}return DK(m,p.toString())}else if(typeof p!="string")throw Error(Nh+p);if(p.charCodeAt(0)===45?(p=p.slice(1),m.s=-1):m.s=1,H4e.test(p))DK(m,p);else throw Error(Nh+p)}if(d.prototype=Nt,d.ROUND_UP=0,d.ROUND_DOWN=1,d.ROUND_CEIL=2,d.ROUND_FLOOR=3,d.ROUND_HALF_UP=4,d.ROUND_HALF_DOWN=5,d.ROUND_HALF_EVEN=6,d.ROUND_HALF_CEIL=7,d.ROUND_HALF_FLOOR=8,d.clone=XZ,d.config=d.set=z4e,e===void 0&&(e={}),e)for(o=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<o.length;)e.hasOwnProperty(a=o[n++])||(e[a]=this[a]);return d.config(e),d}function z4e(e){if(!e||typeof e!="object")throw Error(vo+"Object expected");var n,a,o,d=["precision",1,eg,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(n=0;n<d.length;n+=3)if((o=e[a=d[n]])!==void 0)if(tg(o)===o&&o>=d[n+1]&&o<=d[n+2])this[a]=o;else throw Error(Nh+a+": "+o);if((o=e[a="LN10"])!==void 0)if(o==Math.LN10)this[a]=new this(o);else throw Error(Nh+a+": "+o);return this}var sj=XZ($4e);Ss=new sj(1);const rr=sj;function K4e(e){return J4e(e)||X4e(e)||q4e(e)||Y4e()}function Y4e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function q4e(e,n){if(e){if(typeof e=="string")return aD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return aD(e,n)}}function X4e(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function J4e(e){if(Array.isArray(e))return aD(e)}function aD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var Q4e=function(n){return n},JZ={},QZ=function(n){return n===JZ},jK=function(n){return function a(){return arguments.length===0||arguments.length===1&&QZ(arguments.length<=0?void 0:arguments[0])?a:n.apply(void 0,arguments)}},Z4e=function e(n,a){return n===1?a:jK(function(){for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];var m=d.filter(function(y){return y!==JZ}).length;return m>=n?a.apply(void 0,d):e(n-m,jK(function(){for(var y=arguments.length,b=new Array(y),E=0;E<y;E++)b[E]=arguments[E];var T=d.map(function(w){return QZ(w)?b.shift():w});return a.apply(void 0,K4e(T).concat(b))}))})},RT=function(n){return Z4e(n.length,n)},sD=function(n,a){for(var o=[],d=n;d<a;++d)o[d-n]=d;return o},eFe=RT(function(e,n){return Array.isArray(n)?n.map(e):Object.keys(n).map(function(a){return n[a]}).map(e)}),tFe=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];if(!a.length)return Q4e;var d=a.reverse(),p=d[0],m=d.slice(1);return function(){return m.reduce(function(y,b){return b(y)},p.apply(void 0,arguments))}},oD=function(n){return Array.isArray(n)?n.reverse():n.split("").reverse.join("")},ZZ=function(n){var a=null,o=null;return function(){for(var d=arguments.length,p=new Array(d),m=0;m<d;m++)p[m]=arguments[m];return a&&p.every(function(y,b){return y===a[b]})||(a=p,o=n.apply(void 0,p)),o}};function nFe(e){var n;return e===0?n=1:n=Math.floor(new rr(e).abs().log(10).toNumber())+1,n}function rFe(e,n,a){for(var o=new rr(e),d=0,p=[];o.lt(n)&&d<1e5;)p.push(o.toNumber()),o=o.add(a),d++;return p}var iFe=RT(function(e,n,a){var o=+e,d=+n;return o+a*(d-o)}),aFe=RT(function(e,n,a){var o=n-+e;return o=o||1/0,(a-e)/o}),sFe=RT(function(e,n,a){var o=n-+e;return o=o||1/0,Math.max(0,Math.min(1,(a-e)/o))});const AT={rangeStep:rFe,getDigitCount:nFe,interpolateNumber:iFe,uninterpolateNumber:aFe,uninterpolateTruncation:sFe};function cD(e){return lFe(e)||cFe(e)||eee(e)||oFe()}function oFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cFe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function lFe(e){if(Array.isArray(e))return lD(e)}function Qy(e,n){return hFe(e)||uFe(e,n)||eee(e,n)||dFe()}function dFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eee(e,n){if(e){if(typeof e=="string")return lD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lD(e,n)}}function lD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function uFe(e,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var a=[],o=!0,d=!1,p=void 0;try{for(var m=e[Symbol.iterator](),y;!(o=(y=m.next()).done)&&(a.push(y.value),!(n&&a.length===n));o=!0);}catch(b){d=!0,p=b}finally{try{!o&&m.return!=null&&m.return()}finally{if(d)throw p}}return a}}function hFe(e){if(Array.isArray(e))return e}function tee(e){var n=Qy(e,2),a=n[0],o=n[1],d=a,p=o;return a>o&&(d=o,p=a),[d,p]}function nee(e,n,a){if(e.lte(0))return new rr(0);var o=AT.getDigitCount(e.toNumber()),d=new rr(10).pow(o),p=e.div(d),m=o!==1?.05:.1,y=new rr(Math.ceil(p.div(m).toNumber())).add(a).mul(m),b=y.mul(d);return n?b:new rr(Math.ceil(b))}function pFe(e,n,a){var o=1,d=new rr(e);if(!d.isint()&&a){var p=Math.abs(e);p<1?(o=new rr(10).pow(AT.getDigitCount(e)-1),d=new rr(Math.floor(d.div(o).toNumber())).mul(o)):p>1&&(d=new rr(Math.floor(e)))}else e===0?d=new rr(Math.floor((n-1)/2)):a||(d=new rr(Math.floor(e)));var m=Math.floor((n-1)/2),y=tFe(eFe(function(b){return d.add(new rr(b-m).mul(o)).toNumber()}),sD);return y(0,n)}function ree(e,n,a,o){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-e)/(a-1)))return{step:new rr(0),tickMin:new rr(0),tickMax:new rr(0)};var p=nee(new rr(n).sub(e).div(a-1),o,d),m;e<=0&&n>=0?m=new rr(0):(m=new rr(e).add(n).div(2),m=m.sub(new rr(m).mod(p)));var y=Math.ceil(m.sub(e).div(p).toNumber()),b=Math.ceil(new rr(n).sub(m).div(p).toNumber()),E=y+b+1;return E>a?ree(e,n,a,o,d+1):(E<a&&(b=n>0?b+(a-E):b,y=n>0?y:y+(a-E)),{step:p,tickMin:m.sub(new rr(y).mul(p)),tickMax:m.add(new rr(b).mul(p))})}function fFe(e){var n=Qy(e,2),a=n[0],o=n[1],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,m=Math.max(d,2),y=tee([a,o]),b=Qy(y,2),E=b[0],T=b[1];if(E===-1/0||T===1/0){var w=T===1/0?[E].concat(cD(sD(0,d-1).map(function(){return 1/0}))):[].concat(cD(sD(0,d-1).map(function(){return-1/0})),[T]);return a>o?oD(w):w}if(E===T)return pFe(E,d,p);var N=ree(E,T,m,p),D=N.step,A=N.tickMin,k=N.tickMax,O=AT.rangeStep(A,k.add(new rr(.1).mul(D)),D);return a>o?oD(O):O}function mFe(e,n){var a=Qy(e,2),o=a[0],d=a[1],p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,m=tee([o,d]),y=Qy(m,2),b=y[0],E=y[1];if(b===-1/0||E===1/0)return[o,d];if(b===E)return[b];var T=Math.max(n,2),w=nee(new rr(E).sub(b).div(T-1),p,0),N=[].concat(cD(AT.rangeStep(new rr(b),new rr(E).sub(new rr(.99).mul(w)),w)),[E]);return o>d?oD(N):N}var gFe=ZZ(fFe),vFe=ZZ(mFe),yFe="Invariant failed";function Vh(e,n){throw new Error(yFe)}var _Fe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function vm(e){"@babel/helpers - typeof";return vm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vm(e)}function KS(){return KS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},KS.apply(this,arguments)}function bFe(e,n){return wFe(e)||SFe(e,n)||xFe(e,n)||EFe()}function EFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xFe(e,n){if(e){if(typeof e=="string")return LK(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return LK(e,n)}}function LK(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function SFe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function wFe(e){if(Array.isArray(e))return e}function TFe(e,n){if(e==null)return{};var a=CFe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function CFe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function NFe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function RFe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,see(o.key),o)}}function AFe(e,n,a){return n&&RFe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function IFe(e,n,a){return n=YS(n),OFe(e,iee()?Reflect.construct(n,a||[],YS(e).constructor):n.apply(e,a))}function OFe(e,n){if(n&&(vm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return PFe(e)}function PFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iee=function(){return!!e})()}function YS(e){return YS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},YS(e)}function DFe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&dD(e,n)}function dD(e,n){return dD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},dD(e,n)}function aee(e,n,a){return n=see(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function see(e){var n=kFe(e,"string");return vm(n)=="symbol"?n:n+""}function kFe(e,n){if(vm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(vm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var V_=function(e){function n(){return NFe(this,n),IFe(this,n,arguments)}return DFe(n,e),AFe(n,[{key:"render",value:function(){var o=this.props,d=o.offset,p=o.layout,m=o.width,y=o.dataKey,b=o.data,E=o.dataPointFormatter,T=o.xAxis,w=o.yAxis,N=TFe(o,_Fe),D=vn(N,!1);this.props.direction==="x"&&T.type!=="number"&&Vh();var A=b.map(function(k){var O=E(k,y),F=O.x,M=O.y,V=O.value,H=O.errorVal;if(!H)return null;var B=[],z,q;if(Array.isArray(H)){var Q=bFe(H,2);z=Q[0],q=Q[1]}else z=q=H;if(p==="vertical"){var ee=T.scale,oe=M+d,ne=oe+m,ue=oe-m,Se=ee(V-z),fe=ee(V+q);B.push({x1:fe,y1:ne,x2:fe,y2:ue}),B.push({x1:Se,y1:oe,x2:fe,y2:oe}),B.push({x1:Se,y1:ne,x2:Se,y2:ue})}else if(p==="horizontal"){var we=w.scale,he=F+d,be=he-m,ae=he+m,de=we(V-z),xe=we(V+q);B.push({x1:be,y1:xe,x2:ae,y2:xe}),B.push({x1:he,y1:de,x2:he,y2:xe}),B.push({x1:be,y1:de,x2:ae,y2:de})}return me.createElement(fr,KS({className:"recharts-errorBar",key:"bar-".concat(B.map(function(Ue){return"".concat(Ue.x1,"-").concat(Ue.x2,"-").concat(Ue.y1,"-").concat(Ue.y2)}))},D),B.map(function(Ue){return me.createElement("line",KS({},Ue,{key:"line-".concat(Ue.x1,"-").concat(Ue.x2,"-").concat(Ue.y1,"-").concat(Ue.y2)}))}))});return me.createElement(fr,{className:"recharts-errorBars"},A)}}])}(me.Component);aee(V_,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});aee(V_,"displayName","ErrorBar");function Zy(e){"@babel/helpers - typeof";return Zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Zy(e)}function MK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function ih(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?MK(Object(a),!0).forEach(function(o){jFe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):MK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function jFe(e,n,a){return n=LFe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function LFe(e){var n=MFe(e,"string");return Zy(n)=="symbol"?n:n+""}function MFe(e,n){if(Zy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Zy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var oee=function(n){var a=n.children,o=n.formattedGraphicalItems,d=n.legendWidth,p=n.legendContent,m=bs(a,Yf);if(!m)return null;var y=Yf.defaultProps,b=y!==void 0?ih(ih({},y),m.props):{},E;return m.props&&m.props.payload?E=m.props&&m.props.payload:p==="children"?E=(o||[]).reduce(function(T,w){var N=w.item,D=w.props,A=D.sectors||D.data||[];return T.concat(A.map(function(k){return{type:m.props.iconType||N.props.legendType,value:k.name,color:k.fill,payload:k}}))},[]):E=(o||[]).map(function(T){var w=T.item,N=w.type.defaultProps,D=N!==void 0?ih(ih({},N),w.props):{},A=D.dataKey,k=D.name,O=D.legendType,F=D.hide;return{inactive:F,dataKey:A,type:b.iconType||O||"square",color:oj(w),value:k||A,payload:D}}),ih(ih(ih({},b),Yf.getWithHeight(m,d)),{},{payload:E,item:m})};function e_(e){"@babel/helpers - typeof";return e_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e_(e)}function UK(e){return BFe(e)||VFe(e)||FFe(e)||UFe()}function UFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FFe(e,n){if(e){if(typeof e=="string")return uD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uD(e,n)}}function VFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function BFe(e){if(Array.isArray(e))return uD(e)}function uD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function FK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function qr(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?FK(Object(a),!0).forEach(function(o){Xf(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):FK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Xf(e,n,a){return n=GFe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function GFe(e){var n=WFe(e,"string");return e_(n)=="symbol"?n:n+""}function WFe(e,n){if(e_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(e_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Ra(e,n,a){return _n(e)||_n(n)?a:bi(n)?ho(e,n,a):hn(n)?n(e):a}function gy(e,n,a,o){var d=V4e(e,function(y){return Ra(y,n)});if(a==="number"){var p=d.filter(function(y){return ct(y)||parseFloat(y)});return p.length?[NT(p),kd(p)]:[1/0,-1/0]}var m=o?d.filter(function(y){return!_n(y)}):d;return m.map(function(y){return bi(y)||y instanceof Date?y:""})}var $Fe=function(n){var a,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],d=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0,m=-1,y=(a=o==null?void 0:o.length)!==null&&a!==void 0?a:0;if(y<=1)return 0;if(p&&p.axisType==="angleAxis"&&Math.abs(Math.abs(p.range[1]-p.range[0])-360)<=1e-6)for(var b=p.range,E=0;E<y;E++){var T=E>0?d[E-1].coordinate:d[y-1].coordinate,w=d[E].coordinate,N=E>=y-1?d[0].coordinate:d[E+1].coordinate,D=void 0;if(Zo(w-T)!==Zo(N-w)){var A=[];if(Zo(N-w)===Zo(b[1]-b[0])){D=N;var k=w+b[1]-b[0];A[0]=Math.min(k,(k+T)/2),A[1]=Math.max(k,(k+T)/2)}else{D=T;var O=N+b[1]-b[0];A[0]=Math.min(w,(O+w)/2),A[1]=Math.max(w,(O+w)/2)}var F=[Math.min(w,(D+w)/2),Math.max(w,(D+w)/2)];if(n>F[0]&&n<=F[1]||n>=A[0]&&n<=A[1]){m=d[E].index;break}}else{var M=Math.min(T,N),V=Math.max(T,N);if(n>(M+w)/2&&n<=(V+w)/2){m=d[E].index;break}}}else for(var H=0;H<y;H++)if(H===0&&n<=(o[H].coordinate+o[H+1].coordinate)/2||H>0&&H<y-1&&n>(o[H].coordinate+o[H-1].coordinate)/2&&n<=(o[H].coordinate+o[H+1].coordinate)/2||H===y-1&&n>(o[H].coordinate+o[H-1].coordinate)/2){m=o[H].index;break}return m},oj=function(n){var a,o=n,d=o.type.displayName,p=(a=n.type)!==null&&a!==void 0&&a.defaultProps?qr(qr({},n.type.defaultProps),n.props):n.props,m=p.stroke,y=p.fill,b;switch(d){case"Line":b=m;break;case"Area":case"Radar":b=m&&m!=="none"?m:y;break;default:b=y;break}return b},HFe=function(n){var a=n.barSize,o=n.totalSize,d=n.stackGroups,p=d===void 0?{}:d;if(!p)return{};for(var m={},y=Object.keys(p),b=0,E=y.length;b<E;b++)for(var T=p[y[b]].stackGroups,w=Object.keys(T),N=0,D=w.length;N<D;N++){var A=T[w[N]],k=A.items,O=A.cateAxisId,F=k.filter(function(q){return wl(q.type).indexOf("Bar")>=0});if(F&&F.length){var M=F[0].type.defaultProps,V=M!==void 0?qr(qr({},M),F[0].props):F[0].props,H=V.barSize,B=V[O];m[B]||(m[B]=[]);var z=_n(H)?a:H;m[B].push({item:F[0],stackList:F.slice(1),barSize:_n(z)?void 0:Uh(z,o,0)})}}return m},zFe=function(n){var a=n.barGap,o=n.barCategoryGap,d=n.bandSize,p=n.sizeList,m=p===void 0?[]:p,y=n.maxBarSize,b=m.length;if(b<1)return null;var E=Uh(a,d,0,!0),T,w=[];if(m[0].barSize===+m[0].barSize){var N=!1,D=d/b,A=m.reduce(function(H,B){return H+B.barSize||0},0);A+=(b-1)*E,A>=d&&(A-=(b-1)*E,E=0),A>=d&&D>0&&(N=!0,D*=.9,A=b*D);var k=(d-A)/2>>0,O={offset:k-E,size:0};T=m.reduce(function(H,B){var z={item:B.item,position:{offset:O.offset+O.size+E,size:N?D:B.barSize}},q=[].concat(UK(H),[z]);return O=q[q.length-1].position,B.stackList&&B.stackList.length&&B.stackList.forEach(function(Q){q.push({item:Q,position:O})}),q},w)}else{var F=Uh(o,d,0,!0);d-2*F-(b-1)*E<=0&&(E=0);var M=(d-2*F-(b-1)*E)/b;M>1&&(M>>=0);var V=y===+y?Math.min(M,y):M;T=m.reduce(function(H,B,z){var q=[].concat(UK(H),[{item:B.item,position:{offset:F+(M+E)*z+(M-V)/2,size:V}}]);return B.stackList&&B.stackList.length&&B.stackList.forEach(function(Q){q.push({item:Q,position:q[q.length-1].position})}),q},w)}return T},KFe=function(n,a,o,d){var p=o.children,m=o.width,y=o.margin,b=m-(y.left||0)-(y.right||0),E=oee({children:p,legendWidth:b});if(E){var T=d||{},w=T.width,N=T.height,D=E.align,A=E.verticalAlign,k=E.layout;if((k==="vertical"||k==="horizontal"&&A==="middle")&&D!=="center"&&ct(n[D]))return qr(qr({},n),{},Xf({},D,n[D]+(w||0)));if((k==="horizontal"||k==="vertical"&&D==="center")&&A!=="middle"&&ct(n[A]))return qr(qr({},n),{},Xf({},A,n[A]+(N||0)))}return n},YFe=function(n,a,o){return _n(a)?!0:n==="horizontal"?a==="yAxis":n==="vertical"||o==="x"?a==="xAxis":o==="y"?a==="yAxis":!0},cee=function(n,a,o,d,p){var m=a.props.children,y=po(m,V_).filter(function(E){return YFe(d,p,E.props.direction)});if(y&&y.length){var b=y.map(function(E){return E.props.dataKey});return n.reduce(function(E,T){var w=Ra(T,o);if(_n(w))return E;var N=Array.isArray(w)?[NT(w),kd(w)]:[w,w],D=b.reduce(function(A,k){var O=Ra(T,k,0),F=N[0]-Math.abs(Array.isArray(O)?O[0]:O),M=N[1]+Math.abs(Array.isArray(O)?O[1]:O);return[Math.min(F,A[0]),Math.max(M,A[1])]},[1/0,-1/0]);return[Math.min(D[0],E[0]),Math.max(D[1],E[1])]},[1/0,-1/0])}return null},qFe=function(n,a,o,d,p){var m=a.map(function(y){return cee(n,y,o,p,d)}).filter(function(y){return!_n(y)});return m&&m.length?m.reduce(function(y,b){return[Math.min(y[0],b[0]),Math.max(y[1],b[1])]},[1/0,-1/0]):null},lee=function(n,a,o,d,p){var m=a.map(function(b){var E=b.props.dataKey;return o==="number"&&E&&cee(n,b,E,d)||gy(n,E,o,p)});if(o==="number")return m.reduce(function(b,E){return[Math.min(b[0],E[0]),Math.max(b[1],E[1])]},[1/0,-1/0]);var y={};return m.reduce(function(b,E){for(var T=0,w=E.length;T<w;T++)y[E[T]]||(y[E[T]]=!0,b.push(E[T]));return b},[])},dee=function(n,a){return n==="horizontal"&&a==="xAxis"||n==="vertical"&&a==="yAxis"||n==="centric"&&a==="angleAxis"||n==="radial"&&a==="radiusAxis"},uee=function(n,a,o,d){if(d)return n.map(function(b){return b.coordinate});var p,m,y=n.map(function(b){return b.coordinate===a&&(p=!0),b.coordinate===o&&(m=!0),b.coordinate});return p||y.push(a),m||y.push(o),y},xl=function(n,a,o){if(!n)return null;var d=n.scale,p=n.duplicateDomain,m=n.type,y=n.range,b=n.realScaleType==="scaleBand"?d.bandwidth()/2:2,E=(a||o)&&m==="category"&&d.bandwidth?d.bandwidth()/b:0;if(E=n.axisType==="angleAxis"&&(y==null?void 0:y.length)>=2?Zo(y[0]-y[1])*2*E:E,a&&(n.ticks||n.niceTicks)){var T=(n.ticks||n.niceTicks).map(function(w){var N=p?p.indexOf(w):w;return{coordinate:d(N)+E,value:w,offset:E}});return T.filter(function(w){return!Ym(w.coordinate)})}return n.isCategorical&&n.categoricalDomain?n.categoricalDomain.map(function(w,N){return{coordinate:d(w)+E,value:w,index:N,offset:E}}):d.ticks&&!o?d.ticks(n.tickCount).map(function(w){return{coordinate:d(w)+E,value:w,offset:E}}):d.domain().map(function(w,N){return{coordinate:d(w)+E,value:p?p[w]:w,index:N,offset:E}})},r1=new WeakMap,mx=function(n,a){if(typeof a!="function")return n;r1.has(n)||r1.set(n,new WeakMap);var o=r1.get(n);if(o.has(a))return o.get(a);var d=function(){n.apply(void 0,arguments),a.apply(void 0,arguments)};return o.set(a,d),d},XFe=function(n,a,o){var d=n.scale,p=n.type,m=n.layout,y=n.axisType;if(d==="auto")return m==="radial"&&y==="radiusAxis"?{scale:zy(),realScaleType:"band"}:m==="radial"&&y==="angleAxis"?{scale:GS(),realScaleType:"linear"}:p==="category"&&a&&(a.indexOf("LineChart")>=0||a.indexOf("AreaChart")>=0||a.indexOf("ComposedChart")>=0&&!o)?{scale:my(),realScaleType:"point"}:p==="category"?{scale:zy(),realScaleType:"band"}:{scale:GS(),realScaleType:"linear"};if(Mh(d)){var b="scale".concat(fT(d));return{scale:(PK[b]||my)(),realScaleType:PK[b]?b:"point"}}return hn(d)?{scale:d}:{scale:my(),realScaleType:"point"}},VK=1e-4,JFe=function(n){var a=n.domain();if(!(!a||a.length<=2)){var o=a.length,d=n.range(),p=Math.min(d[0],d[1])-VK,m=Math.max(d[0],d[1])+VK,y=n(a[0]),b=n(a[o-1]);(y<p||y>m||b<p||b>m)&&n.domain([a[0],a[o-1]])}},QFe=function(n,a){if(!n)return null;for(var o=0,d=n.length;o<d;o++)if(n[o].item===a)return n[o].position;return null},ZFe=function(n,a){if(!a||a.length!==2||!ct(a[0])||!ct(a[1]))return n;var o=Math.min(a[0],a[1]),d=Math.max(a[0],a[1]),p=[n[0],n[1]];return(!ct(n[0])||n[0]<o)&&(p[0]=o),(!ct(n[1])||n[1]>d)&&(p[1]=d),p[0]>d&&(p[0]=d),p[1]<o&&(p[1]=o),p},eVe=function(n){var a=n.length;if(!(a<=0))for(var o=0,d=n[0].length;o<d;++o)for(var p=0,m=0,y=0;y<a;++y){var b=Ym(n[y][o][1])?n[y][o][0]:n[y][o][1];b>=0?(n[y][o][0]=p,n[y][o][1]=p+b,p=n[y][o][1]):(n[y][o][0]=m,n[y][o][1]=m+b,m=n[y][o][1])}},tVe=function(n){var a=n.length;if(!(a<=0))for(var o=0,d=n[0].length;o<d;++o)for(var p=0,m=0;m<a;++m){var y=Ym(n[m][o][1])?n[m][o][0]:n[m][o][1];y>=0?(n[m][o][0]=p,n[m][o][1]=p+y,p=n[m][o][1]):(n[m][o][0]=0,n[m][o][1]=0)}},nVe={sign:eVe,expand:vOe,none:cm,silhouette:yOe,wiggle:_Oe,positive:tVe},rVe=function(n,a,o){var d=a.map(function(y){return y.props.dataKey}),p=nVe[o],m=gOe().keys(d).value(function(y,b){return+Ra(y,b,0)}).order(LP).offset(p);return m(n)},iVe=function(n,a,o,d,p,m){if(!n)return null;var y=m?a.reverse():a,b={},E=y.reduce(function(w,N){var D,A=(D=N.type)!==null&&D!==void 0&&D.defaultProps?qr(qr({},N.type.defaultProps),N.props):N.props,k=A.stackId,O=A.hide;if(O)return w;var F=A[o],M=w[F]||{hasStack:!1,stackGroups:{}};if(bi(k)){var V=M.stackGroups[k]||{numericAxisId:o,cateAxisId:d,items:[]};V.items.push(N),M.hasStack=!0,M.stackGroups[k]=V}else M.stackGroups[qm("_stackId_")]={numericAxisId:o,cateAxisId:d,items:[N]};return qr(qr({},w),{},Xf({},F,M))},b),T={};return Object.keys(E).reduce(function(w,N){var D=E[N];if(D.hasStack){var A={};D.stackGroups=Object.keys(D.stackGroups).reduce(function(k,O){var F=D.stackGroups[O];return qr(qr({},k),{},Xf({},O,{numericAxisId:o,cateAxisId:d,items:F.items,stackedData:rVe(n,F.items,p)}))},A)}return qr(qr({},w),{},Xf({},N,D))},T)},aVe=function(n,a){var o=a.realScaleType,d=a.type,p=a.tickCount,m=a.originalDomain,y=a.allowDecimals,b=o||a.scale;if(b!=="auto"&&b!=="linear")return null;if(p&&d==="number"&&m&&(m[0]==="auto"||m[1]==="auto")){var E=n.domain();if(!E.length)return null;var T=gFe(E,p,y);return n.domain([NT(T),kd(T)]),{niceTicks:T}}if(p&&d==="number"){var w=n.domain(),N=vFe(w,p,y);return{niceTicks:N}}return null};function qS(e){var n=e.axis,a=e.ticks,o=e.bandSize,d=e.entry,p=e.index,m=e.dataKey;if(n.type==="category"){if(!n.allowDuplicatedCategory&&n.dataKey&&!_n(d[n.dataKey])){var y=yS(a,"value",d[n.dataKey]);if(y)return y.coordinate+o/2}return a[p]?a[p].coordinate+o/2:null}var b=Ra(d,_n(m)?n.dataKey:m);return _n(b)?null:n.scale(b)}var BK=function(n){var a=n.axis,o=n.ticks,d=n.offset,p=n.bandSize,m=n.entry,y=n.index;if(a.type==="category")return o[y]?o[y].coordinate+d:null;var b=Ra(m,a.dataKey,a.domain[y]);return _n(b)?null:a.scale(b)-p/2+d},sVe=function(n){var a=n.numericAxis,o=a.scale.domain();if(a.type==="number"){var d=Math.min(o[0],o[1]),p=Math.max(o[0],o[1]);return d<=0&&p>=0?0:p<0?p:d}return o[0]},oVe=function(n,a){var o,d=(o=n.type)!==null&&o!==void 0&&o.defaultProps?qr(qr({},n.type.defaultProps),n.props):n.props,p=d.stackId;if(bi(p)){var m=a[p];if(m){var y=m.items.indexOf(n);return y>=0?m.stackedData[y]:null}}return null},cVe=function(n){return n.reduce(function(a,o){return[NT(o.concat([a[0]]).filter(ct)),kd(o.concat([a[1]]).filter(ct))]},[1/0,-1/0])},hee=function(n,a,o){return Object.keys(n).reduce(function(d,p){var m=n[p],y=m.stackedData,b=y.reduce(function(E,T){var w=cVe(T.slice(a,o+1));return[Math.min(E[0],w[0]),Math.max(E[1],w[1])]},[1/0,-1/0]);return[Math.min(b[0],d[0]),Math.max(b[1],d[1])]},[1/0,-1/0]).map(function(d){return d===1/0||d===-1/0?0:d})},GK=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,WK=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,hD=function(n,a,o){if(hn(n))return n(a,o);if(!Array.isArray(n))return a;var d=[];if(ct(n[0]))d[0]=o?n[0]:Math.min(n[0],a[0]);else if(GK.test(n[0])){var p=+GK.exec(n[0])[1];d[0]=a[0]-p}else hn(n[0])?d[0]=n[0](a[0]):d[0]=a[0];if(ct(n[1]))d[1]=o?n[1]:Math.max(n[1],a[1]);else if(WK.test(n[1])){var m=+WK.exec(n[1])[1];d[1]=a[1]+m}else hn(n[1])?d[1]=n[1](a[1]):d[1]=a[1];return d},XS=function(n,a,o){if(n&&n.scale&&n.scale.bandwidth){var d=n.scale.bandwidth();if(!o||d>0)return d}if(n&&a&&a.length>=2){for(var p=j2(a,function(w){return w.coordinate}),m=1/0,y=1,b=p.length;y<b;y++){var E=p[y],T=p[y-1];m=Math.min((E.coordinate||0)-(T.coordinate||0),m)}return m===1/0?0:m}return o?void 0:0},$K=function(n,a,o){return!n||!n.length||gm(n,ho(o,"type.defaultProps.domain"))?a:n},pee=function(n,a){var o=n.type.defaultProps?qr(qr({},n.type.defaultProps),n.props):n.props,d=o.dataKey,p=o.name,m=o.unit,y=o.formatter,b=o.tooltipType,E=o.chartType,T=o.hide;return qr(qr({},vn(n,!1)),{},{dataKey:d,unit:m,formatter:y,name:p||d,color:oj(n),value:Ra(a,d),type:b,payload:a,chartType:E,hide:T})};function t_(e){"@babel/helpers - typeof";return t_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t_(e)}function HK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function zK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?HK(Object(a),!0).forEach(function(o){lVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):HK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function lVe(e,n,a){return n=dVe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function dVe(e){var n=uVe(e,"string");return t_(n)=="symbol"?n:n+""}function uVe(e,n){if(t_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(t_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var JS=Math.PI/180,hVe=function(n){return n*180/Math.PI},Yi=function(n,a,o,d){return{x:n+Math.cos(-JS*d)*o,y:a+Math.sin(-JS*d)*o}},pVe=function(n,a){var o=n.x,d=n.y,p=a.x,m=a.y;return Math.sqrt(Math.pow(o-p,2)+Math.pow(d-m,2))},fVe=function(n,a){var o=n.x,d=n.y,p=a.cx,m=a.cy,y=pVe({x:o,y:d},{x:p,y:m});if(y<=0)return{radius:y};var b=(o-p)/y,E=Math.acos(b);return d>m&&(E=2*Math.PI-E),{radius:y,angle:hVe(E),angleInRadian:E}},mVe=function(n){var a=n.startAngle,o=n.endAngle,d=Math.floor(a/360),p=Math.floor(o/360),m=Math.min(d,p);return{startAngle:a-m*360,endAngle:o-m*360}},gVe=function(n,a){var o=a.startAngle,d=a.endAngle,p=Math.floor(o/360),m=Math.floor(d/360),y=Math.min(p,m);return n+y*360},KK=function(n,a){var o=n.x,d=n.y,p=fVe({x:o,y:d},a),m=p.radius,y=p.angle,b=a.innerRadius,E=a.outerRadius;if(m<b||m>E)return!1;if(m===0)return!0;var T=mVe(a),w=T.startAngle,N=T.endAngle,D=y,A;if(w<=N){for(;D>N;)D-=360;for(;D<w;)D+=360;A=D>=w&&D<=N}else{for(;D>w;)D-=360;for(;D<N;)D+=360;A=D>=N&&D<=w}return A?zK(zK({},a),{},{radius:m,angle:gVe(D,a)}):null};function n_(e){"@babel/helpers - typeof";return n_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n_(e)}var vVe=["offset"];function yVe(e){return xVe(e)||EVe(e)||bVe(e)||_Ve()}function _Ve(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bVe(e,n){if(e){if(typeof e=="string")return pD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pD(e,n)}}function EVe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function xVe(e){if(Array.isArray(e))return pD(e)}function pD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function SVe(e,n){if(e==null)return{};var a=wVe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function wVe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function YK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function gi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?YK(Object(a),!0).forEach(function(o){TVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):YK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function TVe(e,n,a){return n=CVe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function CVe(e){var n=NVe(e,"string");return n_(n)=="symbol"?n:n+""}function NVe(e,n){if(n_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(n_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function r_(){return r_=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},r_.apply(this,arguments)}var RVe=function(n){var a=n.value,o=n.formatter,d=_n(n.children)?a:n.children;return hn(o)?o(d):d},AVe=function(n,a){var o=Zo(a-n),d=Math.min(Math.abs(a-n),360);return o*d},IVe=function(n,a,o){var d=n.position,p=n.viewBox,m=n.offset,y=n.className,b=p,E=b.cx,T=b.cy,w=b.innerRadius,N=b.outerRadius,D=b.startAngle,A=b.endAngle,k=b.clockWise,O=(w+N)/2,F=AVe(D,A),M=F>=0?1:-1,V,H;d==="insideStart"?(V=D+M*m,H=k):d==="insideEnd"?(V=A-M*m,H=!k):d==="end"&&(V=A+M*m,H=k),H=F<=0?H:!H;var B=Yi(E,T,O,V),z=Yi(E,T,O,V+(H?1:-1)*359),q="M".concat(B.x,",").concat(B.y,`
    A`).concat(O,",").concat(O,",0,1,").concat(H?0:1,`,
    `).concat(z.x,",").concat(z.y),Q=_n(n.id)?qm("recharts-radial-line-"):n.id;return me.createElement("text",r_({},o,{dominantBaseline:"central",className:On("recharts-radial-bar-label",y)}),me.createElement("defs",null,me.createElement("path",{id:Q,d:q})),me.createElement("textPath",{xlinkHref:"#".concat(Q)},a))},OVe=function(n){var a=n.viewBox,o=n.offset,d=n.position,p=a,m=p.cx,y=p.cy,b=p.innerRadius,E=p.outerRadius,T=p.startAngle,w=p.endAngle,N=(T+w)/2;if(d==="outside"){var D=Yi(m,y,E+o,N),A=D.x,k=D.y;return{x:A,y:k,textAnchor:A>=m?"start":"end",verticalAnchor:"middle"}}if(d==="center")return{x:m,y,textAnchor:"middle",verticalAnchor:"middle"};if(d==="centerTop")return{x:m,y,textAnchor:"middle",verticalAnchor:"start"};if(d==="centerBottom")return{x:m,y,textAnchor:"middle",verticalAnchor:"end"};var O=(b+E)/2,F=Yi(m,y,O,N),M=F.x,V=F.y;return{x:M,y:V,textAnchor:"middle",verticalAnchor:"middle"}},PVe=function(n){var a=n.viewBox,o=n.parentViewBox,d=n.offset,p=n.position,m=a,y=m.x,b=m.y,E=m.width,T=m.height,w=T>=0?1:-1,N=w*d,D=w>0?"end":"start",A=w>0?"start":"end",k=E>=0?1:-1,O=k*d,F=k>0?"end":"start",M=k>0?"start":"end";if(p==="top"){var V={x:y+E/2,y:b-w*d,textAnchor:"middle",verticalAnchor:D};return gi(gi({},V),o?{height:Math.max(b-o.y,0),width:E}:{})}if(p==="bottom"){var H={x:y+E/2,y:b+T+N,textAnchor:"middle",verticalAnchor:A};return gi(gi({},H),o?{height:Math.max(o.y+o.height-(b+T),0),width:E}:{})}if(p==="left"){var B={x:y-O,y:b+T/2,textAnchor:F,verticalAnchor:"middle"};return gi(gi({},B),o?{width:Math.max(B.x-o.x,0),height:T}:{})}if(p==="right"){var z={x:y+E+O,y:b+T/2,textAnchor:M,verticalAnchor:"middle"};return gi(gi({},z),o?{width:Math.max(o.x+o.width-z.x,0),height:T}:{})}var q=o?{width:E,height:T}:{};return p==="insideLeft"?gi({x:y+O,y:b+T/2,textAnchor:M,verticalAnchor:"middle"},q):p==="insideRight"?gi({x:y+E-O,y:b+T/2,textAnchor:F,verticalAnchor:"middle"},q):p==="insideTop"?gi({x:y+E/2,y:b+N,textAnchor:"middle",verticalAnchor:A},q):p==="insideBottom"?gi({x:y+E/2,y:b+T-N,textAnchor:"middle",verticalAnchor:D},q):p==="insideTopLeft"?gi({x:y+O,y:b+N,textAnchor:M,verticalAnchor:A},q):p==="insideTopRight"?gi({x:y+E-O,y:b+N,textAnchor:F,verticalAnchor:A},q):p==="insideBottomLeft"?gi({x:y+O,y:b+T-N,textAnchor:M,verticalAnchor:D},q):p==="insideBottomRight"?gi({x:y+E-O,y:b+T-N,textAnchor:F,verticalAnchor:D},q):$m(p)&&(ct(p.x)||vh(p.x))&&(ct(p.y)||vh(p.y))?gi({x:y+Uh(p.x,E),y:b+Uh(p.y,T),textAnchor:"end",verticalAnchor:"end"},q):gi({x:y+E/2,y:b+T/2,textAnchor:"middle",verticalAnchor:"middle"},q)},DVe=function(n){return"cx"in n&&ct(n.cx)};function ca(e){var n=e.offset,a=n===void 0?5:n,o=SVe(e,vVe),d=gi({offset:a},o),p=d.viewBox,m=d.position,y=d.value,b=d.children,E=d.content,T=d.className,w=T===void 0?"":T,N=d.textBreakAll;if(!p||_n(y)&&_n(b)&&!Y.isValidElement(E)&&!hn(E))return null;if(Y.isValidElement(E))return Y.cloneElement(E,d);var D;if(hn(E)){if(D=Y.createElement(E,d),Y.isValidElement(D))return D}else D=RVe(d);var A=DVe(p),k=vn(d,!0);if(A&&(m==="insideStart"||m==="insideEnd"||m==="end"))return IVe(d,D,k);var O=A?OVe(d):PVe(d);return me.createElement(jS,r_({className:On("recharts-label",w)},k,O,{breakAll:N}),D)}ca.displayName="Label";var fee=function(n){var a=n.cx,o=n.cy,d=n.angle,p=n.startAngle,m=n.endAngle,y=n.r,b=n.radius,E=n.innerRadius,T=n.outerRadius,w=n.x,N=n.y,D=n.top,A=n.left,k=n.width,O=n.height,F=n.clockWise,M=n.labelViewBox;if(M)return M;if(ct(k)&&ct(O)){if(ct(w)&&ct(N))return{x:w,y:N,width:k,height:O};if(ct(D)&&ct(A))return{x:D,y:A,width:k,height:O}}return ct(w)&&ct(N)?{x:w,y:N,width:0,height:0}:ct(a)&&ct(o)?{cx:a,cy:o,startAngle:p||d||0,endAngle:m||d||0,innerRadius:E||0,outerRadius:T||b||y||0,clockWise:F}:n.viewBox?n.viewBox:{}},kVe=function(n,a){return n?n===!0?me.createElement(ca,{key:"label-implicit",viewBox:a}):bi(n)?me.createElement(ca,{key:"label-implicit",viewBox:a,value:n}):Y.isValidElement(n)?n.type===ca?Y.cloneElement(n,{key:"label-implicit",viewBox:a}):me.createElement(ca,{key:"label-implicit",content:n,viewBox:a}):hn(n)?me.createElement(ca,{key:"label-implicit",content:n,viewBox:a}):$m(n)?me.createElement(ca,r_({viewBox:a},n,{key:"label-implicit"})):null:null},jVe=function(n,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!n||!n.children&&o&&!n.label)return null;var d=n.children,p=fee(n),m=po(d,ca).map(function(b,E){return Y.cloneElement(b,{viewBox:a||p,key:"label-".concat(E)})});if(!o)return m;var y=kVe(n.label,a||p);return[y].concat(yVe(m))};ca.parseViewBox=fee;ca.renderCallByParent=jVe;function LVe(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}var MVe=LVe;const UVe=ar(MVe);function i_(e){"@babel/helpers - typeof";return i_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i_(e)}var FVe=["valueAccessor"],VVe=["data","dataKey","clockWise","id","textBreakAll"];function BVe(e){return HVe(e)||$Ve(e)||WVe(e)||GVe()}function GVe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WVe(e,n){if(e){if(typeof e=="string")return fD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fD(e,n)}}function $Ve(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function HVe(e){if(Array.isArray(e))return fD(e)}function fD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function QS(){return QS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},QS.apply(this,arguments)}function qK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function XK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?qK(Object(a),!0).forEach(function(o){zVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function zVe(e,n,a){return n=KVe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function KVe(e){var n=YVe(e,"string");return i_(n)=="symbol"?n:n+""}function YVe(e,n){if(i_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(i_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function JK(e,n){if(e==null)return{};var a=qVe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function qVe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var XVe=function(n){return Array.isArray(n.value)?UVe(n.value):n.value};function Nl(e){var n=e.valueAccessor,a=n===void 0?XVe:n,o=JK(e,FVe),d=o.data,p=o.dataKey,m=o.clockWise,y=o.id,b=o.textBreakAll,E=JK(o,VVe);return!d||!d.length?null:me.createElement(fr,{className:"recharts-label-list"},d.map(function(T,w){var N=_n(p)?a(T,w):Ra(T&&T.payload,p),D=_n(y)?{}:{id:"".concat(y,"-").concat(w)};return me.createElement(ca,QS({},vn(T,!0),E,D,{parentViewBox:T.parentViewBox,value:N,textBreakAll:b,viewBox:ca.parseViewBox(_n(m)?T:XK(XK({},T),{},{clockWise:m})),key:"label-".concat(w),index:w}))}))}Nl.displayName="LabelList";function JVe(e,n){return e?e===!0?me.createElement(Nl,{key:"labelList-implicit",data:n}):me.isValidElement(e)||hn(e)?me.createElement(Nl,{key:"labelList-implicit",data:n,content:e}):$m(e)?me.createElement(Nl,QS({data:n},e,{key:"labelList-implicit"})):null:null}function QVe(e,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&a&&!e.label)return null;var o=e.children,d=po(o,Nl).map(function(m,y){return Y.cloneElement(m,{data:n,key:"labelList-".concat(y)})});if(!a)return d;var p=JVe(e.label,n);return[p].concat(BVe(d))}Nl.renderCallByParent=QVe;function a_(e){"@babel/helpers - typeof";return a_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},a_(e)}function mD(){return mD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},mD.apply(this,arguments)}function QK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function ZK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?QK(Object(a),!0).forEach(function(o){ZVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):QK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function ZVe(e,n,a){return n=eBe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function eBe(e){var n=tBe(e,"string");return a_(n)=="symbol"?n:n+""}function tBe(e,n){if(a_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(a_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var nBe=function(n,a){var o=Zo(a-n),d=Math.min(Math.abs(a-n),359.999);return o*d},gx=function(n){var a=n.cx,o=n.cy,d=n.radius,p=n.angle,m=n.sign,y=n.isExternal,b=n.cornerRadius,E=n.cornerIsExternal,T=b*(y?1:-1)+d,w=Math.asin(b/T)/JS,N=E?p:p+m*w,D=Yi(a,o,T,N),A=Yi(a,o,d,N),k=E?p-m*w:p,O=Yi(a,o,T*Math.cos(w*JS),k);return{center:D,circleTangency:A,lineTangency:O,theta:w}},mee=function(n){var a=n.cx,o=n.cy,d=n.innerRadius,p=n.outerRadius,m=n.startAngle,y=n.endAngle,b=nBe(m,y),E=m+b,T=Yi(a,o,p,m),w=Yi(a,o,p,E),N="M ".concat(T.x,",").concat(T.y,`
    A `).concat(p,",").concat(p,`,0,
    `).concat(+(Math.abs(b)>180),",").concat(+(m>E),`,
    `).concat(w.x,",").concat(w.y,`
  `);if(d>0){var D=Yi(a,o,d,m),A=Yi(a,o,d,E);N+="L ".concat(A.x,",").concat(A.y,`
            A `).concat(d,",").concat(d,`,0,
            `).concat(+(Math.abs(b)>180),",").concat(+(m<=E),`,
            `).concat(D.x,",").concat(D.y," Z")}else N+="L ".concat(a,",").concat(o," Z");return N},rBe=function(n){var a=n.cx,o=n.cy,d=n.innerRadius,p=n.outerRadius,m=n.cornerRadius,y=n.forceCornerRadius,b=n.cornerIsExternal,E=n.startAngle,T=n.endAngle,w=Zo(T-E),N=gx({cx:a,cy:o,radius:p,angle:E,sign:w,cornerRadius:m,cornerIsExternal:b}),D=N.circleTangency,A=N.lineTangency,k=N.theta,O=gx({cx:a,cy:o,radius:p,angle:T,sign:-w,cornerRadius:m,cornerIsExternal:b}),F=O.circleTangency,M=O.lineTangency,V=O.theta,H=b?Math.abs(E-T):Math.abs(E-T)-k-V;if(H<0)return y?"M ".concat(A.x,",").concat(A.y,`
        a`).concat(m,",").concat(m,",0,0,1,").concat(m*2,`,0
        a`).concat(m,",").concat(m,",0,0,1,").concat(-m*2,`,0
      `):mee({cx:a,cy:o,innerRadius:d,outerRadius:p,startAngle:E,endAngle:T});var B="M ".concat(A.x,",").concat(A.y,`
    A`).concat(m,",").concat(m,",0,0,").concat(+(w<0),",").concat(D.x,",").concat(D.y,`
    A`).concat(p,",").concat(p,",0,").concat(+(H>180),",").concat(+(w<0),",").concat(F.x,",").concat(F.y,`
    A`).concat(m,",").concat(m,",0,0,").concat(+(w<0),",").concat(M.x,",").concat(M.y,`
  `);if(d>0){var z=gx({cx:a,cy:o,radius:d,angle:E,sign:w,isExternal:!0,cornerRadius:m,cornerIsExternal:b}),q=z.circleTangency,Q=z.lineTangency,ee=z.theta,oe=gx({cx:a,cy:o,radius:d,angle:T,sign:-w,isExternal:!0,cornerRadius:m,cornerIsExternal:b}),ne=oe.circleTangency,ue=oe.lineTangency,Se=oe.theta,fe=b?Math.abs(E-T):Math.abs(E-T)-ee-Se;if(fe<0&&m===0)return"".concat(B,"L").concat(a,",").concat(o,"Z");B+="L".concat(ue.x,",").concat(ue.y,`
      A`).concat(m,",").concat(m,",0,0,").concat(+(w<0),",").concat(ne.x,",").concat(ne.y,`
      A`).concat(d,",").concat(d,",0,").concat(+(fe>180),",").concat(+(w>0),",").concat(q.x,",").concat(q.y,`
      A`).concat(m,",").concat(m,",0,0,").concat(+(w<0),",").concat(Q.x,",").concat(Q.y,"Z")}else B+="L".concat(a,",").concat(o,"Z");return B},iBe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},gee=function(n){var a=ZK(ZK({},iBe),n),o=a.cx,d=a.cy,p=a.innerRadius,m=a.outerRadius,y=a.cornerRadius,b=a.forceCornerRadius,E=a.cornerIsExternal,T=a.startAngle,w=a.endAngle,N=a.className;if(m<p||T===w)return null;var D=On("recharts-sector",N),A=m-p,k=Uh(y,A,0,!0),O;return k>0&&Math.abs(T-w)<360?O=rBe({cx:o,cy:d,innerRadius:p,outerRadius:m,cornerRadius:Math.min(k,A/2),forceCornerRadius:b,cornerIsExternal:E,startAngle:T,endAngle:w}):O=mee({cx:o,cy:d,innerRadius:p,outerRadius:m,startAngle:T,endAngle:w}),me.createElement("path",mD({},vn(a,!0),{className:D,d:O,role:"img"}))};function s_(e){"@babel/helpers - typeof";return s_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},s_(e)}function gD(){return gD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},gD.apply(this,arguments)}function e9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function t9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?e9(Object(a),!0).forEach(function(o){aBe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):e9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function aBe(e,n,a){return n=sBe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function sBe(e){var n=oBe(e,"string");return s_(n)=="symbol"?n:n+""}function oBe(e,n){if(s_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(s_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var n9={curveBasisClosed:aOe,curveBasisOpen:sOe,curveBasis:iOe,curveBumpX:$Ie,curveBumpY:HIe,curveLinearClosed:oOe,curveLinear:gT,curveMonotoneX:cOe,curveMonotoneY:lOe,curveNatural:dOe,curveStep:uOe,curveStepAfter:pOe,curveStepBefore:hOe},vx=function(n){return n.x===+n.x&&n.y===+n.y},Kv=function(n){return n.x},Yv=function(n){return n.y},cBe=function(n,a){if(hn(n))return n;var o="curve".concat(fT(n));return(o==="curveMonotone"||o==="curveBump")&&a?n9["".concat(o).concat(a==="vertical"?"Y":"X")]:n9[o]||gT},lBe=function(n){var a=n.type,o=a===void 0?"linear":a,d=n.points,p=d===void 0?[]:d,m=n.baseLine,y=n.layout,b=n.connectNulls,E=b===void 0?!1:b,T=cBe(o,y),w=E?p.filter(function(k){return vx(k)}):p,N;if(Array.isArray(m)){var D=E?m.filter(function(k){return vx(k)}):m,A=w.map(function(k,O){return t9(t9({},k),{},{base:D[O]})});return y==="vertical"?N=ox().y(Yv).x1(Kv).x0(function(k){return k.base.x}):N=ox().x(Kv).y1(Yv).y0(function(k){return k.base.y}),N.defined(vx).curve(T),N(A)}return y==="vertical"&&ct(m)?N=ox().y(Yv).x1(Kv).x0(m):ct(m)?N=ox().x(Kv).y1(Yv).y0(m):N=gQ().x(Kv).y(Yv),N.defined(vx).curve(T),N(w)},Jf=function(n){var a=n.className,o=n.points,d=n.path,p=n.pathRef;if((!o||!o.length)&&!d)return null;var m=o&&o.length?lBe(n):d;return Y.createElement("path",gD({},vn(n,!1),_S(n),{className:On("recharts-curve",a),d:m,ref:p}))},vee={exports:{}},dBe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",uBe=dBe,hBe=uBe;function yee(){}function _ee(){}_ee.resetWarningCache=yee;var pBe=function(){function e(o,d,p,m,y,b){if(b!==hBe){var E=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw E.name="Invariant Violation",E}}e.isRequired=e;function n(){return e}var a={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:n,element:e,elementType:e,instanceOf:n,node:e,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:_ee,resetWarningCache:yee};return a.PropTypes=a,a};vee.exports=pBe();var fBe=vee.exports;const jt=ar(fBe);var mBe=Object.getOwnPropertyNames,gBe=Object.getOwnPropertySymbols,vBe=Object.prototype.hasOwnProperty;function r9(e,n){return function(o,d,p){return e(o,d,p)&&n(o,d,p)}}function yx(e){return function(a,o,d){if(!a||!o||typeof a!="object"||typeof o!="object")return e(a,o,d);var p=d.cache,m=p.get(a),y=p.get(o);if(m&&y)return m===o&&y===a;p.set(a,o),p.set(o,a);var b=e(a,o,d);return p.delete(a),p.delete(o),b}}function yBe(e){return e!=null?e[Symbol.toStringTag]:void 0}function i9(e){return mBe(e).concat(gBe(e))}var _Be=Object.hasOwn||function(e,n){return vBe.call(e,n)};function Yh(e,n){return e===n||!e&&!n&&e!==e&&n!==n}var bBe="__v",EBe="__o",xBe="_owner",a9=Object.getOwnPropertyDescriptor,s9=Object.keys;function SBe(e,n,a){var o=e.length;if(n.length!==o)return!1;for(;o-- >0;)if(!a.equals(e[o],n[o],o,o,e,n,a))return!1;return!0}function wBe(e,n){return Yh(e.getTime(),n.getTime())}function TBe(e,n){return e.name===n.name&&e.message===n.message&&e.cause===n.cause&&e.stack===n.stack}function CBe(e,n){return e===n}function o9(e,n,a){var o=e.size;if(o!==n.size)return!1;if(!o)return!0;for(var d=new Array(o),p=e.entries(),m,y,b=0;(m=p.next())&&!m.done;){for(var E=n.entries(),T=!1,w=0;(y=E.next())&&!y.done;){if(d[w]){w++;continue}var N=m.value,D=y.value;if(a.equals(N[0],D[0],b,w,e,n,a)&&a.equals(N[1],D[1],N[0],D[0],e,n,a)){T=d[w]=!0;break}w++}if(!T)return!1;b++}return!0}var NBe=Yh;function RBe(e,n,a){var o=s9(e),d=o.length;if(s9(n).length!==d)return!1;for(;d-- >0;)if(!bee(e,n,a,o[d]))return!1;return!0}function qv(e,n,a){var o=i9(e),d=o.length;if(i9(n).length!==d)return!1;for(var p,m,y;d-- >0;)if(p=o[d],!bee(e,n,a,p)||(m=a9(e,p),y=a9(n,p),(m||y)&&(!m||!y||m.configurable!==y.configurable||m.enumerable!==y.enumerable||m.writable!==y.writable)))return!1;return!0}function ABe(e,n){return Yh(e.valueOf(),n.valueOf())}function IBe(e,n){return e.source===n.source&&e.flags===n.flags}function c9(e,n,a){var o=e.size;if(o!==n.size)return!1;if(!o)return!0;for(var d=new Array(o),p=e.values(),m,y;(m=p.next())&&!m.done;){for(var b=n.values(),E=!1,T=0;(y=b.next())&&!y.done;){if(!d[T]&&a.equals(m.value,y.value,m.value,y.value,e,n,a)){E=d[T]=!0;break}T++}if(!E)return!1}return!0}function OBe(e,n){var a=e.length;if(n.length!==a)return!1;for(;a-- >0;)if(e[a]!==n[a])return!1;return!0}function PBe(e,n){return e.hostname===n.hostname&&e.pathname===n.pathname&&e.protocol===n.protocol&&e.port===n.port&&e.hash===n.hash&&e.username===n.username&&e.password===n.password}function bee(e,n,a,o){return(o===xBe||o===EBe||o===bBe)&&(e.$$typeof||n.$$typeof)?!0:_Be(n,o)&&a.equals(e[o],n[o],o,o,e,n,a)}var DBe="[object Arguments]",kBe="[object Boolean]",jBe="[object Date]",LBe="[object Error]",MBe="[object Map]",UBe="[object Number]",FBe="[object Object]",VBe="[object RegExp]",BBe="[object Set]",GBe="[object String]",WBe="[object URL]",$Be=Array.isArray,l9=typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView:null,d9=Object.assign,HBe=Object.prototype.toString.call.bind(Object.prototype.toString);function zBe(e){var n=e.areArraysEqual,a=e.areDatesEqual,o=e.areErrorsEqual,d=e.areFunctionsEqual,p=e.areMapsEqual,m=e.areNumbersEqual,y=e.areObjectsEqual,b=e.arePrimitiveWrappersEqual,E=e.areRegExpsEqual,T=e.areSetsEqual,w=e.areTypedArraysEqual,N=e.areUrlsEqual,D=e.unknownTagComparators;return function(k,O,F){if(k===O)return!0;if(k==null||O==null)return!1;var M=typeof k;if(M!==typeof O)return!1;if(M!=="object")return M==="number"?m(k,O,F):M==="function"?d(k,O,F):!1;var V=k.constructor;if(V!==O.constructor)return!1;if(V===Object)return y(k,O,F);if($Be(k))return n(k,O,F);if(l9!=null&&l9(k))return w(k,O,F);if(V===Date)return a(k,O,F);if(V===RegExp)return E(k,O,F);if(V===Map)return p(k,O,F);if(V===Set)return T(k,O,F);var H=HBe(k);if(H===jBe)return a(k,O,F);if(H===VBe)return E(k,O,F);if(H===MBe)return p(k,O,F);if(H===BBe)return T(k,O,F);if(H===FBe)return typeof k.then!="function"&&typeof O.then!="function"&&y(k,O,F);if(H===WBe)return N(k,O,F);if(H===LBe)return o(k,O,F);if(H===DBe)return y(k,O,F);if(H===kBe||H===UBe||H===GBe)return b(k,O,F);if(D){var B=D[H];if(!B){var z=yBe(k);z&&(B=D[z])}if(B)return B(k,O,F)}return!1}}function KBe(e){var n=e.circular,a=e.createCustomConfig,o=e.strict,d={areArraysEqual:o?qv:SBe,areDatesEqual:wBe,areErrorsEqual:TBe,areFunctionsEqual:CBe,areMapsEqual:o?r9(o9,qv):o9,areNumbersEqual:NBe,areObjectsEqual:o?qv:RBe,arePrimitiveWrappersEqual:ABe,areRegExpsEqual:IBe,areSetsEqual:o?r9(c9,qv):c9,areTypedArraysEqual:o?qv:OBe,areUrlsEqual:PBe,unknownTagComparators:void 0};if(a&&(d=d9({},d,a(d))),n){var p=yx(d.areArraysEqual),m=yx(d.areMapsEqual),y=yx(d.areObjectsEqual),b=yx(d.areSetsEqual);d=d9({},d,{areArraysEqual:p,areMapsEqual:m,areObjectsEqual:y,areSetsEqual:b})}return d}function YBe(e){return function(n,a,o,d,p,m,y){return e(n,a,y)}}function qBe(e){var n=e.circular,a=e.comparator,o=e.createState,d=e.equals,p=e.strict;if(o)return function(b,E){var T=o(),w=T.cache,N=w===void 0?n?new WeakMap:void 0:w,D=T.meta;return a(b,E,{cache:N,equals:d,meta:D,strict:p})};if(n)return function(b,E){return a(b,E,{cache:new WeakMap,equals:d,meta:void 0,strict:p})};var m={cache:void 0,equals:d,meta:void 0,strict:p};return function(b,E){return a(b,E,m)}}var XBe=su();su({strict:!0});su({circular:!0});su({circular:!0,strict:!0});su({createInternalComparator:function(){return Yh}});su({strict:!0,createInternalComparator:function(){return Yh}});su({circular:!0,createInternalComparator:function(){return Yh}});su({circular:!0,createInternalComparator:function(){return Yh},strict:!0});function su(e){e===void 0&&(e={});var n=e.circular,a=n===void 0?!1:n,o=e.createInternalComparator,d=e.createState,p=e.strict,m=p===void 0?!1:p,y=KBe(e),b=zBe(y),E=o?o(b):YBe(b);return qBe({circular:a,comparator:b,createState:d,equals:E,strict:m})}function JBe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function u9(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=-1,o=function d(p){a<0&&(a=p),p-a>n?(e(p),a=-1):JBe(d)};requestAnimationFrame(o)}function vD(e){"@babel/helpers - typeof";return vD=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vD(e)}function QBe(e){return n6e(e)||t6e(e)||e6e(e)||ZBe()}function ZBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e6e(e,n){if(e){if(typeof e=="string")return h9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h9(e,n)}}function h9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function t6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function n6e(e){if(Array.isArray(e))return e}function r6e(){var e={},n=function(){return null},a=!1,o=function d(p){if(!a){if(Array.isArray(p)){if(!p.length)return;var m=p,y=QBe(m),b=y[0],E=y.slice(1);if(typeof b=="number"){u9(d.bind(null,E),b);return}d(b),u9(d.bind(null,E));return}vD(p)==="object"&&(e=p,n(e)),typeof p=="function"&&p()}};return{stop:function(){a=!0},start:function(p){a=!1,o(p)},subscribe:function(p){return n=p,function(){n=function(){return null}}}}}function o_(e){"@babel/helpers - typeof";return o_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},o_(e)}function p9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function f9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?p9(Object(a),!0).forEach(function(o){Eee(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Eee(e,n,a){return n=i6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i6e(e){var n=a6e(e,"string");return o_(n)==="symbol"?n:String(n)}function a6e(e,n){if(o_(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(o_(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var s6e=function(n,a){return[Object.keys(n),Object.keys(a)].reduce(function(o,d){return o.filter(function(p){return d.includes(p)})})},o6e=function(n){return n},c6e=function(n){return n.replace(/([A-Z])/g,function(a){return"-".concat(a.toLowerCase())})},vy=function(n,a){return Object.keys(a).reduce(function(o,d){return f9(f9({},o),{},Eee({},d,n(d,a[d])))},{})},m9=function(n,a,o){return n.map(function(d){return"".concat(c6e(d)," ").concat(a,"ms ").concat(o)}).join(",")};function l6e(e,n){return h6e(e)||u6e(e,n)||xee(e,n)||d6e()}function d6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function h6e(e){if(Array.isArray(e))return e}function p6e(e){return g6e(e)||m6e(e)||xee(e)||f6e()}function f6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xee(e,n){if(e){if(typeof e=="string")return yD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yD(e,n)}}function m6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function g6e(e){if(Array.isArray(e))return yD(e)}function yD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var ZS=1e-4,See=function(n,a){return[0,3*n,3*a-6*n,3*n-3*a+1]},wee=function(n,a){return n.map(function(o,d){return o*Math.pow(a,d)}).reduce(function(o,d){return o+d})},g9=function(n,a){return function(o){var d=See(n,a);return wee(d,o)}},v6e=function(n,a){return function(o){var d=See(n,a),p=[].concat(p6e(d.map(function(m,y){return m*y}).slice(1)),[0]);return wee(p,o)}},v9=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var d=a[0],p=a[1],m=a[2],y=a[3];if(a.length===1)switch(a[0]){case"linear":d=0,p=0,m=1,y=1;break;case"ease":d=.25,p=.1,m=.25,y=1;break;case"ease-in":d=.42,p=0,m=1,y=1;break;case"ease-out":d=.42,p=0,m=.58,y=1;break;case"ease-in-out":d=0,p=0,m=.58,y=1;break;default:{var b=a[0].split("(");if(b[0]==="cubic-bezier"&&b[1].split(")")[0].split(",").length===4){var E=b[1].split(")")[0].split(",").map(function(O){return parseFloat(O)}),T=l6e(E,4);d=T[0],p=T[1],m=T[2],y=T[3]}}}var w=g9(d,m),N=g9(p,y),D=v6e(d,m),A=function(F){return F>1?1:F<0?0:F},k=function(F){for(var M=F>1?1:F,V=M,H=0;H<8;++H){var B=w(V)-M,z=D(V);if(Math.abs(B-M)<ZS||z<ZS)return N(V);V=A(V-B/z)}return N(V)};return k.isStepper=!1,k},y6e=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.stiff,o=a===void 0?100:a,d=n.damping,p=d===void 0?8:d,m=n.dt,y=m===void 0?17:m,b=function(T,w,N){var D=-(T-w)*o,A=N*p,k=N+(D-A)*y/1e3,O=N*y/1e3+T;return Math.abs(O-w)<ZS&&Math.abs(k)<ZS?[w,0]:[O,k]};return b.isStepper=!0,b.dt=y,b},_6e=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var d=a[0];if(typeof d=="string")switch(d){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return v9(d);case"spring":return y6e();default:if(d.split("(")[0]==="cubic-bezier")return v9(d)}return typeof d=="function"?d:null};function c_(e){"@babel/helpers - typeof";return c_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},c_(e)}function y9(e){return x6e(e)||E6e(e)||Tee(e)||b6e()}function b6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function x6e(e){if(Array.isArray(e))return bD(e)}function _9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Hi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?_9(Object(a),!0).forEach(function(o){_D(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function _D(e,n,a){return n=S6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function S6e(e){var n=w6e(e,"string");return c_(n)==="symbol"?n:String(n)}function w6e(e,n){if(c_(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(c_(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function T6e(e,n){return R6e(e)||N6e(e,n)||Tee(e,n)||C6e()}function C6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tee(e,n){if(e){if(typeof e=="string")return bD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bD(e,n)}}function bD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function N6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function R6e(e){if(Array.isArray(e))return e}var ew=function(n,a,o){return n+(a-n)*o},ED=function(n){var a=n.from,o=n.to;return a!==o},A6e=function e(n,a,o){var d=vy(function(p,m){if(ED(m)){var y=n(m.from,m.to,m.velocity),b=T6e(y,2),E=b[0],T=b[1];return Hi(Hi({},m),{},{from:E,velocity:T})}return m},a);return o<1?vy(function(p,m){return ED(m)?Hi(Hi({},m),{},{velocity:ew(m.velocity,d[p].velocity,o),from:ew(m.from,d[p].from,o)}):m},a):e(n,d,o-1)};const I6e=function(e,n,a,o,d){var p=s6e(e,n),m=p.reduce(function(O,F){return Hi(Hi({},O),{},_D({},F,[e[F],n[F]]))},{}),y=p.reduce(function(O,F){return Hi(Hi({},O),{},_D({},F,{from:e[F],velocity:0,to:n[F]}))},{}),b=-1,E,T,w=function(){return null},N=function(){return vy(function(F,M){return M.from},y)},D=function(){return!Object.values(y).filter(ED).length},A=function(F){E||(E=F);var M=F-E,V=M/a.dt;y=A6e(a,y,V),d(Hi(Hi(Hi({},e),n),N())),E=F,D()||(b=requestAnimationFrame(w))},k=function(F){T||(T=F);var M=(F-T)/o,V=vy(function(B,z){return ew.apply(void 0,y9(z).concat([a(M)]))},m);if(d(Hi(Hi(Hi({},e),n),V)),M<1)b=requestAnimationFrame(w);else{var H=vy(function(B,z){return ew.apply(void 0,y9(z).concat([a(1)]))},m);d(Hi(Hi(Hi({},e),n),H))}};return w=a.isStepper?A:k,function(){return requestAnimationFrame(w),function(){cancelAnimationFrame(b)}}};function ym(e){"@babel/helpers - typeof";return ym=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ym(e)}var O6e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function P6e(e,n){if(e==null)return{};var a=D6e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function D6e(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,p;for(p=0;p<o.length;p++)d=o[p],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}function i1(e){return M6e(e)||L6e(e)||j6e(e)||k6e()}function k6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function j6e(e,n){if(e){if(typeof e=="string")return xD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xD(e,n)}}function L6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function M6e(e){if(Array.isArray(e))return xD(e)}function xD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function b9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Ho(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?b9(Object(a),!0).forEach(function(o){ny(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function ny(e,n,a){return n=Cee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function U6e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function F6e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Cee(o.key),o)}}function V6e(e,n,a){return n&&F6e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cee(e){var n=B6e(e,"string");return ym(n)==="symbol"?n:String(n)}function B6e(e,n){if(ym(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(ym(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function G6e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&SD(e,n)}function SD(e,n){return SD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},SD(e,n)}function W6e(e){var n=$6e();return function(){var o=tw(e),d;if(n){var p=tw(this).constructor;d=Reflect.construct(o,arguments,p)}else d=o.apply(this,arguments);return wD(this,d)}}function wD(e,n){if(n&&(ym(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TD(e)}function TD(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $6e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function tw(e){return tw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},tw(e)}var qc=function(e){G6e(a,e);var n=W6e(a);function a(o,d){var p;U6e(this,a),p=n.call(this,o,d);var m=p.props,y=m.isActive,b=m.attributeName,E=m.from,T=m.to,w=m.steps,N=m.children,D=m.duration;if(p.handleStyleChange=p.handleStyleChange.bind(TD(p)),p.changeStyle=p.changeStyle.bind(TD(p)),!y||D<=0)return p.state={style:{}},typeof N=="function"&&(p.state={style:T}),wD(p);if(w&&w.length)p.state={style:w[0].style};else if(E){if(typeof N=="function")return p.state={style:E},wD(p);p.state={style:b?ny({},b,E):E}}else p.state={style:{}};return p}return V6e(a,[{key:"componentDidMount",value:function(){var d=this.props,p=d.isActive,m=d.canBegin;this.mounted=!0,!(!p||!m)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(d){var p=this.props,m=p.isActive,y=p.canBegin,b=p.attributeName,E=p.shouldReAnimate,T=p.to,w=p.from,N=this.state.style;if(y){if(!m){var D={style:b?ny({},b,T):T};this.state&&N&&(b&&N[b]!==T||!b&&N!==T)&&this.setState(D);return}if(!(XBe(d.to,T)&&d.canBegin&&d.isActive)){var A=!d.canBegin||!d.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var k=A||E?w:d.to;if(this.state&&N){var O={style:b?ny({},b,k):k};(b&&N[b]!==k||!b&&N!==k)&&this.setState(O)}this.runAnimation(Ho(Ho({},this.props),{},{from:k,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var d=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),d&&d()}},{key:"handleStyleChange",value:function(d){this.changeStyle(d)}},{key:"changeStyle",value:function(d){this.mounted&&this.setState({style:d})}},{key:"runJSAnimation",value:function(d){var p=this,m=d.from,y=d.to,b=d.duration,E=d.easing,T=d.begin,w=d.onAnimationEnd,N=d.onAnimationStart,D=I6e(m,y,_6e(E),b,this.changeStyle),A=function(){p.stopJSAnimation=D()};this.manager.start([N,T,A,b,w])}},{key:"runStepAnimation",value:function(d){var p=this,m=d.steps,y=d.begin,b=d.onAnimationStart,E=m[0],T=E.style,w=E.duration,N=w===void 0?0:w,D=function(k,O,F){if(F===0)return k;var M=O.duration,V=O.easing,H=V===void 0?"ease":V,B=O.style,z=O.properties,q=O.onAnimationEnd,Q=F>0?m[F-1]:O,ee=z||Object.keys(B);if(typeof H=="function"||H==="spring")return[].concat(i1(k),[p.runJSAnimation.bind(p,{from:Q.style,to:B,duration:M,easing:H}),M]);var oe=m9(ee,M,H),ne=Ho(Ho(Ho({},Q.style),B),{},{transition:oe});return[].concat(i1(k),[ne,M,q]).filter(o6e)};return this.manager.start([b].concat(i1(m.reduce(D,[T,Math.max(N,y)])),[d.onAnimationEnd]))}},{key:"runAnimation",value:function(d){this.manager||(this.manager=r6e());var p=d.begin,m=d.duration,y=d.attributeName,b=d.to,E=d.easing,T=d.onAnimationStart,w=d.onAnimationEnd,N=d.steps,D=d.children,A=this.manager;if(this.unSubscribe=A.subscribe(this.handleStyleChange),typeof E=="function"||typeof D=="function"||E==="spring"){this.runJSAnimation(d);return}if(N.length>1){this.runStepAnimation(d);return}var k=y?ny({},y,b):b,O=m9(Object.keys(k),m,E);A.start([T,p,Ho(Ho({},k),{},{transition:O}),m,w])}},{key:"render",value:function(){var d=this.props,p=d.children;d.begin;var m=d.duration;d.attributeName,d.easing;var y=d.isActive;d.steps,d.from,d.to,d.canBegin,d.onAnimationEnd,d.shouldReAnimate,d.onAnimationReStart;var b=P6e(d,O6e),E=Y.Children.count(p),T=this.state.style;if(typeof p=="function")return p(T);if(!y||E===0||m<=0)return p;var w=function(D){var A=D.props,k=A.style,O=k===void 0?{}:k,F=A.className,M=Y.cloneElement(D,Ho(Ho({},b),{},{style:Ho(Ho({},O),T),className:F}));return M};return E===1?w(Y.Children.only(p)):me.createElement("div",null,Y.Children.map(p,function(N){return w(N)}))}}]),a}(Y.PureComponent);qc.displayName="Animate";qc.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};qc.propTypes={from:jt.oneOfType([jt.object,jt.string]),to:jt.oneOfType([jt.object,jt.string]),attributeName:jt.string,duration:jt.number,begin:jt.number,easing:jt.oneOfType([jt.string,jt.func]),steps:jt.arrayOf(jt.shape({duration:jt.number.isRequired,style:jt.object.isRequired,easing:jt.oneOfType([jt.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),jt.func]),properties:jt.arrayOf("string"),onAnimationEnd:jt.func})),children:jt.oneOfType([jt.node,jt.func]),isActive:jt.bool,canBegin:jt.bool,onAnimationEnd:jt.func,shouldReAnimate:jt.bool,onAnimationStart:jt.func,onAnimationReStart:jt.func};function l_(e){"@babel/helpers - typeof";return l_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},l_(e)}function nw(){return nw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},nw.apply(this,arguments)}function H6e(e,n){return q6e(e)||Y6e(e,n)||K6e(e,n)||z6e()}function z6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K6e(e,n){if(e){if(typeof e=="string")return E9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return E9(e,n)}}function E9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function Y6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function q6e(e){if(Array.isArray(e))return e}function x9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function S9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?x9(Object(a),!0).forEach(function(o){X6e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):x9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function X6e(e,n,a){return n=J6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function J6e(e){var n=Q6e(e,"string");return l_(n)=="symbol"?n:n+""}function Q6e(e,n){if(l_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(l_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var w9=function(n,a,o,d,p){var m=Math.min(Math.abs(o)/2,Math.abs(d)/2),y=d>=0?1:-1,b=o>=0?1:-1,E=d>=0&&o>=0||d<0&&o<0?1:0,T;if(m>0&&p instanceof Array){for(var w=[0,0,0,0],N=0,D=4;N<D;N++)w[N]=p[N]>m?m:p[N];T="M".concat(n,",").concat(a+y*w[0]),w[0]>0&&(T+="A ".concat(w[0],",").concat(w[0],",0,0,").concat(E,",").concat(n+b*w[0],",").concat(a)),T+="L ".concat(n+o-b*w[1],",").concat(a),w[1]>0&&(T+="A ".concat(w[1],",").concat(w[1],",0,0,").concat(E,`,
        `).concat(n+o,",").concat(a+y*w[1])),T+="L ".concat(n+o,",").concat(a+d-y*w[2]),w[2]>0&&(T+="A ".concat(w[2],",").concat(w[2],",0,0,").concat(E,`,
        `).concat(n+o-b*w[2],",").concat(a+d)),T+="L ".concat(n+b*w[3],",").concat(a+d),w[3]>0&&(T+="A ".concat(w[3],",").concat(w[3],",0,0,").concat(E,`,
        `).concat(n,",").concat(a+d-y*w[3])),T+="Z"}else if(m>0&&p===+p&&p>0){var A=Math.min(m,p);T="M ".concat(n,",").concat(a+y*A,`
            A `).concat(A,",").concat(A,",0,0,").concat(E,",").concat(n+b*A,",").concat(a,`
            L `).concat(n+o-b*A,",").concat(a,`
            A `).concat(A,",").concat(A,",0,0,").concat(E,",").concat(n+o,",").concat(a+y*A,`
            L `).concat(n+o,",").concat(a+d-y*A,`
            A `).concat(A,",").concat(A,",0,0,").concat(E,",").concat(n+o-b*A,",").concat(a+d,`
            L `).concat(n+b*A,",").concat(a+d,`
            A `).concat(A,",").concat(A,",0,0,").concat(E,",").concat(n,",").concat(a+d-y*A," Z")}else T="M ".concat(n,",").concat(a," h ").concat(o," v ").concat(d," h ").concat(-o," Z");return T},Z6e=function(n,a){if(!n||!a)return!1;var o=n.x,d=n.y,p=a.x,m=a.y,y=a.width,b=a.height;if(Math.abs(y)>0&&Math.abs(b)>0){var E=Math.min(p,p+y),T=Math.max(p,p+y),w=Math.min(m,m+b),N=Math.max(m,m+b);return o>=E&&o<=T&&d>=w&&d<=N}return!1},e8e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},cj=function(n){var a=S9(S9({},e8e),n),o=Y.useRef(),d=Y.useState(-1),p=H6e(d,2),m=p[0],y=p[1];Y.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var H=o.current.getTotalLength();H&&y(H)}catch{}},[]);var b=a.x,E=a.y,T=a.width,w=a.height,N=a.radius,D=a.className,A=a.animationEasing,k=a.animationDuration,O=a.animationBegin,F=a.isAnimationActive,M=a.isUpdateAnimationActive;if(b!==+b||E!==+E||T!==+T||w!==+w||T===0||w===0)return null;var V=On("recharts-rectangle",D);return M?me.createElement(qc,{canBegin:m>0,from:{width:T,height:w,x:b,y:E},to:{width:T,height:w,x:b,y:E},duration:k,animationEasing:A,isActive:M},function(H){var B=H.width,z=H.height,q=H.x,Q=H.y;return me.createElement(qc,{canBegin:m>0,from:"0px ".concat(m===-1?1:m,"px"),to:"".concat(m,"px 0px"),attributeName:"strokeDasharray",begin:O,duration:k,isActive:F,easing:A},me.createElement("path",nw({},vn(a,!0),{className:V,d:w9(q,Q,B,z,N),ref:o})))}):me.createElement("path",nw({},vn(a,!0),{className:V,d:w9(b,E,T,w,N)}))};function CD(){return CD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},CD.apply(this,arguments)}var IT=function(n){var a=n.cx,o=n.cy,d=n.r,p=n.className,m=On("recharts-dot",p);return a===+a&&o===+o&&d===+d?Y.createElement("circle",CD({},vn(n,!1),_S(n),{className:m,cx:a,cy:o,r:d})):null};function d_(e){"@babel/helpers - typeof";return d_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},d_(e)}var t8e=["x","y","top","left","width","height","className"];function ND(){return ND=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},ND.apply(this,arguments)}function T9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function n8e(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?T9(Object(a),!0).forEach(function(o){r8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function r8e(e,n,a){return n=i8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i8e(e){var n=a8e(e,"string");return d_(n)=="symbol"?n:n+""}function a8e(e,n){if(d_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(d_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function s8e(e,n){if(e==null)return{};var a=o8e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function o8e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var c8e=function(n,a,o,d,p,m){return"M".concat(n,",").concat(p,"v").concat(d,"M").concat(m,",").concat(a,"h").concat(o)},l8e=function(n){var a=n.x,o=a===void 0?0:a,d=n.y,p=d===void 0?0:d,m=n.top,y=m===void 0?0:m,b=n.left,E=b===void 0?0:b,T=n.width,w=T===void 0?0:T,N=n.height,D=N===void 0?0:N,A=n.className,k=s8e(n,t8e),O=n8e({x:o,y:p,top:y,left:E,width:w,height:D},k);return!ct(o)||!ct(p)||!ct(w)||!ct(D)||!ct(y)||!ct(E)?null:me.createElement("path",ND({},vn(O,!0),{className:On("recharts-cross",A),d:c8e(o,p,w,D,y,E)}))},d8e=VQ,u8e=d8e(Object.getPrototypeOf,Object),h8e=u8e,p8e=Fl,f8e=h8e,m8e=Vl,g8e="[object Object]",v8e=Function.prototype,y8e=Object.prototype,Nee=v8e.toString,_8e=y8e.hasOwnProperty,b8e=Nee.call(Object);function E8e(e){if(!m8e(e)||p8e(e)!=g8e)return!1;var n=f8e(e);if(n===null)return!0;var a=_8e.call(n,"constructor")&&n.constructor;return typeof a=="function"&&a instanceof a&&Nee.call(a)==b8e}var x8e=E8e;const S8e=ar(x8e);var w8e=Fl,T8e=Vl,C8e="[object Boolean]";function N8e(e){return e===!0||e===!1||T8e(e)&&w8e(e)==C8e}var R8e=N8e;const A8e=ar(R8e);function u_(e){"@babel/helpers - typeof";return u_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},u_(e)}function rw(){return rw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},rw.apply(this,arguments)}function I8e(e,n){return k8e(e)||D8e(e,n)||P8e(e,n)||O8e()}function O8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P8e(e,n){if(e){if(typeof e=="string")return C9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return C9(e,n)}}function C9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function D8e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function k8e(e){if(Array.isArray(e))return e}function N9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function R9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?N9(Object(a),!0).forEach(function(o){j8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function j8e(e,n,a){return n=L8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function L8e(e){var n=M8e(e,"string");return u_(n)=="symbol"?n:n+""}function M8e(e,n){if(u_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(u_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var A9=function(n,a,o,d,p){var m=o-d,y;return y="M ".concat(n,",").concat(a),y+="L ".concat(n+o,",").concat(a),y+="L ".concat(n+o-m/2,",").concat(a+p),y+="L ".concat(n+o-m/2-d,",").concat(a+p),y+="L ".concat(n,",").concat(a," Z"),y},U8e={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},F8e=function(n){var a=R9(R9({},U8e),n),o=Y.useRef(),d=Y.useState(-1),p=I8e(d,2),m=p[0],y=p[1];Y.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var V=o.current.getTotalLength();V&&y(V)}catch{}},[]);var b=a.x,E=a.y,T=a.upperWidth,w=a.lowerWidth,N=a.height,D=a.className,A=a.animationEasing,k=a.animationDuration,O=a.animationBegin,F=a.isUpdateAnimationActive;if(b!==+b||E!==+E||T!==+T||w!==+w||N!==+N||T===0&&w===0||N===0)return null;var M=On("recharts-trapezoid",D);return F?me.createElement(qc,{canBegin:m>0,from:{upperWidth:0,lowerWidth:0,height:N,x:b,y:E},to:{upperWidth:T,lowerWidth:w,height:N,x:b,y:E},duration:k,animationEasing:A,isActive:F},function(V){var H=V.upperWidth,B=V.lowerWidth,z=V.height,q=V.x,Q=V.y;return me.createElement(qc,{canBegin:m>0,from:"0px ".concat(m===-1?1:m,"px"),to:"".concat(m,"px 0px"),attributeName:"strokeDasharray",begin:O,duration:k,easing:A},me.createElement("path",rw({},vn(a,!0),{className:M,d:A9(q,Q,H,B,z),ref:o})))}):me.createElement("g",null,me.createElement("path",rw({},vn(a,!0),{className:M,d:A9(b,E,T,w,N)})))},V8e=["option","shapeType","propTransformer","activeClassName","isActive"];function h_(e){"@babel/helpers - typeof";return h_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},h_(e)}function B8e(e,n){if(e==null)return{};var a=G8e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function G8e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function I9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function iw(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?I9(Object(a),!0).forEach(function(o){W8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):I9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function W8e(e,n,a){return n=$8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function $8e(e){var n=H8e(e,"string");return h_(n)=="symbol"?n:n+""}function H8e(e,n){if(h_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(h_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function z8e(e,n){return iw(iw({},n),e)}function K8e(e,n){return e==="symbols"}function O9(e){var n=e.shapeType,a=e.elementProps;switch(n){case"rectangle":return me.createElement(cj,a);case"trapezoid":return me.createElement(F8e,a);case"sector":return me.createElement(gee,a);case"symbols":if(K8e(n))return me.createElement(N2,a);break;default:return null}}function Y8e(e){return Y.isValidElement(e)?e.props:e}function q8e(e){var n=e.option,a=e.shapeType,o=e.propTransformer,d=o===void 0?z8e:o,p=e.activeClassName,m=p===void 0?"recharts-active-shape":p,y=e.isActive,b=B8e(e,V8e),E;if(Y.isValidElement(n))E=Y.cloneElement(n,iw(iw({},b),Y8e(n)));else if(hn(n))E=n(b);else if(S8e(n)&&!A8e(n)){var T=d(n,b);E=me.createElement(O9,{shapeType:a,elementProps:T})}else{var w=b;E=me.createElement(O9,{shapeType:a,elementProps:w})}return y?me.createElement(fr,{className:m},E):E}function OT(e,n){return n!=null&&"trapezoids"in e.props}function PT(e,n){return n!=null&&"sectors"in e.props}function p_(e,n){return n!=null&&"points"in e.props}function X8e(e,n){var a,o,d=e.x===(n==null||(a=n.labelViewBox)===null||a===void 0?void 0:a.x)||e.x===n.x,p=e.y===(n==null||(o=n.labelViewBox)===null||o===void 0?void 0:o.y)||e.y===n.y;return d&&p}function J8e(e,n){var a=e.endAngle===n.endAngle,o=e.startAngle===n.startAngle;return a&&o}function Q8e(e,n){var a=e.x===n.x,o=e.y===n.y,d=e.z===n.z;return a&&o&&d}function Z8e(e,n){var a;return OT(e,n)?a=X8e:PT(e,n)?a=J8e:p_(e,n)&&(a=Q8e),a}function eGe(e,n){var a;return OT(e,n)?a="trapezoids":PT(e,n)?a="sectors":p_(e,n)&&(a="points"),a}function tGe(e,n){if(OT(e,n)){var a;return(a=n.tooltipPayload)===null||a===void 0||(a=a[0])===null||a===void 0||(a=a.payload)===null||a===void 0?void 0:a.payload}if(PT(e,n)){var o;return(o=n.tooltipPayload)===null||o===void 0||(o=o[0])===null||o===void 0||(o=o.payload)===null||o===void 0?void 0:o.payload}return p_(e,n)?n.payload:{}}function nGe(e){var n=e.activeTooltipItem,a=e.graphicalItem,o=e.itemData,d=eGe(a,n),p=tGe(a,n),m=o.filter(function(b,E){var T=gm(p,b),w=a.props[d].filter(function(A){var k=Z8e(a,n);return k(A,n)}),N=a.props[d].indexOf(w[w.length-1]),D=E===N;return T&&D}),y=o.indexOf(m[m.length-1]);return y}var rGe=Math.ceil,iGe=Math.max;function aGe(e,n,a,o){for(var d=-1,p=iGe(rGe((n-e)/(a||1)),0),m=Array(p);p--;)m[o?p:++d]=e,e+=a;return m}var sGe=aGe,oGe=aZ,P9=1/0,cGe=17976931348623157e292;function lGe(e){if(!e)return e===0?e:0;if(e=oGe(e),e===P9||e===-P9){var n=e<0?-1:1;return n*cGe}return e===e?e:0}var Ree=lGe,dGe=sGe,uGe=bT,a1=Ree;function hGe(e){return function(n,a,o){return o&&typeof o!="number"&&uGe(n,a,o)&&(a=o=void 0),n=a1(n),a===void 0?(a=n,n=0):a=a1(a),o=o===void 0?n<a?1:-1:a1(o),dGe(n,a,o,e)}}var pGe=hGe,fGe=pGe,mGe=fGe(),gGe=mGe;const aw=ar(gGe);function f_(e){"@babel/helpers - typeof";return f_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},f_(e)}function D9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function k9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?D9(Object(a),!0).forEach(function(o){Aee(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):D9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Aee(e,n,a){return n=vGe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function vGe(e){var n=yGe(e,"string");return f_(n)=="symbol"?n:n+""}function yGe(e,n){if(f_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(f_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var _Ge=["Webkit","Moz","O","ms"],bGe=function(n,a){var o=n.replace(/(\w)/,function(p){return p.toUpperCase()}),d=_Ge.reduce(function(p,m){return k9(k9({},p),{},Aee({},m+o,a))},{});return d[n]=a,d};function _m(e){"@babel/helpers - typeof";return _m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_m(e)}function sw(){return sw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},sw.apply(this,arguments)}function j9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function s1(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?j9(Object(a),!0).forEach(function(o){ys(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function EGe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function L9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Oee(o.key),o)}}function xGe(e,n,a){return n&&L9(e.prototype,n),a&&L9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function SGe(e,n,a){return n=ow(n),wGe(e,Iee()?Reflect.construct(n,a||[],ow(e).constructor):n.apply(e,a))}function wGe(e,n){if(n&&(_m(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TGe(e)}function TGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Iee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Iee=function(){return!!e})()}function ow(e){return ow=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ow(e)}function CGe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&RD(e,n)}function RD(e,n){return RD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},RD(e,n)}function ys(e,n,a){return n=Oee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Oee(e){var n=NGe(e,"string");return _m(n)=="symbol"?n:n+""}function NGe(e,n){if(_m(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(_m(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var RGe=function(n){var a=n.data,o=n.startIndex,d=n.endIndex,p=n.x,m=n.width,y=n.travellerWidth;if(!a||!a.length)return{};var b=a.length,E=my().domain(aw(0,b)).range([p,p+m-y]),T=E.domain().map(function(w){return E(w)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:E(o),endX:E(d),scale:E,scaleValues:T}},M9=function(n){return n.changedTouches&&!!n.changedTouches.length},bm=function(e){function n(a){var o;return EGe(this,n),o=SGe(this,n,[a]),ys(o,"handleDrag",function(d){o.leaveTimer&&(clearTimeout(o.leaveTimer),o.leaveTimer=null),o.state.isTravellerMoving?o.handleTravellerMove(d):o.state.isSlideMoving&&o.handleSlideDrag(d)}),ys(o,"handleTouchMove",function(d){d.changedTouches!=null&&d.changedTouches.length>0&&o.handleDrag(d.changedTouches[0])}),ys(o,"handleDragEnd",function(){o.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var d=o.props,p=d.endIndex,m=d.onDragEnd,y=d.startIndex;m==null||m({endIndex:p,startIndex:y})}),o.detachDragEndListener()}),ys(o,"handleLeaveWrapper",function(){(o.state.isTravellerMoving||o.state.isSlideMoving)&&(o.leaveTimer=window.setTimeout(o.handleDragEnd,o.props.leaveTimeOut))}),ys(o,"handleEnterSlideOrTraveller",function(){o.setState({isTextActive:!0})}),ys(o,"handleLeaveSlideOrTraveller",function(){o.setState({isTextActive:!1})}),ys(o,"handleSlideDragStart",function(d){var p=M9(d)?d.changedTouches[0]:d;o.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:p.pageX}),o.attachDragEndListener()}),o.travellerDragStartHandlers={startX:o.handleTravellerDragStart.bind(o,"startX"),endX:o.handleTravellerDragStart.bind(o,"endX")},o.state={},o}return CGe(n,e),xGe(n,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(o){var d=o.startX,p=o.endX,m=this.state.scaleValues,y=this.props,b=y.gap,E=y.data,T=E.length-1,w=Math.min(d,p),N=Math.max(d,p),D=n.getIndexInRange(m,w),A=n.getIndexInRange(m,N);return{startIndex:D-D%b,endIndex:A===T?T:A-A%b}}},{key:"getTextOfTick",value:function(o){var d=this.props,p=d.data,m=d.tickFormatter,y=d.dataKey,b=Ra(p[o],y,o);return hn(m)?m(b,o):b}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(o){var d=this.state,p=d.slideMoveStartX,m=d.startX,y=d.endX,b=this.props,E=b.x,T=b.width,w=b.travellerWidth,N=b.startIndex,D=b.endIndex,A=b.onChange,k=o.pageX-p;k>0?k=Math.min(k,E+T-w-y,E+T-w-m):k<0&&(k=Math.max(k,E-m,E-y));var O=this.getIndex({startX:m+k,endX:y+k});(O.startIndex!==N||O.endIndex!==D)&&A&&A(O),this.setState({startX:m+k,endX:y+k,slideMoveStartX:o.pageX})}},{key:"handleTravellerDragStart",value:function(o,d){var p=M9(d)?d.changedTouches[0]:d;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:o,brushMoveStartX:p.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(o){var d=this.state,p=d.brushMoveStartX,m=d.movingTravellerId,y=d.endX,b=d.startX,E=this.state[m],T=this.props,w=T.x,N=T.width,D=T.travellerWidth,A=T.onChange,k=T.gap,O=T.data,F={startX:this.state.startX,endX:this.state.endX},M=o.pageX-p;M>0?M=Math.min(M,w+N-D-E):M<0&&(M=Math.max(M,w-E)),F[m]=E+M;var V=this.getIndex(F),H=V.startIndex,B=V.endIndex,z=function(){var Q=O.length-1;return m==="startX"&&(y>b?H%k===0:B%k===0)||y<b&&B===Q||m==="endX"&&(y>b?B%k===0:H%k===0)||y>b&&B===Q};this.setState(ys(ys({},m,E+M),"brushMoveStartX",o.pageX),function(){A&&z()&&A(V)})}},{key:"handleTravellerMoveKeyboard",value:function(o,d){var p=this,m=this.state,y=m.scaleValues,b=m.startX,E=m.endX,T=this.state[d],w=y.indexOf(T);if(w!==-1){var N=w+o;if(!(N===-1||N>=y.length)){var D=y[N];d==="startX"&&D>=E||d==="endX"&&D<=b||this.setState(ys({},d,D),function(){p.props.onChange(p.getIndex({startX:p.state.startX,endX:p.state.endX}))})}}}},{key:"renderBackground",value:function(){var o=this.props,d=o.x,p=o.y,m=o.width,y=o.height,b=o.fill,E=o.stroke;return me.createElement("rect",{stroke:E,fill:b,x:d,y:p,width:m,height:y})}},{key:"renderPanorama",value:function(){var o=this.props,d=o.x,p=o.y,m=o.width,y=o.height,b=o.data,E=o.children,T=o.padding,w=Y.Children.only(E);return w?me.cloneElement(w,{x:d,y:p,width:m,height:y,margin:T,compact:!0,data:b}):null}},{key:"renderTravellerLayer",value:function(o,d){var p,m,y=this,b=this.props,E=b.y,T=b.travellerWidth,w=b.height,N=b.traveller,D=b.ariaLabel,A=b.data,k=b.startIndex,O=b.endIndex,F=Math.max(o,this.props.x),M=s1(s1({},vn(this.props,!1)),{},{x:F,y:E,width:T,height:w}),V=D||"Min value: ".concat((p=A[k])===null||p===void 0?void 0:p.name,", Max value: ").concat((m=A[O])===null||m===void 0?void 0:m.name);return me.createElement(fr,{tabIndex:0,role:"slider","aria-label":V,"aria-valuenow":o,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[d],onTouchStart:this.travellerDragStartHandlers[d],onKeyDown:function(B){["ArrowLeft","ArrowRight"].includes(B.key)&&(B.preventDefault(),B.stopPropagation(),y.handleTravellerMoveKeyboard(B.key==="ArrowRight"?1:-1,d))},onFocus:function(){y.setState({isTravellerFocused:!0})},onBlur:function(){y.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},n.renderTraveller(N,M))}},{key:"renderSlide",value:function(o,d){var p=this.props,m=p.y,y=p.height,b=p.stroke,E=p.travellerWidth,T=Math.min(o,d)+E,w=Math.max(Math.abs(d-o)-E,0);return me.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:b,fillOpacity:.2,x:T,y:m,width:w,height:y})}},{key:"renderText",value:function(){var o=this.props,d=o.startIndex,p=o.endIndex,m=o.y,y=o.height,b=o.travellerWidth,E=o.stroke,T=this.state,w=T.startX,N=T.endX,D=5,A={pointerEvents:"none",fill:E};return me.createElement(fr,{className:"recharts-brush-texts"},me.createElement(jS,sw({textAnchor:"end",verticalAnchor:"middle",x:Math.min(w,N)-D,y:m+y/2},A),this.getTextOfTick(d)),me.createElement(jS,sw({textAnchor:"start",verticalAnchor:"middle",x:Math.max(w,N)+b+D,y:m+y/2},A),this.getTextOfTick(p)))}},{key:"render",value:function(){var o=this.props,d=o.data,p=o.className,m=o.children,y=o.x,b=o.y,E=o.width,T=o.height,w=o.alwaysShowText,N=this.state,D=N.startX,A=N.endX,k=N.isTextActive,O=N.isSlideMoving,F=N.isTravellerMoving,M=N.isTravellerFocused;if(!d||!d.length||!ct(y)||!ct(b)||!ct(E)||!ct(T)||E<=0||T<=0)return null;var V=On("recharts-brush",p),H=me.Children.count(m)===1,B=bGe("userSelect","none");return me.createElement(fr,{className:V,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:B},this.renderBackground(),H&&this.renderPanorama(),this.renderSlide(D,A),this.renderTravellerLayer(D,"startX"),this.renderTravellerLayer(A,"endX"),(k||O||F||M||w)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(o){var d=o.x,p=o.y,m=o.width,y=o.height,b=o.stroke,E=Math.floor(p+y/2)-1;return me.createElement(me.Fragment,null,me.createElement("rect",{x:d,y:p,width:m,height:y,fill:b,stroke:"none"}),me.createElement("line",{x1:d+1,y1:E,x2:d+m-1,y2:E,fill:"none",stroke:"#fff"}),me.createElement("line",{x1:d+1,y1:E+2,x2:d+m-1,y2:E+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(o,d){var p;return me.isValidElement(o)?p=me.cloneElement(o,d):hn(o)?p=o(d):p=n.renderDefaultTraveller(d),p}},{key:"getDerivedStateFromProps",value:function(o,d){var p=o.data,m=o.width,y=o.x,b=o.travellerWidth,E=o.updateId,T=o.startIndex,w=o.endIndex;if(p!==d.prevData||E!==d.prevUpdateId)return s1({prevData:p,prevTravellerWidth:b,prevUpdateId:E,prevX:y,prevWidth:m},p&&p.length?RGe({data:p,width:m,x:y,travellerWidth:b,startIndex:T,endIndex:w}):{scale:null,scaleValues:null});if(d.scale&&(m!==d.prevWidth||y!==d.prevX||b!==d.prevTravellerWidth)){d.scale.range([y,y+m-b]);var N=d.scale.domain().map(function(D){return d.scale(D)});return{prevData:p,prevTravellerWidth:b,prevUpdateId:E,prevX:y,prevWidth:m,startX:d.scale(o.startIndex),endX:d.scale(o.endIndex),scaleValues:N}}return null}},{key:"getIndexInRange",value:function(o,d){for(var p=o.length,m=0,y=p-1;y-m>1;){var b=Math.floor((m+y)/2);o[b]>d?y=b:m=b}return d>=o[y]?y:m}}])}(Y.PureComponent);ys(bm,"displayName","Brush");ys(bm,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var AGe=k2;function IGe(e,n){var a;return AGe(e,function(o,d,p){return a=n(o,d,p),!a}),!!a}var OGe=IGe,PGe=PQ,DGe=ru,kGe=OGe,jGe=rs,LGe=bT;function MGe(e,n,a){var o=jGe(e)?PGe:kGe;return a&&LGe(e,n,a)&&(n=void 0),o(e,DGe(n))}var UGe=MGe;const FGe=ar(UGe);var Hc=function(n,a){var o=n.alwaysShow,d=n.ifOverflow;return o&&(d="extendDomain"),d===a},U9=eZ;function VGe(e,n,a){n=="__proto__"&&U9?U9(e,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[n]=a}var BGe=VGe,GGe=BGe,WGe=QQ,$Ge=ru;function HGe(e,n){var a={};return n=$Ge(n),WGe(e,function(o,d,p){GGe(a,d,n(o,d,p))}),a}var zGe=HGe;const KGe=ar(zGe);function YGe(e,n){for(var a=-1,o=e==null?0:e.length;++a<o;)if(!n(e[a],a,e))return!1;return!0}var qGe=YGe,XGe=k2;function JGe(e,n){var a=!0;return XGe(e,function(o,d,p){return a=!!n(o,d,p),a}),a}var QGe=JGe,ZGe=qGe,eWe=QGe,tWe=ru,nWe=rs,rWe=bT;function iWe(e,n,a){var o=nWe(e)?ZGe:eWe;return a&&rWe(e,n,a)&&(n=void 0),o(e,tWe(n))}var aWe=iWe;const Pee=ar(aWe);var sWe=["x","y"];function m_(e){"@babel/helpers - typeof";return m_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},m_(e)}function AD(){return AD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},AD.apply(this,arguments)}function F9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Xv(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?F9(Object(a),!0).forEach(function(o){oWe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function oWe(e,n,a){return n=cWe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function cWe(e){var n=lWe(e,"string");return m_(n)=="symbol"?n:n+""}function lWe(e,n){if(m_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(m_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function dWe(e,n){if(e==null)return{};var a=uWe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function uWe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function hWe(e,n){var a=e.x,o=e.y,d=dWe(e,sWe),p="".concat(a),m=parseInt(p,10),y="".concat(o),b=parseInt(y,10),E="".concat(n.height||d.height),T=parseInt(E,10),w="".concat(n.width||d.width),N=parseInt(w,10);return Xv(Xv(Xv(Xv(Xv({},n),d),m?{x:m}:{}),b?{y:b}:{}),{},{height:T,width:N,name:n.name,radius:n.radius})}function V9(e){return me.createElement(q8e,AD({shapeType:"rectangle",propTransformer:hWe,activeClassName:"recharts-active-bar"},e))}var pWe=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(o,d){if(typeof n=="number")return n;var p=ct(o)||IAe(o);return p?n(o,d):(p||Vh(),a)}},fWe=["value","background"],Dee;function Em(e){"@babel/helpers - typeof";return Em=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Em(e)}function mWe(e,n){if(e==null)return{};var a=gWe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function gWe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function cw(){return cw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},cw.apply(this,arguments)}function B9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function oi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?B9(Object(a),!0).forEach(function(o){jd(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):B9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function vWe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function G9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,jee(o.key),o)}}function yWe(e,n,a){return n&&G9(e.prototype,n),a&&G9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _We(e,n,a){return n=lw(n),bWe(e,kee()?Reflect.construct(n,a||[],lw(e).constructor):n.apply(e,a))}function bWe(e,n){if(n&&(Em(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return EWe(e)}function EWe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kee=function(){return!!e})()}function lw(e){return lw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},lw(e)}function xWe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&ID(e,n)}function ID(e,n){return ID=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},ID(e,n)}function jd(e,n,a){return n=jee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function jee(e){var n=SWe(e,"string");return Em(n)=="symbol"?n:n+""}function SWe(e,n){if(Em(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Em(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var B_=function(e){function n(){var a;vWe(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=_We(this,n,[].concat(d)),jd(a,"state",{isAnimationFinished:!1}),jd(a,"id",qm("recharts-bar-")),jd(a,"handleAnimationEnd",function(){var m=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),m&&m()}),jd(a,"handleAnimationStart",function(){var m=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),m&&m()}),a}return xWe(n,e),yWe(n,[{key:"renderRectanglesStatically",value:function(o){var d=this,p=this.props,m=p.shape,y=p.dataKey,b=p.activeIndex,E=p.activeBar,T=vn(this.props,!1);return o&&o.map(function(w,N){var D=N===b,A=D?E:m,k=oi(oi(oi({},T),w),{},{isActive:D,option:A,index:N,dataKey:y,onAnimationStart:d.handleAnimationStart,onAnimationEnd:d.handleAnimationEnd});return me.createElement(fr,cw({className:"recharts-bar-rectangle"},bS(d.props,w,N),{key:"rectangle-".concat(w==null?void 0:w.x,"-").concat(w==null?void 0:w.y,"-").concat(w==null?void 0:w.value,"-").concat(N)}),me.createElement(V9,k))})}},{key:"renderRectanglesWithAnimation",value:function(){var o=this,d=this.props,p=d.data,m=d.layout,y=d.isAnimationActive,b=d.animationBegin,E=d.animationDuration,T=d.animationEasing,w=d.animationId,N=this.state.prevData;return me.createElement(qc,{begin:b,duration:E,isActive:y,easing:T,from:{t:0},to:{t:1},key:"bar-".concat(w),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(D){var A=D.t,k=p.map(function(O,F){var M=N&&N[F];if(M){var V=Ki(M.x,O.x),H=Ki(M.y,O.y),B=Ki(M.width,O.width),z=Ki(M.height,O.height);return oi(oi({},O),{},{x:V(A),y:H(A),width:B(A),height:z(A)})}if(m==="horizontal"){var q=Ki(0,O.height),Q=q(A);return oi(oi({},O),{},{y:O.y+O.height-Q,height:Q})}var ee=Ki(0,O.width),oe=ee(A);return oi(oi({},O),{},{width:oe})});return me.createElement(fr,null,o.renderRectanglesStatically(k))})}},{key:"renderRectangles",value:function(){var o=this.props,d=o.data,p=o.isAnimationActive,m=this.state.prevData;return p&&d&&d.length&&(!m||!gm(m,d))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(d)}},{key:"renderBackground",value:function(){var o=this,d=this.props,p=d.data,m=d.dataKey,y=d.activeIndex,b=vn(this.props.background,!1);return p.map(function(E,T){E.value;var w=E.background,N=mWe(E,fWe);if(!w)return null;var D=oi(oi(oi(oi(oi({},N),{},{fill:"#eee"},w),b),bS(o.props,E,T)),{},{onAnimationStart:o.handleAnimationStart,onAnimationEnd:o.handleAnimationEnd,dataKey:m,index:T,className:"recharts-bar-background-rectangle"});return me.createElement(V9,cw({key:"background-bar-".concat(T),option:o.props.background,isActive:T===y},D))})}},{key:"renderErrorBar",value:function(o,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var p=this.props,m=p.data,y=p.xAxis,b=p.yAxis,E=p.layout,T=p.children,w=po(T,V_);if(!w)return null;var N=E==="vertical"?m[0].height/2:m[0].width/2,D=function(O,F){var M=Array.isArray(O.value)?O.value[1]:O.value;return{x:O.x,y:O.y,value:M,errorVal:Ra(O,F)}},A={clipPath:o?"url(#clipPath-".concat(d,")"):null};return me.createElement(fr,A,w.map(function(k){return me.cloneElement(k,{key:"error-bar-".concat(d,"-").concat(k.props.dataKey),data:m,xAxis:y,yAxis:b,layout:E,offset:N,dataPointFormatter:D})}))}},{key:"render",value:function(){var o=this.props,d=o.hide,p=o.data,m=o.className,y=o.xAxis,b=o.yAxis,E=o.left,T=o.top,w=o.width,N=o.height,D=o.isAnimationActive,A=o.background,k=o.id;if(d||!p||!p.length)return null;var O=this.state.isAnimationFinished,F=On("recharts-bar",m),M=y&&y.allowDataOverflow,V=b&&b.allowDataOverflow,H=M||V,B=_n(k)?this.id:k;return me.createElement(fr,{className:F},M||V?me.createElement("defs",null,me.createElement("clipPath",{id:"clipPath-".concat(B)},me.createElement("rect",{x:M?E:E-w/2,y:V?T:T-N/2,width:M?w:w*2,height:V?N:N*2}))):null,me.createElement(fr,{className:"recharts-bar-rectangles",clipPath:H?"url(#clipPath-".concat(B,")"):null},A?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(H,B),(!D||O)&&Nl.renderCallByParent(this.props,p))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curData:o.data,prevData:d.curData}:o.data!==d.curData?{curData:o.data}:null}}])}(Y.PureComponent);Dee=B_;jd(B_,"displayName","Bar");jd(B_,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Hh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});jd(B_,"getComposedData",function(e){var n=e.props,a=e.item,o=e.barPosition,d=e.bandSize,p=e.xAxis,m=e.yAxis,y=e.xAxisTicks,b=e.yAxisTicks,E=e.stackedData,T=e.dataStartIndex,w=e.displayedData,N=e.offset,D=QFe(o,a);if(!D)return null;var A=n.layout,k=a.type.defaultProps,O=k!==void 0?oi(oi({},k),a.props):a.props,F=O.dataKey,M=O.children,V=O.minPointSize,H=A==="horizontal"?m:p,B=E?H.scale.domain():null,z=sVe({numericAxis:H}),q=po(M,oZ),Q=w.map(function(ee,oe){var ne,ue,Se,fe,we,he;E?ne=ZFe(E[T+oe],B):(ne=Ra(ee,F),Array.isArray(ne)||(ne=[z,ne]));var be=pWe(V,Dee.defaultProps.minPointSize)(ne[1],oe);if(A==="horizontal"){var ae,de=[m.scale(ne[0]),m.scale(ne[1])],xe=de[0],Ue=de[1];ue=BK({axis:p,ticks:y,bandSize:d,offset:D.offset,entry:ee,index:oe}),Se=(ae=Ue??xe)!==null&&ae!==void 0?ae:void 0,fe=D.size;var Me=xe-Ue;if(we=Number.isNaN(Me)?0:Me,he={x:ue,y:m.y,width:fe,height:m.height},Math.abs(be)>0&&Math.abs(we)<Math.abs(be)){var et=Zo(we||be)*(Math.abs(be)-Math.abs(we));Se-=et,we+=et}}else{var Re=[p.scale(ne[0]),p.scale(ne[1])],nt=Re[0],ut=Re[1];if(ue=nt,Se=BK({axis:m,ticks:b,bandSize:d,offset:D.offset,entry:ee,index:oe}),fe=ut-nt,we=D.size,he={x:p.x,y:Se,width:p.width,height:we},Math.abs(be)>0&&Math.abs(fe)<Math.abs(be)){var Kt=Zo(fe||be)*(Math.abs(be)-Math.abs(fe));fe+=Kt}}return oi(oi(oi({},ee),{},{x:ue,y:Se,width:fe,height:we,value:E?ne:ne[1],payload:ee,background:he},q&&q[oe]&&q[oe].props),{},{tooltipPayload:[pee(a,ee)],tooltipPosition:{x:ue+fe/2,y:Se+we/2}})});return oi({data:Q,layout:A},N)});function g_(e){"@babel/helpers - typeof";return g_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},g_(e)}function wWe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function W9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Lee(o.key),o)}}function TWe(e,n,a){return n&&W9(e.prototype,n),a&&W9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function $9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function qo(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?$9(Object(a),!0).forEach(function(o){DT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function DT(e,n,a){return n=Lee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Lee(e){var n=CWe(e,"string");return g_(n)=="symbol"?n:n+""}function CWe(e,n){if(g_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(g_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Mee=function(n,a,o,d,p){var m=n.width,y=n.height,b=n.layout,E=n.children,T=Object.keys(a),w={left:o.left,leftMirror:o.left,right:m-o.right,rightMirror:m-o.right,top:o.top,topMirror:o.top,bottom:y-o.bottom,bottomMirror:y-o.bottom},N=!!bs(E,B_);return T.reduce(function(D,A){var k=a[A],O=k.orientation,F=k.domain,M=k.padding,V=M===void 0?{}:M,H=k.mirror,B=k.reversed,z="".concat(O).concat(H?"Mirror":""),q,Q,ee,oe,ne;if(k.type==="number"&&(k.padding==="gap"||k.padding==="no-gap")){var ue=F[1]-F[0],Se=1/0,fe=k.categoricalDomain.sort(DAe);if(fe.forEach(function(Re,nt){nt>0&&(Se=Math.min((Re||0)-(fe[nt-1]||0),Se))}),Number.isFinite(Se)){var we=Se/ue,he=k.layout==="vertical"?o.height:o.width;if(k.padding==="gap"&&(q=we*he/2),k.padding==="no-gap"){var be=Uh(n.barCategoryGap,we*he),ae=we*he/2;q=ae-be-(ae-be)/he*be}}}d==="xAxis"?Q=[o.left+(V.left||0)+(q||0),o.left+o.width-(V.right||0)-(q||0)]:d==="yAxis"?Q=b==="horizontal"?[o.top+o.height-(V.bottom||0),o.top+(V.top||0)]:[o.top+(V.top||0)+(q||0),o.top+o.height-(V.bottom||0)-(q||0)]:Q=k.range,B&&(Q=[Q[1],Q[0]]);var de=XFe(k,p,N),xe=de.scale,Ue=de.realScaleType;xe.domain(F).range(Q),JFe(xe);var Me=aVe(xe,qo(qo({},k),{},{realScaleType:Ue}));d==="xAxis"?(ne=O==="top"&&!H||O==="bottom"&&H,ee=o.left,oe=w[z]-ne*k.height):d==="yAxis"&&(ne=O==="left"&&!H||O==="right"&&H,ee=w[z]-ne*k.width,oe=o.top);var et=qo(qo(qo({},k),Me),{},{realScaleType:Ue,x:ee,y:oe,scale:xe,width:d==="xAxis"?o.width:k.width,height:d==="yAxis"?o.height:k.height});return et.bandSize=XS(et,Me),!k.hide&&d==="xAxis"?w[z]+=(ne?-1:1)*et.height:k.hide||(w[z]+=(ne?-1:1)*et.width),qo(qo({},D),{},DT({},A,et))},{})},Uee=function(n,a){var o=n.x,d=n.y,p=a.x,m=a.y;return{x:Math.min(o,p),y:Math.min(d,m),width:Math.abs(p-o),height:Math.abs(m-d)}},NWe=function(n){var a=n.x1,o=n.y1,d=n.x2,p=n.y2;return Uee({x:a,y:o},{x:d,y:p})},Fee=function(){function e(n){wWe(this,e),this.scale=n}return TWe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=o.bandAware,p=o.position;if(a!==void 0){if(p)switch(p){case"start":return this.scale(a);case"middle":{var m=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+m}case"end":{var y=this.bandwidth?this.bandwidth():0;return this.scale(a)+y}default:return this.scale(a)}if(d){var b=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+b}return this.scale(a)}}},{key:"isInRange",value:function(a){var o=this.range(),d=o[0],p=o[o.length-1];return d<=p?a>=d&&a<=p:a>=p&&a<=d}}],[{key:"create",value:function(a){return new e(a)}}])}();DT(Fee,"EPS",1e-4);var lj=function(n){var a=Object.keys(n).reduce(function(o,d){return qo(qo({},o),{},DT({},d,Fee.create(n[d])))},{});return qo(qo({},a),{},{apply:function(d){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=p.bandAware,y=p.position;return KGe(d,function(b,E){return a[E].apply(b,{bandAware:m,position:y})})},isInRange:function(d){return Pee(d,function(p,m){return a[m].isInRange(p)})}})};function RWe(e){return(e%180+180)%180}var AWe=function(n){var a=n.width,o=n.height,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,p=RWe(d),m=p*Math.PI/180,y=Math.atan(o/a),b=m>y&&m<Math.PI-y?o/Math.sin(m):a/Math.cos(m);return Math.abs(b)},IWe=ru,OWe=j_,PWe=yT;function DWe(e){return function(n,a,o){var d=Object(n);if(!OWe(n)){var p=IWe(a);n=PWe(n),a=function(y){return p(d[y],y,d)}}var m=e(n,a,o);return m>-1?d[p?n[m]:m]:void 0}}var kWe=DWe,jWe=Ree;function LWe(e){var n=jWe(e),a=n%1;return n===n?a?n-a:n:0}var MWe=LWe,UWe=zQ,FWe=ru,VWe=MWe,BWe=Math.max;function GWe(e,n,a){var o=e==null?0:e.length;if(!o)return-1;var d=a==null?0:VWe(a);return d<0&&(d=BWe(o+d,0)),UWe(e,FWe(n),d)}var WWe=GWe,$We=kWe,HWe=WWe,zWe=$We(HWe),KWe=zWe;const YWe=ar(KWe);var qWe=LRe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),dj=Y.createContext(void 0),uj=Y.createContext(void 0),Vee=Y.createContext(void 0),Bee=Y.createContext({}),Gee=Y.createContext(void 0),Wee=Y.createContext(0),$ee=Y.createContext(0),H9=function(n){var a=n.state,o=a.xAxisMap,d=a.yAxisMap,p=a.offset,m=n.clipPathId,y=n.children,b=n.width,E=n.height,T=qWe(p);return me.createElement(dj.Provider,{value:o},me.createElement(uj.Provider,{value:d},me.createElement(Bee.Provider,{value:p},me.createElement(Vee.Provider,{value:T},me.createElement(Gee.Provider,{value:m},me.createElement(Wee.Provider,{value:E},me.createElement($ee.Provider,{value:b},y)))))))},XWe=function(){return Y.useContext(Gee)},Hee=function(n){var a=Y.useContext(dj);a==null&&Vh();var o=a[n];return o==null&&Vh(),o},JWe=function(){var n=Y.useContext(dj);return Ad(n)},QWe=function(){var n=Y.useContext(uj),a=YWe(n,function(o){return Pee(o.domain,Number.isFinite)});return a||Ad(n)},zee=function(n){var a=Y.useContext(uj);a==null&&Vh();var o=a[n];return o==null&&Vh(),o},ZWe=function(){var n=Y.useContext(Vee);return n},e$e=function(){return Y.useContext(Bee)},hj=function(){return Y.useContext($ee)},pj=function(){return Y.useContext(Wee)};function xm(e){"@babel/helpers - typeof";return xm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xm(e)}function t$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Yee(o.key),o)}}function r$e(e,n,a){return n&&n$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i$e(e,n,a){return n=dw(n),a$e(e,Kee()?Reflect.construct(n,a||[],dw(e).constructor):n.apply(e,a))}function a$e(e,n){if(n&&(xm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s$e(e)}function s$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Kee=function(){return!!e})()}function dw(e){return dw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},dw(e)}function o$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&OD(e,n)}function OD(e,n){return OD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},OD(e,n)}function z9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function K9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?z9(Object(a),!0).forEach(function(o){fj(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function fj(e,n,a){return n=Yee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Yee(e){var n=c$e(e,"string");return xm(n)=="symbol"?n:n+""}function c$e(e,n){if(xm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(xm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function l$e(e,n){return p$e(e)||h$e(e,n)||u$e(e,n)||d$e()}function d$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u$e(e,n){if(e){if(typeof e=="string")return Y9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Y9(e,n)}}function Y9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function h$e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function p$e(e){if(Array.isArray(e))return e}function PD(){return PD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},PD.apply(this,arguments)}var f$e=function(n,a){var o;return me.isValidElement(n)?o=me.cloneElement(n,a):hn(n)?o=n(a):o=me.createElement("line",PD({},a,{className:"recharts-reference-line-line"})),o},m$e=function(n,a,o,d,p,m,y,b,E){var T=p.x,w=p.y,N=p.width,D=p.height;if(o){var A=E.y,k=n.y.apply(A,{position:m});if(Hc(E,"discard")&&!n.y.isInRange(k))return null;var O=[{x:T+N,y:k},{x:T,y:k}];return b==="left"?O.reverse():O}if(a){var F=E.x,M=n.x.apply(F,{position:m});if(Hc(E,"discard")&&!n.x.isInRange(M))return null;var V=[{x:M,y:w+D},{x:M,y:w}];return y==="top"?V.reverse():V}if(d){var H=E.segment,B=H.map(function(z){return n.apply(z,{position:m})});return Hc(E,"discard")&&FGe(B,function(z){return!n.isInRange(z)})?null:B}return null};function g$e(e){var n=e.x,a=e.y,o=e.segment,d=e.xAxisId,p=e.yAxisId,m=e.shape,y=e.className,b=e.alwaysShow,E=XWe(),T=Hee(d),w=zee(p),N=ZWe();if(!E||!N)return null;Tl(b===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var D=lj({x:T.scale,y:w.scale}),A=bi(n),k=bi(a),O=o&&o.length===2,F=m$e(D,A,k,O,N,e.position,T.orientation,w.orientation,e);if(!F)return null;var M=l$e(F,2),V=M[0],H=V.x,B=V.y,z=M[1],q=z.x,Q=z.y,ee=Hc(e,"hidden")?"url(#".concat(E,")"):void 0,oe=K9(K9({clipPath:ee},vn(e,!0)),{},{x1:H,y1:B,x2:q,y2:Q});return me.createElement(fr,{className:On("recharts-reference-line",y)},f$e(m,oe),ca.renderCallByParent(e,NWe({x1:H,y1:B,x2:q,y2:Q})))}var mj=function(e){function n(){return t$e(this,n),i$e(this,n,arguments)}return o$e(n,e),r$e(n,[{key:"render",value:function(){return me.createElement(g$e,this.props)}}])}(me.Component);fj(mj,"displayName","ReferenceLine");fj(mj,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function DD(){return DD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},DD.apply(this,arguments)}function Sm(e){"@babel/helpers - typeof";return Sm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Sm(e)}function q9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function X9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?q9(Object(a),!0).forEach(function(o){kT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):q9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function v$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function y$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Xee(o.key),o)}}function _$e(e,n,a){return n&&y$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function b$e(e,n,a){return n=uw(n),E$e(e,qee()?Reflect.construct(n,a||[],uw(e).constructor):n.apply(e,a))}function E$e(e,n){if(n&&(Sm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return x$e(e)}function x$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qee=function(){return!!e})()}function uw(e){return uw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},uw(e)}function S$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&kD(e,n)}function kD(e,n){return kD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},kD(e,n)}function kT(e,n,a){return n=Xee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Xee(e){var n=w$e(e,"string");return Sm(n)=="symbol"?n:n+""}function w$e(e,n){if(Sm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Sm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var T$e=function(n){var a=n.x,o=n.y,d=n.xAxis,p=n.yAxis,m=lj({x:d.scale,y:p.scale}),y=m.apply({x:a,y:o},{bandAware:!0});return Hc(n,"discard")&&!m.isInRange(y)?null:y},jT=function(e){function n(){return v$e(this,n),b$e(this,n,arguments)}return S$e(n,e),_$e(n,[{key:"render",value:function(){var o=this.props,d=o.x,p=o.y,m=o.r,y=o.alwaysShow,b=o.clipPathId,E=bi(d),T=bi(p);if(Tl(y===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!E||!T)return null;var w=T$e(this.props);if(!w)return null;var N=w.x,D=w.y,A=this.props,k=A.shape,O=A.className,F=Hc(this.props,"hidden")?"url(#".concat(b,")"):void 0,M=X9(X9({clipPath:F},vn(this.props,!0)),{},{cx:N,cy:D});return me.createElement(fr,{className:On("recharts-reference-dot",O)},n.renderDot(k,M),ca.renderCallByParent(this.props,{x:N-m,y:D-m,width:2*m,height:2*m}))}}])}(me.Component);kT(jT,"displayName","ReferenceDot");kT(jT,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});kT(jT,"renderDot",function(e,n){var a;return me.isValidElement(e)?a=me.cloneElement(e,n):hn(e)?a=e(n):a=me.createElement(IT,DD({},n,{cx:n.cx,cy:n.cy,className:"recharts-reference-dot-dot"})),a});function jD(){return jD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},jD.apply(this,arguments)}function wm(e){"@babel/helpers - typeof";return wm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wm(e)}function J9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Q9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?J9(Object(a),!0).forEach(function(o){LT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function C$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function N$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Qee(o.key),o)}}function R$e(e,n,a){return n&&N$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function A$e(e,n,a){return n=hw(n),I$e(e,Jee()?Reflect.construct(n,a||[],hw(e).constructor):n.apply(e,a))}function I$e(e,n){if(n&&(wm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return O$e(e)}function O$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Jee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Jee=function(){return!!e})()}function hw(e){return hw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},hw(e)}function P$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&LD(e,n)}function LD(e,n){return LD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},LD(e,n)}function LT(e,n,a){return n=Qee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Qee(e){var n=D$e(e,"string");return wm(n)=="symbol"?n:n+""}function D$e(e,n){if(wm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(wm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var k$e=function(n,a,o,d,p){var m=p.x1,y=p.x2,b=p.y1,E=p.y2,T=p.xAxis,w=p.yAxis;if(!T||!w)return null;var N=lj({x:T.scale,y:w.scale}),D={x:n?N.x.apply(m,{position:"start"}):N.x.rangeMin,y:o?N.y.apply(b,{position:"start"}):N.y.rangeMin},A={x:a?N.x.apply(y,{position:"end"}):N.x.rangeMax,y:d?N.y.apply(E,{position:"end"}):N.y.rangeMax};return Hc(p,"discard")&&(!N.isInRange(D)||!N.isInRange(A))?null:Uee(D,A)},MT=function(e){function n(){return C$e(this,n),A$e(this,n,arguments)}return P$e(n,e),R$e(n,[{key:"render",value:function(){var o=this.props,d=o.x1,p=o.x2,m=o.y1,y=o.y2,b=o.className,E=o.alwaysShow,T=o.clipPathId;Tl(E===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var w=bi(d),N=bi(p),D=bi(m),A=bi(y),k=this.props.shape;if(!w&&!N&&!D&&!A&&!k)return null;var O=k$e(w,N,D,A,this.props);if(!O&&!k)return null;var F=Hc(this.props,"hidden")?"url(#".concat(T,")"):void 0;return me.createElement(fr,{className:On("recharts-reference-area",b)},n.renderRect(k,Q9(Q9({clipPath:F},vn(this.props,!0)),O)),ca.renderCallByParent(this.props,O))}}])}(me.Component);LT(MT,"displayName","ReferenceArea");LT(MT,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});LT(MT,"renderRect",function(e,n){var a;return me.isValidElement(e)?a=me.cloneElement(e,n):hn(e)?a=e(n):a=me.createElement(cj,jD({},n,{className:"recharts-reference-area-rect"})),a});function Zee(e,n,a){if(n<1)return[];if(n===1&&a===void 0)return e;for(var o=[],d=0;d<e.length;d+=n)o.push(e[d]);return o}function j$e(e,n,a){var o={width:e.width+n.width,height:e.height+n.height};return AWe(o,a)}function L$e(e,n,a){var o=a==="width",d=e.x,p=e.y,m=e.width,y=e.height;return n===1?{start:o?d:p,end:o?d+m:p+y}:{start:o?d+m:p+y,end:o?d:p}}function pw(e,n,a,o,d){if(e*n<e*o||e*n>e*d)return!1;var p=a();return e*(n-e*p/2-o)>=0&&e*(n+e*p/2-d)<=0}function M$e(e,n){return Zee(e,n+1)}function U$e(e,n,a,o,d){for(var p=(o||[]).slice(),m=n.start,y=n.end,b=0,E=1,T=m,w=function(){var A=o==null?void 0:o[b];if(A===void 0)return{v:Zee(o,E)};var k=b,O,F=function(){return O===void 0&&(O=a(A,k)),O},M=A.coordinate,V=b===0||pw(e,M,F,T,y);V||(b=0,T=m,E+=1),V&&(T=M+e*(F()/2+d),b+=E)},N;E<=p.length;)if(N=w(),N)return N.v;return[]}function v_(e){"@babel/helpers - typeof";return v_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},v_(e)}function Z9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function sa(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Z9(Object(a),!0).forEach(function(o){F$e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Z9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function F$e(e,n,a){return n=V$e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function V$e(e){var n=B$e(e,"string");return v_(n)=="symbol"?n:n+""}function B$e(e,n){if(v_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(v_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function G$e(e,n,a,o,d){for(var p=(o||[]).slice(),m=p.length,y=n.start,b=n.end,E=function(N){var D=p[N],A,k=function(){return A===void 0&&(A=a(D,N)),A};if(N===m-1){var O=e*(D.coordinate+e*k()/2-b);p[N]=D=sa(sa({},D),{},{tickCoord:O>0?D.coordinate-O*e:D.coordinate})}else p[N]=D=sa(sa({},D),{},{tickCoord:D.coordinate});var F=pw(e,D.tickCoord,k,y,b);F&&(b=D.tickCoord-e*(k()/2+d),p[N]=sa(sa({},D),{},{isShow:!0}))},T=m-1;T>=0;T--)E(T);return p}function W$e(e,n,a,o,d,p){var m=(o||[]).slice(),y=m.length,b=n.start,E=n.end;if(p){var T=o[y-1],w=a(T,y-1),N=e*(T.coordinate+e*w/2-E);m[y-1]=T=sa(sa({},T),{},{tickCoord:N>0?T.coordinate-N*e:T.coordinate});var D=pw(e,T.tickCoord,function(){return w},b,E);D&&(E=T.tickCoord-e*(w/2+d),m[y-1]=sa(sa({},T),{},{isShow:!0}))}for(var A=p?y-1:y,k=function(M){var V=m[M],H,B=function(){return H===void 0&&(H=a(V,M)),H};if(M===0){var z=e*(V.coordinate-e*B()/2-b);m[M]=V=sa(sa({},V),{},{tickCoord:z<0?V.coordinate-z*e:V.coordinate})}else m[M]=V=sa(sa({},V),{},{tickCoord:V.coordinate});var q=pw(e,V.tickCoord,B,b,E);q&&(b=V.tickCoord+e*(B()/2+d),m[M]=sa(sa({},V),{},{isShow:!0}))},O=0;O<A;O++)k(O);return m}function gj(e,n,a){var o=e.tick,d=e.ticks,p=e.viewBox,m=e.minTickGap,y=e.orientation,b=e.interval,E=e.tickFormatter,T=e.unit,w=e.angle;if(!d||!d.length||!o)return[];if(ct(b)||Hh.isSsr)return M$e(d,typeof b=="number"&&ct(b)?b:0);var N=[],D=y==="top"||y==="bottom"?"width":"height",A=T&&D==="width"?fy(T,{fontSize:n,letterSpacing:a}):{width:0,height:0},k=function(V,H){var B=hn(E)?E(V.value,H):V.value;return D==="width"?j$e(fy(B,{fontSize:n,letterSpacing:a}),A,w):fy(B,{fontSize:n,letterSpacing:a})[D]},O=d.length>=2?Zo(d[1].coordinate-d[0].coordinate):1,F=L$e(p,O,D);return b==="equidistantPreserveStart"?U$e(O,F,k,d,m):(b==="preserveStart"||b==="preserveStartEnd"?N=W$e(O,F,k,d,m,b==="preserveStartEnd"):N=G$e(O,F,k,d,m),N.filter(function(M){return M.isShow}))}var $$e=["viewBox"],H$e=["viewBox"],z$e=["ticks"];function Tm(e){"@babel/helpers - typeof";return Tm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Tm(e)}function Ff(){return Ff=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Ff.apply(this,arguments)}function eY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function mi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?eY(Object(a),!0).forEach(function(o){vj(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):eY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function o1(e,n){if(e==null)return{};var a=K$e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function K$e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function Y$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function tY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,tte(o.key),o)}}function q$e(e,n,a){return n&&tY(e.prototype,n),a&&tY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function X$e(e,n,a){return n=fw(n),J$e(e,ete()?Reflect.construct(n,a||[],fw(e).constructor):n.apply(e,a))}function J$e(e,n){if(n&&(Tm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Q$e(e)}function Q$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ete(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ete=function(){return!!e})()}function fw(e){return fw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},fw(e)}function Z$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&MD(e,n)}function MD(e,n){return MD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},MD(e,n)}function vj(e,n,a){return n=tte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function tte(e){var n=eHe(e,"string");return Tm(n)=="symbol"?n:n+""}function eHe(e,n){if(Tm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Tm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ng=function(e){function n(a){var o;return Y$e(this,n),o=X$e(this,n,[a]),o.state={fontSize:"",letterSpacing:""},o}return Z$e(n,e),q$e(n,[{key:"shouldComponentUpdate",value:function(o,d){var p=o.viewBox,m=o1(o,$$e),y=this.props,b=y.viewBox,E=o1(y,H$e);return!Kf(p,b)||!Kf(m,E)||!Kf(d,this.state)}},{key:"componentDidMount",value:function(){var o=this.layerReference;if(o){var d=o.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];d&&this.setState({fontSize:window.getComputedStyle(d).fontSize,letterSpacing:window.getComputedStyle(d).letterSpacing})}}},{key:"getTickLineCoord",value:function(o){var d=this.props,p=d.x,m=d.y,y=d.width,b=d.height,E=d.orientation,T=d.tickSize,w=d.mirror,N=d.tickMargin,D,A,k,O,F,M,V=w?-1:1,H=o.tickSize||T,B=ct(o.tickCoord)?o.tickCoord:o.coordinate;switch(E){case"top":D=A=o.coordinate,O=m+ +!w*b,k=O-V*H,M=k-V*N,F=B;break;case"left":k=O=o.coordinate,A=p+ +!w*y,D=A-V*H,F=D-V*N,M=B;break;case"right":k=O=o.coordinate,A=p+ +w*y,D=A+V*H,F=D+V*N,M=B;break;default:D=A=o.coordinate,O=m+ +w*b,k=O+V*H,M=k+V*N,F=B;break}return{line:{x1:D,y1:k,x2:A,y2:O},tick:{x:F,y:M}}}},{key:"getTickTextAnchor",value:function(){var o=this.props,d=o.orientation,p=o.mirror,m;switch(d){case"left":m=p?"start":"end";break;case"right":m=p?"end":"start";break;default:m="middle";break}return m}},{key:"getTickVerticalAnchor",value:function(){var o=this.props,d=o.orientation,p=o.mirror,m="end";switch(d){case"left":case"right":m="middle";break;case"top":m=p?"start":"end";break;default:m=p?"end":"start";break}return m}},{key:"renderAxisLine",value:function(){var o=this.props,d=o.x,p=o.y,m=o.width,y=o.height,b=o.orientation,E=o.mirror,T=o.axisLine,w=mi(mi(mi({},vn(this.props,!1)),vn(T,!1)),{},{fill:"none"});if(b==="top"||b==="bottom"){var N=+(b==="top"&&!E||b==="bottom"&&E);w=mi(mi({},w),{},{x1:d,y1:p+N*y,x2:d+m,y2:p+N*y})}else{var D=+(b==="left"&&!E||b==="right"&&E);w=mi(mi({},w),{},{x1:d+D*m,y1:p,x2:d+D*m,y2:p+y})}return me.createElement("line",Ff({},w,{className:On("recharts-cartesian-axis-line",ho(T,"className"))}))}},{key:"renderTicks",value:function(o,d,p){var m=this,y=this.props,b=y.tickLine,E=y.stroke,T=y.tick,w=y.tickFormatter,N=y.unit,D=gj(mi(mi({},this.props),{},{ticks:o}),d,p),A=this.getTickTextAnchor(),k=this.getTickVerticalAnchor(),O=vn(this.props,!1),F=vn(T,!1),M=mi(mi({},O),{},{fill:"none"},vn(b,!1)),V=D.map(function(H,B){var z=m.getTickLineCoord(H),q=z.line,Q=z.tick,ee=mi(mi(mi(mi({textAnchor:A,verticalAnchor:k},O),{},{stroke:"none",fill:E},F),Q),{},{index:B,payload:H,visibleTicksCount:D.length,tickFormatter:w});return me.createElement(fr,Ff({className:"recharts-cartesian-axis-tick",key:"tick-".concat(H.value,"-").concat(H.coordinate,"-").concat(H.tickCoord)},bS(m.props,H,B)),b&&me.createElement("line",Ff({},M,q,{className:On("recharts-cartesian-axis-tick-line",ho(b,"className"))})),T&&n.renderTickItem(T,ee,"".concat(hn(w)?w(H.value,B):H.value).concat(N||"")))});return me.createElement("g",{className:"recharts-cartesian-axis-ticks"},V)}},{key:"render",value:function(){var o=this,d=this.props,p=d.axisLine,m=d.width,y=d.height,b=d.ticksGenerator,E=d.className,T=d.hide;if(T)return null;var w=this.props,N=w.ticks,D=o1(w,z$e),A=N;return hn(b)&&(A=N&&N.length>0?b(this.props):b(D)),m<=0||y<=0||!A||!A.length?null:me.createElement(fr,{className:On("recharts-cartesian-axis",E),ref:function(O){o.layerReference=O}},p&&this.renderAxisLine(),this.renderTicks(A,this.state.fontSize,this.state.letterSpacing),ca.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(o,d,p){var m,y=On(d.className,"recharts-cartesian-axis-tick-value");return me.isValidElement(o)?m=me.cloneElement(o,mi(mi({},d),{},{className:y})):hn(o)?m=o(mi(mi({},d),{},{className:y})):m=me.createElement(jS,Ff({},d,{className:"recharts-cartesian-axis-tick-value"}),p),m}}])}(Y.Component);vj(ng,"displayName","CartesianAxis");vj(ng,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var tHe=["x1","y1","x2","y2","key"],nHe=["offset"];function Bh(e){"@babel/helpers - typeof";return Bh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Bh(e)}function nY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function la(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?nY(Object(a),!0).forEach(function(o){rHe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function rHe(e,n,a){return n=iHe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function iHe(e){var n=aHe(e,"string");return Bh(n)=="symbol"?n:n+""}function aHe(e,n){if(Bh(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Bh(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function bh(){return bh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},bh.apply(this,arguments)}function rY(e,n){if(e==null)return{};var a=sHe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function sHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var oHe=function(n){var a=n.fill;if(!a||a==="none")return null;var o=n.fillOpacity,d=n.x,p=n.y,m=n.width,y=n.height,b=n.ry;return me.createElement("rect",{x:d,y:p,ry:b,width:m,height:y,stroke:"none",fill:a,fillOpacity:o,className:"recharts-cartesian-grid-bg"})};function nte(e,n){var a;if(me.isValidElement(e))a=me.cloneElement(e,n);else if(hn(e))a=e(n);else{var o=n.x1,d=n.y1,p=n.x2,m=n.y2,y=n.key,b=rY(n,tHe),E=vn(b,!1);E.offset;var T=rY(E,nHe);a=me.createElement("line",bh({},T,{x1:o,y1:d,x2:p,y2:m,fill:"none",key:y}))}return a}function cHe(e){var n=e.x,a=e.width,o=e.horizontal,d=o===void 0?!0:o,p=e.horizontalPoints;if(!d||!p||!p.length)return null;var m=p.map(function(y,b){var E=la(la({},e),{},{x1:n,y1:y,x2:n+a,y2:y,key:"line-".concat(b),index:b});return nte(d,E)});return me.createElement("g",{className:"recharts-cartesian-grid-horizontal"},m)}function lHe(e){var n=e.y,a=e.height,o=e.vertical,d=o===void 0?!0:o,p=e.verticalPoints;if(!d||!p||!p.length)return null;var m=p.map(function(y,b){var E=la(la({},e),{},{x1:y,y1:n,x2:y,y2:n+a,key:"line-".concat(b),index:b});return nte(d,E)});return me.createElement("g",{className:"recharts-cartesian-grid-vertical"},m)}function dHe(e){var n=e.horizontalFill,a=e.fillOpacity,o=e.x,d=e.y,p=e.width,m=e.height,y=e.horizontalPoints,b=e.horizontal,E=b===void 0?!0:b;if(!E||!n||!n.length)return null;var T=y.map(function(N){return Math.round(N+d-d)}).sort(function(N,D){return N-D});d!==T[0]&&T.unshift(0);var w=T.map(function(N,D){var A=!T[D+1],k=A?d+m-N:T[D+1]-N;if(k<=0)return null;var O=D%n.length;return me.createElement("rect",{key:"react-".concat(D),y:N,x:o,height:k,width:p,stroke:"none",fill:n[O],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return me.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},w)}function uHe(e){var n=e.vertical,a=n===void 0?!0:n,o=e.verticalFill,d=e.fillOpacity,p=e.x,m=e.y,y=e.width,b=e.height,E=e.verticalPoints;if(!a||!o||!o.length)return null;var T=E.map(function(N){return Math.round(N+p-p)}).sort(function(N,D){return N-D});p!==T[0]&&T.unshift(0);var w=T.map(function(N,D){var A=!T[D+1],k=A?p+y-N:T[D+1]-N;if(k<=0)return null;var O=D%o.length;return me.createElement("rect",{key:"react-".concat(D),x:N,y:m,width:k,height:b,stroke:"none",fill:o[O],fillOpacity:d,className:"recharts-cartesian-grid-bg"})});return me.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},w)}var hHe=function(n,a){var o=n.xAxis,d=n.width,p=n.height,m=n.offset;return uee(gj(la(la(la({},ng.defaultProps),o),{},{ticks:xl(o,!0),viewBox:{x:0,y:0,width:d,height:p}})),m.left,m.left+m.width,a)},pHe=function(n,a){var o=n.yAxis,d=n.width,p=n.height,m=n.offset;return uee(gj(la(la(la({},ng.defaultProps),o),{},{ticks:xl(o,!0),viewBox:{x:0,y:0,width:d,height:p}})),m.top,m.top+m.height,a)},Ef={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function y_(e){var n,a,o,d,p,m,y=hj(),b=pj(),E=e$e(),T=la(la({},e),{},{stroke:(n=e.stroke)!==null&&n!==void 0?n:Ef.stroke,fill:(a=e.fill)!==null&&a!==void 0?a:Ef.fill,horizontal:(o=e.horizontal)!==null&&o!==void 0?o:Ef.horizontal,horizontalFill:(d=e.horizontalFill)!==null&&d!==void 0?d:Ef.horizontalFill,vertical:(p=e.vertical)!==null&&p!==void 0?p:Ef.vertical,verticalFill:(m=e.verticalFill)!==null&&m!==void 0?m:Ef.verticalFill,x:ct(e.x)?e.x:E.left,y:ct(e.y)?e.y:E.top,width:ct(e.width)?e.width:E.width,height:ct(e.height)?e.height:E.height}),w=T.x,N=T.y,D=T.width,A=T.height,k=T.syncWithTicks,O=T.horizontalValues,F=T.verticalValues,M=JWe(),V=QWe();if(!ct(D)||D<=0||!ct(A)||A<=0||!ct(w)||w!==+w||!ct(N)||N!==+N)return null;var H=T.verticalCoordinatesGenerator||hHe,B=T.horizontalCoordinatesGenerator||pHe,z=T.horizontalPoints,q=T.verticalPoints;if((!z||!z.length)&&hn(B)){var Q=O&&O.length,ee=B({yAxis:V?la(la({},V),{},{ticks:Q?O:V.ticks}):void 0,width:y,height:b,offset:E},Q?!0:k);Tl(Array.isArray(ee),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Bh(ee),"]")),Array.isArray(ee)&&(z=ee)}if((!q||!q.length)&&hn(H)){var oe=F&&F.length,ne=H({xAxis:M?la(la({},M),{},{ticks:oe?F:M.ticks}):void 0,width:y,height:b,offset:E},oe?!0:k);Tl(Array.isArray(ne),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Bh(ne),"]")),Array.isArray(ne)&&(q=ne)}return me.createElement("g",{className:"recharts-cartesian-grid"},me.createElement(oHe,{fill:T.fill,fillOpacity:T.fillOpacity,x:T.x,y:T.y,width:T.width,height:T.height,ry:T.ry}),me.createElement(cHe,bh({},T,{offset:E,horizontalPoints:z,xAxis:M,yAxis:V})),me.createElement(lHe,bh({},T,{offset:E,verticalPoints:q,xAxis:M,yAxis:V})),me.createElement(dHe,bh({},T,{horizontalPoints:z})),me.createElement(uHe,bh({},T,{verticalPoints:q})))}y_.displayName="CartesianGrid";var fHe=["type","layout","connectNulls","ref"],mHe=["key"];function Cm(e){"@babel/helpers - typeof";return Cm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Cm(e)}function iY(e,n){if(e==null)return{};var a=gHe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function gHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function yy(){return yy=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},yy.apply(this,arguments)}function aY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function vs(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?aY(Object(a),!0).forEach(function(o){Xo(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):aY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function xf(e){return bHe(e)||_He(e)||yHe(e)||vHe()}function vHe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yHe(e,n){if(e){if(typeof e=="string")return UD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return UD(e,n)}}function _He(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function bHe(e){if(Array.isArray(e))return UD(e)}function UD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function EHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function sY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ite(o.key),o)}}function xHe(e,n,a){return n&&sY(e.prototype,n),a&&sY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function SHe(e,n,a){return n=mw(n),wHe(e,rte()?Reflect.construct(n,a||[],mw(e).constructor):n.apply(e,a))}function wHe(e,n){if(n&&(Cm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return THe(e)}function THe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rte=function(){return!!e})()}function mw(e){return mw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},mw(e)}function CHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&FD(e,n)}function FD(e,n){return FD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},FD(e,n)}function Xo(e,n,a){return n=ite(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ite(e){var n=NHe(e,"string");return Cm(n)=="symbol"?n:n+""}function NHe(e,n){if(Cm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Cm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var rg=function(e){function n(){var a;EHe(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=SHe(this,n,[].concat(d)),Xo(a,"state",{isAnimationFinished:!0,totalLength:0}),Xo(a,"generateSimpleStrokeDasharray",function(m,y){return"".concat(y,"px ").concat(m-y,"px")}),Xo(a,"getStrokeDasharray",function(m,y,b){var E=b.reduce(function(F,M){return F+M});if(!E)return a.generateSimpleStrokeDasharray(y,m);for(var T=Math.floor(m/E),w=m%E,N=y-m,D=[],A=0,k=0;A<b.length;k+=b[A],++A)if(k+b[A]>w){D=[].concat(xf(b.slice(0,A)),[w-k]);break}var O=D.length%2===0?[0,N]:[N];return[].concat(xf(n.repeat(b,T)),xf(D),O).map(function(F){return"".concat(F,"px")}).join(", ")}),Xo(a,"id",qm("recharts-line-")),Xo(a,"pathRef",function(m){a.mainCurve=m}),Xo(a,"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0}),a.props.onAnimationEnd&&a.props.onAnimationEnd()}),Xo(a,"handleAnimationStart",function(){a.setState({isAnimationFinished:!1}),a.props.onAnimationStart&&a.props.onAnimationStart()}),a}return CHe(n,e),xHe(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();this.setState({totalLength:o})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();o!==this.state.totalLength&&this.setState({totalLength:o})}}},{key:"getTotalLength",value:function(){var o=this.mainCurve;try{return o&&o.getTotalLength&&o.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(o,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var p=this.props,m=p.points,y=p.xAxis,b=p.yAxis,E=p.layout,T=p.children,w=po(T,V_);if(!w)return null;var N=function(k,O){return{x:k.x,y:k.y,value:k.value,errorVal:Ra(k.payload,O)}},D={clipPath:o?"url(#clipPath-".concat(d,")"):null};return me.createElement(fr,D,w.map(function(A){return me.cloneElement(A,{key:"bar-".concat(A.props.dataKey),data:m,xAxis:y,yAxis:b,layout:E,dataPointFormatter:N})}))}},{key:"renderDots",value:function(o,d,p){var m=this.props.isAnimationActive;if(m&&!this.state.isAnimationFinished)return null;var y=this.props,b=y.dot,E=y.points,T=y.dataKey,w=vn(this.props,!1),N=vn(b,!0),D=E.map(function(k,O){var F=vs(vs(vs({key:"dot-".concat(O),r:3},w),N),{},{index:O,cx:k.x,cy:k.y,value:k.value,dataKey:T,payload:k.payload,points:E});return n.renderDotItem(b,F)}),A={clipPath:o?"url(#clipPath-".concat(d?"":"dots-").concat(p,")"):null};return me.createElement(fr,yy({className:"recharts-line-dots",key:"dots"},A),D)}},{key:"renderCurveStatically",value:function(o,d,p,m){var y=this.props,b=y.type,E=y.layout,T=y.connectNulls;y.ref;var w=iY(y,fHe),N=vs(vs(vs({},vn(w,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:d?"url(#clipPath-".concat(p,")"):null,points:o},m),{},{type:b,layout:E,connectNulls:T});return me.createElement(Jf,yy({},N,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(o,d){var p=this,m=this.props,y=m.points,b=m.strokeDasharray,E=m.isAnimationActive,T=m.animationBegin,w=m.animationDuration,N=m.animationEasing,D=m.animationId,A=m.animateNewValues,k=m.width,O=m.height,F=this.state,M=F.prevPoints,V=F.totalLength;return me.createElement(qc,{begin:T,duration:w,isActive:E,easing:N,from:{t:0},to:{t:1},key:"line-".concat(D),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(H){var B=H.t;if(M){var z=M.length/y.length,q=y.map(function(ue,Se){var fe=Math.floor(Se*z);if(M[fe]){var we=M[fe],he=Ki(we.x,ue.x),be=Ki(we.y,ue.y);return vs(vs({},ue),{},{x:he(B),y:be(B)})}if(A){var ae=Ki(k*2,ue.x),de=Ki(O/2,ue.y);return vs(vs({},ue),{},{x:ae(B),y:de(B)})}return vs(vs({},ue),{},{x:ue.x,y:ue.y})});return p.renderCurveStatically(q,o,d)}var Q=Ki(0,V),ee=Q(B),oe;if(b){var ne="".concat(b).split(/[,\s]+/gim).map(function(ue){return parseFloat(ue)});oe=p.getStrokeDasharray(ee,V,ne)}else oe=p.generateSimpleStrokeDasharray(V,ee);return p.renderCurveStatically(y,o,d,{strokeDasharray:oe})})}},{key:"renderCurve",value:function(o,d){var p=this.props,m=p.points,y=p.isAnimationActive,b=this.state,E=b.prevPoints,T=b.totalLength;return y&&m&&m.length&&(!E&&T>0||!gm(E,m))?this.renderCurveWithAnimation(o,d):this.renderCurveStatically(m,o,d)}},{key:"render",value:function(){var o,d=this.props,p=d.hide,m=d.dot,y=d.points,b=d.className,E=d.xAxis,T=d.yAxis,w=d.top,N=d.left,D=d.width,A=d.height,k=d.isAnimationActive,O=d.id;if(p||!y||!y.length)return null;var F=this.state.isAnimationFinished,M=y.length===1,V=On("recharts-line",b),H=E&&E.allowDataOverflow,B=T&&T.allowDataOverflow,z=H||B,q=_n(O)?this.id:O,Q=(o=vn(m,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},ee=Q.r,oe=ee===void 0?3:ee,ne=Q.strokeWidth,ue=ne===void 0?2:ne,Se=rQ(m)?m:{},fe=Se.clipDot,we=fe===void 0?!0:fe,he=oe*2+ue;return me.createElement(fr,{className:V},H||B?me.createElement("defs",null,me.createElement("clipPath",{id:"clipPath-".concat(q)},me.createElement("rect",{x:H?N:N-D/2,y:B?w:w-A/2,width:H?D:D*2,height:B?A:A*2})),!we&&me.createElement("clipPath",{id:"clipPath-dots-".concat(q)},me.createElement("rect",{x:N-he/2,y:w-he/2,width:D+he,height:A+he}))):null,!M&&this.renderCurve(z,q),this.renderErrorBar(z,q),(M||m)&&this.renderDots(z,we,q),(!k||F)&&Nl.renderCallByParent(this.props,y))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,prevPoints:d.curPoints}:o.points!==d.curPoints?{curPoints:o.points}:null}},{key:"repeat",value:function(o,d){for(var p=o.length%2!==0?[].concat(xf(o),[0]):o,m=[],y=0;y<d;++y)m=[].concat(xf(m),xf(p));return m}},{key:"renderDotItem",value:function(o,d){var p;if(me.isValidElement(o))p=me.cloneElement(o,d);else if(hn(o))p=o(d);else{var m=d.key,y=iY(d,mHe),b=On("recharts-line-dot",typeof o!="boolean"?o.className:"");p=me.createElement(IT,yy({key:m},y,{className:b}))}return p}}])}(Y.PureComponent);Xo(rg,"displayName","Line");Xo(rg,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Hh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Xo(rg,"getComposedData",function(e){var n=e.props,a=e.xAxis,o=e.yAxis,d=e.xAxisTicks,p=e.yAxisTicks,m=e.dataKey,y=e.bandSize,b=e.displayedData,E=e.offset,T=n.layout,w=b.map(function(N,D){var A=Ra(N,m);return T==="horizontal"?{x:qS({axis:a,ticks:d,bandSize:y,entry:N,index:D}),y:_n(A)?null:o.scale(A),value:A,payload:N}:{x:_n(A)?null:a.scale(A),y:qS({axis:o,ticks:p,bandSize:y,entry:N,index:D}),value:A,payload:N}});return vs({points:w,layout:T},E)});var RHe=["layout","type","stroke","connectNulls","isRange","ref"],AHe=["key"],ate;function Nm(e){"@babel/helpers - typeof";return Nm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Nm(e)}function ste(e,n){if(e==null)return{};var a=IHe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function IHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function Eh(){return Eh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Eh.apply(this,arguments)}function oY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function xd(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?oY(Object(a),!0).forEach(function(o){Vc(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):oY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function OHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function cY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,cte(o.key),o)}}function PHe(e,n,a){return n&&cY(e.prototype,n),a&&cY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function DHe(e,n,a){return n=gw(n),kHe(e,ote()?Reflect.construct(n,a||[],gw(e).constructor):n.apply(e,a))}function kHe(e,n){if(n&&(Nm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jHe(e)}function jHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ote(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ote=function(){return!!e})()}function gw(e){return gw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},gw(e)}function LHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&VD(e,n)}function VD(e,n){return VD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},VD(e,n)}function Vc(e,n,a){return n=cte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function cte(e){var n=MHe(e,"string");return Nm(n)=="symbol"?n:n+""}function MHe(e,n){if(Nm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Nm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Gl=function(e){function n(){var a;OHe(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=DHe(this,n,[].concat(d)),Vc(a,"state",{isAnimationFinished:!0}),Vc(a,"id",qm("recharts-area-")),Vc(a,"handleAnimationEnd",function(){var m=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),hn(m)&&m()}),Vc(a,"handleAnimationStart",function(){var m=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),hn(m)&&m()}),a}return LHe(n,e),PHe(n,[{key:"renderDots",value:function(o,d,p){var m=this.props.isAnimationActive,y=this.state.isAnimationFinished;if(m&&!y)return null;var b=this.props,E=b.dot,T=b.points,w=b.dataKey,N=vn(this.props,!1),D=vn(E,!0),A=T.map(function(O,F){var M=xd(xd(xd({key:"dot-".concat(F),r:3},N),D),{},{index:F,cx:O.x,cy:O.y,dataKey:w,value:O.value,payload:O.payload,points:T});return n.renderDotItem(E,M)}),k={clipPath:o?"url(#clipPath-".concat(d?"":"dots-").concat(p,")"):null};return me.createElement(fr,Eh({className:"recharts-area-dots"},k),A)}},{key:"renderHorizontalRect",value:function(o){var d=this.props,p=d.baseLine,m=d.points,y=d.strokeWidth,b=m[0].x,E=m[m.length-1].x,T=o*Math.abs(b-E),w=kd(m.map(function(N){return N.y||0}));return ct(p)&&typeof p=="number"?w=Math.max(p,w):p&&Array.isArray(p)&&p.length&&(w=Math.max(kd(p.map(function(N){return N.y||0})),w)),ct(w)?me.createElement("rect",{x:b<E?b:b-T,y:0,width:T,height:Math.floor(w+(y?parseInt("".concat(y),10):1))}):null}},{key:"renderVerticalRect",value:function(o){var d=this.props,p=d.baseLine,m=d.points,y=d.strokeWidth,b=m[0].y,E=m[m.length-1].y,T=o*Math.abs(b-E),w=kd(m.map(function(N){return N.x||0}));return ct(p)&&typeof p=="number"?w=Math.max(p,w):p&&Array.isArray(p)&&p.length&&(w=Math.max(kd(p.map(function(N){return N.x||0})),w)),ct(w)?me.createElement("rect",{x:0,y:b<E?b:b-T,width:w+(y?parseInt("".concat(y),10):1),height:Math.floor(T)}):null}},{key:"renderClipRect",value:function(o){var d=this.props.layout;return d==="vertical"?this.renderVerticalRect(o):this.renderHorizontalRect(o)}},{key:"renderAreaStatically",value:function(o,d,p,m){var y=this.props,b=y.layout,E=y.type,T=y.stroke,w=y.connectNulls,N=y.isRange;y.ref;var D=ste(y,RHe);return me.createElement(fr,{clipPath:p?"url(#clipPath-".concat(m,")"):null},me.createElement(Jf,Eh({},vn(D,!0),{points:o,connectNulls:w,type:E,baseLine:d,layout:b,stroke:"none",className:"recharts-area-area"})),T!=="none"&&me.createElement(Jf,Eh({},vn(this.props,!1),{className:"recharts-area-curve",layout:b,type:E,connectNulls:w,fill:"none",points:o})),T!=="none"&&N&&me.createElement(Jf,Eh({},vn(this.props,!1),{className:"recharts-area-curve",layout:b,type:E,connectNulls:w,fill:"none",points:d})))}},{key:"renderAreaWithAnimation",value:function(o,d){var p=this,m=this.props,y=m.points,b=m.baseLine,E=m.isAnimationActive,T=m.animationBegin,w=m.animationDuration,N=m.animationEasing,D=m.animationId,A=this.state,k=A.prevPoints,O=A.prevBaseLine;return me.createElement(qc,{begin:T,duration:w,isActive:E,easing:N,from:{t:0},to:{t:1},key:"area-".concat(D),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(F){var M=F.t;if(k){var V=k.length/y.length,H=y.map(function(Q,ee){var oe=Math.floor(ee*V);if(k[oe]){var ne=k[oe],ue=Ki(ne.x,Q.x),Se=Ki(ne.y,Q.y);return xd(xd({},Q),{},{x:ue(M),y:Se(M)})}return Q}),B;if(ct(b)&&typeof b=="number"){var z=Ki(O,b);B=z(M)}else if(_n(b)||Ym(b)){var q=Ki(O,0);B=q(M)}else B=b.map(function(Q,ee){var oe=Math.floor(ee*V);if(O[oe]){var ne=O[oe],ue=Ki(ne.x,Q.x),Se=Ki(ne.y,Q.y);return xd(xd({},Q),{},{x:ue(M),y:Se(M)})}return Q});return p.renderAreaStatically(H,B,o,d)}return me.createElement(fr,null,me.createElement("defs",null,me.createElement("clipPath",{id:"animationClipPath-".concat(d)},p.renderClipRect(M))),me.createElement(fr,{clipPath:"url(#animationClipPath-".concat(d,")")},p.renderAreaStatically(y,b,o,d)))})}},{key:"renderArea",value:function(o,d){var p=this.props,m=p.points,y=p.baseLine,b=p.isAnimationActive,E=this.state,T=E.prevPoints,w=E.prevBaseLine,N=E.totalLength;return b&&m&&m.length&&(!T&&N>0||!gm(T,m)||!gm(w,y))?this.renderAreaWithAnimation(o,d):this.renderAreaStatically(m,y,o,d)}},{key:"render",value:function(){var o,d=this.props,p=d.hide,m=d.dot,y=d.points,b=d.className,E=d.top,T=d.left,w=d.xAxis,N=d.yAxis,D=d.width,A=d.height,k=d.isAnimationActive,O=d.id;if(p||!y||!y.length)return null;var F=this.state.isAnimationFinished,M=y.length===1,V=On("recharts-area",b),H=w&&w.allowDataOverflow,B=N&&N.allowDataOverflow,z=H||B,q=_n(O)?this.id:O,Q=(o=vn(m,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},ee=Q.r,oe=ee===void 0?3:ee,ne=Q.strokeWidth,ue=ne===void 0?2:ne,Se=rQ(m)?m:{},fe=Se.clipDot,we=fe===void 0?!0:fe,he=oe*2+ue;return me.createElement(fr,{className:V},H||B?me.createElement("defs",null,me.createElement("clipPath",{id:"clipPath-".concat(q)},me.createElement("rect",{x:H?T:T-D/2,y:B?E:E-A/2,width:H?D:D*2,height:B?A:A*2})),!we&&me.createElement("clipPath",{id:"clipPath-dots-".concat(q)},me.createElement("rect",{x:T-he/2,y:E-he/2,width:D+he,height:A+he}))):null,M?null:this.renderArea(z,q),(m||M)&&this.renderDots(z,we,q),(!k||F)&&Nl.renderCallByParent(this.props,y))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,curBaseLine:o.baseLine,prevPoints:d.curPoints,prevBaseLine:d.curBaseLine}:o.points!==d.curPoints||o.baseLine!==d.curBaseLine?{curPoints:o.points,curBaseLine:o.baseLine}:null}}])}(Y.PureComponent);ate=Gl;Vc(Gl,"displayName","Area");Vc(Gl,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Hh.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});Vc(Gl,"getBaseValue",function(e,n,a,o){var d=e.layout,p=e.baseValue,m=n.props.baseValue,y=m??p;if(ct(y)&&typeof y=="number")return y;var b=d==="horizontal"?o:a,E=b.scale.domain();if(b.type==="number"){var T=Math.max(E[0],E[1]),w=Math.min(E[0],E[1]);return y==="dataMin"?w:y==="dataMax"||T<0?T:Math.max(Math.min(E[0],E[1]),0)}return y==="dataMin"?E[0]:y==="dataMax"?E[1]:E[0]});Vc(Gl,"getComposedData",function(e){var n=e.props,a=e.item,o=e.xAxis,d=e.yAxis,p=e.xAxisTicks,m=e.yAxisTicks,y=e.bandSize,b=e.dataKey,E=e.stackedData,T=e.dataStartIndex,w=e.displayedData,N=e.offset,D=n.layout,A=E&&E.length,k=ate.getBaseValue(n,a,o,d),O=D==="horizontal",F=!1,M=w.map(function(H,B){var z;A?z=E[T+B]:(z=Ra(H,b),Array.isArray(z)?F=!0:z=[k,z]);var q=z[1]==null||A&&Ra(H,b)==null;return O?{x:qS({axis:o,ticks:p,bandSize:y,entry:H,index:B}),y:q?null:d.scale(z[1]),value:z,payload:H}:{x:q?null:o.scale(z[1]),y:qS({axis:d,ticks:m,bandSize:y,entry:H,index:B}),value:z,payload:H}}),V;return A||F?V=M.map(function(H){var B=Array.isArray(H.value)?H.value[0]:null;return O?{x:H.x,y:B!=null&&H.y!=null?d.scale(B):null}:{x:B!=null?o.scale(B):null,y:H.y}}):V=O?d.scale(k):o.scale(k),xd({points:M,baseLine:V,layout:D,isRange:F},N)});Vc(Gl,"renderDotItem",function(e,n){var a;if(me.isValidElement(e))a=me.cloneElement(e,n);else if(hn(e))a=e(n);else{var o=On("recharts-area-dot",typeof e!="boolean"?e.className:""),d=n.key,p=ste(n,AHe);a=me.createElement(IT,Eh({},p,{key:d,className:o}))}return a});function Rm(e){"@babel/helpers - typeof";return Rm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Rm(e)}function UHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function FHe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ute(o.key),o)}}function VHe(e,n,a){return n&&FHe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function BHe(e,n,a){return n=vw(n),GHe(e,lte()?Reflect.construct(n,a||[],vw(e).constructor):n.apply(e,a))}function GHe(e,n){if(n&&(Rm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WHe(e)}function WHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lte=function(){return!!e})()}function vw(e){return vw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},vw(e)}function $He(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&BD(e,n)}function BD(e,n){return BD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},BD(e,n)}function dte(e,n,a){return n=ute(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ute(e){var n=HHe(e,"string");return Rm(n)=="symbol"?n:n+""}function HHe(e,n){if(Rm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Rm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function GD(){return GD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},GD.apply(this,arguments)}function zHe(e){var n=e.xAxisId,a=hj(),o=pj(),d=Hee(n);return d==null?null:Y.createElement(ng,GD({},d,{className:On("recharts-".concat(d.axisType," ").concat(d.axisType),d.className),viewBox:{x:0,y:0,width:a,height:o},ticksGenerator:function(m){return xl(m,!0)}}))}var qd=function(e){function n(){return UHe(this,n),BHe(this,n,arguments)}return $He(n,e),VHe(n,[{key:"render",value:function(){return Y.createElement(zHe,this.props)}}])}(Y.Component);dte(qd,"displayName","XAxis");dte(qd,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Am(e){"@babel/helpers - typeof";return Am=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Am(e)}function KHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function YHe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,fte(o.key),o)}}function qHe(e,n,a){return n&&YHe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function XHe(e,n,a){return n=yw(n),JHe(e,hte()?Reflect.construct(n,a||[],yw(e).constructor):n.apply(e,a))}function JHe(e,n){if(n&&(Am(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QHe(e)}function QHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hte=function(){return!!e})()}function yw(e){return yw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},yw(e)}function ZHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&WD(e,n)}function WD(e,n){return WD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},WD(e,n)}function pte(e,n,a){return n=fte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function fte(e){var n=e7e(e,"string");return Am(n)=="symbol"?n:n+""}function e7e(e,n){if(Am(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Am(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function $D(){return $D=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},$D.apply(this,arguments)}var t7e=function(n){var a=n.yAxisId,o=hj(),d=pj(),p=zee(a);return p==null?null:Y.createElement(ng,$D({},p,{className:On("recharts-".concat(p.axisType," ").concat(p.axisType),p.className),viewBox:{x:0,y:0,width:o,height:d},ticksGenerator:function(y){return xl(y,!0)}}))},Xd=function(e){function n(){return KHe(this,n),XHe(this,n,arguments)}return ZHe(n,e),qHe(n,[{key:"render",value:function(){return Y.createElement(t7e,this.props)}}])}(Y.Component);pte(Xd,"displayName","YAxis");pte(Xd,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function lY(e){return a7e(e)||i7e(e)||r7e(e)||n7e()}function n7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r7e(e,n){if(e){if(typeof e=="string")return HD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return HD(e,n)}}function i7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function a7e(e){if(Array.isArray(e))return HD(e)}function HD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var zD=function(n,a,o,d,p){var m=po(n,mj),y=po(n,jT),b=[].concat(lY(m),lY(y)),E=po(n,MT),T="".concat(d,"Id"),w=d[0],N=a;if(b.length&&(N=b.reduce(function(k,O){if(O.props[T]===o&&Hc(O.props,"extendDomain")&&ct(O.props[w])){var F=O.props[w];return[Math.min(k[0],F),Math.max(k[1],F)]}return k},N)),E.length){var D="".concat(w,"1"),A="".concat(w,"2");N=E.reduce(function(k,O){if(O.props[T]===o&&Hc(O.props,"extendDomain")&&ct(O.props[D])&&ct(O.props[A])){var F=O.props[D],M=O.props[A];return[Math.min(k[0],F,M),Math.max(k[1],F,M)]}return k},N)}return p&&p.length&&(N=p.reduce(function(k,O){return ct(O)?[Math.min(k[0],O),Math.max(k[1],O)]:k},N)),N},mte={exports:{}};(function(e){var n=Object.prototype.hasOwnProperty,a="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(a=!1));function d(b,E,T){this.fn=b,this.context=E,this.once=T||!1}function p(b,E,T,w,N){if(typeof T!="function")throw new TypeError("The listener must be a function");var D=new d(T,w||b,N),A=a?a+E:E;return b._events[A]?b._events[A].fn?b._events[A]=[b._events[A],D]:b._events[A].push(D):(b._events[A]=D,b._eventsCount++),b}function m(b,E){--b._eventsCount===0?b._events=new o:delete b._events[E]}function y(){this._events=new o,this._eventsCount=0}y.prototype.eventNames=function(){var E=[],T,w;if(this._eventsCount===0)return E;for(w in T=this._events)n.call(T,w)&&E.push(a?w.slice(1):w);return Object.getOwnPropertySymbols?E.concat(Object.getOwnPropertySymbols(T)):E},y.prototype.listeners=function(E){var T=a?a+E:E,w=this._events[T];if(!w)return[];if(w.fn)return[w.fn];for(var N=0,D=w.length,A=new Array(D);N<D;N++)A[N]=w[N].fn;return A},y.prototype.listenerCount=function(E){var T=a?a+E:E,w=this._events[T];return w?w.fn?1:w.length:0},y.prototype.emit=function(E,T,w,N,D,A){var k=a?a+E:E;if(!this._events[k])return!1;var O=this._events[k],F=arguments.length,M,V;if(O.fn){switch(O.once&&this.removeListener(E,O.fn,void 0,!0),F){case 1:return O.fn.call(O.context),!0;case 2:return O.fn.call(O.context,T),!0;case 3:return O.fn.call(O.context,T,w),!0;case 4:return O.fn.call(O.context,T,w,N),!0;case 5:return O.fn.call(O.context,T,w,N,D),!0;case 6:return O.fn.call(O.context,T,w,N,D,A),!0}for(V=1,M=new Array(F-1);V<F;V++)M[V-1]=arguments[V];O.fn.apply(O.context,M)}else{var H=O.length,B;for(V=0;V<H;V++)switch(O[V].once&&this.removeListener(E,O[V].fn,void 0,!0),F){case 1:O[V].fn.call(O[V].context);break;case 2:O[V].fn.call(O[V].context,T);break;case 3:O[V].fn.call(O[V].context,T,w);break;case 4:O[V].fn.call(O[V].context,T,w,N);break;default:if(!M)for(B=1,M=new Array(F-1);B<F;B++)M[B-1]=arguments[B];O[V].fn.apply(O[V].context,M)}}return!0},y.prototype.on=function(E,T,w){return p(this,E,T,w,!1)},y.prototype.once=function(E,T,w){return p(this,E,T,w,!0)},y.prototype.removeListener=function(E,T,w,N){var D=a?a+E:E;if(!this._events[D])return this;if(!T)return m(this,D),this;var A=this._events[D];if(A.fn)A.fn===T&&(!N||A.once)&&(!w||A.context===w)&&m(this,D);else{for(var k=0,O=[],F=A.length;k<F;k++)(A[k].fn!==T||N&&!A[k].once||w&&A[k].context!==w)&&O.push(A[k]);O.length?this._events[D]=O.length===1?O[0]:O:m(this,D)}return this},y.prototype.removeAllListeners=function(E){var T;return E?(T=a?a+E:E,this._events[T]&&m(this,T)):(this._events=new o,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=a,y.EventEmitter=y,e.exports=y})(mte);var s7e=mte.exports;const o7e=ar(s7e);var c1=new o7e,l1="recharts.syncMouseEvents";function __(e){"@babel/helpers - typeof";return __=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},__(e)}function c7e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function l7e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,gte(o.key),o)}}function d7e(e,n,a){return n&&l7e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d1(e,n,a){return n=gte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function gte(e){var n=u7e(e,"string");return __(n)=="symbol"?n:n+""}function u7e(e,n){if(__(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(__(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var h7e=function(){function e(){c7e(this,e),d1(this,"activeIndex",0),d1(this,"coordinateList",[]),d1(this,"layout","horizontal")}return d7e(e,[{key:"setDetails",value:function(a){var o,d=a.coordinateList,p=d===void 0?null:d,m=a.container,y=m===void 0?null:m,b=a.layout,E=b===void 0?null:b,T=a.offset,w=T===void 0?null:T,N=a.mouseHandlerCallback,D=N===void 0?null:N;this.coordinateList=(o=p??this.coordinateList)!==null&&o!==void 0?o:[],this.container=y??this.container,this.layout=E??this.layout,this.offset=w??this.offset,this.mouseHandlerCallback=D??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(a){if(this.coordinateList.length!==0)switch(a.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(a){this.activeIndex=a}},{key:"spoofMouse",value:function(){var a,o;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var d=this.container.getBoundingClientRect(),p=d.x,m=d.y,y=d.height,b=this.coordinateList[this.activeIndex].coordinate,E=((a=window)===null||a===void 0?void 0:a.scrollX)||0,T=((o=window)===null||o===void 0?void 0:o.scrollY)||0,w=p+b+E,N=m+this.offset.top+y/2+T;this.mouseHandlerCallback({pageX:w,pageY:N})}}}])}();function p7e(e,n,a){if(a==="number"&&n===!0&&Array.isArray(e)){var o=e==null?void 0:e[0],d=e==null?void 0:e[1];if(o&&d&&ct(o)&&ct(d))return!0}return!1}function f7e(e,n,a,o){var d=o/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?n.x-d:a.left+.5,y:e==="horizontal"?a.top+.5:n.y-d,width:e==="horizontal"?o:a.width-1,height:e==="horizontal"?a.height-1:o}}function vte(e){var n=e.cx,a=e.cy,o=e.radius,d=e.startAngle,p=e.endAngle,m=Yi(n,a,o,d),y=Yi(n,a,o,p);return{points:[m,y],cx:n,cy:a,radius:o,startAngle:d,endAngle:p}}function m7e(e,n,a){var o,d,p,m;if(e==="horizontal")o=n.x,p=o,d=a.top,m=a.top+a.height;else if(e==="vertical")d=n.y,m=d,o=a.left,p=a.left+a.width;else if(n.cx!=null&&n.cy!=null)if(e==="centric"){var y=n.cx,b=n.cy,E=n.innerRadius,T=n.outerRadius,w=n.angle,N=Yi(y,b,E,w),D=Yi(y,b,T,w);o=N.x,d=N.y,p=D.x,m=D.y}else return vte(n);return[{x:o,y:d},{x:p,y:m}]}function b_(e){"@babel/helpers - typeof";return b_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},b_(e)}function dY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function _x(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?dY(Object(a),!0).forEach(function(o){g7e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):dY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function g7e(e,n,a){return n=v7e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function v7e(e){var n=y7e(e,"string");return b_(n)=="symbol"?n:n+""}function y7e(e,n){if(b_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(b_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function _7e(e){var n,a,o=e.element,d=e.tooltipEventType,p=e.isActive,m=e.activeCoordinate,y=e.activePayload,b=e.offset,E=e.activeTooltipIndex,T=e.tooltipAxisBandSize,w=e.layout,N=e.chartName,D=(n=o.props.cursor)!==null&&n!==void 0?n:(a=o.type.defaultProps)===null||a===void 0?void 0:a.cursor;if(!o||!D||!p||!m||N!=="ScatterChart"&&d!=="axis")return null;var A,k=Jf;if(N==="ScatterChart")A=m,k=l8e;else if(N==="BarChart")A=f7e(w,m,b,T),k=cj;else if(w==="radial"){var O=vte(m),F=O.cx,M=O.cy,V=O.radius,H=O.startAngle,B=O.endAngle;A={cx:F,cy:M,startAngle:H,endAngle:B,innerRadius:V,outerRadius:V},k=gee}else A={points:m7e(w,m,b)},k=Jf;var z=_x(_x(_x(_x({stroke:"#ccc",pointerEvents:"none"},b),A),vn(D,!1)),{},{payload:y,payloadIndex:E,className:On("recharts-tooltip-cursor",D.className)});return Y.isValidElement(D)?Y.cloneElement(D,z):Y.createElement(k,z)}var b7e=["item"],E7e=["children","className","width","height","style","compact","title","desc"];function Im(e){"@babel/helpers - typeof";return Im=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Im(e)}function Vf(){return Vf=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Vf.apply(this,arguments)}function uY(e,n){return w7e(e)||S7e(e,n)||_te(e,n)||x7e()}function x7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S7e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,m,y=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(E)throw d}}return y}}function w7e(e){if(Array.isArray(e))return e}function hY(e,n){if(e==null)return{};var a=T7e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function T7e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function C7e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function N7e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,bte(o.key),o)}}function R7e(e,n,a){return n&&N7e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function A7e(e,n,a){return n=_w(n),I7e(e,yte()?Reflect.construct(n,a||[],_w(e).constructor):n.apply(e,a))}function I7e(e,n){if(n&&(Im(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return O7e(e)}function O7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yte=function(){return!!e})()}function _w(e){return _w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_w(e)}function P7e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&KD(e,n)}function KD(e,n){return KD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},KD(e,n)}function Om(e){return j7e(e)||k7e(e)||_te(e)||D7e()}function D7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _te(e,n){if(e){if(typeof e=="string")return YD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return YD(e,n)}}function k7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function j7e(e){if(Array.isArray(e))return YD(e)}function YD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function pY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Be(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?pY(Object(a),!0).forEach(function(o){zt(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function zt(e,n,a){return n=bte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function bte(e){var n=L7e(e,"string");return Im(n)=="symbol"?n:n+""}function L7e(e,n){if(Im(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Im(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var M7e={xAxis:["bottom","top"],yAxis:["left","right"]},U7e={width:"100%",height:"100%"},Ete={x:0,y:0};function bx(e){return e}var F7e=function(n,a){return a==="horizontal"?n.x:a==="vertical"?n.y:a==="centric"?n.angle:n.radius},V7e=function(n,a,o,d){var p=a.find(function(T){return T&&T.index===o});if(p){if(n==="horizontal")return{x:p.coordinate,y:d.y};if(n==="vertical")return{x:d.x,y:p.coordinate};if(n==="centric"){var m=p.coordinate,y=d.radius;return Be(Be(Be({},d),Yi(d.cx,d.cy,y,m)),{},{angle:m,radius:y})}var b=p.coordinate,E=d.angle;return Be(Be(Be({},d),Yi(d.cx,d.cy,b,E)),{},{angle:E,radius:b})}return Ete},UT=function(n,a){var o=a.graphicalItems,d=a.dataStartIndex,p=a.dataEndIndex,m=(o??[]).reduce(function(y,b){var E=b.props.data;return E&&E.length?[].concat(Om(y),Om(E)):y},[]);return m.length>0?m:n&&n.length&&ct(d)&&ct(p)?n.slice(d,p+1):[]};function xte(e){return e==="number"?[0,"auto"]:void 0}var qD=function(n,a,o,d){var p=n.graphicalItems,m=n.tooltipAxis,y=UT(a,n);return o<0||!p||!p.length||o>=y.length?null:p.reduce(function(b,E){var T,w=(T=E.props.data)!==null&&T!==void 0?T:a;w&&n.dataStartIndex+n.dataEndIndex!==0&&n.dataEndIndex-n.dataStartIndex>=o&&(w=w.slice(n.dataStartIndex,n.dataEndIndex+1));var N;if(m.dataKey&&!m.allowDuplicatedCategory){var D=w===void 0?y:w;N=yS(D,m.dataKey,d)}else N=w&&w[o]||y[o];return N?[].concat(Om(b),[pee(E,N)]):b},[])},fY=function(n,a,o,d){var p=d||{x:n.chartX,y:n.chartY},m=F7e(p,o),y=n.orderedTooltipTicks,b=n.tooltipAxis,E=n.tooltipTicks,T=$Fe(m,y,E,b);if(T>=0&&E){var w=E[T]&&E[T].value,N=qD(n,a,T,w),D=V7e(o,y,T,p);return{activeTooltipIndex:T,activeLabel:w,activePayload:N,activeCoordinate:D}}return null},B7e=function(n,a){var o=a.axes,d=a.graphicalItems,p=a.axisType,m=a.axisIdKey,y=a.stackGroups,b=a.dataStartIndex,E=a.dataEndIndex,T=n.layout,w=n.children,N=n.stackOffset,D=dee(T,p);return o.reduce(function(A,k){var O,F=k.type.defaultProps!==void 0?Be(Be({},k.type.defaultProps),k.props):k.props,M=F.type,V=F.dataKey,H=F.allowDataOverflow,B=F.allowDuplicatedCategory,z=F.scale,q=F.ticks,Q=F.includeHidden,ee=F[m];if(A[ee])return A;var oe=UT(n.data,{graphicalItems:d.filter(function(Me){var et,Re=m in Me.props?Me.props[m]:(et=Me.type.defaultProps)===null||et===void 0?void 0:et[m];return Re===ee}),dataStartIndex:b,dataEndIndex:E}),ne=oe.length,ue,Se,fe;p7e(F.domain,H,M)&&(ue=hD(F.domain,null,H),D&&(M==="number"||z!=="auto")&&(fe=gy(oe,V,"category")));var we=xte(M);if(!ue||ue.length===0){var he,be=(he=F.domain)!==null&&he!==void 0?he:we;if(V){if(ue=gy(oe,V,M),M==="category"&&D){var ae=PAe(ue);B&&ae?(Se=ue,ue=aw(0,ne)):B||(ue=$K(be,ue,k).reduce(function(Me,et){return Me.indexOf(et)>=0?Me:[].concat(Om(Me),[et])},[]))}else if(M==="category")B?ue=ue.filter(function(Me){return Me!==""&&!_n(Me)}):ue=$K(be,ue,k).reduce(function(Me,et){return Me.indexOf(et)>=0||et===""||_n(et)?Me:[].concat(Om(Me),[et])},[]);else if(M==="number"){var de=qFe(oe,d.filter(function(Me){var et,Re,nt=m in Me.props?Me.props[m]:(et=Me.type.defaultProps)===null||et===void 0?void 0:et[m],ut="hide"in Me.props?Me.props.hide:(Re=Me.type.defaultProps)===null||Re===void 0?void 0:Re.hide;return nt===ee&&(Q||!ut)}),V,p,T);de&&(ue=de)}D&&(M==="number"||z!=="auto")&&(fe=gy(oe,V,"category"))}else D?ue=aw(0,ne):y&&y[ee]&&y[ee].hasStack&&M==="number"?ue=N==="expand"?[0,1]:hee(y[ee].stackGroups,b,E):ue=lee(oe,d.filter(function(Me){var et=m in Me.props?Me.props[m]:Me.type.defaultProps[m],Re="hide"in Me.props?Me.props.hide:Me.type.defaultProps.hide;return et===ee&&(Q||!Re)}),M,T,!0);if(M==="number")ue=zD(w,ue,ee,p,q),be&&(ue=hD(be,ue,H));else if(M==="category"&&be){var xe=be,Ue=ue.every(function(Me){return xe.indexOf(Me)>=0});Ue&&(ue=xe)}}return Be(Be({},A),{},zt({},ee,Be(Be({},F),{},{axisType:p,domain:ue,categoricalDomain:fe,duplicateDomain:Se,originalDomain:(O=F.domain)!==null&&O!==void 0?O:we,isCategorical:D,layout:T})))},{})},G7e=function(n,a){var o=a.graphicalItems,d=a.Axis,p=a.axisType,m=a.axisIdKey,y=a.stackGroups,b=a.dataStartIndex,E=a.dataEndIndex,T=n.layout,w=n.children,N=UT(n.data,{graphicalItems:o,dataStartIndex:b,dataEndIndex:E}),D=N.length,A=dee(T,p),k=-1;return o.reduce(function(O,F){var M=F.type.defaultProps!==void 0?Be(Be({},F.type.defaultProps),F.props):F.props,V=M[m],H=xte("number");if(!O[V]){k++;var B;return A?B=aw(0,D):y&&y[V]&&y[V].hasStack?(B=hee(y[V].stackGroups,b,E),B=zD(w,B,V,p)):(B=hD(H,lee(N,o.filter(function(z){var q,Q,ee=m in z.props?z.props[m]:(q=z.type.defaultProps)===null||q===void 0?void 0:q[m],oe="hide"in z.props?z.props.hide:(Q=z.type.defaultProps)===null||Q===void 0?void 0:Q.hide;return ee===V&&!oe}),"number",T),d.defaultProps.allowDataOverflow),B=zD(w,B,V,p)),Be(Be({},O),{},zt({},V,Be(Be({axisType:p},d.defaultProps),{},{hide:!0,orientation:ho(M7e,"".concat(p,".").concat(k%2),null),domain:B,originalDomain:H,isCategorical:A,layout:T})))}return O},{})},W7e=function(n,a){var o=a.axisType,d=o===void 0?"xAxis":o,p=a.AxisComp,m=a.graphicalItems,y=a.stackGroups,b=a.dataStartIndex,E=a.dataEndIndex,T=n.children,w="".concat(d,"Id"),N=po(T,p),D={};return N&&N.length?D=B7e(n,{axes:N,graphicalItems:m,axisType:d,axisIdKey:w,stackGroups:y,dataStartIndex:b,dataEndIndex:E}):m&&m.length&&(D=G7e(n,{Axis:p,graphicalItems:m,axisType:d,axisIdKey:w,stackGroups:y,dataStartIndex:b,dataEndIndex:E})),D},$7e=function(n){var a=Ad(n),o=xl(a,!1,!0);return{tooltipTicks:o,orderedTooltipTicks:j2(o,function(d){return d.coordinate}),tooltipAxis:a,tooltipAxisBandSize:XS(a,o)}},mY=function(n){var a=n.children,o=n.defaultShowTooltip,d=bs(a,bm),p=0,m=0;return n.data&&n.data.length!==0&&(m=n.data.length-1),d&&d.props&&(d.props.startIndex>=0&&(p=d.props.startIndex),d.props.endIndex>=0&&(m=d.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:p,dataEndIndex:m,activeTooltipIndex:-1,isTooltipActive:!!o}},H7e=function(n){return!n||!n.length?!1:n.some(function(a){var o=wl(a&&a.type);return o&&o.indexOf("Bar")>=0})},gY=function(n){return n==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:n==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:n==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},z7e=function(n,a){var o=n.props,d=n.graphicalItems,p=n.xAxisMap,m=p===void 0?{}:p,y=n.yAxisMap,b=y===void 0?{}:y,E=o.width,T=o.height,w=o.children,N=o.margin||{},D=bs(w,bm),A=bs(w,Yf),k=Object.keys(b).reduce(function(B,z){var q=b[z],Q=q.orientation;return!q.mirror&&!q.hide?Be(Be({},B),{},zt({},Q,B[Q]+q.width)):B},{left:N.left||0,right:N.right||0}),O=Object.keys(m).reduce(function(B,z){var q=m[z],Q=q.orientation;return!q.mirror&&!q.hide?Be(Be({},B),{},zt({},Q,ho(B,"".concat(Q))+q.height)):B},{top:N.top||0,bottom:N.bottom||0}),F=Be(Be({},O),k),M=F.bottom;D&&(F.bottom+=D.props.height||bm.defaultProps.height),A&&a&&(F=KFe(F,d,o,a));var V=E-F.left-F.right,H=T-F.top-F.bottom;return Be(Be({brushBottom:M},F),{},{width:Math.max(V,0),height:Math.max(H,0)})},K7e=function(n,a){if(a==="xAxis")return n[a].width;if(a==="yAxis")return n[a].height},Ste=function(n){var a=n.chartName,o=n.GraphicalChild,d=n.defaultTooltipEventType,p=d===void 0?"axis":d,m=n.validateTooltipEventTypes,y=m===void 0?["axis"]:m,b=n.axisComponents,E=n.legendContent,T=n.formatAxisMap,w=n.defaultProps,N=function(F,M){var V=M.graphicalItems,H=M.stackGroups,B=M.offset,z=M.updateId,q=M.dataStartIndex,Q=M.dataEndIndex,ee=F.barSize,oe=F.layout,ne=F.barGap,ue=F.barCategoryGap,Se=F.maxBarSize,fe=gY(oe),we=fe.numericAxisName,he=fe.cateAxisName,be=H7e(V),ae=[];return V.forEach(function(de,xe){var Ue=UT(F.data,{graphicalItems:[de],dataStartIndex:q,dataEndIndex:Q}),Me=de.type.defaultProps!==void 0?Be(Be({},de.type.defaultProps),de.props):de.props,et=Me.dataKey,Re=Me.maxBarSize,nt=Me["".concat(we,"Id")],ut=Me["".concat(he,"Id")],Kt={},Rn=b.reduce(function(ma,Oa){var oc=M["".concat(Oa.axisType,"Map")],tt=Me["".concat(Oa.axisType,"Id")];oc&&oc[tt]||Oa.axisType==="zAxis"||Vh();var Lt=oc[tt];return Be(Be({},ma),{},zt(zt({},Oa.axisType,Lt),"".concat(Oa.axisType,"Ticks"),xl(Lt)))},Kt),Pe=Rn[he],lt=Rn["".concat(he,"Ticks")],Et=H&&H[nt]&&H[nt].hasStack&&oVe(de,H[nt].stackGroups),Ae=wl(de.type).indexOf("Bar")>=0,wt=XS(Pe,lt),Xe=[],$t=be&&HFe({barSize:ee,stackGroups:H,totalSize:K7e(Rn,he)});if(Ae){var At,ye,Qe=_n(Re)?Se:Re,Wt=(At=(ye=XS(Pe,lt,!0))!==null&&ye!==void 0?ye:Qe)!==null&&At!==void 0?At:0;Xe=zFe({barGap:ne,barCategoryGap:ue,bandSize:Wt!==wt?Wt:wt,sizeList:$t[ut],maxBarSize:Qe}),Wt!==wt&&(Xe=Xe.map(function(ma){return Be(Be({},ma),{},{position:Be(Be({},ma.position),{},{offset:ma.position.offset-Wt/2})})}))}var ui=de&&de.type&&de.type.getComposedData;ui&&ae.push({props:Be(Be({},ui(Be(Be({},Rn),{},{displayedData:Ue,props:F,dataKey:et,item:de,bandSize:wt,barPosition:Xe,offset:B,stackedData:Et,layout:oe,dataStartIndex:q,dataEndIndex:Q}))),{},zt(zt(zt({key:de.key||"item-".concat(xe)},we,Rn[we]),he,Rn[he]),"animationId",z)),childIndex:$Ae(de,F.children),item:de})}),ae},D=function(F,M){var V=F.props,H=F.dataStartIndex,B=F.dataEndIndex,z=F.updateId;if(!U7({props:V}))return null;var q=V.children,Q=V.layout,ee=V.stackOffset,oe=V.data,ne=V.reverseStackOrder,ue=gY(Q),Se=ue.numericAxisName,fe=ue.cateAxisName,we=po(q,o),he=iVe(oe,we,"".concat(Se,"Id"),"".concat(fe,"Id"),ee,ne),be=b.reduce(function(Me,et){var Re="".concat(et.axisType,"Map");return Be(Be({},Me),{},zt({},Re,W7e(V,Be(Be({},et),{},{graphicalItems:we,stackGroups:et.axisType===Se&&he,dataStartIndex:H,dataEndIndex:B}))))},{}),ae=z7e(Be(Be({},be),{},{props:V,graphicalItems:we}),M==null?void 0:M.legendBBox);Object.keys(be).forEach(function(Me){be[Me]=T(V,be[Me],ae,Me.replace("Map",""),a)});var de=be["".concat(fe,"Map")],xe=$7e(de),Ue=N(V,Be(Be({},be),{},{dataStartIndex:H,dataEndIndex:B,updateId:z,graphicalItems:we,stackGroups:he,offset:ae}));return Be(Be({formattedGraphicalItems:Ue,graphicalItems:we,offset:ae,stackGroups:he},xe),be)},A=function(O){function F(M){var V,H,B;return C7e(this,F),B=A7e(this,F,[M]),zt(B,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),zt(B,"accessibilityManager",new h7e),zt(B,"handleLegendBBoxUpdate",function(z){if(z){var q=B.state,Q=q.dataStartIndex,ee=q.dataEndIndex,oe=q.updateId;B.setState(Be({legendBBox:z},D({props:B.props,dataStartIndex:Q,dataEndIndex:ee,updateId:oe},Be(Be({},B.state),{},{legendBBox:z}))))}}),zt(B,"handleReceiveSyncEvent",function(z,q,Q){if(B.props.syncId===z){if(Q===B.eventEmitterSymbol&&typeof B.props.syncMethod!="function")return;B.applySyncEvent(q)}}),zt(B,"handleBrushChange",function(z){var q=z.startIndex,Q=z.endIndex;if(q!==B.state.dataStartIndex||Q!==B.state.dataEndIndex){var ee=B.state.updateId;B.setState(function(){return Be({dataStartIndex:q,dataEndIndex:Q},D({props:B.props,dataStartIndex:q,dataEndIndex:Q,updateId:ee},B.state))}),B.triggerSyncEvent({dataStartIndex:q,dataEndIndex:Q})}}),zt(B,"handleMouseEnter",function(z){var q=B.getMouseInfo(z);if(q){var Q=Be(Be({},q),{},{isTooltipActive:!0});B.setState(Q),B.triggerSyncEvent(Q);var ee=B.props.onMouseEnter;hn(ee)&&ee(Q,z)}}),zt(B,"triggeredAfterMouseMove",function(z){var q=B.getMouseInfo(z),Q=q?Be(Be({},q),{},{isTooltipActive:!0}):{isTooltipActive:!1};B.setState(Q),B.triggerSyncEvent(Q);var ee=B.props.onMouseMove;hn(ee)&&ee(Q,z)}),zt(B,"handleItemMouseEnter",function(z){B.setState(function(){return{isTooltipActive:!0,activeItem:z,activePayload:z.tooltipPayload,activeCoordinate:z.tooltipPosition||{x:z.cx,y:z.cy}}})}),zt(B,"handleItemMouseLeave",function(){B.setState(function(){return{isTooltipActive:!1}})}),zt(B,"handleMouseMove",function(z){z.persist(),B.throttleTriggeredAfterMouseMove(z)}),zt(B,"handleMouseLeave",function(z){B.throttleTriggeredAfterMouseMove.cancel();var q={isTooltipActive:!1};B.setState(q),B.triggerSyncEvent(q);var Q=B.props.onMouseLeave;hn(Q)&&Q(q,z)}),zt(B,"handleOuterEvent",function(z){var q=WAe(z),Q=ho(B.props,"".concat(q));if(q&&hn(Q)){var ee,oe;/.*touch.*/i.test(q)?oe=B.getMouseInfo(z.changedTouches[0]):oe=B.getMouseInfo(z),Q((ee=oe)!==null&&ee!==void 0?ee:{},z)}}),zt(B,"handleClick",function(z){var q=B.getMouseInfo(z);if(q){var Q=Be(Be({},q),{},{isTooltipActive:!0});B.setState(Q),B.triggerSyncEvent(Q);var ee=B.props.onClick;hn(ee)&&ee(Q,z)}}),zt(B,"handleMouseDown",function(z){var q=B.props.onMouseDown;if(hn(q)){var Q=B.getMouseInfo(z);q(Q,z)}}),zt(B,"handleMouseUp",function(z){var q=B.props.onMouseUp;if(hn(q)){var Q=B.getMouseInfo(z);q(Q,z)}}),zt(B,"handleTouchMove",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.throttleTriggeredAfterMouseMove(z.changedTouches[0])}),zt(B,"handleTouchStart",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.handleMouseDown(z.changedTouches[0])}),zt(B,"handleTouchEnd",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.handleMouseUp(z.changedTouches[0])}),zt(B,"handleDoubleClick",function(z){var q=B.props.onDoubleClick;if(hn(q)){var Q=B.getMouseInfo(z);q(Q,z)}}),zt(B,"handleContextMenu",function(z){var q=B.props.onContextMenu;if(hn(q)){var Q=B.getMouseInfo(z);q(Q,z)}}),zt(B,"triggerSyncEvent",function(z){B.props.syncId!==void 0&&c1.emit(l1,B.props.syncId,z,B.eventEmitterSymbol)}),zt(B,"applySyncEvent",function(z){var q=B.props,Q=q.layout,ee=q.syncMethod,oe=B.state.updateId,ne=z.dataStartIndex,ue=z.dataEndIndex;if(z.dataStartIndex!==void 0||z.dataEndIndex!==void 0)B.setState(Be({dataStartIndex:ne,dataEndIndex:ue},D({props:B.props,dataStartIndex:ne,dataEndIndex:ue,updateId:oe},B.state)));else if(z.activeTooltipIndex!==void 0){var Se=z.chartX,fe=z.chartY,we=z.activeTooltipIndex,he=B.state,be=he.offset,ae=he.tooltipTicks;if(!be)return;if(typeof ee=="function")we=ee(ae,z);else if(ee==="value"){we=-1;for(var de=0;de<ae.length;de++)if(ae[de].value===z.activeLabel){we=de;break}}var xe=Be(Be({},be),{},{x:be.left,y:be.top}),Ue=Math.min(Se,xe.x+xe.width),Me=Math.min(fe,xe.y+xe.height),et=ae[we]&&ae[we].value,Re=qD(B.state,B.props.data,we),nt=ae[we]?{x:Q==="horizontal"?ae[we].coordinate:Ue,y:Q==="horizontal"?Me:ae[we].coordinate}:Ete;B.setState(Be(Be({},z),{},{activeLabel:et,activeCoordinate:nt,activePayload:Re,activeTooltipIndex:we}))}else B.setState(z)}),zt(B,"renderCursor",function(z){var q,Q=B.state,ee=Q.isTooltipActive,oe=Q.activeCoordinate,ne=Q.activePayload,ue=Q.offset,Se=Q.activeTooltipIndex,fe=Q.tooltipAxisBandSize,we=B.getTooltipEventType(),he=(q=z.props.active)!==null&&q!==void 0?q:ee,be=B.props.layout,ae=z.key||"_recharts-cursor";return me.createElement(_7e,{key:ae,activeCoordinate:oe,activePayload:ne,activeTooltipIndex:Se,chartName:a,element:z,isActive:he,layout:be,offset:ue,tooltipAxisBandSize:fe,tooltipEventType:we})}),zt(B,"renderPolarAxis",function(z,q,Q){var ee=ho(z,"type.axisType"),oe=ho(B.state,"".concat(ee,"Map")),ne=z.type.defaultProps,ue=ne!==void 0?Be(Be({},ne),z.props):z.props,Se=oe&&oe[ue["".concat(ee,"Id")]];return Y.cloneElement(z,Be(Be({},Se),{},{className:On(ee,Se.className),key:z.key||"".concat(q,"-").concat(Q),ticks:xl(Se,!0)}))}),zt(B,"renderPolarGrid",function(z){var q=z.props,Q=q.radialLines,ee=q.polarAngles,oe=q.polarRadius,ne=B.state,ue=ne.radiusAxisMap,Se=ne.angleAxisMap,fe=Ad(ue),we=Ad(Se),he=we.cx,be=we.cy,ae=we.innerRadius,de=we.outerRadius;return Y.cloneElement(z,{polarAngles:Array.isArray(ee)?ee:xl(we,!0).map(function(xe){return xe.coordinate}),polarRadius:Array.isArray(oe)?oe:xl(fe,!0).map(function(xe){return xe.coordinate}),cx:he,cy:be,innerRadius:ae,outerRadius:de,key:z.key||"polar-grid",radialLines:Q})}),zt(B,"renderLegend",function(){var z=B.state.formattedGraphicalItems,q=B.props,Q=q.children,ee=q.width,oe=q.height,ne=B.props.margin||{},ue=ee-(ne.left||0)-(ne.right||0),Se=oee({children:Q,formattedGraphicalItems:z,legendWidth:ue,legendContent:E});if(!Se)return null;var fe=Se.item,we=hY(Se,b7e);return Y.cloneElement(fe,Be(Be({},we),{},{chartWidth:ee,chartHeight:oe,margin:ne,onBBoxUpdate:B.handleLegendBBoxUpdate}))}),zt(B,"renderTooltip",function(){var z,q=B.props,Q=q.children,ee=q.accessibilityLayer,oe=bs(Q,Es);if(!oe)return null;var ne=B.state,ue=ne.isTooltipActive,Se=ne.activeCoordinate,fe=ne.activePayload,we=ne.activeLabel,he=ne.offset,be=(z=oe.props.active)!==null&&z!==void 0?z:ue;return Y.cloneElement(oe,{viewBox:Be(Be({},he),{},{x:he.left,y:he.top}),active:be,label:we,payload:be?fe:[],coordinate:Se,accessibilityLayer:ee})}),zt(B,"renderBrush",function(z){var q=B.props,Q=q.margin,ee=q.data,oe=B.state,ne=oe.offset,ue=oe.dataStartIndex,Se=oe.dataEndIndex,fe=oe.updateId;return Y.cloneElement(z,{key:z.key||"_recharts-brush",onChange:mx(B.handleBrushChange,z.props.onChange),data:ee,x:ct(z.props.x)?z.props.x:ne.left,y:ct(z.props.y)?z.props.y:ne.top+ne.height+ne.brushBottom-(Q.bottom||0),width:ct(z.props.width)?z.props.width:ne.width,startIndex:ue,endIndex:Se,updateId:"brush-".concat(fe)})}),zt(B,"renderReferenceElement",function(z,q,Q){if(!z)return null;var ee=B,oe=ee.clipPathId,ne=B.state,ue=ne.xAxisMap,Se=ne.yAxisMap,fe=ne.offset,we=z.type.defaultProps||{},he=z.props,be=he.xAxisId,ae=be===void 0?we.xAxisId:be,de=he.yAxisId,xe=de===void 0?we.yAxisId:de;return Y.cloneElement(z,{key:z.key||"".concat(q,"-").concat(Q),xAxis:ue[ae],yAxis:Se[xe],viewBox:{x:fe.left,y:fe.top,width:fe.width,height:fe.height},clipPathId:oe})}),zt(B,"renderActivePoints",function(z){var q=z.item,Q=z.activePoint,ee=z.basePoint,oe=z.childIndex,ne=z.isRange,ue=[],Se=q.props.key,fe=q.item.type.defaultProps!==void 0?Be(Be({},q.item.type.defaultProps),q.item.props):q.item.props,we=fe.activeDot,he=fe.dataKey,be=Be(Be({index:oe,dataKey:he,cx:Q.x,cy:Q.y,r:4,fill:oj(q.item),strokeWidth:2,stroke:"#fff",payload:Q.payload,value:Q.value},vn(we,!1)),_S(we));return ue.push(F.renderActiveDot(we,be,"".concat(Se,"-activePoint-").concat(oe))),ee?ue.push(F.renderActiveDot(we,Be(Be({},be),{},{cx:ee.x,cy:ee.y}),"".concat(Se,"-basePoint-").concat(oe))):ne&&ue.push(null),ue}),zt(B,"renderGraphicChild",function(z,q,Q){var ee=B.filterFormatItem(z,q,Q);if(!ee)return null;var oe=B.getTooltipEventType(),ne=B.state,ue=ne.isTooltipActive,Se=ne.tooltipAxis,fe=ne.activeTooltipIndex,we=ne.activeLabel,he=B.props.children,be=bs(he,Es),ae=ee.props,de=ae.points,xe=ae.isRange,Ue=ae.baseLine,Me=ee.item.type.defaultProps!==void 0?Be(Be({},ee.item.type.defaultProps),ee.item.props):ee.item.props,et=Me.activeDot,Re=Me.hide,nt=Me.activeBar,ut=Me.activeShape,Kt=!!(!Re&&ue&&be&&(et||nt||ut)),Rn={};oe!=="axis"&&be&&be.props.trigger==="click"?Rn={onClick:mx(B.handleItemMouseEnter,z.props.onClick)}:oe!=="axis"&&(Rn={onMouseLeave:mx(B.handleItemMouseLeave,z.props.onMouseLeave),onMouseEnter:mx(B.handleItemMouseEnter,z.props.onMouseEnter)});var Pe=Y.cloneElement(z,Be(Be({},ee.props),Rn));function lt(Oa){return typeof Se.dataKey=="function"?Se.dataKey(Oa.payload):null}if(Kt)if(fe>=0){var Et,Ae;if(Se.dataKey&&!Se.allowDuplicatedCategory){var wt=typeof Se.dataKey=="function"?lt:"payload.".concat(Se.dataKey.toString());Et=yS(de,wt,we),Ae=xe&&Ue&&yS(Ue,wt,we)}else Et=de==null?void 0:de[fe],Ae=xe&&Ue&&Ue[fe];if(ut||nt){var Xe=z.props.activeIndex!==void 0?z.props.activeIndex:fe;return[Y.cloneElement(z,Be(Be(Be({},ee.props),Rn),{},{activeIndex:Xe})),null,null]}if(!_n(Et))return[Pe].concat(Om(B.renderActivePoints({item:ee,activePoint:Et,basePoint:Ae,childIndex:fe,isRange:xe})))}else{var $t,At=($t=B.getItemByXY(B.state.activeCoordinate))!==null&&$t!==void 0?$t:{graphicalItem:Pe},ye=At.graphicalItem,Qe=ye.item,Wt=Qe===void 0?z:Qe,ui=ye.childIndex,ma=Be(Be(Be({},ee.props),Rn),{},{activeIndex:ui});return[Y.cloneElement(Wt,ma),null,null]}return xe?[Pe,null,null]:[Pe,null]}),zt(B,"renderCustomized",function(z,q,Q){return Y.cloneElement(z,Be(Be({key:"recharts-customized-".concat(Q)},B.props),B.state))}),zt(B,"renderMap",{CartesianGrid:{handler:bx,once:!0},ReferenceArea:{handler:B.renderReferenceElement},ReferenceLine:{handler:bx},ReferenceDot:{handler:B.renderReferenceElement},XAxis:{handler:bx},YAxis:{handler:bx},Brush:{handler:B.renderBrush,once:!0},Bar:{handler:B.renderGraphicChild},Line:{handler:B.renderGraphicChild},Area:{handler:B.renderGraphicChild},Radar:{handler:B.renderGraphicChild},RadialBar:{handler:B.renderGraphicChild},Scatter:{handler:B.renderGraphicChild},Pie:{handler:B.renderGraphicChild},Funnel:{handler:B.renderGraphicChild},Tooltip:{handler:B.renderCursor,once:!0},PolarGrid:{handler:B.renderPolarGrid,once:!0},PolarAngleAxis:{handler:B.renderPolarAxis},PolarRadiusAxis:{handler:B.renderPolarAxis},Customized:{handler:B.renderCustomized}}),B.clipPathId="".concat((V=M.id)!==null&&V!==void 0?V:qm("recharts"),"-clip"),B.throttleTriggeredAfterMouseMove=sZ(B.triggeredAfterMouseMove,(H=M.throttleDelay)!==null&&H!==void 0?H:1e3/60),B.state={},B}return P7e(F,O),R7e(F,[{key:"componentDidMount",value:function(){var V,H;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(V=this.props.margin.left)!==null&&V!==void 0?V:0,top:(H=this.props.margin.top)!==null&&H!==void 0?H:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var V=this.props,H=V.children,B=V.data,z=V.height,q=V.layout,Q=bs(H,Es);if(Q){var ee=Q.props.defaultIndex;if(!(typeof ee!="number"||ee<0||ee>this.state.tooltipTicks.length-1)){var oe=this.state.tooltipTicks[ee]&&this.state.tooltipTicks[ee].value,ne=qD(this.state,B,ee,oe),ue=this.state.tooltipTicks[ee].coordinate,Se=(this.state.offset.top+z)/2,fe=q==="horizontal",we=fe?{x:ue,y:Se}:{y:ue,x:Se},he=this.state.formattedGraphicalItems.find(function(ae){var de=ae.item;return de.type.name==="Scatter"});he&&(we=Be(Be({},we),he.props.points[ee].tooltipPosition),ne=he.props.points[ee].tooltipPayload);var be={activeTooltipIndex:ee,isTooltipActive:!0,activeLabel:oe,activePayload:ne,activeCoordinate:we};this.setState(be),this.renderCursor(Q),this.accessibilityManager.setIndex(ee)}}}},{key:"getSnapshotBeforeUpdate",value:function(V,H){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==H.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==V.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==V.margin){var B,z;this.accessibilityManager.setDetails({offset:{left:(B=this.props.margin.left)!==null&&B!==void 0?B:0,top:(z=this.props.margin.top)!==null&&z!==void 0?z:0}})}return null}},{key:"componentDidUpdate",value:function(V){NP([bs(V.children,Es)],[bs(this.props.children,Es)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var V=bs(this.props.children,Es);if(V&&typeof V.props.shared=="boolean"){var H=V.props.shared?"axis":"item";return y.indexOf(H)>=0?H:p}return p}},{key:"getMouseInfo",value:function(V){if(!this.container)return null;var H=this.container,B=H.getBoundingClientRect(),z=gUe(B),q={chartX:Math.round(V.pageX-z.left),chartY:Math.round(V.pageY-z.top)},Q=B.width/H.offsetWidth||1,ee=this.inRange(q.chartX,q.chartY,Q);if(!ee)return null;var oe=this.state,ne=oe.xAxisMap,ue=oe.yAxisMap,Se=this.getTooltipEventType(),fe=fY(this.state,this.props.data,this.props.layout,ee);if(Se!=="axis"&&ne&&ue){var we=Ad(ne).scale,he=Ad(ue).scale,be=we&&we.invert?we.invert(q.chartX):null,ae=he&&he.invert?he.invert(q.chartY):null;return Be(Be({},q),{},{xValue:be,yValue:ae},fe)}return fe?Be(Be({},q),fe):null}},{key:"inRange",value:function(V,H){var B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,z=this.props.layout,q=V/B,Q=H/B;if(z==="horizontal"||z==="vertical"){var ee=this.state.offset,oe=q>=ee.left&&q<=ee.left+ee.width&&Q>=ee.top&&Q<=ee.top+ee.height;return oe?{x:q,y:Q}:null}var ne=this.state,ue=ne.angleAxisMap,Se=ne.radiusAxisMap;if(ue&&Se){var fe=Ad(ue);return KK({x:q,y:Q},fe)}return null}},{key:"parseEventsOfWrapper",value:function(){var V=this.props.children,H=this.getTooltipEventType(),B=bs(V,Es),z={};B&&H==="axis"&&(B.props.trigger==="click"?z={onClick:this.handleClick}:z={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var q=_S(this.props,this.handleOuterEvent);return Be(Be({},q),z)}},{key:"addListener",value:function(){c1.on(l1,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){c1.removeListener(l1,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(V,H,B){for(var z=this.state.formattedGraphicalItems,q=0,Q=z.length;q<Q;q++){var ee=z[q];if(ee.item===V||ee.props.key===V.key||H===wl(ee.item.type)&&B===ee.childIndex)return ee}return null}},{key:"renderClipPath",value:function(){var V=this.clipPathId,H=this.state.offset,B=H.left,z=H.top,q=H.height,Q=H.width;return me.createElement("defs",null,me.createElement("clipPath",{id:V},me.createElement("rect",{x:B,y:z,height:q,width:Q})))}},{key:"getXScales",value:function(){var V=this.state.xAxisMap;return V?Object.entries(V).reduce(function(H,B){var z=uY(B,2),q=z[0],Q=z[1];return Be(Be({},H),{},zt({},q,Q.scale))},{}):null}},{key:"getYScales",value:function(){var V=this.state.yAxisMap;return V?Object.entries(V).reduce(function(H,B){var z=uY(B,2),q=z[0],Q=z[1];return Be(Be({},H),{},zt({},q,Q.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(V){var H;return(H=this.state.xAxisMap)===null||H===void 0||(H=H[V])===null||H===void 0?void 0:H.scale}},{key:"getYScaleByAxisId",value:function(V){var H;return(H=this.state.yAxisMap)===null||H===void 0||(H=H[V])===null||H===void 0?void 0:H.scale}},{key:"getItemByXY",value:function(V){var H=this.state,B=H.formattedGraphicalItems,z=H.activeItem;if(B&&B.length)for(var q=0,Q=B.length;q<Q;q++){var ee=B[q],oe=ee.props,ne=ee.item,ue=ne.type.defaultProps!==void 0?Be(Be({},ne.type.defaultProps),ne.props):ne.props,Se=wl(ne.type);if(Se==="Bar"){var fe=(oe.data||[]).find(function(ae){return Z6e(V,ae)});if(fe)return{graphicalItem:ee,payload:fe}}else if(Se==="RadialBar"){var we=(oe.data||[]).find(function(ae){return KK(V,ae)});if(we)return{graphicalItem:ee,payload:we}}else if(OT(ee,z)||PT(ee,z)||p_(ee,z)){var he=nGe({graphicalItem:ee,activeTooltipItem:z,itemData:ue.data}),be=ue.activeIndex===void 0?he:ue.activeIndex;return{graphicalItem:Be(Be({},ee),{},{childIndex:be}),payload:p_(ee,z)?ue.data[he]:ee.props.data[he]}}}return null}},{key:"render",value:function(){var V=this;if(!U7(this))return null;var H=this.props,B=H.children,z=H.className,q=H.width,Q=H.height,ee=H.style,oe=H.compact,ne=H.title,ue=H.desc,Se=hY(H,E7e),fe=vn(Se,!1);if(oe)return me.createElement(H9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},me.createElement(AP,Vf({},fe,{width:q,height:Q,title:ne,desc:ue}),this.renderClipPath(),V7(B,this.renderMap)));if(this.props.accessibilityLayer){var we,he;fe.tabIndex=(we=this.props.tabIndex)!==null&&we!==void 0?we:0,fe.role=(he=this.props.role)!==null&&he!==void 0?he:"application",fe.onKeyDown=function(ae){V.accessibilityManager.keyboardEvent(ae)},fe.onFocus=function(){V.accessibilityManager.focus()}}var be=this.parseEventsOfWrapper();return me.createElement(H9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},me.createElement("div",Vf({className:On("recharts-wrapper",z),style:Be({position:"relative",cursor:"default",width:q,height:Q},ee)},be,{ref:function(de){V.container=de}}),me.createElement(AP,Vf({},fe,{width:q,height:Q,title:ne,desc:ue,style:U7e}),this.renderClipPath(),V7(B,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(Y.Component);zt(A,"displayName",a),zt(A,"defaultProps",Be({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},w)),zt(A,"getDerivedStateFromProps",function(O,F){var M=O.dataKey,V=O.data,H=O.children,B=O.width,z=O.height,q=O.layout,Q=O.stackOffset,ee=O.margin,oe=F.dataStartIndex,ne=F.dataEndIndex;if(F.updateId===void 0){var ue=mY(O);return Be(Be(Be({},ue),{},{updateId:0},D(Be(Be({props:O},ue),{},{updateId:0}),F)),{},{prevDataKey:M,prevData:V,prevWidth:B,prevHeight:z,prevLayout:q,prevStackOffset:Q,prevMargin:ee,prevChildren:H})}if(M!==F.prevDataKey||V!==F.prevData||B!==F.prevWidth||z!==F.prevHeight||q!==F.prevLayout||Q!==F.prevStackOffset||!Kf(ee,F.prevMargin)){var Se=mY(O),fe={chartX:F.chartX,chartY:F.chartY,isTooltipActive:F.isTooltipActive},we=Be(Be({},fY(F,V,q)),{},{updateId:F.updateId+1}),he=Be(Be(Be({},Se),fe),we);return Be(Be(Be({},he),D(Be({props:O},he),F)),{},{prevDataKey:M,prevData:V,prevWidth:B,prevHeight:z,prevLayout:q,prevStackOffset:Q,prevMargin:ee,prevChildren:H})}if(!NP(H,F.prevChildren)){var be,ae,de,xe,Ue=bs(H,bm),Me=Ue&&(be=(ae=Ue.props)===null||ae===void 0?void 0:ae.startIndex)!==null&&be!==void 0?be:oe,et=Ue&&(de=(xe=Ue.props)===null||xe===void 0?void 0:xe.endIndex)!==null&&de!==void 0?de:ne,Re=Me!==oe||et!==ne,nt=!_n(V),ut=nt&&!Re?F.updateId:F.updateId+1;return Be(Be({updateId:ut},D(Be(Be({props:O},F),{},{updateId:ut,dataStartIndex:Me,dataEndIndex:et}),F)),{},{prevChildren:H,dataStartIndex:Me,dataEndIndex:et})}return null}),zt(A,"renderActiveDot",function(O,F,M){var V;return Y.isValidElement(O)?V=Y.cloneElement(O,F):hn(O)?V=O(F):V=me.createElement(IT,F),me.createElement(fr,{className:"recharts-active-dot",key:M},V)});var k=Y.forwardRef(function(F,M){return me.createElement(A,Vf({},F,{ref:M}))});return k.displayName=A.displayName,k},wte=Ste({chartName:"LineChart",GraphicalChild:rg,axisComponents:[{axisType:"xAxis",AxisComp:qd},{axisType:"yAxis",AxisComp:Xd}],formatAxisMap:Mee}),Tte=Ste({chartName:"AreaChart",GraphicalChild:Gl,axisComponents:[{axisType:"xAxis",AxisComp:qd},{axisType:"yAxis",AxisComp:Xd}],formatAxisMap:Mee});const Cte={vitaminD:{name:"Vitamin D",icon:FJ,color:"amber",unit:"ng/mL",normalRange:"30-100",lowExplanation:"When Vitamin D is low, you may feel tired all the time, have weak bones that break easily, feel sad or depressed, get sick often, and have muscle pain. Your body needs sunlight and certain foods to make Vitamin D.",tips:["Get 15-20 minutes of sunlight daily","Eat eggs, fish, and fortified milk","Consider supplements if advised by doctor"]},vitaminB12:{name:"Vitamin B12",icon:u2,color:"red",unit:"pg/mL",normalRange:"300-900",lowExplanation:"Low Vitamin B12 makes you feel very tired and weak. You might feel dizzy, have trouble thinking clearly, feel numbness in hands or feet, and look pale. Your body needs B12 to make healthy blood cells.",tips:["Eat meat, fish, eggs, and dairy","Vegetarians may need supplements","Get tested if you feel constantly tired"]},iron:{name:"Iron",icon:qw,color:"rose",unit:"mcg/dL",normalRange:"60-170",lowExplanation:"Low iron means your blood cannot carry enough oxygen. You will feel very tired, look pale, feel short of breath, have cold hands and feet, and may have headaches. Women often have low iron.",tips:["Eat red meat, spinach, and beans","Take iron with Vitamin C for better absorption","Avoid tea/coffee with iron-rich meals"]},hemoglobin:{name:"Hemoglobin",icon:Pi,color:"red",unit:"g/dL",normalRange:"12-17",lowExplanation:"Low hemoglobin means anemia - your blood cannot carry enough oxygen to your body. You will feel extremely tired, weak, dizzy, and may have pale skin. Your heart has to work harder.",tips:["Eat iron-rich foods","Include Vitamin C in your diet","See a doctor if symptoms persist"]},calcium:{name:"Calcium",icon:aTe,color:"slate",unit:"mg/dL",normalRange:"8.5-10.5",lowExplanation:"Low calcium weakens your bones and teeth. You may have muscle cramps, numbness in fingers, brittle nails, and bones that break easily. Long-term low calcium can cause osteoporosis.",tips:["Drink milk and eat dairy products","Eat leafy green vegetables","Get enough Vitamin D for calcium absorption"]},vitaminC:{name:"Vitamin C",icon:vS,color:"orange",unit:"mg/dL",normalRange:"0.6-2.0",lowExplanation:"Low Vitamin C means your body cannot heal wounds properly. You may have bleeding gums, bruise easily, feel tired, have dry skin, and get sick often. Your immune system becomes weak.",tips:["Eat citrus fruits like oranges and lemons","Include tomatoes and bell peppers","Eat fresh fruits and vegetables daily"]},cholesterol:{name:"Cholesterol",icon:ir,color:"yellow",unit:"mg/dL",normalRange:"<200",lowExplanation:"While high cholesterol is usually the concern, very low cholesterol can affect hormone production and brain function. However, most people need to focus on keeping cholesterol in healthy range.",tips:["Limit fried and fatty foods","Exercise regularly","Eat more fiber and vegetables"]},bloodSugar:{name:"Blood Sugar",icon:Qw,color:"purple",unit:"mg/dL",normalRange:"70-100",lowExplanation:"Low blood sugar (hypoglycemia) makes you feel shaky, sweaty, confused, and very hungry. You may feel dizzy or faint. High blood sugar over time can lead to diabetes and damage organs.",tips:["Eat regular meals","Limit sugary foods and drinks","Exercise helps control blood sugar"]},thyroid:{name:"Thyroid (TSH)",icon:oTe,color:"indigo",unit:"mIU/L",normalRange:"0.4-4.0",lowExplanation:"Thyroid problems affect your energy and weight. Low thyroid makes you tired, gain weight, feel cold, and have dry skin. High thyroid makes you anxious, lose weight, and feel hot.",tips:["Get thyroid checked if you have unexplained weight changes","Iodine in salt helps thyroid function","Take thyroid medicine as prescribed"]},heartRate:{name:"Heart Rate",icon:Pi,color:"red",unit:"bpm",normalRange:"60-100",lowExplanation:"Very low heart rate can mean your heart is not pumping enough blood. You may feel dizzy, tired, or faint. Athletes often have lower heart rates which is normal for them.",tips:["Regular exercise strengthens your heart","Reduce stress and anxiety","Limit caffeine and alcohol"]},sleep:{name:"Sleep",icon:Vm,color:"indigo",unit:"hours",normalRange:"7-9",lowExplanation:"Not enough sleep makes you tired, irritable, and unable to think clearly. Long-term poor sleep increases risk of heart disease, diabetes, and weight gain. Your body heals during sleep.",tips:["Sleep 7-9 hours every night","Keep a regular sleep schedule","Avoid screens before bedtime"]},steps:{name:"Daily Steps",icon:DJ,color:"cyan",unit:"steps",normalRange:"8,000-10,000",lowExplanation:"Not walking enough means less exercise for your body. This can lead to weight gain, weak muscles, poor heart health, and low energy. Walking is the easiest exercise for everyone.",tips:["Aim for 8,000-10,000 steps daily","Take stairs instead of elevator","Walk after meals for better digestion"]}},Y7e=({metric:e,onClose:n})=>{if(!e)return null;const a=Cte[e];if(!a)return null;const o=a.icon;return l.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",onClick:n,children:l.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md max-h-[85vh] overflow-y-auto p-5 sm:p-6 relative animate-slide-up sm:animate-fade-in shadow-xl",onClick:d=>d.stopPropagation(),children:[l.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full mx-auto mb-4 sm:hidden"}),l.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-1",children:l.jsx(ha,{className:"w-5 h-5"})}),l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-${a.color}-100 flex items-center justify-center`,children:l.jsx(o,{className:`w-5 h-5 sm:w-6 sm:h-6 text-${a.color}-500`})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg sm:text-xl font-bold text-slate-800",children:a.name}),l.jsxs("p",{className:"text-slate-500 text-xs sm:text-sm",children:["Normal: ",a.normalRange," ",a.unit]})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h4",{className:"text-cyan-600 font-medium mb-2 text-sm sm:text-base",children:"What happens when it's low?"}),l.jsx("p",{className:"text-slate-600 text-xs sm:text-sm leading-relaxed",children:a.lowExplanation})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-emerald-600 font-medium mb-2 text-sm sm:text-base",children:"Simple Tips to Improve"}),l.jsx("ul",{className:"space-y-2",children:a.tips.map((d,p)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-600 text-xs sm:text-sm",children:[l.jsx("span",{className:"text-emerald-500 mt-0.5",children:""}),d]},p))})]}),l.jsx("button",{onClick:n,className:"w-full mt-5 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors sm:hidden",children:"Got it"})]})})},to=({metricKey:e,value:n,unit:a,status:o,subtitle:d,onInfoClick:p})=>{const m=Cte[e];if(!m)return null;const y=m.icon,E={normal:"emerald",low:"amber",high:"red",critical:"red"}[o]||"slate",T=n!=null&&n!=="";return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm group relative p-3 sm:p-5 hover:shadow-md transition-shadow",children:[l.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[l.jsx("span",{className:"text-slate-500 text-xs sm:text-sm truncate pr-2",children:m.name}),l.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 shrink-0",children:[l.jsx("button",{onClick:()=>p(e),className:"w-5 h-5 sm:w-6 sm:h-6 rounded-lg bg-slate-100 flex items-center justify-center opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity hover:bg-slate-200",title:"Learn more",children:l.jsx(Xw,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-cyan-500"})}),l.jsx("div",{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-lg bg-${m.color}-100 flex items-center justify-center`,children:l.jsx(y,{className:`w-3 h-3 sm:w-4 sm:h-4 text-${m.color}-500`})})]})]}),l.jsx("div",{className:"flex items-baseline gap-1 sm:gap-2 flex-wrap",children:T?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"text-xl sm:text-3xl font-bold text-slate-800",children:n}),l.jsx("span",{className:"text-slate-400 text-xs sm:text-sm",children:a||m.unit}),o&&l.jsx("span",{className:`text-${E}-600 text-[10px] sm:text-xs ml-auto px-1.5 sm:px-2 py-0.5 bg-${E}-100 rounded-full`,children:o.toUpperCase()})]}):l.jsx("span",{className:"text-slate-400 text-sm",children:"No data"})}),d&&l.jsx("p",{className:"text-slate-400 text-[10px] sm:text-xs mt-1 sm:mt-2 truncate",children:d})]})};function q7e(){var xe,Ue,Me,et,Re,nt,ut,Kt,Rn;const{user:e}=fa(),{dashboardData:n,wearableData:a,nutritionData:o,loading:d,fetchDashboard:p,fetchWearable:m,fetchNutrition:y}=QTe(),[b,E]=Y.useState(null),[T,w]=Y.useState(new Date().toISOString().split("T")[0]),[N,D]=Y.useState(null),[A,k]=Y.useState(null);Y.useEffect(()=>{(async()=>{var lt,Et;try{k(null),await Promise.all([p(),m()])}catch(Ae){console.error("Failed to fetch dashboard:",Ae),k(((Et=(lt=Ae.response)==null?void 0:lt.data)==null?void 0:Et.message)||"Failed to load dashboard data")}})()},[p,m]),Y.useEffect(()=>{(async()=>{const lt=await y(T);D(lt)})()},[T,y]);const O=d.dashboard||d.wearable,F=n,M=N||o;if(O)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading your health data..."})]})});if(A)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-red-500 mb-4",children:A}),l.jsx("button",{onClick:fetchData,className:"px-6 py-2 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600",children:"Try Again"})]})});const{user:V,healthScores:H,latestAnalysis:B,recentReports:z}=F||{},q=z&&z.length>0,Q=((xe=V==null?void 0:V.healthMetrics)==null?void 0:xe.healthScore)||(B==null?void 0:B.healthScore)||null,ee=(B==null?void 0:B.metrics)||{},oe=Pe=>Pe==null?null:typeof Pe=="object"&&Pe.value!==void 0?Pe.value:Pe,ne={vitaminD:oe(ee.vitaminD),vitaminB12:oe(ee.vitaminB12),iron:oe(ee.iron),calcium:oe(ee.calcium),hemoglobin:oe(ee.hemoglobin),bloodSugar:oe(ee.bloodSugar)||oe(ee.glucose),tsh:oe(ee.tsh)||oe(ee.thyroid),vitaminC:oe(ee.vitaminC),cholesterol:oe(ee.cholesterol)||oe(ee.totalCholesterol)},ue=(a==null?void 0:a.connected)&&(a==null?void 0:a.todayMetrics),Se=(a==null?void 0:a.todayMetrics)||{steps:0,caloriesBurned:0},fe=(a==null?void 0:a.recentHeartRate)||[],we=(a==null?void 0:a.recentSleep)||[],he=fe.length>0?Math.round(fe.reduce((Pe,lt)=>Pe+lt.bpm,0)/fe.length):null,be=we.length>0?(we.reduce((Pe,lt)=>Pe+lt.totalSleepMinutes,0)/we.length/60).toFixed(1):null,ae=(H==null?void 0:H.length)>0?H.map(Pe=>({date:new Date(Pe.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:Pe.score,type:Pe.type})):[],de=(Pe,lt,Et)=>{if(!Pe)return null;const Ae=parseFloat(Pe);return Ae<lt*.7?"critical":Ae<lt?"low":Ae>Et*1.3||Ae>Et?"high":"normal"};return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[b&&l.jsx(Y7e,{metric:b,onClose:()=>E(null)}),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsxs("div",{children:[l.jsxs("h1",{className:"text-xl sm:text-3xl font-bold text-slate-800",children:["Welcome back, ",l.jsx("span",{className:"text-cyan-600",children:(Ue=e==null?void 0:e.name)==null?void 0:Ue.split(" ")[0]})]}),l.jsx("p",{className:"text-slate-500 mt-1 text-sm sm:text-base",children:"Your complete health overview. Tap the eye icon to learn more."})]}),l.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[l.jsxs(un,{to:"/upload",className:"px-3 sm:px-6 py-2 sm:py-3 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50 flex items-center gap-1 sm:gap-2 text-xs sm:text-base",children:[l.jsx(co,{className:"w-3 h-3 sm:w-4 sm:h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Upload Records"}),l.jsx("span",{className:"sm:hidden",children:"Upload"})]}),l.jsxs("button",{className:"px-3 sm:px-6 py-2 sm:py-3 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-1 sm:gap-2 text-xs sm:text-base",style:{backgroundColor:"#8B7355"},children:[l.jsx(Wc,{className:"w-3 h-3 sm:w-4 sm:h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Log Symptoms"}),l.jsx("span",{className:"sm:hidden",children:"Log"})]})]})]}),l.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[q&&Q?l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 sm:p-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-4 mb-4",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-800",children:"Health Score Trend"}),l.jsx("p",{className:"text-slate-500 text-xs sm:text-sm",children:"Your overall health progress"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl sm:text-4xl font-bold text-slate-800",children:Q}),l.jsx("span",{className:"text-slate-400 text-sm",children:"/100"}),ae.length>1&&l.jsxs("span",{className:"text-emerald-500 text-xs sm:text-sm ml-2",children:[ae[ae.length-1].score>ae[ae.length-2].score?"+":"",ae[ae.length-1].score-ae[ae.length-2].score,"%"]})]})]}),ae.length>0&&l.jsx(DS,{width:"100%",height:140,children:l.jsxs(Tte,{data:ae,children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"scoreGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),l.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),l.jsx(y_,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),l.jsx(qd,{dataKey:"date",stroke:"#94a3b8",fontSize:10,tickLine:!1,axisLine:!1}),l.jsx(Xd,{stroke:"#94a3b8",fontSize:10,tickLine:!1,axisLine:!1,domain:[50,100],hide:!0}),l.jsx(Es,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"12px"},labelStyle:{color:"#64748b"},formatter:Pe=>[`${Pe}/100`,"Score"]}),l.jsx(Gl,{type:"monotone",dataKey:"score",stroke:"#10b981",strokeWidth:2,fill:"url(#scoreGradient)"})]})})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-8 text-center",children:[l.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx(Xa,{className:"w-8 h-8 text-slate-400"})}),l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"No Health Data Yet"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Upload your first health report to see your personalized health score and track your progress over time."}),l.jsxs(un,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(co,{className:"w-4 h-4"}),"Upload Your First Report"]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 sm:p-6",children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("div",{children:[l.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(Lh,{className:"w-5 h-5 text-emerald-500"}),"Nutrition Tracker"]}),l.jsx("p",{className:"text-slate-500 text-xs sm:text-sm",children:"Daily calorie and macro tracking"})]})}),l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx("input",{type:"date",value:T,onChange:Pe=>w(Pe.target.value),className:"flex-1 px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500"}),l.jsx("button",{onClick:()=>w(new Date().toISOString().split("T")[0]),className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-sm font-medium transition-colors",children:"Today"})]}),M?l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-sm text-slate-600",children:"Calories"}),l.jsxs("span",{className:"text-sm font-semibold text-slate-800",children:[M.totalCalories||0," / ",M.calorieGoal||1800]})]}),l.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:l.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${Math.min((M.totalCalories||0)/(M.calorieGoal||1800)*100,100)}%`,backgroundColor:"#8B7355"}})}),!M.calorieGoal&&l.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[l.jsx(un,{to:"/profile",className:"underline",children:"Set your fitness goal"})," for personalized targets"]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[l.jsxs("div",{className:"bg-blue-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(Vx,{className:"w-3 h-3 text-blue-500"}),l.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Protein"})]}),l.jsxs("p",{className:"text-lg font-bold text-blue-700",children:[(M.totalProtein||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-blue-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${Math.min((M.totalProtein||0)/(M.proteinGoal||80)*100,100)}%`}})})]}),l.jsxs("div",{className:"bg-amber-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(Vx,{className:"w-3 h-3 text-amber-500"}),l.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Carbs"})]}),l.jsxs("p",{className:"text-lg font-bold text-amber-700",children:[(M.totalCarbs||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-amber-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-amber-500 h-1 rounded-full",style:{width:`${Math.min((M.totalCarbs||0)/(M.carbsGoal||200)*100,100)}%`}})})]}),l.jsxs("div",{className:"bg-rose-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(Vx,{className:"w-3 h-3 text-rose-500"}),l.jsx("span",{className:"text-xs text-rose-600 font-medium",children:"Fats"})]}),l.jsxs("p",{className:"text-lg font-bold text-rose-700",children:[(M.totalFats||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-rose-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-rose-500 h-1 rounded-full",style:{width:`${Math.min((M.totalFats||0)/(M.fatsGoal||50)*100,100)}%`}})})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100",children:[l.jsx("span",{className:"text-sm text-slate-600",children:"Meals logged today"}),l.jsx("span",{className:"text-sm font-semibold text-slate-800",children:((Me=M.mealsLogged)!=null&&Me.breakfast?1:0)+((et=M.mealsLogged)!=null&&et.lunch?1:0)+((Re=M.mealsLogged)!=null&&Re.dinner?1:0)+(((nt=M.mealsLogged)==null?void 0:nt.snacks)||0)})]}),l.jsxs(un,{to:"/nutrition",className:"w-full py-2 text-white rounded-xl font-medium hover:shadow-lg flex items-center justify-center gap-2 text-sm transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(Wc,{className:"w-4 h-4"}),"Log Meal"]})]}):l.jsxs("div",{className:"text-center py-6",children:[l.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-3",children:l.jsx(Lh,{className:"w-6 h-6 text-slate-400"})}),l.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"No meals logged for this day"}),l.jsxs(un,{to:"/nutrition",className:"inline-flex items-center gap-2 px-4 py-2 text-white rounded-xl font-medium hover:shadow-lg text-sm transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(Wc,{className:"w-4 h-4"}),"Log Your First Meal"]})]})]})]}),l.jsxs("div",{children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[l.jsx(ir,{className:"w-4 h-4 sm:w-5 sm:h-5 text-cyan-500"}),"Vital Signs & Activity"]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(to,{metricKey:"heartRate",value:he,status:de(he,60,100),subtitle:ue?"From wearable":"Connect device",onInfoClick:E}),l.jsx(to,{metricKey:"sleep",value:be,status:be?de(parseFloat(be),7,9):null,subtitle:we.length>0?`${we.length} nights avg`:"Track sleep",onInfoClick:E}),l.jsx(to,{metricKey:"steps",value:Se.steps>0?Se.steps.toLocaleString():null,unit:"steps",status:Se.steps>=8e3?"normal":Se.steps>=5e3?"low":Se.steps>0?"critical":null,subtitle:ue?`${Se.caloriesBurned} cal`:"Today",onInfoClick:E}),l.jsx(to,{metricKey:"cholesterol",value:ne.cholesterol,status:de(ne.cholesterol,0,200),subtitle:"From blood work",onInfoClick:E})]})]}),l.jsxs("div",{children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[l.jsx(Qw,{className:"w-4 h-4 sm:w-5 sm:h-5 text-amber-500"}),"Vitamins & Minerals"]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(to,{metricKey:"vitaminD",value:ne.vitaminD,status:de(ne.vitaminD,30,100),subtitle:"Bone & immune health",onInfoClick:E}),l.jsx(to,{metricKey:"vitaminB12",value:ne.vitaminB12,status:de(ne.vitaminB12,300,900),subtitle:"Energy & nerves",onInfoClick:E}),l.jsx(to,{metricKey:"iron",value:ne.iron,status:de(ne.iron,60,170),subtitle:"Blood oxygen",onInfoClick:E}),l.jsx(to,{metricKey:"calcium",value:ne.calcium,status:de(ne.calcium,8.5,10.5),subtitle:"Bones & teeth",onInfoClick:E})]})]}),l.jsxs("div",{children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[l.jsx(qw,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-500"}),"Blood & Hormones"]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(to,{metricKey:"hemoglobin",value:ne.hemoglobin,status:de(ne.hemoglobin,12,17),subtitle:"Oxygen carrier",onInfoClick:E}),l.jsx(to,{metricKey:"bloodSugar",value:ne.bloodSugar,status:de(ne.bloodSugar,70,100),subtitle:"Fasting glucose",onInfoClick:E}),l.jsx(to,{metricKey:"thyroid",value:ne.tsh,status:de(ne.tsh,.4,4),subtitle:"Metabolism control",onInfoClick:E}),l.jsx(to,{metricKey:"vitaminC",value:ne.vitaminC,status:de(ne.vitaminC,.6,2),subtitle:"Immune & healing",onInfoClick:E})]})]}),q&&ae.length>1&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(Xa,{className:"w-5 h-5 text-cyan-500"}),"Health Improvement Tracking"]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[l.jsx(ic,{className:"w-4 h-4"}),"Last updated: ",new Date().toLocaleDateString()]})]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Overall Trend"}),l.jsx(nTe,{className:"w-4 h-4 text-green-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-green-500",children:"Improved"}),l.jsx("span",{className:"text-xs text-slate-400",children:"vs last month"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Based on lab values and wearable data"})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Stable Metrics"}),l.jsx(l2,{className:"w-4 h-4 text-blue-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-blue-500",children:"6"}),l.jsx("span",{className:"text-xs text-slate-400",children:"out of 12"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Maintaining healthy ranges"})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Needs Attention"}),l.jsx(Yw,{className:"w-4 h-4 text-yellow-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-yellow-500",children:"2"}),l.jsx("span",{className:"text-xs text-slate-400",children:"metrics"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Vitamin D, Iron levels"})]})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h4",{className:"text-slate-800 font-medium",children:"Lab Values Trend"}),l.jsxs("select",{className:"bg-slate-50 border border-slate-200 rounded-lg px-3 py-1 text-slate-700 text-sm",children:[l.jsx("option",{children:"Vitamin D"}),l.jsx("option",{children:"Iron"}),l.jsx("option",{children:"B12"}),l.jsx("option",{children:"Hemoglobin"})]})]}),l.jsx(DS,{width:"100%",height:200,children:l.jsxs(wte,{data:ae.map((Pe,lt)=>({date:Pe.date,score:Pe.score})),children:[l.jsx(y_,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),l.jsx(qd,{dataKey:"date",stroke:"#94a3b8",fontSize:12}),l.jsx(Xd,{stroke:"#94a3b8",fontSize:12}),l.jsx(Es,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px"},labelStyle:{color:"#64748b"}}),l.jsx(rg,{type:"monotone",dataKey:"score",stroke:"#f59e0b",strokeWidth:2,dot:{fill:"#f59e0b",strokeWidth:2}})]})}),l.jsxs("div",{className:"flex items-center gap-4 mt-4 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),l.jsx("span",{className:"text-slate-600",children:"Health Score Trend"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(jh,{className:"w-4 h-4 text-green-500"}),l.jsx("span",{className:"text-slate-500",children:"Target: 80+ score"})]})]})]}),(B==null?void 0:B.recommendations)&&l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("h4",{className:"text-slate-800 font-medium mb-4 flex items-center gap-2",children:[l.jsx(AJ,{className:"w-5 h-5 text-cyan-500"}),"Personalized Recommendations"]}),l.jsx("div",{className:"space-y-3",children:(ut=B.recommendations.lifestyle)==null?void 0:ut.slice(0,3).map((Pe,lt)=>l.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-lg",children:[l.jsx(ua,{className:"w-5 h-5 text-green-500 mt-0.5 shrink-0"}),l.jsx("div",{children:l.jsx("p",{className:"text-slate-800 font-medium text-sm",children:Pe})})]},lt))})]})]}),l.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[l.jsxs("div",{className:"rounded-2xl p-6",style:{backgroundColor:"#F5F1EA",border:"2px solid #E5DFD3"},children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("div",{className:"px-3 py-1 rounded-full flex items-center gap-2",style:{backgroundColor:"#E5DFD3"},children:[l.jsx(kh,{className:"w-4 h-4 text-cyan-600"}),l.jsx("span",{className:"text-cyan-700 text-sm font-medium",children:"AI ANALYSIS"})]})}),l.jsx("span",{className:"text-slate-500 text-sm",children:B?"Based on your reports":"No reports yet"})]}),l.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-3",children:((Kt=B==null?void 0:B.summary)==null?void 0:Kt.split(".")[0])||"Upload a health report to get AI insights"}),l.jsx("p",{className:"text-slate-600 mb-6",children:B?B.summary:"Our AI will analyze your health reports and provide personalized insights, recommendations, and track your health trends over time."}),l.jsxs("div",{className:"flex flex-wrap gap-3",children:[!q&&l.jsxs(un,{to:"/upload",className:"px-6 py-2 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-2",style:{backgroundColor:"#8B7355"},children:[l.jsx(co,{className:"w-4 h-4"}),"Upload Your First Report"]}),ue&&l.jsx(un,{to:"/wearables",className:"px-6 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50",children:"View Wearable Data"})]})]}),((Rn=B==null?void 0:B.keyFindings)==null?void 0:Rn.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Key Findings from Your Reports"}),l.jsx("div",{className:"space-y-3",children:B.keyFindings.slice(0,4).map((Pe,lt)=>{const Et=typeof Pe=="string"?Pe:Pe.title||Pe.finding||JSON.stringify(Pe),Ae=typeof Pe=="object"?Pe.description:null,wt=typeof Pe=="object"?Pe.severity:"low";return l.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-xl",children:[l.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${wt==="high"?"bg-red-500":wt==="medium"?"bg-amber-500":"bg-emerald-500"}`}),l.jsxs("div",{children:[l.jsx("p",{className:"text-slate-800 font-medium",children:Et}),Ae&&l.jsx("p",{className:"text-slate-500 text-sm mt-1",children:Ae})]})]},lt)})})]})]}),l.jsx("div",{className:"space-y-6",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h3",{className:"font-semibold text-slate-800",children:"Recent Reports"}),l.jsx(un,{to:"/profile",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"View All"})]}),l.jsx("div",{className:"space-y-3",children:(z==null?void 0:z.length)>0?z.slice(0,3).map(Pe=>l.jsxs(un,{to:`/reports/${Pe._id}`,className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center",children:l.jsx(li,{className:"w-5 h-5 text-red-500"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-slate-800 font-medium truncate",children:Pe.reportType}),l.jsx("p",{className:"text-slate-400 text-sm",children:new Date(Pe.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),l.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Pe.status==="completed"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:Pe.status==="completed"?"ANALYZED":"PENDING"})]},Pe._id)):l.jsxs("div",{className:"text-center py-4",children:[l.jsx(li,{className:"w-10 h-10 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"No reports uploaded yet"}),l.jsx(un,{to:"/upload",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"+ Upload Report"})]})})]})})]})]})}function X7e(){var E,T;const{user:e}=fa(),[n,a]=Y.useState(null),[o,d]=Y.useState(!0);if(Y.useEffect(()=>{(async()=>{try{const{data:N}=await qa.getDashboard();a(N)}catch(N){console.error("Failed to fetch dashboard:",N)}finally{d(!1)}})()},[]),o)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading dashboard..."})]})});const{doctor:p,stats:m,todaySchedule:y,upcomingSchedule:b}=n||{};return(p==null?void 0:p.approvalStatus)==="pending"?l.jsx("div",{className:"max-w-lg mx-auto mt-20",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[l.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:l.jsx(ic,{className:"w-8 h-8 text-amber-500"})}),l.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Approval Pending"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Your profile is under review. You'll be notified once approved."}),l.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium",children:[l.jsx(go,{className:"w-4 h-4"})," Pending Review"]})]})}):(p==null?void 0:p.approvalStatus)==="rejected"?l.jsx("div",{className:"max-w-lg mx-auto mt-20",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[l.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:l.jsx(GJ,{className:"w-8 h-8 text-red-500"})}),l.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Application Rejected"}),l.jsx("p",{className:"text-slate-500",children:"Please contact support for more information."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["Welcome, Dr. ",(E=p==null?void 0:p.name)==null?void 0:E.split(" ")[0],"! "]}),l.jsx("p",{className:"text-slate-500 mt-1",children:p==null?void 0:p.specialization})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs(un,{to:"/doctor/availability",className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium transition-all",children:[l.jsx(Gm,{className:"w-4 h-4"})," Manage Slots"]}),p!=null&&p.isListed?l.jsxs("span",{className:"px-3 py-2 bg-green-100 text-green-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[l.jsx(ua,{className:"w-4 h-4"})," Listed"]}):l.jsxs("span",{className:"px-3 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[l.jsx(go,{className:"w-4 h-4"})," Not Listed"]})]})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:l.jsx(ki,{className:"w-5 h-5 text-blue-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(m==null?void 0:m.todayAppointments)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Today"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:l.jsx(Xa,{className:"w-5 h-5 text-green-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(m==null?void 0:m.upcomingAppointments)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Upcoming"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:l.jsx(om,{className:"w-5 h-5 text-purple-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(m==null?void 0:m.totalPatients)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Patients"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:l.jsx(zc,{className:"w-5 h-5 text-amber-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((T=p==null?void 0:p.rating)==null?void 0:T.toFixed(1))||"0.0"}),l.jsx("p",{className:"text-sm text-slate-500",children:"Rating"})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(ir,{className:"w-5 h-5 text-cyan-500"})," Today's Schedule"]})}),(y==null?void 0:y.length)>0?l.jsx("div",{className:"space-y-3",children:y.map(w=>{var N,D,A,k,O;return l.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center text-cyan-600 font-bold",children:((A=(D=(N=w.patient)==null?void 0:N.name)==null?void 0:D[0])==null?void 0:A.toUpperCase())||"P"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-slate-800",children:(k=w.patient)==null?void 0:k.name}),l.jsx("p",{className:"text-sm text-slate-500",children:w.timeSlot})]})]}),l.jsxs(un,{to:`/patient/${(O=w.patient)==null?void 0:O._id}?appointmentId=${w._id}`,className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-xl hover:bg-slate-200 transition-all text-sm flex items-center gap-1",children:[l.jsx(Xw,{className:"w-4 h-4"})," View"]})]},w._id)})}):l.jsxs("div",{className:"text-center py-8 text-slate-500",children:[l.jsx(ki,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),l.jsx("p",{children:"No appointments today"})]})]}),(b==null?void 0:b.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(ic,{className:"w-5 h-5 text-green-500"})," Upcoming Appointments"]}),l.jsx("div",{className:"space-y-3",children:b.slice(0,5).map(w=>{var N,D,A,k;return l.jsx("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center text-green-600 font-bold",children:((A=(D=(N=w.patient)==null?void 0:N.name)==null?void 0:D[0])==null?void 0:A.toUpperCase())||"P"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-slate-800",children:(k=w.patient)==null?void 0:k.name}),l.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(w.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",w.timeSlot]})]})]})},w._id)})})]})]})}function qh(e,n,a,o){function d(p){return p instanceof a?p:new a(function(m){m(p)})}return new(a||(a=Promise))(function(p,m){function y(T){try{E(o.next(T))}catch(w){m(w)}}function b(T){try{E(o.throw(T))}catch(w){m(w)}}function E(T){T.done?p(T.value):d(T.value).then(y,b)}E((o=o.apply(e,n||[])).next())})}const J7e=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Pm(e,n,a){const o=Q7e(e),{webkitRelativePath:d}=e,p=typeof n=="string"?n:typeof d=="string"&&d.length>0?d:`./${e.name}`;return typeof o.path!="string"&&vY(o,"path",p),vY(o,"relativePath",p),o}function Q7e(e){const{name:n}=e;if(n&&n.lastIndexOf(".")!==-1&&!e.type){const o=n.split(".").pop().toLowerCase(),d=J7e.get(o);d&&Object.defineProperty(e,"type",{value:d,writable:!1,configurable:!1,enumerable:!0})}return e}function vY(e,n,a){Object.defineProperty(e,n,{value:a,writable:!1,configurable:!1,enumerable:!0})}const Z7e=[".DS_Store","Thumbs.db"];function eze(e){return qh(this,void 0,void 0,function*(){return bw(e)&&tze(e.dataTransfer)?aze(e.dataTransfer,e.type):nze(e)?rze(e):Array.isArray(e)&&e.every(n=>"getFile"in n&&typeof n.getFile=="function")?ize(e):[]})}function tze(e){return bw(e)}function nze(e){return bw(e)&&bw(e.target)}function bw(e){return typeof e=="object"&&e!==null}function rze(e){return XD(e.target.files).map(n=>Pm(n))}function ize(e){return qh(this,void 0,void 0,function*(){return(yield Promise.all(e.map(a=>a.getFile()))).map(a=>Pm(a))})}function aze(e,n){return qh(this,void 0,void 0,function*(){if(e.items){const a=XD(e.items).filter(d=>d.kind==="file");if(n!=="drop")return a;const o=yield Promise.all(a.map(sze));return yY(Nte(o))}return yY(XD(e.files).map(a=>Pm(a)))})}function yY(e){return e.filter(n=>Z7e.indexOf(n.name)===-1)}function XD(e){if(e===null)return[];const n=[];for(let a=0;a<e.length;a++){const o=e[a];n.push(o)}return n}function sze(e){if(typeof e.webkitGetAsEntry!="function")return _Y(e);const n=e.webkitGetAsEntry();return n&&n.isDirectory?Rte(n):_Y(e,n)}function Nte(e){return e.reduce((n,a)=>[...n,...Array.isArray(a)?Nte(a):[a]],[])}function _Y(e,n){return qh(this,void 0,void 0,function*(){var a;if(globalThis.isSecureContext&&typeof e.getAsFileSystemHandle=="function"){const p=yield e.getAsFileSystemHandle();if(p===null)throw new Error(`${e} is not a File`);if(p!==void 0){const m=yield p.getFile();return m.handle=p,Pm(m)}}const o=e.getAsFile();if(!o)throw new Error(`${e} is not a File`);return Pm(o,(a=n==null?void 0:n.fullPath)!==null&&a!==void 0?a:void 0)})}function oze(e){return qh(this,void 0,void 0,function*(){return e.isDirectory?Rte(e):cze(e)})}function Rte(e){const n=e.createReader();return new Promise((a,o)=>{const d=[];function p(){n.readEntries(m=>qh(this,void 0,void 0,function*(){if(m.length){const y=Promise.all(m.map(oze));d.push(y),p()}else try{const y=yield Promise.all(d);a(y)}catch(y){o(y)}}),m=>{o(m)})}p()})}function cze(e){return qh(this,void 0,void 0,function*(){return new Promise((n,a)=>{e.file(o=>{const d=Pm(o,e.fullPath);n(d)},o=>{a(o)})})})}var u1=function(e,n){if(e&&n){var a=Array.isArray(n)?n:n.split(",");if(a.length===0)return!0;var o=e.name||"",d=(e.type||"").toLowerCase(),p=d.replace(/\/.*$/,"");return a.some(function(m){var y=m.trim().toLowerCase();return y.charAt(0)==="."?o.toLowerCase().endsWith(y):y.endsWith("/*")?p===y.replace(/\/.*$/,""):d===y})}return!0};function bY(e){return uze(e)||dze(e)||Ite(e)||lze()}function lze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function uze(e){if(Array.isArray(e))return JD(e)}function EY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function xY(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?EY(Object(a),!0).forEach(function(o){Ate(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):EY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Ate(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function E_(e,n){return fze(e)||pze(e,n)||Ite(e,n)||hze()}function hze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ite(e,n){if(e){if(typeof e=="string")return JD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return JD(e,n)}}function JD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function pze(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o=[],d=!0,p=!1,m,y;try{for(a=a.call(e);!(d=(m=a.next()).done)&&(o.push(m.value),!(n&&o.length===n));d=!0);}catch(b){p=!0,y=b}finally{try{!d&&a.return!=null&&a.return()}finally{if(p)throw y}}return o}}function fze(e){if(Array.isArray(e))return e}var mze=typeof u1=="function"?u1:u1.default,gze="file-invalid-type",vze="file-too-large",yze="file-too-small",_ze="too-many-files",bze=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=n.split(","),o=a.length>1?"one of ".concat(a.join(", ")):a[0];return{code:gze,message:"File type must be ".concat(o)}},SY=function(n){return{code:vze,message:"File is larger than ".concat(n," ").concat(n===1?"byte":"bytes")}},wY=function(n){return{code:yze,message:"File is smaller than ".concat(n," ").concat(n===1?"byte":"bytes")}},Eze={code:_ze,message:"Too many files"};function Ote(e,n){var a=e.type==="application/x-moz-file"||mze(e,n);return[a,a?null:bze(n)]}function Pte(e,n,a){if(uh(e.size))if(uh(n)&&uh(a)){if(e.size>a)return[!1,SY(a)];if(e.size<n)return[!1,wY(n)]}else{if(uh(n)&&e.size<n)return[!1,wY(n)];if(uh(a)&&e.size>a)return[!1,SY(a)]}return[!0,null]}function uh(e){return e!=null}function xze(e){var n=e.files,a=e.accept,o=e.minSize,d=e.maxSize,p=e.multiple,m=e.maxFiles,y=e.validator;return!p&&n.length>1||p&&m>=1&&n.length>m?!1:n.every(function(b){var E=Ote(b,a),T=E_(E,1),w=T[0],N=Pte(b,o,d),D=E_(N,1),A=D[0],k=y?y(b):null;return w&&A&&!k})}function Ew(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function Ex(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(n){return n==="Files"||n==="application/x-moz-file"}):!!e.target&&!!e.target.files}function TY(e){e.preventDefault()}function Sze(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function wze(e){return e.indexOf("Edge/")!==-1}function Tze(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Sze(e)||wze(e)}function kc(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return function(o){for(var d=arguments.length,p=new Array(d>1?d-1:0),m=1;m<d;m++)p[m-1]=arguments[m];return n.some(function(y){return!Ew(o)&&y&&y.apply(void 0,[o].concat(p)),Ew(o)})}}function Cze(){return"showOpenFilePicker"in window}function Nze(e){if(uh(e)){var n=Object.entries(e).filter(function(a){var o=E_(a,2),d=o[0],p=o[1],m=!0;return Dte(d)||(console.warn('Skipped "'.concat(d,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),m=!1),(!Array.isArray(p)||!p.every(kte))&&(console.warn('Skipped "'.concat(d,'" because an invalid file extension was provided.')),m=!1),m}).reduce(function(a,o){var d=E_(o,2),p=d[0],m=d[1];return xY(xY({},a),{},Ate({},p,m))},{});return[{description:"Files",accept:n}]}return e}function Rze(e){if(uh(e))return Object.entries(e).reduce(function(n,a){var o=E_(a,2),d=o[0],p=o[1];return[].concat(bY(n),[d],bY(p))},[]).filter(function(n){return Dte(n)||kte(n)}).join(",")}function Aze(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function Ize(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function Dte(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||e==="application/*"||/\w+\/[-+.\w]+/g.test(e)}function kte(e){return/^.*\.[\w]+$/.test(e)}var Oze=["children"],Pze=["open"],Dze=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],kze=["refKey","onChange","onClick"];function jze(e){return Uze(e)||Mze(e)||jte(e)||Lze()}function Lze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Uze(e){if(Array.isArray(e))return QD(e)}function h1(e,n){return Bze(e)||Vze(e,n)||jte(e,n)||Fze()}function Fze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jte(e,n){if(e){if(typeof e=="string")return QD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return QD(e,n)}}function QD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function Vze(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o=[],d=!0,p=!1,m,y;try{for(a=a.call(e);!(d=(m=a.next()).done)&&(o.push(m.value),!(n&&o.length===n));d=!0);}catch(b){p=!0,y=b}finally{try{!d&&a.return!=null&&a.return()}finally{if(p)throw y}}return o}}function Bze(e){if(Array.isArray(e))return e}function CY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Vr(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?CY(Object(a),!0).forEach(function(o){ZD(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):CY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function ZD(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function xw(e,n){if(e==null)return{};var a=Gze(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function Gze(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,p;for(p=0;p<o.length;p++)d=o[p],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}var yj=Y.forwardRef(function(e,n){var a=e.children,o=xw(e,Oze),d=Mte(o),p=d.open,m=xw(d,Pze);return Y.useImperativeHandle(n,function(){return{open:p}},[p]),me.createElement(Y.Fragment,null,a(Vr(Vr({},m),{},{open:p})))});yj.displayName="Dropzone";var Lte={disabled:!1,getFilesFromEvent:eze,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};yj.defaultProps=Lte;yj.propTypes={children:jt.func,accept:jt.objectOf(jt.arrayOf(jt.string)),multiple:jt.bool,preventDropOnDocument:jt.bool,noClick:jt.bool,noKeyboard:jt.bool,noDrag:jt.bool,noDragEventsBubbling:jt.bool,minSize:jt.number,maxSize:jt.number,maxFiles:jt.number,disabled:jt.bool,getFilesFromEvent:jt.func,onFileDialogCancel:jt.func,onFileDialogOpen:jt.func,useFsAccessApi:jt.bool,autoFocus:jt.bool,onDragEnter:jt.func,onDragLeave:jt.func,onDragOver:jt.func,onDrop:jt.func,onDropAccepted:jt.func,onDropRejected:jt.func,onError:jt.func,validator:jt.func};var ek={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Mte(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Vr(Vr({},Lte),e),a=n.accept,o=n.disabled,d=n.getFilesFromEvent,p=n.maxSize,m=n.minSize,y=n.multiple,b=n.maxFiles,E=n.onDragEnter,T=n.onDragLeave,w=n.onDragOver,N=n.onDrop,D=n.onDropAccepted,A=n.onDropRejected,k=n.onFileDialogCancel,O=n.onFileDialogOpen,F=n.useFsAccessApi,M=n.autoFocus,V=n.preventDropOnDocument,H=n.noClick,B=n.noKeyboard,z=n.noDrag,q=n.noDragEventsBubbling,Q=n.onError,ee=n.validator,oe=Y.useMemo(function(){return Rze(a)},[a]),ne=Y.useMemo(function(){return Nze(a)},[a]),ue=Y.useMemo(function(){return typeof O=="function"?O:NY},[O]),Se=Y.useMemo(function(){return typeof k=="function"?k:NY},[k]),fe=Y.useRef(null),we=Y.useRef(null),he=Y.useReducer(Wze,ek),be=h1(he,2),ae=be[0],de=be[1],xe=ae.isFocused,Ue=ae.isFileDialogActive,Me=Y.useRef(typeof window<"u"&&window.isSecureContext&&F&&Cze()),et=function(){!Me.current&&Ue&&setTimeout(function(){if(we.current){var Lt=we.current.files;Lt.length||(de({type:"closeDialog"}),Se())}},300)};Y.useEffect(function(){return window.addEventListener("focus",et,!1),function(){window.removeEventListener("focus",et,!1)}},[we,Ue,Se,Me]);var Re=Y.useRef([]),nt=function(Lt){fe.current&&fe.current.contains(Lt.target)||(Lt.preventDefault(),Re.current=[])};Y.useEffect(function(){return V&&(document.addEventListener("dragover",TY,!1),document.addEventListener("drop",nt,!1)),function(){V&&(document.removeEventListener("dragover",TY),document.removeEventListener("drop",nt))}},[fe,V]),Y.useEffect(function(){return!o&&M&&fe.current&&fe.current.focus(),function(){}},[fe,M,o]);var ut=Y.useCallback(function(tt){Q?Q(tt):console.error(tt)},[Q]),Kt=Y.useCallback(function(tt){tt.preventDefault(),tt.persist(),ui(tt),Re.current=[].concat(jze(Re.current),[tt.target]),Ex(tt)&&Promise.resolve(d(tt)).then(function(Lt){if(!(Ew(tt)&&!q)){var mr=Lt.length,Wn=mr>0&&xze({files:Lt,accept:oe,minSize:m,maxSize:p,multiple:y,maxFiles:b,validator:ee}),Ke=mr>0&&!Wn;de({isDragAccept:Wn,isDragReject:Ke,isDragActive:!0,type:"setDraggedFiles"}),E&&E(tt)}}).catch(function(Lt){return ut(Lt)})},[d,E,ut,q,oe,m,p,y,b,ee]),Rn=Y.useCallback(function(tt){tt.preventDefault(),tt.persist(),ui(tt);var Lt=Ex(tt);if(Lt&&tt.dataTransfer)try{tt.dataTransfer.dropEffect="copy"}catch{}return Lt&&w&&w(tt),!1},[w,q]),Pe=Y.useCallback(function(tt){tt.preventDefault(),tt.persist(),ui(tt);var Lt=Re.current.filter(function(Wn){return fe.current&&fe.current.contains(Wn)}),mr=Lt.indexOf(tt.target);mr!==-1&&Lt.splice(mr,1),Re.current=Lt,!(Lt.length>0)&&(de({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Ex(tt)&&T&&T(tt))},[fe,T,q]),lt=Y.useCallback(function(tt,Lt){var mr=[],Wn=[];tt.forEach(function(Ke){var xt=Ote(Ke,oe),Dn=h1(xt,2),ni=Dn[0],Pa=Dn[1],Ji=Pte(Ke,m,p),gr=h1(Ji,2),Xr=gr[0],ou=gr[1],cu=ee?ee(Ke):null;if(ni&&Xr&&!cu)mr.push(Ke);else{var cc=[Pa,ou];cu&&(cc=cc.concat(cu)),Wn.push({file:Ke,errors:cc.filter(function(G_){return G_})})}}),(!y&&mr.length>1||y&&b>=1&&mr.length>b)&&(mr.forEach(function(Ke){Wn.push({file:Ke,errors:[Eze]})}),mr.splice(0)),de({acceptedFiles:mr,fileRejections:Wn,isDragReject:Wn.length>0,type:"setFiles"}),N&&N(mr,Wn,Lt),Wn.length>0&&A&&A(Wn,Lt),mr.length>0&&D&&D(mr,Lt)},[de,y,oe,m,p,b,N,D,A,ee]),Et=Y.useCallback(function(tt){tt.preventDefault(),tt.persist(),ui(tt),Re.current=[],Ex(tt)&&Promise.resolve(d(tt)).then(function(Lt){Ew(tt)&&!q||lt(Lt,tt)}).catch(function(Lt){return ut(Lt)}),de({type:"reset"})},[d,lt,ut,q]),Ae=Y.useCallback(function(){if(Me.current){de({type:"openDialog"}),ue();var tt={multiple:y,types:ne};window.showOpenFilePicker(tt).then(function(Lt){return d(Lt)}).then(function(Lt){lt(Lt,null),de({type:"closeDialog"})}).catch(function(Lt){Aze(Lt)?(Se(Lt),de({type:"closeDialog"})):Ize(Lt)?(Me.current=!1,we.current?(we.current.value=null,we.current.click()):ut(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):ut(Lt)});return}we.current&&(de({type:"openDialog"}),ue(),we.current.value=null,we.current.click())},[de,ue,Se,F,lt,ut,ne,y]),wt=Y.useCallback(function(tt){!fe.current||!fe.current.isEqualNode(tt.target)||(tt.key===" "||tt.key==="Enter"||tt.keyCode===32||tt.keyCode===13)&&(tt.preventDefault(),Ae())},[fe,Ae]),Xe=Y.useCallback(function(){de({type:"focus"})},[]),$t=Y.useCallback(function(){de({type:"blur"})},[]),At=Y.useCallback(function(){H||(Tze()?setTimeout(Ae,0):Ae())},[H,Ae]),ye=function(Lt){return o?null:Lt},Qe=function(Lt){return B?null:ye(Lt)},Wt=function(Lt){return z?null:ye(Lt)},ui=function(Lt){q&&Lt.stopPropagation()},ma=Y.useMemo(function(){return function(){var tt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Lt=tt.refKey,mr=Lt===void 0?"ref":Lt,Wn=tt.role,Ke=tt.onKeyDown,xt=tt.onFocus,Dn=tt.onBlur,ni=tt.onClick,Pa=tt.onDragEnter,Ji=tt.onDragOver,gr=tt.onDragLeave,Xr=tt.onDrop,ou=xw(tt,Dze);return Vr(Vr(ZD({onKeyDown:Qe(kc(Ke,wt)),onFocus:Qe(kc(xt,Xe)),onBlur:Qe(kc(Dn,$t)),onClick:ye(kc(ni,At)),onDragEnter:Wt(kc(Pa,Kt)),onDragOver:Wt(kc(Ji,Rn)),onDragLeave:Wt(kc(gr,Pe)),onDrop:Wt(kc(Xr,Et)),role:typeof Wn=="string"&&Wn!==""?Wn:"presentation"},mr,fe),!o&&!B?{tabIndex:0}:{}),ou)}},[fe,wt,Xe,$t,At,Kt,Rn,Pe,Et,B,z,o]),Oa=Y.useCallback(function(tt){tt.stopPropagation()},[]),oc=Y.useMemo(function(){return function(){var tt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Lt=tt.refKey,mr=Lt===void 0?"ref":Lt,Wn=tt.onChange,Ke=tt.onClick,xt=xw(tt,kze),Dn=ZD({accept:oe,multiple:y,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:ye(kc(Wn,Et)),onClick:ye(kc(Ke,Oa)),tabIndex:-1},mr,we);return Vr(Vr({},Dn),xt)}},[we,a,y,Et,o]);return Vr(Vr({},ae),{},{isFocused:xe&&!o,getRootProps:ma,getInputProps:oc,rootRef:fe,inputRef:we,open:ye(Ae)})}function Wze(e,n){switch(n.type){case"focus":return Vr(Vr({},e),{},{isFocused:!0});case"blur":return Vr(Vr({},e),{},{isFocused:!1});case"openDialog":return Vr(Vr({},ek),{},{isFileDialogActive:!0});case"closeDialog":return Vr(Vr({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return Vr(Vr({},e),{},{isDragActive:n.isDragActive,isDragAccept:n.isDragAccept,isDragReject:n.isDragReject});case"setFiles":return Vr(Vr({},e),{},{acceptedFiles:n.acceptedFiles,fileRejections:n.fileRejections,isDragReject:n.isDragReject});case"reset":return Vr({},ek);default:return e}}function NY(){}const $ze=[{value:"Blood Test",label:"Blood Test"},{value:"X-Ray",label:"X-Ray"},{value:"MRI",label:"MRI"},{value:"CT Scan",label:"CT Scan"},{value:"ECG",label:"ECG"},{value:"Ultrasound",label:"Ultrasound"},{value:"General Checkup",label:"General Checkup"},{value:"Other",label:"Other"}];function Hze(){const[e,n]=Y.useState([]),[a,o]=Y.useState(!1),[d,p]=Y.useState(0),m=As(),y=Y.useCallback(F=>{const M=F.map(V=>({file:V,id:Math.random().toString(36).substr(2,9),reportType:"Blood Test",name:V.name,size:V.size}));n(V=>[...V,...M])},[]),{getRootProps:b,getInputProps:E,isDragActive:T}=Mte({onDrop:y,accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]},maxSize:10*1024*1024}),w=(F,M)=>{n(V=>V.map(H=>H.id===F?{...H,reportType:M}:H))},N=F=>{n(M=>M.filter(V=>V.id!==F))},D=async F=>{var V,H;if(F.preventDefault(),e.length===0){it.error("Please select at least one file");return}o(!0),p(0);const M=setInterval(()=>{p(B=>B>=90?(clearInterval(M),90):B+10)},500);try{const B=new FormData;B.append("report",e[0].file),B.append("reportType",e[0].reportType);const{data:z}=await Th.uploadReport(B);clearInterval(M),p(100),it.success("Report analyzed successfully!"),setTimeout(()=>m(`/reports/${z.report._id}`),500)}catch(B){clearInterval(M),it.error(((H=(V=B.response)==null?void 0:V.data)==null?void 0:H.message)||"Failed to analyze report"),p(0)}finally{o(!1)}},k=(e.reduce((F,M)=>F+M.size,0)/(1024*1024)).toFixed(1),O=100;return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Upload Medical Reports"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Upload your medical documents for AI-powered analysis"})]}),l.jsx("div",{className:"relative rounded-2xl overflow-hidden shadow-lg bg-gradient-to-r from-cyan-500 to-blue-500 p-6 sm:p-8",children:l.jsxs("div",{className:"text-white max-w-2xl",children:[l.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",children:"How It Works"}),l.jsx("p",{className:"text-white/90 text-sm",children:"Upload your medical reports and get instant AI-powered analysis with personalized health insights"})]})}),l.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[l.jsxs("div",{...b(),className:`relative border-2 border-dashed rounded-2xl p-12 text-center cursor-pointer transition-all ${T?"border-cyan-500 bg-cyan-50":"border-slate-300 hover:border-cyan-400 bg-white"}`,children:[l.jsx("input",{...E()}),l.jsx("div",{className:"w-16 h-16 rounded-2xl bg-cyan-100 flex items-center justify-center mx-auto mb-4",children:l.jsx(co,{className:"w-8 h-8 text-cyan-600"})}),l.jsx("p",{className:"text-lg font-semibold text-slate-800 mb-2",children:T?"Drop your files here":"Drag & drop files here"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"or click to browse from your device"}),l.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-slate-600",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(ua,{className:"w-4 h-4 text-emerald-500"})," PDF"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(ua,{className:"w-4 h-4 text-emerald-500"})," PNG"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(ua,{className:"w-4 h-4 text-emerald-500"})," JPG"]}),l.jsx("span",{children:"Max 10MB per file"})]})]}),e.length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm",children:[l.jsx("div",{className:"p-4 border-b border-slate-200",children:l.jsxs("h3",{className:"font-semibold text-slate-800",children:["Uploaded Files (",e.length,")"]})}),l.jsx("div",{className:"divide-y divide-slate-200",children:e.map(F=>l.jsxs("div",{className:"p-4 flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center",children:l.jsx(li,{className:"w-5 h-5 text-cyan-600"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"font-medium text-slate-800 truncate",children:F.name}),l.jsxs("p",{className:"text-sm text-slate-500",children:[(F.size/1024/1024).toFixed(2)," MB"]})]}),l.jsxs("div",{className:"relative",children:[l.jsx("select",{value:F.reportType,onChange:M=>w(F.id,M.target.value),className:"appearance-none bg-white text-slate-800 text-sm px-4 py-2 pr-8 rounded-xl border border-slate-300 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none cursor-pointer",children:$ze.map(M=>l.jsx("option",{value:M.value,children:M.label},M.value))}),l.jsx(o2,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]}),l.jsx("button",{onClick:()=>N(F.id),className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",children:l.jsx(SP,{className:"w-5 h-5"})})]},F.id))})]}),a&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center",children:l.jsx(E7,{className:"w-5 h-5 text-cyan-600 animate-spin"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800",children:"Analyzing your report..."}),l.jsx("p",{className:"text-sm text-slate-500",children:"AI is extracting health insights"})]})]}),l.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full transition-all duration-500",style:{width:`${d}%`}})}),l.jsxs("p",{className:"text-sm text-slate-500 mt-2 text-right",children:[d,"%"]})]}),l.jsx("button",{onClick:D,disabled:a||e.length===0,className:"w-full py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:a?l.jsxs(l.Fragment,{children:[l.jsx(E7,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):l.jsxs(l.Fragment,{children:[l.jsx(co,{className:"w-5 h-5"}),"Upload & Analyze"]})})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center",children:l.jsx(uTe,{className:"w-5 h-5 text-blue-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800",children:"Storage"}),l.jsxs("p",{className:"text-sm text-slate-500",children:[k," MB of ",O," MB"]})]})]}),l.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full",style:{width:`${parseFloat(k)/O*100}%`}})})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("h3",{className:"font-semibold text-slate-800 mb-4",children:"Recent Uploads"}),l.jsx("div",{className:"space-y-3",children:e.length===0?l.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No files uploaded yet"}):e.slice(0,3).map(F=>l.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[l.jsx(li,{className:"w-5 h-5 text-cyan-600"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm text-slate-800 truncate",children:F.name}),l.jsx("p",{className:"text-xs text-slate-500",children:F.reportType})]})]},F.id))})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx(vS,{className:"w-5 h-5 text-emerald-500"}),l.jsx("span",{className:"font-semibold text-slate-800",children:"Secure Upload"})]}),l.jsx("p",{className:"text-sm text-slate-600",children:"Your files are encrypted end-to-end and stored securely. We comply with HIPAA regulations."})]})]})]}),l.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-slate-500 pt-4",children:[l.jsx(vS,{className:"w-4 h-4"}),l.jsx("span",{children:"End-to-end Encrypted & HIPAA Compliant"})]})]})}function zze(){var oe,ne,ue,Se,fe,we,he,be,ae;const{id:e}=Vw(),[n,a]=Y.useState(null),[o,d]=Y.useState([]),[p,m]=Y.useState(!0),[y,b]=Y.useState(null),[E,T]=Y.useState(!1),[w,N]=Y.useState(!1),[D,A]=Y.useState(!1),[k,O]=Y.useState([]),[F,M]=Y.useState(""),[V,H]=Y.useState(!1),B=Y.useRef(null);Y.useEffect(()=>{(async()=>{try{const{data:xe}=await Th.getReport(e);a(xe.report),d(xe.recommendedDoctors||[])}catch{it.error("Failed to load report")}finally{m(!1)}})()},[e]),Y.useEffect(()=>{var de;(de=B.current)==null||de.scrollIntoView({behavior:"smooth"})},[k]);const z=async()=>{var de,xe;if(y){N(!w);return}T(!0);try{const{data:Ue}=await Th.compareReport(e);b(Ue),N(!0)}catch(Ue){it.error(((xe=(de=Ue.response)==null?void 0:de.data)==null?void 0:xe.message)||"No previous report found")}finally{T(!1)}},q=async de=>{if(de.preventDefault(),!F.trim()||V)return;const xe=F.trim();M(""),O(Ue=>[...Ue,{role:"user",content:xe}]),H(!0);try{const{data:Ue}=await Th.chatAboutReport(e,xe,k);O(Me=>[...Me,{role:"assistant",content:Ue.response}])}catch{it.error("Failed to get response"),O(Me=>Me.slice(0,-1))}finally{H(!1)}};if(p)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:"Loading report..."})]})});if(!n)return l.jsx("div",{className:"text-center py-12 text-slate-400",children:"Report not found"});const{aiAnalysis:Q}=n,ee=(Q==null?void 0:Q.healthScore)||0;return l.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in",children:[l.jsxs(un,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[l.jsx(oo,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-6",children:[l.jsxs("div",{className:"flex items-center gap-5",children:[l.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:l.jsx(li,{className:"w-8 h-8"})}),l.jsxs("div",{children:[l.jsxs("h1",{className:"text-2xl font-bold",children:[n.reportType," Report"]}),l.jsxs("p",{className:"text-white/70",children:["Analyzed on ",new Date(n.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]}),l.jsxs("div",{className:"text-center p-4 bg-white/10 backdrop-blur-sm rounded-xl",children:[l.jsx("p",{className:"text-4xl font-bold",children:ee}),l.jsx("p",{className:"text-sm text-white/70",children:"Health Score"})]})]}),l.jsx("div",{className:"relative flex gap-3 mt-6 pt-6 border-t border-white/20",children:l.jsxs("button",{onClick:z,disabled:E,className:"flex items-center gap-2 px-4 py-2.5 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 transition-all font-medium",children:[l.jsx(mS,{className:"w-4 h-4"}),E?"Loading...":w?"Hide Comparison":"Compare with Previous"]})})]}),w&&y&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-blue-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[l.jsx(mS,{className:"w-5 h-5 text-blue-500"})," Health Comparison"]}),l.jsx("span",{className:`px-3 py-1 rounded-lg text-sm font-medium ${y.comparison.overallTrend==="improved"?"bg-emerald-100 text-emerald-700":y.comparison.overallTrend==="declined"?"bg-red-100 text-red-700":"bg-slate-100 text-slate-700"}`,children:y.comparison.overallTrend==="improved"?" Improved":y.comparison.overallTrend==="declined"?" Declined":" Stable"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[l.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border-2 border-slate-200",children:[l.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Previous Report"}),l.jsx("p",{className:"font-medium text-slate-800",children:new Date(y.previousReport.createdAt).toLocaleDateString()}),l.jsxs("p",{className:"text-2xl font-bold text-slate-600",children:[y.previousReport.healthScore,"/100"]})]}),l.jsxs("div",{className:"bg-cyan-50 p-4 rounded-xl border-2 border-cyan-200",children:[l.jsx("p",{className:"text-sm text-cyan-700 mb-1",children:"Current Report"}),l.jsx("p",{className:"font-medium text-slate-800",children:new Date(y.currentReport.createdAt).toLocaleDateString()}),l.jsxs("p",{className:"text-2xl font-bold text-cyan-600",children:[y.currentReport.healthScore,"/100"]})]})]}),l.jsx("p",{className:"text-slate-700",children:y.comparison.summary})]}),D&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-violet-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[l.jsx(kh,{className:"w-5 h-5 text-violet-500"})," Ask About Your Report"]}),l.jsx("button",{onClick:()=>A(!1),className:"p-2 text-slate-400 hover:text-slate-800 rounded-lg",children:l.jsx(ha,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"h-64 overflow-y-auto mb-4 space-y-3 p-4 bg-slate-50 rounded-xl border border-slate-200",children:[k.length===0&&l.jsxs("p",{className:"text-slate-500 text-center py-8",children:["Ask any questions about your health report.",l.jsx("br",{}),'"What does my hemoglobin level mean?"']}),k.map((de,xe)=>l.jsx("div",{className:`flex ${de.role==="user"?"justify-end":"justify-start"}`,children:l.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${de.role==="user"?"bg-violet-500 text-white":"bg-white border border-slate-200 text-slate-800"}`,children:de.content})},xe)),V&&l.jsx("div",{className:"flex justify-start",children:l.jsx("div",{className:"bg-white border border-slate-200 p-3 rounded-xl",children:l.jsx("span",{className:"animate-pulse text-slate-600",children:"Thinking..."})})}),l.jsx("div",{ref:B})]}),l.jsxs("form",{onSubmit:q,className:"flex gap-2",children:[l.jsx("input",{type:"text",value:F,onChange:de=>M(de.target.value),placeholder:"Ask a question...",className:"flex-1 bg-white border-2 border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-violet-400 focus:outline-none",disabled:V}),l.jsx("button",{type:"submit",disabled:V||!F.trim(),className:"px-4 py-3 bg-violet-500 text-white rounded-xl hover:bg-violet-600 transition-all disabled:opacity-50",children:l.jsx(Bm,{className:"w-5 h-5"})})]})]}),(Q==null?void 0:Q.summary)&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-3 flex items-center gap-2",children:[l.jsx(ir,{className:"w-5 h-5 text-cyan-500"})," Summary"]}),l.jsx("p",{className:"text-slate-700 leading-relaxed",children:Q.summary})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[((oe=Q==null?void 0:Q.keyFindings)==null?void 0:oe.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(Pi,{className:"w-5 h-5 text-blue-500"})," Key Findings"]}),l.jsx("ul",{className:"space-y-2",children:Q.keyFindings.map((de,xe)=>l.jsxs("li",{className:"flex items-start gap-3 text-sm text-slate-700",children:[l.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),de]},xe))})]}),((ne=Q==null?void 0:Q.riskFactors)==null?void 0:ne.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-amber-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(Yw,{className:"w-5 h-5 text-amber-500"})," Risk Factors"]}),l.jsx("ul",{className:"space-y-2",children:Q.riskFactors.map((de,xe)=>l.jsxs("li",{className:"flex items-start gap-3 text-sm text-slate-700",children:[l.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full mt-2 flex-shrink-0"}),de]},xe))})]})]}),(Q==null?void 0:Q.metrics)&&Object.keys(Q.metrics).length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsx("h2",{className:"text-lg font-bold text-slate-800 mb-6",children:"Health Metrics"}),l.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(Q.metrics).map(([de,xe])=>l.jsxs("div",{className:`p-4 rounded-xl border-2 ${xe.status==="normal"?"bg-emerald-50 border-emerald-200":xe.status==="borderline"?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200"}`,children:[l.jsx("p",{className:"text-sm text-slate-600 capitalize mb-1 font-medium",children:de.replace(/([A-Z])/g," $1")}),l.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[xe.value," ",l.jsx("span",{className:"text-sm font-normal text-slate-500",children:xe.unit})]}),l.jsxs("div",{className:"flex items-center justify-between mt-2",children:[l.jsxs("span",{className:"text-xs text-slate-600",children:["Normal: ",xe.normalRange]}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${xe.status==="normal"?"bg-emerald-100 text-emerald-700":xe.status==="borderline"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:xe.status})]})]},de))})]}),((ue=Q==null?void 0:Q.deficiencies)==null?void 0:ue.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-amber-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(qw,{className:"w-5 h-5 text-amber-500"})," Detected Deficiencies"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Q.deficiencies.map((de,xe)=>{var Ue;return l.jsxs("div",{className:`p-4 rounded-xl border-2 ${de.severity==="severe"?"bg-red-50 border-red-200":de.severity==="moderate"?"bg-amber-50 border-amber-200":"bg-yellow-50 border-yellow-200"}`,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"font-bold text-slate-800",children:de.name}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${de.severity==="severe"?"bg-red-100 text-red-700":de.severity==="moderate"?"bg-amber-100 text-amber-700":"bg-yellow-100 text-yellow-700"}`,children:de.severity})]}),l.jsxs("p",{className:"text-sm text-slate-700 font-medium",children:["Current: ",de.currentValue]}),l.jsxs("p",{className:"text-sm text-slate-600",children:["Normal: ",de.normalRange]}),((Ue=de.symptoms)==null?void 0:Ue.length)>0&&l.jsxs("p",{className:"text-xs text-slate-600 mt-2",children:["Symptoms: ",de.symptoms.join(", ")]})]},xe)})})]}),((Se=Q==null?void 0:Q.supplements)==null?void 0:Se.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-2 flex items-center gap-2",children:[l.jsx(nc,{className:"w-5 h-5 text-green-600"})," Natural Supplement Recommendations"]}),l.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Natural Indian foods and remedies to address your deficiencies"}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Q.supplements.map((de,xe)=>l.jsxs("div",{className:"p-4 bg-green-50 rounded-xl border-2 border-green-200",children:[l.jsx("p",{className:"font-bold text-green-700",children:de.category}),l.jsx("p",{className:"text-sm text-green-600 mt-1",children:de.reason}),l.jsx("p",{className:"text-xs text-green-700 mt-2 font-medium",children:de.naturalSources||de.generalDosage}),de.note&&l.jsx("p",{className:"text-xs text-green-600 mt-1 italic",children:de.note})]},xe))})]}),(Q==null?void 0:Q.dietPlan)&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-2 flex items-center gap-2",children:[l.jsx(nc,{className:"w-5 h-5 text-emerald-500"})," Personalized Diet Plan"]}),Q.dietPlan.overview&&l.jsx("p",{className:"text-slate-700 mb-6",children:Q.dietPlan.overview}),l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[{key:"breakfast",label:"Breakfast",icon:"",color:"emerald",bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-700"},{key:"lunch",label:"Lunch",icon:"",color:"blue",bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-700"},{key:"dinner",label:"Dinner",icon:"",color:"violet",bg:"bg-violet-50",border:"border-violet-200",text:"text-violet-700"},{key:"snacks",label:"Snacks",icon:"",color:"amber",bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-700"}].map(({key:de,label:xe,icon:Ue,bg:Me,border:et,text:Re})=>{var nt;return((nt=Q.dietPlan[de])==null?void 0:nt.length)>0&&l.jsxs("div",{className:`p-4 rounded-xl ${Me} border-2 ${et}`,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx("span",{className:"text-xl",children:Ue}),l.jsx("span",{className:`font-bold ${Re}`,children:xe})]}),Q.dietPlan[de].map((ut,Kt)=>l.jsxs("div",{className:"mb-2",children:[l.jsx("p",{className:`text-sm ${Re} font-medium`,children:ut.meal}),ut.tip&&l.jsx("p",{className:"text-xs text-slate-600 italic",children:ut.tip})]},Kt))]},de)})}),(((fe=Q.dietPlan.foodsToIncrease)==null?void 0:fe.length)>0||((we=Q.dietPlan.foodsToLimit)==null?void 0:we.length)>0)&&l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[((he=Q.dietPlan.foodsToIncrease)==null?void 0:he.length)>0&&l.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[l.jsx("h3",{className:"font-bold text-emerald-700 mb-3",children:" Foods to Increase"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:Q.dietPlan.foodsToIncrease.map((de,xe)=>l.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full font-medium",children:de},xe))})]}),((be=Q.dietPlan.foodsToLimit)==null?void 0:be.length)>0&&l.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border-2 border-red-200",children:[l.jsx("h3",{className:"font-bold text-red-700 mb-3",children:" Foods to Limit"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:Q.dietPlan.foodsToLimit.map((de,xe)=>l.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-3 py-1 rounded-full font-medium",children:de},xe))})]})]}),((ae=Q.dietPlan.tips)==null?void 0:ae.length)>0&&l.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-xl",children:[l.jsxs("h3",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[l.jsx(kh,{className:"w-4 h-4 text-amber-500"})," Diet Tips"]}),l.jsx("ul",{className:"space-y-2",children:Q.dietPlan.tips.map((de,xe)=>l.jsxs("li",{className:"text-sm text-slate-700 flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full mt-2"}),de]},xe))})]})]}),l.jsx("div",{className:"p-4 bg-blue-50 rounded-xl border-2 border-blue-200",children:l.jsxs("p",{className:"text-sm text-blue-700",children:[l.jsx("strong",{children:"Disclaimer:"})," This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider for medical decisions."]})})]})}const Kze=["All","General Physician","Nutritionist","Cardiologist","Dermatologist","Endocrinologist","Neurologist"];function Yze(){var ue,Se,fe,we;const e=As(),[n,a]=Y.useState([]),[o,d]=Y.useState([]),[p,m]=Y.useState(!0),[y,b]=Y.useState("All"),[E,T]=Y.useState(""),[w,N]=Y.useState(null),[D,A]=Y.useState({date:"",timeSlot:"",symptoms:""}),[k,O]=Y.useState(!1),[F,M]=Y.useState("doctors"),[V,H]=Y.useState([]),[B,z]=Y.useState(!1);Y.useEffect(()=>{q()},[y]);const q=async()=>{try{const he={};y!=="All"&&(he.specialization=y);const[be,ae]=await Promise.all([qa.getAll(he),qa.getAppointments()]);a(be.data),d(ae.data)}catch(he){console.error("Failed to fetch data:",he)}finally{m(!1)}};Y.useEffect(()=>{w&&D.date&&Q()},[w,D.date]);const Q=async()=>{var he;if(!(!w||!D.date)){z(!0);try{const{data:be}=await qa.getDoctorAvailableSlots(w._id);console.log("Slots response:",be);const ae=new Date(D.date).toDateString();console.log("Looking for dateKey:",ae),console.log("Available keys:",Object.keys(be.slotsByDate||{})),H(((he=be.slotsByDate)==null?void 0:he[ae])||[])}catch(be){console.error("Failed to fetch slots:",be),H([])}finally{z(!1)}}},ee=n.filter(he=>{var be,ae,de;return((ae=he.name||((be=he.user)==null?void 0:be.name))==null?void 0:ae.toLowerCase().includes(E.toLowerCase()))||((de=he.specialization)==null?void 0:de.toLowerCase().includes(E.toLowerCase()))}),oe=async he=>{var be,ae;if(he.preventDefault(),!D.date||!D.timeSlot){it.error("Please select date and time");return}O(!0);try{await qa.bookAppointment({doctorId:w._id,...D,type:"video"}),it.success("Appointment booked successfully!"),N(null),A({date:"",timeSlot:"",symptoms:""}),H([]),q()}catch(de){it.error(((ae=(be=de.response)==null?void 0:be.data)==null?void 0:ae.message)||"Failed to book appointment")}finally{O(!1)}},ne=()=>{const he=[];for(let be=0;be<7;be++){const ae=new Date;ae.setDate(ae.getDate()+be),he.push({value:ae.toISOString().split("T")[0],label:ae.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:be===0})}return he};return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Find Doctors"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Book video consultations with healthcare specialists"})]}),l.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:[l.jsxs("button",{onClick:()=>M("doctors"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${F==="doctors"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(Kc,{className:"w-4 h-4"})," Find Doctors"]}),l.jsxs("button",{onClick:()=>M("appointments"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${F==="appointments"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(ki,{className:"w-4 h-4"})," My Appointments",o.length>0&&l.jsx("span",{className:"ml-1 px-2 py-0.5 bg-cyan-100 text-cyan-600 text-xs rounded-full",children:o.length})]})]}),F==="doctors"&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-4 shadow-sm",children:l.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(Uy,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),l.jsx("input",{type:"text",placeholder:"Search doctors...",value:E,onChange:he=>T(he.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"})]}),l.jsx("select",{value:y,onChange:he=>b(he.target.value),className:"px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Kze.map(he=>l.jsx("option",{value:he,children:he},he))})]})}),p?l.jsxs("div",{className:"text-center py-12",children:[l.jsx("div",{className:"w-10 h-10 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto"}),l.jsx("p",{className:"text-slate-500 mt-4",children:"Loading doctors..."})]}):ee.length>0?l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:ee.map(he=>{var ae,de,xe;const be=he.name||((ae=he.user)==null?void 0:ae.name)||"Doctor";return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[l.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[l.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-xl font-bold text-white",children:(de=be[0])==null?void 0:de.toUpperCase()}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",be]}),l.jsx("p",{className:"text-sm text-cyan-600 font-medium",children:he.specialization}),l.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[l.jsx(zc,{className:"w-4 h-4 text-amber-400 fill-amber-400"}),l.jsx("span",{className:"text-sm text-slate-600",children:((xe=he.rating)==null?void 0:xe.toFixed(1))||"4.5"}),l.jsx("span",{className:"text-slate-300",children:""}),l.jsxs("span",{className:"text-sm text-slate-500",children:[he.experience||5,"+ yrs"]})]})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xl font-bold text-slate-800",children:["",he.consultationFee||500]}),l.jsx("span",{className:"text-sm text-slate-500",children:" / session"})]}),l.jsx("button",{onClick:()=>N(he),className:"px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium rounded-xl hover:shadow-lg transition-all",children:"Book Now"})]})]},he._id)})}):l.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl border border-slate-200",children:[l.jsx(Uy,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),l.jsx("p",{className:"text-slate-500",children:"No doctors found"})]})]}),F==="appointments"&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Your Appointments"}),o.length>0?l.jsx("div",{className:"space-y-3",children:o.map(he=>{var be,ae,de,xe,Ue,Me,et,Re;return l.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:((Ue=(xe=((be=he.doctor)==null?void 0:be.name)||((de=(ae=he.doctor)==null?void 0:ae.user)==null?void 0:de.name))==null?void 0:xe[0])==null?void 0:Ue.toUpperCase())||"D"}),l.jsxs("div",{children:[l.jsxs("p",{className:"font-medium text-slate-800",children:["Dr. ",((Me=he.doctor)==null?void 0:Me.name)||((Re=(et=he.doctor)==null?void 0:et.user)==null?void 0:Re.name)]}),l.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(he.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",he.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${he.status==="completed"?"bg-green-100 text-green-600":he.status==="scheduled"?"bg-amber-100 text-amber-600":"bg-red-100 text-red-600"}`,children:he.status}),he.status==="scheduled"&&l.jsx("button",{onClick:()=>e(`/consultation/${he._id}`),className:"px-3 py-1 bg-cyan-500 text-white text-sm font-medium rounded-lg hover:bg-cyan-600",children:"Join Call"})]})]})},he._id)})}):l.jsxs("div",{className:"text-center py-8",children:[l.jsx(ki,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),l.jsx("p",{className:"text-slate-500",children:"No appointments yet"}),l.jsx("button",{onClick:()=>M("doctors"),className:"mt-3 text-cyan-600 font-medium hover:text-cyan-700",children:"Book your first appointment "})]})]}),w&&l.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up max-h-[90vh] overflow-y-auto",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Book Appointment"}),l.jsx("button",{onClick:()=>{N(null),H([]),A({date:"",timeSlot:"",symptoms:""})},className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg",children:l.jsx(ha,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-xl mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(fe=(Se=w.name||((ue=w.user)==null?void 0:ue.name))==null?void 0:Se[0])==null?void 0:fe.toUpperCase()}),l.jsxs("div",{children:[l.jsxs("p",{className:"font-semibold text-slate-800",children:["Dr. ",w.name||((we=w.user)==null?void 0:we.name)]}),l.jsx("p",{className:"text-sm text-cyan-600",children:w.specialization})]})]}),l.jsxs("form",{onSubmit:oe,className:"space-y-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Date"}),l.jsx("div",{className:"grid grid-cols-4 gap-2",children:ne().map(he=>l.jsxs("button",{type:"button",onClick:()=>A({...D,date:he.value,timeSlot:""}),className:`p-2 rounded-xl text-center transition-all ${D.date===he.value?"bg-cyan-500 text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200"}`,children:[l.jsx("div",{className:"text-xs font-medium",children:he.label.split(" ")[0]}),l.jsx("div",{className:"text-sm font-bold",children:he.label.split(" ")[2]})]},he.value))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Time"}),B?l.jsxs("div",{className:"flex items-center justify-center py-6",children:[l.jsx("div",{className:"w-6 h-6 border-2 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"}),l.jsx("span",{className:"ml-2 text-slate-500 text-sm",children:"Loading slots..."})]}):V.length>0?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:V.map(he=>{const be=D.timeSlot===he.timeSlot,ae=he.status==="passed",de=he.status==="booked",xe=he.status==="blocked",Ue=he.status==="available";return l.jsxs("button",{type:"button",onClick:()=>Ue&&A({...D,timeSlot:he.timeSlot}),disabled:!Ue,className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${be?"bg-cyan-500 text-white ring-2 ring-cyan-300":ae?"bg-slate-100 text-slate-400 cursor-not-allowed line-through":de?"bg-red-50 text-red-400 cursor-not-allowed border border-red-200":xe?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200 cursor-pointer"}`,title:ae?"Time passed":de?"Already booked":xe?"Not available":"Available",children:[he.timeSlot,de&&l.jsx("span",{className:"ml-1 text-xs",children:"(Booked)"})]},he.timeSlot)})}),l.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-slate-500",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-100 border border-emerald-300"})," Available"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-red-50 border border-red-200"})," Booked"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-slate-100 border border-slate-200"})," Passed/Unavailable"]})]})]}):D.date?l.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[l.jsx(ic,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"No slots available for this date"})]}):l.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[l.jsx(ki,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"Select a date first"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Symptoms (Optional)"}),l.jsx("textarea",{value:D.symptoms,onChange:he=>A({...D,symptoms:he.target.value}),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none resize-none",rows:3,placeholder:"Describe your symptoms..."})]}),l.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Hd,{className:"w-5 h-5 text-cyan-600"}),l.jsx("span",{className:"font-medium text-cyan-700",children:"Video Consultation"})]}),l.jsx("p",{className:"text-xs text-cyan-600 mt-1",children:"You'll receive a video call link via email"})]}),l.jsxs("div",{className:"flex gap-3 pt-2",children:[l.jsx("button",{type:"button",onClick:()=>{N(null),H([])},className:"flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 transition-all",children:"Cancel"}),l.jsx("button",{type:"submit",disabled:k||!D.date||!D.timeSlot,className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:k?"Booking...":`Confirm  ${w.consultationFee||500}`})]})]})]})})]})}function qze(){var ne,ue,Se,fe,we,he,be,ae,de,xe,Ue,Me,et,Re,nt,ut,Kt,Rn,Pe,lt,Et,Ae,wt;const{user:e,updateUser:n}=fa(),[a,o]=Y.useState(!1),[d,p]=Y.useState(null),[m,y]=Y.useState(""),[b,E]=Y.useState("profile"),[T,w]=Y.useState(null),[N,D]=Y.useState(!1),[A,k]=Y.useState({goalType:"maintenance",currentWeight:((ne=e==null?void 0:e.profile)==null?void 0:ne.weight)||"",targetWeight:"",height:((ue=e==null?void 0:e.profile)==null?void 0:ue.height)||"",age:((Se=e==null?void 0:e.profile)==null?void 0:Se.age)||"",gender:((fe=e==null?void 0:e.profile)==null?void 0:fe.gender)||"male",activityLevel:"moderate",dietaryPreference:((we=e==null?void 0:e.profile)==null?void 0:we.dietaryPreference)||"non-vegetarian"}),[O,F]=Y.useState({name:(e==null?void 0:e.name)||"",profile:{age:((he=e==null?void 0:e.profile)==null?void 0:he.age)||"",gender:((be=e==null?void 0:e.profile)==null?void 0:be.gender)||"",dietaryPreference:((ae=e==null?void 0:e.profile)==null?void 0:ae.dietaryPreference)||"non-vegetarian",height:((de=e==null?void 0:e.profile)==null?void 0:de.height)||"",weight:((xe=e==null?void 0:e.profile)==null?void 0:xe.weight)||"",bloodGroup:((Ue=e==null?void 0:e.profile)==null?void 0:Ue.bloodGroup)||"",allergies:((et=(Me=e==null?void 0:e.profile)==null?void 0:Me.allergies)==null?void 0:et.join(", "))||"",chronicConditions:((nt=(Re=e==null?void 0:e.profile)==null?void 0:Re.chronicConditions)==null?void 0:nt.join(", "))||""}});Y.useEffect(()=>{const Xe=async()=>{try{const{data:At}=await Th.getHistory();p(At);const ye=Object.keys(At.history||{});ye.length>0&&y(ye[0])}catch(At){console.error("Failed to fetch health history:",At)}},$t=async()=>{try{const At=localStorage.getItem("token"),ye=await Mn.get("/api/nutrition/goals",{headers:{Authorization:`Bearer ${At}`}});ye.data.healthGoal&&(w(ye.data.healthGoal),k({goalType:ye.data.healthGoal.goalType,currentWeight:ye.data.healthGoal.currentWeight,targetWeight:ye.data.healthGoal.targetWeight,height:ye.data.healthGoal.height,age:ye.data.healthGoal.age,gender:ye.data.healthGoal.gender,activityLevel:ye.data.healthGoal.activityLevel,dietaryPreference:ye.data.healthGoal.dietaryPreference}))}catch{console.log("No health goal set yet")}};Xe(),$t()},[]);const M=Xe=>{const{name:$t,value:At}=Xe.target;if($t.startsWith("profile.")){const ye=$t.split(".")[1];F(Qe=>({...Qe,profile:{...Qe.profile,[ye]:At}}))}else F(ye=>({...ye,[$t]:At}))},V=async Xe=>{var $t,At;Xe.preventDefault(),o(!0);try{const ye={name:O.name,profile:{...O.profile,age:O.profile.age?Number(O.profile.age):void 0,height:O.profile.height?Number(O.profile.height):void 0,weight:O.profile.weight?Number(O.profile.weight):void 0,allergies:O.profile.allergies?O.profile.allergies.split(",").map(Wt=>Wt.trim()).filter(Boolean):[],chronicConditions:O.profile.chronicConditions?O.profile.chronicConditions.split(",").map(Wt=>Wt.trim()).filter(Boolean):[]}},{data:Qe}=await dt.put("/auth/profile",ye);n(Qe),it.success("Profile updated successfully!")}catch(ye){it.error(((At=($t=ye.response)==null?void 0:$t.data)==null?void 0:At.message)||"Failed to update profile")}finally{o(!1)}},H=async Xe=>{var $t,At;Xe.preventDefault(),D(!0);try{const ye=localStorage.getItem("token"),Qe={...A,currentWeight:Number(A.currentWeight),targetWeight:Number(A.targetWeight),height:Number(A.height),age:Number(A.age)},Wt=await Mn.post("/api/nutrition/goals",Qe,{headers:{Authorization:`Bearer ${ye}`}});w(Wt.data.healthGoal),it.success("Fitness goal set successfully! Your daily targets have been calculated.")}catch(ye){it.error(((At=($t=ye.response)==null?void 0:$t.data)==null?void 0:At.message)||"Failed to set fitness goal")}finally{D(!1)}},B=Xe=>{const{name:$t,value:At}=Xe.target;k(ye=>({...ye,[$t]:At}))},z=O.profile.height&&O.profile.weight?(O.profile.weight/Math.pow(O.profile.height/100,2)).toFixed(1):null,Q=(Xe=>Xe?Xe<18.5?{label:"Underweight",color:"blue"}:Xe<25?{label:"Normal",color:"emerald"}:Xe<30?{label:"Overweight",color:"amber"}:{label:"Obese",color:"red"}:{label:"N/A",color:"slate"})(parseFloat(z)),ee=((Kt=(ut=d==null?void 0:d.history)==null?void 0:ut[m])==null?void 0:Kt.map(Xe=>({date:new Date(Xe.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:Xe.healthScore||0})).reverse())||[],oe=Object.keys((d==null?void 0:d.history)||{});return l.jsxs("div",{className:"w-full overflow-x-hidden space-y-6 animate-fade-in px-3 md:px-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"My Profile"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Manage your information and track health progress"})]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-500 to-blue-500 rounded-2xl p-3 md:p-6 text-white relative overflow-hidden shadow-lg",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col gap-4 md:gap-6",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:gap-6",children:[l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-2xl md:text-3xl font-bold",children:(Pe=(Rn=e==null?void 0:e.name)==null?void 0:Rn[0])==null?void 0:Pe.toUpperCase()}),l.jsx("button",{className:"absolute -bottom-2 -right-2 w-8 h-8 bg-white rounded-full flex items-center justify-center text-cyan-600 shadow-lg hover:scale-110 transition-transform",children:l.jsx(s2,{className:"w-4 h-4"})})]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:e==null?void 0:e.name}),l.jsxs("div",{className:"flex flex-col gap-2 mt-2 text-white/90 text-sm md:text-base",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(P_,{className:"w-4 h-4 flex-shrink-0"})," ",e==null?void 0:e.email]}),(e==null?void 0:e.phone)&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(d2,{className:"w-4 h-4 flex-shrink-0"})," ",e==null?void 0:e.phone]})]})]})]}),l.jsxs("div",{className:"flex gap-3 md:gap-4",children:[l.jsxs("div",{className:"text-center p-3 md:p-4 bg-white/10 backdrop-blur-sm rounded-xl flex-1",children:[l.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:((lt=e==null?void 0:e.healthMetrics)==null?void 0:lt.healthScore)||"--"}),l.jsx("p",{className:"text-xs md:text-sm text-white/80",children:"Health Score"})]}),z&&l.jsxs("div",{className:"text-center p-3 md:p-4 bg-white/10 backdrop-blur-sm rounded-xl flex-1",children:[l.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:z}),l.jsx("p",{className:"text-xs md:text-sm text-white/80",children:"BMI"})]})]})]})]}),l.jsx("div",{className:"flex gap-1 md:gap-2 p-1 bg-slate-100 rounded-xl w-full md:w-fit overflow-x-auto",children:[{id:"profile",label:"Edit Profile",icon:Kc},{id:"goals",label:"Fitness Goals",icon:jh},{id:"history",label:"Health History",icon:ir}].map(Xe=>l.jsxs("button",{onClick:()=>E(Xe.id),className:`flex items-center gap-1 md:gap-2 px-3 md:px-5 py-2 md:py-2.5 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${b===Xe.id?"bg-white text-slate-800 shadow-sm":"text-slate-600 hover:text-slate-800"}`,children:[l.jsx(Xe.icon,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden md:inline",children:Xe.label}),l.jsx("span",{className:"md:hidden",children:Xe.label.split(" ")[0]})]},Xe.id))}),b==="profile"&&l.jsxs("form",{onSubmit:V,className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-base md:text-lg font-bold text-slate-800 mb-4 md:mb-6 flex items-center gap-2",children:[l.jsx(Kc,{className:"w-5 h-5 text-cyan-500"}),"Basic Information"]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",name:"name",value:O.name,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",value:e==null?void 0:e.email,className:"w-full bg-slate-50 border border-slate-200 rounded-xl py-3 px-4 text-slate-500",disabled:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",name:"profile.age",value:O.profile.age,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"1",max:"120",placeholder:"Enter your age"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),l.jsxs("select",{name:"profile.gender",value:O.profile.gender,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select gender"}),l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]}),l.jsxs("div",{className:"md:col-span-2",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),l.jsxs("select",{name:"profile.dietaryPreference",value:O.profile.dietaryPreference,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(Pi,{className:"w-5 h-5 text-red-500"}),"Health Information"]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",name:"profile.height",value:O.profile.height,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"50",max:"300",placeholder:"170"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Weight (kg)"}),l.jsx("input",{type:"number",name:"profile.weight",value:O.profile.weight,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"10",max:"500",placeholder:"70"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Blood Group"}),l.jsxs("select",{name:"profile.bloodGroup",value:O.profile.bloodGroup,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(Xe=>l.jsx("option",{value:Xe,children:Xe},Xe))]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(go,{className:"w-5 h-5 text-amber-500"}),"Medical History"]}),l.jsxs("div",{className:"space-y-5",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Allergies ",l.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),l.jsx("input",{type:"text",name:"profile.allergies",value:O.profile.allergies,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Penicillin, Peanuts"})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Chronic Conditions ",l.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),l.jsx("input",{type:"text",name:"profile.chronicConditions",value:O.profile.chronicConditions,onChange:M,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),l.jsx("button",{type:"submit",disabled:a,className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:a?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:[l.jsx(LJ,{className:"w-5 h-5"}),"Save Changes"]})})]}),l.jsxs("div",{className:"space-y-6",children:[z&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"BMI Calculator"}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`w-24 h-24 rounded-full bg-${Q.color}-100 flex items-center justify-center mx-auto mb-4`,children:l.jsx("span",{className:`text-3xl font-bold text-${Q.color}-600`,children:z})}),l.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium bg-${Q.color}-100 text-${Q.color}-700`,children:Q.label})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Quick Stats"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Total Reports"}),l.jsx("span",{className:"font-bold text-slate-800",children:(d==null?void 0:d.totalReports)||0})]}),l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Report Types"}),l.jsx("span",{className:"font-bold text-slate-800",children:oe.length})]}),l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Subscription"}),l.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-medium capitalize",children:((Et=e==null?void 0:e.subscription)==null?void 0:Et.plan)||"Free"})]})]})]})]})]}),b==="goals"&&l.jsxs("form",{onSubmit:H,className:"max-w-4xl space-y-6",children:[T&&l.jsxs("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl border-2 border-blue-200 p-3 md:p-6 shadow-sm w-full overflow-hidden",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3 md:gap-4 mb-4",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-lg md:text-xl font-bold text-blue-900 mb-1",children:"Your Current Goal"}),l.jsx("p",{className:"text-xs md:text-sm text-blue-700",children:"Daily targets calculated based on your goal"})]}),l.jsx("div",{className:"px-3 md:px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold capitalize text-sm md:text-base whitespace-nowrap",children:T.goalType.replace("_"," ")})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mt-4",children:[l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Daily Calories"}),l.jsx("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:T.dailyCalorieTarget})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Protein"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[T.macroTargets.protein,"g"]})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Carbs"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[T.macroTargets.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Fats"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[T.macroTargets.fats,"g"]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:T?"Update Your Fitness Goal":"Set Your Fitness Goal"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Goal Type"}),l.jsxs("select",{name:"goalType",value:A.goalType,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"weight_loss",children:"Weight Loss (Fat Loss)"}),l.jsx("option",{value:"muscle_gain",children:"Muscle Gain (Bulking)"}),l.jsx("option",{value:"weight_gain",children:"Weight Gain"}),l.jsx("option",{value:"maintenance",children:"Maintenance"}),l.jsx("option",{value:"health_improvement",children:"Health Improvement"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Activity Level"}),l.jsxs("select",{name:"activityLevel",value:A.activityLevel,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),l.jsx("option",{value:"light",children:"Light (Exercise 1-3 days/week)"}),l.jsx("option",{value:"moderate",children:"Moderate (Exercise 3-5 days/week)"}),l.jsx("option",{value:"active",children:"Active (Exercise 6-7 days/week)"}),l.jsx("option",{value:"very_active",children:"Very Active (Hard exercise daily)"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Current Weight (kg)"}),l.jsx("input",{type:"number",name:"currentWeight",value:A.currentWeight,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Target Weight (kg)"}),l.jsx("input",{type:"number",name:"targetWeight",value:A.targetWeight,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",name:"height",value:A.height,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"100",max:"250"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",name:"age",value:A.age,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"10",max:"120"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),l.jsxs("select",{name:"gender",value:A.gender,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),l.jsxs("select",{name:"dietaryPreference",value:A.dietaryPreference,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]}),l.jsxs("button",{type:"submit",disabled:N,className:"mt-6 w-full md:w-auto px-8 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg font-medium hover:shadow-lg disabled:opacity-50 flex items-center justify-center gap-2",children:[l.jsx(jh,{className:"w-5 h-5"}),N?"Calculating...":T?"Update Goal":"Set Goal & Calculate Targets"]})]}),l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:l.jsxs("div",{className:"flex gap-3",children:[l.jsx(go,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"How it works (Scientifically Backed)"}),l.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:["We use the ",l.jsx("strong",{children:"Mifflin-St Jeor equation"})," (industry standard used by WHO, fitness apps, and hospitals) to calculate your BMR:"]}),l.jsxs("p",{className:"text-xs text-blue-600 font-mono mb-2",children:["Male: BMR = (10  weight) + (6.25  height)  (5  age) + 5",l.jsx("br",{}),"Female: BMR = (10  weight) + (6.25  height)  (5  age)  161"]}),l.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Then we calculate TDEE (Total Daily Energy Expenditure) by multiplying BMR with your activity level, and adjust calories based on your goal:"}),l.jsxs("ul",{className:"text-xs text-blue-600 space-y-1 ml-4",children:[l.jsx("li",{children:" Muscle Gain: +350 calories"}),l.jsx("li",{children:" Fat Loss: -400 calories"}),l.jsx("li",{children:" Maintenance: No adjustment"})]}),l.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:[l.jsx("strong",{children:"Macros:"})," Protein = 1.6g per kg body weight (realistic & sustainable), Fats = 0.8g per kg, Carbs = remaining calories. These targets will be used throughout the platform to track your nutrition and provide personalized recommendations."]})]})]})})]}),b==="history"&&l.jsx("div",{className:"space-y-6",children:oe.length>0?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Health Score Trend"}),l.jsx("p",{className:"text-sm text-slate-500",children:"Track your progress over time"})]}),l.jsx("select",{value:m,onChange:Xe=>y(Xe.target.value),className:"bg-white border border-slate-300 rounded-xl py-2 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:oe.map(Xe=>l.jsx("option",{value:Xe,children:Xe},Xe))})]}),ee.length>1?l.jsx(DS,{width:"100%",height:300,children:l.jsxs(Tte,{data:ee,children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"historyGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.3}),l.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:0})]})}),l.jsx(y_,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),l.jsx(qd,{dataKey:"date",stroke:"#64748b",fontSize:12}),l.jsx(Xd,{domain:[0,100],stroke:"#64748b",fontSize:12}),l.jsx(Es,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"12px"},labelStyle:{color:"#475569"}}),l.jsx(Gl,{type:"monotone",dataKey:"score",stroke:"#06b6d4",strokeWidth:3,fill:"url(#historyGradient)"})]})}):l.jsxs("div",{className:"text-center py-12 text-slate-500",children:[l.jsx(li,{className:"w-12 h-12 mx-auto mb-3 text-slate-300"}),l.jsx("p",{children:"Upload more reports to see your health trend"})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6",children:["Recent ",m," Reports"]}),l.jsx("div",{className:"space-y-3",children:(wt=(Ae=d==null?void 0:d.history)==null?void 0:Ae[m])==null?void 0:wt.slice(0,5).map((Xe,$t)=>{var Qe;const At=d.history[m][$t+1],ye=At?Xe.healthScore-At.healthScore:null;return l.jsxs(un,{to:`/reports/${Xe._id}`,className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition-all group border border-slate-200",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-cyan-100 flex items-center justify-center",children:l.jsx(li,{className:"w-6 h-6 text-cyan-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800",children:new Date(Xe.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),l.jsx("p",{className:"text-sm text-slate-500",children:((Qe=Xe.keyFindings)==null?void 0:Qe.slice(0,2).join(", "))||"View details"})]})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[ye!==null&&l.jsxs("span",{className:`text-sm font-semibold ${ye>0?"text-emerald-600":ye<0?"text-red-600":"text-slate-500"}`,children:[ye>0?"+":"",ye]}),l.jsx("span",{className:"text-2xl font-bold text-cyan-600",children:Xe.healthScore||"--"}),l.jsx(cTe,{className:"w-5 h-5 text-slate-400 group-hover:text-cyan-500 transition-colors"})]})]},Xe._id)})})]})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 text-center py-16 shadow-sm",children:[l.jsx(li,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"No Health History Yet"}),l.jsx("p",{className:"text-slate-500 mb-6",children:"Upload health reports to track your progress over time"}),l.jsxs(un,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:[l.jsx(co,{className:"w-5 h-5"}),"Upload Your First Report"]})]})})]})}const p1={name:"John Doe",email:"john@example.com",profile:{age:32,gender:"male",height:175,weight:72,bloodGroup:"O+",allergies:["Penicillin"],chronicConditions:["None"]}},Xze=[{date:"Jul",score:65},{date:"Aug",score:68},{date:"Sep",score:72},{date:"Oct",score:70},{date:"Nov",score:75},{date:"Dec",score:78}],zo={summary:"Overall health is good with some areas needing attention. Blood sugar levels are slightly elevated.",keyFindings:["Hemoglobin levels are normal at 14.2 g/dL","Cholesterol is borderline high at 210 mg/dL","Vitamin D deficiency detected"],riskFactors:["Pre-diabetic blood sugar levels","Sedentary lifestyle indicators"],metrics:{hemoglobin:{value:14.2,unit:"g/dL",status:"normal",normalRange:"12-16"},bloodSugar:{value:115,unit:"mg/dL",status:"borderline",normalRange:"70-100"},cholesterol:{value:210,unit:"mg/dL",status:"borderline",normalRange:"<200"}},recommendations:{diet:[{item:"Leafy Greens",reason:"Rich in iron and vitamins",priority:"high"},{item:"Fatty Fish",reason:"Omega-3 helps reduce cholesterol",priority:"high"},{item:"Nuts & Seeds",reason:"Good fats for heart health",priority:"medium"}],exercise:[{activity:"Brisk Walking",duration:"30 mins",frequency:"daily",reason:"Improves cardiovascular health"},{activity:"Strength Training",duration:"20 mins",frequency:"3x/week",reason:"Builds muscle"}]},doctorConsultation:{specializations:["Endocrinologist","Cardiologist"],reason:"Blood sugar and cholesterol need monitoring"}},tk=[{_id:"1",name:"Dr. Sarah Johnson",specialization:"Cardiologist",experience:12,fee:800,rating:4.8,reviews:124,hospital:"City Heart Hospital",available:!0,slots:["09:00 AM","10:00 AM","11:00 AM","02:00 PM","03:00 PM"]},{_id:"2",name:"Dr. Raj Patel",specialization:"Endocrinologist",experience:15,fee:900,rating:4.9,reviews:89,hospital:"Diabetes Care Center",available:!0,slots:["10:00 AM","11:00 AM","04:00 PM","05:00 PM"]},{_id:"3",name:"Dr. Emily Chen",specialization:"General Physician",experience:8,fee:500,rating:4.7,reviews:156,hospital:"Family Health Clinic",available:!0,slots:["09:00 AM","10:00 AM","02:00 PM","03:00 PM","04:00 PM"]},{_id:"4",name:"Dr. Michael Brown",specialization:"Neurologist",experience:18,fee:1200,rating:4.9,reviews:67,hospital:"Neuro Care Institute",available:!0,slots:["11:00 AM","02:00 PM","03:00 PM"]},{_id:"5",name:"Dr. Priya Sharma",specialization:"Dermatologist",experience:10,fee:600,rating:4.6,reviews:203,hospital:"Skin & Care Clinic",available:!1,slots:[]}],Jze=[{_id:"apt1",doctor:tk[1],date:"2024-12-15",timeSlot:"10:00 AM",status:"confirmed",type:"online",meetLink:"https://meet.healthai.com/apt-xyz123",amountPaid:450}],RY={summary:"Your health has improved since your last checkup.",metricChanges:[{metric:"Health Score",previous:"72",current:"78",change:"improved"},{metric:"Blood Sugar",previous:"125 mg/dL",current:"115 mg/dL",change:"improved"}]},f1={cholesterol:"Your cholesterol level of 210 mg/dL is borderline high. Focus on reducing saturated fats and increasing fiber. Regular exercise helps too.",worried:"No immediate alarm, but attention needed. Blood sugar is pre-diabetic and cholesterol borderline. Lifestyle changes can help. Follow up with specialists.",default:"Your health score is 78/100. Key areas: managing blood sugar and cholesterol through diet and exercise. Ask me anything specific!"},AY=["All","Cardiologist","Endocrinologist","General Physician","Neurologist","Dermatologist","Orthopedic","Pediatrician"],Qze=["Blood Test","X-Ray","MRI","CT Scan","ECG","General Checkup"];function Zze(){const[e,n]=Y.useState("dashboard"),[a,o]=Y.useState(!1),[d,p]=Y.useState([]),[m,y]=Y.useState(""),[b,E]=Y.useState(!1),[T,w]=Y.useState(!1),[N,D]=Y.useState(null),[A,k]=Y.useState(0),[O,F]=Y.useState({date:"",slot:"",type:"online"}),[M,V]=Y.useState(tk),[H,B]=Y.useState(Jze),[z,q]=Y.useState("All"),[Q,ee]=Y.useState(""),[oe,ne]=Y.useState(0),[ue,Se]=Y.useState(null),[fe,we]=Y.useState(!1),[he,be]=Y.useState({name:"",specialization:"",experience:"",fee:"",hospital:""}),[ae,de]=Y.useState(!1),[xe,Ue]=Y.useState(p1.profile),Me=Y.useRef(null);Y.useEffect(()=>{var ye;(ye=Me.current)==null||ye.scrollIntoView({behavior:"smooth"})},[d]);const et=ye=>{if(ye.preventDefault(),!m.trim())return;const Qe=m.toLowerCase();p(Wt=>[...Wt,{role:"user",content:m}]),y(""),setTimeout(()=>{const Wt=Object.keys(f1).find(ui=>Qe.includes(ui));p(ui=>[...ui,{role:"assistant",content:f1[Wt]||f1.default}])},800)},Re=()=>{if(A===0)k(1);else if(A===1&&O.date&&O.slot)k(2);else if(A===2){const ye={_id:`apt${Date.now()}`,doctor:N,date:O.date,timeSlot:O.slot,status:"confirmed",type:O.type,meetLink:`https://meet.healthai.com/apt-${Math.random().toString(36).substr(2,9)}`,amountPaid:N.fee/2};B(Qe=>[ye,...Qe]),k(3)}},nt=()=>{D(null),k(0),F({date:"",slot:"",type:"online"})},ut=()=>{oe===0&&ue&&(ne(1),we(!0),setTimeout(()=>{we(!1),ne(2)},2500))},Kt=()=>{he.name&&he.specialization&&he.fee&&(V(ye=>[...ye,{...he,_id:`doc${Date.now()}`,rating:4.5,reviews:0,available:!0,slots:["10:00 AM","02:00 PM","04:00 PM"]}]),be({name:"",specialization:"",experience:"",fee:"",hospital:""}),de(!1))},Rn=M.filter(ye=>(z==="All"||ye.specialization===z)&&ye.name.toLowerCase().includes(Q.toLowerCase())),Pe=({trend:ye})=>ye==="improved"?l.jsx(Xa,{className:"w-4 h-4 text-green-600"}):ye==="declined"?l.jsx(VJ,{className:"w-4 h-4 text-red-600"}):l.jsx(l2,{className:"w-4 h-4 text-gray-400"}),lt=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome back, John!"}),l.jsx("p",{className:"text-gray-600",children:"Here's your health overview"})]}),l.jsxs("button",{onClick:()=>n("upload"),className:"btn-primary flex items-center gap-2",children:[l.jsx(co,{className:"w-4 h-4"})," Upload Report"]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{icon:ir,color:"primary",label:"Health Score",value:"78/100"},{icon:li,color:"blue",label:"Total Reports",value:"6"},{icon:Xa,color:"green",label:"BMI",value:"23.5"},{icon:ki,color:"purple",label:"Last Checkup",value:"Dec 5"}].map((ye,Qe)=>l.jsx("div",{className:"card",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:`w-12 h-12 bg-${ye.color}-100 rounded-xl flex items-center justify-center`,children:l.jsx(ye.icon,{className:`w-6 h-6 text-${ye.color}-600`})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-500",children:ye.label}),l.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ye.value})]})]})},Qe))}),H.length>0&&l.jsxs("div",{className:"card border-2 border-green-200 bg-green-50/30",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(ki,{className:"w-5 h-5 text-green-600"})," Upcoming Appointments"]}),H.filter(ye=>ye.status==="confirmed").map(ye=>l.jsxs("div",{className:"bg-white p-4 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:ye.doctor.name[4]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:ye.doctor.name}),l.jsxs("p",{className:"text-sm text-gray-500",children:[ye.doctor.specialization,"  ",ye.date," at ",ye.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[ye.type==="online"&&ye.meetLink&&l.jsxs("a",{href:ye.meetLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:[l.jsx(Hd,{className:"w-4 h-4"})," Join Call"]}),l.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:"Confirmed"})]})]},ye._id))]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Score Trend"}),l.jsx(DS,{width:"100%",height:200,children:l.jsxs(wte,{data:Xze,children:[l.jsx(y_,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),l.jsx(qd,{dataKey:"date"}),l.jsx(Xd,{domain:[0,100]}),l.jsx(Es,{}),l.jsx(rg,{type:"monotone",dataKey:"score",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"}})]})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(nc,{className:"w-5 h-5 text-green-600"}),l.jsx("h3",{className:"font-semibold",children:"Diet Recommendations"})]}),l.jsx("ul",{className:"space-y-2",children:zo.recommendations.diet.map((ye,Qe)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-2"}),l.jsxs("span",{children:[l.jsx("strong",{children:ye.item})," - ",ye.reason]})]},Qe))})]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(bP,{className:"w-5 h-5 text-blue-600"}),l.jsx("h3",{className:"font-semibold",children:"Exercise Plan"})]}),l.jsx("ul",{className:"space-y-2",children:zo.recommendations.exercise.map((ye,Qe)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),l.jsxs("span",{children:[l.jsx("strong",{children:ye.activity})," - ",ye.duration,", ",ye.frequency]})]},Qe))})]})]}),l.jsx("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(go,{className:"w-5 h-5 text-orange-600 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold",children:"Doctor Consultation Recommended"}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:zo.doctorConsultation.reason}),l.jsxs("p",{className:"text-sm mt-2",children:[l.jsx("strong",{children:"Specialists:"})," ",zo.doctorConsultation.specializations.join(", ")]}),l.jsx("button",{onClick:()=>n("doctors"),className:"btn-primary mt-3 text-sm",children:"Find Doctors"})]})]})})]}),Et=()=>l.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Upload Health Report"}),l.jsx("p",{className:"text-gray-600",children:"Upload your medical report for AI-powered analysis"})]}),oe===0&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"card",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Report Type"}),l.jsx("select",{className:"input",children:Qze.map(ye=>l.jsx("option",{children:ye},ye))})]}),l.jsxs("div",{className:"card",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Upload File"}),ue?l.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(li,{className:"w-10 h-10 text-primary-600"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:ue.name}),l.jsxs("p",{className:"text-sm text-gray-500",children:[ue.size," MB"]})]})]}),l.jsx("button",{onClick:()=>Se(null),className:"p-2 text-gray-400 hover:text-red-500",children:l.jsx(ha,{className:"w-5 h-5"})})]}):l.jsxs("div",{onClick:()=>Se({name:"blood_test_report.pdf",size:2.4}),className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center cursor-pointer hover:border-primary-400 transition-colors",children:[l.jsx(co,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop or click to upload"}),l.jsx("p",{className:"text-sm text-gray-500",children:"PDF, PNG, JPG - max 10MB"})]})]}),l.jsxs("button",{onClick:ut,disabled:!ue,className:"btn-primary w-full flex items-center justify-center gap-2",children:[l.jsx(co,{className:"w-5 h-5"})," Analyze Report"]})]}),oe===1&&l.jsxs("div",{className:"card text-center py-12",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold",children:"Analyzing Your Report..."}),l.jsx("p",{className:"text-gray-600 mt-2",children:"Our AI is extracting insights from your report"}),l.jsx("div",{className:"mt-6 space-y-2 text-left max-w-xs mx-auto",children:["Extracting text from PDF...","Analyzing health metrics...","Generating recommendations..."].map((ye,Qe)=>l.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.jsx(gh,{className:"w-4 h-4 text-green-600"}),l.jsx("span",{children:ye})]},Qe))})]}),oe===2&&l.jsxs("div",{className:"space-y-6",children:[l.jsx("div",{className:"card bg-green-50 border-2 border-green-200",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(gh,{className:"w-8 h-8 text-green-600"}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Analysis Complete!"}),l.jsx("p",{className:"text-green-700",children:"Your report has been analyzed successfully"})]})]})}),l.jsx("button",{onClick:()=>n("report"),className:"btn-primary w-full",children:"View Full Analysis"})]}),l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl text-sm text-blue-800",children:[l.jsx("strong",{children:"Note:"})," AI analysis is for informational purposes only. Always consult a healthcare provider."]})]}),Ae=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a?"Manage Doctors":"Find Doctors"}),l.jsx("p",{className:"text-gray-600",children:a?"Add and manage platform doctors":"Book consultations with specialists"})]}),a&&l.jsxs("button",{onClick:()=>de(!0),className:"btn-primary flex items-center gap-2",children:[l.jsx(Wc,{className:"w-4 h-4"})," Add Doctor"]})]}),l.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(Uy,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),l.jsx("input",{type:"text",placeholder:"Search doctors...",value:Q,onChange:ye=>ee(ye.target.value),className:"input pl-12"})]}),l.jsx("div",{className:"flex gap-2 flex-wrap",children:AY.slice(0,5).map(ye=>l.jsx("button",{onClick:()=>q(ye),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${z===ye?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:ye},ye))})]}),l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:Rn.map(ye=>{var Qe;return l.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-xl flex items-center justify-center text-2xl font-bold text-primary-600",children:((Qe=ye.name.split(" ")[1])==null?void 0:Qe[0])||ye.name[0]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"font-semibold text-gray-900",children:ye.name}),l.jsx("p",{className:"text-sm text-primary-600",children:ye.specialization}),l.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[l.jsx(zc,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),l.jsx("span",{className:"text-sm font-medium",children:ye.rating}),l.jsxs("span",{className:"text-sm text-gray-500",children:["(",ye.reviews,")"]})]})]})]}),l.jsxs("div",{className:"mt-4 space-y-2 text-sm text-gray-600",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(ic,{className:"w-4 h-4"}),l.jsxs("span",{children:[ye.experience," years experience"]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(xP,{className:"w-4 h-4"}),l.jsx("span",{children:ye.hospital})]})]}),l.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["",ye.fee]}),l.jsx("span",{className:"text-sm text-gray-500",children:" / session"})]}),ye.available?l.jsx("button",{onClick:()=>{D(ye),k(0)},className:"btn-primary text-sm",children:"Book Now"}):l.jsx("span",{className:"px-3 py-1.5 bg-gray-100 text-gray-500 rounded-xl text-sm",children:"Unavailable"})]})]},ye._id)})}),ae&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold",children:"Add New Doctor"}),l.jsx("button",{onClick:()=>de(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:l.jsx(ha,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Doctor Name"}),l.jsx("input",{type:"text",value:he.name,onChange:ye=>be({...he,name:ye.target.value}),className:"input",placeholder:"Dr. John Smith"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specialization"}),l.jsxs("select",{value:he.specialization,onChange:ye=>be({...he,specialization:ye.target.value}),className:"input",children:[l.jsx("option",{value:"",children:"Select"}),AY.slice(1).map(ye=>l.jsx("option",{children:ye},ye))]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Experience (yrs)"}),l.jsx("input",{type:"number",value:he.experience,onChange:ye=>be({...he,experience:ye.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fee ()"}),l.jsx("input",{type:"number",value:he.fee,onChange:ye=>be({...he,fee:ye.target.value}),className:"input"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hospital/Clinic"}),l.jsx("input",{type:"text",value:he.hospital,onChange:ye=>be({...he,hospital:ye.target.value}),className:"input"})]}),l.jsx("button",{onClick:Kt,className:"btn-primary w-full",children:"Add Doctor"})]})]})})]}),wt=()=>{var ye;return N&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[A<3&&l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold",children:A===0?"Book Appointment":A===1?"Select Slot":"Payment"}),l.jsx("button",{onClick:nt,className:"p-2 hover:bg-gray-100 rounded-lg",children:l.jsx(ha,{className:"w-5 h-5"})})]}),A===0&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[l.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-full flex items-center justify-center text-xl font-bold text-primary-600",children:(ye=N.name.split(" ")[1])==null?void 0:ye[0]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold",children:N.name}),l.jsx("p",{className:"text-sm text-primary-600",children:N.specialization}),l.jsx("p",{className:"text-sm text-gray-500",children:N.hospital})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consultation Type"}),l.jsx("div",{className:"flex gap-4",children:["online","in-person"].map(Qe=>l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",name:"type",checked:O.type===Qe,onChange:()=>F({...O,type:Qe}),className:"text-primary-600"}),Qe==="online"?l.jsxs(l.Fragment,{children:[l.jsx(Hd,{className:"w-4 h-4"})," Online"]}):l.jsxs(l.Fragment,{children:[l.jsx(xP,{className:"w-4 h-4"})," In-Person"]})]},Qe))})]}),l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl",children:[l.jsxs("p",{className:"text-sm text-blue-800",children:[l.jsx("strong",{children:"Consultation Fee:"})," ",N.fee]}),l.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Pay ",N.fee/2," now to confirm (50% advance)"]})]}),l.jsx("button",{onClick:Re,className:"btn-primary w-full",children:"Select Date & Time"})]}),A===1&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date"}),l.jsx("input",{type:"date",value:O.date,onChange:Qe=>F({...O,date:Qe.target.value}),min:new Date().toISOString().split("T")[0],className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Slots"}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:N.slots.map(Qe=>l.jsx("button",{onClick:()=>F({...O,slot:Qe}),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${O.slot===Qe?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:Qe},Qe))})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:()=>k(0),className:"flex-1 py-2.5 border border-gray-300 rounded-xl font-medium",children:"Back"}),l.jsx("button",{onClick:Re,disabled:!O.date||!O.slot,className:"flex-1 btn-primary",children:"Continue to Payment"})]})]}),A===2&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Doctor"}),l.jsx("span",{className:"font-medium",children:N.name})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Date"}),l.jsx("span",{className:"font-medium",children:O.date})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Time"}),l.jsx("span",{className:"font-medium",children:O.slot})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Type"}),l.jsx("span",{className:"font-medium capitalize",children:O.type})]}),l.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between",children:[l.jsx("span",{className:"font-semibold",children:"Amount to Pay"}),l.jsxs("span",{className:"font-bold text-primary-600",children:["",N.fee/2]})]})]}),l.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(IJ,{className:"w-5 h-5 text-gray-600"}),l.jsx("span",{className:"font-medium",children:"Payment Method"})]}),l.jsx("div",{className:"space-y-2",children:["UPI","Credit/Debit Card","Net Banking"].map(Qe=>l.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[l.jsx("input",{type:"radio",name:"payment",defaultChecked:Qe==="UPI"}),l.jsx("span",{children:Qe})]},Qe))})]}),l.jsxs("button",{onClick:Re,className:"btn-primary w-full flex items-center justify-center gap-2",children:[l.jsx(vS,{className:"w-4 h-4"})," Pay ",N.fee/2," Securely"]})]}),A===3&&l.jsxs("div",{className:"text-center py-6",children:[l.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx(gh,{className:"w-8 h-8 text-green-600"})}),l.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),l.jsx("p",{className:"text-gray-600 mb-4",children:"Your appointment has been scheduled"}),l.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-left space-y-2 mb-4",children:[l.jsxs("p",{children:[l.jsx("strong",{children:"Doctor:"})," ",N.name]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Date:"})," ",O.date," at ",O.slot]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Type:"})," ",O.type==="online"?"Video Consultation":"In-Person"]}),O.type==="online"&&l.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[l.jsxs("p",{className:"text-sm text-blue-800 font-medium flex items-center gap-2",children:[l.jsx(Hd,{className:"w-4 h-4"})," Video Call Link"]}),l.jsxs("p",{className:"text-sm text-blue-600 mt-1 break-all",children:["https://meet.healthai.com/apt-",Math.random().toString(36).substr(2,6)]}),l.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Link will be available in your dashboard"})]})]}),l.jsx("button",{onClick:()=>{nt(),n("dashboard")},className:"btn-primary w-full",children:"Go to Dashboard"})]})]})})},Xe=()=>{var ye,Qe;return l.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),l.jsx("p",{className:"text-gray-600",children:"Manage your personal and health information"})]}),l.jsx("div",{className:"card gradient-bg text-white",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center",children:l.jsx(ir,{className:"w-8 h-8"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold",children:"Health Score"}),l.jsx("p",{className:"text-3xl font-bold",children:"78/100"})]}),l.jsxs("div",{className:"ml-auto text-right",children:[l.jsx("p",{className:"text-sm opacity-80",children:"BMI"}),l.jsx("p",{className:"text-2xl font-bold",children:"23.5"})]})]})}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(Kc,{className:"w-5 h-5 text-primary-600"})," Basic Information"]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",value:p1.name,className:"input",readOnly:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",value:p1.email,className:"input bg-gray-50",disabled:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",value:xe.age,onChange:Wt=>Ue({...xe,age:Wt.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender"}),l.jsxs("select",{value:xe.gender,onChange:Wt=>Ue({...xe,gender:Wt.target.value}),className:"input",children:[l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]})]})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Information"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",value:xe.height,onChange:Wt=>Ue({...xe,height:Wt.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight (kg)"}),l.jsx("input",{type:"number",value:xe.weight,onChange:Wt=>Ue({...xe,weight:Wt.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blood Group"}),l.jsx("select",{value:xe.bloodGroup,onChange:Wt=>Ue({...xe,bloodGroup:Wt.target.value}),className:"input",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(Wt=>l.jsx("option",{children:Wt},Wt))})]})]})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Medical History"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allergies"}),l.jsx("input",{type:"text",value:(ye=xe.allergies)==null?void 0:ye.join(", "),className:"input",placeholder:"e.g., Penicillin, Peanuts"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chronic Conditions"}),l.jsx("input",{type:"text",value:(Qe=xe.chronicConditions)==null?void 0:Qe.join(", "),className:"input",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),l.jsxs("button",{className:"btn-primary w-full flex items-center justify-center gap-2",onClick:()=>alert("Profile saved!"),children:[l.jsx(gh,{className:"w-5 h-5"})," Save Changes"]})]})},$t=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("button",{onClick:()=>n("dashboard"),className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[l.jsx(oo,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-xl flex items-center justify-center",children:l.jsx(li,{className:"w-7 h-7 text-primary-600"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Blood Test Report"}),l.jsx("p",{className:"text-gray-500",children:"Analyzed on Dec 5, 2024"})]})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("div",{className:"text-3xl font-bold text-primary-600",children:"78"}),l.jsx("div",{className:"text-sm text-gray-500",children:"Health Score"})]})]}),l.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-100",children:[l.jsxs("button",{onClick:()=>E(!b),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-xl hover:bg-blue-100",children:[l.jsx(mS,{className:"w-4 h-4"}),b?"Hide":"Compare"]}),l.jsxs("button",{onClick:()=>w(!T),className:"flex items-center gap-2 px-4 py-2 bg-purple-50 text-purple-700 rounded-xl hover:bg-purple-100",children:[l.jsx(x7,{className:"w-4 h-4"}),"Ask AI"]})]})]}),b&&l.jsxs("div",{className:"card border-2 border-blue-200 bg-blue-50/50",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[l.jsx(mS,{className:"w-5 h-5 text-blue-600"})," Health Comparison"]}),l.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-700",children:" Improved"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[l.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[l.jsx("p",{className:"text-sm text-gray-500",children:"Previous (Oct)"}),l.jsx("p",{className:"text-2xl font-bold text-gray-400",children:"72/100"})]}),l.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[l.jsx("p",{className:"text-sm text-gray-500",children:"Current (Dec)"}),l.jsx("p",{className:"text-2xl font-bold text-primary-600",children:"78/100"})]})]}),l.jsx("p",{className:"text-gray-700 mb-4",children:RY.summary}),l.jsx("div",{className:"space-y-2 mb-4",children:RY.metricChanges.map((ye,Qe)=>l.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Pe,{trend:ye.change}),l.jsx("span",{className:"font-medium",children:ye.metric})]}),l.jsxs("div",{className:"text-sm",children:[l.jsx("span",{className:"text-gray-500",children:ye.previous}),"  ",l.jsx("span",{className:"font-medium",children:ye.current})]})]},Qe))})]}),T&&l.jsxs("div",{className:"card border-2 border-purple-200",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(x7,{className:"w-5 h-5 text-purple-600"})," Ask About Your Report"]}),l.jsxs("div",{className:"h-48 overflow-y-auto mb-4 space-y-3 p-3 bg-gray-50 rounded-xl",children:[d.length===0&&l.jsx("p",{className:"text-gray-500 text-center py-6",children:'Try: "What does my cholesterol mean?" or "Should I be worried?"'}),d.map((ye,Qe)=>l.jsx("div",{className:`flex ${ye.role==="user"?"justify-end":"justify-start"}`,children:l.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${ye.role==="user"?"bg-purple-600 text-white":"bg-white border"}`,children:ye.content})},Qe)),l.jsx("div",{ref:Me})]}),l.jsxs("form",{onSubmit:et,className:"flex gap-2",children:[l.jsx("input",{type:"text",value:m,onChange:ye=>y(ye.target.value),placeholder:"Ask a question...",className:"input flex-1"}),l.jsx("button",{type:"submit",className:"btn-primary px-4",children:l.jsx(Bm,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(ir,{className:"w-5 h-5 text-primary-600"})," Summary"]}),l.jsx("p",{className:"text-gray-700",children:zo.summary})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Metrics"}),l.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(zo.metrics).map(([ye,Qe])=>l.jsxs("div",{className:`p-4 rounded-xl ${Qe.status==="normal"?"bg-green-50":"bg-yellow-50"}`,children:[l.jsx("p",{className:"text-sm text-gray-600 capitalize",children:ye.replace(/([A-Z])/g," $1")}),l.jsxs("p",{className:"text-xl font-bold",children:[Qe.value," ",Qe.unit]}),l.jsxs("p",{className:"text-xs text-gray-500",children:["Normal: ",Qe.normalRange]}),l.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${Qe.status==="normal"?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,children:Qe.status})]},ye))})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(Pi,{className:"w-5 h-5 text-blue-600"})," Key Findings"]}),l.jsx("ul",{className:"space-y-2",children:zo.keyFindings.map((ye,Qe)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),ye]},Qe))})]}),l.jsxs("div",{className:"card border-l-4 border-orange-400",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(Yw,{className:"w-5 h-5 text-orange-600"})," Risk Factors"]}),l.jsx("ul",{className:"space-y-2",children:zo.riskFactors.map((ye,Qe)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full mt-2"}),ye]},Qe))})]})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(nc,{className:"w-5 h-5 text-green-600"})," Diet"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:zo.recommendations.diet.map((ye,Qe)=>l.jsxs("div",{className:"p-4 bg-green-50 rounded-xl",children:[l.jsxs("div",{className:"flex justify-between mb-2",children:[l.jsx("span",{className:"font-medium text-green-800",children:ye.item}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${ye.priority==="high"?"bg-green-200 text-green-800":"bg-gray-200"}`,children:ye.priority})]}),l.jsx("p",{className:"text-sm text-green-700",children:ye.reason})]},Qe))})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(bP,{className:"w-5 h-5 text-blue-600"})," Exercise"]}),zo.recommendations.exercise.map((ye,Qe)=>l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl mb-3",children:[l.jsxs("div",{className:"flex justify-between mb-2",children:[l.jsx("span",{className:"font-medium text-blue-800",children:ye.activity}),l.jsxs("span",{className:"text-sm text-blue-600",children:[ye.duration,"  ",ye.frequency]})]}),l.jsx("p",{className:"text-sm text-blue-700",children:ye.reason})]},Qe))]}),l.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(om,{className:"w-5 h-5 text-primary-600"})," Recommended Doctors"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:tk.filter(ye=>zo.doctorConsultation.specializations.includes(ye.specialization)).map(ye=>l.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:ye.name.split(" ")[1][0]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:ye.name}),l.jsx("p",{className:"text-sm text-primary-600",children:ye.specialization})]})]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[l.jsx(zc,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),ye.rating,"  ",l.jsx(ic,{className:"w-4 h-4"}),ye.experience," yrs"]}),l.jsxs("div",{className:"flex justify-between mt-3 pt-3 border-t",children:[l.jsxs("span",{className:"font-semibold",children:["",ye.fee]}),l.jsx("button",{onClick:()=>{D(ye),n("doctors")},className:"text-sm bg-primary-600 text-white px-3 py-1.5 rounded-lg hover:bg-primary-700",children:"Book Now"})]})]},ye._id))})]})]}),At=()=>l.jsxs("aside",{className:"w-64 bg-white border-r border-gray-200 fixed h-full flex flex-col",children:[l.jsxs("div",{className:"p-6",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-10 h-10 gradient-bg rounded-xl flex items-center justify-center",children:l.jsx(ir,{className:"w-6 h-6 text-white"})}),l.jsx("span",{className:"text-xl font-bold text-gray-900",children:"HealthAI"})]}),l.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Demo Mode"})]}),l.jsx("nav",{className:"px-4 space-y-1 flex-1",children:[{id:"dashboard",icon:fTe,label:"Dashboard"},{id:"upload",icon:co,label:"Upload Report"},{id:"report",icon:li,label:"Report & Chat"},{id:"doctors",icon:om,label:"Doctors"},{id:"profile",icon:Kc,label:"Profile"}].map(ye=>l.jsxs("button",{onClick:()=>n(ye.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${e===ye.id?"bg-primary-50 text-primary-600":"text-gray-600 hover:bg-gray-50"}`,children:[l.jsx(ye.icon,{className:"w-5 h-5"}),l.jsx("span",{className:"font-medium",children:ye.label})]},ye.id))}),l.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:l.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a,onChange:ye=>o(ye.target.checked),className:"w-4 h-4 text-primary-600 rounded"}),l.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Admin Mode"}),l.jsx(Gm,{className:"w-4 h-4 text-gray-400"})]})}),l.jsx("div",{className:"p-4 border-t border-gray-100",children:l.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[l.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:l.jsx("span",{className:"text-primary-600 font-semibold",children:"J"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a?"Admin User":"John Doe"}),l.jsx("p",{className:"text-xs text-gray-500 truncate",children:a?"admin@healthai.com":"john@example.com"})]}),l.jsx(c2,{className:"w-5 h-5 text-gray-400"})]})})]});return l.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[l.jsx(At,{}),l.jsxs("main",{className:"flex-1 ml-64 p-8",children:[e==="dashboard"&&l.jsx(lt,{}),e==="upload"&&l.jsx(Et,{}),e==="report"&&l.jsx($t,{}),e==="doctors"&&l.jsx(Ae,{}),e==="profile"&&l.jsx(Xe,{})]}),l.jsx(wt,{})]})}function eKe(){const[e,n]=Y.useState(null),[a,o]=Y.useState(!0),[d,p]=Y.useState("overview");Y.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:b}=await Fx.getStats();n(b)}catch{it.error("Failed to load stats")}finally{o(!1)}};if(a)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"})});const y=[{id:"overview",label:"Overview",icon:ir},{id:"doctors",label:"Doctors",icon:BJ}];return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Admin Dashboard"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Manage platform settings and monitor activity"})]}),l.jsx("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:y.map(({id:b,label:E,icon:T})=>l.jsxs("button",{onClick:()=>p(b),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${d===b?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(T,{className:"w-4 h-4"}),l.jsx("span",{children:E})]},b))}),d==="overview"&&l.jsx(tKe,{stats:e}),d==="doctors"&&l.jsx(nKe,{})]})}function tKe({stats:e}){var n,a,o,d;return e?l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:l.jsx(om,{className:"w-5 h-5 text-blue-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Total Patients"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((n=e.stats)==null?void 0:n.totalUsers)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:l.jsx(ua,{className:"w-5 h-5 text-green-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Active Users"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((a=e.stats)==null?void 0:a.activeUsers)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:l.jsx(li,{className:"w-5 h-5 text-purple-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Total Reports"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((o=e.stats)==null?void 0:o.totalReports)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:l.jsx(go,{className:"w-5 h-5 text-amber-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Pending Doctors"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((d=e.stats)==null?void 0:d.pendingDoctors)||0})]})]}):null}function nKe(){const[e,n]=Y.useState([]),[a,o]=Y.useState(!0),[d,p]=Y.useState("all");Y.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:w}=await Fx.getDoctors();n(w.doctors||[])}catch{it.error("Failed to load doctors")}finally{o(!1)}},y=async w=>{try{await Fx.approveDoctor(w),n(e.map(N=>N._id===w?{...N,approvalStatus:"approved",isListed:!0}:N)),it.success("Doctor approved!")}catch{it.error("Failed to approve")}},b=async w=>{try{await Fx.rejectDoctor(w),n(e.map(N=>N._id===w?{...N,approvalStatus:"rejected",isListed:!1}:N)),it.success("Doctor rejected")}catch{it.error("Failed to reject")}},E=e.filter(w=>d==="all"?!0:w.approvalStatus===d),T=e.filter(w=>w.approvalStatus==="pending").length;return a?l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 animate-pulse h-64"}):l.jsxs("div",{className:"space-y-4",children:[T>0&&l.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-center gap-4",children:[l.jsx(go,{className:"w-6 h-6 text-amber-500"}),l.jsx("div",{className:"flex-1",children:l.jsxs("p",{className:"font-medium text-amber-800",children:[T," Doctor(s) Pending Approval"]})}),l.jsx("button",{onClick:()=>p("pending"),className:"px-4 py-2 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600",children:"Review"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Doctor Management"}),l.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(w=>l.jsx("button",{onClick:()=>p(w),className:`px-3 py-1.5 rounded-lg text-sm font-medium capitalize ${d===w?"bg-cyan-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:w},w))})]}),l.jsxs("div",{className:"space-y-3",children:[E.map(w=>{var N,D;return l.jsx("div",{className:`p-4 rounded-xl border ${w.approvalStatus==="pending"?"bg-amber-50 border-amber-200":w.approvalStatus==="rejected"?"bg-red-50 border-red-200":"bg-slate-50 border-slate-200"}`,children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(D=(N=w.name)==null?void 0:N[0])==null?void 0:D.toUpperCase()}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",w.name]}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${w.approvalStatus==="approved"?"bg-green-100 text-green-700":w.approvalStatus==="rejected"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:w.approvalStatus})]}),l.jsx("p",{className:"text-sm text-cyan-600",children:w.specialization}),l.jsxs("p",{className:"text-xs text-slate-500",children:[w.experience," yrs  ",w.consultationFee||0]})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:w.approvalStatus==="pending"&&l.jsxs(l.Fragment,{children:[l.jsxs("button",{onClick:()=>y(w._id),className:"px-3 py-1.5 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 flex items-center gap-1",children:[l.jsx(ua,{className:"w-4 h-4"})," Approve"]}),l.jsxs("button",{onClick:()=>b(w._id),className:"px-3 py-1.5 bg-slate-200 text-red-600 text-sm font-medium rounded-lg hover:bg-slate-300 flex items-center gap-1",children:[l.jsx(GJ,{className:"w-4 h-4"})," Reject"]})]})})]})},w._id)}),E.length===0&&l.jsxs("div",{className:"text-center py-8 text-slate-500",children:[l.jsx(BJ,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),l.jsx("p",{children:"No doctors found"})]})]})]})]})}const rKe=[{id:"free",name:"Free",price:0,period:"forever",features:["1 Report analysis per month","Basic AI insights","View doctor listings","Email support"],color:"slate",icon:zc},{id:"basic",name:"Basic",price:0,period:"month",features:["5 Report analyses per month","Full AI analysis with deficiencies","Personalized diet plans","Supplement recommendations","Health trend tracking","Priority support"],color:"cyan",icon:u2,popular:!0},{id:"premium",name:"Premium",price:0,period:"month",features:["Unlimited report analyses","Advanced AI insights","Personalized diet & exercise plans","Supplement recommendations","Health trend analytics","Chat with AI about reports","Doctor recommendations","24/7 Priority support"],color:"violet",icon:_P}];function iKe(){var E;const{user:e}=fa(),[n,a]=Y.useState(null),[o,d]=Y.useState(!0),[p,m]=Y.useState("monthly");Y.useEffect(()=>{y()},[]);const y=async()=>{try{const{data:T}=await Jwe.getSubscription();a(T)}catch{console.error("Failed to fetch subscription")}finally{d(!1)}},b=(n==null?void 0:n.plan)||((E=e==null?void 0:e.subscription)==null?void 0:E.plan)||"free";return o?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"})}):l.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-fade-in",children:[l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 bg-violet-500/20 text-violet-400 px-4 py-2 rounded-full text-sm font-semibold mb-4",children:[l.jsx(_P,{className:"w-4 h-4"}),"Subscription Plans"]}),l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Choose Your Plan"}),l.jsx("p",{className:"text-slate-400 max-w-lg mx-auto",children:"Unlock the full potential of AI-powered health insights with our premium plans"})]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:l.jsx(_P,{className:"w-7 h-7"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white/70 text-sm",children:"Current Plan"}),l.jsx("h2",{className:"text-2xl font-bold capitalize",children:b})]})]}),l.jsxs("div",{className:"flex items-center gap-6",children:[(n==null?void 0:n.endDate)&&l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-white/70 text-sm",children:"Renewal Date"}),l.jsx("p",{className:"font-semibold",children:new Date(n.endDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl",children:[l.jsx(ki,{className:"w-4 h-4"}),l.jsx("span",{className:"font-medium capitalize",children:(n==null?void 0:n.status)||"Active"})]})]})]})]}),l.jsx("div",{className:"flex justify-center",children:l.jsxs("div",{className:"flex items-center gap-3 p-1 bg-slate-800 rounded-xl",children:[l.jsx("button",{onClick:()=>m("monthly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all ${p==="monthly"?"bg-slate-700 text-white":"text-slate-400"}`,children:"Monthly"}),l.jsxs("button",{onClick:()=>m("yearly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2 ${p==="yearly"?"bg-slate-700 text-white":"text-slate-400"}`,children:["Yearly",l.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded-full",children:"Save 20%"})]})]})}),l.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:rKe.map(T=>{const w=T.icon,N=b===T.id,D=p==="yearly"?Math.round(T.price*12*.8):T.price;return l.jsxs("div",{className:`bg-[#111827] rounded-2xl border p-6 relative ${T.popular?"border-cyan-500":"border-slate-700"} ${N?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-[#0a0f1a]":""}`,children:[T.popular&&l.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:l.jsx("span",{className:"bg-cyan-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg",children:"Most Popular"})}),l.jsxs("div",{className:"text-center mb-6 pt-2",children:[l.jsx("div",{className:`w-14 h-14 rounded-2xl mx-auto mb-4 flex items-center justify-center bg-${T.color}-500/20`,children:l.jsx(w,{className:`w-7 h-7 text-${T.color}-400`})}),l.jsx("h3",{className:"text-xl font-bold text-white",children:T.name}),l.jsxs("div",{className:"mt-4",children:[l.jsxs("span",{className:"text-4xl font-bold text-white",children:["",D]}),l.jsxs("span",{className:"text-slate-400",children:["/",p==="yearly"?"year":T.period]})]})]}),l.jsx("ul",{className:"space-y-3 mb-8",children:T.features.map((A,k)=>l.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[l.jsx("div",{className:`w-5 h-5 rounded-full bg-${T.color}-500/20 flex items-center justify-center flex-shrink-0 mt-0.5`,children:l.jsx(gh,{className:`w-3 h-3 text-${T.color}-400`})}),l.jsx("span",{className:"text-slate-400",children:A})]},k))}),l.jsx("button",{className:`w-full py-3 rounded-xl font-semibold transition-all ${N?"bg-slate-800 text-slate-500 cursor-default":T.popular?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:opacity-90":"border-2 border-slate-700 text-slate-300 hover:border-cyan-500 hover:text-cyan-400"}`,disabled:N,children:N?"Current Plan":T.price===0?"Downgrade":"Upgrade Now"})]},T.id)})}),l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:l.jsx(IJ,{className:"w-6 h-6 text-blue-400"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold text-white mb-2",children:"Secure Payment"}),l.jsx("p",{className:"text-slate-400 text-sm",children:"All payments are processed securely. You can upgrade, downgrade, or cancel your subscription at any time. Changes take effect immediately and unused time is prorated."})]})]})})]})}const Jv=[{id:"apple_watch",name:"Apple Watch",icon:_l,description:"Sync health data from your Apple Watch and iPhone",tags:["Heart Rate","Activity","Sleep"],color:"bg-slate-800",textColor:"text-slate-800"},{id:"google_fit",name:"Google Fit",icon:ir,description:"Aggregates data from Android devices and apps",tags:["Activity","Nutrition","Weight"],color:"bg-blue-500",textColor:"text-blue-600"},{id:"fitbit",name:"Fitbit",icon:u2,description:"Track steps, heart rate, and sleep patterns",tags:["Steps","Heart","Sleep"],color:"bg-cyan-500",textColor:"text-cyan-600"},{id:"garmin",name:"Garmin Connect",icon:Xa,description:"High-fidelity GPS and heart rate data",tags:["Cardio","GPS","Training"],color:"bg-indigo-600",textColor:"text-indigo-600"},{id:"samsung",name:"Samsung Health",icon:MJ,description:"Galaxy Watch and phone health data",tags:["Activity","Sleep","Stress"],color:"bg-purple-600",textColor:"text-purple-600"},{id:"oura",name:"Oura Ring",icon:Vm,description:"Advanced sleep and recovery tracking",tags:["Sleep","Recovery","HRV"],color:"bg-slate-700",textColor:"text-slate-700"}];function aKe(){const[e,n]=Y.useState([]),[a,o]=Y.useState(!0),[d,p]=Y.useState(!1),[m,y]=Y.useState(!1),[b,E]=Y.useState(null);Y.useEffect(()=>{T()},[]);const T=async()=>{try{const{data:O}=await Sf.getDashboard();O.devices&&n(O.devices)}catch(O){console.error("Failed to fetch devices:",O)}finally{o(!1)}},w=async()=>{p(!0);try{e.length>0?(await Sf.generateDemoData(e[0].type),await T(),it.success("All devices synced successfully!")):it.error("No devices connected")}catch(O){console.error("Sync failed:",O),it.error("Failed to sync devices")}finally{p(!1)}},N=async O=>{try{const F=Jv.find(M=>M.id===O);await Sf.connectDevice(O,F==null?void 0:F.name),await Sf.generateDemoData(O),await T(),y(!1),it.success(`${F==null?void 0:F.name} connected successfully!`)}catch(F){console.error("Failed to connect:",F),it.error("Failed to connect device")}},D=async O=>{try{await Sf.disconnectDevice(O),await T(),it.success("Device disconnected")}catch(F){console.error("Failed to disconnect:",F),it.error("Failed to disconnect device")}},A=O=>{const F=Jv.find(M=>M.id===O);return(F==null?void 0:F.icon)||_l},k=O=>{const F=Jv.find(M=>M.id===O);return(F==null?void 0:F.color)||"bg-slate-600"};return a?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading devices..."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Connected Devices"}),l.jsxs("p",{className:"text-slate-500 mt-1 flex items-center gap-2",children:[l.jsx(ic,{className:"w-4 h-4"}),"Last synced: ",new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsxs("button",{onClick:w,disabled:d||e.length===0,className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl hover:bg-slate-50 transition-all disabled:opacity-50",children:[l.jsx(STe,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Sync All"]}),l.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl hover:shadow-lg transition-all",children:[l.jsx(Wc,{className:"w-4 h-4"}),"Add Device"]})]})]}),e.length===0&&l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 flex items-start gap-3",children:[l.jsx("div",{className:"w-6 h-6 rounded-full bg-cyan-100 flex items-center justify-center shrink-0 mt-0.5",children:l.jsx(go,{className:"w-4 h-4 text-cyan-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-cyan-900 font-medium",children:"No devices connected yet"}),l.jsx("p",{className:"text-cyan-700 text-sm mt-1",children:"Connect your wearable devices to automatically track your health metrics and get personalized insights."})]})]}),e.length>0&&l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(gTe,{className:"w-5 h-5 text-slate-600"}),l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Your Devices"}),l.jsxs("span",{className:"px-2 py-0.5 bg-cyan-100 text-cyan-700 rounded-full text-xs font-medium",children:[e.length," connected"]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map((O,F)=>{const M=A(O.type),V=k(O.type),H=Math.floor(Math.random()*50)+50;return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[l.jsxs("div",{className:"flex items-start justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-12 h-12 rounded-xl ${V} flex items-center justify-center`,children:l.jsx(M,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-slate-800 font-semibold",children:O.name}),l.jsx("p",{className:"text-slate-500 text-sm",children:O.type})]})]}),l.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:[l.jsx(ua,{className:"w-3 h-3"}),"Active"]})]}),l.jsx("div",{className:"flex gap-1 mb-4 h-16 bg-slate-50 rounded-lg p-2",children:[...Array(7)].map((B,z)=>{const q=30+Math.random()*70;return l.jsx("div",{className:"flex-1 bg-gradient-to-t from-cyan-500 to-blue-500 rounded-sm",style:{height:`${q}%`,marginTop:"auto"}},z)})}),l.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-200",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(Pi,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Heart"})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(DJ,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Steps"})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(Vm,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Sleep"})]})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-500 text-xs",children:[l.jsx(rTe,{className:"w-4 h-4"}),H,"%"]})]}),l.jsxs("div",{className:"mt-4 flex gap-2",children:[l.jsx("button",{onClick:()=>w(),className:"flex-1 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm font-medium",children:"Sync Now"}),l.jsx("button",{onClick:()=>D(O.type),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm",children:"Disconnect"})]})]},F)})})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(_l,{className:"w-5 h-5 text-slate-600"}),l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Available Integrations"})]})}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Jv.map(O=>{const F=O.icon,M=e.some(V=>V.type===O.id);return l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[l.jsx("div",{className:`w-12 h-12 rounded-xl ${O.color} flex items-center justify-center shrink-0`,children:l.jsx(F,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("p",{className:"text-slate-800 font-semibold",children:O.name}),M&&l.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:"Connected"})]}),l.jsx("p",{className:"text-slate-500 text-sm mb-3",children:O.description}),l.jsx("div",{className:"flex flex-wrap gap-2",children:O.tags.map(V=>l.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded-lg text-slate-600 text-xs",children:V},V))})]})]}),l.jsx("button",{onClick:()=>M?D(O.id):N(O.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${M?"bg-slate-100 text-slate-700 hover:bg-slate-200":"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:shadow-lg"}`,children:M?"Disconnect":"Connect"})]})},O.id)})})]}),m&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-fade-in",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Connect a Device"}),l.jsx("button",{onClick:()=>y(!1),className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-slate-200 transition-colors",children:l.jsx(ha,{className:"w-5 h-5"})})]}),l.jsx("p",{className:"text-slate-500 mb-6",children:"Select a device or service to connect"}),l.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:Jv.map(O=>{const F=O.icon,M=e.some(V=>V.type===O.id);return l.jsxs("button",{onClick:()=>!M&&N(O.id),disabled:M,className:`w-full p-4 border rounded-xl transition-all flex items-center gap-4 text-left ${M?"bg-slate-50 border-slate-200 opacity-60 cursor-not-allowed":"bg-white border-slate-200 hover:border-cyan-500 hover:shadow-sm"}`,children:[l.jsx("div",{className:`w-10 h-10 rounded-xl ${O.color} flex items-center justify-center shrink-0`,children:l.jsx(F,{className:"w-5 h-5 text-white"})}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("p",{className:"text-slate-800 font-medium",children:O.name}),M&&l.jsx(ua,{className:"w-4 h-4 text-emerald-500"})]}),l.jsx("p",{className:"text-slate-500 text-sm",children:O.description})]})]},O.id)})})]})})]})}function sKe(){var k,O,F,M,V,H,B,z,q,Q,ee,oe,ne,ue,Se,fe,we,he,be;const{patientId:e}=Vw(),[n]=Dxe(),a=n.get("appointmentId"),[o,d]=Y.useState(null),[p,m]=Y.useState(!0),[y,b]=Y.useState("overview");if(Y.useEffect(()=>{(async()=>{try{const{data:de}=await qa.getPatientProfile(e,a);d(de)}catch(de){console.error("Failed to fetch patient profile:",de)}finally{m(!1)}})()},[e,a]),p)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:"Loading patient profile..."})]})});if(!o)return l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 text-center py-16",children:[l.jsx("p",{className:"text-slate-400",children:"Patient not found or access denied."}),l.jsx(un,{to:"/doctors",className:"mt-4 inline-block px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl",children:"Go Back"})]});const{patient:E,healthSummary:T,healthReports:w,wearableSummary:N,appointmentHistory:D}=o,A=[{id:"overview",label:"Overview",icon:Kc},{id:"reports",label:"Health Reports",icon:li},{id:"wearables",label:"Wearable Data",icon:_l},{id:"history",label:"Appointment History",icon:ki}];return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs(un,{to:"/doctor/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors",children:[l.jsx(oo,{className:"w-4 h-4"}),"Back to Dashboard"]}),l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-6",children:[l.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-white text-3xl font-bold",children:(O=(k=E.name)==null?void 0:k.charAt(0))==null?void 0:O.toUpperCase()}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h1",{className:"text-2xl font-bold text-white",children:E.name}),l.jsxs("div",{className:"flex flex-wrap gap-4 mt-2 text-sm text-slate-400",children:[E.email&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(P_,{className:"w-4 h-4"})," ",E.email]}),E.phone&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(d2,{className:"w-4 h-4"})," ",E.phone]}),((F=E.profile)==null?void 0:F.age)&&l.jsxs("span",{children:[E.profile.age," years old"]}),((M=E.profile)==null?void 0:M.gender)&&l.jsx("span",{className:"capitalize",children:E.profile.gender})]})]}),(T==null?void 0:T.healthScore)&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`text-4xl font-bold ${T.healthScore>=80?"text-emerald-400":T.healthScore>=60?"text-amber-400":"text-red-400"}`,children:T.healthScore}),l.jsx("p",{className:"text-sm text-slate-400",children:"Health Score"})]})]})}),l.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:A.map(ae=>l.jsxs("button",{onClick:()=>b(ae.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all whitespace-nowrap ${y===ae.id?"bg-cyan-500 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:[l.jsx(ae.icon,{className:"w-4 h-4"}),ae.label]},ae.id))}),y==="overview"&&l.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(Kc,{className:"w-5 h-5 text-cyan-400"})," Basic Information"]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[((V=E.profile)==null?void 0:V.height)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Height"}),l.jsxs("p",{className:"font-semibold text-white",children:[E.profile.height," cm"]})]}),((H=E.profile)==null?void 0:H.weight)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Weight"}),l.jsxs("p",{className:"font-semibold text-white",children:[E.profile.weight," kg"]})]}),((B=E.profile)==null?void 0:B.bloodGroup)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Blood Group"}),l.jsx("p",{className:"font-semibold text-white",children:E.profile.bloodGroup})]}),((z=E.healthMetrics)==null?void 0:z.bmi)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"BMI"}),l.jsx("p",{className:"font-semibold text-white",children:E.healthMetrics.bmi.toFixed(1)})]})]}),((Q=(q=E.profile)==null?void 0:q.allergies)==null?void 0:Q.length)>0&&l.jsxs("div",{className:"mt-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Allergies"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:E.profile.allergies.map((ae,de)=>l.jsx("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:ae},de))})]}),((oe=(ee=E.profile)==null?void 0:ee.chronicConditions)==null?void 0:oe.length)>0&&l.jsxs("div",{className:"mt-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Chronic Conditions"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:E.profile.chronicConditions.map((ae,de)=>l.jsx("span",{className:"px-3 py-1 bg-amber-500/20 text-amber-400 rounded-full text-sm",children:ae},de))})]})]}),T&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(Pi,{className:"w-5 h-5 text-red-400"})," Health Summary"]}),((ne=T.deficiencies)==null?void 0:ne.length)>0&&l.jsxs("div",{className:"mb-4",children:[l.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["Deficiencies (",T.deficiencies.length,")"]}),l.jsx("div",{className:"space-y-2",children:T.deficiencies.slice(0,3).map((ae,de)=>{var Me,et,Re;const xe=typeof ae.currentValue=="object"?((Me=ae.currentValue)==null?void 0:Me.value)||JSON.stringify(ae.currentValue):ae.currentValue,Ue=typeof ae.normalRange=="object"?((et=ae.normalRange)==null?void 0:et.value)||JSON.stringify(ae.normalRange):ae.normalRange;return l.jsxs("div",{className:`p-3 rounded-xl ${ae.severity==="severe"?"bg-red-500/10 border border-red-500/30":ae.severity==="moderate"?"bg-amber-500/10 border border-amber-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"font-medium text-white",children:typeof ae.name=="object"?((Re=ae.name)==null?void 0:Re.value)||"Unknown":ae.name}),l.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${ae.severity==="severe"?"bg-red-500/20 text-red-400":ae.severity==="moderate"?"bg-amber-500/20 text-amber-400":"bg-yellow-500/20 text-yellow-400"}`,children:ae.severity})]}),l.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Current: ",xe," | Normal: ",Ue]})]},de)})})]}),((ue=T.riskFactors)==null?void 0:ue.length)>0&&l.jsxs("div",{className:"mb-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Risk Factors"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:T.riskFactors.map((ae,de)=>l.jsx("span",{className:"px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm",children:typeof ae=="object"?(ae==null?void 0:ae.name)||(ae==null?void 0:ae.value)||JSON.stringify(ae):ae},de))})]}),((Se=T.keyFindings)==null?void 0:Se.length)>0&&l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Key Findings"}),l.jsx("ul",{className:"space-y-1",children:T.keyFindings.slice(0,4).map((ae,de)=>{const xe=typeof ae=="object"?(ae==null?void 0:ae.title)||(ae==null?void 0:ae.finding)||(ae==null?void 0:ae.value)||JSON.stringify(ae):ae;return l.jsxs("li",{className:"text-sm text-slate-300 flex items-start gap-2",children:[l.jsx("span",{className:"text-cyan-400 mt-1",children:""}),xe]},de)})})]})]}),N&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 lg:col-span-2",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(_l,{className:"w-5 h-5 text-blue-400"})," Wearable Data Summary"]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"p-4 bg-blue-500/10 rounded-xl text-center border border-blue-500/20",children:[l.jsx(ir,{className:"w-6 h-6 text-blue-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:((fe=N.avgSteps)==null?void 0:fe.toLocaleString())||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Steps/Day"})]}),l.jsxs("div",{className:"p-4 bg-red-500/10 rounded-xl text-center border border-red-500/20",children:[l.jsx(Pi,{className:"w-6 h-6 text-red-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:N.avgHeartRate||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Heart Rate"})]}),l.jsxs("div",{className:"p-4 bg-indigo-500/10 rounded-xl text-center border border-indigo-500/20",children:[l.jsx(ic,{className:"w-6 h-6 text-indigo-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:N.avgSleepHours||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Sleep (hrs)"})]}),l.jsxs("div",{className:"p-4 bg-emerald-500/10 rounded-xl text-center border border-emerald-500/20",children:[l.jsx(_l,{className:"w-6 h-6 text-emerald-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:((we=N.devices)==null?void 0:we.length)||0}),l.jsx("p",{className:"text-sm text-slate-400",children:"Connected Devices"})]})]})]})]}),y==="reports"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Health Reports"}),(w==null?void 0:w.length)>0?l.jsx("div",{className:"space-y-3",children:w.map(ae=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-700 flex items-center justify-center",children:l.jsx(li,{className:"w-6 h-6 text-slate-400"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-white",children:ae.reportType}),l.jsx("p",{className:"text-sm text-slate-400",children:new Date(ae.createdAt).toLocaleDateString()})]})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[ae.healthScore&&l.jsxs("span",{className:`font-bold ${ae.healthScore>=80?"text-emerald-400":ae.healthScore>=60?"text-amber-400":"text-red-400"}`,children:["Score: ",ae.healthScore]}),l.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${ae.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,children:ae.status})]})]},ae._id))}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No health reports available"})]}),y==="wearables"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Wearable Device Data"}),N?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Connected Devices"}),l.jsx("div",{className:"flex flex-wrap gap-3",children:(he=N.devices)==null?void 0:he.map((ae,de)=>l.jsxs("div",{className:"px-4 py-2 bg-cyan-500/10 border border-cyan-500/20 rounded-xl flex items-center gap-2",children:[l.jsx(_l,{className:"w-4 h-4 text-cyan-400"}),l.jsx("span",{className:"font-medium text-cyan-300",children:ae.name||ae.type})]},de))})]}),((be=N.recentMetrics)==null?void 0:be.length)>0&&l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Recent Activity (Last 7 Days)"}),l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full text-sm",children:[l.jsx("thead",{children:l.jsxs("tr",{className:"border-b border-slate-700",children:[l.jsx("th",{className:"text-left py-2 text-slate-400 font-medium",children:"Date"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Steps"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Calories"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Active Min"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Distance"})]})}),l.jsx("tbody",{children:N.recentMetrics.map((ae,de)=>{var xe,Ue;return l.jsxs("tr",{className:"border-b border-slate-700/50",children:[l.jsx("td",{className:"py-2 text-white",children:new Date(ae.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:(xe=ae.steps)==null?void 0:xe.toLocaleString()}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:ae.caloriesBurned}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:ae.activeMinutes}),l.jsxs("td",{className:"py-2 text-right text-slate-300",children:[(Ue=ae.distance)==null?void 0:Ue.toFixed(1)," km"]})]},de)})})]})})]})]}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No wearable data available"})]}),y==="history"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Appointment History"}),(D==null?void 0:D.length)>0?l.jsx("div",{className:"space-y-3",children:D.map(ae=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(ki,{className:"w-5 h-5 text-slate-400"}),l.jsx("span",{className:"font-semibold text-white",children:new Date(ae.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),l.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${ae.status==="completed"?"bg-emerald-500/20 text-emerald-400":ae.status==="scheduled"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}`,children:ae.status})]}),ae.doctor&&l.jsxs("p",{className:"text-sm text-slate-400",children:["Dr. ",ae.doctor.name," - ",ae.doctor.specialization]}),ae.symptoms&&l.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:[l.jsx("span",{className:"font-medium text-slate-400",children:"Symptoms:"})," ",ae.symptoms]}),ae.notes&&l.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[l.jsx("span",{className:"font-medium text-slate-400",children:"Notes:"})," ",ae.notes]})]},ae._id))}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No appointment history"})]})]})}var Ute={exports:{}};(function(e,n){(function(a,o){e.exports=o()})(Id,function(){function a(t,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(s){if(s!=="default"&&!(s in t)){var c=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(t,s,c.get?c:{enumerable:!0,get:function(){return i[s]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Id<"u"?Id:typeof self<"u"?self:{};function d(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var p=function(t){try{return!!t()}catch{return!0}},m=!p(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),y=m,b=Function.prototype,E=b.call,T=y&&b.bind.bind(E,E),w=y?T:function(t){return function(){return E.apply(t,arguments)}},N=w({}.isPrototypeOf),D=function(t){return t&&t.Math===Math&&t},A=D(typeof globalThis=="object"&&globalThis)||D(typeof window=="object"&&window)||D(typeof self=="object"&&self)||D(typeof o=="object"&&o)||D(typeof o=="object"&&o)||function(){return this}()||Function("return this")(),k=m,O=Function.prototype,F=O.apply,M=O.call,V=typeof Reflect=="object"&&Reflect.apply||(k?M.bind(F):function(){return M.apply(F,arguments)}),H=w,B=H({}.toString),z=H("".slice),q=function(t){return z(B(t),8,-1)},Q=q,ee=w,oe=function(t){if(Q(t)==="Function")return ee(t)},ne=typeof document=="object"&&document.all,ue=ne===void 0&&ne!==void 0?function(t){return typeof t=="function"||t===ne}:function(t){return typeof t=="function"},Se={},fe=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),we=m,he=Function.prototype.call,be=we?he.bind(he):function(){return he.apply(he,arguments)},ae={},de={}.propertyIsEnumerable,xe=Object.getOwnPropertyDescriptor,Ue=xe&&!de.call({1:2},1);ae.f=Ue?function(t){var r=xe(this,t);return!!r&&r.enumerable}:de;var Me,et,Re=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},nt=p,ut=q,Kt=Object,Rn=w("".split),Pe=nt(function(){return!Kt("z").propertyIsEnumerable(0)})?function(t){return ut(t)==="String"?Rn(t,""):Kt(t)}:Kt,lt=function(t){return t==null},Et=lt,Ae=TypeError,wt=function(t){if(Et(t))throw new Ae("Can't call method on "+t);return t},Xe=Pe,$t=wt,At=function(t){return Xe($t(t))},ye=ue,Qe=function(t){return typeof t=="object"?t!==null:ye(t)},Wt={},ui=Wt,ma=A,Oa=ue,oc=function(t){return Oa(t)?t:void 0},tt=function(t,r){return arguments.length<2?oc(ui[t])||oc(ma[t]):ui[t]&&ui[t][r]||ma[t]&&ma[t][r]},Lt=A.navigator,mr=Lt&&Lt.userAgent,Wn=mr?String(mr):"",Ke=A,xt=Wn,Dn=Ke.process,ni=Ke.Deno,Pa=Dn&&Dn.versions||ni&&ni.version,Ji=Pa&&Pa.v8;Ji&&(et=(Me=Ji.split("."))[0]>0&&Me[0]<4?1:+(Me[0]+Me[1])),!et&&xt&&(!(Me=xt.match(/Edge\/(\d+)/))||Me[1]>=74)&&(Me=xt.match(/Chrome\/(\d+)/))&&(et=+Me[1]);var gr=et,Xr=gr,ou=p,cu=A.String,cc=!!Object.getOwnPropertySymbols&&!ou(function(){var t=Symbol("symbol detection");return!cu(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Xr&&Xr<41}),G_=cc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Bte=tt,Gte=ue,Wte=N,$te=Object,ig=G_?function(t){return typeof t=="symbol"}:function(t){var r=Bte("Symbol");return Gte(r)&&Wte(r.prototype,$te(t))},Hte=String,Xh=function(t){try{return Hte(t)}catch{return"Object"}},zte=ue,Kte=Xh,Yte=TypeError,Da=function(t){if(zte(t))return t;throw new Yte(Kte(t)+" is not a function")},qte=Da,Xte=lt,ag=function(t,r){var i=t[r];return Xte(i)?void 0:qte(i)},_j=be,bj=ue,Ej=Qe,Jte=TypeError,xj={exports:{}},Sj=A,Qte=Object.defineProperty,Zte=A,ene=function(t,r){try{Qte(Sj,t,{value:r,configurable:!0,writable:!0})}catch{Sj[t]=r}return r},wj="__core-js_shared__",Tj=xj.exports=Zte[wj]||ene(wj,{});(Tj.versions||(Tj.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var FT=xj.exports,Cj=FT,Jh=function(t,r){return Cj[t]||(Cj[t]=r||{})},tne=wt,nne=Object,lc=function(t){return nne(tne(t))},rne=lc,ine=w({}.hasOwnProperty),ri=Object.hasOwn||function(t,r){return ine(rne(t),r)},ane=w,sne=0,one=Math.random(),cne=ane(1.1.toString),VT=function(t){return"Symbol("+(t===void 0?"":t)+")_"+cne(++sne+one,36)},lne=Jh,Nj=ri,dne=VT,une=cc,hne=G_,Qh=A.Symbol,BT=lne("wks"),pne=hne?Qh.for||Qh:Qh&&Qh.withoutSetter||dne,Zn=function(t){return Nj(BT,t)||(BT[t]=une&&Nj(Qh,t)?Qh[t]:pne("Symbol."+t)),BT[t]},fne=be,Rj=Qe,Aj=ig,mne=ag,gne=function(t,r){var i,s;if(bj(i=t.toString)&&!Ej(s=_j(i,t))||bj(i=t.valueOf)&&!Ej(s=_j(i,t)))return s;throw new Jte("Can't convert object to primitive value")},vne=TypeError,yne=Zn("toPrimitive"),_ne=function(t,r){if(!Rj(t)||Aj(t))return t;var i,s=mne(t,yne);if(s){if(i=fne(s,t,r),!Rj(i)||Aj(i))return i;throw new vne("Can't convert object to primitive value")}return gne(t)},bne=ig,GT=function(t){var r=_ne(t,"string");return bne(r)?r:r+""},Ij=Qe,WT=A.document,Ene=Ij(WT)&&Ij(WT.createElement),$T=function(t){return Ene?WT.createElement(t):{}},xne=$T,Oj=!fe&&!p(function(){return Object.defineProperty(xne("div"),"a",{get:function(){return 7}}).a!==7}),Sne=fe,wne=be,Tne=ae,Cne=Re,Nne=At,Rne=GT,Ane=ri,Ine=Oj,Pj=Object.getOwnPropertyDescriptor;Se.f=Sne?Pj:function(t,r){if(t=Nne(t),r=Rne(r),Ine)try{return Pj(t,r)}catch{}if(Ane(t,r))return Cne(!wne(Tne.f,t,r),t[r])};var One=p,Pne=ue,Dne=/#|\.prototype\./,sg=function(t,r){var i=jne[kne(t)];return i===Mne||i!==Lne&&(Pne(r)?One(r):!!r)},kne=sg.normalize=function(t){return String(t).replace(Dne,".").toLowerCase()},jne=sg.data={},Lne=sg.NATIVE="N",Mne=sg.POLYFILL="P",Dj=sg,Une=Da,Fne=m,Vne=oe(oe.bind),Wl=function(t,r){return Une(t),r===void 0?t:Fne?Vne(t,r):function(){return t.apply(r,arguments)}},Is={},kj=fe&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Bne=Qe,Gne=String,Wne=TypeError,ga=function(t){if(Bne(t))return t;throw new Wne(Gne(t)+" is not an object")},$ne=fe,Hne=Oj,zne=kj,W_=ga,jj=GT,Kne=TypeError,HT=Object.defineProperty,Yne=Object.getOwnPropertyDescriptor,zT="enumerable",KT="configurable",YT="writable";Is.f=$ne?zne?function(t,r,i){if(W_(t),r=jj(r),W_(i),typeof t=="function"&&r==="prototype"&&"value"in i&&YT in i&&!i[YT]){var s=Yne(t,r);s&&s[YT]&&(t[r]=i.value,i={configurable:KT in i?i[KT]:s[KT],enumerable:zT in i?i[zT]:s[zT],writable:!1})}return HT(t,r,i)}:HT:function(t,r,i){if(W_(t),r=jj(r),W_(i),Hne)try{return HT(t,r,i)}catch{}if("get"in i||"set"in i)throw new Kne("Accessors not supported");return"value"in i&&(t[r]=i.value),t};var qne=Is,Xne=Re,lu=fe?function(t,r,i){return qne.f(t,r,Xne(1,i))}:function(t,r,i){return t[r]=i,t},og=A,Jne=V,Qne=oe,Zne=ue,ere=Se.f,tre=Dj,Zh=Wt,nre=Wl,ep=lu,Lj=ri,rre=function(t){var r=function(i,s,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(i);case 2:return new t(i,s)}return new t(i,s,c)}return Jne(t,this,arguments)};return r.prototype=t.prototype,r},Qt=function(t,r){var i,s,c,u,h,f,g,v,_,x=t.target,S=t.global,C=t.stat,U=t.proto,P=S?og:C?og[x]:og[x]&&og[x].prototype,j=S?Zh:Zh[x]||ep(Zh,x,{})[x],W=j.prototype;for(u in r)s=!(i=tre(S?u:x+(C?".":"#")+u,t.forced))&&P&&Lj(P,u),f=j[u],s&&(g=t.dontCallGetSet?(_=ere(P,u))&&_.value:P[u]),h=s&&g?g:r[u],(i||U||typeof f!=typeof h)&&(v=t.bind&&s?nre(h,og):t.wrap&&s?rre(h):U&&Zne(h)?Qne(h):h,(t.sham||h&&h.sham||f&&f.sham)&&ep(v,"sham",!0),ep(j,u,v),U&&(Lj(Zh,c=x+"Prototype")||ep(Zh,c,{}),ep(Zh[c],u,h),t.real&&W&&(i||!W[u])&&ep(W,u,h)))},ire=Math.ceil,are=Math.floor,sre=Math.trunc||function(t){var r=+t;return(r>0?are:ire)(r)},ore=sre,qT=function(t){var r=+t;return r!=r||r===0?0:ore(r)},cre=qT,lre=Math.max,dre=Math.min,XT=function(t,r){var i=cre(t);return i<0?lre(i+r,0):dre(i,r)},ure=qT,hre=Math.min,Mj=function(t){var r=ure(t);return r>0?hre(r,9007199254740991):0},pre=Mj,$l=function(t){return pre(t.length)},fre=At,mre=XT,gre=$l,Uj=function(t){return function(r,i,s){var c=fre(r),u=gre(c);if(u===0)return!t&&-1;var h,f=mre(s,u);if(t&&i!=i){for(;u>f;)if((h=c[f++])!=h)return!0}else for(;u>f;f++)if((t||f in c)&&c[f]===i)return t||f||0;return!t&&-1}},JT={includes:Uj(!0),indexOf:Uj(!1)},vre=JT.includes;Qt({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(t){return vre(this,t,arguments.length>1?arguments[1]:void 0)}});var yre=A,_re=Wt,is=function(t,r){var i=_re[t+"Prototype"],s=i&&i[r];if(s)return s;var c=yre[t],u=c&&c.prototype;return u&&u[r]},bre=is("Array","includes"),Ere=Qe,xre=q,Sre=Zn("match"),QT=function(t){var r;return Ere(t)&&((r=t[Sre])!==void 0?!!r:xre(t)==="RegExp")},wre=QT,Tre=TypeError,Fj={};Fj[Zn("toStringTag")]="z";var ZT=String(Fj)==="[object z]",Cre=ZT,Nre=ue,$_=q,Rre=Zn("toStringTag"),Are=Object,Ire=$_(function(){return arguments}())==="Arguments",Hl=Cre?$_:function(t){var r,i,s;return t===void 0?"Undefined":t===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(r=Are(t),Rre))=="string"?i:Ire?$_(r):(s=$_(r))==="Object"&&Nre(r.callee)?"Arguments":s},Ore=Hl,Pre=String,va=function(t){if(Ore(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return Pre(t)},Dre=Zn("match"),kre=Qt,jre=function(t){if(wre(t))throw new Tre("The method doesn't accept regular expressions");return t},Lre=wt,Vj=va,Mre=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[Dre]=!1,"/./"[t](r)}catch{}}return!1},Ure=w("".indexOf);kre({target:"String",proto:!0,forced:!Mre("includes")},{includes:function(t){return!!~Ure(Vj(Lre(this)),Vj(jre(t)),arguments.length>1?arguments[1]:void 0)}});var Fre=is("String","includes"),Bj=N,Vre=bre,Bre=Fre,eC=Array.prototype,tC=String.prototype,Gre=function(t){var r=t.includes;return t===eC||Bj(eC,t)&&r===eC.includes?Vre:typeof t=="string"||t===tC||Bj(tC,t)&&r===tC.includes?Bre:r},Te=d(Gre),Wre=Da,$re=lc,Hre=Pe,zre=$l,Gj=TypeError,Wj="Reduce of empty array with no initial value",Kre=function(t){return function(r,i,s,c){var u=$re(r),h=Hre(u),f=zre(u);if(Wre(i),f===0&&s<2)throw new Gj(Wj);var g=t?f-1:0,v=t?-1:1;if(s<2)for(;;){if(g in h){c=h[g],g+=v;break}if(g+=v,t?g<0:f<=g)throw new Gj(Wj)}for(;t?g>=0:f>g;g+=v)g in h&&(c=i(c,h[g],g,u));return c}},Yre={left:Kre(!1)},qre=p,H_=function(t,r){var i=[][t];return!!i&&qre(function(){i.call(null,r||function(){return 1},1)})},cg=A,Xre=Wn,Jre=q,z_=function(t){return Xre.slice(0,t.length)===t},nC=z_("Bun/")?"BUN":z_("Cloudflare-Workers")?"CLOUDFLARE":z_("Deno/")?"DENO":z_("Node.js/")?"NODE":cg.Bun&&typeof Bun.version=="string"?"BUN":cg.Deno&&typeof Deno.version=="object"?"DENO":Jre(cg.process)==="process"?"NODE":cg.window&&cg.document?"BROWSER":"REST",K_=nC==="NODE",Qre=Yre.left;Qt({target:"Array",proto:!0,forced:!K_&&gr>79&&gr<83||!H_("reduce")},{reduce:function(t){var r=arguments.length;return Qre(this,t,r,r>1?arguments[1]:void 0)}});var Zre=is("Array","reduce"),eie=N,tie=Zre,rC=Array.prototype,nie=function(t){var r=t.reduce;return t===rC||eie(rC,t)&&r===rC.reduce?tie:r},$j=nie,as=d($j),rie=q,lg=Array.isArray||function(t){return rie(t)==="Array"},iie=Qt,aie=lg,sie=w([].reverse),Hj=[1,2];iie({target:"Array",proto:!0,forced:String(Hj)===String(Hj.reverse())},{reverse:function(){return aie(this)&&(this.length=this.length),sie(this)}});var oie=is("Array","reverse"),cie=N,lie=oie,iC=Array.prototype,die=function(t){var r=t.reverse;return t===iC||cie(iC,t)&&r===iC.reverse?lie:r},zj=die,Kj=d(zj),uie=VT,Yj=Jh("keys"),Y_=function(t){return Yj[t]||(Yj[t]=uie(t))},hie=!p(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),pie=ri,fie=ue,mie=lc,gie=hie,qj=Y_("IE_PROTO"),aC=Object,vie=aC.prototype,sC=gie?aC.getPrototypeOf:function(t){var r=mie(t);if(pie(r,qj))return r[qj];var i=r.constructor;return fie(i)&&r instanceof i?i.prototype:r instanceof aC?vie:null},yie=w,_ie=Da,bie=Qe,Eie=function(t){return bie(t)||t===null},xie=String,Sie=TypeError,wie=function(t,r,i){try{return yie(_ie(Object.getOwnPropertyDescriptor(t,r)[i]))}catch{}},Tie=Qe,Cie=wt,Nie=function(t){if(Eie(t))return t;throw new Sie("Can't set "+xie(t)+" as a prototype")},Rie=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,i={};try{(t=wie(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(s,c){return Cie(s),Nie(c),Tie(s)&&(r?t(s,c):s.__proto__=c),s}}():void 0),q_={},X_={},oC=ri,Aie=At,Iie=JT.indexOf,Oie=X_,Xj=w([].push),Jj=function(t,r){var i,s=Aie(t),c=0,u=[];for(i in s)!oC(Oie,i)&&oC(s,i)&&Xj(u,i);for(;r.length>c;)oC(s,i=r[c++])&&(~Iie(u,i)||Xj(u,i));return u},cC=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Pie=Jj,Die=cC.concat("length","prototype");q_.f=Object.getOwnPropertyNames||function(t){return Pie(t,Die)};var dg={};dg.f=Object.getOwnPropertySymbols;var kie=tt,jie=q_,Lie=dg,Mie=ga,Uie=w([].concat),Fie=kie("Reflect","ownKeys")||function(t){var r=jie.f(Mie(t)),i=Lie.f;return i?Uie(r,i(t)):r},Qj=ri,Vie=Fie,Bie=Se,Gie=Is,lC={},Wie=Jj,$ie=cC,J_=Object.keys||function(t){return Wie(t,$ie)},Hie=fe,zie=kj,Kie=Is,Yie=ga,qie=At,Xie=J_;lC.f=Hie&&!zie?Object.defineProperties:function(t,r){Yie(t);for(var i,s=qie(r),c=Xie(r),u=c.length,h=0;u>h;)Kie.f(t,i=c[h++],s[i]);return t};var Q_,Zj=tt("document","documentElement"),Jie=ga,Qie=lC,eL=cC,Zie=X_,eae=Zj,tae=$T,dC="prototype",uC="script",tL=Y_("IE_PROTO"),hC=function(){},nL=function(t){return"<"+uC+">"+t+"</"+uC+">"},rL=function(t){t.write(nL("")),t.close();var r=t.parentWindow.Object;return t=null,r},Z_=function(){try{Q_=new ActiveXObject("htmlfile")}catch{}var t,r,i;Z_=typeof document<"u"?document.domain&&Q_?rL(Q_):(r=tae("iframe"),i="java"+uC+":",r.style.display="none",eae.appendChild(r),r.src=String(i),(t=r.contentWindow.document).open(),t.write(nL("document.F=Object")),t.close(),t.F):rL(Q_);for(var s=eL.length;s--;)delete Z_[dC][eL[s]];return Z_()};Zie[tL]=!0;var ug=Object.create||function(t,r){var i;return t!==null?(hC[dC]=Jie(t),i=new hC,hC[dC]=null,i[tL]=t):i=Z_(),r===void 0?i:Qie.f(i,r)},nae=Qe,rae=lu,iL=Error,iae=w("".replace),aae=String(new iL("zxcasd").stack),aL=/\n\s*at [^:]*:[^\n]*/,sae=aL.test(aae),oae=Re,cae=!p(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",oae(1,7)),t.stack!==7)}),lae=lu,dae=function(t,r){if(sae&&typeof t=="string"&&!iL.prepareStackTrace)for(;r--;)t=iae(t,aL,"");return t},uae=cae,sL=Error.captureStackTrace,tp={},hae=tp,pae=Zn("iterator"),fae=Array.prototype,oL=function(t){return t!==void 0&&(hae.Array===t||fae[pae]===t)},mae=Hl,cL=ag,gae=lt,vae=tp,yae=Zn("iterator"),e0=function(t){if(!gae(t))return cL(t,yae)||cL(t,"@@iterator")||vae[mae(t)]},_ae=be,bae=Da,Eae=ga,xae=Xh,Sae=e0,wae=TypeError,pC=function(t,r){var i=arguments.length<2?Sae(t):r;if(bae(i))return Eae(_ae(i,t));throw new wae(xae(t)+" is not iterable")},Tae=be,lL=ga,Cae=ag,dL=function(t,r,i){var s,c;lL(t);try{if(!(s=Cae(t,"return"))){if(r==="throw")throw i;return i}s=Tae(s,t)}catch(u){c=!0,s=u}if(r==="throw")throw i;if(c)throw s;return lL(s),i},Nae=Wl,Rae=be,Aae=ga,Iae=Xh,Oae=oL,Pae=$l,uL=N,Dae=pC,kae=e0,hL=dL,jae=TypeError,t0=function(t,r){this.stopped=t,this.result=r},pL=t0.prototype,hg=function(t,r,i){var s,c,u,h,f,g,v,_=i&&i.that,x=!(!i||!i.AS_ENTRIES),S=!(!i||!i.IS_RECORD),C=!(!i||!i.IS_ITERATOR),U=!(!i||!i.INTERRUPTED),P=Nae(r,_),j=function(K){return s&&hL(s,"normal"),new t0(!0,K)},W=function(K){return x?(Aae(K),U?P(K[0],K[1],j):P(K[0],K[1])):U?P(K,j):P(K)};if(S)s=t.iterator;else if(C)s=t;else{if(!(c=kae(t)))throw new jae(Iae(t)+" is not iterable");if(Oae(c)){for(u=0,h=Pae(t);h>u;u++)if((f=W(t[u]))&&uL(pL,f))return f;return new t0(!1)}s=Dae(t,c)}for(g=S?t.next:s.next;!(v=Rae(g,s)).done;){try{f=W(v.value)}catch(K){hL(s,"throw",K)}if(typeof f=="object"&&f&&uL(pL,f))return f}return new t0(!1)},Lae=va,Mae=Qt,Uae=N,Fae=sC,n0=Rie,Vae=function(t,r,i){for(var s=Vie(r),c=Gie.f,u=Bie.f,h=0;h<s.length;h++){var f=s[h];Qj(t,f)||i&&Qj(i,f)||c(t,f,u(r,f))}},fL=ug,fC=lu,mC=Re,Bae=function(t,r){nae(r)&&"cause"in r&&rae(t,"cause",r.cause)},Gae=function(t,r,i,s){uae&&(sL?sL(t,r):lae(t,"stack",dae(i,s)))},Wae=hg,$ae=function(t,r){return t===void 0?arguments.length<2?"":r:Lae(t)},Hae=Zn("toStringTag"),r0=Error,zae=[].push,np=function(t,r){var i,s=Uae(gC,this);n0?i=n0(new r0,s?Fae(this):gC):(i=s?this:fL(gC),fC(i,Hae,"Error")),r!==void 0&&fC(i,"message",$ae(r)),Gae(i,np,i.stack,1),arguments.length>2&&Bae(i,arguments[2]);var c=[];return Wae(t,zae,{that:c}),fC(i,"errors",c),i};n0?n0(np,r0):Vae(np,r0,{name:!0});var gC=np.prototype=fL(r0.prototype,{constructor:mC(1,np),message:mC(1,""),name:mC(1,"AggregateError")});Mae({global:!0},{AggregateError:np});var i0,pg,a0,Kae=ue,mL=A.WeakMap,Yae=Kae(mL)&&/native code/.test(String(mL)),gL=A,qae=Qe,Xae=lu,vC=ri,yC=FT,Jae=Y_,Qae=X_,vL="Object already initialized",_C=gL.TypeError,Zae=gL.WeakMap;if(Yae||yC.state){var dc=yC.state||(yC.state=new Zae);dc.get=dc.get,dc.has=dc.has,dc.set=dc.set,i0=function(t,r){if(dc.has(t))throw new _C(vL);return r.facade=t,dc.set(t,r),r},pg=function(t){return dc.get(t)||{}},a0=function(t){return dc.has(t)}}else{var rp=Jae("state");Qae[rp]=!0,i0=function(t,r){if(vC(t,rp))throw new _C(vL);return r.facade=t,Xae(t,rp,r),r},pg=function(t){return vC(t,rp)?t[rp]:{}},a0=function(t){return vC(t,rp)}}var du,yL,_L,uu={set:i0,get:pg,has:a0,enforce:function(t){return a0(t)?pg(t):i0(t,{})},getterFor:function(t){return function(r){var i;if(!qae(r)||(i=pg(r)).type!==t)throw new _C("Incompatible receiver, "+t+" required");return i}}},bC=fe,ese=ri,bL=Function.prototype,tse=bC&&Object.getOwnPropertyDescriptor,EL=ese(bL,"name"),xL={PROPER:EL&&(function(){}).name==="something",CONFIGURABLE:EL&&(!bC||bC&&tse(bL,"name").configurable)},nse=lu,zl=function(t,r,i,s){return s&&s.enumerable?t[r]=i:nse(t,r,i),t},rse=p,ise=ue,ase=Qe,sse=ug,SL=sC,ose=zl,EC=Zn("iterator"),wL=!1;[].keys&&("next"in(_L=[].keys())?(yL=SL(SL(_L)))!==Object.prototype&&(du=yL):wL=!0);var cse=!ase(du)||rse(function(){var t={};return du[EC].call(t)!==t});ise((du=cse?{}:sse(du))[EC])||ose(du,EC,function(){return this});var TL={IteratorPrototype:du,BUGGY_SAFARI_ITERATORS:wL},lse=Hl,dse=ZT?{}.toString:function(){return"[object "+lse(this)+"]"},use=ZT,hse=Is.f,pse=lu,fse=ri,mse=dse,CL=Zn("toStringTag"),Jc=function(t,r,i,s){var c=i?t:t&&t.prototype;c&&(fse(c,CL)||hse(c,CL,{configurable:!0,value:r}),s&&!use&&pse(c,"toString",mse))},gse=TL.IteratorPrototype,vse=ug,yse=Re,_se=Jc,bse=tp,Ese=function(){return this},xC=function(t,r,i,s){var c=r+" Iterator";return t.prototype=vse(gse,{next:yse(+!s,i)}),_se(t,c,!1,!0),bse[c]=Ese,t},xse=Qt,Sse=be,wse=xL,Tse=xC,Cse=sC,Nse=Jc,NL=zl,RL=tp,Rse=TL,Ase=wse.PROPER,s0=Rse.BUGGY_SAFARI_ITERATORS,SC=Zn("iterator"),AL="keys",o0="values",IL="entries",Ise=function(){return this},OL=function(t,r,i,s,c,u,h){Tse(i,r,s);var f,g,v,_=function(W){if(W===c&&P)return P;if(!s0&&W&&W in C)return C[W];switch(W){case AL:case o0:case IL:return function(){return new i(this,W)}}return function(){return new i(this)}},x=r+" Iterator",S=!1,C=t.prototype,U=C[SC]||C["@@iterator"]||c&&C[c],P=!s0&&U||_(c),j=r==="Array"&&C.entries||U;if(j&&(f=Cse(j.call(new t)))!==Object.prototype&&f.next&&(Nse(f,x,!0,!0),RL[x]=Ise),Ase&&c===o0&&U&&U.name!==o0&&(S=!0,P=function(){return Sse(U,this)}),c)if(g={values:_(o0),keys:u?P:_(AL),entries:_(IL)},h)for(v in g)(s0||S||!(v in C))&&NL(C,v,g[v]);else xse({target:r,proto:!0,forced:s0||S},g);return h&&C[SC]!==P&&NL(C,SC,P,{}),RL[r]=P,g},c0=function(t,r){return{value:t,done:r}},Ose=At,PL=tp,DL=uu;Is.f;var Pse=OL,l0=c0,kL="Array Iterator",Dse=DL.set,kse=DL.getterFor(kL);Pse(Array,"Array",function(t,r){Dse(this,{type:kL,target:Ose(t),index:0,kind:r})},function(){var t=kse(this),r=t.target,i=t.index++;if(!r||i>=r.length)return t.target=null,l0(void 0,!0);switch(t.kind){case"keys":return l0(i,!1);case"values":return l0(r[i],!1)}return l0([i,r[i]],!1)},"values"),PL.Arguments=PL.Array;var jse=Is,d0=function(t,r,i){return jse.f(t,r,i)},Lse=tt,Mse=d0,Use=fe,jL=Zn("species"),Fse=N,Vse=TypeError,wC=function(t,r){if(Fse(r,t))return t;throw new Vse("Incorrect invocation")},Bse=ue,TC=FT,Gse=w(Function.toString);Bse(TC.inspectSource)||(TC.inspectSource=function(t){return Gse(t)});var LL=TC.inspectSource,Wse=w,$se=p,ML=ue,Hse=Hl,zse=LL,UL=function(){},FL=tt("Reflect","construct"),CC=/^\s*(?:class|function)\b/,Kse=Wse(CC.exec),Yse=!CC.test(UL),fg=function(t){if(!ML(t))return!1;try{return FL(UL,[],t),!0}catch{return!1}},VL=function(t){if(!ML(t))return!1;switch(Hse(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Yse||!!Kse(CC,zse(t))}catch{return!0}};VL.sham=!0;var mg,ip,BL,NC,u0=!FL||$se(function(){var t;return fg(fg.call)||!fg(Object)||!fg(function(){t=!0})||t})?VL:fg,qse=u0,Xse=Xh,Jse=TypeError,GL=ga,Qse=function(t){if(qse(t))return t;throw new Jse(Xse(t)+" is not a constructor")},Zse=lt,eoe=Zn("species"),RC=function(t,r){var i,s=GL(t).constructor;return s===void 0||Zse(i=GL(s)[eoe])?r:Qse(i)},Kl=w([].slice),toe=TypeError,hu=function(t,r){if(t<r)throw new toe("Not enough arguments");return t},WL=/(?:ipad|iphone|ipod).*applewebkit/i.test(Wn),ss=A,noe=V,roe=Wl,$L=ue,ioe=ri,HL=p,zL=Zj,aoe=Kl,KL=$T,soe=hu,ooe=WL,coe=K_,AC=ss.setImmediate,IC=ss.clearImmediate,loe=ss.process,OC=ss.Dispatch,doe=ss.Function,YL=ss.MessageChannel,uoe=ss.String,PC=0,gg={},qL="onreadystatechange";HL(function(){mg=ss.location});var DC=function(t){if(ioe(gg,t)){var r=gg[t];delete gg[t],r()}},kC=function(t){return function(){DC(t)}},XL=function(t){DC(t.data)},JL=function(t){ss.postMessage(uoe(t),mg.protocol+"//"+mg.host)};AC&&IC||(AC=function(t){soe(arguments.length,1);var r=$L(t)?t:doe(t),i=aoe(arguments,1);return gg[++PC]=function(){noe(r,void 0,i)},ip(PC),PC},IC=function(t){delete gg[t]},coe?ip=function(t){loe.nextTick(kC(t))}:OC&&OC.now?ip=function(t){OC.now(kC(t))}:YL&&!ooe?(NC=(BL=new YL).port2,BL.port1.onmessage=XL,ip=roe(NC.postMessage,NC)):ss.addEventListener&&$L(ss.postMessage)&&!ss.importScripts&&mg&&mg.protocol!=="file:"&&!HL(JL)?(ip=JL,ss.addEventListener("message",XL,!1)):ip=qL in KL("script")?function(t){zL.appendChild(KL("script"))[qL]=function(){zL.removeChild(this),DC(t)}}:function(t){setTimeout(kC(t),0)});var h0={set:AC,clear:IC},QL=A,hoe=fe,poe=Object.getOwnPropertyDescriptor,ZL=function(t){if(!hoe)return QL[t];var r=poe(QL,t);return r&&r.value},eM=function(){this.head=null,this.tail=null};eM.prototype={add:function(t){var r={item:t,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var ap,jC,LC,MC,tM,nM=eM,foe=/ipad|iphone|ipod/i.test(Wn)&&typeof Pebble<"u",moe=/web0s(?!.*chrome)/i.test(Wn),sp=A,goe=ZL,rM=Wl,UC=h0.set,voe=nM,yoe=WL,_oe=foe,boe=moe,FC=K_,iM=sp.MutationObserver||sp.WebKitMutationObserver,aM=sp.document,sM=sp.process,p0=sp.Promise,VC=goe("queueMicrotask");if(!VC){var f0=new voe,m0=function(){var t,r;for(FC&&(t=sM.domain)&&t.exit();r=f0.get();)try{r()}catch(i){throw f0.head&&ap(),i}t&&t.enter()};yoe||FC||boe||!iM||!aM?!_oe&&p0&&p0.resolve?((MC=p0.resolve(void 0)).constructor=p0,tM=rM(MC.then,MC),ap=function(){tM(m0)}):FC?ap=function(){sM.nextTick(m0)}:(UC=rM(UC,sp),ap=function(){UC(m0)}):(jC=!0,LC=aM.createTextNode(""),new iM(m0).observe(LC,{characterData:!0}),ap=function(){LC.data=jC=!jC}),VC=function(t){f0.head||ap(),f0.add(t)}}var oM=VC,op=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},pu=A.Promise,Eoe=A,vg=pu,xoe=ue,Soe=Dj,woe=LL,Toe=Zn,cM=nC,BC=gr,lM=vg&&vg.prototype,Coe=Toe("species"),dM=xoe(Eoe.PromiseRejectionEvent),Noe=Soe("Promise",function(){var t=woe(vg),r=t!==String(vg);if(!r&&BC===66||!lM.catch||!lM.finally)return!0;if(!BC||BC<51||!/native code/.test(t)){var i=new vg(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((i.constructor={})[Coe]=s,!(i.then(function(){})instanceof s))return!0}return!(r||cM!=="BROWSER"&&cM!=="DENO"||dM)}),yg={CONSTRUCTOR:Noe,REJECTION_EVENT:dM},uc={},uM=Da,Roe=TypeError,Aoe=function(t){var r,i;this.promise=new t(function(s,c){if(r!==void 0||i!==void 0)throw new Roe("Bad Promise constructor");r=s,i=c}),this.resolve=uM(r),this.reject=uM(i)};uc.f=function(t){return new Aoe(t)};var GC,hM,pM,Ioe=Qt,g0=K_,Yl=A,Ooe=Wt,_g=be,Poe=zl,Doe=Jc,koe=function(t){var r=Lse(t);Use&&r&&!r[jL]&&Mse(r,jL,{configurable:!0,get:function(){return this}})},joe=Da,WC=ue,Loe=Qe,Moe=wC,Uoe=RC,fM=h0.set,$C=oM,Foe=function(t,r){try{arguments.length===1?console.error(t):console.error(t,r)}catch{}},Voe=op,Boe=nM,mM=uu,HC=pu,gM=yg,vM=uc,v0="Promise",yM=gM.CONSTRUCTOR,Goe=gM.REJECTION_EVENT,zC=mM.getterFor(v0),Woe=mM.set,$oe=HC&&HC.prototype,bg=HC,KC=$oe,_M=Yl.TypeError,YC=Yl.document,qC=Yl.process,XC=vM.f,Hoe=XC,zoe=!!(YC&&YC.createEvent&&Yl.dispatchEvent),bM="unhandledrejection",EM=function(t){var r;return!(!Loe(t)||!WC(r=t.then))&&r},xM=function(t,r){var i,s,c,u=r.value,h=r.state===1,f=h?t.ok:t.fail,g=t.resolve,v=t.reject,_=t.domain;try{f?(h||(r.rejection===2&&Yoe(r),r.rejection=1),f===!0?i=u:(_&&_.enter(),i=f(u),_&&(_.exit(),c=!0)),i===t.promise?v(new _M("Promise-chain cycle")):(s=EM(i))?_g(s,i,g,v):g(i)):v(u)}catch(x){_&&!c&&_.exit(),v(x)}},SM=function(t,r){t.notified||(t.notified=!0,$C(function(){for(var i,s=t.reactions;i=s.get();)xM(i,t);t.notified=!1,r&&!t.rejection&&Koe(t)}))},wM=function(t,r,i){var s,c;zoe?((s=YC.createEvent("Event")).promise=r,s.reason=i,s.initEvent(t,!1,!0),Yl.dispatchEvent(s)):s={promise:r,reason:i},!Goe&&(c=Yl["on"+t])?c(s):t===bM&&Foe("Unhandled promise rejection",i)},Koe=function(t){_g(fM,Yl,function(){var r,i=t.facade,s=t.value;if(TM(t)&&(r=Voe(function(){g0?qC.emit("unhandledRejection",s,i):wM(bM,i,s)}),t.rejection=g0||TM(t)?2:1,r.error))throw r.value})},TM=function(t){return t.rejection!==1&&!t.parent},Yoe=function(t){_g(fM,Yl,function(){var r=t.facade;g0?qC.emit("rejectionHandled",r):wM("rejectionhandled",r,t.value)})},cp=function(t,r,i){return function(s){t(r,s,i)}},lp=function(t,r,i){t.done||(t.done=!0,i&&(t=i),t.value=r,t.state=2,SM(t,!0))},JC=function(t,r,i){if(!t.done){t.done=!0,i&&(t=i);try{if(t.facade===r)throw new _M("Promise can't be resolved itself");var s=EM(r);s?$C(function(){var c={done:!1};try{_g(s,r,cp(JC,c,t),cp(lp,c,t))}catch(u){lp(c,u,t)}}):(t.value=r,t.state=1,SM(t,!1))}catch(c){lp({done:!1},c,t)}}};yM&&(KC=(bg=function(t){Moe(this,KC),joe(t),_g(GC,this);var r=zC(this);try{t(cp(JC,r),cp(lp,r))}catch(i){lp(r,i)}}).prototype,(GC=function(t){Woe(this,{type:v0,done:!1,notified:!1,parent:!1,reactions:new Boe,rejection:!1,state:0,value:null})}).prototype=Poe(KC,"then",function(t,r){var i=zC(this),s=XC(Uoe(this,bg));return i.parent=!0,s.ok=!WC(t)||t,s.fail=WC(r)&&r,s.domain=g0?qC.domain:void 0,i.state===0?i.reactions.add(s):$C(function(){xM(s,i)}),s.promise}),hM=function(){var t=new GC,r=zC(t);this.promise=t,this.resolve=cp(JC,r),this.reject=cp(lp,r)},vM.f=XC=function(t){return t===bg||t===pM?new hM(t):Hoe(t)}),Ioe({global:!0,wrap:!0,forced:yM},{Promise:bg}),pM=Ooe.Promise,Doe(bg,v0,!1,!0),koe(v0);var CM=Zn("iterator"),NM=!1;try{var qoe=0,RM={next:function(){return{done:!!qoe++}},return:function(){NM=!0}};RM[CM]=function(){return this},Array.from(RM,function(){throw 2})}catch{}var Xoe=pu,Joe=function(t,r){try{if(!r&&!NM)return!1}catch{return!1}var i=!1;try{var s={};s[CM]=function(){return{next:function(){return{done:i=!0}}}},t(s)}catch{}return i},y0=yg.CONSTRUCTOR||!Joe(function(t){Xoe.all(t).then(void 0,function(){})}),Qoe=be,Zoe=Da,ece=uc,tce=op,nce=hg;Qt({target:"Promise",stat:!0,forced:y0},{all:function(t){var r=this,i=ece.f(r),s=i.resolve,c=i.reject,u=tce(function(){var h=Zoe(r.resolve),f=[],g=0,v=1;nce(t,function(_){var x=g++,S=!1;v++,Qoe(h,r,_).then(function(C){S||(S=!0,f[x]=C,--v||s(f))},c)}),--v||s(f)});return u.error&&c(u.value),i.promise}});var rce=Qt,ice=yg.CONSTRUCTOR;pu&&pu.prototype,rce({target:"Promise",proto:!0,forced:ice,real:!0},{catch:function(t){return this.then(void 0,t)}});var ace=be,sce=Da,oce=uc,cce=op,lce=hg;Qt({target:"Promise",stat:!0,forced:y0},{race:function(t){var r=this,i=oce.f(r),s=i.reject,c=cce(function(){var u=sce(r.resolve);lce(t,function(h){ace(u,r,h).then(i.resolve,s)})});return c.error&&s(c.value),i.promise}});var dce=uc;Qt({target:"Promise",stat:!0,forced:yg.CONSTRUCTOR},{reject:function(t){var r=dce.f(this);return(0,r.reject)(t),r.promise}});var uce=ga,hce=Qe,pce=uc,AM=function(t,r){if(uce(t),hce(r)&&r.constructor===t)return r;var i=pce.f(t);return(0,i.resolve)(r),i.promise},fce=Qt,mce=pu,gce=yg.CONSTRUCTOR,vce=AM,yce=tt("Promise"),_ce=!gce;fce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return vce(_ce&&this===yce?mce:this,t)}});var bce=be,Ece=Da,xce=uc,Sce=op,wce=hg;Qt({target:"Promise",stat:!0,forced:y0},{allSettled:function(t){var r=this,i=xce.f(r),s=i.resolve,c=i.reject,u=Sce(function(){var h=Ece(r.resolve),f=[],g=0,v=1;wce(t,function(_){var x=g++,S=!1;v++,bce(h,r,_).then(function(C){S||(S=!0,f[x]={status:"fulfilled",value:C},--v||s(f))},function(C){S||(S=!0,f[x]={status:"rejected",reason:C},--v||s(f))})}),--v||s(f)});return u.error&&c(u.value),i.promise}});var Tce=be,Cce=Da,Nce=tt,Rce=uc,Ace=op,Ice=hg,IM="No one promise resolved";Qt({target:"Promise",stat:!0,forced:y0},{any:function(t){var r=this,i=Nce("AggregateError"),s=Rce.f(r),c=s.resolve,u=s.reject,h=Ace(function(){var f=Cce(r.resolve),g=[],v=0,_=1,x=!1;Ice(t,function(S){var C=v++,U=!1;_++,Tce(f,r,S).then(function(P){U||x||(x=!0,c(P))},function(P){U||x||(U=!0,g[C]=P,--_||u(new i(g,IM)))})}),--_||u(new i(g,IM))});return h.error&&u(h.value),s.promise}});var Oce=Qt,Pce=V,Dce=Kl,kce=uc,jce=Da,OM=op,QC=A.Promise,PM=!1;Oce({target:"Promise",stat:!0,forced:!QC||!QC.try||OM(function(){QC.try(function(t){PM=t===8},8)}).error||!PM},{try:function(t){var r=arguments.length>1?Dce(arguments,1):[],i=kce.f(this),s=OM(function(){return Pce(jce(t),void 0,r)});return(s.error?i.reject:i.resolve)(s.value),i.promise}});var Lce=uc;Qt({target:"Promise",stat:!0},{withResolvers:function(){var t=Lce.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Mce=Qt,ZC=pu,Uce=p,Fce=tt,Vce=ue,Bce=RC,DM=AM,Gce=ZC&&ZC.prototype;Mce({target:"Promise",proto:!0,real:!0,forced:!!ZC&&Uce(function(){Gce.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=Bce(this,Fce("Promise")),i=Vce(t);return this.then(i?function(s){return DM(r,t()).then(function(){return s})}:t,i?function(s){return DM(r,t()).then(function(){throw s})}:t)}});var eN=w,Wce=qT,$ce=va,Hce=wt,zce=eN("".charAt),kM=eN("".charCodeAt),Kce=eN("".slice),jM=function(t){return function(r,i){var s,c,u=$ce(Hce(r)),h=Wce(i),f=u.length;return h<0||h>=f?t?"":void 0:(s=kM(u,h))<55296||s>56319||h+1===f||(c=kM(u,h+1))<56320||c>57343?t?zce(u,h):s:t?Kce(u,h,h+2):c-56320+(s-55296<<10)+65536}},tN={codeAt:jM(!1),charAt:jM(!0)},Yce=tN.charAt,qce=va,LM=uu,Xce=OL,MM=c0,UM="String Iterator",Jce=LM.set,Qce=LM.getterFor(UM);Xce(String,"String",function(t){Jce(this,{type:UM,string:qce(t),index:0})},function(){var t,r=Qce(this),i=r.string,s=r.index;return s>=i.length?MM(void 0,!0):(t=Yce(i,s),r.index+=t.length,MM(t,!1))});var Zce=Wt.Promise,ele={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},tle=A,nle=Jc,FM=tp;for(var nN in ele)nle(tle[nN],nN),FM[nN]=FM.Array;var VM=Zce,De=d(VM),rle=is("Array","values"),ile=Hl,ale=ri,sle=N,ole=rle,rN=Array.prototype,cle={DOMTokenList:!0,NodeList:!0},lle=function(t){var r=t.values;return t===rN||sle(rN,t)&&r===rN.values||ale(cle,ile(t))?ole:r},ya=d(lle),BM=Xh,dle=TypeError,GM=Kl,ule=Math.floor,iN=function(t,r){var i=t.length;if(i<8)for(var s,c,u=1;u<i;){for(c=u,s=t[u];c&&r(t[c-1],s)>0;)t[c]=t[--c];c!==u++&&(t[c]=s)}else for(var h=ule(i/2),f=iN(GM(t,0,h),r),g=iN(GM(t,h),r),v=f.length,_=g.length,x=0,S=0;x<v||S<_;)t[x+S]=x<v&&S<_?r(f[x],g[S])<=0?f[x++]:g[S++]:x<v?f[x++]:g[S++];return t},WM=iN,$M=Wn.match(/firefox\/(\d+)/i),hle=!!$M&&+$M[1],ple=/MSIE|Trident/.test(Wn),HM=Wn.match(/AppleWebKit\/(\d+)\./),fle=!!HM&&+HM[1],mle=Qt,zM=w,gle=Da,vle=lc,KM=$l,yle=function(t,r){if(!delete t[r])throw new dle("Cannot delete property "+BM(r)+" of "+BM(t))},YM=va,aN=p,_le=WM,ble=H_,qM=hle,Ele=ple,XM=gr,JM=fle,ql=[],QM=zM(ql.sort),xle=zM(ql.push),Sle=aN(function(){ql.sort(void 0)}),wle=aN(function(){ql.sort(null)}),Tle=ble("sort"),ZM=!aN(function(){if(XM)return XM<70;if(!(qM&&qM>3)){if(Ele)return!0;if(JM)return JM<603;var t,r,i,s,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)ql.push({k:r+s,v:i})}for(ql.sort(function(u,h){return h.v-u.v}),s=0;s<ql.length;s++)r=ql[s].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});mle({target:"Array",proto:!0,forced:Sle||!wle||!Tle||!ZM},{sort:function(t){t!==void 0&&gle(t);var r=vle(this);if(ZM)return t===void 0?QM(r):QM(r,t);var i,s,c=[],u=KM(r);for(s=0;s<u;s++)s in r&&xle(c,r[s]);for(_le(c,function(h){return function(f,g){return g===void 0?-1:f===void 0?1:h!==void 0?+h(f,g)||0:YM(f)>YM(g)?1:-1}}(t)),i=KM(c),s=0;s<i;)r[s]=c[s++];for(;s<u;)yle(r,s++);return r}});var Cle=is("Array","sort"),Nle=N,Rle=Cle,sN=Array.prototype,Ale=function(t){var r=t.sort;return t===sN||Nle(sN,t)&&r===sN.sort?Rle:r},fu=d(Ale),Ile=Qt,Ole=w,Ple=XT,Dle=RangeError,eU=String.fromCharCode,tU=String.fromCodePoint,kle=Ole([].join);Ile({target:"String",stat:!0,forced:!!tU&&tU.length!==1},{fromCodePoint:function(t){for(var r,i=[],s=arguments.length,c=0;s>c;){if(r=+arguments[c++],Ple(r,1114111)!==r)throw new Dle(r+" is not a valid code point");i[c]=r<65536?eU(r):eU(55296+((r-=65536)>>10),r%1024+56320)}return kle(i,"")}});var jle=p,Lle=Zn("iterator"),_0=!jle(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),s="";return t.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),s+=u+c}),i.delete("a",2),i.delete("b",void 0),!t.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!r.size&&!0||!r.sort||t.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Lle]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Mle=zl,oN=Qt,nU=A,cN=ZL,Ule=tt,b0=be,bo=w,Eg=fe,rU=_0,iU=zl,Fle=d0,Vle=function(t,r,i){for(var s in r)i&&i.unsafe&&t[s]?t[s]=r[s]:Mle(t,s,r[s],i);return t},Ble=Jc,Gle=xC,lN=uu,aU=wC,dN=ue,Wle=ri,$le=Wl,Hle=Hl,zle=ga,sU=Qe,_a=va,Kle=ug,oU=Re,cU=pC,Yle=e0,E0=c0,dp=hu,qle=WM,Xle=Zn("iterator"),up="URLSearchParams",lU=up+"Iterator",dU=lN.set,Os=lN.getterFor(up),Jle=lN.getterFor(lU),uU=cN("fetch"),x0=cN("Request"),xg=cN("Headers"),uN=x0&&x0.prototype,hU=xg&&xg.prototype,Qle=nU.TypeError,Zle=nU.encodeURIComponent,ede=String.fromCharCode,tde=Ule("String","fromCodePoint"),nde=parseInt,S0=bo("".charAt),pU=bo([].join),Xl=bo([].push),fU=bo("".replace),rde=bo([].shift),mU=bo([].splice),gU=bo("".split),vU=bo("".slice),ide=bo(/./.exec),ade=/\+/g,sde=/^[0-9a-f]+$/i,yU=function(t,r){var i=vU(t,r,r+2);return ide(sde,i)?nde(i,16):NaN},ode=function(t){for(var r=0,i=128;i>0&&t&i;i>>=1)r++;return r},cde=function(t){var r=null;switch(t.length){case 1:r=t[0];break;case 2:r=(31&t[0])<<6|63&t[1];break;case 3:r=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:r=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return r>1114111?null:r},_U=function(t){for(var r=(t=fU(t,ade," ")).length,i="",s=0;s<r;){var c=S0(t,s);if(c==="%"){if(S0(t,s+1)==="%"||s+3>r){i+="%",s++;continue}var u=yU(t,s+1);if(u!=u){i+=c,s++;continue}s+=2;var h=ode(u);if(h===0)c=ede(u);else{if(h===1||h>4){i+="",s++;continue}for(var f=[u],g=1;g<h&&!(++s+3>r||S0(t,s)!=="%");){var v=yU(t,s+1);if(v!=v){s+=3;break}if(v>191||v<128)break;Xl(f,v),s+=2,g++}if(f.length!==h){i+="";continue}var _=cde(f);_===null?i+="":c=tde(_)}}i+=c,s++}return i},lde=/[!'()~]|%20/g,dde={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},ude=function(t){return dde[t]},bU=function(t){return fU(Zle(t),lde,ude)},hN=Gle(function(t,r){dU(this,{type:lU,target:Os(t).entries,index:0,kind:r})},up,function(){var t=Jle(this),r=t.target,i=t.index++;if(!r||i>=r.length)return t.target=null,E0(void 0,!0);var s=r[i];switch(t.kind){case"keys":return E0(s.key,!1);case"values":return E0(s.value,!1)}return E0([s.key,s.value],!1)},!0),EU=function(t){this.entries=[],this.url=null,t!==void 0&&(sU(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?S0(t,0)==="?"?vU(t,1):t:_a(t)))};EU.prototype={type:up,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,i,s,c,u,h,f,g=this.entries,v=Yle(t);if(v)for(i=(r=cU(t,v)).next;!(s=b0(i,r)).done;){if(u=(c=cU(zle(s.value))).next,(h=b0(u,c)).done||(f=b0(u,c)).done||!b0(u,c).done)throw new Qle("Expected sequence with length 2");Xl(g,{key:_a(h.value),value:_a(f.value)})}else for(var _ in t)Wle(t,_)&&Xl(g,{key:_,value:_a(t[_])})},parseQuery:function(t){if(t)for(var r,i,s=this.entries,c=gU(t,"&"),u=0;u<c.length;)(r=c[u++]).length&&(i=gU(r,"="),Xl(s,{key:_U(rde(i)),value:_U(pU(i,"="))}))},serialize:function(){for(var t,r=this.entries,i=[],s=0;s<r.length;)t=r[s++],Xl(i,bU(t.key)+"="+bU(t.value));return pU(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var w0=function(){aU(this,hp);var t=dU(this,new EU(arguments.length>0?arguments[0]:void 0));Eg||(this.size=t.entries.length)},hp=w0.prototype;if(Vle(hp,{append:function(t,r){var i=Os(this);dp(arguments.length,2),Xl(i.entries,{key:_a(t),value:_a(r)}),Eg||this.length++,i.updateURL()},delete:function(t){for(var r=Os(this),i=dp(arguments.length,1),s=r.entries,c=_a(t),u=i<2?void 0:arguments[1],h=u===void 0?u:_a(u),f=0;f<s.length;){var g=s[f];if(g.key!==c||h!==void 0&&g.value!==h)f++;else if(mU(s,f,1),h!==void 0)break}Eg||(this.size=s.length),r.updateURL()},get:function(t){var r=Os(this).entries;dp(arguments.length,1);for(var i=_a(t),s=0;s<r.length;s++)if(r[s].key===i)return r[s].value;return null},getAll:function(t){var r=Os(this).entries;dp(arguments.length,1);for(var i=_a(t),s=[],c=0;c<r.length;c++)r[c].key===i&&Xl(s,r[c].value);return s},has:function(t){for(var r=Os(this).entries,i=dp(arguments.length,1),s=_a(t),c=i<2?void 0:arguments[1],u=c===void 0?c:_a(c),h=0;h<r.length;){var f=r[h++];if(f.key===s&&(u===void 0||f.value===u))return!0}return!1},set:function(t,r){var i=Os(this);dp(arguments.length,1);for(var s,c=i.entries,u=!1,h=_a(t),f=_a(r),g=0;g<c.length;g++)(s=c[g]).key===h&&(u?mU(c,g--,1):(u=!0,s.value=f));u||Xl(c,{key:h,value:f}),Eg||(this.size=c.length),i.updateURL()},sort:function(){var t=Os(this);qle(t.entries,function(r,i){return r.key>i.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,i=Os(this).entries,s=$le(t,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)s((r=i[c++]).value,r.key,this)},keys:function(){return new hN(this,"keys")},values:function(){return new hN(this,"values")},entries:function(){return new hN(this,"entries")}},{enumerable:!0}),iU(hp,Xle,hp.entries,{}),iU(hp,"toString",function(){return Os(this).serialize()},{enumerable:!0}),Eg&&Fle(hp,"size",{get:function(){return Os(this).entries.length},configurable:!0,enumerable:!0}),Ble(w0,up),oN({global:!0,forced:!rU},{URLSearchParams:w0}),!rU&&dN(xg)){var hde=bo(hU.has),pde=bo(hU.set),xU=function(t){if(sU(t)){var r,i=t.body;if(Hle(i)===up)return r=t.headers?new xg(t.headers):new xg,hde(r,"content-type")||pde(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Kle(t,{body:oU(0,_a(i)),headers:oU(0,r)})}return t};if(dN(uU)&&oN({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return uU(t,arguments.length>1?xU(arguments[1]):{})}}),dN(x0)){var pN=function(t){return aU(this,uN),new x0(t,arguments.length>1?xU(arguments[1]):{})};uN.constructor=pN,pN.prototype=uN,oN({global:!0,dontCallGetSet:!0,forced:!0},{Request:pN})}}var Ps,fde={URLSearchParams:w0,getState:Os},mde=Wt.URLSearchParams,SU=fe,gde=w,vde=be,yde=p,fN=J_,_de=dg,bde=ae,Ede=lc,xde=Pe,pp=Object.assign,wU=Object.defineProperty,Sde=gde([].concat),wde=!pp||yde(function(){if(SU&&pp({b:1},pp(wU({},"a",{enumerable:!0,get:function(){wU(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},i=Symbol("assign detection"),s="abcdefghijklmnopqrst";return t[i]=7,s.split("").forEach(function(c){r[c]=c}),pp({},t)[i]!==7||fN(pp({},r)).join("")!==s})?function(t,r){for(var i=Ede(t),s=arguments.length,c=1,u=_de.f,h=bde.f;s>c;)for(var f,g=xde(arguments[c++]),v=u?Sde(fN(g),u(g)):fN(g),_=v.length,x=0;_>x;)f=v[x++],SU&&!vde(h,g,f)||(i[f]=g[f]);return i}:pp,Tde=ga,Cde=dL,Nde=fe,Rde=Is,Ade=Re,mN=function(t,r,i){Nde?Rde.f(t,r,Ade(0,i)):t[r]=i},Ide=Wl,Ode=be,Pde=lc,Dde=function(t,r,i,s){try{return s?r(Tde(i)[0],i[1]):r(i)}catch(c){Cde(t,"throw",c)}},kde=oL,jde=u0,Lde=$l,TU=mN,Mde=pC,Ude=e0,CU=Array,mu=w,gN=2147483647,Fde=/[^\0-\u007E]/,NU=/[.\u3002\uFF0E\uFF61]/g,RU="Overflow: input needs wider integers to process",AU=RangeError,Vde=mu(NU.exec),fp=Math.floor,vN=String.fromCharCode,IU=mu("".charCodeAt),OU=mu([].join),Jl=mu([].push),Bde=mu("".replace),Gde=mu("".split),Wde=mu("".toLowerCase),PU=function(t){return t+22+75*(t<26)},$de=function(t,r,i){var s=0;for(t=i?fp(t/700):t>>1,t+=fp(t/r);t>455;)t=fp(t/35),s+=36;return fp(s+36*t/(t+38))},Hde=function(t){var r=[];t=function(W){for(var K=[],J=0,re=W.length;J<re;){var ie=IU(W,J++);if(ie>=55296&&ie<=56319&&J<re){var Z=IU(W,J++);(64512&Z)==56320?Jl(K,((1023&ie)<<10)+(1023&Z)+65536):(Jl(K,ie),J--)}else Jl(K,ie)}return K}(t);var i,s,c=t.length,u=128,h=0,f=72;for(i=0;i<t.length;i++)(s=t[i])<128&&Jl(r,vN(s));var g=r.length,v=g;for(g&&Jl(r,"-");v<c;){var _=gN;for(i=0;i<t.length;i++)(s=t[i])>=u&&s<_&&(_=s);var x=v+1;if(_-u>fp((gN-h)/x))throw new AU(RU);for(h+=(_-u)*x,u=_,i=0;i<t.length;i++){if((s=t[i])<u&&++h>gN)throw new AU(RU);if(s===u){for(var S=h,C=36;;){var U=C<=f?1:C>=f+26?26:C-f;if(S<U)break;var P=S-U,j=36-U;Jl(r,vN(PU(U+P%j))),S=fp(P/j),C+=36}Jl(r,vN(PU(S))),f=$de(h,x,v===g),h=0,v++}}h++,u++}return OU(r,"")},zde=Qt,yN=fe,Kde=_0,_N=A,DU=Wl,Ds=w,T0=zl,ks=d0,Yde=wC,bN=ri,EN=wde,mp=function(t){var r=Pde(t),i=jde(this),s=arguments.length,c=s>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Ide(c,s>2?arguments[2]:void 0));var h,f,g,v,_,x,S=Ude(r),C=0;if(!S||this===CU&&kde(S))for(h=Lde(r),f=i?new this(h):CU(h);h>C;C++)x=u?c(r[C],C):r[C],TU(f,C,x);else for(f=i?new this:[],_=(v=Mde(r,S)).next;!(g=Ode(_,v)).done;C++)x=u?Dde(v,c,[g.value,C],!0):g.value,TU(f,C,x);return f.length=C,f},Eo=Kl,qde=tN.codeAt,Xde=function(t){var r,i,s=[],c=Gde(Bde(Wde(t),NU,"."),".");for(r=0;r<c.length;r++)i=c[r],Jl(s,Vde(Fde,i)?"xn--"+Hde(i):i);return OU(s,".")},Qc=va,Jde=Jc,Qde=hu,kU=fde,jU=uu,Zde=jU.set,C0=jU.getterFor("URL"),eue=kU.URLSearchParams,tue=kU.getState,Sg=_N.URL,xN=_N.TypeError,N0=_N.parseInt,nue=Math.floor,LU=Math.pow,js=Ds("".charAt),xo=Ds(/./.exec),wg=Ds([].join),rue=Ds(1.1.toString),iue=Ds([].pop),gp=Ds([].push),SN=Ds("".replace),aue=Ds([].shift),sue=Ds("".split),Tg=Ds("".slice),R0=Ds("".toLowerCase),oue=Ds([].unshift),wN="Invalid scheme",gu="Invalid host",MU="Invalid port",UU=/[a-z]/i,cue=/[\d+-.a-z]/i,TN=/\d/,lue=/^0x/i,due=/^[0-7]+$/,uue=/^\d+$/,FU=/^[\da-f]+$/i,hue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,pue=/[\0\t\n\r #/:<>?@[\\\]^|]/,fue=/^[\u0000-\u0020]+/,mue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,gue=/[\t\n\r]/g,Cg=function(t){var r,i,s,c;if(typeof t=="number"){for(r=[],i=0;i<4;i++)oue(r,t%256),t=nue(t/256);return wg(r,".")}if(typeof t=="object"){for(r="",s=function(u){for(var h=null,f=1,g=null,v=0,_=0;_<8;_++)u[_]!==0?(v>f&&(h=g,f=v),g=null,v=0):(g===null&&(g=_),++v);return v>f?g:h}(t),i=0;i<8;i++)c&&t[i]===0||(c&&(c=!1),s===i?(r+=i?":":"::",c=!0):(r+=rue(t[i],16),i<7&&(r+=":")));return"["+r+"]"}return t},A0={},VU=EN({},A0,{" ":1,'"':1,"<":1,">":1,"`":1}),BU=EN({},VU,{"#":1,"?":1,"{":1,"}":1}),CN=EN({},BU,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ql=function(t,r){var i=qde(t,0);return i>32&&i<127&&!bN(r,t)?t:encodeURIComponent(t)},I0={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ng=function(t,r){var i;return t.length===2&&xo(UU,js(t,0))&&((i=js(t,1))===":"||!r&&i==="|")},GU=function(t){var r;return t.length>1&&Ng(Tg(t,0,2))&&(t.length===2||(r=js(t,2))==="/"||r==="\\"||r==="?"||r==="#")},vue=function(t){return t==="."||R0(t)==="%2e"},NN={},WU={},RN={},$U={},HU={},AN={},zU={},KU={},O0={},P0={},IN={},ON={},PN={},DN={},YU={},kN={},vp={},hc={},qU={},vu={},Zc={},jN=function(t,r,i){var s,c,u,h=Qc(t);if(r){if(c=this.parse(h))throw new xN(c);this.searchParams=null}else{if(i!==void 0&&(s=new jN(i,!0)),c=this.parse(h,null,s))throw new xN(c);(u=tue(new eue)).bindURL(this),this.searchParams=u}};jN.prototype={type:"URL",parse:function(t,r,i){var s,c,u,h,f,g=this,v=r||NN,_=0,x="",S=!1,C=!1,U=!1;for(t=Qc(t),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,t=SN(t,fue,""),t=SN(t,mue,"$1")),t=SN(t,gue,""),s=mp(t);_<=s.length;){switch(c=s[_],v){case NN:if(!c||!xo(UU,c)){if(r)return wN;v=RN;continue}x+=R0(c),v=WU;break;case WU:if(c&&(xo(cue,c)||c==="+"||c==="-"||c==="."))x+=R0(c);else{if(c!==":"){if(r)return wN;x="",v=RN,_=0;continue}if(r&&(g.isSpecial()!==bN(I0,x)||x==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=x,r)return void(g.isSpecial()&&I0[g.scheme]===g.port&&(g.port=null));x="",g.scheme==="file"?v=DN:g.isSpecial()&&i&&i.scheme===g.scheme?v=$U:g.isSpecial()?v=KU:s[_+1]==="/"?(v=HU,_++):(g.cannotBeABaseURL=!0,gp(g.path,""),v=qU)}break;case RN:if(!i||i.cannotBeABaseURL&&c!=="#")return wN;if(i.cannotBeABaseURL&&c==="#"){g.scheme=i.scheme,g.path=Eo(i.path),g.query=i.query,g.fragment="",g.cannotBeABaseURL=!0,v=Zc;break}v=i.scheme==="file"?DN:AN;continue;case $U:if(c!=="/"||s[_+1]!=="/"){v=AN;continue}v=O0,_++;break;case HU:if(c==="/"){v=P0;break}v=hc;continue;case AN:if(g.scheme=i.scheme,c===Ps)g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=Eo(i.path),g.query=i.query;else if(c==="/"||c==="\\"&&g.isSpecial())v=zU;else if(c==="?")g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=Eo(i.path),g.query="",v=vu;else{if(c!=="#"){g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=Eo(i.path),g.path.length--,v=hc;continue}g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=Eo(i.path),g.query=i.query,g.fragment="",v=Zc}break;case zU:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,v=hc;continue}v=P0}else v=O0;break;case KU:if(v=O0,c!=="/"||js(x,_+1)!=="/")continue;_++;break;case O0:if(c!=="/"&&c!=="\\"){v=P0;continue}break;case P0:if(c==="@"){S&&(x="%40"+x),S=!0,u=mp(x);for(var P=0;P<u.length;P++){var j=u[P];if(j!==":"||U){var W=Ql(j,CN);U?g.password+=W:g.username+=W}else U=!0}x=""}else if(c===Ps||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(S&&x==="")return"Invalid authority";_-=mp(x).length+1,x="",v=IN}else x+=c;break;case IN:case ON:if(r&&g.scheme==="file"){v=kN;continue}if(c!==":"||C){if(c===Ps||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&x==="")return gu;if(r&&x===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(x))return h;if(x="",v=vp,r)return;continue}c==="["?C=!0:c==="]"&&(C=!1),x+=c}else{if(x==="")return gu;if(h=g.parseHost(x))return h;if(x="",v=PN,r===ON)return}break;case PN:if(!xo(TN,c)){if(c===Ps||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(x!==""){var K=N0(x,10);if(K>65535)return MU;g.port=g.isSpecial()&&K===I0[g.scheme]?null:K,x=""}if(r)return;v=vp;continue}return MU}x+=c;break;case DN:if(g.scheme="file",c==="/"||c==="\\")v=YU;else{if(!i||i.scheme!=="file"){v=hc;continue}switch(c){case Ps:g.host=i.host,g.path=Eo(i.path),g.query=i.query;break;case"?":g.host=i.host,g.path=Eo(i.path),g.query="",v=vu;break;case"#":g.host=i.host,g.path=Eo(i.path),g.query=i.query,g.fragment="",v=Zc;break;default:GU(wg(Eo(s,_),""))||(g.host=i.host,g.path=Eo(i.path),g.shortenPath()),v=hc;continue}}break;case YU:if(c==="/"||c==="\\"){v=kN;break}i&&i.scheme==="file"&&!GU(wg(Eo(s,_),""))&&(Ng(i.path[0],!0)?gp(g.path,i.path[0]):g.host=i.host),v=hc;continue;case kN:if(c===Ps||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&Ng(x))v=hc;else if(x===""){if(g.host="",r)return;v=vp}else{if(h=g.parseHost(x))return h;if(g.host==="localhost"&&(g.host=""),r)return;x="",v=vp}continue}x+=c;break;case vp:if(g.isSpecial()){if(v=hc,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Ps&&(v=hc,c!=="/"))continue}else g.fragment="",v=Zc;else g.query="",v=vu;break;case hc:if(c===Ps||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((f=R0(f=x))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||gp(g.path,"")):vue(x)?c==="/"||c==="\\"&&g.isSpecial()||gp(g.path,""):(g.scheme==="file"&&!g.path.length&&Ng(x)&&(g.host&&(g.host=""),x=js(x,0)+":"),gp(g.path,x)),x="",g.scheme==="file"&&(c===Ps||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)aue(g.path);c==="?"?(g.query="",v=vu):c==="#"&&(g.fragment="",v=Zc)}else x+=Ql(c,BU);break;case qU:c==="?"?(g.query="",v=vu):c==="#"?(g.fragment="",v=Zc):c!==Ps&&(g.path[0]+=Ql(c,A0));break;case vu:r||c!=="#"?c!==Ps&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":Ql(c,A0)):(g.fragment="",v=Zc);break;case Zc:c!==Ps&&(g.fragment+=Ql(c,VU))}_++}},parseHost:function(t){var r,i,s;if(js(t,0)==="["){if(js(t,t.length-1)!=="]"||(r=function(c){var u,h,f,g,v,_,x,S=[0,0,0,0,0,0,0,0],C=0,U=null,P=0,j=function(){return js(c,P)};if(j()===":"){if(js(c,1)!==":")return;P+=2,U=++C}for(;j();){if(C===8)return;if(j()!==":"){for(u=h=0;h<4&&xo(FU,j());)u=16*u+N0(j(),16),P++,h++;if(j()==="."){if(h===0||(P-=h,C>6))return;for(f=0;j();){if(g=null,f>0){if(!(j()==="."&&f<4))return;P++}if(!xo(TN,j()))return;for(;xo(TN,j());){if(v=N0(j(),10),g===null)g=v;else{if(g===0)return;g=10*g+v}if(g>255)return;P++}S[C]=256*S[C]+g,++f!=2&&f!==4||C++}if(f!==4)return;break}if(j()===":"){if(P++,!j())return}else if(j())return;S[C++]=u}else{if(U!==null)return;P++,U=++C}}if(U!==null)for(_=C-U,C=7;C!==0&&_>0;)x=S[C],S[C--]=S[U+_-1],S[U+--_]=x;else if(C!==8)return;return S}(Tg(t,1,-1)),!r))return gu;this.host=r}else if(this.isSpecial()){if(t=Xde(t),xo(hue,t)||(r=function(c){var u,h,f,g,v,_,x,S=sue(c,".");if(S.length&&S[S.length-1]===""&&S.length--,(u=S.length)>4)return c;for(h=[],f=0;f<u;f++){if((g=S[f])==="")return c;if(v=10,g.length>1&&js(g,0)==="0"&&(v=xo(lue,g)?16:8,g=Tg(g,v===8?1:2)),g==="")_=0;else{if(!xo(v===10?uue:v===8?due:FU,g))return c;_=N0(g,v)}gp(h,_)}for(f=0;f<u;f++)if(_=h[f],f===u-1){if(_>=LU(256,5-u))return null}else if(_>255)return null;for(x=iue(h),f=0;f<h.length;f++)x+=h[f]*LU(256,3-f);return x}(t),r===null))return gu;this.host=r}else{if(xo(pue,t))return gu;for(r="",i=mp(t),s=0;s<i.length;s++)r+=Ql(i[s],A0);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return bN(I0,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme==="file"&&r===1&&Ng(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,i=t.username,s=t.password,c=t.host,u=t.port,h=t.path,f=t.query,g=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=i+(s?":"+s:"")+"@"),v+=Cg(c),u!==null&&(v+=":"+u)):r==="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+wg(h,"/"):"",f!==null&&(v+="?"+f),g!==null&&(v+="#"+g),v},setHref:function(t){var r=this.parse(t);if(r)throw new xN(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t==="blob")try{return new yp(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Cg(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Qc(t)+":",NN)},getUsername:function(){return this.username},setUsername:function(t){var r=mp(Qc(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=Ql(r[i],CN)}},getPassword:function(){return this.password},setPassword:function(t){var r=mp(Qc(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=Ql(r[i],CN)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?Cg(t):Cg(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,IN)},getHostname:function(){var t=this.host;return t===null?"":Cg(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,ON)},getPort:function(){var t=this.port;return t===null?"":Qc(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Qc(t))===""?this.port=null:this.parse(t,PN))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+wg(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,vp))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Qc(t))===""?this.query=null:(js(t,0)==="?"&&(t=Tg(t,1)),this.query="",this.parse(t,vu)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Qc(t))!==""?(js(t,0)==="#"&&(t=Tg(t,1)),this.fragment="",this.parse(t,Zc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var yp=function(t){var r=Yde(this,ba),i=Qde(arguments.length,1)>1?arguments[1]:void 0,s=Zde(r,new jN(t,!1,i));yN||(r.href=s.serialize(),r.origin=s.getOrigin(),r.protocol=s.getProtocol(),r.username=s.getUsername(),r.password=s.getPassword(),r.host=s.getHost(),r.hostname=s.getHostname(),r.port=s.getPort(),r.pathname=s.getPathname(),r.search=s.getSearch(),r.searchParams=s.getSearchParams(),r.hash=s.getHash())},ba=yp.prototype,Ls=function(t,r){return{get:function(){return C0(this)[t]()},set:r&&function(i){return C0(this)[r](i)},configurable:!0,enumerable:!0}};if(yN&&(ks(ba,"href",Ls("serialize","setHref")),ks(ba,"origin",Ls("getOrigin")),ks(ba,"protocol",Ls("getProtocol","setProtocol")),ks(ba,"username",Ls("getUsername","setUsername")),ks(ba,"password",Ls("getPassword","setPassword")),ks(ba,"host",Ls("getHost","setHost")),ks(ba,"hostname",Ls("getHostname","setHostname")),ks(ba,"port",Ls("getPort","setPort")),ks(ba,"pathname",Ls("getPathname","setPathname")),ks(ba,"search",Ls("getSearch","setSearch")),ks(ba,"searchParams",Ls("getSearchParams")),ks(ba,"hash",Ls("getHash","setHash"))),T0(ba,"toJSON",function(){return C0(this).serialize()},{enumerable:!0}),T0(ba,"toString",function(){return C0(this).serialize()},{enumerable:!0}),Sg){var XU=Sg.createObjectURL,JU=Sg.revokeObjectURL;XU&&T0(yp,"createObjectURL",DU(XU,Sg)),JU&&T0(yp,"revokeObjectURL",DU(JU,Sg))}Jde(yp,"URL"),zde({global:!0,forced:!Kde,sham:!yN},{URL:yp});var yue=Qt,QU=p,_ue=hu,ZU=va,bue=_0,LN=tt("URL"),Eue=bue&&QU(function(){LN.canParse()}),xue=QU(function(){return LN.canParse.length!==1});yue({target:"URL",stat:!0,forced:!Eue||xue},{canParse:function(t){var r=_ue(arguments.length,1),i=ZU(t),s=r<2||arguments[1]===void 0?void 0:ZU(arguments[1]);try{return!!new LN(i,s)}catch{return!1}}});var Sue=Qt,wue=hu,e5=va,Tue=_0,Cue=tt("URL");Sue({target:"URL",stat:!0,forced:!Tue},{parse:function(t){var r=wue(arguments.length,1),i=e5(t),s=r<2||arguments[1]===void 0?void 0:e5(arguments[1]);try{return new Cue(i,s)}catch{return null}}});var D0=d(Wt.URL);let t5=!0,n5=!0;function k0(t,r,i){const s=t.match(r);return s&&s.length>=i&&parseInt(s[i],10)}function yu(t,r,i){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,f){if(h!==r)return c.apply(this,arguments);const g=v=>{const _=i(v);_&&(f.handleEvent?f.handleEvent(_):f(_))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(f,g),c.apply(this,[h,g])};const u=s.removeEventListener;s.removeEventListener=function(h,f){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(f))return u.apply(this,arguments);const g=this._eventMap[r].get(f);return this._eventMap[r].delete(f),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,g])},Object.defineProperty(s,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Nue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(t5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Rue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(n5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function r5(){if(typeof window=="object"){if(t5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function MN(t,r){n5&&console.warn(t+" is deprecated, please use "+r+" instead.")}function i5(t){return Object.prototype.toString.call(t)==="[object Object]"}function a5(t){var r;return i5(t)?as(r=Object.keys(t)).call(r,function(i,s){const c=i5(t[s]),u=c?a5(t[s]):t[s],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[s]:u})},{}):t}function UN(t,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(s=>{s.endsWith("Id")?UN(t,t.get(r[s]),i):s.endsWith("Ids")&&r[s].forEach(c=>{UN(t,t.get(c),i)})}))}function s5(t,r,i){const s=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{t.forEach(f=>{f.type===s&&f.trackId===h.id&&UN(t,f,c)})}),c}const o5=r5;function c5(t,r){const i=t&&t.navigator;if(!i.mediaDevices)return;const s=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const v=typeof h[g]=="object"?h[g]:{ideal:h[g]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const _=function(x,S){return x?x+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(v.ideal!==void 0){f.optional=f.optional||[];let x={};typeof v.ideal=="number"?(x[_("min",g)]=v.ideal,f.optional.push(x),x={},x[_("max",g)]=v.ideal,f.optional.push(x)):(x[_("",g)]=v.ideal,f.optional.push(x))}v.exact!==void 0&&typeof v.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[_("",g)]=v.exact):["min","max"].forEach(x=>{v[x]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[_(x,g)]=v[x])})}),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},c=function(h,f){if(r.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(v,_,x){_ in v&&!(x in v)&&(v[x]=v[_],delete v[_])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const v=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||v)){let _;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?_=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(_=["front"]),_)return i.mediaDevices.enumerateDevices().then(x=>{x=x.filter(C=>C.kind==="videoinput");let S=x.find(C=>_.some(U=>{var P;return Te(P=C.label.toLowerCase()).call(P,U)}));return!S&&x.length&&Te(_).call(_,"back")&&(S=x[x.length-1]),S&&(h.video.deviceId=g.exact?{exact:S.deviceId}:{ideal:S.deviceId}),h.video=s(h.video),o5("chrome: "+JSON.stringify(h)),f(h)})}h.video=s(h.video)}return o5("chrome: "+JSON.stringify(h)),f(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,f,g){c(h,v=>{i.webkitGetUserMedia(v,f,_=>{g&&g(u(_))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(f){return c(f,g=>h(g).then(v=>{if(g.audio&&!v.getAudioTracks().length||g.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return v},v=>De.reject(u(v))))}}}function l5(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function d5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.track.id):{track:s.track};const u=new Event("track");u.track=s.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(s=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.id):{track:s};const u=new Event("track");u.track=s,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else yu(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function u5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,f){let g=c.apply(this,arguments);return g||(g=r(this,h),this._senders.push(g)),g};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const f=this._senders.indexOf(h);f!==-1&&this._senders.splice(f,1)}}const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(f=>f.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function h5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,s,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const u=function(f){const g={};return f.result().forEach(v=>{const _={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(x=>{_[x]=v.stat(x)}),g[_.id]=_}),g},h=function(f){return new Map(Object.keys(f).map(g=>[g,f[g]]))};if(arguments.length>=2){const f=function(g){s(h(u(g)))};return r.apply(this,[f,i])}return new De((f,g)=>{r.apply(this,[function(v){f(h(u(v)))},g])}).then(s,c)}}function p5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>s5(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s}),yu(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>s5(c,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let s,c,u;return this.getSenders().forEach(h=>{h.track===i&&(s?u=!0:s=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||s&&c?De.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():De.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function f5(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(f)===-1&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(g=>{if(this.getSenders().find(_=>_.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const f=this.getSenders().filter(g=>h.indexOf(g)===-1);this._shimmedLocalStreams[u.id]=[u].concat(f)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],s.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const f=this._shimmedLocalStreams[h].indexOf(u);f!==-1&&this._shimmedLocalStreams[h].splice(f,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function m5(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return f5(t);const i=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(v=>this._reverseStreams[v.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(v=>{if(this.getSenders().find(x=>x.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const v=new t.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}s.apply(this,[g])};const c=t.RTCPeerConnection.prototype.removeStream;function u(g,v){let _=v.sdp;return Object.keys(g._reverseStreams||[]).forEach(x=>{const S=g._reverseStreams[x],C=g._streams[S.id];_=_.replace(new RegExp(C.id,"g"),S.id)}),new RTCSessionDescription({type:v.type,sdp:_})}t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(C=>C===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[v.id];if(S)S.addTrack(g),De.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new t.MediaStream([g]);this._streams[v.id]=C,this._reverseStreams[C.id]=v,this.addStream(C)}return this.getSenders().find(C=>C.track===g)},["createOffer","createAnswer"].forEach(function(g){const v=t.RTCPeerConnection.prototype[g],_={[g](){const x=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[S=>{const C=u(this,S);x[0].apply(null,[C])},S=>{x[1]&&x[1].apply(null,S)},arguments[2]]):v.apply(this,arguments).then(S=>u(this,S))}};t.RTCPeerConnection.prototype[g]=_[g]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(g,v){let _=v.sdp;return Object.keys(g._reverseStreams||[]).forEach(x=>{const S=g._reverseStreams[x],C=g._streams[S.id];_=_.replace(new RegExp(S.id,"g"),C.id)}),new RTCSessionDescription({type:v.type,sdp:_})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const g=f.get.apply(this);return g.type===""?g:u(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(x=>g.track===x)&&(v=this._streams[_])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function FN(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=c[i]})}function g5(t,r){yu(t,"negotiationneeded",i=>{const s=i.target;if(!(r.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return i})}var v5=Object.freeze({__proto__:null,fixNegotiationNeeded:g5,shimAddTrackRemoveTrack:m5,shimAddTrackRemoveTrackWithNative:f5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(s=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:u5,shimGetStats:h5,shimGetUserMedia:c5,shimMediaStream:l5,shimOnTrack:d5,shimPeerConnection:FN,shimSenderReceiverGetStats:p5});function y5(t,r){const i=t&&t.navigator,s=t&&t.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){MN("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,f,g){f in h&&!(g in h)&&(h[g]=h[f],delete h[f])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const f=h.apply(this,arguments);return c(f,"mozAutoGainControl","autoGainControl"),c(f,"mozNoiseSuppression","noiseSuppression"),f}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f,"autoGainControl","mozAutoGainControl"),c(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function _5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function VN(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return s.apply(this,[c||null]).then(f=>{if(r.version<53&&!u)try{f.forEach(g=>{g.type=i[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;f.forEach((v,_)=>{f.set(_,Object.assign({},v,{type:i[v.type]||v.type}))})}return f}).then(u,h)}}function b5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(c=>c._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):De.resolve(new Map)}}function E5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i}),yu(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function x5(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){MN("removeStream","removeTrack"),this.getSenders().forEach(i=>{var s;i.track&&Te(s=r.getTracks()).call(s,i.track)&&this.removeTrack(i)})})}function S5(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function w5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(s){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function T5(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function C5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function N5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var R5=Object.freeze({__proto__:null,shimAddTransceiver:w5,shimCreateAnswer:N5,shimCreateOffer:C5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,De.reject(s)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:T5,shimGetUserMedia:y5,shimOnTrack:_5,shimPeerConnection:VN,shimRTCDataChannel:S5,shimReceiverGetStats:E5,shimRemoveStream:x5,shimSenderGetStats:b5});function A5(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){var s;this._localStreams||(this._localStreams=[]),Te(s=this._localStreams).call(s,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var f;this._localStreams?Te(f=this._localStreams).call(f,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const s=r.getTracks();this.getSenders().forEach(c=>{Te(s).call(s,c.track)&&this.removeTrack(c)})})}}function I5(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),Te(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),r.apply(i,arguments)}}}function O5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.createOffer,s=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(g,v){const _=arguments.length>=2?arguments[2]:arguments[0],x=i.apply(this,[_]);return v?(x.then(g,v),De.resolve()):x},r.createAnswer=function(g,v){const _=arguments.length>=2?arguments[2]:arguments[0],x=s.apply(this,[_]);return v?(x.then(g,v),De.resolve()):x};let f=function(g,v,_){const x=c.apply(this,[g]);return _?(x.then(v,_),De.resolve()):x};r.setLocalDescription=f,f=function(g,v,_){const x=u.apply(this,[g]);return _?(x.then(v,_),De.resolve()):x},r.setRemoteDescription=f,f=function(g,v,_){const x=h.apply(this,[g]);return _?(x.then(v,_),De.resolve()):x},r.addIceCandidate=f}function P5(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,s=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>s(D5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,s,c){r.mediaDevices.getUserMedia(i).then(s,c)}).bind(r))}function D5(t){return t&&t.video!==void 0?Object.assign({},t,{video:a5(t.video)}):t}function k5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(MN("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new r(i,s)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function j5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function L5(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function M5(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var U5=Object.freeze({__proto__:null,shimAudioContext:M5,shimCallbacksAPI:O5,shimConstraints:D5,shimCreateOfferLegacy:L5,shimGetUserMedia:P5,shimLocalStreamsAPI:A5,shimRTCIceServerUrls:k5,shimRemoteStreamsAPI:I5,shimTrackEventTransceiver:j5}),F5=`	
\v\f\r \u2028\u2029\uFEFF`,Aue=wt,Iue=va,BN=F5,V5=w("".replace),Oue=RegExp("^["+BN+"]+"),Pue=RegExp("(^|[^"+BN+"])["+BN+"]+$"),Due=function(t){return function(r){var i=Iue(Aue(r));return 1&t&&(i=V5(i,Oue,"")),2&t&&(i=V5(i,Pue,"$1")),i}},kue={trim:Due(3)},jue=xL.PROPER,Lue=p,B5=F5,Mue=kue.trim;Qt({target:"String",proto:!0,forced:function(t){return Lue(function(){return!!B5[t]()||""[t]()!==""||jue&&B5[t].name!==t})}("trim")},{trim:function(){return Mue(this)}});var Uue=is("String","trim"),Fue=N,Vue=Uue,GN=String.prototype,Bue=function(t){var r=t.trim;return typeof t=="string"||t===GN||Fue(GN,t)&&r===GN.trim?Vue:r},xi=d(Bue),G5={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(s=>s.trim())},r.splitSections=function(i){return i.split(`
m=`).map((s,c)=>(c>0?"m="+s:s).trim()+`\r
`)},r.getDescription=function(i){const s=r.splitSections(i);return s&&s[0]},r.getMediaSections=function(i){const s=r.splitSections(i);return s.shift(),s},r.matchPrefix=function(i,s){return r.splitLines(i).filter(c=>c.indexOf(s)===0)},r.parseCandidate=function(i){let s;s=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let u=8;u<s.length;u+=2)switch(s[u]){case"raddr":c.relatedAddress=s[u+1];break;case"rport":c.relatedPort=parseInt(s[u+1],10);break;case"tcptype":c.tcpType=s[u+1];break;case"ufrag":c.ufrag=s[u+1],c.usernameFragment=s[u+1];break;default:c[s[u]]===void 0&&(c[s[u]]=s[u+1])}return c},r.writeCandidate=function(i){const s=[];s.push(i.foundation);const c=i.component;c==="rtp"?s.push(1):c==="rtcp"?s.push(2):s.push(c),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const u=i.type;return s.push("typ"),s.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let s=i.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=s.length===3?parseInt(s[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let s=i.payloadType;i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const s=i.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const s={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),s[c[0].trim()]=c[1];return s},r.writeFmtp=function(i){let s="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),s+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return s},r.parseRtcpFb=function(i){const s=i.substring(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},r.writeRtcpFb=function(i){let s="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{s+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),s},r.parseSsrcMedia=function(i){const s=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,s),10)},u=i.indexOf(":",s);return u>-1?(c.attribute=i.substring(s+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(s+1),c},r.parseSsrcGroup=function(i){const s=i.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},r.getMid=function(i){const s=r.matchPrefix(i,"a=mid:")[0];if(s)return s.substring(6)},r.parseFingerprint=function(i){const s=i.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},r.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:r.matchPrefix(i+s,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,s){let c="a=setup:"+s+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(i){const s=i.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const s=i.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,s){return r.matchPrefix(i+s,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,s){const c=r.matchPrefix(i+s,"a=ice-ufrag:")[0],u=r.matchPrefix(i+s,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(s+=`a=ice-lite\r
`),s},r.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");s.profile=c[2];for(let h=3;h<c.length;h++){const f=c[h],g=r.matchPrefix(i,"a=rtpmap:"+f+" ")[0];if(g){const v=r.parseRtpMap(g),_=r.matchPrefix(i,"a=fmtp:"+f+" ");switch(v.parameters=_.length?r.parseFmtp(_[0]):{},v.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+f+" ").map(r.parseRtcpFb),s.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(h=>{s.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return s.codecs.forEach(h=>{u.forEach(f=>{h.rtcpFeedback.find(g=>g.type===f.type&&g.parameter===f.parameter)||h.rtcpFeedback.push(f)})}),s},r.writeRtpDescription=function(i,s){let c="";c+="m="+i+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return s.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(i){const s=[],c=r.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,f=r.matchPrefix(i,"a=ssrc:").map(S=>r.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),g=f.length>0&&f[0].ssrc;let v;const _=r.matchPrefix(i,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(C=>parseInt(C,10)));_.length>0&&_[0].length>1&&_[0][0]===g&&(v=_[0][1]),c.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let C={ssrc:g,codecPayloadType:parseInt(S.parameters.apt,10)};g&&v&&(C.rtx={ssrc:v}),s.push(C),u&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},s.push(C))}}),s.length===0&&g&&s.push({ssrc:g});let x=r.matchPrefix(i,"b=");return x.length&&(x=x[0].indexOf("b=TIAS:")===0?parseInt(x[0].substring(7),10):x[0].indexOf("b=AS:")===0?1e3*parseInt(x[0].substring(5),10)*.95-16e3:void 0,s.forEach(S=>{S.maxBitrate=x})),s},r.parseRtcpParameters=function(i){const s={},c=r.matchPrefix(i,"a=ssrc:").map(f=>r.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const u=r.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=u.length>0,s.compound=u.length===0;const h=r.matchPrefix(i,"a=rtcp-mux");return s.mux=h.length>0,s},r.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+=`a=rtcp-rsize\r
`),i.mux&&(s+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),s},r.parseMsid=function(i){let s;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const u=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(s=u[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},r.parseSctpDescription=function(i){const s=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:u};const f=r.matchPrefix(i,"a=sctpmap:");if(f.length>0){const g=f[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:u}}},r.writeSctpDescription=function(i,s){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&c.push("a=max-message-size:"+s.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,s,c){let u;const h=s!==void 0?s:2;return u=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,s){const c=r.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return s?r.getDirection(s):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const s=r.splitLines(i)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},r.parseOLine=function(i){const s=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const s=r.splitLines(i);for(let c=0;c<s.length;c++)if(s[c].length<2||s[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(G5);var W5=G5.exports,_p=d(W5),Gue=a({__proto__:null,default:_p},[W5]);function j0(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new r(i),c=_p.parseCandidate(i.candidate),u=Object.assign(s,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(i)},t.RTCIceCandidate.prototype=r.prototype,yu(t,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new t.RTCIceCandidate(i.candidate),writable:"false"}),i))}function WN(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||yu(t,"icecandidate",r=>{if(r.candidate){const i=_p.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function L0(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(f){if(!f||!f.sdp)return!1;const g=_p.splitSections(f.sdp);return g.shift(),g.some(v=>{const _=_p.parseMLine(v);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},s=function(f){const g=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const v=parseInt(g[1],10);return v!=v?-1:v},c=function(f){let g=65536;return r.browser==="firefox"&&(g=r.version<57?f===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},u=function(f,g){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const _=_p.matchPrefix(f.sdp,"a=max-message-size:");return _.length>0?v=parseInt(_[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const f=s(arguments[0]),g=c(f),v=u(arguments[0],f);let _;_=g===0&&v===0?Number.POSITIVE_INFINITY:g===0||v===0?Math.max(g,v):Math.min(g,v);const x={};Object.defineProperty(x,"maxMessageSize",{get:()=>_}),this._sctp=x}return h.apply(this,arguments)}}function M0(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(s,c){const u=s.send;s.send=function(){const h=arguments[0],f=h.length||h.size||h.byteLength;if(s.readyState==="open"&&c.sctp&&f>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(s,arguments)}}const i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return r(s,this),s},yu(t,"datachannel",s=>(r(s.channel,s.target),s))}function $N(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function HN(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=s.sdp.split(`
`).filter(u=>xi(u).call(u)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return i.apply(this,arguments)}}function U0(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?De.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),De.resolve())})}function F0(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?i.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Wue=Object.freeze({__proto__:null,removeExtmapAllowMixed:HN,shimAddIceCandidateNullOrEmpty:U0,shimConnectionState:$N,shimMaxMessageSize:L0,shimParameterlessSetLocalDescription:F0,shimRTCIceCandidate:j0,shimRTCIceCandidateRelayProtocol:WN,shimSendThrowTypeError:M0});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=r5,s=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:f}=u;if(f.mozGetUserMedia)h.browser="firefox",h.version=k0(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=k0(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=k0(f.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:s,commonShim:Wue,extractVersion:k0,disableLog:Nue,disableWarnings:Rue,sdp:Gue};switch(s.browser){case"chrome":if(!v5||!FN||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(s.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=v5,U0(t,s),F0(t),c5(t,s),l5(t),FN(t,s),d5(t),m5(t,s),u5(t),h5(t),p5(t),g5(t,s),j0(t),WN(t),$N(t),L0(t,s),M0(t),HN(t,s);break;case"firefox":if(!R5||!VN||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=R5,U0(t,s),F0(t),y5(t,s),VN(t,s),_5(t),x5(t),b5(t),E5(t),S5(t),w5(t),T5(t),C5(t),N5(t),j0(t),$N(t),L0(t,s),M0(t);break;case"safari":if(!U5||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=U5,U0(t,s),F0(t),k5(t),L5(t),O5(t),A5(t),I5(t),j5(t),P5(t),M5(t),j0(t),WN(t),L0(t,s),M0(t),HN(t,s);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var $ue=p,$5=A.RegExp,Hue=!$ue(function(){var t=!0;try{$5(".","d")}catch{t=!1}var r={},i="",s=t?"dgimsy":"gimsy",c=function(f,g){Object.defineProperty(r,f,{get:function(){return i+=g,!0}})},u={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var h in t&&(u.hasIndices="d"),u)c(h,u[h]);return Object.getOwnPropertyDescriptor($5.prototype,"flags").get.call(r)!==s||i!==s}),zue=ga,Kue=be,Yue=ri,que=N,H5={correct:Hue},Xue=function(){var t=zue(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},Jue=RegExp.prototype,zN=H5.correct?function(t){return t.flags}:function(t){return H5.correct||!que(Jue,t)||Yue(t,"flags")?t.flags:Kue(Xue,t)},KN=w,Que=Math.floor,YN=KN("".charAt),Zue=KN("".replace),qN=KN("".slice),ehe=/\$([$&'`]|\d{1,2})/g,the=Qt,nhe=be,XN=w,z5=wt,rhe=ue,ihe=Qe,ahe=QT,bp=va,she=ag,ohe=zN,che=function(t,r,i,s,c,u){var h=i+t.length,f=s.length,g=ehe;return Zue(u,g,function(v,_){var x;switch(YN(_,0)){case"$":return"$";case"&":return t;case"`":return qN(r,0,i);case"'":return qN(r,h);case"<":x=c[qN(_,1,-1)];break;default:var S=+_;if(S===0)return v;if(S>f){var C=Que(S/10);return C===0?v:C<=f?s[C-1]===void 0?YN(_,1):s[C-1]+YN(_,1):v}x=s[S-1]}return x===void 0?"":x})},lhe=Zn("replace"),dhe=TypeError,JN=XN("".indexOf),uhe=XN("".replace),K5=XN("".slice),hhe=Math.max;the({target:"String",proto:!0},{replaceAll:function(t,r){var i,s,c,u,h,f,g,v,_,x,S=z5(this),C=0,U="";if(ihe(t)){if((i=ahe(t))&&(s=bp(z5(ohe(t))),!~JN(s,"g")))throw new dhe("`.replaceAll` does not allow non-global regexes");if(c=she(t,lhe))return nhe(c,t,S,r);if(i)return uhe(bp(S),t,r)}for(u=bp(S),h=bp(t),(f=rhe(r))||(r=bp(r)),g=h.length,v=hhe(1,g),_=JN(u,h);_!==-1;)x=f?bp(r(h,_,u)):che(h,u,_,[],void 0,r),U+=K5(u,C,_)+x,C=_+g,_=_+v>u.length?-1:JN(u,h,_+v);return C<u.length&&(U+=K5(u,C)),U}});var phe=is("String","replaceAll"),fhe=N,mhe=phe,QN=String.prototype,ghe=function(t){var r=t.replaceAll;return typeof t=="string"||t===QN||fhe(QN,t)&&r===QN.replaceAll?mhe:r},vhe=d(ghe),ZN=A;Qt({global:!0,forced:ZN.globalThis!==ZN},{globalThis:ZN});var Y5=d(A),eR={exports:{}};(function(t,r){(function(i,s){var c="function",u="undefined",h="object",f="string",g="major",v="model",_="name",x="type",S="vendor",C="version",U="architecture",P="console",j="mobile",W="tablet",K="smarttv",J="wearable",re="embedded",ie="Amazon",Z="Apple",se="ASUS",ge="BlackBerry",Ee="Browser",Fe="Chrome",ht="Firefox",ot="Google",St="Honor",yt="Huawei",Yt="LG",Cn="Microsoft",ve="Motorola",Oe="Nvidia",We="OnePlus",_e="Opera",I="OPPO",X="Samsung",te="Sharp",Ne="Sony",mt="Xiaomi",gn="Zebra",xr="Facebook",gs="Chromium OS",_d="Mac OS",FE=" Browser",gf=function(nr){for(var dr={},Sn=0;Sn<nr.length;Sn++)dr[nr[Sn].toUpperCase()]=nr[Sn];return dr},VE=function(nr,dr){return typeof nr===f&&th(dr).indexOf(th(nr))!==-1},th=function(nr){return nr.toLowerCase()},Iv=function(nr,dr){if(typeof nr===f)return nr=nr.replace(/^\s\s*/,""),typeof dr===u?nr:nr.substring(0,500)},nh=function(nr,dr){for(var Sn,ra,Go,zn,ul,Vt,Wo=0;Wo<dr.length&&!ul;){var rh=dr[Wo],Oc=dr[Wo+1];for(Sn=ra=0;Sn<rh.length&&!ul&&rh[Sn];)if(ul=rh[Sn++].exec(nr))for(Go=0;Go<Oc.length;Go++)Vt=ul[++ra],typeof(zn=Oc[Go])===h&&zn.length>0?zn.length===2?typeof zn[1]==c?this[zn[0]]=zn[1].call(this,Vt):this[zn[0]]=zn[1]:zn.length===3?typeof zn[1]!==c||zn[1].exec&&zn[1].test?this[zn[0]]=Vt?Vt.replace(zn[1],zn[2]):s:this[zn[0]]=Vt?zn[1].call(this,Vt,zn[2]):s:zn.length===4&&(this[zn[0]]=Vt?zn[3].call(this,Vt.replace(zn[1],zn[2])):s):this[zn]=Vt||s;Wo+=2}},bd=function(nr,dr){for(var Sn in dr)if(typeof dr[Sn]===h&&dr[Sn].length>0){for(var ra=0;ra<dr[Sn].length;ra++)if(VE(dr[Sn][ra],nr))return Sn==="?"?s:Sn}else if(VE(dr[Sn],nr))return Sn==="?"?s:Sn;return dr.hasOwnProperty("*")?dr["*"]:nr},M$={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},U$={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,C],[/opios[\/ ]+([\w\.]+)/i],[C,[_,_e+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[C,[_,_e+" GX"]],[/\bopr\/([\w\.]+)/i],[C,[_,_e]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[C,[_,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[C,[_,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_,C],[/quark(?:pc)?\/([-\w\.]+)/i],[C,[_,"Quark"]],[/\bddg\/([\w\.]+)/i],[C,[_,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[_,"UC"+Ee]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[C,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[_,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[C,[_,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[C,[_,"Smart Lenovo "+Ee]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+Ee],C],[/\bfocus\/([\w\.]+)/i],[C,[_,ht+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[_,_e+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[_,_e+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[_,"MIUI"+FE]],[/fxios\/([\w\.-]+)/i],[C,[_,ht]],[/\bqihoobrowser\/?([\w\.]*)/i],[C,[_,"360"]],[/\b(qq)\/([\w\.]+)/i],[[_,/(.+)/,"$1Browser"],C],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1"+FE],C],[/samsungbrowser\/([\w\.]+)/i],[C,[_,X+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[C,[_,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_,"Sogou Mobile"],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[_,C],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[_],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[C,_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,xr],C],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[_,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[C,[_,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[_,Fe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,Fe+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[_,"Android "+Ee]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[C,bd,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],C],[/(wolvic|librewolf)\/([\w\.]+)/i],[_,C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[_,ht+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[_,[C,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[_,[C,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[U,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[U,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[U,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[U,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[U,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[U,/ower/,"",th]],[/ sun4\w[;\)]/i],[[U,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[U,th]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[S,X],[x,W]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[S,X],[x,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[S,Z],[x,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[S,Z],[x,W]],[/(macintosh);/i],[v,[S,Z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[S,te],[x,j]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[v,[S,St],[x,W]],[/honor([-\w ]+)[;\)]/i],[v,[S,St],[x,j]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[v,[S,yt],[x,W]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[S,yt],[x,j]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[v,/_/g," "],[S,mt],[x,W]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[v,/_/g," "],[S,mt],[x,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[S,I],[x,j]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[v,[S,bd,{OnePlus:["304","403","203"],"*":I}],[x,W]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[S,"Vivo"],[x,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[S,"Realme"],[x,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[S,ve],[x,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[S,ve],[x,W]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[S,Yt],[x,W]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[S,Yt],[x,j]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[v,[S,"Lenovo"],[x,W]],[/(nokia) (t[12][01])/i],[S,v,[x,W]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[v,/_/g," "],[x,j],[S,"Nokia"]],[/(pixel (c|tablet))\b/i],[v,[S,ot],[x,W]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[S,ot],[x,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[S,Ne],[x,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[S,Ne],[x,W]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[S,We],[x,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[S,ie],[x,W]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[S,ie],[x,j]],[/(playbook);[-\w\),; ]+(rim)/i],[v,S,[x,W]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[S,ge],[x,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[S,se],[x,W]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[S,se],[x,j]],[/(nexus 9)/i],[v,[S,"HTC"],[x,W]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[v,/_/g," "],[x,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[S,"TCL"],[x,W]],[/(itel) ((\w+))/i],[[S,th],v,[x,bd,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[S,"Acer"],[x,W]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[S,"Meizu"],[x,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[S,"Ulefone"],[x,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[S,"Energizer"],[x,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[S,"Cat"],[x,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[S,"Smartfren"],[x,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[S,"Nothing"],[x,j]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[v,[S,"Archos"],[x,W]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[v,[S,"Archos"],[x,j]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[S,v,[x,W]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[S,v,[x,j]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,v,[x,W]],[/(surface duo)/i],[v,[S,Cn],[x,W]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[S,"Fairphone"],[x,j]],[/(u304aa)/i],[v,[S,"AT&T"],[x,j]],[/\bsie-(\w*)/i],[v,[S,"Siemens"],[x,j]],[/\b(rct\w+) b/i],[v,[S,"RCA"],[x,W]],[/\b(venue[\d ]{2,7}) b/i],[v,[S,"Dell"],[x,W]],[/\b(q(?:mv|ta)\w+) b/i],[v,[S,"Verizon"],[x,W]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[S,"Barnes & Noble"],[x,W]],[/\b(tm\d{3}\w+) b/i],[v,[S,"NuVision"],[x,W]],[/\b(k88) b/i],[v,[S,"ZTE"],[x,W]],[/\b(nx\d{3}j) b/i],[v,[S,"ZTE"],[x,j]],[/\b(gen\d{3}) b.+49h/i],[v,[S,"Swiss"],[x,j]],[/\b(zur\d{3}) b/i],[v,[S,"Swiss"],[x,W]],[/\b((zeki)?tb.*\b) b/i],[v,[S,"Zeki"],[x,W]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],v,[x,W]],[/\b(ns-?\w{0,9}) b/i],[v,[S,"Insignia"],[x,W]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[S,"NextBook"],[x,W]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],v,[x,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],v,[x,j]],[/\b(ph-1) /i],[v,[S,"Essential"],[x,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[S,"Envizen"],[x,W]],[/\b(trio[-\w\. ]+) b/i],[v,[S,"MachSpeed"],[x,W]],[/\btu_(1491) b/i],[v,[S,"Rotor"],[x,W]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[v,[S,Oe],[x,W]],[/(sprint) (\w+)/i],[S,v,[x,j]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[S,Cn],[x,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[S,gn],[x,W]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[S,gn],[x,j]],[/smart-tv.+(samsung)/i],[S,[x,K]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[S,X],[x,K]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Yt],[x,K]],[/(apple) ?tv/i],[S,[v,Z+" TV"],[x,K]],[/crkey/i],[[v,Fe+"cast"],[S,ot],[x,K]],[/droid.+aft(\w+)( bui|\))/i],[v,[S,ie],[x,K]],[/(shield \w+ tv)/i],[v,[S,Oe],[x,K]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[S,te],[x,K]],[/(bravia[\w ]+)( bui|\))/i],[v,[S,Ne],[x,K]],[/(mi(tv|box)-?\w+) bui/i],[v,[S,mt],[x,K]],[/Hbbtv.*(technisat) (.*);/i],[S,v,[x,K]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Iv],[v,Iv],[x,K]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[v,[x,K]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[x,K]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,v,[x,P]],[/droid.+; (shield)( bui|\))/i],[v,[S,Oe],[x,P]],[/(playstation \w+)/i],[v,[S,Ne],[x,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[S,Cn],[x,P]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[v,[S,X],[x,J]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[S,v,[x,J]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[v,[S,I],[x,J]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[S,Z],[x,J]],[/(opwwe\d{3})/i],[v,[S,We],[x,J]],[/(moto 360)/i],[v,[S,ve],[x,J]],[/(smartwatch 3)/i],[v,[S,Ne],[x,J]],[/(g watch r)/i],[v,[S,Yt],[x,J]],[/droid.+; (wt63?0{2,3})\)/i],[v,[S,gn],[x,J]],[/droid.+; (glass) \d/i],[v,[S,ot],[x,J]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,v,[x,J]],[/; (quest( \d| pro)?)/i],[v,[S,xr],[x,J]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[x,re]],[/(aeobc)\b/i],[v,[S,ie],[x,re]],[/(homepod).+mac os/i],[v,[S,Z],[x,re]],[/windows iot/i],[[x,re]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[x,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[x,W]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[x,W]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[x,j]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[v,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[_,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[_,C],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_,C],[/ladybird\//i],[[_,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,C],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[_,[C,bd,M$]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[C,bd,M$],[_,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,_d],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,_],[/(ubuntu) ([\w\.]+) like android/i],[[_,/(.+)/,"$1 Touch"],C],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[_,C],[/\(bb(10);/i],[C,[_,ge]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[C,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[_,ht+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[_,Fe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,gs],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,C],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_,C]]},Bo=function(nr,dr){if(typeof nr===h&&(dr=nr,nr=s),!(this instanceof Bo))return new Bo(nr,dr).getResult();var Sn=typeof i!==u&&i.navigator?i.navigator:s,ra=nr||(Sn&&Sn.userAgent?Sn.userAgent:""),Go=Sn&&Sn.userAgentData?Sn.userAgentData:s,zn=dr?function(Vt,Wo){var rh={};for(var Oc in Vt)Wo[Oc]&&Wo[Oc].length%2==0?rh[Oc]=Wo[Oc].concat(Vt[Oc]):rh[Oc]=Vt[Oc];return rh}(U$,dr):U$,ul=Sn&&Sn.userAgent==ra;return this.getBrowser=function(){var Vt={};return Vt[_]=s,Vt[C]=s,nh.call(Vt,ra,zn.browser),Vt[g]=function(Wo){return typeof Wo===f?Wo.replace(/[^\d\.]/g,"").split(".")[0]:s}(Vt[C]),ul&&Sn&&Sn.brave&&typeof Sn.brave.isBrave==c&&(Vt[_]="Brave"),Vt},this.getCPU=function(){var Vt={};return Vt[U]=s,nh.call(Vt,ra,zn.cpu),Vt},this.getDevice=function(){var Vt={};return Vt[S]=s,Vt[v]=s,Vt[x]=s,nh.call(Vt,ra,zn.device),ul&&!Vt[x]&&Go&&Go.mobile&&(Vt[x]=j),ul&&Vt[v]=="Macintosh"&&Sn&&typeof Sn.standalone!==u&&Sn.maxTouchPoints&&Sn.maxTouchPoints>2&&(Vt[v]="iPad",Vt[x]=W),Vt},this.getEngine=function(){var Vt={};return Vt[_]=s,Vt[C]=s,nh.call(Vt,ra,zn.engine),Vt},this.getOS=function(){var Vt={};return Vt[_]=s,Vt[C]=s,nh.call(Vt,ra,zn.os),ul&&!Vt[_]&&Go&&Go.platform&&Go.platform!="Unknown"&&(Vt[_]=Go.platform.replace(/chrome os/i,gs).replace(/macos/i,_d)),Vt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ra},this.setUA=function(Vt){return ra=typeof Vt===f&&Vt.length>500?Iv(Vt,500):Vt,this},this.setUA(ra),this};Bo.VERSION="0.7.41",Bo.BROWSER=gf([_,C,g]),Bo.CPU=gf([U]),Bo.DEVICE=gf([v,S,x,P,j,K,W,J,re]),Bo.ENGINE=Bo.OS=gf([_,C]),t.exports&&(r=t.exports=Bo),r.UAParser=Bo;var vf=typeof i!==u&&(i.jQuery||i.Zepto);if(vf&&!vf.ua){var BE=new Bo;vf.ua=BE.getResult(),vf.ua.get=function(){return BE.getUA()},vf.ua.set=function(nr){BE.setUA(nr);var dr=BE.getResult();for(var Sn in dr)vf.ua[Sn]=dr[Sn]}}})(typeof window=="object"?window:o)})(eR,eR.exports);var yhe=d(eR.exports),q5=h0.clear;Qt({global:!0,bind:!0,forced:A.clearImmediate!==q5},{clearImmediate:q5});var X5=A,_he=V,bhe=ue,Ehe=nC,xhe=Wn,She=Kl,whe=hu,The=X5.Function,Che=/MSIE .\./.test(xhe)||Ehe==="BUN"&&function(){var t=X5.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),Nhe=Qt,J5=A,Q5=h0.set,Rhe=function(t,r){var i=1;return Che?function(s,c){var u=whe(arguments.length,1)>i,h=bhe(s)?s:The(s),f=u?She(arguments,i):[],g=u?function(){_he(h,this,f)}:h;return t(g)}:t},Z5=J5.setImmediate?Rhe(Q5):Q5;Nhe({global:!0,bind:!0,forced:J5.setImmediate!==Z5},{setImmediate:Z5});var e3=d(Wt.setImmediate),Ahe=A,Ihe=oM,Ohe=Da,Phe=hu,Dhe=fe;Qt({global:!0,dontCallGetSet:!0,forced:p(function(){return Dhe&&Object.getOwnPropertyDescriptor(Ahe,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){Phe(arguments.length,1),Ihe(Ohe(t))}});var t3=d(Wt.queueMicrotask);function n3(t,r){return function(){return t.apply(r,arguments)}}const{toString:khe}=Object.prototype,{getPrototypeOf:tR}=Object,{iterator:V0,toStringTag:r3}=Symbol,B0=(nR=Object.create(null),t=>{const r=khe.call(t);return nR[r]||(nR[r]=r.slice(8,-1).toLowerCase())});var nR;const So=t=>(t=t.toLowerCase(),r=>B0(r)===t),G0=t=>r=>typeof r===t,{isArray:Ep}=Array,xp=G0("undefined");function Rg(t){return t!==null&&!xp(t)&&t.constructor!==null&&!xp(t.constructor)&&ka(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const i3=So("ArrayBuffer"),jhe=G0("string"),ka=G0("function"),a3=G0("number"),Ag=t=>t!==null&&typeof t=="object",W0=t=>{if(B0(t)!=="object")return!1;const r=tR(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||r3 in t||V0 in t)},Lhe=So("Date"),Mhe=So("File"),Uhe=So("Blob"),Fhe=So("FileList"),Vhe=So("URLSearchParams"),[Bhe,Ghe,Whe,$he]=["ReadableStream","Request","Response","Headers"].map(So);function Ig(t,r){let i,s,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Ep(t))for(i=0,s=t.length;i<s;i++)r.call(null,t[i],i,t);else{if(Rg(t))return;const u=c?Object.getOwnPropertyNames(t):Object.keys(t),h=u.length;let f;for(i=0;i<h;i++)f=u[i],r.call(null,t[f],f,t)}}function s3(t,r){if(Rg(t))return null;r=r.toLowerCase();const i=Object.keys(t);let s,c=i.length;for(;c-- >0;)if(s=i[c],r===s.toLowerCase())return s;return null}const _u=Y5!==void 0?Y5:typeof self<"u"?self:typeof window<"u"?window:Id,o3=t=>!xp(t)&&t!==_u,Hhe=(rR=typeof Uint8Array<"u"&&tR(Uint8Array),t=>rR&&t instanceof rR);var rR;const zhe=So("HTMLFormElement"),c3=(t=>{let{hasOwnProperty:r}=t;return(i,s)=>r.call(i,s)})(Object.prototype),Khe=So("RegExp"),l3=(t,r)=>{const i=Object.getOwnPropertyDescriptors(t),s={};Ig(i,(c,u)=>{let h;(h=r(c,u,t))!==!1&&(s[u]=h||c)}),Object.defineProperties(t,s)},Yhe=So("AsyncFunction"),d3=(u3=typeof e3=="function",h3=ka(_u.postMessage),u3?e3:h3?(iR="axios@".concat(Math.random()),$0=[],_u.addEventListener("message",t=>{let{source:r,data:i}=t;r===_u&&i===iR&&$0.length&&$0.shift()()},!1),t=>{$0.push(t),_u.postMessage(iR,"*")}):t=>setTimeout(t));var u3,h3,iR,$0;const qhe=t3!==void 0?t3.bind(_u):typeof process<"u"&&process.nextTick||d3;var je={isArray:Ep,isArrayBuffer:i3,isBuffer:Rg,isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||ka(t.append)&&((r=B0(t))==="formdata"||r==="object"&&ka(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&i3(t.buffer),r},isString:jhe,isNumber:a3,isBoolean:t=>t===!0||t===!1,isObject:Ag,isPlainObject:W0,isEmptyObject:t=>{if(!Ag(t)||Rg(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},isReadableStream:Bhe,isRequest:Ghe,isResponse:Whe,isHeaders:$he,isUndefined:xp,isDate:Lhe,isFile:Mhe,isBlob:Uhe,isRegExp:Khe,isFunction:ka,isStream:t=>Ag(t)&&ka(t.pipe),isURLSearchParams:Vhe,isTypedArray:Hhe,isFileList:Fhe,forEach:Ig,merge:function t(){const{caseless:r,skipUndefined:i}=o3(this)&&this||{},s={},c=(u,h)=>{const f=r&&s3(s,h)||h;W0(s[f])&&W0(u)?s[f]=t(s[f],u):W0(u)?s[f]=t({},u):Ep(u)?s[f]=u.slice():i&&xp(u)||(s[f]=u)};for(let u=0,h=arguments.length;u<h;u++)arguments[u]&&Ig(arguments[u],c);return s},extend:function(t,r,i){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ig(r,(c,u)=>{i&&ka(c)?t[u]=n3(c,i):t[u]=c},{allOwnKeys:s}),t},trim:t=>xi(t)?xi(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,i,s)=>{t.prototype=Object.create(r.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),i&&Object.assign(t.prototype,i)},toFlatObject:(t,r,i,s)=>{let c,u,h;const f={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)h=c[u],s&&!s(h,t,r)||f[h]||(r[h]=t[h],f[h]=!0);t=i!==!1&&tR(t)}while(t&&(!i||i(t,r))&&t!==Object.prototype);return r},kindOf:B0,kindOfTest:So,endsWith:(t,r,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=r.length;const s=t.indexOf(r,i);return s!==-1&&s===i},toArray:t=>{if(!t)return null;if(Ep(t))return t;let r=t.length;if(!a3(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=t[r];return i},forEachEntry:(t,r)=>{const i=(t&&t[V0]).call(t);let s;for(;(s=i.next())&&!s.done;){const c=s.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let i;const s=[];for(;(i=t.exec(r))!==null;)s.push(i);return s},isHTMLForm:zhe,hasOwnProperty:c3,hasOwnProp:c3,reduceDescriptors:l3,freezeMethods:t=>{l3(t,(r,i)=>{if(ka(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const s=t[i];ka(s)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(t,r)=>{const i={},s=c=>{c.forEach(u=>{i[u]=!0})};return Ep(t)?s(t):s(String(t).split(r)),i},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,s){return i.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:s3,global:_u,isContextDefined:o3,isSpecCompliantForm:function(t){return!!(t&&ka(t.append)&&t[r3]==="FormData"&&t[V0])},toJSONObject:t=>{const r=new Array(10),i=(s,c)=>{if(Ag(s)){if(r.indexOf(s)>=0)return;if(Rg(s))return s;if(!("toJSON"in s)){r[c]=s;const u=Ep(s)?[]:{};return Ig(s,(h,f)=>{const g=i(h,c+1);!xp(g)&&(u[f]=g)}),r[c]=void 0,u}}return s};return i(t,0)},isAsyncFn:Yhe,isThenable:t=>t&&(Ag(t)||ka(t))&&ka(t.then)&&ka(t.catch),setImmediate:d3,asap:qhe,isIterable:t=>t!=null&&ka(t[V0])};function on(t,r,i,s,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),s&&(this.request=s),c&&(this.response=c,this.status=c.status?c.status:null)}je.inherits(on,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:je.toJSONObject(this.config),code:this.code,status:this.status}}});const p3=on.prototype,f3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{f3[t]={value:t}}),Object.defineProperties(on,f3),Object.defineProperty(p3,"isAxiosError",{value:!0}),on.from=(t,r,i,s,c,u)=>{const h=Object.create(p3);je.toFlatObject(t,h,function(v){return v!==Error.prototype},v=>v!=="isAxiosError");const f=t&&t.message?t.message:"Error",g=r==null&&t?t.code:r;return on.call(h,f,g,i,s,c),t&&h.cause==null&&Object.defineProperty(h,"cause",{value:t,configurable:!0}),h.name=t&&t.name||"Error",u&&Object.assign(h,u),h};function aR(t){return je.isPlainObject(t)||je.isArray(t)}function m3(t){return je.endsWith(t,"[]")?t.slice(0,-2):t}function g3(t,r,i){return t?t.concat(r).map(function(s,c){return s=m3(s),!i&&c?"["+s+"]":s}).join(i?".":""):r}const Xhe=je.toFlatObject(je,{},null,function(t){return/^is[A-Z]/.test(t)});function H0(t,r,i){if(!je.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const s=(i=je.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,C){return!je.isUndefined(C[S])})).metaTokens,c=i.visitor||v,u=i.dots,h=i.indexes,f=(i.Blob||typeof Blob<"u"&&Blob)&&je.isSpecCompliantForm(r);if(!je.isFunction(c))throw new TypeError("visitor must be a function");function g(S){if(S===null)return"";if(je.isDate(S))return S.toISOString();if(je.isBoolean(S))return S.toString();if(!f&&je.isBlob(S))throw new on("Blob is not supported. Use a Buffer instead.");return je.isArrayBuffer(S)||je.isTypedArray(S)?f&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function v(S,C,U){let P=S;if(S&&!U&&typeof S=="object"){if(je.endsWith(C,"{}"))C=s?C:C.slice(0,-2),S=JSON.stringify(S);else if(je.isArray(S)&&function(j){return je.isArray(j)&&!j.some(aR)}(S)||(je.isFileList(S)||je.endsWith(C,"[]"))&&(P=je.toArray(S)))return C=m3(C),P.forEach(function(j,W){!je.isUndefined(j)&&j!==null&&r.append(h===!0?g3([C],W,u):h===null?C:C+"[]",g(j))}),!1}return!!aR(S)||(r.append(g3(U,C,u),g(S)),!1)}const _=[],x=Object.assign(Xhe,{defaultVisitor:v,convertValue:g,isVisitable:aR});if(!je.isObject(t))throw new TypeError("data must be an object");return function S(C,U){if(!je.isUndefined(C)){if(_.indexOf(C)!==-1)throw Error("Circular reference detected in "+U.join("."));_.push(C),je.forEach(C,function(P,j){(!(je.isUndefined(P)||P===null)&&c.call(r,P,je.isString(j)?xi(j).call(j):j,U,x))===!0&&S(P,U?U.concat(j):[j])}),_.pop()}}(t),r}function v3(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function sR(t,r){this._pairs=[],t&&H0(t,this,r)}const y3=sR.prototype;function Jhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function _3(t,r,i){if(!r)return t;const s=i&&i.encode||Jhe;je.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(r,i):je.isURLSearchParams(r)?r.toString():new sR(r,i).toString(s),u){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}y3.append=function(t,r){this._pairs.push([t,r])},y3.toString=function(t){const r=t?function(i){return t.call(this,i,v3)}:v3;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var b3=class{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){je.forEach(this.handlers,function(r){r!==null&&t(r)})}},E3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},x3={exports:{}},Qhe=Qt,Zhe=fe,S3=Is.f;Qhe({target:"Object",stat:!0,forced:Object.defineProperty!==S3,sham:!Zhe},{defineProperty:S3});var w3=Wt.Object,epe=x3.exports=function(t,r,i){return w3.defineProperty(t,r,i)};w3.defineProperty.sham&&(epe.sham=!0);var T3=d(x3.exports),tpe=TypeError,C3=lg,npe=u0,rpe=Qe,ipe=Zn("species"),N3=Array,ape=function(t){var r;return C3(t)&&(r=t.constructor,(npe(r)&&(r===N3||C3(r.prototype))||rpe(r)&&(r=r[ipe])===null)&&(r=void 0)),r===void 0?N3:r},R3=function(t,r){return new(ape(t))(r===0?0:r)},spe=p,ope=gr,cpe=Zn("species"),A3=function(t){return ope>=51||!spe(function(){var r=[];return(r.constructor={})[cpe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},lpe=Qt,dpe=p,upe=lg,hpe=Qe,ppe=lc,fpe=$l,I3=function(t){if(t>9007199254740991)throw tpe("Maximum allowed index exceeded");return t},O3=mN,mpe=R3,gpe=A3,vpe=gr,P3=Zn("isConcatSpreadable"),ype=vpe>=51||!dpe(function(){var t=[];return t[P3]=!1,t.concat()[0]!==t}),_pe=function(t){if(!hpe(t))return!1;var r=t[P3];return r!==void 0?!!r:upe(t)};lpe({target:"Array",proto:!0,forced:!ype||!gpe("concat")},{concat:function(t){var r,i,s,c,u,h=ppe(this),f=mpe(h,0),g=0;for(r=-1,s=arguments.length;r<s;r++)if(_pe(u=r===-1?h:arguments[r]))for(c=fpe(u),I3(g+c),i=0;i<c;i++,g++)i in u&&O3(f,g,u[i]);else I3(g+1),O3(f,g++,u);return f.length=g,f}});var D3={},bpe=q,Epe=At,k3=q_.f,xpe=Kl,j3=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];D3.f=function(t){return j3&&bpe(t)==="Window"?function(r){try{return k3(r)}catch{return xpe(j3)}}(t):k3(Epe(t))};var Sp={},Spe=Zn;Sp.f=Spe;var L3=Wt,wpe=ri,Tpe=Sp,Cpe=Is.f,Lr=function(t){var r=L3.Symbol||(L3.Symbol={});wpe(r,t)||Cpe(r,t,{value:Tpe.f(t)})},Npe=be,Rpe=tt,Ape=Zn,Ipe=zl,M3=function(){var t=Rpe("Symbol"),r=t&&t.prototype,i=r&&r.valueOf,s=Ape("toPrimitive");r&&!r[s]&&Ipe(r,s,function(c){return Npe(i,this)},{})},Ope=Wl,Ppe=Pe,Dpe=lc,kpe=$l,jpe=R3,U3=w([].push),Lpe=function(t){var r=t===1,i=t===2,s=t===3,c=t===4,u=t===6,h=t===7,f=t===5||u;return function(g,v,_,x){for(var S,C,U=Dpe(g),P=Ppe(U),j=kpe(P),W=Ope(v,_),K=0,J=x||jpe,re=r?J(g,j):i||h?J(g,0):void 0;j>K;K++)if((f||K in P)&&(C=W(S=P[K],K,U),t))if(r)re[K]=C;else if(C)switch(t){case 3:return!0;case 5:return S;case 6:return K;case 2:U3(re,S)}else switch(t){case 4:return!1;case 7:U3(re,S)}return u?-1:s||c?c:re}},F3={forEach:Lpe(0)},z0=Qt,Og=A,oR=be,Mpe=w,wp=fe,Tp=cc,Upe=p,Si=ri,Fpe=N,cR=ga,K0=At,lR=GT,Vpe=va,dR=Re,Cp=ug,V3=J_,Bpe=q_,B3=D3,Gpe=dg,G3=Se,W3=Is,Wpe=lC,$3=ae,H3=zl,$pe=d0,uR=Jh,z3=X_,K3=VT,Hpe=Zn,zpe=Sp,Kpe=Lr,Ype=M3,qpe=Jc,Y3=uu,Y0=F3.forEach,ja=Y_("hidden"),q0="Symbol",Pg="prototype",Xpe=Y3.set,q3=Y3.getterFor(q0),wo=Object[Pg],bu=Og.Symbol,X0=bu&&bu[Pg],Jpe=Og.RangeError,Qpe=Og.TypeError,hR=Og.QObject,X3=G3.f,Eu=W3.f,J3=B3.f,Zpe=$3.f,Q3=Mpe([].push),el=uR("symbols"),Dg=uR("op-symbols"),efe=uR("wks"),pR=!hR||!hR[Pg]||!hR[Pg].findChild,Z3=function(t,r,i){var s=X3(wo,r);s&&delete wo[r],Eu(t,r,i),s&&t!==wo&&Eu(wo,r,s)},fR=wp&&Upe(function(){return Cp(Eu({},"a",{get:function(){return Eu(this,"a",{value:7}).a}})).a!==7})?Z3:Eu,mR=function(t,r){var i=el[t]=Cp(X0);return Xpe(i,{type:q0,tag:t,description:r}),wp||(i.description=r),i},J0=function(t,r,i){t===wo&&J0(Dg,r,i),cR(t);var s=lR(r);return cR(i),Si(el,s)?(i.enumerable?(Si(t,ja)&&t[ja][s]&&(t[ja][s]=!1),i=Cp(i,{enumerable:dR(0,!1)})):(Si(t,ja)||Eu(t,ja,dR(1,Cp(null))),t[ja][s]=!0),fR(t,s,i)):Eu(t,s,i)},gR=function(t,r){cR(t);var i=K0(r),s=V3(i).concat(r4(i));return Y0(s,function(c){wp&&!oR(e4,i,c)||J0(t,c,i[c])}),t},e4=function(t){var r=lR(t),i=oR(Zpe,this,r);return!(this===wo&&Si(el,r)&&!Si(Dg,r))&&(!(i||!Si(this,r)||!Si(el,r)||Si(this,ja)&&this[ja][r])||i)},t4=function(t,r){var i=K0(t),s=lR(r);if(i!==wo||!Si(el,s)||Si(Dg,s)){var c=X3(i,s);return!c||!Si(el,s)||Si(i,ja)&&i[ja][s]||(c.enumerable=!0),c}},n4=function(t){var r=J3(K0(t)),i=[];return Y0(r,function(s){Si(el,s)||Si(z3,s)||Q3(i,s)}),i},r4=function(t){var r=t===wo,i=J3(r?Dg:K0(t)),s=[];return Y0(i,function(c){!Si(el,c)||r&&!Si(wo,c)||Q3(s,el[c])}),s};Tp||(bu=function(){if(Fpe(X0,this))throw new Qpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?Vpe(arguments[0]):void 0,r=K3(t),i=function(s){var c=this===void 0?Og:this;c===wo&&oR(i,Dg,s),Si(c,ja)&&Si(c[ja],r)&&(c[ja][r]=!1);var u=dR(1,s);try{fR(c,r,u)}catch(h){if(!(h instanceof Jpe))throw h;Z3(c,r,u)}};return wp&&pR&&fR(wo,r,{configurable:!0,set:i}),mR(r,t)},H3(X0=bu[Pg],"toString",function(){return q3(this).tag}),H3(bu,"withoutSetter",function(t){return mR(K3(t),t)}),$3.f=e4,W3.f=J0,Wpe.f=gR,G3.f=t4,Bpe.f=B3.f=n4,Gpe.f=r4,zpe.f=function(t){return mR(Hpe(t),t)},wp&&$pe(X0,"description",{configurable:!0,get:function(){return q3(this).description}})),z0({global:!0,wrap:!0,forced:!Tp,sham:!Tp},{Symbol:bu}),Y0(V3(efe),function(t){Kpe(t)}),z0({target:q0,stat:!0,forced:!Tp},{useSetter:function(){pR=!0},useSimple:function(){pR=!1}}),z0({target:"Object",stat:!0,forced:!Tp,sham:!wp},{create:function(t,r){return r===void 0?Cp(t):gR(Cp(t),r)},defineProperty:J0,defineProperties:gR,getOwnPropertyDescriptor:t4}),z0({target:"Object",stat:!0,forced:!Tp},{getOwnPropertyNames:n4}),Ype(),qpe(bu,q0),z3[ja]=!0;var i4=cc&&!!Symbol.for&&!!Symbol.keyFor,tfe=Qt,nfe=tt,rfe=ri,ife=va,a4=Jh,afe=i4,vR=a4("string-to-symbol-registry"),sfe=a4("symbol-to-string-registry");tfe({target:"Symbol",stat:!0,forced:!afe},{for:function(t){var r=ife(t);if(rfe(vR,r))return vR[r];var i=nfe("Symbol")(r);return vR[r]=i,sfe[i]=r,i}});var ofe=Qt,cfe=ri,lfe=ig,dfe=Xh,ufe=i4,s4=Jh("symbol-to-string-registry");ofe({target:"Symbol",stat:!0,forced:!ufe},{keyFor:function(t){if(!lfe(t))throw new TypeError(dfe(t)+" is not a symbol");if(cfe(s4,t))return s4[t]}});var o4=lg,hfe=ue,c4=q,pfe=va,l4=w([].push),ffe=Qt,d4=tt,u4=V,mfe=be,kg=w,h4=p,p4=ue,f4=ig,m4=Kl,gfe=function(t){if(hfe(t))return t;if(o4(t)){for(var r=t.length,i=[],s=0;s<r;s++){var c=t[s];typeof c=="string"?l4(i,c):typeof c!="number"&&c4(c)!=="Number"&&c4(c)!=="String"||l4(i,pfe(c))}var u=i.length,h=!0;return function(f,g){if(h)return h=!1,g;if(o4(this))return g;for(var v=0;v<u;v++)if(i[v]===f)return g}}},vfe=cc,yfe=String,Zl=d4("JSON","stringify"),Q0=kg(/./.exec),g4=kg("".charAt),_fe=kg("".charCodeAt),bfe=kg("".replace),Efe=kg(1.1.toString),xfe=/[\uD800-\uDFFF]/g,v4=/^[\uD800-\uDBFF]$/,y4=/^[\uDC00-\uDFFF]$/,_4=!vfe||h4(function(){var t=d4("Symbol")("stringify detection");return Zl([t])!=="[null]"||Zl({a:t})!=="{}"||Zl(Object(t))!=="{}"}),b4=h4(function(){return Zl("\uDF06\uD834")!=='"\\udf06\\ud834"'||Zl("\uDEAD")!=='"\\udead"'}),Sfe=function(t,r){var i=m4(arguments),s=gfe(r);if(p4(s)||t!==void 0&&!f4(t))return i[1]=function(c,u){if(p4(s)&&(u=mfe(s,this,yfe(c),u)),!f4(u))return u},u4(Zl,null,i)},wfe=function(t,r,i){var s=g4(i,r-1),c=g4(i,r+1);return Q0(v4,t)&&!Q0(y4,c)||Q0(y4,t)&&!Q0(v4,s)?"\\u"+Efe(_fe(t,0),16):t};Zl&&ffe({target:"JSON",stat:!0,forced:_4||b4},{stringify:function(t,r,i){var s=m4(arguments),c=u4(_4?Sfe:Zl,null,s);return b4&&typeof c=="string"?bfe(c,xfe,wfe):c}});var E4=dg,Tfe=lc;Qt({target:"Object",stat:!0,forced:!cc||p(function(){E4.f(1)})},{getOwnPropertySymbols:function(t){var r=E4.f;return r?r(Tfe(t)):[]}}),Lr("asyncDispose"),Lr("asyncIterator"),Lr("dispose"),Lr("hasInstance"),Lr("isConcatSpreadable"),Lr("iterator"),Lr("match"),Lr("matchAll"),Lr("replace"),Lr("search"),Lr("species"),Lr("split");var Cfe=M3;Lr("toPrimitive"),Cfe();var Nfe=tt,Rfe=Jc;Lr("toStringTag"),Rfe(Nfe("Symbol"),"Symbol"),Lr("unscopables"),Jc(A.JSON,"JSON",!0);var Afe=Wt.Symbol,Ife=Zn,Ofe=Is.f,x4=Ife("metadata"),S4=Function.prototype;S4[x4]===void 0&&Ofe(S4,x4,{value:null}),Lr("metadata");var Pfe=Afe,Dfe=w,yR=tt("Symbol"),kfe=yR.keyFor,jfe=Dfe(yR.prototype.valueOf),w4=yR.isRegisteredSymbol||function(t){try{return kfe(jfe(t))!==void 0}catch{return!1}};Qt({target:"Symbol",stat:!0},{isRegisteredSymbol:w4});for(var Lfe=Jh,T4=tt,Mfe=w,Ufe=ig,Ffe=Zn,Z0=T4("Symbol"),C4=Z0.isWellKnownSymbol,N4=T4("Object","getOwnPropertyNames"),Vfe=Mfe(Z0.prototype.valueOf),R4=Lfe("wks"),_R=0,A4=N4(Z0),Bfe=A4.length;_R<Bfe;_R++)try{var I4=A4[_R];Ufe(Z0[I4])&&Ffe(I4)}catch{}var O4=function(t){if(C4&&C4(t))return!0;try{for(var r=Vfe(t),i=0,s=N4(R4),c=s.length;i<c;i++)if(R4[s[i]]==r)return!0}catch{}return!1};Qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:O4}),Lr("customMatcher"),Lr("observable"),Qt({target:"Symbol",stat:!0},{isRegistered:w4}),Qt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:O4}),Lr("matcher"),Lr("metadataKey"),Lr("patternMatch"),Lr("replaceAll");var Np=d(Pfe),P4=d(Sp.f("iterator"));function jg(t){return jg=typeof Np=="function"&&typeof P4=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Np=="function"&&r.constructor===Np&&r!==Np.prototype?"symbol":typeof r},jg(t)}var Gfe=d(Sp.f("toPrimitive"));function Wfe(t){var r=function(i,s){if(jg(i)!="object"||!i)return i;var c=i[Gfe];if(c!==void 0){var u=c.call(i,s);if(jg(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(i)}(t,"string");return jg(r)=="symbol"?r:r+""}function L(t,r,i){return(r=Wfe(r))in t?T3(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}var D4=d(mde),$fe={isBrowser:!0,classes:{URLSearchParams:D4!==void 0?D4:sR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const bR=typeof window<"u"&&typeof document<"u",ER=typeof navigator=="object"&&navigator||void 0,Hfe=bR&&(!ER||["ReactNative","NativeScript","NS"].indexOf(ER.product)<0),zfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Kfe=bR&&window.location.href||"http://localhost";function k4(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function j4(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?k4(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k4(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}var Qi=j4(j4({},Object.freeze({__proto__:null,hasBrowserEnv:bR,hasStandardBrowserEnv:Hfe,hasStandardBrowserWebWorkerEnv:zfe,navigator:ER,origin:Kfe})),$fe);function L4(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Yfe(t,r){return H0(t,new Qi.classes.URLSearchParams,function(i){for(var s=1;s<arguments.length;s++){var c=arguments[s]!=null?arguments[s]:{};s%2?L4(Object(c),!0).forEach(function(u){L(i,u,c[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(c)):L4(Object(c)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(c,u))})}return i}({visitor:function(i,s,c,u){return Qi.isNode&&je.isBuffer(i)?(this.append(s,i.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},r))}var qfe=tN.charAt,M4=be,Xfe=ga,Jfe=ue,Qfe=q,Zfe=/./.exec,eme=TypeError,tme=Qt,U4=be,F4=oe,nme=xC,eb=c0,V4=wt,B4=Mj,Lg=va,rme=ga,ime=Qe,ame=q,sme=QT,G4=zN,ome=ag,cme=p,lme=RC,dme=function(t,r,i){return r+(i?qfe(t,r).length:1)},ume=function(t,r){var i=t.exec;if(Jfe(i)){var s=M4(i,t,r);return s!==null&&Xfe(s),s}if(Qfe(t)==="RegExp")return M4(Zfe,t,r);throw new eme("RegExp#exec called on incompatible receiver")},W4=uu,hme=Zn("matchAll"),$4="RegExp String",H4=$4+" Iterator",pme=W4.set,fme=W4.getterFor(H4),mme=TypeError,xR=F4("".indexOf),tb=F4("".matchAll),SR=!!tb&&!cme(function(){tb("a",/./)}),gme=nme(function(t,r,i,s){pme(this,{type:H4,regexp:t,string:r,global:i,unicode:s,done:!1})},$4,function(){var t=fme(this);if(t.done)return eb(void 0,!0);var r=t.regexp,i=t.string,s=ume(r,i);return s===null?(t.done=!0,eb(void 0,!0)):t.global?(Lg(s[0])===""&&(r.lastIndex=dme(i,B4(r.lastIndex),t.unicode)),eb(s,!1)):(t.done=!0,eb(s,!1))}),z4=function(t){var r,i,s,c=rme(this),u=Lg(t),h=lme(c,RegExp),f=Lg(G4(c));return r=new h(h===RegExp?c.source:c,f),i=!!~xR(f,"g"),s=!!~xR(f,"u"),r.lastIndex=B4(c.lastIndex),new gme(r,u,i,s)};tme({target:"String",proto:!0,forced:SR},{matchAll:function(t){var r,i,s,c,u=V4(this);if(ime(t)){if(sme(t)&&(r=Lg(V4(G4(t))),!~xR(r,"g")))throw new mme("`.matchAll` does not allow non-global regexes");if(SR)return tb(u,t);if((s=ome(t,hme))===void 0&&ame(t)==="RegExp"&&(s=z4),s)return U4(s,t,u)}else if(SR)return tb(u,t);return i=Lg(u),c=new RegExp(t,"g"),U4(z4,c,i)}});var vme=is("String","matchAll"),yme=N,_me=vme,wR=String.prototype,bme=function(t){var r=t.matchAll;return typeof t=="string"||t===wR||yme(wR,t)&&r===wR.matchAll?_me:r},Eme=d(bme);function K4(t){function r(i,s,c,u){let h=i[u++];if(h==="__proto__")return!0;const f=Number.isFinite(+h),g=u>=i.length;return h=!h&&je.isArray(c)?c.length:h,g?(je.hasOwnProp(c,h)?c[h]=[c[h],s]:c[h]=s,!f):(c[h]&&je.isObject(c[h])||(c[h]=[]),r(i,s,c[h],u)&&je.isArray(c[h])&&(c[h]=function(v){const _={},x=Object.keys(v);let S;const C=x.length;let U;for(S=0;S<C;S++)U=x[S],_[U]=v[U];return _}(c[h])),!f)}if(je.isFormData(t)&&je.isFunction(t.entries)){const i={};return je.forEachEntry(t,(s,c)=>{r(function(u){return Eme(je).call(je,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(s),c,i,0)}),i}return null}const TR={transitional:E3,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const i=r.getContentType()||"",s=i.indexOf("application/json")>-1,c=je.isObject(t);if(c&&je.isHTMLForm(t)&&(t=new FormData(t)),je.isFormData(t))return s?JSON.stringify(K4(t)):t;if(je.isArrayBuffer(t)||je.isBuffer(t)||je.isStream(t)||je.isFile(t)||je.isBlob(t)||je.isReadableStream(t))return t;if(je.isArrayBufferView(t))return t.buffer;if(je.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return Yfe(t,this.formSerializer).toString();if((u=je.isFileList(t))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return H0(u?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||s?(r.setContentType("application/json",!1),function(h,f,g){if(je.isString(h))try{return(f||JSON.parse)(h),xi(je).call(je,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(g||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||TR.transitional,i=r&&r.forcedJSONParsing,s=this.responseType==="json";if(je.isResponse(t)||je.isReadableStream(t))return t;if(t&&je.isString(t)&&(i&&!this.responseType||s)){const c=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(t,this.parseReviver)}catch(u){if(c)throw u.name==="SyntaxError"?on.from(u,on.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qi.classes.FormData,Blob:Qi.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};je.forEach(["delete","get","head","post","put","patch"],t=>{TR.headers[t]={}});var CR=TR;const xme=je.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Y4=Symbol("internals");function Mg(t){var r;return t&&xi(r=String(t)).call(r).toLowerCase()}function nb(t){return t===!1||t==null?t:je.isArray(t)?t.map(nb):String(t)}function NR(t,r,i,s,c){return je.isFunction(s)?s.call(this,r,i):(c&&(r=i),je.isString(r)?je.isString(s)?r.indexOf(s)!==-1:je.isRegExp(s)?s.test(r):void 0:void 0)}class rb{constructor(r){r&&this.set(r)}set(r,i,s){const c=this;function u(g,v,_){const x=Mg(v);if(!x)throw new Error("header name must be a non-empty string");const S=je.findKey(c,x);(!S||c[S]===void 0||_===!0||_===void 0&&c[S]!==!1)&&(c[S||v]=nb(g))}const h=(g,v)=>je.forEach(g,(_,x)=>u(_,x,v));if(je.isPlainObject(r)||r instanceof this.constructor)h(r,i);else if(je.isString(r)&&(r=xi(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(xi(f=r).call(f)))h((g=>{const v={};let _,x,S;return g&&g.split(`
`).forEach(function(C){var U,P;S=C.indexOf(":"),_=xi(U=C.substring(0,S)).call(U).toLowerCase(),x=xi(P=C.substring(S+1)).call(P),!_||v[_]&&xme[_]||(_==="set-cookie"?v[_]?v[_].push(x):v[_]=[x]:v[_]=v[_]?v[_]+", "+x:x)}),v})(r),i);else if(je.isObject(r)&&je.isIterable(r)){let g,v,_={};for(const x of r){if(!je.isArray(x))throw TypeError("Object iterator must return a key-value pair");_[v=x[0]]=(g=_[v])?je.isArray(g)?[...g,x[1]]:[g,x[1]]:x[1]}h(_,i)}else r!=null&&u(i,r,s);var f;return this}get(r,i){if(r=Mg(r)){const s=je.findKey(this,r);if(s){const c=this[s];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=f.exec(u);)h[g[1]]=g[2];return h}(c);if(je.isFunction(i))return i.call(this,c,s);if(je.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=Mg(r)){const s=je.findKey(this,r);return!(!s||this[s]===void 0||i&&!NR(0,this[s],s,i))}return!1}delete(r,i){const s=this;let c=!1;function u(h){if(h=Mg(h)){const f=je.findKey(s,h);!f||i&&!NR(0,s[f],f,i)||(delete s[f],c=!0)}}return je.isArray(r)?r.forEach(u):u(r),c}clear(r){const i=Object.keys(this);let s=i.length,c=!1;for(;s--;){const u=i[s];r&&!NR(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const i=this,s={};return je.forEach(this,(c,u)=>{var h;const f=je.findKey(s,u);if(f)return i[f]=nb(c),void delete i[u];const g=r?function(v){return xi(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,x,S)=>x.toUpperCase()+S)}(u):xi(h=String(u)).call(h);g!==u&&delete i[u],i[g]=nb(c),s[g]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return je.forEach(this,(s,c)=>{s!=null&&s!==!1&&(i[c]=r&&je.isArray(s)?s.join(", "):s)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,s]=r;return i+": "+s}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(r){const i=(this[Y4]=this[Y4]={accessors:{}}).accessors,s=this.prototype;function c(u){const h=Mg(u);i[h]||(function(f,g){const v=je.toCamelCase(" "+g);["get","set","has"].forEach(_=>{Object.defineProperty(f,_+v,{value:function(x,S,C){return this[_].call(this,g,x,S,C)},configurable:!0})})}(s,u),i[h]=!0)}return je.isArray(r)?r.forEach(c):c(r),this}}rb.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),je.reduceDescriptors(rb.prototype,(t,r)=>{let{value:i}=t,s=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[s]=c}}}),je.freezeMethods(rb);var To=rb;function RR(t,r){const i=this||CR,s=r||i,c=To.from(s.headers);let u=s.data;return je.forEach(t,function(h){u=h.call(i,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function q4(t){return!(!t||!t.__CANCEL__)}function Rp(t,r,i){on.call(this,t??"canceled",on.ERR_CANCELED,r,i),this.name="CanceledError"}function X4(t,r,i){const s=i.config.validateStatus;i.status&&s&&!s(i.status)?r(new on("Request failed with status code "+i.status,[on.ERR_BAD_REQUEST,on.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}je.inherits(Rp,on,{__CANCEL__:!0});const ib=function(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0;const c=function(u,h){u=u||10;const f=new Array(u),g=new Array(u);let v,_=0,x=0;return h=h!==void 0?h:1e3,function(S){const C=Date.now(),U=g[x];v||(v=C),f[_]=S,g[_]=C;let P=x,j=0;for(;P!==_;)j+=f[P++],P%=u;if(_=(_+1)%u,_===x&&(x=(x+1)%u),C-v<h)return;const W=U&&C-U;return W?Math.round(1e3*j/W):void 0}}(50,250);return function(u,h){let f,g,v=0,_=1e3/h;const x=function(S){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),f=null,g&&(clearTimeout(g),g=null),u(...S)};return[function(){const S=Date.now(),C=S-v;for(var U=arguments.length,P=new Array(U),j=0;j<U;j++)P[j]=arguments[j];C>=_?x(P,S):(f=P,g||(g=setTimeout(()=>{g=null,x(f)},_-C)))},()=>f&&x(f)]}(u=>{const h=u.loaded,f=u.lengthComputable?u.total:void 0,g=h-s,v=c(g);s=h,t({loaded:h,total:f,progress:f?h/f:void 0,bytes:g,rate:v||void 0,estimated:v&&f&&h<=f?(f-h)/v:void 0,event:u,lengthComputable:f!=null,[r?"download":"upload"]:!0})},i)},J4=(t,r)=>{const i=t!=null;return[s=>r[0]({lengthComputable:i,total:t,loaded:s}),r[1]]},Q4=t=>function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return je.asap(()=>t(...i))};var Sme=Qi.hasStandardBrowserEnv?((t,r)=>i=>(i=new D0(i,Qi.origin),t.protocol===i.protocol&&t.host===i.host&&(r||t.port===i.port)))(new D0(Qi.origin),Qi.navigator&&/(msie|trident)/i.test(Qi.navigator.userAgent)):()=>!0,wme=Qi.hasStandardBrowserEnv?{write(t,r,i,s,c,u,h){if(typeof document>"u")return;const f=["".concat(t,"=").concat(encodeURIComponent(r))];je.isNumber(i)&&f.push("expires=".concat(new Date(i).toUTCString())),je.isString(s)&&f.push("path=".concat(s)),je.isString(c)&&f.push("domain=".concat(c)),u===!0&&f.push("secure"),je.isString(h)&&f.push("SameSite=".concat(h)),document.cookie=f.join("; ")},read(t){if(typeof document>"u")return null;const r=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return r?decodeURIComponent(r[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function Z4(t,r,i){let s=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(r);return t&&(s||i==0)?function(c,u){return u?c.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):c}(t,r):r}function eF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function AR(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?eF(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):eF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const tF=t=>t instanceof To?AR({},t):t;function xu(t,r){r=r||{};const i={};function s(v,_,x,S){return je.isPlainObject(v)&&je.isPlainObject(_)?je.merge.call({caseless:S},v,_):je.isPlainObject(_)?je.merge({},_):je.isArray(_)?_.slice():_}function c(v,_,x,S){return je.isUndefined(_)?je.isUndefined(v)?void 0:s(void 0,v,0,S):s(v,_,0,S)}function u(v,_){if(!je.isUndefined(_))return s(void 0,_)}function h(v,_){return je.isUndefined(_)?je.isUndefined(v)?void 0:s(void 0,v):s(void 0,_)}function f(v,_,x){return x in r?s(v,_):x in t?s(void 0,v):void 0}const g={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f,headers:(v,_,x)=>c(tF(v),tF(_),0,!0)};return je.forEach(Object.keys(AR(AR({},t),r)),function(v){const _=g[v]||c,x=_(t[v],r[v],v);je.isUndefined(x)&&_!==f||(i[v]=x)}),i}var nF=t=>{const r=xu({},t);let{data:i,withXSRFToken:s,xsrfHeaderName:c,xsrfCookieName:u,headers:h,auth:f}=r;if(r.headers=h=To.from(h),r.url=_3(Z4(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),f&&h.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):""))),je.isFormData(i)){if(Qi.hasStandardBrowserEnv||Qi.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if(je.isFunction(i.getHeaders)){const g=i.getHeaders(),v=["content-type","content-length"];Object.entries(g).forEach(_=>{let[x,S]=_;Te(v).call(v,x.toLowerCase())&&h.set(x,S)})}}if(Qi.hasStandardBrowserEnv&&(s&&je.isFunction(s)&&(s=s(r)),s||s!==!1&&Sme(r.url))){const g=c&&u&&wme.read(u);g&&h.set(c,g)}return r},Tme=typeof XMLHttpRequest<"u"&&function(t){return new De(function(r,i){const s=nF(t);let c=s.data;const u=To.from(s.headers).normalize();let h,f,g,v,_,{responseType:x,onUploadProgress:S,onDownloadProgress:C}=s;function U(){v&&v(),_&&_(),s.cancelToken&&s.cancelToken.unsubscribe(h),s.signal&&s.signal.removeEventListener("abort",h)}let P=new XMLHttpRequest;function j(){if(!P)return;const K=To.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders());X4(function(J){r(J),U()},function(J){i(J),U()},{data:x&&x!=="text"&&x!=="json"?P.response:P.responseText,status:P.status,statusText:P.statusText,headers:K,config:t,request:P}),P=null}P.open(s.method.toUpperCase(),s.url,!0),P.timeout=s.timeout,"onloadend"in P?P.onloadend=j:P.onreadystatechange=function(){P&&P.readyState===4&&(P.status!==0||P.responseURL&&P.responseURL.indexOf("file:")===0)&&setTimeout(j)},P.onabort=function(){P&&(i(new on("Request aborted",on.ECONNABORTED,t,P)),P=null)},P.onerror=function(K){const J=new on(K&&K.message?K.message:"Network Error",on.ERR_NETWORK,t,P);J.event=K||null,i(J),P=null},P.ontimeout=function(){let K=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const J=s.transitional||E3;s.timeoutErrorMessage&&(K=s.timeoutErrorMessage),i(new on(K,J.clarifyTimeoutError?on.ETIMEDOUT:on.ECONNABORTED,t,P)),P=null},c===void 0&&u.setContentType(null),"setRequestHeader"in P&&je.forEach(u.toJSON(),function(K,J){P.setRequestHeader(J,K)}),je.isUndefined(s.withCredentials)||(P.withCredentials=!!s.withCredentials),x&&x!=="json"&&(P.responseType=s.responseType),C&&([g,_]=ib(C,!0),P.addEventListener("progress",g)),S&&P.upload&&([f,v]=ib(S),P.upload.addEventListener("progress",f),P.upload.addEventListener("loadend",v)),(s.cancelToken||s.signal)&&(h=K=>{P&&(i(!K||K.type?new Rp(null,t,P):K),P.abort(),P=null)},s.cancelToken&&s.cancelToken.subscribe(h),s.signal&&(s.signal.aborted?h():s.signal.addEventListener("abort",h)));const W=function(K){const J=/^([-+\w]{1,25})(:?\/\/|:)/.exec(K);return J&&J[1]||""}(s.url);W&&Qi.protocols.indexOf(W)===-1?i(new on("Unsupported protocol "+W+":",on.ERR_BAD_REQUEST,t)):P.send(c||null)})},Cme=(t,r)=>{const{length:i}=t=t?t.filter(Boolean):[];if(r||i){let s,c=new AbortController;const u=function(v){if(!s){s=!0,f();const _=v instanceof Error?v:this.reason;c.abort(_ instanceof on?_:new Rp(_ instanceof Error?_.message:_))}};let h=r&&setTimeout(()=>{h=null,u(new on("timeout ".concat(r," of ms exceeded"),on.ETIMEDOUT))},r);const f=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),t=null)};t.forEach(v=>v.addEventListener("abort",u));const{signal:g}=c;return g.unsubscribe=()=>je.asap(f),g}},IR=d(VM),rF=Sp.f("asyncIterator"),Nme=d(rF);function OR(t,r){this.v=t,this.k=r}function Li(t){return function(){return new Ug(t.apply(this,arguments))}}function Ug(t){var r,i;function s(u,h){try{var f=t[u](h),g=f.value,v=g instanceof OR;IR.resolve(v?g.v:g).then(function(_){if(v){var x=u==="return"?"return":"next";if(!g.k||_.done)return s(x,_);_=t[x](_).value}c(f.done?"return":"normal",_)},function(_){s("throw",_)})}catch(_){c("throw",_)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?s(r.key,r.arg):i=null}this._invoke=function(u,h){return new IR(function(f,g){var v={key:u,arg:h,resolve:f,reject:g,next:null};i?i=i.next=v:(r=i=v,s(u,h))})},typeof t.return!="function"&&(this.return=void 0)}function Tt(t){return new OR(t,0)}function Ap(t){var r={},i=!1;function s(c,u){return i=!0,u=new IR(function(h){h(t[c](u))}),{done:!1,value:new OR(u,1)}}return r[Np!==void 0&&P4||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):s("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return s("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return i?(i=!1,c):s("return",c)}),r}Ug.prototype[typeof Np=="function"&&Nme||"@@asyncIterator"]=function(){return this},Ug.prototype.next=function(t){return this._invoke("next",t)},Ug.prototype.throw=function(t){return this._invoke("throw",t)},Ug.prototype.return=function(t){return this._invoke("return",t)};var ab=d(rF);function PR(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=ab,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new sb(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function sb(t){function r(i){if(Object(i)!==i)return De.reject(new TypeError(i+" is not an object."));var s=i.done;return De.resolve(i.value).then(function(c){return{value:c,done:s}})}return sb=function(i){this.s=i,this.n=i.next},sb.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?De.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?De.reject(i):r(s.apply(this.s,arguments))}},new sb(t)}const Rme=function*(t,r){let i=t.byteLength;if(!r||i<r)return void(yield t);let s,c=0;for(;c<i;)s=c+r,yield t.slice(c,s),c=s},Ame=function(){var t=Li(function*(r,i){var s,c=!1,u=!1;try{for(var h,f=PR(Ime(r));c=!(h=yield Tt(f.next())).done;c=!1){const g=h.value;yield*Ap(PR(Rme(g,i)))}}catch(g){u=!0,s=g}finally{try{c&&f.return!=null&&(yield Tt(f.return()))}finally{if(u)throw s}}});return function(r,i){return t.apply(this,arguments)}}(),Ime=function(){var t=Li(function*(r){if(r[ab])return void(yield*Ap(PR(r)));const i=r.getReader();try{for(;;){const{done:s,value:c}=yield Tt(i.read());if(s)break;yield c}}finally{yield Tt(i.cancel())}});return function(r){return t.apply(this,arguments)}}(),iF=(t,r,i,s)=>{const c=Ame(t,r);let u,h=0,f=g=>{u||(u=!0,s&&s(g))};return new ReadableStream({async pull(g){try{const{done:v,value:_}=await c.next();if(v)return f(),void g.close();let x=_.byteLength;if(i){let S=h+=x;i(S)}g.enqueue(new Uint8Array(_))}catch(v){throw f(v),v}},cancel:g=>(f(g),c.return())},{highWaterMark:2})};function aF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function sF(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?aF(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):aF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const{isFunction:ob}=je,Ome=(t=>{let{Request:r,Response:i}=t;return{Request:r,Response:i}})(je.global),{ReadableStream:oF,TextEncoder:cF}=je.global,lF=function(t){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return!!t(...i)}catch{return!1}},Pme=t=>{t=je.merge.call({skipUndefined:!0},Ome,t);const{fetch:r,Request:i,Response:s}=t,c=r?ob(r):typeof fetch=="function",u=ob(i),h=ob(s);if(!c)return!1;const f=c&&ob(oF),g=c&&(typeof cF=="function"?(v=new cF,U=>v.encode(U)):async U=>new Uint8Array(await new i(U).arrayBuffer()));var v;const _=u&&f&&lF(()=>{let U=!1;const P=new i(Qi.origin,{body:new oF,method:"POST",get duplex(){return U=!0,"half"}}).headers.has("Content-Type");return U&&!P}),x=h&&f&&lF(()=>je.isReadableStream(new s("").body)),S={stream:x&&(U=>U.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(U=>{!S[U]&&(S[U]=(P,j)=>{let W=P&&P[U];if(W)return W.call(P);throw new on("Response type '".concat(U,"' is not supported"),on.ERR_NOT_SUPPORT,j)})});const C=async(U,P)=>{const j=je.toFiniteNumber(U.getContentLength());return j??(async W=>W==null?0:je.isBlob(W)?W.size:je.isSpecCompliantForm(W)?(await new i(Qi.origin,{method:"POST",body:W}).arrayBuffer()).byteLength:je.isArrayBufferView(W)||je.isArrayBuffer(W)?W.byteLength:(je.isURLSearchParams(W)&&(W+=""),je.isString(W)?(await g(W)).byteLength:void 0))(P)};return async U=>{let{url:P,method:j,data:W,signal:K,cancelToken:J,timeout:re,onDownloadProgress:ie,onUploadProgress:Z,responseType:se,headers:ge,withCredentials:Ee="same-origin",fetchOptions:Fe}=nF(U),ht=r||fetch;se=se?(se+"").toLowerCase():"text";let ot=Cme([K,J&&J.toAbortSignal()],re),St=null;const yt=ot&&ot.unsubscribe&&(()=>{ot.unsubscribe()});let Yt;try{if(Z&&_&&j!=="get"&&j!=="head"&&(Yt=await C(ge,W))!==0){let I,X=new i(P,{method:"POST",body:W,duplex:"half"});if(je.isFormData(W)&&(I=X.headers.get("content-type"))&&ge.setContentType(I),X.body){const[te,Ne]=J4(Yt,ib(Q4(Z)));W=iF(X.body,65536,te,Ne)}}je.isString(Ee)||(Ee=Ee?"include":"omit");const Cn=u&&"credentials"in i.prototype,ve=sF(sF({},Fe),{},{signal:ot,method:j.toUpperCase(),headers:ge.normalize().toJSON(),body:W,duplex:"half",credentials:Cn?Ee:void 0});St=u&&new i(P,ve);let Oe=await(u?ht(St,Fe):ht(P,ve));const We=x&&(se==="stream"||se==="response");if(x&&(ie||We&&yt)){const I={};["status","statusText","headers"].forEach(mt=>{I[mt]=Oe[mt]});const X=je.toFiniteNumber(Oe.headers.get("content-length")),[te,Ne]=ie&&J4(X,ib(Q4(ie),!0))||[];Oe=new s(iF(Oe.body,65536,te,()=>{Ne&&Ne(),yt&&yt()}),I)}se=se||"text";let _e=await S[je.findKey(S,se)||"text"](Oe,U);return!We&&yt&&yt(),await new De((I,X)=>{X4(I,X,{data:_e,headers:To.from(Oe.headers),status:Oe.status,statusText:Oe.statusText,config:U,request:St})})}catch(Cn){throw yt&&yt(),Cn&&Cn.name==="TypeError"&&/Load failed|fetch/i.test(Cn.message)?Object.assign(new on("Network Error",on.ERR_NETWORK,U,St),{cause:Cn.cause||Cn}):on.from(Cn,Cn&&Cn.code,U,St)}}},Dme=new Map,dF=t=>{let r=t&&t.env||{};const{fetch:i,Request:s,Response:c}=r,u=[s,c,i];let h,f,g=u.length,v=Dme;for(;g--;)h=u[g],f=v.get(h),f===void 0&&v.set(h,f=g?new Map:Pme(r)),v=f;return f};dF();const DR={http:null,xhr:Tme,fetch:{get:dF}};je.forEach(DR,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const uF=t=>"- ".concat(t),kme=t=>je.isFunction(t)||t===null||t===!1;var hF={getAdapter:function(t,r){t=je.isArray(t)?t:[t];const{length:i}=t;let s,c;const u={};for(let h=0;h<i;h++){let f;if(s=t[h],c=s,!kme(s)&&(c=DR[(f=String(s)).toLowerCase()],c===void 0))throw new on("Unknown adapter '".concat(f,"'"));if(c&&(je.isFunction(c)||(c=c.get(r))))break;u[f||"#"+h]=c}if(!c){const h=Object.entries(u).map(f=>{let[g,v]=f;return"adapter ".concat(g," ")+(v===!1?"is not supported by the environment":"is not available in the build")});throw new on("There is no suitable adapter to dispatch the request "+(i?h.length>1?`since :
`+h.map(uF).join(`
`):" "+uF(h[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return c},adapters:DR};function kR(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Rp(null,t)}function pF(t){return kR(t),t.headers=To.from(t.headers),t.data=RR.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),hF.getAdapter(t.adapter||CR.adapter,t)(t).then(function(r){return kR(t),r.data=RR.call(t,t.transformResponse,r),r.headers=To.from(r.headers),r},function(r){return q4(r)||(kR(t),r&&r.response&&(r.response.data=RR.call(t,t.transformResponse,r.response),r.response.headers=To.from(r.response.headers))),De.reject(r)})}const fF="1.13.2",cb={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{cb[t]=function(i){return typeof i===t||"a"+(r<1?"n ":" ")+t}});const mF={};cb.transitional=function(t,r,i){function s(c,u){return"[Axios v"+fF+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(t===!1)throw new on(s(u," has been removed"+(r?" in "+r:"")),on.ERR_DEPRECATED);return r&&!mF[u]&&(mF[u]=!0,console.warn(s(u," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,u,h)}},cb.spelling=function(t){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(t)),!0)};var lb={assertOptions:function(t,r,i){if(typeof t!="object")throw new on("options must be an object",on.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let c=s.length;for(;c-- >0;){const u=s[c],h=r[u];if(h){const f=t[u],g=f===void 0||h(f,u,t);if(g!==!0)throw new on("option "+u+" must be "+g,on.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new on("Unknown option "+u,on.ERR_BAD_OPTION)}},validators:cb};const pc=lb.validators;let db=class{constructor(t){this.defaults=t||{},this.interceptors={request:new b3,response:new b3}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const c=s.stack?s.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=xu(this.defaults,r);const{transitional:i,paramsSerializer:s,headers:c}=r;i!==void 0&&lb.assertOptions(i,{silentJSONParsing:pc.transitional(pc.boolean),forcedJSONParsing:pc.transitional(pc.boolean),clarifyTimeoutError:pc.transitional(pc.boolean)},!1),s!=null&&(je.isFunction(s)?r.paramsSerializer={serialize:s}:lb.assertOptions(s,{encode:pc.function,serialize:pc.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),lb.assertOptions(r,{baseUrl:pc.spelling("baseURL"),withXsrfToken:pc.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&je.merge(c.common,c[r.method]);c&&je.forEach(["delete","get","head","post","put","patch","common"],C=>{delete c[C]}),r.headers=To.concat(u,c);const h=[];let f=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(r)===!1||(f=f&&C.synchronous,h.unshift(C.fulfilled,C.rejected))});const g=[];let v;this.interceptors.response.forEach(function(C){g.push(C.fulfilled,C.rejected)});let _,x=0;if(!f){const C=[pF.bind(this),void 0];for(C.unshift(...h),C.push(...g),_=C.length,v=De.resolve(r);x<_;)v=v.then(C[x++],C[x++]);return v}_=h.length;let S=r;for(;x<_;){const C=h[x++],U=h[x++];try{S=C(S)}catch(P){U.call(this,P);break}}try{v=pF.call(this,S)}catch(C){return De.reject(C)}for(x=0,_=g.length;x<_;)v=v.then(g[x++],g[x++]);return v}getUri(t){return _3(Z4((t=xu(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};je.forEach(["delete","get","head","options"],function(t){db.prototype[t]=function(r,i){return this.request(xu(i||{},{method:t,url:r,data:(i||{}).data}))}}),je.forEach(["post","put","patch"],function(t){function r(i){return function(s,c,u){return this.request(xu(u||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}db.prototype[t]=r(),db.prototype[t+"Form"]=r(!0)});var ub=db;class jR{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new De(function(c){i=c});const s=this;this.promise.then(c=>{if(!s._listeners)return;let u=s._listeners.length;for(;u-- >0;)s._listeners[u](c);s._listeners=null}),this.promise.then=c=>{let u;const h=new De(f=>{s.subscribe(f),u=f}).then(c);return h.cancel=function(){s.unsubscribe(u)},h},r(function(c,u,h){s.reason||(s.reason=new Rp(c,u,h),i(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=s=>{r.abort(s)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new jR(function(s){r=s}),cancel:r}}}var jme=jR;const LR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(LR).forEach(t=>{let[r,i]=t;LR[i]=r});var Lme=LR;const ii=function t(r){const i=new ub(r),s=n3(ub.prototype.request,i);return je.extend(s,ub.prototype,i,{allOwnKeys:!0}),je.extend(s,i,null,{allOwnKeys:!0}),s.create=function(c){return t(xu(r,c))},s}(CR);ii.Axios=ub,ii.CanceledError=Rp,ii.CancelToken=jme,ii.isCancel=q4,ii.VERSION=fF,ii.toFormData=H0,ii.AxiosError=on,ii.Cancel=ii.CanceledError,ii.all=function(t){return De.all(t)},ii.spread=function(t){return function(r){return t.apply(null,r)}},ii.isAxiosError=function(t){return je.isObject(t)&&t.isAxiosError===!0},ii.mergeConfig=xu,ii.AxiosHeaders=To,ii.formToJSON=t=>K4(je.isHTMLForm(t)?new FormData(t):t),ii.getAdapter=hF.getAdapter,ii.HttpStatusCode=Lme,ii.default=ii;var Mi=ii;const Mme=()=>{};function Fg(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Mme};return t.promise=new De((r,i)=>{t.resolve=s=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(s),t.value=s)},t.reject=s=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,i(s))}}),t}const hb=new Map,pb=new Map,fc=new Map;let vr=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Ht=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const gF=new yhe;let Co=gF.getResult(),MR=null;function Bt(t){if(!MR){Co=gF.getResult();const r=function(f){if(f.engine.name==="Blink"&&f.browser.name!=="WeChat")return Ht.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ht.CHROME;case"Safari":case"Mobile Safari":return Ht.SAFARI;case"Edge":return Ht.EDGE;case"Firefox":return Ht.FIREFOX;case"QQ":case"QQBrowser":return Ht.QQ;case"Opera":return Ht.OPERA;case"WeChat":return Ht.WECHAT;default:return f.browser.name||""}}(Co),i=vF(Co),s=function(f){return f.os.name==="Windows"?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||""}(Co),c=Co.os.version,u=vF(Co,!1),h=Co.device.type;if(!(r&&i&&s&&c))return{name:r,version:i,os:s,osVersion:c,browserVersion:u,deviceType:h};MR={name:r,version:i,os:s,osVersion:c,browserVersion:u,deviceType:h}}return MR}function vF(t){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",i?r.split(".")[0]:r}function fb(){return Bt().os}function yF(){const t=Bt();return"".concat(t.os," ").concat(t.osVersion)}function mb(){const t=Bt();return!!(Co.engine.name==="WebKit"&&t.os===vr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Ht.SAFARI||ai()&&t.name!==Ht.SAFARI)}function tl(){return Bt().name===Ht.CHROME}function Nr(){return Bt().name===Ht.SAFARI}function _F(){const t=Bt();if(t.name!==Ht.SAFARI||!t.browserVersion)return!1;const r=t.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function bF(){return Bt().name===Ht.EDGE}function bn(){return Bt().name===Ht.FIREFOX}function ai(){return Bt().os===vr.IOS}function No(t){const r=Bt();return!(r.name!==Ht.CHROME||!r.osVersion)&&Number(r.version)>=t}function EF(t){const r=Bt();return!(r.name!==Ht.CHROME||!r.osVersion)&&Number(r.version)<t}function UR(t,r,i){const s=Bt();return!(s.name!==t||!s.osVersion)&&(i?Number(s.version)>=r&&Number(s.version)<=i:Number(s.version)===r)}function ed(t){const r=Bt();return!(r.name!==Ht.EDGE||!r.osVersion)&&Number(r.version)>=t}function FR(t){const r=Bt();return!(r.name!==Ht.FIREFOX||!r.osVersion)&&Number(r.version)>=t}function xF(t){const r=Bt();return!(r.name!==Ht.SAFARI||!r.osVersion)&&Number(r.version)>=t}function SF(t,r,i){const s=Bt();if(s.os!==vr.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])>r||Number(c[0])>t:r?Number(c[0])===t&&Number(c[1])>=r||Number(c[0])>t:Number(c[0])>=t}function wF(t,r,i){const s=Bt();if(s.os!==vr.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function VR(t,r,i){const s=Bt();if(s.name!==Ht.SAFARI||!s.osVersion||!s.browserVersion)return!1;const c=s.browserVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function Su(t){const r=Bt();return!(r.name!==Ht.OPERA||!r.osVersion)&&Number(r.version)>=t}function TF(){const t=Bt();if(t.os!==vr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Ip(){const t=Bt();if(t.os!==vr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function BR(){const t=Bt();if(t.os!==vr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function CF(){const t=Bt();if(t.os!==vr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Ms(){return Nr()&&navigator.maxTouchPoints>0}function NF(){return Bt().name===Ht.WECHAT}function RF(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function AF(){const t=fb();return function(){const{deviceType:r}=Bt();return r==="mobile"||r==="tablet"}()||t===vr.ANDROID||t===vr.IOS||t===vr.HARMONY_OS}function mc(){const t=Bt();return t.name!==Ht.EDGE&&t.name!==Ht.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Vg(){return fb()===vr.ANDROID}function Bg(){const t=Bt();return Vg()&&(t.name===Ht.CHROME||t.name===Ht.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function gt(t,r,i){return(r=function(s){var c=function(u,h){if(typeof u!="object"||!u)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var g=f.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function IF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ie(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?IF(Object(i),!0).forEach(function(s){gt(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):IF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let $=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),pe=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),gt(this,"code",void 0),gt(this,"message",void 0),gt(this,"data",void 0),gt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Us(t,r){if(typeof t!="boolean")throw new pe($.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Kn(t,r,i){if(!Te(i).call(i,t))throw new pe($.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function cn(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<i||t>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new pe($.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(s,"]. integer only"))}function GR(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new pe($.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&cn(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&cn(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&cn(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&cn(t.ideal,"".concat(r,".ideal"),1,1/0)}else cn(t,r,1,1/0)}function Mr(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new pe($.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!OF(t,i,s,c))throw new pe($.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function nl(t,r){if(!Array.isArray(t))throw new pe($.INVALID_PARAMS,"".concat(r," should be an array"))}function kn(t){return t==null}function OF(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=i&&t.length>=r&&(!s||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(t))}function PF(t,r,i){if("getBigUint64"in DataView.prototype)return t.getBigUint64(r,i);const s=t.getUint32(r,i),c=t.getUint32(r+4,i),u=0,h=+!i;return BigInt(s*h+c*u)<<BigInt(32)|BigInt(s*u+c*h)}function DF(t,r,i,s){if("setBigUint64"in DataView.prototype)return t.setBigUint64(r,i,s);const c=Number(i>>BigInt(32)),u=Number(i&BigInt(4294967295));t.setUint32(r,c,s),t.setUint32(r+4,u,s)}var Gg=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Gg||{}),WR=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(WR||{});const kF=new class{constructor(){gt(this,"_clientSize",null),gt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),gt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),gt(this,"getStyle",t=>window.getComputedStyle(t,null)),gt(this,"checkCssVisibleProperty",t=>{var r;let i=!0;const s=this.getStyle(t),{display:c,visibility:u,opacity:h,filter:f}=s;return(c==="none"||Te(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(i=!1),!!i&&(f&&f.split(" ").filter(g=>{var v;const _=g.split("(")[0];return Te(v=["brightness","blur","opacity"]).call(v,_)}).map(g=>{const[v,_]=g.split(/\(|\)/);return[v,Number(_.match(/^[0-9\.]+/))]}).forEach(g=>{const[v,_]=g;switch(v){case"brightness":(_<.1||_>3)&&(i=!1);break;case"blur":_>3&&(i=!1);break;case"opacity":_<.1&&(i=!1)}}),i)}),gt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let i=!0,s=!0;const c=h=>r(h);let u=t;for(;u&&s;)c(u)||(i=!1,s=!1),u=u.parentElement,u||(s=!1);return i}),gt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),gt(this,"getSizeAboutClient",t=>{const{width:r,height:i,left:s,right:c,top:u,bottom:h}=t.getBoundingClientRect(),f=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:i,left:s,right:c,top:u,bottom:h,clientWidth:f,clientHeight:g,clientMin:Math.min(f,g)}}),gt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(t,r,i)}),gt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),gt(this,"checkCoverForAPoint",(t,r,i)=>{const s=this.elementFromPoint(t,r);return s!==null&&s!==i}),gt(this,"getPointPositionList",()=>{const{width:t,height:r,left:i,top:s}=this._clientSize,c=t/6,u=r/6,h=[],f=10**6;for(let g=0;g<5;g++)for(let v=0;v<5;v++){const _=(i*f+(g===0?.1:g===4?(c*g*f-1e5)/f:c*g)*f)/f,x=(s*f+(v===0?.1:v===4?(u*v*f-1e5)/f:u*v)*f)/f;h.push({x:_,y:x})}return[...h]}),gt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),gt(this,"checkSizeIsVisible",(t,r,i)=>(t>50||i/t<=10)&&(r>50||i/r<=10)),gt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:i,bottom:s,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let f,g,v,_;if(t<0)f=0;else{if(!(t<u))return!1;f=t}if(r<0)return!1;if(g=r<u?r:u,i<0)v=0;else{if(!(i<c))return!1;v=i}if(s<0)return!1;_=s<c?s:c;const x=g-f,S=_-v;return this.checkSizeIsVisible(x,S,h)}),gt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),gt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Gg.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(Gg.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Gg.SIZE)}}return this.returnHiddenResult(Gg.STYLE)}return this.returnHiddenResult(WR.UNMOUNTED)}return this.returnHiddenResult(WR.INVALID_HTML_ELEMENT)}),gt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function $R(t){return new TextEncoder().encode(t)}const jF=function(t,r){const i=new Uint8Array(t.byteLength+r.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(r),t.byteLength),i},HR=async t=>function(r,i){let s="";return new Uint8Array(r).forEach(c=>{s+=c.toString(i).padStart(2,"0")}),s}(await crypto.subtle.digest("SHA-256",$R(t)),16);let An=class{constructor(){gt(this,"_events",{}),gt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,r);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(u=>u);for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(t,h.listener),h.listener.apply(this,s||[])}}safeEmit(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(t," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(t,r){let i=t.length;for(;i--;)if(t[i].listener===r)return i;return-1}},Wg=null;function LF(){if(Wg)return Wg;if(window.electron)return Wg=window.electron;if(!window.require)return null;try{return Wg=window.require("electron"),Wg}catch{return null}}let wn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t.VOS_FALLBACK_CN="vosFallbackCN",t.DATACHANNEL_FAILBACK="datachannelFailback",t}({}),ln=function(t){return t.TRACER="tracer",t}({});function MF(t){return cn(t.timeout,"config.timeout",0,1e5),cn(t.timeoutFactor,"config.timeoutFactor",0,100,!1),cn(t.maxRetryCount,"config.maxRetryConfig",0,1/0),cn(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Ume=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Dt=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.FALLBACK_TO_HLS="FALLBACK_TO_HLS",t.UID_CONFLICT="UID_CONFLICT",t}({});function wu(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function UF(t){return Mr(t.turnServerURL,"turnServerURL"),Mr(t.username,"username"),Mr(t.password,"password"),t.udpport&&cn(t.udpport,"udpport",1,99999,!0),t.forceturn&&Us(t.forceturn,"forceturn"),t.security&&Us(t.security,"security"),t.tcpport&&cn(t.tcpport,"tcpport",1,99999,!0),!0}let Op=function(t){return t[t.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",t[t.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",t[t.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",t}({});function zR(t){return t.level!==void 0&&Kn(t.level,"level",[1,2,3]),t.delay!==void 0&&cn(t.delay,"delay",0,3e3,!0),!0}let Rt=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t.FALLBACK_TO_HLS="fallback-to-hls",t.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",t.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",t.AV1_DECODABLE_RESULT="av1-decodable-result",t}({}),KR=function(t){return t.CONFIG="config",t.VOSERROR="vos_error",t.AP_ERROR="ap_error",t}({}),$r=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),wi=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Tu=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function er(t,r){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return t.getListeners(r).length===0?De.reject(new pe($.UNEXPECTED_ERROR,"can not emit promise")):new De((u,h)=>{t.emit(r,...s,u,h)})}function fn(t,r){if(t.getListeners(r).length===0)return De.resolve();for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return er(t,r,...s)}function Ea(t,r){if(t.getListeners(r).length===0)return null;for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return Cu(t,r,...s)}function Cu(t,r){let i=null,s=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(t.emit(r,...u,f=>{i=f},f=>{s=f}),s!==null)throw s;if(i===null)throw new pe($.UNEXPECTED_ERROR,"handler is not sync");return i}const jn=new class extends An{set networkState(t){this.emit(Tu.NETWORK_STATE_CHANGE,t,this._networkState),t===wi.ONLINE?this.emit(Tu.ONLINE):t===wi.OFFLINE&&(this.onlineWaiter=new De(r=>{this.once(Tu.ONLINE,()=>{this.onlineWaiter=void 0,r(wi.ONLINE)})}),this.emit(Tu.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===wi.ONLINE}constructor(){super(),gt(this,"_moduleName","network-indicator"),gt(this,"_networkState",wi.ONLINE),gt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=wi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=wi.OFFLINE})}},Ui=[];for(let t=0;t<256;++t)Ui.push((t+256).toString(16).slice(1));const FF=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let YR;const Fme=new Uint8Array(16);function Vme(){return FF?FF():function(i,s,c){var u,h,f,g;const v=(u=(h=(i=i||{}).random)!==null&&h!==void 0?h:(f=(g=i).rng)===null||f===void 0?void 0:f.call(g))!==null&&u!==void 0?u:function(){if(!YR){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");YR=crypto.getRandomValues.bind(crypto)}return YR(Fme)}();if(v.length<16)throw new Error("Random bytes length must be >= 16");if(v[6]=15&v[6]|64,v[8]=63&v[8]|128,s){if((c=c||0)<0||c+16>s.length)throw new RangeError("UUID byte range ".concat(c,":").concat(c+15," is out of buffer bounds"));for(let _=0;_<16;++_)s[c+_]=v[_];return s}return function(_){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Ui[_[x+0]]+Ui[_[x+1]]+Ui[_[x+2]]+Ui[_[x+3]]+"-"+Ui[_[x+4]]+Ui[_[x+5]]+"-"+Ui[_[x+6]]+Ui[_[x+7]]+"-"+Ui[_[x+8]]+Ui[_[x+9]]+"-"+Ui[_[x+10]]+Ui[_[x+11]]+Ui[_[x+12]]+Ui[_[x+13]]+Ui[_[x+14]]+Ui[_[x+15]]).toLowerCase()}(v)}(t,r,void 0);var t,r}function gb(t,r){const i=t.indexOf(r);i!==-1&&t.splice(i,1)}function Pp(t){const r=[];return t.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function vb(t){De!==void 0?De.resolve().then(t):setTimeout(t,0)}function En(t){return JSON.parse(JSON.stringify(t))}function Nu(t){try{return En(t)}catch{return t}}const VF={};function td(t,r){VF[r]||(VF[r]=!0,t())}function Ru(t){const r=window.atob(t),i=new Uint8Array(new ArrayBuffer(r.length));for(let s=0;s<r.length;s+=1)i[s]=r.charCodeAt(s);return i}function nd(t){let r="";for(let i=0;i<t.length;i+=1)r+=String.fromCharCode(t[i]);return window.btoa(r)}function BF(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(t);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const s=new Uint8Array(r);s.set(i),i=s}return i}function GF(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=as(r).call(r,(h,f)=>h+f.length,0),c=new Uint8Array(new ArrayBuffer(s));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function gc(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function WF(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(i=>{r+=typeof i=="string"?gc(i):i.size}),r+138}function Bme(t){const r=new pe($.TIMEOUT,"timeout");return new De((i,s)=>{window.setTimeout(()=>s(r),t)})}function yr(t){return new De(r=>{window.setTimeout(r,t)})}function Zt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,t).toLowerCase();return i.length===t?"".concat(r).concat(i):"".concat(r).concat(i)+Zt(t-i.length,"")}function Au(){let t,r=!1;try{var i;t=vhe(i=Vme()).call(i,"-","")}catch{r=!0}return!r&&t&&t.length===32||(t=Zt(32,"")),t.toUpperCase()}const $g=()=>{},$F=new class{constructor(){gt(this,"fnMap",new Map)}throttleByKey(t,r,i,s){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const f=this.fnMap.get(r);if(f.threshold!==i){f.fn(...f.args),clearTimeout(f.timer);const g=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:t,threshold:i,timer:g,args:u,skipFn:s})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(r,Ie(Ie({},f),{},{fn:t,args:u,skipFn:s}))}else{const f=window.setTimeout(()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:t,threshold:i,timer:f,args:u,skipFn:s})}}},HF=$F.throttleByKey.bind($F);function zF(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function qR(t,r){if(!zF(t)||!zF(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const i=[...t];for(let s=0;s<r.length;s++)i[s]=qR(t[s],r[s]);return i}{const i=Ie({},t);for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&(Object.prototype.hasOwnProperty.call(t,s)?i[s]=qR(t[s],r[s]):i[s]=r[s]);return i}}function KF(t,r){let i=[0];if(i=new Array(r).fill(0),t===0)return i;let s=0;for(;t>0&&(i[s]=255&t,t>>=8,s++,s!==r););return i}function Dp(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function XR(t,r){try{return typeof t=="object"&&typeof r=="object"&&JSON.stringify(t)===JSON.stringify(r)}catch{return!1}}function JR(t){return as(t).call(t,(r,i)=>r+i,0)}function YF(t){const r="0123456789abcdef";function i(J){let re,ie="";for(re=0;re<=3;re++)ie+=r.charAt(J>>8*re+4&15)+r.charAt(J>>8*re&15);return ie}function s(J,re){const ie=(65535&J)+(65535&re);return(J>>16)+(re>>16)+(ie>>16)<<16|65535&ie}function c(J,re,ie,Z,se,ge){return s(function(Ee,Fe){return Ee<<Fe|Ee>>>32-Fe}(s(s(re,J),s(Z,ge)),se),ie)}function u(J,re,ie,Z,se,ge,Ee){return c(re&ie|~re&Z,J,re,se,ge,Ee)}function h(J,re,ie,Z,se,ge,Ee){return c(re&Z|ie&~Z,J,re,se,ge,Ee)}function f(J,re,ie,Z,se,ge,Ee){return c(re^ie^Z,J,re,se,ge,Ee)}function g(J,re,ie,Z,se,ge,Ee){return c(ie^(re|~Z),J,re,se,ge,Ee)}const v=function(J){let re;const ie=1+(J.length+8>>6),Z=new Array(16*ie);for(re=0;re<16*ie;re++)Z[re]=0;for(re=0;re<J.length;re++)Z[re>>2]|=J.charCodeAt(re)<<re%4*8;return Z[re>>2]|=128<<re%4*8,Z[16*ie-2]=8*J.length,Z}(t);let _,x,S,C,U,P=1732584193,j=-271733879,W=-1732584194,K=271733878;for(_=0;_<v.length;_+=16)x=P,S=j,C=W,U=K,P=u(P,j,W,K,v[_+0],7,-680876936),K=u(K,P,j,W,v[_+1],12,-389564586),W=u(W,K,P,j,v[_+2],17,606105819),j=u(j,W,K,P,v[_+3],22,-1044525330),P=u(P,j,W,K,v[_+4],7,-176418897),K=u(K,P,j,W,v[_+5],12,1200080426),W=u(W,K,P,j,v[_+6],17,-1473231341),j=u(j,W,K,P,v[_+7],22,-45705983),P=u(P,j,W,K,v[_+8],7,1770035416),K=u(K,P,j,W,v[_+9],12,-1958414417),W=u(W,K,P,j,v[_+10],17,-42063),j=u(j,W,K,P,v[_+11],22,-1990404162),P=u(P,j,W,K,v[_+12],7,1804603682),K=u(K,P,j,W,v[_+13],12,-40341101),W=u(W,K,P,j,v[_+14],17,-1502002290),j=u(j,W,K,P,v[_+15],22,1236535329),P=h(P,j,W,K,v[_+1],5,-165796510),K=h(K,P,j,W,v[_+6],9,-1069501632),W=h(W,K,P,j,v[_+11],14,643717713),j=h(j,W,K,P,v[_+0],20,-373897302),P=h(P,j,W,K,v[_+5],5,-701558691),K=h(K,P,j,W,v[_+10],9,38016083),W=h(W,K,P,j,v[_+15],14,-660478335),j=h(j,W,K,P,v[_+4],20,-405537848),P=h(P,j,W,K,v[_+9],5,568446438),K=h(K,P,j,W,v[_+14],9,-1019803690),W=h(W,K,P,j,v[_+3],14,-187363961),j=h(j,W,K,P,v[_+8],20,1163531501),P=h(P,j,W,K,v[_+13],5,-1444681467),K=h(K,P,j,W,v[_+2],9,-51403784),W=h(W,K,P,j,v[_+7],14,1735328473),j=h(j,W,K,P,v[_+12],20,-1926607734),P=f(P,j,W,K,v[_+5],4,-378558),K=f(K,P,j,W,v[_+8],11,-2022574463),W=f(W,K,P,j,v[_+11],16,1839030562),j=f(j,W,K,P,v[_+14],23,-35309556),P=f(P,j,W,K,v[_+1],4,-1530992060),K=f(K,P,j,W,v[_+4],11,1272893353),W=f(W,K,P,j,v[_+7],16,-155497632),j=f(j,W,K,P,v[_+10],23,-1094730640),P=f(P,j,W,K,v[_+13],4,681279174),K=f(K,P,j,W,v[_+0],11,-358537222),W=f(W,K,P,j,v[_+3],16,-722521979),j=f(j,W,K,P,v[_+6],23,76029189),P=f(P,j,W,K,v[_+9],4,-640364487),K=f(K,P,j,W,v[_+12],11,-421815835),W=f(W,K,P,j,v[_+15],16,530742520),j=f(j,W,K,P,v[_+2],23,-995338651),P=g(P,j,W,K,v[_+0],6,-198630844),K=g(K,P,j,W,v[_+7],10,1126891415),W=g(W,K,P,j,v[_+14],15,-1416354905),j=g(j,W,K,P,v[_+5],21,-57434055),P=g(P,j,W,K,v[_+12],6,1700485571),K=g(K,P,j,W,v[_+3],10,-1894986606),W=g(W,K,P,j,v[_+10],15,-1051523),j=g(j,W,K,P,v[_+1],21,-2054922799),P=g(P,j,W,K,v[_+8],6,1873313359),K=g(K,P,j,W,v[_+15],10,-30611744),W=g(W,K,P,j,v[_+6],15,-1560198380),j=g(j,W,K,P,v[_+13],21,1309151649),P=g(P,j,W,K,v[_+4],6,-145523070),K=g(K,P,j,W,v[_+11],10,-1120210379),W=g(W,K,P,j,v[_+2],15,718787259),j=g(j,W,K,P,v[_+9],21,-343485551),P=s(P,x),j=s(j,S),W=s(W,C),K=s(K,U);return i(P)+i(j)+i(W)+i(K)}let Gme=1,qF=console,Rr=class{static setLogger(t){qF=t}constructor(t,r){gt(this,"id",void 0),gt(this,"lockingPromise",De.resolve()),gt(this,"locks",0),gt(this,"name",""),gt(this,"lockId",void 0),this.lockId=Gme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");qF.debug("".concat(i," ").concat(s))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const i=new De(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),s=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),s}};function kp(t,r){return function(i,s,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const f=await h.lock("From ".concat(t,".").concat(s));try{for(var g=arguments.length,v=new Array(g),_=0;_<g;_++)v[_]=arguments[_];return await u.apply(this,v)}finally{f()}},c}}const Yn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function yb(t,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,i)}function Ro(t,r,i,s){const c=Object.assign({},Yn,s);let u=c.timeout;const h=async()=>{await function(v){return new De(_=>{window.setTimeout(_,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let f=!1;const g=new De(async(v,_)=>{r=r||(()=>!1),i=i||(()=>!0);for(let x=0;x<c.maxRetryCount;x+=1){if(f)return _(new pe($.OPERATION_ABORTED));try{const S=await t();if(!r(S,x)||x+1===c.maxRetryCount)return v(S);await h()}catch(S){if(!i(S,x)||x+1===c.maxRetryCount)return _(S);await h()}}});return g.cancel=()=>f=!0,g}let _b,QR=class{constructor(t){gt(this,"input",[]),gt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:as(t=this.input).call(t,(r,i)=>r+i)/this.input.length}},bb=0,ZR=0;function eA(t,r,i,s){return new De((c,u)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),bb+=gc(r.data)):i&&(r.data.size?bb+=r.data.size:r.data instanceof FormData?bb+=WF(r.data):bb+=gc(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Mi.request(r).then(h=>{typeof h.data=="string"?ZR+=gc(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?ZR+=h.data.byteLength:ZR+=gc(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Mi.isCancel(h)?u(new pe($.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new pe($.NETWORK_TIMEOUT,h.message)):h.response?u(new pe($.NETWORK_RESPONSE_ERROR,h.response.status)):u(new pe($.NETWORK_ERROR,h.message))})})}async function Wme(t,r){const i=new Blob([r.data],{type:"buffer"});return await eA(t,Ie(Ie({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const XF=()=>window.isSecureContext!==void 0;function Fs(t){if(Array.isArray(t))return t.map(i=>i);if(!JF(t))return t;const r={};for(const i in t){const s=t[i];JF(s)||Array.isArray(s)?r[i]=Fs(s):r[i]=s}return r}function JF(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let tA=class{constructor(t){gt(this,"input",[]),gt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Vs={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Hg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Vs,remoteCandidate:Vs},updateInterval:0},QF={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},ZF={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},eV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},tV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let nA=class{constructor(t,r){gt(this,"onFirstVideoReceived",void 0),gt(this,"onFirstVideoDecoded",void 0),gt(this,"onFirstAudioReceived",void 0),gt(this,"onFirstVideoDecodedTimeout",void 0),gt(this,"onFirstAudioDecoded",void 0),gt(this,"onSelectedLocalCandidateChanged",void 0),gt(this,"onSelectedRemoteCandidateChanged",void 0),gt(this,"videoIsReady",!1),gt(this,"videoIsReady2",{}),gt(this,"pc",void 0),gt(this,"options",void 0),gt(this,"intervalTimer",void 0),gt(this,"stats",Fs(Hg)),gt(this,"isFirstVideoReceived",{}),gt(this,"isFirstVideoDecoded",{}),gt(this,"isFirstAudioReceived",{}),gt(this,"isFirstAudioDecoded",{}),gt(this,"isFirstVideoDecodedTimeout",{}),gt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new De(t=>{t({local:Ie({},Vs),remote:Ie({},Vs)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,c=0,u=0,h=0;for(const f of i)t[f].forEach((g,v)=>{if(!this.lossRateWindowStats[r-1][f][v]||!this.lossRateWindowStats[0][f][v])return;const _=this.lossRateWindowStats[r-1][f][v].packets-this.lossRateWindowStats[0][f][v].packets,x=this.lossRateWindowStats[r-1][f][v].packetsLost-this.lossRateWindowStats[0][f][v].packetsLost;f==="videoSend"||f==="audioSend"?(s+=_,u+=x):(c+=_,h+=x),Number.isNaN(_)||Number.isNaN(_)?g.packetLostRate=0:g.packetLostRate=_<=0||x<=0?0:x/(_+x)});t.sendPacketLossRate=s<=0||u<=0?0:u/(s+u),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},$me=class extends nA{constructor(){super(...arguments),gt(this,"_stats",Hg),gt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Fs(Hg);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const s=r.find(c=>c.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var i;const s=Te(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const c=Fs(ZF);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Fs(QF),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,f=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=f,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Ie({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Fs(tV);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Fs(eV);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new De((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{s[c]=i.stat(c)}),r.push(s)}),r}},jp=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),Eb=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),rA=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),La=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Lp=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Lp||{});function zg(t,r,i,s){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Lp.kNone;if(!r)return;const u=Number(r[i]);if(typeof u!="number")return;const h=Number(r[s]);if(typeof h!="number")return;if(!t)return h?u/h*c:void 0;const f=Number(t[i]);if(typeof f!="number")return;const g=Number(t[s]);if(typeof g!="number")return;const v=h-g;return v?(u-f)/v*c:void 0}let nV=class extends nA{constructor(){super(...arguments),gt(this,"_stats",Hg),gt(this,"report",void 0),gt(this,"lastDecodeVideoReceiverStats",new Map),gt(this,"lastVideoFramesRecv",new Map),gt(this,"lastVideoFramesSent",new Map),gt(this,"lastVideoFramesDecode",new Map),gt(this,"lastVideoFramesOutput",new Map),gt(this,"lastVideoJBDelay",new Map),gt(this,"lastAudioJBDelay",new Map),gt(this,"mediaBytesSent",new Map),gt(this,"mediaBytesRetransmit",new Map),gt(this,"mediaBytesTargetEncode",new Map),gt(this,"lastDecodeAudioReceiverStats",new Map),gt(this,"lastAudioConcealment",new Map),gt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Fs(Hg),this.report.forEach(t=>{switch(t.type){case La.OUTBOUND:case La.INBOUND:{const r=t.mediaType||t.kind,i=!r&&"frameWidth"in t,s=!r&&!("frameWidth"in t);t.type===La.OUTBOUND?r==="audio"||s?this.processAudioOutboundStats(t):(r==="video"||i)&&this.processVideoOutboundStats(t):t.type===La.INBOUND&&(r==="audio"||s?this.processAudioInboundStats(t):(r==="video"||i)&&this.processVideoInboundStats(t));break}case La.TRANSPORT:{this.processTransportStats(t);const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case La.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:Ie({},Vs),remote:Ie({},Vs)};return t.forEach(i=>{let s;if(i.type===La.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===La.CANDIDATE_PAIR&&i.selected&&(s=i),s){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(s.localCandidateId){const u=t.get(s.localCandidateId);u&&c(r.local,u)}if(s.remoteCandidateId){const u=t.get(s.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===La.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===La.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===La.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ie({},r),Ie({},this.stats.selectedCandidatePair.localCandidate)),t.type===La.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ie({},r),Ie({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(s=>s.ssrc===t.ssrc);r||(r=Fs(tV),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount,r.estimatedPlayoutTimestamp=t.estimatedPlayoutTimestamp;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=zg(i,r,"totalProcessingDelay","jitterBufferEmittedCount",Lp.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),this.calculateAudioFreeze(r,i,t),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,Ie({},r))}calculateAudioFreeze(t,r,i){const s=this.lastAudioConcealment.get(t.ssrc);if(r!=null&&s!=null){const c=s.lts,u=i.timestamp,h=u-c;if(h<=0)return;const f=t.concealedSamples-r.concealedSamples-0,g=s.nonSilent+f,v=t.totalSamplesReceived-r.totalSamplesReceived;if(v<=0)return;const _=80*v/h,x=200*v/h,S=h/v;let C=0;t.freezeSamples80=r.freezeSamples80,t.freezeMs80=r.freezeMs80,g>_&&(s.plc80>0?(t.freezeSamples80+=f,t.freezeMs80+=Math.round(f*S)):(t.freezeSamples80+=g,t.freezeMs80+=Math.round(g*S)),C=s.plc80+1);let U=0;t.freezeSamples200=r.freezeSamples200,t.freezeMs200=r.freezeMs200,g>x&&(s.plc200>0?(t.freezeSamples200+=f,t.freezeMs200+=Math.round(f*S)):(t.freezeSamples200+=g,t.freezeMs200+=Math.round(g*S)),U=s.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:f,lts:u,plc80:C,plc200:U})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:i.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=Fs(QF),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.estimatedPlayoutTimestamp=t.estimatedPlayoutTimestamp;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),s=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,f=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,f),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const h=i.stats,f=u-i.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=f,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=zg(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=zg(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",Lp.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=zg(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Lp.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=zg(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",Lp.kMillisecondsFromSeconds),s&&u-s.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-s.count)/((u-s.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):s?r.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Ie({},r),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);r||(r=Fs(ZF),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const s=new tA(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{const c=new tA(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{const c=new tA(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,r.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-s.lastFrameCount,u=t.totalEncodeTime-s.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(t.framesEncoded&&t.qpSum){const s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,La.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(r||(r=Fs(eV),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const i=this.findRemoteStatsId(t.ssrc,La.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}processTransportStats(t){this._stats.transport.bytesReceived=t.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=t.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=t.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=t.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(t,r){var i;const s=Array.from(ya(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===t);return s?s.id:null}processVideoMediaSource(t,r){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,r){const i=this.report.get(t);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,r,i){var s,c,u,h;const f=r?this.report.get(r):void 0,g=(s=f==null?void 0:f.framesSent)!==null&&s!==void 0?s:t.framesSent;if(typeof g!="number")return;let v=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:t.frameWidth,_=(u=f==null?void 0:f.frameHeight)!==null&&u!==void 0?u:t.frameHeight,x=(h=f==null?void 0:f.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof _=="number"||(v=0,_=0),x==null){const S=Date.now(),C=this.lastVideoFramesSent.get(i.ssrc);C&&S-C.lts>=800?(x=Math.round((g-C.count)/((S-C.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:g,lts:S,rate:x})):C?x=C.rate:this.lastVideoFramesSent.set(i.ssrc,{count:g,lts:S,rate:0})}i.sentFrame={width:v,height:_,frameRate:Math.max(0,x)}}processVideoTrackReceiverStats(t,r,i){var s,c,u,h,f;const g=r?this.report.get(r):void 0,v=(s=g==null?void 0:g.framesReceived)!==null&&s!==void 0?s:t.framesReceived,_=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:t.frameWidth,x=(u=g==null?void 0:g.frameHeight)!==null&&u!==void 0?u:t.frameHeight,S=(h=g==null?void 0:g.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,C=(f=g==null?void 0:g.jitterBufferEmittedCount)!==null&&f!==void 0?f:t.jitterBufferEmittedCount;if(typeof v=="number"){const U=this.lastVideoFramesRecv.get(i.ssrc),P=Date.now();i.framesReceivedCount=v;let j=0;U&&P-U.lts>=800?(j=Math.round((v-U.count)/((P-U.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:P,rate:j})):U?j=U.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:P,rate:0}),i.receivedFrame={width:_||0,height:x||0,frameRate:j||0},i.decodedFrame={width:_||0,height:x||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:_||0,height:x||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(S&&C){const U=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let P=U.jitterBufferMs;const j=C-U.jitterBufferEmittedCount;j>0&&(P=1e3*(S-U.jitterBufferDelay)/j),i.jitterBufferMs=P,i.currentDelayMs=Math.round(P),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:C,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,r,i){var s,c,u,h;const f=r?this.report.get(r):void 0,g=(s=(c=f==null?void 0:f.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&s!==void 0?s:0,v=(u=(h=f==null?void 0:f.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=g,i.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,i){var s,c,u,h,f,g,v,_,x;const S=r?this.report.get(r):void 0,C=(s=S==null?void 0:S.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,U=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,P=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,j=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,W=(f=S==null?void 0:S.audioLevel)!==null&&f!==void 0?f:t==null?void 0:t.audioLevel,K=(g=S==null?void 0:S.totalSamplesDuration)!==null&&g!==void 0?g:t==null?void 0:t.totalSamplesDuration,J=(v=S==null?void 0:S.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples,re=(_=S==null?void 0:S.silentConcealedSamples)!==null&&_!==void 0?_:t.silentConcealedSamples,ie=(x=S==null?void 0:S.concealmentEvents)!==null&&x!==void 0?x:t.concealmentEvents;if(typeof U=="number"&&(i.totalSamplesReceived=U),typeof re=="number"&&(i.silentConcealedSamples=re),typeof ie=="number"&&(i.concealmentEvents=ie),typeof J=="number"&&(i.concealedSamples=J),C&&U&&(i.accelerateRate=C/U),P&&j){const se=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ge=se.jitterBufferMs;const Ee=j-se.jitterBufferEmittedCount;Ee>0&&(ge=1e3*(P-se.jitterBufferDelay)/Ee),i.jitterBufferMs=Math.round(ge),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:j,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=W;let Z=1920;K&&U&&(Z=U/K/50,i.receivedFrames=Math.round(U/Z)),J&&(i.droppedFrames=Math.round(J/Z))}processRemoteInboundStats(t,r){const i=this.report.get(t);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const s=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Hme=class extends nA{updateStats(){return De.resolve()}};function xb(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new $me(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new nV(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const f=h.getStats();return!!(f instanceof De||function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"}(f))}(t)?new nV(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new Hme(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c})}const rV="websdk_ng_install_id";function iA(){try{if(G("INSTALL_ID"))return G("INSTALL_ID");let t=window.localStorage.getItem(rV);return t||(t=Au(),window.localStorage.setItem(rV,t)),an("INSTALL_ID",t),t}catch{return}}const os=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],s=r[2];return"".concat(i,".").concat(s)}return"4.0.0.999"}("4.24.2"),aA=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Iu=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Hr=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const s=i.join(""),c=[];for(let f=0;f<6;f++)c.push("1");const u=c.join(""),h={};return h[t]=s,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Hr;const Sb={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},sA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},oA="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",cA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},en=Ie(Ie(Ie(Ie({},cA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:sA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Sb),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function an(t,r,i){var s,c,u;Te(s=Object.keys(en)).call(s,t)&&(!i&&Te(c=Object.keys(Ma)).call(c,t)||(en[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||r!==!0||(en.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,en.USE_NEW_NETWORK_CONFIG=u,u&&(en.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],en.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],en.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],en.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],en.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",en.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(en.ENABLE_INSTANT_VIDEO=!0,en.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(en.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(en.NEW_TURN_MODE||(en.NEW_TURN_MODE=4))))}function G(t){if(t==="TURN_DOMAINS"){const r=en.TURN_DOMAINS;return Te(r).call(r,G("TURN_DOMAIN"))?r:[G("TURN_DOMAIN")].concat(r)}return en[t]}aA||(en.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],en.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],en.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],en.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],en.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],en.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],en.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",en.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",en.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",en.AREAS=["NORTH_AMERICA","OVERSEA"]);let iV=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Ma={};var pt=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_RTE_URL="SET_RTE_URL",t.SET_RTE_SID="SET_RTE_SID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(pt||{});let Ou=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const aV=128,zme=96,sV=1e3,Mp=10;let Kme=0;var oV=(()=>{var t={8:(s,c,u)=>{u.r(c),u.d(c,{Parser:()=>Ee,Printer:()=>yt,parse:()=>Oe,print:()=>We});const h=`
`,f="".concat("\r").concat(h),g=" ";let v;function _(_e){return _e>="0"&&_e<="9"}function x(_e){return _e>="!"&&_e<="~"}function S(_e){return x(_e)||_e>=""&&_e<=""}function C(_e){return _e==="!"||_e>="#"&&_e<="'"||_e>="*"&&_e<="+"||_e>="-"&&_e<="."||_e>="0"&&_e<="9"||_e>="A"&&_e<="Z"||_e>="^"&&_e<="~"}function U(_e){return _e>="1"&&_e<="9"}function P(_e){return _e>="A"&&_e<="Z"||_e>="a"&&_e<="z"}function j(_e){return _e==="d"||_e==="h"||_e==="m"||_e==="s"}function W(_e){return _e>""&&_e<"	"||_e>"\v"&&_e<"\f"||_e>""&&_e<""}function K(_e){return P(_e)||_(_e)||_e==="+"||_e==="/"}function J(_e){return _(_e)||P(_e)||_e==="+"||_e==="/"||_e==="-"||_e==="_"}function re(_e){return P(_e)||_(_e)||_e==="+"||_e==="/"}function ie(_e,I){var X=Object.keys(_e);if(Object.getOwnPropertySymbols){var te=Object.getOwnPropertySymbols(_e);I&&(te=te.filter(function(Ne){return Object.getOwnPropertyDescriptor(_e,Ne).enumerable})),X.push.apply(X,te)}return X}function Z(_e){for(var I=1;I<arguments.length;I++){var X=arguments[I]!=null?arguments[I]:{};I%2?ie(Object(X),!0).forEach(function(te){se(_e,te,X[te])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(X)):ie(Object(X)).forEach(function(te){Object.defineProperty(_e,te,Object.getOwnPropertyDescriptor(X,te))})}return _e}function se(_e,I,X){return I in _e?Object.defineProperty(_e,I,{value:X,enumerable:!0,configurable:!0,writable:!0}):_e[I]=X,_e}(function(_e){_e.VERSION="v",_e.ORIGIN="o",_e.SESSION_NAME="s",_e.INFORMATION="i",_e.URI="u",_e.EMAIL="e",_e.PHONE="p",_e.CONNECTION="c",_e.BANDWIDTH="b",_e.TIME="t",_e.REPEAT="r",_e.ZONE_ADJUSTMENTS="z",_e.KEY="k",_e.ATTRIBUTE="a",_e.MEDIA="m"})(v||(v={}));class ge{consumeText(I,X){let te=X;for(;te<I.length;){const Ne=I[te];if(Ne==="\0"||Ne==="\r"||Ne===h)break;te+=1}if(te-X==0)throw new Error("Invalid text, at ".concat(I));return te}consumeUnicastAddress(I,X,te){return this.consumeTill(I,X,g)}consumeOneOrMore(I,X,te){let Ne=X;for(;te(I[Ne]);)Ne++;if(Ne-X==0)throw new Error("Invalid rule at ".concat(X,"."));return Ne}consumeSpace(I,X){if(I[X]===g)return X+1;throw new Error("Invalid space at ".concat(X,"."))}consumeIP4Address(I,X){let te=X;for(let Ne=0;Ne<4;Ne++)if(te=this.consumeDecimalUChar(I,te),Ne!==3){if(I[te]!==".")throw new Error("Invalid IP4 address.");te++}return te}consumeDecimalUChar(I,X){let te=X;for(let mt=0;mt<3&&_(I[te]);mt++,te++);if(te-X==0)throw new Error("Invalid decimal uchar.");const Ne=parseInt(I.slice(X,te));if(Ne>=0&&Ne<=255)return te;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,X){let te=this.consumeHexpart(I,X);return I[te]===":"&&(te+=1,te=this.consumeIP4Address(I,te)),te}consumeHexpart(I,X){let te=X;if(I[te]===":"&&I[te+1]===":"){te+=2;try{te=this.consumeHexseq(I,te)}catch{}return te}if(te=this.consumeHexseq(I,te),I[te]===":"&&I[te+1]===":"){te+=2;try{te=this.consumeHexseq(I,te)}catch{}return te}return te}consumeHexseq(I,X){let te=X;for(;te=this.consumeHex4(I,te),I[te]===":"&&I[te+1]!==":";)te+=1;return te}consumeHex4(I,X){let te=0;for(;te<4;te++)if(!((Ne=I[X+te])>="0"&&Ne<="9"||Ne>="a"&&Ne<="f"||Ne>="A"&&Ne<="F")){if(te===0)throw new Error("Invalid hex 4");break}var Ne;return X+te}consumeFQDN(I,X){let te=X;for(;_(I[te])||P(I[te])||I[te]==="-"||I[te]===".";)te+=1;if(te-X<4)throw new Error("Invalid FQDN");return te}consumeExtnAddr(I,X){return this.consumeOneOrMore(I,X,S)}consumeMulticastAddress(I,X,te){switch(te){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,X);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,X);default:try{return this.consumeFQDN(I,X)}catch{return this.consumeExtnAddr(I,X)}}}consumeIP6MulticastAddress(I,X){const te=this.consumeHexpart(I,X);return I[te]==="/"?this.consumeInteger(I,te+1):te}consumeIP4MulticastAddress(I,X){let te=X+3;const Ne=I.slice(X,te),mt=parseInt(Ne);if(mt<224||mt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let gn=0;gn<3;gn++){if(I[te]!==".")throw new Error("Invalid IP4 multicast address.");te+=1,te=this.consumeDecimalUChar(I,te)}return I[te]==="/"&&(te+=1),te=this.consumeTTL(I,te),I[te]==="/"&&(te=this.consumeInteger(I,te)),te}consumeInteger(I,X){if(!U(I[X]))throw new Error("Invalid integer.");for(X+=1;_(I[X]);)X+=1;return X}consumeTTL(I,X){if(I[X]==="0")return X+1;if(!U(I[X]))throw new Error("Invalid TTL.");X+=1;for(let te=0;te<2&&_(I[X]);te++)X+=1;return X}consumeToken(I,X){return this.consumeOneOrMore(I,X,C)}consumeTime(I,X){let te=X;if(I[te]==="0")return te+1;for(U(I[te])&&(te+=1);_(I[te]);)te++;if(te-X<10)throw new Error("Invalid time");return te}consumeAddress(I,X){return this.consumeTill(I,X,g)}consumeTypedTime(I,X){let te=X;return te=this.consumeOneOrMore(I,te,_),j(I[te])?te+1:te}consumeRepeatInterval(I,X){if(!U(I[X]))throw new Error("Invalid repeat interval");for(X+=1;_(I[X]);)X+=1;return j(I[X])&&(X+=1),X}consumePort(I,X){return this.consumeOneOrMore(I,X,_)}consume(I,X,te){for(let Ne=0;Ne<te.length;Ne++){if(X+Ne>=I.length)throw new Error("consume exceeding value length");if(I[X+Ne]!==te[Ne])throw new Error("consume ".concat(te," failed at ").concat(Ne))}return X+te.length}consumeTill(I,X,te){let Ne=X;for(;Ne<I.length&&(typeof te!="string"||I[Ne]!==te)&&(typeof te!="function"||!te(I[Ne]));)Ne++;return Ne}}class Ee extends ge{constructor(){super(),se(this,"records",[]),se(this,"currentLine",0)}parse(I){const X=this.probeEOL(I);this.records=I.split(X).filter(bd=>!!xi(bd).call(bd)).map(this.parseLine),this.currentLine=0;const te=this.parseVersion(),Ne=this.parseOrigin(),mt=this.parseSessionName(),gn=this.parseInformation(),xr=this.parseUri(),gs=this.parseEmail(),_d=this.parsePhone(),FE=this.parseConnection(),gf=this.parseBandWidth(),VE=this.parseTimeFields(),th=this.parseKey(),Iv=this.parseSessionAttribute(),nh=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:te,origin:Ne,sessionName:mt,information:gn,uri:xr,emails:gs,phones:_d,connection:FE,bandwidths:gf,timeFields:VE,key:th,attributes:Iv,mediaDescriptions:nh}}getCurrentRecord(){const I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let X=0;X<I.length;X++)if(I[X]===h)return I[X-1]==="\r"?f:h;throw new Error("Invalid newline character.")}parseLine(I,X){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const te=I[0];if(I[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:te,value:I.slice(2),line:X,cur:0}}parseSessionAttribute(){const I=new ht;for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==v.ATTRIBUTE)break;const te={attField:this.extractOneOrMore(X,Ne=>C(Ne)&&Ne!==":"),_cur:0};X.value[X.cur]===":"&&(X.cur+=1,te.attValue=this.extractOneOrMore(X,W)),I.parse(te),this.currentLine++}return I.digest()}parseMediaAttributes(I){const X=new ot(I);for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==v.ATTRIBUTE)break;const Ne={attField:this.extractOneOrMore(te,mt=>C(mt)&&mt!==":"),_cur:0};te.value[te.cur]===":"&&(te.cur+=1,Ne.attValue=this.extractOneOrMore(te,W)),X.parse(Ne),this.currentLine++}return X.digest()}parseKey(){const I=this.getCurrentRecord();if(I.type===v.KEY){if(I.value==="prompt"||I.value==="clear:"||I.value==="base64:"||I.value==="uri:")return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const I=this.getCurrentRecord();if(I.type===v.ZONE_ADJUSTMENTS){const X=[];for(;;)try{const te=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let Ne=!1;I.value[I.cur]==="-"&&(Ne=!0,I.cur+=1);const mt=this.extract(I,this.consumeTypedTime);X.push({time:te,typedTime:mt,back:Ne})}catch{break}if(X.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,X}return[]}parseRepeat(){const I=[];for(;;){const X=this.getCurrentRecord();if(X.type!==v.REPEAT)break;{const te=this.extract(X,this.consumeRepeatInterval),Ne=this.parseTypedTime(X);I.push({repeatInterval:te,typedTimes:Ne}),this.currentLine++}}return I}parseTypedTime(I){const X=[];for(;;)try{this.consumeSpaceForRecord(I),X.push(this.extract(I,this.consumeTypedTime))}catch{break}if(X.length===0)throw new Error("Invalid typed time.");return X}parseTime(){const I=this.getCurrentRecord(),X=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);const te=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:X,stopTime:te}}parseBandWidth(){const I=[];for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==v.BANDWIDTH)break;{const te=this.extractOneOrMore(X,C);if(X.value[X.cur]!==":")throw new Error("Invalid bandwidth field.");X.cur++;const Ne=this.extractOneOrMore(X,_);I.push({bwtype:te,bandwidth:Ne}),this.currentLine++}}return I}parseVersion(){const I=this.getCurrentRecord();if(I.type!==v.VERSION)throw new Error("first sdp record must be version");const X=I.value.slice(0,this.consumeOneOrMore(I.value,0,_));if(X.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,X}parseOrigin(){const I=this.getCurrentRecord();if(I.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const X=this.extractOneOrMore(I,S);this.consumeSpaceForRecord(I);const te=this.extractOneOrMore(I,_);this.consumeSpaceForRecord(I);const Ne=this.extractOneOrMore(I,_);this.consumeSpaceForRecord(I);const mt=this.extractOneOrMore(I,C);this.consumeSpaceForRecord(I);const gn=this.extractOneOrMore(I,C);this.consumeSpaceForRecord(I);const xr=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:X,sessId:te,sessVersion:Ne,nettype:mt,addrtype:gn,unicastAddress:xr}}parseSessionName(){const I=this.getCurrentRecord();if(I.type===v.SESSION_NAME){const X=this.extract(I,this.consumeText);return this.currentLine++,X}}parseInformation(){const I=this.getCurrentRecord();if(I.type!==v.INFORMATION)return;const X=this.extract(I,this.consumeText);return this.currentLine++,X}parseUri(){const I=this.getCurrentRecord();if(I.type===v.URI)return this.currentLine++,I.value}parseEmail(){const I=[];for(;;){const X=this.getCurrentRecord();if(X.type!==v.EMAIL)break;I.push(X.value),this.currentLine++}return I}parsePhone(){const I=[];for(;;){const X=this.getCurrentRecord();if(X.type!==v.PHONE)break;I.push(X.value),this.currentLine++}return I}parseConnection(){const I=this.getCurrentRecord();if(I.type===v.CONNECTION){const X=this.extractOneOrMore(I,C);this.consumeSpaceForRecord(I);const te=this.extractOneOrMore(I,C);this.consumeSpaceForRecord(I);const Ne=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:X,addrtype:te,address:Ne}}}parseMedia(){const I=this.getCurrentRecord(),X=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let te=this.extract(I,this.consumePort);I.value[I.cur]==="/"&&(I.cur+=1,te+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);const Ne=[];for(Ne.push(this.extract(I,this.consumeToken));I.value[I.cur]==="/";)I.cur+=1,Ne.push(this.extract(I,this.consumeToken));if(Ne.length===0)throw new Error("Invalid proto");const mt=this.parseFmt(I);return this.currentLine++,{mediaType:X,port:te,protos:Ne,fmts:mt}}parseTimeFields(){const I=[];for(;this.getCurrentRecord().type===v.TIME;){const X=this.parseTime(),te=this.parseRepeat(),Ne=this.parseZone();I.push({time:X,repeats:te,zones:Ne})}return I}parseMediaDescription(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const X=this.parseMedia(),te=this.parseInformation(),Ne=this.parseConnections(),mt=this.parseBandWidth(),gn=this.parseKey(),xr=this.parseMediaAttributes(X);I.push({media:X,information:te,connections:Ne,bandwidths:mt,key:gn,attributes:xr})}return I}parseConnections(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){const X=[];for(;;)try{this.consumeSpaceForRecord(I),X.push(this.extract(I,this.consumeToken))}catch{break}if(X.length===0)throw new Error("Invalid fmts");return X}extract(I,X){for(var te=arguments.length,Ne=new Array(te>2?te-2:0),mt=2;mt<te;mt++)Ne[mt-2]=arguments[mt];const gn=X.call(this,I.value,I.cur,...Ne),xr=I.value.slice(I.cur,gn);return I.cur=gn,xr}extractOneOrMore(I,X){const te=this.consumeOneOrMore(I.value,I.cur,X),Ne=I.value.slice(I.cur,te);return I.cur=te,Ne}consumeSpaceForRecord(I){if(I.value[I.cur]!==g)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class Fe extends ge{constructor(){super(...arguments),se(this,"attributes",void 0),se(this,"digested",!1)}extractOneOrMore(I,X,te){const Ne=this.consumeOneOrMore(I.attValue,I._cur,X),mt=I.attValue.slice(I._cur,Ne),[gn,xr]=te||[];if(typeof gn=="number"&&mt.length<gn)throw new Error("error in length, should be more or equal than ".concat(gn," characters."));if(typeof xr=="number"&&mt.length>xr)throw new Error("error in length, should be less or equal than ".concat(xr," characters."));return I._cur=Ne,mt}consumeAttributeSpace(I){if(I.attValue[I._cur]!==g)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,X){if(!I.attValue)throw new Error("Nothing to extract from attValue.");for(var te=arguments.length,Ne=new Array(te>2?te-2:0),mt=2;mt<te;mt++)Ne[mt-2]=arguments[mt];const gn=X.call(this,I.attValue,I._cur,...Ne),xr=I.attValue.slice(I._cur,gn);return I._cur=gn,xr}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,X){if(!I.attValue)throw new Error;for(let te=0;te<X.length;te++)if(X[te]!==I.attValue[I._cur+te])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,K,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,K,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const X=[];for(;!this.atEnd(I);){X.push(this.extractOneOrMore(I,K));try{this.consumeAttributeSpace(I)}catch(te){if(this.atEnd(I))break;throw te}}this.attributes.iceOptions=X}parseFingerprint(I){const X=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const te=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:X,fingerprint:te})}parseExtmap(I){const X=this.extractOneOrMore(I,_);let te;this.peekChar(I)==="/"&&(this.extract(I,this.consume,"/"),te=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);const Ne=this.extract(I,this.consumeTill,g),mt=Z(Z({entry:parseInt(X,10)},te&&{direction:te}),{},{extensionName:Ne});this.peekChar(I)===g&&(this.consumeAttributeSpace(I),mt.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(mt)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const X=this.extract(I,this.consumeTill);if(X!=="active"&&X!=="passive"&&X!=="actpass"&&X!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=X}}class ht extends Fe{constructor(){super(...arguments),se(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(X){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),X}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){const X=this.extract(I,this.consumeToken),te=[];for(;!this.atEnd(I)&&this.peekChar(I)===g;)this.consumeAttributeSpace(I),te.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:X,identificationTag:te})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,J)}parseIdentity(I){const X=this.extractOneOrMore(I,re),te=[];for(;!this.atEnd(I)&&this.peekChar(I)===g;){this.consumeAttributeSpace(I);const Ne=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");const mt=this.extractOneOrMore(I,gn=>gn!==g&&W(gn));te.push({name:Ne,value:mt})}this.attributes.identities.push({assertionValue:X,extensions:te})}parseMsidSemantic(I){this.peekChar(I)===g&&this.consumeAttributeSpace(I);const X={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch{break}if(this.peekChar(I)==="*"){this.extract(I,this.consume,"*"),X.applyForAll=!0;break}{const te=this.extract(I,this.consumeTill,g);X.identifierList.push(te)}}this.attributes.msidSemantic=X}}class ot extends Fe{constructor(I){super(),se(this,"attributes",void 0),I.protos.indexOf("RTP")!==-1||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(X){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),X}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){const X=this.extractOneOrMore(I,K,[1,32]);this.consumeAttributeSpace(I);const te=this.extractOneOrMore(I,_,[1,5]);this.consumeAttributeSpace(I);const Ne=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const mt=this.extractOneOrMore(I,_,[1,10]);this.consumeAttributeSpace(I);const gn=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const xr=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);const gs={foundation:X,componentId:te,transport:Ne,priority:mt,connectionAddress:gn,port:xr,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),gs.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),gs.relPort=this.extract(I,this.consumePort));this.peekChar(I)===g;){this.consumeAttributeSpace(I);const _d=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),gs.extension[_d]=this.extractOneOrMore(I,x)}this.attributes.candidates.push(gs)}parseRemoteCandidate(I){const X=[];for(;;){const te=this.extractOneOrMore(I,_,[1,5]);this.consumeAttributeSpace(I);const Ne=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const mt=this.extract(I,this.consumePort);X.push({componentId:te,connectionAddress:Ne,port:mt});try{this.consumeAttributeSpace(I)}catch{break}}this.attributes.remoteCandidatesList.push(X)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){const X=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const te=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");const Ne={encodingName:te,clockRate:this.extractOneOrMore(I,_)};this.atEnd(I)||this.peekChar(I)!=="/"||(this.extract(I,this.consume,"/"),Ne.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));const mt=this.attributes.payloads.find(gn=>gn.payloadType===parseInt(X,10));mt?mt.rtpMap=Ne:this.attributes.payloads.push({payloadType:parseInt(X,10),rtpMap:Ne,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){const X=this.extractOneOrMore(I,_);this.consumeAttributeSpace(I);const te=this.extract(I,this.consumeTill,":");let Ne;this.peekChar(I)===":"&&(this.extract(I,this.consume,":"),Ne=this.extract(I,this.consumeTill));const mt=this.attributes.ssrcs.find(gn=>gn.ssrcId===parseInt(X,10));mt?mt.attributes[te]=Ne:this.attributes.ssrcs.push({ssrcId:parseInt(X,10),attributes:{[te]:Ne}})}parseFmtp(I){const X=this.extract(I,this.consumeTill,g);this.consumeAttributeSpace(I);const te=this.extract(I,this.consumeTill),Ne={};te.split(";").forEach(gn=>{let[xr,gs]=gn.split("=");xr=xi(xr).call(xr);const _d=typeof gs=="string"?xi(gs).call(gs):null;typeof xr=="string"&&xr.length>0&&(Ne[xr]=_d)});const mt=this.attributes.payloads.find(gn=>gn.payloadType===parseInt(X,10));mt?mt.fmtp={parameters:Ne}:this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[],fmtp:{parameters:Ne}})}parseFmtParameters(I){const X={},te=this.extract(I,this.consumeTill,"=");I._cur++;const Ne=this.extract(I,this.consumeTill,";");for(X[te]=Ne;I.attValue[I._cur]===";";){const mt=this.extract(I,this.consumeTill,"=");I._cur++;const gn=this.extract(I,this.consumeTill,";");X[mt]=gn}return X}parseRtcpFb(I){let X="";X=this.peekChar(I)==="*"?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,g),this.consumeAttributeSpace(I);const te=this.extract(I,this.consumeTill,g);let Ne;if(te==="trr-int")Ne={type:te,interval:this.extract(I,this.consumeTill)};else{const mt={type:te};this.peekChar(I)===g&&(this.consumeAttributeSpace(I),mt.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===g&&(mt.additional=this.extract(I,this.consumeTill))),Ne=mt}if(X==="*")this.attributes.rtcpFeedbackWildcards.push(Ne);else{const mt=this.attributes.payloads.find(gn=>gn.payloadType===parseInt(X,10));mt?mt.rtcpFeedbacks.push(Ne):this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[Ne]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const X={port:this.extract(I,this.consumePort)};this.peekChar(I)===g&&(this.consumeAttributeSpace(I),X.netType=this.extractOneOrMore(I,C),this.consumeAttributeSpace(I),X.addressType=this.extractOneOrMore(I,C),this.consumeAttributeSpace(I),X.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=X}parseMsid(I){const X={id:this.extractOneOrMore(I,C,[1,64])};this.peekChar(I)===g&&(this.consumeAttributeSpace(I),X.appdata=this.extractOneOrMore(I,C,[1,64])),this.attributes.msids.push(X)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){const X=this.extractOneOrMore(I,Ne=>P(Ne)||_(Ne)||Ne==="_"||Ne==="-");this.consumeAttributeSpace(I);const te={id:X,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===g){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");const Ne=[];for(;;){const mt=this.extract(I,this.consumeToken);Ne.push(mt);try{this.extract(I,this.consume,",")}catch{break}}te.payloads=Ne,this.peekChar(I)===g&&this.extract(I,this.consume,g)}for(;;){const Ne=this.extract(I,this.consumeToken);switch(Ne){case"depend":{const mt={type:Ne,rids:this.extract(I,this.consume,"=").split(",")};te.params.push(mt);break}default:{const mt={type:Ne};this.peekChar(I)==="="&&(this.extract(I,this.consume,"="),mt.val=this.extract(I,this.consumeTill,";")),te.params.push(mt)}}try{this.extract(I,this.consume,";")}catch{break}}}this.attributes.rids.push(te)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,_,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){const X=this.extract(I,this.consumeToken),te=[];for(;;)try{this.consumeAttributeSpace(I);const Ne=this.extract(I,this.consumeInteger);te.push(parseInt(Ne,10))}catch{break}this.attributes.ssrcGroups.push({semantic:X,ssrcIds:te})}}function St(_e,I,X){return I in _e?Object.defineProperty(_e,I,{value:X,enumerable:!0,configurable:!0,writable:!0}):_e[I]=X,_e}class yt{constructor(){St(this,"eol",f)}print(I,X){let te="";return X&&(this.eol=X),te+=this.printVersion(I.version),te+=this.printOrigin(I.origin),te+=this.printSessionName(I.sessionName),te+=this.printInformation(I.information),te+=this.printUri(I.uri),te+=this.printEmail(I.emails),te+=this.printPhone(I.phones),te+=this.printConnection(I.connection),te+=this.printBandwidth(I.bandwidths),te+=this.printTimeFields(I.timeFields),te+=this.printKey(I.key),te+=this.printSessionAttributes(I.attributes),te+=this.printMediaDescription(I.mediaDescriptions),te}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let X="";for(const te of I)X+="e=".concat(te).concat(this.eol);return X}printPhone(I){let X="";for(const te of I)X+="e=".concat(te).concat(this.eol);return X}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let X="";for(const te of I)X+="b=".concat(te.bwtype,":").concat(te.bandwidth).concat(this.eol);return X}printTimeFields(I){let X="";for(const te of I){X+="t=".concat(te.time.startTime," ").concat(te.time.startTime).concat(this.eol);for(const Ne of te.repeats)X+="r=".concat(Ne.repeatInterval," ").concat(Ne.typedTimes.join(" ")).concat(this.eol);te.zoneAdjustments&&(X+="z=",X+="z=".concat(te.zoneAdjustments.map(Ne=>"".concat(Ne.time," ").concat(Ne.back?"-":""," ").concat(Ne.typedTime)).join(" ")).concat(this.eol),X+=this.eol)}return X}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let X="";for(const te of I)X+="a=".concat(te.attField).concat(te.attValue?":".concat(te.attValue):"").concat(this.eol);return X}printMediaDescription(I){let X="";for(const te of I)X+=this.printMedia(te.media),X+=this.printInformation(te.information),X+=this.printConnections(te.connections),X+=this.printBandwidth(te.bandwidths),X+=this.printKey(te.key),X+=this.printMediaAttributes(te);return X}printConnections(I){let X="";for(const te of I)X+=this.printConnection(te);return X}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new Cn(this.eol).print(I)}printMediaAttributes(I){return new ve(this.eol).print(I)}}class Yt{constructor(I){St(this,"eol",void 0),this.eol=I}printIceUfrag(I){return I===void 0?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return I===void 0?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return I===void 0?"":"a=ice-options:".concat(I.join(g)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(X=>"a=fingerprint:".concat(X.hashFunction).concat(g).concat(X.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(X=>"a=extmap:".concat(X.entry).concat(X.direction?"/".concat(X.direction):"").concat(g).concat(X.extensionName).concat(X.extensionAttributes?"".concat(g).concat(X.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return I===void 0?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(X=>"a=".concat(X.attField).concat(X.attValue?":".concat(X.attValue):"").concat(this.eol)).join("")}}class Cn extends Yt{print(I){let X="";return X+=this.printGroups(I.groups),X+=this.printMsidSemantic(I.msidSemantic),X+=this.printIceLite(I.iceLite),X+=this.printIceUfrag(I.iceUfrag),X+=this.printIcePwd(I.icePwd),X+=this.printIceOptions(I.iceOptions),X+=this.printFingerprints(I.fingerprints),X+=this.printSetup(I.setup),X+=this.printTlsId(I.tlsId),X+=this.printIdentity(I.identities),X+=this.printExtmap(I.extmaps),X+=this.printUnrecognized(I.unrecognized),X}printGroups(I){let X="";return I.length>0&&(X+=I.map(te=>"a=group:".concat(te.semantic).concat(te.identificationTag.map(Ne=>"".concat(g).concat(Ne)).join("")).concat(this.eol)).join("")),X}printIceLite(I){return I===void 0?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return I.length===0?"":I.map(X=>"a=identity:".concat(X.assertionValue).concat(X.extensions.map(te=>"".concat(g).concat(te.name).concat(te.value?"=".concat(te.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let X="a=msid-semantic:".concat(I.semantic);return I.applyForAll?X+="".concat(g,"*"):I.identifierList.length>0&&(X+=I.identifierList.map(te=>"".concat(g).concat(te))),X+this.eol}}class ve extends Yt{print(I){const X=I.attributes;let te="";return te+=this.printRTCP(X.rtcp),te+=this.printIceUfrag(X.iceUfrag),te+=this.printIcePwd(X.icePwd),te+=this.printIceOptions(X.iceOptions),te+=this.printCandidates(X.candidates),te+=this.printRemoteCandidatesList(X.remoteCandidatesList),te+=this.printEndOfCandidates(X.endOfCandidates),te+=this.printFingerprints(X.fingerprints),te+=this.printSetup(X.setup),te+=this.printMid(X.mid),te+=this.printExtmap(X.extmaps),te+=this.printRTPRelated(X),te+=this.printPtime(X.ptime),te+=this.printMaxPtime(X.maxPtime),te+=this.printDirection(X.direction),te+=this.printSSRCGroups(X.ssrcGroups),te+=this.printSSRC(X.ssrcs),te+=this.printRTCPMux(X.rtcpMux),te+=this.printRTCPMuxOnly(X.rtcpMuxOnly),te+=this.printRTCPRsize(X.rtcpRsize),te+=this.printMSId(X.msids),te+=this.printImageattr(X.imageattr),te+=this.printRid(X.rids),te+=this.printSimulcast(X.simulcast),te+=this.printSCTPPort(X.sctpPort),te+=this.printMaxMessageSize(X.maxMessageSize),te+=this.printUnrecognized(X.unrecognized),te}printCandidates(I){return I.map(X=>"a=candidate:".concat(X.foundation).concat(g).concat(X.componentId).concat(g).concat(X.transport).concat(g).concat(X.priority).concat(g).concat(X.connectionAddress).concat(g).concat(X.port).concat(g,"typ").concat(g).concat(X.type).concat(X.relAddr?"".concat(g,"raddr").concat(g).concat(X.relAddr):"").concat(X.relPort?"".concat(g,"rport").concat(g).concat(X.relPort):"").concat(Object.keys(X.extension).map(te=>"".concat(g).concat(te).concat(g).concat(X.extension[te])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(X=>"a=remote-candidates:".concat(X.join(g)).concat(this.eol)).join("")}printEndOfCandidates(I){return I===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";const X=I.payloads;let te="";te+=I.rtcpFeedbackWildcards.map(Ne=>this.printRTCPFeedback("*",Ne)).join("");for(const Ne of X)te+=this.printRtpMap(Ne.payloadType,Ne.rtpMap),te+=this.printFmtp(Ne.payloadType,Ne.fmtp),te+=Ne.rtcpFeedbacks.map(mt=>this.printRTCPFeedback(Ne.payloadType,mt)).join("");return te}printFmtp(I,X){if(!X)return"";const te=Object.keys(X.parameters);return te.length===1&&X.parameters[te[0]]===null?"a=fmtp:".concat(I).concat(g).concat(te[0]).concat(this.eol):"a=fmtp:".concat(I).concat(g).concat(Object.keys(X.parameters).map(Ne=>"".concat(Ne,"=").concat(X.parameters[Ne])).join(";")).concat(this.eol)}printRtpMap(I,X){return X?"a=rtpmap:".concat(I).concat(g).concat(X.encodingName,"/").concat(X.clockRate).concat(X.encodingParameters?"/".concat(X.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,X){let te="a=rtcp-fb:".concat(I).concat(g),Ne=X;return Ne.type==="trr-int"?te+="ttr-int".concat(g).concat(Ne.interval):(te+="".concat(Ne.type),Ne.parameter&&(te+="".concat(g).concat(Ne.parameter),Ne.additional&&(te+="".concat(g).concat(Ne.additional)))),te+this.eol}printPtime(I){return I===void 0?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return I===void 0?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return I===void 0?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(X=>Object.keys(X.attributes).map(te=>"a=ssrc:".concat(X.ssrcId.toString(10)).concat(g).concat(te).concat(X.attributes[te]?":".concat(X.attributes[te]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return I===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return I===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return I===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(I===void 0)return"";let X="a=rtcp:".concat(I.port);return I.netType&&(X+="".concat(g).concat(I.netType)),I.addressType&&(X+="".concat(g).concat(I.addressType)),I.address&&(X+="".concat(g).concat(I.address)),X+this.eol}printMSId(I){return I.map(X=>"a=msid:".concat(X.id).concat(X.appdata?"".concat(g).concat(X.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(X=>"a=imageattr:".concat(X).concat(this.eol)).join("")}printRid(I){return I.map(X=>{let te="a=rid:".concat(X.id).concat(g).concat(X.direction);return X.payloads&&(te+="".concat(g,"pt=").concat(X.payloads.join(","))),X.params.length>0&&(te+="".concat(g).concat(X.params.map(Ne=>Ne.type==="depend"?"depend=".concat(Ne.rids.join(",")):"".concat(Ne.type,"=").concat(Ne.val)).join(";"))),te+this.eol}).join("")}printSimulcast(I){return I===void 0?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return I===void 0?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return I===void 0?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return I===void 0?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(X=>"a=ssrc-group:".concat(X.semantic).concat(X.ssrcIds.map(te=>"".concat(g).concat(te.toString(10))).join("")).concat(this.eol)).join("")}}function Oe(_e){return new Ee().parse(_e)}function We(_e,I){return new yt().print(_e,I)}}},r={};function i(s){if(r[s])return r[s].exports;var c=r[s]={exports:{}};return t[s](c,c.exports,i),c.exports}return i.d=(s,c)=>{for(var u in c)i.o(c,u)&&!i.o(s,u)&&Object.defineProperty(s,u,{enumerable:!0,get:c[u]})},i.o=(s,c)=>Object.prototype.hasOwnProperty.call(s,c),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i(8)})();function Ti(t){return oV.parse(t)}function rl(t,r){return oV.print(t,r)}var Yme=is("Array","keys"),qme=Hl,Xme=ri,Jme=N,Qme=Yme,lA=Array.prototype,Zme={DOMTokenList:!0,NodeList:!0},ege=function(t){var r=t.keys;return t===lA||Jme(lA,t)&&r===lA.keys||Xme(Zme,qme(t))?Qme:r},si=d(ege);function Ln(t,r,i){return(r=function(s){var c=function(u,h){if(typeof u!="object"||!u)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var g=f.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function cV(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function bt(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?cV(Object(i),!0).forEach(function(s){Ln(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):cV(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function wb(t,r){return wb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},wb(t,r)}function dA(){dA=function(c,u){return new i(c,void 0,u)};var t=RegExp.prototype,r=new WeakMap;function i(c,u,h){var f=RegExp(c,u);return r.set(f,h||r.get(c)),wb(f,i.prototype)}function s(c,u){var h,f=r.get(u);return as(h=Object.keys(f)).call(h,function(g,v){var _=f[v];if(typeof _=="number")g[v]=c[_];else{for(var x=0;c[_[x]]===void 0&&x+1<_.length;)x++;g[v]=c[_[x]]}return g},Object.create(null))}return function(c,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(u&&u.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),u&&wb(c,u)}(i,RegExp),i.prototype.exec=function(c){var u=t.exec.call(this,c);if(u){u.groups=s(u,this);var h=u.indices;h&&(h.groups=s(h,this))}return u},i.prototype[Symbol.replace]=function(c,u){if(typeof u=="string"){var h=r.get(this);return t[Symbol.replace].call(this,c,u.replace(/\$<([^>]+)(>|$)/g,function(g,v,_){if(_==="")return g;var x=h[v];return Array.isArray(x)?"$"+x.join("$"):typeof x=="number"?"$"+x:""}))}if(typeof u=="function"){var f=this;return t[Symbol.replace].call(this,c,function(){var g=arguments;return typeof g[g.length-1]!="object"&&(g=[].slice.call(g)).push(s(g,f)),u.apply(this,g)})}return t[Symbol.replace].call(this,c,u)},dA.apply(this,arguments)}const lV=new class extends An{constructor(){super(...arguments),Ln(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class tge{constructor(r){Ln(this,"logger",void 0),Ln(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function uA(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function dV(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const cs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Tb=Date.now(),Kg=t=>{for(const r in cs)if(Object.prototype.hasOwnProperty.call(cs,r)&&cs[r]===t)return r;return"DEFAULT"},R=new class{constructor(){Ln(this,"proxyServerURL",void 0),Ln(this,"logLevel",cs.DEBUG),Ln(this,"uploadState","collecting"),Ln(this,"uploadLogWaitingList",[]),Ln(this,"uploadLogUploadingList",[]),Ln(this,"uploadErrorCount",0),Ln(this,"currentLogID",0),Ln(this,"url",void 0),Ln(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[cs.DEBUG].concat(r);this.log.apply(this,s)}info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[cs.INFO].concat(r);this.log.apply(this,s)}warning(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[cs.WARNING].concat(r);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[cs.ERROR].concat(r);this.log.apply(this,s)}upload(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[cs.DEBUG].concat(r);this.uploadLog.apply(this,s)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){an("UPLOAD_LOG",!0)}disableLogUpload(){an("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new tge(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-Tb<100)return void setTimeout(()=>{this.log(...r)},Date.now()-Tb);const s=Math.max(0,Math.min(4,r[0]));if(r[0]=uA()+" Agora-SDK [".concat(Kg(s),"]:"),this.appendLogToWaitingList(s,...r),s<this.logLevel)return;const c=uA()+" %cAgora-SDK [".concat(Kg(s),"]:");let u=[];if(!G("USE_NEW_LOG"))switch(s){case cs.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case cs.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case cs.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case cs.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-Tb<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-Tb);const s=Math.max(0,Math.min(4,r[0]));r[0]=uA()+" Agora-SDK [".concat(Kg(s),"]:"),this.appendLogToWaitingList(s,...r)}appendLogToWaitingList(t){if(!G("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];Array.isArray(i[0])?i[0][0]=dV()+" Agora-SDK [".concat(Kg(t),"]:"):i[0]=dV()+" Agora-SDK [".concat(Kg(t),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:os,process_id:G("PROCESS_ID"),payload:JSON.stringify(t)};return Ro(async()=>{const i=await Mi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(G("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(G("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const s=new Error("unexpected upload log response");throw s.response=i,s}},()=>(this.uploadLogUploadingList=[],!1),i=>{const s={status:-1,message:i.message,errorRange:t.map(c=>c.log_item_id)};return i.response?(s.status=i.response.status,s.data=i.response.data,s.headers=i.response.headers):i.request&&(s.status=i.request.status),lV.reportLogUploadError(s),!0},{timeout:G("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:G("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,G("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var uV;function nge(t){return Mr(t.reportId,"params.reportId",0,100,!1),Mr(t.category,"params.category",0,100,!1),Mr(t.event,"params.event",0,100,!1),Mr(t.label,"params.label",0,100,!1),cn(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(uV={}).FREE="free",uV.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const rge={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let sr=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.RTE_DETAIL="rte_detail_stats",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Tn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let ige=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function at(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,s){const c=s.value;if(typeof c=="function"){const u=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);s.value=function(){for(var h,f=arguments.length,g=new Array(f),v=0;v<f;v++)g[v]=arguments[v];let _=g;if(t.argsMap)try{_=t.argsMap(this,...g)}catch(S){R.warning(S),_=[]}try{JSON.stringify(_)}catch{R.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),_=[]}const x=(t.report||$e).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:_,tag:ln.TRACER,reportResult:t.reportResult},t.throttleTime);try{const S=c.apply(this,g);return S instanceof De?S.then(C=>(x.onSuccess(t.reportResult&&C),C)).catch(C=>{throw x.onError(C),C}):(x.onSuccess(t.reportResult&&S),S)}catch(S){throw x.onError(S),S}}}return s}}const $e=new class{constructor(){Ln(this,"baseInfoMap",new Map),Ln(this,"proxyServer",void 0),Ln(this,"eventUploadTimer",void 0),Ln(this,"setSessionIdTimer",void 0),Ln(this,"url",void 0),Ln(this,"sids",new Set),Ln(this,"backupUrl",void 0),Ln(this,"_appId",void 0),Ln(this,"_aid",0),Ln(this,"keyEventUploadPendingItems",[]),Ln(this,"normalEventUploadPendingItems",[]),Ln(this,"apiInvokeUploadPendingItems",[]),Ln(this,"apiInvokeCount",0),Ln(this,"apiInvokeLoggedCount",0),Ln(this,"ltsList",[]),Ln(this,"lastSendNormalEventTime",Date.now()),Ln(this,"customReportCounterTimer",void 0),Ln(this,"customReportCount",0),Ln(this,"extApiInvoke",async t=>{for(const r of t){const i=bt(bt({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:ln.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),G("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),G("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,s]=r;return i+s}),16)||0}reportApiInvoke(t,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const s=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!G("SHOW_REPORT_INVOKER_LOG"),h=!!G("SHOW_REPORT_USER_INVOKER_LOG"),f=u||h&&r.id;f&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function v(C,U){if(f){let P="[apiInvoke-".concat(g,"]");if(r.id&&(P+="[".concat(r.id,"]")),r.name&&(P+="[".concat(r.name,"]"),r.name===wn.JOIN))return R.info("".concat(P," ").concat(C));R.info("".concat(P," ").concat(C),C==="start"?r.options:U||"")}}const _=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:s,options:r.options,states:r.states||null});v("start");let x=!1;yr(r.timeout).then(()=>{x||(this.sendApiInvoke(bt(bt({},_()),{},{error:$.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const S=new pe($.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:C=>{const U=()=>{if(x)throw S;return x=!0,this.sendApiInvoke(bt(bt({},_()),{},{success:!0},r.reportResult&&{result:C})),v("onSuccess"),C};return i?HF(U,r.name+"Success",i,()=>x=!0):U()},onError:C=>{const U=()=>{if(x)throw C;x=!0,this.sendApiInvoke(bt(bt({},_()),{},{success:!1,error:C})),v("onFailure",C.toString())};return i?HF(U,r.name+"Error",i,()=>x=!0):U()}}}_send(t,r,i){this.send({type:t,data:r},i)}_sendApiInvoke(t){return this.sendApiInvoke(t)}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const i=Date.now(),s=this.createBaseInfo(t,i);s.cname=r.cname,s.rteUrl=r.rteUrl;const c=Object.assign({},{willUploadConsoleLog:G("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:aA?"global":"oversea",areas:G("AREAS")&&G("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:f,isABTestSuccess:g,lsid:v,clientRole:_}=r,x=Date.now(),S=bt(bt({},s),{},{eventType:sr.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:oA,lts:x,elapse:x-i,extend:JSON.stringify(c),mode:r.mode,process:G("PROCESS_ID"),appType:G("APP_TYPE"),success:!0,version:os,stringUid:u,channelProfile:h,channelMode:f,isABTestSuccess:g,lsid:v,clientType:Te(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:_,serviceId:G("PROCESS_ID"),extensionID:G("PLUGIN_INFO").join(",")||"",rteUrl:r.rteUrl,rteSid:r.rteSid});var C;this.send({type:Tn.SESSION,data:S},!0)}reportRteDetail(t){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,s=Date.now(),c=bt(bt({},i),{},{eventType:sr.RTE_DETAIL,lts:s,success:!0,elapse:s-r.startTime,vid:i.vid===void 0?0:Number(i.vid),ua:navigator.userAgent});this.send({type:Tn.RTE_DETAIL,data:c},!0)}joinChooseServer(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid);const c=Date.now(),u=bt(bt({},s),{},{role:r.role,eventType:sr.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:Tn.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt({},s),{},{eventType:sr.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Tn.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid),s.uid=r.uid,s.cid=r.cid;const c=Date.now(),{firstSuccess:u,addr:h,isProxy:f}=r,g=c-i.startTime,v=bt(bt({},s),{},{eventType:sr.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:iA(),isABTestSuccess:r.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:f?1:0}),_=v.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),h)if(v.signalChannel==="1"){const x=dA(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),S=h.match(x);v.gatewayIp=S&&S.groups?S.groups.ip:"",v.gatewayPort=S&&S.groups?S.groups.port:""}else if(f){const x=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),S=h.match(/p=[0-9]{1,6}/g);v.gatewayIp=x&&x.length?x[0].split("=")[1].replace(/-/g,"."):"",v.gatewayPort=S&&S.length?S[0].split("=")[1]:""}else{const x=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),S=h.match(/(:|p=)[0-9]{1,6}/g);v.gatewayIp=x&&x.length?x[0].split("//")[1].replace(/-/g,"."):"",v.gatewayPort=S&&S.length?S[0].split(/:|p=/g)[1]:""}if(u)this.send({type:Tn.JOIN_GATEWAY,data:v},!0);else{let x={isSuccess:_,port:v.gatewayPort};delete v.success,delete v.eventType,delete v.firstSuccess,delete v.gatewayPort,v.vid=Number(v.vid);const S=Object.assign({},v,x,{eventType:sr.REJOIN_GATEWAY});this.send({type:Tn.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=Date.now(),c=bt(bt({},i.info),{},{lts:s,timeout:r,elapse:s-i.startTime});this.send({type:Tn.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt({},s),{},{eventType:sr.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Tn.PUBLISH,data:u},!0)}subscribe(t,r,i){const s=this.baseInfoMap.get(t);if(!s)return;const c=s.info,u=Date.now(),h=bt(bt({},c),{},{eventType:sr.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-s.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Tn.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const i=[...si(r=this.baseInfoMap).call(r)],s=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;const u=c.info,h=Date.now(),f=bt(bt({},u),{},{eventType:sr.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Tn.WS_COMPRESSOR_INIT,data:f},!0)}firstXLAPeerFirstVideoFrame(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=r.peerPubStatusMs-(i.lastJoinSuccessTime||c),h=bt(bt({},s),{},{elapse:c-i.startTime,eventType:sr.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:u,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>u?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0,firstReceivedEncodedFrame:r.firstReceivedEncodedFrame?Math.max(r.firstReceivedEncodedFrame-r.joinChannelStart,0):void 0,frameType:r.frameType||"",rtpTimestamp:r.rtpTimestamp||0,framePayloadType:r.framePayloadType||0,frameDataLength:r.frameDataLength||0,mimeType:r.mimeType||""});this.send({type:Tn.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),f=bt(bt(bt({},u),s),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((s.firstFrame||h)-c.startTime,0),apEnd:Math.max(s.apEnd-c.startTime,0),apStart:Math.max(s.apStart-c.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-c.startTime,0),joinGwStart:Math.max(s.joinGwStart-c.startTime,0),pcEnd:Math.max(s.pcEnd-c.startTime,0),pcStart:Math.max(s.pcStart-c.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-c.startTime,0),subscriberStart:Math.max(s.subscriberStart-c.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-c.startTime,0)});this.send({type:i,data:f},!0)}firstRemoteFrame(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),f=bt(bt(bt({},u),s),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:i,data:f},!0)}abTest(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt(bt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:sr.AB_TEST,lts:c});this.send({type:Tn.AB_TEST,data:u},!0)}pcStats(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt(bt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:sr.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Tn.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,r){if(t){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt(bt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:sr.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Tn.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),f=bt(bt(bt({},u),s),{},{eventType:r,lts:h});this.send({type:i,data:f},!0)}streamSwitch(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt({},s),{},{eventType:sr.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:Tn.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt({},s),{},{eventType:sr.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Tn.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt({},s),{},{eventType:sr.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Tn.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?R.debug("reportProxyServerurl: ".concat(t)):R.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt({},s),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Tn.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now();(function(u,h,f){const g=u[h];if(!g||typeof g!="string")return[u];u[h]="";const v=gc(JSON.stringify(u));let _=0;const x=[];let S=0;for(let C=0;C<g.length;C++)S+=g.charCodeAt(C)<=127?1:3,S<=f-v||(x[x.length]=Ie(Ie({},u),{},{[h]:g.substring(_,C)}),_=C,S=g.charCodeAt(C)<=127?1:3);return _!==g.length-1&&(x[x.length]=Ie(Ie({},u),{},{[h]:g.substring(_)})),x})(bt(bt(bt({},s),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Tn.WORKER_EVENT,data:u},!0))}apworkerEvent(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt(bt({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:Tn.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt(bt({},s),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:Tn.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=bt(bt(bt({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:Tn.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>G("CUSTOM_REPORT_LIMIT"))throw new pe($.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=r.map(c=>({type:Tn.USER_ANALYTICS,data:bt(bt({sid:t},c),{},{lts:i})}));try{G("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(c){throw R.error("send custom report message failed",c.toString()),new pe($.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=G("NOT_REPORT_EVENT");if(t.tag&&Te(r)&&Te(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:s,uid:c,cid:u}=i.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof pe){const{code:g,message:v}=t.error;h=g||v||t.error.toString()}else h=t.error.toString();const f={invokeId:t.invokeId,sid:t.sid,cname:s,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Tn.API_INVOKE,data:f},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&t.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const i=[],s=[];for(;t.length;){const u=t.shift();i.length<20?i.push(u):s.push(u)}t.push(...s);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),fu(c=this.ltsList).call(c,(h,f)=>h-f))}return r||(this.lastSendNormalEventTime=Date.now()),G("ENABLE_EVENT_REPORT")&&i.length&&(G("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{G("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-G("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){jn.networkState===wi.OFFLINE&&await De.race([jn.onlineWaiter,yr(2*Yn.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const f=$R(JSON.stringify(h.data)),g=new ArrayBuffer(5),v=(x=>{let S=0;return Object.entries(Tn).forEach(C=>{let[U,P]=C;P===x.type&&(S=ige[U])}),S})(h),_=new DataView(g);_.setUint16(0,f.byteLength,!0),_.setUint8(2,255&v),_.setUint8(3,v>>>8&255),_.setUint8(4,v>>>16&255),u=jF(u,new Uint8Array(g)),u=jF(u,f)}),u},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await eA(s,{timeout:1e4,data:r(t),headers:bt(bt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(f=>{const g=f&&f.data.sid&&this.baseInfoMap.get(f.data.sid);return g&&g.info.vid&&+g.info.vid||0})(t[0]),s=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(f=>JSON.stringify(f)),vid:i,aid:s};jn.networkState===wi.OFFLINE&&await De.race([jn.onlineWaiter,yr(2*Yn.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(G("EVENT_REPORT_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(u));for(let f=0;f<2;f+=1){f===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(G("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(u)));try{r?await Wme(h,{timeout:1e4,data:c}):await eA(h,{timeout:1e4,data:c})}catch(g){if(f===1)throw g;continue}return}}createBaseInfo(t,r){const i=Object.assign({},rge);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:r}),i}reportResourceTiming(t,r){const i=performance.getEntriesByName(t),s=i[i.length-1];s&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:s,tag:ln.TRACER}).onSuccess()}};lV.on("REPORT_LOG_UPLOAD",t=>{t.networkState=jn.networkState,$e.reportApiInvoke(null,{name:"logUploadError",options:t,tag:ln.TRACER}).onSuccess("logUploadError")});let ce=class extends pe{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ln(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}};const _r={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function It(){return _r}function hV(){return"setSinkId"in HTMLAudioElement.prototype&&(!G("RESTRICTION_SET_PLAYBACK_DEVICE")||(tl()||bF())&&!AF())}function Cb(){return!_r.supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&mc()}function Yg(t){return!(bn()||EF(87)||Cb()||!G("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}function pV(t){return G("ENABLE_INSTANT_VIDEO")?G("ENABLE_INSTANT_VIDEO"):!(t==null||!t.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB"))}function fV(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function mV(){if(fV()){const t=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in t)||!t.suppressLocalAudioPlayback)}return No(141)||ed(141)||Su(141)}function gV(){if(fV()){const t=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in t)||!t.restrictOwnAudio)}return No(141)||ed(141)||Su(125)}let Ur=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Up(t,r,i){return{sampleRate:t,stereo:r,bitrate:i}}function Gt(t,r,i,s,c){return{width:t,height:r,frameRate:i,bitrateMin:s,bitrateMax:c}}function Bs(t,r,i,s,c){return{width:{max:t},height:{max:r},frameRate:i,bitrateMin:s,bitrateMax:c}}function hA(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const age={"90p":Gt(160,90),"90p_1":Gt(160,90),"120p":Gt(160,120,15,30,65),"120p_1":Gt(160,120,15,30,65),"120p_3":Gt(120,120,15,30,50),"120p_4":Gt(212,120),"180p":Gt(320,180,15,30,140),"180p_1":Gt(320,180,15,30,140),"180p_3":Gt(180,180,15,30,100),"180p_4":Gt(240,180,15,30,120),"240p":Gt(320,240,15,40,200),"240p_1":Gt(320,240,15,40,200),"240p_3":Gt(240,240,15,40,140),"240p_4":Gt(424,240,15,40,220),"360p":Gt(640,360,15,80,400),"360p_1":Gt(640,360,15,80,400),"360p_3":Gt(360,360,15,80,260),"360p_4":Gt(640,360,30,80,600),"360p_6":Gt(360,360,30,80,400),"360p_7":Gt(480,360,15,80,320),"360p_8":Gt(480,360,30,80,490),"360p_9":Gt(640,360,15,80,800),"360p_10":Gt(640,360,24,80,800),"360p_11":Gt(640,360,24,80,1e3),"480p":Gt(640,480,15,100,500),"480p_1":Gt(640,480,15,100,500),"480p_2":Gt(640,480,30,100,1e3),"480p_3":Gt(480,480,15,100,400),"480p_4":Gt(640,480,30,100,750),"480p_6":Gt(480,480,30,100,600),"480p_8":Gt(848,480,15,100,610),"480p_9":Gt(848,480,30,100,930),"480p_10":Gt(640,480,10,100,400),"720p":Gt(1280,720,15,120,1130),"720p_auto":Gt(1280,720,30,900,3e3),"720p_1":Gt(1280,720,15,120,1130),"720p_2":Gt(1280,720,30,120,2e3),"720p_3":Gt(1280,720,30,120,1710),"720p_5":Gt(960,720,15,120,910),"720p_6":Gt(960,720,30,120,1380),"1080p":Gt(1920,1080,15,120,2080),"1080p_1":Gt(1920,1080,15,120,2080),"1080p_2":Gt(1920,1080,30,120,3e3),"1080p_3":Gt(1920,1080,30,120,3150),"1080p_5":Gt(1920,1080,60,120,4780),"1440p":Gt(2560,1440,30,120,4850),"1440p_1":Gt(2560,1440,30,120,4850),"1440p_2":Gt(2560,1440,60,120,7350),"4k":Gt(3840,2160,30,120,8910),"4k_1":Gt(3840,2160,30,120,8910),"4k_3":Gt(3840,2160,60,120,13500)},sge={"480p":Bs(640,480,5),"480p_1":Bs(640,480,5),"480p_2":Bs(640,480,30),"480p_3":Bs(640,480,15),"720p":Bs(1280,720,5),"720p_auto":Gt(1280,720,30,900,3e3),"720p_1":Bs(1280,720,5),"720p_2":Bs(1280,720,30),"720p_3":Bs(1280,720,15),"1080p":Bs(1920,1080,5),"1080p_1":Bs(1920,1080,5),"1080p_2":Bs(1920,1080,30),"1080p_3":Bs(1920,1080,15)},oge={"1SL1TL":hA(1,1),"3SL3TL":hA(3,3),"2SL3TL":hA(2,3)};function Gs(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},age[t]):t}function pA(t){return typeof t=="string"?Object.assign({},sge[t]):t}function Nb(t){return typeof t=="string"?Object.assign({},oge[t]):t}const cge={speech_low_quality:Up(16e3,!1),speech_standard:Up(32e3,!1,18),music_standard:Up(48e3,!1),standard_stereo:Up(48e3,!0,56),high_quality:Up(48e3,!1,128),high_quality_stereo:Up(48e3,!0,192)};function Rb(t){return typeof t=="string"?Object.assign({},cge[t]):t}const Pu=[];function vV(t){return Kn(t,"mediaSource",["screen","window","application"]),!0}let He=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Jt=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Fp=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),lge=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),dge=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),Du=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Vp=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),ls=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),Bp=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Ua=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const fA={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},mA={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},yV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},uge={uplinkNetworkQuality:0,downlinkNetworkQuality:0},_V={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ci=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Fa=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),qg=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),ku=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Jr=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),vc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const gA={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Ab=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Mt(t,r,i,s,c){var u,h,f={};return Object.keys(s).forEach(function(g){f[g]=s[g]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=as(u=Kj(h=i.slice()).call(h)).call(u,function(g,v){return v(t,r,g)||g},f),c&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(c):void 0,f.initializer=void 0),f.initializer===void 0?(Object.defineProperty(t,r,f),null):f}function le(t,r,i){return(r=function(s){var c=function(u,h){if(typeof u!="object"||!u)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var g=f.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function bV(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function yn(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?bV(Object(i),!0).forEach(function(s){le(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):bV(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class EV extends An{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(Du.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),le(this,"trackMediaType",void 0),le(this,"_ID",void 0),le(this,"_rtpTransceiver",void 0),le(this,"_lowRtpTransceiver",void 0),le(this,"_hints",[]),le(this,"_isClosed",!1),le(this,"_originMediaStreamTrack",void 0),le(this,"mediaStreamTrack",void 0),le(this,"_external",{}),this._ID=i||Zt(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(s){Te(Pu).call(Pu,s)||Pu.push(s)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||td(()=>{var i;$e.reportApiInvoke(null,{name:wn.GET_MEDIA_STREAM_TRACK,options:[],tag:ln.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Fp.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=Pu.indexOf(r);i!==-1&&Pu.splice(i,1)}(this),this.emit(Vp.CLOSED),this.removeAllListeners(Du.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Fp.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(Du.TRANSCEIVER_UPDATED,r,i)}}class Gp extends EV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),le(this,"_enabled",!0),le(this,"_muted",!1),le(this,"_isExternalTrack",!1),le(this,"_isClosed",!1),le(this,"_enabledMutex",void 0),le(this,"processor",void 0),le(this,"_processorContext",void 0),le(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Rr("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(He.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vp.TRACK_ENDED)}stateCheck(r,i){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),Us(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new pe($.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new pe($.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():De.resolve([])}}const xV=window.AudioContext||window.webkitAudioContext;let vA,Va=null;const sn=new class extends An{constructor(){super(...arguments),le(this,"prevState",void 0),le(this,"curState",void 0),le(this,"currentTime",void 0),le(this,"currentTimeStuckAt",void 0),le(this,"interruptDetectorTrack",void 0),le(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Ur.IOS_15_16_INTERRUPTION_START)}),le(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Va&&await Va.suspend(),this.emit(Ur.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){R.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){R.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Wp(){if(!Va){if(function(){if(!xV)return void R.error("your browser is not support web audio");R.info("create audio context");const t=yn({},G("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(t)),Va=new xV(t),sn.curState=Va.state,Va.onstatechange=()=>{sn.prevState=sn.curState,sn.curState=Va?Va.state:void 0;const{prevState:r,curState:i}=sn,s=i==="running",c=i==="interrupted",u=r==="running",h=r==="suspended",f=r==="interrupted",g=Bt().osVersion;(ai()||Ms())&&u&&c&&(R.info("ios".concat(g,"-interruption-start")),sn.emit(Ur.IOS_INTERRUPTION_START)),(ai()||Ms())&&(h||f)&&s&&(R.info("ios".concat(g,"-interruption-end")),sn.emit(Ur.IOS_INTERRUPTION_END)),r!==i&&sn.emit(Ur.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Va)===null||r===void 0?void 0:r.currentTime;sn.currentTime!==i?(sn.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(i)),sn.currentTimeStuckAt=void 0),sn.currentTime=i):(i!==sn.currentTimeStuckAt&&($e.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:ln.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(i))),sn.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,c,u=!1,h=!1,f=!1;function g(W){r.state==="running"?v(!1):ai()||Ms()?r.state==="suspended"&&(v(!0),W&&r.resume().then(_,_)):r.state!=="closed"&&(v(!0),W&&r.resume().then(_,_))}function v(W){if(u!==W){u=W;for(let K=0,J=i;K<J.length;K+=1){const re=J[K];W?window.addEventListener(re,x,{capture:!0,passive:!0}):window.removeEventListener(re,x,{capture:!0,passive:!0})}}}function _(){g(!1)}function x(){g(!0)}function S(){let W;try{W=s.play(),W?W.then(P,P):(s.addEventListener("playing",P),s.addEventListener("abort",P),s.addEventListener("error",P))}catch{P()}}function C(W){f||(s.paused?W?(U(!1),f=!0,S()):U(!0):U(!1))}function U(W){if(h!==W){h=W;for(let K=0,J=i;K<J.length;K++){const re=J[K];W?window.addEventListener(re,j,{capture:!0,passive:!0}):window.removeEventListener(re,j,{capture:!0,passive:!0})}}}function P(){s.removeEventListener("playing",P),s.removeEventListener("abort",P),s.removeEventListener("error",P),f=!1,C(!1)}function j(){C(!0)}if(ai()&&G("IOS_BG_TAG")){const W=r.createMediaStreamDestination(),K=document.createElement("div");K.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=K.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=W.stream,c=()=>{if(G("IOS_AUTO_RESTART_BG_TAG")&&s&&s.srcObject&&!f&&(!s.paused||h!==!0)){s.paused||s.pause();try{f=!0,S()}catch{f=!1}return!0}},C(!0)}return sn.on(Ur.STATE_CHANGE,function(){g(!0)}),g(!1),c}(Va).then(r=>{vA=r})}(),!Va)throw new pe($.NOT_SUPPORTED,"can not create audio context");return Va}return Va}function ju(t){if(function(){if(yA!==null)return yA;const s=Wp(),c=s.createBufferSource(),u=s.createGain(),h=s.createGain();c.connect(u),c.connect(h),c.disconnect(u);let f=!1;try{c.disconnect(u)}catch{f=!0}return c.disconnect(),yA=f,f}())return;const r=t.connect,i=t.disconnect;t.connect=(s,c,u)=>{var h;return t._inputNodes||(t._inputNodes=[]),Te(h=t._inputNodes).call(h,s)||(s instanceof AudioNode?(t._inputNodes.push(s),r.call(t,s,c,u)):r.call(t,s,c)),t},t.disconnect=(s,c,u)=>{i.call(t),s?gb(t._inputNodes,s):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let yA=null;function _A(t,r){let i=!1;const s=1/r;if(G("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):t(performance.now()/1e3)},1e3*s)}else{const c=Wp();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const f=c.createOscillator();f.onended=h,f.connect(u),f.start(0),f.stop(c.currentTime+s),t(c.currentTime)};h()}return()=>{i=!0}}class SV{constructor(){le(this,"context",void 0),le(this,"analyserNode",void 0),le(this,"sourceNode",void 0),this.context=Wp(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ai()||Ms()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<r.length;++c)r[c]=s[c]/128-1}const i=as(r).call(r,(s,c)=>s+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class wV extends An{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),le(this,"outputNode",void 0),le(this,"outputTrack",void 0),le(this,"isPlayed",!1),le(this,"sourceNode",void 0),le(this,"context",void 0),le(this,"audioBufferNode",void 0),le(this,"destNode",void 0),le(this,"audioOutputLevel",0),le(this,"volumeLevelAnalyser",void 0),le(this,"_processedNode",void 0),le(this,"playNode",void 0),le(this,"isDestroyed",!1),le(this,"onNoAudioInput",void 0),le(this,"isNoAudioInput",!1),le(this,"_noAudioInputCount",0),this.context=Wp(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ju(this.outputNode),this.volumeLevelAnalyser=new SV}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Ua.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const u=s.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return s.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!It().webAudioMediaStreamDest)throw new pe($.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&vb(()=>{sn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ai()||Ms()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let s;i.getFloatTimeDomainData?(s=new Float32Array(i.fftSize),i.getFloatTimeDomainData(s)):(s=new Uint8Array(i.fftSize),i.getByteTimeDomainData(s));let c=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await yr(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bA extends wV{get isFreeze(){return!1}constructor(r,i,s){var c;if(super(),le(this,"sourceNode",void 0),le(this,"track",void 0),le(this,"clonedTrack",void 0),le(this,"audioElement",void 0),le(this,"isCurrentTrackCloned",!1),le(this,"isRemoteTrack",!1),le(this,"originVolumeLevelAnalyser",void 0),le(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const f=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?f.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),ju(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),ju(this.outputNode),this.emit(Ua.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new pe($.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),ju(this.sourceNode),s){const f=s.clone();f.enabled=!0,this.clonedTrack=f,R.debug("create an unmuted track ".concat(f.id," from the original track ").concat(s.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([f]));ju(g),this.originVolumeLevelAnalyser=new SV,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Bt();i&&h.os===vr.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(sn.on(Ur.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(f=>{f||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),ju(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ua.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),sn.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),R.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([i]));ju(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function TV(t,r,i){const s=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:s(r.height,1080),maxWidth:s(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function hge(t,r){const i=await CV(t.mediaSource),{sourceId:s,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new De((f,g)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const x=document.createElement("div");x.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",x.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const U=document.createElement("button");U.innerHTML="cancel",U.setAttribute("style","width: 85px;"),U.onclick=()=>{document.body.removeChild(W);const K=new Error("NotAllowedError");K.name="NotAllowedError",g(K)};let P=h;const j=document.createElement("div");if(h){const K=document.createElement("input");K.setAttribute("type","checkbox");const J=document.createElement("span");K.setAttribute("style","margin-right: 6px;"),J.innerText="Share audio",K.checked=P,K.onchange=()=>{P=K.checked},j.appendChild(K),j.appendChild(J)}C.appendChild(j),C.appendChild(U),_.appendChild(x),_.appendChild(S),_.appendChild(C);const W=document.createElement("div");W.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),W.appendChild(v),W.appendChild(_),document.body.appendChild(W),u.map(K=>{if(K.id){const J=document.createElement("div");J.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let re=K.thumbnail;try{const{width:ie}=re.getSize();ie>1920&&(re=re.resize({width:1920}))}catch(ie){throw ie&&ie.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ie}J.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+re.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+K.name.replace(/[\u00A0-\u9999<>\&]/g,function(ie){return"&#"+ie.charCodeAt(0)+";"})+"</span>",J.onclick=()=>{document.body.removeChild(W),f({sourceId:K.id,audio:P})},S.appendChild(J)}})})}(i,r);return await TV(s,t,c)}async function CV(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const i=LF();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new pe($.ELECTRON_IS_NULL);let s=null;try{var c;s=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{s=null}s&&s.then||(s=new De((u,h)=>{i.desktopCapturer.getSources({types:r},(f,g)=>{f?h(f):u(g)})}));try{return await s}catch(u){throw new pe($.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const EA=new Rr("safari");let NV=!1,RV=!1;async function Ba(t,r){let i=0,s=null;for(;i<2;)try{s=await pge(t,r,i>0);break}catch(c){if(c instanceof pe)throw R.error("[".concat(r,"] ").concat(c.toString())),c;const u=Ib(c.name||c.code||c,c.message);if(u.code===$.MEDIA_OPTION_INVALID){R.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await yr(500);continue}throw R.error("[".concat(r,"] ").concat(u.toString())),u}if(!s)throw new pe($.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function pge(t,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new pe($.NOT_SUPPORTED,"can not find getUserMedia");i&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const s=It(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return R.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(LF())t.screen.sourceId?$p(c,await TV(t.screen.sourceId,t.screen,!!t.screenAudio)):$p(c,await hge(t.screen,!!t.screenAudio));else if(tl()&&t.screen.extensionId&&t.screen.mandatory){if(!s.getStreamFromExtension)throw new pe($.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const S=await(h=t.screen.extensionId,f=r,new De((C,U)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},P=>{if(!P||!P.streamId)return R.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),P),void U(new pe($.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(P.streamId)})}catch(P){R.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),P.toString()),U(new pe($.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=S,$p(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(s.getDisplayMedia){var u;t.screen.mediaSource&&vV(t.screen.mediaSource);const S={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(u=t.screen.displaySurface)!==null&&u!==void 0?u:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:U,systemAudio:P,preferCurrentTab:j,windowAudio:W,monitorTypeSurfaces:K}=t.screen,J={selfBrowserSurface:C,surfaceSwitching:U,systemAudio:P,preferCurrentTab:j,windowAudio:W,monitorTypeSurfaces:K};!C&&delete J.selfBrowserSurface,!U&&delete J.surfaceSwitching,!P&&delete J.systemAudio,!j&&delete J.preferCurrentTab,!W&&delete J.windowAudio,!K&&delete J.monitorTypeSurfaces,R.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:S,audio:t.screenAudio,controls:J})),$p(c,await navigator.mediaDevices.getDisplayMedia(yn({video:S,audio:t.screenAudio},J)))}else{if(!bn())throw R.error("[".concat(r,"] This browser does not support screenSharing")),new pe($.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&vV(t.screen.mediaSource);const S={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};R.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(S))),$p(c,await navigator.mediaDevices.getUserMedia(S))}}var h,f;if(!t.video&&!t.audio)return c;let g={video:t.video,audio:t.audio},v=G("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),g=qR(g,v)}catch{}R.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),Bt();let _,x=null;(Nr()||ai()||mb())&&(x=await EA.lock());try{_=await navigator.mediaDevices.getUserMedia(g)}catch(S){throw x&&x(),S}return g.audio&&(NV=!0),g.video&&(RV=!0),$p(c,_),x&&x(),c}function Ib(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new pe($.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new pe($.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new pe($.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new pe($.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new pe($.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new pe($.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return R.error("getUserMedia unexpected error",t),new pe($.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function $p(t,r){const i=t.getVideoTracks()[0],s=t.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(s&&t.removeTrack(s),t.addTrack(u)),c&&(i&&t.removeTrack(i),t.addTrack(c))}const Ga=new class extends An{get state(){return this._state}set state(t){t!==this._state&&(this.emit(ku.STATE_CHANGE,t),this._state=t)}constructor(){super(),le(this,"_state",qg.IDLE),le(this,"isAccessMicrophonePermission",!1),le(this,"isAccessCameraPermission",!1),le(this,"lastAccessMicrophonePermission",!1),le(this,"lastAccessCameraPermission",!1),le(this,"checkdeviceMatched",!1),le(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(G("ENUMERATE_DEVICES_INTERVAL")||(Vg()||fb()===vr.HARMONY_OS)&&mc())&&this.updateDevicesInfo()},G("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>R.error(t.toString()))}async enumerateDevices(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new pe($.NOT_SUPPORTED,"enumerateDevices() not supported.");const s=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(s);let u=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let f=null,g=null,v=null;if(!i&&(u||h)){if(EA.isLocked&&(R.debug("[device manager] wait GUM lock"),(await EA.lock())(),R.debug("[device manager] GUM unlock")),NV&&(u=!1,this.isAccessMicrophonePermission=!0),RV&&(h=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",t,r,u,h),u&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const x=Ib(_.name||_.code||_,_.message);if(x.code===$.PERMISSION_DENIED)throw x;R.warning("getUserMedia failed in getDevices",x)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{f=await navigator.mediaDevices.getUserMedia({audio:t})}catch(_){const x=Ib(_.name||_.code||_,_.message);if(x.code===$.PERMISSION_DENIED)throw x;R.warning("getUserMedia failed in getDevices",x)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(_){const x=Ib(_.name||_.code||_,_.message);if(x.code===$.PERMISSION_DENIED)throw x;R.warning("getUserMedia failed in getDevices",x)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",t,"cam permission",r)}try{const _=await navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(x=>x.stop()),g&&g.getTracks().forEach(x=>x.stop()),v&&v.getTracks().forEach(x=>x.stop()),f=null,g=null,v=null,_}catch(_){return f&&f.getTracks().forEach(x=>x.stop()),g&&g.getTracks().forEach(x=>x.stop()),v&&v.getTracks().forEach(x=>x.stop()),f=null,g=null,v=null,new pe($.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===t&&(r=i.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===t);if(!r)throw new pe($.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=qg.INITING;try{await this.updateDevicesInfo(),this.state=qg.INITEND}catch(t){throw this.state=qg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(R.warning("Device Detection functionality cannot start properly.",t.toString()),t):new pe($.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?R.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):R.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):R.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==qg.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ku.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ku.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ku.PLAYOUT_DEVICE_CHANGED,c)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),i=t.filter(c=>c.kind==="videoinput"),s={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};let xA=!1;const Fi=new class extends An{constructor(){super(...arguments),le(this,"onAutoplayFailed",void 0),le(this,"onAudioAutoplayFailed",void 0)}};function AV(){if(xA)return G("FLS_AUTOPLAY_EMITS")?(Fi.onAutoplayFailed&&Fi.onAutoplayFailed(),Fi.emit("autoplay-failed")):void 0;{const t=r=>{r.preventDefault(),xA=!1,Bg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};xA=!0,Bg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Fi.onAutoplayFailed?Fi.onAutoplayFailed():Fi.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Fi.emit("autoplay-failed")}}function IV(t,r,i,s){if(!t)return;const c=$e.getBaseInfoBySessionId(t);if(!c)return;const u=c.info,h=Date.now(),f=yn(yn({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Fi.onAutoplayFailed||Fi.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:s,extend:void 0});$e.send({type:Tn.AUTOPLAY_FAILED,data:f},!0)}const fge=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],hi=new class{constructor(){le(this,"onAutoplayFailed",void 0),le(this,"elementMap",new Map),le(this,"elementStateMap",new Map),le(this,"elementsNeedToResume",[]),le(this,"sinkIdMap",new Map),le(this,"autoResumeAfterInterruption",t=>De.all(Array.from(this.elementMap.entries()).map(async r=>{let[i,s]=r;const c=this.elementStateMap.get(i),u=s.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(R.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return s.pause(),s.play();if(sn.curState==="running")return Ip()?(s.pause(),s.play()):c&&c==="paused"?s.play():void 0}}))),le(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t;const s=i.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),sn.on(Ur.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sn.on(Ur.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),sn.on(Ur.STATE_CHANGE,()=>{ai()&&sn.prevState==="suspended"&&sn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const i=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),i)try{await i.setSinkId(r)}catch(s){throw new pe($.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(t,r,i,s){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,Jr.INIT),this.setVolume(r,i);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(f=>{R.warning("[".concat(r,"] set sink id failed"),f.toString())})}catch(f){R.warning("[".concat(r,"] set sink id failed"),f.toString())}const h=c.play();h&&h.then&&h.catch(f=>{s&&IV(s,"audio",f.message,r),R.warning("audio element play warning",f.toString()),this.elementMap.has(r)&&f.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),vb(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),AV()}))})}updateTrack(t,r){const i=this.elementMap.get(t);i&&(i.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const i=this.elementMap.get(t);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}getVolume(t){const r=this.elementMap.get(t);return r?r.volume:0}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){fge.forEach(i=>{r.addEventListener(i,s=>{const c=this.elementStateMap.get(t),u=s.type==="pause"?"paused":s.type;if(R.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(u)),s.type==="error"){const h=r==null?void 0:r.error;h&&R.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,u)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{R.debug("Auto resume audio element success")}).catch(i=>{R.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new De(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{Bg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Fn(){return function(t,r,i){const s=i.value;return typeof s=="function"&&(i.value=function(){this._isClosed&&new pe($.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const f=s.apply(this,u);return f instanceof De?new De((g,v)=>{f.then(g).catch(v)}):f}),i}}class OV extends An{constructor(r){super(),le(this,"name","VideoProcessorDestination"),le(this,"ID","0"),le(this,"_source",void 0),le(this,"videoContext",void 0),le(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new pe($.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new pe($.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Ci.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ci.ON_TRACK,void 0)}}class PV extends An{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),le(this,"constraintsMap",new Map),le(this,"statsRegistry",[]),le(this,"usageRegistry",[]),le(this,"trackId",void 0),le(this,"direction",void 0),le(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await er(this,Fa.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var s;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),fn(this,Fa.REQUEST_UPDATE_CONSTRAINTS,Array.from(ya(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return R.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),fn(this,Fa.REQUEST_UPDATE_CONSTRAINTS,Array.from(ya(i=this.constraintsMap).call(i)))}registerStats(r,i,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){R.error(new pe($.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof De&&(s=await s),r.push(yn(yn({},s),{},{direction:this.direction}))}catch(s){R.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class DV extends An{constructor(r){super(),le(this,"name","AudioProcessorDestination"),le(this,"ID","0"),le(this,"inputTrack",void 0),le(this,"inputNode",void 0),le(this,"audioProcessorContext",void 0),le(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new pe($.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new pe($.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ci.ON_TRACK,void 0),this.emit(Ci.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Ci.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Ci.ON_NODE,this.inputNode))}}class kV extends An{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,s){super(),le(this,"constraintsMap",new Map),le(this,"statsRegistry",[]),le(this,"audioContext",void 0),le(this,"trackId",void 0),le(this,"direction",void 0),le(this,"usageRegistry",[]),le(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=s}async getConstraints(){return er(this,Fa.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var s;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),fn(this,Fa.REQUEST_UPDATE_CONSTRAINTS,Array.from(ya(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),fn(this,Fa.REQUEST_UPDATE_CONSTRAINTS,Array.from(ya(i=this.constraintsMap).call(i)))}registerStats(r,i,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){R.error(new pe($.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof De&&(s=await s),r.push(yn(yn({},s),{},{direction:this.direction}))}catch(s){R.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class SA extends An{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),le(this,"context",void 0),le(this,"processSourceNode",void 0),le(this,"outputTrack",void 0),le(this,"processedNode",void 0),le(this,"clonedTrack",void 0),le(this,"outputNode",void 0),this.outputNode=new mge}setVolume(){}createOutputTrack(){throw new pe($.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class mge{disconnect(){}connect(){}}function jV(t){return new De((r,i)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=ai()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,f=c.videoHeight;!h&&bn()||(s=!0,c.srcObject=null,c.remove(),r([h,f]))}),c.srcObject=new MediaStream([t]),c.play().catch($g),setTimeout(()=>{s||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function Ob(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const i=Gs(t.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!RF()&&i.frameRate&&(r.frameRate=i.frameRate),bF()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),bn()&&(r.frameRate={ideal:30,max:30}),r}function LV(t){const r={};return RF()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,tl()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function MV(t){const r=LV(t);if(t.encoderConfig){const i=Rb(t.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),Vg()&&(r.sampleRate=void 0),r}const UV=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:i,width:s,height:c}=t.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=s,height:f=c}=r;if(!u||!h||!f)return;h=Dp(h),f=Dp(f),u=Dp(u);const{max:g,min:v}=function(C,U,P){const j=200*Math.pow(P/15,.6)*Math.pow(C*U/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(h,f,u),{bitrateMax:_,bitrateMin:x}=r||{};_||R.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(f,", fps: ").concat(u,"] => [brMax: ").concat(_,", brMin: ").concat(x,"]"));const{maxFramerate:S}=G("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(u=Math.min(u,S)),{frameRate:u,bitrateMax:_||g,bitrateMin:x||v,scaleResolutionDownBy:1,scale:0}},FV=async(t,r,i)=>await(async(s,c,u)=>{const h=function(v){const _=[];for(let x=0;x<v.length;x+=2)_.push(parseInt(v.slice(x,x+2),16));return Uint8Array.from(_)}(YF(""+c+u)).slice(0,16),f=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},g,s))})(t.buffer,r,i),wA=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new De((i,s)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await VV(c);i({buffer:u,width:r.width,height:r.height})}else s(new pe($.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},VV=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var BV,GV,WV,$V,HV,zV,KV,YV,qV,XV,JV,QV,ZV,eB,tB,nB,rB,iB,Pn,aB,sB,oB,cB,lB,dB,yc,uB,hB,pB,fB,mB,gB,vB,yB,_B,bB,EB,xB,SB,zr;let Vn=(BV=at({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),GV=at({argsMap:(t,r)=>[t.getTrackId(),r]}),WV=Fn(),$V=kp("LocalAudioTrack","_enabledMutex"),HV=at({argsMap:(t,r)=>[t.getTrackId(),r]}),zV=Fn(),KV=kp("LocalAudioTrack","_enabledMutex"),YV=at({argsMap:(t,r)=>[t.getTrackId(),r]}),qV=Fn(),XV=Fn(),JV=Fn(),QV=at({argsMap:t=>[t.getTrackId()]}),ZV=Fn(),eB=at({argsMap:t=>[t.getTrackId()]}),tB=Fn(),nB=at({argsMap:t=>[t.getTrackId()]}),rB=at({argsMap:(t,r)=>[t.getTrackId(),r.name]}),iB=at({argsMap:t=>[t.getTrackId()]}),Mt((Pn=class extends Gp{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?hi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,i,s){super(t,i),le(this,"trackMediaType",Bp.AUDIO),le(this,"_encoderConfig",void 0),le(this,"_trackSource",void 0),le(this,"metadata",[]),le(this,"_enabled",!0),le(this,"_volume",100),le(this,"_useAudioElement",!0),le(this,"_bypassWebAudio",!1),le(this,"processor",void 0),le(this,"_processorContext",void 0),le(this,"_processorDestination",void 0),le(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!s,this._trackSource=new SA,G("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),G("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Nr()&&!Va?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){cn(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&hi.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,fn(this,He.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!hV())throw new pe($.NOT_SUPPORTED,"your browser does not support setting the audio output device");await hi.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,i){return this._setEnabled(t,r,i)}async _setEnabled(t,r,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await fn(this,He.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(s){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await fn(this,He.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await fn(this,He.NEED_MUTE_TRACK,this):await fn(this,He.NEED_UNMUTE_TRACK,this))}getStats(){return td(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ea(this,He.GET_STATS)||yn({},fA)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Ua.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Ua.ON_AUDIO_BUFFER),this._source.on(Ua.ON_AUDIO_BUFFER,i=>t(i))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),hi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?hi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&hi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return De.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new pe($.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new pe($.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Ci.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await fn(this,He.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this))}),t.on(Ci.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Ci.ON_TRACK),t.removeAllListeners(Ci.ON_NODE)}bindProcessorContextEvents(t){t.on(Fa.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Fa.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof SA&&(this._trackSource=new bA(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new kV(this._source.context,this.getTrackId(),"local"),r=new DV(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(Ua.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(hi.stop(this.getTrackId()),this._source.play()),fn(this,He.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[BV],Object.getOwnPropertyDescriptor(Pn.prototype,"setVolume"),Pn.prototype),Mt(Pn.prototype,"setPlaybackDevice",[GV,WV],Object.getOwnPropertyDescriptor(Pn.prototype,"setPlaybackDevice"),Pn.prototype),Mt(Pn.prototype,"setEnabled",[$V,HV,zV],Object.getOwnPropertyDescriptor(Pn.prototype,"setEnabled"),Pn.prototype),Mt(Pn.prototype,"setMuted",[KV,YV,qV],Object.getOwnPropertyDescriptor(Pn.prototype,"setMuted"),Pn.prototype),Mt(Pn.prototype,"getStats",[XV],Object.getOwnPropertyDescriptor(Pn.prototype,"getStats"),Pn.prototype),Mt(Pn.prototype,"setAudioFrameCallback",[JV],Object.getOwnPropertyDescriptor(Pn.prototype,"setAudioFrameCallback"),Pn.prototype),Mt(Pn.prototype,"play",[QV,ZV],Object.getOwnPropertyDescriptor(Pn.prototype,"play"),Pn.prototype),Mt(Pn.prototype,"stop",[eB,tB],Object.getOwnPropertyDescriptor(Pn.prototype,"stop"),Pn.prototype),Mt(Pn.prototype,"close",[nB],Object.getOwnPropertyDescriptor(Pn.prototype,"close"),Pn.prototype),Mt(Pn.prototype,"pipe",[rB],Object.getOwnPropertyDescriptor(Pn.prototype,"pipe"),Pn.prototype),Mt(Pn.prototype,"unpipe",[iB],Object.getOwnPropertyDescriptor(Pn.prototype,"unpipe"),Pn.prototype),Pn),Xg=(aB=at({argsMap:(t,r)=>[t.getTrackId(),r]}),sB=Fn(),oB=kp("MicrophoneAudioTrack","_enabledMutex"),cB=at({argsMap:(t,r,i)=>[t.getTrackId(),r,i]}),lB=Fn(),dB=at({argsMap:t=>[t.getTrackId()]}),Mt((yc=class extends Vn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,i,s){super(t,r.encoderConfig?Rb(r.encoderConfig):{},s,G("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),le(this,"_config",void 0),le(this,"_deviceName","default"),le(this,"_constraints",void 0),le(this,"_originalConstraints",void 0),le(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Ip()||BR())&&sn.bindInterruptDetectorTrack(this)}async setDevice(t){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await Ga.getDeviceById(t),i={};i.audio=yn({},this._constraints),i.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let s=null;try{s=await Ba(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await Ba({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Ga.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,i){if(r)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),G("AUTO_RESET_AUDIO_ROUTE")&&(ai()||Ms())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await fn(this,He.NEED_DISABLE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=yn({},this._constraints),u=Ga.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await Ba({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await fn(this,He.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ip()||BR())&&sn.unbindInterruptDetectorTrack(this),Pu.some(t=>function(r){return"__className__"in r&&r.__className__==="MicrophoneAudioTrack"}(t))||vA&&vA()&&($e.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:ln.TRACER}).onSuccess(),R.debug("restart background audio tag success"))}onTrackEnded(){if((ai()||Ms())&&this._enabled&&!this._isClosed&&sn.duringInterruption){const t=async()=>{sn.off(Ur.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};sn.on(Ur.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vp.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,i=Ga.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const s=await Ba({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Fa.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Fa.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[aB,sB],Object.getOwnPropertyDescriptor(yc.prototype,"setDevice"),yc.prototype),Mt(yc.prototype,"setEnabled",[oB,cB,lB],Object.getOwnPropertyDescriptor(yc.prototype,"setEnabled"),yc.prototype),Mt(yc.prototype,"close",[dB],Object.getOwnPropertyDescriptor(yc.prototype,"close"),yc.prototype),yc),gge=(uB=at({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),hB=Fn(),pB=at({argsMap:t=>[t.getTrackId()]}),fB=Fn(),mB=at({argsMap:t=>[t.getTrackId()]}),gB=Fn(),vB=at({argsMap:t=>[t.getTrackId()]}),yB=Fn(),_B=at({argsMap:t=>[t.getTrackId()]}),bB=Fn(),EB=at({argsMap:t=>[t.getTrackId()]}),xB=at({argsMap:t=>[t.getTrackId()]}),SB=Fn(),Mt((zr=class extends Vn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,i,s){super(r.createOutputTrack(),i,s),le(this,"source",void 0),le(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(Ua.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Vp.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){cn(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[uB,hB],Object.getOwnPropertyDescriptor(zr.prototype,"startProcessAudioBuffer"),zr.prototype),Mt(zr.prototype,"pauseProcessAudioBuffer",[pB,fB],Object.getOwnPropertyDescriptor(zr.prototype,"pauseProcessAudioBuffer"),zr.prototype),Mt(zr.prototype,"seekAudioBuffer",[mB,gB],Object.getOwnPropertyDescriptor(zr.prototype,"seekAudioBuffer"),zr.prototype),Mt(zr.prototype,"resumeProcessAudioBuffer",[vB,yB],Object.getOwnPropertyDescriptor(zr.prototype,"resumeProcessAudioBuffer"),zr.prototype),Mt(zr.prototype,"stopProcessAudioBuffer",[_B,bB],Object.getOwnPropertyDescriptor(zr.prototype,"stopProcessAudioBuffer"),zr.prototype),Mt(zr.prototype,"close",[EB],Object.getOwnPropertyDescriptor(zr.prototype,"close"),zr.prototype),Mt(zr.prototype,"setAudioBufferPlaybackSpeed",[xB,SB],Object.getOwnPropertyDescriptor(zr.prototype,"setAudioBufferPlaybackSpeed"),zr.prototype),zr);class or extends Vn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Wp().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,Zt(8,"track-mix-")),le(this,"trackList",void 0),le(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(R.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):R.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){R.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}gb(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof or?i.emit(Du.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class vge extends wV{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Ua.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),le(this,"audioBuffer",void 0),le(this,"sourceNode",void 0),le(this,"startPlayTime",0),le(this,"startPlayOffset",0),le(this,"pausePlayTime",0),le(this,"options",void 0),le(this,"currentLoopCount",0),le(this,"currentPlaybackSpeed",100),le(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const wB=new Map;function TB(t,r){if(t.length===0||r.length===0)return 1/0;const i=JR(t),s=JR(r);return Math.floor(s/i)}class TA{get rendFrameRate(){const r=Math.max(1,TB(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Jr.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){le(this,"trackId",void 0),le(this,"config",void 0),le(this,"onFirstVideoFrameDecoded",void 0),le(this,"onFirstVideoFrameRender",void 0),le(this,"onVideoBufferReady",void 0),le(this,"onVideoStateChanged",void 0),le(this,"freezeTimeCounterList",[]),le(this,"renderFreezeAccTime",0),le(this,"renderFreezeAccTime2",0),le(this,"isKeepLastFrame",!1),le(this,"isDestroyed",!1),le(this,"timeUpdatedCount",0),le(this,"freezeTime",0),le(this,"playbackTime",0),le(this,"lastTimeUpdatedTime",0),le(this,"autoplayFailed",!1),le(this,"videoTrack",void 0),le(this,"videoElement",void 0),le(this,"cacheVideoElement",void 0),le(this,"cancelRVFId",void 0),le(this,"internal",!1),le(this,"_render_interframe_delays",[]),le(this,"_render_interframe_delays_sizes",[]),le(this,"_videoState",vc.VideoStateStopped),le(this,"videoElementCheckInterval",void 0),le(this,"videoElementFreezeTimeout",void 0),le(this,"_videoElementStatus",Jr.NONE),le(this,"_isInPage",!0),le(this,"isGettingVideoDimensions",!1),le(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),le(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&sn.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(yF())),CF()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),le(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":i.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Jr.PLAYING;break;case"loadeddata":if(this.videoState=vc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Jr.CANPLAY;break;case"stalled":this.videoElementStatus=Jr.STALLED;break;case"suspend":this.videoElementStatus=Jr.SUSPEND;break;case"pause":this.videoElementStatus=Jr.PAUSED,ai()||Ms()||Nr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Jr.WAITING;break;case"abort":this.videoElementStatus=Jr.ABORT;break;case"ended":this.videoElementStatus=Jr.ENDED;break;case"emptied":this.videoElementStatus=Jr.EMPTIED;break;case"error":{const s=this.videoElement.error;s&&(this.videoElementStatus=Jr.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>G("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,xa.lastVisibleTime<xa.lastHiddenTime||u<xa.lastHiddenTime||u<xa.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>G("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),le(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(yF())),CF()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),sn.on(Ur.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sn.on(Ur.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&IV(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),c)});const s=Bt();if((s.name==="Safari"&&Number(s.version)===15||Ip())&&i&&i.then){const c=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return R.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const s=i.getImageData(0,0,r.width,r.height);return r.remove(),s}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const c=s.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,s.width,s.height),new De((u,h)=>{s.toBlob(async f=>{if(s.remove(),f){const g=await VV(f);u({buffer:g,width:s.width,height:s.height})}else h(new pe($.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await wA(r)}destroy(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,sn.off(Ur.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sn.off(Ur.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),r?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=vc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Jr.INIT,!this.videoElementCheckInterval&&(CB.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(u){return u!==document.body&&document.body.contains(u)}(this.videoElement)},1e3),G("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(f,G("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===vc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=vc.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(v,_)=>{if(this.videoElementStatus===Jr.PLAYING){if(u){const C=_.presentationTime-u.presentationTime,U=_.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(U),this._render_interframe_delays.push(C);const P=JR(this._render_interframe_delays_sizes),j=P-this._render_interframe_delays_sizes[0];if(P>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===vc.VideoStateStarting&&(this.videoState=vc.VideoStateDecoding),this.videoState===vc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,G("VIDEO_FREEZE_DURATION"))),C<G("VIDEO_FREEZE_DURATION")&&this.videoState===vc.VideoStateFrozen&&(this.videoState=vc.VideoStateDecoding),C>G("VIDEO_FREEZE_DURATION")&&xa.lastVisibleTime>=xa.lastHiddenTime&&u.timestamp>xa.lastVisibleTime&&u.timestamp>xa.lastHiddenTime){const W=Math.min(66,TB(this._render_interframe_delays_sizes,this._render_interframe_delays)),K=Math.max(0,C-(U-1)*W);this.renderFreezeAccTime2+=K>W?K:0,this.renderFreezeAccTime+=C}}u=yn(yn({},_),{},{timestamp:v})}else this.isSkipCalcRenderFreezeTime()&&(u=yn(yn({},_),{},{timestamp:v}));var x,S;G("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(x=(S=this.videoElement).requestVideoFrameCallback)===null||x===void 0?void 0:x.call(S,g))};this.cancelRVFId=(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0?void 0:r.call(i,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Vg()&&!G("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=Bt();this.config.noStyle||(s.name==="Safari"&&Number(s.version)===15||Ip()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bn()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{R.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){var r,i;CB.forEach(s=>{this.videoElement&&this.videoElement.removeEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((r=(i=this.videoElement).cancelVideoFrameCallback)===null||r===void 0||r.call(i,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Jr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Jr.DESTROYED||this.internal}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{R.error(s)}),this.autoplayFailed=!1,Bg()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};Bg()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),AV()}}const CB=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Pb extends TA{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),le(this,"container",void 0),le(this,"slot",void 0),this.slot=r.element,this.internal=i,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;var s;!this.internal||this.slot?(i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()):(this.slot=i,i&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(s=this.slot)===null||s===void 0||s.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,s):await wA(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",G("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var NB,RB,AB,IB,OB,PB,DB,kB,jB,LB,MB,UB,FB,VB,BB,GB,WB,$B,HB,zB,KB,YB,qB,XB,JB,QB,ZB,e6,Ot,t6,n6,r6,i6,a6,s6,o6,c6,Wa;let dn=(NB=at({argsMap:(t,r,i)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),RB=Fn(),AB=at({argsMap:t=>[t.getTrackId()]}),IB=kp("LocalVideoTrack","_enabledMutex"),OB=at({argsMap:(t,r)=>[t.getTrackId(),r]}),PB=Fn(),DB=kp("LocalVideoTrack","_enabledMutex"),kB=at({argsMap:(t,r)=>[t.getTrackId(),r]}),jB=Fn(),LB=at({argsMap:(t,r)=>[t.getTrackId(),r,t._saveEncodeBitrateRatio]}),MB=Fn(),UB=at({argsMap:(t,r)=>[t.getTrackId(),r]}),FB=Fn(),VB=Fn(),BB=at({argsMap:(t,r,i)=>[t.getTrackId(),r,i]}),GB=Fn(),WB=Fn(),$B=Fn(),HB=at({argsMap:t=>[t.getTrackId()]}),zB=Fn(),KB=Fn(),YB=Fn(),qB=Fn(),XB=Fn(),JB=at({argsMap:(t,r)=>[t.getTrackId(),r.name]}),QB=at({argsMap:t=>[t.getTrackId()]}),ZB=at({argsMap:t=>[t.getTrackId()]}),e6=at({argsMap:(t,r,i)=>[t.getTrackId(),r.label,i]}),Ot=class Fte extends Gp{get videoHeight(){if(Nr()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Nr()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Jr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,s,c,u,h){if(super(r,u),le(this,"trackMediaType",Bp.VIDEO),le(this,"_player",void 0),le(this,"isUseScaleResolutionDownBy",!1),le(this,"_videoVisibleTimer",null),le(this,"_previousVideoVisibleStatus",void 0),le(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),le(this,"_encoderConfig",void 0),le(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),le(this,"_optimizationMode",void 0),le(this,"_saveEncodeBitrateRatio",1),le(this,"_videoHeight",void 0),le(this,"_videoWidth",void 0),le(this,"_forceBitrateLimit",void 0),le(this,"_enabled",!0),le(this,"_processorDestination",void 0),le(this,"_processorContext",void 0),Nr()){const{width:f,height:g}=r.getSettings();this._videoWidth=f,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=s,this._optimizationMode=c,this._hints=h||[],i&&this._hints.indexOf(Jt.CUSTOM_TRACK)!==-1?this._encoderConfig=En(i):this._encoderConfig=i,this._hints.indexOf(Jt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(UR(Ht.CHROME,115)&&fb().indexOf("Windows")!==-1){const f=function(g,v){if("VideoFrame"in window&&"TransformStream"in window&&It().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(g),x=new MediaStreamTrackGenerator({kind:"video"});let S,C,U=Date.now();const P=()=>{j&&(clearInterval(j),j=void 0),S&&(S.close(),S=void 0),g.stop(),C=void 0,x.removeEventListener("ended",P)};let j=window.setInterval(()=>{if(C&&S&&Date.now()-U>1e3)try{x.readyState==="live"?C.enqueue(S.clone()):P()}catch{P()}},1e3);const W=new TransformStream({transform:(K,J)=>{x.readyState==="live"?(C=J,U=Date.now(),S===void 0?(S=K,J.enqueue(K.clone())):(J.enqueue(S),S=K)):K.close()}});return x.addEventListener("ended",P),_.readable.pipeThrough(W).pipeTo(x.writable),x}}(r);f&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}i&&this._hints.indexOf(Jt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new PV(this.getTrackId(),"local"),this._processorDestination=new OV(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=yn(yn(yn({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(s):(r instanceof HTMLVideoElement?this._player=new TA(s):this._player=new Pb(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Vp.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await fn(this,He.NEED_DISABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return i||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await fn(this,He.NEED_ENABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await fn(this,He.NEED_MUTE_TRACK,this):await fn(this,He.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await fn(this,He.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new pe($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Gs(r),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const s=Ob({encoderConfig:r});(Nr()||ai()||Ms())&&(s.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){const u=new pe($.UNEXPECTED_ERROR,c.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(Jt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fn(this,He.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(R)}}getStats(){return td(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ea(this,He.GET_STATS)||yn({},mA)}async setBeautyEffect(r){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await wA(r)}async findClosestProfile(){const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings(),{width:c,height:u,frameRate:h}=this._encoderConfig||{},f=Dp(this._videoWidth||r||c||0),g=Dp(this._videoHeight||i||u||0),v=function(_,x,S){if(!Array.isArray(G("VIDEO_ENCODER_CONFIG_LIST"))||G("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const C=Math.min(_,x);return!(C>=480)&&yn(yn({},G("VIDEO_ENCODER_CONFIG_LIST").find(U=>U.height>C)),{},{frameRate:S})}(f,g,Dp(s||h||15));if(v)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(f,"x").concat(g," => ").concat(JSON.stringify(v))),this.setEncoderConfiguration(v)}async setBitrateLimit(r){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void R.error($.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await fn(this,He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=i,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return R.error($.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){jV(this._originMediaStreamTrack).then(r=>{let[i,s]=r;this._videoHeight=s,this._videoWidth=i}).catch($g)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new pe($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Gs(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(Jt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fn(this,He.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings();if(!r||!i||!s)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:f}=function(g,v,_,x,S){const C=G("BITRATE_ADAPTER_TYPE");if(C==="DEFAULT_BITRATE")return{min:x,max:S};if(S===void 0){const U=Math.floor(200*Math.pow(_/15,.6)*Math.pow(g*v/640/360,.75));S=C==="STANDARD_BITRATE"?4*U:2*U,x=x??U}else x=x??Math.floor(S/10);return{min:x,max:S}}(r,i,s,u,c);if(this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=h,G("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&c==null){const[g,v]=function(_,x,S){const C=4*Math.floor(2e5*Math.pow(S/15,.6)*Math.pow(_*x/230400,.75)),U=_*x,P=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let W=ya(P).call(P).next().value,K=1;if(P.has(U))W=P.get(U);else{var J;const Fe=fu(J=Array.from(P.entries())).call(J,(ot,St)=>{let[yt]=ot,[Yt]=St;return yt-Yt}),ht=Fe.find(ot=>{let[St]=ot;return St>U});if(ht){const ot=Fe.indexOf(ht);if(ot>0){const St=Fe[ot-1],yt=(U-St[0])/(ht[0]-St[0]);W=St[1]+yt*(ht[1]-St[1])}else W=ht[1]}else W=Fe[Fe.length-1][1]}if(j.has(U))K=j.get(U);else{var re;const Fe=fu(re=Array.from(j.entries())).call(re,(ot,St)=>{let[yt]=ot,[Yt]=St;return yt-Yt}),ht=Fe.find(ot=>{let[St]=ot;return St>U});if(ht){const ot=Fe.indexOf(ht);if(ot>0){const St=Fe[ot-1],yt=(U-St[0])/(ht[0]-St[0]);K=St[1]+yt*(ht[1]-St[1])}else K=ht[1]}else K=Fe[Fe.length-1][1]}const ie=G("VIDEO_NEW_BITRATE_RATIO");ie&&ie>0&&(W=ie/100);const Z=Math.floor(C*W),se=Math.floor(65e4*Math.pow(_*x/230400,.5)*Math.pow(S/15,.69));let ge=Z;const Ee=G("VIDEO_STANDARD_BITRATE_VERSION");return Ee&&Ee>0&&(Ee===1?ge=C:Ee===2?ge=Z:Ee===3&&(ge=se)),[Math.floor(ge/1e3),K]}(r,i,s);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=f?Math.min(f,g):g,this._saveEncodeBitrateRatio=v,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(h,", brMin: ").concat(f,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,i;const s=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=kF.checkOneElementVisible(u),g=Object.assign({},f);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const v=$e.reportApiInvoke(null,{tag:ln.TRACER,name:wn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(s){throw new pe($.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new pe($.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=yn(yn({},s),Gs(r))),s=Nu(s);const c=Zt(8,"track-video-cloned-"),u=new Fte(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,Nu(this._scalabilityMode),this._optimizationMode,c,Nu(this._hints));return r&&s&&u.setEncoderConfiguration(s),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new pe($.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new pe($.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(td(()=>{$e.reportApiInvoke(null,{name:wn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:ln.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!G("ENABLE_VIDEO_SEI")||!G("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new pe($.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void R.warning("Video track is not published, SEI can not be send");const s=i.sender.getParameters();if(s.codecs.length===0)return;const c=s.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):R.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Ci.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ci.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Fa.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Fa.REQUEST_CONSTRAINTS)}},Mt(Ot.prototype,"play",[NB,RB],Object.getOwnPropertyDescriptor(Ot.prototype,"play"),Ot.prototype),Mt(Ot.prototype,"stop",[AB],Object.getOwnPropertyDescriptor(Ot.prototype,"stop"),Ot.prototype),Mt(Ot.prototype,"setEnabled",[IB,OB,PB],Object.getOwnPropertyDescriptor(Ot.prototype,"setEnabled"),Ot.prototype),Mt(Ot.prototype,"setMuted",[DB,kB,jB],Object.getOwnPropertyDescriptor(Ot.prototype,"setMuted"),Ot.prototype),Mt(Ot.prototype,"setSaveEncodeBitrateRatio",[LB,MB],Object.getOwnPropertyDescriptor(Ot.prototype,"setSaveEncodeBitrateRatio"),Ot.prototype),Mt(Ot.prototype,"setEncoderConfiguration",[UB,FB],Object.getOwnPropertyDescriptor(Ot.prototype,"setEncoderConfiguration"),Ot.prototype),Mt(Ot.prototype,"getStats",[VB],Object.getOwnPropertyDescriptor(Ot.prototype,"getStats"),Ot.prototype),Mt(Ot.prototype,"setBeautyEffect",[BB,GB],Object.getOwnPropertyDescriptor(Ot.prototype,"setBeautyEffect"),Ot.prototype),Mt(Ot.prototype,"getCurrentFrameData",[WB],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameData"),Ot.prototype),Mt(Ot.prototype,"getCurrentFrameImage",[$B],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameImage"),Ot.prototype),Mt(Ot.prototype,"findClosestProfile",[HB,zB],Object.getOwnPropertyDescriptor(Ot.prototype,"findClosestProfile"),Ot.prototype),Mt(Ot.prototype,"setBitrateLimit",[KB],Object.getOwnPropertyDescriptor(Ot.prototype,"setBitrateLimit"),Ot.prototype),Mt(Ot.prototype,"setOptimizationMode",[YB],Object.getOwnPropertyDescriptor(Ot.prototype,"setOptimizationMode"),Ot.prototype),Mt(Ot.prototype,"setScalabiltyMode",[qB],Object.getOwnPropertyDescriptor(Ot.prototype,"setScalabiltyMode"),Ot.prototype),Mt(Ot.prototype,"updateMediaStreamTrackResolution",[XB],Object.getOwnPropertyDescriptor(Ot.prototype,"updateMediaStreamTrackResolution"),Ot.prototype),Mt(Ot.prototype,"pipe",[JB],Object.getOwnPropertyDescriptor(Ot.prototype,"pipe"),Ot.prototype),Mt(Ot.prototype,"unpipe",[QB],Object.getOwnPropertyDescriptor(Ot.prototype,"unpipe"),Ot.prototype),Mt(Ot.prototype,"close",[ZB],Object.getOwnPropertyDescriptor(Ot.prototype,"close"),Ot.prototype),Mt(Ot.prototype,"replaceTrack",[e6],Object.getOwnPropertyDescriptor(Ot.prototype,"replaceTrack"),Ot.prototype),Ot),Db=(t6=at({argsMap:(t,r)=>[t.getTrackId(),r]}),n6=Fn(),r6=kp("CameraVideoTrack","_enabledMutex"),i6=at({argsMap:(t,r)=>[t.getTrackId(),r]}),a6=Fn(),s6=at({argsMap:(t,r)=>[t.getTrackId(),r]}),o6=Fn(),c6=at({argsMap:t=>[t.getTrackId()]}),Wa=class Vte extends dn{get __className__(){return"CameraVideoTrack"}constructor(r,i,s,c,u,h){super(r,Gs(i.encoderConfig),c,u,h),le(this,"_config",void 0),le(this,"_originalConstraints",void 0),le(this,"_constraints",void 0),le(this,"_enabled",!0),le(this,"_deviceName","default"),le(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ip()||BR())&&!function(){const f=Bt();if(f.os!==vr.IOS||!f.osVersion)return!1;const g=f.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2}()&&NF()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=r.label,this._encoderConfig=Gs(this._config.encoderConfig),sn.on(Ur.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),sn.on(Ur.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await Ga.getDeviceById(r),s={};s.video=yn({},this._constraints),s.video.deviceId={exact:r},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Ba(s,this.getTrackId())}catch(u){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Ba({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Ga.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:yn(yn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Ba(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),s=await Ba({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=yn({},i.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await Ba({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await fn(this,He.NEED_ENABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await fn(this,He.NEED_DISABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new pe($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Gs(r),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const s=En(this._config);s.encoderConfig=r;const c=Ob(s);(Nr()||ai()||Ms())&&(c.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new pe($.UNEXPECTED_ERROR,u.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=s,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(Jt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fn(this,He.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ai()||Ms())&&this._enabled&&!this._isClosed&&sn.duringInterruption){const r=async()=>{sn.off(Ur.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};sn.on(Ur.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vp.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,s=Ga.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId={exact:s}),this._enabled){const c=await Ba({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),sn.off(Ur.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),sn.off(Ur.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=yn(yn({},s),Gs(r))),s=Nu(s);const c=Zt(8,"track-cam-cloned-"),u=new Vte(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Nu(yn(yn({},this._config),{},{encoderConfig:s})),Nu(this._constraints),Nu(this._scalabilityMode),this._optimizationMode,c);return r&&s&&u.setEncoderConfiguration(s),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Fa.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}}),this.processorContext.on(Fa.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Mt(Wa.prototype,"setDevice",[t6,n6],Object.getOwnPropertyDescriptor(Wa.prototype,"setDevice"),Wa.prototype),Mt(Wa.prototype,"setEnabled",[r6,i6,a6],Object.getOwnPropertyDescriptor(Wa.prototype,"setEnabled"),Wa.prototype),Mt(Wa.prototype,"setEncoderConfiguration",[s6,o6],Object.getOwnPropertyDescriptor(Wa.prototype,"setEncoderConfiguration"),Wa.prototype),Mt(Wa.prototype,"close",[c6],Object.getOwnPropertyDescriptor(Wa.prototype,"close"),Wa.prototype),Wa);function l6(t){const r=Zt(8,"track-cus-"),i=$e.reportApiInvoke(null,{id:r,tag:ln.TRACER,name:wn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),s=new Vn(t.mediaStreamTrack,t.encoderConfig?Rb(t.encoderConfig):{},r,!1);return R.info("create custom audio track success with config",t,"trackId",s.getTrackId()),i.onSuccess(s.getTrackId()),s}function CA(t,r,i,s){i.optimizationMode&&(s&&s.width&&s.height?(i.encoderConfig=yn(yn({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?R.debug("[".concat(t,"] set content hint to"),i.optimizationMode):R.debug("[".concat(t,"] set content hint failed")))):R.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var d6,u6,h6,p6,ds,f6,m6,g6,v6,y6,_6,b6,Kr;class E6 extends EV{getUserId(){return this._userId}constructor(r,i,s,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(Zt(5,""))),le(this,"_userId",void 0),le(this,"_uintId",void 0),le(this,"_isDestroyed",!1),le(this,"store",void 0),le(this,"processor",void 0),le(this,"processorContext",void 0),this._userId=i,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Hp=(d6=at({argsMap:(t,r,i)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),u6=at({argsMap:t=>[t.getTrackId()]}),h6=at({argsMap:(t,r)=>[t.getTrackId(),r.name]}),p6=at({argsMap:t=>[t.getTrackId()]}),Mt((ds=class extends E6{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Jr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,i,s,c){super(t,r,i,s),le(this,"_videoVisibleTimer",null),le(this,"_previousVideoVisibleStatus",void 0),le(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),le(this,"trackMediaType",Bp.VIDEO),le(this,"_videoWidth",void 0),le(this,"_videoHeight",void 0),le(this,"_player",void 0),le(this,"_prePlayer",void 0),le(this,"processorDestination",void 0),le(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new PV(this.getTrackId(),"remote"),this.processorDestination=new OV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return td(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ea(this,He.GET_STATS)||yn({},_V)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(ls.PLAY_START),typeof t=="string"){const s=document.getElementById(t);s?t=s:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=yn(yn({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(i);else{let s=!1,c=!1;t instanceof HTMLVideoElement?(this._player=new TA(i),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,s=this._player.videoState>0,this._player.updateConfig(i)):this._player=new Pb(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ls.FIRST_FRAME_DECODED),c&&this.safeEmit(ls.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=u=>{this.safeEmit(ls.VIDEO_STATE_CHANGED,u)},s&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(ls.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(ls.PLAY_END)}stop(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(t),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){jV(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch($g)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=kF.checkOneElementVisible(c),f=Object.assign({},h);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;const g=$e.reportApiInvoke(null,{tag:ln.TRACER,name:wn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(i){throw new pe($.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new pe($.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ci.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ci.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(Du.SEI_RECEIVED,t)}}).prototype,"play",[d6],Object.getOwnPropertyDescriptor(ds.prototype,"play"),ds.prototype),Mt(ds.prototype,"stop",[u6],Object.getOwnPropertyDescriptor(ds.prototype,"stop"),ds.prototype),Mt(ds.prototype,"pipe",[h6],Object.getOwnPropertyDescriptor(ds.prototype,"pipe"),ds.prototype),Mt(ds.prototype,"unpipe",[p6],Object.getOwnPropertyDescriptor(ds.prototype,"unpipe"),ds.prototype),ds),zp=(f6=at({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),m6=at({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),g6=at({argsMap:(t,r)=>[t.getTrackId(),r]}),v6=at({argsMap:t=>[t.getTrackId()]}),y6=at({argsMap:t=>[t.getTrackId()]}),_6=at({argsMap:(t,r)=>[t.getTrackId(),r.name]}),b6=at({argsMap:t=>[t.getTrackId()]}),Mt((Kr=class extends E6{get isPlaying(){return this._useAudioElement?hi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,i,s){super(t,r,i,s),le(this,"trackMediaType",Bp.AUDIO),le(this,"_source",void 0),le(this,"_useAudioElement",!0),le(this,"_volume",100),le(this,"processorContext",void 0),le(this,"processorDestination",void 0),le(this,"_played",!1),le(this,"_bypassWebAudio",!1),G("DISABLE_WEBAUDIO")?(this._source=new SA,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bA(t,!0),G("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ua.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ls.FIRST_FRAME_DECODED)}),this.processorContext=new kV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new DV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ua.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Ua.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Ua.ON_AUDIO_BUFFER),this._source.on(Ua.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){this._volume=t,this._useAudioElement?hi.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}setAmplifiedVolume(t){this._useAudioElement&&this._played&&(hi.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,t=Math.min(t,G("MAX_WEBAUDIO_VOLUME")),this._volume=t,this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!hV())throw new pe($.NOT_SUPPORTED,"your browser does not support setting the audio output device");await hi.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?hi.getVolume(this.getTrackId()):this._source instanceof bA?this._source.getAudioVolume():0}getStats(){return td(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ea(this,He.GET_STATS)||yn({},yV)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),hi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(R.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?hi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&hi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new pe($.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new pe($.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new pe($.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ci.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ci.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ci.ON_TRACK),this.processorDestination.removeAllListeners(Ci.ON_NODE)}}).prototype,"setVolume",[f6],Object.getOwnPropertyDescriptor(Kr.prototype,"setVolume"),Kr.prototype),Mt(Kr.prototype,"setAmplifiedVolume",[m6],Object.getOwnPropertyDescriptor(Kr.prototype,"setAmplifiedVolume"),Kr.prototype),Mt(Kr.prototype,"setPlaybackDevice",[g6],Object.getOwnPropertyDescriptor(Kr.prototype,"setPlaybackDevice"),Kr.prototype),Mt(Kr.prototype,"play",[v6],Object.getOwnPropertyDescriptor(Kr.prototype,"play"),Kr.prototype),Mt(Kr.prototype,"stop",[y6],Object.getOwnPropertyDescriptor(Kr.prototype,"stop"),Kr.prototype),Mt(Kr.prototype,"pipe",[_6],Object.getOwnPropertyDescriptor(Kr.prototype,"pipe"),Kr.prototype),Mt(Kr.prototype,"unpipe",[b6],Object.getOwnPropertyDescriptor(Kr.prototype,"unpipe"),Kr.prototype),Kr);const xa=new class extends An{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),le(this,"_lastHiddenTime",0),le(this,"_lastVisibleTime",0),le(this,"needUploadStats",[]),le(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class x6 extends An{constructor(r,i){super(),le(this,"trackMediaType",Bp.DATA),le(this,"_version",1),le(this,"_type",3),le(this,"_config",void 0),le(this,"_originDataChannel",void 0),le(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),le(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),le(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return G("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new De((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const s=setTimeout(()=>{var c;i(new pe($.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new pe($.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new pe($.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[Ab.OPEN,Ab.CLOSE,Ab.ERROR].forEach(i=>{const s=()=>{this.emit(i)};this._datachannelEventMap.set(i,s),r.addEventListener(i,s)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[s,c]=i;r.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class yge extends x6{constructor(r){super(r),le(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(s).getUint8(3);if(c!==this.id)return void(G("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(Ab.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class _ge extends x6{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function kb(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>D0.revokeObjectURL(t),0),new Worker(D0.createObjectURL(t))}const S6=71,NA=1,RA=2,AA=1,w6=2;var rd=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(rd||{});function IA(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=t.getUint8(0);if(i!==S6)return;const s=t.getUint16(1),c=NA+RA+s,u=new Uint8Array(t.byteLength-c);u.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:i,tlvLen:s,tlv:[],frame:u};let f=NA+RA;for(;f<c;){const g=t.getUint8(f),v=t.getUint16(f+AA),_=AA+w6;if(g===rd.AUDIO_LEVEL){let x=t.getUint8(f+_);for(let S=1;S<v;S++)x=x<<8|t.getUint8(f+_+S);h.tlv.push({tag:g,length:v,value:r?127^x>>1:127&x})}else if(g===rd.METADATA||g===rd.AUDIO_64_BIT_PTS){const x=new Uint8Array(v);for(let S=0;S<v;S++)x[S]=t.getUint8(f+_+S);h.tlv.push({tag:g,length:v,value:x})}f+=_+v}return h}const jb=new Map,Lb=127,Lu=1e-10,OA=139/13,Mb=new Map;function PA(t,r,i){const s="".concat(t,"-").concat(r,"-").concat(i);let c=0;return Mb.has(s)?c=Mb.get(s):(c=Math.log(function(h,f){const g=h-f;f<g&&(f=g);let v=1;for(let _=h,x=1;_>f;_--,x++)v=v*_/x;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(i)+i*t,Mb.set(s,c)),c<Lu&&(c=Lu),c}function T6(t,r,i){const s=r.length,c=t.length/s;let u=!1;for(let h=0,f=0;h<s;h++){let g=0;for(let v=f+c;f<v;f++)t[f]>i&&g++;r[h]!==g&&(r[h]=g,u=!0)}return u}window.cache=Mb;let bge=0;class C6{constructor(r){le(this,"id",void 0),le(this,"immediates",[]),le(this,"lastNonSilence",-1),le(this,"immediateSpeechActivityScore",Lu),le(this,"lastLevelChangedTime",Date.now()),le(this,"levels",[]),le(this,"longs",[]),le(this,"longSpeechActivityScore",Lu),le(this,"mediums",[]),le(this,"mediumSpeechActivityScore",Lu),le(this,"minLevel",0),le(this,"nextMinLevel",0),le(this,"nextMinLevelWindowLength",0),le(this,"energyScore",0),this.id=r||"".concat(bge++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,s=this.minLevel+OA;let c=!1;for(let u=0;u<r.length;++u){let h=i[u];h<s&&(h=0);const f=Math.floor(h/OA);r[u]!==f&&(r[u]=f,c=!0)}return c}computeLongs(){return T6(this.mediums,this.longs,4)}computeMediums(){return T6(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=PA(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=PA(this.longs[0],10,47),this.longSpeechActivityScore>Lu&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=PA(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(Kj(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let s=r;return r<0&&(s=0),r>Lb&&(s=Lb),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+OA?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>Lb&&(i=Lb),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Ege{constructor(r){le(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class DA{constructor(r,i,s){le(this,"isDominant",void 0),le(this,"energyRanking",void 0),le(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=s}}class xge extends An{constructor(r){super(),le(this,"dominantId",null),le(this,"lastDecisionTime",0),le(this,"lastLevelChangedTime",0),le(this,"lastLevelIdleTime",0),le(this,"relativeSpeechActivities",[]),le(this,"speakers",new Map),le(this,"enableSilence",!1),le(this,"timeoutToSilenceInterval",0),le(this,"decisionMaker",null),le(this,"loudest",[]),le(this,"numLoudestToTrack",3),le(this,"energyExpireTimeMs",250),le(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),s!=null&&(this.energyAlphaPct=s),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const s=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const u=c.levelChanged(i,s);return this.updateLoudestList(c,u,s)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new C6(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,s){const c=r.id===this.dominantId;if(i<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new DA(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new DA(c,0,r.energyScore);const u=s-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let f=0;for(;f<this.loudest.length&&!(this.loudest[f].energyScore<r.energyScore);)++f;return f<this.numLoudestToTrack&&(this.loudest.splice(f,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new DA(c,f,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Ege(this),this.decisionMaker.execute())}makeDecision(r){let i=null,s=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const f=ya(h=this.speakers).call(h).next().value;this.enableSilence&&f&&(u=f.id,f.evaluateSpeechActivityScores(r),r-f.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let f=this.dominantId==null?null:this.speakers.get(this.dominantId);if(f==null){const _=this.speakers.entries().next();_.value&&(u=_.value[0],f=_.value[1])}else u=f.id;f!=null&&f.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let v=2;for(const _ of this.speakers.entries()){const[x,S]=_;if(S===f)continue;S.evaluateSpeechActivityScores(r);for(let j=0;j<g.length;++j){const W=f==null?Lu:f.getSpeechActivityScore(j);g[j]=Math.log(S.getSpeechActivityScore(j)/W)}const C=g[0],U=g[1],P=g[2];C>3&&U>2&&P>0&&U>v&&(v=U,u=x)}this.enableSilence&&f!=null&&u===f.id&&r-f.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,s=this.dominantId),s==null&&!this.enableSilence||s===i||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let s=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):s=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&s>c&&(s=c),s}timeoutIdleLevels(r){const i=[];for(const c of ya(s=this.speakers).call(s)){var s;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Kp=new Map;let Ao=null,Ub=null;const N6=3;let Mu=[];const Io=new Map,Fb=new Map;class Sge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){le(this,"id",void 0),le(this,"track",void 0),le(this,"score",0),le(this,"active",!0),le(this,"muted",!1),le(this,"timer",0),le(this,"actives",0),le(this,"inactives",0),this.id=r,this.track=i,this.setActive(Io.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:s}=function(){const c=[],u=[];return Array.from(ya(Io).call(Io)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&s.length>0){let c;s.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let s;return Array.from(ya(Io).call(Io)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!s||c.score<s.score)&&(s=c)}),s}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let s;return Array.from(ya(Io).call(Io)).forEach(c=>{c.active||c.id===i||c.samples<40||(!s||c.score>s.score)&&(s=c)}),s}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Vb;function R6(t){const r=Io.get(t);r&&(Io.delete(t),r.clearTimer())}const Bb=new Map,wge=new Map,kA="video/h264",jA="video/h265";function A6(t,r,i){let s=new Uint8Array(t,r,i),c=[],u=0;for(;c.length<i;)u+3<i&&s[u]===0&&s[u+1]===0&&s[u+2]===3&&(s[u+3]===0||s[u+3]===1||s[u+3]===2||s[u+3]===3)?(c.push(s[u],s[u+1],s[u+3]),u+=4):(c.push(s[u]),u++);return new Uint8Array(c)}function I6(t){const r=t.length;let i=[],s=0;for(;s<r;)s+2<r&&t[s]===0&&t[s+1]===0&&(t[s+2]===0||t[s+2]===1||t[s+2]===2||t[s+2]===3)?(i.push(t[s],t[s+1],3,t[s+2]),s+=3):(i.push(t[s]),s++);return new Uint8Array(i)}function O6(t){if(t.length<5)return"";let r=-1;for(let c=0;c<t.length-3;c++){if(t[c]===0&&t[c+1]===0&&t[c+2]===1){r=c;break}if(c<t.length-4&&t[c]===0&&t[c+1]===0&&t[c+2]===0&&t[c+3]===1){r=c;break}}if(r===-1)return"";const i=r+(t[r+2]===0?4:3);if(i>=t.length)return"";const s=t[i];return 128&s?"":(s>>1&63)>=32||i+1<t.length&&!(248&t[i+1])?jA:(31&s)<=31?kA:""}const Gb=new Map,Jg=new Map;(function(){const t=Bt();_r.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),_r.getStreamFromExtension=t.name===Ht.CHROME&&Number(t.version)>34,_r.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),_r.supportMinBitrate=t.name===Ht.CHROME||t.name===Ht.EDGE,_r.supportSetRtpSenderParameters=function(){const r=Bt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!mc()||!(!Nr()&&!mb())||r.name===Ht.FIREFOX&&Number(r.version)>=64)}(),t.name===Ht.SAFARI&&(Number(t.version)>=14?_r.supportDualStream=!0:_r.supportDualStream=!1),_r.webAudioMediaStreamDest=function(){const r=Bt();return!(r.name===Ht.SAFARI&&Number(r.version)<12)}(),_r.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",_r.supportWebGL=typeof WebGLRenderingContext<"u",_r.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,mc()||(_r.webAudioWithAEC=!0),_r.supportShareAudio=function(){const r=Bt();return(r.os===vr.WIN_10||r.os===vr.WIN_81||r.os===vr.WIN_7||r.os===vr.LINUX||r.os===vr.MAC_OS||r.os===vr.CHROMIUM_OS)&&r.name===Ht.CHROME&&Number(r.version)>=74}(),_r.supportDataChannel=!!(No(76)||FR(68)||xF(14)),_r.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!bn()&&!!r&&r.prototype.setConfiguration instanceof Function}(),_r.supportWebRTCEncodedTransform=No(87)||_F()||FR(117),_r.supportWebRTCInsertableStream=function(){const r=Bt();return(r.name===Ht.CHROME||r.name===Ht.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),_r.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,_r.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,_r.supportSuppressLocalAudioPlayback=mV(),_r.supportRestrictOwnAudio=gV(),vb(()=>{_r.supportDualStreamEncoding=function(){const r=Bt();return!!G("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&G("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",t),R.info("browser compatibility: ",_r)})})();const Tge=["CHINA","GLOBAL"],P6=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Uu=[],Yp=[];function Fu(t,r){return!!r&&Uu.some(i=>i.uid===t&&i.channelName===r)}function LA(){return Yp.length>0}var Cge=F3.forEach,D6=H_("forEach")?[].forEach:function(t){return Cge(this,t,arguments.length>1?arguments[1]:void 0)};Qt({target:"Array",proto:!0,forced:[].forEach!==D6},{forEach:D6});var Nge=is("Array","forEach"),Rge=Hl,Age=ri,Ige=N,Oge=Nge,MA=Array.prototype,Pge={DOMTokenList:!0,NodeList:!0},Dge=function(t){var r=t.forEach;return t===MA||Ige(MA,t)&&r===MA.forEach||Age(Pge,Rge(t))?Oge:r},kge=d(Dge),jge=lc,k6=J_;Qt({target:"Object",stat:!0,forced:p(function(){k6(1)})},{keys:function(t){return k6(jge(t))}});var Lge=d(Wt.Object.keys),Mge=d($j),Uge=d(zj),Fge=Qt,j6=lg,Vge=u0,Bge=Qe,L6=XT,Gge=$l,Wge=At,$ge=mN,Hge=Zn,zge=Kl,Kge=A3("slice"),Yge=Hge("species"),UA=Array,qge=Math.max;Fge({target:"Array",proto:!0,forced:!Kge},{slice:function(t,r){var i,s,c,u=Wge(this),h=Gge(u),f=L6(t,h),g=L6(r===void 0?h:r,h);if(j6(u)&&(i=u.constructor,(Vge(i)&&(i===UA||j6(i.prototype))||Bge(i)&&(i=i[Yge])===null)&&(i=void 0),i===UA||i===void 0))return zge(u,f,g);for(s=new(i===void 0?UA:i)(qge(g-f,0)),c=0;f<g;f++,c++)f in u&&$ge(s,c,u[f]);return s.length=c,s}});var Xge=is("Array","slice"),Jge=N,Qge=Xge,FA=Array.prototype,Zge=function(t){var r=t.slice;return t===FA||Jge(FA,t)&&r===FA.slice?Qge:r},eve=d(Zge);function ke(t,r,i,s,c){var u,h,f,g={};return kge(u=Lge(s)).call(u,function(v){g[v]=s[v]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Mge(h=Uge(f=eve(i).call(i)).call(f)).call(h,function(v,_){return _(t,r,v)||v},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(T3(t,r,g),null):g}let Wb=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),VA=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),us=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t[t.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",t}({}),Ni=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Ze=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),kt=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),ze=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.DATACHANNEL_PRECONNECT="datachannel_preconnect",t.DATACHANNEL_CONNECTING="datachannel_connecting",t.DATACHANNEL_FAILBACK="datachannel_failback",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t.VOS_FALLBACK="vos_fallback",t.VOS_FALLBACK_PROMISE="vos_fallback_promise",t}({}),Ye=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SET_DUAL_STREAM_MODE="set_dual_stream_mode",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.CONFIGURE="configure",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),Vu=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),ft=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t.ENABLE_MULTI_STREAM="enable_multi_stream",t}({}),Ri=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),_t=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t.ON_FALLBACK="websocket:on_fallback",t}({});function $b(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw R.error("Invalid Channel Name ".concat(t)),new ce($.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Hb(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||OF(t,1,255)))throw new ce($.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let il=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const tve={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},BA={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function GA(t,r){Mr(t.url,"".concat(r,".url"),1,1e3,!1),kn(t.x)||cn(t.x,"".concat(r,".x"),0,1e4),kn(t.y)||cn(t.y,"".concat(r,".y"),0,1e4),kn(t.width)||cn(t.width,"".concat(r,".width"),0,1e4),kn(t.height)||cn(t.height,"".concat(r,".height"),0,1e4),kn(t.zOrder)||cn(t.zOrder,"".concat(r,".zOrder"),0,255),kn(t.alpha)||cn(t.alpha,"".concat(r,".alpha"),0,1,!1)}const nve={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let id=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),WA=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),cr=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function M6(t){if(!t.channelName)throw new ce($.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new ce($.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Mr(t.token,"info.token",1,2047),Hb(t.uid),$b(t.channelName),!0}let Vi=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),al=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Zi=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),qp=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),tn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),$n=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t.VOS_FALLBACK="vos-fallback",t.VOS_FALLBACK_PROMISE="vos-fallback-promise",t.RESET_SIGNAL="reset-signal",t.DATACHANNEL_FAILBACK="datachannel-failback",t}({}),zb=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),br=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),qt=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const U6=[qt.AFRICA,qt.ASIA,qt.CHINA,qt.EUROPE,qt.GLOBAL,qt.INDIA,qt.JAPAN,qt.NORTH_AMERICA,qt.OCEANIA,qt.OVERSEA,qt.SOUTH_AMERICA];let Qr=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const Kb={CHINA:{},ASIA:{CODE:Qr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Qr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Qr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Qr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Qr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Qr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Qr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Qr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Qr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Qr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Qr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Qr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Qr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};aA&&(Kb.CHINA={CODE:Qr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Oo=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",t.FALLBACK_TO_HLS="fallback_to_hls",t.UPDATE_VOS_CONFIGURE="update_vos_configure",t}({});function F6(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class V6 extends An{constructor(r,i){super(),L(this,"onICEConnectionStateChange",void 0),L(this,"onConnectionStateChange",void 0),L(this,"onDTLSTransportStateChange",void 0),L(this,"onDTLSTransportError",void 0),L(this,"onICETransportStateChange",void 0),L(this,"onFirstAudioReceived",void 0),L(this,"onFirstVideoReceived",void 0),L(this,"onFirstAudioDecoded",void 0),L(this,"onFirstVideoDecoded",void 0),L(this,"onFirstVideoRender",void 0),L(this,"onFirstVideoBufferReady",void 0),L(this,"onFirstVideoDecodedTimeout",void 0),L(this,"onSelectedLocalCandidateChanged",void 0),L(this,"onSelectedRemoteCandidateChanged",void 0),L(this,"onICECandidateError",void 0),L(this,"getLocalVideoStats",void 0)}}class Yb extends V6{constructor(r,i){super(r,i),L(this,"establishPromise",void 0)}}let Ge=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ar=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),sl=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const B6=["disconnected","failed"];let Ce=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Xt=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),qe=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t.FirstVideoPreRender="FirstVideoPreRender",t.FirstVideoBufferReady="FirstVideoBufferReady",t}({}),Ws=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),$s=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Ir=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),ad=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),lr=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),_c=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),hs=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Po=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Xp=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Hn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Jp=function(t){return t.ABORT="abort",t}({}),sd=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),rve=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const ive={[Wb.ACCESS_POINT]:{[Ni.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ni.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ni.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ni.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ni.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ni.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Wb.UNILBS]:{[us.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[us.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[us.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[us.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[us.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[us.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[us.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[us.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[us.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[us.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[us.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[us.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[us.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[Wb.STRING_UID_ALLOCATOR]:{[VA.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[VA.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[VA.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Qp(t){const r=ive[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[t%1e4];if(!i){if(Math.floor(t/1e4)===Wb.ACCESS_POINT){const s=t%1e4;if(s.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const ave={[Ze.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ze.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ze.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ze.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ze.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ze.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ze.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ze.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ze.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ze.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ze.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ze.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ze.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ze.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[Ze.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ze.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ze.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ze.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ze.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ze.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ze.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ze.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ze.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ze.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ze.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ze.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ze.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ze.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ze.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ze.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ze.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ze.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ze.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ze.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ze.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ze.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ze.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ze.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ze.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ze.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ze.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ze.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ze.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ze.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ze.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ze.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ze.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ze.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ze.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ze.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ze.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ze.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ze.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ze.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ze.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ze.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ze.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ze.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ze.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ze.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ze.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ze.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Bu(t){return ave[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function G6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function $A(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?G6(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):G6(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function HA(t,r){if(typeof t=="string")return t;const{proxy:i,host:s,port:c}=t;if(r){const u=G("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const sve=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,ove=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,cve=/wss:\/\/(.+):([0-9]+)\/?/,lve=/wss:\/\/(.[^\/]+)\/?/;let dve=0;class uve{constructor(r,i){L(this,"id",0),L(this,"store",void 0),L(this,"recordIndex",void 0),L(this,"websockets",[]),L(this,"try443PortDuration",2e3),L(this,"forceCloseWSDuration",5e3),L(this,"try443PortTimeout",null),L(this,"forceCloseTimeout",null),L(this,"isTry443PortFailed",!1),L(this,"isNormalPortFailed",!1),L(this,"useDoubleDomain",!1),L(this,"useProxy",!1),L(this,"startTime",Date.now()),this.id=++dve,this.try443PortDuration=G("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];R.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,s){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:s});const c=G("GATEWAY_DOMAINS"),u=Date.now(),h=[],f=c.find(S=>{var C;return Te(C=r.host).call(C,S)});f||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach(S=>{g.push(HA($A($A({},r),{},{host:r.host.replace(f,S)}),i))});else{const S=$A({},r);if(i&&f){const C=c.find(U=>U!==f);C&&(S.host=S.host.replace(f,C))}g.push(HA(S,i))}try{g.forEach(S=>{const C=new WebSocket(S);C.binaryType="arraybuffer",h.push(C),this.logger("ws is connecting:",C.url)})}catch(S){if(this.logger("ws create failed"),h.forEach(C=>C.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,s);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,s);throw new ce($.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}const v=Fg();this.store&&this.store.recordJoinChannelService({urls:h.map(S=>S.url),service:"gateway"},this.recordIndex),h.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(C=>{C!==S&&(C.onopen=null,C.onclose=null,C.onmessage=null,C.close(),this.logger("close backup websocket: ".concat(C.url)))}),this.websockets.length=0,v.resolve(S)},S.onclose=C=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(S.readyState));const U=h.every(P=>P.readyState===WebSocket.CLOSED||P.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(U)),U&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(C.reason)),v.reject({code:C.code,reason:zb.A_ROUND_WS_FAILED})):!i&&U&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),x()),i?this.isTry443PortFailed=U:this.isNormalPortFailed=U},S.onmessage=C=>this.logger("".concat(S.url," onmessage: ").concat(C.data))}),this.websockets.push(...h);const _=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},x=()=>{if(v.isResolved)return _();Bt().os===vr.MAC_OS&&bn()&&_(),this.createWebSocket(r,!0,!0).then(S=>{v.resolve(S)}).catch(S=>{this.isNormalPortFailed&&v.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return s||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,x()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,i,s,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(u){let h,f,g;return[,h,f,g]=u.match(sve)||[],h||([,f,g]=u.match(ove)||[]),f&&g||([,f,g]=u.match(cve)||[]),f&&g||([,f]=u.match(lve)||[]),f||R.warning("un-destructible url: ",u),{proxy:h,host:f,port:g||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,s&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(r,!!s,!1).finally(()=>this.clearTimeout())}}function W6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class $6 extends An{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;Te(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(_t.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(_t.CONNECTED):this._state==="closed"?this.emit(_t.CLOSED):this._state==="failed"&&this.emit(_t.FAILED))}resetReconnectCount(r){R.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),L(this,"_websocketUrl",null),L(this,"connectionID",0),L(this,"currentURLIndex",0),L(this,"urls",[]),L(this,"_reconnectMode","tryNext"),L(this,"reconnectReason",void 0),L(this,"_initMutex",void 0),L(this,"name",void 0),L(this,"_state","closed"),L(this,"reconnectInterrupter",void 0),L(this,"websocket",void 0),L(this,"retryConfig",void 0),L(this,"reconnectCount",0),L(this,"forceCloseTimeout",5e3),L(this,"onlineReconnectListener",void 0),L(this,"useCompress",void 0),L(this,"tryDoubleDomain",!1),L(this,"use443PortOnly",!1),L(this,"wsInflateLength",0),L(this,"wsDeflateLength",0),L(this,"closeEstablishingWs",()=>{}),L(this,"store",void 0),L(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(x){for(var S=1;S<arguments.length;S++){var C=arguments[S]!=null?arguments[S]:{};S%2?W6(Object(C),!0).forEach(function(U){L(x,U,C[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(C)):W6(Object(C)).forEach(function(U){Object.defineProperty(x,U,Object.getOwnPropertyDescriptor(C,U))})}return x}({},i),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Rr("websocket",h?h.clientId:void 0);const{timeout:f,timeoutFactor:g}=i,v=Math.max(300,Math.floor(3*f/5)),_=Math.max(1.2,Math.floor(8*g)/10);wi.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=_),jn.on(Tu.NETWORK_STATE_CHANGE,(x,S)=>{x!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(x)),x===wi.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{var c;const u=Fg(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(f){return!(Cb()||G("USE_NEW_TOKEN")||!G("ENABLE_PREALLOC_PC")&&(f==null||!f.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(lr.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(u.resolve).catch(u.reject),this.once(_t.CLOSED,()=>{u.reject(new pe($.WS_DISCONNECT))}),this.once(_t.CONNECTED,u.resolve),await u.promise}catch{}finally{s()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;i?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new pe($.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(s){throw new pe($.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const s=Fg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=_=>{var x;(x=this.store)===null||x===void 0||x.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},u=async _=>{var x;if(R.debug("[".concat(this.name,"] websocket close ").concat((x=this.websocket)===null||x===void 0?void 0:x.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new pe($.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=Ea(this,_t.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,C=await this.reconnectWithAction(S);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!C)return s.reject(new pe($.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);s.resolve()}},h=_=>{this.emit(_t.ON_MESSAGE,_)},f=_=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),G("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=G("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),r);const g=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=HA(r);const _=await this.chooseBestWebsocketConnection(r);this.websocket=_,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=f,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(_){const x=this.state==="closed",S=_ instanceof pe,C=S&&_.code===$.WS_ABORT,U=S&&_.code===$.WS_ERR,P=S?_.message:_&&(_.reason||_.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(P)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:C?"aborted":"error",errors:[_]},g),x||U?(s.reject(x?new pe($.WS_DISCONNECT,"websocket is closed: ".concat(P)):new pe($.WS_ERR,"init websocket failed: ".concat(P))),U&&R.error("[".concat(this.name,"] init websocket failed: ").concat(P))):u&&u(_)}return s.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||jn.isOnline||!jn.onlineWaiter||(this.onlineReconnectListener=jn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,i){const h=yb(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await De.race([yr(h),this.onlineReconnectListener||new De(()=>{})])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;const c=async(h,f)=>{this.emit(_t.RECONNECT_CREATE_CONNECTION,f),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await er(this,_t.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;R.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const f=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;if(Array.isArray(f)){if(Te(f).call(f,"dynamic key expired"))return this.emit(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(Te(f).call(f,"request downgrade fallback"))return this.emit(_t.ON_FALLBACK),!1}return this.reconnectWithAction(r,i)}return!0}}class zA extends $6{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const s=Fg(),c=function(h,f){return new uve(h,f)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),s.reject(new pe($.WS_ABORT,"choose best websocket aborted"))};const u=G("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Qg extends $6{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new De((s,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),h.forEach(U=>{U.onclose=null,U.onopen=null,U.onmessage=null,U.close()}),c(new pe($.WS_ABORT,"choose best websocket aborted"))};const f=G("GATEWAY_DOMAINS");let g;const v=r.indexOf("?h="),_=f.find(U=>v!==-1?Te(r).call(r,U,v):Te(r).call(r,U));R.debug("[choose-best-ws] currentDomain: ",_,", domains: ",f);let x=!this.tryDoubleDomain||!_;if(!x&&_){var S;const U=Date.now();try{f.forEach(P=>{const j=v===-1?r.replace(_,P):r.substr(0,v)+r.substr(v).replace(_,P),W=new WebSocket(j);W.binaryType="arraybuffer",h.push(W),R.debug("[choose-best-ws] ws is connecting:",W.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(j=>j.close());h.length;)h.pop();x=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},i),h.forEach(P=>{P.onopen=()=>{if(u)return;const j=Date.now()-U;R.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),h.filter(W=>W!==P).forEach(W=>{R.debug("[choose-best-ws]close backup websocket: ".concat(W.url)),W.close()}),u=!0,s(P)},P.onclose=j=>{g=j,!u&&(h.find(W=>!(W.readyState===WebSocket.CLOSED||W.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),u=!0,c(g)))},P.onmessage=j=>{R.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(j.data))}}),yr(this.forceCloseTimeout).then(()=>{h.forEach(P=>{P.readyState!==WebSocket.OPEN&&P.close()})})}if(x){var C;let U;R.debug("[choose-best-ws] use single url: ",r),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[r],service:"gateway"},i);try{U=new WebSocket(r),h.push(U),U.binaryType="arraybuffer"}catch(P){const j=new pe($.WS_ERR,"init websocket failed! Error: ".concat(P.toString()));return R.error("[".concat(this.name,"]").concat(j)),void c(j)}U.onopen=()=>{s(U)},U.onclose=P=>{c(P)},U.onmessage=P=>{R.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(P.data))},yr(this.forceCloseTimeout).then(()=>{U&&U.readyState!==WebSocket.OPEN&&U.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class H6 extends An{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===kt.CONNECTED?this.emit(ze.WS_CONNECTED):r===kt.RECONNECTING?this.emit(ze.WS_RECONNECTING,this._websocketReconnectReason):r===kt.CLOSED&&this.emit(ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),L(this,"__name__","AgoraRTCSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",kt.CLOSED),L(this,"reconnectToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new QR(5)),L(this,"pingpongTimer",void 0),L(this,"wsInflateDataTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"ortc",void 0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(ze.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===ft.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ft.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Dt.UID_BANNED);break;case 15:this.close(Dt.IP_BANNED);break;case 16:this.close(Dt.CHANNEL_BANNED)}if(c._type===ft.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ze.ERR_LICENSE_MISSING:this.close(Dt.LICENSE_MISSING);break;case Ze.ERR_LICENSE_EXPIRED:this.close(Dt.LICENSE_EXPIRED);break;case Ze.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Dt.LICENSE_MINUTES_EXCEEDED);break;case Ze.ERR_LICENSE_PERIOD_INVALID:this.close(Dt.LICENSE_PERIOD_INVALID);break;case Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Dt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ze.ERR_LICENSE_ILLEGAL:this.close(Dt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new zA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===kt.CONNECTED&&this.reconnect("retry",$r.OFFLINE)})}async request(r,i,s,c){const u=Zt(6,""),h={_id:u,_type:r,_message:i},f=this.websocket.connectionID,g=()=>new De((U,P)=>{if(this.connectionState===kt.CONNECTED)return U();const j=()=>{this.off(ze.WS_CLOSED,W),U()},W=()=>{this.off(ze.WS_CONNECTED,j),P(new ce($.WS_ABORT))};this.once(ze.WS_CONNECTED,j),this.once(ze.WS_CLOSED,W),r!==Ye.PUBLISH&&r!==Ye.PUBLISH_DATASTREAM&&r!==Ye.SUBSCRIBE&&r!==Ye.SUBSCRIBE_DATASTREAM&&r!==Ye.UNSUBSCRIBE&&r!==Ye.UNSUBSCRIBE_DATASTREAM&&r!==Ye.UNPUBLISH&&r!==Ye.UNPUBLISH_DATASTREAM&&r!==Ye.CONTROL&&r!==Ye.RESTART_ICE||this.once(ze.DISCONNECT_P2P,()=>{P(new ce($.DISCONNECT_P2P))}),r!==Ye.PUBLISH&&r!==Ye.RESTART_ICE||this.once(ze.ABORT_P2P_EXECUTION,()=>{P(new ce($.DISCONNECT_P2P))})});if(this.connectionState!==kt.CONNECTING&&this.connectionState!==kt.RECONNECTING||r===Ye.JOIN||r===Ye.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const v=new De((U,P)=>{let j=!1;const W=(J,re)=>{j=!0,U({isSuccess:J==="success",message:re||{}}),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.emit(ze.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),W);const K=()=>{P(new ce($.WS_ABORT,"type: ".concat(r))),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.off("res-@".concat(u),W)};this.once(ze.WS_CLOSED,K),this.once(ze.WS_RECONNECTING,K),yr(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||j||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(ze.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(U){if(this.connectionState===kt.CLOSED||r===Ye.LEAVE)throw new ce($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?U.throw():r===Ye.JOIN||r===Ye.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const x=Number(_.message.error_code||_.message.code),S=Bu(x),C=new ce($.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:x,data:_.message,desc:S.desc});return S.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(x,", message: ").concat(S.desc,", action: ").concat(S.action)),x===Ze.ERR_TOO_MANY_BROADCASTERS?((r===Ye.JOIN||r===Ye.REJOIN)&&(this.initError=C,this.close()),C.throw()):S.action==="failed"?C.throw():S.action==="quit"?(this.initError=C,this.close(),C.throw()):(x===Ze.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$r.MULTI_IP)):this.reconnect(S.action,$r.SERVER_ERROR),r===Ye.JOIN||r===Ye.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new De(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Vu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==kt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const s={_type:r,_message:i};this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((i,s)=>{this.once(ze.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ze.WS_CLOSED,c=>s(this.initError||new ce($.WS_ABORT,c))),this.connectionState=kt.CONNECTING,this.websocket.init(r).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Dt.LEAVE,this.connectionState=kt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ze.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await er(this,ze.REQUEST_JOIN_INFO);this.store.joinReq();const i=await this.request(Ye.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!i)return this.emit(ze.REPORT_JOIN_GATEWAY,zb.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(ze.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ce($.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Cu(this,ze.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(Ye.REJOIN,r);return!!i&&(this.connectionState=kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(s=>{this.emit(ft.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(ft.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(ft.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(ft.MUTE_AUDIO,{uid:s.uid}):this.emit(ft.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(ft.MUTE_VIDEO,{uid:s.uid}):this.emit(ft.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(ft.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(ft.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(ft.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(ft.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(ft.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Ye.DOWNGRADE_CODEC,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Bu(r.code);if(r.code===28&&"detail"in r&&(R.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(ze.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?r.code===Ze.ERR_REPEAT_JOIN_CHANNEL&&G("IGNORE_UID_CHECK")?void this.close(Dt.UID_CONFLICT):(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Dt.UID_BANNED),void this.close()):r.code===Ze.K_VOS_FALLBACK&&"detail"in r?(R.info("[".concat(this.clientId,"] receive vos fallback notification: "),r.detail),r.detail==="FALLBACKCN"&&G("ENABLE_QUALITY_FALLBACK")?void er(this,ze.VOS_FALLBACK_PROMISE,r.detail).then(()=>{this.reconnect("recover",i.desc)}).catch(s=>{R.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),s)}):r.detail==="fallback_hls"&&G("ENABLE_FALLBACK_TO_HLS")?(this.emit(ze.VOS_FALLBACK,r.detail),void this.close(Dt.FALLBACK_TO_HLS)):this.reconnect(i.action,i.desc)):void this.reconnect(i.action,$r.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=G("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$r.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),G("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(Vu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,r=>{this.emit(ze.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=kt.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Dt.NETWORK_ERROR,this.connectionState=kt.CLOSED}),this.websocket.on(_t.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===kt.CONNECTED?this.connectionState=kt.RECONNECTING:this.connectionState=kt.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(r,i,s)=>{const c=Cu(this,ze.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=zb.P2P_DISCONNECTED),u&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(ze.REPORT_JOIN_GATEWAY,i||zb.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ze.DISCONNECT_P2P)),s(r)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",$r.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(ze.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof ce){if(r.code===$.UNEXPECTED_RESPONSE&&r.data.code===Ze.ERR_NO_AUTHORIZED)return this.initError=new ce($.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Dt.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$r.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(_t.REQUEST_NEW_URLS,(r,i)=>{er(this,ze.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(lr.PRE_CONNECT_PC,()=>{this.emit(ze.PRE_CONNECT_PC)}),this.websocket.on(_t.ON_FALLBACK,()=>{G("ENABLE_FALLBACK_TO_HLS")&&this.emit(ze.VOS_FALLBACK,"fallback_hls")})}}let hve=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),qn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function z6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function qb(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?z6(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):z6(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let KA=0;function Hs(t){const r=G("TURN_DOMAINS");KA=(KA+1)%r.length;const i=r[KA]||"edge.agora.io";return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(i):(R.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function Xb(t){try{const r=G("TURN_DOMAINS"),i=G("GATEWAY_DOMAINS").concat(r).find(s=>Te(t).call(t,s));return i?t.split(".".concat(i))[0].replace(/-/g,"."):t}catch{return R.debug("serverUrlToIp error, fallback to url",t),t}}function YA(t,r){t.addresses||(t.addresses=[]);const i=function(f,g){if(G("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return f.map(x=>{let{ip:S,port:C}=x;return{address:"".concat(S,":").concat(C)}});const v=G("GATEWAY_DOMAINS");let _=v[1]&&Te(g).call(g,v[1])?1:0;return f.map(x=>{let{domain_prefix:S,port:C,ip:U}=x;if(S)return{address:"".concat(S,".").concat(v[_++%v.length],":").concat(C)};const P=/^[\.\:\d]+$/.test(U),j=P?"".concat(U.replace(/[^\d]/g,"-"),".").concat(v[_++%v.length],":").concat(C):"".concat(U,":").concat(C);return P||R.debug("Cannot recognized as ip address: ".concat(U,", use as host3")),{ip:U,port:C,address:j}})}(t.addresses,r),s=Array.isArray(t.detail)&&t.detail[18];if(s&&typeof s=="string"){const f=s.split(";");for(let g=0;g<f.length;g++){var c;const v=xi(c=f[g]).call(c);i[g]&&v&&(i[g].ip6=v)}}const u=t.detail&&t.detail.candidate;let h;if(u){const[f,g]=u.split(":");f&&g&&(h={port:Number(g),ip:f,address:"".concat(f,":").concat(g)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Bi(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function K6(t){const r=t._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(Bi(r.width),"x").concat(Bi(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function Jb(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Zg(t,r){let i,s,c;switch(r){case qn.CHOOSE_SERVER:s=4096,c="choose server";break;case qn.CLOUD_PROXY:s=1048576,c="proxy";break;case qn.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case qn.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new ce($.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(u=>{u.buffer&&u.buffer.flag===s&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>qb(qb({},h),{},{ticket:u.buffer.cert})),server_ts:t.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:qb(qb({},u.buffer.detail),t.detail),flag:u.buffer.flag,opid:t.opid,cert:u.buffer.cert})}),!i)throw new ce($.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return i}async function Y6(t,r){return await De.all(t.addresses.map(async i=>({address:Hs(i.ip),tcpport:i.port,udpport:i.port,username:r&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Hr.username,password:r&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await HR(r.toString()):Hr.password})))}function qA(t,r){const i=r.getMediaStreamTrack(!0).getSettings(),s=r.videoHeight||i.height,c=r.videoWidth||i.width;return s&&c?Math.max(Math.min(s,c)/Math.min(Bi(t.height),Bi(t.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function od(t){let{candidateType:r,relayProtocol:i,type:s,address:c,port:u,protocol:h}=t;const f={candidateType:r,relayProtocol:i,protocol:h};if(s!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),f.address=g.join("."),f.port=u}return f}function bc(t){const r=t.split(":"),i=t.split(/[-.]/),s=Te(t).call(t,"-")?"-":".";let c=t;return r.length>1?i.length>1?(i[1]="**",c=i[0]+s+"**:"+r[r.length-1]):c=r.length>2?r[0]+s+"**:"+r[r.length-1]:"**:"+r[r.length-1]:i.length>1&&(c=i[0]+s+"**"),c}function q6(t,r){return t.getTransceivers().find(i=>i.sender.track===r||i.receiver.track===r)}function ev(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G("SVC_MODE");if(G("ENABLE_SVC"))return function(r){return r in Eb}(t)?t:Eb.L1T3}const X6={[Ge.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Ge.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function J6(t){t.send&&(Zp(Ge.VIDEO,t.send.videoExtensions),Zp(Ge.AUDIO,t.send.audioExtensions)),t.recv&&(Zp(Ge.VIDEO,t.recv.videoExtensions),Zp(Ge.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(Zp(Ge.VIDEO,t.sendrecv.videoExtensions),Zp(Ge.AUDIO,t.sendrecv.audioExtensions))}function Q6(t,r){t.send&&(Qb(Ge.VIDEO,t.send.videoExtensions,r.send.videoExtensions),Qb(Ge.AUDIO,t.send.audioExtensions,r.send.audioExtensions)),t.recv&&(Qb(Ge.VIDEO,t.recv.videoExtensions,r.recv.videoExtensions),Qb(Ge.AUDIO,t.recv.audioExtensions,r.recv.audioExtensions))}function Qb(t,r,i){r.forEach(s=>{var c;const u=X6[t].find(f=>{var g;let{key:v}=f;return Te(g=s.extensionName).call(g,v)});if(!u)return;const h=i.find(f=>{let{extensionName:g}=f;return Te(g).call(g,u.key)});h&&Te(c=h.extensionName).call(c,"gdpr_forbidden")&&(s.extensionName=h.extensionName)})}function Zp(t,r){r.forEach(i=>{var s;const c=X6[t].find(u=>{var h;let{key:f}=u;return Te(h=i.extensionName).call(h,f)});Te(s=i.extensionName).call(s,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function Z6(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Te(t).call(t,"abs-send-time")}function Zb(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Te(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function e8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function t8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?e8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function tv(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:f,filterVideoCodec:g,unsupportedVideoUplinkCodec:v,unsupportedVideoDownlinkCodec:_}=r,{useXR:x}=i;let S=[],C=[],U=[],P=[],j=!1,W=!1;if(Ti(t).mediaDescriptions.forEach(J=>{s&&s!==J.attributes.direction||(J.media.mediaType!=="video"||j||(C=J.attributes.payloads,P=J.attributes.extmaps,j=!0),J.media.mediaType!=="audio"||W||(S=J.attributes.payloads,U=J.attributes.extmaps,W=!0))}),!P||C.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!U||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(C.forEach(J=>{var re;(re=J.rtpMap)!==null&&re!==void 0&&re.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),x&&J.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(J=>{var re;(re=J.rtpMap)!==null&&re!==void 0&&re.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),x&&J.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(J=>{var re;return((re=J.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())!=="rtx"}),C=C.filter(J=>{var re;return((re=J.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())!=="rtx"})),u){const J=C.filter(Z=>{var se;return/(red)|(ulpfec)|(flexfec)/i.test(((se=Z.rtpMap)===null||se===void 0?void 0:se.encodingName)||"")}),re=cd(J,C).map(Z=>Z.payloadType),ie=[...J.map(Z=>Z.payloadType),...re];C=C.filter(Z=>!Te(ie).call(ie,Z.payloadType))}if(h&&(S=S.filter(J=>{var re;return!/(red)|(ulpfec)|(flexfec)/i.test(((re=J.rtpMap)===null||re===void 0?void 0:re.encodingName)||"")})),f&&(f==null?void 0:f.length)>0&&(S=S.filter(J=>{var re;return Te(f).call(f,((re=J.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0){const J=C.filter(re=>{var ie;return Te(g).call(g,((ie=re.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLowerCase())||"")});C=J.concat(c?[]:cd(J,C))}const K=G("UNSUPPORTED_VIDEO_CODEC");if(K&&K.length>0){const J=C.filter(Z=>Z.rtpMap&&Te(K).call(K,Z.rtpMap.encodingName.toLowerCase())),re=cd(J,C),ie=J.concat(re).map(Z=>Z.payloadType);C=C.filter(Z=>!Te(ie).call(ie,Z.payloadType)),R.debug("unsupportedVideoCodec: ".concat(K,", toBeRemoved: ").concat(ie))}if(v&&v.length>0&&s==="sendonly"){const J=C.filter(Z=>Z.rtpMap&&Te(v).call(v,Z.rtpMap.encodingName.toLowerCase())),re=cd(J,C),ie=J.concat(re).map(Z=>Z.payloadType);C=C.filter(Z=>!Te(ie).call(ie,Z.payloadType)),R.debug("unsupportedVideoUplinkCodec: ".concat(v,", toBeRemoved: ").concat(ie))}if(_&&_.length>0&&s==="recvonly"){const J=C.filter(Z=>Z.rtpMap&&Te(_).call(_,Z.rtpMap.encodingName.toLowerCase())),re=cd(J,C),ie=J.concat(re).map(Z=>Z.payloadType);C=C.filter(Z=>!Te(ie).call(ie,Z.payloadType)),R.debug("unsupportedVideoDownlinkCodec: ".concat(_,", toBeRemoved: ").concat(ie))}return{audioCodecs:S,videoCodecs:C,audioExtensions:U,videoExtensions:P}}function Ec(t){const r=Ti(t);let i,s;for(const c of r.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!s){const u=c.attributes.fingerprints;u.length>0&&(s={fingerprints:u})}}if(!s&&r.attributes.fingerprints.length>0&&(s={fingerprints:r.attributes.fingerprints}),!s||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:s}}function XA(t,r){const i=[],s=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var f;const g=(f=s.find(v=>v.ssrcIds[0]===h))===null||f===void 0?void 0:f.ssrcIds[1];i.push({ssrcId:h,rtx:r?g:void 0})});else if(s.length>0){const h=s[0].ssrcIds[0],f=s[0].ssrcIds[1];i.push({ssrcId:h,rtx:r?f:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function n8(t,r,i){const{cname:s}=t;let c=[];r&&(c=r8(r)),c.length===0&&(c=t.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),R.debug("Using candidates from gateway."));const u={fingerprints:t.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let f;switch(t.dtlsParameters.role){case"server":f="passive";break;case"client":f="active";break;case"auto":f="actpass"}const g=rv(t.rtpCapabilities),v=[];return Array.isArray(i)&&i.length>0&&i.forEach(_=>{v.push({kind:Ge.VIDEO,ssrcMsg:[{ssrcId:_.v,rtx:_.v_rtx}],mslabel:"".concat(_.v,"_").concat(_.a)},{kind:Ge.AUDIO,ssrcMsg:[{ssrcId:_.a}],mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:g,setup:f,cname:s,preSSRCs:v}}function r8(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(bc(t.ip),":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(bc(t.ip6),":").concat(t.port)))),r}function nv(t,r,i){const s=[],c=[];return t.forEach(u=>{let{ssrcId:h,rtx:f}=u;const g=Zt(8,"track-"),v={ssrcId:h,attributes:t8({label:g,mslabel:i=i||Zt(10,""),msid:"".concat(i," ").concat(g)},r&&{cname:r})};if(s.push(v),f!==void 0){const _={ssrcId:f,attributes:t8({label:g,mslabel:i,msid:"".concat(i," ").concat(g)},r&&{cname:r})};s.push(_),c.push({semantic:"FID",ssrcIds:[h,f]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:s,ssrcGroups:c}}function Gu(t,r){r instanceof Vn&&t.attributes.payloads.forEach(i=>{var s;const c=(s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),c==="opus"&&typeof G("OPUS_PTIME")=="number"?i.fmtp.parameters.ptime=G("OPUS_PTIME"):i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!bn()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1")),r instanceof Xg&&c==="opus"&&r._config.DTX&&(i.fmtp.parameters.usedtx="1"))})}function JA(t){const r=t.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function QA(t,r){var i;if(t.attributes.payloads.forEach(c=>{var u;((u=c.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())==="h264"&&c.fmtp&&c.fmtp.parameters&&G("ENABLE_UP_SPS_PPS")&&(c.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(r instanceof dn&&r._encoderConfig&&r._hints.indexOf(Jt.SCREEN_TRACK)===-1))return;const s=r._encoderConfig;It().supportMinBitrate&&s.bitrateMin&&t.attributes.payloads.forEach(c=>{var u,h;Te(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),It().supportMinBitrate&&!Te(i=r._hints).call(i,Jt.LOW_STREAM)&&s.bitrateMax&&t.attributes.payloads.forEach(c=>{var u,h;Te(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(G("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function i8(t){if(t.media.mediaType!=="video")return;const r=Bt();if(r.name!==Ht.SAFARI&&r.os!==vr.IOS)return;const i=t.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));i!==-1&&t.attributes.extmaps.splice(i,1)}function eE(t,r,i){if(!r)return;let s,c;if(t.media.mediaType==="video"?(s=i.videoExtensions,c=i.videoCodecs):(s=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const u=s.find(h=>Zb(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(g=>Zb(g.extensionName))||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(g,v){return v.filter(_=>!!g.find(x=>x.payloadType===_.payloadType&&!!x.rtcpFeedbacks.find(S=>S.type==="transport-cc")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(v=>v.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=t.attributes.extmaps.findIndex(h=>Zb(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}if(r.remb===!0){const u=s.find(h=>Z6(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(g=>g.extensionName===h)||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(g,v){return v.filter(_=>!!g.find(x=>x.payloadType===_.payloadType&&!!x.rtcpFeedbacks.find(S=>S.type==="goog-remb")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(v=>v.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=t.attributes.extmaps.findIndex(h=>Z6(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}}function ZA(t,r,i){if(bn()||t.media.mediaType!=="video"||!(r instanceof dn)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!G("SIMULCAST")||i==="vp9"&&G("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const s=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],u=t.attributes.ssrcGroups.find(f=>f.semantic==="FID"&&f.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let f=1;f<s;f++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+f,attributes:En(c.attributes)}),h.ssrcIds.push(c.ssrcId+f),u&&(t.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+f,attributes:En(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+f,u.ssrcIds[1]+f]}));t.attributes.ssrcGroups.unshift(h)}async function a8(){try{const t=new RTCPeerConnection;t.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Eb.L1T3}]});const r=await t.createOffer();if(!r.sdp)return void t.close();const i=Ti(r.sdp).mediaDescriptions[0];if(!i)return;const s=i.attributes.extmaps.find(c=>c.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return t.close(),s}catch{return}}async function eI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const _=tv(v,f,g,"sendonly"),x=tv(v,f,g,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zs(_,x,"videoExtensions",S,C,U),zs(_,x,"videoCodecs",S,C,U),zs(_,x,"audioExtensions",S,C,U),zs(_,x,"audioCodecs",S,C,U),G("RAISE_H264_BASELINE_PRIORITY")){const P=[],j=[];if(U.videoCodecs.forEach((W,K)=>{var J;if(((J=W.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"){var re,ie;const Z=U.videoCodecs[K+1],se=Z&&l8(W,Z),ge=(re=W.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"],Ee=(ie=W.fmtp)===null||ie===void 0?void 0:ie.parameters["packetization-mode"];!ge||ge!==G("FIRST_H264_PROFILE_LEVEL_ID")||G("FIRST_PACKETIZATION_MODE")&&Ee!==G("FIRST_PACKETIZATION_MODE")?se?j.push([W,Z]):j.push([W]):se?P.push([W,Z]):P.push([W])}}),P.length>0&&j.length>0){R.debug("raising H264 baseline profile priority"),U.videoCodecs.forEach((K,J)=>{var re;if(((re=K.rtpMap)===null||re===void 0?void 0:re.encodingName.toLocaleLowerCase())==="h264"){const ie=l8(K,U.videoCodecs[J+1]),Z=P.shift()||j.shift()||[];Z.length>0&&(ie?U.videoCodecs.splice(J,2,...Z):U.videoCodecs.splice(J,1,...Z))}});const W=C.videoCodecs.filter(K=>{var J,re;return((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((re=K.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID")});if(W.length>0){const K=cd(W,C.videoCodecs).map(re=>re.payloadType),J=[...W.map(re=>re.payloadType),...K];C.videoCodecs=C.videoCodecs.filter(re=>!Te(J).call(J,re.payloadType))}G("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(K=>{var J,re;return!(((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((re=K.fmtp)===null||re===void 0?void 0:re.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:S,recv:C,sendrecv:U}}return{send:S,recv:C,sendrecv:U}}(t,r,s);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function s8(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=tv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zs(t,r,"videoExtensions",i,s,c),zs(t,r,"videoCodecs",i,s,c),zs(t,r,"audioExtensions",i,s,c),zs(t,r,"audioCodecs",i,s,c),G("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){R.debug("raising H264 baseline profile priority");const f=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,f)}h!==-1&&(s.videoCodecs=s.videoCodecs.filter(f=>!(f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:s,sendrecv:c}}function zs(t,r,i,s,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return t[i].forEach(f=>{r[i].some((g,v)=>{if(f.entry===g.entry&&f.extensionName===g.extensionName)return h.push(v),!0})?u[i].push(f):s[i].push(f)}),void r[i].forEach((f,g)=>{h.indexOf(g)===-1&&c[i].push(f)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return t[i].forEach(f=>{r[i].some((g,v)=>{if(f.payloadType===g.payloadType&&JSON.stringify(f)===JSON.stringify(g))return h.push(v),!0})?u[i].push(f):s[i].push(f)}),void r[i].forEach((f,g)=>{h.indexOf(g)===-1&&c[i].push(f)})}}function rv(t){const{send:r,recv:i,sendrecv:s}=t;if(!s){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...s.audioCodecs],c.videoCodecs=[...r.videoCodecs,...s.videoCodecs],c.audioExtensions=[...r.audioExtensions,...s.audioExtensions],c.videoExtensions=[...r.videoExtensions,...s.videoExtensions]):c=En(s),i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...s.audioCodecs],u.videoCodecs=[...i.videoCodecs,...s.videoCodecs],u.audioExtensions=[...i.audioExtensions,...s.audioExtensions],u.videoExtensions=[...i.videoExtensions,...s.videoExtensions]):u=En(s),{send:c,recv:u}}function ef(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function iv(t,r,i,s){let c=[];if(t===Ge.VIDEO){if(G("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return Te(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,s)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===G("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],f=[],g=[];if(i.videoCodecs.forEach(v=>{const _=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";Te(_).call(_,s)?u.push(v):Te(_).call(_,"vp9")?h.push(v):Te(_).call(_,"vp8")?f.push(v):Te(_).call(_,"h264")&&g.push(v)}),u.length===0){let v="";h.length!==0?(u=h,v="vp9"):f.length!==0?(u=f,v="vp8"):g.length!==0&&(u=g,v="h264"),R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=r.videoCodecs.filter(v=>u.some(_=>_.payloadType===v.payloadType)))}if(c.length===0&&(R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),G("USE_PUB_RTX")||G("USE_SUB_RTX")){const u=cd(c,r.videoCodecs);c=[...c,...u]}}else{c=r.audioCodecs.filter(h=>{var f;return Te(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,s)});const u=r.audioCodecs.filter(h=>{var f;return Te(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,"red")});c.length===0&&(R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(h=>{var f;return Te(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,"opus")})),G("ENABLE_AUDIO_RED")&&u.length!==0&&(c=[...u,...c])}return c}function cd(t,r){const i=t.map(s=>s.payloadType.toString());return r.filter(s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&Te(i).call(i,s.fmtp&&s.fmtp.parameters.apt))}async function ea(t,r,i){const s=r.toString(),c=o8(s,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:s});const u=await t.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=tI(h,i||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function tI(t,r,i){if(G("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const s=Ti(t),{useXR:c}=r;return s.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!Te(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&ef(u),u.media.mediaType==="video"&&function(f){f.media.mediaType==="video"&&G("ENABLE_DOWN_SPS_PPS")&&f.attributes.payloads.filter(g=>{var v;return((v=g.rtpMap)===null||v===void 0?void 0:v.encodingName.toLowerCase())==="h264"}).forEach(g=>{g.fmtp||(g.fmtp={parameters:{}}),g.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(u),c&&Te(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(f=>{f.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&f.rtcpFeedbacks.push({type:"rrtr"})})))}),rl(s)}function o8(t,r,i,s){if(G("SDP_LOGGING"))return R.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(s,`
`),t),r==="offer"?c=>{o8(c,"answer",i==="local"?"remote":"local",s)}:void 0}async function c8(t,r,i){try{var s;if(!It().supportSetRtpSenderParameters||!function(g){return g==="vp9"||g==="av1"}(t)||!G("ENABLE_SVC"))return;const c={},u={},h=r.getParameters(),f=(s=h.encodings)===null||s===void 0?void 0:s[0];u.scalabilityMode=ev(i),f&&Object.assign(f,u),Object.assign(h,c),await r.setParameters(h),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(h.encodings)))}catch(c){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",c)}}function tE(t){const r=G("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>Te(t).call(t,i))}function l8(t,r){try{var i;return((i=t.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function d8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Sa(t,r){return typeof G(t)===r?G(t):void 0}function pve(){try{const t=G("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?d8(Object(s),!0).forEach(function(c){L(r,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):d8(Object(s)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(s,c))})}return r}({},t)}catch(t){return R.debug("handle gateway attributes failed: ",t),{}}}const u8={};function xc(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(t.name)),u8[t.name]=t}function Do(t){const r=u8[t];if(!r)throw new pe($.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function h8(t,r){return Do("DataStream").create(t,r)}function nE(){return Do("InterceptFrame").create()}function p8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Or(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?p8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const nI=new Map;class fve extends An{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit($n.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit($n.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var s,c,u;super(),L(this,"store",void 0),L(this,"joinInfo",void 0),L(this,"key",void 0),L(this,"ntpOffset",0),L(this,"usingProxy",!1),L(this,"signal",void 0),L(this,"role",void 0),L(this,"isPreallocation",void 0),L(this,"isPreSub",void 0),L(this,"inChannelInfo",{joinAt:null,duration:0}),L(this,"spec",void 0),L(this,"_state","DISCONNECTED"),L(this,"_statsCollector",void 0),L(this,"_disconnectedReason",void 0),L(this,"isSignalRecover",!1),L(this,"hasChangeBGPAddress",!1),L(this,"trafficStatsInterval",void 0),L(this,"networkQualityInterval",void 0),L(this,"_joinGatewayStartTime",0),L(this,"_signalTimeout",!1),L(this,"_clientRoleOptions",void 0),L(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(s={spec:Or(Or({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(u=Do("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,s)):this.store.useDcSignal?function(h){return Do("DataChannelSignal").create(h)}({spec:Or(Or({},i),{},{retryConfig:i.websocketRetryConfig}),store:r}):new H6(Or(Or({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(r){this.usingProxy=r}async join(r,i,s){if(this.store.useDcSignal){let _=!1;r.cloudProxyServer!=="disabled"?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(r.cloudProxyServer,")")),_=!0):"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length>255||"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length<22?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):r.apResponse.addresses.some(x=>x.fingerprint)||G("FINGERPRINT")||(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&this.resetSignal()}this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=nI.get(r.cname);if(u||(u=new Map,nI.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const _=new ce($.UID_CONFLICT);throw $e.joinGateway(r.sid,{lts:c,succ:!1,ec:_.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:r.preload}),_}u.set(r.uid,!0),this.joinInfo=r,this.key=i;let h=0;this.joinGatewayStartTime=c;const f=r.proxyServer,g=this.store.useDcSignal?"datachannel":"websocket";try{R.debug("[".concat(this.store.clientId,"] use ").concat(g," join uid ").concat(h));const _=r.gatewayAddrs.map(S=>{let{address:C}=S;const[U,P]=C.split(":"),j={host:U,port:P};return r.proxyServer&&(j.proxy=r.proxyServer),j});let x;x=this.store.useDcSignal?await this.signal.init(r.apResponse.addresses):await this.signal.init(_),h=x.uid,R.debug("[".concat(this.store.clientId,"] ").concat(g," join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var v;throw _.code===$.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||$e.joinGateway(r.sid,{lts:c,succ:!1,ec:((v=_.data)===null||v===void 0?void 0:v.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!f||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:r.preload}),_&&_.code===$.INIT_DATACHANNEL_TIMEOUT?(R.warning("[".concat(this.store.clientId,"] User join datachannel failed"),_.toString()),this.resetSignal(),_):(R.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),u.delete(r.uid),this.signal.close(),_)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit($n.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit($n.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit($n.NETWORK_QUALITY,{uplinkNetworkQuality:Jb(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Jb(this._statsCollector.trafficStats.B_dnq)}):this.emit($n.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Dt.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==kt.CONNECTED||await function(s,c){return c===1/0?s:De.race([s,Bme(c)])}(this.signal.request(Ye.LEAVE,void 0,!0),3e3)}catch(s){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(i),i!==Dt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:G("PUB_EXTEND"),twcc:!!G("PUBLISH_TWCC"),rtx:!!G("USE_PUB_RTX")};try{return(await this.signal.request(Ye.PUBLISH,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===Ze.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw u}}async publishDataChannel(r,i,s){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Ye.PUBLISH_DATASTREAM,u,!0)}catch(h){if(s&&h.data&&h.data.code===Ze.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw h}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ye.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(s){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(r.map(i=>this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){R.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX")||void 0,extend:G("SUB_EXTEND"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Ye.PRE_SUBSCRIBE,c,!0)}catch(u){if(s&&u.data&&u.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,i,!1);throw u}}async subscribe(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX"),extend:G("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return(await this.signal.request(Ye.SUBSCRIBE,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw u}}async subscribeDataChannel(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Ye.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(s&&u.data&&u.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw u}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!G("USE_SUB_RTX"),twcc:!!G("SUBSCRIBE_TWCC"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Ye.SUBSCRIBE_STREAMS,s,!0)}catch(c){if(i&&c.data&&c.data.code===Ze.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let c=s.frameRate,u=s.width,h=s.height,f=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(f=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(f=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(f=!1)),f?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0}(r);if(i)return this.signal.request(Ye.SET_VIDEO_PROFILE,i);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(s){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(r.map(s=>this.signal.request(Ye.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:i},!0)))}catch(s){R.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(r){try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Ye.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ye.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Ye.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),G("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),G("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let s,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const u=Object.assign({},i);delete u.delay,delete u.level,await this.signal.request(Ye.SET_CLIENT_ROLE,Or(Or({role:r,level:c,delay:s},u),{},{client_ts:Date.now()})),this.role=r}async setDualStreamMode(r,i,s){await this.signal.request(Ye.SET_DUAL_STREAM_MODE,{mode:r},s,i)}async setRemoteVideoStreamType(r,i){await this.signal.request(Ye.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Ye.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(Ye.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(Ye.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Ye.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Or({},this.inChannelInfo)}async setConfigure(r){if(r&&Array.isArray(r)&&r.length!==0)return this.signal.request(Ye.CONFIGURE,r)}async getGatewayVersion(){return(await this.signal.request(Ye.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=nI.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let s;return s=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:Hr.username,password:Hr.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Or(Or({},Hr),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Ye.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);s&&s.B_st!==i.B_st&&vb(()=>{this.emit($n.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var i,s,c,u;if(!this.joinInfo||!this.key)throw new ce($.UNEXPECTED_ERROR,"can not generate join message, no join info");const h=Object.assign({},this.joinInfo.apResponse);let f=G("REPORT_APP_SCENARIO");if(typeof f!="string")try{f=JSON.stringify(f)}catch{f=void 0}var g;f&&f.length>128&&(f=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit($n.UPDATE_GATEWAY_CONFIG),g=this.store.clientId,Te(Yp).call(Yp,g)||Yp.push(g);const v=Yg(this.store),_=!((i=this.isPreallocation)===null||i===void 0||!i.call(this)),x=pV(this.store),S=pve(),C=No(87)||_F()||FR(117),U=(function(){const K=Bt();if(K.name!==Ht.SAFARI||!K.browserVersion)return!1;const J=K.browserVersion.split(".");return Number(J[0])>18||Number(J[0])===18&&Number(J[1])>=4}()||SF(18,4,!1))&&VR(18,6,!0)&&this.spec.codec==="h264"&&G("ENABLE_ABSSENDTIME_AS_SENTTS"),P=!(((s=h.detail)===null||s===void 0?void 0:s[3])!=="CN"||!G("ENABLE_QUALITY_FALLBACK"))&&G("ENABLE_QUALITY_FALLBACK"),j=!!G("ENABLE_AP_MULTI_IP")&&((c=h.detail)===null||c===void 0?void 0:c[5])==="multi-ip",W=Or({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:os,browser:navigator.userAgent,process_id:G("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:j||this.hasChangeBGPAddress,ap_response:h,extend:G("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:f,attributes:{userAttributes:Or(Or({enableEncodedTransform:(!!G("ENABLE_AUDIO_METADATA")||!!G("ENABLE_AUDIO_PTS"))&&C||!!G("ENABLE_AUDIO_TOPN")&&UR(Ht.CHROME,87,116)||void 0,enableAudioMetadata:!!G("ENABLE_AUDIO_METADATA")&&C,enableAudioPts:!!G("ENABLE_AUDIO_PTS")&&C,topnSmoothLevel:G("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:G("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:G("TOPN_SWITCH_HOLD_MS"),topnAudioGain:G("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:G("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:G("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Sa("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Sa("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Sa("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:G("USE_PUB_RTX")===!0||G("USE_SUB_RTX")===!0||void 0,disableFEC:G("DISABLE_FEC"),enableNTPReport:!!G("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:x,enableFulllinkAvSync:!!G("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Sa("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!G("FORCE_ENABLE_AUT_CC")||!Cb()&&(!!G("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!G("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Sa("USE_XR","boolean"),enableLossbasedBwe:Sa("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!G("FORCE_ENABLE_AUT_CC")||!Cb()&&(!!G("ENABLE_AUT_CC")||void 0),enableCCFallback:Sa("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:_,preSubNum:v?Sa("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Sa("PUBLISH_TWCC","boolean"),enableSubTWCC:Sa("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Sa("USE_PUB_RTX","boolean"),enableSubRTX:Sa("USE_SUB_RTX","boolean"),enableSubSVC:G("ENABLE_SVC")?G("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0,enableSvcExtended:G("ENABLE_SVC")&&Array.isArray(G("SVC_EXTENDED"))&&G("SVC_EXTENDED").length!==0?G("SVC_EXTENDED"):void 0,enableVosFallback:G("ENABLE_VOS_FALLBACK"),enableQualityFallback:P},S),{},{audioDuplicate:Sa("ENABLE_AUDIO_RED","boolean")?(u=Sa("AUDIO_DUPLICATE_NUM","number"))!==null&&u!==void 0?u:2:void 0,senttsUsesAbsSendTime:!!U||void 0,enableDualStreamFlag:Sa("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(W.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(W.aes_mode=this.joinInfo.aesmode,G("ENCRYPT_AES")?(W.aes_secret=this.joinInfo.aespassword,W.aes_encrypt=!0):W.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(W.aes_salt=this.joinInfo.aessalt)),h.addresses[this.signal.websocket.currentURLIndex]&&(W.ap_response.ticket=h.addresses[this.signal.websocket.currentURLIndex].ticket,delete h.addresses),this.joinInfo.defaultVideoStream!==void 0&&(W.default_video_stream=this.joinInfo.defaultVideoStream),W}getRejoinMessage(){if(!this.joinInfo)throw new ce($.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ze.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ze.WS_RECONNECTING,r=>{this.joinInfo&&$e.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||$r.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",$e.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ze.WS_CLOSED,r=>{let i;switch(r){case Dt.LEAVE:i=$r.LEAVE;break;case Dt.UID_BANNED:case Dt.IP_BANNED:case Dt.CHANNEL_BANNED:case Dt.SERVER_ERROR:i=$r.SERVER_ERROR;break;case Dt.FALLBACK:i=$r.FALLBACK;break;case Dt.LICENSE_MISSING:case Dt.LICENSE_EXPIRED:case Dt.LICENSE_MINUTES_EXCEEDED:case Dt.LICENSE_PERIOD_INVALID:case Dt.LICENSE_MULTIPLE_SDK_SERVICE:case Dt.LICENSE_ILLEGAL:case Dt.TOKEN_EXPIRE:i=r;break;default:i=$r.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+$r.NETWORK_ERROR)),this.joinInfo&&$e.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Dt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==Dt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ze.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=G("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if($e.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));an("EVENT_REPORT_DOMAIN",r[1]),an("EVENT_REPORT_BACKUP_DOMAIN",r[1]),an("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(ft.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(ze.REQUEST_RECOVER,(r,i,s)=>{if(!this.joinInfo)return s(new ce($.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,er(this,$n.REQUEST_NEW_GATEWAY_LIST).then(i).catch(s)}),this.signal.on(ze.REQUEST_JOIN_INFO,async(r,i,s)=>{var c,u,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const f=En((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(G("NEW_TURN_MODE")&&f&&((u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer)==="disabled"){var g;let S=f.servers.map(P=>"turnServerURL"in P&&G("USE_TURN_IP")?Or(Or({},P),{},{turnServerURL:Xb(P.turnServerURL)}):P),C=(g=f.serversFromGateway)===null||g===void 0?void 0:g.map(P=>G("USE_TURN_IP")?Or(Or({},P),{},{turnServerURL:Xb(P.turnServerURL)}):P);const U=this.signal.currentURLIndex;S.length>0&&(S=[S[U%S.length]],f.servers=S),Array.isArray(C)&&C.length>0&&(C=[C[0]],f.serversFromGateway=C),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(U))}const{iceParameters:v,dtlsParameters:_,rtpCapabilities:x}=await er(this,$n.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:f,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:v,dtlsParameters:_,rtpCapabilities:x,version:"2"}}))}catch(S){i(S)}}),this.signal.on(ze.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(ze.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let s,c="";var u;r instanceof ce?(s=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):s=r,$e.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(ze.IS_P2P_DISCONNECTED,r=>{r(Cu(this,$n.IS_P2P_DISCONNECTED))}),this.signal.on(ze.DISCONNECT_P2P,()=>{this.emit($n.DISCONNECT_P2P)}),this.signal.on(ze.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ze.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ze.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit($n.JOIN_RESPONSE,r,i)}),this.signal.on(ze.PRE_CONNECT_PC,async(r,i)=>{if(this.joinInfo){var s,c;this.updateTurnConfigFromSignal();const h=this.getCurrentGatewayAddress(),f=En((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(G("NEW_TURN_MODE")&&f&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var u;let v=f.servers.map(S=>"turnServerURL"in S&&G("USE_TURN_IP")?Or(Or({},S),{},{turnServerURL:Xb(S.turnServerURL)}):S),_=(u=f.serversFromGateway)===null||u===void 0?void 0:u.map(S=>G("USE_TURN_IP")?Or(Or({},S),{},{turnServerURL:Xb(S.turnServerURL)}):S);const x=this.signal.currentURLIndex;v.length>0&&(v=[v[x%v.length]],f.servers=v),Array.isArray(_)&&_.length>0&&(_=[_[0]],f.serversFromGateway=_),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(x,",in pre pc"))}const g=G("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(h&&g){const v=r8(h);er(this,$n.PRE_CONNECT_PC,{candidates:v,fingerprint:g,turnServer:f}).then(_=>{r==null||r(_)}).catch(i||(()=>{}))}}}),this.signal.on(ze.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof G("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(G("AP_REQUEST_DETAIL"),";").concat(r))}),this.signal.on(ze.VOS_FALLBACK,r=>{this.emit($n.VOS_FALLBACK,r)}),this.signal.on(ze.DATACHANNEL_FAILBACK,r=>{R.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit($n.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(Ye.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(s){throw R.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(Ye.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(s){throw R.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(r){const i={users:r.map(s=>({stream_id:s.stream_id,stream_type:s.stream_type}))};try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(r,i){const s={action:r.find(c=>c.stream_type===tn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Ye.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const s={action:r.find(c=>c.stream_type===tn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Ye.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const s={action:r===Ge.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Ye.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const s={action:r===Ge.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Ye.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Ye.RESTART_ICE,i,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||$r.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!G("GATEWAY_WSS_ADDRESS"))return G("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Ye.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Dt.FALLBACK)),this.store.useDcSignal=!1,this.signal=new H6(Or(Or({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit($n.RESET_SIGNAL)}}let rE=0,rI=0;function ko(t,r,i,s){return new De((c,u)=>{r.timeout=r.timeout||G("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),rE+=gc(r.data)):i&&(r.data.size?rE+=r.data.size:r.data instanceof FormData?rE+=WF(r.data):rE+=gc(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Mi.request(r).then(h=>{typeof h.data=="string"?rI+=gc(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?rI+=h.data.byteLength:rI+=gc(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Mi.isCancel(h)?u(new ce($.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new ce($.NETWORK_TIMEOUT,h.message)):h.response?u(new ce($.NETWORK_RESPONSE_ERROR,h.response.status)):u(new ce($.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(ve){var Oe=0;return function(){return Oe<ve.length?{done:!1,value:ve[Oe++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(ve,Oe,We){return ve==Array.prototype||ve==Object.prototype||(ve[Oe]=We.value),ve},s,c=function(ve){ve=[typeof globalThis=="object"&&globalThis,ve,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var Oe=0;Oe<ve.length;++Oe){var We=ve[Oe];if(We&&We.Math==Math)return We}throw Error("Cannot find global object")}(this);function u(ve,Oe){if(Oe)e:{var We=c;ve=ve.split(".");for(var _e=0;_e<ve.length-1;_e++){var I=ve[_e];if(!(I in We))break e;We=We[I]}(Oe=Oe(_e=We[ve=ve[ve.length-1]]))!=_e&&Oe!=null&&i(We,ve,{configurable:!0,writable:!0,value:Oe})}}function h(ve){return(ve={next:ve})[Symbol.iterator]=function(){return this},ve}function f(ve){var Oe=typeof Symbol<"u"&&Symbol.iterator&&ve[Symbol.iterator];return Oe?Oe.call(ve):{next:r(ve)}}if(u("Symbol",function(ve){function Oe(I,X){this.A=I,i(this,"description",{configurable:!0,writable:!0,value:X})}if(ve)return ve;Oe.prototype.toString=function(){return this.A};var We="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",_e=0;return function I(X){if(this instanceof I)throw new TypeError("Symbol is not a constructor");return new Oe(We+(X||"")+"_"+_e++,X)}}),u("Symbol.iterator",function(ve){if(ve)return ve;ve=Symbol("Symbol.iterator");for(var Oe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),We=0;We<Oe.length;We++){var _e=c[Oe[We]];typeof _e=="function"&&typeof _e.prototype[ve]!="function"&&i(_e.prototype,ve,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return ve}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var g;e:{var v={};try{v.__proto__={a:!0},g=v.a;break e}catch{}g=!1}s=g?function(ve,Oe){if(ve.__proto__=Oe,ve.__proto__!==Oe)throw new TypeError(ve+" is not extensible");return ve}:null}var _=s;function x(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(ve){if(ve.m)throw new TypeError("Generator is already running");ve.m=!0}function C(ve,Oe){return ve.h=3,{value:Oe}}function U(ve){this.g=new x,this.G=ve}function P(ve,Oe,We,_e){try{var I=Oe.call(ve.g.j,We);if(!(I instanceof Object))throw new TypeError("Iterator result "+I+" is not an object");if(!I.done)return ve.g.m=!1,I;var X=I.value}catch(te){return ve.g.j=null,ve.g.s(te),j(ve)}return ve.g.j=null,_e.call(ve.g,X),j(ve)}function j(ve){for(;ve.g.h;)try{var Oe=ve.G(ve.g);if(Oe)return ve.g.m=!1,{value:Oe.value,done:!1}}catch(We){ve.g.v=void 0,ve.g.s(We)}if(ve.g.m=!1,ve.g.l){if(Oe=ve.g.l,ve.g.l=null,Oe.F)throw Oe.D;return{value:Oe.return,done:!0}}return{value:void 0,done:!0}}function W(ve){this.next=function(Oe){return ve.o(Oe)},this.throw=function(Oe){return ve.s(Oe)},this.return=function(Oe){return function(We,_e){S(We.g);var I=We.g.j;return I?P(We,"return"in I?I.return:function(X){return{value:X,done:!0}},_e,We.g.return):(We.g.return(_e),j(We))}(ve,Oe)},this[Symbol.iterator]=function(){return this}}function K(ve,Oe){return Oe=new W(new U(Oe)),_&&ve.prototype&&_(Oe,ve.prototype),Oe}if(x.prototype.o=function(ve){this.v=ve},x.prototype.s=function(ve){this.l={D:ve,F:!0},this.h=this.C||this.u},x.prototype.return=function(ve){this.l={return:ve},this.h=this.u},U.prototype.o=function(ve){return S(this.g),this.g.j?P(this,this.g.j.next,ve,this.g.o):(this.g.o(ve),j(this))},U.prototype.s=function(ve){return S(this.g),this.g.j?P(this,this.g.j.throw,ve,this.g.o):(this.g.s(ve),j(this))},u("Array.prototype.entries",function(ve){return ve||function(){return function(Oe,We){Oe instanceof String&&(Oe+="");var _e=0,I=!1,X={next:function(){if(!I&&_e<Oe.length){var te=_e++;return{value:We(te,Oe[te]),done:!1}}return I=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}(this,function(Oe,We){return[Oe,We]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var J=function(ve,Oe){for(var We=0;We<ve.length;We++)Oe(ve[We])},re=function(ve){return ve.replace(/\r?\n|\r/g,`\r
`)},ie=function(ve,Oe,We){return Oe instanceof Blob?(We=We!==void 0?We+"":typeof Oe.name=="string"?Oe.name:"blob",Oe.name===We&&Object.prototype.toString.call(Oe)!=="[object Blob]"||(Oe=new File([Oe],We)),[String(ve),Oe]):[String(ve),String(Oe)]},Z=function(ve,Oe){if(ve.length<Oe)throw new TypeError(Oe+" argument required, but only "+ve.length+" present.")},se=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ge=se.FormData,Ee=se.XMLHttpRequest&&se.XMLHttpRequest.prototype.send,Fe=se.Request&&se.fetch,ht=se.navigator&&se.navigator.sendBeacon,ot=se.Element&&se.Element.prototype,St=se.Symbol&&Symbol.toStringTag;St&&(Blob.prototype[St]||(Blob.prototype[St]="Blob"),"File"in se&&!File.prototype[St]&&(File.prototype[St]="File"));try{new File([],"")}catch{se.File=function(Oe,We,_e){return Oe=new Blob(Oe,_e||{}),Object.defineProperties(Oe,{name:{value:We},lastModified:{value:+(_e&&_e.lastModified!==void 0?new Date(_e.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),St&&Object.defineProperty(Oe,St,{value:"File"}),Oe}}var yt=function(ve){return ve.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Yt=function(ve){this.i=[];var Oe=this;ve&&J(ve.elements,function(We){if(We.name&&!We.disabled&&We.type!=="submit"&&We.type!=="button"&&!We.matches("form fieldset[disabled] *"))if(We.type==="file"){var _e=We.files&&We.files.length?We.files:[new File([],"",{type:"application/octet-stream"})];J(_e,function(I){Oe.append(We.name,I)})}else We.type==="select-multiple"||We.type==="select-one"?J(We.options,function(I){!I.disabled&&I.selected&&Oe.append(We.name,I.value)}):We.type==="checkbox"||We.type==="radio"?We.checked&&Oe.append(We.name,We.value):(_e=We.type==="textarea"?re(We.value):We.value,Oe.append(We.name,_e))})};if((t=Yt.prototype).append=function(ve,Oe,We){Z(arguments,2),this.i.push(ie(ve,Oe,We))},t.delete=function(ve){Z(arguments,1);var Oe=[];ve=String(ve),J(this.i,function(We){We[0]!==ve&&Oe.push(We)}),this.i=Oe},t.entries=function ve(){var Oe,We=this;return K(ve,function(_e){if(_e.h==1&&(Oe=0),_e.h!=3)return Oe<We.i.length?_e=C(_e,We.i[Oe]):(_e.h=0,_e=void 0),_e;Oe++,_e.h=2})},t.forEach=function(ve,Oe){Z(arguments,1);for(var We=f(this),_e=We.next();!_e.done;_e=We.next()){var I=f(_e.value);_e=I.next().value,I=I.next().value,ve.call(Oe,I,_e,this)}},t.get=function(ve){Z(arguments,1);var Oe=this.i;ve=String(ve);for(var We=0;We<Oe.length;We++)if(Oe[We][0]===ve)return Oe[We][1];return null},t.getAll=function(ve){Z(arguments,1);var Oe=[];return ve=String(ve),J(this.i,function(We){We[0]===ve&&Oe.push(We[1])}),Oe},t.has=function(ve){Z(arguments,1),ve=String(ve);for(var Oe=0;Oe<this.i.length;Oe++)if(this.i[Oe][0]===ve)return!0;return!1},t.keys=function ve(){var Oe,We,_e,I,X=this;return K(ve,function(te){if(te.h==1&&(Oe=f(X),We=Oe.next()),te.h!=3)return We.done?void(te.h=0):(_e=We.value,I=f(_e),C(te,I.next().value));We=Oe.next(),te.h=2})},t.set=function(ve,Oe,We){Z(arguments,2),ve=String(ve);var _e=[],I=ie(ve,Oe,We),X=!0;J(this.i,function(te){te[0]===ve?X&&(X=!_e.push(I)):_e.push(te)}),X&&_e.push(I),this.i=_e},t.values=function ve(){var Oe,We,_e,I,X=this;return K(ve,function(te){if(te.h==1&&(Oe=f(X),We=Oe.next()),te.h!=3)return We.done?void(te.h=0):(_e=We.value,(I=f(_e)).next(),C(te,I.next().value));We=Oe.next(),te.h=2})},Yt.prototype._asNative=function(){for(var ve=new ge,Oe=f(this),We=Oe.next();!We.done;We=Oe.next()){var _e=f(We.value);We=_e.next().value,_e=_e.next().value,ve.append(We,_e)}return ve},Yt.prototype._blob=function(){var ve="----formdata-polyfill-"+Math.random(),Oe=[],We="--"+ve+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(_e,I){return typeof _e=="string"?Oe.push(We+yt(re(I))+`"\r
\r
`+re(_e)+`\r
`):Oe.push(We+yt(re(I))+'"; filename="'+yt(_e.name)+`"\r
Content-Type: `+(_e.type||"application/octet-stream")+`\r
\r
`,_e,`\r
`)}),Oe.push("--"+ve+"--"),new Blob(Oe,{type:"multipart/form-data; boundary="+ve})},Yt.prototype[Symbol.iterator]=function(){return this.entries()},Yt.prototype.toString=function(){return"[object FormData]"},ot&&!ot.matches&&(ot.matches=ot.matchesSelector||ot.mozMatchesSelector||ot.msMatchesSelector||ot.oMatchesSelector||ot.webkitMatchesSelector||function(ve){for(var Oe=(ve=(this.document||this.ownerDocument).querySelectorAll(ve)).length;0<=--Oe&&ve.item(Oe)!==this;);return-1<Oe}),St&&(Yt.prototype[St]="FormData"),Ee){var Cn=se.XMLHttpRequest.prototype.setRequestHeader;se.XMLHttpRequest.prototype.setRequestHeader=function(ve,Oe){Cn.call(this,ve,Oe),ve.toLowerCase()==="content-type"&&(this.B=!0)},se.XMLHttpRequest.prototype.send=function(ve){ve instanceof Yt?(ve=ve._blob(),this.B||this.setRequestHeader("Content-Type",ve.type),Ee.call(this,ve)):Ee.call(this,ve)}}Fe&&(se.fetch=function(ve,Oe){return Oe&&Oe.body&&Oe.body instanceof Yt&&(Oe.body=Oe.body._blob()),Fe.call(this,ve,Oe)}),ht&&(se.navigator.sendBeacon=function(ve,Oe){return Oe instanceof Yt&&(Oe=Oe._asNative()),ht.call(this,ve,Oe)}),se.FormData=Yt}})();const av=()=>{const t=G("AREAS");return t.length===0&&t.push(qt.GLOBAL),as(t).call(t,(r,i,s)=>{const c=f8(i);return c?s===0?c:"".concat(r,",").concat(c):r},"")},f8=t=>t===qt.OVERSEA?"".concat(Qr.ASIA,",").concat(Qr.EUROPE,",").concat(Qr.AFRICA,",").concat(Qr.NORTH_AMERICA,",").concat(Qr.SOUTH_AMERICA,",").concat(Qr.OCEANIA):Qr[t],mve=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(i=>{const s=Kb[i],c=Object.keys(s);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(s[u]))})}),r},iE={GLOBAL:{ASIA:[qt.CHINA,qt.JAPAN,qt.INDIA,qt.KOREA,qt.HKMC],EUROPE:[],NORTH_AMERICA:[qt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},aE=Object.keys(iE[qt.GLOBAL]),iI=[qt.CHINA,qt.NORTH_AMERICA,qt.EUROPE,qt.ASIA,qt.JAPAN,qt.INDIA,qt.OCEANIA,qt.SOUTH_AMERICA,qt.AFRICA,qt.KOREA,qt.HKMC,qt.US],gve=function(t,r){let i=[];if(Te(t).call(t,qt.GLOBAL)){const u=[qt.GLOBAL,qt.OVERSEA],h=Object.keys(Kb);if(r===qt.GLOBAL)throw new ce($.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===qt.CHINA)i=[qt.OVERSEA];else if(c=r,Te(aE).call(aE,c)){const f=(s=r,iE[qt.GLOBAL][s]||[]),g=[...u,r,...f];i=h.filter(v=>!Te(g).call(g,v))}else if(function(f){let g=!1;return aE.forEach(v=>{var _;Te(_=iE[qt.GLOBAL][v]).call(_,f)&&(g=!0)}),g}(r)){const f=function(v){let _;return aE.forEach(x=>{var S;Te(S=iE[qt.GLOBAL][x]).call(S,v)&&(_=x)}),_}(r),g=[...u,f,r];i=h.filter(v=>!Te(g).call(g,v))}else i=t;i=function(f){const g=[];return iI.forEach(v=>{Te(f).call(f,v)&&g.push(v)}),g.concat(f.filter(v=>!Te(iI).call(iI,v)))}(i)}else i=t;var s,c;return i};function m8(t){var r,i;if(!t&&Te(r=G("AREAS")).call(r,qt.EXTENSIONS))return R.debug("update area from ap : reset"),void aI(Tge,!0);if(!Te(i=G("AREAS")).call(i,qt.GLOBAL)||!t)return;let s=Kb.EXTENSIONS;s&&(s={CODE:f8(qt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},R.debug("update area from ap success: ".concat(t,",config is "),s),an("AREAS",[qt.EXTENSIONS],!0),Object.keys(s).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?an(c,s[c][0]):an(c,s[c])}))}function aI(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=$e.reportApiInvoke(null,{name:wn.SET_AREA,options:t,tag:ln.TRACER});try{let s=[];if(typeof t=="string"&&(s=[t]),Array.isArray(t)&&(t.forEach(u=>{if(!Te(U6).call(U6,u))throw new ce($.INVALID_PARAMS,"invalid area code")}),s=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:h}=t;if(!u)throw new ce($.INVALID_PARAMS,"area code is needed");let f=u;typeof u=="string"&&(f=[u]),s=h?gve(f,h):f}if(!r){if(Ma.AREAS){const u=new ce($.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void R.warning("setArea is prohibited because of config-distribute")}if(Te(s).call(s,qt.GLOBAL)&&G("AREAS")===qt.EXTENSIONS){const u=new ce($.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void R.warning("setArea is prohibited because of ap extensions")}}an("AREAS",s,r);const c=mve(s);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?an(u,c[u][0]):an(u,c[u])}),R.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()}function g8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Sc(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?g8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let sI=1;function vve(t,r,i,s,c){sI+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:sI,requestId:sI,version:os,cname:i.cname},h={service_name:r,json_body:JSON.stringify(u)};let f,g,v=t[0];return Ro(async()=>{f=Date.now();const _=await ko(v,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-f,_.code!==0){const C=new ce($.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:g});throw R.error(C.toString()),C}const x=JSON.parse(_.json_body);if(x.code!==200){const C=new ce($.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(x.code,", reason: ").concat(x.reason),{code:x.code,responseTime:g});throw R.error(C.toString()),C}if(!x.servers||x.servers.length===0){const C=new ce($.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:x.code,responseTime:g});throw R.error(C.toString()),C}const S=function(C,U){return{addressList:C.servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(U))),workerToken:C.workerToken,vid:C.vid}}(x,r);return G("LIVE_STREAMING_ADDRESS")&&(S.addressList=G("LIVE_STREAMING_ADDRESS")instanceof Array?G("LIVE_STREAMING_ADDRESS"):[G("LIVE_STREAMING_ADDRESS")]),Sc(Sc({},S),{},{responseTime:g})},(_,x)=>($e.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(_.addressList),firstSuccess:x===0,responseTime:g,serverIp:t[x%t.length]}),!1),(_,x)=>($e.apworkerEvent(i.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:r,responseTime:g,serverIp:t[x%t.length]}),!!(_.code!==$.OPERATION_ABORTED&&_.code!==$.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(v=t[(x+1)%t.length],!0)),c)}let oI=1;function v8(t,r,i,s){let{url:c,areaCode:u}=t;const{clientId:h,sid:f}=r,g=Date.now();let v;const _=r.role,[x,S]=lI(r,u,[qn.CHOOSE_SERVER]);let C=jn.networkState;return Ro(async()=>{C&&jn.networkState===wi.OFFLINE&&jn.onlineWaiter&&await De.race([jn.onlineWaiter,yr(s&&s.maxRetryTimeout||Yn.maxRetryTimeout)]),C=jn.networkState;const{data:U,headers:P}=await ko(c,{data:x,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=P.http3==="1"?1:-1,$e.reportResourceTiming(c,f),_8(U,c,r,g,[qn.CHOOSE_SERVER],v);const j=Zg(U,qn.CHOOSE_SERVER);return cI(j),YA(j,c)},U=>(U&&$e.joinChooseServer(f,{role:_,lts:g,succ:!0,csAddr:c,opid:S,serverList:U.gatewayAddrs.map(P=>P.address),ec:null,cid:U.cid.toString(),uid:U.uid.toString(),csIp:U.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:U.res.detail&&U.res.detail[38],vid:U.vid}),!1),U=>U.code!==$.OPERATION_ABORTED&&(U.code===$.CAN_NOT_GET_GATEWAY_SERVER?U.data.retry:($e.joinChooseServer(f,{role:_,lts:g,succ:!1,csAddr:c,serverList:null,opid:S,ec:U.code,csIp:U.data&&U.data.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:C}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),R.warning("[".concat(h||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),U),!0)),s)}function y8(t,r,i,s){let c,{url:u,areaCode:h,serviceIds:f}=t;const g=Date.now(),v=r.role,[_,x]=lI(r,h,f);let S;return Ro(async()=>{S&&jn.networkState===wi.OFFLINE&&jn.onlineWaiter&&await De.race([jn.onlineWaiter,yr(s&&s.maxRetryTimeout||Yn.maxRetryTimeout)]),S=jn.networkState;const{data:C,headers:U}=await ko(u,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=U.http3==="1"?1:-1,$e.reportResourceTiming(u,r.sid),_8(C,u,r,g,f,c);const P=Zg(C,qn.CHOOSE_SERVER),j=Zg(C,r.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK),W=performance.getEntriesByName(u),K=W[W.length-1];let J;return K&&(J={name:K.name,protocol:"nextHopProtocol"in K?K.nextHopProtocol:"",dnscost:"domainLookupEnd"in K&&"domainLookupStart"in K&&typeof K.domainLookupEnd=="number"&&typeof K.domainLookupStart=="number"?K.domainLookupEnd-K.domainLookupStart:-1,tcpTlsCost:"connectEnd"in K&&"connectStart"in K&&typeof K.connectEnd=="number"&&typeof K.connectStart=="number"?K.connectEnd-K.connectStart:-1,reqCost:"requestStart"in K&&typeof K.requestStart=="number"&&"responseEnd"in K&&typeof K.responseEnd=="number"?K.responseEnd-K.requestStart:-1,handleCost:"leave_ts"in C&&"enter_ts"in C&&typeof C.leave_ts=="number"&&typeof C.enter_ts=="number"?C.leave_ts-C.enter_ts:-1}),cI(P),{gatewayInfo:YA(P,u),proxyInfo:j,url:u,resourceTimingInfo:J}},C=>{var U;return C.gatewayInfo&&$e.joinChooseServer(r.sid,{role:v,lts:g,succ:!0,csAddr:u,serverList:C.gatewayInfo.gatewayAddrs.map(P=>P.address),ec:null,opid:x,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:C.gatewayInfo.res.detail&&C.gatewayInfo.res.detail[38],vid:(U=C.gatewayInfo)===null||U===void 0?void 0:U.vid,resourceTimingInfo:C.resourceTimingInfo?JSON.stringify(C.resourceTimingInfo):void 0}),C.proxyInfo&&$e.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:u,turnServerAddrList:C.proxyInfo.addresses.map(P=>P.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:f.toString()}),!1},C=>C.code!==$.OPERATION_ABORTED&&(C.code===$.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:($e.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:C.code,eventType:r.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:S})}),R.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),C),!0)),s)}const _8=(t,r,i,s,c,u)=>{const{sid:h,clientId:f,cloudProxyServer:g}=i,v=[],_=x=>{x.flag===4096?$e.joinChooseServer(h,{role:i.role,lts:s,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:x.error.message,csIp:x.error.data&&x.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):x.flag!==1048576&&x.flag!==4194304&&x.flag!==4194310||$e.joinWebProxyAP(h,{lts:s,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:x.error.code,eventType:g,unilbsServerIds:c.toString()})};if(t.response_body.forEach(x=>{const S=x.buffer.code;if(x.uri===23&&S===0&&!x.buffer.edges_services)if(x.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),x.buffer.edges_services=[];else{const C={error:new ce($.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:G("NO_EDGES_RETRY"),csIp:t.detail[502]}),flag:x.buffer.flag};v.push(C),_(C)}if(S!==0){const C=Qp(S),U={error:new ce($.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:t.detail[502]}),flag:x.buffer.flag};x.buffer.flag===4194310?R.warning(U.error.toString()):v.push(U),_(U)}}),v.length)throw R.warning("[".concat(f||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message,", retry: ").concat(x.error.data.retry)).join(" | "))),new ce($.CAN_NOT_GET_GATEWAY_SERVER,v.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message)).join(" | "),{retry:!!v.find(x=>x.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(x=>{var S;return x==null||(S=x.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(x=>!!x))]})},cI=t=>{var r,i,s,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new ce($.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(G("AP_AREA")&&((s=t.detail)!==null&&s!==void 0&&s[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?m8(t.detail[23].toLowerCase()):m8()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((i=t.detail)===null||i===void 0?void 0:i[19])=="string"){const h=t.detail[19],f=h==null?void 0:h.split(";");for(let g=0;g<f.length;g++){var u;const v=xi(u=f[g]).call(u);t.addresses[g]&&f&&(t.addresses[g].fingerprint=v)}}if(G("GATEWAY_ADDRESS")&&G("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",G("GATEWAY_ADDRESS"));const h=G("GATEWAY_ADDRESS").map(f=>{var g,v;const _=(g=(v=t.addresses.find(x=>x.ip===f.ip&&x.port===f.port))===null||v===void 0?void 0:v.fingerprint)!==null&&g!==void 0?g:"";return{ip:f.ip,port:f.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:f.fingerprint||_}});t.addresses=h}},yve=(t,r)=>{if(t.response_body&&t.response_body.length){const i=t.response_body[0];if(i.buffer.code!==0){const s=Qp(i.buffer.code);throw new ce($.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return i.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",r),new ce($.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},lI=(t,r,i)=>{const s=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,u={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Sc(Sc(Sc({6:t.stringUid,11:r,12:G("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:i,uid:t.uid||0}}]};u.request_bodies.forEach(f=>{t.multiIP&&t.multiIP.gateway_ip&&(f.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,s]},_ve=(t,r)=>{const i=Math.floor(Math.random()*1e12),s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]};let tf=0;function nf(t){return De.all(t.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const sv=async t=>{let{fragementLength:r,referenceList:i,asyncMapHandler:s,allFailedhandler:c,promisesCollector:u}=t,h=0;const f=r;let g,v=0;const _=async()=>{const x=(()=>{const S=h*f,C=S+f;return i.slice(S,C).map(s)})();u&&u.push(...x);try{g=await nf(x)}catch(S){if(v+=f,h++,!(v>=i.length))return void await _();c(S)}x.forEach(S=>S.cancel())};return await _(),g},b8=async t=>{let{referenceList:r,asyncMapHandler:i,closeFn:s}=t;const c=r.length;let u=0;const h=async()=>{const f=i(r.shift());try{return await f}catch(g){if(u++,u>=c||s!=null&&s(g))throw g;return h()}};return h()};async function bve(){if(typeof VideoDecoder>"u")return!0;let t;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],u=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new De((g,v)=>{let _;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:S=>{S.close(),clearTimeout(_),g(!0)},error:S=>{clearTimeout(_),g(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const x=[r,i,s,c,u,h];for(let S=0;S<x.length;S++){const C=new EncodedVideoChunk({type:S==0?"key":"delta",timestamp:33333*S,duration:33333,data:new Uint8Array(x[S])});try{await t.decode(C)}catch{return void g(!1)}}})(),_=setTimeout(()=>{g(!1)},5e3)})}async function sE(t,r,i,s){return{gatewayInfo:await async function(u,h,f,g){let v=null;const _=[],x=async()=>{const C=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:av()})),U=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),P=await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),v8(j,u,h,f)),allFailedhandler:j=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:_});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},U),P},S=async()=>{if(await yr(1e3),v!==null)return v;const C=G("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:av()})),U=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),P=await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),v8(j,u,h,f)),allFailedhandler:j=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:_});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},U),P};try{return v=await nf([x(),S()]),_.length&&_.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),v}catch(C){throw C[0]}}(t,r,i,s)}}async function E8(t,r,i,s,c){const u=t.cloudProxyServer;if(u==="disabled"){if(t.useLocalAccessPoint)return await sE(t,r,i,c);if(G("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:S,proxyInfo:C}=await w8(t,r,i,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:S};const U=C.map(P=>({turnServerURL:P.address,tcpport:P.tcpport||Hr.tcpport,udpport:P.udpport||Hr.udpport,username:P.username||Hr.username,password:P.password||Hr.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const P=(h=t.uid)!==null&&h!==void 0?h:S.uid,j="glb:".concat(P.toString()),W=await HR(j),K=C.map(J=>({turnServerURL:J.address,tcpport:J.tcpport||Hr.tcpport,udpport:J.udpport||Hr.udpport,username:j,password:W,forceturn:!1,security:!0}));U.push(...K)}return t.turnServer={mode:"manual",servers:U},{gatewayInfo:S}}return await sE(t,r,i,c)}const{proxyInfo:f,gatewayInfo:g}=await w8(t,r,i,c),v={gatewayInfo:g},_=f.map(S=>({turnServerURL:S.address,tcpport:u==="proxy3"?void 0:S.tcpport?S.tcpport:Hr.tcpport,udpport:u==="proxy4"?void 0:S.udpport?S.udpport:Hr.udpport,username:S.username||Hr.username,password:S.password||Hr.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var x;const S=(x=t.uid)!==null&&x!==void 0?x:g.uid,C="glb:".concat(S.toString()),U=await HR(C),P=f.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||Hr.tcpport,udpport:u==="proxy4"?void 0:j.udpport||Hr.udpport,username:C,password:U,forceturn:u!=="proxy4",security:u==="proxy5"}));_.push(...P)}return t.turnServer={mode:"manual",servers:_},R.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(u)),v}async function x8(t,r,i,s,c){const u=G("ACCOUNT_REGISTER").slice(0,G("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1")):u.map(g=>"https://".concat(g,"/api/v1"));const f=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await async function(v,_,x,S,C){const U=Date.now(),P={sid:x.sid,opid:10,appid:x.appId,string_uid:_};let j=v[0];const W=await Ro(()=>ko(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(K,J)=>{if(K.code===0){if(K.uid<=0||K.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(_," => ").concat(K.uid),K),$e.reqUserAccount(P.sid,{lts:U,success:!1,serverAddr:j,stringUid:P.string_uid,uid:K.uid,errorCode:$.INVALID_UINT_UID_FROM_STRING_UID,extend:P}),new ce($.INVALID_UINT_UID_FROM_STRING_UID);return $e.reqUserAccount(P.sid,{lts:U,success:!0,serverAddr:j,stringUid:P.string_uid,uid:K.uid,errorCode:null,extend:P}),!1}const re=Qp(K.code);return re.retry&&(j=v[(J+1)%v.length]),$e.reqUserAccount(P.sid,{lts:U,success:!1,serverAddr:j,stringUid:P.string_uid,uid:K.uid,errorCode:re.desc,extend:P}),re.retry},(K,J)=>K.code!==$.OPERATION_ABORTED&&($e.reqUserAccount(P.sid,{lts:U,success:!1,serverAddr:j,stringUid:P.string_uid,uid:null,errorCode:K.code,extend:P}),j=v[(J+1)%v.length],!0),C);if(W.code!==0){const K=Qp(W.code);throw new ce($.UNEXPECTED_RESPONSE,K.desc)}return W}(h,t,r,i,s);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},f),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},f),g}}async function Eve(t,r,i){const s=G("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?s.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));try{return await b8({referenceList:c,asyncMapHandler:h=>async function(f,g,v,_){const x=Date.now(),S={sid:v.sid,opid:10,appid:v.appId,string_uid:g};try{const C=await ko(f+"".concat(f.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(C.code!==0){const U=Qp(C.code);throw new ce($.UNEXPECTED_RESPONSE,"preload sua error:".concat(U.desc),U)}if(C.uid<=0||C.uid>=Math.pow(2,32))throw new ce($.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:x,url:f,req:S,uid:C.uid,elapse:Date.now()-x}}catch(C){throw C}}(h,t,r,i),closeFn:h=>h.code===$.OPERATION_ABORTED||h.code===$.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function xve(t,r,i){const s=G("CDS_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=s.map(g=>function(v,_,x,S){const C=Bt(),U={flag:64,cipher_method:0,features:Sc(Sc(Sc(Sc(Sc({install_id:iA(),device:C.name,system:C.os,system_general:navigator.userAgent,vendor:_.appId,version:os,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:hve.WEB_RTC,browser_name:C.name,browser_version:C.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),C.os&&{os_name:C.os}),C.osVersion&&{os_version:C.osVersion}),{},{detail:""})};return Ro(()=>ko(v,{data:U,timeout:1e3,cancelToken:x,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,P=>P.code!==$.OPERATION_ABORTED,S)}(g,t,r,i));let u=null,h=null,f={};try{u=await nf(c)}catch(g){if(g.code===$.OPERATION_ABORTED)throw g;h=g}if(c.forEach(g=>g.cancel()),$e.reportApiInvoke(t.sid,{name:wn.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{f=function(g){if(!g.test_tags)return{};const v=g.test_tags,_=Object.keys(v),x={};return _.forEach(S=>{var C;const U=xi(C=S.slice(4)).call(C),P=JSON.parse(v[S]),j=P[1];x[U]={tag:P[0]||"",value:j}}),x}(u)}catch{}return f}async function S8(t,r){const i=G("WEBCS_DOMAIN").concat(G("WEBCS_DOMAIN_BACKUP_LIST")).map(s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:av(),serviceIds:[qn.CHOOSE_SERVER,qn.CLOUD_PROXY_FALLBACK]}));try{return await b8({referenceList:i,asyncMapHandler:c=>async function(u,h,f){let g,{url:v,areaCode:_,serviceIds:x}=u;const S=Date.now(),[C,U]=lI(h,_,x);let P=jn.networkState;try{P&&jn.networkState===wi.OFFLINE&&jn.onlineWaiter&&await De.race([jn.onlineWaiter,yr(Yn.maxRetryTimeout)]),P=jn.networkState;const{data:j,headers:W}=await ko(v,{data:C,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=W.http3==="1"?1:-1,(ie=>{const Z=[];if(ie.response_body.forEach(se=>{const ge=se.buffer.code;if(se.uri===23&&ge===0&&!se.buffer.edges_services)if(se.buffer.flag===4194310)se.buffer.edges_services=[];else{const Ee={error:new ce($.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:G("NO_EDGES_RETRY"),csIp:ie.detail[502]}),flag:se.buffer.flag};Z.push(Ee)}if(ge!==0){const Ee=Qp(ge),Fe={error:new ce($.CAN_NOT_GET_GATEWAY_SERVER,Ee.desc,{desc:Ee.desc,retry:Ee.retry,csIp:ie.detail[502]}),flag:se.buffer.flag};se.buffer.flag===4194310?R.warning(Fe.error.toString()):Z.push(Fe)}}),Z.length)throw new ce($.CAN_NOT_GET_GATEWAY_SERVER,Z.map(se=>"flag: ".concat(se.flag,", message: ").concat(se.error.message)).join(" | "),{retry:!!Z.find(se=>se.error.data.retry),csIp:ie.detail[502],desc:[...new Set(Z.map(se=>{var ge;return se==null||(ge=se.error)===null||ge===void 0||(ge=ge.data)===null||ge===void 0?void 0:ge.desc}).filter(se=>!!se))]})})(j);const J=Zg(j,qn.CHOOSE_SERVER),re=Zg(j,qn.CLOUD_PROXY_FALLBACK);return cI(J),{gatewayInfo:YA(J,v),proxyInfo:re,opid:U,requestTime:S,url:v,isHttp3:g,elapse:Date.now()-S}}catch(j){throw j}}(c,t,r),closeFn:c=>c.code===$.OPERATION_ABORTED||c.code===$.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(s){throw s}}async function w8(t,r,i,s){const c=G("PROXY_SERVER_TYPE3"),u=(C,U,P)=>{let j=P||c;return Array.isArray(j)&&(j=U%2==0&&c[1]||c[0]),"https://".concat(j,"/ap/?url=").concat(C)};let h=null;const f=[],g=async()=>{const C=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((j,W)=>{let K;return K=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),W,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),W),{url:K,areaCode:av(),serviceIds:[qn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK]}}),U=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),P=await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(t.clientId,"] Connect to choose_server:"),j.url),y8(j,t,r,i)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},U),P},v=async()=>{if(await yr(1e3),h!==null)return h;const C=G("WEBCS_DOMAIN_BACKUP_LIST").map((j,W)=>{let K;return K=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),W,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),W),{url:K,areaCode:av(),serviceIds:[qn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK]}}),U=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),P=await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),j.url),y8(j,t,r,i)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},U),P};let _,x,S;try{({gatewayInfo:_,proxyInfo:x,url:S}=await nf([g(),v()]))}catch(C){throw C[0]}if(f.length&&f.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),!_||!x)throw new ce($.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=S,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&S){const C=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];Te(c).call(c,C)&&(t.proxyServer=C,R.setProxyServer(C),$e.setProxyServer(C))}return h={gatewayInfo:_,proxyInfo:await Y6(x,_.uid)},h}async function Sve(t,r,i){const s=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=s.map(u=>function(h,f,g,v){const _={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:os,cname:f.cname,uid:f.uid.toString(),requestId:oI,seq:oI};oI+=1;const x={service_name:"tele_channel",json_body:JSON.stringify(_)};return Ro(async()=>{const S=await ko(h,{data:x,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){const U=new ce($.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw R.error(U.toString()),U}const C=JSON.parse(S.json_body);if(C.code!==200){const U=new ce($.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw R.error(U.toString()),U}if(!C.servers||C.servers.length===0){const U=new ce($.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(U.toString()),U}return{vid:C.vid,workerToken:C.workerToken,addressList:(G("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(U.wss))}},void 0,S=>!!(S.code!==$.OPERATION_ABORTED&&S.code!==$.UNEXPECTED_RESPONSE||S.data&&S.data.retry),v)}(u,t,r,i));try{const u=await nf(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function wve(t,r,i){let s=null;const c=[],u=async h=>{const f=G(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return h&&(await yr(1e3),s!==null)?s:await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:g=>(R.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),function(v,_,x,S){const[C]=_ve(_,[qn.CHOOSE_SERVER]);let U=jn.networkState;return Ro(async()=>{U&&jn.networkState===wi.OFFLINE&&jn.onlineWaiter&&await De.race([jn.onlineWaiter,yr(S&&S.maxRetryTimeout||Yn.maxRetryTimeout)]),U=jn.networkState;const P=await ko(v,{data:C,cancelToken:x,headers:{"Content-Type":"multipart/form-data;"}},!0);return yve(P,v)},()=>!1,P=>P.code!==$.OPERATION_ABORTED&&(P.code===$.UPDATE_TICKET_FAILED?P.data.retry:(R.warning("[".concat(_.clientId,"] update ticket network error, retry"),P),!0)),S)}(g,t,r,i)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return s=await nf([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),s}catch(h){throw h[0]}}function T8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function dI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?T8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class Tve extends An{get isSuccess(){return!!this.configs}constructor(r,i){super(),L(this,"configs",void 0),L(this,"store",void 0),L(this,"joinInfo",void 0),L(this,"cancelToken",void 0),L(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),L(this,"interval",void 0),L(this,"mutex",void 0),L(this,"mutableParamsRead",!1),L(this,"configCache",{}),L(this,"limit_bitrate",void 0),this.mutex=new Rr("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),G("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},G("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,$e.reportApiInvoke(null,{options:void 0,name:wn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:ln.TRACER}).onSuccess(JSON.stringify(Ma))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await xve(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(r));const s=function(c){var u;const h=fu(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<h.length;v++)for(let _=h.length-1;_>v;_--){const x=h[_],S=c[x].value;if(typeof S.__priority=="number"){const C=S.__priority,U=h[_-1],P=c[U].value;if(typeof P.__priority=="number"){if(!(C>P.__priority))continue;{const j=x;h[_]=h[_-1],h[_-1]=j}}else{const j=x;h[_]=h[_-1],h[_-1]=j}}}const f=Date.now(),g={};return h.forEach(v=>{const _=c[v].value.__expires;_&&_<=f||(g[v]=c[v])}),g}(r);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){const c=new ce($.NETWORK_RESPONSE_ERROR,s);R.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){F6(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(Oo.UPDATE_BITRATE_LIMIT,r):this.emit(Oo.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&dI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},s=Object.keys(r),c=[];s.forEach(u=>{const h=r[u].value;i[u]=h;const f=h.__id;if(f&&this.configCache[u]&&this.configCache[u].__id===f)return;const g=h.__type,v=r[u].value,_=r[u].tag;let x=0;g?g===iV.REALTIME&&(x=1):Object.keys(v).some(S=>Object.prototype.hasOwnProperty.call(cA,S)||!LA()&&Object.prototype.hasOwnProperty.call(Sb,S)?(x=1,!0):void 0),c.push({tag:_,isApplied:x,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:f,params:g,isApplied:v}=u;this.store.sessionId&&$e.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:f,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){R.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const f=c[h].value,g=f.__expires,v=f.__type;Object.keys(f).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(u,_)||(u[_]=dI(dI({value:f[_]},g&&{expires:g}),v&&{type:v}))})}),u}(r);try{var s;const c=(s=i.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete i.LIMIT_BITRATE,c&&F6(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(f){try{const g=Date.now();Object.keys(f).forEach(v=>{const{value:_,type:x,expires:S}=f[v];S&&S<=g||((x===iV.REALTIME||Object.prototype.hasOwnProperty.call(cA,v))&&(Ma[v]=_,en[v]=_,R.debug("Update realtime parameters from config distribute",v,_)),x||LA()||!Object.prototype.hasOwnProperty.call(Sb,v)||(Ma[v]=_,en[v]=_,R.debug("Update gateway parameters from config distribute",v,_)))})}catch(g){R.error("Error update config immediately: ".concat(f),g.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),R.debug("Caching global parameters ".concat(u))}catch(c){R.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(s=>{switch(s){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(en,s)){const{value:u,expires:h}=r[s];if(h&&h<=i)return;XR(en[s],u)||(Ma[s]=u,en[s]=u,this.emit(Oo.UPDATE_CLIENT_ROLE_OPTIONS,u),R.debug("Updating client role options: ".concat(JSON.stringify(u))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(en,s)){var c;const{value:u,expires:h}=r[s];if(h&&h<=i)return;typeof u=="number"&&Te(c=[0,1,4,5,6,7,8,9]).call(c,u)&&(Ma[s]={value:u},en[s]=u,this.emit(Oo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,u),R.debug("Updating client remote stream type: ".concat(JSON.stringify(u))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(en,s)){const{value:u,expires:h}=r[s];if(h&&h<=i)return;XR(en[s],u)||(Ma[s]=u,en[s]=u,this.emit(Oo.FALLBACK_TO_HLS,u),R.debug("Updating enable force hls: ".concat(JSON.stringify(u))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(en,s)){const{value:u,expires:h}=r[s];if(h&&h<=i)return;XR(en[s],u)||(Ma[s]=u,en[s]=u,this.emit(Oo.UPDATE_VOS_CONFIGURE,u),R.debug("Updating vos configure: ".concat(JSON.stringify(u))))}}})}catch(i){R.error("Error handling global parameter config:",i.message)}}}class Cve extends An{constructor(){super(...arguments),L(this,"resultStorage",new Map)}setLocalAudioStats(r,i,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(s,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(s,i))}setLocalVideoStats(r,i,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(s,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(s,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(s)),!i.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(s))}setRemoteAudioStats(r,i){const s=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const s=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(i))}record(r,i,s){if(G("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(s);const u=r==="VIDEO_ENCODE_FAILED"?G("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=u){var h;const f=Te(h=c.result).call(h,!0);c.isPrevNormal&&!f&&this.emit("exception",uI[r],r,i),!c.isPrevNormal&&f&&this.emit("exception",uI[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=f,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof or&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let s=null;i._encoderConfig&&i._encoderConfig.frameRate&&(s=Bi(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var i;return!(!r.codecType||Te(i=G("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(i,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof or&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const uI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Zr=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(t,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function C8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Wu(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?C8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):C8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class ov{constructor(r){L(this,"store",void 0),L(this,"onStatsException",void 0),L(this,"onUploadPublishDuration",void 0),L(this,"onStatsChanged",void 0),L(this,"onVideoCodecChanged",void 0),L(this,"localStats",new Map),L(this,"remoteStats",new Map),L(this,"updateStatsInterval",void 0),L(this,"trafficStats",void 0),L(this,"trafficStatsPeerList",[]),L(this,"uplinkStats",void 0),L(this,"exceptionMonitor",void 0),L(this,"p2pChannel",void 0),L(this,"scalabilityMode",Eb.L1T1),L(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Cve,this.exceptionMonitor.on("exception",(i,s,c)=>{this.onStatsException&&this.onStatsException(i,s,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ce.LocalAudioTrack)||Wu({},fA)}getLocalVideoTrackStats(){return this.localStats.get(Ce.LocalVideoTrack)||Wu({},mA)}getRemoteAudioTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(s[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:f}]=u;f&&(s[h]=i(h,f))});return s}getRemoteNetworkQualityStats(r){const i={};if(r){var s;const c=(s=this.remoteStats.get(r))===null||s===void 0?void 0:s.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getNetworkQuality(){let r=0,i=0;return this.trafficStats&&(r=Jb(this.trafficStats.B_unq),i=Jb(this.trafficStats.B_dnq)),{uplinkNetworkQuality:r,downlinkNetworkQuality:i}}getRemoteVideoTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(s[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:f}]=u;f&&(s[h]=i(h,f))});return s}getRTCStats(){let r=0,i=0,s=0,c=0;const u=this.localStats.get(Ce.LocalAudioTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(Ce.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const f=this.localStats.get(Ce.LocalVideoLowTrack);f&&(r+=f.sendBytes,i+=f.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:_,videoStats:x}=v;_&&(s+=_.receiveBytes,c+=_.receiveBitrate),x&&(s+=x.receiveBytes,c+=x.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:i,SendBytes:r,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var s;const c=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Zr.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Zr.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,s){if(!r)return!1;const c=!!s&&i.framesDecodeFreezeTime>s.framesDecodeFreezeTime,u=!s||i.framesDecodeCount>s.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[s,c]=i;switch(s){case Ce.LocalVideoTrack:case Ce.LocalVideoLowTrack:{const f=c,g=Wu({},mA),v=r.getStats(),_=r.getLocalMedia(s);if(v){const x=v.videoSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(x){const S=r.getLocalVideoSize(),C=r.getEncoderConfig(Ce.LocalVideoTrack);var u;(x.codec==="H264"||x.codec==="H265"||x.codec==="VP8"||x.codec==="VP9"||x.codec==="AV1X"||x.codec==="AV1")&&(g.codecType=x.codec,(f==null?void 0:f.codecType)!==x.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,x.codec.toLocaleLowerCase()))),g.sendBytes=x.bytes,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0,x.inputFrame?(g.captureFrameRate=x.inputFrame.frameRate,g.captureResolutionHeight=x.inputFrame.height,g.captureResolutionWidth=x.inputFrame.width):S&&(g.captureResolutionWidth=S.width,g.captureResolutionHeight=S.height),x.sentFrame?(g.sendFrameRate=x.sentFrame.frameRate,g.sendResolutionHeight=x.sentFrame.height,g.sendResolutionWidth=x.sentFrame.width):S&&(g.sendResolutionWidth=S.width,g.sendResolutionHeight=S.height),x.avgEncodeMs&&(g.encodeDelay=x.avgEncodeMs),C&&C.bitrateMax?g.targetSendBitrate=1e3*C.bitrateMax:x.targetBitrate&&(g.targetSendBitrate=x.targetBitrate),g.sendPackets=x.packets,g.sendPacketsLost=x.packetsLost,g.sendJitterMs=x.jitterMs,g.sendRttMs=x.rttMs,g.totalDuration=f?f.totalDuration+1:1,g.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(x)&&(g.totalFreezeTime+=1),x.scalabilityMode&&this.scalabilityMode!==x.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(x.scalabilityMode)),this.scalabilityMode=x.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(s,g),((f==null?void 0:f.sendResolutionWidth)!==g.sendResolutionWidth||(f==null?void 0:f.sendResolutionHeight)!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,g);break}case Ce.LocalAudioTrack:{const f=c,g=Wu({},fA),v=r.getStats(),_=r.getLocalMedia(s);if(v){const x=v.audioSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(x){if(x.codec!=="opus"&&x.codec!=="aac"&&x.codec!=="PCMU"&&x.codec!=="PCMA"&&x.codec!=="G722"||(g.codecType=x.codec),x.inputLevel)g.sendVolumeLevel=Math.round(32767*x.inputLevel);else{const S=r.getLocalAudioVolume();S&&(g.sendVolumeLevel=Math.round(32767*S))}g.sendBytes=x.bytes,g.sendPackets=x.packets,g.sendPacketsLost=x.packetsLost,g.sendJitterMs=x.jitterMs,g.sendRttMs=x.rttMs,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ce.LocalAudioTrack,g),g&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,g);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var s,c;let[u,{videoStats:h,audioStats:f,videoPcStats:g}]=i;const v=f,_=h,x=g,S=Wu({},yV),C=Wu({},_V),U=Wu({},uge),{audioTrack:P,videoTrack:j,audioSSRC:W,videoSSRC:K}=r.getRemoteMedia(u);let J;J=this.store.useP2P?r.getStats(!0):r.getStats();const re=(s=J)===null||s===void 0?void 0:s.audioRecv.find(ge=>ge.ssrc===W),ie=(c=J)===null||c===void 0?void 0:c.videoRecv.find(ge=>ge.ssrc===K),Z=this.trafficStats&&this.trafficStats.peer_delay.find(ge=>ge.peer_uid===u);if(re&&(re.codec!=="opus"&&re.codec!=="aac"&&re.codec!=="PCMU"&&re.codec!=="PCMA"&&re.codec!=="G722"||(S.codecType=re.codec),re.outputLevel?S.receiveLevel=Math.round(32767*re.outputLevel):P&&(S.receiveLevel=Math.round(32767*P.getVolumeLevel())),S.receiveBytes=re.bytes,S.receivePackets=re.packets,S.receivePacketsLost=re.packetsLost,S.receivePacketsDiscarded=re.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=v?8*Math.max(0,S.receiveBytes-v.receiveBytes):0,S.totalDuration=v?v.totalDuration+1:1,S.totalFreezeTime=v?v.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=re.jitterBufferMs,S.totalDuration>10&&ov.isRemoteAudioFreeze(P)&&(S.totalFreezeTime+=1)),ie){var se;ie.codec!=="H264"&&ie.codec!=="H265"&&ie.codec!=="VP8"&&ie.codec!=="VP9"&&ie.codec!=="AV1X"&&ie.codec!=="AV1"||(C.codecType=ie.codec),C.receiveBytes=ie.bytes,C.receiveBitrate=_?8*Math.max(0,C.receiveBytes-_.receiveBytes):0,C.decodeFrameRate=ie.decodeFrameRate<0?0:ie.decodeFrameRate,C.renderFrameRate=ie.decodeFrameRate<0?0:ie.decodeFrameRate,ie.outputFrame&&(C.renderFrameRate=ie.outputFrame.frameRate),ie.receivedFrame?(C.receiveFrameRate=ie.receivedFrame.frameRate,C.receiveResolutionHeight=ie.receivedFrame.height,C.receiveResolutionWidth=ie.receivedFrame.width):j&&(C.receiveResolutionHeight=j._videoHeight||0,C.receiveResolutionWidth=j._videoWidth||0),ie.framesRateFirefox!==void 0&&(C.receiveFrameRate=Math.round(ie.framesRateFirefox)),C.receivePackets=ie.packets,C.receivePacketsLost=ie.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost);const ge=_?_.totalFreezeTime:0,Ee=_?_.totalDuration:0;C.totalDuration=_?_.totalDuration+1:1,C.totalFreezeTime=(se=ie.totalFreezesDuration)!==null&&se!==void 0?se:ge||0,C.receiveDelay=ie.jitterBufferMs||0;const Fe=!!K&&r.getRemoteVideoIsReady(K);ie.totalFreezesDuration===void 0&&j&&Fe&&ov.isRemoteVideoFreeze(j,ie,x)&&(C.totalFreezeTime+=1),C.freezeRate=Math.max(0,Math.min((C.totalFreezeTime-ge)/(C.totalDuration-Ee),1))}Z&&(S.end2EndDelay=Z.B_ad,C.end2EndDelay=Z.B_vd,S.transportDelay=Z.B_ed,C.transportDelay=Z.B_ed,S.currentPacketLossRate=Z.B_ealr4/100,C.currentPacketLossRate=Z.B_evlr4/100,U.uplinkNetworkQuality=Z.B_punq?Z.B_punq:0,U.downlinkNetworkQuality=Z.B_pdnq?Z.B_pdnq:0),this.remoteStats.set(u,{audioStats:S,videoStats:C,videoPcStats:ie,networkStats:U}),P&&this.exceptionMonitor.setRemoteAudioStats(P,S),j&&this.exceptionMonitor.setRemoteVideoStats(j,C)})}}class N8{constructor(){L(this,"destChannelMediaInfos",new Map),L(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){M6(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){M6(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){$b(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function R8(t){if(!(t instanceof N8))return new ce($.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),i=t.getDestChannelMediaInfo();if(!r)return new ce($.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new ce($.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class ld{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){L(this,"uid",void 0),L(this,"_uintid",void 0),L(this,"_trust_in_room_",!0),L(this,"_trust_audio_enabled_state_",!0),L(this,"_trust_video_enabled_state_",!0),L(this,"_trust_audio_mute_state_",!0),L(this,"_trust_video_mute_state_",!0),L(this,"_audio_muted_",!1),L(this,"_video_muted_",!1),L(this,"_audio_enabled_",!0),L(this,"_video_enabled_",!0),L(this,"_audio_added_",!1),L(this,"_video_added_",!1),L(this,"_is_pre_created",!1),L(this,"_video_pre_subscribed",!1),L(this,"_audio_pre_subscribed",!1),L(this,"_trust_video_stream_added_state_",!0),L(this,"_trust_audio_stream_added_state_",!0),L(this,"_audioTrack",void 0),L(this,"_videoTrack",void 0),L(this,"_dataChannels",[]),L(this,"_audioSSRC",void 0),L(this,"_videoSSRC",void 0),L(this,"_audioOrtc",void 0),L(this,"_videoOrtc",void 0),L(this,"_cname",void 0),L(this,"_rtxSsrcId",void 0),L(this,"_videoMid",void 0),L(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function A8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function hI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?A8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):A8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const Nve=t=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(t?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),oE="9",pI=2e4,cE=4e4;let I8=class{get localCapabilities(){return En(this._localCapabilities)}get rtpCapabilities(){return En(this._rtpCapabilities)}get candidates(){return En(this._candidates)}get iceParameters(){return En(this._iceParameters)}get dtlsParameters(){return En(this._dtlsParameters)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3];L(this,"sessionDesc",void 0),L(this,"_localCapabilities",void 0),L(this,"_rtpCapabilities",void 0),L(this,"_candidates",void 0),L(this,"_originCandidates",void 0),L(this,"_iceParameters",void 0),L(this,"_isUseExtmapAllowMixed",void 0),L(this,"_isUseLocalCodecs",void 0),L(this,"_isUseDataChannel",void 0),L(this,"_dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname",void 0),L(this,"useLocalCodecsMids",[]),L(this,"preloadSsrcs",[]),L(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=r,this._isUseLocalCodecs=i,this._isUseDataChannel=s,t=En(t);const{iceParameters:c,dtlsParameters:u,candidates:h,rtpCapabilities:f,setup:g,localCapabilities:v,cname:_}=t;this._rtpCapabilities=f,this._candidates=h,this._originCandidates=En(h),this._iceParameters=c,this._dtlsParameters=u,this._localCapabilities=v,this.setup=g,this.cname=_,[this.sessionDesc]=this.updateRemoteRTPCapabilities(f),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(t){return t.length===this.preloadSsrcs.length&&t.every(r=>{var i;return Te(i=this.preloadSsrcs).call(i,r)})}preloadRemoteMedia(t){let r=0;const i=[],s=[];for(;t>0;){const c=[hI({ssrcId:cE+r},G("USE_SUB_RTX")?{rtx:cE+r+1}:{})],u="".concat(cE+r,"_").concat(pI+r),{ssrcs:h,ssrcGroups:f}=nv(c,this.cname,G("SYNC_GROUP")?u:void 0),g=this.preCreateOrRecycleSendMedia("video",h,f,void 0),v=[{ssrcId:pI+r}],_="".concat(cE+r,"_").concat(pI+r),{ssrcs:x,ssrcGroups:S}=nv(v,this.cname,G("SYNC_GROUP")?_:void 0),C=this.preCreateOrRecycleSendMedia("audio",x,S,void 0);t--,r+=2,i.push(g,C),s.push(h[0].ssrcId,x[0].ssrcId)}return this.useLocalCodecsMids.push(...i),this.preloadSsrcs=s,{mids:i,preSSRCs:s,isAvailable:!0}}preCreateOrRecycleSendMedia(t,r,i,s){const c=this.rtpCapabilities.send.videoCodecs,u=this._isUseLocalCodecs||c.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",r[0].ssrcId);const h=t===Ge.VIDEO?u.videoCodecs:u.audioCodecs,f=t===Ge.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let v={media:{mediaType:t,port:oE,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};return v=this.mungSendMediaDesc(v,s),this.sessionDesc.mediaDescriptions.push(v),this.updateBundleMids(),g}toString(){return rl(this.sessionDesc)}send(t,r,i,s){const{ssrcs:c,ssrcGroups:u}=nv(r,this.cname,G("SYNC_GROUP")?i:void 0),h=this.findPreloadMediaDesc(c);if(h){if(bn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,h.attributes.mid),s&&(s.twcc||s.remb)){const f=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(h,s),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const f=this.findAvailableMediaIndex(t,c);let g;return f===-1||f===1&&(Nr()||function(){const v=Bt();return!(v.name!==Ht.CHROME||!v.osVersion)&&Number(v.version)<=90}()||No(143)||ed(143)||G("RESERVE_MID_1_MLINE")||G("ENABLE_ENCODED_TRANSFORM")&&tl())||f===0&&!function(v){const _=Bt();return!(_.name!==Ht.FIREFOX||!_.osVersion)&&Number(_.version)===v}(138)&&G("USE_SUB_RTX")||TF()?(g=this.createOrRecycleSendMedia(t,c,u,"sendonly",s),this.updateBundleMids()):(g=En(this.sessionDesc.mediaDescriptions[f]),g.attributes.direction="sendonly",g.attributes.ssrcs=c,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(g,s)),bn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:r}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:r}}batchSend(t){const r=t.map(c=>{let{kind:u,ssrcMsg:h,mslabel:f}=c;return this.send(u,h,f)}),i=[];let s=!1;return r.forEach(c=>{let{mid:u,needExchangeSDP:h}=c;h&&(s=!0),i.push(u)}),{mids:i,needExchangeSDP:s}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.mid==="0"||bn()||TF()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Te(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Te(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,r,i,s){t.forEach((c,u)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",r,i,s[u])}),this.updateBundleMids()}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const r=this.sessionDesc||Ti((i=this._isUseExtmapAllowMixed,this._isUseDataChannel?Nve(i):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(i?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var i;this._rtpCapabilities=t;let s=!1;const c=this.rtpCapabilities.send,u=this.localCapabilities.send,h=this.localCapabilities.recv,f=h.videoCodecs,g=h.audioCodecs,v=h.videoExtensions,_=h.audioExtensions;for(const U of r.mediaDescriptions){var x;if(U.attributes.direction!=="sendonly"||typeof U.attributes.mid!="string"||!Te(x=this.useLocalCodecsMids).call(x,U.attributes.mid)){if(s=!0,U.attributes.iceUfrag=this._iceParameters.iceUfrag,U.attributes.icePwd=this._iceParameters.icePwd,U.attributes.fingerprints=this._dtlsParameters.fingerprints,U.attributes.candidates=this._candidates,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var S;U.media.fmts=f.map(j=>j.payloadType.toString(10)),U.attributes.payloads=f,U.attributes.extmaps=v;const P=U.attributes.mid;typeof P!="string"||Te(S=this.useLocalCodecsMids).call(S,P)||this.useLocalCodecsMids.push(P)}else if(c.videoCodecs.length===0){const P=u.videoCodecs.filter(j=>{var W,K;return(W=j.rtpMap)===null||W===void 0?void 0:Te(K=W.encodingName.toLowerCase()).call(K,"vp8")});P.length===0&&P.push(u.videoCodecs[0]),U.media.fmts=P.map(j=>j.payloadType.toString(10)),U.attributes.payloads=P,U.attributes.extmaps=[]}else U.media.fmts=c.videoCodecs.map(P=>P.payloadType.toString(10)),U.attributes.payloads=c.videoCodecs,U.attributes.extmaps=c.videoExtensions;if(U.media.mediaType==="audio")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var C;U.media.fmts=g.map(j=>j.payloadType.toString(10)),U.attributes.payloads=g,U.attributes.extmaps=_;const P=U.attributes.mid;typeof P!="string"||Te(C=this.useLocalCodecsMids).call(C,P)||this.useLocalCodecsMids.push(P)}else if(c.audioCodecs.length===0){const P=u.audioCodecs.filter(j=>{var W,K;return(W=j.rtpMap)===null||W===void 0?void 0:Te(K=W.encodingName.toLowerCase()).call(K,"opus")})||[u.audioCodecs[0]];U.media.fmts=P.map(j=>j.payloadType.toString(10)),U.attributes.payloads=P,U.attributes.extmaps=[]}else U.media.fmts=c.audioCodecs.map(P=>P.payloadType.toString(10)),U.attributes.payloads=c.audioCodecs,U.attributes.extmaps=c.audioExtensions,ef(U)}}return this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1,[this.sessionDesc,s]}updateCandidates(t){const r=this._originCandidates.filter(s=>s.transport==="udp"),i=[];if(r.forEach(s=>{i.push(hI(hI({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),r.length!==0){switch(t){case Ar.TCP_RELAY:this._candidates=i;break;case Ar.UDP_TCP_RELAY:case Ar.RELAY:this._candidates=[...r,...i];break;default:this._candidates=r}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(t){t=En(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}findAvailableMediaIndex(t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(bn()){if(s){const c=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return s})}createOrRecycleDataChannel(){for(const i of this.sessionDesc.mediaDescriptions)if(i.media.mediaType==="application")return{mediaDesc:i,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),r={media:{mediaType:"application",port:oE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(r),{mediaDesc:r,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,r,i,s,c,u){const h=t._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,g=iv(h,f,this.localCapabilities.send,h===Ge.VIDEO?s:c),v=h===Ge.VIDEO?f.videoExtensions:f.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let x={media:{mediaType:h,port:oE,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};x=this.mungRecvMediaDsec(x,t,u);const S=this.findFirstClosedMedia(h);if(S){const C=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[C]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}updateRemoteDtlsParameters(t){const r=new Set(this._dtlsParameters.fingerprints.map(c=>c.fingerprint)),i=new Set(t.map(c=>c.fingerprint));let s=!1;r.size!==i.size&&(s=!0);for(const c of r)i.has(c)||(s=!0);return s}updateRemoteCodec(t,r,i){const s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(x=>x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||"").filter(x=>{var S;return Te(S=Object.keys(Ou)).call(S,x)}))],c=new Set(r);if(s.every(x=>c.has(x)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const u=this._rtpCapabilities.recv.videoCodecs.filter(x=>r.some(S=>{var C;return Te(C=x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||"").call(C,S)}));if(u.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(r)),!1;const h=[...new Set(u.map(x=>x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||""))];let f;if(R.debug("updateRemoteCodec, from ".concat(s," to ").concat(h)),t.length===0)f=this.sessionDesc.mediaDescriptions.filter(x=>x.media.mediaType==="video"&&x.attributes.direction==="recvonly");else if(f=this.sessionDesc.mediaDescriptions.filter(x=>x.attributes.mid&&x.media.mediaType==="video"&&Te(t).call(t,x.attributes.mid)&&x.attributes.direction==="recvonly"),f.length!==t.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(r)),!1;if(G("USE_PUB_RTX")||G("USE_SUB_RTX")){const x=cd(u,this.rtpCapabilities.recv.videoCodecs);u.push(...x)}this._rtpCapabilities.recv.videoCodecs=u;const g=this.localCapabilities.send,v=this.rtpCapabilities.recv,_=iv(Ge.VIDEO,v,g,i);return f.forEach(x=>{const S=_.map(C=>C.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(x.attributes.mid,", from"),x.attributes.payloads,"to",_),x.attributes.payloads=_,x.media.fmts=S}),R.debug("updateRemoteCodec success, mids: ".concat(t,", codecs: ").concat(r,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(t,r,i,s,c){const u=this.rtpCapabilities.send.videoCodecs,h=this._isUseLocalCodecs||u.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,f=t===Ge.VIDEO?h.videoCodecs:h.audioCodecs,g=t===Ge.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const v="".concat(this.currentMidIndex);let _={media:{mediaType:t,port:oE,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};_=this.mungSendMediaDesc(_,c);const x=this.findFirstClosedMedia(t);if(x){const S=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,r,i){const s=En(t);return JA(s),Gu(s,r),QA(s,r),i8(s),eE(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){const i=En(t);return i.attributes&&i.attributes.payloads&&Array.isArray(i.attributes.payloads)&&i.attributes.payloads.length>0&&i.attributes.payloads.forEach(s=>{s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&G("ENABLE_DOWN_SPS_PPS")&&(s.fmtp&&s.fmtp.parameters||(s.fmtp={parameters:{}}),s.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),eE(i,r,this.localCapabilities.recv),ef(i),i}updateRecvMedia(t,r){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>bn()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var r;return(r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs}};function O8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ol(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?O8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):O8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}var rf=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(rf||{});const lE=new Map;function P8(t,r,i,s){let{scale:c}=t;if(c===0&&s===rf.UP||c>=r.length-1&&s===rf.DOWN)return t;let u=ol(ol({},t),{},{scale:s===rf.DOWN?++c:--c});switch(i){case"maintain-framerate":u=ol(ol({},u),r[c].motion);break;case"maintain-resolution":u=ol(ol({},u),r[c].detail);break;case"balanced":u=ol(ol({},u),r[c].balanced)}return u}function D8(t,r){if(r){const i={overUse:0,underUse:0,adaptationList:k8(r)};lE.set(t,i)}else lE.delete(t)}function k8(t){const r=ol({},t),{bitrateMax:i,frameRate:s,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:x,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:U,BALANCE_BITRATE_FACTOR:P,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:W,MOTION_RESOLUTION_FACTOR:K,MOTION_BITRATE_FACTOR:J,DETAIL_FRAMERATE_FACTOR:re,DETAIL_BITRATE_FACTOR:ie}=sA,Z=Math.min(r.frameRate,f),se=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(C,1)*Z),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u}}];for(let ge=1;ge<=g;ge++){const Ee={bwe_up:Math.round(Math.pow(x,ge)*i),bwe_down:Math.round(Math.pow(S,ge+1)*i),fps_up:Math.round(Math.pow(U,ge)*Z),fps_down:Math.round(Math.pow(C,ge+1)*Z)},Fe={scaleResolutionDownBy:c/Math.pow(W,ge),frameRate:Math.max(Math.round(Math.pow(j,ge)*s),h),bitrateMax:Math.max(Math.round(Math.pow(P,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(P,ge)*u),v)},ht={scaleResolutionDownBy:c/Math.pow(K,ge),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(J,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(J,ge)*u),v)},ot={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(re,ge)*s),h),bitrateMax:Math.max(Math.round(Math.pow(ie,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(ie,ge)*u),v)};se.push({scale:ge,threshold:Ee,balanced:Fe,motion:ht,detail:ot})}return se}function Rve(t,r,i,s,c,u){const h=lE.get(t)||{overUse:0,underUse:0,adaptationList:k8(c)},{adaptationList:f}=h;lE.set(t,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:v}=sA,{scale:_}=s;let x,S;return typeof r=="number"&&r>0&&function(C,U,P,j){if(U>=P.length)return!1;let{threshold:{fps_down:W}}=P[U];return G("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(W=P[0].threshold.fps_down),C<W}(r,_,f,u)&&(h.overUse++,S=jp.CPU,h.overUse>g)||typeof i=="number"&&i>0&&function(C,U,P){if(U>=P.length)return!1;const{threshold:{bwe_down:j}}=P[U];return C<j}(i,_,f)&&(h.overUse++,S=jp.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,x=P8(s,f,u,rf.DOWN),[x,S]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(C,U,P,j){if(U===0)return;let{threshold:{fps_up:W}}=P[U];return G("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(W=P[1].threshold.fps_up),C>W}(r,_,f,u)&&function(C,U,P){if(U===0)return;const{threshold:{bwe_up:j}}=P[U];return C>j}(i,_,f)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,x=P8(s,f,u,rf.UP),x.scale===0&&(S=jp.NONE))),[x,S])}function j8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function fI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?j8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):j8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function L8(t){var r;return!!G("ENABLE_AG_ADAPTATION")&&!!(t instanceof Db||Te(r=t._hints).call(r,Jt.CUSTOM_TRACK))&&(!!G("FORCE_SUPPORT_AG_ADAPTATION")||!!(SF(14,0,!1)&&wF(17,4,!0)||xF(14)&&VR(17,4,!0)))}const dE=new Map;function M8(t,r,i,s,c,u){if(af(t,i),c(r),s!=="balanced"&&s!=="maintain-framerate"&&s!=="maintain-resolution")return;let h=-1;D8(t,r);const f=window.setInterval(()=>{const v=dE.get(t);if(!G("ENABLE_AG_ADAPTATION")||!v)return af(t,i),void c(r);const _=u();if(_.sendPackets>0&&_.OutgoingAvailableBandwidth>0){if(h===-1)return void(h=Date.now());if(Date.now()-h<1e3)return;const x=_.sendFrameRate,S=_.OutgoingAvailableBandwidth,[C,U]=Rve(t,x,S,v.adaptationConfig,r,s);U&&(i.qualityLimitationReason=U),C&&v.adaptationConfig.scale!==C.scale&&(R.debug("[".concat(t,"] applyAdaptation: ").concat(i.qualityLimitationReason,`
           sendFps `).concat(x,", bwe ").concat(S,", switch from ").concat(v.adaptationConfig.scale," to ").concat(C.scale," ")),v.adaptationConfig=fI(fI({},v.adaptationConfig),C),c(C))}},G("CHECK_LOCAL_STATS_INTERVAL")),g=fI({},r);dE.set(t,{timer:f,adaptationConfig:g,originConfig:r,adaptationFunc:c}),R.debug("[".concat(t,"] start adaptation, originConfig: ").concat(JSON.stringify(r),", degradationPreference: ").concat(s))}function af(t,r){const i=dE.get(t);if(i){const{timer:s}=i;window.clearTimeout(s),dE.delete(t)}r.qualityLimitationReason=jp.NONE,D8(t)}function Ave(t,r){var i;let s;switch(r){case Ce.LocalAudioTrack:s=tn.Audio;break;case Ce.LocalVideoTrack:s=Te(i=t._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Ce.LocalVideoLowTrack:s=tn.Low}return s}function mI(t){const r=It();if(t.some(i=>i._bypassWebAudio))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function gI(t,r){mI(t);const i=new or;return t.forEach(s=>i.addAudioTrack(s)),i}const Ive=!It().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&mc();function cv(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.useDcSignal)return i={spec:r,store:t},Do("DataChannelConnection").create(i);var i;return Ive?function(c){return Do("PlanBConnection").create(c)}({spec:r,store:t}):new $a(r,t)}function vI(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function yI(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(wu(t.turnServer.servers))return!1;if(G("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Ut;function U8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function jo(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?U8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):U8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let $a=(Ut=class dh extends Yb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Te(i=Object.keys(Ou)).call(i,r)}))]}constructor(r,i){super(r,i),L(this,"id",Zt(5,"connection-")),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"forceTurn",!1),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"transportEventReceiver",void 0),L(this,"statsFilter",void 0),L(this,"extension",{useXR:G("USE_XR")}),L(this,"localCapabilities",void 0),L(this,"remoteCodecs",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"isPreallocation",!1),L(this,"isPreRender",!1),L(this,"preMediaMap",new Map),L(this,"dataStreamChannelMap",new Map),L(this,"establishPromise",void 0),L(this,"recoveredDataChannelIds",[]),L(this,"currentDataChannelId",1),L(this,"supportAV1RtpSpec",!1),L(this,"mutex",void 0),L(this,"qualityLimitationReason",jp.NONE),L(this,"isFirstConnected",!1),this.store=i,this.forceTurn=yI(r),this.mutex=new Rr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(dh.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=xb(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,bn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Ec(i.sdp),c=await eI({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=rv(c),this.initialOffer=i,G("ENABLE_SVC")&&this.store.codec=="av1"){const h=await a8();var r;h&&(this.supportAV1RtpSpec=!0,(r=c.send)===null||r===void 0||r.videoExtensions.push(h))}let u;return i.sdp&&tE(i.sdp)&&(u=En(c),J6(u)),jo(jo({},s),{},{rtpCapabilities:u||c,offerSDP:i.sdp})}catch(i){throw new pe($.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&tE(this.initialOffer.sdp)&&Q6(r.rtpCapabilities,this.localCapabilities),this.remoteSDP=new I8(jo(jo({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&Yg(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=tI(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),Yg(this.store))if(r.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const h=G("PRE_SUB_NUM"),{mids:f,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(h);await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(f,g)}else{const{preSSRCs:h=[]}=r,f=h.map(v=>v.ssrcMsg[0].ssrcId);if(h.length===0)return;const{mids:g}=this.remoteSDP.batchSend(h.map(v=>Object.assign({},v)));await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(g,f)}}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}presetMedia(r,i){r.forEach((s,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&s===u.mid&&u.receiver.track){const h=u.receiver.track;let f;h.kind==="video"&&G("ENABLE_PRE_RENDER")&&(f=new Pb({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(Zt(5,""))},!0),f.updateVideoTrack(h),f.onFirstVideoFrameRender=()=>{var g;const v=this.preMediaMap.get(i[c]);v&&(v.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,i[c])},f.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,i[c])},f.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(i[c],{mid:s,track:h,player:f,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:s}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||h}const{preSSRCs:c=[]}=r,u=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){const h=[],f=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[v,{mid:_,player:x,track:S}]=g;return h.push(_),f.push(v),this.preMediaMap.delete(v),x&&x.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await ea(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),$e.reportApiInvoke(this.store.sessionId,{name:wn.PRELOAD_MEDIA_FAILED,options:[c,f],tag:ln.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(v=>Object.assign({},v)));await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}i?(await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Li(function*(){const u=yield Tt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=ev();r.forEach(j=>{const W=c.peerConnection.addTransceiver(j._mediaStreamTrack,jo({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));h.push(W),j._updateRtpTransceiver(W)}),bn()&&G("SIMULCAST")===!0&&(yield Tt(c.applySimulcastForFirefox(h,r)));const g=yield Tt(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),_=c.mungSendOfferSDP(g.sdp,r,v),x=Ti(_),S=v.map(j=>{const W=x.mediaDescriptions.find(K=>K.attributes.mid===j);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return XA(W,G("USE_PUB_RTX"))});let C;try{C=yield S}catch(j){C=[],c.remoteSDP.receive(r,i,s,C);const W=c.remoteSDP.toString();throw yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Tt(c.stopSending(v,!0)),j}c.remoteSDP.receive(r,i,s,C);const U=c.remoteSDP.toString(),P=c.logSDPExchange(_,"offer","local","send");return yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.applySimulcastEncodings(h,r)),yield Tt(c.applySendEncodings(h,r)),P==null||P(U),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:U})),h.map((j,W)=>{const K=v[W];return{localSSRC:S[W],id:K,transceiver:j}})}catch(h){throw h instanceof pe?h:new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}i.forEach(u=>{u._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof pe?s:new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof pe?i:new pe($.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var v;af(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,s,c);h&&(await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:u,transceiver:f}}catch(u){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preMediaMap.entries()).some(h=>{let[f,{mid:g,player:v}]=h;if(g===u)return this.preMediaMap.delete(f),v&&v.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,f)=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Li(function*(){const s=yield Tt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=It().supportPCSetConfiguration,u=G("FORCE_TURN_TCP")||i.forceTurn;if(r===Ar.RELAY&&!c)return;if(c&&!u){const x=r===Ar.RELAY?"relay":"all",S=i.peerConnection.getConfiguration();S.iceTransportPolicy!==x&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(x,"]")),S.iceTransportPolicy=x,i.peerConnection.setConfiguration(S))}i.remoteSDP.updateCandidates(r);const h=yield Tt(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Ec(h.sdp),{remoteIceParameters:g}=yield f.iceParameters;i.remoteSDP.restartICE(g);const v=i.remoteSDP.toString(),_=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Tt(i.peerConnection.setLocalDescription(h)),_==null||_(v),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ar.TCP_RELAY),await ea(this.peerConnection,this.remoteSDP,this.extension)}catch(i){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{af(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:s}=i;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return jo(jo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new pe($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?bn()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:jo(jo({},Vs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:jo(jo({},Vs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",u=bc(r.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(u||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},s=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(wu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:G("NEW_TURN_MODE")&&i.iceServers&&s==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...dh.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...dh.newTurnServerConfigToIceServers(r.turnServer.servers)),G("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...dh.turnServerConfigToIceServers(r.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...dh.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Hs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!G("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{const c=G("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Hs(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Hs(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:u}=s.getSelectedCandidatePair()||{};if(c&&u){const h=c.address+":"+c.port,f=u.address+":"+u.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(bc(h)),", remote ").concat(JSON.stringify(bc(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const f=q6(this.peerConnection,r._mediaStreamTrack),g=UV(r);if(L8(r)&&f&&i&&g&&this.getLocalVideoStats&&Te(s=["vp8","vp9"]).call(s,this.store.codec)){var v;const P=u.degradationPreference||(Te(v=r._hints).call(v,Jt.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");M8(this.id+f.mid,g,this,P,j=>{i&&this.updateAdaptation(i,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;const{bitrateMax:P,frameRate:j,scaleResolutionDownBy:W}=r._encoderConfig;P&&(h.maxBitrate=1e3*P),(Te(_=r._hints).call(_,Jt.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=Bi(j)),W&&W>=1&&(h.scaleResolutionDownBy=W))}const{maxFramerate:x}=G("ENCODER_CONFIG_LIMIT");if(x&&typeof x=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,x):x),G("DSCP_TYPE")&&mc()){var S;const P=G("DSCP_TYPE");Te(S=["very-low","low","medium","high"]).call(S,P)&&(h.networkPriority=P)}const C=i.getParameters(),U=(c=C.encodings)===null||c===void 0?void 0:c[0];bn()&&!U&&(u.encodings=[h]),U&&Object.assign(U,h),Object.assign(C,u),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await c8(this.store.codec,i,G("SVC_MODE"))}async updateAdaptation(r,i){var s,c;if(!r)return R.debug("[updateAdaptation] no rtpSender found");if(!It().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:f,scaleResolutionDownBy:g}=i;h&&(u.maxBitrate=1e3*h),f&&(u.maxFramerate=Bi(f)),g&&g>=1&&Te(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=g);const v=r.getParameters(),_=(c=v.encodings)===null||c===void 0?void 0:c[0];_&&Object.assign(_,u),Object.assign(v,{});try{await r.setParameters(v),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(x){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",x):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!It().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof dn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){if(G("FORBID_MODIFY_LOCAL_OFFER_SDP"))return r;const c=Ti(r);return i.forEach((u,h)=>{const f=s[h],g=c.mediaDescriptions.find(v=>v.attributes.mid===f);g&&(Gu(g,u),ZA(g,u,this.store.codec))}),rl(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,h,f;const v=r[g],_=i[g];if(_ instanceof dn&&!Te(s=_._hints).call(s,Jt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=_._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=_._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const x={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};x.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,x))}}}async applySimulcastEncodings(r,i){if(!bn()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof dn&&this.isVP8Simulcast(c)){const u=r[s],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var i,s,c,u,h;return!!(r instanceof dn&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Te(i=r._hints).call(i,Jt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(G("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(It().supportPCSetConfiguration){const i=dh.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},ke(Ut.prototype,"updateRemoteRTPCapabilities",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteRTPCapabilities"),Ut.prototype),ke(Ut.prototype,"connect",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"connect"),Ut.prototype),ke(Ut.prototype,"updateRemoteConnect",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteConnect"),Ut.prototype),ke(Ut.prototype,"createDataChannels",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"createDataChannels"),Ut.prototype),ke(Ut.prototype,"receive",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"receive"),Ut.prototype),ke(Ut.prototype,"batchReceive",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"batchReceive"),Ut.prototype),ke(Ut.prototype,"stopReceiving",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"stopReceiving"),Ut.prototype),ke(Ut.prototype,"muteRemote",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"muteRemote"),Ut.prototype),ke(Ut.prototype,"unmuteRemote",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteRemote"),Ut.prototype),ke(Ut.prototype,"muteLocal",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"muteLocal"),Ut.prototype),ke(Ut.prototype,"unmuteLocal",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteLocal"),Ut.prototype),ke(Ut.prototype,"close",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"close"),Ut.prototype),ke(Ut.prototype,"updateEncoderConfig",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateEncoderConfig"),Ut.prototype),ke(Ut.prototype,"updateSendParameters",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateSendParameters"),Ut.prototype),ke(Ut.prototype,"replaceTrack",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"replaceTrack"),Ut.prototype),ke(Ut.prototype,"updateAdaptation",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"updateAdaptation"),Ut.prototype),ke(Ut.prototype,"getRemoteSSRC",[Gi],Object.getOwnPropertyDescriptor(Ut.prototype,"getRemoteSSRC"),Ut.prototype),Ut);function Gi(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},i}function _I(t,r){let i=document.createElement("video"),s=document.createElement("canvas");i.setAttribute("style","display:none"),s.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),s.width=Bi(r.width),s.height=Bi(r.height);const c=Bi(r.framerate||15);document.body.append(i),document.body.append(s);let u=t._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play().catch($g);const h=s.getContext("2d");if(!h)throw new ce($.UNEXPECTED_ERROR,"can not get canvas context");const f=It(),g=s.captureStream(f.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=s),s.startCapture=()=>{if(!i)return s.stopCapture&&s.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const _=i.videoWidth,x=i.videoHeight/_,S=s.width*x;Math.abs(S-s.height)>=2&&(R.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(S)),s.height=S)}h.drawImage(i,0,0,s.width,s.height),g.requestFrame&&g.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,i.srcObject=new MediaStream([u]))},s.stopCapture=_A(()=>s.startCapture&&s.startCapture(),c);const v=g.stop;return g.stop=()=>{v.call(g),i&&(i.remove(),i.srcObject=null,i=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),R.debug("clean low stream renderer")},g}var F8=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(F8||{}),Lo=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(Lo||{}),vt=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(vt||{}),Er=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t[t.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",t}(Er||{}),Fr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Fr||{}),sf=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t[t.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",t}(sf||{}),bI=function(t){return t[t.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",t[t.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",t}(bI||{});const $u=1e3,uE=6,lv=3,Ove=Math.max(uE,lv,60);function st(t,r,i){i!=null&&Number.isFinite(i)&&(t[r]=Math.round(Math.max(0,i)))}function V8(t){const r={[Fr.CONN_TYPE]:0,[Fr.RTT]:t.rtt,[Fr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=t.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[Fr.CONN_TYPE]=1),i==="tcp"&&(r[Fr.CONN_TYPE]=3),i==="tls"&&(r[Fr.CONN_TYPE]=4);break}case"srflx":r[Fr.CONN_TYPE]=2;break;case"unknown":r[Fr.CONN_TYPE]=5;break;default:r[Fr.CONN_TYPE]=0}return r}function B8(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class G8 extends An{constructor(r){super(),L(this,"store",void 0),L(this,"uploadWRTCStatsTimer",void 0),L(this,"uploadOutboundDenoiserStatsTimer",void 0),L(this,"uploadExtStatsTimer",void 0),L(this,"uploadExtUsageStatsTimer",void 0),L(this,"uploadInboundExtStatsTimer",void 0),L(this,"requestStats",void 0),L(this,"requestTransportStats",void 0),L(this,"requestLocalMedia",void 0),L(this,"requestRemoteMedia",void 0),L(this,"requestAllTracks",void 0),L(this,"requestVideoIsReady",void 0),L(this,"requestUploadStats",void 0),L(this,"requestUpload",void 0),L(this,"uploadOutboundStarted",!1),L(this,"uploadInboundStarted",!1),L(this,"uploadTransportStarted",!1),L(this,"uploadBaseStatsStarted",!1),L(this,"uploadExtensionUsageStarted",!1),L(this,"lastRecvStats",void 0),L(this,"lastSendStats",void 0),L(this,"lastRefRecvStats",void 0),L(this,"lastRefSendStats",void 0),L(this,"lastNormalRecvStats",void 0),L(this,"lastNormalSendStats",void 0),L(this,"lastExtendStats",{}),L(this,"needUploadStats",{}),L(this,"needUploadRenderFreezeTime",!0),L(this,"lastUploadCompensateTime",-1),L(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%lv==0,s=r%uE==0,c=r%60==0;let u,h;if(this.uploadTransportStarted&&(u=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!u&&this.uploadOutboundStarted&&(u=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),u||h){var f;const g={};if(this.uploadTransportStarted&&u){const _=this.getTransportStats(u,i?this.lastRefSendStats:void 0,h,i);_&&(g.misc=[_])}if(this.uploadOutboundStarted&&u){const _=this.getOutboundStats(u,s?this.lastNormalSendStats:void 0,i?this.lastRefSendStats:void 0,this.lastSendStats,c);_&&(g.outbound=[_])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(r);const _=this.getInboundStats(h,s?this.lastNormalRecvStats:void 0,i?this.lastRefRecvStats:void 0,this.lastRecvStats);_&&(g.inbound=_)}const v=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;if(v&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[sf.RTC_PEER_CONNECTION_STATE]=rA[v]):g.misc=[{addition:{[sf.RTC_PEER_CONNECTION_STATE]:rA[v]}}]),xa.needUploadStats.length>0||s){const _=xa.needUploadStats.shift()||(xa.visibility==="visible"?1:0);Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[sf.PAGE_VISIBILITY]=_):g.misc=[{addition:{[sf.PAGE_VISIBILITY]:_}}]}this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[F8.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=u,s&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=u),i&&(this.lastRefRecvStats=h,this.lastRefSendStats=u)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,xa.startCollectStats();let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,s;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[sf.RTC_PEER_CONNECTION_STATE]:rA[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Ove+1&&(r=1)},$u)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const i=r%lv==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!i)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const s=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=s,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const u=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&u){const f=this.requestRemoteMedia()||[],g=[];f.forEach(v=>{let[_,x]=v;const S={peer:_.uid};if(_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)&&x.has(Ge.VIDEO)&&_.videoTrack){const C=function(U,P,j){if(!P.videoRecv.find(K=>K.ssrc===U))return;const W={};if(j&&j._player){const K=j._player,{renderFreezeAccTime2:J,videoElementStatus:re}=K;if(xa.visibility==="visible"&&re===Jr.PLAYING&&It().supportRequestVideoFrameCallback){const ie=Math.min(6e3,J);K.renderFreezeAccTime2=Math.max(0,J-ie),st(W,Lo.Video_Render_Freeze_Time_Render2,ie),G("USE_NEW_RENDER_FREEZE_TIME")&&st(W,Lo.Video_Render_Freeze_Time_Render,ie)}}return W}(_._videoSSRC,u,_.videoTrack);C&&(S.video=C)}S.video&&g.push(S)}),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,i,s,c){if(!this.requestStats)return;if(!c)return r.rtt==null?void 0:{addition:{[Fr.RTT]:r.rtt,[Fr.CONN_TYPE]:void 0,[Fr.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const u=V8(r);if(this.store.useP2P){if(s){const h=V8(s);u[Fr.CONN_TYPE]&&h[Fr.CONN_TYPE]&&(u[Fr.CONN_TYPE]+=h[Fr.CONN_TYPE]<<3)}u[Fr.CONN_TYPE]?u[Fr.CONN_TYPE]+=110:u[Fr.CONN_TYPE]=110}else{u[Fr.CONN_TYPE]?u[Fr.CONN_TYPE]+=100:u[Fr.CONN_TYPE]=100;const h=function(f,g){return g?[Math.ceil(8*(f.transport.bytesSent-g.transport.bytesSent)/(f.timestamp-g.timestamp)),Math.ceil(8*(f.transport.bytesReceived-g.transport.bytesReceived)/(f.timestamp-g.timestamp))]:[0,0]}(r,i);u[bI.Transport_Send_Bitrate]=h[0],u[bI.Transport_Recv_Bitrate]=h[1]}return{addition:u}}getOutboundStats(r,i,s,c,u){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let f,g,v;return h.forEach(_=>{let[x,{track:S,ssrcs:C}]=_;switch(x){case Ce.LocalVideoLowTrack:case Ce.LocalVideoTrack:if(x===Ce.LocalVideoTrack){var U;const P=function(J,re,ie,Z,se,ge){const Ee=re.videoSend.find(St=>St.ssrc===J);if(!Ee)return;const Fe={},{sentFrame:ht,inputFrame:ot}=Ee;if(Z&&(st(Fe,Lo.Video_Send_Qp_Sum,Ee.qpSumPerFrame),ot&&ht)){const St=ot.frameRate,yt=ht.frameRate;Fe[Lo.Video_Send_Freeze]=function(Yt,Cn){let ve=!0;return ve=!(Yt<=5)&&(Yt<=10?Cn<3:Yt<=20?Cn<4:Cn<5),ve}(St,yt)?1:0}if(se){switch(ht&&(st(Fe,vt.Video_Send_Height,ht.height),st(Fe,vt.Video_Send_Width,ht.width),st(Fe,vt.Video_Send_Frame_Rate,ht.frameRate)),Fe[vt.Video_Send_Disabled]=ie._originMediaStreamTrack&&!ie._originMediaStreamTrack.enabled||ie._mediaStreamTrack&&!ie._mediaStreamTrack.enabled?1:0,Ee.adaptionChangeReason){case"none":Fe[vt.Video_Send_Adaptation]=0;break;case"cpu":Fe[vt.Video_Send_Adaptation]=1;break;case"bandwidth":Fe[vt.Video_Send_Adaptation]=2;break;case"other":Fe[vt.Video_Send_Adaptation]=3}let St=0;Ee.adaptionChangeReason&&(St+=B8(Ee.adaptionChangeReason)),re.qualityLimitationReason&&(St+=B8(re.qualityLimitationReason)<<3),Fe[vt.Video_Send_Adaptation]=St,Fe[vt.Video_Send_Player_Status]=gA[ie._player?ie._player.videoElementStatus:"uninit"],st(Fe,vt.Video_Send_Nacks,Ee.nacksCount),st(Fe,vt.Video_Send_Plis,Ee.plisCount),st(Fe,vt.Video_Send_Firs,Ee.firsCount),st(Fe,vt.Video_Send_Avg_Encode,Ee.avgEncodeMs),st(Fe,vt.Video_Send_Huge_Frame_Sent,Ee.hugeFramesSent),st(Fe,vt.Video_Send_Bytes_Retransmit,Ee.retransmittedBytesSent),st(Fe,vt.Video_Send_Packages_Retransmit,Ee.retransmittedPacketsSent),st(Fe,vt.Video_Send_Key_Frames_Encoded,Ee.keyFramesEncoded);const yt=se.videoSend.find(Yt=>Yt.ssrc===J);if(yt){let Yt=$u*lv;yt.timestamp&&Ee.timestamp&&(Yt=Ee.timestamp-yt.timestamp),yt.packets!=null&&Ee.packets!=null&&st(Fe,vt.Video_Send_Package_Rate,1e3*(Ee.packets-yt.packets)/Yt),Ee.packetsLost!=null&&yt.packetsLost!=null&&st(Fe,vt.Video_Send_Package_Lost,Ee.packetsLost-yt.packetsLost),yt.bytes!=null&&Ee.bytes!=null&&st(Fe,vt.Video_Send_Bitrate,8*(Ee.bytes-yt.bytes)/Yt)}}return Fe}(C[0].ssrcId,r,S,i,s),j=S.__className__==="CameraVideoTrack"?3:Te(U=S._hints).call(U,Jt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==j||u)&&(this.needUploadStats={sendType:j},this.lastExtendStats.sendType=j);const W=S&&function(J,re,ie,Z){const se=re.videoSend.find(Ee=>Ee.ssrc===J);if(!se)return null;const ge={};if(Z){const Ee=se.inputFrame,Fe=Ee&&Ee.height||ie.videoHeight||0,ht=Ee&&Ee.width||ie.videoWidth||0,ot=Ee&&Ee.frameRate||0;st(ge,vt.Video_Capture_Height,Fe),st(ge,vt.Video_Capture_Width,ht),st(ge,vt.Video_Capture_Frame_Rate,ot)}return ge}(C[0].ssrcId,r,S,!!s),K=function(J,re){const ie={};return re&&(st(ie,vt.Video_Send_Retransmit,J.bitrate.retransmit),st(ie,vt.Video_Send_Target_Encoded,J.bitrate.targetEncoded),st(ie,vt.Video_Send_Actual_Encoded,J.bitrate.actualEncoded),st(ie,vt.Video_Send_Transmit,J.bitrate.transmit),st(ie,vt.Video_Send_Bandwidth,J.sendBandwidth)),ie}(r,!!s);g=Object.assign({},P,W,K)}else v=function(P,j,W,K,J){const re=j.videoSend.find(Z=>Z.ssrc===P);if(!re)return;const ie={};if(K){const Z=re.sentFrame;Z&&(st(ie,vt.Video_Send_Low_Height,Z.height),st(ie,vt.Video_Send_Low_Width,Z.width),st(ie,vt.Video_Send_Low_Frame_Rate,Z.frameRate));const se=K.videoSend.find(ge=>ge.ssrc===P);if(se){let ge=$u*uE;se.timestamp&&re.timestamp&&(ge=re.timestamp-se.timestamp),se.packets!=null&&re.packets!=null&&st(ie,vt.Video_Send_Low_Package_Rate,1e3*(re.packets-se.packets)/ge),re.packetsLost!=null&&se.packetsLost!=null&&st(ie,vt.Video_Send_Low_Package_Lost,re.packetsLost-se.packetsLost),se.bytes!=null&&re.bytes!=null&&st(ie,vt.Video_Send_Low_Bitrate,8*(re.bytes-se.bytes)/ge)}}return ie}(C[0].ssrcId,r,0,s);break;case Ce.LocalAudioTrack:f=S&&function(P,j,W,K,J,re){const ie=j.audioSend.find(se=>se.ssrc===P);if(!ie)return;const Z={};if(J){Z[vt.Audio_Send_Disabled]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0;const se=100*W._source.getAccurateVolumeLevel(),ge=ie.inputLevel;if(ge!=null){const Fe=Math.ceil(50*Math.log10(100*ge+1));st(Z,vt.Audio_Send_Level,Fe)}st(Z,vt.Audio_Capture_PCM_Level,se),st(Z,vt.Audio_Send_AEC_Return_Loss,ie.aecReturnLoss),st(Z,vt.Audio_Send_AEC_Return_Loss_Enhancement,ie.aecReturnLossEnhancement),st(Z,vt.Audio_Send_Bytes_Retransmit,ie.retransmittedBytesSent),st(Z,vt.Audio_Send_Packages_Retransmit,ie.retransmittedPacketsSent),Z[vt.Audio_Send_Freeze]=0;const Ee=J.audioSend.find(Fe=>Fe.ssrc===P);if(Ee){let Fe=$u*uE;Ee.timestamp&&ie.timestamp&&(Fe=ie.timestamp-Ee.timestamp),Ee.bytes!=null&&ie.bytes!=null&&st(Z,vt.Audio_Send_Bitrate,8*(ie.bytes-Ee.bytes)/Fe),Ee.packets!=null&&ie.packets!=null&&st(Z,vt.Audio_Send_Package_Rate,1e3*(ie.packets-Ee.packets)/Fe)}}return Z}(C[0].ssrcId,r,S,0,s)}}),{high:g,low:v,audio:f}}getInboundStats(r,i,s,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(f=>{let[g,v]=f;const _={peer:g.uid};let x;if(v.has(Ge.VIDEO)&&g.videoTrack){const S=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,C=g.videoTrack?function(U,P,j,W,K,J,re,ie){const Z=P.videoRecv.find(yt=>yt.ssrc===U);if(!Z)return;const se={},{receivedFrame:ge,outputFrame:Ee,decodeFrameRate:Fe}=Z;st(se,Er.Video_Render_Frame_Rate_Decode,Fe),Z.framesRateFirefox&&st(se,Er.Video_Recv_Frame_Rate,Z.framesRateFirefox),ge&&st(se,Er.Video_Recv_Frame_Rate,ge.frameRate),st(se,Er.Video_Recv_Frame_Dropped,Z.framesDroppedCount),st(se,Er.Video_Recv_Bytes_Retransmit,Z.retransmittedBytesReceived),st(se,Er.Video_Recv_Packages_Retransmit,Z.retransmittedPacketsReceived),st(se,Er.Video_Recv_Packages_Discarded,Z.packetsDiscarded),st(se,Er.Video_Recv_Avg_Decode,Z.avgDecodeMs),st(se,Er.Video_Recv_Avg_Processing_Delay,Z.avgProcessingDelayMs),st(se,Er.Video_Recv_Avg_Assembly_Time,Z.avgFramesAssembledFromMultiplePacketsMs),st(se,Er.Video_Recv_Avg_Inter_Frame_Delay,Z.avgInterFrameDelayMs),st(se,Er.Video_Recv_Key_Frames_Decoded,Z.keyFramesDecoded);const ht=ie&&ie.videoRecv.find(yt=>yt.ssrc===U);if(ht){const yt=P.timestamp-ie.timestamp||$u;Z.packetsLost!=null&&ht.packetsLost!=null&&st(se,Er.Video_Recv_Package_Lost,Z.packetsLost-ht.packetsLost),ht.bytes!=null&&Z.bytes!=null&&st(se,Er.Video_Recv_Bitrate,8*(Z.bytes-ht.bytes)/yt),ht.packets!=null&&Z.packets!=null&&st(se,Er.Video_Recv_Package_Rate,1e3*(Z.packets-ht.packets)/yt)}const ot=J&&J.videoRecv.find(yt=>yt.ssrc===U);if(ot&&(st(se,Lo.Video_Recv_Qp_Sum,Z.qpSumPerFrame),se[Lo.Video_Recv_Freeze]=W&&ov.isRemoteVideoFreeze(j,Z,ot)?1:0),re){var St;const yt=re.videoRecv.find(Cn=>Cn.ssrc===U);ge?(st(se,vt.Video_Recv_Height,ge.height),st(se,vt.Video_Recv_Width,ge.width)):j&&(st(se,vt.Video_Recv_Height,j._videoHeight||0),st(se,vt.Video_Recv_Width,j._videoWidth||0)),Ee&&st(se,vt.Video_Recv_Frame_Rate_Output,Ee.frameRate);const Yt=(St=j._player)===null||St===void 0?void 0:St.rendFrameRate.toFixed(0);if(Yt&&st(se,vt.Video_Render_Frame_Rate_Render,+Yt),st(se,vt.Video_Recv_Jitter_Buffer,Z.jitterBufferMs),st(se,vt.Video_Recv_Current_Delay,Z.currentDelayMs),st(se,vt.Video_Recv_Firs,Z.firsCount),st(se,vt.Video_Recv_Nacks,Z.nacksCount),st(se,vt.Video_Recv_Plis,Z.plisCount),j){se[vt.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const Cn=j._player;if(Cn){const{freezeTimeCounterList:ve,renderFreezeAccTime:Oe,renderFreezeAccTime2:We,videoElementStatus:_e}=Cn;if(ve&&ve.length>0&&st(se,Lo.Video_Render_Freeze_Time,ve.splice(0,1)[0]),K&&xa.visibility==="visible"&&_e===Jr.PLAYING&&It().supportRequestVideoFrameCallback){const I=Math.min(6e3,We);Cn.renderFreezeAccTime2=Math.max(0,We-I),st(se,Lo.Video_Render_Freeze_Time_Render2,I);const X=Math.min(6e3,Oe);Cn.renderFreezeAccTime=Math.max(0,Oe-X),st(se,Lo.Video_Render_Freeze_Time_Render,G("USE_NEW_RENDER_FREEZE_TIME")?I:X)}if(typeof Z.totalFreezesDuration=="number"){const I=yt&&yt.totalFreezesDuration?Z.totalFreezesDuration-yt.totalFreezesDuration:Z.totalFreezesDuration;st(se,vt.Video_Render_Freeze_Duration,1e3*I)}}}if(se[vt.Video_Recv_Player_Status]=gA[j._player?j._player.videoElementStatus:"uninit"],yt&&Z.totalInterFrameDelay!==void 0&&Z.totalSquaredInterFrameDelay!==void 0&&yt.totalInterFrameDelay!==void 0&&yt.totalSquaredInterFrameDelay!==void 0){const Cn=Z.totalInterFrameDelay-yt.totalInterFrameDelay,ve=Z.totalSquaredInterFrameDelay-yt.totalSquaredInterFrameDelay,Oe=Z.framesDecodeCount-yt.framesDecodeCount,We=Cn/Oe*1e3,_e=Math.round(1e3*Math.sqrt((ve-Math.pow(Cn,2)/Oe)/Oe));!isNaN(_e)&&We+_e>Math.max(3*We,We+150)&&(se[vt.Video_Recv_I_Frame_Delay]=_e)}}return se}(g._videoSSRC,r,g.videoTrack,S===!0,this.needUploadRenderFreezeTime,i,s,c):void 0;if(C&&(_.video=C),g.videoTrack){const U=r.videoRecv.find(P=>P.ssrc===g._videoSSRC);U&&U.estimatedPlayoutTimestamp&&(x=U.estimatedPlayoutTimestamp)}}if(v.has(Ge.AUDIO)&&g.audioTrack){const S=g.audioTrack?function(C,U,P,j,W,K){const J=U.audioRecv.find(se=>se.ssrc===C);if(!J)return;const re={};st(re,Er.Audio_Recv_Jitter,J.jitterMs),st(re,Er.Audio_Recv_Bytes_Retransmit,J.retransmittedBytesReceived),st(re,Er.Audio_Recv_Packages_Retransmit,J.retransmittedPacketsReceived),st(re,Er.Audio_Recv_Packages_Discarded,J.packetsDiscarded),st(re,Er.Audio_Recv_Avg_Processing_Delay,J.avgProcessingDelayMs);const ie=K&&K.audioRecv.find(se=>se.ssrc===C);if(ie){const se=$u;J.packets!=null&&ie.packets!=null&&st(re,Er.Audio_Recv_Package_Rate,1e3*(J.packets-ie.packets)/se),J.packetsLost!=null&&ie.packetsLost!=null&&st(re,Er.Audio_Recv_Package_Lost,J.packetsLost-ie.packetsLost)}if(j){const{receivedFrames:se,droppedFrames:ge}=J;se!=null&&ge!=null&&(re[Lo.Audio_Recv_Freeze]=(Z=se)===0||100*ge/Z>20?1:0)}var Z;if(W){const se=100*P._source.getAccurateVolumeLevel(),ge=J.outputLevel;if(ge!=null){const Fe=Math.ceil(50*Math.log10(100*ge+1));st(re,vt.Audio_Render_Level,Fe)}st(re,vt.Audio_Recv_PCM_Level,se),P&&(re[vt.Audio_Recv_Disabled]=P._originMediaStreamTrack.enabled&&P._mediaStreamTrack.enabled?0:1),st(re,vt.Audio_Recv_Jitter_Buffer,J.jitterBufferMs),st(re,vt.Audio_Recv_Current_Delay,J.jitterBufferMs),re[vt.Audio_Recv_Player_Status]=gA[hi.getPlayerState(P.getTrackId())];const Ee=W.audioRecv.find(Fe=>Fe.ssrc===C);if(Ee){Ee.bytes!=null&&J.bytes!=null&&st(re,vt.Audio_Recv_Bitrate,8*(J.bytes-Ee.bytes)/($u*lv));const Fe=J.concealedSamples-Ee.concealedSamples;Fe>0&&st(re,vt.Audio_Recv_Concealed_Samples,Fe);const ht=J.totalSamplesReceived-Ee.totalSamplesReceived;ht>0&&st(re,vt.Audio_Recv_Total_Samples_Received,ht);const ot=J.freezeSamples80-Ee.freezeSamples80;ot>0&&st(re,vt.Audio_Render_Freeze_Samples_80ms,ot);const St=J.freezeSamples200-Ee.freezeSamples200;St>0&&st(re,vt.Audio_Render_Freeze_Samples_200ms,St);const yt=J.freezeMs80-Ee.freezeMs80;st(re,vt.Audio_Render_Freeze_Time_80ms,yt<0?0:yt);const Yt=J.freezeMs200-Ee.freezeMs200;st(re,vt.Audio_Render_Freeze_Time_200ms,Yt<0?0:Yt)}}return re}(g._audioSSRC,r,g.audioTrack,i,s,c):void 0;if(S&&(_.audio=S),g.audioTrack&&x){const C=r.audioRecv.find(U=>U.ssrc===g._audioSSRC);if(C&&C.estimatedPlayoutTimestamp){const U=C.estimatedPlayoutTimestamp-x;_.audio?_.audio[Er.Audio_Recv_AV_Sync_TIME]=U:_.audio={[Er.Audio_Recv_AV_Sync_TIME]:U}}}}(_.video||_.audio)&&h.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof Xg);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(Vu.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,s]=r;s.has(Ge.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),s.has(Ge.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),s={connectionInterval:G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,_]of h)_.has(Ge.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),_.has(Ge.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;s.details=function(v,_){const x={};for(const{id:P,value:j,level:W,direction:K}of v){var S;const J=(S=_.get(P))!==null&&S!==void 0?S:0,re=j===2?J+G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:J;var C,U;_.set(P,re),x[P]?(j===2&&(x[P].value=j),W>x[P].level&&(x[P].level=W),K==="remote"&&(x[P].remoteUidCount+=1),x[P].totalTs=(C=_.get(P))!==null&&C!==void 0?C:0):x[P]={value:j,level:W,remoteUidCount:K==="local"?0:1,totalTs:(U=_.get(P))!==null&&U!==void 0?U:0}}return Object.keys(x).map(P=>{const{level:j,value:W,totalTs:K}=x[P];return{id:P,level:j,value:W,totalTs:K}})}(c,r);const f=Date.now(),g=f>i?f:i+1;this.requestUpload&&this.requestUpload(Vu.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:g})},G("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,xa.stopCollectStats()}}const Pve=G("ICE_RESTART_INTERVAL");let hE=new Map,of=new Map,dd=[Ar.UDP_TCP_RELAY,Ar.TCP_RELAY,Ar.RELAY],EI=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&It().supportPCSetConfiguration;function W8(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=hE.get(t.id);i&&(window.clearTimeout(i),hE.delete(t.id));const s=of.get(t.id);r&&s&&s.index===dd.length-1&&(R.debug("[".concat(t.id,"] reset ICE restart policy")),of.delete(t.id))}function $8(t,r,i){if(hE.size===0&&of.size===0&&(Array.isArray(G("RESTART_SEQUENCE"))&&G("RESTART_SEQUENCE").length>0&&!function(f,g){if(f.length!==g.length)return!1;for(let v=0;v<f.length;v+=1){const _=f[v];if(f.filter(x=>x===_).length!==g.filter(x=>x===_).length)return!1}return!0}(dd,G("RESTART_SEQUENCE"))&&(dd=G("RESTART_SEQUENCE").filter(f=>{var g;if(Te(g=Object.values(Ar)).call(g,f))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(dd.join(" => ")))),EI=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&It().supportPCSetConfiguration),dd.length===0)return void i();let s,{index:c=0,type:u}=of.get(t.id)||{};if(EI&&u===Ar.RELAY)return void i();let h=u&&c>=dd.length-1;if(EI)u=Ar.RELAY;else{if(h)return void i();u?(c++,u=dd[c]):(u=dd[0],c=0)}R.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),of.set(t.id,{index:c,type:u}),s=window.setTimeout(()=>$8(t,r,i),Pve),hE.set(t.id,s)}var Pt;function H8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function wc(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?H8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):H8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function z8(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=ab,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new pE(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function pE(t){function r(i){if(Object(i)!==i)return De.reject(new TypeError(i+" is not an object."));var s=i.done;return De.resolve(i.value).then(function(c){return{value:c,done:s}})}return pE=function(i){this.s=i,this.n=i.next},pE.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?De.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?De.reject(i):r(s.apply(this.s,arguments))}},new pE(t)}let Hu=(Pt=class extends An{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(qe.StateChange,r,this._state)}constructor(t,r){super(),L(this,"isPlanB",void 0),L(this,"store",void 0),L(this,"statsUploader",void 0),L(this,"connection",void 0),L(this,"localTrackMap",new Map),L(this,"remoteUserMap",new Map),L(this,"localDataChannels",[]),L(this,"remoteDataChannelMap",new Map),L(this,"pendingLocalTracks",[]),L(this,"pendingRemoteTracks",[]),L(this,"pendingLocalDataChannels",[]),L(this,"pendingRemoteDataChannels",[]),L(this,"statsCollector",void 0),L(this,"shouldForwardP2PCreation",void 0),L(this,"iceFailedCount",0),L(this,"dtlsFailedCount",0),L(this,"mutex",void 0),L(this,"_state",Xt.Disconnected),L(this,"_pcStatsUploadType",G("NEW_ICE_RESTART")?sl.FIRST_CONNECTION:sl.OLD_FIRST_CONNECTION),L(this,"_isStartRestartIce",!1),L(this,"_restartTimer",void 0),L(this,"_isTryConnecting",!1),L(this,"_iceError",null),L(this,"_forceTurn",!1),L(this,"_isWaitPcToRePub",!1),L(this,"handleMuteLocalTrack",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Xt.Connected)return void c(new pe($.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void s();const f=h.find(v=>v[0]==="videoLowTrack");if(f){const v=f[1];this.store.enableInstantMuteRestore?(v.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):v.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(v=>{let[,{id:_}]=v;return _}));const g=this.createMuteMessage(h);await fn(this,qe.RequestMuteLocal,g),s()}catch(h){c(h)}finally{u()}}),L(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Xt.Connected)return void c(new pe($.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void s();const f=h.find(v=>v[0]==="videoLowTrack");if(f){const v=f[1];if(this.store.enableInstantMuteRestore)v.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(v.track._originMediaStreamTrack.stop(),!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const _=i._mediaStreamTrack.clone();v.track._mediaStreamTrack=_,v.track._originMediaStreamTrack=_}else{const _=_I(i,Cu(this,qe.RequestLowStreamParameter));v.track._mediaStreamTrack=_,v.track._originMediaStreamTrack=_}await new De((_,x)=>{this.handleReplaceTrack(v.track,_,x,!0)})}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(v=>{let[,{id:_}]=v;return _}));const g=this.createUnmuteMessage(h);await fn(this,qe.RequestUnmuteLocal,g),s()}catch(h){c(h)}finally{u()}}),L(this,"handleUpdateVideoEncoder",async(i,s,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ce.LocalVideoTrack);if(!this.connection||!g||g.track!==i||this.state!==Xt.Connected)return void s();const{id:v,track:_}=g;await this.connection.updateSendParameters(v,_),await this.connection.updateEncoderConfig(v,_),this.emit(qe.UpdateVideoEncoder,_),s()}catch(g){c(g)}finally{var f;(f=h)===null||f===void 0||f()}}),L(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ce.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Xt.Connected)return void s();const{id:f,track:g}=h;await this.connection.updateSendParameters(f,g),s()}catch(h){c(h)}finally{u()}}),L(this,"handleReplaceMixingTrack",async(i,s,c,u)=>{if(!this.connection||this.state!==Xt.Connected)return void s();const h=gI([i]);let f;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(f=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),s()}catch(v){c(v)}finally{var g;(g=f)===null||g===void 0||g()}}),L(this,"handleReplaceTrack",async(i,s,c,u)=>{let h;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:x}]=_;return i===x});if(!this.connection||!v||this.state!==Xt.Connected)return void s();if(await((f=this.connection)===null||f===void 0?void 0:f.replaceTrack(i,v[1].id)),this.isPlanB){const _=v[1];_.id=i._mediaStreamTrack.id,this.localTrackMap.set(v[0],_)}if(v[0]===Ce.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const _=this.localTrackMap.get(Ce.LocalVideoLowTrack);if(_){const x=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=x,_.track._originMediaStreamTrack=x,await new De((S,C)=>{this.handleReplaceTrack(_.track,S,C,!0)})}}s()}catch(v){c(v)}finally{var g;(g=h)===null||g===void 0||g()}}),L(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),L(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),L(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),L(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),L(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new G8(this.store),this.bindStatsUploaderEvents(),this.mutex=new Rr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!It().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&mc(),this.shouldForwardP2PCreation=G("FORWARD_P2P_CREATION")&&It().supportPCSetConfiguration&&AF(),this.shouldForwardP2PCreation&&(this.connection=cv(this.store),this.emit(qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,r){var i;this.state=Xt.New,this._forceTurn=yI(t),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||s||r)&&((s||r)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=cv(this.store,t),this.emit(qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=G("NEW_ICE_RESTART")?sl.FIRST_CONNECTION:sl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==Xt.Connected){this.store.peerConnectionStart();const r=await this.connection.connect(t);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Xt.Connected,r}if(this.connection instanceof $a&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),$e.reportApiInvoke(this.store.sessionId,{name:wn.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:ln.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(qe.RequestReconnect)});await this.connection.updateRemoteConnect(t)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return Te(u=[Ce.LocalVideoLowTrack,Ce.LocalVideoTrack]).call(u,h)}),i=r.map(c=>{let[,{id:u}]=c;return u}),s=r.map(c=>{let[u]=c;return u});if(this.connection instanceof $a||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if($e.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Te(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>Te(t).call(t,u));c&&(this.store.codec=c,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,t)}}async getEstablishParams(){var t;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof $a&&this.connection.peerConnectionState!=="closed"&&Te(t=[Xt.New,Xt.Connected]).call(t,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(t){if(!this.connection||this.state!==Xt.Connected){if(this.state===Xt.Disconnected)throw new pe($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(i=>{var s;Te(s=this.pendingLocalDataChannels).call(s,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}),t.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(t,r,i){var s=this;return Li(function*(){const c=yield Tt(s.mutex.lock("From P2PChannel.publish"));try{var u;const h=s.connection&&Te(u=["disconnected","failed"]).call(u,s.connection.peerConnectionState);if(!s.connection||s.state!==Xt.Connected||h){if(s.state===Xt.Disconnected)throw new pe($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(t);const g=t.filter(v=>s.pendingLocalTracks.indexOf(v)===-1);return s.pendingLocalTracks=s.pendingLocalTracks.concat(g),void(h&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,Zr.markPublishStart(s.store.clientId,s.store.pubId);const f=s.filterTobePublishedTracks(t,r,i);if(f.length===0)return void(yield Tt(s.tryToUnmuteAudio(t)));yield*Ap(z8(s.doPublish(s.connection,f)))}finally{c()}})()}doPublish(t,r){var i=this;return Li(function*(){r.forEach(S=>{let{track:C,type:U}=S;const P=Date.now();i.store.publish(C.getTrackId(),U===Ce.LocalAudioTrack?"audio":"video",P)}),i.bindLocalTrackEvents(r);const s=r.map(S=>{let{track:C}=S;return C}),c=yield Tt(t.send(s,i.store.codec,i.store.audioCodec)),u=(yield Tt(c.next())).value,h=i.createGatewayPublishMessage(r,u);let f;try{f=yield h}catch(S){throw c.throw(S),(S==null?void 0:S.code)===$.WS_ABORT&&r.forEach(C=>{let{track:U}=C;i.pendingLocalTracks.indexOf(U)===-1&&i.pendingLocalTracks.push(U)}),i.unbindLocalTrackEvents(r),S}const g=i.mapPubResToRemoteConfig(h,f,s),v=(yield Tt(c.next(g))).value;if(i.state===Xt.Disconnected)throw new pe($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");G("ENABLE_VIDEO_SEI");const _=G("ENABLE_ENCODED_TRANSFORM"),x=G("ENABLE_AUDIO_METADATA");s.forEach(async S=>{const C=S.getRTCRtpTransceiver();if(!C||!_)return;const{interceptLocalVideoFrame:U,interceptLocalAudioFrame:P}=nE();S.trackMediaType===Ge.VIDEO?await U(C.sender,S):S.trackMediaType===Ge.AUDIO&&await P(C.sender,{metadata:x?()=>{const j=S.metadata.shift();return j&&j.value}:void 0})}),r.forEach(S=>{let{type:C}=S;i.statsCollector.addLocalStats(C)}),i.assignLocalTracks(r,v),i.statsUploader.startUploadOutboundStats(),r.forEach(S=>{let{track:C,type:U}=S;const P=Date.now();i.store.publish(C.getTrackId(),U===Ce.LocalAudioTrack?"audio":"video",void 0,P)})})()}async updateVideoStreamParameter(t,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof dn))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=i,c=function(u,h){const f={};return u.height&&u.width&&(f.scaleResolutionDownBy=qA(u,h)),f.maxFramerate=u.framerate?Bi(u.framerate):void 0,f.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,f}(t,s);if(s._encoderConfig||(s._encoderConfig={}),r!==Ce.LocalVideoLowTrack||!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=s._originMediaStreamTrack;if(!u.canvas)return R.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(h,f){const g=h.canvas;f.width&&(g.width=Bi(f.width)),f.height&&(g.height=Bi(f.height)),f.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=_A(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Bi(f.framerate)))})(u,t)}c.maxBitrate!=null&&(s._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=c.maxFramerate:s._encoderConfig.frameRate={max:c.maxFramerate}),R.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(t){var r=this;return Li(function*(){if(!r.connection||r.state!==Xt.Connected)return;const i=yield Tt(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ce.LocalVideoTrack);if(!c)throw new pe($.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ce.LocalVideoLowTrack))throw new pe($.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,t),type:Ce.LocalVideoLowTrack}];if(yield*Ap(z8(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var s;const h=(s=r.localTrackMap.get(Ce.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;h!==void 0&&(yield Tt(r.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await er(this,qe.RequestRePublish,this.pendingLocalTracks),this.emit(qe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await er(this,qe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:s}=this.pendingRemoteTracks[r];(s!==Ge.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==Ge.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await er(this,qe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===Ge.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(qe.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Xt.Connected)return void t.forEach(s=>{const c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const i=r.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Xt.Connected)return void t.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Xt.Connected)return;const t=this.localTrackMap.get(Ce.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Ce.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const i=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(s=>{let[c,{track:u}]=s;return{type:c,track:u}})),r.forEach(s=>{let[c]=s;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Xt.Connected)throw new pe($.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(s=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(t.uid,i),i.forEach(s=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(s.id,s):this.remoteDataChannelMap.set(t,new Map([[s.id,s]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:f,id:g}=h;return f.uid===t.uid&&g===s.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(s=>s.id)}async subscribe(t,r,i,s,c){var u;if(!this.connection||this.state!==Xt.Connected)throw new pe($.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(r))return;let h,f,g,v;const _=this.connection.getPreMedia(i);if(_)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),g=_.transceiver,h=_.track,f=_.mid,v=_.player,_.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:_.firstVideoRender});else if(c){const C=c.find(P=>{let{stream_type:j}=P;return j===r});if(!C)throw new pe($.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const U=await this.connection.receive(r,C.ssrcs,String(t._uintid),C.attributes);(this.connection instanceof $a||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=U.transceiver),h=U.track,f=U.id}else{const C=await this.connection.receive(r,[{ssrcId:i,rtx:s}],String(t._uintid),void 0);(this.connection instanceof $a||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=C.transceiver),h=C.track,f=C.id}if(r===Ge.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new zp(h,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),g&&t._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new Hp(h,t.uid,t._uintid,this.store,v),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(ls.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(ls.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),v?t._videoTrack.once(ls.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(ls.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),g&&t._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._videoTrack)),g&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:U}=nE();r==Ge.VIDEO?await C(g.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(P=>{var j;return(j=t._videoTrack)===null||j===void 0?void 0:j._onSei(P)}),onFirstFrame:P=>{var j;const W=Array.from(si(j=this.remoteUserMap).call(j)).find(K=>K._videoSSRC===P.ssrc);W&&this.store.firstVideoFrameDecoded(W.uid,{firstReceivedEncodedFrame:Date.now(),frameType:P.type,rtpTimestamp:P.rtpTimestamp,framePayloadType:P.payloadType,frameDataLength:P.length,mimeType:P.mimeType})}}):r==Ge.AUDIO&&await U(g.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:P=>{this.safeEmit(qe.AudioMetadata,P)},onPts:P=>{this.safeEmit(qe.AudioPts,P)}})}const x=this.remoteUserMap.get(t);x?x.set(r,f):this.remoteUserMap.set(t,new Map([[r,f]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(C=>{let{user:U,kind:P}=C;return U.uid===t.uid&&r===P});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(qe.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Xt.Connected)throw new pe($.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var u;let{user:h,mediaType:f}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(f))});const r=[],i=new Map;t.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);if(u){const{track:h,mid:f,transceiver:g,player:v}=u;i.set(c.ssrcId,{track:h,id:f,transceiver:g,player:v})}else r.push(c)});const s=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:f,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:f,rtx:g}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{i.set(c.ssrcId,s[u])});for(const{user:c,mediaType:u,ssrcId:h}of t){const f=i.get(h);if(!f)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:g,id:v,transceiver:_,player:x}=f;if(_&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:P}=nE();u==Ge.VIDEO?await U(_.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(j=>{var W;return(W=c._videoTrack)===null||W===void 0?void 0:W._onSei(j)}),onFirstFrame:j=>{var W;const K=Array.from(si(W=this.remoteUserMap).call(W)).find(J=>J._videoSSRC===j.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==Ge.AUDIO&&await P(_.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(qe.AudioMetadata,j)},onPts:j=>{this.safeEmit(qe.AudioPts,j)}})}if(u===Ge.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new zp(g,c.uid,c._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),_&&c._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new Hp(g,c.uid,c._uintid,this.store,x),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),_&&c._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(c,c._videoTrack)),G("ENABLE_VIDEO_SEI")&&_){const{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:P}=nE();u==Ge.VIDEO?await U(_.receiver,{onSei:j=>{var W;(W=c._videoTrack)===null||W===void 0||W._onSei(j)},onFirstFrame:j=>{var W;const K=Array.from(si(W=this.remoteUserMap).call(W)).find(J=>J._videoSSRC===j.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==Ge.AUDIO&&await P(_.receiver)}const S=this.remoteUserMap.get(c);S?S.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const C=this.pendingRemoteTracks.findIndex(U=>{let{user:P,kind:j}=U;return P.uid===c.uid&&u===j});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(qe.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,i){const s=this.pendingRemoteTracks.filter(h=>{let{user:f,kind:g}=h;return r!==void 0?f.uid===t.uid&&r===g:f.uid===t.uid});if(s.forEach(h=>{const f=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(f,1)}),this.connection&&this.state===Xt.Connected||i||s.forEach(h=>{let{kind:f}=h;var g;if(f===Ge.AUDIO)(g=t._audioTrack)===null||g===void 0||g._destroy(),t._audioTrack=void 0;else if(f===Ge.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Xt.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:f}]=h;return f}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[f,{kind:g}]=h;var v,_;if(g===Ge.VIDEO&&f._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),g===Ge.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),i||((_=f._videoTrack)===null||_===void 0||_._destroy(),f._videoTrack=void 0);else if(g===Ge.AUDIO){var x;this.unbindRemoteTrackEvents(f._audioTrack),!i&&((x=f._audioTrack)===null||x===void 0||x._destroy(),f._audioTrack=void 0)}}),u}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(t,r);if(i.length===0)return;r.forEach(c=>{c._close()});const s=this.remoteDataChannelMap.get(t);return i.forEach(c=>{s&&s.delete(c.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),i.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:u}of t){const h=this.pendingRemoteTracks.filter(f=>{let{user:g,kind:v}=f;return u!==void 0?g.uid===c.uid&&u===v:g.uid===c.uid});h.forEach(f=>{const g=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(g,1)}),r=r.concat(h)}if(!this.connection||this.state!==Xt.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var f;if(h===Ge.AUDIO)(f=u._audioTrack)===null||f===void 0||f._destroy(),u._audioTrack=void 0;else if(h===Ge.VIDEO){var g;(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0}});const i=as(t).call(t,(c,u)=>{let{user:h,mediaType:f}=u;const g=this.filterTobeUnSubscribedTracks(h,f);return c.concat(g)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var f,g;if(h===Ge.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Ge.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0;else if(h===Ge.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),s}isPreSubScribe(t){return!this.connection||this.state!==Xt.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(r))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const s=r===Ge.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(r)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Ce.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Ce.LocalAudioTrack);if((r==null?void 0:r.track)instanceof or){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==Ce.LocalAudioTrack}).filter(s=>{let[c]=s;return!(t&&c===Ce.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Ce.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,i,s,c){if(t){const h=this.localTrackMap.get(Ce.LocalAudioTrack),f=s?this.localTrackMap.get(Ce.LocalVideoLowTrack):this.localTrackMap.get(Ce.LocalVideoTrack);$e.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(Jt.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(g=>g instanceof Vn),f=s?(u=this.localTrackMap.get(Ce.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(g=>g instanceof dn);$e.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(Jt.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,i,s){const c=s===Ge.VIDEO?i._videoSSRC:i._audioSSRC;c&&$e.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===Ge.VIDEO,audio:s===Ge.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Rr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=cv(this.store),this.emit(qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof or){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Xt.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ce.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ce.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof dn||r&&r.track instanceof Vn?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r;const i=Array.from(si(r=this.remoteUserMap).call(r)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ce.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=fu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Xt.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=cv(this.store),this.emit(qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[i,{track:s}]=t;switch(i){case Ce.LocalVideoTrack:Te(r=s._hints).call(r,Jt.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Ce.LocalAudioTrack:s instanceof or?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Ce.LocalVideoLowTrack:}}),this.emit(qe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;Array.from(si(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(qe.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,i]=t;Array.from(si(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(r,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const i of this.pendingRemoteDataChannels){const{user:s,id:c}=i;if((t instanceof ld?t.uid:t)===s.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((t instanceof ld?t.uid:t)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Li(function*(){if(!r.connection||r.state!==Xt.Connected)return;const i=yield Tt(r.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield Tt(r.connection.restartICE(t));const u=yield Tt(s.next());if(u.done)return;const h=u.value,f=yield h;switch(vI(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Ar.UDP_TCP_RELAY:r._pcStatsUploadType=sl.UDP_TCP_RESTART;break;case Ar.TCP_RELAY:r._pcStatsUploadType=sl.TCP_RESTART;break;case Ar.RELAY:r._pcStatsUploadType=sl.RELAY_RESTART;break;default:r._pcStatsUploadType=sl.OLD_RESTART}r._isTryConnecting=!0,s.next(f)}catch(u){var c;(c=s)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Ce.LocalVideoTrack),i=this.localTrackMap.get(Ce.LocalAudioTrack),s=t.videoSend.find(C=>C.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(C=>C.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!c)return 1;const u=Ea(this,qe.NeedSignalRTT),h=s?s.rttMs:void 0,f=c?c.rttMs:void 0,g=h&&f?(h+f)/2:h||f,v=(g&&u?(g+u)/2:g||u)||0,_=100*t.sendPacketLossRate*.7/50+.3*v/1500,x=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,S=r==null?void 0:r.track;if(S&&S._encoderConfig&&S._hints.indexOf(Jt.SCREEN_TRACK)===-1){const C=S._encoderConfig.bitrateMax,U=t.bitrate.actualEncoded;if(C&&U){const P=(1e3*C-U)/(1e3*C);return P6[P<.15?0:P<.3?1:P<.45?2:P<.6?3:4][x]}}return x}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,u=s._videoSSRC,h=t.audioRecv.find(U=>U.ssrc===c),f=t.videoRecv.find(U=>U.ssrc===u);if(!h&&!f)return void(r+=1);const g=Ea(this,qe.NeedSignalRTT),v=t.rtt,_=(v&&g?(v+g)/2:v||g)||0,x=h?h.jitterMs:void 0,S=t.recvPacketLossRate;let C=.7*S*100/50+.3*_/1500;x&&(C=.6*S*100/50+.2*_/1500+.2*x/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new De((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}async replaceTrack(t,r){var i;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Xt.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return t===h});if(!s)return;const c=s[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),s[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,s[1].id)),this.isPlanB){const u=s[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ce.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const u=this.localTrackMap.get(Ce.LocalVideoLowTrack);if(u){const h=t._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new De((f,g)=>{this.handleReplaceTrack(u.track,f,g,!0)})}}}filterTobePublishedTracks(t,r,i){const s=[],c=this.getAllTracks();t=Pp(t=t.filter(g=>c.indexOf(g)===-1));let u,h=!1;const f=this.localTrackMap.get(Ce.LocalAudioTrack);for(const g of t){if(g instanceof dn&&(this.localTrackMap.has(Ce.LocalVideoTrack)||h?new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:Ce.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(g,i);s.push({track:v,type:Ce.LocalVideoLowTrack})}if(g instanceof Vn)if(f){const v=f.track;if(v instanceof or)mI([g]),v.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const _=gI([v,g]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(v,_)}}else u instanceof or?(mI([g]),u.addAudioTrack(g)):u||!g._useAudioElement&&It().webAudioMediaStreamDest&&!g._bypassWebAudio?u=gI(u?[g,u]:[g]):u=g}return u&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),s.push({track:u,type:Ce.LocalAudioTrack})),s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Pp(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Vn){const c=this.localTrackMap.get(Ce.LocalAudioTrack);if(!c)continue;c.track instanceof or?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([Ce.LocalAudioTrack,c]),c.track.close())):r.push([Ce.LocalAudioTrack,c])}if(s instanceof dn){const c=this.localTrackMap.get(Ce.LocalVideoTrack);if(!c)continue;r.push([Ce.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ce.LocalVideoLowTrack);u&&r.push([Ce.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(t){return t=(t=Pp(t)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Pp(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Ce.LocalVideoTrack:i.addListener(He.GET_STATS,this.handleGetLocalVideoStats),i.addListener(He.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(He.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof or?t.trackList.forEach(i=>{i.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(He.GET_STATS,this.handleGetLocalAudioStats),i.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(He.GET_STATS,this.handleGetLocalAudioStats),t.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(He.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Ce.LocalVideoTrack:i.off(He.GET_STATS,this.handleGetLocalVideoStats),i.off(He.GET_RTC_STATS,this.handleGetRTCStats),i.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(He.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof or?t.trackList.forEach(r=>{r.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(He.GET_STATS,this.handleGetLocalAudioStats),r.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(He.GET_STATS,this.handleGetLocalAudioStats),t.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(He.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Hp&&r.addListener(He.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof zp&&r.addListener(He.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(He.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;i.has(Ge.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(Ge.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((i,s)=>{var c;let u,h,{track:f,type:g}=i;switch(g){case Ce.LocalAudioTrack:u=tn.Audio,h={dtx:f instanceof Xg&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ce.LocalVideoTrack:u=Te(c=f._hints).call(c,Jt.SCREEN_TRACK)?tn.Screen:tn.High,h=wc(wc({},K6(f)),{},{codec:this.store.codec,svc_mode:ev()});break;case Ce.LocalVideoLowTrack:u=tn.Low,h=wc(wc({},K6(f)),{},{codec:this.store.codec,svc_mode:ev()})}return{stream_type:u,attributes:h,ssrcs:r[s]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:f}]=r;switch(c){case Ce.LocalVideoTrack:s=Te(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Ce.LocalAudioTrack:s=tn.Audio;break;case Ce.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:h,mid:f}})}assignLocalTracks(t,r){t.forEach((i,s)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(qe.PeerConnectionStateChange,r),r==="connecting"&&t instanceof $a&&!bn()&&G("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},G("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof $a&&W8(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=sl.DISCONNECTED_OR_FAILED,Ea(this,qe.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),s=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));$e.reportApiInvoke(this.store.sessionId,{name:wn.REPUB_AFTER_PC_CONNECTED,options:i.concat(s),tag:ln.TRACER}).onSuccess(),this.republish()}if(G("NEW_ICE_RESTART")&&t instanceof $a&&!bn()&&!this._forceTurn&&!this.store.useDcSignal){if(Te(B6).call(B6,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{vI(t)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Ea(this,qe.QueryClientConnectionState)==="CONNECTED"&&this.emit(qe.RequestRestartICE,c))},s=()=>{vI(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(qe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{$8(t,i,s)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&G("ICE_RESTART")&&Ea(this,qe.QueryClientConnectionState)==="CONNECTED"&&this.emit(qe.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(qe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(qe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),$e.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:ln.TRACER}).onSuccess(),this.emit(qe.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(ls.FIRST_FRAME_DECODED),$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,Tn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);s&&$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,Tn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{var c;const u=Array.from(si(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===r);u&&this.store.firstVideoFrameDecoded(u.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,i,s)},t.onFirstVideoRender=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(s),this.emit(qe.FirstVideoPreRender,s.uid,r))},t.onFirstVideoReceived=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstReceived:Date.now()}),$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,Tn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstVideoBufferReady=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&this.emit(qe.FirstVideoBufferReady,s.uid,r)},t.onSelectedLocalCandidateChanged=(r,i)=>{const s=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(qe.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(od(i))," -> ").concat(JSON.stringify(od(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(od(i))," -> ").concat(JSON.stringify(od(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return wc(wc({},r),i)},t.onICECandidateError=r=>{this._iceError=r}}fallbackConnection(){R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===Xt.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=cv(this.store),this.emit(qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(t){t instanceof $a&&function(r){of.delete(r.id),W8(r)}(t),t.close(),this.emit(qe.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const i=this.localTrackMap.get(Ce.LocalAudioTrack);if(t instanceof Vn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive||r.push([Ce.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s&&(r.push(s),s[0]===Ce.LocalVideoTrack)){const c=this.localTrackMap.get(Ce.LocalVideoLowTrack);c&&r.push([Ce.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],i=this.localTrackMap.get(Ce.LocalAudioTrack);if(t instanceof Vn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive&&r.push([Ce.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s)if(s[0]===Ce.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get(Ce.LocalVideoLowTrack);c&&r.push([Ce.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:f}]=r;switch(c){case Ce.LocalAudioTrack:s=tn.Audio;break;case Ce.LocalVideoTrack:s=Te(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Ce.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:h,mid:f}})}createUnmuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:f}]=r;switch(c){case Ce.LocalAudioTrack:s=tn.Audio;break;case Ce.LocalVideoTrack:s=Te(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Ce.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const c=s.get(r);if(!c)return i;i.push([t,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,h]=c;i.push([t,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(t,r){const i=[];return r.forEach(s=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(t){const r=[];return t.forEach(i=>{let[s,{kind:c,id:u}]=i;switch(c){case Ge.VIDEO:return void(s._videoSSRC&&r.push({stream_type:Ge.VIDEO,ssrcId:s._videoSSRC}));case Ge.AUDIO:return void(s._audioSSRC&&r.push({stream_type:Ge.AUDIO,ssrcId:s._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(i=>{let[s,{kind:c}]=i;if(r.has(s)){let u=r.get(s);c===Ge.VIDEO?u|=br.Video:u|=br.Audio,r.set(s,u)}else c===Ge.VIDEO?r.set(s,br.Video):r.set(s,br.Audio)}),{users:Array.from(r.entries()).map(i=>{let[s,c]=i;return{stream_id:s.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[i,{kind:s}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ce.LocalVideoTrack),i=this.localTrackMap.get(Ce.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new De((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),i&&t.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new De((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof $a&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof $a)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof $a&&this.connection.isPreRender}mapPubResToRemoteConfig(t,r,i){return t.map((s,c)=>{var u;let{stream_type:h}=s;const f=(u=r.find(g=>{let{stream_type:v}=g;return h===v}))===null||u===void 0?void 0:u.attributes;if(f&&G("DISABLE_SCREEN_SHARE_REMB")){const g=i[c]._hints;(Te(g).call(g,Jt.SCREEN_TRACK)||Te(g).call(g,Jt.SCREEN_LOW_TRACK))&&(f.remb=!1,R.debug("disable remb for screen share, hints:",g))}return f})}async tryToUnmuteAudio(t){for(let i=0;i<t.length;i++)if(t[i]instanceof Vn){var r;const s=this.filterTobeUnmutedTracks(t[i]);if(s.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(s.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(s);return void await fn(this,qe.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(qe.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(qe.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yr(yb(this.dtlsFailedCount,Yn)),this.emit(qe.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await er(this,qe.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(qe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ce.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof dn)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof dn).length>1)throw new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Vn).length>1&&(t.some(r=>r instanceof Vn&&r._bypassWebAudio)||!It().webAudioMediaStreamDest))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof dn&&this.pendingLocalTracks.some(i=>i instanceof dn))throw new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Vn&&this.pendingLocalTracks.some(i=>i instanceof Vn)&&(!It().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Vn&&i._bypassWebAudio)))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var i;const s=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding,c=wc(wc({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=s?t._mediaStreamTrack.clone():_I(t,c);const h=Zt(8,"track-low-"),f=new dn(u,wc(wc({},s&&{scaleResolutionDownBy:qA(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return f.on(Du.TRANSCEIVER_UPDATED,g=>{t._updateRtpTransceiver(g,Fp.LOW_STREAM)}),f._hints.push(Jt.LOW_STREAM),Te(i=t._hints).call(i,Jt.SCREEN_TRACK)&&f._hints.push(Jt.SCREEN_LOW_TRACK),t.on("sei-to-send",g=>{f.emit("sei-to-send",g)}),t.addListener(He.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof $a){var c,u,h,f;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:_,peerConnectionState:x}=this.connection,{local:S,remote:C}=await this.connection.getSelectedCandidatePair();$e.pcStats(this.store.sessionId,{startTime:g,eventElapse:t-g||0,iceconnectionsate:v,dtlsstate:_,connectionstate:x,intSucc:r?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(c=S==null?void 0:S.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=S.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(h=C.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(f=C.candidateType)!==null&&f!==void 0?f:"",selectedRemoteCandidateAddress:"".concat(C.address,":").concat(C.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const r=this.store.keyMetrics,i=r.firstVideoFrameDecoded.find(_=>_.userId===t.uid);if(!i)return;const{isInternalUpload:s,isExternalUpload:c}=i;if(s&&c)return;const{subscribeEnd:u,firstPreRender:h,peerPublishDuration:f,peerPubStatusMs:g}=i;let{firstRender:v=0}=i;if(u&&(v||h)&&f&&g){i.isInternalUpload=!0;const{playEnd:_}=i;_&&(i.isExternalUpload=!0);const{firstPreRender:x=0}=i;v=x||v;const S=t.videoTrack,C={peer:t._uintid,width:(S==null?void 0:S._videoWidth)||0,height:(S==null?void 0:S._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:f,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:i.userJoinNotify||0,videoAddNotify:i.videoAddNotify||0,subscribeStart:i.subscribeStart||0,subscribeEnd:i.subscribeEnd||0,firstReceived:i.firstReceived||0,firstDecoded:i.firstDecoded||0,firstPreRender:x||0,firstRender:_?Math.max(v,_):Math.max(v,u),playStart:i.playStart||0,playEnd:i.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:pV(this.store),firstReceivedEncodedFrame:i.firstReceivedEncodedFrame||0,frameType:i.frameType||"",rtpTimestamp:i.rtpTimestamp||0,framePayloadType:i.framePayloadType||0,frameDataLength:i.frameDataLength||0,mimeType:i.mimeType||""};$e.firstXLAPeerFirstVideoFrame(this.store.sessionId,C)}}reportVideoFirstFrameDecoded(t,r,i,s){var c;const u=Array.from(si(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(g=>g.userId===u.uid&&g.type==="video");$e.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,Tn.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:s?1:0,firstFrame:(f==null?void 0:f.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const c=s.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:i}]=t;r===Ce.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Fp.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ke(Pt.prototype,"startP2PConnection",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"startP2PConnection"),Pt.prototype),ke(Pt.prototype,"connect",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"connect"),Pt.prototype),ke(Pt.prototype,"updateRemoteRTPCapabilities",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"updateRemoteRTPCapabilities"),Pt.prototype),ke(Pt.prototype,"publishDataChannel",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"publishDataChannel"),Pt.prototype),ke(Pt.prototype,"unpublish",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublish"),Pt.prototype),ke(Pt.prototype,"unpublishDataChannel",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublishDataChannel"),Pt.prototype),ke(Pt.prototype,"unpublishLowStream",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublishLowStream"),Pt.prototype),ke(Pt.prototype,"subscribeDataChannel",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"subscribeDataChannel"),Pt.prototype),ke(Pt.prototype,"subscribe",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"subscribe"),Pt.prototype),ke(Pt.prototype,"massSubscribe",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"massSubscribe"),Pt.prototype),ke(Pt.prototype,"unsubscribe",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unsubscribe"),Pt.prototype),ke(Pt.prototype,"unsubscribeDataChannel",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unsubscribeDataChannel"),Pt.prototype),ke(Pt.prototype,"massUnsubscribe",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"massUnsubscribe"),Pt.prototype),ke(Pt.prototype,"muteRemote",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"muteRemote"),Pt.prototype),ke(Pt.prototype,"unmuteRemote",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteRemote"),Pt.prototype),ke(Pt.prototype,"hasRemoteMediaWithLock",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"hasRemoteMediaWithLock"),Pt.prototype),ke(Pt.prototype,"disconnectForReconnect",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"disconnectForReconnect"),Pt.prototype),ke(Pt.prototype,"updateBitrateLimit",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"updateBitrateLimit"),Pt.prototype),ke(Pt.prototype,"remoteMediaSsrcChanged",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"remoteMediaSsrcChanged"),Pt.prototype),Pt);function pi(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},i}function K8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Y8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?K8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):K8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const Dve=Date.now(),kve=20,xI=new Map,fE=new Map;async function q8(t){const r=xI.get(t),i=Array.isArray(r)&&r[r.length-1],s=fE.get(t);if(!i)return void(s.isSyncing=!1);const c={uid:i.uid,payload:i.payload};s.firstRecvTs===0&&(s.firstRecvTs=i.recvTs,s.firstSendTs=i.sendTs);const u=i.sendTs-s.firstSendTs,h=u-(Date.now()-s.firstRecvTs);h>0&&(s.firstRecvTs=Date.now()-u);let f=i.mediaDelay+h;f<=0?(r.pop(),X8(i.context,c),f=0):f=Math.min(f,kve),setTimeout(()=>r.length&&q8(t),f)}function X8(t,r){t.safeEmit(Rt.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function jve(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return X8(i,{uid:t.uid,payload:t.payload});const s="".concat(i.id,"-").concat(t.uid),c=xI.get(s)||[],u=c.findIndex(v=>t.sendTs>=v.sendTs),h=Y8(Y8({},t),{},{context:i,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),xI.set(s,c);let f=!1;var g;fE.has(s)?f=!((g=fE.get(s))===null||g===void 0||!g.isSyncing):fE.set(s,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||q8(s)}const Lve=Bt().name;function J8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Q8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?J8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):J8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const cf="websdk_ng_cache_parameter",Mve=G("MAX_PRELOAD_ASYNC_LENGTH"),Uve=1e4,zu=new Map,Ku=[];let SI=null,wI=0,TI=0;const mE=new Map,Z8=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),Fve=function(t,r){const i=[];let s=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&s<r?c():s--};return async function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];return new De(async(g,v)=>{i.push(async()=>{try{const _=await t(...h);g(_)}catch(_){v(_)}}),s<r&&(s++,c())})}}(NI,Mve),CI=Mi.CancelToken.source();class Vve{constructor(){L(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const r=this._audioContext.sampleRate,i=10*r,s=this._audioContext.createBuffer(2,i,r),c=this._audioContext.createBufferSource();c.buffer=s;const u=this._audioContext.createMediaStreamDestination();return c.connect(u),c.start(),u.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function NI(t,r,i,s,c,u,h){try{if(!G("ENABLE_PRELOAD"))return;if(!It().supportWebCrypto)return void td(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new pe($.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Mr(i,"token",1,2047),Mr(t,"appid",1,2047),$b(r),s&&Hb(s);const f=Au();R.debug("preload channel ".concat(r,", uid is ").concat(s));const g={appId:t,cname:r,token:i||t,uid:typeof s!="string"?s:null,sid:f,proxyServer:c,role:h};let v,_;typeof s=="string"?(g.stringUid=s,[_,v]=await De.all([Eve(s,{sid:f,appId:t},CI.token),S8(Q8(Q8({},g),{},{token:i||t,uid:0}),CI.token)]),g.uid=_.uid,v.gatewayInfo.uid=g.uid,v.gatewayInfo.res.uid=g.uid):(u&&(g.stringUid=u),v=await S8(g,CI.token));const x={sid:f,appId:t,cname:r,token:i||t,uid:g.stringUid||s,intUid:g.uid||v.gatewayInfo.uid,stringUid:g.stringUid,ts:Date.now(),sua:_,ap:v};await AI(x),wI++}catch(f){throw TI++,function(g){SI||(SI=window.setTimeout(()=>{let _="";mE.forEach((x,S)=>{_+="".concat(S,": ").concat(x," ;")}),$e.reportApiInvoke(null,{name:wn.PRELOAD,options:{success:wI,failed:TI,err:_}}).onError(g),wI=0,TI=0,mE.clear(),SI=null},Uve));const v=mE.get(g.code)||0;mE.set(g.code,v+1)}(f),f}}async function RI(t){try{if(G("AP_REQUEST_DETAIL")||G("ENABLE_ROLE_SELECT_EDGE"))return;const r=eG(t);if(!r||t.cloudProxyServer!=="disabled")return;const i=await async function(s,c){try{const u=await window.crypto.subtle.importKey("raw",BF(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:Z8},u,Ru(s));return JSON.parse(window.atob(nd(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!i||!function(s,c){return s.cname===c.cname&&s.appId===c.appId&&s.token===c.token?c.stringUid?s.stringUid===c.stringUid:typeof c.uid=="number"?s.uid===c.uid:s.uid==c.uid:!1}(i,t))return;if(i&&Date.now()-i.ts<G("AP_CACHE_LIFETIME"))return i}catch(r){R.warn("Error get preloadInfo",r.message)}}function eG(t){let r;try{if(r=rG(cf),!r)return;const i=JSON.parse(r),s=iG(t),c=function(h,f){for(let g=h.length-1;g>=0;g--)if(f(h[g]))return g;return-1}(i,h=>s in h);if(c===-1)return;const u=i.splice(c,1)[0];return gE(cf,JSON.stringify(i)),u[s]}catch(i){R.warn("Error delete preload info: ".concat(r),i.message),gE(cf,"")}}async function AI(t){let r;try{t.uid&&eG({appId:t.appId,cname:t.cname,token:t.token,uid:t.uid,stringUid:t.stringUid});const i=iG(t),s=await async function(u,h){try{const f=await window.crypto.subtle.importKey("raw",BF(h),"AES-GCM",!1,["encrypt"]),g=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:Z8},f,Ru(window.btoa(JSON.stringify(u))));return nd(new Uint8Array(g))}catch{return}}(t,t.token||t.appId);if(!s)return;r=rG(cf);const c=r?JSON.parse(r):[];c.push({[i]:s}),c.length>G("AP_CACHE_NUM")&&c.shift(),gE(cf,JSON.stringify(c))}catch(i){R.warn("Error caching server parameters:",i.message),gE(cf,"")}}function II(t){if(t){let r=zu.get(t);r&&(window.clearTimeout(r),r=null,zu.delete(t)),Te(Ku).call(Ku,t)||t.cloudProxyServer!=="disabled"||Ku.push(t)}if(zu.size<G("AP_CACHE_NUM")&&Ku.length>0){const r=Ku.shift();zu.set(r,window.setTimeout(async()=>{const{appId:i,cname:s,token:c,stringUid:u,uid:h,proxyServer:f,role:g}=r;try{await Fve(i,s,c,h,f,u,g),zu.has(r)&&II(r)}catch(v){R.warn("update preload failed",v.message),tG(r)}},G("AP_UPDATE_INTERVAL")))}}function tG(t){const r=Ku.indexOf(t);r!==-1&&Ku.splice(r,1);let i=zu.get(t);i&&(window.clearTimeout(i),i=null,zu.delete(t),II())}function nG(t,r){const i=t.sua,s=t.ap;r&&i&&$e.reqUserAccount(t.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:t.intUid,errorCode:null,extend:i.req}),$e.reportResourceTiming(t.ap.url,t.sid),$e.joinWebProxyAP(t.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[qn.CHOOSE_SERVER,qn.CLOUD_PROXY_FALLBACK].toString()}),$e.joinChooseServer(t.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function rG(t){return window.atob(window.localStorage.getItem(t)||"")}function gE(t,r){window.localStorage.setItem(t,window.btoa(r))}function iG(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),YF(r)}function Bve(t){let r=function(){const i=$ve.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,s){let c=i.appId;c!==void 0&&(Xn(s,10),ud(s,c));let u=i.cid;u!==void 0&&(Xn(s,16),Xn(s,u));let h=i.cname;h!==void 0&&(Xn(s,26),ud(s,h));let f=i.deviceId;f!==void 0&&(Xn(s,34),ud(s,f));let g=i.elapse;g!==void 0&&(Xn(s,40),hd(s,g));let v=i.fileSize;v!==void 0&&(Xn(s,48),hd(s,lf(v)));let _=i.height;_!==void 0&&(Xn(s,56),hd(s,lf(_)));let x=i.jpg;x!==void 0&&(Xn(s,66),Xn(s,x.length),sG(s,x));let S=i.networkType;S!==void 0&&(Xn(s,72),hd(s,lf(S)));let C=i.osType;C!==void 0&&(Xn(s,80),hd(s,lf(C)));let U=i.requestId;U!==void 0&&(Xn(s,90),ud(s,U));let P=i.sdkVersion;P!==void 0&&(Xn(s,98),ud(s,P));let j=i.sequence;j!==void 0&&(Xn(s,104),hd(s,lf(j)));let W=i.sid;W!==void 0&&(Xn(s,114),ud(s,W));let K=i.timestamp;K!==void 0&&(Xn(s,120),hd(s,K));let J=i.uid;J!==void 0&&(Xn(s,128),Xn(s,J));let re=i.vid;re!==void 0&&(Xn(s,136),Xn(s,re));let ie=i.width;ie!==void 0&&(Xn(s,144),hd(s,lf(ie)));let Z=i.service;Z!==void 0&&(Xn(s,152),Xn(s,Z));let se=i.callbackData;se!==void 0&&(Xn(s,162),Xn(s,se.length),sG(s,se));let ge=i.ticket;ge!==void 0&&(Xn(s,170),ud(s,ge));let Ee=i.vendorConfigs;Ee!==void 0&&(Xn(s,178),ud(s,Ee))}(t,r),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(r)}function Gve(t){return function(i){let s={};e:for(;!Hve(i);){let c=dv(i);switch(c>>>3){case 0:break e;case 1:s.code=dv(i);break;case 2:s.msg=oG(i,dv(i));break;case 3:s.requestId=oG(i,dv(i));break;case 4:s.timestamp=zve(i,!1);break;default:Wve(i,7&c)}}return s}({bytes:r=t,offset:0,limit:r.length});var r}function Wve(t,r){switch(r){case 0:for(;128&Ks(t););break;case 2:OI(t,dv(t));break;case 5:OI(t,4);break;case 1:OI(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function lf(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let $ve=[];function OI(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function Hve(t){return t.offset>=t.limit}function vE(t,r){let i=t.bytes,s=t.offset,c=t.limit,u=s+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),s}function aG(t,r){let i=t.offset;if(i+r>t.limit)throw new Error("Read past limit");return t.offset+=r,i}function sG(t,r){let i=vE(t,r.length);t.bytes.set(r,i)}function oG(t,r){let i=aG(t,r),s=String.fromCharCode,c=t.bytes,u="",h="";for(let f=0;f<r;f++){let g,v,_,x,S=c[f+i];128&S?(224&S)==192?f+1>=r?h+=u:(g=c[f+i+1],(192&g)!=128?h+=u:(x=(31&S)<<6|63&g,x<128?h+=u:(h+=s(x),f++))):(240&S)==224?f+2>=r?h+=u:(g=c[f+i+1],v=c[f+i+2],(49344&(g|v<<8))!=32896?h+=u:(x=(15&S)<<12|(63&g)<<6|63&v,x<2048||x>=55296&&x<=57343?h+=u:(h+=s(x),f+=2))):(248&S)==240?f+3>=r?h+=u:(g=c[f+i+1],v=c[f+i+2],_=c[f+i+3],(12632256&(g|v<<8|_<<16))!=8421504?h+=u:(x=(7&S)<<18|(63&g)<<12|(63&v)<<6|63&_,x<65536||x>1114111?h+=u:(x-=65536,h+=s(55296+(x>>10),56320+(1023&x)),f+=3))):h+=u:h+=s(S)}return h}function ud(t,r){let i=r.length,s=0;for(let h=0;h<i;h++){let f=r.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+r.charCodeAt(++h)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}Xn(t,s);let c=vE(t,s),u=t.bytes;for(let h=0;h<i;h++){let f=r.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+r.charCodeAt(++h)-56613888),f<128?u[c++]=f:(f<2048?u[c++]=f>>6&31|192:(f<65536?u[c++]=f>>12&15|224:(u[c++]=f>>18&7|240,u[c++]=f>>12&63|128),u[c++]=f>>6&63|128),u[c++]=63&f|128)}}function Ks(t){return t.bytes[aG(t,1)]}function cG(t,r){let i=vE(t,1);t.bytes[i]=r}function dv(t){let r,i=0,s=0;do r=Ks(t),i<32&&(s|=(127&r)<<i),i+=7;while(128&r);return s}function Xn(t,r){for(r>>>=0;r>=128;)cG(t,127&r|128),r>>>=7;cG(t,r)}function zve(t,r){let i,s=0,c=0,u=0;return i=Ks(t),s=127&i,128&i&&(i=Ks(t),s|=(127&i)<<7,128&i&&(i=Ks(t),s|=(127&i)<<14,128&i&&(i=Ks(t),s|=(127&i)<<21,128&i&&(i=Ks(t),c=127&i,128&i&&(i=Ks(t),c|=(127&i)<<7,128&i&&(i=Ks(t),c|=(127&i)<<14,128&i&&(i=Ks(t),c|=(127&i)<<21,128&i&&(i=Ks(t),u=127&i,128&i&&(i=Ks(t),u|=(127&i)<<7))))))))),{low:s|c<<28,high:c>>>4|u<<24,unsigned:r}}function hd(t,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=vE(t,u),f=t.bytes;switch(u){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=u!==9?128|c:127&c;case 8:f[h+7]=u!==8?s>>>21|128:s>>>21&127;case 7:f[h+6]=u!==7?s>>>14|128:s>>>14&127;case 6:f[h+5]=u!==6?s>>>7|128:s>>>7&127;case 5:f[h+4]=u!==5?128|s:127&s;case 4:f[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:f[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:f[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:f[h]=u!==1?128|i:127&i}}const lG={},dG={},yE=4294967296,Kve=yE*yE,uG=Kve/2;pG(0,!0);const hG=pG(0),Yve=uv(0,-2147483648,!1),qve=uv(-1,2147483647,!1);function pG(t,r){let i,s,c;return r?(c=0<=(t>>>=0)&&t<256)&&(s=dG[t],s)?s:(i=uv(t,0,!0),c&&(dG[t]=i),i):(c=-128<=(t|=0)&&t<128)&&(s=lG[t],s)?s:(i=uv(t,t<0?-1:0,!1),c&&(lG[t]=i),i)}function uv(t,r,i){return{low:0|t,high:0|r,unsigned:!!i}}function fG(t,r){if(isNaN(t))return hG;{if(t<=-uG)return Yve;if(t+1>=uG)return qve}return t<0?hG:uv(t%yE|0,t/yE|0,r)}function mG(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class PI extends An{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Po.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),L(this,"name","AgoraRTCImageModeration"),L(this,"_connectionState",hs.CONNECTING),L(this,"_sequence",0),L(this,"_moderationStartTime",void 0),L(this,"_workerConnection",void 0),L(this,"_workerMessageLengthLimit",void 0),L(this,"_qualityRatio",void 0),L(this,"_connectInfo",void 0),L(this,"_cancelTokenSource",Mi.CancelToken.source()),L(this,"_retryConfig",void 0),L(this,"_moderationInterval",void 0),L(this,"_moderationTimer",null),L(this,"_moderationMode",1),L(this,"_quality",1),L(this,"_qualityTimer",null),L(this,"_ticket",void 0),L(this,"_moderationIntervalMinimum",void 0),L(this,"_uploadFailedNum",0),L(this,"_uploadNum",0),L(this,"_uploadTimer",null),L(this,"_extraInfo",void 0),L(this,"_vendor",""),L(this,"_encoder",new TextEncoder),L(this,"_moderationId",void 0),L(this,"inspectImage",()=>{if(this.connectionState!==hs.CONNECTED)throw new ce($.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===hs.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Zt(5,"image-moderation-"),this._workerMessageLengthLimit=G("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=G("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=G("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Qg("worker-"+this._moderationId,Yn),this.on(Po.STATE_CHANGE,(s,c)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Xp[s]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(Po.STATE_CHANGE,Xp.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=i,new De((c,u)=>{this.on(Po.CONNECTION_STATE_CHANGE,(h,f)=>{h===hs.CONNECTED&&c()}),this.requestAP(r,s,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===hs.CONNECTED&&this.inspectImage()}async requestAP(r,i,s){const c=G("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),u=await function(g,v,_,x){let{appId:S,areaCode:C,cname:U,sid:P,token:j,uid:W}=v;tf++;const K="moderation_plugin",J={service_name:K,json_body:JSON.stringify({appId:S,areaCode:C,cname:U,command:"allocateEdge",requestId:tf,seq:tf,sid:P,appToken:j,ts:Date.now(),uid:W+""})};let re,ie,Z=g[0];return Ro(async()=>{re=Date.now();const se=await ko(Z,{data:J,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ie=Date.now()-re,se.code!==0){const ot=new ce($.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+se.code,{retry:!0,responseTime:ie});throw R.error(ot.toString()),ot}const ge=JSON.parse(se.json_body);if(ge.code!==200){const ot=new ce($.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ge.code,", reason: ").concat(ge.reason),{code:ge.code,responseTime:ie});throw R.error(ot.toString()),ot}if(!ge.servers||!Array.isArray(ge.servers)||ge.servers.length===0){const ot=new ce($.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ge.code,responseTime:ie});throw R.error(ot.toString()),ot}if(!ge.servers.some(ot=>!!ot.wss)){const ot=new ce($.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ge.code,responseTime:ie});throw R.error(ot.toString()),ot}const Ee=G("IMAGE_MODERATION_WORKER_WSS");if(Ee)return{addressList:[Ee],workerToken:ge.workerToken,vid:ge.vid,responseTime:ie};const Fe=G("IMAGE_MODERATION_WORKER_HOST");return{addressList:ge.servers.map(ot=>{let{address:St,wss:yt}=ot;if(St&&yt)return"wss://".concat(St.replace(/\./g,"-"),".").concat(Fe,":").concat(yt,"/moderation")}).filter(ot=>!!ot),workerToken:ge.workerToken,vid:ge.vid,ticket:ge.appTicket,responseTime:ie}},(se,ge)=>($e.apworkerEvent(P,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(se.addressList),firstSuccess:ge===0,responseTime:ie,serverIp:g[ge%g.length]}),!1),(se,ge)=>($e.apworkerEvent(P,{success:!1,sc:se.data&&se.data.code||200,serviceName:K,responseTime:ie,serverIp:g[ge%g.length]}),!!(se.code!==$.OPERATION_ABORTED&&se.code!==$.UNEXPECTED_RESPONSE||se.data&&se.data.retry)&&(Z=g[(ge+1)%g.length],!0)),x)}(c,r,i,s);this.emit(Po.STATE_CHANGE,Xp.AP_CONNECTED);const{addressList:h,ticket:f}=u;return this._ticket=f,h}async connectWorker(r){this.emit(Po.STATE_CHANGE,Xp.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(_t.CONNECTED,async()=>{this.emit(Po.STATE_CHANGE,Xp.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=hs.CONNECTED}),this._workerConnection.on(_t.CLOSED,()=>{this.connectionState=hs.CLOSED}),this._workerConnection.on(_t.FAILED,()=>{this.connectionState=hs.CLOSED}),this._workerConnection.on(_t.RECONNECTING,()=>{this.connectionState=this.connectionState===hs.CONNECTED?hs.RECONNECTING:hs.CONNECTING}),this._workerConnection.on(_t.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=Gve(new Uint8Array(r.data));G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{$e.reportApiInvoke(this._connectInfo.sid||null,{name:wn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:ln.TRACER}).onError(new ce($.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},G("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(_t.WILL_RECONNECT,(r,i,s)=>{r==="recover"&&s(r),s("tryNext")}),this._workerConnection.on(_t.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Ea(this,Po.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(r,i);this._workerConnection.sendMessage(s,!0,!0)}else G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:s,cname:c,cid:u,vid:h,sid:f,uid:g}=i;const v=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),x=await FV(_,s,c),S=this._sequence+"-"+u+"-"+g+"-"+v+"-"+Zt(12,""),C={appId:s,cid:u,cname:c,deviceId:"",elapse:PI.intToLong(Number(v-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:x,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.2",sequence:this._sequence,sid:f,timestamp:fG(v),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete C.callbackData;const U=Bve(C);if(U.byteLength<this._workerMessageLengthLimit){if(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const P=function(j){for(var W=1;W<arguments.length;W++){var K=arguments[W]!=null?arguments[W]:{};W%2?mG(Object(K),!0).forEach(function(J){L(j,J,K[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(K)):mG(Object(K)).forEach(function(J){Object.defineProperty(j,J,Object.getOwnPropertyDescriptor(K,J))})}return j}({},C);delete P.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(P))}return U}{const P=this.quality*this._qualityRatio;return this.quality=P,await this.generateRequestData(r,{appId:s,cname:c,cid:u,vid:h,sid:f,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=hs.CLOSED,this.emit(Po.STATE_CHANGE,Xp.CLOSED)}}function gG(t){if(cn(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new ce($.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new ce($.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Xve={name:"ImageModeration",create:function(t){let{config:r}=t;return gG(r),new PI(r)}};var vG,yG,_G,bG,EG,xG,SG,wG,TG,CG,NG,RG,AG,IG,OG,PG,DG,kG,jG,LG,MG,UG,FG,VG,BG,GG,WG,$G,HG,zG,KG,YG,qG,XG,JG,QG,ZG,eW,tW,nW,rW,iW,Ve;function aW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ys(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?aW(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):aW(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}Rr.setLogger(R);let Jve=(vG=at(),yG=at({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Gp))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),_G=at({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Bp.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),bG=at({argsMap:(t,r,i,s)=>[typeof r=="object"?r.uid:r,i,s]}),EG=at({argsMap:(t,r,i)=>[r,i]}),xG=at({argsMap:(t,r)=>r.map(i=>{let{user:s,mediaType:c}=i;return[s==null?void 0:s.uid,c]})}),SG=at({argsMap:(t,r,i,s)=>[typeof r=="object"?r.uid:r,i,s]}),wG=at({argsMap:(t,r)=>r.map(i=>{let{user:s,mediaType:c}=i;return{uid:s==null?void 0:s.uid,mediaType:c}})}),TG=at(),CG=at(),NG=at(),RG=at(),AG=at(),IG=at(),OG=at(),PG=at(),DG=at(),kG=at(),jG=at(),LG=at(),MG=at(),UG=at(),FG=at(),VG=at(),BG=at({argsMap:(t,r)=>[r]}),GG=at(),WG=at(),$G=at(),HG=at(),zG=at(),KG=at(),YG=at(),qG=at(),XG=at({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),JG=at(),QG=at(),ZG=at(),eW=at(),tW=at(),nW=at(),rW=at({reportResult:!0}),iW=at(),Ve=class extends An{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let i;if(super(),L(this,"store",void 0),L(this,"_uid",void 0),L(this,"_channelName",void 0),L(this,"_uintUid",void 0),L(this,"_users",[]),L(this,"_config",void 0),L(this,"_clientId",void 0),L(this,"_appId",void 0),L(this,"_sessionId",null),L(this,"_key",void 0),L(this,"_rtmConfig",{}),L(this,"_joinInfo",void 0),L(this,"_gateway",void 0),L(this,"_statsCollector",void 0),L(this,"_configDistribute",void 0),L(this,"_leaveMutex",void 0),L(this,"_publishMutex",void 0),L(this,"_renewTokenMutex",void 0),L(this,"_subscribeMutex",void 0),L(this,"_encryptionMode","none"),L(this,"_encryptionSecret",null),L(this,"_encryptionSalt",null),L(this,"_encryptDataStream",!1),L(this,"_encryptDataStreamKey",null),L(this,"_encryptDataStreamIv",null),L(this,"_proxyServer",void 0),L(this,"_turnServer",{servers:[],mode:"auto"}),L(this,"_cloudProxyServerMode","disabled"),L(this,"_isDualStreamEnabled",!1),L(this,"_defaultStreamFallbackType",void 0),L(this,"_lowStreamParameter",void 0),L(this,"_streamFallbackTypeCacheMap",new Map),L(this,"_remoteStreamTypeCacheMap",new Map),L(this,"_axiosCancelSource",Mi.CancelToken.source()),L(this,"_audioVolumeIndicationInterval",void 0),L(this,"_networkQualityInterval",void 0),L(this,"_userOfflineTimeout",void 0),L(this,"_streamRemovedTimeout",void 0),L(this,"_rteDetailInterval",void 0),L(this,"_liveTranscodeStreamingClient",void 0),L(this,"_liveRawStreamingClient",void 0),L(this,"_channelMediaRelayClient",void 0),L(this,"_networkQualitySensitivity","normal"),L(this,"_p2pChannel",void 0),L(this,"_useLocalAccessPoint",!1),L(this,"_setLocalAPVersion",void 0),L(this,"_joinAndNotLeaveYet",!1),L(this,"_numberOfJoinCount",0),L(this,"_joinResponse",null),L(this,"_remoteDefaultVideoStreamType",void 0),L(this,"_inspect",void 0),L(this,"_moderation",void 0),L(this,"_license",void 0),L(this,"_pendingPublishedUsers",[]),L(this,"ntpAlignErrorCount",0),L(this,"remoteInboundOffset",0),L(this,"_peerConnectionState",void 0),L(this,"_pendingRtpCapabilityChange",void 0),L(this,"_fallbackServerInfo",void 0),L(this,"_dualStreamMode",void 0),L(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),L(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),L(this,"_handleUserOnline",c=>{if(G("BLOCK_LOCAL_CLIENT")&&Fu(c.uid,this.channelName))return void R.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(Rt.USER_JOINED,u));else{const h=new ld(c.uid,c.uint_id||c.uid);this._users.push(h),R.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(Rt.USER_JOINED,h)}}),L(this,"_handleUserOffline",c=>{if(G("BLOCK_LOCAL_CLIENT")&&Fu(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:gb(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),R.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Rt.USER_LEAVED,u,c.reason))}),L(this,"_handleAddAudioOrVideoStream",(c,u,h,f,g,v,_,x)=>{if(G("BLOCK_LOCAL_CLIENT")&&Fu(u,this.channelName))return;const S=this._users.find(P=>P.uid===u);if(!S)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(S.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(S.uid,{videoAddNotify:Date.now()});const C=c==="audio"?S.hasAudio:S.hasVideo;S._uintid||(S._uintid=v||u),c==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,c==="audio"?(S._audio_added_=!0,h!==void 0&&(S._audioSSRC=h),f!==void 0&&(S._cname=f),_&&(S._audioOrtc=_)):(S._video_added_=!0,h!==void 0&&(S._videoSSRC=h),f!==void 0&&(S._cname=f),x!==void 0&&(S._rtxSsrcId=x),_&&(S._videoOrtc=_)),(c==="audio"?S.hasAudio:S.hasVideo)&&!C&&(R.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(c)),this.safeEmit(Rt.USER_PUBLISHED,S,c)),c==="video"?$e.onGatewayStream(this._sessionId,sr.ON_ADD_VIDEO_STREAM,Tn.ON_ADD_VIDEO_STREAM,{peer:v||u,ssrc:S._videoSSRC}):$e.onGatewayStream(this._sessionId,sr.ON_ADD_AUDIO_STREAM,Tn.ON_ADD_AUDIO_STREAM,{peer:v||u,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,c,h).then(P=>{if(P&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Hu))return this._p2pChannel.unsubscribe(S,c,!0).then(()=>this._subscribe(S,c,!0).catch(j=>{R.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,c)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,c,!0).catch(P=>{R.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}));const U=this._getEncodingName(g);c==="video"&&(U==="unknown"?this.safeEmit(Rt.AV1_DECODABLE_RESULT,!1):Nr()||ai()||(U==null?void 0:U.toLocaleLowerCase())!==Ou.av1||bve().then(P=>{G("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Rt.AV1_DECODABLE_RESULT,P),P||this._gateway.downgradeCodec(U)}))}),L(this,"_handleRemoveStream",c=>{if(G("BLOCK_LOCAL_CLIENT")&&Fu(c.uid,this.channelName))return;const u=this._users.find(f=>f.uid===c.uid);if(!u)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Rt.USER_UNPUBLISHED,u,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Rt.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Rt.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Rt.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Hu&&this._p2pChannel.unsubscribe(u).then(f=>{if(f)return this._gateway.unsubscribe(f,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),$e.onGatewayStream(this._sessionId,sr.ON_REMOVE_STREAM,Tn.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),L(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(G("BLOCK_LOCAL_CLIENT")&&Fu(u,this.channelName))return;const f=this._users.find(_=>_.uid===u);if(!f)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const g=c==="audio"?f.hasAudio:f.hasVideo;if(c==="audio"){f._trust_audio_enabled_state_=!0;const _=f._audio_enabled_;if(f._audio_enabled_=h,f._audio_enabled_===_)return;{const x=f._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(x)),this.safeEmit(Rt.USER_INFO_UPDATED,u,x)}}else{f._trust_video_enabled_state_=!0;const _=f._video_enabled_;if(f._video_enabled_=h,f._video_enabled_===_)return;{const x=f._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(x)),this.safeEmit(Rt.USER_INFO_UPDATED,u,x)}}const v=c==="audio"?f.hasAudio:f.hasVideo;return g!==v?!g&&v?(R.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(Rt.USER_PUBLISHED,f,c)):(c==="video"&&f._videoTrack&&f._videoTrack._destroy(),c==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,c),R.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(Rt.USER_UNPUBLISHED,f,c)):void 0}),L(this,"_handleMuteStream",(c,u,h)=>{if(G("BLOCK_LOCAL_CLIENT")&&Fu(c,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const f=this._users.find(_=>_.uid===c);if(!f)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=u==="audio"?f.hasAudio:f.hasVideo;if(u==="audio"){f._trust_audio_mute_state_=!0;const _=f._audio_muted_;if(f._audio_muted_=h,f._audio_muted_===_)return;{const x=f._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(x)),this.safeEmit(Rt.USER_INFO_UPDATED,c,x)}}else{f._trust_video_mute_state_=!0;const _=f._video_muted_;if(f._video_muted_=h,f._video_muted_===_)return;{const x=f._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(x)),this.safeEmit(Rt.USER_INFO_UPDATED,c,x)}}const v=u==="audio"?f.hasAudio:f.hasVideo;if(g!==v){if(!g&&v)return(u==="audio"?f._audioSSRC:f._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(Rt.USER_PUBLISHED,f,u)):void R.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),u==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,u),R.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(Rt.USER_UNPUBLISHED,f,u)}}),L(this,"_handleP2PLost",async c=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),L(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Rt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),L(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),L(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Rt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Rt.NETWORK_QUALITY,c)}),L(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,f)=>{const g=this._users.find(_=>_.uid===u);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),f!==void 0&&(g._audioMid=f)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),f!==void 0&&(g._videoMid=f)),(c==="audio"?g.hasAudio:g.hasVideo)&&!v&&(R.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Rt.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(_=>{R.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=t,this._clientId=r||Zt(5,"client-"),this.store=new class{constructor(c,u,h,f,g){gt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:f,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Iu.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!g}}dispatch(c){this.state=function(u,h){switch(h.type){case pt.SET_SESSION_ID:return Ie(Ie({},u),{},{sessionId:h.sessionId});case pt.SET_P2P_ID:return Ie(Ie({},u),{},{p2pId:h.p2pId});case pt.SET_UID:return Ie(Ie({},u),{},{uid:h.uid});case pt.SET_INT_UID:return Ie(Ie({},u),{},{intUid:h.intUid});case pt.SET_PUB_ID:return Ie(Ie({},u),{},{pubId:h.pubId});case pt.KEY_METRIC_CLIENT_CREATED:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{clientCreated:h.metric})});case pt.KEY_METRIC_JOIN_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinStart:h.metric})});case pt.KEY_METRIC_PRELOAD_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{preloadStart:h.metric})});case pt.KEY_METRIC_PRELOAD_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{preloadEnd:h.metric})});case pt.KEY_METRIC_JOIN_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinEnd:h.metric})});case pt.KEY_METRIC_REQUEST_AP_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{requestAPStart:h.metric})});case pt.KEY_METRIC_REQUEST_AP_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{requestAPEnd:h.metric})});case pt.KEY_METRIC_REQUEST_SUA_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{requestSUAEnd:h.metric})});case pt.KEY_METRIC_BEFORE_CONNECT:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{beforeConnect:h.metric})});case pt.KEY_METRIC_PEER_RECEIVER:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{peerReceiver:h.metric})});case pt.KEY_METRIC_SIGNAL_CONNECTED:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{signalConnected:h.metric})});case pt.KEY_METRIC_JOIN_REQ:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinReq:h.metric})});case pt.KEY_METRIC_JOIN_REP:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinRep:h.metric})});case pt.KEY_METRIC_JOIN_GATEWAY_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case pt.KEY_METRIC_JOIN_GATEWAY_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case pt.KEY_METRIC_PEER_CONNECTION_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case pt.KEY_METRIC_PEER_CONNECTION_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case pt.KEY_METRIC_DESCRIPTION_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{descriptionStart:h.metric})});case pt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case pt.KEY_METRIC_ICE_CONNECTION_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case pt.KEY_METRIC_PUBLISH:{const f=u.keyMetrics.publish,g=f.findIndex(v=>v.trackId===h.metric.trackId);return g!==-1?(f[g]=Ie(Ie({},f[g]),h.metric),Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{publish:[...f]})})):Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case pt.KEY_METRIC_SUBSCRIBE:{const f=u.keyMetrics.subscribe,g=f.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return g!==-1?(f[g]=Ie(Ie({},f[g]),h.metric),Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{subscribe:[...f]})})):Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case pt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const f=u.keyMetrics.firstVideoFrameDecoded,g=f.findIndex(v=>v.userId===h.metric.userId);return g!==-1?(f[g]=Ie(Ie({},f[g]),h.metric),Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{firstVideoFrameDecoded:[...f]})})):Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{firstVideoFrameDecoded:[...u.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case pt.RESET_FIRST_VIDEO_FRAME_DECODED:return u.keyMetrics.firstVideoFrameDecoded=[],u;case pt.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case pt.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=Ie(Ie({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case pt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case pt.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},u;case pt.SET_USE_P2P:return Ie(Ie({},u),{},{useP2P:h.val});case pt.SET_TRANSPORT_TYPE:return Ie(Ie({},u),{},{p2pTransport:h.val});case pt.SET_RTE_URL:return Ie(Ie({},u),{},{rteUrl:h.rteUrl});case pt.SET_RTE_SID:return Ie(Ie({},u),{},{rteSid:h.rteSid});default:return u}}(this.state,c)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(c){this.state.useDcSignal=c}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(c){this.state.networkQualityProbe=c}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(c){this.dispatch({type:pt.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set rteUrl(c){this.dispatch({type:pt.SET_RTE_URL,rteUrl:c})}get rteUrl(){return this.state.rteUrl}set rteSid(c){this.dispatch({type:pt.SET_RTE_SID,rteSid:c})}get rteSid(){return this.state.rteSid}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:pt.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:pt.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:pt.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:pt.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:pt.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:pt.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:pt.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:pt.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:pt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:pt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:pt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:pt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:pt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:pt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:pt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:pt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:pt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:pt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:pt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:pt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:pt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:pt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:pt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:pt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:pt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,u){this.dispatch({type:pt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Ie({userId:c},u)})}descriptionStart(){this.dispatch({type:pt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:pt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:pt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,f){this.dispatch({type:pt.KEY_METRIC_PUBLISH,metric:Ie(Ie({trackId:c,type:u},h&&{publishStart:h}),f&&{publishEnd:f})})}subscribe(c,u,h,f,g,v,_){this.dispatch({type:pt.KEY_METRIC_SUBSCRIBE,metric:Ie(Ie(Ie(Ie(Ie({userId:c,type:u},h&&{subscribeStart:h}),f&&{subscribeEnd:f}),g&&{firstFrame:g}),v&&{streamAdded:v}),_&&{firstDecoded:_})})}massSubscribe(c,u,h,f){c.forEach(g=>{this.dispatch({type:pt.KEY_METRIC_SUBSCRIBE,metric:Ie(Ie(Ie({userId:g.userId,type:g.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),f&&{firstFrame:f})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:pt.RECORD_JOIN_CHANNEL_SERVICE,record:Ie(Ie({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:pt.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:pt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:pt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:pt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId,G("SIGNAL_CHANNEL")===1),this._leaveMutex=new Rr("client-leave",this._clientId),this._publishMutex=new Rr("client-publish",this._clientId),this._renewTokenMutex=new Rr("client-renewtoken",this._clientId),this._subscribeMutex=new Rr("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(os," build: ").concat(oA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{zR(t.clientRoleOptions),i=Object.assign({},t.clientRoleOptions)}catch(c){R.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var s;this._statsCollector=new ov(this.store),this._statsCollector.onStatsException=(c,u,h)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),c===uI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(f=>{f instanceof Db&&G("ENABLE_ENCODE_EXCEPTION")&&f.findClosestProfile()}),this.safeEmit(Rt.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,f)=>{const g=this._users.find(v=>v.uid===c);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g.uid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),$e.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:u,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(G("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const u=this.localTracks.find(h=>h instanceof dn);u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(c==="h264"?G("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new fve(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Yn,httpRetryConfig:t.httpRetryConfig||Yn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:i}),this._configDistribute=new Tve(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},Do("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new Hu(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,i,s,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];an("JOIN_GATEWAY_USE_443PORT_ONLY",u),an("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const f=this._gateway.signal.websocket;return f instanceof zA&&(f.use443PortOnly=u,f.tryDoubleDomain=h),async function(g,v,_){hb.get(g)||hb.set(g,[]),pb.get(g)||pb.set(g,v),fc.get(g)||fc.set(g,0);const x=hb.get(g),S=pb.get(g);if(!x||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(fc.get(g)===S){const W=Fg();x.push(W),await W.promise}fc.set(g,fc.get(g)+1);for(var C=arguments.length,U=new Array(C>3?C-3:0),P=3;P<C;P++)U[P-3]=arguments[P];const j=await _(...U);return fc.set(g,fc.get(g)-1),fc.get(g)===S-1&&x.length>0&&(x[0].resolve(),x.shift()),fc.get(g)===0&&(hb.set(g,[]),pb.set(g,0),fc.set(g,0)),j}("client.join",G("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,i,s,c)}async join(t,r,i,s,c){const u=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const h=(_b||_b||(_b=(window.location.protocol.split(":")[0]||"").toUpperCase(),_b))==="HTTPS",f=XF()?window.isSecureContext:"Browser Not Support";(!XF()&&!h||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;$e.setAppId(t);try{if(!i&&i!==null)throw new ce($.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));if(i&&Mr(i,"token",1,2047),Mr(t,"appid",1,2047),$b(r),s&&Hb(s),c)if(typeof c=="string")Mr(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new ce($.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:j,enableInstantMuteRestore:W,networkQualityProbe:K}=c;j&&(Us(j,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(j)),this.store.autoSubscribe=j),W&&(Us(W,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(W)),this.store.enableInstantMuteRestore=W),K&&(Us(K,"networkQualityProbe"),R.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(K)),this.store.networkQualityProbe=K)}}}catch(j){throw $e.reportApiInvoke(Au(),{name:wn.JOIN,options:[t,r,i,s],states:{isHttps:h,isSecureContext:f},tag:ln.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw $e.reportApiInvoke(Au(),{name:wn.JOIN,options:[t,r,i,s],states:{isHttps:h,isSecureContext:f},tag:ln.TRACER}).onError(j),j}this._gateway.state="CONNECTING",this.store.preloadStart();const v=await RI({appId:t,cname:r,uid:s,stringUid:typeof s=="string"?s:void 0,token:i||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const _=(v==null?void 0:v.sid)||Au();R.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId);const x=$e.reportApiInvoke(this._sessionId,{id:this._clientId,name:wn.JOIN,options:[t,r,i,s],states:{isHttps:h,isSecureContext:f},tag:ln.TRACER}),S=Ys(Ys(Ys({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!v},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:G("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(S.stringUid=s,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async j=>{const W=function(ie){const Z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),se=new Uint8Array(new ArrayBuffer(Z.length));for(let ge=0;ge<Z.length;ge+=1)se[ge]=Z.charCodeAt(ge);return se}(),K=await window.crypto.subtle.importKey("spki",W,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),J=$R(j),re=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},K,J);return function(ie){let Z="";for(let se=0;se<ie.length;se+=1)Z+=String.fromCharCode(ie[se]);return window.btoa(Z)}(new Uint8Array(re))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,W=G("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(S.appId+this._encryptionSecret+this._encryptionSecret):j.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(K,J,re){const ie=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=K==="aes-128-gcm2"?128:256,se=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:sV,hash:"SHA-256",salt:re},ie,Z+zme);return new Uint8Array(se).subarray(Z/8)}(this._encryptionMode,W,Ru(this._encryptionSalt)),this._encryptDataStreamKey=await async function(K,J,re){const ie=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=K==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:sV,hash:"SHA-256",salt:re},ie,{name:"AES-GCM",length:Z},!0,["encrypt","decrypt"])}(this._encryptionMode,W,Ru(this._encryptionSalt))}else f?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:S.stringUid});const C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&$e.joinChannelTimeout(this._sessionId,5)},5e3);try{var U;let j;const W=S.cloudProxyServer;if(Te(U=["proxy3","proxy4","proxy5"]).call(U,W)){const Z=G("PROXY_SERVER_TYPE3");Array.isArray(Z)?S.proxyServer=Z[0]:S.proxyServer=Z}if($e.setProxyServer(S.proxyServer),R.setProxyServer(S.proxyServer),this.store.requestAPStart(),v){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(v.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=v.intUid),j={gatewayInfo:v.ap.gatewayInfo},G("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(v.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Z=(await Y6(v.ap.proxyInfo,v.ap.gatewayInfo.uid)).map(se=>({turnServerURL:se.address,tcpport:se.tcpport||Hr.tcpport,udpport:se.udpport||Hr.udpport,username:se.username||Hr.username,password:se.password||Hr.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:Z}}nG(v,S.stringUid)}else{if(S.stringUid&&!S.uid){let Z;[Z,j]=await De.all([x8(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,this.store).finally(()=>{this.store.requestSUAEnd()}),E8(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(Z)),S.uid=Z,j.gatewayInfo.uid=Z,j.gatewayInfo.res.uid=Z}else j=await E8(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(Oo.UPDATE_BITRATE_LIMIT,Z=>{this._p2pChannel.updateBitrateLimit(Z)}),this._configDistribute.on(Oo.UPDATE_CLIENT_ROLE_OPTIONS,Z=>{this._setClientRoleOptions(Z)}),this._configDistribute.on(Oo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,Z=>{var se;Te(se=[0,1,4,5,6,7,8,9]).call(se,Z)&&(this.remoteUsers.forEach(ge=>{this._remoteStreamTypeCacheMap.get(ge.uid)!==Z&&this.setRemoteVideoStreamType(ge.uid,Z)}),this.setRemoteDefaultVideoStreamType(Z))}),this._configDistribute.on(Oo.FALLBACK_TO_HLS,Z=>{Z&&this.safeEmit(Rt.FALLBACK_TO_HLS,KR.CONFIG)}),this._configDistribute.on(Oo.UPDATE_VOS_CONFIGURE,Z=>{this._gateway.setConfigure(Z).catch(se=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),se)})})},0),this._key=i||t;const K=j.gatewayInfo,J=S.uid?S.uid:K.uid;this._joinInfo=Ys(Ys({},S),{},{cid:K.cid,uid:J,vid:K.vid,apResponse:K.res,apGatewayAddress:K.apGatewayAddress,uni_lbs_ip:K.uni_lbs_ip,gatewayAddrs:K.gatewayAddrs}),this.store.intUid=J,this.store.cid=K.cid;const re=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));x.onSuccess(re),this._appId=t,this._channelName=S.cname,this._uid=re,this.store.uid=re,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Nr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ie=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ie)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),P=this,Te(Uu).call(Uu,P)||Uu.push(P),this._cloudProxyServerMode==="disabled"&&It().supportWebCrypto&&G("ENABLE_PRELOAD")&&II(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&$e.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&$e.reportRteDetail(this._sessionId)},G("RTE_DETAIL_REPORT_INTERVAL")||6e4),re}catch(j){const W=Array.isArray(j)?j[0]:j;throw W&&W.code===$.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),W):R.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),W),W.code!==$.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),x.onError(W),W}var P}async _joinGateway(){if(!this._joinInfo||!this._key)throw new ce($.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!G("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(t){if(t.code===$.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Dt.FALLBACK),R.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new ce($.INVALID_OPERATION);return $e.reportApiInvoke(this._sessionId,{name:wn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:ln.TRACER}).onSuccess(),await this._joinGateway()}throw t}}async leave(){R.info("[".concat(this._clientId,"] Leaving channel"));const t=()=>{!Nr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(i){const s=Uu.indexOf(i);s!==-1&&Uu.splice(s,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||t();const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void r();await this._gateway.leave(this.connectionState!=="CONNECTED",Dt.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),r(),this.store.useDcSignal&&t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Gp))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new ce($.INVALID_PARAMS,"param list is empty");const i=t;if(this._gateway.role==="audience")throw new ce($.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof Gp))throw new ce($.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new ce($.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof dn&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),R.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw R.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{s()}}async _publishDataChannel(t){if(t==null)throw new ce($.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));cn(t.id,"id",0,65535,!0),Us(t.ordered,"ordered"),Mr(t.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new ce($.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ce($.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new ce($.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return h8(c,!1)}(t),s=await this._p2pChannel.publishDataChannel([i]);if(s.length>0){if(typeof i._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ce($.CREATE_DATACHANNEL_ERROR);try{await De.all(s.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==$.DISCONNECT_P2P)throw c}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw R.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new ce($.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Gp))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.sendExtensionMessage(Hn.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.unpublish(s,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(s){throw R.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(t);i&&await this._gateway.unpublishDataChannel(i),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(s=>"".concat(s.id))))}catch(i){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(t,r,i){if(!(t instanceof ld)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new ce($.INVALID_REMOTE_USER,"user is not in the channel");t=s}return r==="datachannel"?this._subscribeDataChannel(t,i):this._subscribe(t,r)}async presubscribe(t,r){if(Kn(r,"mediaType",["audio","video"]),this.store.useP2P)throw new ce($.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ce($.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===Ge.AUDIO,s=r===Ge.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:f,cname:g,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(u==null)throw new ce($.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(S=>S.uid===t);_||(_=new ld(t,v||t),_._is_pre_created=!0,this._users.push(_)),g&&(_._cname=g),_._uintid||(_._uintid=v||t),i&&(_._audioSSRC=u,_._audio_pre_subscribed=!0,h&&(_._audioOrtc=h)),s&&(_._videoSSRC=u,_._video_pre_subscribed=!0,h&&(_._videoOrtc=h),f!=null&&(_._rtxSsrcId=f)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(_,r,u,f,h);const x=i?_._audioTrack:_._videoTrack;if(!x)throw new ce($.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),s&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),x}catch(u){throw R.error("[".concat(this._clientId,"] presub user ").concat(t," error"),u),u}finally{c()}}async _subscribeDataChannel(t,r){var i;if(cn(r,"channelId",0,65535,!0),!this._joinInfo)throw new ce($.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===t))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new ce($.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new ce($.INVALID_REMOTE_USER,"user is not published");const c=(i=t._dataChannels)===null||i===void 0?void 0:i.find(f=>f.id===r);if(!c)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new ce($.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const f=await this._p2pChannel.subscribeDataChannel(t,[c]);if(f&&Te(f).call(f,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ce($.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==$.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),g;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(t,r,i){if(Kn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new ce($.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new ce($.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!i&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const u=new ce($.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,f=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,f)}catch(h){throw h}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new ce($.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{c()}}async _subscribe(t,r,i){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Kn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new ce($.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new ce($.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(i||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new ce($.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,f={stream_type:r==="audio"?Ge.AUDIO:Ge.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const _=r==="audio"?t._audioSSRC:t._videoSSRC;_!==void 0&&_!==c&&(c=_,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,f={stream_type:r==="audio"?Ge.AUDIO:Ge.VIDEO,ssrcId:c}),Zr.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,f,!0)}catch(x){if((x==null?void 0:x.code)!==$.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),x;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,t,r),_}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(_=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new ce($.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),v}catch(v){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{g()}}async massSubscribe(t){if(nl(t,"subscribeList"),!this._joinInfo)throw new ce($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(f=>{let{user:g,mediaType:v}=f;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(f=>{let{user:g,mediaType:v}=f;return{user:g,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var h;for(let g=t.length-1;g>=0;g--){const v=t[g],{user:_,mediaType:x}=v;if(Kn(x,"mediaType",["audio","video"]),!_){const P=new ce($.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),P}if(!this._users.find(P=>P===_)){const P=new ce($.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),c[g].error=P,t.splice(g,1);continue}if(x==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||x==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const P=new ce($.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(x,", remote user is not published")),c[g].error=P,t.splice(g,1);continue}const C=br.Video|br.LwoVideo,U=i.get(_);if(U){if(x==="video"?U&C:U&br.Audio){t.splice(g,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(x," twice"));continue}i.set(_,U|(x==="video"?C:br.Audio))}else i.set(_,x==="video"?C:br.Audio)}for(let g=t.length-1;g>=0;g--){const v=t[g],{user:_,mediaType:x}=v,S=br.Video|br.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,x)){await this._p2pChannel.unmuteRemoteNoLock(_,x);const C=i.get(_);i.set(_,x==="video"?C^S:C^br.Audio),t.splice(g,1)}}this.store.massSubscribe(t.map(g=>({userId:g.user.uid,type:g.mediaType})),r);let f=as(h=Array.from(i.entries())).call(h,(g,v)=>{let[_,x]=v;if(x===0)return g;const S={stream_id:_.uid,stream_type:x};return x&br.Audio&&(S.audio_ssrc=_._audioSSRC),x&br.Video&&(S.video_ssrc=_._videoSSRC),g.push(S),g},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:_,mediaType:x}=v;return{user:_,mediaType:x,ssrcId:x===Ge.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:x===Ge.VIDEO?_._rtxSsrcId:void 0}}));const g=new Map;if(f=f.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),f.length>0){const v=await this._gateway.subscribeAll(f,!0);((v==null?void 0:v.users)||[]).forEach(_=>{let{stream_id:x,video_error_code:S,audio_error_code:C,error_code:U}=_;(S||C||U)&&g.set(x,{video_error_code:S,audio_error_code:C,error_code:U})})}if(Array.from(g.entries()).length>0){const v=[];Array.from(g.entries()).forEach(_=>{let[x,S]=_;const C=this.remoteUsers.find(U=>U.uid===x);if(C){let U;S.error_code||S.video_error_code&&S.audio_error_code?U=void 0:S.video_error_code?U=Ge.VIDEO:S.audio_error_code&&(U=Ge.AUDIO),v.push({user:C,mediaType:U})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const _=g.get(v.user.uid);if(_){const x=_.error_code||v.mediaType==="audio"&&_.audio_error_code||v.mediaType==="video"&&_.video_error_code;if(x){const S=Bu(x);R.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(S.desc)),v.error=new ce($.SUBSCRIBE_FAILED,"code ".concat(x,": ").concat(S.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var _;$e.subscribe(this.store.sessionId,{succ:!!v.error,ec:((_=v.error)===null||_===void 0?void 0:_.code)||null,video:v.mediaType===Ge.VIDEO,audio:v.mediaType===Ge.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===Ge.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:_,mediaType:x}=v;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(x)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(t),g}}finally{u(),s()}}async unsubscribe(t,r,i){if(!(t instanceof ld)){const u=this.remoteUsers.find(h=>h.uid===t);if(!u)throw new ce($.INVALID_REMOTE_USER,"user is not in the channel");t=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,i)}else await this._unsubscribeDataChannel(t,i);if(r&&Kn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce($.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===t)){const u=new ce($.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),u}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const u=await this._p2pChannel.unsubscribe(t,r);u&&await this._gateway.unsubscribe(u,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&gb(this._users,t),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===$.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&cn(r,"id",0,65535,!0),!this._joinInfo)throw new ce($.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new ce($.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let s;if(typeof r=="number"){const c=t._dataChannels.find(u=>u.id===r);c&&(s=[c])}else s=t._dataChannels;if(s===void 0){const c=new ce($.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,s);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===$.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(nl(t,"unsubscribeList"),!this._joinInfo)throw new ce($.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(i=>{let{user:s,mediaType:c}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let i=t.length-1;i>=0;i--){const{user:s,mediaType:c}=t[i];if(!s){const f=new ce($.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),f}if(Kn(c,"mediaType",["video","audio",void 0]),!this._users.find(f=>f===s)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),t.splice(i,1);continue}const h=br.Video|br.LwoVideo;if(r.has(s)){const f=r.get(s);let g;switch(c){case"video":g=f&h;break;case"audio":g=f&br.Audio;break;default:g=f&(br.Audio|h)}if(g){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(c," twice.")),t.splice(i,1);continue}c?c==="audio"?r.set(s,f|br.Audio):c==="video"&&r.set(s,f|h):r.set(s,f|br.Audio|h)}else c?c==="audio"?r.set(s,br.Audio):c==="video"&&r.set(s,h):r.set(s,br.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(t);i&&await this._gateway.massUnsubscribe(i),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(s=>{let{user:c,mediaType:u}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===$.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(t){(function(i){if(!i)throw new pe($.INVALID_PARAMS);kn(i.width)||GR(i.width,"streamParameter.width"),kn(i.height)||GR(i.height,"streamParameter.height"),kn(i.framerate)||GR(i.framerate,"streamParameter.framerate"),kn(i.bitrate)||cn(i.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Ce.LocalVideoLowTrack)}async setDualStreamMode(t,r){Kn(t,"mode",[0,1,-1]);try{switch(r&&await this.setLowStreamParameter(r),this._dualStreamMode=t,this._joinInfo?this._gateway.setDualStreamMode(t).catch(i=>{R.warning("[".concat(this._clientId,"] set dual stream mode failed"),i.toString())}):R.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(t)),t){case Op.AUTO_SIMULCAST_STREAM:R.info("[".concat(this._clientId,"] set dual stream mode to ").concat(t));break;case Op.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case Op.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(i){throw R.error("[".concat(this._clientId,"] set dual stream mode error"),i.toString()),i}}async enableDualStream(){if(!It().supportDualStream)throw $e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ce($.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ce($.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw $e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,this._dualStreamMode=Op.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(t=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),t.toString())}),$e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void R.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(Ce.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw $e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,this._dualStreamMode=Op.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(t=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),t.toString())}),$e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(s){Kn(s,"role",["audience","host"])}(t),r&&zR(r),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ce($.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new ce($.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new ce($.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;if(this._joinInfo&&(this._joinInfo.role=t),t!==i&&G("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",$r.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),R.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level)),i==="audience"&&t!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Hu){const{video_codec:s}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(s.map(c=>c.toLowerCase()).filter(c=>{var u;return Te(u=Object.keys(Ou)).call(u,c)}))}}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&zR(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Mr(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new ce($.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ce($.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,$e.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new ce($.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ce($.INVALID_OPERATION,"You have already set the proxy")}if(wu(t))return this._turnServer={servers:t,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(i=>i.urls).join(","),"."));t.forEach(i=>UF(i)),this._turnServer={servers:t,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new ce($.INVALID_OPERATION,"you should set license before join channel");if(Mr(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new ce($.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,R.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new ce($.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ce($.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(t===void 0&&(t=3),t){case 1:case 2:throw new ce($.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new ce($.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ce($.INVALID_OPERATION,"Stop proxy server after leave channel");$e.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new ce($.INVALID_PARAMS,"accessPoints is required.");nl(t.accessPoints.serverList,"accessPoints.serverList"),Mr(t.accessPoints.domain,"accessPoints.domain");const r=(S,C)=>{cn(S,C,0,65535,!0)};let i=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),i=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ce($.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");G("CLOSE_AFB_FOR_LOCAL_AP")&&(an("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),an("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,u=t.accessPoints.serverList.map(S=>s.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(c):S),h=u.map(S=>"".concat(S,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,an("WEBCS_DOMAIN",h),an("WEBCS_DOMAIN_BACKUP_LIST",h),an("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(nl(t.report.hostname,"report.hostname"),an("EVENT_REPORT_DOMAIN",t.report.hostname[0]),an("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(an("EVENT_REPORT_DOMAIN",u[0]),an("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let f=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),f=t.report.port),an("STATS_COLLECTOR_PORT",f),t.report?an("ENABLE_EVENT_REPORT",!0):an("ENABLE_EVENT_REPORT",!1);let g="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(nl(t.log.hostname,"log.hostname"),g=t.log.hostname[0]):g=u[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),an("LOG_UPLOAD_SERVER","".concat(g,":").concat(v));let _=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(nl(t.cds.hostname,"cds.hostname"),_=t.cds.hostname):_=u;let x=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),x=t.cds.port),an("CDS_AP",_.map(S=>"".concat(S,":").concat(x))),t.cds?an("ENABLE_CONFIG_DISTRIBUTE",!0):an("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(nl(t,"serverList"),Mr(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ce($.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(r):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,an("WEBCS_DOMAIN",t),an("WEBCS_DOMAIN_BACKUP_LIST",t),an("GATEWAY_DOMAINS",[r]),an("EVENT_REPORT_DOMAIN",t[0]),an("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),an("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Kn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Kn(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const i=this._users.find(s=>s.uid===t);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Kn(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(i){throw R.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,i,s){(function(u){Kn(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Mr(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Te(c).call(c,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new ce($.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new ce($.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(Us(s,"encryptDataStream"),!Te(c).call(c,t))throw new ce($.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,i&&(this._encryptionSalt=nd(i))}async renewToken(t){if(Mr(t,"token",1,2047),!this._key||!this._joinInfo)throw new ce($.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const i=await this._renewTokenMutex.lock();try{if(G("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await wve(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:s})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=r,this._joinInfo.token=r,R.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Rt.VOLUME_INDICATOR,t)},G("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new ce($.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ce($.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new ce($.LIVE_STREAMING_TASK_CONFLICT);const i=r?il.TRANSCODE:il.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(t,i)}setLiveTranscoding(t){return this._createLiveStreamingClient(il.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(t));if(!r.length)throw new ce($.INVALID_PARAMS,"can not find live streaming url to stop");await De.all(r.map(i=>i&&i.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){R8(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){R8(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Hu&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ce($.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Te(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(s=!0,t.payload=await async function(c,u,h){var f;const g=as(f=Array.from(h)).call(f,(P,j)=>P+j,0),v={serverTs:0,seq:Kme++,length:h.length,checkSum:g},_=new Uint8Array(KF(g,2)),x=new ArrayBuffer(Mp),S=new DataView(x);S.setUint32(0,v.serverTs),S.setUint16(4,v.seq),S.setUint16(6,v.length),S.setUint16(8,v.checkSum);const C=16-h.length%16;h=GF(h,new Uint8Array(C));const U=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:aV,additionalData:_},u,h);return GF(new Uint8Array(x),new Uint8Array(U))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new ce($.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ye.DATA_STREAM,{payload:nd(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-Dve},!i)}sendMetadata(t){if(!this._joinInfo)throw new ce($.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new ce($.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ye.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:nd(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(nge),!this._joinInfo)throw new ce($.INVALID_OPERATION,"can not send custom report, not joined");await $e.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(G("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map(i=>i.uid+"");Object.keys(t).forEach(i=>{Te(r).call(r,i)||delete t[i]})}return t}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(t,r){Kn(r.spatialLayer,"spatialLayer",[0,1,2,3]),Kn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(i){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:i}=t;if(Us(r,"apRTM"),cn(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(t){const r=Yp.indexOf(t);r!==-1&&Yp.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Mi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&tG(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&$e.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&$e.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Rr("client-publish",this._clientId),this._subscribeMutex=new Rr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var i;const s=t||Au();t?R.debug("[".concat(this._clientId,"] new Session ").concat(s)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const c=t?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,$e.addSid(s);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};$e.sessionInit(this._sessionId,Ys({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new ce($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new ce($.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const s=(await i.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Hn.PUBLISH,s,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await i.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==$.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof dn&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,t),(i==null?void 0:i.code)===$.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ce($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce($.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==$.DISCONNECT_P2P)throw i.throw(u),u}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===$.WS_ABORT)return;throw i}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new ce($.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Do("LiveStreaming").create(s));var s;return i.onLiveStreamError=(c,u)=>{$e.reportApiInvoke(this._sessionId,{name:wn.ON_LIVE_STREAM_ERROR,options:[c,u],tag:ln.TRACER}).onSuccess(),this.safeEmit(Rt.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{$e.reportApiInvoke(this._sessionId,{name:wn.ON_LIVE_STREAM_WARNING,options:[c,u],tag:ln.TRACER}).onSuccess(),this.safeEmit(Rt.LIVE_STREAMING_WARNING,c,u)},i.on(WA.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new ce($.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(f,g,v,_){const x=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(S=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await vve(x,f,g,v,_)})(c,this._joinInfo,this._axiosCancelSource.token,Yn).then(u).catch(h)}),i};return t===il.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ce($.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),s=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},Do("ChannelMediaRelay").create(t));s.on("state",c=>{c===Zi.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(Rt.CHANNEL_MEDIA_RELAY_STATE,c)}),s.on("event",c=>{this.safeEmit(Rt.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:i,deleted:s}=t,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(f=>{i.every(g=>g.uid!==h._uintid||g.stream_id!==f.id)&&u.push({uid:h._uintid,stream_id:f.id,ordered:f.ordered,max_retrans_times:f.maxRetransmits,metadata:f.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:f,ordered:g,max_retrans_times:v,metadata:_}=u,x=this._users.find(S=>S._uintid===h);if(!x)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),Te(c).call(c,x)||c.push(x),x._uintid||(x._uintid=h),x._dataChannels.findIndex(S=>S.id===u.stream_id)===-1){const S={id:f,ordered:!!g,maxRetransmits:v,metadata:_},C=function(U){return h8(U,!0)}(S);x._dataChannels.push(C),R.info("[".concat(this._clientId,"] remote user ").concat(x.uid," published datachannel")),r||this.safeEmit(Rt.USER_PUBLISHED,x,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(x,u.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(x.uid," after reconnect.")),this._subscribeDataChannel(x,u.stream_id).catch(S=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),r&&(this.safeEmit(Rt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:f}=u,g=this._users.find(_=>_._uintid===h);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=g._dataChannels.find(_=>_.id===u.stream_id);v&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[v]).then(_=>{if(g._dataChannels=g._dataChannels.filter(x=>x!==v),_)return this._gateway.unsubscribeDataChannel(_,g.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(Rt.USER_UNPUBLISHED,g,"datachannel",v._config))})}_getEncodingName(t){var r,i;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(!s)return;for(const f of s){var c;if(f.payloadType===t)return f==null||(c=f.rtpMap)===null||c===void 0?void 0:c.encodingName}const u=(i=this._joinResponse.ortc.rtpCapabilities.recv)===null||i===void 0?void 0:i.videoCodecs;if(u)for(const f of u){var h;if(f.payloadType===t)return f==null||(h=f.rtpMap)===null||h===void 0?void 0:h.encodingName}return t===0?"unknown":void 0}_handleRemoveDataChannels(t){const r=this._users.find(i=>i.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const i=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(s=>{this.safeEmit(Rt.USER_UNPUBLISHED,r,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,r.uid)}),i()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on($n.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),i=Date.now();Object.keys(r).forEach(s=>{const{value:c,type:u,expires:h}=r[s];h&&h<=i||u||LA()||!Object.prototype.hasOwnProperty.call(Sb,s)||(Ma[s]=c,en[s]=c,R.debug("Update gateway parameters from config distribute",s,c))})}catch(r){R.error("Error update config from local cache",r.message)}})()}),this._gateway.on($n.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on($n.CONNECTION_STATE_CHANGE,(t,r,i)=>{var s;if(i===Dt.FALLBACK)return;const c=()=>{this.safeEmit(Rt.CONNECTION_STATE_CHANGE,t,r,i)};if($e.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:wn.CONNECTION_STATE_CHANGE,options:[t,r,i],tag:ln.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:i})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,f)=>{this._gateway.setStreamFallbackOption(f,h).catch(g=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((h,f)=>{this._gateway.setRemoteVideoStreamType(f,h).catch(g=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),G("VOS_CONFIGURE")&&Array.isArray(G("VOS_CONFIGURE"))&&G("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(G("VOS_CONFIGURE")).catch(h=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),h)}),R.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(h=>{R.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),h)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Ge.AUDIO,!1)),h._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Ge.VIDEO,!1)),h._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on($n.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new ce($.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;if(this._fallbackServerInfo)i=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,$e.reportApiInvoke(this._sessionId,{name:wn.VOS_FALLBACK_CN,options:{cur:i.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:ln.TRACER}).onSuccess(),R.info("[".concat(this._clientId,"] use fallback cn server info"));else{const c=await RI(Ys(Ys({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));c?(i=c.ap,nG(c),this._joinInfo.preload=!0):(i=await sE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const s=[];i.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:u}=c;const[h,f]=u.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:h,port:f}):s.push({host:h,port:f})}),t(s)}catch(i){r(i)}}),this._gateway.on($n.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Rt.NETWORK_QUALITY,t)}),this._gateway.on($n.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(Rt.STREAM_TYPE_CHANGED,t,r),$e.reportApiInvoke(this._sessionId,{name:wn.STREAM_TYPE_CHANGE,options:[t,r],tag:ln.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on($n.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on($n.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,i)=>{try{let s=await this._p2pChannel.getEstablishParams();s&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(s=await this._p2pChannel.startP2PConnection(t)),r(s)}catch(s){i(s)}}),this._gateway.on($n.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let i;this._joinResponse=t,t.attributes?i=t.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const s=n8(t.ortc,r,i);this._p2pChannel.connect(s)}),this._gateway.on($n.PRE_CONNECT_PC,async(t,r,i)=>{const{candidates:s,fingerprint:c,turnServer:u}=t;if(this._joinInfo&&s.length>0&&!this._p2pChannel.isPlanB){const{cert:f,cid:g}=this._joinInfo.apResponse,v="".concat(g,"_").concat(f);if(v.length<4||v.length>256)return void R.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(v.length));await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var h;r(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(g,"_").concat(f),icePwd:"".concat(g,"_").concat(f)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(h=G("FINGERPRINT"))!==null&&h!==void 0?h:c}]},candidates:s,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(_){_.code&&_.code===$.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),i(_)}}}),this._gateway.on($n.VOS_FALLBACK,t=>{t==="fallback_hls"&&this.safeEmit(Rt.FALLBACK_TO_HLS,KR.VOSERROR)}),this._gateway.on($n.RESET_SIGNAL,()=>{this._p2pChannel instanceof Hu&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on($n.DATACHANNEL_FAILBACK,()=>{$e.reportApiInvoke(this._sessionId,{name:wn.DATACHANNEL_FAILBACK,options:{},tag:ln.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(ft.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ft.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ft.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(ft.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(ft.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(ft.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ft.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ft.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ft.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ge.AUDIO,!0)),this._gateway.signal.on(ft.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ge.AUDIO,!1)),this._gateway.signal.on(ft.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ge.VIDEO,!0)),this._gateway.signal.on(ft.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ge.VIDEO,!1)),this._gateway.signal.on(ft.RECEIVE_METADATA,t=>{const r=Ru(t.metadata);this.safeEmit(Rt.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(ft.ON_DATA_STREAM,async t=>{var r;if(!t)return;let i=Ru(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Te(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Mp)throw new ce($.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Mp));i=await async function(u,h,f){const g=f.subarray(0,Mp),v=g.slice(8,Mp),_=(v[0]<<8)+v[1],x=(g[6]<<8)+g[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:aV,additionalData:new Uint8Array(KF(_,2))},h,f.subarray(Mp));return new Uint8Array(S).subarray(0,x)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let s=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(f=>f.uid===t.uid),h=c==null?void 0:c.audioRecv.find(f=>f.ssrc===(u==null?void 0:u._audioSSRC));s=h==null?void 0:h.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),jve(Ys(Ys({},t),{},{payload:i}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ft.ON_CRYPT_ERROR,()=>{td(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Rt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ft.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Dt.TOKEN_EXPIRE),this.safeEmit(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ft.ON_STREAM_FALLBACK_UPDATE,t=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Rt.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ft.ENABLE_MULTI_STREAM,t=>{this._dualStreamMode===Op.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(r=>{R.debug("[".concat(this._clientId,"] set dual stream mode error"),r.toString())})}),this._gateway.signal.on(ft.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(ft.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(ft.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(ze.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Ye.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,s;const u=c.some(g=>{let{stream_type:v}=g;return v===tn.Audio}),h=c.some(g=>{let{stream_type:v}=g;return v!==tn.Audio}),f=c.some(g=>{let{stream_type:v}=g;return v===tn.Screen||v===tn.ScreenLow});r.state==="offer"&&$e.publish(this._joinInfo.sid,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:$.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:u?(i=c.find(g=>{let{stream_type:v}=g;return v===tn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(s=c.find(g=>{let{stream_type:v}=g;return v!==tn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case Ye.SUBSCRIBE:r&&$e.subscribe(this._joinInfo.sid,{succ:!1,ec:$.TIMEOUT,audio:r.stream_type===Ge.AUDIO,video:r.stream_type===Ge.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(ft.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(ft.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;G("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(s=>!Fu(s.string_id||s.stream_id,this.channelName)));const r=[],i=[];for(const s of t.users){let c=this._users.find(_=>_._uintid===s.stream_id);c?c._trust_in_room_=!0:(c=new ld(s.string_id||s.stream_id,s.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Rt.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(Rt.USER_JOINED,c)));const u=br.Audio&s.stream_type,h=(br.Video|br.LwoVideo)&s.stream_type,f=(65280&s.stream_type)!=0,g=u&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=s.video_ssrc,c._rtxSsrcId=s.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=s.audio_ssrc),u&&!g&&this.getListeners(Rt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Rt.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(Rt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Rt.USER_PUBLISHED,c,"video")),(u&&!g||h&&!v||f)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(Rt.PUBLISHED_USER_LIST).length>0?G("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(s=>s.uid).join(", "))),this.safeEmit(Rt.PUBLISHED_USER_LIST,r)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(ft.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;if(this._p2pChannel instanceof Hu){if(this.role==="audience"&&G("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=t,void R.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(t)));this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var s;return Te(s=Object.keys(Ou)).call(s,i)}))}}),this._gateway.signal.on(ze.VOS_FALLBACK_PROMISE,async(t,r,i)=>{if(t==="FALLBACKCN"&&G("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return i(new ce($.UNEXPECTED_ERROR,"can not recover, no join info"));R.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const c=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=t;const u=await sE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,this.store);if(G("QUALITY_FALLBACK_REHEARSAL"))return $e.reportApiInvoke(this._sessionId,{name:wn.VOS_FALLBACK_CN,options:{cur:u.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:ln.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c,void i();this._fallbackServerInfo=u,r()}catch(u){var s;const h=u==null||(s=u.data)===null||s===void 0?void 0:s.desc;G("QUALITY_FALLBACK_REHEARSAL")?($e.reportApiInvoke(this._sessionId,{name:wn.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+h||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:ln.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c):Array.isArray(h)&&Te(h).call(h,"request downgrade fallback")&&this.safeEmit(Rt.FALLBACK_TO_HLS,KR.AP_ERROR),i(u)}}else i()})}_handleP2PEvents(){this._gateway.signal.on(ft.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Hn.PUBLISH,(t,r,i)=>{const{uid:s}=t;t.forEach(c=>{const{kind:u,ssrcs:h,mid:f,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(u,s,h[0].ssrcId,f);const v=this._users.find(_=>_.uid===s);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,h[0].ssrcId,f).then(()=>{r()}).catch(i):r(),this._handleMuteStream(s,u,!!g)})}),this._gateway.signal.on(Hn.CALL,async(t,r,i)=>{if(this.store.useP2P)try{var s;r(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},t))}catch(c){i(c)}}),this._gateway.signal.on(ze.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Hn.UNPUBLISH,async(t,r,i)=>{if(this.store.useP2P){const{unpubMsg:s,uid:c}=t,u=this._users.find(h=>h.uid===c);if(!u)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{s.forEach(async h=>{let{stream_type:f}=h;const g=f===tn.Audio?Ge.AUDIO:Ge.VIDEO;await this._p2pChannel.unsubscribe(u,g),this._handleMuteStream(c,g,!0)}),r()}catch(h){i(h)}}}),this._gateway.signal.on(Hn.CONTROL,async(t,r)=>{const{action:i}=t;switch(i){case sd.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Ge.VIDEO,!0);break;case sd.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Ge.AUDIO,!0);break;case sd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Ge.VIDEO,!1);break;case sd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Ge.AUDIO,!1)}}),this._gateway.signal.on(Hn.RESTART_ICE,async(t,r,i)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:c}=t;s!==Ri.SEND_ONLY||c?r(await this._p2pChannel.restartICE(s,c)):(this._p2pChannel.handleDisconnect(s),r())}catch(s){i(s)}}),this._gateway.signal.on(Hn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:i}=t;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(qe.RequestP2PRestartICE,async(t,r,i)=>{try{const{direction:s}=t;r(await this._gateway.sendExtensionMessage(Hn.RESTART_ICE,t,s===Ri.SEND_ONLY))}catch(s){i(s)}}),this._p2pChannel.on(qe.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Hn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(qe.RequestP2PMuteLocal,async(t,r,i)=>{try{await this._gateway.sendExtensionMessage(Hn.CONTROL,t,!0),r()}catch(s){i(s)}}),this._p2pChannel.on(qe.RequestP2PUnmuteRemote,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===$.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(qe.RequestP2PMuteRemote,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===$.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(qe.StateChange,(t,r)=>{r===Xt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(qe.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(Rt.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(qe.RequestMuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===$.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(qe.RequestUnmuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===$.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(qe.RequestRePublish,(t,r,i)=>{this.publish(t,!1).then(r).catch(i)}),this._p2pChannel.on(qe.RequestRePublishDataChannel,(t,r,i)=>{De.all(t.map(async s=>{const c=await this._p2pChannel.publishDataChannel([s]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==$.DISCONNECT_P2P)throw u}})).then(r).catch(i)}),this._p2pChannel.on(qe.RequestReSubscribe,async(t,r,i)=>{try{for(const{user:s,kind:c}of t)c===Ge.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");r()}catch(s){i(s)}}),this._p2pChannel.on(qe.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(qe.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(qe.MediaReconnectStart,t=>{this.safeEmit(Rt.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(qe.MediaReconnectEnd,t=>{this.safeEmit(Rt.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(qe.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(qe.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),i=await r.next();if(i.done)return;const s=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:s})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const f=h.iceParameters;return{iceParameters:{iceUfrag:f.iceUfrag,icePwd:f.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(qe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(qe.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:s}),h=n8(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(qe.RequestUnpublishForReconnectPC,async(t,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):i()}),this._p2pChannel.on(qe.P2PLost,()=>{this.safeEmit(Rt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(qe.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(qe.ConnectionTypeChange,t=>{this.safeEmit(Rt.IS_USING_CLOUD_PROXY,t),this._gateway.setUsingProxy(t)}),this._p2pChannel.on(qe.FirstVideoBufferReady,(t,r)=>{this.safeEmit(Rt.FIRST_VIDEO_BUFFER_READY,t,r)}),this._p2pChannel.on(qe.FirstVideoPreRender,(t,r)=>{this.safeEmit(Rt.FIRST_VIDEO_PRE_RENDER,t,r)}),this._p2pChannel.on(qe.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(qe.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(qe.AudioMetadata,t=>{this.safeEmit(Rt.AUDIO_METADATA,t)}),this._p2pChannel.on(qe.AudioPts,t=>{this.safeEmit(Rt.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:t},Do("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:s,cname:c,sid:u,token:h,uid:f,cid:g,vid:v}=this._joinInfo;await i.init({appId:s,areaCode:"",cname:c,sid:u,token:h,uid:f,cid:g,vid:v?Number(v):0},Yn)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(t){t.on(Ir.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(Rt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===Ws.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Rt.CONTENT_INSPECT_ERROR,new ce($.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Ir.INSPECT_RESULT,(r,i)=>{var s;if((i==null?void 0:i.code)===$.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(Rt.CONTENT_INSPECT_RESULT,r,i)}),t.on(Ir.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(Us(t,"enabled"),t){if(!r)throw new ce($.INVALID_PARAMS,"config is required");if(gG(r),!this._joinInfo)throw new ce($.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const s=(i={config:r},Do("ImageModeration").create(i));this._moderation=s,this.handleImageModerationEvents(s);const{appId:c,cname:u,sid:h,token:f,uid:g,cid:v,vid:_}=this._joinInfo;await s.init({appId:c,areaCode:"",cname:u,sid:h,token:f,uid:g,cid:v,vid:_?Number(_):0},Yn)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var i;if(!this._moderation)throw new ce($.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(t){t.on(Po.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(Rt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===hs.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ce($.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Po.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Kn(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new ce($.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Us(t,"enabled"),an("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_setRteInfo(t,r){this.store.rteUrl=t,this.store.rteSid=r}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},ke(Ve.prototype,"leave",[vG],Object.getOwnPropertyDescriptor(Ve.prototype,"leave"),Ve.prototype),ke(Ve.prototype,"publish",[yG],Object.getOwnPropertyDescriptor(Ve.prototype,"publish"),Ve.prototype),ke(Ve.prototype,"unpublish",[_G],Object.getOwnPropertyDescriptor(Ve.prototype,"unpublish"),Ve.prototype),ke(Ve.prototype,"subscribe",[bG],Object.getOwnPropertyDescriptor(Ve.prototype,"subscribe"),Ve.prototype),ke(Ve.prototype,"presubscribe",[EG],Object.getOwnPropertyDescriptor(Ve.prototype,"presubscribe"),Ve.prototype),ke(Ve.prototype,"massSubscribe",[xG],Object.getOwnPropertyDescriptor(Ve.prototype,"massSubscribe"),Ve.prototype),ke(Ve.prototype,"unsubscribe",[SG],Object.getOwnPropertyDescriptor(Ve.prototype,"unsubscribe"),Ve.prototype),ke(Ve.prototype,"massUnsubscribe",[wG],Object.getOwnPropertyDescriptor(Ve.prototype,"massUnsubscribe"),Ve.prototype),ke(Ve.prototype,"setLowStreamParameter",[TG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLowStreamParameter"),Ve.prototype),ke(Ve.prototype,"setDualStreamMode",[CG],Object.getOwnPropertyDescriptor(Ve.prototype,"setDualStreamMode"),Ve.prototype),ke(Ve.prototype,"enableDualStream",[NG],Object.getOwnPropertyDescriptor(Ve.prototype,"enableDualStream"),Ve.prototype),ke(Ve.prototype,"disableDualStream",[RG],Object.getOwnPropertyDescriptor(Ve.prototype,"disableDualStream"),Ve.prototype),ke(Ve.prototype,"setClientRole",[AG],Object.getOwnPropertyDescriptor(Ve.prototype,"setClientRole"),Ve.prototype),ke(Ve.prototype,"_setClientRoleOptions",[IG],Object.getOwnPropertyDescriptor(Ve.prototype,"_setClientRoleOptions"),Ve.prototype),ke(Ve.prototype,"setProxyServer",[OG],Object.getOwnPropertyDescriptor(Ve.prototype,"setProxyServer"),Ve.prototype),ke(Ve.prototype,"setTurnServer",[PG],Object.getOwnPropertyDescriptor(Ve.prototype,"setTurnServer"),Ve.prototype),ke(Ve.prototype,"setLicense",[DG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLicense"),Ve.prototype),ke(Ve.prototype,"startProxyServer",[kG],Object.getOwnPropertyDescriptor(Ve.prototype,"startProxyServer"),Ve.prototype),ke(Ve.prototype,"stopProxyServer",[jG],Object.getOwnPropertyDescriptor(Ve.prototype,"stopProxyServer"),Ve.prototype),ke(Ve.prototype,"setLocalAccessPointsV2",[LG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLocalAccessPointsV2"),Ve.prototype),ke(Ve.prototype,"setLocalAccessPoints",[MG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLocalAccessPoints"),Ve.prototype),ke(Ve.prototype,"setRemoteDefaultVideoStreamType",[UG],Object.getOwnPropertyDescriptor(Ve.prototype,"setRemoteDefaultVideoStreamType"),Ve.prototype),ke(Ve.prototype,"setRemoteVideoStreamType",[FG],Object.getOwnPropertyDescriptor(Ve.prototype,"setRemoteVideoStreamType"),Ve.prototype),ke(Ve.prototype,"setStreamFallbackOption",[VG],Object.getOwnPropertyDescriptor(Ve.prototype,"setStreamFallbackOption"),Ve.prototype),ke(Ve.prototype,"setEncryptionConfig",[BG],Object.getOwnPropertyDescriptor(Ve.prototype,"setEncryptionConfig"),Ve.prototype),ke(Ve.prototype,"renewToken",[GG],Object.getOwnPropertyDescriptor(Ve.prototype,"renewToken"),Ve.prototype),ke(Ve.prototype,"enableAudioVolumeIndicator",[WG],Object.getOwnPropertyDescriptor(Ve.prototype,"enableAudioVolumeIndicator"),Ve.prototype),ke(Ve.prototype,"startLiveStreaming",[$G],Object.getOwnPropertyDescriptor(Ve.prototype,"startLiveStreaming"),Ve.prototype),ke(Ve.prototype,"setLiveTranscoding",[HG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLiveTranscoding"),Ve.prototype),ke(Ve.prototype,"stopLiveStreaming",[zG],Object.getOwnPropertyDescriptor(Ve.prototype,"stopLiveStreaming"),Ve.prototype),ke(Ve.prototype,"startChannelMediaRelay",[KG],Object.getOwnPropertyDescriptor(Ve.prototype,"startChannelMediaRelay"),Ve.prototype),ke(Ve.prototype,"updateChannelMediaRelay",[YG],Object.getOwnPropertyDescriptor(Ve.prototype,"updateChannelMediaRelay"),Ve.prototype),ke(Ve.prototype,"stopChannelMediaRelay",[qG],Object.getOwnPropertyDescriptor(Ve.prototype,"stopChannelMediaRelay"),Ve.prototype),ke(Ve.prototype,"sendCustomReportMessage",[XG],Object.getOwnPropertyDescriptor(Ve.prototype,"sendCustomReportMessage"),Ve.prototype),ke(Ve.prototype,"pickSVCLayer",[JG],Object.getOwnPropertyDescriptor(Ve.prototype,"pickSVCLayer"),Ve.prototype),ke(Ve.prototype,"setRTMConfig",[QG],Object.getOwnPropertyDescriptor(Ve.prototype,"setRTMConfig"),Ve.prototype),ke(Ve.prototype,"enableContentInspect",[ZG],Object.getOwnPropertyDescriptor(Ve.prototype,"enableContentInspect"),Ve.prototype),ke(Ve.prototype,"disableContentInspect",[eW],Object.getOwnPropertyDescriptor(Ve.prototype,"disableContentInspect"),Ve.prototype),ke(Ve.prototype,"setImageModeration",[tW],Object.getOwnPropertyDescriptor(Ve.prototype,"setImageModeration"),Ve.prototype),ke(Ve.prototype,"setP2PTransport",[nW],Object.getOwnPropertyDescriptor(Ve.prototype,"setP2PTransport"),Ve.prototype),ke(Ve.prototype,"getJoinChannelServiceRecords",[rW],Object.getOwnPropertyDescriptor(Ve.prototype,"getJoinChannelServiceRecords"),Ve.prototype),ke(Ve.prototype,"setPublishAudioFilterEnabled",[iW],Object.getOwnPropertyDescriptor(Ve.prototype,"setPublishAudioFilterEnabled"),Ve.prototype),Ve);function sW(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=Zt(5,"client-"),s=$e.reportApiInvoke(null,{id:i,name:wn.CREATE_CLIENT,options:[r],tag:ln.TRACER});try{(function(c){Kn(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Kn(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Kn(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Mr(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&UF(c.turnServer),c.httpRetryConfig!==void 0&&MF(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&MF(c.websocketRetryConfig)})(r)}catch(c){throw s.onError(c),c}return(wF(16,0,!0)||VR(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",R.debug("browser not support vp9, force use vp8")),an("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),s.onSuccess(),new Jve(Ys(Ys({forceWaitGatewayResponse:!0},r),{},{role:Te(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),i)}function Qve(){let t=!1;const r=Bt();return(r.name===Ht.CHROME&&Number(r.version)>=58&&(Co.engine.name!=="WebKit"||function(){const i=Bt();if(mb()){if(i.os===vr.MAC_OS)return!0;if(i.os===vr.IOS){const s=Co.os.version&&Co.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1}())||r.name===Ht.FIREFOX&&Number(r.version)>=56||r.name===Ht.OPERA&&Number(r.version)>=45||r.name===Ht.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(ai()||Ms())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||NF()||Bt().name===Ht.QQ)&&(t=!0),t}class hv{constructor(r,i){L(this,"id",0),L(this,"element",void 0),L(this,"peerPair",void 0),L(this,"context",void 0),L(this,"audioPlayerElement",void 0),L(this,"audioTrack",void 0),hv.count+=1,this.id=hv.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(s,c)=>{const u=c==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(u),s.iceGatheringState==="complete"?s.localDescription:new De(h=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&h(s.localDescription)}})},i=async(s,c)=>await s.setRemoteDescription(c);try{const s=await r(this.peerPair[0],"offer");await i(this.peerPair[1],s);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(s){throw new ce($.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new ce($.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new ce($.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=i.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var oW,_E;L(hv,"count",0);const Zve=window.AudioContext||window.webkitAudioContext,eye=new(oW=at({report:$e}),ke((_E=class{constructor(){L(this,"units",[]),L(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Zve);let r=this.units.find(i=>i&&i.getElement()===t);return r||(r=new hv(t,this.context),this.units.push(r)),r.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Bt().name!==Ht.SAFARI}}).prototype,"processExternalMediaAEC",[oW],Object.getOwnPropertyDescriptor(_E.prototype,"processExternalMediaAEC"),_E.prototype),_E);function cW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function lW(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?cW(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):cW(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const DI=window||document;function dW(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!DI)return;const i=tr._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const s=c=>{if(!(c&&c.blockedURI&&(tr.onSecurityPolicyViolation||tr.getListeners(_c.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;G("CSP_DETECTED_HOSTNAME_LIST").some(h=>Te(u).call(u,h))&&(tr.onSecurityPolicyViolation&&typeof tr.onSecurityPolicyViolation=="function"&&tr.onSecurityPolicyViolation(c),tr.getListeners(_c.SECURITY_POLICY_VIOLATION).length>0&&tr.safeEmit(_c.SECURITY_POLICY_VIOLATION,c))};i&&DI.removeEventListener("securitypolicyviolation",i),(r||t&&typeof t=="function"||tr.getListeners(_c.SECURITY_POLICY_VIOLATION).length>0)&&DI.addEventListener("securitypolicyviolation",s),tr._cspEventHandlerPointer=s}var tye=N,nye=zN,uW=RegExp.prototype,rye=function(t){return t===uW||tye(uW,t)?nye(t):t.flags},fi=d(rye);function df(t){let r=t.length;for(;--r>=0;)t[r]=0}const kI=256,hW=286,pv=30,fv=15,jI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),bE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),iye=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),pW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cl=new Array(576);df(cl);const mv=new Array(60);df(mv);const gv=new Array(512);df(gv);const vv=new Array(256);df(vv);const LI=new Array(29);df(LI);const EE=new Array(pv);function MI(t,r,i,s,c){this.static_tree=t,this.extra_bits=r,this.extra_base=i,this.elems=s,this.max_length=c,this.has_stree=t&&t.length}let fW,mW,gW;function UI(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}df(EE);const vW=t=>t<256?gv[t]:gv[256+(t>>>7)],yv=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},Ha=(t,r,i)=>{t.bi_valid>16-i?(t.bi_buf|=r<<t.bi_valid&65535,yv(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=i)},Tc=(t,r,i)=>{Ha(t,i[2*r],i[2*r+1])},yW=(t,r)=>{let i=0;do i|=1&t,t>>>=1,i<<=1;while(--r>0);return i>>>1},_W=(t,r,i)=>{const s=new Array(16);let c,u,h=0;for(c=1;c<=fv;c++)h=h+i[c-1]<<1,s[c]=h;for(u=0;u<=r;u++){let f=t[2*u+1];f!==0&&(t[2*u]=yW(s[f]++,f))}},bW=t=>{let r;for(r=0;r<hW;r++)t.dyn_ltree[2*r]=0;for(r=0;r<pv;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},EW=t=>{t.bi_valid>8?yv(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},xW=(t,r,i,s)=>{const c=2*r,u=2*i;return t[c]<t[u]||t[c]===t[u]&&s[r]<=s[i]},FI=(t,r,i)=>{const s=t.heap[i];let c=i<<1;for(;c<=t.heap_len&&(c<t.heap_len&&xW(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!xW(r,s,t.heap[c],t.depth));)t.heap[i]=t.heap[c],i=c,c<<=1;t.heap[i]=s},SW=(t,r,i)=>{let s,c,u,h,f=0;if(t.sym_next!==0)do s=255&t.pending_buf[t.sym_buf+f++],s+=(255&t.pending_buf[t.sym_buf+f++])<<8,c=t.pending_buf[t.sym_buf+f++],s===0?Tc(t,c,r):(u=vv[c],Tc(t,u+kI+1,r),h=jI[u],h!==0&&(c-=LI[u],Ha(t,c,h)),s--,u=vW(s),Tc(t,u,i),h=bE[u],h!==0&&(s-=EE[u],Ha(t,s,h)));while(f<t.sym_next);Tc(t,256,r)},VI=(t,r)=>{const i=r.dyn_tree,s=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,f,g,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):i[2*h+1]=0;for(;t.heap_len<2;)g=t.heap[++t.heap_len]=v<2?++v:0,i[2*g]=1,t.depth[g]=0,t.opt_len--,c&&(t.static_len-=s[2*g+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)FI(t,i,h);g=u;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],FI(t,i,1),f=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=f,i[2*g]=i[2*h]+i[2*f],t.depth[g]=(t.depth[h]>=t.depth[f]?t.depth[h]:t.depth[f])+1,i[2*h+1]=i[2*f+1]=g,t.heap[1]=g++,FI(t,i,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((_,x)=>{const S=x.dyn_tree,C=x.max_code,U=x.stat_desc.static_tree,P=x.stat_desc.has_stree,j=x.stat_desc.extra_bits,W=x.stat_desc.extra_base,K=x.stat_desc.max_length;let J,re,ie,Z,se,ge,Ee=0;for(Z=0;Z<=fv;Z++)_.bl_count[Z]=0;for(S[2*_.heap[_.heap_max]+1]=0,J=_.heap_max+1;J<573;J++)re=_.heap[J],Z=S[2*S[2*re+1]+1]+1,Z>K&&(Z=K,Ee++),S[2*re+1]=Z,re>C||(_.bl_count[Z]++,se=0,re>=W&&(se=j[re-W]),ge=S[2*re],_.opt_len+=ge*(Z+se),P&&(_.static_len+=ge*(U[2*re+1]+se)));if(Ee!==0){do{for(Z=K-1;_.bl_count[Z]===0;)Z--;_.bl_count[Z]--,_.bl_count[Z+1]+=2,_.bl_count[K]--,Ee-=2}while(Ee>0);for(Z=K;Z!==0;Z--)for(re=_.bl_count[Z];re!==0;)ie=_.heap[--J],ie>C||(S[2*ie+1]!==Z&&(_.opt_len+=(Z-S[2*ie+1])*S[2*ie],S[2*ie+1]=Z),re--)}})(t,r),_W(i,v,t.bl_count)},wW=(t,r,i)=>{let s,c,u=-1,h=r[1],f=0,g=7,v=4;for(h===0&&(g=138,v=3),r[2*(i+1)+1]=65535,s=0;s<=i;s++)c=h,h=r[2*(s+1)+1],++f<g&&c===h||(f<v?t.bl_tree[2*c]+=f:c!==0?(c!==u&&t.bl_tree[2*c]++,t.bl_tree[32]++):f<=10?t.bl_tree[34]++:t.bl_tree[36]++,f=0,u=c,h===0?(g=138,v=3):c===h?(g=6,v=3):(g=7,v=4))},TW=(t,r,i)=>{let s,c,u=-1,h=r[1],f=0,g=7,v=4;for(h===0&&(g=138,v=3),s=0;s<=i;s++)if(c=h,h=r[2*(s+1)+1],!(++f<g&&c===h)){if(f<v)do Tc(t,c,t.bl_tree);while(--f!=0);else c!==0?(c!==u&&(Tc(t,c,t.bl_tree),f--),Tc(t,16,t.bl_tree),Ha(t,f-3,2)):f<=10?(Tc(t,17,t.bl_tree),Ha(t,f-3,3)):(Tc(t,18,t.bl_tree),Ha(t,f-11,7));f=0,u=c,h===0?(g=138,v=3):c===h?(g=6,v=3):(g=7,v=4)}};let CW=!1;const NW=(t,r,i,s)=>{Ha(t,0+(s?1:0),3),EW(t),yv(t,i),yv(t,~i),i&&t.pending_buf.set(t.window.subarray(r,r+i),t.pending),t.pending+=i};var aye=t=>{CW||((()=>{let r,i,s,c,u;const h=new Array(16);for(s=0,c=0;c<28;c++)for(LI[c]=s,r=0;r<1<<jI[c];r++)vv[s++]=c;for(vv[s-1]=c,u=0,c=0;c<16;c++)for(EE[c]=u,r=0;r<1<<bE[c];r++)gv[u++]=c;for(u>>=7;c<pv;c++)for(EE[c]=u<<7,r=0;r<1<<bE[c]-7;r++)gv[256+u++]=c;for(i=0;i<=fv;i++)h[i]=0;for(r=0;r<=143;)cl[2*r+1]=8,r++,h[8]++;for(;r<=255;)cl[2*r+1]=9,r++,h[9]++;for(;r<=279;)cl[2*r+1]=7,r++,h[7]++;for(;r<=287;)cl[2*r+1]=8,r++,h[8]++;for(_W(cl,287,h),r=0;r<pv;r++)mv[2*r+1]=5,mv[2*r]=yW(r,5);fW=new MI(cl,jI,257,hW,fv),mW=new MI(mv,bE,0,pv,fv),gW=new MI(new Array(0),iye,0,19,7)})(),CW=!0),t.l_desc=new UI(t.dyn_ltree,fW),t.d_desc=new UI(t.dyn_dtree,mW),t.bl_desc=new UI(t.bl_tree,gW),t.bi_buf=0,t.bi_valid=0,bW(t)},sye=(t,r,i,s)=>{let c,u,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(f=>{let g,v=4093624447;for(g=0;g<=31;g++,v>>>=1)if(1&v&&f.dyn_ltree[2*g]!==0)return 0;if(f.dyn_ltree[18]!==0||f.dyn_ltree[20]!==0||f.dyn_ltree[26]!==0)return 1;for(g=32;g<kI;g++)if(f.dyn_ltree[2*g]!==0)return 1;return 0})(t)),VI(t,t.l_desc),VI(t,t.d_desc),h=(f=>{let g;for(wW(f,f.dyn_ltree,f.l_desc.max_code),wW(f,f.dyn_dtree,f.d_desc.max_code),VI(f,f.bl_desc),g=18;g>=3&&f.bl_tree[2*pW[g]+1]===0;g--);return f.opt_len+=3*(g+1)+5+5+4,g})(t),c=t.opt_len+3+7>>>3,u=t.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&r!==-1?NW(t,r,i,s):t.strategy===4||u===c?(Ha(t,2+(s?1:0),3),SW(t,cl,mv)):(Ha(t,4+(s?1:0),3),((f,g,v,_)=>{let x;for(Ha(f,g-257,5),Ha(f,v-1,5),Ha(f,_-4,4),x=0;x<_;x++)Ha(f,f.bl_tree[2*pW[x]+1],3);TW(f,f.dyn_ltree,g-1),TW(f,f.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),SW(t,t.dyn_ltree,t.dyn_dtree)),bW(t),s&&EW(t)},oye=(t,r,i)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=i,r===0?t.dyn_ltree[2*i]++:(t.matches++,r--,t.dyn_ltree[2*(vv[i]+kI+1)]++,t.dyn_dtree[2*vW(r)]++),t.sym_next===t.sym_end),cye=t=>{Ha(t,2,3),Tc(t,256,cl),(r=>{r.bi_valid===16?(yv(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},lye={_tr_init:aye,_tr_stored_block:NW,_tr_flush_block:sye,_tr_tally:oye,_tr_align:cye},_v=(t,r,i,s)=>{let c=65535&t|0,u=t>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+r[s++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const dye=new Uint32Array((()=>{let t,r=[];for(var i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;r[i]=t}return r})());var Ai=(t,r,i,s)=>{const c=dye,u=s+i;t^=-1;for(let h=s;h<u;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},Yu={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},xE={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:uye,_tr_stored_block:BI,_tr_flush_block:hye,_tr_tally:pd,_tr_align:pye}=lye,{Z_NO_FLUSH:fd,Z_PARTIAL_FLUSH:fye,Z_FULL_FLUSH:mye,Z_FINISH:qs,Z_BLOCK:RW,Z_OK:Wi,Z_STREAM_END:AW,Z_STREAM_ERROR:Cc,Z_DATA_ERROR:gye,Z_BUF_ERROR:GI,Z_DEFAULT_COMPRESSION:vye,Z_FILTERED:yye,Z_HUFFMAN_ONLY:SE,Z_RLE:_ye,Z_FIXED:bye,Z_DEFAULT_STRATEGY:Eye,Z_UNKNOWN:xye,Z_DEFLATED:wE}=xE,WI=286,Sye=30,wye=19,Tye=2*WI+1,Cye=15,qu=258,Nc=262,uf=42,Xu=113,bv=666,Ju=(t,r)=>(t.msg=Yu[r],r),IW=t=>2*t-(t>4?9:0),md=t=>{let r=t.length;for(;--r>=0;)t[r]=0},Nye=t=>{let r,i,s,c=t.w_size;r=t.hash_size,s=r;do i=t.head[--s],t.head[s]=i>=c?i-c:0;while(--r);r=c,s=r;do i=t.prev[--s],t.prev[s]=i>=c?i-c:0;while(--r)};let gd=(t,r,i)=>(r<<t.hash_shift^i)&t.hash_mask;const ps=t=>{const r=t.state;let i=r.pending;i>t.avail_out&&(i=t.avail_out),i!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),t.next_out),t.next_out+=i,r.pending_out+=i,t.total_out+=i,t.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},fs=(t,r)=>{hye(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,ps(t.strm)},Gn=(t,r)=>{t.pending_buf[t.pending++]=r},Ev=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},$I=(t,r,i,s)=>{let c=t.avail_in;return c>s&&(c=s),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),i),t.state.wrap===1?t.adler=_v(t.adler,r,c,i):t.state.wrap===2&&(t.adler=Ai(t.adler,r,c,i)),t.next_in+=c,t.total_in+=c,c)},OW=(t,r)=>{let i,s,c=t.max_chain_length,u=t.strstart,h=t.prev_length,f=t.nice_match;const g=t.strstart>t.w_size-Nc?t.strstart-(t.w_size-Nc):0,v=t.window,_=t.w_mask,x=t.prev,S=t.strstart+qu;let C=v[u+h-1],U=v[u+h];t.prev_length>=t.good_match&&(c>>=2),f>t.lookahead&&(f=t.lookahead);do if(i=r,v[i+h]===U&&v[i+h-1]===C&&v[i]===v[u]&&v[++i]===v[u+1]){u+=2,i++;do;while(v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&u<S);if(s=qu-(S-u),u=S-qu,s>h){if(t.match_start=r,h=s,s>=f)break;C=v[u+h-1],U=v[u+h]}}while((r=x[r&_])>g&&--c!=0);return h<=t.lookahead?h:t.lookahead},hf=t=>{const r=t.w_size;let i,s,c;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Nc)&&(t.window.set(t.window.subarray(r,r+r-s),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),Nye(t),s+=r),t.strm.avail_in===0)break;if(i=$I(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=i,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=gd(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=gd(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Nc&&t.strm.avail_in!==0)},PW=(t,r)=>{let i,s,c,u=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,f=t.strm.avail_in;do{if(i=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,s=t.strstart-t.block_start,i>s+t.strm.avail_in&&(i=s+t.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&r!==qs||r===fd||i!==s+t.strm.avail_in)))break;h=r===qs&&i===s+t.strm.avail_in?1:0,BI(t,0,0,h),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,ps(t.strm),s&&(s>i&&(s=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,i-=s),i&&($I(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(h===0);return f-=t.strm.avail_in,f&&(f>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=f&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-f,t.strm.next_in),t.strstart),t.strstart+=f,t.insert+=f>t.w_size-t.insert?t.w_size-t.insert:f),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==fd&&r!==qs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&($I(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,u=c>t.w_size?t.w_size:c,s=t.strstart-t.block_start,(s>=u||(s||r===qs)&&r!==fd&&t.strm.avail_in===0&&s<=c)&&(i=s>c?c:s,h=r===qs&&t.strm.avail_in===0&&i===s?1:0,BI(t,t.block_start,i,h),t.block_start+=i,ps(t.strm)),h?3:1)},HI=(t,r)=>{let i,s;for(;;){if(t.lookahead<Nc){if(hf(t),t.lookahead<Nc&&r===fd)return 1;if(t.lookahead===0)break}if(i=0,t.lookahead>=3&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),i!==0&&t.strstart-i<=t.w_size-Nc&&(t.match_length=OW(t,i)),t.match_length>=3)if(s=pd(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=gd(t,t.ins_h,t.window[t.strstart+1]);else s=pd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(fs(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===qs?(fs(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(fs(t,!1),t.strm.avail_out===0)?1:2},pf=(t,r)=>{let i,s,c;for(;;){if(t.lookahead<Nc){if(hf(t),t.lookahead<Nc&&r===fd)return 1;if(t.lookahead===0)break}if(i=0,t.lookahead>=3&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,i!==0&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-Nc&&(t.match_length=OW(t,i),t.match_length<=5&&(t.strategy===yye||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,s=pd(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(fs(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(s=pd(t,0,t.window[t.strstart-1]),s&&fs(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=pd(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===qs?(fs(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(fs(t,!1),t.strm.avail_out===0)?1:2};function Rc(t,r,i,s,c){this.good_length=t,this.max_lazy=r,this.nice_length=i,this.max_chain=s,this.func=c}const xv=[new Rc(0,0,0,0,PW),new Rc(4,4,8,4,HI),new Rc(4,5,16,8,HI),new Rc(4,6,32,32,HI),new Rc(4,4,16,16,pf),new Rc(8,16,32,32,pf),new Rc(8,16,128,128,pf),new Rc(8,32,128,256,pf),new Rc(32,128,258,1024,pf),new Rc(32,258,258,4096,pf)];function Rye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=wE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Tye),this.dyn_dtree=new Uint16Array(2*(2*Sye+1)),this.bl_tree=new Uint16Array(2*(2*wye+1)),md(this.dyn_ltree),md(this.dyn_dtree),md(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Cye+1),this.heap=new Uint16Array(2*WI+1),md(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*WI+1),md(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Sv=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==uf&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Xu&&r.status!==bv?1:0},DW=t=>{if(Sv(t))return Ju(t,Cc);t.total_in=t.total_out=0,t.data_type=xye;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?uf:Xu,t.adler=r.wrap===2?0:1,r.last_flush=-2,uye(r),Wi},kW=t=>{const r=DW(t);return r===Wi&&(i=>{i.window_size=2*i.w_size,md(i.head),i.max_lazy_match=xv[i.level].max_lazy,i.good_match=xv[i.level].good_length,i.nice_match=xv[i.level].nice_length,i.max_chain_length=xv[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(t.state),r},jW=(t,r,i,s,c,u)=>{if(!t)return Cc;let h=1;if(r===vye&&(r=6),s<0?(h=0,s=-s):s>15&&(h=2,s-=16),c<1||c>9||i!==wE||s<8||s>15||r<0||r>9||u<0||u>bye||s===8&&h!==1)return Ju(t,Cc);s===8&&(s=9);const f=new Rye;return t.state=f,f.strm=t,f.status=uf,f.wrap=h,f.gzhead=null,f.w_bits=s,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=c+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<c+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=r,f.strategy=u,f.method=i,kW(t)};var Aye=(t,r)=>{if(Sv(t)||r>RW||r<0)return t?Ju(t,Cc):Cc;const i=t.state;if(!t.output||t.avail_in!==0&&!t.input||i.status===bv&&r!==qs)return Ju(t,t.avail_out===0?GI:Cc);const s=i.last_flush;if(i.last_flush=r,i.pending!==0){if(ps(t),t.avail_out===0)return i.last_flush=-1,Wi}else if(t.avail_in===0&&IW(r)<=IW(s)&&r!==qs)return Ju(t,GI);if(i.status===bv&&t.avail_in!==0)return Ju(t,GI);if(i.status===uf&&i.wrap===0&&(i.status=Xu),i.status===uf){let c=wE+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=SE||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,Ev(i,c),i.strstart!==0&&(Ev(i,t.adler>>>16),Ev(i,65535&t.adler)),t.adler=1,i.status=Xu,ps(t),i.pending!==0)return i.last_flush=-1,Wi}if(i.status===57){if(t.adler=0,Gn(i,31),Gn(i,139),Gn(i,8),i.gzhead)Gn(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Gn(i,255&i.gzhead.time),Gn(i,i.gzhead.time>>8&255),Gn(i,i.gzhead.time>>16&255),Gn(i,i.gzhead.time>>24&255),Gn(i,i.level===9?2:i.strategy>=SE||i.level<2?4:0),Gn(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Gn(i,255&i.gzhead.extra.length),Gn(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Ai(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Gn(i,0),Gn(i,0),Gn(i,0),Gn(i,0),Gn(i,0),Gn(i,i.level===9?2:i.strategy>=SE||i.level<2?4:0),Gn(i,3),i.status=Xu,ps(t),i.pending!==0)return i.last_flush=-1,Wi}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let f=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+f),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=f,ps(t),i.pending!==0)return i.last_flush=-1,Wi;c=0,u-=f}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-u,u)),ps(t),i.pending!==0)return i.last_flush=-1,Wi;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Gn(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-u,u)),ps(t),i.pending!==0)return i.last_flush=-1,Wi;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Gn(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(ps(t),i.pending!==0))return i.last_flush=-1,Wi;Gn(i,255&t.adler),Gn(i,t.adler>>8&255),t.adler=0}if(i.status=Xu,ps(t),i.pending!==0)return i.last_flush=-1,Wi}if(t.avail_in!==0||i.lookahead!==0||r!==fd&&i.status!==bv){let c=i.level===0?PW(i,r):i.strategy===SE?((u,h)=>{let f;for(;;){if(u.lookahead===0&&(hf(u),u.lookahead===0)){if(h===fd)return 1;break}if(u.match_length=0,f=pd(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,f&&(fs(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===qs?(fs(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(fs(u,!1),u.strm.avail_out===0)?1:2})(i,r):i.strategy===_ye?((u,h)=>{let f,g,v,_;const x=u.window;for(;;){if(u.lookahead<=qu){if(hf(u),u.lookahead<=qu&&h===fd)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,g=x[v],g===x[++v]&&g===x[++v]&&g===x[++v])){_=u.strstart+qu;do;while(g===x[++v]&&g===x[++v]&&g===x[++v]&&g===x[++v]&&g===x[++v]&&g===x[++v]&&g===x[++v]&&g===x[++v]&&v<_);u.match_length=qu-(_-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(f=pd(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(f=pd(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),f&&(fs(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===qs?(fs(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(fs(u,!1),u.strm.avail_out===0)?1:2})(i,r):xv[i.level].func(i,r);if(c!==3&&c!==4||(i.status=bv),c===1||c===3)return t.avail_out===0&&(i.last_flush=-1),Wi;if(c===2&&(r===fye?pye(i):r!==RW&&(BI(i,0,0,!1),r===mye&&(md(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),ps(t),t.avail_out===0))return i.last_flush=-1,Wi}return r!==qs?Wi:i.wrap<=0?AW:(i.wrap===2?(Gn(i,255&t.adler),Gn(i,t.adler>>8&255),Gn(i,t.adler>>16&255),Gn(i,t.adler>>24&255),Gn(i,255&t.total_in),Gn(i,t.total_in>>8&255),Gn(i,t.total_in>>16&255),Gn(i,t.total_in>>24&255)):(Ev(i,t.adler>>>16),Ev(i,65535&t.adler)),ps(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Wi:AW)},Iye=(t,r)=>{let i=r.length;if(Sv(t))return Cc;const s=t.state,c=s.wrap;if(c===2||c===1&&s.status!==uf||s.lookahead)return Cc;if(c===1&&(t.adler=_v(t.adler,r,i,0)),s.wrap=0,i>=s.w_size){c===0&&(md(s.head),s.strstart=0,s.block_start=0,s.insert=0);let g=new Uint8Array(s.w_size);g.set(r.subarray(i-s.w_size,i),0),r=g,i=s.w_size}const u=t.avail_in,h=t.next_in,f=t.input;for(t.avail_in=i,t.next_in=0,t.input=r,hf(s);s.lookahead>=3;){let g=s.strstart,v=s.lookahead-2;do s.ins_h=gd(s,s.ins_h,s.window[g+3-1]),s.prev[g&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=g,g++;while(--v);s.strstart=g,s.lookahead=2,hf(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=h,t.input=f,t.avail_in=u,s.wrap=c,Wi},wv={deflateInit:(t,r)=>jW(t,r,wE,15,8,Eye),deflateInit2:jW,deflateReset:kW,deflateResetKeep:DW,deflateSetHeader:(t,r)=>Sv(t)||t.state.wrap!==2?Cc:(t.state.gzhead=r,Wi),deflate:Aye,deflateEnd:t=>{if(Sv(t))return Cc;const r=t.state.status;return t.state=null,r===Xu?Ju(t,gye):Wi},deflateSetDictionary:Iye,deflateInfo:"pako deflate (from Nodeca project)"};const Oye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var TE={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const s in i)Oye(i,s)&&(t[s]=i[s])}}return t},flattenChunks:t=>{let r=0;for(let s=0,c=t.length;s<c;s++)r+=t[s].length;const i=new Uint8Array(r);for(let s=0,c=0,u=t.length;s<u;s++){let h=t[s];i.set(h,c),c+=h.length}return i}};let LW=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{LW=!1}const Tv=new Uint8Array(256);for(let t=0;t<256;t++)Tv[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Tv[254]=Tv[254]=1;var Cv={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,i,s,c,u,h=t.length,f=0;for(c=0;c<h;c++)i=t.charCodeAt(c),(64512&i)==55296&&c+1<h&&(s=t.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(f),u=0,c=0;u<f;c++)i=t.charCodeAt(c),(64512&i)==55296&&c+1<h&&(s=t.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),i<128?r[u++]=i:i<2048?(r[u++]=192|i>>>6,r[u++]=128|63&i):i<65536?(r[u++]=224|i>>>12,r[u++]=128|i>>>6&63,r[u++]=128|63&i):(r[u++]=240|i>>>18,r[u++]=128|i>>>12&63,r[u++]=128|i>>>6&63,r[u++]=128|63&i);return r},buf2string:(t,r)=>{const i=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let s,c;const u=new Array(2*i);for(c=0,s=0;s<i;){let h=t[s++];if(h<128){u[c++]=h;continue}let f=Tv[h];if(f>4)u[c++]=65533,s+=f-1;else{for(h&=f===2?31:f===3?15:7;f>1&&s<i;)h=h<<6|63&t[s++],f--;f>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,f)=>{if(f<65534&&h.subarray&&LW)return String.fromCharCode.apply(null,h.length===f?h:h.subarray(0,f));let g="";for(let v=0;v<f;v++)g+=String.fromCharCode(h[v]);return g})(u,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let i=r-1;for(;i>=0&&(192&t[i])==128;)i--;return i<0||i===0?r:i+Tv[t[i]]>r?i:r}},MW=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const UW=Object.prototype.toString,{Z_NO_FLUSH:Pye,Z_SYNC_FLUSH:Dye,Z_FULL_FLUSH:kye,Z_FINISH:jye,Z_OK:CE,Z_STREAM_END:Lye,Z_DEFAULT_COMPRESSION:Mye,Z_DEFAULT_STRATEGY:Uye,Z_DEFLATED:Fye}=xE;function NE(t){this.options=TE.assign({level:Mye,method:Fye,chunkSize:16384,windowBits:15,memLevel:8,strategy:Uye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MW,this.strm.avail_out=0;let i=wv.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==CE)throw new Error(Yu[i]);if(r.header&&wv.deflateSetHeader(this.strm,r.header),r.dictionary){let s;if(s=typeof r.dictionary=="string"?Cv.string2buf(r.dictionary):UW.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=wv.deflateSetDictionary(this.strm,s),i!==CE)throw new Error(Yu[i]);this._dict_set=!0}}function FW(t,r){const i=new NE(r);if(i.push(t,!0),i.err)throw i.msg||Yu[i.err];return i.result}NE.prototype.push=function(t,r){const i=this.strm,s=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?jye:Pye,typeof t=="string"?i.input=Cv.string2buf(t):UW.call(t)==="[object ArrayBuffer]"?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(u===Dye||u===kye)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=wv.deflate(i,u),c===Lye)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=wv.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===CE;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},NE.prototype.onData=function(t){this.chunks.push(t)},NE.prototype.onEnd=function(t){t===CE&&(this.result=TE.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Vye={deflate:FW,deflateRaw:function(t,r){return(r=r||{}).raw=!0,FW(t,r)}};const RE=16209;var Bye=function(t,r){let i,s,c,u,h,f,g,v,_,x,S,C,U,P,j,W,K,J,re,ie,Z,se,ge,Ee;const Fe=t.state;i=t.next_in,ge=t.input,s=i+(t.avail_in-5),c=t.next_out,Ee=t.output,u=c-(r-t.avail_out),h=c+(t.avail_out-257),f=Fe.dmax,g=Fe.wsize,v=Fe.whave,_=Fe.wnext,x=Fe.window,S=Fe.hold,C=Fe.bits,U=Fe.lencode,P=Fe.distcode,j=(1<<Fe.lenbits)-1,W=(1<<Fe.distbits)-1;e:do{C<15&&(S+=ge[i++]<<C,C+=8,S+=ge[i++]<<C,C+=8),K=U[S&j];t:for(;;){if(J=K>>>24,S>>>=J,C-=J,J=K>>>16&255,J===0)Ee[c++]=65535&K;else{if(!(16&J)){if(!(64&J)){K=U[(65535&K)+(S&(1<<J)-1)];continue t}if(32&J){Fe.mode=16191;break e}t.msg="invalid literal/length code",Fe.mode=RE;break e}re=65535&K,J&=15,J&&(C<J&&(S+=ge[i++]<<C,C+=8),re+=S&(1<<J)-1,S>>>=J,C-=J),C<15&&(S+=ge[i++]<<C,C+=8,S+=ge[i++]<<C,C+=8),K=P[S&W];n:for(;;){if(J=K>>>24,S>>>=J,C-=J,J=K>>>16&255,!(16&J)){if(!(64&J)){K=P[(65535&K)+(S&(1<<J)-1)];continue n}t.msg="invalid distance code",Fe.mode=RE;break e}if(ie=65535&K,J&=15,C<J&&(S+=ge[i++]<<C,C+=8,C<J&&(S+=ge[i++]<<C,C+=8)),ie+=S&(1<<J)-1,ie>f){t.msg="invalid distance too far back",Fe.mode=RE;break e}if(S>>>=J,C-=J,J=c-u,ie>J){if(J=ie-J,J>v&&Fe.sane){t.msg="invalid distance too far back",Fe.mode=RE;break e}if(Z=0,se=x,_===0){if(Z+=g-J,J<re){re-=J;do Ee[c++]=x[Z++];while(--J);Z=c-ie,se=Ee}}else if(_<J){if(Z+=g+_-J,J-=_,J<re){re-=J;do Ee[c++]=x[Z++];while(--J);if(Z=0,_<re){J=_,re-=J;do Ee[c++]=x[Z++];while(--J);Z=c-ie,se=Ee}}}else if(Z+=_-J,J<re){re-=J;do Ee[c++]=x[Z++];while(--J);Z=c-ie,se=Ee}for(;re>2;)Ee[c++]=se[Z++],Ee[c++]=se[Z++],Ee[c++]=se[Z++],re-=3;re&&(Ee[c++]=se[Z++],re>1&&(Ee[c++]=se[Z++]))}else{Z=c-ie;do Ee[c++]=Ee[Z++],Ee[c++]=Ee[Z++],Ee[c++]=Ee[Z++],re-=3;while(re>2);re&&(Ee[c++]=Ee[Z++],re>1&&(Ee[c++]=Ee[Z++]))}break}}break}}while(i<s&&c<h);re=C>>3,i-=re,C-=re<<3,S&=(1<<C)-1,t.next_in=i,t.next_out=c,t.avail_in=i<s?s-i+5:5-(i-s),t.avail_out=c<h?h-c+257:257-(c-h),Fe.hold=S,Fe.bits=C};const AE=15,Gye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Wye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),$ye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Hye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Nv=(t,r,i,s,c,u,h,f)=>{const g=f.bits;let v,_,x,S,C,U,P=0,j=0,W=0,K=0,J=0,re=0,ie=0,Z=0,se=0,ge=0,Ee=null;const Fe=new Uint16Array(16),ht=new Uint16Array(16);let ot,St,yt,Yt=null;for(P=0;P<=AE;P++)Fe[P]=0;for(j=0;j<s;j++)Fe[r[i+j]]++;for(J=g,K=AE;K>=1&&Fe[K]===0;K--);if(J>K&&(J=K),K===0)return c[u++]=20971520,c[u++]=20971520,f.bits=1,0;for(W=1;W<K&&Fe[W]===0;W++);for(J<W&&(J=W),Z=1,P=1;P<=AE;P++)if(Z<<=1,Z-=Fe[P],Z<0)return-1;if(Z>0&&(t===0||K!==1))return-1;for(ht[1]=0,P=1;P<AE;P++)ht[P+1]=ht[P]+Fe[P];for(j=0;j<s;j++)r[i+j]!==0&&(h[ht[r[i+j]]++]=j);if(t===0?(Ee=Yt=h,U=20):t===1?(Ee=Gye,Yt=Wye,U=257):(Ee=$ye,Yt=Hye,U=0),ge=0,j=0,P=W,C=u,re=J,ie=0,x=-1,se=1<<J,S=se-1,t===1&&se>852||t===2&&se>592)return 1;for(;;){ot=P-ie,h[j]+1<U?(St=0,yt=h[j]):h[j]>=U?(St=Yt[h[j]-U],yt=Ee[h[j]-U]):(St=96,yt=0),v=1<<P-ie,_=1<<re,W=_;do _-=v,c[C+(ge>>ie)+_]=ot<<24|St<<16|yt|0;while(_!==0);for(v=1<<P-1;ge&v;)v>>=1;if(v!==0?(ge&=v-1,ge+=v):ge=0,j++,--Fe[P]==0){if(P===K)break;P=r[i+h[j]]}if(P>J&&(ge&S)!==x){for(ie===0&&(ie=J),C+=W,re=P-ie,Z=1<<re;re+ie<K&&(Z-=Fe[re+ie],!(Z<=0));)re++,Z<<=1;if(se+=1<<re,t===1&&se>852||t===2&&se>592)return 1;x=ge&S,c[x]=J<<24|re<<16|C-u|0}}return ge!==0&&(c[C+ge]=P-ie<<24|64<<16|0),f.bits=J,0};const{Z_FINISH:VW,Z_BLOCK:zye,Z_TREES:IE,Z_OK:Qu,Z_STREAM_END:Kye,Z_NEED_DICT:Yye,Z_STREAM_ERROR:Xs,Z_DATA_ERROR:BW,Z_MEM_ERROR:GW,Z_BUF_ERROR:qye,Z_DEFLATED:WW}=xE,OE=16180,PE=16190,ll=16191,zI=16192,KI=16194,DE=16199,kE=16200,YI=16206,Pr=16209,$W=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Xye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Zu=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<OE||r.mode>16211?1:0},HW=t=>{if(Zu(t))return Xs;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=OE,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Qu},zW=t=>{if(Zu(t))return Xs;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,HW(t)},KW=(t,r)=>{let i;if(Zu(t))return Xs;const s=t.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Xs:(s.window!==null&&s.wbits!==r&&(s.window=null),s.wrap=i,s.wbits=r,zW(t))},YW=(t,r)=>{if(!t)return Xs;const i=new Xye;t.state=i,i.strm=t,i.window=null,i.mode=OE;const s=KW(t,r);return s!==Qu&&(t.state=null),s};let qI,XI,qW=!0;const Jye=t=>{if(qW){qI=new Int32Array(512),XI=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(Nv(1,t.lens,0,288,qI,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;Nv(2,t.lens,0,32,XI,0,t.work,{bits:5}),qW=!1}t.lencode=qI,t.lenbits=9,t.distcode=XI,t.distbits=5},XW=(t,r,i,s)=>{let c;const u=t.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),s>=u.wsize?(u.window.set(r.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>s&&(c=s),u.window.set(r.subarray(i-s,i-s+c),u.wnext),(s-=c)?(u.window.set(r.subarray(i-s,i),0),u.wnext=s,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Qye=(t,r)=>{let i,s,c,u,h,f,g,v,_,x,S,C,U,P,j,W,K,J,re,ie,Z,se,ge=0;const Ee=new Uint8Array(4);let Fe,ht;const ot=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Zu(t)||!t.output||!t.input&&t.avail_in!==0)return Xs;i=t.state,i.mode===ll&&(i.mode=zI),h=t.next_out,c=t.output,g=t.avail_out,u=t.next_in,s=t.input,f=t.avail_in,v=i.hold,_=i.bits,x=f,S=g,se=Qu;e:for(;;)switch(i.mode){case OE:if(i.wrap===0){i.mode=zI;break}for(;_<16;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(2&i.wrap&&v===35615){i.wbits===0&&(i.wbits=15),i.check=0,Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Ai(i.check,Ee,2,0),v=0,_=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",i.mode=Pr;break}if((15&v)!==WW){t.msg="unknown compression method",i.mode=Pr;break}if(v>>>=4,_-=4,Z=8+(15&v),i.wbits===0&&(i.wbits=Z),Z>15||Z>i.wbits){t.msg="invalid window size",i.mode=Pr;break}i.dmax=1<<i.wbits,i.flags=0,t.adler=i.check=1,i.mode=512&v?16189:ll,v=0,_=0;break;case 16181:for(;_<16;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(i.flags=v,(255&fi(i))!==WW){t.msg="unknown compression method",i.mode=Pr;break}if(57344&fi(i)){t.msg="unknown header flags set",i.mode=Pr;break}i.head&&(i.head.text=v>>8&1),512&fi(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Ai(i.check,Ee,2,0)),v=0,_=0,i.mode=16182;case 16182:for(;_<32;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}i.head&&(i.head.time=v),512&fi(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,Ee[2]=v>>>16&255,Ee[3]=v>>>24&255,i.check=Ai(i.check,Ee,4,0)),v=0,_=0,i.mode=16183;case 16183:for(;_<16;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}i.head&&(i.head.xflags=255&v,i.head.os=v>>8),512&fi(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Ai(i.check,Ee,2,0)),v=0,_=0,i.mode=16184;case 16184:if(1024&fi(i)){for(;_<16;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}i.length=v,i.head&&(i.head.extra_len=v),512&fi(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Ai(i.check,Ee,2,0)),v=0,_=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&fi(i)&&(C=i.length,C>f&&(C=f),C&&(i.head&&(Z=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(u,u+C),Z)),512&fi(i)&&4&i.wrap&&(i.check=Ai(i.check,s,C,u)),f-=C,u+=C,i.length-=C),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&fi(i)){if(f===0)break e;C=0;do Z=s[u+C++],i.head&&Z&&i.length<65536&&(i.head.name+=String.fromCharCode(Z));while(Z&&C<f);if(512&fi(i)&&4&i.wrap&&(i.check=Ai(i.check,s,C,u)),f-=C,u+=C,Z)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&fi(i)){if(f===0)break e;C=0;do Z=s[u+C++],i.head&&Z&&i.length<65536&&(i.head.comment+=String.fromCharCode(Z));while(Z&&C<f);if(512&fi(i)&&4&i.wrap&&(i.check=Ai(i.check,s,C,u)),f-=C,u+=C,Z)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&fi(i)){for(;_<16;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(4&i.wrap&&v!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Pr;break}v=0,_=0}i.head&&(i.head.hcrc=fi(i)>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=ll;break;case 16189:for(;_<32;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}t.adler=i.check=$W(v),v=0,_=0,i.mode=PE;case PE:if(i.havedict===0)return t.next_out=h,t.avail_out=g,t.next_in=u,t.avail_in=f,i.hold=v,i.bits=_,Yye;t.adler=i.check=1,i.mode=ll;case ll:if(r===zye||r===IE)break e;case zI:if(i.last){v>>>=7&_,_-=7&_,i.mode=YI;break}for(;_<3;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}switch(i.last=1&v,v>>>=1,_-=1,3&v){case 0:i.mode=16193;break;case 1:if(Jye(i),i.mode=DE,r===IE){v>>>=2,_-=2;break e}break;case 2:i.mode=16196;break;case 3:t.msg="invalid block type",i.mode=Pr}v>>>=2,_-=2;break;case 16193:for(v>>>=7&_,_-=7&_;_<32;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Pr;break}if(i.length=65535&v,v=0,_=0,i.mode=KI,r===IE)break e;case KI:i.mode=16195;case 16195:if(C=i.length,C){if(C>f&&(C=f),C>g&&(C=g),C===0)break e;c.set(s.subarray(u,u+C),h),f-=C,u+=C,g-=C,h+=C,i.length-=C;break}i.mode=ll;break;case 16196:for(;_<14;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(i.nlen=257+(31&v),v>>>=5,_-=5,i.ndist=1+(31&v),v>>>=5,_-=5,i.ncode=4+(15&v),v>>>=4,_-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Pr;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;_<3;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}i.lens[ot[i.have++]]=7&v,v>>>=3,_-=3}for(;i.have<19;)i.lens[ot[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Fe={bits:i.lenbits},se=Nv(0,i.lens,0,19,i.lencode,0,i.work,Fe),i.lenbits=Fe.bits,se){t.msg="invalid code lengths set",i.mode=Pr;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;ge=i.lencode[v&(1<<i.lenbits)-1],j=ge>>>24,W=ge>>>16&255,K=65535&ge,!(j<=_);){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(K<16)v>>>=j,_-=j,i.lens[i.have++]=K;else{if(K===16){for(ht=j+2;_<ht;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(v>>>=j,_-=j,i.have===0){t.msg="invalid bit length repeat",i.mode=Pr;break}Z=i.lens[i.have-1],C=3+(3&v),v>>>=2,_-=2}else if(K===17){for(ht=j+3;_<ht;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}v>>>=j,_-=j,Z=0,C=3+(7&v),v>>>=3,_-=3}else{for(ht=j+7;_<ht;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}v>>>=j,_-=j,Z=0,C=11+(127&v),v>>>=7,_-=7}if(i.have+C>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Pr;break}for(;C--;)i.lens[i.have++]=Z}}if(i.mode===Pr)break;if(i.lens[256]===0){t.msg="invalid code -- missing end-of-block",i.mode=Pr;break}if(i.lenbits=9,Fe={bits:i.lenbits},se=Nv(1,i.lens,0,i.nlen,i.lencode,0,i.work,Fe),i.lenbits=Fe.bits,se){t.msg="invalid literal/lengths set",i.mode=Pr;break}if(i.distbits=6,i.distcode=i.distdyn,Fe={bits:i.distbits},se=Nv(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Fe),i.distbits=Fe.bits,se){t.msg="invalid distances set",i.mode=Pr;break}if(i.mode=DE,r===IE)break e;case DE:i.mode=kE;case kE:if(f>=6&&g>=258){t.next_out=h,t.avail_out=g,t.next_in=u,t.avail_in=f,i.hold=v,i.bits=_,Bye(t,S),h=t.next_out,c=t.output,g=t.avail_out,u=t.next_in,s=t.input,f=t.avail_in,v=i.hold,_=i.bits,i.mode===ll&&(i.back=-1);break}for(i.back=0;ge=i.lencode[v&(1<<i.lenbits)-1],j=ge>>>24,W=ge>>>16&255,K=65535&ge,!(j<=_);){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(W&&!(240&W)){for(J=j,re=W,ie=K;ge=i.lencode[ie+((v&(1<<J+re)-1)>>J)],j=ge>>>24,W=ge>>>16&255,K=65535&ge,!(J+j<=_);){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}v>>>=J,_-=J,i.back+=J}if(v>>>=j,_-=j,i.back+=j,i.length=K,W===0){i.mode=16205;break}if(32&W){i.back=-1,i.mode=ll;break}if(64&W){t.msg="invalid literal/length code",i.mode=Pr;break}i.extra=15&W,i.mode=16201;case 16201:if(i.extra){for(ht=i.extra;_<ht;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}i.length+=v&(1<<i.extra)-1,v>>>=i.extra,_-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;ge=i.distcode[v&(1<<i.distbits)-1],j=ge>>>24,W=ge>>>16&255,K=65535&ge,!(j<=_);){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(!(240&W)){for(J=j,re=W,ie=K;ge=i.distcode[ie+((v&(1<<J+re)-1)>>J)],j=ge>>>24,W=ge>>>16&255,K=65535&ge,!(J+j<=_);){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}v>>>=J,_-=J,i.back+=J}if(v>>>=j,_-=j,i.back+=j,64&W){t.msg="invalid distance code",i.mode=Pr;break}i.offset=K,i.extra=15&W,i.mode=16203;case 16203:if(i.extra){for(ht=i.extra;_<ht;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}i.offset+=v&(1<<i.extra)-1,v>>>=i.extra,_-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Pr;break}i.mode=16204;case 16204:if(g===0)break e;if(C=S-g,i.offset>C){if(C=i.offset-C,C>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Pr;break}C>i.wnext?(C-=i.wnext,U=i.wsize-C):U=i.wnext-C,C>i.length&&(C=i.length),P=i.window}else P=c,U=h-i.offset,C=i.length;C>g&&(C=g),g-=C,i.length-=C;do c[h++]=P[U++];while(--C);i.length===0&&(i.mode=kE);break;case 16205:if(g===0)break e;c[h++]=i.length,g--,i.mode=kE;break;case YI:if(i.wrap){for(;_<32;){if(f===0)break e;f--,v|=s[u++]<<_,_+=8}if(S-=g,t.total_out+=S,i.total+=S,4&i.wrap&&S&&(t.adler=i.check=fi(i)?Ai(i.check,c,S,h-S):_v(i.check,c,S,h-S)),S=g,4&i.wrap&&(fi(i)?v:$W(v))!==i.check){t.msg="incorrect data check",i.mode=Pr;break}v=0,_=0}i.mode=16207;case 16207:if(i.wrap&&fi(i)){for(;_<32;){if(f===0)break e;f--,v+=s[u++]<<_,_+=8}if(4&i.wrap&&v!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Pr;break}v=0,_=0}i.mode=16208;case 16208:se=Kye;break e;case Pr:se=BW;break e;case 16210:return GW;default:return Xs}return t.next_out=h,t.avail_out=g,t.next_in=u,t.avail_in=f,i.hold=v,i.bits=_,(i.wsize||S!==t.avail_out&&i.mode<Pr&&(i.mode<YI||r!==VW))&&XW(t,t.output,t.next_out,S-t.avail_out),x-=t.avail_in,S-=t.avail_out,t.total_in+=x,t.total_out+=S,i.total+=S,4&i.wrap&&S&&(t.adler=i.check=fi(i)?Ai(i.check,c,S,t.next_out-S):_v(i.check,c,S,t.next_out-S)),t.data_type=i.bits+(i.last?64:0)+(i.mode===ll?128:0)+(i.mode===DE||i.mode===KI?256:0),(x===0&&S===0||r===VW)&&se===Qu&&(se=qye),se},dl={inflateReset:zW,inflateReset2:KW,inflateResetKeep:HW,inflateInit:t=>YW(t,15),inflateInit2:YW,inflate:Qye,inflateEnd:t=>{if(Zu(t))return Xs;let r=t.state;return r.window&&(r.window=null),t.state=null,Qu},inflateGetHeader:(t,r)=>{if(Zu(t))return Xs;const i=t.state;return 2&i.wrap?(i.head=r,r.done=!1,Qu):Xs},inflateSetDictionary:(t,r)=>{const i=r.length;let s,c,u;return Zu(t)?Xs:(s=t.state,s.wrap!==0&&s.mode!==PE?Xs:s.mode===PE&&(c=1,c=_v(c,r,i,0),c!==s.check)?BW:(u=XW(t,r,i,i),u?(s.mode=16210,GW):(s.havedict=1,Qu)))},inflateInfo:"pako inflate (from Nodeca project)"},Zye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const JW=Object.prototype.toString,{Z_NO_FLUSH:e_e,Z_FINISH:t_e,Z_OK:Rv,Z_STREAM_END:JI,Z_NEED_DICT:QI,Z_STREAM_ERROR:n_e,Z_DATA_ERROR:QW,Z_MEM_ERROR:r_e}=xE;function jE(t){this.options=TE.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&!(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MW,this.strm.avail_out=0;let i=dl.inflateInit2(this.strm,r.windowBits);if(i!==Rv)throw new Error(Yu[i]);if(this.header=new Zye,dl.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=Cv.string2buf(r.dictionary):JW.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=dl.inflateSetDictionary(this.strm,r.dictionary),i!==Rv)))throw new Error(Yu[i])}function ZW(t,r){const i=new jE(r);if(i.push(t),i.err)throw i.msg||Yu[i.err];return i.result}jE.prototype.push=function(t,r){const i=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let u,h,f;if(this.ended)return!1;for(h=r===~~r?r:r===!0?t_e:e_e,JW.call(t)==="[object ArrayBuffer]"?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),u=dl.inflate(i,h),u===QI&&c&&(u=dl.inflateSetDictionary(i,c),u===Rv?u=dl.inflate(i,h):u===QW&&(u=QI));i.avail_in>0&&u===JI&&i.state.wrap>0&&t[i.next_in]!==0;)dl.inflateReset(i),u=dl.inflate(i,h);switch(u){case n_e:case QW:case QI:case r_e:return this.onEnd(u),this.ended=!0,!1}if(f=i.avail_out,i.next_out&&(i.avail_out===0||u===JI))if(this.options.to==="string"){let g=Cv.utf8border(i.output,i.next_out),v=i.next_out-g,_=Cv.buf2string(i.output,g);i.next_out=v,i.avail_out=s-v,v&&i.output.set(i.output.subarray(g,g+v),0),this.onData(_)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==Rv||f!==0){if(u===JI)return u=dl.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},jE.prototype.onData=function(t){this.chunks.push(t)},jE.prototype.onEnd=function(t){t===Rv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=TE.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var i_e={inflate:ZW,inflateRaw:function(t,r){return(r=r||{}).raw=!0,ZW(t,r)}};const{deflate:a_e,deflateRaw:s_e}=Vye,{inflate:o_e,inflateRaw:c_e}=i_e;var l_e=a_e,d_e=s_e,u_e=o_e,h_e=c_e,e$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(e$||{});class p_e{constructor(){L(this,"_sequence",0),L(this,"_startTime",Date.now()),L(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const g={id:0,length:4,data:f.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};i.commonPacketHeader.extension=1,i.extension=v,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;G("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const s=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(s),u=new DataView(s);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const f=this.serializeExtension(i.extension);c.set(new Uint8Array(f),h),h+=f.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let s=0;const c=i.getUint16(s,!0);s+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(s+2,!0)<<16|i.getUint16(s,!0)};let h,f;if(s+=4,G("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(s,!0),s+=2,u.extension){f=this.deserializeExtension(r.slice(s)),s+=2+f.length,h=r.slice(s);let g=!1;if(f.datas.length>0){const v=f.datas.find(_=>_.id===0);v&&(g=(1&new DataView(v.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:i,length:s,datas:c}=r,u=new ArrayBuffer(s+2),h=new Uint8Array(u),f=new DataView(u);let g=0;if(f.setUint8(g++,i),f.setUint8(g++,s),c.forEach(v=>{i?(f.setUint8(g++,v.id),f.setUint8(g++,v.length),h.set(new Uint8Array(v.data),g),g+=v.data.byteLength):(f.setUint8(g++,v.id|v.length<<4),h.set(new Uint8Array(v.data),g),g+=v.data.byteLength)}),g!==s+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(s+2));return u}deserializeExtension(r){const i=new DataView(r);let s=0;const c=i.getUint8(s);s++;const u=i.getUint8(s);s++;const h=c===e$.TWO_BYTE,f=[],g=new DataView(r,2);let v=0;for(;v<u;){let _=0,x=0,S=new ArrayBuffer(0);h?(_=g.getUint8(v),v++,x=g.getUint8(v),v++):(_=15&g.getUint8(v),x=g.getUint8(v)>>4,v++),x>0&&(S=g.buffer.slice(v+2,v+2+x),v+=S.byteLength),f.push({id:_,length:x,data:S})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:f}}decompress(r){return u_e(new Uint8Array(r))}compress(r){return l_e(new Uint8Array(r))}}const f_e={name:"DataStream",create:(t,r)=>{const i=r?new yge(t):new _ge(t);return i.useDataStream(new p_e),i}};class m_e extends An{constructor(r,i,s){super(),L(this,"ws",void 0),L(this,"requestId",1),L(this,"heartBeatTimer",void 0),L(this,"joinInfo",void 0),L(this,"clientId",void 0),L(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),L(this,"onClose",c=>{this.emit("close"),this.dispose()}),L(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=i,this.ws=new Qg("cross-channel-".concat(this.clientId),s),this.ws.on(_t.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(_t.CONNECTED,this.onOpen),this.ws.on(_t.ON_MESSAGE,this.onMessage),this.ws.on(_t.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new De((i,s)=>{const c=window.setTimeout(()=>{s(new ce($.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?s(new ce($.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new ce($.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new ce($.WS_DISCONNECT);const i=()=>new De((h,f)=>{this.ws.once(_t.CLOSED,()=>f(new ce($.WS_ABORT))),this.ws.once(_t.CONNECTED,h)});this.ws.state!=="connected"&&await i();const s=this.sendMessage(r),c=new De((h,f)=>{const g=()=>{f(new ce($.WS_ABORT))};this.ws.once(_t.RECONNECTING,g),this.ws.once(_t.CLOSED,g),this.once("req_".concat(s),h),yr(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(_t.RECONNECTING,g),this.ws.off(_t.CLOSED,g),f(new ce($.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new ce($.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(_t.REQUEST_NEW_URLS),this.ws.on(_t.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class g_e extends An{set state(r){r!==this._state&&(r!==Zi.RELAY_STATE_FAILURE&&(this.errorCode=qp.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,s,c,u){super(),L(this,"joinInfo",void 0),L(this,"sid",void 0),L(this,"clientId",void 0),L(this,"cancelToken",Mi.CancelToken.source()),L(this,"workerToken",void 0),L(this,"requestId",0),L(this,"signal",void 0),L(this,"prevChannelMediaConfig",void 0),L(this,"httpRetryConfig",void 0),L(this,"_resolution",void 0),L(this,"_state",Zi.RELAY_STATE_IDLE),L(this,"errorCode",qp.RELAY_OK),L(this,"onStatus",h=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",al.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",al.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=qp.SRC_TOKEN_EXPIRED,this.state=Zi.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=qp.DEST_TOKEN_EXPIRED,this.state=Zi.RELAY_STATE_FAILURE))}),L(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",al.NETWORK_DISCONNECTED),this.state=Zi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Zi.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",h.toString()),this.errorCode=qp.SERVER_CONNECTION_LOST,this.state=Zi.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=Au(),this.signal=new m_e(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Zi.RELAY_STATE_IDLE)throw new ce($.INVALID_OPERATION);this.state=Zi.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new ce($.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new ce($.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new ce($.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Zi.RELAY_STATE_RUNNING)throw new ce($.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Zi.RELAY_STATE_RUNNING)throw new ce($.INVALID_OPERATION);const i=this.genMessage(Vi.SetVideoProfile);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Zi.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Mi.CancelToken.source(),this.state=Zi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Sve(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",al.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(Vi.SetSdkProfile,r);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Vi.SetSourceChannel,r);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",al.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const c=this.genMessage(Vi.SetSourceUserId,r);await this.signal.request(c),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const u=this.genMessage(Vi.SetDestChannel,r);await this.signal.request(u),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",al.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const h=this.genMessage(Vi.StartPacketTransfer,r);await this.signal.request(h),this.emit("event",al.PACKET_SENT_TO_DEST_CHANNEL),this.state=Zi.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(Vi.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",al.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Vi.StopPacketTransfer);await this.signal.request(r),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const s=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:os,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.2"&&(h.sdkVersion="0.0.1");let f=null,g=null;switch(r){case Vi.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Vi.SetSourceChannel:if(g=i&&i.getSrcChannelMediaInfo(),!g)throw new ce($.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case Vi.SetSourceUserId:if(g=i&&i.getSrcChannelMediaInfo(),!g)throw new ce($.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case Vi.SetDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new ce($.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{s.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:u},h;case Vi.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Vi.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Vi.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Vi.UpdateDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new ce($.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{s.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:u},h;case Vi.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const v_e={name:"ChannelMediaRelay",create:function(t){return new g_e(t.joinInfo,t.clientId,t.websocketRetryConfig||Yn,t.httpRetryConfig||Yn,t.resolution)}};function t$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Av(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?t$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):t$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class y_e extends An{constructor(r,i,s,c){super(),L(this,"spec",void 0),L(this,"token",void 0),L(this,"websocket",void 0),L(this,"pingpongTimer",void 0),L(this,"reconnectMode","retry"),L(this,"serviceMode",void 0),L(this,"reqId",0),L(this,"commandReqId",0),L(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),L(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):($e.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===il.TRANSCODE?1:2}),this.emit(id.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new Qg("live-streaming",s),this.websocket.on(_t.CONNECTED,this.handleWebSocketOpen),this.websocket.on(_t.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(_t.REQUEST_NEW_URLS,(u,h)=>{er(this,id.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(_t.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,s,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new ce($.UNEXPECTED_ERROR);const f=Av({command:r,sdkVersion:os==="4.24.2"?"0.0.1":os,seq:h,requestId:h,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new ce($.WS_DISCONNECT);const g=()=>new De((S,C)=>{this.websocket.once(_t.CLOSED,()=>C(new ce($.WS_ABORT))),this.websocket.once(_t.CONNECTED,S)});this.websocket.state!=="connected"&&await g(),f.clientRequest&&(f.clientRequest.workerToken=this.token);const v=new De((S,C)=>{const U=()=>{C(new ce($.WS_ABORT))};this.websocket.once(_t.RECONNECTING,U),this.websocket.once(_t.CLOSED,U),this.once("@".concat(h,"-").concat(this.spec.sid),P=>{S(P)})});c&&$e.workerEvent(this.spec.sid,Av(Av({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(f);let x=null;try{x=await v}catch(S){if(this.websocket.state==="closed")throw S;return await g(),await this.request(r,i,s)}return c&&$e.workerEvent(this.spec.sid,Av(Av({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(x.serverResponse),serverCode:x.code,success:x.code===200,responseTime:Date.now()-_})),x.code!==200&&this.handleResponseError(x),x}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=os==="4.24.2"?"0.0.1":os;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case cr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case cr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case cr.LIVE_STREAM_RESPONSE_BAD_STREAM:case cr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ce($.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new ce($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ce($.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new ce($.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(id.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new ce($.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(id.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ce($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ce($.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new ce($.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(id.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ce($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ce($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new ce($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new ce($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new ce($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ce($.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch($g)},6e3)}}function n$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ta(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?n$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class __e extends An{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yn,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Yn;super(),L(this,"onLiveStreamWarning",void 0),L(this,"onLiveStreamError",void 0),L(this,"spec",void 0),L(this,"retryTimeout",1e4),L(this,"connection",void 0),L(this,"httpRetryConfig",void 0),L(this,"wsRetryConfig",void 0),L(this,"streamingTasks",new Map),L(this,"isStartingStreamingTask",!1),L(this,"taskMutex",new Rr("live-streaming")),L(this,"cancelToken",Mi.CancelToken.source()),L(this,"transcodingConfig",void 0),L(this,"uapResponse",void 0),L(this,"lastTaskId",1),L(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=s,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=ta(ta({},nve),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>ta(ta(ta({},tve),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){kn(h.width)||cn(h.width,"config.width",0,1e4),kn(h.height)||cn(h.height,"config.height",0,1e4),kn(h.videoBitrate)||cn(h.videoBitrate,"config.videoBitrate",1,1e6),kn(h.videoFrameRate)||cn(h.videoFrameRate,"config.videoFrameRate"),kn(h.lowLatency)||Us(h.lowLatency,"config.lowLatency"),kn(h.audioSampleRate)||Kn(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),kn(h.audioBitrate)||cn(h.audioBitrate,"config.audioBitrate",1,128),kn(h.audioChannels)||Kn(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),kn(h.videoGop)||cn(h.videoGop,"config.videoGop"),kn(h.videoCodecProfile)||Kn(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),kn(h.userCount)||cn(h.userCount,"config.userCount",0,17),kn(h.backgroundColor)||cn(h.backgroundColor,"config.backgroundColor",0,16777215),kn(h.userConfigExtraInfo)||Mr(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!kn(h.transcodingUsers)&&(nl(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((f,g)=>{Hb(f.uid),kn(f.x)||cn(f.x,"transcodingUser[".concat(g,"].x"),0,1e4),kn(f.y)||cn(f.y,"transcodingUser[".concat(g,"].y"),0,1e4),kn(f.width)||cn(f.width,"transcodingUser[".concat(g,"].width"),0,1e4),kn(f.height)||cn(f.height,"transcodingUser[".concat(g,"].height"),0,1e4),kn(f.zOrder)||cn(f.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),kn(f.alpha)||cn(f.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),kn(h.watermark)||GA(h.watermark,"watermark"),kn(h.backgroundImage)||GA(h.backgroundImage,"backgroundImage"),h.images&&!kn(h.images)&&(nl(h.images,"config.images"),h.images.forEach((f,g)=>{GA(f,"images[".concat(g,"]"))}))}(i);const s=[];i.images&&s.push(...i.images.map(h=>ta(ta(ta({},BA),h),{},{zOrder:255}))),i.backgroundImage&&(s.push(ta(ta(ta({},BA),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(s.push(ta(ta(ta({},BA),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=s,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>ta({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?De.resolve(h.uid):x8(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await De.all(c)).forEach((h,f)=>{i.userConfigs&&i.userConfigs[f]&&(i.userConfigs[f].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ya(u=this.streamingTasks).call(u)).map(f=>f.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(f=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,h).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(f.url," success"))}).catch(g=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),f.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,g)})})}}async startLiveStreamingTask(r,i,s){if(!this.transcodingConfig&&i===il.TRANSCODE)throw new ce($.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&s)return void u();if(this.streamingTasks.get(r)&&!s)return u(),new ce($.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(f){throw u(),f}switch(i){case il.TRANSCODE:c.transcodingConfig=ta({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const f=new De((v,_)=>{yr(this.retryTimeout).then(()=>{if(s)return _(s);const x=this.statusError.get(r);return x?(this.statusError.delete(r),_(x)):void 0})}),g=await De.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===il.TRANSCODE?1:2,requestByUser:!s,tid:h.toString()}),f]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:h}),u()}catch(f){if(u(),this.isStartingStreamingTask=!1,!f.data||!f.data.retry||s)throw f;return f.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,f)):await this.startLiveStreamingTask(r,i,f)}}stopLiveStreamingTask(r){return new De((i,s)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new ce($.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===il.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(s)})}resetAllTask(){var r;const i=Array.from(ya(r=this.streamingTasks).call(r));this.terminate();for(const s of i)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Mi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new ce($.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await er(this,WA.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new y_e(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(id.WARNING,(s,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,s)),this.connection.on(id.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(id.REQUEST_NEW_ADDRESS,(s,c)=>{if(!this.connection)return c(new ce($.UNEXPECTED_ERROR,"can not get new live streaming address list"));er(this,WA.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,s(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",s=this.streamingTasks.get(i),c=r.reason;switch(r.code){case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new ce($.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(s)return R.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new ce($.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(ya(u=this.streamingTasks).call(u));for(const f of h)f.abortTask?f.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new ce($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(g=>{R.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,g)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const b_e={name:"LiveStreaming",create:function(t){return new __e(t.joinInfo,t.websocketRetryConfig||Yn,t.httpRetryConfig||Yn)}};function E_e(t){let r=a$();return function(i,s){let c=i.appId;c!==void 0&&(nn(s,10),Ac(s,c));let u=i.cid;u!==void 0&&(nn(s,16),nn(s,u));let h=i.cname;h!==void 0&&(nn(s,26),Ac(s,h));let f=i.deviceId;f!==void 0&&(nn(s,34),Ac(s,f));let g=i.elapse;g!==void 0&&(nn(s,40),vd(s,g));let v=i.fileSize;v!==void 0&&(nn(s,48),vd(s,ff(v)));let _=i.height;_!==void 0&&(nn(s,56),vd(s,ff(_)));let x=i.jpg;x!==void 0&&(nn(s,66),nn(s,x.length),function(Cn,ve){let Oe=mf(Cn,ve.length);Cn.bytes.set(ve,Oe)}(s,x));let S=i.networkType;S!==void 0&&(nn(s,72),vd(s,ff(S)));let C=i.osType;C!==void 0&&(nn(s,80),vd(s,ff(C)));let U=i.requestId;U!==void 0&&(nn(s,90),Ac(s,U));let P=i.sdkVersion;P!==void 0&&(nn(s,98),Ac(s,P));let j=i.sequence;j!==void 0&&(nn(s,104),vd(s,ff(j)));let W=i.sid;W!==void 0&&(nn(s,114),Ac(s,W));let K=i.timestamp;K!==void 0&&(nn(s,120),vd(s,K));let J=i.uid;J!==void 0&&(nn(s,128),nn(s,J));let re=i.vid;re!==void 0&&(nn(s,136),nn(s,re));let ie=i.width;ie!==void 0&&(nn(s,144),vd(s,ff(ie)));let Z=i.service;Z!==void 0&&(nn(s,152),nn(s,Z));let se=i.callbackData;se!==void 0&&(nn(s,162),Ac(s,se));let ge=i.jpgEncryption;ge!==void 0&&(nn(s,168),nn(s,ge));let Ee=i.requestType;Ee!==void 0&&(nn(s,176),nn(s,Ee));let Fe=i.scorePorn;Fe!==void 0&&(nn(s,185),rO(s,Fe));let ht=i.scoreSexy;ht!==void 0&&(nn(s,193),rO(s,ht));let ot=i.scoreNeutral;ot!==void 0&&(nn(s,201),rO(s,ot));let St=i.scene;St!==void 0&&(nn(s,208),nn(s,St));let yt=i.ossFilePrefix;yt!==void 0&&(nn(s,218),Ac(s,yt));let Yt=i.serviceVendor;if(Yt!==void 0)for(let Cn of Yt){nn(s,226);let ve=a$();w_e(Cn,ve),nn(s,ve.limit),R_e(s,ve),N_e(ve)}}(t,r),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(r)}function x_e(t){return function(i){let s={};e:for(;!s$(i);){let c=Ic(i);switch(c>>>3){case 0:break e;case 1:s.code=Ic(i);break;case 2:s.msg=o$(i,Ic(i));break;case 3:{let u=T_e(i);s.data=S_e(i),i.limit=u;break}default:r$(i,7&c)}}return s}({bytes:r=t,offset:0,limit:r.length});var r}function S_e(t){let r={};e:for(;!s$(t);){let i=Ic(t);switch(i>>>3){case 0:break e;case 1:r.requestId=o$(t,Ic(t));break;case 2:r.requestType=Ic(t)>>>0;break;case 3:r.scorePorn=nO(t);break;case 4:r.scoreSexy=nO(t);break;case 5:r.scoreNeutral=nO(t);break;case 6:r.requestScene=Ic(t)>>>0;break;case 7:r.scene=Ic(t)>>>0;break;default:r$(t,7&i)}}return r}function w_e(t,r){let i=t.service;i!==void 0&&(nn(r,8),nn(r,i));let s=t.vendor;s!==void 0&&(nn(r,16),nn(r,s));let c=t.token;c!==void 0&&(nn(r,26),Ac(r,c));let u=t.callbackUrl;u!==void 0&&(nn(r,34),Ac(r,u))}function T_e(t){let r=Ic(t),i=t.limit;return t.limit=t.offset+r,i}function r$(t,r){switch(r){case 0:for(;128&c$(t););break;case 2:eO(t,Ic(t));break;case 5:eO(t,4);break;case 1:eO(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let C_e=new Float32Array(1);new Uint8Array(C_e.buffer);let ZI=new Float64Array(1),na=new Uint8Array(ZI.buffer);function ff(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let i$=[];function a$(){const t=i$.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function N_e(t){i$.push(t)}function eO(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function s$(t){return t.offset>=t.limit}function mf(t,r){let i=t.bytes,s=t.offset,c=t.limit,u=s+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),s}function tO(t,r){let i=t.offset;if(i+r>t.limit)throw new Error("Read past limit");return t.offset+=r,i}function o$(t,r){let i=tO(t,r),s=String.fromCharCode,c=t.bytes,u="",h="";for(let f=0;f<r;f++){let g,v,_,x,S=c[f+i];128&S?(224&S)==192?f+1>=r?h+=u:(g=c[f+i+1],(192&g)!=128?h+=u:(x=(31&S)<<6|63&g,x<128?h+=u:(h+=s(x),f++))):(240&S)==224?f+2>=r?h+=u:(g=c[f+i+1],v=c[f+i+2],(49344&(g|v<<8))!=32896?h+=u:(x=(15&S)<<12|(63&g)<<6|63&v,x<2048||x>=55296&&x<=57343?h+=u:(h+=s(x),f+=2))):(248&S)==240?f+3>=r?h+=u:(g=c[f+i+1],v=c[f+i+2],_=c[f+i+3],(12632256&(g|v<<8|_<<16))!=8421504?h+=u:(x=(7&S)<<18|(63&g)<<12|(63&v)<<6|63&_,x<65536||x>1114111?h+=u:(x-=65536,h+=s(55296+(x>>10),56320+(1023&x)),f+=3))):h+=u:h+=s(S)}return h}function Ac(t,r){let i=r.length,s=0;for(let h=0;h<i;h++){let f=r.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+r.charCodeAt(++h)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}nn(t,s);let c=mf(t,s),u=t.bytes;for(let h=0;h<i;h++){let f=r.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+r.charCodeAt(++h)-56613888),f<128?u[c++]=f:(f<2048?u[c++]=f>>6&31|192:(f<65536?u[c++]=f>>12&15|224:(u[c++]=f>>18&7|240,u[c++]=f>>12&63|128),u[c++]=f>>6&63|128),u[c++]=63&f|128)}}function R_e(t,r){let i=mf(t,r.limit),s=t.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)s[u+i]=c[u]}function c$(t){return t.bytes[tO(t,1)]}function l$(t,r){let i=mf(t,1);t.bytes[i]=r}function nO(t){let r=tO(t,8),i=t.bytes;return na[0]=i[r++],na[1]=i[r++],na[2]=i[r++],na[3]=i[r++],na[4]=i[r++],na[5]=i[r++],na[6]=i[r++],na[7]=i[r++],ZI[0]}function rO(t,r){let i=mf(t,8),s=t.bytes;ZI[0]=r,s[i++]=na[0],s[i++]=na[1],s[i++]=na[2],s[i++]=na[3],s[i++]=na[4],s[i++]=na[5],s[i++]=na[6],s[i++]=na[7]}function Ic(t){let r,i=0,s=0;do r=c$(t),i<32&&(s|=(127&r)<<i),i+=7;while(128&r);return s}function nn(t,r){for(r>>>=0;r>=128;)l$(t,127&r|128),r>>>=7;l$(t,r)}function vd(t,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=mf(t,u),f=t.bytes;switch(u){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=u!==9?128|c:127&c;case 8:f[h+7]=u!==8?s>>>21|128:s>>>21&127;case 7:f[h+6]=u!==7?s>>>14|128:s>>>14&127;case 6:f[h+5]=u!==6?s>>>7|128:s>>>7&127;case 5:f[h+4]=u!==5?128|s:127&s;case 4:f[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:f[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:f[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:f[h]=u!==1?128|i:127&i}}function d$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}const A_e=new Map([["moderation",1],["supervise",2]]);class I_e extends An{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Ir.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=as(i=r.map(s=>A_e.get(s)||0)).call(i,(s,c)=>s+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),L(this,"name","AgoraRTCVideoContentInspect"),L(this,"_connectionState",Ws.CONNECTING),L(this,"_innerConnectionState",void 0),L(this,"sequence",0),L(this,"inspectStartTime",void 0),L(this,"workerManagerConnection",void 0),L(this,"workerConnection",void 0),L(this,"workerMessageLengthLimit",void 0),L(this,"inspectIntervalMinimum",void 0),L(this,"qualityRatio",void 0),L(this,"_connectInfo",void 0),L(this,"_cancelTokenSource",Mi.CancelToken.source()),L(this,"_retryConfig",void 0),L(this,"wmSequence",0),L(this,"inspectInterval",void 0),L(this,"inspectTimer",null),L(this,"ossFilePrefix",void 0),L(this,"extraInfo",void 0),L(this,"_inspectType",void 0),L(this,"_inspectMode",void 0),L(this,"_quality",1),L(this,"qualityTimer",null),L(this,"_inspectId",void 0),L(this,"_needWorkUrlOnly",!1),L(this,"inspectImage",()=>{if(this.connectionState!==Ws.CONNECTED)throw new ce($.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ws.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Zt(5,"inspect-"),this.workerMessageLengthLimit=G("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=G("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=G("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Qg("worker-manager-"+this._inspectId,Yn),this.on(Ir.STATE_CHANGE,(i,s)=>{this._innerConnectionState=i,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat($s[i]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Qg("worker-"+this._inspectId,Yn),this.handleWorkerEvents()}async init(r,i){this.emit(Ir.STATE_CHANGE,$s.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=i,new De((c,u)=>{this.on(Ir.CONNECTION_STATE_CHANGE,(h,f)=>{f===Ws.CONNECTED&&c()}),this.requestAP(r,s,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,i,s){const c=G("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),u=await function(f,g,v,_){let{appId:x,areaCode:S,cname:C,sid:U,token:P,uid:j}=g;tf++;const W="image_moderation_api",K={service_name:W,json_body:JSON.stringify({appId:x,areaCode:S,cname:C,command:"allocateEdge",requestId:tf,seq:tf,sid:U,token:P,ts:Date.now(),uid:j+""})};let J,re,ie=f[0];return Ro(async()=>{J=Date.now();const Z=await ko(ie,{data:K,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(re=Date.now()-J,Z.code!==0){const ot=new ce($.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Z.code,{retry:!0,responseTime:re});throw R.error(ot.toString()),ot}const se=JSON.parse(Z.json_body);if(se.code!==200){const ot=new ce($.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(se.code,", reason: ").concat(se.reason),{code:se.code,responseTime:re});throw R.error(ot.toString()),ot}if(!se.servers||!Array.isArray(se.servers)||se.servers.length===0){const ot=new ce($.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:se.code,responseTime:re});throw R.error(ot.toString()),ot}const ge=G("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(ge)return{addressList:[ge],workerToken:se.workerToken,vid:se.vid,responseTime:re};const Ee=G("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Fe=G("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:se.servers.map(ot=>{let{address:St,wss:yt}=ot;if(St&&yt)return"wss://".concat(St.replace(/\./g,"-"),".").concat(Ee,":").concat(Fe||yt)}).filter(ot=>!!ot),workerToken:se.workerToken,vid:se.vid,responseTime:re}},(Z,se)=>($e.apworkerEvent(U,{success:!0,sc:200,serviceName:W,responseDetail:JSON.stringify(Z.addressList),firstSuccess:se===0,responseTime:re,serverIp:f[se%f.length]}),!1),(Z,se)=>($e.apworkerEvent(U,{success:!1,sc:Z.data&&Z.data.code||200,serviceName:W,responseTime:re,serverIp:f[se%f.length]}),!!(Z.code!==$.OPERATION_ABORTED&&Z.code!==$.UNEXPECTED_RESPONSE||Z.data&&Z.data.retry)&&(ie=f[(se+1)%f.length],!0)),_)}(c,r,i,s);this.emit(Ir.STATE_CHANGE,$s.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Ir.STATE_CHANGE,$s.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(_t.CONNECTED,async()=>{this.emit(Ir.STATE_CHANGE,$s.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(_t.CLOSED,()=>{this._innerConnectionState<$s.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(_t.FAILED,()=>{this._innerConnectionState<$s.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(_t.RECONNECTING,()=>{this._innerConnectionState<$s.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(_t.ON_MESSAGE,async r=>{this.emit(Ir.STATE_CHANGE,$s.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(r.data);if(s.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new ce($.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&i))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new ce($.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const c=G("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Ir.STATE_CHANGE,$s.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Ir.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(_t.WILL_RECONNECT,(r,i,s)=>{s(r)}),this.workerManagerConnection.on(_t.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(_t.CONNECTED,async()=>{this.emit(Ir.STATE_CHANGE,$s.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ws.CONNECTED}),this.workerConnection.on(_t.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=x_e(new Uint8Array(r.data));if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ir.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var i;const c={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},u=as(i=Object.keys(c)).call(i,(f,g)=>c[f]>c[g]?f:g,"porn"),h=Object.keys(c).find(f=>f===u);this.emit(Ir.INSPECT_RESULT,h)}else this.emit(Ir.INSPECT_RESULT,void 0,new ce($.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(Ir.INSPECT_RESULT,void 0,new ce($.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ir.INSPECT_RESULT,void 0,new ce($.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(_t.CLOSED,()=>{this.connectionState=Ws.CLOSED}),this.workerConnection.on(_t.FAILED,()=>{this.connectionState=Ws.CLOSED}),this.workerConnection.on(_t.RECONNECTING,()=>{this.connectionState=this.connectionState===Ws.CONNECTED?Ws.RECONNECTING:Ws.CONNECTING}),this.workerConnection.on(_t.WILL_RECONNECT,(r,i,s)=>{r==="recover"&&s(r),s("tryNext")}),this.workerConnection.on(_t.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(Ir.REQUEST_NEW_WORKER_URL,s=>{r([s])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s=>{this.connectWorkerManager(s,!0)}).catch(s=>{i(s)})})}async requestToInspectImage(){this.sequence++;const r=Ea(this,Ir.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(Ir.INSPECT_RESULT,void 0,new ce($.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(r,i);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(Ir.INSPECT_RESULT,void 0,new ce($.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:s,cname:c,cid:u,vid:h,sid:f,uid:g}=i;const v=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),x=await FV(_,s,c),S=this.sequence+"-"+u+"-"+g+"-"+v+"-"+Zt(12,""),C={appId:s,cid:u,cname:c,deviceId:"",elapse:(U=Number(v-this.inspectStartTime),{low:U|=0,high:U>>31,unsigned:U>=0}),fileSize:x.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:x,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.2",sequence:this.sequence,sid:f,timestamp:fG(v),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var U;this.extraInfo===void 0&&delete C.callbackData,this.ossFilePrefix===void 0&&delete C.ossFilePrefix;const P=E_e(C);if(P.byteLength<this.workerMessageLengthLimit){if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(W){for(var K=1;K<arguments.length;K++){var J=arguments[K]!=null?arguments[K]:{};K%2?d$(Object(J),!0).forEach(function(re){L(W,re,J[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(J)):d$(Object(J)).forEach(function(re){Object.defineProperty(W,re,Object.getOwnPropertyDescriptor(J,re))})}return W}({},C);delete j.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return P}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:s,cname:c,cid:u,vid:h,sid:f,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ws.CLOSED,this.emit(Ir.STATE_CHANGE,$s.CLOSED)}}const O_e={name:"ContentInspect",create:function(t){let{config:r}=t;return function(i){if(!i)throw new ce($.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new ce($.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const s=[...new Set(i.inspectType)];s.forEach(c=>{var u;if(!Te(u=["supervise","moderation"]).call(u,c))throw new ce($.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=s}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new ce($.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new I_e(r)}};var u$=d(Wt.Object.getOwnPropertySymbols),P_e=Qt,D_e=JT.indexOf,k_e=H_,iO=oe([].indexOf),h$=!!iO&&1/iO([1],1,-0)<0;P_e({target:"Array",proto:!0,forced:h$||!k_e("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return h$?iO(this,t,r)||0:D_e(this,t,r)}});var j_e=is("Array","indexOf"),L_e=N,M_e=j_e,aO=Array.prototype,U_e=function(t){var r=t.indexOf;return t===aO||L_e(aO,t)&&r===aO.indexOf?M_e:r},p$=d(U_e);function F_e(t,r){if(t==null)return{};var i,s,c=function(h,f){if(h==null)return{};var g={};for(var v in h)if({}.hasOwnProperty.call(h,v)){if(p$(f).call(f,v)!==-1)continue;g[v]=h[v]}return g}(t,r);if(u$){var u=u$(t);for(s=0;s<u.length;s++)i=u[s],p$(r).call(r,i)===-1&&{}.propertyIsEnumerable.call(t,i)&&(c[i]=t[i])}return c}let f$=class{get localCapabilities(){return En(this._localCapabilities)}get rtpCapabilities(){return En(this._rtpCapabilities)}get candidates(){return En(this._candidates)}get iceParameters(){return En(this._iceParameters)}get dtlsParameters(){return En(this._dtlsParameters)}constructor(t){L(this,"sessionDesc",void 0),L(this,"_localCapabilities",void 0),L(this,"_rtpCapabilities",void 0),L(this,"_candidates",void 0),L(this,"_iceParameters",void 0),L(this,"_dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname","o/i14u9pJrxRKAsu"),L(this,"firefoxSsrcMidMap",new Map),t=En(t);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:f,videoCodec:g,audioCodec:v}=t;let _;this.setup=f,_=h===Ri.RECEIVE_ONLY?Ti(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ti(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=s,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u;const x=h===Ri.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=h===Ri.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=h===Ri.RECEIVE_ONLY?c.send.videoCodecs:iv(Ge.VIDEO,x,S,g),U=h===Ri.RECEIVE_ONLY?c.send.audioCodecs:iv(Ge.AUDIO,x,S,v);for(const P of _.mediaDescriptions)P.attributes.iceUfrag=r.iceUfrag,P.attributes.icePwd=r.icePwd,P.attributes.fingerprints=i.fingerprints,P.attributes.candidates=s,P.attributes.setup=this.setup,P.media.mediaType==="application"&&(P.attributes.sctpPort="5000"),P.media.mediaType==="video"&&(P.media.fmts=C.map(j=>j.payloadType.toString(10)),P.attributes.payloads=C,P.attributes.extmaps=x.videoExtensions),P.media.mediaType==="audio"&&(P.media.fmts=U.map(j=>j.payloadType.toString(10)),P.attributes.payloads=U,P.attributes.extmaps=x.audioExtensions,ef(P));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return rl(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,i,s,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=nv(r,this.cname,G("SYNC_GROUP")?i:void 0),f=this.findPreloadMediaDesc(u);if(f){if(bn()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,f.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(f,c),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(t,u,s);let v;return g===-1?(v=this.createOrRecycleSendMedia(t,u,h,"sendonly",s,c),this.updateBundleMids()):(v=En(this.sessionDesc.mediaDescriptions[g]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(v,c)),bn()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,i){const s=[];return t.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let f,g=!1;h===-1?(g=!0,f=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(f=En(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="recvonly"),s.push({mid:f.attributes.mid,needCreateTransceiver:g})}),s}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:i,address:s,port:c,type:u,relatedAddress:h,relatedPort:f,priority:g}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:i??"",priority:g?g+"":"",connectionAddress:s??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:f?f+"":"",extension:{}};this.candidates.some(_=>_.priority===v.priority&&_.connectionAddress===v.connectionAddress&&_.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,i,s,c){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=iv(u,h,this.localCapabilities.send,u===Ge.AUDIO?c:s),g=u===Ge.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let _={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};_=this.mungRecvMediaDsec(_,t);const x=this.findFirstClosedMedia(u);if(x){const S=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Te(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Te(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===t&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(bn()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!u||u!==s.attributes.mid)}return!1}return c&&s.attributes.mid===i})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(t){t=En(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,i,s,c,u){const h=this.rtpCapabilities.send,f=t===Ge.VIDEO?h.videoCodecs:h.audioCodecs,g=t===Ge.VIDEO?h.videoExtensions:h.audioExtensions;bn()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(x=>x.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const _=this.findFirstClosedMedia(t);if(_){const x=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[x]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,i){const s=En(t);return JA(s),Gu(s,r),QA(s,r),i8(s),eE(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){const i=En(t);return eE(i,r,this.localCapabilities.recv),ef(i),i}updateRecvMedia(t,r){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>bn()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const V_e=["sdp"];var xn;function m$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function yd(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?m$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let g$=(xn=class wf extends V6{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,s){super(r,i),L(this,"direction",void 0),L(this,"name",void 0),L(this,"store",void 0),L(this,"spec",void 0),L(this,"peerConnection",void 0),L(this,"initialOffer",void 0),L(this,"transport",void 0),L(this,"statsFilter",void 0),L(this,"localCandidateCount",0),L(this,"_isInRestartIce",!1),L(this,"mutex",void 0),L(this,"onLocalCandidate",void 0),L(this,"remoteSDP",void 0),L(this,"pendingCandidates",[]),L(this,"localCapabilities",void 0),L(this,"isReady",!1),L(this,"restartCnt",0),L(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new Rr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(wf.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??Ri.SEND_ONLY,this.name=this.direction===Ri.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=xb(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,bn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await eI();if(this.localCapabilities=rv(i),r){const{sdp:s}=r,c=F_e(r,V_e),u=function(){const _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},x=tv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zs(x,_,"videoExtensions",S,C,U),zs(x,_,"videoCodecs",S,C,U),zs(x,_,"audioExtensions",S,C,U),zs(x,_,"audioCodecs",S,C,U),G("RAISE_H264_BASELINE_PRIORITY")){const P=U.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(P!==-1){const j=U.videoCodecs.findIndex(W=>W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<P){R.debug("raising H264 baseline profile priority");const W=U.videoCodecs[P];U.videoCodecs.splice(P,1),U.videoCodecs.splice(j,0,W)}j!==-1&&G("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(W=>!(W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W.fmtp&&W.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:C,sendrecv:U}}({},{},s);this.remoteSDP=new f$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const f=Ec(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await s8({},{},h.sdp);this.localCapabilities=rv(g);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),yd(yd({},f),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ec(s.sdp);return this.initialOffer=s,yd(yd({},c),{},{sdp:s.sdp})}}catch(i){throw new pe($.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:s,dtlsParameters:c}=r,u=await s8({},{},i);this.remoteSDP=new f$({remoteIceParameters:s,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new pe($.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Li(function*(){const u=yield Tt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=c.remoteSDP.receive(r,i,s);r.forEach((j,W)=>{if(f[W].needCreateTransceiver){const K=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});h.push(K),j._updateRtpTransceiver(K)}else{const K=c.peerConnection.getTransceivers().find(J=>J.mid===f[W].mid);if(!K)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[W].mid));h.push(K),j._updateRtpTransceiver(K)}}),bn()&&G("SIMULCAST")===!0&&(yield Tt(c.applySimulcastForFirefox(h,r)));const g=f.map(j=>j.mid),v=yield Tt(c.peerConnection.createOffer()),_=c.mungSendOfferSDP(v.sdp,r,g),x=Ti(_),S=g.map(j=>{const W=x.mediaDescriptions.find(K=>K.attributes.mid===j);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return XA(W,G("USE_PUB_RTX"))}),C=h.map((j,W)=>{const K=g[W];return{localSSRC:S[W],id:K}});yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield C}catch(j){const W=c.remoteSDP.toString();throw yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Tt(c.stopSending(g,!0)),j}yield Tt(c.applySimulcastEncodings(h,r)),yield Tt(c.applySendEncodings(h,r));const U=c.remoteSDP.toString(),P=c.logSDPExchange(_,"offer","local","send");return P==null||P(U),yield Tt(c.setRemoteDescription({type:"answer",sdp:U})),h.map((j,W)=>{const K=g[W];return{localSSRC:S[W],id:K}})}catch(h){throw h instanceof pe?h:new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var v;g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const f=this.remoteSDP.toString();h==null||h(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,s,c);if(h){const g=this.remoteSDP.toString(),v=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const _=await this.peerConnection.createAnswer(),x=this.mungReceiveAnswerSDP(_.sdp,u,r);v==null||v(x||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:x}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const f=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!f||f.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,transceiver:f}}catch(u){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,s,c);if(h){const f=this.remoteSDP.toString(),g=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});const v=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(v.sdp,u,r);g==null||g(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===Iu.Auto&&(this.store.p2pTransport=Iu.SdRtn,It().supportPCSetConfiguration&&this.peerConnection.setConfiguration(wf.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,It().supportPCSetConfiguration&&this.peerConnection.setConfiguration(wf.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:s}=Ec(i.sdp);return this.store.descriptionStart(),this.direction===Ri.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Ri.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:s}=Ec(i.sdp);return await this.peerConnection.setLocalDescription(i),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new pe($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?bn()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:yd(yd({},Vs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:yd(yd({},Vs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;Te(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(wu(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...wf.turnServerConfigToIceServers(r.turnServer.servers,i,s)),G("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...wf.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,s)),Te(u=[Iu.Relay,Iu.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),G("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(f=>f.tcpport);R.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(s));const h=u.length>s?u[s]:u[0];switch(i){case Iu.SdRtn:const f=r.filter(v=>{var _;return Te(_=v.username).call(_,"glb:")&&v.turnServerURL==v.turnServerURL}),g=f.length>s?f[s]:f[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Hs(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Hs(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case Iu.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Hs(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Hs(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var s;r!=null&&r.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,r.state))},r.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const s=r==null?void 0:r.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:c}=i.getSelectedCandidatePair()||{};if(s&&c){const u=s.address+":"+s.port,h=c.address+":"+c.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(bc(u)),", remote ").concat(JSON.stringify(bc(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s;if(i||(i=this.peerConnection.getSenders().find(_=>_.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:_,frameRate:x,scaleResolutionDownBy:S}=r._encoderConfig;_&&(u.maxBitrate=1e3*_),Te(h=r._hints).call(h,Jt.LOW_STREAM)&&(x&&(u.maxFramerate=Bi(x)),S&&S>=1&&(u.scaleResolutionDownBy=S))}if(G("DSCP_TYPE")&&mc()){var f;const _=G("DSCP_TYPE");Te(f=["very-low","low","medium","high"]).call(f,_)&&(u.networkPriority=_)}const g=i.getParameters(),v=(s=g.encodings)===null||s===void 0?void 0:s[0];bn()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(g,c),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await i.setParameters(g)}async applySendEncodings(r,i){try{if(!It().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof dn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){const c=Ti(r);return i.forEach((u,h)=>{const f=s[h],g=c.mediaDescriptions.find(v=>v.attributes.mid===f);g&&(Gu(g,u),ZA(g,u,this.store.codec))}),rl(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,h,f;const v=r[g],_=i[g];if(_ instanceof dn&&!Te(s=_._hints).call(s,Jt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=_._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=_._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const x={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};x.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,x))}}}async applySimulcastEncodings(r,i){if(!bn()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof dn&&this.isVP8Simulcast(c)){const u=r[s],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var i,s,c,u,h;return!!(r instanceof dn&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Te(i=r._hints).call(i,Jt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(G("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var s;if(i=i??((s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp)){var c;const u=(c=Ti(i).mediaDescriptions.find(h=>h.attributes.mid===r))===null||c===void 0?void 0:c.attributes.ssrcs;return u==null?void 0:u[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),Te(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,s){const c=Ti(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&s===Ge.AUDIO&&u.media.mediaType==="audio"&&ef(u),rl(c)}},ke(xn.prototype,"establish",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"establish"),xn.prototype),ke(xn.prototype,"connect",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"connect"),xn.prototype),ke(xn.prototype,"receive",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"receive"),xn.prototype),ke(xn.prototype,"mockReceive",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"mockReceive"),xn.prototype),ke(xn.prototype,"stopReceiving",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"stopReceiving"),xn.prototype),ke(xn.prototype,"restartICE",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"restartICE"),xn.prototype),ke(xn.prototype,"close",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"close"),xn.prototype),ke(xn.prototype,"updateEncoderConfig",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"updateEncoderConfig"),xn.prototype),ke(xn.prototype,"updateSendParameters",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"updateSendParameters"),xn.prototype),ke(xn.prototype,"replaceTrack",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"replaceTrack"),xn.prototype),ke(xn.prototype,"muteLocal",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"muteLocal"),xn.prototype),ke(xn.prototype,"unmuteLocal",[Js],Object.getOwnPropertyDescriptor(xn.prototype,"unmuteLocal"),xn.prototype),xn);function Js(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},i}let Mo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var v$,y$,_$,b$,E$,x$,S$,w$,T$,C$,N$,In;function R$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function LE(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?R$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):R$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let B_e=(v$=Uo(Mo.SEND_ONLY),y$=Uo(Mo.SEND_ONLY),_$=Uo(),b$=Uo(Mo.RECEIVE_ONLY),E$=Uo(Mo.RECEIVE_ONLY),x$=Uo(Mo.RECEIVE_ONLY),S$=Uo(Mo.RECEIVE_ONLY),w$=Uo(Mo.RECEIVE_ONLY),T$=Uo(Mo.RECEIVE_ONLY),C$=Uo(),N$=Uo(Mo.RECEIVE_ONLY),In=class extends An{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(qe.StateChange,r,this._state)}constructor(t,r){super(),L(this,"isPlanB",!1),L(this,"store",void 0),L(this,"statsUploader",void 0),L(this,"sendConnection",void 0),L(this,"recvConnection",void 0),L(this,"localTrackMap",new Map),L(this,"remoteUserMap",new Map),L(this,"localDataChannels",[]),L(this,"pendingLocalTracks",[]),L(this,"pendingRemoteTracks",[]),L(this,"statsCollector",void 0),L(this,"dtlsFailedCount",0),L(this,"sendMutex",void 0),L(this,"recvMutex",void 0),L(this,"_state",Xt.Disconnected),L(this,"_restartStates",["disconnected","failed"]),L(this,"reconnectInterval",void 0),L(this,"uploadUnplinkStarted",!1),L(this,"uploadDownlinkStarted",!1),L(this,"uplinkStateUploadInterval",void 0),L(this,"downlinkStatsUploadInterval",void 0),L(this,"handleMuteLocalTrack",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Xt.Connected)return void c(new pe($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(i);if(g.length===0)return void s();const v=g.find(C=>C[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(C=>{let[,{id:U}]=C;return U}));let _=!1;var h,f;i.trackMediaType==="video"?_=!((h=this.localTrackMap.get(Ce.LocalAudioTrack))===null||h===void 0||!h.track._muted):_=((f=this.localTrackMap.get(Ce.LocalVideoTrack))===null||f===void 0?void 0:f.id)===void 0;const x=this.createMuteMessage(g);await fn(this,qe.RequestMuteLocal,x);const S=i.trackMediaType==="video"?sd.MUTE_LOCAL_VIDEO:sd.MUTE_LOCAL_AUDIO;await fn(this,qe.RequestP2PMuteLocal,{action:S,message:x,isMuteAll:_}),s()}catch(g){c(g)}finally{u()}}),L(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Xt.Connected)return void c(new pe($.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void s();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:_}]=v;return _}));const f=this.createUnmuteMessage(h),g=i.trackMediaType==="video"?sd.UNMUTE_LOCAL_VIDEO:sd.UNMUTE_LOCAL_AUDIO;await fn(this,qe.RequestP2PMuteLocal,{action:g,message:f}),s()}catch(h){c(h)}finally{u()}}),L(this,"handleUpdateVideoEncoder",async(i,s,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ce.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==i||this.state!==Xt.Connected)return void s();const{id:v,track:_}=g;v&&(await this.sendConnection.updateSendParameters(v,_),await this.sendConnection.updateEncoderConfig(v,_),this.emit(qe.UpdateVideoEncoder,_)),s()}catch(g){c(g)}finally{var f;(f=h)===null||f===void 0||f()}}),L(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ce.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Xt.Connected)return void s();const{id:f,track:g}=h;f&&await this.sendConnection.updateSendParameters(f,g),s()}catch(h){c(h)}finally{u()}}),L(this,"handleReplaceTrack",async(i,s,c,u)=>{let h;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:x}]=_;return i===x});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Xt.Connected)return void s();if(await((f=this.sendConnection)===null||f===void 0?void 0:f.replaceTrack(i,v[1].id)),v[0]===Ce.LocalVideoTrack&&It().supportDualStreamEncoding){const _=this.localTrackMap.get(Ce.LocalVideoLowTrack);if(_){const x=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=x,_.track._originMediaStreamTrack=x,await new De((S,C)=>{this.handleReplaceTrack(_.track,S,C,!0)})}}s()}catch(v){c(v)}finally{var g;(g=h)===null||g===void 0||g()}}),L(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),L(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),L(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),L(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new G8(t),this.bindStatsUploaderEvents(),this.sendMutex=new Rr("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Rr("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},G("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new pe($.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let i;try{if(r){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new g$(t,this.store,Ri.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(r);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=Xt.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new g$(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{i&&i()}}async p2pConnect(t){if(!this.sendConnection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Xt.Connected}async addRemoteCandidate(t,r){if(r===Ri.RECEIVE_ONLY){if(!this.sendConnection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,i){var s=this;return Li(function*(){const c=yield Tt(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==Xt.Connected){s.throwIfTrackTypeNotMatch(t);const v=t.filter(_=>s.pendingLocalTracks.indexOf(_)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(v))}s.store.pubId=s.store.pubId+1,Zr.markPublishStart(s.store.clientId,s.store.pubId);const u=s.filterTobePublishedTracks(t,r,i);if(u.length===0)return void(yield Tt(s.tryToUnmuteAudio(t)));u.forEach(v=>{let{track:_,type:x}=v;const S=Date.now();s.store.publish(_.getTrackId(),x===Ce.LocalAudioTrack?"audio":"video",S)}),s.bindLocalTrackEvents(u);const h=yield Tt(s.sendConnection.send(u.map(v=>{let{track:_}=v;return _}),s.store.codec,s.store.audioCodec)),f=(yield Tt(h.next())).value,g=s.createGatewayPublishMessage(u,f);try{yield g}catch(v){throw h.throw(v),(v==null?void 0:v.code)===$.WS_ABORT&&u.forEach(_=>{let{track:x}=_;s.pendingLocalTracks.indexOf(x)===-1&&s.pendingLocalTracks.push(x)}),s.unbindLocalTrackEvents(u),v}yield Tt(h.next()),u.forEach(v=>{let{type:_}=v;s.statsCollector.addLocalStats(_)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(u,f),u.forEach(v=>{let{track:_,type:x}=v;const S=Date.now();s.store.publish(_.getTrackId(),x===Ce.LocalAudioTrack?"audio":"video",void 0,S)}),s.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Xt.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!Te(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const s=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Xt.Connected)return i&&i[1].track.close(),s;t.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[c,{track:u,ssrcs:h}]=s;const f={stream_type:Ave(u,c),ssrcs:h};u._muted||!u._enabled?r.push(f):i.push(f)}),r.length>0&&r.forEach(s=>{fn(this,qe.RequestMuteLocal,[s])}),i.length>0&&i.forEach(s=>{fn(this,qe.RequestUnmuteLocal,[s])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Li(function*(){throw new pe($.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await er(this,qe.RequestRePublish,this.pendingLocalTracks),this.emit(qe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new pe($.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,i,s){var c;if(!this.recvConnection)throw new pe($.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:f}=await this.recvConnection.receive(r,[{ssrcId:i}],String(t.uid),s);r===Ge.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new zp(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),f&&t._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=i,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new Hp(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),f&&t._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(t,t._videoTrack));const g=this.remoteUserMap.get(t);g?g.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(_=>{let{user:x,kind:S}=_;return x.uid===t.uid&&r===S});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(qe.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,i,s){if(!this.recvConnection)throw new pe($.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(t.uid),s)}async unsubscribe(t,r,i){const s=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:f}=u;return r!==void 0?h.uid===t.uid&&r===f:h.uid===t.uid});if(s.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||s.forEach(u=>{let{kind:h}=u;var f;if(h===Ge.AUDIO)(f=t._audioTrack)===null||f===void 0||f._destroy(),t._audioTrack=void 0;else if(h===Ge.VIDEO){var g;(g=t._videoTrack)===null||g===void 0||g._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:f}]=u;var g,v;if(f===Ge.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===Ge.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(f===Ge.AUDIO){var _;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((_=h._audioTrack)===null||_===void 0||_._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;fn(this,qe.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[Ge.VIDEO,Ge.AUDIO].forEach(s=>{i.has(s)?fn(this,qe.RequestP2PUnmuteRemote,s):fn(this,qe.RequestP2PMuteRemote,s)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(r))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const s=r===Ge.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(r)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Ce.LocalAudioTrack);if((r==null?void 0:r.track)instanceof or){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==Ce.LocalAudioTrack}).filter(s=>{let[c]=s;return!(t&&c===Ce.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Ce.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(t,r,i,s,c){if(t){const h=this.localTrackMap.get(Ce.LocalAudioTrack),f=s?this.localTrackMap.get(Ce.LocalVideoLowTrack):this.localTrackMap.get(Ce.LocalVideoTrack);$e.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(Jt.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(g=>g instanceof Vn),f=s?(u=this.localTrackMap.get(Ce.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(g=>g instanceof dn);$e.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(Jt.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,i,s){const c=s===Ge.VIDEO?i._videoSSRC:i._audioSSRC;c&&$e.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===Ge.VIDEO,audio:s===Ge.AUDIO,peerid:i.uid,subscribeRequestid:s===Ge.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,c)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Rr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Rr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof or){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Xt.Disconnected}getStats(t){var r,i;return t?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ce.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ce.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof dn||r&&r.track instanceof Vn?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r;const i=Array.from(si(r=this.remoteUserMap).call(r)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ce.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=fu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Xt.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[i,{track:s}]=t;switch(i){case Ce.LocalVideoTrack:Te(r=s._hints).call(r,Jt.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Ce.LocalAudioTrack:s instanceof or?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Ce.LocalVideoLowTrack:}}),this.emit(qe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;Array.from(si(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(qe.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((t instanceof ld?t.uid:t)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let i,s;if(t===Ri.SEND_ONLY){if(!this.sendConnection)throw new pe($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new pe($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(r){const c=await s.restartICE(r);return s.isInRestartIce=!1,c}{const c=await s.restartICE();if(c){const u=await er(this,qe.RequestP2PRestartICE,{direction:Ri.RECEIVE_ONLY,iceParameter:c});await s.restartICE(u),s.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Ce.LocalVideoTrack),i=this.localTrackMap.get(Ce.LocalAudioTrack),s=t.videoSend.find(C=>{var U;return C.ssrc===(r==null||(U=r.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)}),c=t.audioSend.find(C=>{var U;return C.ssrc===(i==null||(U=i.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)});if(!s||!c)return 1;const u=Ea(this,qe.NeedSignalRTT),h=s?s.rttMs:void 0,f=c?c.rttMs:void 0,g=h&&f?(h+f)/2:h||f,v=(g&&u?(g+u)/2:g||u)||0,_=100*t.sendPacketLossRate*.7/50+.3*v/1500,x=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,S=r==null?void 0:r.track;if(S&&S._encoderConfig&&S._hints.indexOf(Jt.SCREEN_TRACK)===-1){const C=S._encoderConfig.bitrateMax,U=t.bitrate.actualEncoded;if(C&&U){const P=(1e3*C-U)/(1e3*C);return P6[P<.15?0:P<.3?1:P<.45?2:P<.6?3:4][x]}}return x}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,u=s._videoSSRC,h=t.audioRecv.find(U=>U.ssrc===c),f=t.videoRecv.find(U=>U.ssrc===u);if(!h&&!f)return void(r+=1);const g=Ea(this,qe.NeedSignalRTT),v=t.rtt,_=(v&&g?(v+g)/2:v||g)||0,x=h?h.jitterMs:void 0,S=t.recvPacketLossRate;let C=.7*S*100/50+.3*_/1500;x&&(C=.6*S*100/50+.2*_/1500+.2*x/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new De((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}filterTobePublishedTracks(t,r,i){const s=[],c=It(),u=this.getAllTracks();t=Pp(t=t.filter(g=>u.indexOf(g)===-1));let h=!1,f=!1;for(const g of t){if(g instanceof dn&&(this.localTrackMap.has(Ce.LocalVideoTrack)||h?new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:Ce.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(g,i);s.push({track:v,type:Ce.LocalVideoLowTrack})}if(g instanceof Vn){const v=this.localTrackMap.get(Ce.LocalAudioTrack);if(v){if(!(v.track instanceof or))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(f){const _=s.find(x=>{let{type:S}=x;return S===Ce.LocalAudioTrack});if(!(_.track instanceof or))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof or||g._bypassWebAudio)s.push({track:g,type:Ce.LocalAudioTrack});else{const _=new or;_.addAudioTrack(g),s.push({track:_,type:Ce.LocalAudioTrack})}f=!0}}}return s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Pp(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Vn){const c=this.localTrackMap.get(Ce.LocalAudioTrack);if(!c)continue;c.track instanceof or?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([Ce.LocalAudioTrack,c]),c.track.close())):r.push([Ce.LocalAudioTrack,c])}if(s instanceof dn){const c=this.localTrackMap.get(Ce.LocalVideoTrack);if(!c)continue;r.push([Ce.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ce.LocalVideoLowTrack);u&&r.push([Ce.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Ce.LocalVideoTrack:i.addListener(He.GET_STATS,this.handleGetLocalVideoStats),i.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(He.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof or?t.trackList.forEach(i=>{i.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(He.GET_STATS,this.handleGetLocalAudioStats),i.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(He.GET_STATS,this.handleGetLocalAudioStats),t.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(He.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Ce.LocalVideoTrack:i.off(He.GET_STATS,this.handleGetLocalVideoStats),i.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(He.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof or?t.trackList.forEach(r=>{r.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(He.GET_STATS,this.handleGetLocalAudioStats),r.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(He.GET_STATS,this.handleGetLocalAudioStats),t.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Hp&&r.addListener(He.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof zp&&r.addListener(He.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(He.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;i.has(Ge.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(Ge.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((i,s)=>{var c;let u,{track:h,type:f}=i;switch(f){case Ce.LocalAudioTrack:u=tn.Audio;break;case Ce.LocalVideoTrack:u=Te(c=h._hints).call(c,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Ce.LocalVideoLowTrack:u=tn.Low}return{kind:f===Ce.LocalAudioTrack?Ge.AUDIO:Ge.VIDEO,stream_type:u,mid:r[s].id,ssrcs:r[s].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:f}]=r;switch(c){case Ce.LocalVideoTrack:s=Te(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Ce.LocalAudioTrack:s=tn.Audio;break;case Ce.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:h,mid:f}})}assignLocalTracks(t,r){t.forEach((i,s)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var i;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(qe.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),Te(i=this._restartStates).call(i,r)&&!t.isInRestartIce&&(r==="disconnected"&&await yr(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),$e.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:ln.TRACER}).onSuccess(),this.emit(qe.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(ls.FIRST_FRAME_DECODED),$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,Tn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);s&&$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,Tn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{this.reportVideoFirstFrameDecoded(r,i,s)},t.onFirstVideoReceived=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,Tn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,i)=>{const s=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(qe.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(od(i))," -> ").concat(JSON.stringify(od(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(od(i))," -> ").concat(JSON.stringify(od(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(qe.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Ri.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Ri.SEND_ONLY?this.restartICE(t):er(this,qe.RequestP2PRestartICE,{direction:Ri.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const i=this.localTrackMap.get(Ce.LocalAudioTrack);if(t instanceof Vn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive||r.push([Ce.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s&&(r.push(s),s[0]===Ce.LocalVideoTrack)){const c=this.localTrackMap.get(Ce.LocalVideoLowTrack);c&&r.push([Ce.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],i=this.localTrackMap.get(Ce.LocalAudioTrack);if(t instanceof Vn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive&&r.push([Ce.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s)if(s[0]===Ce.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get(Ce.LocalVideoLowTrack);c&&r.push([Ce.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:f}]=r;switch(c){case Ce.LocalAudioTrack:s=tn.Audio;break;case Ce.LocalVideoTrack:s=Te(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Ce.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:h,mid:f}})}createUnmuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:f}]=r;switch(c){case Ce.LocalAudioTrack:s=tn.Audio;break;case Ce.LocalVideoTrack:s=Te(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Ce.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const c=s.get(r);if(!c)return i;i.push([t,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,h]=c;i.push([t,{kind:u,id:h}])});return i}createUnsubscribeMessage(t){const r=[];return t.forEach(i=>{let[s,{kind:c,id:u}]=i;switch(c){case Ge.VIDEO:return void(s._videoSSRC&&r.push({stream_type:Ge.VIDEO,ssrcId:s._videoSSRC}));case Ge.AUDIO:return void(s._audioSSRC&&r.push({stream_type:Ge.AUDIO,ssrcId:s._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[i,{kind:s}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ce.LocalVideoTrack),i=this.localTrackMap.get(Ce.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new De((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),i&&t.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new De((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Vn){const i=this.filterTobeUnmutedTracks(t[r]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await fn(this,qe.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(qe.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(qe.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yr(yb(this.dtlsFailedCount,Yn)),this.emit(qe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ce.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof dn)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof dn).length>1)throw new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Vn).length>1&&(t.some(r=>r instanceof Vn&&r._bypassWebAudio)||!It().webAudioMediaStreamDest))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof dn&&this.pendingLocalTracks.some(i=>i instanceof dn))throw new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Vn&&this.pendingLocalTracks.some(i=>i instanceof Vn)&&(!It().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Vn&&i._bypassWebAudio)))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const i=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding,s=LE(LE({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?t._mediaStreamTrack.clone():_I(t,s);const u=Zt(8,"track-low-"),h=new dn(c,LE(LE({},i&&{scaleResolutionDownBy:qA(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,u);return h.on(Du.TRANSCEIVER_UPDATED,f=>{t._updateRtpTransceiver(f,Fp.LOW_STREAM)}),h._hints.push(Jt.LOW_STREAM),t.addListener(He.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,i,s){var c;const u=Array.from(si(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(g=>g.userId===u.uid&&g.type==="video");$e.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,Tn.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,r,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const c=s.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new pe($.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new pe($.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new pe($.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new pe($.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new pe($.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new pe($.NOT_SUPPORTED)}async preConnect(t){throw new pe($.NOT_SUPPORTED)}getEstablishParams(){throw new pe($.NOT_SUPPORTED)}async reSubscribe(t){throw new pe($.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,r){throw new pe($.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:i}]=t;r===Ce.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Fp.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ke(In.prototype,"p2pConnect",[v$],Object.getOwnPropertyDescriptor(In.prototype,"p2pConnect"),In.prototype),ke(In.prototype,"unpublish",[y$],Object.getOwnPropertyDescriptor(In.prototype,"unpublish"),In.prototype),ke(In.prototype,"unpublishLowStream",[_$],Object.getOwnPropertyDescriptor(In.prototype,"unpublishLowStream"),In.prototype),ke(In.prototype,"subscribe",[b$],Object.getOwnPropertyDescriptor(In.prototype,"subscribe"),In.prototype),ke(In.prototype,"mockSubscribe",[E$],Object.getOwnPropertyDescriptor(In.prototype,"mockSubscribe"),In.prototype),ke(In.prototype,"unsubscribe",[x$],Object.getOwnPropertyDescriptor(In.prototype,"unsubscribe"),In.prototype),ke(In.prototype,"muteRemote",[S$],Object.getOwnPropertyDescriptor(In.prototype,"muteRemote"),In.prototype),ke(In.prototype,"unmuteRemote",[w$],Object.getOwnPropertyDescriptor(In.prototype,"unmuteRemote"),In.prototype),ke(In.prototype,"hasRemoteMediaWithLock",[T$],Object.getOwnPropertyDescriptor(In.prototype,"hasRemoteMediaWithLock"),In.prototype),ke(In.prototype,"disconnectForReconnect",[C$],Object.getOwnPropertyDescriptor(In.prototype,"disconnectForReconnect"),In.prototype),ke(In.prototype,"remoteMediaSsrcChanged",[N$],Object.getOwnPropertyDescriptor(In.prototype,"remoteMediaSsrcChanged"),In.prototype),In);function Uo(t){return function(r,i,s){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];switch(t){case Mo.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{g()}}case Mo.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(i)),v=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{g(),v()}}}},s}}class eh extends An{constructor(r,i){super(),L(this,"signal",void 0),L(this,"token",void 0),L(this,"tokenTimeout",void 0),L(this,"tokenInterval",void 0),L(this,"_sequence",0),L(this,"userMap",new Map),L(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const s=()=>{this.signal.connectionState===kt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*G("P2P_TOKEN_INTERVAL"))};s()}async send(r,i,s,c,u){var h;if(this.userMap.size===0)return;const f=Array.from(ya(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=c??Zt(6,""),u=u??this._sequence++;const g={_id:c,_type:r,_seq:u,_message:i,token:"".concat(this.token,"_").concat(f)};G("SHOW_P2P_LOG")&&R.debug("send message",g,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(g)).forEach(_=>{this.signal.request(Ye.DATA_STREAM,{payload:nd(this.encoder.encode(_))})});const v=new De((_,x)=>{const S=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),P),this.off(Jp.ABORT,U),R.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?x(new pe($.INVALID_REMOTE_USER)):x(new pe($.TIMEOUT))},G("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{S&&window.clearTimeout(S),this.off(Jp.ABORT,U),s&&_()},U=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),P),x(new pe($.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Jp.ABORT,U),this.once("res-@".concat(c,"_ack"),C);const P=(W,K)=>{j=!0,S&&window.clearTimeout(S),this.off("res-@".concat(c,"_ack"),C),this.off(Jp.ABORT,U),W==="success"?_(K):x(new pe($.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let j=!1;s||(this.once("res-@".concat(c),P),yr(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||R.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))}))});try{return await v}catch(_){if(_.code===$.TIMEOUT)return await this.send(r,i,s,c,u);throw _}}onMessage(r){var i;const{_uid:s}=r;let c,u=this.userMap.get(s);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Hn.CHECK)return;const{token:v}=r;c=new Map,u={uid:s,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,u),this.signal.emit(ft.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:_}=r,x=(h=c.get(v))!==null&&h!==void 0?h:[];if(x.push(r),c.has(v)||c.set(v,x),x.length!==_)return;{const S=fu(x).call(x,(C,U)=>C.index-U.index).map(C=>C.payload).join("");c.delete(v),(r=JSON.parse(S))._uid=s}}const{_type:f,token:g}=r;if(Te(i=[Hn.ACK,Hn.CHECK]).call(i,f))return f===Hn.CHECK&&this.handleCheckToken(u,g),void this.receiveMessage(r);g==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):R.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:Zt(6,""),token:this.token,_type:Hn.CHECK};G("SHOW_P2P_LOG")&&R.debug("send message",r),this.signal.request(Ye.DATA_STREAM,{payload:nd(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:Hn.ACK,token:this.token};G("SHOW_P2P_LOG")&&R.debug("send message",i),this.signal.request(Ye.DATA_STREAM,{payload:nd(this.encoder.encode(JSON.stringify(i)))})}response(r,i,s){this.send(Hn.RESPONSE,JSON.stringify({success:!s,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:x}=v;for(;_.has(x);){const S=_.get(x);_.delete(x),this.receiveMessage(S),v.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:s,_seq:c}=r,u=this.userMap.get(s),{receivedMessagesMap:h,isStart:f,nextExpectedSequenceNumber:g}=u;if(c<g)return this.ack(r._id),void R.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),f&&c===g&&(this.receiveMessage(r),h.delete(g),u.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:s,_message:c,_uid:u}=r;if(G("SHOW_P2P_LOG")&&R.debug("receive message",r),i){let h;switch(r._type!==Hn.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Hn.CANDIDATE:case Hn.CONTROL:this.signal.emit(s,h,u);break;case Hn.PUBLISH:case Hn.UNPUBLISH:case Hn.RESTART_ICE:case Hn.CALL:h.uid=u,er(this.signal,s,h).then(f=>{this.response(r._id,f)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Hn.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Hn.RESPONSE:{const{success:f,message:g}=h;this.emit("res-@".concat(i),f?"success":"failed",g);break}}}}splitMessage(r){if(r.length<eh.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:s}=JSON.parse(r),c=Zt(6,"");let u=0,h=800;const f=Math.ceil(r.length/h);for(;r.length>0;){u++;const g={id:c,index:u,total:f,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(s)};JSON.stringify(g).length>eh.MAX_MESSAGE_SIZE?h-=50:(i.push(g),r=r.slice(h))}return i.map(g=>JSON.stringify(g))}handleCheckToken(r,i){return r.token!==i?(R.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(i)),this.reset(r.uid)},G("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await er(this.signal,Hn.CALL,void 0),i=await this.send(Hn.CALL,r);this.signal.emit(ze.P2P_CONNECTION,i,!0)}async reset(r,i){const s=this.userMap.get(r);s&&(this.emit(Jp.ABORT),this.signal.emit(ft.ON_USER_OFFLINE,{uid:s.uid,reason:rve.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(R.debug("change local token from ".concat(i," to ").concat(i)),this.token=Zt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Jp.ABORT)}}L(eh,"MAX_SIZE",1),L(eh,"MAX_MESSAGE_SIZE",1024);class G_e extends An{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===kt.CONNECTED?this.emit(ze.WS_CONNECTED):r===kt.RECONNECTING?this.emit(ze.WS_RECONNECTING,this._websocketReconnectReason):r===kt.CLOSED&&this.emit(ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),L(this,"__name__","P2PSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",kt.CLOSED),L(this,"reconnectToken",void 0),L(this,"p2pToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new QR(5)),L(this,"pingpongTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"_external_signal",void 0),L(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(ze.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case ft.ON_DATA_STREAM:return void this.handleDataStream(c._message);case ft.MUTE_AUDIO:case ft.MUTE_VIDEO:case ft.ON_P2P_LOST:case ft.ON_USER_ONLINE:return;case ft.ON_USER_OFFLINE:const{uid:u}=c._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===ft.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ft.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Dt.UID_BANNED);break;case 15:this.close(Dt.IP_BANNED);break;case 16:this.close(Dt.CHANNEL_BANNED)}if(c._type===ft.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ze.ERR_LICENSE_MISSING:this.close(Dt.LICENSE_MISSING);break;case Ze.ERR_LICENSE_EXPIRED:this.close(Dt.LICENSE_EXPIRED);break;case Ze.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Dt.LICENSE_MINUTES_EXCEEDED);break;case Ze.ERR_LICENSE_PERIOD_INVALID:this.close(Dt.LICENSE_PERIOD_INVALID);break;case Ze.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Dt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ze.ERR_LICENSE_ILLEGAL:this.close(Dt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new zA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===kt.CONNECTED&&this.reconnect("retry",$r.OFFLINE)}),this.p2pToken=Zt(6,""),this._external_signal=new eh(this,this.p2pToken)}async request(r,i,s,c){const u=Zt(6,""),h={_id:u,_type:r,_message:i},f=this.websocket.connectionID,g=()=>new De((U,P)=>{if(this.connectionState===kt.CONNECTED)return U();const j=()=>{this.off(ze.WS_CLOSED,W),U()},W=()=>{this.off(ze.WS_CONNECTED,j),P(new pe($.WS_ABORT))};this.once(ze.WS_CONNECTED,j),this.once(ze.WS_CLOSED,W)});if(this.connectionState!==kt.CONNECTING&&this.connectionState!==kt.RECONNECTING||r===Ye.JOIN||r===Ye.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const v=new De((U,P)=>{let j=!1;const W=(J,re)=>{j=!0,U({isSuccess:J==="success",message:re||{}}),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.emit(ze.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),W);const K=()=>{P(new pe($.WS_ABORT,"type: ".concat(r))),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.off("res-@".concat(u),W)};this.once(ze.WS_CLOSED,K),this.once(ze.WS_RECONNECTING,K),yr(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||j||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(ze.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(U){if(this.connectionState===kt.CLOSED||r===Ye.LEAVE)throw new pe($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?U.throw():r===Ye.JOIN||r===Ye.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const x=Number(_.message.error_code||_.message.code),S=Bu(x),C=new pe($.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:x,data:_.message,desc:S.desc});return S.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(x,", message: ").concat(S.desc,", action: ").concat(S.action)),x===Ze.ERR_TOO_MANY_BROADCASTERS?((r===Ye.JOIN||r===Ye.REJOIN)&&(this.initError=C,this.close()),C.throw()):S.action==="failed"?C.throw():S.action==="quit"?(this.initError=C,this.close(),C.throw()):(x===Ze.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$r.MULTI_IP)):this.reconnect(S.action,$r.SERVER_ERROR),r===Ye.JOIN||r===Ye.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new De(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Vu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==kt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const s={_type:r,_message:i};this.websocket.sendMessage(s)}async sendExtensionMessage(r,i,s){return await this._external_signal.send(r,i,s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((i,s)=>{this.once(ze.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ze.WS_CLOSED,()=>s(this.initError||new pe($.WS_ABORT))),this.connectionState=kt.CONNECTING,this.websocket.init(r).catch(s)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Dt.LEAVE,this.connectionState=kt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Zt(6,""),this._external_signal.clear(),this._external_signal=new eh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ze.ABORT_P2P_EXECUTION);const r=await er(this,ze.REQUEST_JOIN_INFO),i=await this.request(Ye.JOIN,r);if(!i)return this.emit(ze.REPORT_JOIN_GATEWAY,$.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(ze.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){return!1}handleDataStream(r){try{var i;const s=Ru(r.payload),c=new TextDecoder().decode(s),u=JSON.parse(c);"total"in u&&"id"in u||Te(i=Object.values(Hn)).call(i,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(ft.ON_DATA_STREAM,r)}catch{this.emit(ft.ON_DATA_STREAM,r)}}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Bu(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?r.code===Ze.ERR_REPEAT_JOIN_CHANNEL&&G("IGNORE_UID_CHECK")?void this.close(Dt.UID_CONFLICT):(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Dt.UID_BANNED),void this.close()):void this.reconnect(i.action,$r.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=G("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$r.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),G("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,r=>{this.emit(ze.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=kt.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Dt.NETWORK_ERROR,this.connectionState=kt.CLOSED}),this.websocket.on(_t.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===kt.CONNECTED?this.connectionState=kt.RECONNECTING:this.connectionState=kt.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(r,i,s)=>{r!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(r)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(ze.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof pe&&r.code===$.UNEXPECTED_RESPONSE&&r.data.code===Ze.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",$r.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$r.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(_t.REQUEST_NEW_URLS,(r,i)=>{er(this,ze.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const W_e={name:"P2PChannel",create:function(t){let{store:r,statsCollector:i}=t;return new B_e(r,i)},createSubmodule:function(t){let{store:r,spec:i}=t;return new G_e(i,r)}};function A$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function I$(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?A$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):A$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class $_e{constructor(r){L(this,"sessionDesc",void 0),L(this,"localCapabilities",void 0),L(this,"rtpCapabilities",void 0),L(this,"candidates",void 0),L(this,"_originCandidates",void 0),L(this,"iceParameters",void 0),L(this,"dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname",void 0),r=En(r);const{iceParameters:i,dtlsParameters:s,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:f,sdkCodec:g,cname:v}=r,_=Ti(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=En(c),this.iceParameters=i,this.dtlsParameters=s,this.setup=h,this.localCapabilities=f,this.cname=v;for(let x=0;x<_.mediaDescriptions.length;x++){const S=_.mediaDescriptions[x];if(S.attributes.iceUfrag=i.iceUfrag,S.attributes.icePwd=i.icePwd,S.attributes.fingerprints=s.fingerprints,S.attributes.candidates=c,S.attributes.setup=h,S.media.mediaType==="video"){S.media.fmts=u.videoCodecs.map(P=>P.payloadType.toString(10));const C=u.videoCodecs.filter(P=>{var j,W;return(j=P.rtpMap)===null||j===void 0?void 0:Te(W=j.encodingName.toLowerCase()).call(W,g)}),U=u.videoCodecs.filter(P=>!Te(C).call(C,P));S.attributes.payloads=[...C,...U],S.attributes.extmaps=u.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=u.audioCodecs.map(C=>C.payloadType.toString(10)),S.attributes.payloads=u.audioCodecs,S.attributes.extmaps=u.audioExtensions),_.mediaDescriptions[x]=this.mungMediaDesc(S)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return rl(this.sessionDesc)}send(r,i,s){const{ssrcs:c,ssrcGroups:u}=nv(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>r===Ge.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),f=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:f,mslabel:g}}batchSend(r){return r.map(i=>{let{kind:s,ssrcMsg:c}=i;return this.send(s,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{Te(r).call(r,h.attributes.label||"")?u.push(h):s.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var f;Te(f=u.map(g=>g.ssrcId)).call(f,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,s){r.forEach((c,u)=>{const h=c._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],c);this.sessionDesc.mediaDescriptions[f]=g})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),s=[];if(i.forEach(c=>{s.push(I$(I$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case Ar.TCP_RELAY:this.candidates=s;break;case Ar.UDP_TCP_RELAY:case Ar.RELAY:this.candidates=[...i,...s];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=En(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(r,i){const s=En(r);return Gu(s,i),QA(s,i),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(s!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,s){const c=this.sessionDesc.mediaDescriptions.find(h=>r===Ge.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(f=>f.attributes.label===i);var u;h&&(h.attributes.label=s,(u=h.attributes.msid)===null||u===void 0||u.replace(i,s))}}mungMediaDesc(r){const i=En(r);return JA(i),function(s){const c=s.attributes.extmaps.find(u=>Zb(u.extensionName));c&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(c),1),s.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===r)return[s]}}var mn;function O$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ME(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?O$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):O$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let H_e=(mn=class ry extends Yb{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Te(i=Object.keys(Ou)).call(i,r)}))]}constructor(r,i){super(r,i),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"statsFilter",void 0),L(this,"useRTX",!1),L(this,"localCapabilities",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"establishPromise",void 0),L(this,"mutex",void 0),this.store=i,this.mutex=new Rr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(ry.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=xb(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,bn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Ec(r.sdp),s=tv(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=r,ME(ME({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:r.sdp})}catch(r){throw new pe($.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new $_e(ME(ME({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new pe($.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var s=this;return Li(function*(){const c=yield Tt(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(S=>s.peerConnection.addTrack(S._mediaStreamTrack)),h=yield Tt(s.peerConnection.createOffer()),f=Ti(h.sdp),g=r.map(S=>{const C=S._mediaStreamTrack,U=f.mediaDescriptions.find(P=>P.attributes.mid===C.kind);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,j,W){const K=P.attributes.ssrcs.filter(re=>re.attributes.label===j),J=P.attributes.ssrcGroups;if(K.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(J&&K.length>1){const re=J.find(ie=>ie.ssrcIds.indexOf(K[0].ssrcId)!==-1);return re?[{ssrcId:re.ssrcIds[0],rtx:W?re.ssrcIds[1]:void 0}]:[{ssrcId:K[0].ssrcId}]}return[{ssrcId:K[0].ssrcId}]}(U,C.id,s.useRTX)});let v;try{v=yield g}catch(S){throw u.forEach(C=>{Nr()&&C.replaceTrack(null),s.peerConnection.removeTrack(C)}),S}const _=s.mungSendOfferSDP(h.sdp,r);s.remoteSDP.receive(r,i,v);const x=s.remoteSDP.toString();return yield Tt(s.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(s.applySendEncodings(u,r)),yield Tt(s.peerConnection.setRemoteDescription({type:"answer",sdp:x})),r.map((S,C)=>{const U=S._mediaStreamTrack.id;return{localSSRC:g[C],id:U}})}catch(u){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{Nr()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,i,c),f=new De((_,x)=>{const S=setTimeout(()=>{x(new Error("Cannot receive track, id: ".concat(u)))},1e4),C=U=>{const P=Bt();if((P.name==="Safari"&&Number(P.version)===11||ai())&&U.track.id!==u&&U.streams[0].id===h){var j;const W=U.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(r,u,U.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(S),void _(W)}if(U.track.id===u)return this.peerConnection.removeEventListener("track",C),clearTimeout(S),void _(U.track)};this.peerConnection.addEventListener("track",C)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await f,id:u}}catch(u){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(s=>{var c;return r.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(s=>{if(Nr()&&s.track)s.track.enabled=!1;else{const c=s.getParameters();c.encodings.forEach(u=>u.active=!1),s.setParameters(c)}})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(Nr()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(f=>f.active=!0),await u.setParameters(h)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Li(function*(){const s=yield Tt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=It().supportPCSetConfiguration;if(r===Ar.RELAY&&!c)return;if(c){const v=i.peerConnection.getConfiguration(),_=r===Ar.RELAY?"relay":"all";v.iceTransportPolicy!==_&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(_,"]")),v.iceTransportPolicy=_,i.peerConnection.setConfiguration(v))}r!==Ar.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Tt(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Ec(u.sdp),{remoteIceParameters:f}=yield h.iceParameters;i.remoteSDP.restartICE(f);const g=i.remoteSDP.toString();yield Tt(i.peerConnection.setLocalDescription(u)),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new pe($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});s.length===1&&await this.applySendEncodings(s,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});s&&await s.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new pe($.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new pe($.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(wu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...ry.turnServerConfigToIceServers(r.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...ry.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var s;if(i||(i=this.peerConnection.getSenders().find(v=>{var _;return((_=v.track)===null||_===void 0?void 0:_.id)===r._mediaStreamTrack.id})),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!It().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof dn)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(G("DSCP_TYPE")&&mc()){var h;const v=G("DSCP_TYPE");Te(h=["very-low","low","medium","high"]).call(h,v)&&(u.networkPriority=v)}const f=i.getParameters(),g=(s=f.encodings)===null||s===void 0?void 0:s[0];g&&Object.assign(g,u),Object.assign(f,c),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await i.setParameters(f)}async applySendEncodings(r,i){try{if(!It().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const s=Ti(r);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,f=s.mediaDescriptions.find(g=>g.attributes.mid===h.kind);f&&Gu(f,c)}),rl(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:f,mslabel:g}=u;const{kind:v}=r[h];return new De((_,x)=>{const S=setTimeout(()=>{x(new Error("Cannot receive track, id: ".concat(f)))},1e4),C=U=>{const P=Bt();if(P.name==="Safari"&&Number(P.version)===11&&U.track.id!==f&&U.streams[0].id===g){var j;const W=U.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(v,f,U.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(S),void _({track:W,id:f})}if(U.track.id===f)return this.peerConnection.removeEventListener("track",C),clearTimeout(S),void _({track:U.track,id:f})};this.peerConnection.addEventListener("track",C)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await De.all(i)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(It().supportPCSetConfiguration){const i=ry.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},ke(mn.prototype,"connect",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"connect"),mn.prototype),ke(mn.prototype,"stopSending",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"stopSending"),mn.prototype),ke(mn.prototype,"receive",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"receive"),mn.prototype),ke(mn.prototype,"stopReceiving",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"stopReceiving"),mn.prototype),ke(mn.prototype,"muteRemote",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"muteRemote"),mn.prototype),ke(mn.prototype,"unmuteRemote",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"unmuteRemote"),mn.prototype),ke(mn.prototype,"muteLocal",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"muteLocal"),mn.prototype),ke(mn.prototype,"unmuteLocal",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"unmuteLocal"),mn.prototype),ke(mn.prototype,"close",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"close"),mn.prototype),ke(mn.prototype,"updateEncoderConfig",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"updateEncoderConfig"),mn.prototype),ke(mn.prototype,"updateSendParameters",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"updateSendParameters"),mn.prototype),ke(mn.prototype,"replaceTrack",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"replaceTrack"),mn.prototype),ke(mn.prototype,"getRemoteSSRC",[ms],Object.getOwnPropertyDescriptor(mn.prototype,"getRemoteSSRC"),mn.prototype),mn);function ms(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},i}const z_e={name:"PlanBConnection",create:function(t){let{store:r,spec:i}=t;return new H_e(i,r)}},K_e={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(jb.has(t)||!t.track)return;const i={track:t.track};if(tl()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void R.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){i.controller||(i.controller=f),t.track&&t.track.id!==i.track.id&&(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const g=r.metadata&&r.metadata();g?function(v,_){const{chunk:x,controller:S}=_,C=rd.METADATA;x.data=function(U,P,j){const W=j.byteLength,K=W+AA+w6,J=NA+RA+K,re=new ArrayBuffer(U.byteLength+J),ie=new DataView(re);ie.setUint8(0,S6),ie.setUint16(1,K),ie.setUint8(3,P),ie.setUint16(4,W);for(let se=0;se<W;se++)ie.setUint8(6+se,j[se]);const Z=new Uint8Array(ie.buffer);return Z.set(new Uint8Array(U),J),Z.buffer}(x.data,C,v),S.enqueue(x)}(g,{chunk:h,controller:f}):f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=kb(),u=new MessageChannel;await new De(f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);t.transform=h,await new De(f=>c.onmessage=g=>{g.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var g;if(f.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id)R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s);else if(f.data.getMetadata){const v=r.metadata&&r.metadata();v&&u.port1.postMessage({metadata:v})}},i.worker=c}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}const c=jb.get(t);if(c){jb.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){R.warning(f&&f.message)}}}jb.set(t,i),t.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(Bb.has(t))return;const i={track:t.track,onMetadata:r.onMetadata,onPts:r.onPts};if(tl()&&!ai()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");UR(Ht.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void R.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){i.controller||(i.controller=f),t.track&&t.track.id!==i.track.id&&(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s)),r.enableTopn?function(g,v,_){var x;const S=IA(new DataView(v.data));if(!S)return _.enqueue(v);const C=g.track.id;wge.set(C,g.track);const U=(x=S.tlv.find(re=>re.tag===rd.AUDIO_LEVEL))===null||x===void 0?void 0:x.value;let P=0;typeof U=="number"&&(P=127-U);const j=Math.round(Math.pow(10,P/60)-1),{selected:W,speaker:K}=function(re,ie){let Z=Kp.get(re);if(Z||(Z=function(se){const ge=new C6;return Kp.set(se,ge),Ao||(Ao=new xge(G("TOPN_SILENCE_THRESHOLD")||500),Ao.on("ActiveSpeakerChanged",Ee=>{Ee!=null&&(Ub=Ee)})),Ao.addSpeakers([ge]),ge}(re)),Kp.size<=N6)return{selected:!0,speaker:Z};if(!Ao)throw new Error("no active speaker detector");return Ao.levelChanged(Z.id,ie),Mu=Ao.loudest.map(se=>se.id),Ub&&!Te(Mu).call(Mu,Ub)&&Mu.length>=N6&&Mu.pop(),{selected:Te(Mu).call(Mu,Z.id)||Z.id===Ub,speaker:Z}}(g,j),J=function(re,ie,Z){const se=Io.get(re)||new Sge(re,ie);return se.score=Z,Io.set(re,se),function(ge){if(Fb.set(ge,!0),!Vb)return void(Vb=Date.now());const Ee=Date.now();Ee-Vb>1e3&&(Fb.get(ge)?Fb.set(ge,!1):(R6(ge),Fb.delete(ge)),Vb=Ee)}(re),se}(C,g.track,K.energyScore);J.addSample(W),J.active&&(v.data=S.frame.buffer,_.enqueue(v))}(t,h,f):r.enableMetadata||r.enablePts?function(g,v,_,x){const S=new DataView(g.data),C=S.getUint8(0);let U;if(128&C&&C!==71){const W=function(K){if(K.byteLength<=0)return[];const J=[];let re=0;for(;re<K.byteLength;){const Z=(128&K.getUint8(re))>>7,se=127&K.getUint8(re);if(!(Z&&re+4<=K.byteLength)){re++;break}{const ge=K.getUint32(re,!1),Ee=(16776192&ge)>>10,Fe=1023&ge;J.push({pt:se,ts_offset:Ee,length:Fe,data:new Uint8Array}),re+=4}}let ie=K.byteLength-re;for(const Z of J){if(Z.length>ie)return console.warn("Broken red payload"),[];Z.length>0&&(Z.data=new Uint8Array(K.buffer,K.byteOffset+re,Z.length),re+=Z.length,ie-=Z.length)}if(ie>0){const Z={pt:J.length>0?J[J.length-1].pt:0,ts_offset:0,length:ie,data:new Uint8Array(K.buffer,K.byteOffset+re,ie)};J.push(Z)}return J}(S);if(W.length>0){const K=function(J){let re=0;for(let se=0;se<J.length;se++)re+=se<J.length-1?4:1,re+=J[se].length;const ie=new Uint8Array(re);let Z=0;for(let se=0;se<J.length;se++)if(se<J.length-1){const ge=(2147483648|(127&J[se].pt)<<24|(262143&J[se].ts_offset)<<10|1023&J[se].length)>>>0;ie[Z++]=ge>>24&255,ie[Z++]=ge>>16&255,ie[Z++]=ge>>8&255,ie[Z++]=255&ge}else ie[Z++]=127&J[se].pt;for(const se of J)ie.set(se.data,Z),Z+=se.length;return ie}(W.map(J=>{const re=new Uint8Array(J.length);re.set(J.data);const ie=IA(new DataView(re.buffer));return ie!=null&&ie.frame&&(J.data=ie==null?void 0:ie.frame),U=ie,J}));g.data=K.buffer}}else U=IA(S),U&&(g.data=U.frame.buffer);if(v.enqueue(g),!U)return;const P=U.tlv.find(W=>W.tag===rd.METADATA);P&&_&&P.value instanceof Uint8Array&&_(P.value);const j=U.tlv.find(W=>W.tag===rd.AUDIO_64_BIT_PTS);j&&x&&j.value instanceof Uint8Array&&j.value.length==8&&x(new DataView(j.value.buffer).getBigUint64(0,!0))}(h,f,r.onMetadata,r.onPts):f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=kb(),u=new MessageChannel;await new De(f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);t.transform=h,await new De(f=>c.onmessage=g=>{g.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var g;f.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id?(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s)):f.data.metadata&&i.onMetadata?i.onMetadata(f.data.metadata):f.data.pts&&i.onPts&&i.onPts(f.data.pts)},i.worker=c}function s(){t.track.removeEventListener("ended",s),function(c){const u=Bb.get(c);if(u){(function(g){const v=Kp.get(g);v&&(Kp.delete(g),Ao&&(Ao.removeSpeakers([v]),Kp.size===0&&(Ao.destroy(),Ao=null)))})(c),R6(c.track.id),Bb.delete(c);try{var h,f;(h=u.controller)===null||h===void 0||h.terminate(),(f=u.worker)===null||f===void 0||f.terminate()}catch(g){R.warning(g&&g.message)}}}(t)}Bb.set(t,i),t.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(t,r){if(!It().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(Gb.has(t)||!t.track)return;const i={track:t.track};if(tl()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(f){return void R.error("create video-encoded-streams error",f&&f.message)}const u=[];r.on("sei-to-send",f=>{u.push(f)});const h=new TransformStream({transform(f,g){i.controller||(i.controller=g),t.track&&t.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const v=O6(new Uint8Array(f.data)),_=u.shift();if(_){const x=function(S,C,U){switch(U){case kA:return function(P,j){const W=I6(j),K=W.length,J=Math.floor(K/255),re=K%255,ie=new Uint8Array(6+J+1+K+P.byteLength);ie[0]=0,ie[1]=0,ie[2]=0,ie[3]=1,ie[4]=6,ie[5]=101;let Z=0;for(;Z<J;)ie[6+Z]=255,Z++;return ie[6+Z]=re,Z++,ie.set(W,6+Z),ie.set(new Uint8Array(P),6+Z+K),ie.buffer}(S,C);case jA:return function(P,j){const W=I6(j),K=W.length,J=Math.floor(K/255),re=K%255,ie=new Uint8Array(7+J+1+K+1+P.byteLength);ie[0]=0,ie[1]=0,ie[2]=0,ie[3]=1,ie[4]=78,ie[5]=1,ie[6]=101;let Z=0;for(;Z<J;)ie[7+Z]=255,Z++;return ie[7+Z]=re,Z++,ie.set(W,7+Z),Z+=K,ie[7+Z]=128,Z++,ie.set(new Uint8Array(P),7+Z),ie.buffer}(S,C);default:return null}}(f.data,_,v);x&&(f.data=x)}g.enqueue(f)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Nr())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=kb(),u=new MessageChannel;await new De(f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);t.transform=h,await new De(f=>c.onmessage=g=>{g.data==="started"&&f(void 0)}),r.on("sei-to-send",f=>{u.port1.postMessage({sei:f})}),u.port1.onmessage=f=>{var g;f.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s))},i.worker=c}}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}const c=Gb.get(t);if(c){Gb.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){R.warning(f&&f.message)}}}Gb.set(t,i),t.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!t.track)return;if(Jg.has(t)){const c=Jg.get(t);return void(c&&(c.onSei=r.onSei))}const i={track:t.track,onSei:r.onSei};if(tl()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void R.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){if(i.controller||(i.controller=f),!i.firstFrameInfo){var g;const _=h.getMetadata()||{};i.firstFrameInfo=yn({type:h.type,rtpTimestamp:h.timestamp,payloadType:_.payloadType||0,ssrc:_.synchronizationSource||0,length:h.data.byteLength},"mimeType"in _?{mimeType:_.mimeType}:{}),(g=r.onFirstFrame)===null||g===void 0||g.call(r,i.firstFrameInfo)}t.track&&t.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const v=function(_,x){switch(x){case kA:return function(S){const C=new DataView(S.data);let U=0;for(;U+4<S.data.byteLength;){if(C.getUint8(U+0)===0&&C.getUint8(U+1)===0&&C.getUint8(U+2)===0&&C.getUint8(U+3)===1&&C.getUint8(U+4)===6){let P=U+6,j=0,W=0;for(;(W=C.getUint8(P++))===255;)j+=255;j+=W;const K=A6(S.data,P,j);return new Uint8Array(K)}U++}return null}(_);case jA:return function(S){const C=new DataView(S.data);let U=0;for(;U+5<S.data.byteLength;){if(C.getUint8(U+0)===0&&C.getUint8(U+1)===0&&C.getUint8(U+2)===0&&C.getUint8(U+3)===1&&C.getUint8(U+4)===78&&C.getUint8(U+5)===1&&C.getUint8(U+6)===101){let P=U+7,j=0,W=0;for(;(W=C.getUint8(P++))===255;)j+=255;j+=W;const K=A6(S.data,P,j);return new Uint8Array(K)}U++}return null}(_);default:return null}}(h,O6(new Uint8Array(h.data)));v&&i.onSei&&i.onSei(v),f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=kb(),u=new MessageChannel;await new De(f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);t.transform=h,await new De(f=>c.onmessage=g=>{g.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var g;if(f.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id)R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s);else if(f.data.sei&&i.onSei)i.onSei(f.data.sei);else if(f.data.firstFrameInfo&&r.onFirstFrame){var v;(v=r.onFirstFrame)===null||v===void 0||v.call(r,f.data.firstFrameInfo)}},i.worker=c}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}(function(c){const u=Jg.get(c);if(u){Jg.delete(c);try{var h,f;(h=u.controller)===null||h===void 0||h.terminate(),(f=u.worker)===null||f===void 0||f.terminate()}catch(g){R.warning(g&&g.message)}}})(t)}Jg.set(t,i),t.track.addEventListener("ended",s)}},Y_e={name:"InterceptFrame",create:()=>K_e};var Ft;function P$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Fo(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?P$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):P$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let q_e=(Ft=class Tf extends Yb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Te(i=Object.keys(Ou)).call(i,r)}))]}constructor(r,i,s){super(r,i),L(this,"id",Zt(5,"connection-")),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"forceTurn",!1),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"transportEventReceiver",void 0),L(this,"statsFilter",void 0),L(this,"extension",{useXR:G("USE_XR")}),L(this,"localCapabilities",void 0),L(this,"remoteCodecs",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"isPreallocation",!1),L(this,"preMediaMap",new Map),L(this,"dataStreamChannelMap",new Map),L(this,"establishPromise",void 0),L(this,"recoveredDataChannelIds",[]),L(this,"currentDataChannelId",1),L(this,"supportAV1RtpSpec",!1),L(this,"mutex",void 0),L(this,"qualityLimitationReason",jp.NONE),L(this,"isFirstConnected",!1),this.store=i,this.forceTurn=yI(r),this.mutex=new Rr("NVConnectionExtension-mutex",i.clientId),this.peerConnection=s,this.isFirstConnected=!1,this.statsFilter=xb(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,bn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else R.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Ec(i.sdp),c=await eI({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=rv(c),this.initialOffer=i,G("ENABLE_SVC")&&this.store.codec=="av1"){const h=await a8();var r;h&&(this.supportAV1RtpSpec=!0,(r=c.send)===null||r===void 0||r.videoExtensions.push(h))}let u;return i.sdp&&tE(i.sdp)&&(u=En(c),J6(u)),Fo(Fo({},s),{},{rtpCapabilities:u||c,offerSDP:i.sdp})}catch(i){throw new pe($.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&tE(this.initialOffer.sdp)&&Q6(r.rtpCapabilities,this.localCapabilities),this.remoteSDP=new I8(Fo(Fo({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&Yg(this.store),!0),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=tI(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),Yg(this.store))if(r.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const h=G("PRE_SUB_NUM"),{mids:f,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(h);await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(f,g)}else{const{preSSRCs:h=[]}=r,f=h.map(v=>v.ssrcMsg[0].ssrcId);if(h.length===0)return;const{mids:g}=this.remoteSDP.batchSend(h.map(v=>Object.assign({},v)));await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(g,f)}}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(i.toString()))}}presetMedia(r,i){r.forEach((s,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&s===u.mid&&u.receiver.track){const h=u.receiver.track;let f;h.kind==="video"&&G("ENABLE_PRE_RENDER")&&(f=new Pb({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(Zt(5,""))},!0),f.updateVideoTrack(h),f.onFirstVideoFrameRender=()=>{var g;const v=this.preMediaMap.get(i[c]);v&&(v.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,i[c])},f.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,i[c])},f.play(this.store.sessionId||void 0)),this.preMediaMap.set(i[c],{mid:s,track:h,player:f,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:s}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||h}const{preSSRCs:c=[]}=r,u=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){const h=[],f=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[v,{mid:_,player:x,track:S}]=g;return h.push(_),f.push(v),this.preMediaMap.delete(v),x&&x.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await ea(this.peerConnection,this.remoteSDP,this.extension),R.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),$e.reportApiInvoke(this.store.sessionId,{name:wn.PRELOAD_MEDIA_FAILED,options:[c,f],tag:ln.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(v=>Object.assign({},v)));await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}i?(await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):R.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Li(function*(){const u=yield Tt(c.mutex.lock("From NVConnectionExtension.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const h=[],f=ev();r.forEach(j=>{const W=c.peerConnection.addTransceiver(j._mediaStreamTrack,Fo({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));h.push(W),j._updateRtpTransceiver(W)}),bn()&&G("SIMULCAST")===!0&&(yield Tt(c.applySimulcastForFirefox(h,r)));const g=yield Tt(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),_=c.mungSendOfferSDP(g.sdp,r,v),x=Ti(_),S=v.map(j=>{const W=x.mediaDescriptions.find(K=>K.attributes.mid===j);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return XA(W,G("USE_PUB_RTX"))});let C;try{C=yield S}catch(j){C=[],c.remoteSDP.receive(r,i,s,C);const W=c.remoteSDP.toString();throw yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),yield Tt(c.stopSending(v,!0)),j}c.remoteSDP.receive(r,i,s,C);const U=c.remoteSDP.toString(),P=c.logSDPExchange(_,"offer","local","send");return yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.applySimulcastEncodings(h,r)),yield Tt(c.applySendEncodings(h,r)),P==null||P(U),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:U})),h.map((j,W)=>{const K=v[W];return{localSSRC:S[W],id:K,transceiver:j}})}catch(h){throw h instanceof pe?h:new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")R.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}i.forEach(u=>{u._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),R.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else R.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof pe?s:new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof pe?i:new pe($.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");c.map(g=>{var v;af(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,s,c);h&&(await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(r," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:u,transceiver:f}}catch(u){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await ea(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preMediaMap.entries()).some(h=>{let[f,{mid:g,player:v}]=h;if(g===u)return this.preMediaMap.delete(f),v&&v.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,f)=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Li(function*(){const s=yield Tt(i.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=It().supportPCSetConfiguration,u=G("FORCE_TURN_TCP")||i.forceTurn;if(r===Ar.RELAY&&!c)return;if(c&&!u){const x=r===Ar.RELAY?"relay":"all",S=i.peerConnection.getConfiguration();S.iceTransportPolicy!==x&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(x,"]")),S.iceTransportPolicy=x,i.peerConnection.setConfiguration(S))}i.remoteSDP.updateCandidates(r);const h=yield Tt(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Ec(h.sdp),{remoteIceParameters:g}=yield f.iceParameters;i.remoteSDP.restartICE(g);const v=i.remoteSDP.toString(),_=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Tt(i.peerConnection.setLocalDescription(h)),_==null||_(v),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Ar.TCP_RELAY),await ea(this.peerConnection,this.remoteSDP,this.extension)}catch(i){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{af(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:s}=i;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Fo(Fo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new pe($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?bn()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:Fo(Fo({},Vs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Fo(Fo({},Vs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",u=bc(r.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(s,"), url: ").concat(u||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},s=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(wu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:G("NEW_TURN_MODE")&&i.iceServers&&s==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...Tf.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...Tf.newTurnServerConfigToIceServers(r.turnServer.servers)),G("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...Tf.turnServerConfigToIceServers(r.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...Tf.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Hs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!G("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{const c=G("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Hs(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Hs(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:u}=s.getSelectedCandidatePair()||{};if(c&&u){const h=c.address+":"+c.port,f=u.address+":"+u.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(bc(h)),", remote ").concat(JSON.stringify(bc(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const f=q6(this.peerConnection,r._mediaStreamTrack),g=UV(r);if(L8(r)&&f&&i&&g&&this.getLocalVideoStats&&Te(s=["vp8","vp9"]).call(s,this.store.codec)){var v;const P=u.degradationPreference||(Te(v=r._hints).call(v,Jt.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");M8(this.id+f.mid,g,this,P,j=>{i&&this.updateAdaptation(i,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;const{bitrateMax:P,frameRate:j,scaleResolutionDownBy:W}=r._encoderConfig;P&&(h.maxBitrate=1e3*P),(Te(_=r._hints).call(_,Jt.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=Bi(j)),W&&W>=1&&(h.scaleResolutionDownBy=W))}const{maxFramerate:x}=G("ENCODER_CONFIG_LIMIT");if(x&&typeof x=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,x):x),G("DSCP_TYPE")&&mc()){var S;const P=G("DSCP_TYPE");Te(S=["very-low","low","medium","high"]).call(S,P)&&(h.networkPriority=P)}const C=i.getParameters(),U=(c=C.encodings)===null||c===void 0?void 0:c[0];bn()&&!U&&(u.encodings=[h]),U&&Object.assign(U,h),Object.assign(C,u),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await c8(this.store.codec,i,G("SVC_MODE"))}async updateAdaptation(r,i){var s,c;if(!r)return R.debug("[updateAdaptation] no rtpSender found");if(!It().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:f,scaleResolutionDownBy:g}=i;h&&(u.maxBitrate=1e3*h),f&&(u.maxFramerate=Bi(f)),g&&g>=1&&Te(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=g);const v=r.getParameters(),_=(c=v.encodings)===null||c===void 0?void 0:c[0];_&&Object.assign(_,u),Object.assign(v,{});try{await r.setParameters(v),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(x){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",x):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!It().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof dn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){const c=Ti(r);return i.forEach((u,h)=>{const f=s[h],g=c.mediaDescriptions.find(v=>v.attributes.mid===f);g&&(Gu(g,u),ZA(g,u,this.store.codec))}),rl(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,h,f;const v=r[g],_=i[g];if(_ instanceof dn&&!Te(s=_._hints).call(s,Jt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=_._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=_._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const x={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};x.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,x))}}}async applySimulcastEncodings(r,i){if(!bn()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof dn&&this.isVP8Simulcast(c)){const u=r[s],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var i,s,c,u,h;return!!(r instanceof dn&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Te(i=r._hints).call(i,Jt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(G("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during NVConnectionExtension.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(It().supportPCSetConfiguration){const i=Tf.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},ke(Ft.prototype,"updateRemoteRTPCapabilities",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"updateRemoteRTPCapabilities"),Ft.prototype),ke(Ft.prototype,"connect",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"connect"),Ft.prototype),ke(Ft.prototype,"updateRemoteConnect",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"updateRemoteConnect"),Ft.prototype),ke(Ft.prototype,"createDataChannels",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"createDataChannels"),Ft.prototype),ke(Ft.prototype,"receive",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"receive"),Ft.prototype),ke(Ft.prototype,"batchReceive",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"batchReceive"),Ft.prototype),ke(Ft.prototype,"stopReceiving",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"stopReceiving"),Ft.prototype),ke(Ft.prototype,"muteRemote",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"muteRemote"),Ft.prototype),ke(Ft.prototype,"unmuteRemote",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"unmuteRemote"),Ft.prototype),ke(Ft.prototype,"muteLocal",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"muteLocal"),Ft.prototype),ke(Ft.prototype,"unmuteLocal",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"unmuteLocal"),Ft.prototype),ke(Ft.prototype,"close",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"close"),Ft.prototype),ke(Ft.prototype,"updateEncoderConfig",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"updateEncoderConfig"),Ft.prototype),ke(Ft.prototype,"updateSendParameters",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"updateSendParameters"),Ft.prototype),ke(Ft.prototype,"replaceTrack",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"replaceTrack"),Ft.prototype),ke(Ft.prototype,"updateAdaptation",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"updateAdaptation"),Ft.prototype),ke(Ft.prototype,"getRemoteSSRC",[$i],Object.getOwnPropertyDescriptor(Ft.prototype,"getRemoteSSRC"),Ft.prototype),Ft);function $i(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From NVConnectionExtension.".concat(r));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},i}var rn;function D$(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=ab,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new UE(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function UE(t){function r(i){if(Object(i)!==i)return De.reject(new TypeError(i+" is not an object."));var s=i.done;return De.resolve(i.value).then(function(c){return{value:c,done:s}})}return UE=function(i){this.s=i,this.n=i.next},UE.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?De.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?De.reject(i):r(s.apply(this.s,arguments))}},new UE(t)}let X_e=(rn=class Bx extends Yb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(r,i){super(r,i),L(this,"name","DataChannelConnection"),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"cname",void 0),L(this,"mutex",new Rr("DataChannelConnection-mutex")),L(this,"dataChannel",void 0),L(this,"_p2pConnection",void 0),L(this,"establishPromise",void 0),L(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Bx.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new q_e(r,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(r){var i;return(i=this._p2pConnection)===null||i===void 0?void 0:i.getPreMedia(r)}isPreSub(){var r,i;return(r=(i=this._p2pConnection)===null||i===void 0?void 0:i.isPreSub())!==null&&r!==void 0&&r}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(r){return this._p2pConnection.updateRtpSenderEncodings(r)}async connect(r){return this.cname=r.cname,await this._p2pConnection.connect(r),await new De((i,s)=>{const c=setTimeout(()=>{this.closeSignal(),s(new ce($.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r.candidates))))},G("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(c),void i()},this.dataChannel.onerror=u=>{this.closeSignal(),s(u)},this.dataChannel.addEventListener("close",()=>{s(new ce($.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(r,i){return this._p2pConnection.updateRemoteRTPCapabilities(r,i)}send(r,i,s){var c=this;return Li(function*(){const u=yield Tt(c.mutex.lock("From DataChannelConnection.send"));try{return yield*Ap(D$(c._p2pConnection.send(r,i,s)))}finally{u()}})()}async stopSending(r,i){return this._p2pConnection.stopSending(r,i)}async createDataChannels(r,i){return this._p2pConnection.createDataChannels(r,i)}async stopDataChannels(r){return this._p2pConnection.stopDataChannels(r)}async receive(r,i,s,c){return this._nvMedia?(R.debug("[DataChannelConnection] receive ".concat(r," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(r,i,this.cname)):(R.debug("[DataChannelConnection] receive ".concat(r," by WebRTC.")),await this._p2pConnection.receive(r,i,s,c))}async batchReceive(r){return[...await this._p2pConnection.batchReceive(r)]}async stopReceiving(r){return await this._p2pConnection.stopReceiving(r)}async muteRemote(r){return await this._p2pConnection.muteRemote(r)}async unmuteRemote(r){return await this._p2pConnection.unmuteRemote(r)}async muteLocal(r){return await this._p2pConnection.muteLocal(r)}async unmuteLocal(r){return await this._p2pConnection.unmuteLocal(r)}restartICE(r){var i=this;return Li(function*(){return yield*Ap(D$(i._p2pConnection.restartICE(r)))})()}close(){var r;(r=this._nvMedia)===null||r===void 0||r.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(r){return this._p2pConnection.getRemoteVideoIsReady(r)}updateRemoteConnect(r){var i;return(i=this._nvMedia)===null||i===void 0||i.setRemoteRtpCapabilities(r),this._p2pConnection.updateRemoteConnect(r)}async updateEncoderConfig(r,i){return await this._p2pConnection.updateEncoderConfig(r,i)}async updateSendParameters(r,i){return await this._p2pConnection.updateSendParameters(r,i)}setStatsRemoteVideoIsReady(r,i){this._p2pConnection.setStatsRemoteVideoIsReady(r,i)}async replaceTrack(r,i){return await this._p2pConnection.replaceTrack(r,i)}async getRemoteSSRC(r){return this._p2pConnection.getRemoteSSRC(r)}logSDPExchange(r,i,s,c){if(G("SDP_LOGGING"))return R.upload("exchanging ".concat(s," ").concat(i," SDP during DataChannelConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(wu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...Bx.turnServerConfigToIceServers(r.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...Bx.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Hs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!G("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=r=>{var i;return(i=this.onICEConnectionStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onConnectionStateChange=r=>{var i;return(i=this.onConnectionStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportStateChange=r=>{var i;return(i=this.onDTLSTransportStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportError=r=>{var i;return(i=this.onDTLSTransportError)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onICETransportStateChange=r=>{var i;return(i=this.onICETransportStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioReceived=r=>{var i;return(i=this.onFirstAudioReceived)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoReceived=r=>{var i;return(i=this.onFirstVideoReceived)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioDecoded=r=>{var i;return(i=this.onFirstAudioDecoded)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoRender=r=>{var i;return(i=this.onFirstVideoRender)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoBufferReady=r=>{var i;return(i=this.onFirstVideoBufferReady)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoDecoded=(r,i,s)=>{var c;return(c=this.onFirstVideoDecoded)===null||c===void 0?void 0:c.call(this,r,i,s)},this._p2pConnection.onFirstVideoDecodedTimeout=r=>{var i;return(i=this.onFirstVideoDecodedTimeout)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onSelectedLocalCandidateChanged=(r,i)=>{var s;return(s=this.onSelectedLocalCandidateChanged)===null||s===void 0?void 0:s.call(this,r,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(r,i)=>{var s;return(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0?void 0:s.call(this,r,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0}setConfiguration(r){this._p2pConnection.setConfiguration(r)}},ke(rn.prototype,"connect",[za],Object.getOwnPropertyDescriptor(rn.prototype,"connect"),rn.prototype),ke(rn.prototype,"updateRemoteRTPCapabilities",[za],Object.getOwnPropertyDescriptor(rn.prototype,"updateRemoteRTPCapabilities"),rn.prototype),ke(rn.prototype,"createDataChannels",[za],Object.getOwnPropertyDescriptor(rn.prototype,"createDataChannels"),rn.prototype),ke(rn.prototype,"receive",[za],Object.getOwnPropertyDescriptor(rn.prototype,"receive"),rn.prototype),ke(rn.prototype,"stopReceiving",[za],Object.getOwnPropertyDescriptor(rn.prototype,"stopReceiving"),rn.prototype),ke(rn.prototype,"muteRemote",[za],Object.getOwnPropertyDescriptor(rn.prototype,"muteRemote"),rn.prototype),ke(rn.prototype,"unmuteRemote",[za],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteRemote"),rn.prototype),ke(rn.prototype,"muteLocal",[za],Object.getOwnPropertyDescriptor(rn.prototype,"muteLocal"),rn.prototype),ke(rn.prototype,"unmuteLocal",[za],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteLocal"),rn.prototype),ke(rn.prototype,"close",[za],Object.getOwnPropertyDescriptor(rn.prototype,"close"),rn.prototype),ke(rn.prototype,"updateEncoderConfig",[za],Object.getOwnPropertyDescriptor(rn.prototype,"updateEncoderConfig"),rn.prototype),ke(rn.prototype,"updateSendParameters",[za],Object.getOwnPropertyDescriptor(rn.prototype,"updateSendParameters"),rn.prototype),ke(rn.prototype,"replaceTrack",[za],Object.getOwnPropertyDescriptor(rn.prototype,"replaceTrack"),rn.prototype),ke(rn.prototype,"getRemoteSSRC",[za],Object.getOwnPropertyDescriptor(rn.prototype,"getRemoteSSRC"),rn.prototype),rn);function za(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From DataChannelConnection.".concat(r));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},i}function k$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class J_e extends An{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;Te(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(lr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(lr.CONNECTED):this._state==="closed"?this.emit(lr.CLOSED):this._state==="failed"&&this.emit(lr.FAILED))}constructor(r,i,s,c){super(),L(this,"connectionID",0),L(this,"currentURLIndex",0),L(this,"reconnectReason",void 0),L(this,"_reconnectMode","tryNext"),L(this,"_initMutex",void 0),L(this,"_name",void 0),L(this,"_state","closed"),L(this,"_reconnectInterrupter",void 0),L(this,"_url",void 0),L(this,"_retryConfig",void 0),L(this,"_reconnectCount",0),L(this,"_forceCloseTimeout",5e3),L(this,"_onlineReconnectListener",void 0),L(this,"_closeEstablishingTransmitter",()=>{}),L(this,"_store",void 0),L(this,"_joinChannelServiceRecordIndex",void 0),L(this,"_transmitter",void 0),L(this,"_useCompress",void 0),L(this,"_inflateLength",0),L(this,"_deflateLength",0),this._store=c,this._name=r,this._retryConfig=function(u){for(var h=1;h<arguments.length;h++){var f=arguments[h]!=null?arguments[h]:{};h%2?k$(Object(f),!0).forEach(function(g){L(u,g,f[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(f)):k$(Object(f)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(f,g))})}return u}({},i),this._useCompress=s}resetReconnectCount(r){R.debug("".concat(this._name," reset reconnect count, reason: ").concat(r)),this._reconnectCount=0}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const s=this._transmitter;i?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=r?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(r,i){if(!this._transmitter)return void R.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((s=this._store)===null||s===void 0||s.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));const c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){const r=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:r,deflateLength:i}}setInflateData(r){this._deflateLength=this._deflateLength+r.originLength,this._inflateLength=this._inflateLength+r.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Vo=function(t){return t[t.Default=0]="Default",t[t.Ack=1]="Ack",t}({});class Q_e{constructor(r,i,s){L(this,"version",1),L(this,"initialRTO",void 0),L(this,"maxBatchAckCount",void 0),L(this,"maxRTO",void 0),L(this,"initialRTT",void 0),L(this,"ID",void 0),L(this,"rtt",void 0),L(this,"packetNumber",1),L(this,"rtoRatioMap",new Map),L(this,"timeoutMap",new Map),L(this,"unorderedPacketQueue",[]),L(this,"batchAckPacketQueue",[]),L(this,"lastOrderedPacketNumber",0),L(this,"batchAckTimer",void 0),L(this,"sendImpl",void 0),L(this,"receiveImpl",void 0),this.sendImpl=r,this.receiveImpl=i,this.ID=Zt(7,"transmitter-"),this.initialRTO=(s==null?void 0:s.initialRTO)!==void 0?s.initialRTO:G("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(s==null?void 0:s.initialRTT)!==void 0?s.initialRTT:G("TRANSMITTER_INITIAL_RTT"),this.rtt=(s==null?void 0:s.initialRTT)!==void 0?s.initialRTT:G("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(s==null?void 0:s.maxBatchAckCount)!==void 0?s.maxBatchAckCount:G("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(s==null?void 0:s.maxRTO)!==void 0?s.maxRTO:G("TRANSMITTER_MAX_RTO")}packetize(r,i){return{type:Vo.Default,version:this.version,packetNumber:i,payload:r}}serialize(r){switch(r.type){case Vo.Default:{let i;typeof r.payload=="string"?i=new TextEncoder().encode(r.payload):i=r.payload;const s=new ArrayBuffer(i.length+15),c=new DataView(s);return c.setUint16(0,r.version),c.setUint8(2,r.type),c.setUint32(3,r.packetNumber),DF(c,7,BigInt(r.sendTs)),new Uint8Array(c.buffer).set(i,15),s}case Vo.Ack:{const i=new ArrayBuffer(16),s=new DataView(i);return s.setUint16(0,r.version),s.setUint8(2,r.type),s.setUint32(3,r.maxAckPacketNumber),s.setUint8(7,r.shift),DF(s,8,BigInt(r.ackSendTs)),i}}}deserialize(r){const i=new DataView(r),s=i.getUint16(0),c=i.getUint8(2);switch(c){case Vo.Default:{const u=i.getUint32(3),h=PF(i,7),f=r.slice(15),g=new Uint8Array(f);return{version:s,type:c,packetNumber:u,sendTs:Number(h),payload:g}}case Vo.Ack:{const u=i.getUint32(3),h=i.getUint8(7),f=PF(i,8);return{version:s,type:c,maxAckPacketNumber:u,shift:h,ackSendTs:Number(f)}}default:throw R.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(r){G("DC_DEBUG_LOG")&&typeof r=="string"&&R.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(r));const i=this.packetize(r,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const s=this.calculateRTO(i),c=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,c),this.sendPacket(i)}onData(r){const i=this.deserialize(r);i.type===Vo.Default?this.ack(i):i.type===Vo.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(r=>{let[i,s]=r;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(r){const i=this.calculateRTO(r),s=window.setTimeout(()=>{G("DC_DEBUG_LOG")&&typeof r.payload=="string"&&R.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(r.payload),"timeout: ".concat(i)),this.resendMessage(r)},i);this.timeoutMap.set(r.packetNumber,s),this.sendPacket(r)}calculateRTO(r){const i=this.rtoRatioMap.get(r.packetNumber);if(i===void 0)return this.rtoRatioMap.set(r.packetNumber,1),this.initialRTO;{const s=9*this.rtt/8*i;return this.rtoRatioMap.set(r.packetNumber,i+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(r,i){const s=r.ackSendTs;this.rtt=this.rtt*(7/8)+(i-s-this.rtt)/8}ack(r){if(r.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(r):(this.batchAckPacketQueue.push(r),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(r.payload);;){const i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(r.packetNumber<=this.lastOrderedPacketNumber){const i={ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Vo.Ack,version:this.version};G("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),i,"packetNumber: ".concat(r.packetNumber)),this.sendPacket(i)}else if(r.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[r.packetNumber-this.lastOrderedPacketNumber-2]=r;const i={ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Vo.Ack,version:this.version};G("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),i,"packetNumber: ".concat(r.packetNumber)),this.sendPacket(i)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const r={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Vo.Ack,version:this.version};G("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending batch ack packet"),r,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(r),this.batchAckPacketQueue=[]}sendPacket(r){r.type===Vo.Default&&(r.sendTs=Math.round(performance.now()));const i=this.serialize(r);this.sendImpl(i)}clearRTO(r){for(let i=r.maxAckPacketNumber-r.shift;i<=r.maxAckPacketNumber;i++){const s=this.timeoutMap.get(i);s!==void 0&&window.clearTimeout(s),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class j$ extends J_e{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),L(this,"_initMutex",void 0),L(this,"_reconnectInterrupter",void 0),L(this,"_url",void 0),L(this,"_transmitter",void 0),L(this,"_addresses",void 0),L(this,"_reliableTransmission",void 0),L(this,"_textEncoder",void 0),L(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new Rr("datachannel");const{timeout:s,timeoutFactor:c}=i,u=Math.max(300,Math.floor(3*s/5)),h=Math.max(1.2,Math.floor(8*c)/10);wi.ONLINE&&(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=h),jn.on(Tu.NETWORK_STATE_CHANGE,(f,g)=>{f!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(f)),f===wi.ONLINE?(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=i;const s=(c,u)=>{this._addresses=r,this.currentURLIndex=this._addresses.findIndex(f=>f.fingerprint||G("FINGERPRINT"));const h=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(h).then(c).catch(u),this.once(lr.CLOSED,()=>u(new ce($.WS_DISCONNECT))),this.once(lr.CONNECTED,()=>c())};return this._initMutex.lock().then(c=>new De((u,h)=>{s(u,h)}).then(()=>{c()}).catch(()=>{c()}))}async sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new ce($.WS_ABORT,"datachannel is not ready");try{i||(r=JSON.stringify(r));const s=this._textEncoder.encode(r),c=d_e(s,{raw:!0});this._reliableTransmission.sendMessage(c)}catch(s){throw new ce($.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(r){const i=JSON.stringify(r);return{compressed:i,compressedLength:i.length,origin:r}}sendMessageWithUint8Array(r){return{compressed:r,compressedLength:r.byteLength,origin:r}}createTransmitterConnection(r){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(r.ip,":").concat(r.port),new De((i,s)=>{var c;const u=()=>{R.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),i()},h=async _=>{var x;if((x=this._closeEstablishingTransmitter)===null||x===void 0||x.call(this),R.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=Ea(this,lr.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,C=await this.reconnectWithAction(S);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!C)return s(new ce($.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);i()}else s(new ce($.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},f=async _=>{try{var x;(x=this._reliableTransmission)===null||x===void 0||x.onData(_.data)}catch(S){console.log(S)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),R.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(r)));const g=(c=this._store)===null||c===void 0?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),v=Date.now();er(this,lr.TO_CONNECT_DATACHANNEL).then(_=>{var x,S;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:C,close:U}=_;this._transmitter=C,(x=this._store)===null||x===void 0||x.signalChannelOpen();const P=Date.now()-v;R.debug("[choose dc] dc open cost ".concat(P,"ms")),this._reliableTransmission=new Q_e(j=>{var W;this._transmitter&&this._transmitter.readyState==="open"&&((W=this._transmitter)===null||W===void 0||W.send(j))},j=>{if(typeof j=="string")this.emit(lr.ON_MESSAGE,j);else{const W=h_e(j,{raw:!0}).buffer,K=this._textDecoder.decode(W);this.emit(lr.ON_MESSAGE,K)}}),this._closeEstablishingTransmitter=()=>{var j;(j=this._reliableTransmission)===null||j===void 0||j.close(),this._reliableTransmission=void 0,U()},u&&u(),C.onclose=h,C.onmessage=f,(S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(_=>{var x;if((x=this._store)===null||x===void 0||x.recordJoinChannelService({endTs:Date.now(),status:_ instanceof ce&&_.code===$.WS_ABORT?"aborted":"error",errors:[_]},g),this.state!=="closed"){if(_ instanceof ce&&_.code===$.WS_ERR){const S=new ce($.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return R.error("[".concat(this._name,"]").concat(S)),void s(S)}h&&h(_)}else s(new ce($.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||jn.networkState!==wi.OFFLINE||(this._onlineReconnectListener=jn.onlineWaiter&&jn.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let s=!0;if(this._reconnectInterrupter=()=>{s=!1},i){const f=yb(this._reconnectCount,this._retryConfig);R.debug("[".concat(this._name,"] wait ").concat(f,"ms to reconnect datachannel, mode: ").concat(r)),await De.race([yr(f),this._onlineReconnectListener||new De(()=>{})])}if(this.state==="closed"||!s)return!1;this._reconnectCount+=1;const c=async(f,g)=>{this.emit(lr.RECONNECT_CREATE_CONNECTION,g),await this.createTransmitterConnection(f)};try{if(r==="retry"){const f=this._addresses[this.currentURLIndex];await c(f,r)}else if(r==="tryNext"){this.currentURLIndex+=1;for(let g=this.currentURLIndex;g<this._addresses.length;g++){if(this._addresses[g].fingerprint||G("FINGERPRINT")){this.currentURLIndex=g;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return R.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);R.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const f=this._addresses[this.currentURLIndex];await c(f,r)}else r==="recover"&&(R.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(lr.FAILBACK));return!0}catch(f){var u,h;return R.error("[".concat(this._name,"] reconnect failed"),f.toString()),f!=null&&(u=f.data)!==null&&u!==void 0&&u.desc&&Array.isArray(f.data.desc)&&f.data.desc.length&&Te(h=f.data.desc).call(h,"dynamic key expired")?(this.emit(lr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(r,i)}}}class Z_e extends An{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===kt.CONNECTED?this.emit(ze.WS_CONNECTED):r===kt.RECONNECTING?this.emit(ze.WS_RECONNECTING,this._websocketReconnectReason):r===kt.CLOSED&&this.emit(ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(R.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(r=>{let{type:i,message:s}=r;this.emit(i,s),i===ft.ON_NOTIFICATION&&this.handleNotification(s),i===ft.ON_USER_BANNED&&this.handleUserBanned(s)}),this.pendingNotifications=[])}handleUserBanned(r){switch(r.error_code){case 14:this.close(Dt.UID_BANNED);break;case 15:this.close(Dt.IP_BANNED);break;case 16:this.close(Dt.CHANNEL_BANNED)}}constructor(r,i){super(),L(this,"__name__","DataChannelSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",kt.CLOSED),L(this,"reconnectToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new QR(5)),L(this,"pingpongTimer",void 0),L(this,"inflateDataTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"ortc",void 0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"isJoining",!1),L(this,"pendingNotifications",[]),L(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit(ze.ON_BINARY_DATA,s);const c=JSON.parse(s);if(G("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] received packet",c),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else Object.prototype.hasOwnProperty.call(c,"_type")&&(this.isJoining?c._type===ft.ON_NOTIFICATION||c._type===ft.ON_USER_BANNED?(this.emit(c._type,c._message),c._type===ft.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ft.ON_USER_BANNED&&this.handleUserBanned(c._message)):(this.pendingNotifications.push({type:c._type,message:c._message}),R.debug("[".concat(this.clientId,"] cached notification during join: ").concat(c._type))):(this.emit(c._type,c._message),c._type===ft.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ft.ON_USER_BANNED&&this.handleUserBanned(c._message)))}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new j$("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===kt.CONNECTED&&this.reconnect("retry",ad.OFFLINE)})}async request(r,i,s,c){const u=Zt(6,""),h={_id:u,_type:r,_message:i},f=this.websocket.connectionID,g=()=>new De((U,P)=>{if(this.connectionState===kt.CONNECTED)return U();const j=()=>{this.off(ze.WS_CLOSED,W),U()},W=()=>{this.off(ze.WS_CONNECTED,j),P(new ce($.WS_ABORT))};this.once(ze.WS_CONNECTED,j),this.once(ze.WS_CLOSED,W),r!==Ye.PUBLISH&&r!==Ye.SUBSCRIBE&&r!==Ye.UNSUBSCRIBE&&r!==Ye.UNPUBLISH&&r!==Ye.CONTROL&&r!==Ye.RESTART_ICE||this.once(ze.DISCONNECT_P2P,()=>{P(new ce($.DISCONNECT_P2P))}),r!==Ye.PUBLISH&&r!==Ye.RESTART_ICE||this.once(ze.ABORT_P2P_EXECUTION,()=>{P(new ce($.DISCONNECT_P2P))})});if(this.connectionState!==kt.CONNECTING&&this.connectionState!==kt.RECONNECTING||r===Ye.JOIN||r===Ye.REJOIN||await g(),r===Ye.LEAVE&&(this.websocket.unbindDcCloseEventListener(),c=!0),G("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] sendMessage",h),await this.websocket.sendMessage(h,!0,!1),c)return;const v=new De((U,P)=>{let j=!1;const W=(J,re)=>{j=!0,U({isSuccess:J==="success",message:re||{}}),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.emit(ze.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),W);const K=()=>{P(new ce($.WS_ABORT,"type: ".concat(r))),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.off("res-@".concat(u),W)};this.once(ze.WS_CLOSED,K),this.once(ze.WS_RECONNECTING,K),yr(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||j||(R.warning("dc request timeout, type: ".concat(r)),this.emit(ze.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(U){if(this.connectionState===kt.CLOSED||r===Ye.LEAVE)throw new ce($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?U.throw():r===Ye.JOIN||r===Ye.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const x=Number(_.message.error_code||_.message.code),S=Bu(x),C=new ce($.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:x,data:_.message});return S.action==="success"?_.message:(R.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(x,", message: ").concat(S.desc,", action: ").concat(S.action)),x===Ze.ERR_TOO_MANY_BROADCASTERS?((r===Ye.JOIN||r===Ye.REJOIN)&&(this.initError=C,this.close()),C.throw()):S.action==="failed"?C.throw():S.action==="quit"?(this.initError=C,this.close(),C.throw()):(x===Ze.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ad.MULTI_IP)):this.reconnect(S.action,ad.SERVER_ERROR),r===Ye.JOIN||r===Ye.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new De(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Vu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==kt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(r,i){const s={_type:r,_message:i};await this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((i,s)=>{this.once(ze.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ze.WS_CLOSED,()=>s(this.initError||new ce($.WS_ABORT))),this.connectionState=kt.CONNECTING,this.websocket.init(r).catch(s),this.websocket.once(lr.FAILBACK,()=>{s(new ce($.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(R.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new ce($.INIT_DATACHANNEL_TIMEOUT)))},G("DC_JOIN_WITH_FAILBACK"))})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=r||Dt.LEAVE,this.connectionState=kt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),r===Dt.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new j$("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),G("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(ze.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await er(this,ze.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const i=await this.request(Ye.JOIN,r);if(this.store.joinRep(),this.ortc=r==null?void 0:r.ortc,!i)return this.emit(ze.REPORT_JOIN_GATEWAY,$.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(ze.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=kt.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new ce($.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Cu(this,ze.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(Ye.REJOIN,r);return!!i&&(this.connectionState=kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),G("DC_PINGPONG_INTERVAL")),i.peers&&i.peers.forEach(s=>{this.emit(ft.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(ft.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(ft.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(ft.MUTE_AUDIO,{uid:s.uid}):this.emit(ft.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(ft.MUTE_VIDEO,{uid:s.uid}):this.emit(ft.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(ft.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(ft.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(ft.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(ft.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(ft.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Ye.DOWNGRADE_CODEC,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Bu(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Dt.UID_BANNED),void this.close()):void this.reconnect(i.action,ad.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,G("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const r=G("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",ad.FALLBACK):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),G("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){const{inflateLength:r,deflateLength:i}=this.websocket.getInflateData();r!==0&&i!==0&&this.upload(Vu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(lr.RECONNECT_CREATE_CONNECTION,r=>{this.emit(ze.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(lr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(lr.CLOSED,()=>{this.connectionState=kt.CLOSED}),this.websocket.on(lr.FAILED,()=>{this._disconnectedReason=Dt.NETWORK_ERROR,this.connectionState=kt.CLOSED}),this.websocket.on(lr.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===kt.CONNECTED?this.connectionState=kt.RECONNECTING:this.connectionState=kt.CONNECTING}),this.websocket.on(lr.WILL_RECONNECT,(r,i)=>{if(Cu(this,ze.IS_P2P_DISCONNECTED)&&r==="retry")return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ze.NEED_RENEW_SESSION),this.emit(ze.DISCONNECT_P2P),i("tryNext");r!=="retry"&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(ze.NEED_RENEW_SESSION),this.emit(ze.DISCONNECT_P2P)),i(r)}),this.websocket.on(lr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",ad.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(ze.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof ce&&r.code===$.UNEXPECTED_RESPONSE&&r.data.code===Ze.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ad.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ad.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(lr.REQUEST_NEW_URLS,(r,i)=>{er(this,ze.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(lr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(lr.TO_CONNECT_DATACHANNEL,(r,i)=>{er(this,ze.PRE_CONNECT_PC).then(r).catch(i)}),this.websocket.on(lr.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(ze.DATACHANNEL_FAILBACK)})}}const e0e={name:"DataChannelConnection",create:function(t){let{store:r,spec:i}=t;return new X_e(i,r)}},t0e={name:"DataChannelSignal",create:function(t){let{store:r,spec:i}=t;return new Z_e(i,r)}};iA(),an("PROCESS_ID","process-".concat(Zt(8,""),"-").concat(Zt(4,""),"-").concat(Zt(4,""),"-").concat(Zt(4,""),"-").concat(Zt(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),i=Date.now();R.debug("Loading global parameters from cache",r),Object.keys(r).forEach(s=>{if(Object.prototype.hasOwnProperty.call(en,s)){const{value:c,expires:u}=r[s];if(u&&u<=i)return;Ma[s]=c,en[s]=c}})}catch(r){R.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Ma.AREAS)&&Ma.AREAS.length>0&&aI(Ma.AREAS,!0);const L$=(t,r,i)=>{R.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),an(t,r,i)};xc(v_e,!1),xc(b_e,!1),xc(Xve,!1),xc(O_e,!1),xc(f_e,!1),xc(W_e,!1),xc(z_e,!1),xc(Y_e,!1),xc(e0e,!1),xc(t0e,!1);const tr=function(t){const r=new An,i=t,s={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,f){h===_c.SECURITY_POLICY_VIOLATION&&dW(f,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return lW(lW({},i),s)}({__TRACK_LIST__:Pu,VERSION:os,BUILD:oA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:L$,getParameter:G,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(s){let c;return It().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),c=(await s.createOffer()).sdp):c=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return t;r.close(),r=null,t=function(s){const c={video:[],audio:[]};return s.match(/ VP8/i)&&c.video.push("VP8"),s.match(/ VP9/i)&&c.video.push("VP9"),s.match(/ AV1/i)&&c.video.push("AV1"),s.match(/ H264/i)&&c.video.push("H264"),s.match(/ H265/i)&&c.video.push("H265"),s.match(/ opus/i)&&c.audio.push("OPUS"),s.match(/ PCMU/i)&&c.audio.push("PCMU"),s.match(/ PCMA/i)&&c.audio.push("PCMA"),s.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new ce($.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const r=$e.reportApiInvoke(null,{name:wn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:ln.TRACER}),i=function(){let u=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],h=!1;try{const f=window.RTCPeerConnection,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,v=window.WebSocket;h=!(!f||!v),u&&!g&&(h=!1),h&&Vg()&&EF(75)&&new f().close()}catch(f){R.error("check system requirement failed: ",f),h=!1}return h}(t),s=Qve();R.debug("checkSystemRequirements, api:",i,"browser",s);const c=i&&s;return r.onSuccess(c),G("IGNORE_RTC_DEVICE_CHECK")?i:c},getDevices:function(t){return Ga.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Ga.getRecordingDevices(t)},getCameras:function(t){return Ga.getCamerasDevices(t)},getElectronScreenSources:CV,getPlaybackDevices:function(t){return Ga.getSpeakers(t)},createClient:sW,createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=G("CAMERA_CAPTURE_CONFIG"),i=Zt(8,"track-cam-"),s=$e.reportApiInvoke(null,{id:i,tag:ln.TRACER,name:wn.CREATE_CAM_VIDEO_TRACK,options:[yn({},t),r]});r&&(t.encoderConfig=r);const c=Ob(t);let u=null;R.info("start create camera video track with config",JSON.stringify(t),"trackId",i);try{u=(await Ba({video:c},i)).getVideoTracks()[0]||null}catch(f){throw s.onError(f),f}if(!u){const f=new pe($.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(f),f.throw(R)}if(t.optimizationMode&&CA(i,u,t,Gs(t.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const f=Gs(t.encoderConfig);t.encoderConfig=f,delete f.bitrateMax,delete f.bitrateMin}const h=new Db(u,t,c,t.scalabiltyMode?Nb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess(h.getTrackId()),R.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(t){const r=Zt(8,"track-cus-"),i=$e.reportApiInvoke(null,{id:r,tag:ln.TRACER,name:wn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});G("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const s=new dn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?Nb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[Jt.CUSTOM_TRACK]);return i.onSuccess(s.getTrackId()),R.info("create custom video track success with config",t,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(S){const C=LV(S);return mV()&&S.suppressLocalAudioPlayback&&(C.suppressLocalAudioPlayback=S.suppressLocalAudioPlayback),gV()&&S.restrictOwnAudio&&(C.restrictOwnAudio=!0),C}(r):void 0;i&&(r="auto");const s=Zt(8,"track-scr-v-"),c=$e.reportApiInvoke(null,{id:s,tag:ln.TRACER,name:wn.CREATE_SCREEN_VIDEO_TRACK,options:[yn({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const u=function(S){const C={};S.screenSourceType&&(C.mediaSource=S.screenSourceType),S.extensionId&&tl()&&(C.extensionId=S.extensionId);const{displaySurface:U,selfBrowserSurface:P,surfaceSwitching:j,systemAudio:W,preferCurrentTab:K,windowAudio:J,monitorTypeSurfaces:re}=S;(No(107)||ed(107)||Su(93))&&(U&&(Kn(U,"displaySurface",["browser","window","monitor"]),C.displaySurface=U),P?(Kn(P,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=P):C.selfBrowserSurface="include",j&&(Kn(j,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=j)),(No(105)||ed(105)||Su(91))&&W&&(Kn(W,"systemAudio",["exclude","include"]),C.systemAudio=W),(No(94)||ed(94)||Su(80))&&K&&(C.preferCurrentTab=!0),(No(141)||ed(141)||Su(125))&&J&&(Kn(J,"windowAudio",["exclude","system"]),C.windowAudio=J),(No(119)||ed(119)||Su(105))&&re&&(Kn(re,"monitorTypeSurfaces",["exclude","include"]),C.monitorTypeSurfaces=re),S.electronScreenSourceId&&(C.sourceId=S.electronScreenSourceId);const ie=S.encoderConfig?pA(S.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:ie?ie.width:void 0,maxHeight:ie?ie.height:void 0},ie&&(ie.frameRate&&(typeof ie.frameRate=="number"?(C.mandatory.maxFrameRate=ie.frameRate,C.mandatory.minFrameRate=ie.frameRate):(C.mandatory.maxFrameRate=ie.frameRate.max||ie.frameRate.ideal||ie.frameRate.exact||void 0,C.mandatory.minFrameRate=ie.frameRate.min||ie.frameRate.ideal||ie.frameRate.exact||void 0),C.frameRate=ie.frameRate),ie.width&&(C.width=ie.width),ie.height&&(C.height=ie.height)),C}(t);let h=null,f=null;const g=It();if(!g.supportShareAudio&&r==="enable"){const S=new pe($.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(S),S.throw(R)}R.info("start create screen video track with config",t,"withAudio",r,"trackId",s);const v=g.supportShareAudio&&r!=="disable";try{const S=await Ba({screen:u,screenAudio:v?i||!0:void 0},s);h=S.getVideoTracks()[0]||null,f=S.getAudioTracks()[0]||null}catch(S){throw c.onError(S),S}if(!h){const S=new pe($.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(S),S.throw(R)}if(!f&&r==="enable"){h&&h.stop();const S=new pe($.SHARE_AUDIO_NOT_ALLOWED);return c.onError(S),S.throw(R)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(CA(s,h,t,t.encoderConfig&&pA(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const _=new dn(h,t.encoderConfig?pA(t.encoderConfig):{},t.scalabiltyMode?Nb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s,[Jt.SCREEN_TRACK]);if(!f)return c.onSuccess(_.getTrackId()),R.info("create screen video track success","video:",_.getTrackId()),_;const x=new Vn(f,void 0,Zt(8,"track-scr-a-"),!1);return c.onSuccess([_.getTrackId(),x.getTrackId()]),R.info("create screen video track success","video:",_.getTrackId(),"audio:",x.getTrackId()),[_,x]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=G("CAMERA_CAPTURE_CONFIG"),s=Zt(8,"track-mic-"),c=Zt(8,"track-cam-"),u=$e.reportApiInvoke(null,{id:"".concat(s,"-").concat(c),tag:ln.TRACER,name:wn.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,i]});i&&(r.encoderConfig=i);const h=Ob(r),f=MV(t);let g=null,v=null;R.info("start create camera video track(".concat(c,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const S=await Ba({audio:f,video:h},"".concat(s,"-").concat(c));g=S.getAudioTracks()[0],v=S.getVideoTracks()[0]}catch(S){throw u.onError(S),S}if(!g||!v){const S=new pe($.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(S),S.throw(R)}if(r.optimizationMode&&CA(c,v,r,Gs(r.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const S=Gs(r.encoderConfig);r.encoderConfig=S,delete S.bitrateMax,delete S.bitrateMin}const _=new Xg(g,t,f,s),x=new Db(v,r,h,r.scalabiltyMode?Nb(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([_.getTrackId(),x.getTrackId()]),R.info("create camera video track(".concat(c,") and microphone audio track(").concat(s,") success")),[_,x]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Zt(8,"track-mic-"),i=$e.reportApiInvoke(null,{id:r,tag:ln.TRACER,name:wn.CREATE_MIC_AUDIO_TRACK,options:[t]}),s=MV(t);let c=null;R.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Ba({audio:s},r)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new pe($.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(R)}const u=new Xg(c,t,s,r);return i.onSuccess(u.getTrackId()),R.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:l6,createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:i,encoderConfig:s}=t;let{source:c}=t;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:s},h=Zt(8,"track-buf-"),f=$e.reportApiInvoke(null,{id:h,tag:ln.TRACER,name:wn.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(G("DISABLE_WEBAUDIO"))throw new pe($.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const g=c;if(!(c instanceof AudioBuffer))try{c=await async function(x,S){let C=null;if(typeof x=="string"){const P=wB.get(x);if(P)return R.debug("use cached audio resource: ",x),P;try{C=(await Ro(()=>Mi.get(x,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new pe($.FETCH_AUDIO_FILE_FAILED,j.toString())}}else C=await new De((j,W)=>{const K=new FileReader;K.onload=J=>{J.target?j(J.target.result):W(new pe($.READ_LOCAL_AUDIO_FILE_ERROR))},K.onerror=()=>{W(new pe($.READ_LOCAL_AUDIO_FILE_ERROR))},K.readAsArrayBuffer(x)});const U=await function(P){const j=Wp();return new De((W,K)=>{j.decodeAudioData(P,J=>{W(J)},J=>{K(new pe($.DECODE_AUDIO_FILE_FAILED,J.toString()))})})}(C);return typeof x=="string"&&S&&wB.set(x,U),U}(c,i)}catch(x){return f.onError(x),x.throw(R)}const v=new vge(c),_=new gge(g,v,s?Rb(s):{},h);return R.info("create buffer source audio track success, trackId:",h),f.onSuccess(_.getTrackId()),_},setAppType:function(t){if(R.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw R.debug("Invalid appType"),new ce($.INVALID_PARAMS,"invalid app type",t);an("APP_TYPE",Math.floor(t))},setLogLevel:function(t){R.setLogLevel(t)},enableLogUpload:function(){G("USE_NEW_LOG")?an("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){G("USE_NEW_LOG")?an("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new N8},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=$e.reportApiInvoke(null,{tag:ln.TRACER,name:wn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Vn||t instanceof zp)){const g=new ce($.INVALID_TRACK,"the parameter is not a audio track");return i.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const s=t instanceof Vn?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,h=c;const f=Date.now();return new De(g=>{const v=setInterval(()=>{const _=t.getVolumeLevel();u=_>u?_:u,h=_<h?_:h;const x=u-h>1e-4,S=Date.now()-f;if(x||S>r){clearInterval(v);const C=x,U={duration:S,deviceLabel:s,maxVolumeLevel:u,result:C};R.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(U))),i.onSuccess(U),g(C)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=$e.reportApiInvoke(null,{tag:ln.TRACER,name:wn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof dn||t instanceof Hp)){const x=new ce($.INVALID_TRACK,"the parameter is not a video track");return i.onError(x),x.throw()}r&&r<1e3&&(r=1e3);const s=t instanceof dn?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Nr()||mb())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let f=0,g=0;try{const x=Date.now();f=await function(S,C,U,P){let j,W=0,K=null;return new De((J,re)=>{function ie(){W>P&&j&&(j(),J(W));const Z=U.getContext("2d");if(!Z){const Ee=new ce($.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(Ee.toString()),void re(Ee)}Z.drawImage(S,0,0,160,120);const se=Z.getImageData(0,0,U.width,U.height),ge=Math.floor(se.data.length/3);if(K){for(let Ee=0;Ee<ge;Ee+=3)if(se.data[Ee]!==K[Ee])return W+=1,void(K=se.data);K=se.data}else K=se.data}setTimeout(()=>{j&&(j(),J(W))},C),j=_A(()=>{ie()},30)})}(u,r,h,4),g=Date.now()-x}catch(x){throw i.onError(x),x}Lve===Ht.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=f>4,_={duration:g,changedPicNum:f,deviceLabel:s,result:v};return R.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),i.onSuccess(_),v},setArea:aI,audioElementPlayCenter:hi,resumeAudioContext:function(){return hi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){eye.processExternalMediaAEC(t)},registerExtensions:function(t){const r=G("PLUGIN_INFO")||[];t.forEach(i=>{"name"in i&&!Te(r).call(r,i.name)&&r.push(i.name);const s=i;s.__registered__=!0,s.logger.hookLog=R.extLog,s.reporter.hookApiInvoke=$e.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(c=>{s.parameters[c]=G(c)})}),L$("PLUGIN_INFO",r)},ChannelMediaRelayError:qp,ChannelMediaRelayEvent:al,ChannelMediaRelayState:Zi,RemoteStreamFallbackType:dge,RemoteStreamType:lge,ConnectionDisconnectedReason:Dt,AudienceLatencyLevelType:Ume,AREAS:qt,preload:async function(t,r,i,s){return NI(t,r,i,s)},startLastmileProbeTest:async function(t,r,i,s){let c={state:"unavailable"};await NI(t,r,i,s);const u=await RI({appId:t,cname:r,token:i||t,uid:s,cloudProxyServer:"disabled"});if(!u)return c;await AI(u);let h,f=sW({mode:"rtc",codec:"vp8"});try{h=await f.join(t,r,i,s,{networkQualityProbe:!0})}catch{return c}const g=new Vve,v=g.createMuteAudioTrack();let _=await l6({mediaStreamTrack:v});await f.publish([_]);let[x,S,C]=await new De((J,re)=>{const ie=setTimeout(()=>{clearTimeout(ie),J([!0,null,"audio"])},5e3);f.on("user-published",async(Z,se)=>{Z.uid===h&&(clearTimeout(ie),J([!1,Z,se]))})});if(x||!S)return await f.unpublish([_]),await f.leave(),_.close(),g.close(),c;await f.subscribe(S,C),await new De((J,re)=>{const ie=setTimeout(()=>{clearTimeout(ie),J(null)},5e3)});let U=f.getRTCStats(),P=f.getLocalAudioStats();const j=U.RTT,W=P.sendJitterMs,K=P.currentPacketLossRate;return c={state:"complete",rtt:j,packetLossRate:K,jitter:W,networkQuality:((J,re,ie)=>{let Z=1;if(ie>0){let ht=Math.log(100*ie)/Math.log(2)+1;ht=Math.min(5,Math.max(0,ht)),Z=1-ht/5}let se=1;if(J>0){let ht=Math.log(J/40)/Math.log(2)+1;ht=Math.min(5,Math.max(0,ht)),se=1-ht/5}let ge=1;if(re>0){let ht=Math.log(re/10)/Math.log(2.5)+1;ht=Math.min(5,Math.max(0,ht)),ge=1-ht/5}const Ee=.5*Z+.3*se+.2*ge;let Fe=0;return Fe=Ee>=.8?1:Ee>=.6?2:Ee>=.4?3:Ee>=.2?4:5,Fe})(j,W,K)},await f.unsubscribe(S),await f.unpublish([_]),await f.leave(),_.close(),g.close(),await AI(u),c}});return Object.defineProperties(tr,{onAudioAutoplayFailed:{get:()=>Fi.onAudioAutoplayFailed,set:t=>{Fi.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Fi.onAutoplayFailed,set:t=>{Fi.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>tr._onSecurityPolicyViolation,set(t){tr._onSecurityPolicyViolation=t,dW(t)}},__CLIENT_LIST__:{get:()=>G("SHOW_GLOBAL_CLIENT_LIST")?Uu:[]}}),Ga.on(ku.CAMERA_DEVICE_CHANGED,t=>{R.info("camera device changed",JSON.stringify(t)),tr.onCameraChanged&&tr.onCameraChanged(t),tr.safeEmit(_c.CAMERA_CHANGED,t)}),Ga.on(ku.RECORDING_DEVICE_CHANGED,t=>{R.info("microphone device changed",JSON.stringify(t)),tr.onMicrophoneChanged&&tr.onMicrophoneChanged(t),tr.safeEmit(_c.MICROPHONE_CHANGED,t)}),Ga.on(ku.PLAYOUT_DEVICE_CHANGED,t=>{R.debug("playout device changed",JSON.stringify(t)),tr.onPlaybackDeviceChanged&&tr.onPlaybackDeviceChanged(t),tr.safeEmit(_c.PLAYBACK_DEVICE_CHANGED,t)}),hi.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Fi.onAudioAutoplayFailed&&Fi.onAudioAutoplayFailed()},sn.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),Fi.onAudioAutoplayFailed&&Fi.onAudioAutoplayFailed(),tr.safeEmit(_c.AUTOPLAY_FAILED)}),sn.on(Ur.STATE_CHANGE,(t,r)=>{R.info("audio context state changed: ".concat(r," => ").concat(t)),tr.onAudioContextStateChanged&&tr.onAudioContextStateChanged(t,r),tr.safeEmit(_c.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),jn.on(Tu.NETWORK_STATE_CHANGE,(t,r)=>{R.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=tr),tr})})(Ute);var oKe=Ute.exports;const Qf=ar(oKe);function cKe(){var Ue,Me,et,Re,nt,ut,Kt,Rn,Pe,lt,Et;const{appointmentId:e}=Vw(),n=As(),[a,o]=Y.useState(null),[d,p]=Y.useState(!0),[m,y]=Y.useState(!1),[b,E]=Y.useState("video"),[T,w]=Y.useState([]),[N,D]=Y.useState(""),[A,k]=Y.useState({video:!0,audio:!0,speaker:!0}),[O,F]=Y.useState(null),[M,V]=Y.useState(null),[H,B]=Y.useState(null),[z,q]=Y.useState([]),[Q,ee]=Y.useState(!1),oe=Y.useRef(null),ne=Y.useRef(null);Y.useEffect(()=>(fe(),ue(),()=>{Se()}),[e]);const ue=()=>{const Ae=Qf.createClient({mode:"rtc",codec:"vp8"});Ae.on("user-published",async(wt,Xe)=>{await Ae.subscribe(wt,Xe),Xe==="video"&&(q($t=>[...$t.filter(At=>At.uid!==wt.uid),wt]),ne.current&&wt.videoTrack.play(ne.current)),Xe==="audio"&&wt.audioTrack.play()}),Ae.on("user-unpublished",wt=>{q(Xe=>Xe.filter($t=>$t.uid!==wt.uid))}),Ae.on("user-left",wt=>{q(Xe=>Xe.filter($t=>$t.uid!==wt.uid))}),F(Ae)},Se=async()=>{M&&(M.stop(),M.close()),H&&(H.stop(),H.close()),O&&Q&&await O.leave()},fe=async()=>{try{const{data:Ae}=await qa.getAppointmentDetails(e);o(Ae)}catch{it.error("Failed to load appointment details"),n("/doctors")}finally{p(!1)}},we=async()=>{if(!O||!(a!=null&&a.videoRoom)){it.error("Video call not available");return}try{const{config:Ae}=a.videoRoom;if(Ae.type==="agora"&&Ae.appId&&Ae.token){await O.join(Ae.appId,Ae.channelName,Ae.token,Ae.uid);const wt=await Qf.createCameraVideoTrack(),Xe=await Qf.createMicrophoneAudioTrack();V(wt),B(Xe),oe.current&&wt.play(oe.current),await O.publish([wt,Xe]),ee(!0),it.success("Joined video call successfully")}else it.error("Video call configuration not available")}catch(Ae){console.error("Error joining video call:",Ae),it.error("Failed to join video call")}},he=async()=>{try{await Se(),ee(!1),q([]),it.success("Left video call")}catch(Ae){console.error("Error leaving video call:",Ae)}},be=async()=>{try{await qa.startConsultation(e),y(!0),(a==null?void 0:a.type)==="video"&&await we(),it.success("Consultation started")}catch{it.error("Failed to start consultation")}},ae=async()=>{try{Q&&await he(),await qa.endConsultation(e),y(!1),it.success("Consultation ended"),n("/consultation-summary/"+e)}catch{it.error("Failed to end consultation")}},de=()=>{if(!N.trim())return;const Ae={id:Date.now(),text:N,sender:"patient",timestamp:new Date};w([...T,Ae]),D("")},xe=async Ae=>{if(Ae==="video"&&M){const wt=!A.video;await M.setEnabled(wt),k(Xe=>({...Xe,video:wt}))}else if(Ae==="audio"&&H){const wt=!A.audio;await H.setEnabled(wt),k(Xe=>({...Xe,audio:wt}))}else Ae==="speaker"&&k(wt=>({...wt,speaker:!wt.speaker}))};return d?l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})}):a?l.jsxs("div",{className:"min-h-screen bg-[#0a0f1a]",children:[l.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:l.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("button",{onClick:()=>n("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:l.jsx(oo,{className:"w-5 h-5 text-slate-400"})}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:((et=(Me=(Ue=a.doctor)==null?void 0:Ue.name)==null?void 0:Me[0])==null?void 0:et.toUpperCase())||"D"}),l.jsxs("div",{children:[l.jsxs("h1",{className:"text-lg font-bold text-white",children:["Dr. ",(Re=a.doctor)==null?void 0:Re.name]}),l.jsx("p",{className:"text-sm text-slate-400",children:(nt=a.doctor)==null?void 0:nt.specialization})]})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.status==="confirmed"?"bg-green-500/20 text-green-400":a.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-slate-500/20 text-slate-400"}`,children:a.status})})]})}),m?l.jsxs("div",{className:"h-[calc(100vh-80px)] flex",children:[l.jsxs("div",{className:"flex-1 bg-slate-900 relative",children:[b==="video"&&l.jsxs("div",{className:"h-full relative",children:[l.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:z.length>0?l.jsx("div",{ref:ne,className:"w-full h-full",style:{background:"#1e293b"}}):l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-4xl font-bold text-white mx-auto mb-4",children:((lt=(Pe=(Rn=a.doctor)==null?void 0:Rn.name)==null?void 0:Pe[0])==null?void 0:lt.toUpperCase())||"D"}),l.jsxs("p",{className:"text-white text-lg",children:["Dr. ",(Et=a.doctor)==null?void 0:Et.name]}),l.jsx("p",{className:"text-slate-400",children:Q?"Waiting for doctor to join...":"Video consultation ready"})]})}),Q&&l.jsxs("div",{className:"absolute top-4 right-4 w-48 h-36 bg-slate-800 rounded-lg overflow-hidden border-2 border-slate-600",children:[l.jsx("div",{ref:oe,className:"w-full h-full",style:{background:"#1e293b"}}),l.jsx("div",{className:"absolute bottom-2 left-2 text-white text-xs bg-black/50 px-2 py-1 rounded",children:"You"})]}),l.jsx("div",{className:"absolute top-4 left-4",children:l.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${Q?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:[l.jsx("div",{className:`w-2 h-2 rounded-full ${Q?"bg-green-400":"bg-yellow-400"} animate-pulse`}),Q?"Connected":"Connecting..."]})}),Q&&l.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:l.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/90 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm",children:[l.jsx(om,{className:"w-4 h-4"}),z.length+1," participants"]})})]}),l.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2",children:l.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/90 backdrop-blur-sm rounded-full px-6 py-3",children:[l.jsx("button",{onClick:()=>xe("audio"),className:`p-3 rounded-full transition-colors ${A.audio?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.audio?"Mute microphone":"Unmute microphone",children:A.audio?l.jsx(jJ,{className:"w-5 h-5"}):l.jsx(kJ,{className:"w-5 h-5"})}),l.jsx("button",{onClick:()=>xe("video"),className:`p-3 rounded-full transition-colors ${A.video?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.video?"Turn off camera":"Turn on camera",children:A.video?l.jsx(s2,{className:"w-5 h-5"}):l.jsx(wP,{className:"w-5 h-5"})}),l.jsx("button",{onClick:()=>xe("speaker"),className:`p-3 rounded-full transition-colors ${A.speaker?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.speaker?"Mute speaker":"Unmute speaker",children:A.speaker?l.jsx(CTe,{className:"w-5 h-5"}):l.jsx(NTe,{className:"w-5 h-5"})}),l.jsx("button",{className:"p-3 rounded-full bg-slate-700 text-white hover:bg-slate-600 transition-colors",title:"Share screen",children:l.jsx(yTe,{className:"w-5 h-5"})}),l.jsx("button",{onClick:ae,className:"p-3 rounded-full bg-red-500 hover:bg-red-600 text-white transition-colors",title:"End consultation",children:l.jsx(ha,{className:"w-5 h-5"})})]})})]}),l.jsxs("div",{className:"w-80 bg-[#111827] border-l border-slate-700 flex flex-col",children:[l.jsx("div",{className:"p-4 border-b border-slate-700",children:l.jsx("h3",{className:"text-white font-medium",children:"Chat"})}),l.jsx("div",{className:"flex-1 p-4 overflow-y-auto space-y-3",children:T.map(Ae=>l.jsx("div",{className:`flex ${Ae.sender==="patient"?"justify-end":"justify-start"}`,children:l.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${Ae.sender==="patient"?"bg-cyan-500 text-white":"bg-slate-700 text-white"}`,children:Ae.text})},Ae.id))}),l.jsx("div",{className:"p-4 border-t border-slate-700",children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:N,onChange:Ae=>D(Ae.target.value),onKeyPress:Ae=>Ae.key==="Enter"&&de(),placeholder:"Type a message...",className:"flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500"}),l.jsx("button",{onClick:de,className:"bg-cyan-500 hover:bg-cyan-600 text-white p-2 rounded-lg transition-colors",children:l.jsx(Bm,{className:"w-4 h-4"})})]})})]})]}):l.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Appointment Details"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(ki,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Date & Time"}),l.jsxs("p",{className:"text-slate-400 text-sm",children:[new Date(a.date).toLocaleDateString()," at ",a.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Hd,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Consultation Type"}),l.jsx("p",{className:"text-slate-400 text-sm capitalize",children:a.type})]})]}),a.symptoms&&l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(li,{className:"w-5 h-5 text-cyan-400 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Symptoms"}),l.jsx("p",{className:"text-slate-400 text-sm",children:a.symptoms})]})]})]})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Doctor Information"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(AJ,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Experience"}),l.jsxs("p",{className:"text-slate-400 text-sm",children:[((ut=a.doctor)==null?void 0:ut.experience)||"5+"," years"]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(xP,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Location"}),l.jsx("p",{className:"text-slate-400 text-sm",children:((Kt=a.doctor)==null?void 0:Kt.location)||"Online"})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(zc,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Rating"}),l.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(Ae=>l.jsx(zc,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},Ae)),l.jsx("span",{className:"text-slate-400 text-sm ml-1",children:"(4.8)"})]})]})]})]})]})]}),l.jsx("div",{className:"mt-8 text-center",children:l.jsxs("button",{onClick:be,className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white px-8 py-4 rounded-xl font-medium transition-all inline-flex items-center gap-2",children:[l.jsx(Hd,{className:"w-5 h-5"}),"Start Consultation"]})})]})]}):l.jsxs("div",{className:"text-center py-12",children:[l.jsx(go,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),l.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Appointment Not Found"}),l.jsx("p",{className:"text-slate-400",children:"The appointment you're looking for doesn't exist."})]})}function lKe(){const{appointmentId:e}=Vw(),n=As(),[a,o]=Y.useState(null),[d,p]=Y.useState(!0),[m,y]=Y.useState(0),[b,E]=Y.useState(""),[T,w]=Y.useState(!1),[N,D]=Y.useState("summary");Y.useEffect(()=>{A()},[e]);const A=async()=>{try{const{data:V}=await qa.getConsultationSummary(e);o(V)}catch{it.error("Failed to load consultation summary"),n("/doctors")}finally{p(!1)}},k=async()=>{if(m===0){it.error("Please provide a rating");return}w(!0);try{await qa.submitReview(e,{rating:m,review:b}),it.success("Review submitted successfully"),o(V=>({...V,reviewSubmitted:!0}))}catch{it.error("Failed to submit review")}finally{w(!1)}},O=async()=>{try{const V=await qa.downloadPrescription(e),H=new Blob([V.data],{type:"application/pdf"}),B=window.URL.createObjectURL(H),z=document.createElement("a");z.href=B,z.download=`prescription-${e}.pdf`,z.click(),window.URL.revokeObjectURL(B)}catch{it.error("Failed to download prescription")}};if(d)return l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})});const F={doctor:{name:"Dr. Sarah Johnson",specialization:"General Physician"},date:new Date().toISOString(),duration:"30 minutes",diagnosis:"Vitamin D deficiency with mild fatigue symptoms",prescription:[{medication:"Vitamin D3 Supplement",dosage:"1000 IU daily",duration:"3 months",instructions:"Take with food, preferably in the morning"},{medication:"Multivitamin",dosage:"1 tablet daily",duration:"1 month",instructions:"Take after breakfast"}],recommendations:["Get 15-20 minutes of sunlight exposure daily","Include vitamin D rich foods like fatty fish, eggs, and fortified milk","Regular exercise to improve energy levels","Follow-up blood test in 3 months"],followUp:{date:new Date(Date.now()+90*24*60*60*1e3).toISOString(),type:"Blood test review"},notes:"Patient reported fatigue and low energy levels. Blood work shows vitamin D deficiency at 18 ng/mL (normal: 30-100). Recommended supplementation and lifestyle changes.",reviewSubmitted:!1},M=a||F;return l.jsxs("div",{className:"min-h-screen bg-[#0a0f1a] pb-8",children:[l.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:l.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("button",{onClick:()=>n("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:l.jsx(oo,{className:"w-5 h-5 text-slate-400"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-lg font-bold text-white",children:"Consultation Summary"}),l.jsxs("p",{className:"text-sm text-slate-400",children:[new Date(M.date).toLocaleDateString(),"  ",M.duration]})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("button",{onClick:O,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[l.jsx(OJ,{className:"w-4 h-4"}),"Download"]}),l.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg transition-colors",children:[l.jsx(TTe,{className:"w-4 h-4"}),"Share"]})]})]})}),l.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 mb-6",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-xl font-bold text-white",children:M.doctor.name[0]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h2",{className:"text-xl font-bold text-white",children:M.doctor.name}),l.jsx("p",{className:"text-slate-400",children:M.doctor.specialization})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("div",{className:"flex items-center gap-1 mb-1",children:[1,2,3,4,5].map(V=>l.jsx(zc,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},V))}),l.jsx("p",{className:"text-sm text-slate-400",children:"4.8 rating"})]})]})}),l.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-xl w-fit mb-6",children:[l.jsx("button",{onClick:()=>D("summary"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="summary"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Summary"}),l.jsx("button",{onClick:()=>D("prescription"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="prescription"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Prescription"}),l.jsx("button",{onClick:()=>D("followup"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="followup"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Follow-up"})]}),l.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[N==="summary"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:l.jsx(ir,{className:"w-5 h-5 text-blue-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Diagnosis"})]}),l.jsx("p",{className:"text-slate-300 leading-relaxed",children:M.diagnosis})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:l.jsx(li,{className:"w-5 h-5 text-green-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Doctor's Notes"})]}),l.jsx("p",{className:"text-slate-300 leading-relaxed",children:M.notes})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center",children:l.jsx(ua,{className:"w-5 h-5 text-cyan-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Recommendations"})]}),l.jsx("ul",{className:"space-y-3",children:M.recommendations.map((V,H)=>l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(ua,{className:"w-5 h-5 text-green-400 mt-0.5 shrink-0"}),l.jsx("span",{className:"text-slate-300",children:V})]},H))})]})]}),N==="prescription"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center",children:l.jsx(Qw,{className:"w-5 h-5 text-purple-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Prescription"})]}),l.jsx("div",{className:"space-y-4",children:M.prescription.map((V,H)=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h4",{className:"font-bold text-white",children:V.medication}),l.jsx("span",{className:"text-sm text-slate-400",children:V.duration})]}),l.jsx("p",{className:"text-cyan-400 font-medium mb-2",children:V.dosage}),l.jsx("p",{className:"text-slate-300 text-sm",children:V.instructions})]},H))}),l.jsx("div",{className:"mt-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(Yw,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-yellow-400 font-medium mb-1",children:"Important"}),l.jsx("p",{className:"text-slate-300 text-sm",children:"Take medications as prescribed. Do not stop or change dosage without consulting your doctor."})]})]})})]}),N==="followup"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center",children:l.jsx(ki,{className:"w-5 h-5 text-orange-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Follow-up Care"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[l.jsx(ic,{className:"w-5 h-5 text-cyan-400"}),l.jsx("h4",{className:"font-bold text-white",children:"Next Appointment"})]}),l.jsxs("p",{className:"text-slate-300",children:[new Date(M.followUp.date).toLocaleDateString()," - ",M.followUp.type]})]}),l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsx("h4",{className:"font-bold text-white mb-2",children:"Health Tracking"}),l.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"Monitor your progress and upload follow-up reports to track improvements."}),l.jsx("button",{className:"bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"Upload Report"})]})]})]})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Quick Actions"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(ki,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Book Follow-up"})]}),l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(D_,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Message Doctor"})]}),l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(sTe,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Save to Health Records"})]})]})]}),!M.reviewSubmitted&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Rate this Consultation"}),l.jsxs("div",{className:"mb-4",children:[l.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"How was your experience?"}),l.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(V=>l.jsx("button",{onClick:()=>y(V),className:`p-1 transition-colors ${V<=m?"text-yellow-400":"text-slate-600 hover:text-slate-400"}`,children:l.jsx(zc,{className:"w-6 h-6 fill-current"})},V))})]}),l.jsx("textarea",{value:b,onChange:V=>E(V.target.value),placeholder:"Share your feedback (optional)",className:"w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-400 resize-none h-20 focus:outline-none focus:border-cyan-500"}),l.jsx("button",{onClick:k,disabled:T||m===0,className:"w-full mt-4 bg-cyan-500 hover:bg-cyan-600 disabled:bg-slate-600 text-white py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:T?l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):l.jsxs(l.Fragment,{children:[l.jsx(Bm,{className:"w-4 h-4"}),"Submit Review"]})})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Health Tracking"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Vitamin D Level"}),l.jsx("span",{className:"text-yellow-400",children:"Improving"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Energy Level"}),l.jsx("span",{className:"text-green-400",children:"Stable"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Sleep Quality"}),l.jsx("span",{className:"text-cyan-400",children:"Good"})]})]})]})]})]})]})]})}function dKe(){const[e,n]=Y.useState(null),[a,o]=Y.useState(null),[d,p]=Y.useState(null),[m,y]=Y.useState([]),[b,E]=Y.useState(!1),[T,w]=Y.useState(!0),[N,D]=Y.useState(!0),A=Y.useRef(null),k=Y.useRef(null),O="e788e8f838484d4dafe4705d682df57c",F="healthai-test";Y.useEffect(()=>(M(),()=>{B()}),[]);const M=()=>{const Q=Qf.createClient({mode:"rtc",codec:"vp8"});Q.on("user-published",async(ee,oe)=>{await Q.subscribe(ee,oe),oe==="video"&&(y(ne=>[...ne.filter(ue=>ue.uid!==ee.uid),ee]),k.current&&ee.videoTrack.play(k.current)),oe==="audio"&&ee.audioTrack.play()}),Q.on("user-unpublished",ee=>{y(oe=>oe.filter(ne=>ne.uid!==ee.uid))}),Q.on("user-left",ee=>{y(oe=>oe.filter(ne=>ne.uid!==ee.uid))}),n(Q)},V=async()=>{if(e)try{const Q=Math.floor(Math.random()*1e4);let ee=null;try{const Se=await(await fetch("/api/doctors/generate-video-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelName:F,uid:Q})})).json();Se.success&&(ee=Se.token,console.log("Generated token:",ee?"Token received":"No token (testing mode)"))}catch(ue){console.log("Failed to get token from server, using null token:",ue)}await e.join(O,F,ee,Q);const oe=await Qf.createCameraVideoTrack(),ne=await Qf.createMicrophoneAudioTrack();o(oe),p(ne),A.current&&oe.play(A.current),await e.publish([oe,ne]),E(!0),it.success("Joined video call successfully!")}catch(Q){console.error("Error joining channel:",Q),it.error("Failed to join video call: "+Q.message)}},H=async()=>{if(e)try{await B(),E(!1),y([]),it.success("Left video call")}catch(Q){console.error("Error leaving channel:",Q),it.error("Failed to leave video call")}},B=async()=>{a&&(a.stop(),a.close(),o(null)),d&&(d.stop(),d.close(),p(null)),e&&b&&await e.leave()},z=async()=>{if(a){const Q=!T;await a.setEnabled(Q),w(Q)}},q=async()=>{if(d){const Q=!N;await d.setEnabled(Q),D(Q)}};return l.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:l.jsxs("div",{className:"max-w-6xl mx-auto",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Video Call Test"}),l.jsx("p",{className:"text-slate-400",children:"Test your Agora.io video calling setup"}),l.jsx("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:l.jsxs("p",{className:"text-sm text-slate-300",children:[l.jsx("strong",{children:"Channel:"})," ",F," | ",l.jsx("strong",{children:"App ID:"})," ",O.substring(0,8),"..."]})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[l.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[l.jsx("div",{ref:A,className:"w-full h-full bg-slate-800"}),l.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:["You ",b?"(Live)":"(Preview)"]}),!T&&l.jsx("div",{className:"absolute inset-0 bg-slate-800 flex items-center justify-center",children:l.jsx(wP,{className:"w-16 h-16 text-slate-400"})})]}),l.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[m.length>0?l.jsx("div",{ref:k,className:"w-full h-full bg-slate-800"}):l.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Hd,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:b?"Waiting for others to join...":"Remote participant will appear here"})]})}),m.length>0&&l.jsx("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:"Remote User"})]})]}),l.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[l.jsx("button",{onClick:q,className:`p-4 rounded-full transition-colors ${N?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!b,children:N?l.jsx(jJ,{className:"w-6 h-6"}):l.jsx(kJ,{className:"w-6 h-6"})}),l.jsx("button",{onClick:z,className:`p-4 rounded-full transition-colors ${T?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!b,children:T?l.jsx(Hd,{className:"w-6 h-6"}):l.jsx(wP,{className:"w-6 h-6"})}),b?l.jsxs("button",{onClick:H,className:"bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[l.jsx(ETe,{className:"w-5 h-5"}),"Leave Call"]}):l.jsxs("button",{onClick:V,className:"bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[l.jsx(d2,{className:"w-5 h-5"}),"Join Call"]})]}),l.jsx("div",{className:"text-center",children:l.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${b?"bg-green-500/20 text-green-400":"bg-slate-500/20 text-slate-400"}`,children:[l.jsx("div",{className:`w-2 h-2 rounded-full ${b?"bg-green-400 animate-pulse":"bg-slate-400"}`}),b?`Connected (${m.length+1} participants)`:"Not connected"]})}),l.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Testing Instructions:"}),l.jsxs("ol",{className:"text-slate-300 space-y-2 list-decimal list-inside",children:[l.jsx("li",{children:'Click "Join Call" to start the video call'}),l.jsx("li",{children:"Allow camera and microphone permissions when prompted"}),l.jsx("li",{children:"Open this page in another browser tab/window to test with multiple participants"}),l.jsx("li",{children:"Test the mute/unmute and video on/off controls"}),l.jsx("li",{children:"Check that you can see and hear other participants"})]}),l.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:l.jsxs("p",{className:"text-blue-400 text-sm",children:[l.jsx("strong",{children:"Note:"})," This is using your Agora.io free tier (10,000 minutes/month). Perfect for testing and development!"]})}),l.jsxs("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[l.jsx("h4",{className:"text-yellow-400 font-medium mb-2",children:" Troubleshooting"}),l.jsxs("div",{className:"text-yellow-300 text-sm space-y-1",children:[l.jsx("p",{children:l.jsx("strong",{children:"If video call fails:"})}),l.jsx("p",{children:" Check browser console for error messages"}),l.jsx("p",{children:" Ensure camera/microphone permissions are granted"}),l.jsx("p",{children:" Try disabling token authentication in Agora Console"}),l.jsx("p",{children:" Check server logs for token generation issues"})]})]}),l.jsxs("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[l.jsx("h4",{className:"text-green-400 font-medium mb-2",children:" Quick Fix"}),l.jsx("div",{className:"text-green-300 text-sm",children:l.jsxs("p",{children:[l.jsx("strong",{children:"Easiest solution:"}),' Go to Agora Console  Project Settings  Change Authentication from "App ID + Token" to "App ID only"']})})]})]})]})})}function uKe(){const[e,n]=Y.useState(""),[a,o]=Y.useState(!1),[d,p]=Y.useState(null),m=async y=>{if(y.preventDefault(),!e){it.error("Please enter an email address");return}o(!0),p(null);try{const E=await(await fetch("/api/doctors/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})})).json();E.success?(p({success:!0,message:E.message}),it.success("Test email sent successfully!")):(p({success:!1,message:E.message}),it.error("Failed to send email"))}catch(b){console.error("Email test error:",b),p({success:!1,message:b.message}),it.error("Failed to send email")}finally{o(!1)}};return l.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:l.jsxs("div",{className:"max-w-2xl mx-auto",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Email Test"}),l.jsx("p",{className:"text-slate-400",children:"Test your SMTP email configuration"})]}),l.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[l.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(P_,{className:"w-5 h-5 text-cyan-400"}),"Current SMTP Configuration"]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"Host:"}),l.jsx("span",{className:"text-white ml-2",children:"smtp.gmail.com"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"Port:"}),l.jsx("span",{className:"text-white ml-2",children:"587"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"User:"}),l.jsx("span",{className:"text-white ml-2",children:"tech@colabplatforms.com"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"From:"}),l.jsx("span",{className:"text-white ml-2",children:"HealthAI <tech@colabplatforms.com>"})]})]})]}),l.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Send Test Email"}),l.jsxs("form",{onSubmit:m,className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Test Email Address"}),l.jsx("input",{type:"email",value:e,onChange:y=>n(y.target.value),placeholder:"Enter email to receive test appointment confirmation",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500",required:!0})]}),l.jsx("button",{type:"submit",disabled:a,className:"w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-slate-600 disabled:to-slate-600 text-white py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2",children:a?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Sending..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Bm,{className:"w-5 h-5"}),"Send Test Email"]})})]})]}),d&&l.jsxs("div",{className:`rounded-2xl p-6 ${d.success?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"}`,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.success?l.jsx(ua,{className:"w-6 h-6 text-green-400"}):l.jsx(go,{className:"w-6 h-6 text-red-400"}),l.jsx("h3",{className:`text-lg font-bold ${d.success?"text-green-400":"text-red-400"}`,children:d.success?"Email Sent Successfully!":"Email Failed"})]}),l.jsx("p",{className:`${d.success?"text-green-300":"text-red-300"}`,children:d.message}),d.success&&l.jsxs("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:"What to expect:"}),l.jsxs("ul",{className:"text-slate-300 text-sm space-y-1",children:[l.jsx("li",{children:' Check your inbox for "Appointment Confirmation - HealthAI"'}),l.jsx("li",{children:" The email will contain appointment details and a join link"}),l.jsx("li",{children:" It may take a few minutes to arrive"}),l.jsx("li",{children:" Check spam folder if not received"})]})]})]}),l.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Email Features"}),l.jsxs("div",{className:"space-y-4 text-slate-300",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Appointment Confirmation"}),l.jsx("p",{className:"text-sm",children:"Professional HTML email with appointment details, doctor info, and video call join link."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Automated Reminders"}),l.jsx("p",{className:"text-sm",children:"System sends reminders 24 hours before and 30 minutes before appointments."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Mobile Responsive"}),l.jsx("p",{className:"text-sm",children:"Emails look great on all devices with touch-friendly buttons and responsive design."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Professional Design"}),l.jsx("p",{className:"text-sm",children:"Branded emails with HealthAI colors, gradients, and professional layout."})]})]})]}),l.jsxs("div",{className:"mt-8 bg-yellow-500/10 border border-yellow-500/20 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-yellow-400 mb-4",children:"Troubleshooting"}),l.jsxs("div",{className:"space-y-2 text-yellow-300 text-sm",children:[l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Gmail App Password:"})," Make sure you're using an app password, not your regular Gmail password"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"2FA Required:"})," Gmail requires 2-factor authentication to generate app passwords"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Less Secure Apps:"}),' App passwords bypass the need for "less secure apps" setting']}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Rate Limits:"})," Gmail has sending limits (500 emails/day for free accounts)"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Spam Filters:"})," Test emails might go to spam initially"]})]})]})]})})}const hKe=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],fl={startTime:"09:00",endTime:"18:00",slotDuration:30};function pKe(){const[e,n]=Y.useState(fl),[a,o]=Y.useState({}),[d,p]=Y.useState({}),[m,y]=Y.useState(!1),[b,E]=Y.useState(!0),T=()=>{const H=[],B=new Date;for(let z=0;z<7;z++){const q=new Date(B);q.setDate(B.getDate()+z),H.push({date:q.toISOString().split("T")[0],dayName:hKe[q.getDay()],displayDate:q.toLocaleDateString("en-US",{month:"short",day:"numeric"}),isToday:z===0})}return H},[w]=Y.useState(T());Y.useEffect(()=>{N()},[]);const N=async()=>{var H,B,z,q,Q,ee,oe;try{const{data:ne}=await qa.getMyAvailability(),ue={startTime:((B=(H=ne.availability)==null?void 0:H.settings)==null?void 0:B.startTime)||fl.startTime,endTime:((q=(z=ne.availability)==null?void 0:z.settings)==null?void 0:q.endTime)||fl.endTime,slotDuration:((ee=(Q=ne.availability)==null?void 0:Q.settings)==null?void 0:ee.slotDuration)||fl.slotDuration};n(ue),(oe=ne.availability)!=null&&oe.blockedSlots&&p(ne.availability.blockedSlots),D(ue)}catch(ne){console.error("Failed to fetch availability:",ne),D(fl)}finally{E(!1)}},D=H=>{H||(H=fl);const B={},z=H.startTime||fl.startTime,q=H.endTime||fl.endTime,Q=H.slotDuration||fl.slotDuration,ee=z.split(":"),oe=q.split(":");if(ee.length<2||oe.length<2){console.error("Invalid time format");return}const ne=parseInt(ee[0],10),ue=parseInt(ee[1],10),Se=parseInt(oe[0],10),fe=parseInt(oe[1],10);w.forEach(we=>{B[we.date]=[];let he=ne*60+ue;const be=Se*60+fe;for(;he<be;){const ae=Math.floor(he/60),de=he%60,xe=`${ae.toString().padStart(2,"0")}:${de.toString().padStart(2,"0")}`,Ue=new Date(`2000-01-01T${xe}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});B[we.date].push({time:xe,display:Ue}),he+=Q}}),o(B)},A=(H,B)=>{const z={...e,[H]:B};n(z),D(z)},k=(H,B)=>{p(z=>{const q=z[H]||[];return q.includes(B)?{...z,[H]:q.filter(Q=>Q!==B)}:{...z,[H]:[...q,B]}})},O=H=>{const B=a[H]||[];(d[H]||[]).length===B.length?p(q=>({...q,[H]:[]})):p(q=>({...q,[H]:B.map(Q=>Q.time)}))},F=(H,B)=>(d[H]||[]).includes(B),M=H=>{const B=a[H]||[],z=d[H]||[];return B.length>0&&z.length===B.length},V=async()=>{var H,B;y(!0);try{const z=await qa.updateMyAvailability({settings:e,blockedSlots:d});console.log("Save response:",z.data),it.success("Availability saved successfully!")}catch(z){console.error("Failed to save:",z),it.error(((B=(H=z.response)==null?void 0:H.data)==null?void 0:B.message)||"Failed to save availability")}finally{y(!1)}};return b?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading availability..."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Manage Your Slots"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Set your operating hours and block unavailable times"})]}),l.jsxs("button",{onClick:V,disabled:m,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50",children:[m?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsx(LJ,{className:"w-5 h-5"}),"Save Changes"]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(ic,{className:"w-5 h-5 text-cyan-500"}),"Operating Hours"]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Start Time"}),l.jsx("select",{value:e.startTime,onChange:H=>A("startTime",H.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(H,B)=>{const z=`${B.toString().padStart(2,"0")}:00`,q=new Date(`2000-01-01T${z}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return l.jsx("option",{value:z,children:q},z)})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"End Time"}),l.jsx("select",{value:e.endTime,onChange:H=>A("endTime",H.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(H,B)=>{const z=`${B.toString().padStart(2,"0")}:00`,q=new Date(`2000-01-01T${z}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return l.jsx("option",{value:z,children:q},z)})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Slot Duration"}),l.jsxs("select",{value:e.slotDuration,onChange:H=>A("slotDuration",parseInt(H.target.value)),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:[l.jsx("option",{value:15,children:"15 minutes"}),l.jsx("option",{value:30,children:"30 minutes"}),l.jsx("option",{value:45,children:"45 minutes"}),l.jsx("option",{value:60,children:"60 minutes"})]})]})]}),l.jsxs("p",{className:"text-sm text-slate-400 mt-3",children:["Current: ",e.startTime," to ",e.endTime,", ",e.slotDuration," min slots"]})]}),l.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-100 border-2 border-emerald-300"}),l.jsx("span",{className:"text-slate-600",children:"Available"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-4 h-4 rounded-full bg-red-100 border-2 border-red-300"}),l.jsx("span",{className:"text-slate-600",children:"Blocked"})]}),l.jsx("p",{className:"text-slate-400 ml-auto",children:"Click on slots to block/unblock"})]}),l.jsx("div",{className:"space-y-4",children:w.map(H=>{const B=a[H.date]||[],z=M(H.date);return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(ki,{className:"w-5 h-5 text-cyan-500"}),l.jsxs("div",{children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:[H.dayName,H.isToday&&l.jsx("span",{className:"ml-2 text-xs bg-cyan-100 text-cyan-600 px-2 py-0.5 rounded-full",children:"Today"})]}),l.jsx("p",{className:"text-sm text-slate-500",children:H.displayDate})]})]}),l.jsx("button",{onClick:()=>O(H.date),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${z?"bg-emerald-100 text-emerald-600 hover:bg-emerald-200":"bg-red-100 text-red-600 hover:bg-red-200"}`,children:z?l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(gh,{className:"w-4 h-4"})," Unblock All"]}):l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(ha,{className:"w-4 h-4"})," Block Day"]})})]}),l.jsxs("div",{className:"flex flex-wrap gap-2",children:[B.map(q=>{const Q=F(H.date,q.time);return l.jsx("button",{onClick:()=>k(H.date,q.time),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${Q?"bg-red-100 text-red-600 border border-red-200 hover:bg-red-200":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200"}`,children:q.display},q.time)}),B.length===0&&l.jsx("p",{className:"text-slate-400 text-sm py-2",children:"No slots - check your operating hours"})]})]},H.date)})}),l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4",children:[l.jsx("h3",{className:"font-medium text-cyan-800 mb-2",children:" Quick Tips"}),l.jsxs("ul",{className:"text-sm text-cyan-700 space-y-1",children:[l.jsx("li",{children:" Set your operating hours above to auto-generate time slots"}),l.jsx("li",{children:" Click individual slots to block specific times"}),l.jsx("li",{children:' Use "Block Day" to mark entire days as unavailable'}),l.jsx("li",{children:" Don't forget to save your changes!"})]})]})]})}const fKe={"Vitamin D":{foods:[{name:"Fish (salmon, mackerel, rohu)",diet:["non-vegetarian"]},{name:"Egg yolks",diet:["eggetarian","non-vegetarian"]},{name:"Fortified milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushrooms",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Egg bhurji with paneer",diet:["eggetarian","non-vegetarian"]},{name:"Dalia with milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushroom omelette",diet:["eggetarian","non-vegetarian"]},{name:"Almond milk smoothie",diet:["vegan"]}],lunch:[{name:"Fish fry with salad",diet:["non-vegetarian"]},{name:"Fish curry with rice",diet:["non-vegetarian"]},{name:"Egg curry with rice",diet:["eggetarian","non-vegetarian"]},{name:"Mushroom pulao",diet:["vegan","vegetarian"]}],dinner:[{name:"Tandoori fish with vegetables",diet:["non-vegetarian"]},{name:"Paneer tikka",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushroom masala",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Paneer cubes",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Boiled eggs",diet:["eggetarian","non-vegetarian"]},{name:"Orange juice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Get 15-20 minutes of morning sunlight daily","Include fortified foods in your diet"]},"Vitamin B12":{foods:[{name:"Chicken, mutton",diet:["non-vegetarian"]},{name:"Fish",diet:["non-vegetarian"]},{name:"Eggs",diet:["eggetarian","non-vegetarian"]},{name:"Yogurt, milk, paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified cereals",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Nutritional yeast",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Eggs with whole wheat bread",diet:["eggetarian","non-vegetarian"]},{name:"Yogurt with muesli",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Milk smoothie",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified dalia with almond milk",diet:["vegan"]}],lunch:[{name:"Chicken with rice",diet:["non-vegetarian"]},{name:"Fish curry",diet:["non-vegetarian"]},{name:"Paneer salad",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu bhurji",diet:["vegan"]}],dinner:[{name:"Tandoori chicken",diet:["non-vegetarian"]},{name:"Mutton curry",diet:["non-vegetarian"]},{name:"Paneer butter masala",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Soya chunks curry",diet:["vegan"]}],snacks:[{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Almond milk",diet:["vegan"]}],tips:["Vegetarians and vegans should consider B12 supplements","Include fortified foods in every meal"]},Iron:{foods:[{name:"Red meat",diet:["non-vegetarian"]},{name:"Spinach (palak)",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Rajma, chana",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified cereals",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pumpkin seeds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Spinach smoothie",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified dalia",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Poha with peanuts",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],lunch:[{name:"Dal rice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Palak paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Liver curry",diet:["non-vegetarian"]},{name:"Rajma rice",diet:["vegan"]}],dinner:[{name:"Dal soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Grilled meat with vegetables",diet:["non-vegetarian"]}],snacks:[{name:"Pumpkin seeds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dried apricots",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Eat iron-rich foods with Vitamin C for better absorption","Avoid tea/coffee with meals"]},Calcium:{foods:[{name:"Milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Leafy green vegetables",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Almonds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified almond milk",diet:["vegan"]}],breakfast:[{name:"Milk with dalia",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt with fruits",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer paratha",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Almond milk smoothie",diet:["vegan"]}],lunch:[{name:"Paneer curry",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu bhurji",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],dinner:[{name:"Palak paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fish curry",diet:["non-vegetarian"]},{name:"Broccoli soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Almonds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]}],tips:["Include calcium-rich foods in every meal","Get adequate Vitamin D for calcium absorption"]},Hemoglobin:{foods:[{name:"Red meat",diet:["non-vegetarian"]},{name:"Liver",diet:["non-vegetarian"]},{name:"Spinach (palak)",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Beetroot",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Beetroot juice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach paratha",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate smoothie",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],lunch:[{name:"Liver curry",diet:["non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Beetroot salad",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],dinner:[{name:"Grilled meat",diet:["non-vegetarian"]},{name:"Spinach soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dal curry",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Jaggery",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Eat iron-rich foods with Vitamin C","Avoid calcium with iron-rich meals"]}};function mKe(){var be,ae,de,xe,Ue,Me,et;const{user:e}=fa(),[n,a]=Y.useState(!0),[o,d]=Y.useState(!1),[p,m]=Y.useState([]),[y,b]=Y.useState(null),[E,T]=Y.useState(null),[w,N]=Y.useState(""),[D,A]=Y.useState(!1),[k,O]=Y.useState(null),[F,M]=Y.useState(!0),[V,H]=Y.useState(!1);Y.useEffect(()=>{B(),z(),q()},[]);const B=async()=>{var Re;try{const{data:nt}=await Th.getDashboard(),ut=((Re=nt.latestAnalysis)==null?void 0:Re.deficiencies)||[];m(ut.map(Kt=>typeof Kt=="string"?Kt:Kt.name||Kt.nutrient))}catch(nt){console.error("Failed to fetch health data:",nt)}finally{a(!1)}},z=async()=>{try{const Re=localStorage.getItem("token"),ut=await(await fetch("/api/diet-recommendations/diet-plan/active",{headers:{Authorization:`Bearer ${Re}`}})).json();ut.success&&ut.dietPlan&&(b(ut.dietPlan),H(!0))}catch(Re){console.error("Failed to fetch personalized plan:",Re)}},q=async()=>{try{const Re=localStorage.getItem("token"),ut=await(await fetch("/api/diet-recommendations/supplements/active",{headers:{Authorization:`Bearer ${Re}`}})).json();ut.success&&ut.recommendations&&T(ut.recommendations)}catch(Re){console.error("Failed to fetch supplement recommendations:",Re)}},Q=async()=>{d(!0);try{const Re=localStorage.getItem("token"),ut=await(await fetch("/api/diet-recommendations/diet-plan/generate",{method:"POST",headers:{Authorization:`Bearer ${Re}`,"Content-Type":"application/json"}})).json();ut.success?(b(ut.dietPlan),H(!0),it.success("AI-powered diet plan generated!")):it.error(ut.message||"Failed to generate plan")}catch(Re){console.error("Failed to generate AI plan:",Re),it.error("Failed to generate personalized plan")}finally{d(!1)}},ee=async()=>{try{const Re=localStorage.getItem("token"),ut=await(await fetch("/api/diet-recommendations/supplements/generate",{method:"POST",headers:{Authorization:`Bearer ${Re}`,"Content-Type":"application/json"}})).json();ut.success?(T(ut.recommendations),it.success("Supplement recommendations generated!")):it.error(ut.message||"Failed to generate recommendations")}catch(Re){console.error("Failed to generate supplements:",Re),it.error("Failed to generate supplement recommendations")}},oe=()=>{if(w.trim()){const Re=w.split(",").map(nt=>nt.trim()).filter(Boolean);m([...new Set([...p,...Re])]),N(""),A(!1),it.success("Deficiencies added")}},ne=Re=>{m(p.filter(nt=>nt!==Re))},ue=()=>{var ut;const Re={breakfast:[],lunch:[],dinner:[],snacks:[],tips:[],foods:[]},nt=((ut=e==null?void 0:e.profile)==null?void 0:ut.dietaryPreference)||"non-vegetarian";return p.forEach(Kt=>{const Rn=Object.entries(fKe).find(([Pe])=>Kt.toLowerCase().includes(Pe.toLowerCase())||Pe.toLowerCase().includes(Kt.toLowerCase()));if(Rn){const[,Pe]=Rn,lt=Et=>Et.filter(Ae=>Ae.diet.includes(nt)).map(Ae=>Ae.name);Re.breakfast.push(...lt(Pe.breakfast||[])),Re.lunch.push(...lt(Pe.lunch||[])),Re.dinner.push(...lt(Pe.dinner||[])),Re.snacks.push(...lt(Pe.snacks||[])),Re.foods.push(...lt(Pe.foods||[])),Re.tips.push(...Pe.tips||[])}}),Object.keys(Re).forEach(Kt=>{Re[Kt]=[...new Set(Re[Kt])]}),Re},Se=()=>E?p.map(Re=>{const nt=Object.entries(E).find(([ut])=>Re.toLowerCase().includes(ut.toLowerCase())||ut.toLowerCase().includes(Re.toLowerCase()));return nt?{deficiency:Re,...nt[1]}:null}).filter(Boolean):[];if(n)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading your personalized plan..."})]})});const fe=ue(),we=Se(),he=p.length>0&&(fe.breakfast.length>0||fe.lunch.length>0);return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Personalized Diet Plan"}),l.jsxs("p",{className:"text-slate-500 mt-1",children:["AI-generated nutrition guidance based on your health data",((be=e==null?void 0:e.profile)==null?void 0:be.age)&&`  ${e.profile.age} years`,((ae=e==null?void 0:e.profile)==null?void 0:ae.gender)&&`  ${e.profile.gender}`,((de=e==null?void 0:e.profile)==null?void 0:de.dietaryPreference)&&`  ${e.profile.dietaryPreference.charAt(0).toUpperCase()+e.profile.dietaryPreference.slice(1)}`]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[!y&&l.jsx("button",{onClick:Q,disabled:o,className:"px-6 py-3 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-2 disabled:opacity-50",style:{backgroundColor:"#8B7355"},children:o?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Generating..."]}):l.jsxs(l.Fragment,{children:[l.jsx(kh,{className:"w-5 h-5"}),"Generate AI Plan"]})}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:F,onChange:Re=>M(Re.target.checked),className:"w-4 h-4 rounded border-slate-300 focus:ring-2",style:{accentColor:"#8B7355"}}),l.jsx("span",{className:"text-sm text-slate-600",children:"Enable diet recommendations"})]})]})]}),F?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(go,{className:"w-5 h-5 text-amber-500"}),"Detected Deficiencies"]}),l.jsxs("button",{onClick:()=>A(!D),className:"flex items-center gap-1 text-sm text-cyan-600 hover:text-cyan-700",children:[l.jsx(Wc,{className:"w-4 h-4"})," Add Manually"]})]}),((xe=e==null?void 0:e.profile)==null?void 0:xe.dietaryPreference)&&l.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-xl",children:l.jsxs("p",{className:"text-sm text-green-700",children:[l.jsx("strong",{children:"Dietary Preference:"})," ",e.profile.dietaryPreference.charAt(0).toUpperCase()+e.profile.dietaryPreference.slice(1)," ","- All recommendations are filtered to match your preference.",l.jsx(un,{to:"/profile",className:"ml-2 text-cyan-600 hover:text-cyan-700 underline",children:"Change in Profile"})]})}),D&&l.jsxs("div",{className:"mb-4 p-4 bg-slate-50 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Don't have reports? Add your known deficiencies manually:"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:w,onChange:Re=>N(Re.target.value),placeholder:"e.g., Vitamin D, Iron, B12",className:"flex-1 px-4 py-2 bg-white border border-slate-200 rounded-lg text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"}),l.jsx("button",{onClick:oe,className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600",children:"Add"})]})]}),p.length>0?l.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((Re,nt)=>l.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-amber-100 text-amber-700 rounded-full text-sm",children:[Re,l.jsx("button",{onClick:()=>ne(Re),className:"hover:text-amber-900",children:""})]},nt))}):l.jsx("p",{className:"text-slate-500 text-sm",children:"No deficiencies detected. Upload a health report or add deficiencies manually to get personalized recommendations."})]}),y&&V&&l.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl border-2 border-purple-200 p-6 shadow-lg",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-xl font-bold text-purple-900 flex items-center gap-2",children:[l.jsx(kh,{className:"w-6 h-6 text-purple-600"}),"AI-Powered Personalized Diet Plan"]}),l.jsx("button",{onClick:()=>H(!1),className:"text-purple-600 hover:text-purple-800 text-sm",children:"Show Basic Plan"})]}),l.jsxs("p",{className:"text-sm text-purple-700 mb-4",children:["Generated on ",new Date(y.generatedAt).toLocaleDateString(),"  Valid until ",new Date(y.validUntil).toLocaleDateString()]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Daily Calories"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:y.dailyCalorieTarget})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Protein"}),l.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[(Ue=y.macroTargets)==null?void 0:Ue.protein,"g"]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Carbs"}),l.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[(Me=y.macroTargets)==null?void 0:Me.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Fats"}),l.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:[(et=y.macroTargets)==null?void 0:et.fats,"g"]})]})]}),l.jsx("div",{className:"space-y-4",children:Object.entries(y.mealPlan||{}).map(([Re,nt])=>nt&&nt.length>0&&l.jsxs("div",{className:"bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3 capitalize",children:Re.replace(/([A-Z])/g," $1").trim()}),l.jsx("div",{className:"space-y-2",children:nt.map((ut,Kt)=>l.jsx("div",{className:"p-3 bg-purple-50 rounded-lg",children:l.jsxs("div",{className:"flex justify-between items-start",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"font-medium text-purple-900",children:ut.name}),l.jsx("p",{className:"text-sm text-purple-700 mt-1",children:ut.description}),ut.benefits&&l.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[" ",ut.benefits]})]}),l.jsxs("div",{className:"text-right ml-4",children:[l.jsxs("p",{className:"text-sm font-semibold text-purple-900",children:[ut.calories," cal"]}),ut.protein&&l.jsxs("p",{className:"text-xs text-purple-600",children:[ut.protein,"g protein"]})]})]})},Kt))})]},Re))}),y.keyFoods&&y.keyFoods.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"Key Foods to Include"}),l.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:y.keyFoods.map((Re,nt)=>l.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[l.jsx("p",{className:"font-medium text-green-900",children:Re.name}),l.jsx("p",{className:"text-sm text-green-700 mt-1",children:Re.reason}),l.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Frequency: ",Re.frequency]})]},nt))})]}),y.deficiencyCorrections&&y.deficiencyCorrections.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"Deficiency Corrections"}),l.jsx("div",{className:"space-y-3",children:y.deficiencyCorrections.map((Re,nt)=>l.jsxs("div",{className:"p-3 bg-amber-50 rounded-lg border border-amber-200",children:[l.jsx("p",{className:"font-medium text-amber-900",children:Re.deficiency}),l.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:[l.jsx("strong",{children:"Foods:"})," ",Re.indianFoods.join(", ")]}),l.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:[l.jsx("strong",{children:"Meals:"})," ",Re.mealSuggestions.join(", ")]})]},nt))})]}),y.lifestyleRecommendations&&y.lifestyleRecommendations.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsxs("h3",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[l.jsx(gS,{className:"w-5 h-5 text-purple-600"}),"Lifestyle Tips"]}),l.jsx("ul",{className:"space-y-2",children:y.lifestyleRecommendations.map((Re,nt)=>l.jsxs("li",{className:"flex items-start gap-2 text-purple-700",children:[l.jsx(ua,{className:"w-4 h-4 mt-0.5 text-purple-500 shrink-0"}),Re]},nt))})]}),y.avoidFoods&&y.avoidFoods.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-red-900 mb-3",children:"Foods to Avoid"}),l.jsx("div",{className:"space-y-2",children:y.avoidFoods.map((Re,nt)=>l.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[l.jsx("p",{className:"font-medium text-red-900",children:Re.food}),l.jsx("p",{className:"text-sm text-red-700 mt-1",children:Re.reason})]},nt))})]}),l.jsx("button",{onClick:Q,disabled:o,className:"mt-6 w-full px-6 py-3 bg-purple-600 text-white rounded-xl font-medium hover:bg-purple-700 disabled:opacity-50",children:o?"Regenerating...":"Regenerate Plan"})]}),he&&!V&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(mTe,{className:"w-5 h-5 text-green-500"}),"Recommended Foods"]}),l.jsx("div",{className:"flex flex-wrap gap-2",children:fe.foods.slice(0,15).map((Re,nt)=>l.jsx("span",{className:"px-3 py-1.5 bg-green-50 text-green-700 rounded-full text-sm border border-green-200",children:Re},nt))})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(xx,{icon:hTe,title:"Breakfast",color:"amber",items:fe.breakfast,expanded:k==="breakfast",onToggle:()=>O(k==="breakfast"?null:"breakfast")}),l.jsx(xx,{icon:FJ,title:"Lunch",color:"orange",items:fe.lunch,expanded:k==="lunch",onToggle:()=>O(k==="lunch"?null:"lunch")}),l.jsx(xx,{icon:Vm,title:"Dinner",color:"indigo",items:fe.dinner,expanded:k==="dinner",onToggle:()=>O(k==="dinner"?null:"dinner")}),l.jsx(xx,{icon:nc,title:"Snacks",color:"green",items:fe.snacks,expanded:k==="snacks",onToggle:()=>O(k==="snacks"?null:"snacks")})]}),fe.tips.length>0&&l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-2xl p-6",children:[l.jsxs("h2",{className:"text-lg font-semibold text-cyan-800 mb-4 flex items-center gap-2",children:[l.jsx(gS,{className:"w-5 h-5"}),"Nutritional Tips"]}),l.jsx("ul",{className:"space-y-2",children:fe.tips.map((Re,nt)=>l.jsxs("li",{className:"flex items-start gap-2 text-cyan-700",children:[l.jsx(ua,{className:"w-4 h-4 mt-0.5 text-cyan-500 shrink-0"}),Re]},nt))})]}),E&&E.supplements&&E.supplements.length>0?l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(Lh,{className:"w-5 h-5 text-purple-500"}),"AI-Powered Supplement Recommendations"]}),l.jsx("button",{onClick:ee,className:"text-sm text-purple-600 hover:text-purple-700",children:"Regenerate"})]}),l.jsx("p",{className:"text-sm text-slate-500 mb-4",children:E.consultationNote||"Always consult a healthcare provider before starting supplements."}),l.jsx("div",{className:"space-y-4",children:E.supplements.map((Re,nt)=>l.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h3",{className:"font-medium text-purple-800",children:Re.name}),Re.priority&&l.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${Re.priority==="high"?"bg-red-100 text-red-700":Re.priority==="medium"?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700"}`,children:[Re.priority," priority"]})]}),l.jsxs("p",{className:"text-sm text-purple-700 mb-2",children:[l.jsx("strong",{children:"For:"})," ",Re.deficiency]}),l.jsx("p",{className:"text-sm text-purple-700 mb-2",children:Re.reason}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-2 mt-3",children:[l.jsxs("div",{className:"text-sm",children:[l.jsx("strong",{className:"text-purple-800",children:"Dosage:"}),l.jsx("p",{className:"text-purple-600",children:Re.dosage})]}),l.jsxs("div",{className:"text-sm",children:[l.jsx("strong",{className:"text-purple-800",children:"Timing:"}),l.jsx("p",{className:"text-purple-600",children:Re.timing})]})]}),Re.foodAlternatives&&Re.foodAlternatives.length>0&&l.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-lg",children:l.jsxs("p",{className:"text-xs text-green-700",children:[l.jsx("strong",{children:"Food alternatives:"})," ",Re.foodAlternatives.join(", ")]})}),Re.indianBrands&&Re.indianBrands.length>0&&l.jsxs("div",{className:"mt-2 text-xs text-purple-600",children:[l.jsx("strong",{children:"Available brands:"})," ",Re.indianBrands.join(", ")]}),Re.precautions&&l.jsx("div",{className:"mt-2 p-2 bg-amber-50 rounded-lg",children:l.jsxs("p",{className:"text-xs text-amber-700",children:[l.jsx("strong",{children:" Precautions:"})," ",Re.precautions]})})]},nt))}),E.generalGuidance&&E.generalGuidance.length>0&&l.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-xl",children:[l.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"General Guidance"}),l.jsx("ul",{className:"space-y-1",children:E.generalGuidance.map((Re,nt)=>l.jsxs("li",{className:"text-sm text-blue-700 flex items-start gap-2",children:[l.jsx(ua,{className:"w-4 h-4 mt-0.5 shrink-0"}),Re]},nt))})]})]}):we.length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(Lh,{className:"w-5 h-5 text-purple-500"}),"Supplement Recommendations"]}),l.jsx("button",{onClick:ee,className:"px-4 py-2 text-sm text-white rounded-lg hover:shadow-lg",style:{backgroundColor:"#8B7355"},children:"Get AI Recommendations"})]}),l.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"General wellness guidance based on your deficiencies. Always consult a healthcare provider before starting supplements."}),l.jsx("div",{className:"space-y-4",children:we.map((Re,nt)=>l.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:[l.jsx("h3",{className:"font-medium text-purple-800",children:Re.category}),l.jsx("p",{className:"text-sm text-purple-700 mt-1",children:Re.description}),l.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:Re.note})]},nt))})]})]}),!he&&p.length===0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center",children:[l.jsx(nc,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-xl font-semibold text-slate-800 mb-2",children:"No Diet Plan Available"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Upload a health report to get AI-analyzed deficiencies and personalized diet recommendations, or add your known deficiencies manually."}),l.jsx("button",{onClick:()=>A(!0),className:"px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all",children:"Add Deficiencies Manually"})]}),l.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm text-slate-500",children:[l.jsx("strong",{children:"Disclaimer:"})," This diet plan is AI-generated for informational purposes only. It is not a substitute for professional medical advice. Please consult a healthcare provider or registered dietitian before making significant changes to your diet."]})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center",children:[l.jsx(nc,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"Diet Recommendations Disabled"}),l.jsx("p",{className:"text-slate-500",children:"Enable diet recommendations to see your personalized plan."})]})]})}function xx({icon:e,title:n,color:a,items:o,expanded:d,onToggle:p}){const m={amber:"bg-amber-100 text-amber-700",orange:"bg-orange-100 text-orange-700",indigo:"bg-indigo-100 text-indigo-700",green:"bg-green-100 text-green-700"},y={amber:"border-amber-200",orange:"border-orange-200",indigo:"border-indigo-200",green:"border-green-200"};return l.jsxs("div",{className:`bg-white rounded-2xl border-2 ${y[a]} p-5 shadow-sm hover:shadow-md transition-shadow`,children:[l.jsxs("button",{onClick:p,className:"w-full flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-10 h-10 rounded-xl ${m[a]} flex items-center justify-center`,children:l.jsx(e,{className:"w-5 h-5"})}),l.jsx("h3",{className:"font-semibold text-slate-800 text-lg",children:n})]}),d?l.jsx(lTe,{className:"w-5 h-5 text-slate-400"}):l.jsx(o2,{className:"w-5 h-5 text-slate-400"})]}),d&&o.length>0&&l.jsx("ul",{className:"mt-4 space-y-2",children:o.map((b,E)=>l.jsxs("li",{className:"flex items-center gap-2 text-slate-700 text-sm font-medium",children:[l.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${m[a].split(" ")[1].replace("text-","bg-")}`}),b]},E))}),!d&&o.length>0&&l.jsxs("p",{className:"mt-2 text-sm text-slate-600 font-medium",children:[o.length," options available"]})]})}function gKe(){const{user:e}=fa(),n=Ul(),[a,o]=Y.useState([]),[d,p]=Y.useState(""),[m,y]=Y.useState(!1),[b,E]=Y.useState(!1),[T,w]=Y.useState(""),[N,D]=Y.useState(null),[A,k]=Y.useState([]),[O,F]=Y.useState(!0),M=Y.useRef(null),V=Y.useRef(null);Y.useEffect(()=>{(async()=>{try{const oe=localStorage.getItem("token"),ne=await fetch("/api/health/reports",{headers:{Authorization:`Bearer ${oe}`}});if(ne.ok){const ue=await ne.json();k(ue.reports||[])}}catch(oe){console.error("Failed to load reports:",oe)}finally{F(!1)}})()},[]),Y.useEffect(()=>{var oe;if(e&&(async()=>{try{const ne=localStorage.getItem(`chat_history_${e==null?void 0:e.id}`);if(ne){const ue=JSON.parse(ne);o(ue),console.log("Loaded chat history from localStorage:",ue.length,"messages")}else o([{role:"assistant",content:`Hello ${(e==null?void 0:e.name)||"there"}!  I'm your AI health assistant. I can help you understand your health reports, explain medical terms, provide diet guidance, and answer health-related questions. What would you like to know?`,timestamp:new Date}])}catch(ne){console.error("Failed to load chat history:",ne),o([{role:"assistant",content:`Hello ${(e==null?void 0:e.name)||"there"}!  I'm your AI health assistant. How can I help you today?`,timestamp:new Date}])}})(),(oe=n.state)!=null&&oe.selectedText){const ne=n.state.selectedText;p(`Can you explain this: "${ne}"`)}},[e==null?void 0:e.id,n.state,e==null?void 0:e.name]),Y.useEffect(()=>{H()},[a,T]);const H=()=>{var ee;(ee=M.current)==null||ee.scrollIntoView({behavior:"smooth"})},B=(ee,oe)=>{E(!0),w("");let ne=0;const ue=setInterval(()=>{ne<=ee.length?(w(ee.substring(0,ne)),ne++):(clearInterval(ue),E(!1),oe())},15);return()=>clearInterval(ue)},z=async ee=>{if(ee.preventDefault(),!d.trim()||m)return;const oe={role:"user",content:d,timestamp:new Date};o(ue=>[...ue,oe]);const ne=d;p(""),y(!0);try{const ue=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:ne,conversationHistory:a.slice(-10),userReports:A.map(fe=>({type:fe.reportType,date:fe.uploadDate,analysis:fe.analysis,metrics:fe.metrics}))})});if(!ue.ok){const fe=await ue.json().catch(()=>({}));throw console.error("API Error:",ue.status,fe),new Error(fe.message||`Failed to get AI response (${ue.status})`)}const Se=await ue.json();if(Se.success&&Se.response)B(Se.response,()=>{const fe={role:"assistant",content:Se.response,timestamp:new Date};o(he=>[...he,fe]),w("");const we=[...a,oe,fe];localStorage.setItem(`chat_history_${e==null?void 0:e.id}`,JSON.stringify(we))});else throw new Error("Invalid response from AI")}catch(ue){console.error("AI Chat error:",ue),it.error("Failed to get response. Using fallback.");const Se=q(ne);B(Se,()=>{const fe={role:"assistant",content:Se,timestamp:new Date};o(we=>[...we,fe]),w("")})}finally{y(!1)}},q=ee=>{const oe=ee.toLowerCase();return oe.includes("vitamin d")||oe.includes("vitamin-d")?`Based on your query about Vitamin D:

**What is Vitamin D?**
Vitamin D is essential for bone health, immune function, and overall wellbeing.

**Normal Range:** 30-100 ng/mL

**If Low:**
 Get 15-20 minutes of morning sunlight daily
 Eat fish, eggs, fortified milk
 Consider supplements (consult your doctor)

**Symptoms of Deficiency:**
 Fatigue and tiredness
 Bone pain or weakness
 Frequent infections
 Mood changes

Would you like more specific information about your levels?`:oe.includes("iron")||oe.includes("hemoglobin")?`Regarding Iron and Hemoglobin:

**Importance:**
Iron is crucial for producing hemoglobin, which carries oxygen in your blood.

**Normal Hemoglobin:** 12-17 g/dL
**Normal Iron:** 60-170 mcg/dL

**To Increase Iron:**
 Red meat, spinach, dal
 Eat with Vitamin C foods
 Avoid tea/coffee with meals

**Symptoms of Low Iron:**
 Extreme fatigue
 Pale skin
 Shortness of breath
 Cold hands and feet

Consult your doctor if symptoms persist.`:oe.includes("diet")||oe.includes("food")?`For a healthy diet plan:

**General Guidelines:**
 Eat balanced meals with proteins, carbs, and healthy fats
 Include plenty of fruits and vegetables
 Stay hydrated (8-10 glasses of water daily)
 Limit processed foods and sugar

**Based on Your Health Data:**
I can provide personalized diet recommendations based on your deficiencies. Check your Diet Plan page for detailed meal suggestions.

Would you like specific recommendations for any nutrient?`:`Thank you for your question. I'm here to help with:

 Understanding your health reports
 Explaining medical terms and values
 Providing general health guidance
 Diet and lifestyle recommendations
 Symptom information

**Important:** I provide general information only. For medical diagnosis and treatment, please consult with a healthcare professional.

Could you please provide more details about what you'd like to know?`},Q=(ee,oe)=>{navigator.clipboard.writeText(ee),D(oe),setTimeout(()=>D(null),2e3),it.success("Copied to clipboard")};return l.jsxs("div",{className:"h-screen flex flex-col",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{ref:V,className:"flex-1 overflow-y-auto px-3 md:px-6 py-4 md:py-6 space-y-4 pb-32 md:pb-28",style:{userSelect:"text"},onMouseUp:ee=>{ee.stopPropagation()},children:[a.map((ee,oe)=>l.jsxs("div",{className:`flex gap-3 ${ee.role==="user"?"justify-end":"justify-start"}`,children:[ee.role==="assistant"&&l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-md",style:{backgroundColor:"#8B7355"},children:l.jsx(LO,{className:"w-5 h-5 text-white"})}),l.jsxs("div",{className:`max-w-[80%] sm:max-w-[70%] rounded-2xl px-4 py-3 shadow-sm ${ee.role==="user"?"text-white shadow-sm":"bg-white text-slate-800"}`,style:ee.role==="user"?{backgroundColor:"#8B7355",border:"1px solid #E5DFD3"}:{border:"1px solid #E5DFD3"},children:[l.jsx("div",{className:"whitespace-pre-wrap break-words text-sm sm:text-base leading-relaxed",children:ee.content}),l.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[l.jsx("span",{className:`text-xs ${ee.role==="user"?"text-white/70":"text-slate-400"}`,children:ee.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),ee.role==="assistant"&&l.jsx("button",{onClick:()=>Q(ee.content,oe),className:"transition-colors p-1 rounded",style:{color:"#5C4F3D"},onMouseEnter:ne=>{ne.currentTarget.style.color="#8B7355",ne.currentTarget.style.backgroundColor="#F5F1EA"},onMouseLeave:ne=>{ne.currentTarget.style.color="#5C4F3D",ne.currentTarget.style.backgroundColor="transparent"},title:"Copy response",children:N===oe?l.jsx(gh,{className:"w-4 h-4 text-green-500"}):l.jsx(pTe,{className:"w-4 h-4"})})]})]}),ee.role==="user"&&l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm",style:{backgroundColor:"#E5DFD3"},children:l.jsx(Kc,{className:"w-5 h-5",style:{color:"#5C4F3D"}})})]},oe)),b&&T&&l.jsxs("div",{className:"flex gap-3 justify-start",children:[l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-md",style:{backgroundColor:"#8B7355"},children:l.jsx(LO,{className:"w-5 h-5 text-white"})}),l.jsx("div",{className:"max-w-[80%] sm:max-w-[70%] bg-white rounded-2xl px-4 py-3 shadow-sm",style:{border:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"whitespace-pre-wrap break-words text-sm sm:text-base leading-relaxed",style:{color:"#2C2416"},children:[T,l.jsx("span",{className:"inline-block w-1 h-4 ml-1 animate-pulse",style:{backgroundColor:"#8B7355"}})]})})]}),m&&!b&&l.jsxs("div",{className:"flex gap-3 justify-start",children:[l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-md",style:{backgroundColor:"#8B7355"},children:l.jsx(LO,{className:"w-5 h-5 text-white"})}),l.jsx("div",{className:"bg-white rounded-2xl px-4 py-3 shadow-sm",style:{border:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"flex items-center gap-2",style:{color:"#5C4F3D"},children:[l.jsx(py,{className:"w-4 h-4 animate-spin",style:{color:"#8B7355"}}),l.jsx("span",{className:"text-sm",children:"Analyzing your question..."})]})})]}),l.jsx("div",{ref:M})]}),l.jsx("div",{className:"fixed bottom-20 md:bottom-0 left-0 right-0 flex justify-center items-center px-3 md:px-6 py-3 md:py-4",style:{backgroundColor:"#F5F1EA",zIndex:40},children:l.jsxs("form",{onSubmit:z,className:"w-full md:max-w-2xl flex gap-2 md:gap-3 items-end",children:[l.jsxs("div",{className:"flex-1 relative",children:[l.jsx("input",{type:"text",value:d,onChange:ee=>p(ee.target.value),placeholder:"Ask about your health...",className:"w-full px-4 py-2.5 md:py-3 pr-10 bg-white rounded-full focus:outline-none focus:ring-2 transition-all text-sm md:text-base shadow-md hover:shadow-lg",style:{border:"1.5px solid #E5DFD3",color:"#2C2416"},onFocus:ee=>{ee.target.style.borderColor="#8B7355",ee.target.style.boxShadow="0 4px 16px rgba(139, 115, 85, 0.2)"},onBlur:ee=>{ee.target.style.borderColor="#E5DFD3",ee.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.08)"},disabled:m||b}),d&&l.jsx("button",{type:"button",onClick:()=>p(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-lg hover:opacity-70 transition-opacity",style:{color:"#5C4F3D"},children:""})]}),l.jsx("button",{type:"submit",disabled:!d.trim()||m||b,className:"px-4 md:px-5 py-2.5 md:py-3 text-white rounded-full font-medium hover:shadow-lg hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center gap-1 md:gap-2 flex-shrink-0 text-sm md:text-base shadow-md",style:{backgroundColor:"#8B7355"},title:d.trim()?"Send message":"Type a message first",children:m||b?l.jsx(py,{className:"w-4 md:w-5 h-4 md:h-5 animate-spin"}):l.jsxs(l.Fragment,{children:[l.jsx(Bm,{className:"w-4 md:w-5 h-4 md:h-5"}),l.jsx("span",{className:"hidden sm:inline",children:"Send"})]})})]})})]})}function vKe(){const{user:e}=fa(),[n,a]=Y.useState(!0),[o,d]=Y.useState(!1),[p,m]=Y.useState([]),[y,b]=Y.useState(null),[E,T]=Y.useState(null),[w,N]=Y.useState(!1),[D,A]=Y.useState(null),[k,O]=Y.useState(null),[F,M]=Y.useState(null),[V,H]=Y.useState([]),[B,z]=Y.useState(""),[q,Q]=Y.useState(()=>{const Ke=localStorage.getItem("quickCheckResult");return Ke?JSON.parse(Ke):null}),[ee,oe]=Y.useState(!1),[ne,ue]=Y.useState(null),[Se,fe]=Y.useState(null),[we,he]=Y.useState(!1),[be,ae]=Y.useState(""),[de,xe]=Y.useState(new Date().toISOString().split("T")[0]),[Ue,Me]=Y.useState("breakfast"),[et,Re]=Y.useState(""),[nt,ut]=Y.useState(null),[Kt,Rn]=Y.useState(null),[Pe,lt]=Y.useState(null);Y.useEffect(()=>{Et()},[de]);const Et=async()=>{try{const xt={Authorization:`Bearer ${localStorage.getItem("token")}`},Dn=new Date().toISOString().split("T")[0],ni=de===Dn,[Pa,Ji,gr]=await Promise.all([ni?Mn.get("/api/nutrition/logs/today",{headers:xt}):Mn.get(`/api/nutrition/logs?startDate=${de}&endDate=${de}`,{headers:xt}),Mn.get(`/api/nutrition/summary/daily?date=${de}`,{headers:xt}),Mn.get("/api/nutrition/goals",{headers:xt}).catch(()=>({data:{healthGoal:null}}))]);m(Pa.data.foodLogs||[]),b(Ji.data.summary),T(gr.data.healthGoal);try{const Xr=await Mn.get("/api/nutrition/activity/week",{headers:xt});H(Xr.data.weekData||[])}catch{console.log("Activity data not available"),H([])}}catch(Ke){console.error("Failed to fetch data:",Ke),it.error("Failed to load nutrition data")}finally{a(!1)}},Ae=Ke=>{const xt=Ke.target.files[0];if(xt){ut(xt);const Dn=new FileReader;Dn.onloadend=()=>{Rn(Dn.result)},Dn.readAsDataURL(xt)}},wt=async()=>{if(!et&&!nt){it.error("Please provide food description or image");return}d(!0);try{const Ke=localStorage.getItem("token");let xt=null;if(nt){const ni=new FileReader;xt=await new Promise(Pa=>{ni.onloadend=()=>{const Ji=ni.result.split(",")[1];Pa(Ji)},ni.readAsDataURL(nt)})}const Dn=await Mn.post("/api/nutrition/analyze-food",{foodDescription:et||void 0,imageBase64:xt,additionalContext:et||void 0},{headers:{Authorization:`Bearer ${Ke}`}});lt(Dn.data.analysis),it.success("Food analyzed successfully!")}catch(Ke){console.error("Analysis error:",Ke),it.error("Failed to analyze food")}finally{d(!1)}},Xe=async()=>{if(!Pe){it.error("Please analyze food first");return}try{const Ke=localStorage.getItem("token");await Mn.post("/api/nutrition/log-meal",{mealType:Ue,foodItems:Pe.foodItems,imageUrl:Kt,notes:et},{headers:{Authorization:`Bearer ${Ke}`}}),it.success("Meal logged successfully!"),N(!1),At(),Et()}catch(Ke){console.error("Log meal error:",Ke),it.error("Failed to log meal")}},$t=async Ke=>{if(confirm("Delete this meal?"))try{const xt=localStorage.getItem("token");await Mn.delete(`/api/nutrition/logs/${Ke}`,{headers:{Authorization:`Bearer ${xt}`}}),it.success("Meal deleted"),Et()}catch(xt){console.error("Delete error:",xt),it.error("Failed to delete meal")}},At=()=>{Me("breakfast"),Re(""),ut(null),Rn(null),lt(null)},ye=Ke=>{O(Ke._id),M({mealType:Ke.mealType,foodDescription:Ke.foodItems.map(xt=>`${xt.name} (${xt.quantity})`).join(", "),totalCalories:Ke.totalNutrition.calories,totalProtein:Ke.totalNutrition.protein,totalCarbs:Ke.totalNutrition.carbs,totalFats:Ke.totalNutrition.fats})},Qe=async()=>{if(F)try{const Ke=localStorage.getItem("token");await Mn.put(`/api/nutrition/logs/${k}`,{mealType:F.mealType,notes:F.foodDescription},{headers:{Authorization:`Bearer ${Ke}`}}),it.success("Meal updated successfully!"),O(null),M(null),Et()}catch(Ke){console.error("Update error:",Ke),it.error("Failed to update meal")}},Wt=Ke=>{const xt=Ke.target.files[0];if(xt){ue(xt);const Dn=new FileReader;Dn.onloadend=()=>{fe(Dn.result)},Dn.readAsDataURL(xt)}},ui=Ke=>{const xt=Ke.toLowerCase();return/\d+/.test(xt)||xt.includes("bowl")||xt.includes("plate")||xt.includes("cup")||xt.includes("glass")||xt.includes("slice")||xt.includes("piece")||xt.includes("gram")||xt.includes("kg")||xt.includes("ml")||xt.includes("litre")?{show:!1,unit:"",examples:""}:["juice","milk","water","tea","coffee","smoothie","shake","lassi","buttermilk","soup","dal","curry","gravy","kadhi","rasam","sambhar"].some(Xr=>xt.includes(Xr))?{show:!0,examples:" Add quantity: e.g., 250ml, 1 glass, 2 cups"}:["pizza","bread","toast","cake","pie","sandwich","paratha","naan"].some(Xr=>xt.includes(Xr))?{show:!0,examples:" Add quantity: e.g., 2 slices, 1 piece"}:["rice","roti","chapati","chicken","fish","meat","paneer","vegetables","salad","pasta","noodles","biryani","pulao","khichdi"].some(Xr=>xt.includes(Xr))?{show:!0,examples:" Add quantity: e.g., 100g, 1 bowl, 1 plate"}:["egg","banana","apple","orange","samosa","pakora","biscuit","cookie","idli","dosa","vada","gulab jamun","ladoo"].some(Xr=>xt.includes(Xr))?{show:!0,examples:" Add quantity: e.g., 2 pieces, 1 banana"}:{show:!0,examples:" Add quantity for accurate results: e.g., 100g, 1 bowl, 2 pieces, 250ml"}},ma=Ke=>{const xt=Ke.target.value;if(z(xt),xt.length>=3){const Dn=ui(xt);he(Dn.show),ae(Dn.examples)}else he(!1),ae("")},Oa=async()=>{var Ke,xt;if(!B.trim()&&!ne){it.error("Please enter a food item or upload an image");return}oe(!0);try{const Dn=localStorage.getItem("token");let ni=null;if(ne)try{const gr=new FileReader;ni=await new Promise((Xr,ou)=>{gr.onloadend=()=>{const cu=gr.result.split(",")[1];Xr(cu)},gr.onerror=ou,gr.readAsDataURL(ne)})}catch(gr){console.error("Image read error:",gr),it.error("Failed to read image file"),oe(!1);return}const Ji=(await Mn.post("/api/nutrition/quick-check",{foodDescription:B||void 0,imageBase64:ni,additionalContext:B||void 0},{headers:{Authorization:`Bearer ${Dn}`}})).data;Q(Ji),localStorage.setItem("quickCheckResult",JSON.stringify(Ji)),it.success("Food analyzed!"),he(!1)}catch(Dn){console.error("Quick check error:",Dn);const ni=((xt=(Ke=Dn.response)==null?void 0:Ke.data)==null?void 0:xt.message)||Dn.message||"Failed to analyze food";it.error(ni)}finally{oe(!1)}},oc=()=>{Q(null),z(""),ue(null),fe(null),localStorage.removeItem("quickCheckResult")};if(n)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsx(py,{className:"w-8 h-8 animate-spin text-cyan-500"})});const tt=(y==null?void 0:y.caloriePercentage)||0,Lt=(y==null?void 0:y.proteinPercentage)||0,mr=(y==null?void 0:y.carbsPercentage)||0,Wn=(y==null?void 0:y.fatsPercentage)||0;return l.jsxs("div",{className:"space-y-6 animate-fade-in w-full overflow-x-hidden",children:[l.jsxs("div",{className:"bg-white rounded-2xl p-3 md:p-6 shadow-sm border border-[#E5DFD3] w-full overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:"Your Activity"}),l.jsxs("div",{className:"flex items-center gap-1 text-sm md:text-base text-[#5C4F3D] bg-[#F5F1EA] px-2 md:px-3 py-2 rounded-lg cursor-pointer hover:bg-[#E5DFD3] flex-shrink-0",children:[l.jsx(ki,{className:"w-4 h-4 flex-shrink-0"}),l.jsx("input",{type:"date",value:de,onChange:Ke=>xe(Ke.target.value),className:"bg-transparent text-xs md:text-sm text-[#2C2416] cursor-pointer outline-none w-24 md:w-32"})]})]}),y&&E?l.jsxs("div",{className:"bg-gradient-to-br from-[#E8F5E9] to-[#C8E6C9] rounded-2xl p-4 md:p-6 mb-4 w-full overflow-hidden",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(ir,{className:"w-5 h-5 text-[#2E7D32]"}),l.jsx("span",{className:"text-sm md:text-base font-medium text-[#2E7D32]",children:"Daily Intake"})]}),l.jsxs("div",{className:"md:hidden flex flex-col items-center gap-6 w-full",children:[l.jsxs("div",{className:"relative w-24 h-24 flex-shrink-0",children:[l.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#2E7D32",strokeWidth:"3",strokeDasharray:`${Math.min(tt,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-lg font-bold text-[#1B5E20]",children:y.totalCalories}),l.jsx("span",{className:"text-[10px] text-[#2E7D32]",children:"kcal"})]})]}),l.jsxs("div",{className:"w-full space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full flex-shrink-0"}),l.jsx("span",{className:"text-xs text-[#2E7D32] truncate",children:"Protein"})]}),l.jsxs("span",{className:"text-xs font-bold text-[#1B5E20] flex-shrink-0 whitespace-nowrap",children:[y.totalProtein.toFixed(2),"/",E.macroTargets.protein,"g"]})]}),l.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full flex-shrink-0"}),l.jsx("span",{className:"text-xs text-[#2E7D32] truncate",children:"Carbs"})]}),l.jsxs("span",{className:"text-xs font-bold text-[#1B5E20] flex-shrink-0 whitespace-nowrap",children:[y.totalCarbs.toFixed(2),"/",E.macroTargets.carbs,"g"]})]}),l.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full flex-shrink-0"}),l.jsx("span",{className:"text-xs text-[#2E7D32] truncate",children:"Fats"})]}),l.jsxs("span",{className:"text-xs font-bold text-[#1B5E20] flex-shrink-0 whitespace-nowrap",children:[y.totalFats.toFixed(2),"/",E.macroTargets.fats,"g"]})]})]})]}),l.jsxs("div",{className:"hidden md:flex md:items-center md:justify-between gap-8 w-full",children:[l.jsxs("div",{className:"relative w-32 h-32 flex-shrink-0",children:[l.jsxs("svg",{className:"w-32 h-32 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#2E7D32",strokeWidth:"3",strokeDasharray:`${Math.min(tt,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-2xl font-bold text-[#1B5E20]",children:y.totalCalories}),l.jsx("span",{className:"text-xs text-[#2E7D32]",children:"kcal"})]})]}),l.jsxs("div",{className:"relative w-28 h-28 flex-shrink-0",children:[l.jsxs("svg",{className:"w-28 h-28 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#EF4444",strokeWidth:"3",strokeDasharray:`${Math.min(Lt,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-lg font-bold text-[#1B5E20]",children:y.totalProtein.toFixed(0)}),l.jsx("span",{className:"text-[10px] text-[#2E7D32]",children:"g"})]})]}),l.jsxs("div",{className:"relative w-28 h-28 flex-shrink-0",children:[l.jsxs("svg",{className:"w-28 h-28 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#F97316",strokeWidth:"3",strokeDasharray:`${Math.min(mr,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-lg font-bold text-[#1B5E20]",children:y.totalCarbs.toFixed(0)}),l.jsx("span",{className:"text-[10px] text-[#2E7D32]",children:"g"})]})]}),l.jsxs("div",{className:"relative w-28 h-28 flex-shrink-0",children:[l.jsxs("svg",{className:"w-28 h-28 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#3B82F6",strokeWidth:"3",strokeDasharray:`${Math.min(Wn,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-lg font-bold text-[#1B5E20]",children:y.totalFats.toFixed(0)}),l.jsx("span",{className:"text-[10px] text-[#2E7D32]",children:"g"})]})]}),l.jsxs("div",{className:"flex flex-col gap-3 ml-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),l.jsxs("span",{className:"text-sm text-[#2E7D32]",children:["Protein: ",y.totalProtein.toFixed(2),"/",E.macroTargets.protein,"g"]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),l.jsxs("span",{className:"text-sm text-[#2E7D32]",children:["Carbs: ",y.totalCarbs.toFixed(2),"/",E.macroTargets.carbs,"g"]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),l.jsxs("span",{className:"text-sm text-[#2E7D32]",children:["Fats: ",y.totalFats.toFixed(2),"/",E.macroTargets.fats,"g"]})]})]})]})]}):l.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(jh,{className:"w-5 h-5 text-amber-600 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-amber-900 mb-1",children:"Set Your Health Goal"}),l.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Set your health goals to get personalized calorie and macro targets."}),l.jsx(un,{to:"/profile",className:"inline-block px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 text-sm font-medium",children:"Set Goals Now"})]})]})}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-[#E5DFD3] overflow-hidden",children:[l.jsx("h3",{className:"text-sm md:text-base font-medium text-[#2C2416] mb-1",children:"Activity"}),l.jsx("p",{className:"text-xs text-[#5C4F3D] mb-3",children:"Last 7 days calorie intake"}),l.jsx("div",{className:"flex items-end gap-1 mb-3 justify-center md:justify-start h-20",children:V&&V.length>0?V.map((Ke,xt)=>{var gr;const Dn=new Date(Ke.date).toDateString()===new Date().toDateString(),ni=((gr=E==null?void 0:E.macroTargets)==null?void 0:gr.calories)||(E==null?void 0:E.dailyCalorieTarget)||2e3,Pa=Math.max(...V.map(Xr=>Xr.calories||0),ni),Ji=Ke.calories/Pa*100;return l.jsx("div",{className:`flex-1 rounded-t transition-all group relative cursor-pointer ${Dn?"bg-[#2E7D32]":"bg-[#8B7355]"}`,style:{height:`${Math.max(Ji,10)}%`},title:`${new Date(Ke.date).toLocaleDateString("en-US",{weekday:"short"})}: ${Ke.calories} kcal`,children:l.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-[#2C2416] text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:[Ke.calories," kcal"]})},xt)}):l.jsx("div",{className:"w-full flex items-center justify-center text-[#5C4F3D] text-sm",children:"No data available"})}),l.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[l.jsx("span",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:(y==null?void 0:y.totalCalories)||0}),l.jsx("span",{className:"text-sm md:text-base text-[#5C4F3D]",children:"Kcal (Today)"}),l.jsx(Xa,{className:"w-4 h-4 text-[#2E7D32]"})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-[#E5DFD3] overflow-hidden",children:[l.jsx("h3",{className:"text-sm md:text-base font-medium text-[#2C2416] mb-3",children:"Meals Summary"}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D] mb-3",children:"Logged meals today"}),l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[p.length===0?l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"No meals logged yet"}):l.jsxs(l.Fragment,{children:[p.slice(0,3).map((Ke,xt)=>l.jsxs("div",{className:"group relative",children:[l.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-gradient-to-br from-orange-400 to-red-500 flex items-center justify-center text-white text-xs font-bold cursor-pointer hover:shadow-lg transition-shadow",children:Ke.mealType.charAt(0).toUpperCase()}),l.jsxs("div",{className:"absolute -top-10 left-1/2 transform -translate-x-1/2 bg-[#2C2416] text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:[Ke.mealType,": ",Ke.totalNutrition.calories," cal"]})]},xt)),p.length>3&&l.jsxs("div",{className:"text-xs text-[#5C4F3D] font-medium",children:["+",p.length-3]})]}),l.jsx("button",{onClick:()=>N(!0),className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-[#8B7355] text-white flex items-center justify-center text-lg md:text-xl font-medium hover:bg-[#A0826D] transition-colors",title:"Add new meal",children:"+"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-3 md:p-6 shadow-sm border border-[#E5DFD3] w-full overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Uy,{className:"w-5 h-5 text-[#5C4F3D]"}),l.jsx("h2",{className:"text-lg md:text-xl font-semibold text-[#2C2416]",children:"Quick Food Check"})]}),q&&l.jsx("button",{onClick:oc,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Clear"})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"text",value:B,onChange:ma,onKeyPress:Ke=>Ke.key==="Enter"&&Oa(),placeholder:"E.g., Pizza, 2 slices or Milk, 250ml",className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none text-sm md:text-base"}),we&&be&&l.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 p-3 bg-blue-50 border-2 border-blue-200 rounded-xl shadow-lg z-10",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(gS,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),l.jsx("p",{className:"text-xs md:text-sm text-blue-700",children:be})]})})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-[#E5DFD3] rounded-xl hover:border-[#8B7355] cursor-pointer transition-colors",children:[l.jsx(s2,{className:"w-5 h-5 text-[#5C4F3D]"}),l.jsx("span",{className:"text-sm text-[#5C4F3D] hidden md:inline",children:ne?"Image Selected ":"Photo"}),l.jsx("span",{className:"text-xs text-[#5C4F3D] md:hidden",children:ne?"Image ":"Photo"}),l.jsx("input",{type:"file",accept:"image/*",onChange:Wt,className:"hidden"})]}),l.jsxs("button",{onClick:Oa,disabled:ee,className:"px-6 py-3 bg-[#8B7355] text-white rounded-xl font-medium hover:bg-[#A0826D] disabled:opacity-50 flex items-center gap-2 text-sm md:text-base",children:[ee?l.jsx(py,{className:"w-5 h-5 animate-spin"}):l.jsx(kh,{className:"w-5 h-5"}),ee?"Checking...":"Check"]})]}),Se&&l.jsxs("div",{className:"relative",children:[l.jsx("img",{src:Se,alt:"Food preview",className:"w-full h-40 md:h-48 object-cover rounded-xl"}),l.jsx("button",{onClick:()=>{ue(null),fe(null)},className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600",children:l.jsx(SP,{className:"w-3 h-3"})})]})]}),q&&l.jsxs("div",{className:"mt-4 bg-gray-50 rounded-xl p-4 md:p-6 space-y-4",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-lg md:text-xl text-slate-800",children:q.foodItem.name}),l.jsx("p",{className:"text-sm md:text-base text-slate-600",children:q.foodItem.quantity})]}),l.jsx("div",{className:`px-3 py-1 rounded-full text-xs md:text-sm font-medium ${q.isHealthy?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:q.isHealthy?" Healthy":" Unhealthy"})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center",children:[l.jsx(Vx,{className:"w-5 h-5 md:w-6 md:h-6 mx-auto mb-2 text-orange-500"}),l.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Calories"}),l.jsx("p",{className:"text-base md:text-lg font-bold text-slate-800",children:q.foodItem.nutrition.calories})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center",children:[l.jsx(ir,{className:"w-5 h-5 md:w-6 md:h-6 mx-auto mb-2 text-blue-500"}),l.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Protein"}),l.jsxs("p",{className:"text-base md:text-lg font-bold text-slate-800",children:[q.foodItem.nutrition.protein,"g"]})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center",children:[l.jsx(nc,{className:"w-5 h-5 md:w-6 md:h-6 mx-auto mb-2 text-green-500"}),l.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Carbs"}),l.jsxs("p",{className:"text-base md:text-lg font-bold text-slate-800",children:[q.foodItem.nutrition.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center",children:[l.jsx(qw,{className:"w-5 h-5 md:w-6 md:h-6 mx-auto mb-2 text-purple-500"}),l.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Fats"}),l.jsxs("p",{className:"text-base md:text-lg font-bold text-slate-800",children:[q.foodItem.nutrition.fats,"g"]})]})]}),l.jsx("div",{className:"bg-white p-3 md:p-4 rounded-lg",children:l.jsx("p",{className:"text-sm md:text-base text-slate-700",children:q.analysis})}),q.warnings&&q.warnings.length>0&&l.jsx("div",{className:"bg-red-50 p-3 md:p-4 rounded-lg border border-red-200",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(go,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"text-sm md:text-base font-medium text-red-900 mb-2",children:"Warnings:"}),l.jsx("ul",{className:"text-sm md:text-base text-red-700 space-y-1",children:q.warnings.map((Ke,xt)=>l.jsxs("li",{children:[" ",Ke]},xt))})]})]})}),q.alternatives&&q.alternatives.length>0&&l.jsxs("div",{className:"bg-green-50 p-3 md:p-4 rounded-lg border border-green-200",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(gS,{className:"w-5 h-5 text-green-600"}),l.jsx("h4",{className:"text-sm md:text-base font-semibold text-green-900",children:"Healthier Alternatives"})]}),l.jsx("div",{className:"space-y-3",children:q.alternatives.map((Ke,xt)=>l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm md:text-base font-medium text-green-900",children:Ke.name}),l.jsx("p",{className:"text-xs md:text-sm text-green-700",children:Ke.description})]}),l.jsxs("p",{className:"text-xs md:text-sm font-medium text-green-900",children:[Ke.nutrition.calories," cal"]})]}),l.jsxs("div",{className:"flex gap-3 text-xs md:text-sm text-green-700 mb-2",children:[l.jsxs("span",{children:["P: ",Ke.nutrition.protein,"g"]}),l.jsxs("span",{children:["C: ",Ke.nutrition.carbs,"g"]}),l.jsxs("span",{children:["F: ",Ke.nutrition.fats,"g"]})]}),l.jsxs("p",{className:"text-xs md:text-sm text-green-600",children:[" ",Ke.benefits]})]},xt))})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-4 md:p-6 shadow-sm border border-[#E5DFD3] overflow-hidden w-full",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-lg md:text-xl font-semibold text-[#2C2416]",children:"Recently logged"}),l.jsx("button",{onClick:()=>N(!0),className:"p-2 bg-[#8B7355] text-white rounded-full hover:bg-[#A0826D] flex-shrink-0",children:l.jsx(Wc,{className:"w-5 h-5"})})]}),p.length===0?l.jsxs("div",{className:"text-center py-8",children:[l.jsx(nc,{className:"w-12 h-12 text-[#E5DFD3] mx-auto mb-3"}),l.jsx("p",{className:"text-[#5C4F3D] mb-3",children:"No meals logged today"}),l.jsx("button",{onClick:()=>N(!0),className:"px-4 py-2 bg-[#8B7355] text-white rounded-lg hover:bg-[#A0826D] text-sm",children:"Log Your First Meal"})]}):l.jsx("div",{className:"space-y-3 overflow-x-hidden",children:p.map(Ke=>{var xt;return l.jsxs("div",{className:"flex items-center gap-2 md:gap-3 p-3 md:p-4 bg-[#F5F1EA] rounded-xl hover:bg-[#E5DFD3] transition-colors overflow-hidden",children:[l.jsx("div",{className:"w-14 h-14 md:w-20 md:h-20 bg-gradient-to-br from-orange-400 to-red-500 rounded-xl flex-shrink-0"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("h3",{className:"font-medium text-sm md:text-base text-[#2C2416] capitalize truncate",children:((xt=Ke.foodItems[0])==null?void 0:xt.name)||Ke.mealType}),l.jsxs("div",{className:"flex items-center gap-2 md:gap-3 text-[10px] md:text-xs text-[#5C4F3D] mt-1 overflow-x-auto",children:[l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full"}),l.jsxs("span",{children:[Ke.totalNutrition.protein,"g"]})]}),l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full"}),l.jsxs("span",{children:[Ke.totalNutrition.carbs,"g"]})]}),l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),l.jsxs("span",{children:[Ke.totalNutrition.fats,"g"]})]})]})]}),l.jsxs("div",{className:"text-right flex-shrink-0",children:[l.jsx("p",{className:"text-sm md:text-base font-semibold text-[#2C2416]",children:Ke.totalNutrition.calories}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"kcal"})]}),l.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[l.jsx("button",{onClick:()=>ye(Ke),className:"p-1.5 md:p-2 text-[#5C4F3D] hover:text-[#8B7355] rounded-lg hover:bg-white transition-colors",title:"Edit meal",children:l.jsx(bTe,{className:"w-4 h-4"})}),l.jsx("button",{onClick:()=>$t(Ke._id),className:"p-1.5 md:p-2 text-[#5C4F3D] hover:text-red-600 rounded-lg hover:bg-red-50 transition-colors",title:"Delete meal",children:l.jsx(SP,{className:"w-4 h-4"})})]})]},Ke._id)})})]}),l.jsx("div",{className:"h-6 md:h-0"}),k&&F&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end md:items-center justify-center z-50 overflow-hidden",onClick:()=>O(null),children:l.jsxs("div",{className:"bg-white rounded-t-2xl md:rounded-2xl w-full md:max-w-2xl h-[70vh] md:h-auto md:max-h-[75vh] flex flex-col",onClick:Ke=>Ke.stopPropagation(),children:[l.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0 p-4 md:p-6",children:[l.jsx("h2",{className:"text-xl md:text-2xl font-bold text-[#2C2416]",children:"Edit Meal"}),l.jsx("button",{onClick:()=>O(null),className:"text-[#5C4F3D] hover:text-[#2C2416] text-2xl flex-shrink-0",children:""})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 md:pr-0 p-4 md:p-6",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"Meal Type"}),l.jsxs("select",{value:F.mealType,onChange:Ke=>M({...F,mealType:Ke.target.value}),className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none text-sm md:text-base",children:[l.jsx("option",{value:"breakfast",children:"Breakfast"}),l.jsx("option",{value:"lunch",children:"Lunch"}),l.jsx("option",{value:"dinner",children:"Dinner"}),l.jsx("option",{value:"snack",children:"Snack"})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"Food Items"}),l.jsx("textarea",{value:F.foodDescription,onChange:Ke=>M({...F,foodDescription:Ke.target.value}),className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none resize-none text-sm md:text-base",rows:"3"})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:[l.jsxs("div",{className:"bg-[#F5F1EA] p-3 rounded-lg",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"Calories"}),l.jsx("p",{className:"text-lg font-bold text-[#2C2416]",children:F.totalCalories})]}),l.jsxs("div",{className:"bg-[#F5F1EA] p-3 rounded-lg",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"Protein"}),l.jsxs("p",{className:"text-lg font-bold text-[#2C2416]",children:[F.totalProtein,"g"]})]}),l.jsxs("div",{className:"bg-[#F5F1EA] p-3 rounded-lg",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"Carbs"}),l.jsxs("p",{className:"text-lg font-bold text-[#2C2416]",children:[F.totalCarbs,"g"]})]}),l.jsxs("div",{className:"bg-[#F5F1EA] p-3 rounded-lg",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"Fats"}),l.jsxs("p",{className:"text-lg font-bold text-[#2C2416]",children:[F.totalFats,"g"]})]})]})]}),l.jsxs("div",{className:"flex-shrink-0 border-t border-[#E5DFD3] pt-4 mt-4 gap-3 flex p-4 md:p-6 bg-white",children:[l.jsx("button",{onClick:Qe,className:"flex-1 px-6 py-3 bg-[#2E7D32] text-white rounded-xl font-medium hover:bg-[#1B5E20] text-sm md:text-base",children:"Save Changes"}),l.jsx("button",{onClick:()=>O(null),className:"flex-1 px-6 py-3 bg-[#E5DFD3] text-[#2C2416] rounded-xl font-medium hover:bg-[#D4CFC3] text-sm md:text-base",children:"Cancel"})]})]})}),w&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end md:items-center justify-center z-50 overflow-hidden",onClick:()=>N(!1),children:l.jsxs("div",{className:"bg-white rounded-t-2xl md:rounded-2xl w-full md:max-w-2xl h-[70vh] md:h-auto md:max-h-[75vh] flex flex-col",onClick:Ke=>Ke.stopPropagation(),children:[l.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0 p-4 md:p-6",children:[l.jsx("h2",{className:"text-xl md:text-2xl font-bold text-[#2C2416]",children:"Add Meal"}),l.jsx("button",{onClick:()=>N(!1),className:"text-[#5C4F3D] hover:text-[#2C2416] text-2xl flex-shrink-0",children:""})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 md:pr-0 p-4 md:p-6",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"Meal Type"}),l.jsxs("select",{value:Ue,onChange:Ke=>Me(Ke.target.value),className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none text-sm md:text-base",children:[l.jsx("option",{value:"breakfast",children:"Breakfast"}),l.jsx("option",{value:"lunch",children:"Lunch"}),l.jsx("option",{value:"dinner",children:"Dinner"}),l.jsx("option",{value:"snack",children:"Snack"})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"What did you eat?"}),l.jsx("textarea",{value:et,onChange:Ke=>Re(Ke.target.value),placeholder:"E.g., 2 eggs, 2 slices of whole wheat toast, 1 banana",className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none resize-none text-sm md:text-base",rows:"3"})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"Or upload a photo"}),l.jsxs("label",{className:"flex items-center justify-center gap-2 px-4 py-6 border-2 border-dashed border-[#E5DFD3] rounded-xl hover:border-[#8B7355] cursor-pointer transition-colors",children:[l.jsx(co,{className:"w-6 h-6 text-[#5C4F3D]"}),l.jsx("span",{className:"text-[#5C4F3D] text-sm md:text-base",children:"Upload Image"}),l.jsx("input",{type:"file",accept:"image/*",onChange:Ae,className:"hidden"})]}),Kt&&l.jsx("div",{className:"mt-3",children:l.jsx("img",{src:Kt,alt:"Food",className:"w-full h-48 object-cover rounded-xl"})})]}),Pe&&l.jsxs("div",{className:"border-2 border-[#2E7D32] rounded-xl p-4 md:p-6 bg-[#E8F5E9] mb-4",children:[l.jsx("h3",{className:"font-semibold text-lg md:text-xl text-[#1B5E20] mb-4",children:"Nutrition Breakdown"}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:[l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Calories"}),l.jsx("p",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:Pe.totalNutrition.calories})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Protein"}),l.jsxs("p",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:[Pe.totalNutrition.protein,"g"]})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Carbs"}),l.jsxs("p",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:[Pe.totalNutrition.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Fats"}),l.jsxs("p",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:[Pe.totalNutrition.fats,"g"]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg mb-4 border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-sm md:text-base font-medium text-[#2C2416] mb-3",children:"Detected Items:"}),l.jsx("div",{className:"space-y-2",children:Pe.foodItems.map((Ke,xt)=>l.jsxs("div",{className:"border-l-4 border-[#8B7355] pl-3 py-2",children:[l.jsxs("div",{className:"flex items-start justify-between mb-1",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm md:text-base font-medium text-[#2C2416]",children:Ke.name}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:Ke.quantity})]}),l.jsxs("p",{className:"text-sm md:text-base font-bold text-[#2C2416]",children:[Ke.nutrition.calories," cal"]})]}),l.jsxs("div",{className:"flex gap-3 text-xs md:text-sm text-[#5C4F3D]",children:[l.jsxs("span",{children:["P: ",Ke.nutrition.protein,"g"]}),l.jsxs("span",{children:["C: ",Ke.nutrition.carbs,"g"]}),l.jsxs("span",{children:["F: ",Ke.nutrition.fats,"g"]})]})]},xt))})]})]})]}),l.jsxs("div",{className:"flex-shrink-0 border-t border-[#E5DFD3] pt-4 mt-4 space-y-3 p-4 md:p-6 bg-white",children:[l.jsx("button",{onClick:wt,disabled:o||!et&&!nt,className:"w-full px-6 py-4 bg-gradient-to-r from-[#8B7355] to-[#A0826D] text-white rounded-xl font-medium hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm md:text-base",children:o?l.jsxs(l.Fragment,{children:[l.jsx(py,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):l.jsxs(l.Fragment,{children:[l.jsx(kh,{className:"w-5 h-5"}),"Analyze with AI"]})}),Pe&&l.jsx("button",{onClick:Xe,className:"w-full px-6 py-3 bg-[#2E7D32] text-white rounded-xl font-medium hover:bg-[#1B5E20] text-sm md:text-base",children:"Log This Meal"})]})]})})]})}const no=({children:e,allowedRoles:n})=>{const{user:a,loading:o}=fa();return o?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):a?n&&!n.includes(a.role)?a.role==="admin"?l.jsx(xs,{to:"/admin"}):a.role==="doctor"?l.jsx(xs,{to:"/doctor/dashboard"}):l.jsx(xs,{to:"/dashboard"}):e:l.jsx(xs,{to:"/login"})},yKe=({children:e})=>{const{user:n,loading:a,isAdmin:o}=fa();return a?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n?o()?e:l.jsx(xs,{to:"/dashboard"}):l.jsx(xs,{to:"/login"})},m1=({children:e})=>{const{user:n,loading:a,isDoctor:o}=fa();return a?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n?o()?e:l.jsx(xs,{to:"/dashboard"}):l.jsx(xs,{to:"/login"})};function _Ke(){const{user:e,isAdmin:n,isDoctor:a}=fa(),o=()=>e?n()?l.jsx(xs,{to:"/admin"}):a()?l.jsx(xs,{to:"/doctor/dashboard"}):l.jsx(xs,{to:"/dashboard"}):l.jsx(KTe,{});return l.jsxs(l.Fragment,{children:[l.jsx(kTe,{}),l.jsxs(Exe,{children:[l.jsx(Dr,{path:"/",element:l.jsx(zTe,{})}),l.jsx(Dr,{path:"/login",element:o()}),l.jsx(Dr,{path:"/register",element:e?l.jsx(xs,{to:"/dashboard"}):l.jsx(YTe,{})}),l.jsx(Dr,{path:"/register/doctor",element:e?l.jsx(xs,{to:"/doctor/dashboard"}):l.jsx(XTe,{})}),l.jsx(Dr,{path:"/dashboard",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(q7e,{})})})}),l.jsx(Dr,{path:"/upload",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(Hze,{})})})}),l.jsx(Dr,{path:"/reports/:id",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(zze,{})})})}),l.jsx(Dr,{path:"/doctors",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(Yze,{})})})}),l.jsx(Dr,{path:"/consultation/:appointmentId",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(cKe,{})})}),l.jsx(Dr,{path:"/consultation-summary/:appointmentId",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(lKe,{})})})}),l.jsx(Dr,{path:"/wearables",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(aKe,{})})})}),l.jsx(Dr,{path:"/nutrition",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(vKe,{})})})}),l.jsx(Dr,{path:"/subscription",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(iKe,{})})})}),l.jsx(Dr,{path:"/diet-plan",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(mKe,{})})})}),l.jsx(Dr,{path:"/ai-chat",element:l.jsx(no,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(gKe,{})})})}),l.jsx(Dr,{path:"/doctor/dashboard",element:l.jsx(m1,{children:l.jsx(wa,{isDoctor:!0,children:l.jsx(X7e,{})})})}),l.jsx(Dr,{path:"/doctor/availability",element:l.jsx(m1,{children:l.jsx(wa,{isDoctor:!0,children:l.jsx(pKe,{})})})}),l.jsx(Dr,{path:"/patient/:patientId",element:l.jsx(m1,{children:l.jsx(wa,{isDoctor:!0,children:l.jsx(sKe,{})})})}),l.jsx(Dr,{path:"/profile",element:l.jsx(no,{children:l.jsx(wa,{children:l.jsx(qze,{})})})}),l.jsx(Dr,{path:"/admin",element:l.jsx(yKe,{children:l.jsx(wa,{isAdmin:!0,children:l.jsx(eKe,{})})})}),l.jsx(Dr,{path:"/demo",element:l.jsx(Zze,{})}),l.jsx(Dr,{path:"/video-test",element:l.jsx(dKe,{})}),l.jsx(Dr,{path:"/email-test",element:l.jsx(uKe,{})})]})]})}g1.createRoot(document.getElementById("root")).render(l.jsx(me.StrictMode,{children:l.jsx(Axe,{children:l.jsx(Zwe,{children:l.jsxs(ZTe,{children:[l.jsx(_Ke,{}),l.jsx(ESe,{position:"top-right"})]})})})}));
