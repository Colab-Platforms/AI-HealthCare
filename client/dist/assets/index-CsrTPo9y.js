const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-QGJJl75w.js","assets/vendor-BZrlrEDh.js","assets/ui-CJTePhGH.js"])))=>i.map(i=>d[i]);
var Tre=Object.defineProperty;var Rre=(a,o,c)=>o in a?Tre(a,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[o]=c;var gn=(a,o,c)=>Rre(a,typeof o!="symbol"?o+"":o,c);import{r as te,a as Ire,u as to,b as Zy,L as Os,d as Ore,R as XV,e as sx,f as JV,c as O_,g as kre,h as Dre,i as tn,N as wc,B as Bre}from"./vendor-BZrlrEDh.js";import{M as rx,X as Yi,S as Sg,H as Vi,W as GA,C as Ti,L as YR,a as eE,A as Cr,b as $V,F as Bn,c as Lre,U as nx,d as Xp,e as zb,B as WA,f as cl,g as XR,D as tE,h as Xd,i as ZV,j as vo,T as va,k as Zl,P as Zu,l as ix,m as eQ,n as jre,o as Pp,Z as nl,p as G3,q as sE,r as wg,s as il,t as lh,u as ax,v as qb,E as tQ,w as Kp,x as Oy,y as sQ,z as ln,G as K3,R as Pre,I as JR,J as Ure,K as Fre,N as Mre,O as rE,Q as Cg,V as dh,Y as dn,_ as Ln,$ as Vre,a0 as rQ,a1 as Qre,a2 as eh,a3 as HA,a4 as W3,a5 as Jl,a6 as Hre,a7 as Fb,a8 as Yb,a9 as QT,aa as HT,ab as nE,ac as iE,ad as aE,ae as $R,af as th,ag as $l,ah as GT,ai as ZR,aj as Gre,ak as eI,al as nQ,am as zA,an as kn,ao as pg,ap as zd,aq as iQ,ar as Kre,as as aQ,at as ah,au as tI,av as sI,aw as oQ,ax as cQ,ay as lQ,az as KT,aA as dQ,aB as z3,aC as q3,aD as ox,aE as Wre,aF as AQ,aG as WT,aH as zre,aI as qre,aJ as Yre,aK as Xre,aL as uQ,aM as hQ,aN as zT,aO as Jre,aP as $re,aQ as Zre,aR as ene,aS as tne,aT as sne,aU as rne,aV as nne,aW as V2,aX as ine,aY as ane,aZ as one,a_ as Y3}from"./ui-CJTePhGH.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))d(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const g of m.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&d(g)}).observe(document,{childList:!0,subtree:!0});function c(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function d(h){if(h.ep)return;h.ep=!0;const m=c(h);fetch(h.href,m)}})();var pQ={exports:{}},oE={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cne=te,lne=Symbol.for("react.element"),dne=Symbol.for("react.fragment"),Ane=Object.prototype.hasOwnProperty,une=cne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hne={key:!0,ref:!0,__self:!0,__source:!0};function mQ(a,o,c){var d,h={},m=null,g=null;c!==void 0&&(m=""+c),o.key!==void 0&&(m=""+o.key),o.ref!==void 0&&(g=o.ref);for(d in o)Ane.call(o,d)&&!hne.hasOwnProperty(d)&&(h[d]=o[d]);if(a&&a.defaultProps)for(d in o=a.defaultProps,o)h[d]===void 0&&(h[d]=o[d]);return{$$typeof:lne,type:a,key:m,ref:g,props:h,_owner:une.current}}oE.Fragment=dne;oE.jsx=mQ;oE.jsxs=mQ;pQ.exports=oE;var n=pQ.exports,qT={},X3=Ire;qT.createRoot=X3.createRoot,qT.hydrateRoot=X3.hydrateRoot;let pne={data:""},mne=a=>{if(typeof window=="object"){let o=(a?a.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return o.nonce=window.__nonce__,o.parentNode||(a||document.head).appendChild(o),o.firstChild}return a||pne},fne=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,gne=/\/\*[^]*?\*\/|  +/g,J3=/\n+/g,$u=(a,o)=>{let c="",d="",h="";for(let m in a){let g=a[m];m[0]=="@"?m[1]=="i"?c=m+" "+g+";":d+=m[1]=="f"?$u(g,m):m+"{"+$u(g,m[1]=="k"?"":o)+"}":typeof g=="object"?d+=$u(g,o?o.replace(/([^,])+/g,x=>m.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,v=>/&/.test(v)?v.replace(/&/g,x):x?x+" "+v:v)):m):g!=null&&(m=/^--/.test(m)?m:m.replace(/[A-Z]/g,"-$&").toLowerCase(),h+=$u.p?$u.p(m,g):m+":"+g+";")}return c+(o&&h?o+"{"+h+"}":h)+d},LA={},fQ=a=>{if(typeof a=="object"){let o="";for(let c in a)o+=c+fQ(a[c]);return o}return a},bne=(a,o,c,d,h)=>{let m=fQ(a),g=LA[m]||(LA[m]=(v=>{let E=0,S=11;for(;E<v.length;)S=101*S+v.charCodeAt(E++)>>>0;return"go"+S})(m));if(!LA[g]){let v=m!==a?a:(E=>{let S,I,k=[{}];for(;S=fne.exec(E.replace(gne,""));)S[4]?k.shift():S[3]?(I=S[3].replace(J3," ").trim(),k.unshift(k[0][I]=k[0][I]||{})):k[0][S[1]]=S[2].replace(J3," ").trim();return k[0]})(a);LA[g]=$u(h?{["@keyframes "+g]:v}:v,c?"":"."+g)}let x=c&&LA.g?LA.g:null;return c&&(LA.g=LA[g]),((v,E,S,I)=>{I?E.data=E.data.replace(I,v):E.data.indexOf(v)===-1&&(E.data=S?v+E.data:E.data+v)})(LA[g],o,d,x),g},xne=(a,o,c)=>a.reduce((d,h,m)=>{let g=o[m];if(g&&g.call){let x=g(c),v=x&&x.props&&x.props.className||/^go/.test(x)&&x;g=v?"."+v:x&&typeof x=="object"?x.props?"":$u(x,""):x===!1?"":x}return d+h+(g??"")},"");function cE(a){let o=this||{},c=a.call?a(o.p):a;return bne(c.unshift?c.raw?xne(c,[].slice.call(arguments,1),o.p):c.reduce((d,h)=>Object.assign(d,h&&h.call?h(o.p):h),{}):c,mne(o.target),o.g,o.o,o.k)}let gQ,YT,XT;cE.bind({g:1});let qA=cE.bind({k:1});function vne(a,o,c,d){$u.p=o,gQ=a,YT=c,XT=d}function hh(a,o){let c=this||{};return function(){let d=arguments;function h(m,g){let x=Object.assign({},m),v=x.className||h.className;c.p=Object.assign({theme:YT&&YT()},x),c.o=/ *go\d+/.test(v),x.className=cE.apply(c,d)+(v?" "+v:"");let E=a;return a[0]&&(E=x.as||a,delete x.as),XT&&E[0]&&XT(x),gQ(E,x)}return h}}var wne=a=>typeof a=="function",ky=(a,o)=>wne(a)?a(o):a,_ne=(()=>{let a=0;return()=>(++a).toString()})(),bQ=(()=>{let a;return()=>{if(a===void 0&&typeof window<"u"){let o=matchMedia("(prefers-reduced-motion: reduce)");a=!o||o.matches}return a}})(),yne=20,rI="default",xQ=(a,o)=>{let{toastLimit:c}=a.settings;switch(o.type){case 0:return{...a,toasts:[o.toast,...a.toasts].slice(0,c)};case 1:return{...a,toasts:a.toasts.map(g=>g.id===o.toast.id?{...g,...o.toast}:g)};case 2:let{toast:d}=o;return xQ(a,{type:a.toasts.find(g=>g.id===d.id)?1:0,toast:d});case 3:let{toastId:h}=o;return{...a,toasts:a.toasts.map(g=>g.id===h||h===void 0?{...g,dismissed:!0,visible:!1}:g)};case 4:return o.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(g=>g.id!==o.toastId)};case 5:return{...a,pausedAt:o.time};case 6:let m=o.time-(a.pausedAt||0);return{...a,pausedAt:void 0,toasts:a.toasts.map(g=>({...g,pauseDuration:g.pauseDuration+m}))}}},my=[],vQ={toasts:[],pausedAt:void 0,settings:{toastLimit:yne}},qd={},wQ=(a,o=rI)=>{qd[o]=xQ(qd[o]||vQ,a),my.forEach(([c,d])=>{c===o&&d(qd[o])})},_Q=a=>Object.keys(qd).forEach(o=>wQ(a,o)),Ene=a=>Object.keys(qd).find(o=>qd[o].toasts.some(c=>c.id===a)),lE=(a=rI)=>o=>{wQ(o,a)},Sne={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Cne=(a={},o=rI)=>{let[c,d]=te.useState(qd[o]||vQ),h=te.useRef(qd[o]);te.useEffect(()=>(h.current!==qd[o]&&d(qd[o]),my.push([o,d]),()=>{let g=my.findIndex(([x])=>x===o);g>-1&&my.splice(g,1)}),[o]);let m=c.toasts.map(g=>{var x,v,E;return{...a,...a[g.type],...g,removeDelay:g.removeDelay||((x=a[g.type])==null?void 0:x.removeDelay)||(a==null?void 0:a.removeDelay),duration:g.duration||((v=a[g.type])==null?void 0:v.duration)||(a==null?void 0:a.duration)||Sne[g.type],style:{...a.style,...(E=a[g.type])==null?void 0:E.style,...g.style}}});return{...c,toasts:m}},Nne=(a,o="blank",c)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:o,ariaProps:{role:"status","aria-live":"polite"},message:a,pauseDuration:0,...c,id:(c==null?void 0:c.id)||_ne()}),cx=a=>(o,c)=>{let d=Nne(o,a,c);return lE(d.toasterId||Ene(d.id))({type:2,toast:d}),d.id},na=(a,o)=>cx("blank")(a,o);na.error=cx("error");na.success=cx("success");na.loading=cx("loading");na.custom=cx("custom");na.dismiss=(a,o)=>{let c={type:3,toastId:a};o?lE(o)(c):_Q(c)};na.dismissAll=a=>na.dismiss(void 0,a);na.remove=(a,o)=>{let c={type:4,toastId:a};o?lE(o)(c):_Q(c)};na.removeAll=a=>na.remove(void 0,a);na.promise=(a,o,c)=>{let d=na.loading(o.loading,{...c,...c==null?void 0:c.loading});return typeof a=="function"&&(a=a()),a.then(h=>{let m=o.success?ky(o.success,h):void 0;return m?na.success(m,{id:d,...c,...c==null?void 0:c.success}):na.dismiss(d),h}).catch(h=>{let m=o.error?ky(o.error,h):void 0;m?na.error(m,{id:d,...c,...c==null?void 0:c.error}):na.dismiss(d)}),a};var Tne=1e3,Rne=(a,o="default")=>{let{toasts:c,pausedAt:d}=Cne(a,o),h=te.useRef(new Map).current,m=te.useCallback((I,k=Tne)=>{if(h.has(I))return;let R=setTimeout(()=>{h.delete(I),g({type:4,toastId:I})},k);h.set(I,R)},[]);te.useEffect(()=>{if(d)return;let I=Date.now(),k=c.map(R=>{if(R.duration===1/0)return;let O=(R.duration||0)+R.pauseDuration-(I-R.createdAt);if(O<0){R.visible&&na.dismiss(R.id);return}return setTimeout(()=>na.dismiss(R.id,o),O)});return()=>{k.forEach(R=>R&&clearTimeout(R))}},[c,d,o]);let g=te.useCallback(lE(o),[o]),x=te.useCallback(()=>{g({type:5,time:Date.now()})},[g]),v=te.useCallback((I,k)=>{g({type:1,toast:{id:I,height:k}})},[g]),E=te.useCallback(()=>{d&&g({type:6,time:Date.now()})},[d,g]),S=te.useCallback((I,k)=>{let{reverseOrder:R=!1,gutter:O=8,defaultPosition:F}=k||{},M=c.filter($=>($.position||F)===(I.position||F)&&$.height),Q=M.findIndex($=>$.id===I.id),Z=M.filter(($,X)=>X<Q&&$.visible).length;return M.filter($=>$.visible).slice(...R?[Z+1]:[0,Z]).reduce(($,X)=>$+(X.height||0)+O,0)},[c]);return te.useEffect(()=>{c.forEach(I=>{if(I.dismissed)m(I.id,I.removeDelay);else{let k=h.get(I.id);k&&(clearTimeout(k),h.delete(I.id))}})},[c,m]),{toasts:c,handlers:{updateHeight:v,startPause:x,endPause:E,calculateOffset:S}}},Ine=qA`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,One=qA`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,kne=qA`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Dne=hh("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${a=>a.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Ine} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${One} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${a=>a.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${kne} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Bne=qA`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Lne=hh("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${a=>a.secondary||"#e0e0e0"};
  border-right-color: ${a=>a.primary||"#616161"};
  animation: ${Bne} 1s linear infinite;
`,jne=qA`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Pne=qA`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Une=hh("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${a=>a.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${jne} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Pne} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${a=>a.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Fne=hh("div")`
  position: absolute;
`,Mne=hh("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Vne=qA`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Qne=hh("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Vne} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Hne=({toast:a})=>{let{icon:o,type:c,iconTheme:d}=a;return o!==void 0?typeof o=="string"?te.createElement(Qne,null,o):o:c==="blank"?null:te.createElement(Mne,null,te.createElement(Lne,{...d}),c!=="loading"&&te.createElement(Fne,null,c==="error"?te.createElement(Dne,{...d}):te.createElement(Une,{...d})))},Gne=a=>`
0% {transform: translate3d(0,${a*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Kne=a=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${a*-150}%,-1px) scale(.6); opacity:0;}
`,Wne="0%{opacity:0;} 100%{opacity:1;}",zne="0%{opacity:1;} 100%{opacity:0;}",qne=hh("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Yne=hh("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Xne=(a,o)=>{let c=a.includes("top")?1:-1,[d,h]=bQ()?[Wne,zne]:[Gne(c),Kne(c)];return{animation:o?`${qA(d)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${qA(h)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Jne=te.memo(({toast:a,position:o,style:c,children:d})=>{let h=a.height?Xne(a.position||o||"top-center",a.visible):{opacity:0},m=te.createElement(Hne,{toast:a}),g=te.createElement(Yne,{...a.ariaProps},ky(a.message,a));return te.createElement(qne,{className:a.className,style:{...h,...c,...a.style}},typeof d=="function"?d({icon:m,message:g}):te.createElement(te.Fragment,null,m,g))});vne(te.createElement);var $ne=({id:a,className:o,style:c,onHeightUpdate:d,children:h})=>{let m=te.useCallback(g=>{if(g){let x=()=>{let v=g.getBoundingClientRect().height;d(a,v)};x(),new MutationObserver(x).observe(g,{subtree:!0,childList:!0,characterData:!0})}},[a,d]);return te.createElement("div",{ref:m,className:o,style:c},h)},Zne=(a,o)=>{let c=a.includes("top"),d=c?{top:0}:{bottom:0},h=a.includes("center")?{justifyContent:"center"}:a.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:bQ()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${o*(c?1:-1)}px)`,...d,...h}},eie=cE`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,k_=16,tie=({reverseOrder:a,position:o="top-center",toastOptions:c,gutter:d,children:h,toasterId:m,containerStyle:g,containerClassName:x})=>{let{toasts:v,handlers:E}=Rne(c,m);return te.createElement("div",{"data-rht-toaster":m||"",style:{position:"fixed",zIndex:9999,top:k_,left:k_,right:k_,bottom:k_,pointerEvents:"none",...g},className:x,onMouseEnter:E.startPause,onMouseLeave:E.endPause},v.map(S=>{let I=S.position||o,k=E.calculateOffset(S,{reverseOrder:a,gutter:d,defaultPosition:o}),R=Zne(I,k);return te.createElement($ne,{id:S.id,key:S.id,onHeightUpdate:E.updateHeight,className:S.visible?eie:"",style:R},S.type==="custom"?ky(S.message,S):h?h(S):te.createElement(Jne,{toast:S,position:I}))}))},Ct=na;function yQ(a,o){return function(){return a.apply(o,arguments)}}const{toString:sie}=Object.prototype,{getPrototypeOf:nI}=Object,{iterator:dE,toStringTag:EQ}=Symbol,AE=(a=>o=>{const c=sie.call(o);return a[c]||(a[c]=c.slice(8,-1).toLowerCase())})(Object.create(null)),td=a=>(a=a.toLowerCase(),o=>AE(o)===a),uE=a=>o=>typeof o===a,{isArray:Ng}=Array,_g=uE("undefined");function lx(a){return a!==null&&!_g(a)&&a.constructor!==null&&!_g(a.constructor)&&zo(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const SQ=td("ArrayBuffer");function rie(a){let o;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?o=ArrayBuffer.isView(a):o=a&&a.buffer&&SQ(a.buffer),o}const nie=uE("string"),zo=uE("function"),CQ=uE("number"),dx=a=>a!==null&&typeof a=="object",iie=a=>a===!0||a===!1,fy=a=>{if(AE(a)!=="object")return!1;const o=nI(a);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(EQ in a)&&!(dE in a)},aie=a=>{if(!dx(a)||lx(a))return!1;try{return Object.keys(a).length===0&&Object.getPrototypeOf(a)===Object.prototype}catch{return!1}},oie=td("Date"),cie=td("File"),lie=td("Blob"),die=td("FileList"),Aie=a=>dx(a)&&zo(a.pipe),uie=a=>{let o;return a&&(typeof FormData=="function"&&a instanceof FormData||zo(a.append)&&((o=AE(a))==="formdata"||o==="object"&&zo(a.toString)&&a.toString()==="[object FormData]"))},hie=td("URLSearchParams"),[pie,mie,fie,gie]=["ReadableStream","Request","Response","Headers"].map(td),bie=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ax(a,o,{allOwnKeys:c=!1}={}){if(a===null||typeof a>"u")return;let d,h;if(typeof a!="object"&&(a=[a]),Ng(a))for(d=0,h=a.length;d<h;d++)o.call(null,a[d],d,a);else{if(lx(a))return;const m=c?Object.getOwnPropertyNames(a):Object.keys(a),g=m.length;let x;for(d=0;d<g;d++)x=m[d],o.call(null,a[x],x,a)}}function NQ(a,o){if(lx(a))return null;o=o.toLowerCase();const c=Object.keys(a);let d=c.length,h;for(;d-- >0;)if(h=c[d],o===h.toLowerCase())return h;return null}const Hp=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,TQ=a=>!_g(a)&&a!==Hp;function JT(){const{caseless:a,skipUndefined:o}=TQ(this)&&this||{},c={},d=(h,m)=>{const g=a&&NQ(c,m)||m;fy(c[g])&&fy(h)?c[g]=JT(c[g],h):fy(h)?c[g]=JT({},h):Ng(h)?c[g]=h.slice():(!o||!_g(h))&&(c[g]=h)};for(let h=0,m=arguments.length;h<m;h++)arguments[h]&&Ax(arguments[h],d);return c}const xie=(a,o,c,{allOwnKeys:d}={})=>(Ax(o,(h,m)=>{c&&zo(h)?a[m]=yQ(h,c):a[m]=h},{allOwnKeys:d}),a),vie=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),wie=(a,o,c,d)=>{a.prototype=Object.create(o.prototype,d),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:o.prototype}),c&&Object.assign(a.prototype,c)},_ie=(a,o,c,d)=>{let h,m,g;const x={};if(o=o||{},a==null)return o;do{for(h=Object.getOwnPropertyNames(a),m=h.length;m-- >0;)g=h[m],(!d||d(g,a,o))&&!x[g]&&(o[g]=a[g],x[g]=!0);a=c!==!1&&nI(a)}while(a&&(!c||c(a,o))&&a!==Object.prototype);return o},yie=(a,o,c)=>{a=String(a),(c===void 0||c>a.length)&&(c=a.length),c-=o.length;const d=a.indexOf(o,c);return d!==-1&&d===c},Eie=a=>{if(!a)return null;if(Ng(a))return a;let o=a.length;if(!CQ(o))return null;const c=new Array(o);for(;o-- >0;)c[o]=a[o];return c},Sie=(a=>o=>a&&o instanceof a)(typeof Uint8Array<"u"&&nI(Uint8Array)),Cie=(a,o)=>{const d=(a&&a[dE]).call(a);let h;for(;(h=d.next())&&!h.done;){const m=h.value;o.call(a,m[0],m[1])}},Nie=(a,o)=>{let c;const d=[];for(;(c=a.exec(o))!==null;)d.push(c);return d},Tie=td("HTMLFormElement"),Rie=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(c,d,h){return d.toUpperCase()+h}),$3=(({hasOwnProperty:a})=>(o,c)=>a.call(o,c))(Object.prototype),Iie=td("RegExp"),RQ=(a,o)=>{const c=Object.getOwnPropertyDescriptors(a),d={};Ax(c,(h,m)=>{let g;(g=o(h,m,a))!==!1&&(d[m]=g||h)}),Object.defineProperties(a,d)},Oie=a=>{RQ(a,(o,c)=>{if(zo(a)&&["arguments","caller","callee"].indexOf(c)!==-1)return!1;const d=a[c];if(zo(d)){if(o.enumerable=!1,"writable"in o){o.writable=!1;return}o.set||(o.set=()=>{throw Error("Can not rewrite read-only method '"+c+"'")})}})},kie=(a,o)=>{const c={},d=h=>{h.forEach(m=>{c[m]=!0})};return Ng(a)?d(a):d(String(a).split(o)),c},Die=()=>{},Bie=(a,o)=>a!=null&&Number.isFinite(a=+a)?a:o;function Lie(a){return!!(a&&zo(a.append)&&a[EQ]==="FormData"&&a[dE])}const jie=a=>{const o=new Array(10),c=(d,h)=>{if(dx(d)){if(o.indexOf(d)>=0)return;if(lx(d))return d;if(!("toJSON"in d)){o[h]=d;const m=Ng(d)?[]:{};return Ax(d,(g,x)=>{const v=c(g,h+1);!_g(v)&&(m[x]=v)}),o[h]=void 0,m}}return d};return c(a,0)},Pie=td("AsyncFunction"),Uie=a=>a&&(dx(a)||zo(a))&&zo(a.then)&&zo(a.catch),IQ=((a,o)=>a?setImmediate:o?((c,d)=>(Hp.addEventListener("message",({source:h,data:m})=>{h===Hp&&m===c&&d.length&&d.shift()()},!1),h=>{d.push(h),Hp.postMessage(c,"*")}))(`axios@${Math.random()}`,[]):c=>setTimeout(c))(typeof setImmediate=="function",zo(Hp.postMessage)),Fie=typeof queueMicrotask<"u"?queueMicrotask.bind(Hp):typeof process<"u"&&process.nextTick||IQ,Mie=a=>a!=null&&zo(a[dE]),xt={isArray:Ng,isArrayBuffer:SQ,isBuffer:lx,isFormData:uie,isArrayBufferView:rie,isString:nie,isNumber:CQ,isBoolean:iie,isObject:dx,isPlainObject:fy,isEmptyObject:aie,isReadableStream:pie,isRequest:mie,isResponse:fie,isHeaders:gie,isUndefined:_g,isDate:oie,isFile:cie,isBlob:lie,isRegExp:Iie,isFunction:zo,isStream:Aie,isURLSearchParams:hie,isTypedArray:Sie,isFileList:die,forEach:Ax,merge:JT,extend:xie,trim:bie,stripBOM:vie,inherits:wie,toFlatObject:_ie,kindOf:AE,kindOfTest:td,endsWith:yie,toArray:Eie,forEachEntry:Cie,matchAll:Nie,isHTMLForm:Tie,hasOwnProperty:$3,hasOwnProp:$3,reduceDescriptors:RQ,freezeMethods:Oie,toObjectSet:kie,toCamelCase:Rie,noop:Die,toFiniteNumber:Bie,findKey:NQ,global:Hp,isContextDefined:TQ,isSpecCompliantForm:Lie,toJSONObject:jie,isAsyncFn:Pie,isThenable:Uie,setImmediate:IQ,asap:Fie,isIterable:Mie};function vr(a,o,c,d,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",o&&(this.code=o),c&&(this.config=c),d&&(this.request=d),h&&(this.response=h,this.status=h.status?h.status:null)}xt.inherits(vr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:xt.toJSONObject(this.config),code:this.code,status:this.status}}});const OQ=vr.prototype,kQ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{kQ[a]={value:a}});Object.defineProperties(vr,kQ);Object.defineProperty(OQ,"isAxiosError",{value:!0});vr.from=(a,o,c,d,h,m)=>{const g=Object.create(OQ);xt.toFlatObject(a,g,function(S){return S!==Error.prototype},E=>E!=="isAxiosError");const x=a&&a.message?a.message:"Error",v=o==null&&a?a.code:o;return vr.call(g,x,v,c,d,h),a&&g.cause==null&&Object.defineProperty(g,"cause",{value:a,configurable:!0}),g.name=a&&a.name||"Error",m&&Object.assign(g,m),g};const Vie=null;function $T(a){return xt.isPlainObject(a)||xt.isArray(a)}function DQ(a){return xt.endsWith(a,"[]")?a.slice(0,-2):a}function Z3(a,o,c){return a?a.concat(o).map(function(h,m){return h=DQ(h),!c&&m?"["+h+"]":h}).join(c?".":""):o}function Qie(a){return xt.isArray(a)&&!a.some($T)}const Hie=xt.toFlatObject(xt,{},null,function(o){return/^is[A-Z]/.test(o)});function hE(a,o,c){if(!xt.isObject(a))throw new TypeError("target must be an object");o=o||new FormData,c=xt.toFlatObject(c,{metaTokens:!0,dots:!1,indexes:!1},!1,function(F,M){return!xt.isUndefined(M[F])});const d=c.metaTokens,h=c.visitor||S,m=c.dots,g=c.indexes,v=(c.Blob||typeof Blob<"u"&&Blob)&&xt.isSpecCompliantForm(o);if(!xt.isFunction(h))throw new TypeError("visitor must be a function");function E(O){if(O===null)return"";if(xt.isDate(O))return O.toISOString();if(xt.isBoolean(O))return O.toString();if(!v&&xt.isBlob(O))throw new vr("Blob is not supported. Use a Buffer instead.");return xt.isArrayBuffer(O)||xt.isTypedArray(O)?v&&typeof Blob=="function"?new Blob([O]):Buffer.from(O):O}function S(O,F,M){let Q=O;if(O&&!M&&typeof O=="object"){if(xt.endsWith(F,"{}"))F=d?F:F.slice(0,-2),O=JSON.stringify(O);else if(xt.isArray(O)&&Qie(O)||(xt.isFileList(O)||xt.endsWith(F,"[]"))&&(Q=xt.toArray(O)))return F=DQ(F),Q.forEach(function($,X){!(xt.isUndefined($)||$===null)&&o.append(g===!0?Z3([F],X,m):g===null?F:F+"[]",E($))}),!1}return $T(O)?!0:(o.append(Z3(M,F,m),E(O)),!1)}const I=[],k=Object.assign(Hie,{defaultVisitor:S,convertValue:E,isVisitable:$T});function R(O,F){if(!xt.isUndefined(O)){if(I.indexOf(O)!==-1)throw Error("Circular reference detected in "+F.join("."));I.push(O),xt.forEach(O,function(Q,Z){(!(xt.isUndefined(Q)||Q===null)&&h.call(o,Q,xt.isString(Z)?Z.trim():Z,F,k))===!0&&R(Q,F?F.concat(Z):[Z])}),I.pop()}}if(!xt.isObject(a))throw new TypeError("data must be an object");return R(a),o}function e6(a){const o={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(d){return o[d]})}function iI(a,o){this._pairs=[],a&&hE(a,this,o)}const BQ=iI.prototype;BQ.append=function(o,c){this._pairs.push([o,c])};BQ.toString=function(o){const c=o?function(d){return o.call(this,d,e6)}:e6;return this._pairs.map(function(h){return c(h[0])+"="+c(h[1])},"").join("&")};function Gie(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function LQ(a,o,c){if(!o)return a;const d=c&&c.encode||Gie;xt.isFunction(c)&&(c={serialize:c});const h=c&&c.serialize;let m;if(h?m=h(o,c):m=xt.isURLSearchParams(o)?o.toString():new iI(o,c).toString(d),m){const g=a.indexOf("#");g!==-1&&(a=a.slice(0,g)),a+=(a.indexOf("?")===-1?"?":"&")+m}return a}class t6{constructor(){this.handlers=[]}use(o,c,d){return this.handlers.push({fulfilled:o,rejected:c,synchronous:d?d.synchronous:!1,runWhen:d?d.runWhen:null}),this.handlers.length-1}eject(o){this.handlers[o]&&(this.handlers[o]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(o){xt.forEach(this.handlers,function(d){d!==null&&o(d)})}}const jQ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Kie=typeof URLSearchParams<"u"?URLSearchParams:iI,Wie=typeof FormData<"u"?FormData:null,zie=typeof Blob<"u"?Blob:null,qie={isBrowser:!0,classes:{URLSearchParams:Kie,FormData:Wie,Blob:zie},protocols:["http","https","file","blob","url","data"]},aI=typeof window<"u"&&typeof document<"u",ZT=typeof navigator=="object"&&navigator||void 0,Yie=aI&&(!ZT||["ReactNative","NativeScript","NS"].indexOf(ZT.product)<0),Xie=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Jie=aI&&window.location.href||"http://localhost",$ie=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:aI,hasStandardBrowserEnv:Yie,hasStandardBrowserWebWorkerEnv:Xie,navigator:ZT,origin:Jie},Symbol.toStringTag,{value:"Module"})),eo={...$ie,...qie};function Zie(a,o){return hE(a,new eo.classes.URLSearchParams,{visitor:function(c,d,h,m){return eo.isNode&&xt.isBuffer(c)?(this.append(d,c.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)},...o})}function eae(a){return xt.matchAll(/\w+|\[(\w*)]/g,a).map(o=>o[0]==="[]"?"":o[1]||o[0])}function tae(a){const o={},c=Object.keys(a);let d;const h=c.length;let m;for(d=0;d<h;d++)m=c[d],o[m]=a[m];return o}function PQ(a){function o(c,d,h,m){let g=c[m++];if(g==="__proto__")return!0;const x=Number.isFinite(+g),v=m>=c.length;return g=!g&&xt.isArray(h)?h.length:g,v?(xt.hasOwnProp(h,g)?h[g]=[h[g],d]:h[g]=d,!x):((!h[g]||!xt.isObject(h[g]))&&(h[g]=[]),o(c,d,h[g],m)&&xt.isArray(h[g])&&(h[g]=tae(h[g])),!x)}if(xt.isFormData(a)&&xt.isFunction(a.entries)){const c={};return xt.forEachEntry(a,(d,h)=>{o(eae(d),h,c,0)}),c}return null}function sae(a,o,c){if(xt.isString(a))try{return(o||JSON.parse)(a),xt.trim(a)}catch(d){if(d.name!=="SyntaxError")throw d}return(c||JSON.stringify)(a)}const ux={transitional:jQ,adapter:["xhr","http","fetch"],transformRequest:[function(o,c){const d=c.getContentType()||"",h=d.indexOf("application/json")>-1,m=xt.isObject(o);if(m&&xt.isHTMLForm(o)&&(o=new FormData(o)),xt.isFormData(o))return h?JSON.stringify(PQ(o)):o;if(xt.isArrayBuffer(o)||xt.isBuffer(o)||xt.isStream(o)||xt.isFile(o)||xt.isBlob(o)||xt.isReadableStream(o))return o;if(xt.isArrayBufferView(o))return o.buffer;if(xt.isURLSearchParams(o))return c.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),o.toString();let x;if(m){if(d.indexOf("application/x-www-form-urlencoded")>-1)return Zie(o,this.formSerializer).toString();if((x=xt.isFileList(o))||d.indexOf("multipart/form-data")>-1){const v=this.env&&this.env.FormData;return hE(x?{"files[]":o}:o,v&&new v,this.formSerializer)}}return m||h?(c.setContentType("application/json",!1),sae(o)):o}],transformResponse:[function(o){const c=this.transitional||ux.transitional,d=c&&c.forcedJSONParsing,h=this.responseType==="json";if(xt.isResponse(o)||xt.isReadableStream(o))return o;if(o&&xt.isString(o)&&(d&&!this.responseType||h)){const g=!(c&&c.silentJSONParsing)&&h;try{return JSON.parse(o,this.parseReviver)}catch(x){if(g)throw x.name==="SyntaxError"?vr.from(x,vr.ERR_BAD_RESPONSE,this,null,this.response):x}}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:eo.classes.FormData,Blob:eo.classes.Blob},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};xt.forEach(["delete","get","head","post","put","patch"],a=>{ux.headers[a]={}});const rae=xt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),nae=a=>{const o={};let c,d,h;return a&&a.split(`
`).forEach(function(g){h=g.indexOf(":"),c=g.substring(0,h).trim().toLowerCase(),d=g.substring(h+1).trim(),!(!c||o[c]&&rae[c])&&(c==="set-cookie"?o[c]?o[c].push(d):o[c]=[d]:o[c]=o[c]?o[c]+", "+d:d)}),o},s6=Symbol("internals");function wb(a){return a&&String(a).trim().toLowerCase()}function gy(a){return a===!1||a==null?a:xt.isArray(a)?a.map(gy):String(a)}function iae(a){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=c.exec(a);)o[d[1]]=d[2];return o}const aae=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function Q2(a,o,c,d,h){if(xt.isFunction(d))return d.call(this,o,c);if(h&&(o=c),!!xt.isString(o)){if(xt.isString(d))return o.indexOf(d)!==-1;if(xt.isRegExp(d))return d.test(o)}}function oae(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(o,c,d)=>c.toUpperCase()+d)}function cae(a,o){const c=xt.toCamelCase(" "+o);["get","set","has"].forEach(d=>{Object.defineProperty(a,d+c,{value:function(h,m,g){return this[d].call(this,o,h,m,g)},configurable:!0})})}let qo=class{constructor(o){o&&this.set(o)}set(o,c,d){const h=this;function m(x,v,E){const S=wb(v);if(!S)throw new Error("header name must be a non-empty string");const I=xt.findKey(h,S);(!I||h[I]===void 0||E===!0||E===void 0&&h[I]!==!1)&&(h[I||v]=gy(x))}const g=(x,v)=>xt.forEach(x,(E,S)=>m(E,S,v));if(xt.isPlainObject(o)||o instanceof this.constructor)g(o,c);else if(xt.isString(o)&&(o=o.trim())&&!aae(o))g(nae(o),c);else if(xt.isObject(o)&&xt.isIterable(o)){let x={},v,E;for(const S of o){if(!xt.isArray(S))throw TypeError("Object iterator must return a key-value pair");x[E=S[0]]=(v=x[E])?xt.isArray(v)?[...v,S[1]]:[v,S[1]]:S[1]}g(x,c)}else o!=null&&m(c,o,d);return this}get(o,c){if(o=wb(o),o){const d=xt.findKey(this,o);if(d){const h=this[d];if(!c)return h;if(c===!0)return iae(h);if(xt.isFunction(c))return c.call(this,h,d);if(xt.isRegExp(c))return c.exec(h);throw new TypeError("parser must be boolean|regexp|function")}}}has(o,c){if(o=wb(o),o){const d=xt.findKey(this,o);return!!(d&&this[d]!==void 0&&(!c||Q2(this,this[d],d,c)))}return!1}delete(o,c){const d=this;let h=!1;function m(g){if(g=wb(g),g){const x=xt.findKey(d,g);x&&(!c||Q2(d,d[x],x,c))&&(delete d[x],h=!0)}}return xt.isArray(o)?o.forEach(m):m(o),h}clear(o){const c=Object.keys(this);let d=c.length,h=!1;for(;d--;){const m=c[d];(!o||Q2(this,this[m],m,o,!0))&&(delete this[m],h=!0)}return h}normalize(o){const c=this,d={};return xt.forEach(this,(h,m)=>{const g=xt.findKey(d,m);if(g){c[g]=gy(h),delete c[m];return}const x=o?oae(m):String(m).trim();x!==m&&delete c[m],c[x]=gy(h),d[x]=!0}),this}concat(...o){return this.constructor.concat(this,...o)}toJSON(o){const c=Object.create(null);return xt.forEach(this,(d,h)=>{d!=null&&d!==!1&&(c[h]=o&&xt.isArray(d)?d.join(", "):d)}),c}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([o,c])=>o+": "+c).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(o){return o instanceof this?o:new this(o)}static concat(o,...c){const d=new this(o);return c.forEach(h=>d.set(h)),d}static accessor(o){const d=(this[s6]=this[s6]={accessors:{}}).accessors,h=this.prototype;function m(g){const x=wb(g);d[x]||(cae(h,g),d[x]=!0)}return xt.isArray(o)?o.forEach(m):m(o),this}};qo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);xt.reduceDescriptors(qo.prototype,({value:a},o)=>{let c=o[0].toUpperCase()+o.slice(1);return{get:()=>a,set(d){this[c]=d}}});xt.freezeMethods(qo);function H2(a,o){const c=this||ux,d=o||c,h=qo.from(d.headers);let m=d.data;return xt.forEach(a,function(x){m=x.call(c,m,h.normalize(),o?o.status:void 0)}),h.normalize(),m}function UQ(a){return!!(a&&a.__CANCEL__)}function Tg(a,o,c){vr.call(this,a??"canceled",vr.ERR_CANCELED,o,c),this.name="CanceledError"}xt.inherits(Tg,vr,{__CANCEL__:!0});function FQ(a,o,c){const d=c.config.validateStatus;!c.status||!d||d(c.status)?a(c):o(new vr("Request failed with status code "+c.status,[vr.ERR_BAD_REQUEST,vr.ERR_BAD_RESPONSE][Math.floor(c.status/100)-4],c.config,c.request,c))}function lae(a){const o=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return o&&o[1]||""}function dae(a,o){a=a||10;const c=new Array(a),d=new Array(a);let h=0,m=0,g;return o=o!==void 0?o:1e3,function(v){const E=Date.now(),S=d[m];g||(g=E),c[h]=v,d[h]=E;let I=m,k=0;for(;I!==h;)k+=c[I++],I=I%a;if(h=(h+1)%a,h===m&&(m=(m+1)%a),E-g<o)return;const R=S&&E-S;return R?Math.round(k*1e3/R):void 0}}function Aae(a,o){let c=0,d=1e3/o,h,m;const g=(E,S=Date.now())=>{c=S,h=null,m&&(clearTimeout(m),m=null),a(...E)};return[(...E)=>{const S=Date.now(),I=S-c;I>=d?g(E,S):(h=E,m||(m=setTimeout(()=>{m=null,g(h)},d-I)))},()=>h&&g(h)]}const Dy=(a,o,c=3)=>{let d=0;const h=dae(50,250);return Aae(m=>{const g=m.loaded,x=m.lengthComputable?m.total:void 0,v=g-d,E=h(v),S=g<=x;d=g;const I={loaded:g,total:x,progress:x?g/x:void 0,bytes:v,rate:E||void 0,estimated:E&&x&&S?(x-g)/E:void 0,event:m,lengthComputable:x!=null,[o?"download":"upload"]:!0};a(I)},c)},r6=(a,o)=>{const c=a!=null;return[d=>o[0]({lengthComputable:c,total:a,loaded:d}),o[1]]},n6=a=>(...o)=>xt.asap(()=>a(...o)),uae=eo.hasStandardBrowserEnv?((a,o)=>c=>(c=new URL(c,eo.origin),a.protocol===c.protocol&&a.host===c.host&&(o||a.port===c.port)))(new URL(eo.origin),eo.navigator&&/(msie|trident)/i.test(eo.navigator.userAgent)):()=>!0,hae=eo.hasStandardBrowserEnv?{write(a,o,c,d,h,m,g){if(typeof document>"u")return;const x=[`${a}=${encodeURIComponent(o)}`];xt.isNumber(c)&&x.push(`expires=${new Date(c).toUTCString()}`),xt.isString(d)&&x.push(`path=${d}`),xt.isString(h)&&x.push(`domain=${h}`),m===!0&&x.push("secure"),xt.isString(g)&&x.push(`SameSite=${g}`),document.cookie=x.join("; ")},read(a){if(typeof document>"u")return null;const o=document.cookie.match(new RegExp("(?:^|; )"+a+"=([^;]*)"));return o?decodeURIComponent(o[1]):null},remove(a){this.write(a,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function pae(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function mae(a,o){return o?a.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):a}function MQ(a,o,c){let d=!pae(o);return a&&(d||c==!1)?mae(a,o):o}const i6=a=>a instanceof qo?{...a}:a;function Jp(a,o){o=o||{};const c={};function d(E,S,I,k){return xt.isPlainObject(E)&&xt.isPlainObject(S)?xt.merge.call({caseless:k},E,S):xt.isPlainObject(S)?xt.merge({},S):xt.isArray(S)?S.slice():S}function h(E,S,I,k){if(xt.isUndefined(S)){if(!xt.isUndefined(E))return d(void 0,E,I,k)}else return d(E,S,I,k)}function m(E,S){if(!xt.isUndefined(S))return d(void 0,S)}function g(E,S){if(xt.isUndefined(S)){if(!xt.isUndefined(E))return d(void 0,E)}else return d(void 0,S)}function x(E,S,I){if(I in o)return d(E,S);if(I in a)return d(void 0,E)}const v={url:m,method:m,data:m,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:x,headers:(E,S,I)=>h(i6(E),i6(S),I,!0)};return xt.forEach(Object.keys({...a,...o}),function(S){const I=v[S]||h,k=I(a[S],o[S],S);xt.isUndefined(k)&&I!==x||(c[S]=k)}),c}const VQ=a=>{const o=Jp({},a);let{data:c,withXSRFToken:d,xsrfHeaderName:h,xsrfCookieName:m,headers:g,auth:x}=o;if(o.headers=g=qo.from(g),o.url=LQ(MQ(o.baseURL,o.url,o.allowAbsoluteUrls),a.params,a.paramsSerializer),x&&g.set("Authorization","Basic "+btoa((x.username||"")+":"+(x.password?unescape(encodeURIComponent(x.password)):""))),xt.isFormData(c)){if(eo.hasStandardBrowserEnv||eo.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if(xt.isFunction(c.getHeaders)){const v=c.getHeaders(),E=["content-type","content-length"];Object.entries(v).forEach(([S,I])=>{E.includes(S.toLowerCase())&&g.set(S,I)})}}if(eo.hasStandardBrowserEnv&&(d&&xt.isFunction(d)&&(d=d(o)),d||d!==!1&&uae(o.url))){const v=h&&m&&hae.read(m);v&&g.set(h,v)}return o},fae=typeof XMLHttpRequest<"u",gae=fae&&function(a){return new Promise(function(c,d){const h=VQ(a);let m=h.data;const g=qo.from(h.headers).normalize();let{responseType:x,onUploadProgress:v,onDownloadProgress:E}=h,S,I,k,R,O;function F(){R&&R(),O&&O(),h.cancelToken&&h.cancelToken.unsubscribe(S),h.signal&&h.signal.removeEventListener("abort",S)}let M=new XMLHttpRequest;M.open(h.method.toUpperCase(),h.url,!0),M.timeout=h.timeout;function Q(){if(!M)return;const $=qo.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders()),be={data:!x||x==="text"||x==="json"?M.responseText:M.response,status:M.status,statusText:M.statusText,headers:$,config:a,request:M};FQ(function(Ne){c(Ne),F()},function(Ne){d(Ne),F()},be),M=null}"onloadend"in M?M.onloadend=Q:M.onreadystatechange=function(){!M||M.readyState!==4||M.status===0&&!(M.responseURL&&M.responseURL.indexOf("file:")===0)||setTimeout(Q)},M.onabort=function(){M&&(d(new vr("Request aborted",vr.ECONNABORTED,a,M)),M=null)},M.onerror=function(X){const be=X&&X.message?X.message:"Network Error",me=new vr(be,vr.ERR_NETWORK,a,M);me.event=X||null,d(me),M=null},M.ontimeout=function(){let X=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded";const be=h.transitional||jQ;h.timeoutErrorMessage&&(X=h.timeoutErrorMessage),d(new vr(X,be.clarifyTimeoutError?vr.ETIMEDOUT:vr.ECONNABORTED,a,M)),M=null},m===void 0&&g.setContentType(null),"setRequestHeader"in M&&xt.forEach(g.toJSON(),function(X,be){M.setRequestHeader(be,X)}),xt.isUndefined(h.withCredentials)||(M.withCredentials=!!h.withCredentials),x&&x!=="json"&&(M.responseType=h.responseType),E&&([k,O]=Dy(E,!0),M.addEventListener("progress",k)),v&&M.upload&&([I,R]=Dy(v),M.upload.addEventListener("progress",I),M.upload.addEventListener("loadend",R)),(h.cancelToken||h.signal)&&(S=$=>{M&&(d(!$||$.type?new Tg(null,a,M):$),M.abort(),M=null)},h.cancelToken&&h.cancelToken.subscribe(S),h.signal&&(h.signal.aborted?S():h.signal.addEventListener("abort",S)));const Z=lae(h.url);if(Z&&eo.protocols.indexOf(Z)===-1){d(new vr("Unsupported protocol "+Z+":",vr.ERR_BAD_REQUEST,a));return}M.send(m||null)})},bae=(a,o)=>{const{length:c}=a=a?a.filter(Boolean):[];if(o||c){let d=new AbortController,h;const m=function(E){if(!h){h=!0,x();const S=E instanceof Error?E:this.reason;d.abort(S instanceof vr?S:new Tg(S instanceof Error?S.message:S))}};let g=o&&setTimeout(()=>{g=null,m(new vr(`timeout ${o} of ms exceeded`,vr.ETIMEDOUT))},o);const x=()=>{a&&(g&&clearTimeout(g),g=null,a.forEach(E=>{E.unsubscribe?E.unsubscribe(m):E.removeEventListener("abort",m)}),a=null)};a.forEach(E=>E.addEventListener("abort",m));const{signal:v}=d;return v.unsubscribe=()=>xt.asap(x),v}},xae=function*(a,o){let c=a.byteLength;if(c<o){yield a;return}let d=0,h;for(;d<c;)h=d+o,yield a.slice(d,h),d=h},vae=async function*(a,o){for await(const c of wae(a))yield*xae(c,o)},wae=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const o=a.getReader();try{for(;;){const{done:c,value:d}=await o.read();if(c)break;yield d}}finally{await o.cancel()}},a6=(a,o,c,d)=>{const h=vae(a,o);let m=0,g,x=v=>{g||(g=!0,d&&d(v))};return new ReadableStream({async pull(v){try{const{done:E,value:S}=await h.next();if(E){x(),v.close();return}let I=S.byteLength;if(c){let k=m+=I;c(k)}v.enqueue(new Uint8Array(S))}catch(E){throw x(E),E}},cancel(v){return x(v),h.return()}},{highWaterMark:2})},o6=64*1024,{isFunction:D_}=xt,_ae=(({Request:a,Response:o})=>({Request:a,Response:o}))(xt.global),{ReadableStream:c6,TextEncoder:l6}=xt.global,d6=(a,...o)=>{try{return!!a(...o)}catch{return!1}},yae=a=>{a=xt.merge.call({skipUndefined:!0},_ae,a);const{fetch:o,Request:c,Response:d}=a,h=o?D_(o):typeof fetch=="function",m=D_(c),g=D_(d);if(!h)return!1;const x=h&&D_(c6),v=h&&(typeof l6=="function"?(O=>F=>O.encode(F))(new l6):async O=>new Uint8Array(await new c(O).arrayBuffer())),E=m&&x&&d6(()=>{let O=!1;const F=new c(eo.origin,{body:new c6,method:"POST",get duplex(){return O=!0,"half"}}).headers.has("Content-Type");return O&&!F}),S=g&&x&&d6(()=>xt.isReadableStream(new d("").body)),I={stream:S&&(O=>O.body)};h&&["text","arrayBuffer","blob","formData","stream"].forEach(O=>{!I[O]&&(I[O]=(F,M)=>{let Q=F&&F[O];if(Q)return Q.call(F);throw new vr(`Response type '${O}' is not supported`,vr.ERR_NOT_SUPPORT,M)})});const k=async O=>{if(O==null)return 0;if(xt.isBlob(O))return O.size;if(xt.isSpecCompliantForm(O))return(await new c(eo.origin,{method:"POST",body:O}).arrayBuffer()).byteLength;if(xt.isArrayBufferView(O)||xt.isArrayBuffer(O))return O.byteLength;if(xt.isURLSearchParams(O)&&(O=O+""),xt.isString(O))return(await v(O)).byteLength},R=async(O,F)=>{const M=xt.toFiniteNumber(O.getContentLength());return M??k(F)};return async O=>{let{url:F,method:M,data:Q,signal:Z,cancelToken:$,timeout:X,onDownloadProgress:be,onUploadProgress:me,responseType:Ne,headers:le,withCredentials:H="same-origin",fetchOptions:Ae}=VQ(O),J=o||fetch;Ne=Ne?(Ne+"").toLowerCase():"text";let Y=bae([Z,$&&$.toAbortSignal()],X),se=null;const oe=Y&&Y.unsubscribe&&(()=>{Y.unsubscribe()});let Te;try{if(me&&E&&M!=="get"&&M!=="head"&&(Te=await R(le,Q))!==0){let Ue=new c(F,{method:"POST",body:Q,duplex:"half"}),re;if(xt.isFormData(Q)&&(re=Ue.headers.get("content-type"))&&le.setContentType(re),Ue.body){const[ve,fe]=r6(Te,Dy(n6(me)));Q=a6(Ue.body,o6,ve,fe)}}xt.isString(H)||(H=H?"include":"omit");const he=m&&"credentials"in c.prototype,Ce={...Ae,signal:Y,method:M.toUpperCase(),headers:le.normalize().toJSON(),body:Q,duplex:"half",credentials:he?H:void 0};se=m&&new c(F,Ce);let ee=await(m?J(se,Ae):J(F,Ce));const Be=S&&(Ne==="stream"||Ne==="response");if(S&&(be||Be&&oe)){const Ue={};["status","statusText","headers"].forEach(Ie=>{Ue[Ie]=ee[Ie]});const re=xt.toFiniteNumber(ee.headers.get("content-length")),[ve,fe]=be&&r6(re,Dy(n6(be),!0))||[];ee=new d(a6(ee.body,o6,ve,()=>{fe&&fe(),oe&&oe()}),Ue)}Ne=Ne||"text";let He=await I[xt.findKey(I,Ne)||"text"](ee,O);return!Be&&oe&&oe(),await new Promise((Ue,re)=>{FQ(Ue,re,{data:He,headers:qo.from(ee.headers),status:ee.status,statusText:ee.statusText,config:O,request:se})})}catch(he){throw oe&&oe(),he&&he.name==="TypeError"&&/Load failed|fetch/i.test(he.message)?Object.assign(new vr("Network Error",vr.ERR_NETWORK,O,se),{cause:he.cause||he}):vr.from(he,he&&he.code,O,se)}}},Eae=new Map,QQ=a=>{let o=a&&a.env||{};const{fetch:c,Request:d,Response:h}=o,m=[d,h,c];let g=m.length,x=g,v,E,S=Eae;for(;x--;)v=m[x],E=S.get(v),E===void 0&&S.set(v,E=x?new Map:yae(o)),S=E;return E};QQ();const oI={http:Vie,xhr:gae,fetch:{get:QQ}};xt.forEach(oI,(a,o)=>{if(a){try{Object.defineProperty(a,"name",{value:o})}catch{}Object.defineProperty(a,"adapterName",{value:o})}});const A6=a=>`- ${a}`,Sae=a=>xt.isFunction(a)||a===null||a===!1;function Cae(a,o){a=xt.isArray(a)?a:[a];const{length:c}=a;let d,h;const m={};for(let g=0;g<c;g++){d=a[g];let x;if(h=d,!Sae(d)&&(h=oI[(x=String(d)).toLowerCase()],h===void 0))throw new vr(`Unknown adapter '${x}'`);if(h&&(xt.isFunction(h)||(h=h.get(o))))break;m[x||"#"+g]=h}if(!h){const g=Object.entries(m).map(([v,E])=>`adapter ${v} `+(E===!1?"is not supported by the environment":"is not available in the build"));let x=c?g.length>1?`since :
`+g.map(A6).join(`
`):" "+A6(g[0]):"as no adapter specified";throw new vr("There is no suitable adapter to dispatch the request "+x,"ERR_NOT_SUPPORT")}return h}const HQ={getAdapter:Cae,adapters:oI};function G2(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new Tg(null,a)}function u6(a){return G2(a),a.headers=qo.from(a.headers),a.data=H2.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),HQ.getAdapter(a.adapter||ux.adapter,a)(a).then(function(d){return G2(a),d.data=H2.call(a,a.transformResponse,d),d.headers=qo.from(d.headers),d},function(d){return UQ(d)||(G2(a),d&&d.response&&(d.response.data=H2.call(a,a.transformResponse,d.response),d.response.headers=qo.from(d.response.headers))),Promise.reject(d)})}const GQ="1.13.2",pE={};["object","boolean","number","function","string","symbol"].forEach((a,o)=>{pE[a]=function(d){return typeof d===a||"a"+(o<1?"n ":" ")+a}});const h6={};pE.transitional=function(o,c,d){function h(m,g){return"[Axios v"+GQ+"] Transitional option '"+m+"'"+g+(d?". "+d:"")}return(m,g,x)=>{if(o===!1)throw new vr(h(g," has been removed"+(c?" in "+c:"")),vr.ERR_DEPRECATED);return c&&!h6[g]&&(h6[g]=!0,console.warn(h(g," has been deprecated since v"+c+" and will be removed in the near future"))),o?o(m,g,x):!0}};pE.spelling=function(o){return(c,d)=>(console.warn(`${d} is likely a misspelling of ${o}`),!0)};function Nae(a,o,c){if(typeof a!="object")throw new vr("options must be an object",vr.ERR_BAD_OPTION_VALUE);const d=Object.keys(a);let h=d.length;for(;h-- >0;){const m=d[h],g=o[m];if(g){const x=a[m],v=x===void 0||g(x,m,a);if(v!==!0)throw new vr("option "+m+" must be "+v,vr.ERR_BAD_OPTION_VALUE);continue}if(c!==!0)throw new vr("Unknown option "+m,vr.ERR_BAD_OPTION)}}const by={assertOptions:Nae,validators:pE},Qd=by.validators;let Wp=class{constructor(o){this.defaults=o||{},this.interceptors={request:new t6,response:new t6}}async request(o,c){try{return await this._request(o,c)}catch(d){if(d instanceof Error){let h={};Error.captureStackTrace?Error.captureStackTrace(h):h=new Error;const m=h.stack?h.stack.replace(/^.+\n/,""):"";try{d.stack?m&&!String(d.stack).endsWith(m.replace(/^.+\n.+\n/,""))&&(d.stack+=`
`+m):d.stack=m}catch{}}throw d}}_request(o,c){typeof o=="string"?(c=c||{},c.url=o):c=o||{},c=Jp(this.defaults,c);const{transitional:d,paramsSerializer:h,headers:m}=c;d!==void 0&&by.assertOptions(d,{silentJSONParsing:Qd.transitional(Qd.boolean),forcedJSONParsing:Qd.transitional(Qd.boolean),clarifyTimeoutError:Qd.transitional(Qd.boolean)},!1),h!=null&&(xt.isFunction(h)?c.paramsSerializer={serialize:h}:by.assertOptions(h,{encode:Qd.function,serialize:Qd.function},!0)),c.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?c.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:c.allowAbsoluteUrls=!0),by.assertOptions(c,{baseUrl:Qd.spelling("baseURL"),withXsrfToken:Qd.spelling("withXSRFToken")},!0),c.method=(c.method||this.defaults.method||"get").toLowerCase();let g=m&&xt.merge(m.common,m[c.method]);m&&xt.forEach(["delete","get","head","post","put","patch","common"],O=>{delete m[O]}),c.headers=qo.concat(g,m);const x=[];let v=!0;this.interceptors.request.forEach(function(F){typeof F.runWhen=="function"&&F.runWhen(c)===!1||(v=v&&F.synchronous,x.unshift(F.fulfilled,F.rejected))});const E=[];this.interceptors.response.forEach(function(F){E.push(F.fulfilled,F.rejected)});let S,I=0,k;if(!v){const O=[u6.bind(this),void 0];for(O.unshift(...x),O.push(...E),k=O.length,S=Promise.resolve(c);I<k;)S=S.then(O[I++],O[I++]);return S}k=x.length;let R=c;for(;I<k;){const O=x[I++],F=x[I++];try{R=O(R)}catch(M){F.call(this,M);break}}try{S=u6.call(this,R)}catch(O){return Promise.reject(O)}for(I=0,k=E.length;I<k;)S=S.then(E[I++],E[I++]);return S}getUri(o){o=Jp(this.defaults,o);const c=MQ(o.baseURL,o.url,o.allowAbsoluteUrls);return LQ(c,o.params,o.paramsSerializer)}};xt.forEach(["delete","get","head","options"],function(o){Wp.prototype[o]=function(c,d){return this.request(Jp(d||{},{method:o,url:c,data:(d||{}).data}))}});xt.forEach(["post","put","patch"],function(o){function c(d){return function(m,g,x){return this.request(Jp(x||{},{method:o,headers:d?{"Content-Type":"multipart/form-data"}:{},url:m,data:g}))}}Wp.prototype[o]=c(),Wp.prototype[o+"Form"]=c(!0)});let Tae=class KQ{constructor(o){if(typeof o!="function")throw new TypeError("executor must be a function.");let c;this.promise=new Promise(function(m){c=m});const d=this;this.promise.then(h=>{if(!d._listeners)return;let m=d._listeners.length;for(;m-- >0;)d._listeners[m](h);d._listeners=null}),this.promise.then=h=>{let m;const g=new Promise(x=>{d.subscribe(x),m=x}).then(h);return g.cancel=function(){d.unsubscribe(m)},g},o(function(m,g,x){d.reason||(d.reason=new Tg(m,g,x),c(d.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]}unsubscribe(o){if(!this._listeners)return;const c=this._listeners.indexOf(o);c!==-1&&this._listeners.splice(c,1)}toAbortSignal(){const o=new AbortController,c=d=>{o.abort(d)};return this.subscribe(c),o.signal.unsubscribe=()=>this.unsubscribe(c),o.signal}static source(){let o;return{token:new KQ(function(h){o=h}),cancel:o}}};function Rae(a){return function(c){return a.apply(null,c)}}function Iae(a){return xt.isObject(a)&&a.isAxiosError===!0}const eR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(eR).forEach(([a,o])=>{eR[o]=a});function WQ(a){const o=new Wp(a),c=yQ(Wp.prototype.request,o);return xt.extend(c,Wp.prototype,o,{allOwnKeys:!0}),xt.extend(c,o,null,{allOwnKeys:!0}),c.create=function(h){return WQ(Jp(a,h))},c}const Hr=WQ(ux);Hr.Axios=Wp;Hr.CanceledError=Tg;Hr.CancelToken=Tae;Hr.isCancel=UQ;Hr.VERSION=GQ;Hr.toFormData=hE;Hr.AxiosError=vr;Hr.Cancel=Hr.CanceledError;Hr.all=function(o){return Promise.all(o)};Hr.spread=Rae;Hr.isAxiosError=Iae;Hr.mergeConfig=Jp;Hr.AxiosHeaders=qo;Hr.formToJSON=a=>PQ(xt.isHTMLForm(a)?new FormData(a):a);Hr.getAdapter=HQ.getAdapter;Hr.HttpStatusCode=eR;Hr.default=Hr;const{Axios:y0e,AxiosError:E0e,CanceledError:S0e,isCancel:C0e,CancelToken:N0e,VERSION:T0e,all:R0e,Cancel:I0e,isAxiosError:O0e,spread:k0e,toFormData:D0e,AxiosHeaders:B0e,HttpStatusCode:L0e,formToJSON:j0e,getAdapter:P0e,mergeConfig:U0e}=Hr,_b="healthai_cache_",Oae=5*60*1e3,tl={set(a,o,c=Oae){try{const d={value:o,expiry:Date.now()+c};localStorage.setItem(_b+a,JSON.stringify(d))}catch(d){console.error("Cache set error:",d)}},get(a){try{const o=localStorage.getItem(_b+a);if(!o)return null;const c=JSON.parse(o);return Date.now()>c.expiry?(this.delete(a),null):c.value}catch(o){return console.error("Cache get error:",o),null}},delete(a){try{localStorage.removeItem(_b+a)}catch(o){console.error("Cache delete error:",o)}},clear(){try{Object.keys(localStorage).forEach(o=>{o.startsWith(_b)&&localStorage.removeItem(o)})}catch(a){console.error("Cache clear error:",a)}},cleanup(){try{Object.keys(localStorage).forEach(o=>{if(o.startsWith(_b)){const c=localStorage.getItem(o);if(c){const d=JSON.parse(c);Date.now()>d.expiry&&localStorage.removeItem(o)}}})}catch(a){console.error("Cache cleanup error:",a)}}};tl.cleanup();setInterval(()=>tl.cleanup(),5*60*1e3);const kae=()=>"/api",Wt=Hr.create({baseURL:kae(),headers:{"Content-Type":"application/json"}});console.log(" API Configuration:",{baseURL:Wt.defaults.baseURL,hostname:window.location.hostname,isProd:!0,isDev:!1,mode:"production"});Wt.interceptors.request.use(a=>{const o=localStorage.getItem("token");return o&&(a.headers.Authorization=`Bearer ${o}`),a});Wt.interceptors.response.use(a=>a,a=>{var c,d,h;const o=(c=a.config)==null?void 0:c.skipAutoLogout;return((d=a.response)==null?void 0:d.status)===401&&!o?(console.log("401 Unauthorized - Logging out"),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"):((h=a.response)==null?void 0:h.status)===401&&o&&console.log("401 Unauthorized - Skipping auto-logout (skipAutoLogout flag set)"),a.response||console.error("Network Error:",{message:a.message,apiUrl:Wt.defaults.baseURL,currentHost:window.location.hostname,currentPort:window.location.port}),Promise.reject(a)});const ll={uploadReport:a=>Wt.post("/health/upload",a,{headers:{"Content-Type":"multipart/form-data"}}),getReports:()=>Wt.get("/health/reports"),getReport:a=>Wt.get(`/health/reports/${a}`),deleteReport:a=>Wt.delete(`/health/reports/${a}`),getDashboard:()=>Wt.get("/health/dashboard"),getHistory:a=>Wt.get("/health/history",{params:{reportType:a}}),compareReport:a=>Wt.get(`/health/reports/${a}/compare`),chatAboutReport:(a,o,c)=>Wt.post(`/health/reports/${a}/chat`,{message:o,chatHistory:c}),askAI:a=>Wt.post("/health/ai-chat",a),getMetricInfo:a=>Wt.post("/health/metric-info",a)},Wo={getAll:a=>Wt.get("/doctors",{params:a}),getById:a=>Wt.get(`/doctors/${a}`),getRecommended:a=>Wt.get("/doctors/recommended",{params:{specializations:a}}),bookAppointment:a=>Wt.post("/doctors/book",a),getAppointments:()=>Wt.get("/doctors/appointments"),getAppointment:a=>Wt.get(`/doctors/appointments/${a}`),startConsultation:a=>Wt.post(`/doctors/appointments/${a}/start`),endConsultation:a=>Wt.post(`/doctors/appointments/${a}/end`),getConsultationSummary:a=>Wt.get(`/doctors/appointments/${a}/summary`),submitReview:(a,o)=>Wt.post(`/doctors/appointments/${a}/review`,o),downloadPrescription:a=>Wt.get(`/doctors/appointments/${a}/prescription`,{responseType:"blob"}),getDashboard:()=>Wt.get("/doctors/me/dashboard"),getMyProfile:()=>Wt.get("/doctors/me/profile"),updateMyProfile:a=>Wt.put("/doctors/me/profile",a),getMyAppointments:a=>Wt.get("/doctors/me/appointments",{params:a}),updateAppointmentStatus:(a,o)=>Wt.patch(`/doctors/me/appointments/${a}`,o),getPatientProfile:(a,o)=>Wt.get(`/doctors/patient/${a}`,{params:{appointmentId:o}}),getDoctorAppointments:(a,o)=>Wt.get(`/doctors/${a}/appointments`,{params:{status:o}}),getMyAvailability:()=>Wt.get("/doctors/me/availability"),updateMyAvailability:a=>Wt.put("/doctors/me/availability",a),generateTimeSlots:()=>Wt.post("/doctors/me/generate-slots"),getDoctorAvailableSlots:(a,o)=>Wt.get(`/doctors/${a}/available-slots`,{params:{date:o}}),checkSlotAvailability:(a,o,c)=>Wt.get(`/doctors/${a}/check-slot`,{params:{date:o,timeSlot:c}})},ig={connectDevice:(a,o)=>Wt.post("/wearables/connect",{deviceType:a,deviceName:o}),disconnectDevice:a=>Wt.post(`/wearables/disconnect/${a}`),getDevices:()=>Wt.get("/wearables/devices"),syncMetrics:(a,o)=>Wt.post("/wearables/sync",{deviceType:a,metrics:o}),addHeartRate:(a,o,c)=>Wt.post("/wearables/heart-rate",{deviceType:a,bpm:o,type:c}),addSleepData:(a,o)=>Wt.post("/wearables/sleep",{deviceType:a,sleepData:o}),getDashboard:()=>Wt.get("/wearables/dashboard"),generateDemoData:a=>Wt.post("/wearables/demo-data",{deviceType:a})},xy={getStats:()=>Wt.get("/admin/stats"),getUsers:a=>Wt.get("/admin/users",{params:a}),getUserDetails:a=>Wt.get(`/admin/users/${a}`),updateUserStatus:(a,o)=>Wt.patch(`/admin/users/${a}/status`,{isActive:o}),getReports:a=>Wt.get("/admin/reports",{params:a}),getDeficiencyRules:()=>Wt.get("/admin/deficiency-rules"),createDeficiencyRule:a=>Wt.post("/admin/deficiency-rules",a),updateDeficiencyRule:(a,o)=>Wt.put(`/admin/deficiency-rules/${a}`,o),deleteDeficiencyRule:a=>Wt.delete(`/admin/deficiency-rules/${a}`),getSupplements:()=>Wt.get("/admin/supplements"),createSupplement:a=>Wt.post("/admin/supplements",a),updateSupplement:(a,o)=>Wt.put(`/admin/supplements/${a}`,o),deleteSupplement:a=>Wt.delete(`/admin/supplements/${a}`),getDietPlans:a=>Wt.get("/admin/diet-plans",{params:a}),createDietPlan:a=>Wt.post("/admin/diet-plans",a),updateDietPlan:(a,o)=>Wt.put(`/admin/diet-plans/${a}`,o),approveDietPlan:(a,o)=>Wt.patch(`/admin/diet-plans/${a}/approve`,{status:o}),deleteDietPlan:a=>Wt.delete(`/admin/diet-plans/${a}`),getDoctors:a=>Wt.get("/admin/doctors",{params:a}),createDoctor:a=>Wt.post("/admin/doctors",a),updateDoctor:(a,o)=>Wt.put(`/admin/doctors/${a}`,o),approveDoctor:a=>Wt.patch(`/admin/doctors/${a}/approve`),rejectDoctor:(a,o)=>Wt.patch(`/admin/doctors/${a}/reject`,{reason:o}),deleteDoctor:a=>Wt.delete(`/admin/doctors/${a}`),toggleDoctorVisibility:a=>Wt.patch(`/admin/doctors/${a}/visibility`),getDoctorScheduleOverview:a=>Wt.get(`/admin/doctors/${a}/schedule-overview`)},Dae={getSubscription:()=>Wt.get("/auth/subscription")},zQ={analyzeFood:a=>Wt.post("/nutrition/analyze-food",{foodDescription:a}),logMeal:a=>Wt.post("/nutrition/log-meal",a),getTodayLogs:()=>Wt.get("/nutrition/logs/today"),getDailySummary:a=>Wt.get("/nutrition/summary/daily",{params:{date:a}}),getGoals:()=>Wt.get("/nutrition/goals"),updateGoals:a=>Wt.put("/nutrition/goals",a)},qQ=te.createContext(),aa=()=>te.useContext(qQ),Bae=({children:a})=>{const[o,c]=te.useState(null),[d,h]=te.useState(!0);te.useEffect(()=>{const F=localStorage.getItem("token"),M=localStorage.getItem("user");F&&M&&(c(JSON.parse(M)),Wt.defaults.headers.common.Authorization=`Bearer ${F}`),h(!1)},[]);const m=async(F,M)=>{const Z=F.includes("@")?{email:F,password:M}:{phone:F,password:M},{data:$}=await Wt.post("/auth/login",Z);return localStorage.setItem("token",$.token),localStorage.setItem("user",JSON.stringify($)),Wt.defaults.headers.common.Authorization=`Bearer ${$.token}`,c($),$},g=async(F,M,Q,Z={},$=null)=>{const{data:X}=await Wt.post("/auth/register",{name:F,email:M,password:Q,profile:Z,nutritionGoal:$});return localStorage.setItem("token",X.token),localStorage.setItem("user",JSON.stringify(X)),Wt.defaults.headers.common.Authorization=`Bearer ${X.token}`,c(X),X},x=async F=>{const{data:M}=await Wt.post("/auth/register/doctor",F);return localStorage.setItem("token",M.token),localStorage.setItem("user",JSON.stringify(M)),Wt.defaults.headers.common.Authorization=`Bearer ${M.token}`,c(M),M},v=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),delete Wt.defaults.headers.common.Authorization,c(null)},E=F=>{c(F),localStorage.setItem("user",JSON.stringify(F))},S=()=>(o==null?void 0:o.role)==="admin",I=()=>(o==null?void 0:o.role)==="doctor",k=()=>(o==null?void 0:o.role)==="patient"||(o==null?void 0:o.role)==="client",R=()=>{var F;return((F=o==null?void 0:o.doctorProfile)==null?void 0:F.approvalStatus)==="approved"},O=()=>{var F;return((F=o==null?void 0:o.subscription)==null?void 0:F.status)==="active"};return n.jsx(qQ.Provider,{value:{user:o,login:m,register:g,registerDoctor:x,logout:v,updateUser:E,loading:d,isAdmin:S,isDoctor:I,isPatient:k,isDoctorApproved:R,isSubscribed:O},children:a})};function Lae(){const[a,o]=te.useState(""),[c,d]=te.useState({x:0,y:0}),[h,m]=te.useState(!1),g=to();te.useEffect(()=>{const v=()=>{const E=window.getSelection(),S=E.toString().trim();if(S.length>0){const k=E.getRangeAt(0).getBoundingClientRect();o(S),d({x:k.left+k.width/2,y:k.top-10}),m(!0)}else m(!1)};return document.addEventListener("mouseup",v),document.addEventListener("touchend",v),()=>{document.removeEventListener("mouseup",v),document.removeEventListener("touchend",v)}},[]);const x=()=>{g("/ai-chat",{state:{selectedText:a}}),m(!1)};return h?n.jsx("div",{className:"fixed z-50 animate-fade-in",style:{left:`${c.x}px`,top:`${c.y}px`,transform:"translate(-50%, -100%)"},children:n.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-orange-500 text-white rounded-lg shadow-lg hover:shadow-xl transition-all text-sm font-medium",children:[n.jsx(rx,{className:"w-4 h-4"}),"Ask AI"]})}):null}function jae(){var k,R;const a=Zy(),o=to(),{user:c,logout:d}=aa(),[h,m]=te.useState(!1),[g,x]=te.useState(!1);te.useEffect(()=>{const O=()=>{const Q=document.querySelectorAll(".fixed");let Z=!1;Q.forEach($=>{const X=$.className,be=X.includes("bg-black")||X.includes("inset-0"),me=X.includes("z-50")||X.includes("z-40");be&&me&&$.offsetHeight>0&&(Z=!0)}),a.pathname==="/ai-chat"&&(Z=!0),x(Z||h)};O();const F=setTimeout(O,100),M=new MutationObserver(O);return M.observe(document.body,{childList:!0,subtree:!0}),()=>{clearTimeout(F),M.disconnect()}},[a.pathname,h]);const v=[{path:"/dashboard",icon:eE,label:"Home"},{path:"/nutrition",icon:Cr,label:"Nutrition"},{path:"/quick-food-scan",icon:$V,label:"Scan Food",isCenter:!0},{path:"/upload",icon:Bn,label:"Reports"}],E=[{path:"/profile",icon:Sg,label:"Profile"},{path:"/diet-plan",icon:Vi,label:"Diet Plan"},{path:"/wearables",icon:GA,label:"Wearables",comingSoon:!0},{path:"#appointment",icon:Ti,label:"Appointment",comingSoon:!0}],S=O=>a.pathname===O,I=()=>{d(),Ct.success("Logged out successfully"),o("/login"),m(!1)};return n.jsxs(n.Fragment,{children:[h&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>m(!1)}),h&&n.jsxs("div",{className:"fixed bottom-24 right-4 left-4 sm:left-auto sm:w-72 bg-gradient-to-br from-white to-orange-50 rounded-3xl shadow-2xl z-50 overflow-hidden animate-fade-in border-2 border-cyan-200",children:[n.jsx("div",{className:"p-5 bg-gradient-to-r from-purple-500 to-orange-500",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:"font-bold text-white text-lg",children:"Menu"}),n.jsx("button",{onClick:()=>m(!1),className:"text-white hover:bg-white/20 rounded-full p-1.5 transition-colors",children:n.jsx(Yi,{className:"w-5 h-5"})})]})}),n.jsxs("div",{className:"space-y-1 p-3",children:[E.map(O=>{const F=O.icon,M=S(O.path);return O.comingSoon?n.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-3.5 text-slate-500 bg-slate-50 rounded-xl opacity-60 cursor-not-allowed text-sm",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-200 flex items-center justify-center",children:n.jsx(F,{className:"w-5 h-5"})}),n.jsx("span",{className:"font-medium",children:O.label})]}),n.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2.5 py-1 rounded-full font-semibold",children:"Soon"})]},O.label):O.path==="#appointment"?n.jsxs("button",{onClick:()=>{Ct.info("Appointment coming soon"),m(!1)},className:"w-full flex items-center gap-3 px-4 py-3.5 text-slate-700 hover:bg-cyan-50 rounded-xl transition-all text-sm group",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center group-hover:bg-cyan-200 transition-colors",children:n.jsx(F,{className:"w-5 h-5 text-cyan-600"})}),n.jsx("span",{className:"font-medium",children:O.label})]},O.label):n.jsxs(Os,{to:O.path,onClick:()=>m(!1),className:`flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all text-sm group ${M?"bg-gradient-to-r from-purple-500 to-orange-500 text-white shadow-lg":"text-slate-700 hover:bg-cyan-50"}`,children:[n.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-colors ${M?"bg-white/20":"bg-cyan-100 group-hover:bg-cyan-200"}`,children:n.jsx(F,{className:`w-5 h-5 ${M?"text-white":"text-cyan-600"}`})}),n.jsx("span",{className:"font-medium",children:O.label})]},O.path)}),n.jsx("div",{className:"border-t-2 border-cyan-100 my-3"}),n.jsxs("div",{className:"px-4 py-2 flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-white font-bold",children:(R=(k=c==null?void 0:c.name)==null?void 0:k[0])==null?void 0:R.toUpperCase()}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-semibold text-slate-800 truncate",children:c==null?void 0:c.name}),n.jsx("p",{className:"text-xs text-slate-500 truncate",children:c==null?void 0:c.email})]})]}),n.jsxs("button",{onClick:I,className:"w-full flex items-center gap-3 px-4 py-3.5 text-red-600 hover:bg-red-50 rounded-xl transition-all text-sm font-medium group",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center group-hover:bg-red-200 transition-colors",children:n.jsx(YR,{className:"w-5 h-5"})}),n.jsx("span",{children:"Logout"})]})]})]}),n.jsx("nav",{className:`mobile-bottom-nav-container ${g?"hidden":""}`,children:n.jsxs("div",{className:"mobile-bottom-nav",children:[v.map(O=>{const F=O.icon,M=S(O.path);return O.isCenter?n.jsx(Os,{to:O.path,className:"nav-center-fab flex flex-col items-center justify-center","aria-label":O.label,title:O.label,children:n.jsx(F,{className:"w-7 h-7"})},O.path):n.jsxs(Os,{to:O.path,className:`nav-item-modern flex flex-col items-center justify-center gap-0.5 ${M?"active":""}`,"aria-label":O.label,title:O.label,children:[n.jsx(F,{className:"w-5 h-5"}),n.jsx("span",{className:"text-[9px] font-medium",children:O.label})]},O.path)}),n.jsxs("button",{onClick:()=>m(!h),className:`nav-item-modern flex flex-col items-center justify-center gap-0.5 ${h?"active":""}`,"aria-label":"More",title:"More",children:[n.jsx(Lre,{className:"w-5 h-5"}),n.jsx("span",{className:"text-[11px] font-medium",children:"More"})]})]})})]})}const Pae=[{path:"/dashboard",icon:eE,label:"Dashboard"},{path:"/ai-chat",icon:rx,label:"AI Assistant"},{path:"/upload",icon:Bn,label:"My Reports"},{path:"/nutrition",icon:nx,label:"Nutrition"},{path:"/diet-plan",icon:Xp,label:"Diet Plan"},{path:"/profile",icon:Sg,label:"Profile"},{path:"/doctors",icon:Ti,label:"Appointments",comingSoon:!0},{path:"/wearables",icon:GA,label:"Devices",comingSoon:!0}],Uae=[{path:"/doctor/dashboard",icon:eE,label:"Dashboard"},{path:"/doctor/availability",icon:cl,label:"Manage Slots"},{path:"/profile",icon:Sg,label:"Profile"}],Fae=[{path:"/admin",icon:eE,label:"Dashboard"},{path:"/profile",icon:Sg,label:"Settings"}];function hi({children:a,isAdmin:o,isDoctor:c}){var F,M,Q,Z;const{user:d,logout:h,isAdmin:m,isDoctor:g}=aa(),x=Zy(),v=to(),[E,S]=te.useState(!1),I=()=>{h(),v("/")};let k=Pae,R="/dashboard",O="Patient Portal";return m()||o?(k=Fae,R="/admin",O="Admin Panel"):(g()||c)&&(k=Uae,R="/doctor/dashboard",O=((F=d==null?void 0:d.doctorProfile)==null?void 0:F.specialization)||"Doctor Portal"),n.jsxs("div",{className:"min-h-screen flex",children:[n.jsx("aside",{className:`fixed inset-y-0 right-0 lg:left-0 lg:right-auto z-50 w-64 shadow-lg lg:shadow-sm transform transition-transform duration-300 hidden lg:flex lg:flex-col bg-gradient-to-br from-purple-500 to-orange-600 ${E?"translate-x-0":"translate-x-full lg:translate-x-0"}`,children:n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("div",{className:"p-6 shrink-0",style:{borderBottom:"1px solid rgba(255,255,255,0.2)"},children:n.jsxs(Os,{to:R,className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-white/20",children:n.jsx(Cr,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-bold text-white",children:"FitCure"}),n.jsx("p",{className:"text-xs text-white/80",children:O})]})]})}),n.jsx("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:k.map(({path:$,icon:X,label:be,comingSoon:me})=>me?n.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all cursor-not-allowed relative",style:{color:"rgba(255,255,255,0.5)",opacity:.6},children:[n.jsx(X,{className:"w-5 h-5"}),n.jsx("span",{children:be}),n.jsx("span",{className:"ml-auto text-xs px-2 py-0.5 rounded-full font-semibold bg-white/20 text-white",children:"Soon"})]},$):n.jsxs(Os,{to:$,onClick:()=>S(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${x.pathname===$?"border":""}`,style:x.pathname===$?{backgroundColor:"rgba(255,255,255,0.2)",color:"white",borderColor:"rgba(255,255,255,0.3)"}:{color:"rgba(255,255,255,0.8)"},onMouseEnter:Ne=>{x.pathname!==$&&(Ne.currentTarget.style.backgroundColor="rgba(255,255,255,0.15)",Ne.currentTarget.style.color="white")},onMouseLeave:Ne=>{x.pathname!==$&&(Ne.currentTarget.style.backgroundColor="transparent",Ne.currentTarget.style.color="rgba(255,255,255,0.8)")},children:[n.jsx(X,{className:"w-5 h-5"}),n.jsx("span",{children:be})]},$))}),n.jsx("div",{className:"p-4 shrink-0",style:{borderTop:"1px solid rgba(255,255,255,0.2)"},children:n.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/20",children:[n.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shrink-0 bg-white",children:n.jsx("span",{className:"font-bold text-cyan-600",children:(Q=(M=d==null?void 0:d.name)==null?void 0:M[0])==null?void 0:Q.toUpperCase()})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate text-white",children:g()?`Dr. ${d==null?void 0:d.name}`:d==null?void 0:d.name}),n.jsx("p",{className:"text-xs truncate text-white/80",children:d==null?void 0:d.email})]}),n.jsx("button",{onClick:I,className:"p-2 rounded-lg transition-all shrink-0 text-white/80",onMouseEnter:$=>{$.currentTarget.style.color="#fca5a5",$.currentTarget.style.backgroundColor="rgba(255,255,255,0.2)"},onMouseLeave:$=>{$.currentTarget.style.color="rgba(255,255,255,0.8)",$.currentTarget.style.backgroundColor="transparent"},title:"Logout",children:n.jsx(YR,{className:"w-5 h-5"})})]})})]})}),E&&n.jsx("div",{className:"fixed inset-0 bg-black/20 z-40 lg:hidden",onClick:()=>S(!1)}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-screen lg:ml-64",children:[n.jsx("header",{className:"sticky top-0 z-30 backdrop-blur-xl bg-gradient-to-r from-purple-500 to-orange-600 border-b border-white/20 hidden md:block",children:n.jsxs("div",{className:"flex items-center justify-between px-3 md:px-4 lg:px-8 py-3 md:py-4",children:[n.jsxs("div",{className:"flex items-center gap-2 md:gap-4 flex-1 md:flex-none",children:[n.jsxs(Os,{to:R,className:"lg:hidden flex items-center gap-2 flex-shrink-0",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center bg-white/20",children:n.jsx(Cr,{className:"w-5 h-5 text-white"})}),n.jsx("span",{className:"text-sm font-bold text-white",children:"FitCure"})]}),n.jsx("h1",{className:"text-base md:text-lg font-semibold hidden sm:block text-white",children:((Z=k.find($=>$.path===x.pathname))==null?void 0:Z.label)||"Dashboard"})]}),n.jsxs("div",{className:"flex items-center gap-2 md:gap-3 overflow-hidden",children:[n.jsx("div",{className:"hidden md:flex items-center",children:n.jsxs("div",{className:"relative",children:[n.jsx(zb,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/60"}),n.jsx("input",{type:"text",placeholder:"Search...",className:"w-48 pl-10 pr-4 py-2 rounded-xl text-sm focus:outline-none bg-white/20 border border-white/30 text-white placeholder-white/60"})]})}),n.jsxs("button",{className:"relative p-2 rounded-xl transition-all flex-shrink-0 text-white/80 hover:bg-white/20",children:[n.jsx(WA,{className:"w-5 h-5"}),n.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"})]})]})]})}),n.jsx("main",{className:"flex-1 main-content-mobile overflow-x-hidden w-full",style:x.pathname==="/nutrition"||x.pathname==="/ai-chat"?{padding:0,backgroundColor:"white"}:x.pathname==="/dashboard"||x.pathname==="/glucose-log"?{padding:0}:{padding:0},children:a}),!m()&&!g()&&!o&&!c&&n.jsx(jae,{})]}),x.pathname!=="/ai-chat"&&n.jsx(Lae,{})]})}function Mae(){const[a,o]=te.useState(null),[c,d]=te.useState(!1),[h,m]=te.useState(!1);te.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches){m(!0);return}const v=S=>{S.preventDefault(),o(S);const k=window.innerWidth<768?1e3:5e3,R=setTimeout(()=>{d(!0)},k);return()=>clearTimeout(R)},E=()=>{m(!0),d(!1),o(null),Ct.success(" FitCure app installed successfully!")};return window.addEventListener("beforeinstallprompt",v),window.addEventListener("appinstalled",E),()=>{window.removeEventListener("beforeinstallprompt",v),window.removeEventListener("appinstalled",E)}},[]),te.useEffect(()=>{if(!a||h)return;const v=setInterval(()=>{d(!0)},2*60*1e3);return()=>clearInterval(v)},[a,h]);const g=async()=>{if(!a)return;a.prompt();const{outcome:v}=await a.userChoice;v==="accepted"?Ct.success("Installing FitCure app..."):Ct("You can install later from browser menu",{icon:""}),o(null),d(!1)},x=()=>{d(!1)};return h||!c||!a?null:n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"md:hidden fixed bottom-20 left-0 right-0 z-50 px-3 animate-slide-up",children:n.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-orange-600 rounded-2xl shadow-2xl p-4",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center flex-shrink-0",children:n.jsx(XR,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"font-bold text-white text-sm",children:"Install FitCure App"}),n.jsx("p",{className:"text-xs text-white/90",children:"Quick access from home screen"})]}),n.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[n.jsx("button",{onClick:g,className:"px-4 py-2 bg-white text-cyan-600 rounded-xl font-bold hover:bg-white/90 transition-all text-sm shadow-lg",children:"Install"}),n.jsx("button",{onClick:x,className:"p-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-all",children:n.jsx(Yi,{className:"w-5 h-5"})})]})]})})}),n.jsx("div",{className:"hidden md:block fixed bottom-8 right-8 z-40 animate-slide-up",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border-2 border-cyan-200 p-6 max-w-sm",children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center flex-shrink-0",children:n.jsx(tE,{className:"w-7 h-7 text-white"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"Install FitCure"}),n.jsx("p",{className:"text-sm text-slate-600",children:"Progressive Web App"})]})]}),n.jsx("button",{onClick:x,className:"text-slate-400 hover:text-slate-600 flex-shrink-0",children:n.jsx(Yi,{className:"w-5 h-5"})})]}),n.jsxs("p",{className:"text-sm text-slate-600 mb-4",children:[" Install FitCure for quick access to your health data",n.jsx("br",{})," Works offline with cached data",n.jsx("br",{})," Faster loading and better performance"]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:g,className:"flex-1 px-5 py-3 bg-gradient-to-r from-purple-500 to-orange-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all",children:"Install Now"}),n.jsx("button",{onClick:x,className:"px-5 py-3 bg-slate-100 text-slate-700 rounded-xl font-medium hover:bg-slate-200 transition-all",children:"Later"})]})]})})]})}const XA=()=>n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-pink-900 to-slate-900 p-4 sm:p-6 animate-pulse",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"h-8 bg-slate-700/50 rounded w-48 mb-2"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-64"})]}),n.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>n.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-700/50",children:[n.jsx("div",{className:"h-6 bg-slate-700/50 rounded w-40 mb-4"}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-full"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-5/6"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-4/6"})]})]},a))})]}),Vae=()=>{const[a,o]=te.useState(!1),[c,d]=te.useState(!1),h=te.useRef(null);return te.useEffect(()=>{const m=g=>{h.current&&!h.current.contains(g.target)&&d(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]),n.jsx("header",{className:"fixed top-5 z-50 left-1/2 -translate-x-1/2 w-[calc(100%-200px)] max-w-5xl max-md:w-[calc(100%-40px)]",children:n.jsx("div",{className:"bg-white/80 backdrop-blur-md rounded-[28px] border border-white/40 shadow-2xl shadow-black/10",children:n.jsxs("div",{className:"px-6 lg:px-8",children:[n.jsxs("div",{className:"flex items-center justify-between h-16",children:[n.jsxs("nav",{className:"hidden lg:flex items-center gap-6",children:[n.jsx("a",{href:"#features",className:"text-sm text-gray-700 hover:text-gray-900 transition-colors font-medium",children:"Features"}),n.jsx("a",{href:"#showcase",className:"text-sm text-gray-700 hover:text-gray-900 transition-colors font-medium",children:"Showcase"})]}),n.jsx(Os,{to:"/",className:"absolute left-1/2 -translate-x-1/2",children:n.jsx("span",{className:"text-xl lg:text-2xl font-serif text-gray-900",children:"FitCure"})}),n.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[n.jsx("a",{href:"#testimonials",className:"text-sm text-gray-700 hover:text-gray-900 transition-colors font-medium",children:"Testimonials"}),n.jsx("a",{href:"#faq",className:"text-sm text-gray-700 hover:text-gray-900 transition-colors font-medium",children:"FAQ"}),n.jsxs("div",{className:"relative",ref:h,children:[n.jsx("button",{onClick:()=>d(!c),className:"w-10 h-10 rounded-full bg-cyan-500 flex items-center justify-center hover:bg-cyan-400 transition-colors ml-2",children:n.jsx(Xd,{className:"w-5 h-5 text-white"})}),c&&n.jsxs("div",{className:"absolute right-0 mt-3 w-48 bg-white backdrop-blur-2xl rounded-2xl shadow-xl border border-gray-200 py-2 animate-fade-in",children:[n.jsx(Os,{to:"/login",className:"block px-6 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors font-medium",onClick:()=>d(!1),children:"Sign In"}),n.jsx(Os,{to:"/register",className:"block px-6 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors font-medium",onClick:()=>d(!1),children:"Get Started"})]})]})]}),n.jsx("button",{className:"lg:hidden p-2 text-gray-900 ml-auto",onClick:()=>o(!a),children:a?n.jsx(Yi,{className:"w-6 h-6"}):n.jsx(ZV,{className:"w-6 h-6"})})]}),a&&n.jsx("div",{className:"lg:hidden py-6 border-t border-gray-200",children:n.jsxs("nav",{className:"flex flex-col gap-4",children:[n.jsx("a",{href:"#features",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Features"}),n.jsx("a",{href:"#showcase",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Showcase"}),n.jsx("a",{href:"#testimonials",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Testimonials"}),n.jsx("a",{href:"#faq",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"FAQ"}),n.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t border-gray-200",children:[n.jsx(Os,{to:"/login",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Sign In"}),n.jsx(Os,{to:"/register",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Get Started"})]})]})})]})})})},Qae=()=>n.jsxs("div",{className:"relative min-h-screen flex items-center overflow-hidden bg-gradient-to-b from-[#0a3d5c] to-[#0d5a8a]",children:[n.jsxs("div",{className:"absolute inset-0 z-0",children:[n.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover opacity-60",children:[n.jsx("source",{src:"https://cdn.shopify.com/videos/c/o/v/dcb48db72fdb4641a2af2df51c03aad5.mp4",type:"video/mp4"}),n.jsx("img",{src:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=1920&h=1080&fit=crop",alt:"Healthcare",className:"w-full h-full object-cover opacity-60"})]}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/40 via-black/20 to-transparent"})]}),n.jsx("div",{className:"relative z-10 w-full max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-32",children:n.jsxs("div",{className:"max-w-xl lg:max-w-2xl text-center lg:text-left",children:[n.jsx("p",{className:"text-xs sm:text-sm uppercase tracking-[0.2em] text-cyan-300 mb-6 font-medium",children:"SMART NUTRITION TRACKING"}),n.jsx("h1",{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-serif text-white mb-6 leading-[1.1]",children:"Take Control of your Health Journey."}),n.jsx("p",{className:"text-base sm:text-lg md:text-xl text-cyan-100 mb-10 leading-relaxed max-w-lg",children:"Empowers user to take informed action on their health through easy to understand insights, continuous tracking, and goal-based guidance."}),n.jsxs(Os,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-cyan-500 text-white rounded-full font-medium hover:bg-cyan-400 transition-all group shadow-lg",children:["Start Tracking",n.jsx(vo,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})}),n.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 z-10",children:[n.jsx("span",{className:"text-xs uppercase tracking-wider text-cyan-300 font-medium",children:"SCROLL"}),n.jsx("div",{className:"w-px h-12 bg-cyan-300/30"})]})]}),Hae=()=>{const a=[{icon:Cr,title:"Health Tracking",description:"Effortless daily tracking"},{icon:va,title:"Progress Analytics",description:"Real-time health insights"},{icon:Zl,title:"Goal Setting",description:"Personalized targets"},{icon:Vi,title:"Wellness Plans",description:"AI-powered recommendations"}];return n.jsx("section",{id:"features",className:"py-20 bg-transparent",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:a.map((o,c)=>{const d=o.icon;return n.jsxs("div",{className:"text-center bg-gradient-to-br from-[#0a3d5c]/60 to-[#0d5a8a]/60 backdrop-blur-sm rounded-2xl p-8 border border-cyan-400/30 hover:border-cyan-400/60 transition-all hover:shadow-lg hover:shadow-cyan-500/20",children:[n.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-6 bg-cyan-500/20 rounded-full border border-cyan-400/40",children:n.jsx(d,{className:"w-12 h-12 text-cyan-300 stroke-[1.5]"})}),n.jsx("h3",{className:"text-lg font-serif text-white mb-2",children:o.title}),n.jsx("p",{className:"text-sm text-cyan-100",children:o.description})]},c)})})})})},Gae=()=>n.jsx("section",{className:"bg-transparent py-20",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[n.jsxs("div",{className:"relative rounded-3xl overflow-hidden group",children:[n.jsx("img",{src:"https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=800&h=600&fit=crop",alt:"AI-Powered Nutrition",className:"w-full h-full object-cover min-h-[400px]"}),n.jsxs("div",{className:"absolute bottom-8 left-8 right-8 bg-gradient-to-r from-[#0a3d5c]/90 to-[#0d5a8a]/90 backdrop-blur-sm rounded-2xl p-6 border border-cyan-400/30",children:[n.jsx("h3",{className:"text-2xl font-serif text-white mb-2",children:"AI-Powered Nutrition"}),n.jsx("p",{className:"text-sm text-cyan-100",children:"Smart meal recognition and instant calorie calculation with advanced AI technology."})]})]}),n.jsxs("div",{className:"flex flex-col gap-8",children:[n.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-gradient-to-br from-[#0a3d5c]/80 to-[#0d5a8a]/80 backdrop-blur-sm p-8 border border-cyan-400/30",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-2xl font-serif text-white mb-2",children:"Track Everything"}),n.jsx("h4",{className:"text-xl font-serif text-cyan-300 mb-4",children:"Achieve Anything"}),n.jsxs("ul",{className:"space-y-2 text-sm text-cyan-100",children:[n.jsxs("li",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-1 h-1 rounded-full bg-cyan-400"}),"Calorie & Macro Tracking"]}),n.jsxs("li",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-1 h-1 rounded-full bg-cyan-400"}),"Meal Planning & Recipes"]}),n.jsxs("li",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-1 h-1 rounded-full bg-cyan-400"}),"Progress Analytics"]})]})]}),n.jsx("div",{className:"flex-shrink-0",children:n.jsx("img",{src:"https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300&h=400&fit=crop",alt:"Healthy Food",className:"w-48 h-64 object-cover rounded-2xl"})})]})}),n.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-gradient-to-br from-[#0a3d5c]/80 to-[#0d5a8a]/80 backdrop-blur-sm p-8 border border-cyan-400/30",children:n.jsxs("div",{className:"flex items-center gap-6",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx("div",{className:"w-16 h-16 rounded-full bg-cyan-500/20 flex items-center justify-center border border-cyan-400/50",children:n.jsx(XR,{className:"w-8 h-8 text-cyan-300"})})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-xl font-serif text-white mb-2",children:"Report Analyzer"}),n.jsx("p",{className:"text-sm text-cyan-100",children:"Track on-the-go"})]}),n.jsx("div",{className:"flex-shrink-0",children:n.jsx("img",{src:"https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=200&h=200&fit=crop",alt:"Mobile App",className:"w-32 h-32 object-cover rounded-xl"})})]})})]})]})})}),Kae=()=>{const[a,o]=te.useState(0),c=te.useRef(null),d=[{title:"Track Your Health Metrics",description:"Monitor vital signs, lab results, and health trends all in one place with AI-powered insights.",phoneScreen:"dashboard",cards:[{icon:Vi,title:"Heart Rate",value:"72 bpm",color:"rose",position:"left-top"},{icon:Cr,title:"Blood Pressure",value:"120/80",color:"blue",position:"left-bottom"},{icon:va,title:"Health Score",value:"85/100",color:"emerald",position:"right-top"},{icon:Zu,title:"Vitamin D",value:"45 ng/mL",color:"amber",position:"right-bottom"}]},{title:"Smart Nutrition Tracking",description:"Track your meals and get actionable feedback that helps you build a better relationship with food.",phoneScreen:"nutrition",cards:[{icon:nx,title:"Today's Meals",value:"3 logged",color:"emerald",position:"left-top"},{icon:Cr,title:"Calories",value:"1,850 kcal",color:"orange",position:"left-bottom"},{icon:va,title:"Protein",value:"95g",color:"blue",position:"right-top"},{icon:Vi,title:"Macro Balance",value:"Optimal",color:"purple",position:"right-bottom"}]},{title:"AI-Powered Health Insights",description:"Get personalized recommendations based on your medical reports and wearable data.",phoneScreen:"ai-chat",cards:[{icon:rx,title:"AI Assistant",value:"24/7 Available",color:"cyan",position:"left-top"},{icon:va,title:"Insights",value:"12 new",color:"indigo",position:"left-bottom"},{icon:Ti,title:"Reminders",value:"5 today",color:"pink",position:"right-top"},{icon:Vi,title:"Health Tips",value:"Updated",color:"red",position:"right-bottom"}]},{title:"Sleep & Recovery Tracking",description:"Improve your sleep by understanding patterns, identifying disruptions, and building habits.",phoneScreen:"sleep",cards:[{icon:ix,title:"Sleep Quality",value:"85%",color:"indigo",position:"left-top"},{icon:Cr,title:"Sleep Duration",value:"7h 45m",color:"blue",position:"left-bottom"},{icon:va,title:"Deep Sleep",value:"2h 15m",color:"purple",position:"right-top"},{icon:Vi,title:"REM Sleep",value:"1h 30m",color:"pink",position:"right-bottom"}]}];te.useEffect(()=>{const x=()=>{if(!c.current)return;const v=c.current,{top:E,height:S}=v.getBoundingClientRect(),I=window.innerHeight,k=(I/2-E)/(S-I/2),R=Math.max(0,Math.min(1,k)),O=Math.floor(R*d.length),F=Math.min(O,d.length-1);o(F)};return window.addEventListener("scroll",x),x(),()=>window.removeEventListener("scroll",x)},[d.length]);const h=x=>({"left-top":"left-[1%] sm:left-[3%] md:left-[8%] top-[8%] sm:top-[10%] md:top-[12%]","left-bottom":"left-[1%] sm:left-[5%] md:left-[10%] bottom-[12%] sm:bottom-[15%] md:bottom-[18%]","right-top":"right-[1%] sm:right-[3%] md:right-[8%] top-[14%] sm:top-[16%] md:top-[18%]","right-bottom":"right-[1%] sm:right-[5%] md:right-[10%] bottom-[6%] sm:bottom-[9%] md:bottom-[12%]"})[x]||"left-[10%] top-[20%]",m=(x,v)=>({"left-top":v?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 translate-y-16 scale-75","left-bottom":v?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 -translate-y-16 scale-75","right-top":v?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 translate-y-16 scale-75","right-bottom":v?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 -translate-y-16 scale-75"})[x],g=x=>({dashboard:"from-purple-500 to-orange-500",nutrition:"from-purple-500 to-orange-500","ai-chat":"from-purple-500 to-orange-500",sleep:"from-purple-500 to-orange-500"})[x]||"from-purple-500 to-orange-500";return n.jsx("div",{id:"showcase",ref:c,className:"relative bg-transparent",style:{height:`${d.length*100}vh`},children:n.jsx("div",{className:"sticky top-0 h-screen flex items-center justify-center overflow-hidden pt-20 sm:pt-24 px-2 sm:px-4",children:n.jsx("div",{className:"relative w-full max-w-7xl mx-auto",children:n.jsxs("div",{className:"relative flex flex-col items-center",children:[n.jsx("div",{className:"text-center mb-2 sm:mb-3 max-w-2xl px-4 transition-all duration-700 transform relative z-30",children:n.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-serif text-white mb-6 sm:mb-8 leading-tight",children:d[a].title})}),n.jsx("div",{className:"absolute inset-0 pointer-events-none z-40",children:d[a].cards.map((x,v)=>{const E=x.icon,S={rose:{bg:"bg-rose-50",icon:"text-rose-500",value:"text-rose-600",border:"border-rose-100"},blue:{bg:"bg-blue-50",icon:"text-blue-500",value:"text-blue-600",border:"border-blue-100"},emerald:{bg:"bg-emerald-50",icon:"text-emerald-500",value:"text-emerald-600",border:"border-emerald-100"},amber:{bg:"bg-amber-50",icon:"text-amber-500",value:"text-amber-600",border:"border-amber-100"},orange:{bg:"bg-orange-50",icon:"text-orange-500",value:"text-orange-600",border:"border-orange-100"},purple:{bg:"bg-purple-50",icon:"text-purple-500",value:"text-purple-600",border:"border-purple-100"},cyan:{bg:"bg-cyan-50",icon:"text-cyan-500",value:"text-cyan-600",border:"border-cyan-100"},indigo:{bg:"bg-indigo-50",icon:"text-indigo-500",value:"text-indigo-600",border:"border-indigo-100"},pink:{bg:"bg-pink-50",icon:"text-pink-500",value:"text-pink-600",border:"border-pink-100"},red:{bg:"bg-red-50",icon:"text-red-500",value:"text-red-600",border:"border-red-100"}};return S[x.color]||S.blue,n.jsx("div",{className:`absolute ${h(x.position)} ${m(x.position,!0)} 
                      transition-all duration-1000 ease-out`,style:{transitionDelay:`${v*150}ms`},children:n.jsxs("div",{className:`bg-gradient-to-br from-[#0a3d5c]/90 to-[#0d5a8a]/90 rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-4 md:p-6 border border-cyan-400/40 
                      hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 w-32 sm:w-40 md:w-48 backdrop-blur-sm`,children:[n.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-lg sm:rounded-xl bg-cyan-500/20 flex items-center justify-center mb-2 sm:mb-3 border border-cyan-400/30",children:n.jsx(E,{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-cyan-300",strokeWidth:2})}),n.jsx("h4",{className:"text-white font-medium text-xs sm:text-sm md:text-base mb-1 leading-tight",children:x.title}),n.jsx("p",{className:"text-cyan-300 font-bold text-base sm:text-lg md:text-xl",children:x.value})]})},v)})}),n.jsxs("div",{className:"relative transform perspective-1000 z-10",children:[n.jsxs("div",{className:"relative w-[240px] sm:w-[280px] md:w-[320px] lg:w-[340px] h-[480px] sm:h-[560px] md:h-[640px] lg:h-[680px] bg-slate-900 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] p-2 sm:p-3 shadow-2xl",children:[n.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-28 sm:w-32 md:w-36 h-5 sm:h-6 md:h-7 bg-slate-900 rounded-b-2xl sm:rounded-b-3xl z-10"}),n.jsx("div",{className:"relative w-full h-full bg-white rounded-[2rem] sm:rounded-[2.5rem] md:rounded-[3rem] overflow-hidden",children:n.jsxs("div",{className:`absolute inset-0 bg-gradient-to-br ${g(d[a].phoneScreen)} 
                    transition-all duration-1000 ease-in-out`,children:[n.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-5 md:px-6 pt-2 sm:pt-3 text-white text-[10px] sm:text-xs",children:[n.jsx("span",{children:"9:41"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:"w-3 h-2 sm:w-4 sm:h-3 border border-white rounded-sm"}),n.jsx("div",{className:"w-0.5 h-2 sm:w-1 sm:h-3 bg-white rounded-sm"})]})]}),n.jsxs("div",{className:"px-4 sm:px-5 md:px-6 pt-6 sm:pt-7 md:pt-8",children:[n.jsxs("h3",{className:"text-white text-lg sm:text-xl md:text-2xl font-bold",children:[d[a].phoneScreen==="dashboard"&&"Dashboard",d[a].phoneScreen==="nutrition"&&"Nutrition",d[a].phoneScreen==="ai-chat"&&"AI Assistant",d[a].phoneScreen==="sleep"&&"Sleep"]}),n.jsx("p",{className:"text-white/80 text-[10px] sm:text-xs md:text-sm mt-1",children:new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),n.jsx("div",{className:`absolute inset-x-4 sm:inset-x-5 md:inset-x-6 top-24 sm:top-28 md:top-32 bottom-4 sm:bottom-5 md:bottom-6 bg-white/10 backdrop-blur-md rounded-2xl sm:rounded-3xl border border-white/20 p-4 sm:p-5 md:p-6 \r
                      transition-all duration-1000 shadow-inner`,children:n.jsx("div",{className:"space-y-3 sm:space-y-4",children:[1,2,3].map(x=>n.jsx("div",{className:"bg-white/20 rounded-xl sm:rounded-2xl h-14 sm:h-16 md:h-20 animate-pulse shadow-lg",style:{animationDelay:`${x*200}ms`,animationDuration:"2s"}},x))})})]})})]}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-slate-900/10 to-slate-900/30 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] -z-10 blur-2xl sm:blur-3xl transform scale-105"})]})]})})})})},Wae=(a,o)=>{const c=new Array(a.length+o.length);for(let d=0;d<a.length;d++)c[d]=a[d];for(let d=0;d<o.length;d++)c[a.length+d]=o[d];return c},zae=(a,o)=>({classGroupId:a,validator:o}),YQ=(a=new Map,o=null,c)=>({nextPart:a,validators:o,classGroupId:c}),By="-",p6=[],qae="arbitrary..",Yae=a=>{const o=Jae(a),{conflictingClassGroups:c,conflictingClassGroupModifiers:d}=a;return{getClassGroupId:g=>{if(g.startsWith("[")&&g.endsWith("]"))return Xae(g);const x=g.split(By),v=x[0]===""&&x.length>1?1:0;return XQ(x,v,o)},getConflictingClassGroupIds:(g,x)=>{if(x){const v=d[g],E=c[g];return v?E?Wae(E,v):v:E||p6}return c[g]||p6}}},XQ=(a,o,c)=>{if(a.length-o===0)return c.classGroupId;const h=a[o],m=c.nextPart.get(h);if(m){const E=XQ(a,o+1,m);if(E)return E}const g=c.validators;if(g===null)return;const x=o===0?a.join(By):a.slice(o).join(By),v=g.length;for(let E=0;E<v;E++){const S=g[E];if(S.validator(x))return S.classGroupId}},Xae=a=>a.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const o=a.slice(1,-1),c=o.indexOf(":"),d=o.slice(0,c);return d?qae+d:void 0})(),Jae=a=>{const{theme:o,classGroups:c}=a;return $ae(c,o)},$ae=(a,o)=>{const c=YQ();for(const d in a){const h=a[d];cI(h,c,d,o)}return c},cI=(a,o,c,d)=>{const h=a.length;for(let m=0;m<h;m++){const g=a[m];Zae(g,o,c,d)}},Zae=(a,o,c,d)=>{if(typeof a=="string"){eoe(a,o,c);return}if(typeof a=="function"){toe(a,o,c,d);return}soe(a,o,c,d)},eoe=(a,o,c)=>{const d=a===""?o:JQ(o,a);d.classGroupId=c},toe=(a,o,c,d)=>{if(roe(a)){cI(a(d),o,c,d);return}o.validators===null&&(o.validators=[]),o.validators.push(zae(c,a))},soe=(a,o,c,d)=>{const h=Object.entries(a),m=h.length;for(let g=0;g<m;g++){const[x,v]=h[g];cI(v,JQ(o,x),c,d)}},JQ=(a,o)=>{let c=a;const d=o.split(By),h=d.length;for(let m=0;m<h;m++){const g=d[m];let x=c.nextPart.get(g);x||(x=YQ(),c.nextPart.set(g,x)),c=x}return c},roe=a=>"isThemeGetter"in a&&a.isThemeGetter===!0,noe=a=>{if(a<1)return{get:()=>{},set:()=>{}};let o=0,c=Object.create(null),d=Object.create(null);const h=(m,g)=>{c[m]=g,o++,o>a&&(o=0,d=c,c=Object.create(null))};return{get(m){let g=c[m];if(g!==void 0)return g;if((g=d[m])!==void 0)return h(m,g),g},set(m,g){m in c?c[m]=g:h(m,g)}}},tR="!",m6=":",ioe=[],f6=(a,o,c,d,h)=>({modifiers:a,hasImportantModifier:o,baseClassName:c,maybePostfixModifierPosition:d,isExternal:h}),aoe=a=>{const{prefix:o,experimentalParseClassName:c}=a;let d=h=>{const m=[];let g=0,x=0,v=0,E;const S=h.length;for(let F=0;F<S;F++){const M=h[F];if(g===0&&x===0){if(M===m6){m.push(h.slice(v,F)),v=F+1;continue}if(M==="/"){E=F;continue}}M==="["?g++:M==="]"?g--:M==="("?x++:M===")"&&x--}const I=m.length===0?h:h.slice(v);let k=I,R=!1;I.endsWith(tR)?(k=I.slice(0,-1),R=!0):I.startsWith(tR)&&(k=I.slice(1),R=!0);const O=E&&E>v?E-v:void 0;return f6(m,R,k,O)};if(o){const h=o+m6,m=d;d=g=>g.startsWith(h)?m(g.slice(h.length)):f6(ioe,!1,g,void 0,!0)}if(c){const h=d;d=m=>c({className:m,parseClassName:h})}return d},ooe=a=>{const o=new Map;return a.orderSensitiveModifiers.forEach((c,d)=>{o.set(c,1e6+d)}),c=>{const d=[];let h=[];for(let m=0;m<c.length;m++){const g=c[m],x=g[0]==="[",v=o.has(g);x||v?(h.length>0&&(h.sort(),d.push(...h),h=[]),d.push(g)):h.push(g)}return h.length>0&&(h.sort(),d.push(...h)),d}},coe=a=>({cache:noe(a.cacheSize),parseClassName:aoe(a),sortModifiers:ooe(a),...Yae(a)}),loe=/\s+/,doe=(a,o)=>{const{parseClassName:c,getClassGroupId:d,getConflictingClassGroupIds:h,sortModifiers:m}=o,g=[],x=a.trim().split(loe);let v="";for(let E=x.length-1;E>=0;E-=1){const S=x[E],{isExternal:I,modifiers:k,hasImportantModifier:R,baseClassName:O,maybePostfixModifierPosition:F}=c(S);if(I){v=S+(v.length>0?" "+v:v);continue}let M=!!F,Q=d(M?O.substring(0,F):O);if(!Q){if(!M){v=S+(v.length>0?" "+v:v);continue}if(Q=d(O),!Q){v=S+(v.length>0?" "+v:v);continue}M=!1}const Z=k.length===0?"":k.length===1?k[0]:m(k).join(":"),$=R?Z+tR:Z,X=$+Q;if(g.indexOf(X)>-1)continue;g.push(X);const be=h(Q,M);for(let me=0;me<be.length;++me){const Ne=be[me];g.push($+Ne)}v=S+(v.length>0?" "+v:v)}return v},Aoe=(...a)=>{let o=0,c,d,h="";for(;o<a.length;)(c=a[o++])&&(d=$Q(c))&&(h&&(h+=" "),h+=d);return h},$Q=a=>{if(typeof a=="string")return a;let o,c="";for(let d=0;d<a.length;d++)a[d]&&(o=$Q(a[d]))&&(c&&(c+=" "),c+=o);return c},uoe=(a,...o)=>{let c,d,h,m;const g=v=>{const E=o.reduce((S,I)=>I(S),a());return c=coe(E),d=c.cache.get,h=c.cache.set,m=x,x(v)},x=v=>{const E=d(v);if(E)return E;const S=doe(v,c);return h(v,S),S};return m=g,(...v)=>m(Aoe(...v))},hoe=[],ra=a=>{const o=c=>c[a]||hoe;return o.isThemeGetter=!0,o},ZQ=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,eH=/^\((?:(\w[\w-]*):)?(.+)\)$/i,poe=/^\d+\/\d+$/,moe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,foe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,goe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,boe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,xoe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,qf=a=>poe.test(a),Sr=a=>!!a&&!Number.isNaN(Number(a)),Wu=a=>!!a&&Number.isInteger(Number(a)),K2=a=>a.endsWith("%")&&Sr(a.slice(0,-1)),jA=a=>moe.test(a),voe=()=>!0,woe=a=>foe.test(a)&&!goe.test(a),tH=()=>!1,_oe=a=>boe.test(a),yoe=a=>xoe.test(a),Eoe=a=>!Ss(a)&&!Cs(a),Soe=a=>Rg(a,nH,tH),Ss=a=>ZQ.test(a),Lp=a=>Rg(a,iH,woe),W2=a=>Rg(a,Ioe,Sr),g6=a=>Rg(a,sH,tH),Coe=a=>Rg(a,rH,yoe),B_=a=>Rg(a,aH,_oe),Cs=a=>eH.test(a),yb=a=>Ig(a,iH),Noe=a=>Ig(a,Ooe),b6=a=>Ig(a,sH),Toe=a=>Ig(a,nH),Roe=a=>Ig(a,rH),L_=a=>Ig(a,aH,!0),Rg=(a,o,c)=>{const d=ZQ.exec(a);return d?d[1]?o(d[1]):c(d[2]):!1},Ig=(a,o,c=!1)=>{const d=eH.exec(a);return d?d[1]?o(d[1]):c:!1},sH=a=>a==="position"||a==="percentage",rH=a=>a==="image"||a==="url",nH=a=>a==="length"||a==="size"||a==="bg-size",iH=a=>a==="length",Ioe=a=>a==="number",Ooe=a=>a==="family-name",aH=a=>a==="shadow",koe=()=>{const a=ra("color"),o=ra("font"),c=ra("text"),d=ra("font-weight"),h=ra("tracking"),m=ra("leading"),g=ra("breakpoint"),x=ra("container"),v=ra("spacing"),E=ra("radius"),S=ra("shadow"),I=ra("inset-shadow"),k=ra("text-shadow"),R=ra("drop-shadow"),O=ra("blur"),F=ra("perspective"),M=ra("aspect"),Q=ra("ease"),Z=ra("animate"),$=()=>["auto","avoid","all","avoid-page","page","left","right","column"],X=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],be=()=>[...X(),Cs,Ss],me=()=>["auto","hidden","clip","visible","scroll"],Ne=()=>["auto","contain","none"],le=()=>[Cs,Ss,v],H=()=>[qf,"full","auto",...le()],Ae=()=>[Wu,"none","subgrid",Cs,Ss],J=()=>["auto",{span:["full",Wu,Cs,Ss]},Wu,Cs,Ss],Y=()=>[Wu,"auto",Cs,Ss],se=()=>["auto","min","max","fr",Cs,Ss],oe=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Te=()=>["start","end","center","stretch","center-safe","end-safe"],he=()=>["auto",...le()],Ce=()=>[qf,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...le()],ee=()=>[a,Cs,Ss],Be=()=>[...X(),b6,g6,{position:[Cs,Ss]}],He=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Ue=()=>["auto","cover","contain",Toe,Soe,{size:[Cs,Ss]}],re=()=>[K2,yb,Lp],ve=()=>["","none","full",E,Cs,Ss],fe=()=>["",Sr,yb,Lp],Ie=()=>["solid","dashed","dotted","double"],je=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ee=()=>[Sr,K2,b6,g6],We=()=>["","none",O,Cs,Ss],ze=()=>["none",Sr,Cs,Ss],st=()=>["none",Sr,Cs,Ss],bt=()=>[Sr,Cs,Ss],Qe=()=>[qf,"full",...le()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[jA],breakpoint:[jA],color:[voe],container:[jA],"drop-shadow":[jA],ease:["in","out","in-out"],font:[Eoe],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[jA],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[jA],shadow:[jA],spacing:["px",Sr],text:[jA],"text-shadow":[jA],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",qf,Ss,Cs,M]}],container:["container"],columns:[{columns:[Sr,Ss,Cs,x]}],"break-after":[{"break-after":$()}],"break-before":[{"break-before":$()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:be()}],overflow:[{overflow:me()}],"overflow-x":[{"overflow-x":me()}],"overflow-y":[{"overflow-y":me()}],overscroll:[{overscroll:Ne()}],"overscroll-x":[{"overscroll-x":Ne()}],"overscroll-y":[{"overscroll-y":Ne()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:H()}],"inset-x":[{"inset-x":H()}],"inset-y":[{"inset-y":H()}],start:[{start:H()}],end:[{end:H()}],top:[{top:H()}],right:[{right:H()}],bottom:[{bottom:H()}],left:[{left:H()}],visibility:["visible","invisible","collapse"],z:[{z:[Wu,"auto",Cs,Ss]}],basis:[{basis:[qf,"full","auto",x,...le()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Sr,qf,"auto","initial","none",Ss]}],grow:[{grow:["",Sr,Cs,Ss]}],shrink:[{shrink:["",Sr,Cs,Ss]}],order:[{order:[Wu,"first","last","none",Cs,Ss]}],"grid-cols":[{"grid-cols":Ae()}],"col-start-end":[{col:J()}],"col-start":[{"col-start":Y()}],"col-end":[{"col-end":Y()}],"grid-rows":[{"grid-rows":Ae()}],"row-start-end":[{row:J()}],"row-start":[{"row-start":Y()}],"row-end":[{"row-end":Y()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":se()}],"auto-rows":[{"auto-rows":se()}],gap:[{gap:le()}],"gap-x":[{"gap-x":le()}],"gap-y":[{"gap-y":le()}],"justify-content":[{justify:[...oe(),"normal"]}],"justify-items":[{"justify-items":[...Te(),"normal"]}],"justify-self":[{"justify-self":["auto",...Te()]}],"align-content":[{content:["normal",...oe()]}],"align-items":[{items:[...Te(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Te(),{baseline:["","last"]}]}],"place-content":[{"place-content":oe()}],"place-items":[{"place-items":[...Te(),"baseline"]}],"place-self":[{"place-self":["auto",...Te()]}],p:[{p:le()}],px:[{px:le()}],py:[{py:le()}],ps:[{ps:le()}],pe:[{pe:le()}],pt:[{pt:le()}],pr:[{pr:le()}],pb:[{pb:le()}],pl:[{pl:le()}],m:[{m:he()}],mx:[{mx:he()}],my:[{my:he()}],ms:[{ms:he()}],me:[{me:he()}],mt:[{mt:he()}],mr:[{mr:he()}],mb:[{mb:he()}],ml:[{ml:he()}],"space-x":[{"space-x":le()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":le()}],"space-y-reverse":["space-y-reverse"],size:[{size:Ce()}],w:[{w:[x,"screen",...Ce()]}],"min-w":[{"min-w":[x,"screen","none",...Ce()]}],"max-w":[{"max-w":[x,"screen","none","prose",{screen:[g]},...Ce()]}],h:[{h:["screen","lh",...Ce()]}],"min-h":[{"min-h":["screen","lh","none",...Ce()]}],"max-h":[{"max-h":["screen","lh",...Ce()]}],"font-size":[{text:["base",c,yb,Lp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[d,Cs,W2]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",K2,Ss]}],"font-family":[{font:[Noe,Ss,o]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[h,Cs,Ss]}],"line-clamp":[{"line-clamp":[Sr,"none",Cs,W2]}],leading:[{leading:[m,...le()]}],"list-image":[{"list-image":["none",Cs,Ss]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Cs,Ss]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:ee()}],"text-color":[{text:ee()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ie(),"wavy"]}],"text-decoration-thickness":[{decoration:[Sr,"from-font","auto",Cs,Lp]}],"text-decoration-color":[{decoration:ee()}],"underline-offset":[{"underline-offset":[Sr,"auto",Cs,Ss]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:le()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Cs,Ss]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Cs,Ss]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Be()}],"bg-repeat":[{bg:He()}],"bg-size":[{bg:Ue()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Wu,Cs,Ss],radial:["",Cs,Ss],conic:[Wu,Cs,Ss]},Roe,Coe]}],"bg-color":[{bg:ee()}],"gradient-from-pos":[{from:re()}],"gradient-via-pos":[{via:re()}],"gradient-to-pos":[{to:re()}],"gradient-from":[{from:ee()}],"gradient-via":[{via:ee()}],"gradient-to":[{to:ee()}],rounded:[{rounded:ve()}],"rounded-s":[{"rounded-s":ve()}],"rounded-e":[{"rounded-e":ve()}],"rounded-t":[{"rounded-t":ve()}],"rounded-r":[{"rounded-r":ve()}],"rounded-b":[{"rounded-b":ve()}],"rounded-l":[{"rounded-l":ve()}],"rounded-ss":[{"rounded-ss":ve()}],"rounded-se":[{"rounded-se":ve()}],"rounded-ee":[{"rounded-ee":ve()}],"rounded-es":[{"rounded-es":ve()}],"rounded-tl":[{"rounded-tl":ve()}],"rounded-tr":[{"rounded-tr":ve()}],"rounded-br":[{"rounded-br":ve()}],"rounded-bl":[{"rounded-bl":ve()}],"border-w":[{border:fe()}],"border-w-x":[{"border-x":fe()}],"border-w-y":[{"border-y":fe()}],"border-w-s":[{"border-s":fe()}],"border-w-e":[{"border-e":fe()}],"border-w-t":[{"border-t":fe()}],"border-w-r":[{"border-r":fe()}],"border-w-b":[{"border-b":fe()}],"border-w-l":[{"border-l":fe()}],"divide-x":[{"divide-x":fe()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":fe()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Ie(),"hidden","none"]}],"divide-style":[{divide:[...Ie(),"hidden","none"]}],"border-color":[{border:ee()}],"border-color-x":[{"border-x":ee()}],"border-color-y":[{"border-y":ee()}],"border-color-s":[{"border-s":ee()}],"border-color-e":[{"border-e":ee()}],"border-color-t":[{"border-t":ee()}],"border-color-r":[{"border-r":ee()}],"border-color-b":[{"border-b":ee()}],"border-color-l":[{"border-l":ee()}],"divide-color":[{divide:ee()}],"outline-style":[{outline:[...Ie(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Sr,Cs,Ss]}],"outline-w":[{outline:["",Sr,yb,Lp]}],"outline-color":[{outline:ee()}],shadow:[{shadow:["","none",S,L_,B_]}],"shadow-color":[{shadow:ee()}],"inset-shadow":[{"inset-shadow":["none",I,L_,B_]}],"inset-shadow-color":[{"inset-shadow":ee()}],"ring-w":[{ring:fe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:ee()}],"ring-offset-w":[{"ring-offset":[Sr,Lp]}],"ring-offset-color":[{"ring-offset":ee()}],"inset-ring-w":[{"inset-ring":fe()}],"inset-ring-color":[{"inset-ring":ee()}],"text-shadow":[{"text-shadow":["none",k,L_,B_]}],"text-shadow-color":[{"text-shadow":ee()}],opacity:[{opacity:[Sr,Cs,Ss]}],"mix-blend":[{"mix-blend":[...je(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":je()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Sr]}],"mask-image-linear-from-pos":[{"mask-linear-from":Ee()}],"mask-image-linear-to-pos":[{"mask-linear-to":Ee()}],"mask-image-linear-from-color":[{"mask-linear-from":ee()}],"mask-image-linear-to-color":[{"mask-linear-to":ee()}],"mask-image-t-from-pos":[{"mask-t-from":Ee()}],"mask-image-t-to-pos":[{"mask-t-to":Ee()}],"mask-image-t-from-color":[{"mask-t-from":ee()}],"mask-image-t-to-color":[{"mask-t-to":ee()}],"mask-image-r-from-pos":[{"mask-r-from":Ee()}],"mask-image-r-to-pos":[{"mask-r-to":Ee()}],"mask-image-r-from-color":[{"mask-r-from":ee()}],"mask-image-r-to-color":[{"mask-r-to":ee()}],"mask-image-b-from-pos":[{"mask-b-from":Ee()}],"mask-image-b-to-pos":[{"mask-b-to":Ee()}],"mask-image-b-from-color":[{"mask-b-from":ee()}],"mask-image-b-to-color":[{"mask-b-to":ee()}],"mask-image-l-from-pos":[{"mask-l-from":Ee()}],"mask-image-l-to-pos":[{"mask-l-to":Ee()}],"mask-image-l-from-color":[{"mask-l-from":ee()}],"mask-image-l-to-color":[{"mask-l-to":ee()}],"mask-image-x-from-pos":[{"mask-x-from":Ee()}],"mask-image-x-to-pos":[{"mask-x-to":Ee()}],"mask-image-x-from-color":[{"mask-x-from":ee()}],"mask-image-x-to-color":[{"mask-x-to":ee()}],"mask-image-y-from-pos":[{"mask-y-from":Ee()}],"mask-image-y-to-pos":[{"mask-y-to":Ee()}],"mask-image-y-from-color":[{"mask-y-from":ee()}],"mask-image-y-to-color":[{"mask-y-to":ee()}],"mask-image-radial":[{"mask-radial":[Cs,Ss]}],"mask-image-radial-from-pos":[{"mask-radial-from":Ee()}],"mask-image-radial-to-pos":[{"mask-radial-to":Ee()}],"mask-image-radial-from-color":[{"mask-radial-from":ee()}],"mask-image-radial-to-color":[{"mask-radial-to":ee()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":X()}],"mask-image-conic-pos":[{"mask-conic":[Sr]}],"mask-image-conic-from-pos":[{"mask-conic-from":Ee()}],"mask-image-conic-to-pos":[{"mask-conic-to":Ee()}],"mask-image-conic-from-color":[{"mask-conic-from":ee()}],"mask-image-conic-to-color":[{"mask-conic-to":ee()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Be()}],"mask-repeat":[{mask:He()}],"mask-size":[{mask:Ue()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Cs,Ss]}],filter:[{filter:["","none",Cs,Ss]}],blur:[{blur:We()}],brightness:[{brightness:[Sr,Cs,Ss]}],contrast:[{contrast:[Sr,Cs,Ss]}],"drop-shadow":[{"drop-shadow":["","none",R,L_,B_]}],"drop-shadow-color":[{"drop-shadow":ee()}],grayscale:[{grayscale:["",Sr,Cs,Ss]}],"hue-rotate":[{"hue-rotate":[Sr,Cs,Ss]}],invert:[{invert:["",Sr,Cs,Ss]}],saturate:[{saturate:[Sr,Cs,Ss]}],sepia:[{sepia:["",Sr,Cs,Ss]}],"backdrop-filter":[{"backdrop-filter":["","none",Cs,Ss]}],"backdrop-blur":[{"backdrop-blur":We()}],"backdrop-brightness":[{"backdrop-brightness":[Sr,Cs,Ss]}],"backdrop-contrast":[{"backdrop-contrast":[Sr,Cs,Ss]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Sr,Cs,Ss]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Sr,Cs,Ss]}],"backdrop-invert":[{"backdrop-invert":["",Sr,Cs,Ss]}],"backdrop-opacity":[{"backdrop-opacity":[Sr,Cs,Ss]}],"backdrop-saturate":[{"backdrop-saturate":[Sr,Cs,Ss]}],"backdrop-sepia":[{"backdrop-sepia":["",Sr,Cs,Ss]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":le()}],"border-spacing-x":[{"border-spacing-x":le()}],"border-spacing-y":[{"border-spacing-y":le()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Cs,Ss]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Sr,"initial",Cs,Ss]}],ease:[{ease:["linear","initial",Q,Cs,Ss]}],delay:[{delay:[Sr,Cs,Ss]}],animate:[{animate:["none",Z,Cs,Ss]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[F,Cs,Ss]}],"perspective-origin":[{"perspective-origin":be()}],rotate:[{rotate:ze()}],"rotate-x":[{"rotate-x":ze()}],"rotate-y":[{"rotate-y":ze()}],"rotate-z":[{"rotate-z":ze()}],scale:[{scale:st()}],"scale-x":[{"scale-x":st()}],"scale-y":[{"scale-y":st()}],"scale-z":[{"scale-z":st()}],"scale-3d":["scale-3d"],skew:[{skew:bt()}],"skew-x":[{"skew-x":bt()}],"skew-y":[{"skew-y":bt()}],transform:[{transform:[Cs,Ss,"","none","gpu","cpu"]}],"transform-origin":[{origin:be()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Qe()}],"translate-x":[{"translate-x":Qe()}],"translate-y":[{"translate-y":Qe()}],"translate-z":[{"translate-z":Qe()}],"translate-none":["translate-none"],accent:[{accent:ee()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:ee()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Cs,Ss]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":le()}],"scroll-mx":[{"scroll-mx":le()}],"scroll-my":[{"scroll-my":le()}],"scroll-ms":[{"scroll-ms":le()}],"scroll-me":[{"scroll-me":le()}],"scroll-mt":[{"scroll-mt":le()}],"scroll-mr":[{"scroll-mr":le()}],"scroll-mb":[{"scroll-mb":le()}],"scroll-ml":[{"scroll-ml":le()}],"scroll-p":[{"scroll-p":le()}],"scroll-px":[{"scroll-px":le()}],"scroll-py":[{"scroll-py":le()}],"scroll-ps":[{"scroll-ps":le()}],"scroll-pe":[{"scroll-pe":le()}],"scroll-pt":[{"scroll-pt":le()}],"scroll-pr":[{"scroll-pr":le()}],"scroll-pb":[{"scroll-pb":le()}],"scroll-pl":[{"scroll-pl":le()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Cs,Ss]}],fill:[{fill:["none",...ee()]}],"stroke-w":[{stroke:[Sr,yb,Lp,W2]}],stroke:[{stroke:["none",...ee()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Doe=uoe(koe);function yc(...a){return Doe(eQ(a))}const Boe=Math.sqrt(5e3),Loe=[{tempId:0,testimonial:"My favorite solution in the market. We work 5x faster with COMPANY.",by:"Alex, CEO at TechCorp",imgSrc:"https://i.pravatar.cc/150?img=1"},{tempId:1,testimonial:"I'm confident my data is safe with COMPANY. I can't say that about other providers.",by:"Dan, CTO at SecureNet",imgSrc:"https://i.pravatar.cc/150?img=2"},{tempId:2,testimonial:"I know it's cliche, but we were lost before we found COMPANY. Can't thank you guys enough!",by:"Stephanie, COO at InnovateCo",imgSrc:"https://i.pravatar.cc/150?img=3"},{tempId:3,testimonial:"COMPANY's products make planning for the future seamless. Can't recommend them enough!",by:"Marie, CFO at FuturePlanning",imgSrc:"https://i.pravatar.cc/150?img=4"},{tempId:4,testimonial:"If I could give 11 stars, I'd give 12.",by:"Andre, Head of Design at CreativeSolutions",imgSrc:"https://i.pravatar.cc/150?img=5"},{tempId:5,testimonial:"SO SO SO HAPPY WE FOUND YOU GUYS!!!! I'd bet you've saved me 100 hours so far.",by:"Jeremy, Product Manager at TimeWise",imgSrc:"https://i.pravatar.cc/150?img=6"},{tempId:6,testimonial:"Took some convincing, but now that we're on COMPANY, we're never going back.",by:"Pam, Marketing Director at BrandBuilders",imgSrc:"https://i.pravatar.cc/150?img=7"},{tempId:7,testimonial:"I would be lost without COMPANY's in-depth analytics. The ROI is EASILY 100X for us.",by:"Daniel, Data Scientist at AnalyticsPro",imgSrc:"https://i.pravatar.cc/150?img=8"},{tempId:8,testimonial:"It's just the best. Period.",by:"Fernando, UX Designer at UserFirst",imgSrc:"https://i.pravatar.cc/150?img=9"},{tempId:9,testimonial:"I switched 5 years ago and never looked back.",by:"Andy, DevOps Engineer at CloudMasters",imgSrc:"https://i.pravatar.cc/150?img=10"},{tempId:10,testimonial:"I've been searching for a solution like COMPANY for YEARS. So glad I finally found one!",by:"Pete, Sales Director at RevenueRockets",imgSrc:"https://i.pravatar.cc/150?img=11"},{tempId:11,testimonial:"It's so simple and intuitive, we got the team up to speed in 10 minutes.",by:"Marina, HR Manager at TalentForge",imgSrc:"https://i.pravatar.cc/150?img=12"},{tempId:12,testimonial:"COMPANY's customer support is unparalleled. They're always there when we need them.",by:"Olivia, Customer Success Manager at ClientCare",imgSrc:"https://i.pravatar.cc/150?img=13"},{tempId:13,testimonial:"The efficiency gains we've seen since implementing COMPANY are off the charts!",by:"Raj, Operations Manager at StreamlineSolutions",imgSrc:"https://i.pravatar.cc/150?img=14"},{tempId:14,testimonial:"COMPANY has revolutionized how we handle our workflow. It's a game-changer!",by:"Lila, Workflow Specialist at ProcessPro",imgSrc:"https://i.pravatar.cc/150?img=15"},{tempId:15,testimonial:"The scalability of COMPANY's solution is impressive. It grows with our business seamlessly.",by:"Trevor, Scaling Officer at GrowthGurus",imgSrc:"https://i.pravatar.cc/150?img=16"},{tempId:16,testimonial:"I appreciate how COMPANY continually innovates. They're always one step ahead.",by:"Naomi, Innovation Lead at FutureTech",imgSrc:"https://i.pravatar.cc/150?img=17"},{tempId:17,testimonial:"The ROI we've seen with COMPANY is incredible. It's paid for itself many times over.",by:"Victor, Finance Analyst at ProfitPeak",imgSrc:"https://i.pravatar.cc/150?img=18"},{tempId:18,testimonial:"COMPANY's platform is so robust, yet easy to use. It's the perfect balance.",by:"Yuki, Tech Lead at BalancedTech",imgSrc:"https://i.pravatar.cc/150?img=19"},{tempId:19,testimonial:"We've tried many solutions, but COMPANY stands out in terms of reliability and performance.",by:"Zoe, Performance Manager at ReliableSystems",imgSrc:"https://i.pravatar.cc/150?img=20"}],joe=({position:a,testimonial:o,handleMove:c,cardSize:d})=>{const h=a===0;return n.jsxs("div",{onClick:()=>c(a),className:yc("absolute left-1/2 top-1/2 cursor-pointer border-2 p-8 transition-all duration-500 ease-in-out",h?"z-10 bg-gradient-to-br from-[#0a3d5c] to-[#0d5a8a] text-white border-cyan-400/60":"z-0 bg-gradient-to-br from-[#0a3d5c]/40 to-[#0d5a8a]/40 text-cyan-100 border-cyan-400/20 hover:border-cyan-400/40"),style:{width:d,height:d,clipPath:"polygon(50px 0%, calc(100% - 50px) 0%, 100% 50px, 100% 100%, calc(100% - 50px) 100%, 50px 100%, 0 100%, 0 0)",transform:`
          translate(-50%, -50%) 
          translateX(${d/1.5*a}px)
          translateY(${h?-65:a%2?15:-15}px)
          rotate(${h?0:a%2?2.5:-2.5}deg)
        `,boxShadow:h?"0px 8px 0px 4px hsl(var(--border))":"0px 0px 0px 0px transparent"},children:[n.jsx("span",{className:"absolute block origin-top-right rotate-45 bg-border",style:{right:-2,top:48,width:Boe,height:2}}),n.jsx("img",{src:o.imgSrc,alt:`${o.by.split(",")[0]}`,className:"mb-4 h-14 w-12 bg-muted object-cover object-top",style:{boxShadow:"3px 3px 0px hsl(var(--background))"}}),n.jsxs("h3",{className:yc("text-base sm:text-xl font-medium",h?"text-white":"text-cyan-100"),children:['"',o.testimonial,'"']}),n.jsxs("p",{className:yc("absolute bottom-8 left-8 right-8 mt-2 text-sm italic",h?"text-white/80":"text-cyan-100/60"),children:["- ",o.by]})]})},Poe=()=>{const[a,o]=te.useState(365),[c,d]=te.useState(Loe),h=m=>{const g=[...c];if(m>0)for(let x=m;x>0;x--){const v=g.shift();if(!v)return;g.push({...v,tempId:Math.random()})}else for(let x=m;x<0;x++){const v=g.pop();if(!v)return;g.unshift({...v,tempId:Math.random()})}d(g)};return te.useEffect(()=>{const m=()=>{const{matches:g}=window.matchMedia("(min-width: 640px)");o(g?365:290)};return m(),window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]),n.jsxs("div",{className:"relative w-full overflow-hidden bg-muted/30",style:{height:600},children:[c.map((m,g)=>{const x=c.length%2?g-(c.length+1)/2:g-c.length/2;return n.jsx(joe,{testimonial:m,handleMove:h,position:x,cardSize:a},m.tempId)}),n.jsxs("div",{className:"absolute bottom-4 left-1/2 flex -translate-x-1/2 gap-2",children:[n.jsx("button",{onClick:()=>h(-1),className:yc("flex h-14 w-14 items-center justify-center text-2xl transition-colors","bg-background border-2 border-border hover:bg-primary hover:text-primary-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"),"aria-label":"Previous testimonial",children:n.jsx(jre,{})}),n.jsx("button",{onClick:()=>h(1),className:yc("flex h-14 w-14 items-center justify-center text-2xl transition-colors","bg-background border-2 border-border hover:bg-primary hover:text-primary-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"),"aria-label":"Next testimonial",children:n.jsx(Pp,{})})]})]})};function Uoe(){const a=te.useRef(null);return te.useEffect(()=>{const o=async()=>{const d=(h,m)=>new Promise((g,x)=>{if(window[m]){g();return}if(document.querySelector(`script[src="${h}"]`)){const E=setInterval(()=>{window[m]&&(clearInterval(E),g())},50);setTimeout(()=>{clearInterval(E),x(new Error(`Timeout waiting for ${m}`))},1e4);return}const v=document.createElement("script");v.src=h,v.onload=()=>{setTimeout(()=>g(),100)},v.onerror=()=>x(new Error(`Failed to load ${h}`)),document.head.appendChild(v)});try{await d("https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js","gsap"),await d("https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js","THREE")}catch(h){console.error("Failed to load base scripts:",h)}c()},c=async()=>{const d={settings:{transitionDuration:1.2,autoSlideSpeed:5e3,currentEffect:"glass",currentEffectPreset:"Default",globalIntensity:1,speedMultiplier:1,distortionStrength:1,colorEnhancement:1,glassRefractionStrength:1,glassChromaticAberration:1,glassBubbleClarity:1,glassEdgeGlow:1,glassLiquidFlow:1,frostIntensity:1.5,frostCrystalSize:1,frostIceCoverage:1,frostTemperature:1,frostTexture:1,rippleFrequency:25,rippleAmplitude:.08,rippleWaveSpeed:1,rippleRippleCount:1,rippleDecay:1,plasmaIntensity:1.2,plasmaSpeed:.8,plasmaEnergyIntensity:.4,plasmaContrastBoost:.3,plasmaTurbulence:1,timeshiftDistortion:1.6,timeshiftBlur:1.5,timeshiftFlow:1.4,timeshiftChromatic:1.5,timeshiftTurbulence:1.4}};let h=0,m=!1,g,x,v,E,S=[],I=!1,k=null,R=null,O=!1;const F=()=>d.settings.autoSlideSpeed,M=50,Q=()=>d.settings.transitionDuration,Z=[{title:"Ai Lab report Analyser",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/AILabReportAnalyser_DesktopSize_3f161f3f-0678-452f-9c1a-a413994df30a.png?v=1770719872",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/AILabReportAnalyser_MobileSize.png?v=1770719520"},{title:"Track Health Parameter",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/NutritionTracker_jpg.jpg?v=1770722505",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/TrackHealthParameter_MobileSize_jpg.jpg?v=1770719520"},{title:"Nutrition Tracker",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/TrackHealthParameter_DesktopSize_jpg.jpg?v=1770719871",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/NutritionTrackerMobile_jpg.jpg?v=1770722504"},{title:"Diet Recommendations",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/WhatsApp_Image_2026-02-07_at_6.44.25_PM.jpg?v=1770707929",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/2150040498_2__jpg.jpg?v=1770722504"},{title:"Supplement Recommendation",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/2150040498_jpg_f6df5fdb-1a8b-4c71-97ec-58643d0dca22.jpg?v=1770722509",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/NutritionTrackerMobile_jpg.jpg?v=1770722504"},{title:"Doctor Recommendation",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/WhatsApp_Image_2026-02-07_at_6.43.52_PM.jpg?v=1770707929",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/TrackHealthParameter_MobileSize_jpg.jpg?v=1770719520"}],$="varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",X=`
            uniform sampler2D uTexture1, uTexture2;
            uniform float uProgress;
            uniform vec2 uResolution, uTexture1Size, uTexture2Size;
            uniform int uEffectType;
            uniform float uGlobalIntensity, uSpeedMultiplier, uDistortionStrength, uColorEnhancement;
            uniform float uGlassRefractionStrength, uGlassChromaticAberration, uGlassBubbleClarity, uGlassEdgeGlow, uGlassLiquidFlow;
            uniform float uFrostIntensity, uFrostCrystalSize, uFrostIceCoverage, uFrostTemperature, uFrostTexture;
            uniform float uRippleFrequency, uRippleAmplitude, uRippleWaveSpeed, uRippleRippleCount, uRippleDecay;
            uniform float uPlasmaIntensity, uPlasmaSpeed, uPlasmaEnergyIntensity, uPlasmaContrastBoost, uPlasmaTurbulence;
            uniform float uTimeshiftDistortion, uTimeshiftBlur, uTimeshiftFlow, uTimeshiftChromatic, uTimeshiftTurbulence;
            varying vec2 vUv;

            vec2 getCoverUV(vec2 uv, vec2 textureSize) {
                vec2 s = uResolution / textureSize;
                float scale = max(s.x, s.y);
                vec2 scaledSize = textureSize * scale;
                vec2 offset = (uResolution - scaledSize) * 0.5;
                return (uv * uResolution - offset) / scaledSize;
            }
            float noise(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453); }
            
            vec4 glassEffect(vec2 uv, float progress) {
                float time = progress * 5.0 * uSpeedMultiplier;
                vec2 uv1 = getCoverUV(uv, uTexture1Size); vec2 uv2 = getCoverUV(uv, uTexture2Size);
                float maxR = length(uResolution) * 0.85; float br = progress * maxR;
                vec2 p = uv * uResolution; vec2 c = uResolution * 0.5;
                float d = length(p - c); float nd = d / max(br, 0.001);
                float param = smoothstep(br + 3.0, br - 3.0, d); // Inside circle
                vec4 img;
                if (param > 0.0) {
                     float ro = 0.08 * uGlassRefractionStrength * uDistortionStrength * uGlobalIntensity * pow(smoothstep(0.3 * uGlassBubbleClarity, 1.0, nd), 1.5);
                     vec2 dir = (d > 0.0) ? (p - c) / d : vec2(0.0);
                     vec2 distUV = uv2 - dir * ro;
                     distUV += vec2(sin(time + nd * 10.0), cos(time * 0.8 + nd * 8.0)) * 0.015 * uGlassLiquidFlow * uSpeedMultiplier * nd * param;
                     float ca = 0.02 * uGlassChromaticAberration * uGlobalIntensity * pow(smoothstep(0.3, 1.0, nd), 1.2);
                     img = vec4(texture2D(uTexture2, distUV + dir * ca * 1.2).r, texture2D(uTexture2, distUV + dir * ca * 0.2).g, texture2D(uTexture2, distUV - dir * ca * 0.8).b, 1.0);
                     if (uGlassEdgeGlow > 0.0) {
                        float rim = smoothstep(0.95, 1.0, nd) * (1.0 - smoothstep(1.0, 1.01, nd));
                        img.rgb += rim * 0.08 * uGlassEdgeGlow * uGlobalIntensity;
                     }
                } else { img = texture2D(uTexture2, uv2); }
                vec4 oldImg = texture2D(uTexture1, uv1);
                if (progress > 0.95) img = mix(img, texture2D(uTexture2, uv2), (progress - 0.95) / 0.05);
                return mix(oldImg, img, param);
            }
            // Simplified stubs for other effects (to save space, logic is in glassEffect mainly for demo)
            vec4 frostEffect(vec2 uv, float progress) { return mix(texture2D(uTexture1, getCoverUV(uv, uTexture1Size)), texture2D(uTexture2, getCoverUV(uv, uTexture2Size)), progress); }
            vec4 rippleEffect(vec2 uv, float progress) { return mix(texture2D(uTexture1, getCoverUV(uv, uTexture1Size)), texture2D(uTexture2, getCoverUV(uv, uTexture2Size)), progress); }
            vec4 plasmaEffect(vec2 uv, float progress) { return mix(texture2D(uTexture1, getCoverUV(uv, uTexture1Size)), texture2D(uTexture2, getCoverUV(uv, uTexture2Size)), progress); }
            vec4 timeshiftEffect(vec2 uv, float progress) { return mix(texture2D(uTexture1, getCoverUV(uv, uTexture1Size)), texture2D(uTexture2, getCoverUV(uv, uTexture2Size)), progress); }

            void main() {
                if (uEffectType == 0) gl_FragColor = glassEffect(vUv, uProgress);
                else if (uEffectType == 1) gl_FragColor = frostEffect(vUv, uProgress);
                else if (uEffectType == 2) gl_FragColor = rippleEffect(vUv, uProgress);
                else if (uEffectType == 3) gl_FragColor = plasmaEffect(vUv, uProgress);
                else gl_FragColor = timeshiftEffect(vUv, uProgress);
            }
        `,be=fe=>({glass:0,frost:1,ripple:2,plasma:3,timeshift:4})[fe]||0,me=()=>{if(!g)return;const fe=d.settings,Ie=g.uniforms;for(const je in fe){const Ee="u"+je.charAt(0).toUpperCase()+je.slice(1);Ie[Ee]&&(Ie[Ee].value=fe[je])}Ie.uEffectType.value=be(fe.currentEffect)},Ne=fe=>fe.split("").map(Ie=>`<span style="display: inline-block; opacity: 0;">${Ie===" "?"&nbsp;":Ie}</span>`).join(""),le=fe=>{const Ie=document.getElementById("mainTitle"),je=document.getElementById("mainDesc");Ie&&je&&(gsap.to(Ie.children,{y:-20,opacity:0,duration:.5,stagger:.02,ease:"power2.in"}),gsap.to(je,{y:-10,opacity:0,duration:.4,ease:"power2.in"}),setTimeout(()=>{Ie.innerHTML=Ne(Z[fe].title),je.textContent=Z[fe].description,gsap.set(Ie.children,{opacity:0}),gsap.set(je,{y:20,opacity:0});const Ee=Ie.children;switch(fe){case 0:gsap.set(Ee,{y:20}),gsap.to(Ee,{y:0,opacity:1,duration:.8,stagger:.03,ease:"power3.out"}),gsap.to(je,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"});break;case 1:gsap.set(Ee,{y:-20}),gsap.to(Ee,{y:0,opacity:1,duration:.8,stagger:.03,ease:"back.out(1.7)"}),gsap.to(je,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"});break;case 2:gsap.set(Ee,{filter:"blur(10px)",scale:1.5,y:0}),gsap.to(Ee,{filter:"blur(0px)",scale:1,opacity:1,duration:1,stagger:{amount:.5,from:"random"},ease:"power2.out"}),gsap.to(je,{y:0,opacity:1,duration:1,delay:.3,ease:"power2.out"});break;case 3:gsap.set(Ee,{scale:0,y:0}),gsap.to(Ee,{scale:1,opacity:1,duration:.6,stagger:.05,ease:"back.out(1.5)"}),gsap.to(je,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"});break;case 4:gsap.set(Ee,{rotationX:90,y:0,transformOrigin:"50% 50%"}),gsap.to(Ee,{rotationX:0,opacity:1,duration:.8,stagger:.04,ease:"power2.out"}),gsap.to(je,{y:0,opacity:1,duration:.8,delay:.2,ease:"power2.out"});break;case 5:gsap.set(Ee,{x:30,y:0}),gsap.to(Ee,{x:0,opacity:1,duration:.8,stagger:.03,ease:"power3.out"}),gsap.to(je,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"});break;default:gsap.set(Ee,{y:20}),gsap.to(Ee,{y:0,opacity:1,duration:.8,stagger:.03,ease:"power3.out"}),gsap.to(je,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"})}},500))},H=fe=>{if(m||fe===h)return;ee(),Te(h);const Ie=S[h],je=S[fe];!Ie||!je||(m=!0,g.uniforms.uTexture1.value=Ie,g.uniforms.uTexture2.value=je,g.uniforms.uTexture1Size.value=Ie.userData.size,g.uniforms.uTexture2Size.value=je.userData.size,le(fe),h=fe,he(h),Y(h),gsap.fromTo(g.uniforms.uProgress,{value:0},{value:1,duration:Q(),ease:"power2.inOut",onComplete:()=>{g.uniforms.uProgress.value=0,g.uniforms.uTexture1.value=je,g.uniforms.uTexture1Size.value=je.userData.size,m=!1,Be(100)}}))},Ae=()=>{m||!I||!O||H((h+1)%Z.length)},J=()=>{const fe=document.getElementById("slidesNav");fe&&(fe.children.length>0||Z.forEach((Ie,je)=>{const Ee=document.createElement("div");Ee.className=`slide-nav-item${je===0?" active":""}`,Ee.dataset.slideIndex=String(je),Ee.innerHTML=`<div class="slide-progress-line"><div class="slide-progress-fill"></div></div><div class="slide-nav-title">${Ie.title}</div>`,Ee.addEventListener("click",We=>{We.stopPropagation(),!m&&je!==h&&(ee(),Te(h),H(je))}),fe.appendChild(Ee)}))},Y=fe=>document.querySelectorAll(".slide-nav-item").forEach((Ie,je)=>Ie.classList.toggle("active",je===fe)),se=(fe,Ie)=>{var Ee;const je=(Ee=document.querySelectorAll(".slide-nav-item")[fe])==null?void 0:Ee.querySelector(".slide-progress-fill");je&&(je.style.width=`${Ie}%`,je.style.opacity="1")},oe=fe=>{var je;const Ie=(je=document.querySelectorAll(".slide-nav-item")[fe])==null?void 0:je.querySelector(".slide-progress-fill");Ie&&(Ie.style.opacity="0",setTimeout(()=>Ie.style.width="0%",300))},Te=fe=>{var je;const Ie=(je=document.querySelectorAll(".slide-nav-item")[fe])==null?void 0:je.querySelector(".slide-progress-fill");Ie&&(Ie.style.transition="width 0.2s ease-out",Ie.style.width="0%",setTimeout(()=>Ie.style.transition="width 0.1s ease, opacity 0.3s ease",200))},he=fe=>{const Ie=document.getElementById("slideNumber");Ie&&(Ie.textContent=String(fe+1).padStart(2,"0"));const je=document.getElementById("slideTotal");je&&(je.textContent=String(Z.length).padStart(2,"0"))},Ce=()=>{if(!I||!O||m)return;ee();let fe=0;const Ie=100/F()*M;R=setInterval(()=>{if(!O||m){ee();return}fe+=Ie,se(h,fe),fe>=100&&(clearInterval(R),R=null,oe(h),m||Ae())},M)},ee=()=>{R&&clearInterval(R),k&&clearTimeout(k),R=null,k=null},Be=(fe=0)=>{ee(),O&&I&&(fe>0?k=setTimeout(Ce,fe):Ce())},He=fe=>new Promise((Ie,je)=>{new THREE.TextureLoader().load(fe,We=>{We.minFilter=We.magFilter=THREE.LinearFilter,We.userData={size:new THREE.Vector2(We.image.width,We.image.height)},Ie(We)},void 0,je)}),Ue=async()=>{var Ee;const fe=document.querySelector(".webgl-canvas");if(!fe)return;v=new THREE.Scene,E=new THREE.OrthographicCamera(-1,1,1,-1,0,1),x=new THREE.WebGLRenderer({canvas:fe,antialias:!1,alpha:!1}),x.setSize(window.innerWidth,window.innerHeight),x.setPixelRatio(Math.min(window.devicePixelRatio,2)),g=new THREE.ShaderMaterial({uniforms:{uTexture1:{value:null},uTexture2:{value:null},uProgress:{value:0},uResolution:{value:new THREE.Vector2(window.innerWidth,window.innerHeight)},uTexture1Size:{value:new THREE.Vector2(1,1)},uTexture2Size:{value:new THREE.Vector2(1,1)},uEffectType:{value:0},uGlobalIntensity:{value:1},uSpeedMultiplier:{value:1},uDistortionStrength:{value:1},uColorEnhancement:{value:1},uGlassRefractionStrength:{value:1},uGlassChromaticAberration:{value:1},uGlassBubbleClarity:{value:1},uGlassEdgeGlow:{value:1},uGlassLiquidFlow:{value:1},uFrostIntensity:{value:1},uFrostCrystalSize:{value:1},uFrostIceCoverage:{value:1},uFrostTemperature:{value:1},uFrostTexture:{value:1},uRippleFrequency:{value:25},uRippleAmplitude:{value:.08},uRippleWaveSpeed:{value:1},uRippleRippleCount:{value:1},uRippleDecay:{value:1},uPlasmaIntensity:{value:1.2},uPlasmaSpeed:{value:.8},uPlasmaEnergyIntensity:{value:.4},uPlasmaContrastBoost:{value:.3},uPlasmaTurbulence:{value:1},uTimeshiftDistortion:{value:1.6},uTimeshiftBlur:{value:1.5},uTimeshiftFlow:{value:1.4},uTimeshiftChromatic:{value:1.5},uTimeshiftTurbulence:{value:1.4}},vertexShader:$,fragmentShader:X}),v.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),g));const Ie=window.innerWidth<=768;for(const We of Z)try{const ze=Ie&&We.mediaMobile||We.media;S.push(await He(ze))}catch{console.warn("Failed texture")}S.length>=2&&(g.uniforms.uTexture1.value=S[0],g.uniforms.uTexture2.value=S[1],g.uniforms.uTexture1Size.value=S[0].userData.size,g.uniforms.uTexture2Size.value=S[1].userData.size,I=!0,O=!0,me(),(Ee=document.querySelector(".slider-wrapper"))==null||Ee.classList.add("loaded"),Be(500));const je=()=>{requestAnimationFrame(je),x.render(v,E)};je()};J(),he(0);const re=document.getElementById("mainTitle"),ve=document.getElementById("mainDesc");re&&ve&&(re.innerHTML=Ne(Z[0].title),ve.textContent=Z[0].description,gsap.fromTo(re.children,{y:20,opacity:0},{y:0,opacity:1,duration:1,stagger:.03,ease:"power3.out",delay:.5}),gsap.fromTo(ve,{y:20,opacity:0},{y:0,opacity:1,duration:1,ease:"power3.out",delay:.8})),Ue(),document.addEventListener("visibilitychange",()=>document.hidden?ee():!m&&Be()),window.addEventListener("resize",()=>{x&&(x.setSize(window.innerWidth,window.innerHeight),g.uniforms.uResolution.value.set(window.innerWidth,window.innerHeight))})};return o(),()=>{}},[]),n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
        .slider-wrapper {
          position: relative;
          width: 100%;
          height: 100vh;
          overflow: hidden;
          background: transparent;
          border-radius: 1.5rem;
        }

        .webgl-canvas {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border-radius: 1.5rem;
        }

        /* Slide Numbers - Left and Right */
        .slide-number, .slide-total {
          position: absolute;
          font-size: 2rem;
          font-weight: 300;
          color: rgba(255, 255, 255, 0.6);
          z-index: 10;
          letter-spacing: 2px;
        }

        .slide-number {
          top: 50%;
          left: 2rem;
          transform: translateY(-50%);
        }

        .slide-total {
          top: 50%;
          right: 2rem;
          transform: translateY(-50%);
        }

        /* Center Content */
        .slide-content {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
          z-index: 5;
          width: 80%;
          max-width: 800px;
        }

        .slide-title {
          font-size: 2.5rem;
          font-weight: 300;
          color: white;
          margin: 0;
          margin-bottom: 1rem;
          letter-spacing: 2px;
          line-height: 1.2;
        }

        .slide-description {
          font-size: 1.1rem;
          color: rgba(255, 255, 255, 0.8);
          margin: 0;
          letter-spacing: 0.5px;
          line-height: 1.6;
        }

        /* Navigation at bottom */
        .slides-navigation {
          position: absolute;
          bottom: 2rem;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 2rem;
          z-index: 10;
          width: 90%;
          max-width: 1200px;
          justify-content: center;
          flex-wrap: nowrap;
          overflow-x: hidden;
        }

        .slide-nav-item {
          cursor: pointer;
          position: relative;
          padding-bottom: 0.5rem;
          transition: all 0.3s ease;
        }

        .slide-nav-title {
          font-size: 0.9rem;
          color: rgba(255, 255, 255, 0.6);
          letter-spacing: 1px;
          text-transform: uppercase;
          transition: color 0.3s ease;
        }

        .slide-nav-item.active .slide-nav-title {
          color: rgba(255, 255, 255, 1);
        }

        .slide-progress-line {
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 1px;
          background: rgba(255, 255, 255, 0.2);
        }

        .slide-progress-fill {
          height: 100%;
          background: rgba(255, 255, 255, 0.8);
          width: 0%;
          transition: width 0.1s ease, opacity 0.3s ease;
          opacity: 0;
        }

        .slider-wrapper.loaded {
          opacity: 1;
        }

        @media (max-width: 768px) {
          .slide-title {
            font-size: 1.8rem;
          }

          .slide-description {
            font-size: 0.9rem;
          }

          .slide-number, .slide-total {
            font-size: 1.2rem;
            top: 1.5rem;
          }

          .slide-number {
            left: 1.5rem;
            transform: none;
          }

          .slide-total {
            right: 1.5rem;
            transform: none;
          }

          .slides-navigation {
            bottom: 1rem;
            gap: 0.5rem;
            width: 95%;
            max-width: 100%;
            flex-wrap: wrap;
            justify-content: center;
          }

          .slide-nav-item {
            flex: 0 1 calc(50% - 0.25rem);
            min-width: 0;
          }

          .slide-nav-title {
            font-size: 0.7rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }

          .slide-content {
            width: 90%;
          }
        }
      `}),n.jsxs("main",{className:"slider-wrapper",ref:a,children:[n.jsx("canvas",{className:"webgl-canvas"}),n.jsx("span",{className:"slide-number",id:"slideNumber",children:"01"}),n.jsx("span",{className:"slide-total",id:"slideTotal",children:"06"}),n.jsx("div",{className:"slide-content",children:n.jsx("p",{className:"slide-description",id:"mainDesc"})}),n.jsx("nav",{className:"slides-navigation",id:"slidesNav"})]})]})}const x6=a=>typeof a=="boolean"?`${a}`:a===0?"0":a,v6=eQ,oH=(a,o)=>c=>{var d;if((o==null?void 0:o.variants)==null)return v6(a,c==null?void 0:c.class,c==null?void 0:c.className);const{variants:h,defaultVariants:m}=o,g=Object.keys(h).map(E=>{const S=c==null?void 0:c[E],I=m==null?void 0:m[E];if(S===null)return null;const k=x6(S)||x6(I);return h[E][k]}),x=c&&Object.entries(c).reduce((E,S)=>{let[I,k]=S;return k===void 0||(E[I]=k),E},{}),v=o==null||(d=o.compoundVariants)===null||d===void 0?void 0:d.reduce((E,S)=>{let{class:I,className:k,...R}=S;return Object.entries(R).every(O=>{let[F,M]=O;return Array.isArray(M)?M.includes({...m,...x}[F]):{...m,...x}[F]===M})?[...E,I,k]:E},[]);return v6(a,g,v,c==null?void 0:c.class,c==null?void 0:c.className)},Foe=oH("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function w6({className:a,variant:o,...c}){return n.jsx("div",{className:yc(Foe({variant:o}),a),...c})}function _6(a,o){if(typeof a=="function")return a(o);a!=null&&(a.current=o)}function Moe(...a){return o=>{let c=!1;const d=a.map(h=>{const m=_6(h,o);return!c&&typeof m=="function"&&(c=!0),m});if(c)return()=>{for(let h=0;h<d.length;h++){const m=d[h];typeof m=="function"?m():_6(a[h],null)}}}}var Voe=Symbol.for("react.lazy"),Ly=Ore[" use ".trim().toString()];function Qoe(a){return typeof a=="object"&&a!==null&&"then"in a}function cH(a){return a!=null&&typeof a=="object"&&"$$typeof"in a&&a.$$typeof===Voe&&"_payload"in a&&Qoe(a._payload)}function Hoe(a){const o=Koe(a),c=te.forwardRef((d,h)=>{let{children:m,...g}=d;cH(m)&&typeof Ly=="function"&&(m=Ly(m._payload));const x=te.Children.toArray(m),v=x.find(zoe);if(v){const E=v.props.children,S=x.map(I=>I===v?te.Children.count(E)>1?te.Children.only(null):te.isValidElement(E)?E.props.children:null:I);return n.jsx(o,{...g,ref:h,children:te.isValidElement(E)?te.cloneElement(E,void 0,S):null})}return n.jsx(o,{...g,ref:h,children:m})});return c.displayName=`${a}.Slot`,c}var Goe=Hoe("Slot");function Koe(a){const o=te.forwardRef((c,d)=>{let{children:h,...m}=c;if(cH(h)&&typeof Ly=="function"&&(h=Ly(h._payload)),te.isValidElement(h)){const g=Yoe(h),x=qoe(m,h.props);return h.type!==te.Fragment&&(x.ref=d?Moe(d,g):g),te.cloneElement(h,x)}return te.Children.count(h)>1?te.Children.only(null):null});return o.displayName=`${a}.SlotClone`,o}var Woe=Symbol("radix.slottable");function zoe(a){return te.isValidElement(a)&&typeof a.type=="function"&&"__radixId"in a.type&&a.type.__radixId===Woe}function qoe(a,o){const c={...o};for(const d in o){const h=a[d],m=o[d];/^on[A-Z]/.test(d)?h&&m?c[d]=(...x)=>{const v=m(...x);return h(...x),v}:h&&(c[d]=h):d==="style"?c[d]={...h,...m}:d==="className"&&(c[d]=[h,m].filter(Boolean).join(" "))}return{...a,...c}}function Yoe(a){var d,h;let o=(d=Object.getOwnPropertyDescriptor(a.props,"ref"))==null?void 0:d.get,c=o&&"isReactWarning"in o&&o.isReactWarning;return c?a.ref:(o=(h=Object.getOwnPropertyDescriptor(a,"ref"))==null?void 0:h.get,c=o&&"isReactWarning"in o&&o.isReactWarning,c?a.props.ref:a.props.ref||a.ref)}const Xoe=oH("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),sR=te.forwardRef(({className:a,variant:o,size:c,asChild:d=!1,...h},m)=>{const g=d?Goe:"button";return n.jsx(g,{className:yc(Xoe({variant:o,size:c,className:a})),ref:m,...h})});sR.displayName="Button";const rR=te.forwardRef(({className:a,...o},c)=>n.jsx("div",{ref:c,className:yc("rounded-lg border bg-card text-card-foreground shadow-sm",a),...o}));rR.displayName="Card";const nR=te.forwardRef(({className:a,...o},c)=>n.jsx("div",{ref:c,className:yc("flex flex-col space-y-1.5 p-6",a),...o}));nR.displayName="CardHeader";const iR=te.forwardRef(({className:a,...o},c)=>n.jsx("h3",{ref:c,className:yc("text-2xl font-semibold leading-none tracking-tight",a),...o}));iR.displayName="CardTitle";const Joe=te.forwardRef(({className:a,...o},c)=>n.jsx("p",{ref:c,className:yc("text-sm text-muted-foreground",a),...o}));Joe.displayName="CardDescription";const aR=te.forwardRef(({className:a,...o},c)=>n.jsx("div",{ref:c,className:yc("p-6 pt-0",a),...o}));aR.displayName="CardContent";const $oe=te.forwardRef(({className:a,...o},c)=>n.jsx("div",{ref:c,className:yc("flex items-center p-6 pt-0",a),...o}));$oe.displayName="CardFooter";function Zoe({timelineData:a}){const[o,c]=te.useState({}),[d,h]=te.useState("orbital"),[m,g]=te.useState(0),[x,v]=te.useState(!0),[E,S]=te.useState({}),[I,k]=te.useState({x:0,y:0}),[R,O]=te.useState(null),F=te.useRef(null),M=te.useRef(null),Q=te.useRef({}),Z=H=>{(H.target===F.current||H.target===M.current)&&(c({}),O(null),S({}),v(!0))},$=H=>{c(Ae=>{const J={...Ae};if(Object.keys(J).forEach(Y=>{parseInt(Y)!==H&&(J[parseInt(Y)]=!1)}),J[H]=!Ae[H],Ae[H])O(null),v(!0),S({});else{O(H),v(!1);const Y=me(H),se={};Y.forEach(oe=>{se[oe]=!0}),S(se),X(H)}return J})};te.useEffect(()=>{let H;return x&&d==="orbital"&&(H=setInterval(()=>{g(Ae=>(Ae+.5)%360)},30)),()=>{H&&clearInterval(H)}},[x,d]);const X=H=>{if(d!=="orbital"||!Q.current[H])return;const Ae=a.findIndex(se=>se.id===H),J=a.length,Y=Ae/J*360;g(270-Y)},be=(H,Ae)=>{const J=(H/Ae*360+m)%360,se=typeof window<"u"&&window.innerWidth<1024?160:200,oe=J*Math.PI/180,Te=se*Math.cos(oe)+I.x,he=se*Math.sin(oe)+I.y,Ce=Math.round(100+50*Math.cos(oe)),ee=Math.max(.4,Math.min(1,.4+.6*((1+Math.sin(oe))/2)));return{x:Te,y:he,angle:J,zIndex:Ce,opacity:ee}},me=H=>{const Ae=a.find(J=>J.id===H);return Ae?Ae.relatedIds:[]},Ne=H=>R?me(R).includes(H):!1,le=H=>{switch(H){case"completed":return"text-white bg-black border-white";case"in-progress":return"text-black bg-white border-black";case"pending":return"text-white bg-black/40 border-white/50";default:return"text-white bg-black/40 border-white/50"}};return n.jsx("div",{className:"w-full py-20 md:py-32 bg-gradient-to-b from-transparent via-transparent to-transparent overflow-hidden",ref:F,onClick:Z,children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"hidden md:block text-center max-w-3xl mx-auto mb-16",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400"}),n.jsx("span",{className:"text-sm uppercase tracking-wider text-cyan-300 font-medium",children:"Platform Features"})]}),n.jsx("h2",{className:"text-3xl md:text-5xl font-bold text-white mb-6",children:"Five Core Features That Power HealthAI"}),n.jsx("p",{className:"text-lg text-cyan-100",children:"Discover the essential capabilities that make intelligent health management possible"})]}),n.jsxs("div",{className:"hidden lg:flex items-center justify-center gap-16 h-[600px]",children:[n.jsx("div",{className:"flex-1 flex flex-col justify-center",children:n.jsx("p",{className:"text-6xl md:text-7xl font-serif font-bold text-white leading-tight",children:"Transform Your Health With Advanced AI Intelligence and Insights"})}),n.jsx("div",{className:"flex-1 h-full relative rounded-3xl overflow-visible bg-gradient-to-br from-[#0a3d5c] via-[#0d5a8a] to-[#051f2e] border border-cyan-400/20 shadow-2xl shadow-cyan-600/20",children:n.jsxs("div",{className:"absolute w-full h-full flex items-center justify-center z-10",ref:M,style:{perspective:"1000px",transform:`translate(${I.x}px, ${I.y}px)`},children:[n.jsxs("div",{className:"absolute w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 via-blue-500 to-teal-500 animate-pulse flex items-center justify-center z-50",children:[n.jsx("div",{className:"absolute w-20 h-20 rounded-full border-2 border-white/30 animate-ping opacity-70"}),n.jsx("div",{className:"absolute w-24 h-24 rounded-full border-2 border-white/20 animate-ping opacity-50",style:{animationDelay:"0.5s"}}),n.jsx("div",{className:"w-8 h-8 rounded-full bg-white/90 backdrop-blur-md shadow-lg shadow-white/50"})]}),n.jsx("div",{className:"absolute w-96 h-96 rounded-full border border-white/10"}),a.map((H,Ae)=>{const J=be(Ae,a.length),Y=o[H.id],se=Ne(H.id),oe=E[H.id],Te=H.icon,he={transform:`translate(${J.x}px, ${J.y}px)`,zIndex:Y?200:J.zIndex,opacity:Y?1:J.opacity};return n.jsxs("div",{ref:Ce=>Q.current[H.id]=Ce,className:"absolute transition-all duration-700 cursor-pointer",style:he,onClick:Ce=>{Ce.stopPropagation(),$(H.id)},children:[n.jsx("div",{className:`absolute rounded-full -inset-1 ${oe?"animate-pulse duration-1000":""}`,style:{background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%)",width:`${H.energy*.5+40}px`,height:`${H.energy*.5+40}px`,left:`-${(H.energy*.5+40-40)/2}px`,top:`-${(H.energy*.5+40-40)/2}px`}}),n.jsx("div",{className:`
                  w-10 h-10 rounded-full flex items-center justify-center
                  bg-transparent text-white
                  border-2 
                  ${Y?"border-white shadow-lg shadow-white/30":se?"border-white animate-pulse":"border-white"}
                  transition-all duration-300 transform
                  ${Y?"scale-150":""}
                `,children:n.jsx(Te,{size:16})}),n.jsx("div",{className:`
                  absolute top-12  whitespace-nowrap
                  text-xs font-semibold tracking-wider
                  transition-all duration-300
                  ${Y?"text-white scale-125":"text-white"}
                `,children:H.title}),Y&&n.jsxs(rR,{className:"absolute top-14 left-1/2 -translate-x-1/2 w-48 bg-gradient-to-br from-[#0a3d5c] to-[#0d5a8a] backdrop-blur-lg border-cyan-500/50 shadow-xl shadow-cyan-500/20 overflow-visible z-50",children:[n.jsx("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 w-px h-1.5 bg-cyan-400/70"}),n.jsxs(nR,{className:"pb-1.5 pt-3 px-3",children:[n.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[n.jsx(w6,{className:`px-1.5 text-xs font-semibold ${le(H.status)}`,children:H.status==="completed"?" COMPLETE":H.status==="in-progress"?" IN PROGRESS":" PENDING"}),n.jsx("span",{className:"text-xs font-mono text-cyan-300/70",children:H.date})]}),n.jsx(iR,{className:"text-xs text-white mt-0.5",children:H.title})]}),n.jsxs(aR,{className:"text-xs text-cyan-100/90 space-y-1.5 px-3 pb-2",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-cyan-300 font-semibold mb-0.5 text-xs",children:" Overview"}),n.jsx("p",{className:"text-cyan-100/80 text-xs leading-tight",children:H.content})]}),n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsx("h4",{className:"text-cyan-300 font-semibold mb-1 text-xs",children:" Key Features"}),n.jsxs("div",{className:"space-y-0.5",children:[H.id===1&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Comprehensive health data collection"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"User needs and pain points analysis"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Feature prioritization framework"})]})]}),H.id===2&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Scalable microservices architecture"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"AI/ML pipeline integration"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Secure data storage design"})]})]}),H.id===3&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Claude AI integration for analysis"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Real-time report processing"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Multi-language support"})]})]}),H.id===4&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Automated test suite coverage"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Performance optimization"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Security vulnerability scanning"})]})]}),H.id===5&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Production deployment pipeline"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"24/7 monitoring and alerts"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"User onboarding and support"})]})]})]})]}),n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsxs("div",{className:"flex justify-between items-center text-xs mb-0.5",children:[n.jsxs("span",{className:"flex items-center text-cyan-300",children:[n.jsx(nl,{size:9,className:"mr-0.5"}),"Progress"]}),n.jsxs("span",{className:"font-mono text-cyan-400 text-xs",children:[H.energy,"%"]})]}),n.jsx("div",{className:"w-full h-1 bg-cyan-900/50 rounded-full overflow-hidden border border-cyan-500/30",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-cyan-400",style:{width:`${H.energy}%`}})})]}),H.relatedIds.length>0&&n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsxs("div",{className:"flex items-center mb-0.5",children:[n.jsx(G3,{size:9,className:"text-cyan-400 mr-0.5"}),n.jsx("h4",{className:"text-xs uppercase tracking-wider font-semibold text-cyan-300",children:"Related Phases"})]}),n.jsx("div",{className:"flex flex-wrap gap-1",children:H.relatedIds.map(Ce=>{const ee=a.find(Be=>Be.id===Ce);return n.jsxs(sR,{variant:"outline",size:"sm",className:"flex items-center h-5 px-1 py-0 text-xs rounded-md border-cyan-500/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-300 hover:text-cyan-200 transition-all",onClick:Be=>{Be.stopPropagation(),$(Ce)},children:[ee==null?void 0:ee.title,n.jsx(vo,{size:7,className:"ml-0.5 text-cyan-400/60"})]},Ce)})})]})]})]})]},H.id)})]})})]}),n.jsx("div",{className:"lg:hidden h-auto py-4 flex flex-col items-center justify-center",children:n.jsxs("div",{className:"relative w-full h-[480px] flex items-center justify-center rounded-2xl overflow-visible",style:{background:"linear-gradient(135deg, rgba(10, 61, 92, 0.4) 0%, rgba(13, 90, 138, 0.4) 100%)"},children:[n.jsx("div",{className:"absolute inset-0 rounded-2xl border border-cyan-500/30"}),n.jsxs("div",{className:"absolute w-full h-full flex items-center justify-center",ref:M,style:{perspective:"1000px",transform:`translate(${I.x}px, ${I.y}px)`},children:[n.jsxs("div",{className:"absolute w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 via-blue-500 to-teal-500 animate-pulse flex items-center justify-center z-50",children:[n.jsx("div",{className:"absolute w-20 h-20 rounded-full border-2 border-white/30 animate-ping opacity-70"}),n.jsx("div",{className:"absolute w-24 h-24 rounded-full border-2 border-white/20 animate-ping opacity-50",style:{animationDelay:"0.5s"}}),n.jsx("div",{className:"w-8 h-8 rounded-full bg-white/90 backdrop-blur-md shadow-lg shadow-white/50"})]}),n.jsx("div",{className:"absolute w-96 h-96 rounded-full border border-white/10"}),a.map((H,Ae)=>{const J=be(Ae,a.length),Y=o[H.id],se=Ne(H.id),oe=E[H.id],Te=H.icon,he={transform:`translate(${J.x}px, ${J.y}px)`,zIndex:Y?200:J.zIndex,opacity:Y?1:J.opacity};return n.jsxs("div",{ref:Ce=>Q.current[H.id]=Ce,className:"absolute transition-all duration-700 cursor-pointer",style:he,onClick:Ce=>{Ce.stopPropagation(),$(H.id)},children:[n.jsx("div",{className:`absolute rounded-full -inset-1 ${oe?"animate-pulse duration-1000":""}`,style:{background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%)",width:`${H.energy*.5+40}px`,height:`${H.energy*.5+40}px`,left:`-${(H.energy*.5+40-40)/2}px`,top:`-${(H.energy*.5+40-40)/2}px`}}),n.jsx("div",{className:`
                      w-10 h-10 rounded-full flex items-center justify-center
                      bg-transparent text-white
                      border-2 
                      ${Y?"border-white shadow-lg shadow-white/30":se?"border-white animate-pulse":"border-white"}
                      transition-all duration-300 transform
                      ${Y?"scale-150":""}
                    `,children:n.jsx(Te,{size:16})}),n.jsx("div",{className:`
                      absolute top-12  whitespace-nowrap
                      text-xs font-semibold tracking-wider
                      transition-all duration-300
                      ${Y?"text-white scale-125":"text-white"}
                    `,children:H.title}),Y&&n.jsxs(rR,{className:"absolute top-14 left-1/2 -translate-x-1/2 w-48 bg-gradient-to-br from-[#0a3d5c] to-[#0d5a8a] backdrop-blur-lg border-cyan-500/50 shadow-xl shadow-cyan-500/20 overflow-visible z-50",children:[n.jsx("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 w-px h-1.5 bg-cyan-400/70"}),n.jsxs(nR,{className:"pb-1.5 pt-3 px-3",children:[n.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[n.jsx(w6,{className:`px-1.5 text-xs font-semibold ${le(H.status)}`,children:H.status==="completed"?" COMPLETE":H.status==="in-progress"?" IN PROGRESS":" PENDING"}),n.jsx("span",{className:"text-xs font-mono text-cyan-300/70",children:H.date})]}),n.jsx(iR,{className:"text-xs text-white mt-0.5",children:H.title})]}),n.jsxs(aR,{className:"text-xs text-cyan-100/90 space-y-1.5 px-3 pb-2",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-cyan-300 font-semibold mb-0.5 text-xs",children:" Overview"}),n.jsx("p",{className:"text-cyan-100/80 text-xs leading-tight",children:H.content})]}),n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsx("h4",{className:"text-cyan-300 font-semibold mb-1 text-xs",children:" Key Features"}),n.jsxs("div",{className:"space-y-0.5",children:[H.id===1&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Comprehensive health data collection"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"User needs and pain points analysis"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Feature prioritization framework"})]})]}),H.id===2&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Scalable microservices architecture"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"AI/ML pipeline integration"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Secure data storage design"})]})]}),H.id===3&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Claude AI integration for analysis"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Real-time report processing"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Multi-language support"})]})]}),H.id===4&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Automated test suite coverage"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Performance optimization"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Security vulnerability scanning"})]})]}),H.id===5&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Production deployment pipeline"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"24/7 monitoring and alerts"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"User onboarding and support"})]})]})]})]}),n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsxs("div",{className:"flex justify-between items-center text-xs mb-0.5",children:[n.jsxs("span",{className:"flex items-center text-cyan-300",children:[n.jsx(nl,{size:9,className:"mr-0.5"}),"Progress"]}),n.jsxs("span",{className:"font-mono text-cyan-400 text-xs",children:[H.energy,"%"]})]}),n.jsx("div",{className:"w-full h-1 bg-cyan-900/50 rounded-full overflow-hidden border border-cyan-500/30",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-cyan-400",style:{width:`${H.energy}%`}})})]}),H.relatedIds.length>0&&n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsxs("div",{className:"flex items-center mb-0.5",children:[n.jsx(G3,{size:9,className:"text-cyan-400 mr-0.5"}),n.jsx("h4",{className:"text-xs uppercase tracking-wider font-semibold text-cyan-300",children:"Related Phases"})]}),n.jsx("div",{className:"flex flex-wrap gap-1",children:H.relatedIds.map(Ce=>{const ee=a.find(Be=>Be.id===Ce);return n.jsxs(sR,{variant:"outline",size:"sm",className:"flex items-center h-5 px-1 py-0 text-xs rounded-md border-cyan-500/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-300 hover:text-cyan-200 transition-all",onClick:Be=>{Be.stopPropagation(),$(Ce)},children:[ee==null?void 0:ee.title,n.jsx(vo,{size:7,className:"ml-0.5 text-cyan-400/60"})]},Ce)})})]})]})]})]},H.id)})]})]})})]})})}const ece=[{id:1,title:"AI Analysis",date:"Real-time",content:"Advanced AI-powered analysis of your medical reports to identify health patterns and risks.",category:"Feature",icon:sE,relatedIds:[2,3],status:"completed",energy:100},{id:2,title:"Health Tracking",date:"24/7",content:"Continuous monitoring of your health metrics with smart alerts and personalized recommendations.",category:"Feature",icon:Vi,relatedIds:[1,4],status:"completed",energy:95},{id:3,title:"Doctor Network",date:"Verified",content:"Connect with verified healthcare professionals recommended based on your specific health needs.",category:"Feature",icon:wg,relatedIds:[1,5],status:"completed",energy:90},{id:4,title:"Nutrition Plans",date:"Personalized",content:"Get customized nutrition plans and supplement recommendations based on your health profile.",category:"Feature",icon:Xp,relatedIds:[2,5],status:"completed",energy:85},{id:5,title:"Report Upload",date:"Instant",content:"Upload your medical reports and get instant AI-powered analysis with actionable insights.",category:"Feature",icon:il,relatedIds:[3,4],status:"completed",energy:100}];function tce(){const[a,o]=te.useState(0),c=[{question:"What types of health reports can I upload?",answer:"FitCure supports all common medical report formats including blood tests, lab results, imaging reports, and general health checkups. You can upload PDFs, images, or even photos of paper reports. Our AI can extract and analyze data from virtually any medical document."},{question:"How accurate is the AI analysis?",answer:"Our AI has been trained on millions of medical records and achieves 98% accuracy in data extraction and analysis. However, our insights are meant to supplement, not replace, professional medical advice. We always recommend consulting with healthcare professionals for serious health concerns."},{question:"Is my health data secure and private?",answer:"Absolutely. We use bank-level encryption to protect your data and are fully HIPAA compliant. Your health information is never shared with third parties without your explicit consent. You have complete control over your data and can delete it at any time."},{question:"Can I connect with real doctors through the platform?",answer:"Yes! Based on your AI analysis, we recommend verified healthcare professionals who specialize in your specific health needs. Our network includes thousands of doctors, specialists, and healthcare providers who understand our AI insights."},{question:"What if I don't have any medical reports?",answer:"No problem! You can start by taking our comprehensive health assessment, or we can help you understand what tests to request from your doctor. We also provide guidance on essential health screenings based on your age, gender, and health goals."},{question:"Can I cancel my subscription anytime?",answer:"Yes, you can cancel your subscription at any time with no penalties or fees. If you cancel mid-cycle, you'll continue to have access to all features until the end of your billing period. We also offer a 30-day money-back guarantee for new subscribers."}];return n.jsx("section",{id:"faq",className:"py-20 md:py-32 bg-transparent",children:n.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"text-center mb-16",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400"}),n.jsx("span",{className:"text-sm uppercase tracking-wider text-cyan-300 font-medium",children:"FAQ"})]}),n.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-white mb-6",children:"Got questions?"}),n.jsx("p",{className:"text-lg text-cyan-100",children:"We've got answers. If you can't find what you're looking for, chat with our team."})]}),n.jsx("div",{className:"space-y-4",children:c.map((d,h)=>n.jsxs("div",{className:"border border-cyan-500/30 rounded-xl overflow-hidden bg-white/5 backdrop-blur-sm hover:bg-white/10 transition-colors",children:[n.jsxs("button",{onClick:()=>o(a===h?null:h),className:"w-full flex items-center justify-between p-6 text-left",children:[n.jsx("span",{className:"text-lg font-medium text-white pr-4",children:d.question}),n.jsx(lh,{className:`w-5 h-5 text-cyan-300 shrink-0 transition-transform duration-200 ${a===h?"rotate-180":""}`})]}),n.jsx("div",{className:`overflow-hidden transition-all duration-200 ${a===h?"max-h-96":"max-h-0"}`,children:n.jsx("p",{className:"px-6 pb-6 text-cyan-100 leading-relaxed",children:d.answer})})]},h))})]})})}function sce(){return n.jsx("section",{className:"py-20 md:py-32 bg-transparent",children:n.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-white mb-6",children:"Ready to transform your health with AI?"}),n.jsx("p",{className:"text-lg text-cyan-100 mb-10 max-w-2xl mx-auto",children:"Join 10,000+ people who've made the switch to proactive, AI-powered healthcare. Your future self will thank you."}),n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[n.jsxs(Os,{to:"/register?skip=true",className:"bg-white text-[#8B7355] hover:bg-[#F5F1EA] rounded-full px-8 py-4 text-base font-medium transition-all inline-flex items-center gap-2 shadow-lg",children:["Start your free analysis",n.jsx(vo,{className:"w-5 h-5"})]}),n.jsx(Os,{to:"/login",className:"rounded-full px-8 py-4 text-base font-medium border-2 border-white/40 text-white hover:bg-white/10 bg-transparent transition-all backdrop-blur-sm",children:"Talk to our team"})]}),n.jsx("p",{className:"text-sm text-white/80 mt-6",children:"Free forever plan  No credit card required  Cancel anytime"})]})})}function rce(){return n.jsx("footer",{className:"bg-gradient-to-b from-[#0a3d5c] to-[#051f2e] text-white py-16",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8 mb-12",children:[n.jsxs("div",{className:"col-span-2 lg:col-span-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("div",{className:"w-8 h-8 bg-[#8B7355] rounded-xl flex items-center justify-center",children:n.jsx(Cr,{className:"w-5 h-5 text-white"})}),n.jsx("span",{className:"font-serif text-xl",children:"FitCure"})]}),n.jsx("p",{className:"text-white/60 text-sm mb-4",children:"AI-powered health insights for better living."})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Product"}),n.jsxs("ul",{className:"space-y-3 text-sm",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Features"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Pricing"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Mobile App"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"API"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),n.jsxs("ul",{className:"space-y-3 text-sm",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"About"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Blog"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Careers"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Press"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Resources"}),n.jsxs("ul",{className:"space-y-3 text-sm",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Help Center"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Health Guides"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Find a Doctor"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Partner with Us"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),n.jsxs("ul",{className:"space-y-3 text-sm",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Privacy Policy"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Terms of Service"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"HIPAA Compliance"})})]})]})]}),n.jsx("div",{className:"pt-8 border-t border-white/10 flex flex-col md:flex-row items-center justify-between gap-4",children:n.jsx("p",{className:"text-sm text-white/60",children:" 2026 FitCure. All rights reserved."})})]})})}function nce(){return n.jsxs("div",{className:"min-h-screen bg-transparent",children:[n.jsx(Vae,{}),n.jsx(Qae,{}),n.jsx(Hae,{}),n.jsx(Gae,{}),n.jsx(Uoe,{}),n.jsx(Zoe,{timelineData:ece}),n.jsx(Kae,{}),n.jsx(Poe,{}),n.jsx(tce,{}),n.jsx(sce,{}),n.jsx(rce,{})]})}function ice(){const[a,o]=te.useState(""),[c,d]=te.useState(""),[h,m]=te.useState(!1),[g,x]=te.useState(!1),{login:v}=aa(),E=to(),S=async I=>{var k,R,O;I.preventDefault(),x(!0);try{const F=await v(a,c);Ct.success("Welcome back!"),E(F.role==="admin"?"/admin":F.role==="doctor"?"/doctor/dashboard":"/dashboard")}catch(F){const M=((R=(k=F.response)==null?void 0:k.data)==null?void 0:R.message)||F.message||"Login failed";F.response?Ct.error(M):(Ct.error("Network error - Check if server is running and accessible"),console.error("Connection details:",{apiUrl:(O=F.config)==null?void 0:O.baseURL,host:window.location.hostname,port:window.location.port}))}finally{x(!1)}};return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center w-full p-12 text-white",children:[n.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:n.jsx(Cr,{className:"w-10 h-10"})}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Welcome to HealthAI"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Your AI-powered health companion for smarter healthcare decisions."})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[n.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-orange-600 rounded-xl flex items-center justify-center",children:n.jsx(Cr,{className:"w-7 h-7 text-white"})}),n.jsx("span",{className:"text-2xl font-bold text-gray-900",children:"HealthAI"})]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-900",children:"Sign In"}),n.jsx("p",{className:"text-gray-600",children:"Access your health dashboard"})]}),n.jsxs("form",{onSubmit:S,className:"space-y-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(ax,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"email",value:a,onChange:I=>o(I.target.value),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-gray-200 text-gray-900",placeholder:"you@example.com",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(qb,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:h?"text":"password",value:c,onChange:I=>d(I.target.value),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-gray-200 text-gray-900",placeholder:"",required:!0}),n.jsx("button",{type:"button",onClick:()=>m(!h),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:h?n.jsx(tQ,{className:"w-5 h-5"}):n.jsx(Kp,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-cyan-500 focus:ring-cyan-500"}),n.jsx("span",{className:"text-sm text-gray-600",children:"Remember me"})]}),n.jsx("a",{href:"#",className:"text-sm font-medium text-cyan-600 hover:text-cyan-700",children:"Forgot password?"})]}),n.jsx("button",{type:"submit",disabled:g,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50 bg-gradient-to-r from-purple-500 to-orange-600 hover:from-purple-600 hover:to-orange-700",children:g?n.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):n.jsxs(n.Fragment,{children:["Sign In ",n.jsx(vo,{className:"w-5 h-5"})]})})]}),n.jsxs("p",{className:"text-center mt-8 text-gray-600",children:["Don't have an account?"," ",n.jsx(Os,{to:"/register",className:"font-semibold text-cyan-600 hover:text-cyan-700",children:"Create one"})]})]})})]})}function ace({step:a}){const o=(a-1)/6*100,c=()=>{switch(a){case 2:return n.jsx(Vi,{className:"w-12 h-12"});case 3:return n.jsx(Cr,{className:"w-12 h-12"});case 4:return n.jsx(sQ,{className:"w-12 h-12"});case 5:return n.jsx(nx,{className:"w-12 h-12"});case 6:return n.jsx(Oy,{className:"w-12 h-12"});case 7:return n.jsx(Zl,{className:"w-12 h-12"});default:return n.jsx(Vi,{className:"w-12 h-12"})}},d=()=>{switch(a){case 2:return"Building Your Profile";case 3:return"Analyzing Your Health";case 4:return"Understanding Diabetes";case 5:return"Diet Preferences";case 6:return"Fitness & Goals";case 7:return"Almost Complete!";default:return"Getting Started"}};return n.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-4",children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-400 to-orange-500 rounded-full opacity-20 animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-gradient-to-br from-purple-400 to-orange-500 rounded-full opacity-30 animate-pulse",style:{animationDelay:"0.2s"}}),n.jsx("div",{className:"absolute inset-8 bg-gradient-to-br from-purple-500 to-orange-600 rounded-full flex items-center justify-center text-white shadow-lg",children:c()}),n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"currentColor",strokeOpacity:"0.1",strokeWidth:"4",fill:"none",className:"text-cyan-500"}),n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"currentColor",strokeWidth:"4",fill:"none",strokeDasharray:"377",strokeDashoffset:377-377*(o/100),className:"text-cyan-500 transition-all duration-500",strokeLinecap:"round"})]})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-lg font-semibold text-cyan-600 mb-1",children:d()}),n.jsxs("p",{className:"text-sm text-gray-600",children:[Math.round(o),"% Complete"]})]}),n.jsx("div",{className:"flex items-center gap-2 mt-4",children:[2,3,4,5,6,7].map(h=>n.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${h<a?"bg-cyan-500 w-8":h===a?"bg-cyan-500 w-3 h-3":"bg-gray-300"}`},h))})]})}function oce(){const a=Zy();new URLSearchParams(a.search);const[o,c]=te.useState(2),[d,h]=te.useState("patient"),[m,g]=te.useState({name:"",email:"",password:"",confirmPassword:"",age:"",gender:"",height:"",weight:"",bloodGroup:"",dietaryPreference:"non-vegetarian",activityLevel:"sedentary",smoker:!1,alcohol:!1,sleepHours:"7",stressLevel:"moderate",waterIntake:"8",chronicConditions:[],isDiabetic:"no",diabetesType:"",diagnosisYear:"",diabetesStatus:"",hba1c:"",glucoseMonitoring:"",fastingGlucose:"",postMealGlucose:"",testingFrequency:"",onMedication:!1,medicationType:[],insulinTiming:"",recentDosageChange:!1,primaryGoal:"general_health",targetWeight:"",weeklyGoal:"0.5"}),[x,v]=te.useState(!1),[E,S]=te.useState(!1),[I,k]=te.useState(""),[R,O]=te.useState(""),[F,M]=te.useState(""),[Q,Z]=te.useState(""),{register:$}=aa(),X=to(),be=async H=>{var Ae,J;if(H.preventDefault(),m.password!==m.confirmPassword){Ct.error("Passwords do not match");return}if(!m.age||!m.gender){Ct.error("Please provide your age and gender");return}S(!0);try{const Y={age:parseInt(m.age),gender:m.gender,height:m.height?parseFloat(m.height):void 0,weight:m.weight?parseFloat(m.weight):void 0,bloodGroup:m.bloodGroup||void 0,dietaryPreference:m.dietaryPreference,activityLevel:m.activityLevel,medicalHistory:{conditions:m.chronicConditions.includes("Diabetes")?m.chronicConditions:m.isDiabetic==="yes"?["Diabetes",...m.chronicConditions]:m.chronicConditions},lifestyle:{smoker:m.smoker,alcohol:m.alcohol,sleepHours:parseInt(m.sleepHours),stressLevel:m.stressLevel,waterIntake:parseInt(m.waterIntake)},diabetesProfile:m.isDiabetic==="yes"?{type:m.diabetesType,diagnosisYear:m.diagnosisYear,status:m.diabetesStatus,hba1c:m.hba1c,glucoseMonitoring:m.glucoseMonitoring,fastingGlucose:m.fastingGlucose,postMealGlucose:m.postMealGlucose,testingFrequency:m.testingFrequency,onMedication:m.onMedication,medicationType:m.medicationType,insulinTiming:m.insulinTiming,recentDosageChange:m.recentDosageChange}:void 0},se={goal:m.primaryGoal,targetWeight:m.targetWeight?parseFloat(m.targetWeight):null,weeklyGoal:parseFloat(m.weeklyGoal)};await $(m.name,m.email,m.password,Y,se),Ct.success("Account created successfully!"),X("/dashboard")}catch(Y){Ct.error(((J=(Ae=Y.response)==null?void 0:Ae.data)==null?void 0:J.message)||"Registration failed")}finally{S(!1)}},me=()=>{if(o===2&&(!m.name||!m.email||!m.password||!m.age||!m.gender)){Ct.error("Please fill in all basic fields");return}if(o===3&&(!m.height||!m.weight)){Ct.error("Please provide height and weight");return}if(o===5&&m.isDiabetic==="no"){c(6);return}c(o+1)},Ne=()=>{o===2?X("/"):c(o-1)},le=(H,Ae)=>{g(J=>({...J,[H]:J[H].includes(Ae)?J[H].filter(Y=>Y!==Ae):[...J[H],Ae]}))};if(o===2)return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsx("div",{className:"lg:hidden w-full",children:n.jsx(ace,{step:2})}),n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Vi,{className:"w-12 h-12 animate-pulse"})}),n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeOpacity:"0.2",strokeWidth:"4",fill:"none"}),n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeWidth:"4",fill:"none",strokeDasharray:"377",strokeDashoffset:377-377*.16,className:"transition-all duration-500",strokeLinecap:"round"})]})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Your Health Journey Starts Here"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Get personalized health insights, diet plans, and supplement recommendations based on your unique profile."}),n.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=2?"bg-white text-cyan-600":"bg-white/20"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"1"})}),n.jsx("span",{className:"text-xs",children:"Basic"})]}),n.jsx("div",{className:"w-8 h-0.5 bg-white/20"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=3?"bg-white text-cyan-600":"bg-white/20"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"2"})}),n.jsx("span",{className:"text-xs",children:"Health"})]}),n.jsx("div",{className:"w-8 h-0.5 bg-white/20"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=4?"bg-white text-cyan-600":"bg-white/20"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"3"})}),n.jsx("span",{className:"text-xs",children:"Lifestyle"})]}),n.jsx("div",{className:"w-8 h-0.5 bg-white/20"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=5?"bg-white text-cyan-600":"bg-white/20"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"4"})}),n.jsx("span",{className:"text-xs",children:"Diabetes"})]}),n.jsx("div",{className:"w-8 h-0.5 bg-white/20"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=6?"bg-white text-cyan-600":"bg-white/20"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"5"})}),n.jsx("span",{className:"text-xs",children:"Goals"})]})]}),n.jsxs("p",{className:"text-sm text-white/70 mt-6",children:["Step ",o-1," of 5 - ",o===2?"Basic Info":o===3?"Health Profile":o===4?"Lifestyle":o===5?"Diabetes":"Goals"]})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("button",{onClick:()=>X("/"),className:"flex items-center gap-2 mb-6 text-cyan-600 hover:text-cyan-700",children:[n.jsx(ln,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Basic Information"}),n.jsx("p",{className:"text-slate-600",children:"Step 1 of 5 - Let's start with the basics"})]}),n.jsxs("form",{onSubmit:H=>{H.preventDefault(),me()},className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Full Name *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Xd,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:"text",value:m.name,onChange:H=>g({...m,name:H.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"John Doe",required:!0})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Age *"}),n.jsx("input",{type:"number",value:m.age,onChange:H=>g({...m,age:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"25",min:"1",max:"120",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Gender *"}),n.jsxs("select",{value:m.gender,onChange:H=>g({...m,gender:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900",required:!0,children:[n.jsx("option",{value:"",className:"text-slate-900",children:"Select"}),n.jsx("option",{value:"male",className:"text-slate-900",children:"Male"}),n.jsx("option",{value:"female",className:"text-slate-900",children:"Female"}),n.jsx("option",{value:"other",className:"text-slate-900",children:"Other"})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Email Address *"}),n.jsxs("div",{className:"relative",children:[n.jsx(ax,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:"email",value:m.email,onChange:H=>g({...m,email:H.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"you@example.com",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Password *"}),n.jsxs("div",{className:"relative",children:[n.jsx(qb,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:x?"text":"password",value:m.password,onChange:H=>g({...m,password:H.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"",required:!0}),n.jsx("button",{type:"button",onClick:()=>v(!x),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:x?n.jsx(tQ,{className:"w-5 h-5"}):n.jsx(Kp,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Confirm Password *"}),n.jsxs("div",{className:"relative",children:[n.jsx(qb,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:"password",value:m.confirmPassword,onChange:H=>g({...m,confirmPassword:H.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"",required:!0})]})]}),n.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 bg-gradient-to-r from-purple-500 to-orange-600 hover:from-purple-600 hover:to-orange-700",children:["Continue ",n.jsx(vo,{className:"w-5 h-5"})]})]}),n.jsxs("p",{className:"text-center mt-6 text-slate-600",children:["Already have an account?"," ",n.jsx(Os,{to:"/login",className:"font-semibold text-cyan-600 hover:text-cyan-700",children:"Sign in"})]})]})})]});if(o===3)return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(K3,{className:"w-12 h-12 animate-bounce",style:{animationDuration:"2s"}})}),n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeOpacity:"0.2",strokeWidth:"4",fill:"none"}),n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeWidth:"4",fill:"none",strokeDasharray:"377",strokeDashoffset:377-377*.4,className:"transition-all duration-500",strokeLinecap:"round"})]})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Health Profile"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Help us calculate your personalized nutrition goals based on your body metrics."}),n.jsx("p",{className:"text-sm text-white/70 mt-6",children:"Step 2 of 5"})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(ln,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Health Profile"}),n.jsx("p",{className:"text-cyan-700",children:"Step 2 of 5 - Your body metrics"})]}),n.jsxs("form",{onSubmit:H=>{H.preventDefault(),me()},className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Height (cm) *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Pre,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-600"}),n.jsx("input",{type:"number",value:m.height,onChange:H=>g(Ae=>({...Ae,height:H.target.value})),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"170",min:"100",max:"250",step:"0.1",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Weight (kg) *"}),n.jsxs("div",{className:"relative",children:[n.jsx(K3,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-600"}),n.jsx("input",{type:"number",value:m.weight,onChange:H=>g(Ae=>({...Ae,weight:H.target.value})),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"70",min:"30",max:"300",step:"0.1",required:!0})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Blood Group"}),n.jsxs("div",{className:"relative",children:[n.jsx(JR,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-600"}),n.jsxs("select",{value:m.bloodGroup,onChange:H=>g(Ae=>({...Ae,bloodGroup:H.target.value})),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"",className:"text-slate-900",children:"Select (Optional)"}),n.jsx("option",{value:"A+",className:"text-slate-900",children:"A+"}),n.jsx("option",{value:"A-",className:"text-slate-900",children:"A-"}),n.jsx("option",{value:"B+",className:"text-slate-900",children:"B+"}),n.jsx("option",{value:"B-",className:"text-slate-900",children:"B-"}),n.jsx("option",{value:"AB+",className:"text-slate-900",children:"AB+"}),n.jsx("option",{value:"AB-",className:"text-slate-900",children:"AB-"}),n.jsx("option",{value:"O+",className:"text-slate-900",children:"O+"}),n.jsx("option",{value:"O-",className:"text-slate-900",children:"O-"})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Dietary Preference *"}),n.jsxs("select",{value:m.dietaryPreference,onChange:H=>g(Ae=>({...Ae,dietaryPreference:H.target.value})),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900",required:!0,children:[n.jsx("option",{value:"non-vegetarian",className:"text-slate-900",children:"Non-Vegetarian"}),n.jsx("option",{value:"vegetarian",className:"text-slate-900",children:"Vegetarian"}),n.jsx("option",{value:"vegan",className:"text-slate-900",children:"Vegan"}),n.jsx("option",{value:"eggetarian",className:"text-slate-900",children:"Eggetarian"})]}),n.jsx("p",{className:"text-xs mt-1 text-cyan-700",children:"This helps us recommend suitable diet plans"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Activity Level *"}),n.jsxs("select",{value:m.activityLevel,onChange:H=>g(Ae=>({...Ae,activityLevel:H.target.value})),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900",required:!0,children:[n.jsx("option",{value:"sedentary",className:"text-slate-900",children:"Sedentary (Little or no exercise)"}),n.jsx("option",{value:"lightly_active",className:"text-slate-900",children:"Lightly Active (1-3 days/week)"}),n.jsx("option",{value:"moderately_active",className:"text-slate-900",children:"Moderately Active (3-5 days/week)"}),n.jsx("option",{value:"very_active",className:"text-slate-900",children:"Very Active (6-7 days/week)"}),n.jsx("option",{value:"extremely_active",className:"text-slate-900",children:"Extremely Active (Athlete)"})]}),n.jsx("p",{className:"text-xs mt-1 text-cyan-700",children:"Used to calculate your daily calorie needs"})]}),n.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700",children:["Continue ",n.jsx(vo,{className:"w-5 h-5"})]})]})]})})]});if(o===5)return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Cr,{className:"w-12 h-12"})})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Diabetes Information"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Skip this if you don't have diabetes. This helps us tailor your glucose management plan."}),n.jsx("p",{className:"text-sm text-white/70 mt-6",children:"Step 4 of 5"})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:n.jsxs("div",{className:"w-full max-w-md py-8",children:[n.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(ln,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Are you diabetic?"}),n.jsx("p",{className:"text-cyan-700",children:"Step 4 of 5 - Detailed health check"})]}),n.jsxs("form",{onSubmit:H=>{H.preventDefault(),me()},className:"space-y-6",children:[n.jsxs("div",{className:"flex gap-4 p-4 bg-white rounded-xl border border-cyan-200",children:[n.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all hover:bg-cyan-50 border-cyan-200",children:[n.jsx("input",{type:"radio",checked:m.isDiabetic==="no",onChange:()=>g({...m,isDiabetic:"no",diabetesType:""}),className:"text-cyan-500"}),n.jsx("span",{className:"font-medium text-slate-800",children:"No"})]}),n.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all hover:bg-cyan-50 border-cyan-200",children:[n.jsx("input",{type:"radio",checked:m.isDiabetic==="yes",onChange:()=>g({...m,isDiabetic:"yes"}),className:"text-cyan-500"}),n.jsx("span",{className:"font-medium text-slate-800",children:"Yes"})]})]}),m.isDiabetic==="yes"&&n.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-top-4 duration-300",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Diabetes Type"}),n.jsxs("select",{value:m.diabetesType,onChange:H=>g({...m,diabetesType:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"",className:"text-slate-900",children:"Select Type"}),n.jsx("option",{value:"Type 1",className:"text-slate-900",children:"Type 1"}),n.jsx("option",{value:"Type 2",className:"text-slate-900",children:"Type 2"}),n.jsx("option",{value:"Prediabetes",className:"text-slate-900",children:"Prediabetes"}),n.jsx("option",{value:"Gestational",className:"text-slate-900",children:"Gestational"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Diagnosis Year"}),n.jsx("input",{type:"number",value:m.diagnosisYear,onChange:H=>g({...m,diagnosisYear:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"2020"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"HbA1c (%)"}),n.jsx("input",{type:"number",step:"0.1",value:m.hba1c,onChange:H=>g({...m,hba1c:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"6.5"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Are you on medication?"}),n.jsxs("div",{className:"flex gap-4",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"radio",checked:!m.onMedication,onChange:()=>g({...m,onMedication:!1}),className:"text-cyan-500"}),n.jsx("span",{className:"text-sm text-slate-800",children:"No"})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"radio",checked:m.onMedication,onChange:()=>g({...m,onMedication:!0}),className:"text-cyan-500"}),n.jsx("span",{className:"text-sm text-slate-800",children:"Yes"})]})]})]})]}),n.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 flex items-center justify-center gap-2",children:["Continue ",n.jsx(vo,{className:"w-5 h-5"})]})]})]})})]});if(o===4)return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Cr,{className:"w-12 h-12"})})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Lifestyle & Health"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Tell us about your daily habits and any existing health conditions."}),n.jsx("p",{className:"text-sm text-white/70 mt-6",children:"Step 3 of 5"})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:n.jsxs("div",{className:"w-full max-w-md py-8",children:[n.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(ln,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Lifestyle & Conditions"}),n.jsx("p",{className:"text-cyan-700",children:"Step 3 of 5 - Habits and health history"})]}),n.jsxs("form",{onSubmit:H=>{H.preventDefault(),me()},className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-xl border border-slate-200",children:[n.jsx(Ure,{className:"w-5 h-5 text-slate-400"}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:m.smoker,onChange:H=>g({...m,smoker:H.target.checked}),className:"text-cyan-500"}),n.jsx("span",{className:"text-sm text-slate-800",children:"Smoker"})]})]}),n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-xl border border-slate-200",children:[n.jsx(Fre,{className:"w-5 h-5 text-slate-400"}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:m.alcohol,onChange:H=>g({...m,alcohol:H.target.checked}),className:"text-cyan-500"}),n.jsx("span",{className:"text-sm text-slate-800",children:"Alcohol"})]})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:["Sleep Hours/Night: ",m.sleepHours,"h"]}),n.jsx("input",{type:"range",min:"4",max:"12",value:m.sleepHours,onChange:H=>g({...m,sleepHours:H.target.value}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Stress Level"}),n.jsxs("select",{value:m.stressLevel,onChange:H=>g({...m,stressLevel:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-slate-200 text-slate-900",children:[n.jsx("option",{value:"low",className:"text-slate-900",children:"Low"}),n.jsx("option",{value:"moderate",className:"text-slate-900",children:"Moderate"}),n.jsx("option",{value:"high",className:"text-slate-900",children:"High"})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:["Water Intake (Glasses/Day): ",m.waterIntake]}),n.jsx("input",{type:"range",min:"1",max:"15",value:m.waterIntake,onChange:H=>g({...m,waterIntake:H.target.value}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Chronic Conditions (If any)"}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:["Hypertension","Thyroid","PCOS/PCOD","Asthma","Arthritis","None"].map(H=>n.jsx("button",{type:"button",onClick:()=>{H==="None"?g({...m,chronicConditions:[]}):le("chronicConditions",H)},className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${m.chronicConditions.includes(H)?"bg-cyan-600 text-white":"bg-slate-100 text-slate-700"}`,children:H},H))})]}),n.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 flex items-center justify-center gap-2",children:["Continue ",n.jsx(vo,{className:"w-5 h-5"})]})]})]})})]});if(o===7){const Ae=(()=>{if(!m.targetWeight||!m.weight)return null;const J=Math.abs(parseFloat(m.targetWeight)-parseFloat(m.weight));return Math.ceil(J/parseFloat(m.weeklyGoal))})();return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Zl,{className:"w-12 h-12"})}),n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeOpacity:"0.2",strokeWidth:"4",fill:"none"}),n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeWidth:"4",fill:"none",strokeDasharray:"377",strokeDashoffset:377-377*1,className:"transition-all duration-500",strokeLinecap:"round"})]}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:n.jsx(Mre,{className:"w-16 h-16 text-white/80 animate-pulse"})})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Final Step!"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"We'll calculate your personalized nutrition plan based on your goals."}),n.jsxs("div",{className:"mt-6 text-center",children:[n.jsx("p",{className:"text-lg font-bold text-white mb-2",children:" Almost Complete!"}),n.jsx("p",{className:"text-sm text-white/70",children:"One more step to unlock your personalized health plan"})]})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:n.jsxs("div",{className:"w-full max-w-md py-8",children:[n.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(ln,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Nutrition Goals"}),n.jsx("p",{className:"text-cyan-700",children:"Step 6 of 6 - Final step!"})]}),n.jsxs("form",{onSubmit:be,className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-3 text-slate-900",children:"What's your primary nutrition goal?"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("button",{type:"button",onClick:()=>g({...m,nutritionGoal:"weight_loss"}),className:`p-4 rounded-xl border-2 transition-all ${m.nutritionGoal==="weight_loss"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(rE,{className:`w-8 h-8 mx-auto mb-2 ${m.nutritionGoal==="weight_loss"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Weight Loss"})]}),n.jsxs("button",{type:"button",onClick:()=>g({...m,nutritionGoal:"weight_gain"}),className:`p-4 rounded-xl border-2 transition-all ${m.nutritionGoal==="weight_gain"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(va,{className:`w-8 h-8 mx-auto mb-2 ${m.nutritionGoal==="weight_gain"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Weight Gain"})]}),n.jsxs("button",{type:"button",onClick:()=>g({...m,nutritionGoal:"muscle_gain"}),className:`p-4 rounded-xl border-2 transition-all ${m.nutritionGoal==="muscle_gain"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(Oy,{className:`w-8 h-8 mx-auto mb-2 ${m.nutritionGoal==="muscle_gain"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Muscle Gain"})]}),n.jsxs("button",{type:"button",onClick:()=>g({...m,nutritionGoal:"maintain"}),className:`p-4 rounded-xl border-2 transition-all ${m.nutritionGoal==="maintain"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(Cg,{className:`w-8 h-8 mx-auto mb-2 ${m.nutritionGoal==="maintain"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Maintain"})]}),n.jsxs("button",{type:"button",onClick:()=>g({...m,nutritionGoal:"general_health"}),className:`p-4 rounded-xl border-2 transition-all col-span-2 ${m.nutritionGoal==="general_health"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(Vi,{className:`w-8 h-8 mx-auto mb-2 ${m.nutritionGoal==="general_health"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"General Health"})]})]})]}),(m.nutritionGoal==="weight_loss"||m.nutritionGoal==="weight_gain")&&n.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-4 border border-cyan-200",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Target Weight (kg)"}),n.jsx("input",{type:"number",value:m.targetWeight,onChange:J=>g({...m,targetWeight:J.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:m.weight,min:"30",max:"300",step:"0.1"}),n.jsxs("p",{className:"text-xs mt-1 text-slate-600",children:["Current: ",m.weight," kg"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Weekly Goal"}),n.jsxs("select",{value:m.weeklyGoal,onChange:J=>g({...m,weeklyGoal:J.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"0.25",className:"text-slate-900",children:"0.25 kg/week (Slow & Steady)"}),n.jsx("option",{value:"0.5",className:"text-slate-900",children:"0.5 kg/week (Recommended)"}),n.jsx("option",{value:"1",className:"text-slate-900",children:"1 kg/week (Aggressive)"})]})]}),Ae&&n.jsx("div",{className:"bg-cyan-50 rounded-xl p-3 border border-cyan-200",children:n.jsxs("p",{className:"text-sm text-cyan-900",children:[n.jsx("strong",{children:"Estimated time:"})," ",Ae," weeks (",Math.ceil(Ae/4)," months)"]})})]}),n.jsx("div",{className:"bg-cyan-50 rounded-xl p-4 border border-cyan-200",children:n.jsx("p",{className:"text-sm text-cyan-900 font-medium",children:"What happens next? We'll calculate your personalized daily calorie and macro goals based on your profile and goals. You can adjust these anytime from your nutrition dashboard."})}),n.jsx("button",{type:"submit",disabled:E,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700",children:E?n.jsx(dh,{className:"w-5 h-5 animate-spin"}):n.jsxs(n.Fragment,{children:["Create Account & Calculate Goals ",n.jsx(vo,{className:"w-5 h-5"})]})})]})]})})]})}return o===6?n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Zl,{className:"w-12 h-12"})})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Set Your Goals"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Define your target and we'll help you reach it with precision."}),n.jsx("p",{className:"text-sm text-white/70 mt-6",children:"Step 5 of 5"})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:n.jsxs("div",{className:"w-full max-w-md py-8",children:[n.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(ln,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Health Goals"}),n.jsx("p",{className:"text-cyan-700",children:"Step 5 of 5 - The finish line!"})]}),n.jsxs("form",{onSubmit:be,className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Primary Goal"}),n.jsxs("select",{value:m.primaryGoal,onChange:H=>g({...m,primaryGoal:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"weight_loss",className:"text-slate-900",children:"Weight Loss"}),n.jsx("option",{value:"weight_gain",className:"text-slate-900",children:"Weight Gain"}),n.jsx("option",{value:"maintain",className:"text-slate-900",children:"Maintain Weight"}),n.jsx("option",{value:"general_health",className:"text-slate-900",children:"General Health"}),n.jsx("option",{value:"diabetes_management",className:"text-slate-900",children:"Diabetes Management"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Target Weight (kg)"}),n.jsx("input",{type:"number",step:"0.1",value:m.targetWeight,onChange:H=>g({...m,targetWeight:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"65"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Weekly Goal (kg/week)"}),n.jsxs("select",{value:m.weeklyGoal,onChange:H=>g({...m,weeklyGoal:H.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"0.25",className:"text-slate-900",children:"0.25 kg (Steady)"}),n.jsx("option",{value:"0.5",className:"text-slate-900",children:"0.5 kg (Recommended)"}),n.jsx("option",{value:"1.0",className:"text-slate-900",children:"1.0 kg (Aggressive)"})]})]}),n.jsx("button",{type:"submit",disabled:E,className:"w-full py-3 text-white font-semibold rounded-xl bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 flex items-center justify-center gap-2 disabled:opacity-50",children:E?n.jsx(dh,{className:"w-5 h-5 animate-spin"}):n.jsxs(n.Fragment,{children:["Create Account ",n.jsx(vo,{className:"w-5 h-5"})]})})]})]})})]}):null}const cce=["General Physician","Cardiologist","Dermatologist","Endocrinologist","Gastroenterologist","Neurologist","Nutritionist","Oncologist","Orthopedic","Pediatrician","Psychiatrist","Pulmonologist"],y6=[{id:"license",name:"Medical License",description:"Valid medical license certificate"},{id:"degree",name:"Medical Degree",description:"MBBS/MD or equivalent degree certificate"},{id:"id_proof",name:"ID Proof",description:"Government issued ID (Aadhar/Passport)"}];function lce(){const{registerDoctor:a}=aa(),o=to(),[c,d]=te.useState(!1),[h,m]=te.useState(1),[g,x]=te.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",specialization:"",qualifications:"",experience:"",hospital:"",licenseNumber:"",consultationFee:"",bio:""}),[v,E]=te.useState({}),S=O=>{x({...g,[O.target.name]:O.target.value})},I=(O,F)=>{F&&E(M=>({...M,[O]:{file:F,name:F.name,size:(F.size/1024).toFixed(1)+" KB"}}))},k=O=>{E(F=>{const M={...F};return delete M[O],M})},R=async O=>{var M,Q;if(O.preventDefault(),g.password!==g.confirmPassword){Ct.error("Passwords do not match");return}const F=y6.filter(Z=>!v[Z.id]);if(F.length>0){Ct.error(`Please upload: ${F.map(Z=>Z.name).join(", ")}`);return}d(!0);try{const Z=Object.entries(v).map(([$,X])=>({name:X.name,type:$,url:`pending_upload_${$}`}));await a({...g,qualifications:g.qualifications.split(",").map($=>$.trim()).filter(Boolean),experience:parseInt(g.experience),consultationFee:parseInt(g.consultationFee)||500,documents:Z}),Ct.success("Registration successful! Your profile is pending approval."),o("/doctor/dashboard")}catch(Z){Ct.error(((Q=(M=Z.response)==null?void 0:M.data)==null?void 0:Q.message)||"Registration failed")}finally{d(!1)}};return n.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"w-full max-w-2xl",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsxs(Os,{to:"/",className:"inline-flex items-center gap-2 mb-6",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center",children:n.jsx(Cr,{className:"w-7 h-7 text-white"})}),n.jsx("span",{className:"text-2xl font-bold text-slate-800",children:"HealthAI"})]}),n.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Doctor Registration"}),n.jsx("p",{className:"text-slate-500",children:"Join our platform and connect with patients"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 shadow-sm",children:[n.jsx("div",{className:"flex items-center justify-center gap-4 mb-8",children:[1,2,3].map(O=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold ${h>=O?"bg-cyan-500 text-white":"bg-slate-200 text-slate-400"}`,children:O}),n.jsx("span",{className:`text-sm hidden sm:block ${h>=O?"text-cyan-600 font-medium":"text-slate-400"}`,children:O===1?"Account":O===2?"Professional":"Documents"}),O<3&&n.jsx("div",{className:`w-8 h-1 rounded ${h>O?"bg-cyan-500":"bg-slate-200"}`})]},O))}),n.jsxs("form",{onSubmit:R,children:[h===1&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),n.jsx("input",{type:"text",name:"name",value:g.name,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"Dr. John Smith",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),n.jsx("input",{type:"email",name:"email",value:g.email,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"doctor@example.com",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone"}),n.jsx("input",{type:"tel",name:"phone",value:g.phone,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"+91 98765 43210"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),n.jsx("input",{type:"password",name:"password",value:g.password,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0,minLength:6})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm Password"}),n.jsx("input",{type:"password",name:"confirmPassword",value:g.confirmPassword,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0})]})]}),n.jsx("button",{type:"button",onClick:()=>m(2),className:"w-full py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all mt-4",children:"Continue "})]}),h===2&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Specialization"}),n.jsxs("select",{name:"specialization",value:g.specialization,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:outline-none",required:!0,children:[n.jsx("option",{value:"",children:"Select specialization"}),cce.map(O=>n.jsx("option",{value:O,children:O},O))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Experience (years)"}),n.jsx("input",{type:"number",name:"experience",value:g.experience,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"5",required:!0,min:0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Medical License Number"}),n.jsx("input",{type:"text",name:"licenseNumber",value:g.licenseNumber,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MCI-12345",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Qualifications (comma separated)"}),n.jsx("input",{type:"text",name:"qualifications",value:g.qualifications,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MBBS, MD, FRCP"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Hospital/Clinic"}),n.jsx("input",{type:"text",name:"hospital",value:g.hospital,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"City Hospital"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consultation Fee ()"}),n.jsx("input",{type:"number",name:"consultationFee",value:g.consultationFee,onChange:S,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"500",min:0})]})]}),n.jsxs("div",{className:"flex gap-3 mt-4",children:[n.jsxs("button",{type:"button",onClick:()=>m(1),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[n.jsx(ln,{className:"w-4 h-4"})," Back"]}),n.jsx("button",{type:"button",onClick:()=>m(3),className:"flex-1 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:"Continue "})]})]}),h===3&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:n.jsxs("p",{className:"text-sm text-amber-800",children:[n.jsx("strong",{children:"Important:"})," Please upload clear copies of the following documents. These will be reviewed by our admin team before your profile is approved."]})}),y6.map(O=>n.jsxs("div",{className:"border border-slate-200 rounded-xl p-4",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"font-medium text-slate-800",children:[O.name," ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsx("p",{className:"text-sm text-slate-500",children:O.description})]}),v[O.id]?n.jsx(dn,{className:"w-5 h-5 text-green-500"}):null]}),v[O.id]?n.jsxs("div",{className:"mt-3 flex items-center justify-between bg-slate-50 rounded-lg p-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Bn,{className:"w-5 h-5 text-cyan-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-slate-700",children:v[O.id].name}),n.jsx("p",{className:"text-xs text-slate-500",children:v[O.id].size})]})]}),n.jsx("button",{type:"button",onClick:()=>k(O.id),className:"p-1 text-slate-400 hover:text-red-500",children:n.jsx(Yi,{className:"w-4 h-4"})})]}):n.jsxs("label",{className:"mt-3 flex items-center justify-center gap-2 p-4 border-2 border-dashed border-slate-200 rounded-lg cursor-pointer hover:border-cyan-500 hover:bg-cyan-50 transition-all",children:[n.jsx(il,{className:"w-5 h-5 text-slate-400"}),n.jsx("span",{className:"text-sm text-slate-500",children:"Click to upload"}),n.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:F=>I(O.id,F.target.files[0])})]})]},O.id)),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsxs("button",{type:"button",onClick:()=>m(2),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[n.jsx(ln,{className:"w-4 h-4"})," Back"]}),n.jsx("button",{type:"submit",disabled:c,className:"flex-1 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:c?"Submitting...":"Submit Application"})]})]})]}),n.jsxs("p",{className:"text-center text-slate-500 mt-6",children:["Already have an account? ",n.jsx(Os,{to:"/login",className:"text-cyan-600 hover:text-cyan-700 font-medium",children:"Sign in"})]})]}),n.jsxs("p",{className:"text-center text-sm text-slate-500 mt-6 flex items-center justify-center gap-2",children:[n.jsx(sQ,{className:"w-4 h-4"}),"Your profile will be reviewed by our admin team before being listed."]})]})})}const lH=te.createContext(),dH=()=>{const a=te.useContext(lH);if(!a)throw new Error("useData must be used within DataProvider");return a},dce=({children:a})=>{const[o,c]=te.useState(null),[d,h]=te.useState(null),[m,g]=te.useState(null),[x,v]=te.useState({dashboard:!1,wearable:!1,nutrition:!1}),E=te.useCallback(async(F=!1)=>{if(!F){const M=tl.get("dashboard");if(M)return c(M),M}v(M=>({...M,dashboard:!0}));try{const Q=(await ll.getDashboard()).data;return c(Q),tl.set("dashboard",Q,10*60*1e3),Q}catch(M){throw console.error("Failed to fetch dashboard:",M),M}finally{v(M=>({...M,dashboard:!1}))}},[]),S=te.useCallback(async(F=!1)=>{if(!F){const M=tl.get("wearable");if(M)return h(M),M}v(M=>({...M,wearable:!0}));try{const Q=(await ig.getDashboard()).data;return h(Q),tl.set("wearable",Q,2*60*1e3),Q}catch(M){console.error("Failed to fetch wearable:",M);const Q={connected:!1};return h(Q),Q}finally{v(M=>({...M,wearable:!1}))}},[]),I=te.useCallback(async(F,M=!1)=>{var Z;const Q=`nutrition_${F}`;if(!M){const $=tl.get(Q);if($)return g($),$}v($=>({...$,nutrition:!0}));try{const X=((Z=(await zQ.getDailySummary(F)).data)==null?void 0:Z.summary)||null;return g(X),X&&tl.set(Q,X,5*60*1e3),X}catch($){return console.error("Failed to fetch nutrition:",$),g(null),null}finally{v($=>({...$,nutrition:!1}))}},[]),k=te.useCallback(async(F=!1)=>{if(!F){const M=tl.get("diet_plan");if(M)return M}try{const M=localStorage.getItem("token"),Q=await fetch("/api/diet-recommendations/diet-plan/active",{headers:{Authorization:`Bearer ${M}`}});if(Q.status===404)return null;const Z=await Q.json();return Z.success&&Z.dietPlan?(tl.set("diet_plan",Z.dietPlan,15*60*1e3),Z.dietPlan):null}catch(M){return console.error("Failed to fetch diet plan:",M),null}},[]),R=te.useCallback((F=[])=>{F.length===0?(tl.clear(),c(null),h(null),g(null)):F.forEach(M=>{tl.delete(M),M==="dashboard"&&c(null),M==="wearable"&&h(null),M.startsWith("nutrition_")&&g(null)})},[]),O={dashboardData:o,wearableData:d,nutritionData:m,loading:x,fetchDashboard:E,fetchWearable:S,fetchNutrition:I,fetchDietPlan:k,invalidateCache:R};return n.jsx(lH.Provider,{value:O,children:a})},Ace="http://localhost:5000",uce=({bmi:a})=>{const[h,m]=te.useState(null),x=a<16?0:a>=40?180:(a-16)/24*180,v=[{start:0,end:30,color:"#ef4444",label:"Underweight",range:"< 18.5"},{start:30,end:82.5,color:"#22c55e",label:"Normal",range:"18.5 - 25"},{start:82.5,end:120,color:"#eab308",label:"Overweight",range:"25 - 30"},{start:120,end:157.5,color:"#f97316",label:"Obese",range:"30 - 35"},{start:157.5,end:180,color:"#dc2626",label:"Severely Obese",range:"> 35"}];return n.jsxs("div",{className:"relative flex items-center justify-center",children:[n.jsxs("svg",{width:200,height:200/2+20,className:"overflow-visible",children:[v.map((E,S)=>{const I=E.start-90,k=E.end-90,R=k-I>180?1:0,O=200/2+90*Math.cos(I*Math.PI/180),F=200/2+90*Math.sin(I*Math.PI/180),M=200/2+90*Math.cos(k*Math.PI/180),Q=200/2+90*Math.sin(k*Math.PI/180);return n.jsx("g",{children:n.jsx("path",{d:`M ${O} ${F} A 90 90 0 ${R} 1 ${M} ${Q}`,fill:"none",stroke:E.color,strokeWidth:20,strokeLinecap:"round",className:"cursor-pointer transition-opacity hover:opacity-80",onMouseEnter:()=>m(S),onMouseLeave:()=>m(null)})},S)}),n.jsxs("g",{transform:`rotate(${x-90} ${200/2} ${200/2})`,children:[n.jsx("line",{x1:200/2,y1:200/2,x2:200/2+90-10,y2:200/2,stroke:"#1e293b",strokeWidth:"3",strokeLinecap:"round"}),n.jsx("circle",{cx:200/2,cy:200/2,r:"8",fill:"#1e293b"})]}),n.jsx("text",{x:200/2,y:200/2+35,textAnchor:"middle",className:"text-3xl font-bold fill-slate-800",children:a.toFixed(1)}),n.jsx("text",{x:200/2,y:200/2+55,textAnchor:"middle",className:"text-xs fill-slate-500",children:"kg/m"})]}),h!==null&&n.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-full mb-2 px-3 py-2 bg-slate-800 text-white text-xs font-medium rounded-lg shadow-lg whitespace-nowrap z-10",children:[n.jsx("div",{className:"font-semibold",children:v[h].label}),n.jsxs("div",{className:"text-slate-300",children:["BMI: ",v[h].range]}),n.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-800"})]})]})},hce=({bmi:a})=>{const[h,m]=te.useState(null),x=a<16?0:a>=40?180:(a-16)/24*180,v=[{start:0,end:30,color:"#ef4444",label:"Underweight",range:"< 18.5"},{start:30,end:82.5,color:"#22c55e",label:"Normal",range:"18.5 - 25"},{start:82.5,end:120,color:"#eab308",label:"Overweight",range:"25 - 30"},{start:120,end:157.5,color:"#f97316",label:"Obese",range:"30 - 35"},{start:157.5,end:180,color:"#dc2626",label:"Severely Obese",range:"> 35"}];return n.jsxs("div",{className:"relative flex items-center justify-center",children:[n.jsxs("svg",{width:240,height:240/2+30,className:"overflow-visible",children:[v.map((E,S)=>{const I=E.start,k=E.end,R=0,O=240/2-109*Math.cos(I*Math.PI/180),F=240/2-109*Math.sin(I*Math.PI/180),M=240/2-109*Math.cos(k*Math.PI/180),Q=240/2-109*Math.sin(k*Math.PI/180);return n.jsx("g",{children:n.jsx("path",{d:`M ${O} ${F} A 109 109 0 ${R} 1 ${M} ${Q}`,fill:"none",stroke:E.color,strokeWidth:22,strokeLinecap:"round",className:"cursor-pointer transition-opacity active:opacity-80",onTouchStart:()=>m(S),onTouchEnd:()=>m(null),onMouseEnter:()=>m(S),onMouseLeave:()=>m(null)})},S)}),n.jsxs("g",{transform:`rotate(${x} ${240/2} ${240/2})`,children:[n.jsx("line",{x1:240/2,y1:240/2,x2:240/2-109+12,y2:240/2,stroke:"#1e293b",strokeWidth:"3",strokeLinecap:"round"}),n.jsx("circle",{cx:240/2,cy:240/2,r:"9",fill:"#1e293b"})]}),n.jsx("text",{x:240/2,y:240/2+25,textAnchor:"middle",className:"text-4xl font-bold fill-slate-800",children:a.toFixed(1)}),n.jsx("text",{x:240/2,y:240/2+45,textAnchor:"middle",className:"text-sm fill-slate-500 font-medium",children:"kg/m"})]}),h!==null&&n.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-800 text-white text-xs font-medium rounded-lg shadow-lg whitespace-nowrap z-10 animate-fade-in",children:[n.jsx("div",{className:"font-semibold",children:v[h].label}),n.jsxs("div",{className:"text-slate-300",children:["BMI: ",v[h].range]}),n.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-800"})]})]})},pce=({bmi:a})=>{const c=a<16?{label:"Severely Underweight",color:"bg-red-100 text-red-700 border-red-200",icon:Ln}:a<18.5?{label:"Underweight",color:"bg-red-50 text-red-600 border-red-200",icon:Ln}:a<25?{label:"Normal",color:"bg-green-100 text-green-700 border-green-200",icon:dn}:a<30?{label:"Overweight",color:"bg-yellow-100 text-yellow-700 border-yellow-200",icon:va}:a<35?{label:"Obese",color:"bg-orange-100 text-orange-700 border-orange-200",icon:va}:{label:"Severely Obese",color:"bg-red-100 text-red-700 border-red-200",icon:Ln},d=c.icon;return n.jsxs("div",{className:`flex items-center gap-1.5 lg:gap-2 px-3 lg:px-4 py-1.5 lg:py-2 rounded-full border-2 ${c.color} font-semibold text-xs lg:text-sm`,children:[n.jsx(d,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"}),c.label]})};function mce(){const{user:a}=aa(),[o,c]=te.useState(null),[d,h]=te.useState(null),[m,g]=te.useState(null),[x,v]=te.useState(null),[E,S]=te.useState(null);te.useEffect(()=>{I(),k()},[a]);const I=()=>{var be,me;const R=(be=a==null?void 0:a.profile)==null?void 0:be.height,O=(me=a==null?void 0:a.profile)==null?void 0:me.weight;if(!R||!O)return;const F=R/100,M=O/(F*F);c(M);const Q=M/25;h(Q);const Z=O/Math.pow(F,3);g(Z);const $=18.5*F*F,X=25*F*F;v({min:$.toFixed(1),max:X.toFixed(1)})},k=async()=>{var R;try{const O=localStorage.getItem("token"),{data:F}=await Hr.get(`${Ace}/api/auth/profile`,{headers:{Authorization:`Bearer ${O}`}});S((R=F.user)==null?void 0:R.nutritionGoal)}catch(O){console.error("Failed to fetch goal:",O)}};return o?n.jsx(n.Fragment,{children:n.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-orange-50 rounded-2xl border-2 border-cyan-200 p-4 lg:p-6 shadow-sm",children:n.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-3 lg:gap-6",children:[n.jsx("div",{className:"lg:hidden w-full flex justify-center",children:n.jsx(hce,{bmi:o})}),n.jsx("div",{className:"hidden lg:block flex-shrink-0",children:n.jsx(uce,{bmi:o})}),n.jsxs("div",{className:"flex-1 w-full space-y-2 lg:space-y-4 text-center lg:text-left",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2 justify-center lg:justify-start",children:[n.jsx("h3",{className:"hidden lg:block text-2xl font-bold text-slate-800",children:"Your BMI"}),n.jsx(pce,{bmi:o})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 lg:gap-3",children:[n.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-2 lg:p-3 border border-slate-200",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-600 mb-0.5 lg:mb-1",children:"Healthy BMI"}),n.jsx("p",{className:"text-xs lg:text-sm font-bold text-slate-800",children:"18.5 - 25"})]}),n.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-2 lg:p-3 border border-slate-200",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-600 mb-0.5 lg:mb-1",children:"Healthy Weight"}),n.jsxs("p",{className:"text-xs lg:text-sm font-bold text-slate-800",children:[x==null?void 0:x.min," - ",x==null?void 0:x.max," kg"]})]}),n.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-2 lg:p-3 border border-slate-200",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-600 mb-0.5 lg:mb-1",children:"BMI Prime"}),n.jsx("p",{className:"text-xs lg:text-sm font-bold text-slate-800",children:d==null?void 0:d.toFixed(2)})]}),n.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-2 lg:p-3 border border-slate-200",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-600 mb-0.5 lg:mb-1",children:"Ponderal Index"}),n.jsxs("p",{className:"text-xs lg:text-sm font-bold text-slate-800",children:[m==null?void 0:m.toFixed(1)," kg/m"]})]})]}),E!=null&&E.goal?n.jsx("div",{className:"bg-white rounded-lg lg:rounded-xl p-2.5 lg:p-4 border-2 border-cyan-200",children:n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 lg:gap-3",children:[n.jsxs("div",{className:"text-center sm:text-left",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-600 mb-0.5 lg:mb-1",children:"Current Goal"}),n.jsxs("p",{className:"text-xs lg:text-sm font-bold text-slate-800 capitalize",children:[E.goal.replace("_"," "),E.targetWeight&&` - ${E.targetWeight} kg`]})]}),n.jsx(Os,{to:"/profile?tab=goals",className:"px-3 py-1.5 lg:px-4 lg:py-2 bg-cyan-500 text-white rounded-lg text-xs lg:text-sm font-medium hover:bg-cyan-600 transition-colors whitespace-nowrap",children:"Change"})]})}):n.jsxs(Os,{to:"/profile?tab=goals",className:"w-full py-2 lg:py-3 bg-cyan-500 text-white rounded-lg lg:rounded-xl font-semibold hover:bg-cyan-600 transition-colors flex items-center justify-center gap-2 text-sm lg:text-base",children:[n.jsx(Zl,{className:"w-4 h-4 lg:w-5 lg:h-5"}),"Set Your Goal"]})]})]})})}):n.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-orange-50 rounded-2xl border-2 border-cyan-200 p-6",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Zl,{className:"w-12 h-12 text-cyan-500 mx-auto mb-3"}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"Complete Your Profile"}),n.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Add your height and weight to see your BMI and get personalized recommendations"}),n.jsx("a",{href:"/profile",className:"inline-block px-6 py-2 bg-cyan-500 text-white rounded-xl font-medium hover:bg-cyan-600 transition-colors",children:"Update Profile"})]})})}function fce({isOpen:a,onClose:o}){const[c,d]=te.useState(!1),[h,m]=te.useState(null),[g,x]=te.useState(0),[v,E]=te.useState([]),[S,I]=te.useState(!1),[k,R]=te.useState(""),[O,F]=te.useState(""),[M,Q]=te.useState(new Date),[Z,$]=te.useState(localStorage.getItem("usual_sleep_time")||"22:00"),[X,be]=te.useState(localStorage.getItem("usual_wakeup_time")||"06:00");te.useEffect(()=>{const ee=localStorage.getItem("sleep_tracking"),Be=localStorage.getItem("sleep_history");if(ee){const He=JSON.parse(ee);if(d(He.isTracking),m(He.startTime?new Date(He.startTime):null),He.isTracking&&He.startTime){const Ue=Date.now()-new Date(He.startTime).getTime();x(Ue)}}Be&&E(JSON.parse(Be))},[]),te.useEffect(()=>{let ee;return c&&h&&(ee=setInterval(()=>{const Be=Date.now()-h.getTime();x(Be)},1e3)),()=>clearInterval(ee)},[c,h]);const me=ee=>{const Be=Math.floor(ee/1e3),He=Math.floor(Be/3600),Ue=Math.floor(Be%3600/60);return{hours:He,minutes:Ue}},Ne=()=>{const ee=new Date;d(!0),m(ee),x(0),localStorage.setItem("sleep_tracking",JSON.stringify({isTracking:!0,startTime:ee.toISOString()})),Ct.success("Sleep tracking started ")},le=()=>{if(!h)return;const ee=new Date,Be=ee.getTime()-h.getTime(),{hours:He,minutes:Ue}=me(Be),ve=[{id:Date.now(),date:h.toISOString(),startTime:h.toISOString(),endTime:ee.toISOString(),duration:Be,hours:He,minutes:Ue,quality:H(He)},...v].slice(0,7);E(ve),localStorage.setItem("sleep_history",JSON.stringify(ve)),d(!1),m(null),x(0),localStorage.removeItem("sleep_tracking"),Ct.success(`Sleep recorded: ${He}h ${Ue}m `)},H=ee=>ee>=7&&ee<=9?85+Math.floor(Math.random()*15):ee>=6&&ee<7?70+Math.floor(Math.random()*15):ee>=5&&ee<6?55+Math.floor(Math.random()*15):40+Math.floor(Math.random()*15),Ae=()=>{const ee=parseInt(k)||0,Be=parseInt(O)||0;if(ee===0&&Be===0){Ct.error("Please enter valid time");return}const He=(ee*3600+Be*60)*1e3,Ue=new Date(M),re=new Date(Ue.getTime()-He),fe=[{id:Date.now(),date:M.toISOString(),startTime:re.toISOString(),endTime:Ue.toISOString(),duration:He,hours:ee,minutes:Be,quality:H(ee),manual:!0},...v].slice(0,7);E(fe),localStorage.setItem("sleep_history",JSON.stringify(fe)),I(!1),R(""),F(""),Ct.success("Sleep data saved manually ")},J=(ee,Be)=>{$(ee),be(Be),localStorage.setItem("usual_sleep_time",ee),localStorage.setItem("usual_wakeup_time",Be)},Y=()=>{const ee=new Date().toDateString();return v.find(Be=>new Date(Be.date).toDateString()===ee)},se=()=>{const ee=[];for(let Be=6;Be>=0;Be--){const He=new Date;He.setDate(He.getDate()-Be),ee.push(He)}return ee},{hours:oe,minutes:Te}=me(g),he=Y(),Ce=se();return a?n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-3xl w-full max-w-md max-h-[90vh] pb-24 md:pb-0 flex flex-col shadow-2xl border border-slate-700",children:[n.jsxs("div",{className:"flex-shrink-0 bg-slate-900/95 backdrop-blur-sm p-4 border-b border-slate-700 flex items-center justify-between rounded-t-3xl",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center",children:n.jsx(ix,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-lg font-bold text-white",children:"Sleep Tracker"}),n.jsx("p",{className:"text-xs text-slate-400",children:"Track your sleep quality"})]})]}),n.jsx("button",{onClick:o,className:"p-2 hover:bg-slate-800 rounded-full transition",children:n.jsx(Yi,{className:"w-5 h-5 text-slate-400"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",children:[n.jsxs("div",{className:"p-3 sm:p-4 border-b border-slate-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-xl sm:text-2xl font-bold text-white truncate",children:new Date().toLocaleDateString("en-US",{weekday:"long"})}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:new Date().toLocaleDateString("en-US",{day:"numeric",month:"long"})})]}),n.jsx("button",{onClick:()=>I(!S),className:"p-2 hover:bg-slate-800 rounded-lg transition flex-shrink-0",children:n.jsx(Ti,{className:"w-4 h-4 sm:w-5 sm:h-5 text-slate-400"})})]}),n.jsx("div",{className:"flex justify-between gap-1.5 sm:gap-2",children:Ce.map((ee,Be)=>{const He=v.find(re=>new Date(re.date).toDateString()===ee.toDateString()),Ue=ee.toDateString()===new Date().toDateString();return n.jsx("div",{className:`flex-1 text-center ${Ue?"opacity-100":"opacity-60"}`,children:n.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 mx-auto rounded-full flex items-center justify-center mb-1 ${He?"bg-gradient-to-br from-purple-500 to-orange-600 ring-2 ring-orange-400/30":"bg-slate-800"} ${Ue?"ring-2 ring-white/30":""}`,children:n.jsx("span",{className:"text-[10px] sm:text-xs font-medium text-white",children:ee.toLocaleDateString("en-US",{weekday:"short"})[0]})})},Be)})}),n.jsxs("div",{className:"mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-slate-700/50",children:[n.jsx("p",{className:"text-xs text-slate-400 mb-3 font-medium",children:"Weekly Sleep Pattern"}),n.jsx("div",{className:"flex items-end justify-between gap-1.5 sm:gap-2 h-24",children:Ce.map((ee,Be)=>{const He=v.find(ve=>new Date(ve.date).toDateString()===ee.toDateString()),Ue=(He==null?void 0:He.hours)||0,re=Ue>0?Math.max(Math.min(Ue/10*100,100),10):0;return n.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 min-w-[10px]",children:[n.jsx("div",{className:"w-full bg-slate-800 rounded-t-lg overflow-hidden relative",style:{height:"80px"},children:re>0&&n.jsx("div",{className:"absolute bottom-0 w-full bg-gradient-to-t from-purple-500 to-orange-400 rounded-t-lg transition-all duration-700 ease-out",style:{height:`${re}%`},children:n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent to-white/20"})})}),n.jsx("span",{className:"text-[9px] sm:text-[10px] text-slate-500 font-medium",children:ee.toLocaleDateString("en-US",{weekday:"short"})[0]})]},Be)})})]}),n.jsxs("div",{className:"p-3 sm:p-4 border-b border-slate-700/50",children:[n.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:"Sleep Preferences"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-2xl border border-slate-700",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2",children:"Usual Sleep"}),n.jsx("input",{type:"time",value:Z,onChange:ee=>J(ee.target.value,X),className:"bg-transparent text-white text-sm font-bold outline-none w-full"})]}),n.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-2xl border border-slate-700",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2",children:"Usual Wakeup"}),n.jsx("input",{type:"time",value:X,onChange:ee=>J(Z,ee.target.value),className:"bg-transparent text-white text-sm font-bold outline-none w-full"})]})]})]})]}),n.jsxs("div",{className:"p-3 sm:p-6",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4 sm:mb-6",children:[n.jsxs("div",{className:"relative w-24 h-24 sm:w-32 sm:h-32 flex-shrink-0",children:[n.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[n.jsx("circle",{cx:"48",cy:"48",r:"42",stroke:"#1e293b",strokeWidth:"10",fill:"none",className:"sm:hidden"}),n.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#1e293b",strokeWidth:"12",fill:"none",className:"hidden sm:block"}),n.jsx("circle",{cx:"48",cy:"48",r:"42",stroke:"url(#gradient)",strokeWidth:"10",fill:"none",strokeDasharray:`${((he==null?void 0:he.quality)||0)*2.64} 264`,strokeLinecap:"round",className:"transition-all duration-1000 sm:hidden"}),n.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"url(#gradient)",strokeWidth:"12",fill:"none",strokeDasharray:`${((he==null?void 0:he.quality)||0)*3.51} 351`,strokeLinecap:"round",className:"transition-all duration-1000 hidden sm:block"}),n.jsx("defs",{children:n.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",stopColor:"#f97316"}),n.jsx("stop",{offset:"100%",stopColor:"#fb923c"})]})})]}),n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[n.jsxs("span",{className:"text-2xl sm:text-3xl font-bold text-white",children:[(he==null?void 0:he.quality)||0,"%"]}),n.jsx("span",{className:"text-xs text-slate-400",children:"Quality"})]})]}),n.jsx("div",{className:"flex-1 min-w-0",children:n.jsxs("div",{className:"text-center sm:text-left",children:[n.jsx("span",{className:"text-2xl sm:text-3xl font-bold text-white block",children:c?`${oe}h ${Te}m`:he?`${he.hours}h ${he.minutes}m`:"0h 0m"}),n.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Time in bed"})]})})]}),S?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"bg-slate-800 rounded-2xl p-4",children:[n.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Enter sleep duration"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("input",{type:"number",value:k,onChange:ee=>R(ee.target.value),placeholder:"0",className:"w-full px-4 py-3 bg-slate-700 text-white placeholder-slate-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 text-center text-lg font-semibold",min:"0",max:"24"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1 text-center",children:"Hours"})]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("input",{type:"number",value:O,onChange:ee=>F(ee.target.value),placeholder:"0",className:"w-full px-4 py-3 bg-slate-700 text-white placeholder-slate-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 text-center text-lg font-semibold",min:"0",max:"59"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1 text-center",children:"Minutes"})]})]})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:Ae,className:"flex-1 py-3 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 text-white rounded-2xl font-semibold flex items-center justify-center gap-2 transition",children:[n.jsx(eh,{className:"w-4 h-4"}),"Save"]}),n.jsx("button",{onClick:()=>{I(!1),R(""),F("")},className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-2xl font-medium transition",children:"Cancel"})]})]}):n.jsx("div",{className:"space-y-2",children:c?n.jsxs("button",{onClick:le,className:"w-full py-3 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 text-white rounded-xl font-semibold flex items-center justify-center gap-2 transition shadow-lg animate-pulse text-sm",children:[n.jsx(Qre,{className:"w-4 h-4"}),"Stop & Save Sleep"]}):n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:Ne,className:"flex-1 py-2.5 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 text-white rounded-xl font-semibold flex items-center justify-center gap-1.5 transition shadow-lg text-xs",children:[n.jsx(Vre,{className:"w-3.5 h-3.5"}),"Start Sleep"]}),n.jsxs("button",{onClick:()=>I(!0),className:"flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-medium flex items-center justify-center gap-1.5 transition text-xs",children:[n.jsx(rQ,{className:"w-3.5 h-3.5"}),"Manual Edit"]})]})}),v.length>0&&n.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-700",children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-400 mb-3",children:"Recent Sleep History"}),n.jsx("div",{className:"space-y-2",children:v.slice(0,3).map(ee=>n.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-white",children:new Date(ee.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),n.jsxs("p",{className:"text-xs text-slate-400",children:[ee.hours,"h ",ee.minutes,"m ",ee.manual&&"(Manual)"]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"text-lg font-bold text-orange-400",children:[ee.quality,"%"]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Quality"})]})]},ee.id))})]})]})]})]})}):null}function gce(){var ee,Be,He,Ue,re,ve,fe,Ie,je,Ee,We,ze,st,bt,Qe,rt,Nt,we,Rt,Fe,et,$e,Kt,qt,Xe,ht,dt,Dt,ss,$t,ls,Zt,Rs,es,Zs;const{user:a}=aa(),o=to(),{dashboardData:c,loading:d,fetchDashboard:h,fetchNutrition:m,nutritionData:g,fetchDietPlan:x}=dH(),[v,E]=te.useState(0),[S,I]=te.useState(!c),[k,R]=te.useState(null),[O,F]=te.useState(!1),[M,Q]=te.useState(""),[Z,$]=te.useState(!1),[X,be]=te.useState(new Date),[me,Ne]=te.useState(null),le=()=>{const pt=new Date(X);pt.setDate(pt.getDate()-1),be(pt)},H=()=>{const pt=new Date(X);pt.setDate(pt.getDate()+1),be(pt)},Ae=()=>{const pt=new Date().getHours();return pt<12?"Morning":pt<18?"Afternoon":"Evening"},J=pt=>{pt.preventDefault(),M.trim()&&o("/ai-chat",{state:{initialQuery:M}})};if(te.useEffect(()=>{(async()=>{const[Ut,zt]=await Promise.all([h(),x()]);zt&&Ne(zt),I(!1)})()},[h,x]),te.useEffect(()=>{const pt=X.toISOString().split("T")[0];m(pt)},[X,m]),te.useEffect(()=>{!c&&!d.dashboard&&!S&&h()},[c,d.dashboard,h,S]),te.useEffect(()=>{var pt;if(((pt=c==null?void 0:c.recentReports)==null?void 0:pt.length)>0&&!k){const Ut=c.recentReports.find(zt=>{var rs;return(rs=zt.aiAnalysis)==null?void 0:rs.metrics});if(Ut){const zt=Object.keys(Ut.aiAnalysis.metrics)[0];zt&&R(zt)}}},[c,k]),te.useEffect(()=>{const pt=()=>{!document.hidden&&c&&h(!0)};return document.addEventListener("visibilitychange",pt),()=>document.removeEventListener("visibilitychange",pt)},[h,c]),te.useEffect(()=>{var pt,Ut,zt;if(c){let rs=0;const Ht=4;(pt=a==null?void 0:a.profile)!=null&&pt.age&&((Ut=a==null?void 0:a.profile)!=null&&Ut.gender)&&rs++,((zt=c.recentReports)==null?void 0:zt.length)>0&&rs++,c.nutritionTracked&&rs++,c.wearableConnected&&rs++;const vt=Math.round(rs/Ht*100);setTimeout(()=>E(vt),300)}},[c,a]),S&&d.dashboard&&!c)return n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-600",children:"Loading your health dashboard..."})]})});const Y=((ee=c==null?void 0:c.recentReports)==null?void 0:ee.length)>0;(Be=a==null?void 0:a.profile)!=null&&Be.age&&((He=a==null?void 0:a.profile)==null||He.gender),c==null||c.nutritionTracked,c==null||c.wearableConnected;const se=((re=(Ue=c==null?void 0:c.user)==null?void 0:Ue.healthMetrics)==null?void 0:re.healthScore)||((ve=c==null?void 0:c.latestAnalysis)==null?void 0:ve.healthScore),oe={};c!=null&&c.recentReports&&c.recentReports.forEach(pt=>{var Ut;(Ut=pt.aiAnalysis)!=null&&Ut.metrics&&Object.entries(pt.aiAnalysis.metrics).forEach(([zt,rs])=>{oe[zt]||(oe[zt]={name:zt.replace(/([A-Z])/g," $1").trim(),unit:rs.unit||"",history:[]})})}),Object.keys(oe).forEach(pt=>{var Ut;(Ut=c==null?void 0:c.recentReports)==null||Ut.forEach(zt=>{var Ht,vt;const rs=(vt=(Ht=zt.aiAnalysis)==null?void 0:Ht.metrics)==null?void 0:vt[pt];rs&&oe[pt].history.push({date:new Date(zt.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"}),value:parseFloat(rs.value)||0,fullDate:new Date(zt.createdAt)})}),oe[pt].history.sort((zt,rs)=>zt.fullDate-rs.fullDate)});const Te=Object.keys(oe),he=k||Te[0],Ce=oe[he];return n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-100",children:[d.dashboard&&c&&n.jsxs("div",{className:"fixed top-20 right-4 z-50 bg-white rounded-full shadow-lg px-4 py-2 flex items-center gap-2 animate-slide-in-right",children:[n.jsx("div",{className:"w-4 h-4 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"}),n.jsx("span",{className:"text-sm text-slate-600",children:"Refreshing..."})]}),n.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 animate-fade-in pb-20 px-0 md:px-4",children:[n.jsxs("div",{className:"pt-4 space-y-3 md:hidden px-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-lg font-bold shadow-md",children:((Ie=(fe=a==null?void 0:a.name)==null?void 0:fe[0])==null?void 0:Ie.toUpperCase())||"U"}),n.jsxs("div",{children:[n.jsxs("h1",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[Ae(),", ",n.jsxs("span",{className:"text-slate-900",children:[((je=a==null?void 0:a.name)==null?void 0:je.split(" ")[0])||"there","!"]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[n.jsxs("span",{className:"font-semibold",children:[((Ee=c==null?void 0:c.nutritionData)==null?void 0:Ee.totalCalories)||0," cal"]}),n.jsx("span",{className:"text-slate-400",children:"."}),n.jsxs("span",{className:"font-semibold text-emerald-600",children:[((ze=(We=c==null?void 0:c.user)==null?void 0:We.healthMetrics)==null?void 0:ze.healthScore)||82,"% Healthy"]})]})]})]}),n.jsx("button",{className:"w-10 h-10 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all",children:n.jsx(WA,{className:"w-5 h-5 text-slate-700"})})]}),n.jsx("form",{onSubmit:J,className:"relative",children:n.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-full px-4 py-2.5 shadow-md border-2 border-purple-200 hover:border-purple-300 transition-all",children:[n.jsx(HA,{className:"w-4 h-4 text-purple-500 flex-shrink-0"}),n.jsx("input",{type:"text",placeholder:"Ask coach",value:M,onChange:pt=>Q(pt.target.value),className:"flex-1 bg-transparent outline-none text-sm text-slate-700 placeholder-slate-400"}),n.jsx("button",{type:"submit",className:"w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center hover:bg-purple-600 transition-all flex-shrink-0",children:n.jsx(W3,{className:"w-4 h-4 text-white"})})]})})]}),n.jsxs("div",{className:"pt-4 space-y-3 hidden md:block px-3 md:px-0",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-lg font-bold shadow-md",children:((bt=(st=a==null?void 0:a.name)==null?void 0:st[0])==null?void 0:bt.toUpperCase())||"U"}),n.jsxs("div",{children:[n.jsxs("h1",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[Ae(),", ",n.jsxs("span",{className:"text-slate-900",children:[((Qe=a==null?void 0:a.name)==null?void 0:Qe.split(" ")[0])||"there","!"]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[n.jsxs("span",{className:"font-semibold",children:[((rt=c==null?void 0:c.nutritionData)==null?void 0:rt.totalCalories)||0," cal"]}),n.jsx("span",{className:"text-slate-400",children:"."}),n.jsxs("span",{className:"font-semibold text-emerald-600",children:[((we=(Nt=c==null?void 0:c.user)==null?void 0:Nt.healthMetrics)==null?void 0:we.healthScore)||82,"% Healthy"]})]})]})]}),n.jsx("button",{className:"w-10 h-10 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all",children:n.jsx(WA,{className:"w-5 h-5 text-slate-700"})})]}),n.jsx("form",{onSubmit:J,className:"relative",children:n.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-full px-4 py-2.5 shadow-md border-2 border-purple-200 hover:border-purple-300 transition-all",children:[n.jsx(HA,{className:"w-4 h-4 text-purple-500 flex-shrink-0"}),n.jsx("input",{type:"text",placeholder:"Ask coach",value:M,onChange:pt=>Q(pt.target.value),className:"flex-1 bg-transparent outline-none text-sm text-slate-700 placeholder-slate-400"}),n.jsx("button",{type:"submit",className:"w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center hover:bg-purple-600 transition-all flex-shrink-0",children:n.jsx(W3,{className:"w-4 h-4 text-white"})})]})})]}),n.jsx("div",{className:"px-3 md:px-0 mb-6",children:n.jsxs("div",{className:"bg-[#E2D5FF] rounded-[2.5rem] p-5 shadow-xl shadow-indigo-200/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6 px-2",children:[n.jsx("button",{onClick:le,className:"w-8 h-8 rounded-full bg-white/40 flex items-center justify-center text-indigo-900 transition-colors hover:bg-white",children:n.jsx(ln,{className:"w-4 h-4"})}),n.jsxs("h2",{className:"text-sm sm:text-base font-black text-indigo-950 flex items-center gap-2",children:[X.toDateString()===new Date().toDateString()?"Today, ":"",X.toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"})]}),n.jsx("button",{onClick:H,className:"w-8 h-8 rounded-full bg-white/40 flex items-center justify-center text-indigo-900 transition-colors hover:bg-white rotate-180",children:n.jsx(ln,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"flex justify-between items-end gap-1 overflow-x-auto pb-2 scrollbar-hide",children:(()=>{const pt=["Su","Mo","Tu","We","Th","Fr","Sa"],Ut=[],zt=new Date(X);zt.setDate(zt.getDate()-3);for(let rs=0;rs<7;rs++){const Ht=new Date(zt);Ht.setDate(Ht.getDate()+rs),Ut.push({label:pt[Ht.getDay()],date:Ht.getDate(),fullDate:Ht,isToday:Ht.toDateString()===new Date().toDateString()})}return Ut.map((rs,Ht)=>{var wa,Qi;const vt=rs.isToday,jt=X.toDateString()===rs.fullDate.toDateString();let ps=0;const Qs=rs.fullDate.toDateString(),Is=jt?g:null,ms=Is!=null&&Is.totalCalories&&(Is!=null&&Is.calorieGoal)?Math.min(Is.totalCalories/Is.calorieGoal*100,100):0,Ws=((Qi=(wa=c==null?void 0:c.user)==null?void 0:wa.challengeData)==null?void 0:Qi[rs.date])||{},qr=Object.values(Ws).filter(Boolean).length/4*100,Xi=JSON.parse(localStorage.getItem("sleep_history")||"[]").find(fi=>new Date(fi.date).toDateString()===Qs);let Ds=0;if(Xi){const fi=parseInt(Xi.hours)*60+parseInt(Xi.minutes);Ds=Math.min(fi/480*100,100)}const An=ms>0?100:0;return jt?ps=Math.round(ms*.3+Ds*.2+qr*.3+An*.2):(ps=qr,Ds>0&&(ps=Math.round(ps*.6+Ds*.4)),ps===0&&rs.fullDate<new Date&&(ps=rs.date%3===0?100:rs.date%2===0?60:30)),n.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[45px] cursor-pointer",onClick:()=>be(rs.fullDate),children:[n.jsx("span",{className:`text-[10px] font-black uppercase tracking-tighter transition-colors ${jt?"text-indigo-800":"text-slate-500"}`,children:rs.label}),n.jsxs("div",{className:`w-12 h-12 rounded-full flex items-center justify-center relative transition-all ${jt?"bg-white shadow-xl scale-110 ring-2 ring-indigo-300":"bg-white/30 hover:bg-white/50"}`,children:[n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",viewBox:"0 0 48 48",children:[n.jsx("circle",{cx:"24",cy:"24",r:"21",fill:"none",stroke:jt?"#F1F5F9":"rgba(255,255,255,0.2)",strokeWidth:"3"}),n.jsx("circle",{cx:"24",cy:"24",r:"21",fill:"none",stroke:"#818CF8",strokeWidth:"3",strokeDasharray:`${ps/100*132} 132`,strokeLinecap:"round",className:"transition-all duration-1000"})]}),vt?n.jsx(Jl,{className:`w-5 h-5 ${jt?"text-orange-500 fill-orange-500":"text-orange-400"}`}):null]}),n.jsx("span",{className:`text-[11px] font-black ${jt?"text-indigo-900 scale-110":"text-slate-600"}`,children:rs.date})]},Ht)})})()})]})}),n.jsx(fce,{isOpen:Z,onClose:()=>$(!1)}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-6 px-3 md:px-0",children:[n.jsxs(Os,{to:"/nutrition",className:"card card-gradient p-4 sm:p-6 group relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsxs("div",{className:"flex items-center justify-between mb-3 relative z-10",children:[n.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-white/30 backdrop-blur-md flex items-center justify-center group-hover:rotate-12 transition-transform shadow-inner",children:n.jsx(Jl,{className:"w-6 h-6 sm:w-7 sm:h-7 text-orange-600"})}),(g==null?void 0:g.averageHealthScore)>0&&n.jsxs("div",{className:`px-2 py-1 rounded-lg text-[10px] font-black shadow-lg flex flex-col items-center justify-center min-w-[36px] ${g.averageHealthScore>=80?"bg-emerald-500 text-white":g.averageHealthScore>=60?"bg-amber-500 text-white":"bg-rose-500 text-white"}`,children:[n.jsx("span",{className:"leading-none",children:Math.round(g.averageHealthScore)}),n.jsx("span",{className:"text-[6px] opacity-80 tracking-tighter uppercase font-black",children:"Score"})]})]}),n.jsx("h3",{className:"text-slate-700 text-[10px] sm:text-xs font-black mb-1 uppercase tracking-[0.15em] relative z-10",children:"Nutrition"}),n.jsxs("p",{className:"text-2xl sm:text-3xl font-black text-slate-900 mb-1 relative z-10",children:[(g==null?void 0:g.totalCalories)||0," ",n.jsx("span",{className:"text-base sm:text-lg opacity-60 font-medium",children:"kcal"})]}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-600 font-bold relative z-10",children:g!=null&&g.calorieGoal?`${Math.round(g.totalCalories/g.calorieGoal*100)}% Goal`:"Track your meals"})]}),n.jsxs("button",{onClick:()=>$(!0),className:"card p-4 sm:p-6 group relative overflow-hidden text-left",children:[n.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-indigo-500/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsx("div",{className:"flex items-center justify-between mb-3 relative z-10",children:n.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-indigo-50 flex items-center justify-center group-hover:rotate-12 transition-transform shadow-inner",children:n.jsx(ix,{className:"w-6 h-6 sm:w-7 sm:h-7 text-indigo-500"})})}),n.jsx("h3",{className:"text-slate-500 text-[10px] sm:text-xs font-black mb-1 uppercase tracking-[0.15em] relative z-10",children:"Sleep"}),n.jsx("p",{className:"text-2xl sm:text-3xl font-black text-slate-800 mb-1 relative z-10",children:(()=>{const pt=JSON.parse(localStorage.getItem("sleep_history")||"[]"),Ut=X.toDateString(),zt=pt.find(rs=>new Date(rs.date).toDateString()===Ut);return zt?`${zt.hours}h ${zt.minutes}m`:"0h 0m"})()}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-bold relative z-10",children:(()=>{const pt=JSON.parse(localStorage.getItem("sleep_history")||"[]"),Ut=X.toDateString(),zt=pt.find(rs=>new Date(rs.date).toDateString()===Ut);if(zt){const rs=zt.hours*60+zt.minutes;return`${Math.round(rs/480*100)}% Efficiency`}return"Track your sleep"})()})]}),n.jsxs(Os,{to:"/diet-plan",className:"card p-4 sm:p-6 group relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-orange-500/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsx("div",{className:"flex items-center justify-between mb-3 relative z-10",children:n.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-orange-50 flex items-center justify-center group-hover:rotate-12 transition-transform shadow-inner",children:n.jsx(nx,{className:"w-6 h-6 sm:w-7 sm:h-7 text-orange-500"})})}),n.jsx("h3",{className:"text-slate-500 text-[10px] sm:text-xs font-black mb-1 uppercase tracking-[0.15em] relative z-10",children:"Diet Plan"}),n.jsx("p",{className:"text-base sm:text-lg font-black text-slate-800 mb-1 relative z-10 leading-tight",children:(()=>{if(!me)return"No active plan";const pt=new Date().getHours();return pt<9?n.jsxs(n.Fragment,{children:["Upcoming ",n.jsx("br",{})," Breakfast"]}):pt>=9&&pt<14?n.jsxs(n.Fragment,{children:["Upcoming ",n.jsx("br",{})," Lunch"]}):pt>=14&&pt<17?n.jsxs(n.Fragment,{children:["Upcoming ",n.jsx("br",{})," Snacks"]}):n.jsxs(n.Fragment,{children:["Upcoming ",n.jsx("br",{})," Dinner"]})})()}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-bold relative z-10",children:me?"Your personalized meal plan":"Tap to generate"})]}),n.jsxs(Os,{to:"/challenge",className:"card p-4 sm:p-6 group relative overflow-hidden",style:{background:"linear-gradient(135deg, #ede9fe 0%, #fce7f3 50%, #fff1eb 100%)"},children:[n.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-purple-500/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsx("div",{className:"flex items-center justify-between mb-3 relative z-10",children:n.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl flex items-center justify-center group-hover:rotate-12 transition-transform shadow-inner",style:{background:"linear-gradient(135deg, #c084fc, #fb923c)"},children:n.jsx(Hre,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white"})})}),n.jsx("h3",{className:"text-slate-500 text-[10px] sm:text-xs font-black mb-1 uppercase tracking-[0.15em] relative z-10",children:"Mind"}),n.jsxs("p",{className:"text-2xl sm:text-3xl font-black text-slate-800 mb-1 relative z-10",children:[(c==null?void 0:c.streakDays)||(a==null?void 0:a.challengeStreak)||0," ",n.jsx("span",{className:"text-base sm:text-lg opacity-60 font-medium",children:"days"})]}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 font-bold relative z-10",children:"Daily Streak"})]})]}),n.jsxs(Os,{to:"/glucose-log",className:"block bg-gradient-to-br from-[#e8f0fe] via-[#edf3ff] to-[#f0f4ff] rounded-3xl shadow-md p-5 sm:p-6 hover:shadow-xl transition-all group relative overflow-hidden border border-blue-100 mx-3 md:mx-0",children:[n.jsx("div",{className:"absolute bottom-2 right-2 opacity-[0.06] pointer-events-none",children:n.jsx(Fb,{className:"w-28 h-28 text-blue-500"})}),n.jsxs("div",{className:"relative z-10",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center shadow-md",children:n.jsx(Fb,{className:"w-5 h-5 text-white"})}),n.jsx("span",{className:"text-sm font-bold text-slate-700 uppercase tracking-wider",children:"Diabetes Management"})]}),n.jsx("span",{className:"px-3 py-1 bg-emerald-500 text-white rounded-full text-[11px] font-bold shadow-sm tracking-wide",children:"IN RANGE"})]}),n.jsxs("div",{className:"flex items-baseline gap-2 mb-1.5",children:[n.jsx("span",{className:"text-4xl sm:text-5xl font-extrabold text-slate-800",children:(()=>{const pt=JSON.parse(localStorage.getItem("glucoseData")||"[]");return pt.length>0?pt[0].value:108})()}),n.jsx("span",{className:"text-sm text-slate-400 font-semibold tracking-wide",children:"MG/DL"})]}),n.jsx("p",{className:"text-slate-500 text-sm mb-4 leading-relaxed",children:"Your fasting glucose is stable. Tap to log your next reading or view progress."}),n.jsxs("div",{className:"flex items-center gap-1.5 text-blue-600 font-bold text-sm group-hover:gap-3 transition-all",children:[n.jsx("span",{children:"OPEN CARE CENTER"}),n.jsx(Pp,{className:"w-4 h-4"})]})]})]}),Y&&n.jsxs("div",{className:"space-y-6 mx-3 md:mx-0",children:[n.jsxs("div",{className:"bg-gradient-to-br from-[#4F46E5] via-[#6366F1] to-[#818CF8] rounded-[2.5rem] p-8 shadow-xl relative overflow-hidden group",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl pointer-events-none"}),n.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-indigo-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl pointer-events-none"}),n.jsx(HA,{className:"absolute top-8 right-12 w-16 h-16 text-white/10 group-hover:scale-110 transition-transform duration-500"}),n.jsxs("div",{className:"relative z-10",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[n.jsx(HA,{className:"w-5 h-5 text-white/80"}),n.jsx("span",{className:"text-xs font-bold text-white/80 uppercase tracking-[0.2em]",children:"AI Health Insights"})]}),n.jsxs("h2",{className:"text-2xl sm:text-3xl font-black text-white mb-4 tracking-tight leading-tight",children:[((Rt=c.recentReports[0])==null?void 0:Rt.reportType)||"Health Report"," Analysis",n.jsxs("span",{className:"block text-lg font-medium text-white/80 mt-1",children:["(",new Date((Fe=c.recentReports[0])==null?void 0:Fe.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),")"]})]}),n.jsxs("p",{className:"text-white/90 text-sm sm:text-base leading-relaxed mb-8 max-w-xl font-medium italic",children:['"',($e=(et=c.latestAnalysis)==null?void 0:et.summary)==null?void 0:$e.split(".")[0],"... ",(qt=(Kt=c.latestAnalysis)==null?void 0:Kt.summary)==null?void 0:qt.split(".")[1],'."']}),n.jsxs(Os,{to:`/reports/${(Xe=c.recentReports[0])==null?void 0:Xe._id}`,className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-md hover:bg-white/30 text-white px-8 py-4 rounded-2xl font-bold transition-all border border-white/30 shadow-lg group",children:["View Full Analysis",n.jsx(Pp,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})]}),n.jsxs("div",{className:"bg-gradient-to-br from-[#6366F1] to-[#4F46E5] rounded-[2.5rem] p-8 shadow-xl relative overflow-hidden text-white",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-xs font-bold text-white/70 uppercase tracking-widest",children:"Wellness Score"}),n.jsx("div",{className:"flex items-baseline gap-2 mt-2",children:n.jsxs("span",{className:"text-6xl font-black",children:[se||88,"%"]})})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-lg font-bold text-white",children:"Excellent Condition"}),n.jsxs("p",{className:"text-xs text-white/60",children:["Updated ",new Date((ht=c.recentReports[0])==null?void 0:ht.createdAt).getHours(),"h ago"]})]})]}),n.jsx("div",{className:"h-40 w-full mt-6 -mx-4",children:n.jsx(Yb,{width:"100%",height:"100%",children:n.jsxs(QT,{data:((dt=c.healthScores)==null?void 0:dt.slice(-7))||[],children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"scoreGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:"#fff",stopOpacity:.3}),n.jsx("stop",{offset:"95%",stopColor:"#fff",stopOpacity:0})]})}),n.jsx(HT,{type:"monotone",dataKey:"score",stroke:"#fff",strokeWidth:4,fillOpacity:1,fill:"url(#scoreGradient)"})]})})}),n.jsxs("p",{className:"text-sm font-medium mt-4 text-white/90",children:["Your health score is ",se>80?"trending up":"stable",". Keep maintaining your routine!"]})]}),n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Biomarker Trends"}),n.jsxs("button",{className:"text-indigo-600 text-xs font-black uppercase tracking-widest flex items-center gap-1 group",children:["View All",n.jsx(vo,{className:"w-3 h-3 group-hover:translate-x-1 transition-transform"})]})]}),n.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>F(!O),className:"w-full bg-[#F8FAFC] rounded-3xl p-4 sm:p-6 border border-slate-100 flex items-center justify-between hover:border-indigo-200 transition-all text-left",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-slate-900 font-bold block sm:inline",children:(Ce==null?void 0:Ce.name)||"Core Biomarker"}),Ce&&Ce.history.length>0&&n.jsxs("p",{className:"text-xs text-slate-500 font-semibold mt-1",children:["Current: ",(Dt=Ce.history[Ce.history.length-1])==null?void 0:Dt.value," ",Ce.unit]})]}),n.jsx(Pp,{className:`w-5 h-5 text-slate-400 transition-transform ${O?"rotate-[-90deg]":"rotate-90"}`})]}),O&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-3xl shadow-2xl border border-slate-100 z-50 py-4 max-h-64 overflow-y-auto anima-fade-in",children:Te.map(pt=>n.jsx("button",{onClick:()=>{R(pt),F(!1)},className:`w-full px-6 py-3 text-left hover:bg-slate-50 transition-colors ${k===pt?"text-indigo-600 font-bold":"text-slate-700"}`,children:oe[pt].name},pt))})]}),n.jsx("div",{className:"h-64 sm:h-72 w-full relative -mx-2 sm:mx-0 pr-4 sm:pr-0",children:n.jsx(Yb,{width:"100%",height:"100%",children:n.jsxs(QT,{data:(Ce==null?void 0:Ce.history)||[],margin:{top:20,right:30,left:0,bottom:20},children:[n.jsx(nE,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),n.jsx(iE,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:700},dy:8,interval:"preserveStartEnd",minTickGap:20}),n.jsx(aE,{axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:700},dx:-8,width:45,domain:["dataMin - 1","dataMax + 1"]}),n.jsx($R,{content:({active:pt,payload:Ut})=>pt&&Ut&&Ut.length?n.jsxs("div",{className:"bg-white shadow-2xl rounded-2xl p-4 border border-indigo-100 ring-4 ring-indigo-50/50",children:[n.jsx("p",{className:"text-[10px] font-black text-indigo-600 uppercase mb-1 tracking-wider",children:Ut[0].payload.date}),n.jsxs("p",{className:"text-sm font-bold text-slate-900",children:[Ut[0].value," ",Ce==null?void 0:Ce.unit]})]}):null}),n.jsx(HT,{type:"monotone",dataKey:"value",stroke:"#4F46E5",strokeWidth:4,fill:"#4F46E5",fillOpacity:.08,dot:{r:5,fill:"#4F46E5",strokeWidth:3,stroke:"#fff"},activeDot:{r:7,fill:"#4F46E5",strokeWidth:3,stroke:"#fff",shadow:"0 0 15px rgba(79,70,229,0.4)"}})]})})}),Ce&&n.jsxs("div",{className:"bg-[#F0FDF4] rounded-3xl p-5 sm:p-6 border border-emerald-100 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-slate-800 mb-1",children:Ce.name}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 font-medium lowercase",children:"Target: Normal Range"}),n.jsxs("div",{className:"flex items-baseline gap-2 mt-2 sm:mt-4",children:[n.jsx("span",{className:"text-3xl sm:text-4xl font-black text-emerald-600",children:(ss=Ce.history[Ce.history.length-1])==null?void 0:ss.value}),n.jsx("span",{className:"text-xs sm:text-sm font-bold text-emerald-600/70",children:Ce.unit}),Ce.history.length>1&&n.jsx(va,{className:`w-5 h-5 text-emerald-500 ${Ce.history[Ce.history.length-1].value<Ce.history[Ce.history.length-2].value?"transform rotate-180":""}`})]})]}),n.jsx("div",{className:"bg-white px-3 sm:px-4 py-2 rounded-full text-[10px] sm:text-[11px] font-black text-emerald-600 uppercase shadow-sm border border-emerald-50",children:"Stable"})]})]})]}),n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight mb-6 sm:mb-8 uppercase",children:"Metrics Overview"}),n.jsxs("div",{className:"grid grid-cols-3 gap-3 sm:gap-4 pb-2 sm:pb-0",children:[n.jsxs("div",{className:"bg-[#F0FDF4] rounded-3xl p-4 sm:p-6 border border-emerald-100 text-center group hover:scale-105 transition-transform shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-sm border border-emerald-50",children:n.jsx("span",{className:"text-xl sm:text-2xl font-black text-emerald-600",children:Object.values((($t=c.latestAnalysis)==null?void 0:$t.metrics)||{}).filter(pt=>{var Ut;return pt.status==="normal"||((Ut=pt.status)==null?void 0:Ut.toLowerCase())==="normal"}).length||4})}),n.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-emerald-600 uppercase tracking-widest block",children:"Good"})]}),n.jsxs("div",{className:"bg-[#FFFBEB] rounded-3xl p-4 sm:p-6 border border-amber-100 text-center group hover:scale-105 transition-transform shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-sm border border-amber-50",children:n.jsx("span",{className:"text-xl sm:text-2xl font-black text-amber-600",children:Object.values(((ls=c.latestAnalysis)==null?void 0:ls.metrics)||{}).filter(pt=>{var Ut;return pt.status==="moderate"||pt.status==="warning"||((Ut=pt.status)==null?void 0:Ut.toLowerCase().includes("borderline"))}).length||2})}),n.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-amber-600 uppercase tracking-widest block",children:"Moderate"})]}),n.jsxs("div",{className:"bg-[#FEF2F2] rounded-3xl p-4 sm:p-6 border border-red-100 text-center group hover:scale-105 transition-transform shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-sm border border-red-50",children:n.jsx("span",{className:"text-xl sm:text-2xl font-black text-red-600",children:Object.values(((Zt=c.latestAnalysis)==null?void 0:Zt.metrics)||{}).filter(pt=>{var Ut;return["low","high","critical"].includes((Ut=pt.status)==null?void 0:Ut.toLowerCase())}).length||2})}),n.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-red-600 uppercase tracking-widest block",children:"Issues"})]})]})]}),n.jsxs("div",{className:"bg-[#FFF1F2] rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-red-100",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6 sm:mb-8",children:[n.jsx("div",{className:"bg-[#FE2C55] p-2 rounded-xl",children:n.jsx(Ln,{className:"w-5 h-5 text-white"})}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Critical Deficiencies"})]}),n.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[(((es=(Rs=c.latestAnalysis)==null?void 0:Rs.deficiencies)==null?void 0:es.length)>0?c.latestAnalysis.deficiencies:[{name:"Vitamin D Deficiency",severity:"High"},{name:"Iron Insufficiency",severity:"Moderate"}]).map((pt,Ut)=>{var zt,rs;return n.jsxs(Os,{to:`/reports/${(zt=c.recentReports[0])==null?void 0:zt._id}`,className:"flex items-center justify-between bg-white rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-red-100/50 hover:border-red-200 transition-all group shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 overflow-hidden",children:[n.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl sm:rounded-2xl flex-shrink-0 flex items-center justify-center ${((rs=pt.severity)==null?void 0:rs.toLowerCase())==="high"?"bg-[#FE2C55]":"bg-orange-500"}`,children:n.jsx(th,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h4",{className:"font-extrabold text-slate-800 group-hover:text-[#FE2C55] transition-colors text-sm sm:text-base truncate",children:pt.name}),n.jsxs("p",{className:"text-[9px] sm:text-[10px] font-black text-slate-400 uppercase tracking-widest mt-0.5 sm:mt-1",children:[pt.severity||"High"," Priority"]})]})]}),n.jsx(Pp,{className:"w-4 h-4 sm:w-5 h-5 text-slate-300 group-hover:text-[#FE2C55] transition-all flex-shrink-0"})]},Ut)}),n.jsxs(Os,{to:"/nutrition",className:"w-full mt-2 sm:mt-4 bg-[#FE2C55] hover:bg-[#E5264D] text-white font-black text-[11px] sm:text-sm uppercase tracking-widest py-4 sm:py-5 rounded-2xl sm:rounded-3xl transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2 group",children:["View Personalized Diet Plan",n.jsx(vo,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6 px-3 md:px-0",children:[n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-lg font-black text-[#0F172A] uppercase tracking-tight",children:"Recent Tests"}),n.jsx(Os,{to:"/reports",className:"text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-indigo-600 transition-colors",children:"View All"})]}),n.jsx("div",{className:"space-y-4",children:(((Zs=c==null?void 0:c.recentReports)==null?void 0:Zs.length)>0?c.recentReports.slice(0,3):[{_id:"1",reportType:"Complete Blood Count",createdAt:"2026-02-12",status:"completed"},{_id:"2",reportType:"Lipid Profile",createdAt:"2026-01-28",status:"pending"},{_id:"3",reportType:"Thyroid Panel",createdAt:"2025-12-15",status:"completed"}]).map((pt,Ut)=>n.jsxs(Os,{to:pt._id?`/reports/${pt._id}`:"#",className:"flex items-center justify-between p-4 bg-slate-50 hover:bg-white border border-transparent hover:border-slate-100 rounded-3xl transition-all group shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white flex items-center justify-center shadow-sm text-slate-400 group-hover:text-indigo-600 transition-colors",children:n.jsx(Bn,{className:"w-6 h-6"})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-slate-800 group-hover:text-indigo-600 transition-colors",children:pt.reportType}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-0.5",children:new Date(pt.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${pt.status==="completed"?"text-emerald-500":"text-amber-500"}`,children:pt.status==="completed"?"Analyzed - Healthy":"Action Required"}),n.jsx(Pp,{className:"w-4 h-4 text-slate-300 group-hover:text-indigo-600 transition-colors"})]})]},pt._id||Ut))})]}),n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-50 flex items-center justify-center",children:n.jsx(Cr,{className:"w-5 h-5 text-indigo-600"})}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] uppercase tracking-tight",children:"Personalized Recommendations"})]}),n.jsx("div",{className:"space-y-4",children:[{name:"Vitamin B12 Panel",reason:"Low intake detected in food log",type:"Test"},{name:"Omega-3 (1000mg)",reason:"To support heart and brain health",type:"Supplement"},{name:"HbA1c Test",reason:"Important for diabetes monitoring",type:"Test"},{name:"Vitamin D3 (2000 IU)",reason:"Low sun exposure detected",type:"Supplement"}].map((pt,Ut)=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-3xl group cursor-pointer hover:bg-white border border-transparent hover:border-slate-100 transition-all shadow-sm",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("h4",{className:"font-bold text-slate-800",children:pt.name}),n.jsx("span",{className:`text-[8px] font-black uppercase tracking-tighter px-1.5 py-0.5 rounded-md ${pt.type==="Test"?"bg-indigo-100 text-indigo-600":"bg-emerald-100 text-emerald-600"}`,children:pt.type})]}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:pt.reason})]}),n.jsx("button",{className:"w-10 h-10 rounded-full bg-white flex items-center justify-center shadow-sm text-indigo-600 hover:bg-indigo-600 hover:text-white transition-all ring-1 ring-slate-100",children:n.jsx($l,{className:"w-5 h-5"})})]},Ut))})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center",children:n.jsx(GT,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"30 Days Challenge"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"Build healthy habits, one day at a time"})]})]}),n.jsxs(Os,{to:"/challenge",className:"block bg-gradient-to-br from-purple-400 via-pink-500 to-orange-500 rounded-3xl p-5 sm:p-8 text-white hover:shadow-2xl transition-all hover:-translate-y-1 group",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-1",children:[n.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center flex-shrink-0",children:n.jsx(GT,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-base sm:text-2xl font-bold mb-0.5 sm:mb-1 leading-tight",children:"30 Days Health Challenge"}),n.jsx("p",{className:"text-xs sm:text-base text-amber-100 leading-tight",children:"Complete daily tasks to build lasting habits"})]})]}),n.jsx(Pp,{className:"w-6 h-6 sm:w-8 sm:h-8 group-hover:translate-x-2 transition-transform flex-shrink-0"})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mb-4 sm:mb-6",children:[n.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-3 sm:p-4 text-center",children:[n.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:""}),n.jsx("p",{className:"text-xs sm:text-sm font-medium",children:"Drink Water"})]}),n.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-3 sm:p-4 text-center",children:[n.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:""}),n.jsx("p",{className:"text-xs sm:text-sm font-medium",children:"Workout/Yoga"})]}),n.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-3 sm:p-4 text-center",children:[n.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:""}),n.jsx("p",{className:"text-xs sm:text-sm font-medium",children:"Eat Fruits"})]}),n.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-3 sm:p-4 text-center",children:[n.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:""}),n.jsx("p",{className:"text-xs sm:text-sm font-medium",children:"Sleep Well"})]})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap",children:[n.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[n.jsx(Jl,{className:"w-4 h-4 sm:w-5 sm:h-5"}),n.jsx("span",{className:"text-xs sm:text-base font-bold",children:"Start Streak"})]}),n.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[n.jsx(ZR,{className:"w-4 h-4 sm:w-5 sm:h-5"}),n.jsx("span",{className:"text-xs sm:text-base font-bold",children:"Earn Badges"})]})]}),n.jsxs("div",{className:"px-3 py-1.5 sm:px-4 sm:py-2 bg-white/20 backdrop-blur-sm rounded-full text-xs sm:text-base font-bold whitespace-nowrap flex items-center gap-1",children:["Start Challenge",n.jsx(vo,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-400 to-orange-500 flex items-center justify-center",children:n.jsx(HA,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Did You Know?"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"Surprising nutrition facts about everyday foods"})]})]}),n.jsxs("div",{className:"md:grid md:grid-cols-2 lg:grid-cols-4 md:gap-4 flex md:flex-none overflow-x-auto gap-4 pb-4 md:pb-0 snap-x snap-mandatory scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0",children:[n.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-2xl border-2 border-orange-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"text-4xl",children:""}),n.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:n.jsx(Xp,{className:"w-5 h-5 text-green-600"})})]}),n.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Guava Power"}),n.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["One guava contains ",n.jsx("span",{className:"font-bold text-green-600",children:"3g of protein"})," - more than most fruits!"]}),n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[n.jsx(Zl,{className:"w-3 h-3"}),n.jsx("span",{children:"Great for muscle recovery"})]})]}),n.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-2xl border-2 border-blue-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"text-4xl",children:""}),n.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:n.jsx(Fb,{className:"w-5 h-5 text-blue-600"})})]}),n.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Spinach Iron"}),n.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["Spinach has ",n.jsx("span",{className:"font-bold text-blue-600",children:"2.7mg iron"})," per 100g - boosts blood health naturally"]}),n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[n.jsx(Vi,{className:"w-3 h-3"}),n.jsx("span",{children:"Prevents anemia"})]})]}),n.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-2xl border-2 border-purple-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"text-4xl",children:""}),n.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:n.jsx(nl,{className:"w-5 h-5 text-purple-600"})})]}),n.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Almond Energy"}),n.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["Just ",n.jsx("span",{className:"font-bold text-purple-600",children:"23 almonds"})," provide 6g protein and healthy fats for brain power"]}),n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[n.jsx(sE,{className:"w-3 h-3"}),n.jsx("span",{children:"Boosts brain function"})]})]}),n.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-2xl border-2 border-amber-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"text-4xl",children:""}),n.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:n.jsx(Gre,{className:"w-5 h-5 text-amber-600"})})]}),n.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Egg Vitamin D"}),n.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["One egg yolk has ",n.jsx("span",{className:"font-bold text-amber-600",children:"40 IU Vitamin D"})," - supports bone health"]}),n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[n.jsx(eI,{className:"w-3 h-3"}),n.jsx("span",{children:"Strengthens immunity"})]})]})]})]}),n.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-orange-500 rounded-3xl p-8 text-white",children:n.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Need Help Getting Started?"}),n.jsx("p",{className:"text-cyan-50",children:"Our AI assistant is here to guide you through your health journey"})]}),n.jsxs(Os,{to:"/ai-chat",className:"px-8 py-4 bg-white text-cyan-600 rounded-xl font-bold hover:shadow-2xl transition-all flex items-center gap-2 group",children:[n.jsx(rx,{className:"w-5 h-5"}),"Chat with AI",n.jsx(vo,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})})]})]})}function bce(){var E,S;const{user:a}=aa(),[o,c]=te.useState(null),[d,h]=te.useState(!0);if(te.useEffect(()=>{(async()=>{try{const{data:k}=await Wo.getDashboard();c(k)}catch(k){console.error("Failed to fetch dashboard:",k)}finally{h(!1)}})()},[]),d)return n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500",children:"Loading dashboard..."})]})});const{doctor:m,stats:g,todaySchedule:x,upcomingSchedule:v}=o||{};return(m==null?void 0:m.approvalStatus)==="pending"?n.jsx("div",{className:"max-w-lg mx-auto mt-20",children:n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:n.jsx(cl,{className:"w-8 h-8 text-amber-500"})}),n.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Approval Pending"}),n.jsx("p",{className:"text-slate-500 mb-4",children:"Your profile is under review. You'll be notified once approved."}),n.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium",children:[n.jsx(Ln,{className:"w-4 h-4"})," Pending Review"]})]})}):(m==null?void 0:m.approvalStatus)==="rejected"?n.jsx("div",{className:"max-w-lg mx-auto mt-20",children:n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:n.jsx(nQ,{className:"w-8 h-8 text-red-500"})}),n.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Application Rejected"}),n.jsx("p",{className:"text-slate-500",children:"Please contact support for more information."})]})}):n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["Welcome, Dr. ",(E=m==null?void 0:m.name)==null?void 0:E.split(" ")[0],"! "]}),n.jsx("p",{className:"text-slate-500 mt-1",children:m==null?void 0:m.specialization})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs(Os,{to:"/doctor/availability",className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium transition-all",children:[n.jsx(Sg,{className:"w-4 h-4"})," Manage Slots"]}),m!=null&&m.isListed?n.jsxs("span",{className:"px-3 py-2 bg-green-100 text-green-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[n.jsx(dn,{className:"w-4 h-4"})," Listed"]}):n.jsxs("span",{className:"px-3 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[n.jsx(Ln,{className:"w-4 h-4"})," Not Listed"]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:n.jsx(Ti,{className:"w-5 h-5 text-blue-600"})}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(g==null?void 0:g.todayAppointments)||0}),n.jsx("p",{className:"text-sm text-slate-500",children:"Today"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:n.jsx(va,{className:"w-5 h-5 text-green-600"})}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(g==null?void 0:g.upcomingAppointments)||0}),n.jsx("p",{className:"text-sm text-slate-500",children:"Upcoming"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:n.jsx(wg,{className:"w-5 h-5 text-purple-600"})}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(g==null?void 0:g.totalPatients)||0}),n.jsx("p",{className:"text-sm text-slate-500",children:"Patients"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:n.jsx(zA,{className:"w-5 h-5 text-amber-600"})}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((S=m==null?void 0:m.rating)==null?void 0:S.toFixed(1))||"0.0"}),n.jsx("p",{className:"text-sm text-slate-500",children:"Rating"})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsx("div",{className:"flex items-center justify-between mb-4",children:n.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[n.jsx(Cr,{className:"w-5 h-5 text-cyan-500"})," Today's Schedule"]})}),(x==null?void 0:x.length)>0?n.jsx("div",{className:"space-y-3",children:x.map(I=>{var k,R,O,F,M;return n.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center text-cyan-600 font-bold",children:((O=(R=(k=I.patient)==null?void 0:k.name)==null?void 0:R[0])==null?void 0:O.toUpperCase())||"P"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-slate-800",children:(F=I.patient)==null?void 0:F.name}),n.jsx("p",{className:"text-sm text-slate-500",children:I.timeSlot})]})]}),n.jsxs(Os,{to:`/patient/${(M=I.patient)==null?void 0:M._id}?appointmentId=${I._id}`,className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-xl hover:bg-slate-200 transition-all text-sm flex items-center gap-1",children:[n.jsx(Kp,{className:"w-4 h-4"})," View"]})]},I._id)})}):n.jsxs("div",{className:"text-center py-8 text-slate-500",children:[n.jsx(Ti,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),n.jsx("p",{children:"No appointments today"})]})]}),(v==null?void 0:v.length)>0&&n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[n.jsx(cl,{className:"w-5 h-5 text-green-500"})," Upcoming Appointments"]}),n.jsx("div",{className:"space-y-3",children:v.slice(0,5).map(I=>{var k,R,O,F;return n.jsx("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center text-green-600 font-bold",children:((O=(R=(k=I.patient)==null?void 0:k.name)==null?void 0:R[0])==null?void 0:O.toUpperCase())||"P"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-slate-800",children:(F=I.patient)==null?void 0:F.name}),n.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(I.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",I.timeSlot]})]})]})},I._id)})})]})]})}function tm(a,o,c,d){function h(m){return m instanceof c?m:new c(function(g){g(m)})}return new(c||(c=Promise))(function(m,g){function x(S){try{E(d.next(S))}catch(I){g(I)}}function v(S){try{E(d.throw(S))}catch(I){g(I)}}function E(S){S.done?m(S.value):h(S.value).then(x,v)}E((d=d.apply(a,o||[])).next())})}const xce=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function yg(a,o,c){const d=vce(a),{webkitRelativePath:h}=a,m=typeof o=="string"?o:typeof h=="string"&&h.length>0?h:`./${a.name}`;return typeof d.path!="string"&&E6(d,"path",m),E6(d,"relativePath",m),d}function vce(a){const{name:o}=a;if(o&&o.lastIndexOf(".")!==-1&&!a.type){const d=o.split(".").pop().toLowerCase(),h=xce.get(d);h&&Object.defineProperty(a,"type",{value:h,writable:!1,configurable:!1,enumerable:!0})}return a}function E6(a,o,c){Object.defineProperty(a,o,{value:c,writable:!1,configurable:!1,enumerable:!0})}const wce=[".DS_Store","Thumbs.db"];function _ce(a){return tm(this,void 0,void 0,function*(){return jy(a)&&yce(a.dataTransfer)?Nce(a.dataTransfer,a.type):Ece(a)?Sce(a):Array.isArray(a)&&a.every(o=>"getFile"in o&&typeof o.getFile=="function")?Cce(a):[]})}function yce(a){return jy(a)}function Ece(a){return jy(a)&&jy(a.target)}function jy(a){return typeof a=="object"&&a!==null}function Sce(a){return oR(a.target.files).map(o=>yg(o))}function Cce(a){return tm(this,void 0,void 0,function*(){return(yield Promise.all(a.map(c=>c.getFile()))).map(c=>yg(c))})}function Nce(a,o){return tm(this,void 0,void 0,function*(){if(a.items){const c=oR(a.items).filter(h=>h.kind==="file");if(o!=="drop")return c;const d=yield Promise.all(c.map(Tce));return S6(AH(d))}return S6(oR(a.files).map(c=>yg(c)))})}function S6(a){return a.filter(o=>wce.indexOf(o.name)===-1)}function oR(a){if(a===null)return[];const o=[];for(let c=0;c<a.length;c++){const d=a[c];o.push(d)}return o}function Tce(a){if(typeof a.webkitGetAsEntry!="function")return C6(a);const o=a.webkitGetAsEntry();return o&&o.isDirectory?uH(o):C6(a,o)}function AH(a){return a.reduce((o,c)=>[...o,...Array.isArray(c)?AH(c):[c]],[])}function C6(a,o){return tm(this,void 0,void 0,function*(){var c;if(globalThis.isSecureContext&&typeof a.getAsFileSystemHandle=="function"){const m=yield a.getAsFileSystemHandle();if(m===null)throw new Error(`${a} is not a File`);if(m!==void 0){const g=yield m.getFile();return g.handle=m,yg(g)}}const d=a.getAsFile();if(!d)throw new Error(`${a} is not a File`);return yg(d,(c=o==null?void 0:o.fullPath)!==null&&c!==void 0?c:void 0)})}function Rce(a){return tm(this,void 0,void 0,function*(){return a.isDirectory?uH(a):Ice(a)})}function uH(a){const o=a.createReader();return new Promise((c,d)=>{const h=[];function m(){o.readEntries(g=>tm(this,void 0,void 0,function*(){if(g.length){const x=Promise.all(g.map(Rce));h.push(x),m()}else try{const x=yield Promise.all(h);c(x)}catch(x){d(x)}}),g=>{d(g)})}m()})}function Ice(a){return tm(this,void 0,void 0,function*(){return new Promise((o,c)=>{a.file(d=>{const h=yg(d,a.fullPath);o(h)},d=>{c(d)})})})}var z2=function(a,o){if(a&&o){var c=Array.isArray(o)?o:o.split(",");if(c.length===0)return!0;var d=a.name||"",h=(a.type||"").toLowerCase(),m=h.replace(/\/.*$/,"");return c.some(function(g){var x=g.trim().toLowerCase();return x.charAt(0)==="."?d.toLowerCase().endsWith(x):x.endsWith("/*")?m===x.replace(/\/.*$/,""):h===x})}return!0};function N6(a){return Dce(a)||kce(a)||pH(a)||Oce()}function Oce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kce(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function Dce(a){if(Array.isArray(a))return cR(a)}function T6(a,o){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);o&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(a,h).enumerable})),c.push.apply(c,d)}return c}function R6(a){for(var o=1;o<arguments.length;o++){var c=arguments[o]!=null?arguments[o]:{};o%2?T6(Object(c),!0).forEach(function(d){hH(a,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):T6(Object(c)).forEach(function(d){Object.defineProperty(a,d,Object.getOwnPropertyDescriptor(c,d))})}return a}function hH(a,o,c){return o in a?Object.defineProperty(a,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[o]=c,a}function Xb(a,o){return jce(a)||Lce(a,o)||pH(a,o)||Bce()}function Bce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pH(a,o){if(a){if(typeof a=="string")return cR(a,o);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return cR(a,o)}}function cR(a,o){(o==null||o>a.length)&&(o=a.length);for(var c=0,d=new Array(o);c<o;c++)d[c]=a[c];return d}function Lce(a,o){var c=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(c!=null){var d=[],h=!0,m=!1,g,x;try{for(c=c.call(a);!(h=(g=c.next()).done)&&(d.push(g.value),!(o&&d.length===o));h=!0);}catch(v){m=!0,x=v}finally{try{!h&&c.return!=null&&c.return()}finally{if(m)throw x}}return d}}function jce(a){if(Array.isArray(a))return a}var Pce=typeof z2=="function"?z2:z2.default,Uce="file-invalid-type",Fce="file-too-large",Mce="file-too-small",Vce="too-many-files",Qce=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",c=o.split(","),d=c.length>1?"one of ".concat(c.join(", ")):c[0];return{code:Uce,message:"File type must be ".concat(d)}},I6=function(o){return{code:Fce,message:"File is larger than ".concat(o," ").concat(o===1?"byte":"bytes")}},O6=function(o){return{code:Mce,message:"File is smaller than ".concat(o," ").concat(o===1?"byte":"bytes")}},Hce={code:Vce,message:"Too many files"};function mH(a,o){var c=a.type==="application/x-moz-file"||Pce(a,o);return[c,c?null:Qce(o)]}function fH(a,o,c){if(Mp(a.size))if(Mp(o)&&Mp(c)){if(a.size>c)return[!1,I6(c)];if(a.size<o)return[!1,O6(o)]}else{if(Mp(o)&&a.size<o)return[!1,O6(o)];if(Mp(c)&&a.size>c)return[!1,I6(c)]}return[!0,null]}function Mp(a){return a!=null}function Gce(a){var o=a.files,c=a.accept,d=a.minSize,h=a.maxSize,m=a.multiple,g=a.maxFiles,x=a.validator;return!m&&o.length>1||m&&g>=1&&o.length>g?!1:o.every(function(v){var E=mH(v,c),S=Xb(E,1),I=S[0],k=fH(v,d,h),R=Xb(k,1),O=R[0],F=x?x(v):null;return I&&O&&!F})}function Py(a){return typeof a.isPropagationStopped=="function"?a.isPropagationStopped():typeof a.cancelBubble<"u"?a.cancelBubble:!1}function j_(a){return a.dataTransfer?Array.prototype.some.call(a.dataTransfer.types,function(o){return o==="Files"||o==="application/x-moz-file"}):!!a.target&&!!a.target.files}function k6(a){a.preventDefault()}function Kce(a){return a.indexOf("MSIE")!==-1||a.indexOf("Trident/")!==-1}function Wce(a){return a.indexOf("Edge/")!==-1}function zce(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Kce(a)||Wce(a)}function Hd(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return function(d){for(var h=arguments.length,m=new Array(h>1?h-1:0),g=1;g<h;g++)m[g-1]=arguments[g];return o.some(function(x){return!Py(d)&&x&&x.apply(void 0,[d].concat(m)),Py(d)})}}function qce(){return"showOpenFilePicker"in window}function Yce(a){if(Mp(a)){var o=Object.entries(a).filter(function(c){var d=Xb(c,2),h=d[0],m=d[1],g=!0;return gH(h)||(console.warn('Skipped "'.concat(h,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),g=!1),(!Array.isArray(m)||!m.every(bH))&&(console.warn('Skipped "'.concat(h,'" because an invalid file extension was provided.')),g=!1),g}).reduce(function(c,d){var h=Xb(d,2),m=h[0],g=h[1];return R6(R6({},c),{},hH({},m,g))},{});return[{description:"Files",accept:o}]}return a}function Xce(a){if(Mp(a))return Object.entries(a).reduce(function(o,c){var d=Xb(c,2),h=d[0],m=d[1];return[].concat(N6(o),[h],N6(m))},[]).filter(function(o){return gH(o)||bH(o)}).join(",")}function Jce(a){return a instanceof DOMException&&(a.name==="AbortError"||a.code===a.ABORT_ERR)}function $ce(a){return a instanceof DOMException&&(a.name==="SecurityError"||a.code===a.SECURITY_ERR)}function gH(a){return a==="audio/*"||a==="video/*"||a==="image/*"||a==="text/*"||a==="application/*"||/\w+\/[-+.\w]+/g.test(a)}function bH(a){return/^.*\.[\w]+$/.test(a)}var Zce=["children"],ele=["open"],tle=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],sle=["refKey","onChange","onClick"];function rle(a){return ale(a)||ile(a)||xH(a)||nle()}function nle(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ile(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function ale(a){if(Array.isArray(a))return lR(a)}function q2(a,o){return lle(a)||cle(a,o)||xH(a,o)||ole()}function ole(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xH(a,o){if(a){if(typeof a=="string")return lR(a,o);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return lR(a,o)}}function lR(a,o){(o==null||o>a.length)&&(o=a.length);for(var c=0,d=new Array(o);c<o;c++)d[c]=a[c];return d}function cle(a,o){var c=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(c!=null){var d=[],h=!0,m=!1,g,x;try{for(c=c.call(a);!(h=(g=c.next()).done)&&(d.push(g.value),!(o&&d.length===o));h=!0);}catch(v){m=!0,x=v}finally{try{!h&&c.return!=null&&c.return()}finally{if(m)throw x}}return d}}function lle(a){if(Array.isArray(a))return a}function D6(a,o){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);o&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(a,h).enumerable})),c.push.apply(c,d)}return c}function pi(a){for(var o=1;o<arguments.length;o++){var c=arguments[o]!=null?arguments[o]:{};o%2?D6(Object(c),!0).forEach(function(d){dR(a,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):D6(Object(c)).forEach(function(d){Object.defineProperty(a,d,Object.getOwnPropertyDescriptor(c,d))})}return a}function dR(a,o,c){return o in a?Object.defineProperty(a,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[o]=c,a}function Uy(a,o){if(a==null)return{};var c=dle(a,o),d,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(a);for(h=0;h<m.length;h++)d=m[h],!(o.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(a,d)&&(c[d]=a[d])}return c}function dle(a,o){if(a==null)return{};var c={},d=Object.keys(a),h,m;for(m=0;m<d.length;m++)h=d[m],!(o.indexOf(h)>=0)&&(c[h]=a[h]);return c}var lI=te.forwardRef(function(a,o){var c=a.children,d=Uy(a,Zce),h=wH(d),m=h.open,g=Uy(h,ele);return te.useImperativeHandle(o,function(){return{open:m}},[m]),XV.createElement(te.Fragment,null,c(pi(pi({},g),{},{open:m})))});lI.displayName="Dropzone";var vH={disabled:!1,getFilesFromEvent:_ce,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};lI.defaultProps=vH;lI.propTypes={children:kn.func,accept:kn.objectOf(kn.arrayOf(kn.string)),multiple:kn.bool,preventDropOnDocument:kn.bool,noClick:kn.bool,noKeyboard:kn.bool,noDrag:kn.bool,noDragEventsBubbling:kn.bool,minSize:kn.number,maxSize:kn.number,maxFiles:kn.number,disabled:kn.bool,getFilesFromEvent:kn.func,onFileDialogCancel:kn.func,onFileDialogOpen:kn.func,useFsAccessApi:kn.bool,autoFocus:kn.bool,onDragEnter:kn.func,onDragLeave:kn.func,onDragOver:kn.func,onDrop:kn.func,onDropAccepted:kn.func,onDropRejected:kn.func,onError:kn.func,validator:kn.func};var AR={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function wH(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=pi(pi({},vH),a),c=o.accept,d=o.disabled,h=o.getFilesFromEvent,m=o.maxSize,g=o.minSize,x=o.multiple,v=o.maxFiles,E=o.onDragEnter,S=o.onDragLeave,I=o.onDragOver,k=o.onDrop,R=o.onDropAccepted,O=o.onDropRejected,F=o.onFileDialogCancel,M=o.onFileDialogOpen,Q=o.useFsAccessApi,Z=o.autoFocus,$=o.preventDropOnDocument,X=o.noClick,be=o.noKeyboard,me=o.noDrag,Ne=o.noDragEventsBubbling,le=o.onError,H=o.validator,Ae=te.useMemo(function(){return Xce(c)},[c]),J=te.useMemo(function(){return Yce(c)},[c]),Y=te.useMemo(function(){return typeof M=="function"?M:B6},[M]),se=te.useMemo(function(){return typeof F=="function"?F:B6},[F]),oe=te.useRef(null),Te=te.useRef(null),he=te.useReducer(Ale,AR),Ce=q2(he,2),ee=Ce[0],Be=Ce[1],He=ee.isFocused,Ue=ee.isFileDialogActive,re=te.useRef(typeof window<"u"&&window.isSecureContext&&Q&&qce()),ve=function(){!re.current&&Ue&&setTimeout(function(){if(Te.current){var Dt=Te.current.files;Dt.length||(Be({type:"closeDialog"}),se())}},300)};te.useEffect(function(){return window.addEventListener("focus",ve,!1),function(){window.removeEventListener("focus",ve,!1)}},[Te,Ue,se,re]);var fe=te.useRef([]),Ie=function(Dt){oe.current&&oe.current.contains(Dt.target)||(Dt.preventDefault(),fe.current=[])};te.useEffect(function(){return $&&(document.addEventListener("dragover",k6,!1),document.addEventListener("drop",Ie,!1)),function(){$&&(document.removeEventListener("dragover",k6),document.removeEventListener("drop",Ie))}},[oe,$]),te.useEffect(function(){return!d&&Z&&oe.current&&oe.current.focus(),function(){}},[oe,Z,d]);var je=te.useCallback(function(dt){le?le(dt):console.error(dt)},[le]),Ee=te.useCallback(function(dt){dt.preventDefault(),dt.persist(),Kt(dt),fe.current=[].concat(rle(fe.current),[dt.target]),j_(dt)&&Promise.resolve(h(dt)).then(function(Dt){if(!(Py(dt)&&!Ne)){var ss=Dt.length,$t=ss>0&&Gce({files:Dt,accept:Ae,minSize:g,maxSize:m,multiple:x,maxFiles:v,validator:H}),ls=ss>0&&!$t;Be({isDragAccept:$t,isDragReject:ls,isDragActive:!0,type:"setDraggedFiles"}),E&&E(dt)}}).catch(function(Dt){return je(Dt)})},[h,E,je,Ne,Ae,g,m,x,v,H]),We=te.useCallback(function(dt){dt.preventDefault(),dt.persist(),Kt(dt);var Dt=j_(dt);if(Dt&&dt.dataTransfer)try{dt.dataTransfer.dropEffect="copy"}catch{}return Dt&&I&&I(dt),!1},[I,Ne]),ze=te.useCallback(function(dt){dt.preventDefault(),dt.persist(),Kt(dt);var Dt=fe.current.filter(function($t){return oe.current&&oe.current.contains($t)}),ss=Dt.indexOf(dt.target);ss!==-1&&Dt.splice(ss,1),fe.current=Dt,!(Dt.length>0)&&(Be({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),j_(dt)&&S&&S(dt))},[oe,S,Ne]),st=te.useCallback(function(dt,Dt){var ss=[],$t=[];dt.forEach(function(ls){var Zt=mH(ls,Ae),Rs=q2(Zt,2),es=Rs[0],Zs=Rs[1],pt=fH(ls,g,m),Ut=q2(pt,2),zt=Ut[0],rs=Ut[1],Ht=H?H(ls):null;if(es&&zt&&!Ht)ss.push(ls);else{var vt=[Zs,rs];Ht&&(vt=vt.concat(Ht)),$t.push({file:ls,errors:vt.filter(function(jt){return jt})})}}),(!x&&ss.length>1||x&&v>=1&&ss.length>v)&&(ss.forEach(function(ls){$t.push({file:ls,errors:[Hce]})}),ss.splice(0)),Be({acceptedFiles:ss,fileRejections:$t,isDragReject:$t.length>0,type:"setFiles"}),k&&k(ss,$t,Dt),$t.length>0&&O&&O($t,Dt),ss.length>0&&R&&R(ss,Dt)},[Be,x,Ae,g,m,v,k,R,O,H]),bt=te.useCallback(function(dt){dt.preventDefault(),dt.persist(),Kt(dt),fe.current=[],j_(dt)&&Promise.resolve(h(dt)).then(function(Dt){Py(dt)&&!Ne||st(Dt,dt)}).catch(function(Dt){return je(Dt)}),Be({type:"reset"})},[h,st,je,Ne]),Qe=te.useCallback(function(){if(re.current){Be({type:"openDialog"}),Y();var dt={multiple:x,types:J};window.showOpenFilePicker(dt).then(function(Dt){return h(Dt)}).then(function(Dt){st(Dt,null),Be({type:"closeDialog"})}).catch(function(Dt){Jce(Dt)?(se(Dt),Be({type:"closeDialog"})):$ce(Dt)?(re.current=!1,Te.current?(Te.current.value=null,Te.current.click()):je(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):je(Dt)});return}Te.current&&(Be({type:"openDialog"}),Y(),Te.current.value=null,Te.current.click())},[Be,Y,se,Q,st,je,J,x]),rt=te.useCallback(function(dt){!oe.current||!oe.current.isEqualNode(dt.target)||(dt.key===" "||dt.key==="Enter"||dt.keyCode===32||dt.keyCode===13)&&(dt.preventDefault(),Qe())},[oe,Qe]),Nt=te.useCallback(function(){Be({type:"focus"})},[]),we=te.useCallback(function(){Be({type:"blur"})},[]),Rt=te.useCallback(function(){X||(zce()?setTimeout(Qe,0):Qe())},[X,Qe]),Fe=function(Dt){return d?null:Dt},et=function(Dt){return be?null:Fe(Dt)},$e=function(Dt){return me?null:Fe(Dt)},Kt=function(Dt){Ne&&Dt.stopPropagation()},qt=te.useMemo(function(){return function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Dt=dt.refKey,ss=Dt===void 0?"ref":Dt,$t=dt.role,ls=dt.onKeyDown,Zt=dt.onFocus,Rs=dt.onBlur,es=dt.onClick,Zs=dt.onDragEnter,pt=dt.onDragOver,Ut=dt.onDragLeave,zt=dt.onDrop,rs=Uy(dt,tle);return pi(pi(dR({onKeyDown:et(Hd(ls,rt)),onFocus:et(Hd(Zt,Nt)),onBlur:et(Hd(Rs,we)),onClick:Fe(Hd(es,Rt)),onDragEnter:$e(Hd(Zs,Ee)),onDragOver:$e(Hd(pt,We)),onDragLeave:$e(Hd(Ut,ze)),onDrop:$e(Hd(zt,bt)),role:typeof $t=="string"&&$t!==""?$t:"presentation"},ss,oe),!d&&!be?{tabIndex:0}:{}),rs)}},[oe,rt,Nt,we,Rt,Ee,We,ze,bt,be,me,d]),Xe=te.useCallback(function(dt){dt.stopPropagation()},[]),ht=te.useMemo(function(){return function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Dt=dt.refKey,ss=Dt===void 0?"ref":Dt,$t=dt.onChange,ls=dt.onClick,Zt=Uy(dt,sle),Rs=dR({accept:Ae,multiple:x,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Fe(Hd($t,bt)),onClick:Fe(Hd(ls,Xe)),tabIndex:-1},ss,Te);return pi(pi({},Rs),Zt)}},[Te,c,x,bt,d]);return pi(pi({},ee),{},{isFocused:He&&!d,getRootProps:qt,getInputProps:ht,rootRef:oe,inputRef:Te,open:Fe(Qe)})}function Ale(a,o){switch(o.type){case"focus":return pi(pi({},a),{},{isFocused:!0});case"blur":return pi(pi({},a),{},{isFocused:!1});case"openDialog":return pi(pi({},AR),{},{isFileDialogActive:!0});case"closeDialog":return pi(pi({},a),{},{isFileDialogActive:!1});case"setDraggedFiles":return pi(pi({},a),{},{isDragActive:o.isDragActive,isDragAccept:o.isDragAccept,isDragReject:o.isDragReject});case"setFiles":return pi(pi({},a),{},{acceptedFiles:o.acceptedFiles,fileRejections:o.fileRejections,isDragReject:o.isDragReject});case"reset":return pi({},AR);default:return a}}function B6(){}const ule=[{value:"Blood Test",label:"Blood Test",icon:""},{value:"X-Ray",label:"X-Ray",icon:""},{value:"MRI",label:"MRI",icon:""},{value:"CT Scan",label:"CT Scan",icon:""},{value:"ECG",label:"ECG",icon:""},{value:"Ultrasound",label:"Ultrasound",icon:""},{value:"General Checkup",label:"General Checkup",icon:""},{value:"Other",label:"Other",icon:""}];function hle(){const[a,o]=te.useState([]),[c,d]=te.useState(!1),[h,m]=te.useState(0),[g,x]=te.useState([]),v=to();te.useEffect(()=>{window.scrollTo(0,0),E()},[]);const E=async()=>{try{const{data:Q}=await ll.getReports();x(Q.slice(0,3))}catch(Q){console.error("Failed to fetch recent reports",Q)}},S=te.useCallback(Q=>{const Z=Q.map($=>({file:$,id:Math.random().toString(36).substr(2,9),reportType:"Blood Test",name:$.name,size:$.size}));o($=>[...$,...Z])},[]),{getRootProps:I,getInputProps:k,isDragActive:R}=wH({onDrop:S,accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]},maxSize:10*1024*1024}),O=(Q,Z)=>{o($=>$.map(X=>X.id===Q?{...X,reportType:Z}:X))},F=Q=>{o(Z=>Z.filter($=>$.id!==Q))},M=async Q=>{var $,X;if(Q.preventDefault(),a.length===0){Ct.error("Please select at least one file");return}d(!0),m(0);const Z=setInterval(()=>{m(be=>be>=90?(clearInterval(Z),90):be+5)},300);try{const be=new FormData;be.append("report",a[0].file),be.append("reportType",a[0].reportType);const{data:me}=await ll.uploadReport(be);clearInterval(Z),m(100),Ct.success("Report analyzed successfully!"),setTimeout(()=>v(`/reports/${me.report._id}`),500)}catch(be){clearInterval(Z),Ct.error(((X=($=be.response)==null?void 0:$.data)==null?void 0:X.message)||"Failed to analyze report"),m(0)}finally{d(!1)}};return n.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col items-center py-12 px-4 sm:px-6",children:[n.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[n.jsx("div",{className:"absolute top-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-400/10 rounded-full blur-[120px]"}),n.jsx("div",{className:"absolute bottom-[-10%] left-[-10%] w-[40%] h-[40%] bg-cyan-400/10 rounded-full blur-[120px]"})]}),n.jsxs("div",{className:"w-full max-w-2xl relative",children:[n.jsxs("div",{className:"flex flex-col items-center text-center mb-10 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-100/50 rounded-full border border-blue-200",children:[n.jsx(qb,{className:"w-3.5 h-3.5 text-blue-600"}),n.jsx("span",{className:"text-[10px] font-black tracking-widest text-blue-700 uppercase",children:"HIPAA Secure Portal"})]}),n.jsxs("h1",{className:"text-4xl font-black text-slate-800 tracking-tight",children:["Analyze Medical ",n.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-orange-500",children:"Reports"})]}),n.jsx("p",{className:"text-slate-500 max-w-md font-medium",children:"Upload your documents for instant AI-powered health insights and personalized recommendations."})]}),n.jsx("div",{className:"bg-white rounded-[2.5rem] shadow-[0_20px_50px_-12px_rgba(0,0,0,0.08)] border border-slate-100 overflow-hidden transition-all",children:n.jsx("div",{className:"p-8 sm:p-12",children:!c&&a.length===0?n.jsxs("div",{...I(),className:`relative group border-4 border-dashed rounded-[2rem] p-10 text-center cursor-pointer transition-all duration-500 ${R?"border-blue-500 bg-blue-50/50 scale-[1.02]":"border-slate-100 hover:border-blue-300 bg-slate-50/50"}`,children:[n.jsx("input",{...k()}),n.jsx("div",{className:"w-20 h-20 rounded-3xl bg-white shadow-xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-500",children:n.jsx(il,{className:"w-8 h-8 text-blue-600"})}),n.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:R?"Drop your report here":"Drop report or click to browse"}),n.jsx("p",{className:"text-slate-500 font-medium mb-6 text-sm",children:"PDF, PNG, or JPG (Max 10MB)"}),n.jsx("div",{className:"flex items-center justify-center gap-4",children:["PDF","PNG","JPG"].map(Q=>n.jsx("span",{className:"px-3 py-1 bg-white border border-slate-200 rounded-lg text-[10px] font-black text-slate-400",children:Q},Q))})]}):a.length>0&&!c?n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"bg-slate-50 rounded-3xl p-6 border border-slate-100",children:a.map(Q=>n.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6",children:[n.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[n.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white shadow-md flex items-center justify-center flex-shrink-0",children:n.jsx(Bn,{className:"w-6 h-6 text-blue-600"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("p",{className:"font-bold text-slate-800 truncate text-base",children:Q.name}),n.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase",children:[(Q.size/1024/1024).toFixed(2)," MB"]})]})]}),n.jsxs("div",{className:"w-full sm:w-auto flex items-center gap-2",children:[n.jsxs("div",{className:"relative flex-1 sm:w-48",children:[n.jsx("select",{value:Q.reportType,onChange:Z=>O(Q.id,Z.target.value),className:"w-full appearance-none bg-white text-slate-800 text-sm font-bold pl-4 pr-10 py-3 rounded-xl border border-slate-200 focus:border-blue-500 focus:outline-none cursor-pointer",children:ule.map(Z=>n.jsxs("option",{value:Z.value,children:[Z.icon," ",Z.label]},Z.value))}),n.jsx(lh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]}),n.jsx("button",{onClick:()=>F(Q.id),className:"p-3 bg-red-50 text-red-500 hover:bg-red-100 rounded-xl transition-all flex-shrink-0",children:n.jsx(pg,{className:"w-5 h-5"})})]})]},Q.id))}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("button",{onClick:()=>o([]),className:"px-6 py-4 bg-slate-100 text-slate-600 font-bold rounded-2xl hover:bg-slate-200 transition-all",children:"Cancel"}),n.jsxs("button",{onClick:M,className:"flex-1 py-4 bg-slate-900 text-white font-black rounded-2xl hover:bg-slate-800 transition-all shadow-xl flex items-center justify-center gap-3 uppercase tracking-widest text-sm",children:[n.jsx(dn,{className:"w-5 h-5 text-blue-400"}),"Analyze Report"]})]})]}):n.jsxs("div",{className:"space-y-10 py-6",children:[n.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-slate-100 border-t-blue-500 animate-spin"}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:n.jsx(Bn,{className:"w-8 h-8 text-blue-500 animate-pulse"})})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-2xl font-black text-slate-800",children:"Analyzing Report"}),n.jsx("p",{className:"text-slate-500 font-medium",children:"Extracting health markers and findings..."})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"h-4 bg-slate-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-purple-600 to-orange-500 transition-all duration-500",style:{width:`${h}%`}})}),n.jsxs("div",{className:"flex justify-between text-xs font-black text-slate-400 uppercase tracking-widest",children:[n.jsx("span",{children:"Processing Data"}),n.jsxs("span",{children:[h,"%"]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex items-center gap-3",children:[n.jsx(eI,{className:"w-5 h-5 text-blue-500"}),n.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Secure Scan"})]}),n.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex items-center gap-3",children:[n.jsx(qb,{className:"w-5 h-5 text-blue-500"}),n.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"HIPAA Compliant"})]})]})]})})}),n.jsxs("div",{className:"mt-8 bg-blue-50 rounded-3xl p-6 border border-blue-100 flex gap-4",children:[n.jsx(zd,{className:"w-6 h-6 text-blue-500 flex-shrink-0"}),n.jsx("p",{className:"text-sm text-blue-700 leading-relaxed font-medium",children:"Our AI analysis provides deep insights but is for educational purposes only. Always consult with a healthcare professional before making medical decisions."})]}),g.length>0&&n.jsxs("div",{className:"mt-12 space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex items-center justify-between px-2",children:[n.jsx("h2",{className:"text-xl font-black text-slate-800 tracking-tight",children:"Recent Tests"}),n.jsx(Os,{to:"/reports",className:"text-sm font-bold text-blue-600 hover:text-blue-700",children:"View All"})]}),n.jsx("div",{className:"grid gap-4",children:g.map(Q=>n.jsxs("div",{className:"card p-5 relative border-none ring-1 ring-white/50",children:[n.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-[1rem] bg-indigo-50 flex items-center justify-center flex-shrink-0 shadow-inner",children:n.jsx(Bn,{className:"w-6 h-6 text-indigo-600"})}),n.jsxs("div",{className:"flex-1 mt-1",children:[n.jsx("div",{className:"flex items-center gap-2 mb-1.5",children:n.jsx("span",{className:`text-[9px] font-black px-2.5 py-1 rounded-lg uppercase tracking-widest ${Q.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:Q.status})}),n.jsx("h3",{className:"text-base font-black text-slate-800 leading-tight uppercase mb-1",children:Q.reportType}),n.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-[10px] font-black uppercase tracking-widest font-mono",children:[n.jsx(Ti,{className:"w-3 h-3"}),new Date(Q.reportDate||Q.createdAt).toLocaleDateString()]})]})]}),n.jsxs(Os,{to:`/reports/${Q._id}`,onClick:()=>window.scrollTo(0,0),className:"w-full py-3 bg-white border-2 border-slate-100 text-slate-800 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:border-purple-600 hover:text-purple-600 transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[n.jsx(Kp,{className:"w-4 h-4"}),"Analysis Details"]})]},Q._id))})]})]})]})}function ple(){var R,O,F,M,Q,Z,$,X,be,me,Ne,le;const{id:a}=sx(),o=to(),[c,d]=te.useState(null),[h,m]=te.useState(!0);if(te.useEffect(()=>{(async()=>{try{const{data:Ae}=await ll.getReport(a);d(Ae.report)}catch{Ct.error("Failed to load report")}finally{m(!1)}})()},[a]),h)return n.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-blue-500/20 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500 font-medium",children:"Analyzing Report..."})]})});if(!c)return n.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-slate-50 px-6",children:[n.jsx(th,{className:"w-16 h-16 text-amber-500 mb-4"}),n.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Report Not Found"}),n.jsx("p",{className:"text-slate-500 text-center mb-6",children:"We couldn't find the report you're looking for."}),n.jsx("button",{onClick:()=>o("/dashboard"),className:"w-full py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg",children:"Back to Dashboard"})]});const{aiAnalysis:g}=c,x=(g==null?void 0:g.metrics)||{},v=Object.entries(x),E={good:v.filter(([H,Ae])=>Ae.status==="normal").length,moderate:v.filter(([H,Ae])=>Ae.status==="borderline"||Ae.status==="moderate").length,low:v.filter(([H,Ae])=>Ae.status==="low"||Ae.status==="high").length},S=H=>H==="normal"||H==="good"?"emerald":H==="borderline"||H==="moderate"?"amber":"red",I=()=>{const H=`Check out my ${c.reportType} health report analysis! Health Score: ${g==null?void 0:g.healthScore}/100`,Ae=window.location.href;navigator.share?navigator.share({title:"Health Report Analysis",text:H,url:Ae}).catch(()=>{window.open(`https://wa.me/?text=${encodeURIComponent(H+" "+Ae)}`,"_blank")}):window.open(`https://wa.me/?text=${encodeURIComponent(H+" "+Ae)}`,"_blank")},k=()=>{window.print()};return n.jsxs("div",{className:"min-h-screen pb-20 font-sans",children:[n.jsx("div",{className:"px-6 pt-8 pb-4 flex items-center justify-between sticky top-0 backdrop-blur-md z-10",children:n.jsxs(Os,{to:"/dashboard",className:"flex items-center gap-2 text-purple-600 font-bold text-xs tracking-[0.1em]",children:[n.jsx(ln,{className:"w-4 h-4"})," BACK TO REPORTS"]})}),n.jsxs("div",{className:"px-6 mb-8 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h1",{className:"text-2xl font-black text-[#0F172A] tracking-tight truncate whitespace-nowrap",children:"Report Analysis"}),n.jsx("p",{className:"text-slate-500 font-medium mt-0.5 text-xs",children:"AI-Powered Health Insights"})]}),n.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[n.jsx("button",{onClick:I,className:"p-2.5 bg-white rounded-xl shadow-sm border border-slate-100 text-[#25D366] hover:bg-emerald-50 transition-colors",title:"Share on WhatsApp",children:n.jsx(iQ,{className:"w-5 h-5"})}),n.jsx("button",{onClick:k,className:"p-2.5 bg-white rounded-xl shadow-sm border border-slate-100 text-slate-600 hover:bg-slate-50 transition-colors",title:"Download PDF",children:n.jsx(tE,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"px-4 space-y-6",children:[n.jsxs("div",{className:"card card-gradient p-8 text-slate-900 shadow-2xl relative overflow-hidden ring-1 ring-white/50",children:[n.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-white/20 rounded-full blur-3xl -mr-20 -mt-20"}),n.jsxs("div",{className:"flex items-center gap-3 mb-6 relative z-10",children:[n.jsx("div",{className:"w-10 h-10 bg-white/40 backdrop-blur-md rounded-xl flex items-center justify-center border border-white/50 shadow-inner",children:n.jsx(Bn,{className:"w-5 h-5 text-purple-700"})}),n.jsx("span",{className:"text-[10px] font-black tracking-[0.25em] text-slate-800 uppercase",children:"Lab Report"})]}),n.jsxs("h2",{className:"text-2xl font-black mb-4 flex items-center gap-2 overflow-hidden relative z-10",children:[n.jsx("span",{className:"truncate whitespace-nowrap",children:c.reportType}),n.jsxs("span",{className:"text-sm font-bold opacity-60 shrink-0",children:["(",new Date(c.createdAt).toLocaleDateString("en-US",{month:"short",year:"numeric"}),")"]})]}),n.jsxs("div",{className:"space-y-4 relative z-10",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx(Ti,{className:"w-4 h-4 opacity-60"}),n.jsx("span",{className:"text-sm font-bold",children:new Date(c.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),n.jsxs("div",{className:"flex items-center gap-3 text-slate-700 overflow-hidden",children:[n.jsx(Kre,{className:"w-4 h-4 opacity-60 shrink-0"}),n.jsxs("span",{className:"text-sm font-bold truncate whitespace-nowrap",children:[c.patientName||"Patient Name",c.patientAge?`  ${c.patientAge}Y`:"",c.patientGender?`  ${c.patientGender}`:""]})]})]}),n.jsx("div",{className:"absolute top-6 right-6 bg-white/40 backdrop-blur-md border border-white/60 rounded-xl px-3 py-1.5 text-center shadow-lg z-10",children:n.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[n.jsx("span",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),n.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-800",children:"Analyzed"})]})}),n.jsx("div",{className:"absolute bottom-[-20px] right-8 opacity-5",children:n.jsx(Bn,{className:"w-32 h-32"})})]}),(g==null?void 0:g.summary)&&n.jsxs("div",{className:"card p-8 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-xl flex items-center justify-center",children:n.jsx(Cr,{className:"w-5 h-5 text-purple-600"})}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Executive Summary"})]}),n.jsx("p",{className:"text-slate-600 leading-relaxed font-bold text-sm mb-6",children:g.summary}),n.jsxs("div",{className:"bg-purple-50/50 rounded-3xl p-6 border border-purple-100",children:[n.jsx("h4",{className:"text-purple-700 font-black text-[10px] uppercase tracking-wider mb-2",children:"Key Insight"}),n.jsx("p",{className:"text-purple-900 text-xs leading-relaxed font-bold",children:((R=g.keyFindings)==null?void 0:R[0])||"Your health markers are generally within range, but some areas require focus."})]})]}),n.jsxs("div",{className:"mt-8",children:[n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase mb-6 px-4",children:"Health Metrics"}),n.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[n.jsxs("div",{className:"bg-white rounded-3xl p-4 text-center border border-slate-100 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-3",children:n.jsx(dn,{className:"w-5 h-5 text-emerald-500"})}),n.jsx("p",{className:"text-2xl font-black text-slate-800 mb-1",children:E.good}),n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Good"})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-4 text-center border border-slate-100 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 bg-amber-50 rounded-full flex items-center justify-center mx-auto mb-3",children:n.jsx(Ln,{className:"w-5 h-5 text-amber-500"})}),n.jsx("p",{className:"text-2xl font-black text-slate-800 mb-1",children:E.moderate}),n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Moderate"})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-4 text-center border border-slate-100 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-3",children:n.jsx(th,{className:"w-5 h-5 text-red-500"})}),n.jsx("p",{className:"text-2xl font-black text-slate-800 mb-1",children:E.low}),n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Low"})]})]}),n.jsx("div",{className:"space-y-4",children:v.map(([H,Ae])=>{const J=S(Ae.status);return n.jsxs("div",{className:`card p-6 border-2 border-${J}-100 relative overflow-hidden`,children:[n.jsx("div",{className:`absolute top-0 right-0 w-24 h-24 bg-${J}-500/5 rounded-full -mr-12 -mt-12`}),n.jsxs("div",{className:"flex justify-between items-start mb-4 relative z-1",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"text-base font-black text-slate-800 flex items-center gap-2",children:[H.replace(/([A-Z])/g," $1"),Ae.status!=="normal"&&n.jsx(th,{className:`w-4 h-4 text-${J}-500`}),Ae.status==="normal"&&n.jsx(dn,{className:"w-4 h-4 text-emerald-500"})]}),n.jsxs("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:["Range: ",Ae.normalRange," ",Ae.unit]})]}),n.jsx("div",{className:`px-2.5 py-1 bg-${J}-100/80 text-${J}-700 rounded-full flex items-center gap-1 border border-${J}-200`,children:n.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:Ae.status})})]}),n.jsxs("div",{className:"flex items-baseline gap-2 relative z-1",children:[n.jsx("span",{className:`text-3xl font-black text-${J}-600`,children:Ae.value}),n.jsx("span",{className:"text-slate-400 font-bold text-xs tracking-tight uppercase",children:Ae.unit})]})]},H)})})]}),((O=g==null?void 0:g.deficiencies)==null?void 0:O.length)>0&&n.jsxs("div",{className:"mt-12 bg-[#FFF8F8] rounded-[2.5rem] p-8 border border-red-100 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[n.jsx(th,{className:"w-6 h-6 text-red-500"}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Deficiencies Detected"})]}),n.jsx("div",{className:"space-y-6",children:g.deficiencies.map((H,Ae)=>{var J;return n.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-md border-2 border-red-50 relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-red-500"}),n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsx("h4",{className:"font-black text-[#0F172A] text-lg",children:H.name}),n.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest ${H.severity==="severe"?"bg-red-100 text-red-600":"bg-amber-100 text-amber-600"}`,children:H.severity||"Moderate"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[n.jsxs("div",{className:"bg-slate-50 p-2.5 rounded-2xl border border-slate-100",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1",children:"Current Level"}),n.jsx("p",{className:"text-base font-black text-slate-800",children:H.currentValue||"N/A"})]}),n.jsxs("div",{className:"bg-slate-50 p-2.5 rounded-2xl border border-slate-100",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1",children:"Normal Range"}),n.jsx("p",{className:"text-base font-black text-slate-600",children:H.normalRange||"N/A"})]})]}),((J=H.symptoms)==null?void 0:J.length)>0&&n.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2",children:"Check for these symptoms"}),n.jsx("div",{className:"flex flex-wrap gap-1.5",children:H.symptoms.map((Y,se)=>n.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-600 text-[10px] font-bold rounded-lg border border-blue-100",children:Y},se))})]})]},Ae)})})]}),(g==null?void 0:g.dietPlan)&&n.jsxs("div",{className:"mt-12 bg-white rounded-[2.5rem] p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(Xp,{className:"w-6 h-6 text-emerald-500"}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Personalized Diet Plan"})]}),n.jsx("p",{className:"text-slate-500 font-medium text-sm leading-relaxed mb-8",children:"Based on your deficiencies and fitness goals, we've curated a nutrition plan to help restore optimal levels through natural food sources."}),n.jsx("div",{className:"space-y-6",children:[{label:"Breakfast Recommendatons",items:((F=g.dietPlan.breakfast)==null?void 0:F.slice(0,4))||[],color:"blue"},{label:"Lunch Options",items:((M=g.dietPlan.lunch)==null?void 0:M.slice(0,4))||[],color:"emerald"},{label:"Dinner Suggestions",items:((Q=g.dietPlan.dinner)==null?void 0:Q.slice(0,4))||[],color:"purple"},{label:"Healthy Snacks",items:((Z=g.dietPlan.snacks)==null?void 0:Z.slice(0,4))||[],color:"amber"}].map((H,Ae)=>H.items.length>0&&n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-6 border border-slate-200/50",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(aQ,{className:`w-4 h-4 text-${H.color}-500`}),n.jsx("h4",{className:"font-extrabold text-slate-800 text-sm uppercase tracking-tight",children:H.label})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:H.items.map((J,Y)=>n.jsx("div",{className:"px-4 py-2 bg-white rounded-2xl text-xs font-bold text-slate-800 border border-slate-200/60 shadow-sm",children:J.meal||J},Y))})]},Ae))})]}),(((X=($=g==null?void 0:g.recommendations)==null?void 0:$.lifestyle)==null?void 0:X.length)>0||((me=(be=g==null?void 0:g.dietPlan)==null?void 0:be.tips)==null?void 0:me.length)>0)&&n.jsxs("div",{className:"mt-12 bg-[#F0FDF4] rounded-[2.5rem] p-8 border border-emerald-100 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[n.jsx(Cr,{className:"w-6 h-6 text-emerald-600"}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Personalized Health Tips"})]}),n.jsx("div",{className:"space-y-4",children:(((Ne=g.recommendations)==null?void 0:Ne.lifestyle)||((le=g.dietPlan)==null?void 0:le.tips)||[]).map((H,Ae)=>n.jsxs("div",{className:"bg-white rounded-3xl p-6 flex gap-4 shadow-sm border border-slate-100 group relative overflow-hidden",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-gradient-to-b from-purple-400 to-orange-600"}),n.jsx("div",{className:"w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center shrink-0",children:n.jsx(nl,{className:"w-5 h-5 text-blue-500"})}),n.jsxs("div",{children:[n.jsxs("h4",{className:"font-black text-xs uppercase tracking-[0.15em] text-slate-400 mb-1",children:["Recommendation ",Ae+1]}),n.jsx("p",{className:"text-sm text-slate-700 leading-relaxed font-bold",children:H})]})]},Ae))})]}),n.jsx("div",{className:"mt-12 px-8 pb-8 text-center",children:n.jsx("p",{className:"text-slate-400 text-xs leading-relaxed font-medium",children:"Disclaimer: This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider."})})]})]})}const mle=["All","General Physician","Nutritionist","Cardiologist","Dermatologist","Endocrinologist","Neurologist"];function fle(){var Y,se,oe,Te;const a=to(),[o,c]=te.useState([]),[d,h]=te.useState([]),[m,g]=te.useState(!0),[x,v]=te.useState("All"),[E,S]=te.useState(""),[I,k]=te.useState(null),[R,O]=te.useState({date:"",timeSlot:"",symptoms:""}),[F,M]=te.useState(!1),[Q,Z]=te.useState("doctors"),[$,X]=te.useState([]),[be,me]=te.useState(!1);te.useEffect(()=>{Ne()},[x]);const Ne=async()=>{try{const he={};x!=="All"&&(he.specialization=x);const[Ce,ee]=await Promise.all([Wo.getAll(he),Wo.getAppointments()]);c(Ce.data),h(ee.data)}catch(he){console.error("Failed to fetch data:",he)}finally{g(!1)}};te.useEffect(()=>{I&&R.date&&le()},[I,R.date]);const le=async()=>{var he;if(!(!I||!R.date)){me(!0);try{const{data:Ce}=await Wo.getDoctorAvailableSlots(I._id);console.log("Slots response:",Ce);const ee=new Date(R.date).toDateString();console.log("Looking for dateKey:",ee),console.log("Available keys:",Object.keys(Ce.slotsByDate||{})),X(((he=Ce.slotsByDate)==null?void 0:he[ee])||[])}catch(Ce){console.error("Failed to fetch slots:",Ce),X([])}finally{me(!1)}}},H=o.filter(he=>{var Ce,ee,Be;return((ee=he.name||((Ce=he.user)==null?void 0:Ce.name))==null?void 0:ee.toLowerCase().includes(E.toLowerCase()))||((Be=he.specialization)==null?void 0:Be.toLowerCase().includes(E.toLowerCase()))}),Ae=async he=>{var Ce,ee;if(he.preventDefault(),!R.date||!R.timeSlot){Ct.error("Please select date and time");return}M(!0);try{await Wo.bookAppointment({doctorId:I._id,...R,type:"video"}),Ct.success("Appointment booked successfully!"),k(null),O({date:"",timeSlot:"",symptoms:""}),X([]),Ne()}catch(Be){Ct.error(((ee=(Ce=Be.response)==null?void 0:Ce.data)==null?void 0:ee.message)||"Failed to book appointment")}finally{M(!1)}},J=()=>{const he=[];for(let Ce=0;Ce<7;Ce++){const ee=new Date;ee.setDate(ee.getDate()+Ce),he.push({value:ee.toISOString().split("T")[0],label:ee.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:Ce===0})}return he};return n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Find Doctors"}),n.jsx("p",{className:"text-slate-500 mt-1",children:"Book video consultations with healthcare specialists"})]}),n.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:[n.jsxs("button",{onClick:()=>Z("doctors"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${Q==="doctors"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[n.jsx(Xd,{className:"w-4 h-4"})," Find Doctors"]}),n.jsxs("button",{onClick:()=>Z("appointments"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${Q==="appointments"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[n.jsx(Ti,{className:"w-4 h-4"})," My Appointments",d.length>0&&n.jsx("span",{className:"ml-1 px-2 py-0.5 bg-cyan-100 text-cyan-600 text-xs rounded-full",children:d.length})]})]}),Q==="doctors"&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-4 shadow-sm",children:n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(zb,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:"text",placeholder:"Search doctors...",value:E,onChange:he=>S(he.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"})]}),n.jsx("select",{value:x,onChange:he=>v(he.target.value),className:"px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:mle.map(he=>n.jsx("option",{value:he,children:he},he))})]})}),m?n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"w-10 h-10 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto"}),n.jsx("p",{className:"text-slate-500 mt-4",children:"Loading doctors..."})]}):H.length>0?n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:H.map(he=>{var ee,Be,He;const Ce=he.name||((ee=he.user)==null?void 0:ee.name)||"Doctor";return n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[n.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[n.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-xl font-bold text-white",children:(Be=Ce[0])==null?void 0:Be.toUpperCase()}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",Ce]}),n.jsx("p",{className:"text-sm text-cyan-600 font-medium",children:he.specialization}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx(zA,{className:"w-4 h-4 text-amber-400 fill-amber-400"}),n.jsx("span",{className:"text-sm text-slate-600",children:((He=he.rating)==null?void 0:He.toFixed(1))||"4.5"}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsxs("span",{className:"text-sm text-slate-500",children:[he.experience||5,"+ yrs"]})]})]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[n.jsxs("div",{children:[n.jsxs("span",{className:"text-xl font-bold text-slate-800",children:["",he.consultationFee||500]}),n.jsx("span",{className:"text-sm text-slate-500",children:" / session"})]}),n.jsx("button",{onClick:()=>k(he),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-medium rounded-xl hover:shadow-lg transition-all",children:"Book Now"})]})]},he._id)})}):n.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl border border-slate-200",children:[n.jsx(zb,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),n.jsx("p",{className:"text-slate-500",children:"No doctors found"})]})]}),Q==="appointments"&&n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsx("h2",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Your Appointments"}),d.length>0?n.jsx("div",{className:"space-y-3",children:d.map(he=>{var Ce,ee,Be,He,Ue,re,ve,fe;return n.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-white font-bold",children:((Ue=(He=((Ce=he.doctor)==null?void 0:Ce.name)||((Be=(ee=he.doctor)==null?void 0:ee.user)==null?void 0:Be.name))==null?void 0:He[0])==null?void 0:Ue.toUpperCase())||"D"}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-medium text-slate-800",children:["Dr. ",((re=he.doctor)==null?void 0:re.name)||((fe=(ve=he.doctor)==null?void 0:ve.user)==null?void 0:fe.name)]}),n.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(he.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",he.timeSlot]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${he.status==="completed"?"bg-green-100 text-green-600":he.status==="scheduled"?"bg-amber-100 text-amber-600":"bg-red-100 text-red-600"}`,children:he.status}),he.status==="scheduled"&&n.jsx("button",{onClick:()=>a(`/consultation/${he._id}`),className:"px-3 py-1 bg-cyan-500 text-white text-sm font-medium rounded-lg hover:bg-cyan-600",children:"Join Call"})]})]})},he._id)})}):n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Ti,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),n.jsx("p",{className:"text-slate-500",children:"No appointments yet"}),n.jsx("button",{onClick:()=>Z("doctors"),className:"mt-3 text-cyan-600 font-medium hover:text-cyan-700",children:"Book your first appointment "})]})]}),I&&n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Book Appointment"}),n.jsx("button",{onClick:()=>{k(null),X([]),O({date:"",timeSlot:"",symptoms:""})},className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg",children:n.jsx(Yi,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-xl mb-6",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-white font-bold",children:(oe=(se=I.name||((Y=I.user)==null?void 0:Y.name))==null?void 0:se[0])==null?void 0:oe.toUpperCase()}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-semibold text-slate-800",children:["Dr. ",I.name||((Te=I.user)==null?void 0:Te.name)]}),n.jsx("p",{className:"text-sm text-cyan-600",children:I.specialization})]})]}),n.jsxs("form",{onSubmit:Ae,className:"space-y-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Date"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:J().map(he=>n.jsxs("button",{type:"button",onClick:()=>O({...R,date:he.value,timeSlot:""}),className:`p-2 rounded-xl text-center transition-all ${R.date===he.value?"bg-cyan-500 text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200"}`,children:[n.jsx("div",{className:"text-xs font-medium",children:he.label.split(" ")[0]}),n.jsx("div",{className:"text-sm font-bold",children:he.label.split(" ")[2]})]},he.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Time"}),be?n.jsxs("div",{className:"flex items-center justify-center py-6",children:[n.jsx("div",{className:"w-6 h-6 border-2 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"}),n.jsx("span",{className:"ml-2 text-slate-500 text-sm",children:"Loading slots..."})]}):$.length>0?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:$.map(he=>{const Ce=R.timeSlot===he.timeSlot,ee=he.status==="passed",Be=he.status==="booked",He=he.status==="blocked",Ue=he.status==="available";return n.jsxs("button",{type:"button",onClick:()=>Ue&&O({...R,timeSlot:he.timeSlot}),disabled:!Ue,className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${Ce?"bg-cyan-500 text-white ring-2 ring-cyan-300":ee?"bg-slate-100 text-slate-400 cursor-not-allowed line-through":Be?"bg-red-50 text-red-400 cursor-not-allowed border border-red-200":He?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200 cursor-pointer"}`,title:ee?"Time passed":Be?"Already booked":He?"Not available":"Available",children:[he.timeSlot,Be&&n.jsx("span",{className:"ml-1 text-xs",children:"(Booked)"})]},he.timeSlot)})}),n.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-slate-500",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-100 border border-emerald-300"})," Available"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-3 h-3 rounded-full bg-red-50 border border-red-200"})," Booked"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-3 h-3 rounded-full bg-slate-100 border border-slate-200"})," Passed/Unavailable"]})]})]}):R.date?n.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[n.jsx(cl,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),n.jsx("p",{className:"text-slate-500 text-sm",children:"No slots available for this date"})]}):n.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[n.jsx(Ti,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),n.jsx("p",{className:"text-slate-500 text-sm",children:"Select a date first"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Symptoms (Optional)"}),n.jsx("textarea",{value:R.symptoms,onChange:he=>O({...R,symptoms:he.target.value}),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none resize-none",rows:3,placeholder:"Describe your symptoms..."})]}),n.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ah,{className:"w-5 h-5 text-cyan-600"}),n.jsx("span",{className:"font-medium text-cyan-700",children:"Video Consultation"})]}),n.jsx("p",{className:"text-xs text-cyan-600 mt-1",children:"You'll receive a video call link via email"})]}),n.jsxs("div",{className:"flex gap-3 pt-2",children:[n.jsx("button",{type:"button",onClick:()=>{k(null),X([])},className:"flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 transition-all",children:"Cancel"}),n.jsx("button",{type:"submit",disabled:F||!R.date||!R.timeSlot,className:"flex-1 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-medium rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:F?"Booking...":`Confirm  ${I.consultationFee||500}`})]})]})]})})]})}function gle(){var me,Ne,le,H,Ae,J,Y,se,oe,Te,he,Ce,ee,Be,He,Ue,re,ve,fe,Ie,je,Ee,We,ze,st,bt,Qe,rt,Nt,we,Rt;const{user:a,updateUser:o}=aa(),[c]=JV(),[d,h]=te.useState(!1),[m,g]=te.useState(c.get("tab")||"profile"),[x,v]=te.useState(null),[E,S]=te.useState(!1),[I,k]=te.useState({goalType:"maintenance",currentWeight:((me=a==null?void 0:a.profile)==null?void 0:me.weight)||"",targetWeight:"",height:((Ne=a==null?void 0:a.profile)==null?void 0:Ne.height)||"",age:((le=a==null?void 0:a.profile)==null?void 0:le.age)||"",gender:((H=a==null?void 0:a.profile)==null?void 0:H.gender)||"male",activityLevel:"moderate",dietaryPreference:((Ae=a==null?void 0:a.profile)==null?void 0:Ae.dietaryPreference)||"non-vegetarian"}),[R,O]=te.useState({name:(a==null?void 0:a.name)||"",profile:{age:((J=a==null?void 0:a.profile)==null?void 0:J.age)||"",gender:((Y=a==null?void 0:a.profile)==null?void 0:Y.gender)||"",dietaryPreference:((se=a==null?void 0:a.profile)==null?void 0:se.dietaryPreference)||"non-vegetarian",height:((oe=a==null?void 0:a.profile)==null?void 0:oe.height)||"",weight:((Te=a==null?void 0:a.profile)==null?void 0:Te.weight)||"",bloodGroup:((he=a==null?void 0:a.profile)==null?void 0:he.bloodGroup)||"",medicalHistory:{conditions:((ee=(Ce=a==null?void 0:a.profile)==null?void 0:Ce.medicalHistory)==null?void 0:ee.conditions)||[]},lifestyle:{smoker:((He=(Be=a==null?void 0:a.profile)==null?void 0:Be.lifestyle)==null?void 0:He.smoker)||!1,alcohol:((re=(Ue=a==null?void 0:a.profile)==null?void 0:Ue.lifestyle)==null?void 0:re.alcohol)||!1,sleepHours:((fe=(ve=a==null?void 0:a.profile)==null?void 0:ve.lifestyle)==null?void 0:fe.sleepHours)||"7",stressLevel:((je=(Ie=a==null?void 0:a.profile)==null?void 0:Ie.lifestyle)==null?void 0:je.stressLevel)||"moderate",waterIntake:((We=(Ee=a==null?void 0:a.profile)==null?void 0:Ee.lifestyle)==null?void 0:We.waterIntake)||"8"},diabetesProfile:((ze=a==null?void 0:a.profile)==null?void 0:ze.diabetesProfile)||null}});te.useEffect(()=>{(async()=>{try{const et=localStorage.getItem("token"),$e=await Hr.get("/api/nutrition/goals",{headers:{Authorization:`Bearer ${et}`}});$e.data.healthGoal&&(v($e.data.healthGoal),k({goalType:$e.data.healthGoal.goalType,currentWeight:$e.data.healthGoal.currentWeight,targetWeight:$e.data.healthGoal.targetWeight,height:$e.data.healthGoal.height,age:$e.data.healthGoal.age,gender:$e.data.healthGoal.gender,activityLevel:$e.data.healthGoal.activityLevel,dietaryPreference:$e.data.healthGoal.dietaryPreference}))}catch{console.log("No health goal set yet")}})()},[]);const F=Fe=>{const{name:et,value:$e,type:Kt,checked:qt}=Fe.target;if(et.startsWith("profile.lifestyle.")){const Xe=et.split(".")[2];O(ht=>({...ht,profile:{...ht.profile,lifestyle:{...ht.profile.lifestyle,[Xe]:Kt==="checkbox"?qt:$e}}}))}else if(et.startsWith("profile.diabetesProfile.")){const Xe=et.split(".")[2];O(ht=>({...ht,profile:{...ht.profile,diabetesProfile:{...ht.profile.diabetesProfile,[Xe]:$e}}}))}else if(et.startsWith("profile.")){const Xe=et.split(".")[1];O(ht=>({...ht,profile:{...ht.profile,[Xe]:$e}}))}else O(Xe=>({...Xe,[et]:$e}))},M=async Fe=>{var et,$e;Fe.preventDefault(),h(!0);try{const Kt={name:R.name,profile:{...R.profile,age:R.profile.age?Number(R.profile.age):void 0,height:R.profile.height?Number(R.profile.height):void 0,weight:R.profile.weight?Number(R.profile.weight):void 0,lifestyle:{...R.profile.lifestyle,sleepHours:Number(R.profile.lifestyle.sleepHours),waterIntake:Number(R.profile.lifestyle.waterIntake)}}},{data:qt}=await Wt.put("/auth/profile",Kt);o(qt),Ct.success("Profile updated successfully!")}catch(Kt){Ct.error((($e=(et=Kt.response)==null?void 0:et.data)==null?void 0:$e.message)||"Failed to update profile")}finally{h(!1)}},Q=async Fe=>{var et,$e;Fe.preventDefault(),S(!0);try{const Kt=localStorage.getItem("token"),qt={...I,currentWeight:Number(I.currentWeight),targetWeight:Number(I.targetWeight),height:Number(I.height),age:Number(I.age)},Xe=await Hr.post("/api/nutrition/goals",qt,{headers:{Authorization:`Bearer ${Kt}`}});v(Xe.data.healthGoal),Ct.success("Fitness goal set successfully! Your daily targets have been calculated.")}catch(Kt){Ct.error((($e=(et=Kt.response)==null?void 0:et.data)==null?void 0:$e.message)||"Failed to set fitness goal")}finally{S(!1)}},Z=Fe=>{const{name:et,value:$e}=Fe.target;k(Kt=>({...Kt,[et]:$e}))},$=R.profile.height&&R.profile.weight?(R.profile.weight/Math.pow(R.profile.height/100,2)).toFixed(1):null,be=(Fe=>Fe?Fe<18.5?{label:"Underweight",color:"blue"}:Fe<25?{label:"Normal",color:"emerald"}:Fe<30?{label:"Overweight",color:"amber"}:{label:"Obese",color:"red"}:{label:"N/A",color:"slate"})(parseFloat($));return n.jsxs("div",{className:"w-full overflow-x-hidden space-y-6 animate-fade-in px-3 md:px-6",children:[n.jsxs("div",{className:"md:hidden flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-sm font-bold shadow-md flex-shrink-0",children:((bt=(st=a==null?void 0:a.name)==null?void 0:st[0])==null?void 0:bt.toUpperCase())||"U"}),n.jsxs("h1",{className:"text-sm font-bold text-slate-800 truncate",children:[(()=>{const Fe=new Date().getHours();return Fe<12?"Good Morning":Fe<18?"Good Afternoon":"Good Evening"})(),", ",((Qe=a==null?void 0:a.name)==null?void 0:Qe.split(" ")[0])||"there","!"]})]}),n.jsx("button",{className:"w-9 h-9 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all flex-shrink-0",children:n.jsx(WA,{className:"w-4 h-4 text-slate-700"})})]}),n.jsxs("div",{className:"hidden md:block",children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"My Profile"}),n.jsx("p",{className:"text-slate-500 mt-1",children:"Manage your information and track health progress"})]}),n.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-orange-500 rounded-2xl p-3 md:p-6 text-white relative overflow-hidden shadow-lg",children:[n.jsx("div",{className:"absolute inset-0 opacity-10",children:n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),n.jsxs("div",{className:"relative flex flex-col gap-4 md:gap-6",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:gap-6",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-2xl md:text-3xl font-bold",children:(Nt=(rt=a==null?void 0:a.name)==null?void 0:rt[0])==null?void 0:Nt.toUpperCase()}),n.jsx("button",{className:"absolute -bottom-2 -right-2 w-8 h-8 bg-white rounded-full flex items-center justify-center text-cyan-600 shadow-lg hover:scale-110 transition-transform",children:n.jsx(tI,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:a==null?void 0:a.name}),n.jsxs("div",{className:"flex flex-col gap-2 mt-2 text-white/90 text-sm md:text-base",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(ax,{className:"w-4 h-4 flex-shrink-0"})," ",a==null?void 0:a.email]}),(a==null?void 0:a.phone)&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(sI,{className:"w-4 h-4 flex-shrink-0"})," ",a==null?void 0:a.phone]})]})]})]}),n.jsxs("div",{className:"flex gap-3 md:gap-4",children:[n.jsxs("div",{className:"text-center p-3 md:p-4 bg-white/10 backdrop-blur-sm rounded-xl flex-1",children:[n.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:((we=a==null?void 0:a.healthMetrics)==null?void 0:we.healthScore)||"--"}),n.jsx("p",{className:"text-xs md:text-sm text-white/80",children:"Health Score"})]}),$&&n.jsxs("div",{className:"text-center p-3 md:p-4 bg-white/10 backdrop-blur-sm rounded-xl flex-1",children:[n.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:$}),n.jsx("p",{className:"text-xs md:text-sm text-white/80",children:"BMI"})]})]})]})]}),n.jsx(mce,{}),n.jsx("div",{className:"flex gap-1 md:gap-2 p-1 bg-slate-100 rounded-xl w-full md:w-fit overflow-x-auto",children:[{id:"profile",label:"Profile",icon:Xd},{id:"goals",label:"Set Goal",icon:Zl}].map(Fe=>n.jsxs("button",{onClick:()=>g(Fe.id),className:`flex items-center gap-1 md:gap-2 px-3 md:px-5 py-2 md:py-2.5 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${m===Fe.id?"bg-white text-slate-800 shadow-sm":"text-slate-600 hover:text-slate-800"}`,children:[n.jsx(Fe.icon,{className:"w-4 h-4"}),Fe.label]},Fe.id))}),m==="profile"&&n.jsxs("form",{onSubmit:M,className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[n.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-base md:text-lg font-bold text-slate-800 mb-4 md:mb-6 flex items-center gap-2",children:[n.jsx(Xd,{className:"w-5 h-5 text-cyan-500"}),"Basic Information"]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),n.jsx("input",{type:"text",name:"name",value:R.name,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),n.jsx("input",{type:"email",value:a==null?void 0:a.email,className:"w-full bg-slate-50 border border-slate-200 rounded-xl py-3 px-4 text-slate-500",disabled:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),n.jsx("input",{type:"number",name:"profile.age",value:R.profile.age,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"1",max:"120",placeholder:"Enter your age"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),n.jsxs("select",{name:"profile.gender",value:R.profile.gender,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[n.jsx("option",{value:"",children:"Select gender"}),n.jsx("option",{value:"male",children:"Male"}),n.jsx("option",{value:"female",children:"Female"}),n.jsx("option",{value:"other",children:"Other"})]})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),n.jsxs("select",{name:"profile.dietaryPreference",value:R.profile.dietaryPreference,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[n.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),n.jsx("option",{value:"vegetarian",children:"Vegetarian"}),n.jsx("option",{value:"vegan",children:"Vegan"}),n.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Vi,{className:"w-5 h-5 text-red-500"}),"Health Information"]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),n.jsx("input",{type:"number",name:"profile.height",value:R.profile.height,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"50",max:"300",placeholder:"170"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Weight (kg)"}),n.jsx("input",{type:"number",name:"profile.weight",value:R.profile.weight,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"10",max:"500",placeholder:"70"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Blood Group"}),n.jsxs("select",{name:"profile.bloodGroup",value:R.profile.bloodGroup,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[n.jsx("option",{value:"",children:"Select"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(Fe=>n.jsx("option",{value:Fe,children:Fe},Fe))]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Ln,{className:"w-5 h-5 text-amber-500"}),"Medical Conditions"]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Chronic Conditions ",n.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),n.jsx("input",{type:"text",name:"profile.medicalHistory.conditions",value:R.profile.medicalHistory.conditions.join(", "),onChange:Fe=>{const et=Fe.target.value.split(",").map($e=>$e.trim()).filter(Boolean);O($e=>({...$e,profile:{...$e.profile,medicalHistory:{...$e.profile.medicalHistory,conditions:et}}}))},className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Diabetes, Hypertension"})]})]}),R.profile.diabetesProfile&&n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Zu,{className:"w-5 h-5 text-purple-500"}),"Diabetes Management"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Diabetes Type"}),n.jsxs("select",{name:"profile.diabetesProfile.type",value:R.profile.diabetesProfile.type,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4",children:[n.jsx("option",{value:"Type 1",children:"Type 1"}),n.jsx("option",{value:"Type 2",children:"Type 2"}),n.jsx("option",{value:"Prediabetes",children:"Prediabetes"}),n.jsx("option",{value:"Gestational",children:"Gestational"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"HbA1c Level (%)"}),n.jsx("input",{type:"number",step:"0.1",name:"profile.diabetesProfile.hba1c",value:R.profile.diabetesProfile.hba1c,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Diagnosis Year"}),n.jsx("input",{type:"number",name:"profile.diabetesProfile.diagnosisYear",value:R.profile.diabetesProfile.diagnosisYear,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Current Status"}),n.jsxs("select",{name:"profile.diabetesProfile.status",value:R.profile.diabetesProfile.status,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4",children:[n.jsx("option",{value:"Controlled",children:"Controlled"}),n.jsx("option",{value:"Uncontrolled",children:"Uncontrolled"}),n.jsx("option",{value:"Newly diagnosed",children:"Newly diagnosed"})]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Cr,{className:"w-5 h-5 text-green-500"}),"Lifestyle Habits"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Sleep Hours"}),n.jsx("input",{type:"number",name:"profile.lifestyle.sleepHours",value:R.profile.lifestyle.sleepHours,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Water Intake (glasses)"}),n.jsx("input",{type:"number",name:"profile.lifestyle.waterIntake",value:R.profile.lifestyle.waterIntake,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Stress Level"}),n.jsxs("select",{name:"profile.lifestyle.stressLevel",value:R.profile.lifestyle.stressLevel,onChange:F,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500",children:[n.jsx("option",{value:"low",children:"Low"}),n.jsx("option",{value:"moderate",children:"Moderate"}),n.jsx("option",{value:"high",children:"High"})]})]}),n.jsxs("div",{className:"flex flex-col gap-4 justify-center",children:[n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",name:"profile.lifestyle.smoker",checked:R.profile.lifestyle.smoker,onChange:F,className:"w-5 h-5 text-cyan-500 rounded border-slate-300 focus:ring-cyan-500"}),n.jsx("span",{className:"text-slate-700 font-medium",children:"Smoker"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",name:"profile.lifestyle.alcohol",checked:R.profile.lifestyle.alcohol,onChange:F,className:"w-5 h-5 text-cyan-500 rounded border-slate-300 focus:ring-cyan-500"}),n.jsx("span",{className:"text-slate-700 font-medium",children:"Consume Alcohol"})]})]})]})]}),n.jsx("button",{type:"submit",disabled:d,className:"w-full py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:d?n.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):n.jsxs(n.Fragment,{children:[n.jsx(oQ,{className:"w-5 h-5"}),"Save Changes"]})})]}),n.jsxs("div",{className:"space-y-6",children:[$&&n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"BMI Calculator"}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:`w-24 h-24 rounded-full bg-${be.color}-100 flex items-center justify-center mx-auto mb-4`,children:n.jsx("span",{className:`text-3xl font-bold text-${be.color}-600`,children:$})}),n.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium bg-${be.color}-100 text-${be.color}-700`,children:be.label})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Quick Stats"}),n.jsx("div",{className:"space-y-3",children:n.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[n.jsx("span",{className:"text-slate-600",children:"Subscription"}),n.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-medium capitalize",children:((Rt=a==null?void 0:a.subscription)==null?void 0:Rt.plan)||"Free"})]})})]})]})]}),m==="goals"&&n.jsxs("form",{onSubmit:Q,className:"max-w-4xl space-y-6",children:[x&&n.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-orange-50 rounded-2xl border-2 border-blue-200 p-3 md:p-6 shadow-sm w-full overflow-hidden",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3 md:gap-4 mb-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg md:text-xl font-bold text-blue-900 mb-1",children:"Your Current Goal"}),n.jsx("p",{className:"text-xs md:text-sm text-blue-700",children:"Daily targets calculated based on your goal"})]}),n.jsx("div",{className:"px-3 md:px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold capitalize text-sm md:text-base whitespace-nowrap",children:x.goalType.replace("_"," ")})]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mt-4",children:[n.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[n.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Daily Calories"}),n.jsx("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:x.dailyCalorieTarget})]}),n.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[n.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Protein"}),n.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[x.macroTargets.protein,"g"]})]}),n.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[n.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Carbs"}),n.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[x.macroTargets.carbs,"g"]})]}),n.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[n.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Fats"}),n.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[x.macroTargets.fats,"g"]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:x?"Update Your Fitness Goal":"Set Your Fitness Goal"}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Goal Type"}),n.jsxs("select",{name:"goalType",value:I.goalType,onChange:Z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[n.jsx("option",{value:"weight_loss",children:"Weight Loss (Fat Loss)"}),n.jsx("option",{value:"muscle_gain",children:"Muscle Gain (Bulking)"}),n.jsx("option",{value:"weight_gain",children:"Weight Gain"}),n.jsx("option",{value:"maintenance",children:"Maintenance"}),n.jsx("option",{value:"health_improvement",children:"Health Improvement"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Activity Level"}),n.jsxs("select",{name:"activityLevel",value:I.activityLevel,onChange:Z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[n.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),n.jsx("option",{value:"light",children:"Light (Exercise 1-3 days/week)"}),n.jsx("option",{value:"moderate",children:"Moderate (Exercise 3-5 days/week)"}),n.jsx("option",{value:"active",children:"Active (Exercise 6-7 days/week)"}),n.jsx("option",{value:"very_active",children:"Very Active (Hard exercise daily)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Current Weight (kg)"}),n.jsx("input",{type:"number",name:"currentWeight",value:I.currentWeight,onChange:Z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Target Weight (kg)"}),n.jsx("input",{type:"number",name:"targetWeight",value:I.targetWeight,onChange:Z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),n.jsx("input",{type:"number",name:"height",value:I.height,onChange:Z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"100",max:"250"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),n.jsx("input",{type:"number",name:"age",value:I.age,onChange:Z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"10",max:"120"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),n.jsxs("select",{name:"gender",value:I.gender,onChange:Z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[n.jsx("option",{value:"male",children:"Male"}),n.jsx("option",{value:"female",children:"Female"}),n.jsx("option",{value:"other",children:"Other"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),n.jsxs("select",{name:"dietaryPreference",value:I.dietaryPreference,onChange:Z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[n.jsx("option",{value:"vegetarian",children:"Vegetarian"}),n.jsx("option",{value:"vegan",children:"Vegan"}),n.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),n.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]}),n.jsxs("button",{type:"submit",disabled:E,className:"mt-6 w-full md:w-auto px-8 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white rounded-lg font-medium hover:shadow-lg disabled:opacity-50 flex items-center justify-center gap-2",children:[n.jsx(Zl,{className:"w-5 h-5"}),E?"Calculating...":x?"Update Goal":"Set Goal & Calculate Targets"]})]}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:n.jsxs("div",{className:"flex gap-3",children:[n.jsx(Ln,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"How it works (Scientifically Backed)"}),n.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:["We use the ",n.jsx("strong",{children:"Mifflin-St Jeor equation"})," (industry standard used by WHO, fitness apps, and hospitals) to calculate your BMR:"]}),n.jsxs("p",{className:"text-xs text-blue-600 font-mono mb-2",children:["Male: BMR = (10  weight) + (6.25  height)  (5  age) + 5",n.jsx("br",{}),"Female: BMR = (10  weight) + (6.25  height)  (5  age)  161"]}),n.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Then we calculate TDEE (Total Daily Energy Expenditure) by multiplying BMR with your activity level, and adjust calories based on your goal:"}),n.jsxs("ul",{className:"text-xs text-blue-600 space-y-1 ml-4",children:[n.jsx("li",{children:" Muscle Gain: +350 calories"}),n.jsx("li",{children:" Fat Loss: -400 calories"}),n.jsx("li",{children:" Maintenance: No adjustment"})]}),n.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:[n.jsx("strong",{children:"Macros:"})," Protein = 1.6g per kg body weight (realistic & sustainable), Fats = 0.8g per kg, Carbs = remaining calories. These targets will be used throughout the platform to track your nutrition and provide personalized recommendations."]})]})]})})]})]})}const Y2={name:"John Doe",email:"john@example.com",profile:{age:32,gender:"male",height:175,weight:72,bloodGroup:"O+",allergies:["Penicillin"],chronicConditions:["None"]}},ble=[{date:"Jul",score:65},{date:"Aug",score:68},{date:"Sep",score:72},{date:"Oct",score:70},{date:"Nov",score:75},{date:"Dec",score:78}],ql={summary:"Overall health is good with some areas needing attention. Blood sugar levels are slightly elevated.",keyFindings:["Hemoglobin levels are normal at 14.2 g/dL","Cholesterol is borderline high at 210 mg/dL","Vitamin D deficiency detected"],riskFactors:["Pre-diabetic blood sugar levels","Sedentary lifestyle indicators"],metrics:{hemoglobin:{value:14.2,unit:"g/dL",status:"normal",normalRange:"12-16"},bloodSugar:{value:115,unit:"mg/dL",status:"borderline",normalRange:"70-100"},cholesterol:{value:210,unit:"mg/dL",status:"borderline",normalRange:"<200"}},recommendations:{diet:[{item:"Leafy Greens",reason:"Rich in iron and vitamins",priority:"high"},{item:"Fatty Fish",reason:"Omega-3 helps reduce cholesterol",priority:"high"},{item:"Nuts & Seeds",reason:"Good fats for heart health",priority:"medium"}],exercise:[{activity:"Brisk Walking",duration:"30 mins",frequency:"daily",reason:"Improves cardiovascular health"},{activity:"Strength Training",duration:"20 mins",frequency:"3x/week",reason:"Builds muscle"}]},doctorConsultation:{specializations:["Endocrinologist","Cardiologist"],reason:"Blood sugar and cholesterol need monitoring"}},uR=[{_id:"1",name:"Dr. Sarah Johnson",specialization:"Cardiologist",experience:12,fee:800,rating:4.8,reviews:124,hospital:"City Heart Hospital",available:!0,slots:["09:00 AM","10:00 AM","11:00 AM","02:00 PM","03:00 PM"]},{_id:"2",name:"Dr. Raj Patel",specialization:"Endocrinologist",experience:15,fee:900,rating:4.9,reviews:89,hospital:"Diabetes Care Center",available:!0,slots:["10:00 AM","11:00 AM","04:00 PM","05:00 PM"]},{_id:"3",name:"Dr. Emily Chen",specialization:"General Physician",experience:8,fee:500,rating:4.7,reviews:156,hospital:"Family Health Clinic",available:!0,slots:["09:00 AM","10:00 AM","02:00 PM","03:00 PM","04:00 PM"]},{_id:"4",name:"Dr. Michael Brown",specialization:"Neurologist",experience:18,fee:1200,rating:4.9,reviews:67,hospital:"Neuro Care Institute",available:!0,slots:["11:00 AM","02:00 PM","03:00 PM"]},{_id:"5",name:"Dr. Priya Sharma",specialization:"Dermatologist",experience:10,fee:600,rating:4.6,reviews:203,hospital:"Skin & Care Clinic",available:!1,slots:[]}],xle=[{_id:"apt1",doctor:uR[1],date:"2024-12-15",timeSlot:"10:00 AM",status:"confirmed",type:"online",meetLink:"https://meet.healthai.com/apt-xyz123",amountPaid:450}],L6={summary:"Your health has improved since your last checkup.",metricChanges:[{metric:"Health Score",previous:"72",current:"78",change:"improved"},{metric:"Blood Sugar",previous:"125 mg/dL",current:"115 mg/dL",change:"improved"}]},X2={cholesterol:"Your cholesterol level of 210 mg/dL is borderline high. Focus on reducing saturated fats and increasing fiber. Regular exercise helps too.",worried:"No immediate alarm, but attention needed. Blood sugar is pre-diabetic and cholesterol borderline. Lifestyle changes can help. Follow up with specialists.",default:"Your health score is 78/100. Key areas: managing blood sugar and cholesterol through diet and exercise. Ask me anything specific!"},j6=["All","Cardiologist","Endocrinologist","General Physician","Neurologist","Dermatologist","Orthopedic","Pediatrician"],vle=["Blood Test","X-Ray","MRI","CT Scan","ECG","General Checkup"];function wle(){const[a,o]=te.useState("dashboard"),[c,d]=te.useState(!1),[h,m]=te.useState([]),[g,x]=te.useState(""),[v,E]=te.useState(!1),[S,I]=te.useState(!1),[k,R]=te.useState(null),[O,F]=te.useState(0),[M,Q]=te.useState({date:"",slot:"",type:"online"}),[Z,$]=te.useState(uR),[X,be]=te.useState(xle),[me,Ne]=te.useState("All"),[le,H]=te.useState(""),[Ae,J]=te.useState(0),[Y,se]=te.useState(null),[oe,Te]=te.useState(!1),[he,Ce]=te.useState({name:"",specialization:"",experience:"",fee:"",hospital:""}),[ee,Be]=te.useState(!1),[He,Ue]=te.useState(Y2.profile),re=te.useRef(null);te.useEffect(()=>{var Fe;(Fe=re.current)==null||Fe.scrollIntoView({behavior:"smooth"})},[h]);const ve=Fe=>{if(Fe.preventDefault(),!g.trim())return;const et=g.toLowerCase();m($e=>[...$e,{role:"user",content:g}]),x(""),setTimeout(()=>{const $e=Object.keys(X2).find(Kt=>et.includes(Kt));m(Kt=>[...Kt,{role:"assistant",content:X2[$e]||X2.default}])},800)},fe=()=>{if(O===0)F(1);else if(O===1&&M.date&&M.slot)F(2);else if(O===2){const Fe={_id:`apt${Date.now()}`,doctor:k,date:M.date,timeSlot:M.slot,status:"confirmed",type:M.type,meetLink:`https://meet.healthai.com/apt-${Math.random().toString(36).substr(2,9)}`,amountPaid:k.fee/2};be(et=>[Fe,...et]),F(3)}},Ie=()=>{R(null),F(0),Q({date:"",slot:"",type:"online"})},je=()=>{Ae===0&&Y&&(J(1),Te(!0),setTimeout(()=>{Te(!1),J(2)},2500))},Ee=()=>{he.name&&he.specialization&&he.fee&&($(Fe=>[...Fe,{...he,_id:`doc${Date.now()}`,rating:4.5,reviews:0,available:!0,slots:["10:00 AM","02:00 PM","04:00 PM"]}]),Ce({name:"",specialization:"",experience:"",fee:"",hospital:""}),Be(!1))},We=Z.filter(Fe=>(me==="All"||Fe.specialization===me)&&Fe.name.toLowerCase().includes(le.toLowerCase())),ze=({trend:Fe})=>Fe==="improved"?n.jsx(va,{className:"w-4 h-4 text-green-600"}):Fe==="declined"?n.jsx(rE,{className:"w-4 h-4 text-red-600"}):n.jsx(Cg,{className:"w-4 h-4 text-gray-400"}),st=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome back, John!"}),n.jsx("p",{className:"text-gray-600",children:"Here's your health overview"})]}),n.jsxs("button",{onClick:()=>o("upload"),className:"btn-primary flex items-center gap-2",children:[n.jsx(il,{className:"w-4 h-4"})," Upload Report"]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{icon:Cr,color:"primary",label:"Health Score",value:"78/100"},{icon:Bn,color:"blue",label:"Total Reports",value:"6"},{icon:va,color:"green",label:"BMI",value:"23.5"},{icon:Ti,color:"purple",label:"Last Checkup",value:"Dec 5"}].map((Fe,et)=>n.jsx("div",{className:"card",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:`w-12 h-12 bg-${Fe.color}-100 rounded-xl flex items-center justify-center`,children:n.jsx(Fe.icon,{className:`w-6 h-6 text-${Fe.color}-600`})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-500",children:Fe.label}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Fe.value})]})]})},et))}),X.length>0&&n.jsxs("div",{className:"card border-2 border-green-200 bg-green-50/30",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(Ti,{className:"w-5 h-5 text-green-600"})," Upcoming Appointments"]}),X.filter(Fe=>Fe.status==="confirmed").map(Fe=>n.jsxs("div",{className:"bg-white p-4 rounded-xl flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:Fe.doctor.name[4]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium",children:Fe.doctor.name}),n.jsxs("p",{className:"text-sm text-gray-500",children:[Fe.doctor.specialization,"  ",Fe.date," at ",Fe.timeSlot]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[Fe.type==="online"&&Fe.meetLink&&n.jsxs("a",{href:Fe.meetLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:[n.jsx(ah,{className:"w-4 h-4"})," Join Call"]}),n.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:"Confirmed"})]})]},Fe._id))]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Score Trend"}),n.jsx(Yb,{width:"100%",height:200,children:n.jsxs(cQ,{data:ble,children:[n.jsx(nE,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),n.jsx(iE,{dataKey:"date"}),n.jsx(aE,{domain:[0,100]}),n.jsx($R,{}),n.jsx(lQ,{type:"monotone",dataKey:"score",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"}})]})})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"card",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(Xp,{className:"w-5 h-5 text-green-600"}),n.jsx("h3",{className:"font-semibold",children:"Diet Recommendations"})]}),n.jsx("ul",{className:"space-y-2",children:ql.recommendations.diet.map((Fe,et)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-2"}),n.jsxs("span",{children:[n.jsx("strong",{children:Fe.item})," - ",Fe.reason]})]},et))})]}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(Oy,{className:"w-5 h-5 text-blue-600"}),n.jsx("h3",{className:"font-semibold",children:"Exercise Plan"})]}),n.jsx("ul",{className:"space-y-2",children:ql.recommendations.exercise.map((Fe,et)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),n.jsxs("span",{children:[n.jsx("strong",{children:Fe.activity})," - ",Fe.duration,", ",Fe.frequency]})]},et))})]})]}),n.jsx("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Ln,{className:"w-5 h-5 text-orange-600 mt-0.5"}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold",children:"Doctor Consultation Recommended"}),n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:ql.doctorConsultation.reason}),n.jsxs("p",{className:"text-sm mt-2",children:[n.jsx("strong",{children:"Specialists:"})," ",ql.doctorConsultation.specializations.join(", ")]}),n.jsx("button",{onClick:()=>o("doctors"),className:"btn-primary mt-3 text-sm",children:"Find Doctors"})]})]})})]}),bt=()=>n.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Upload Health Report"}),n.jsx("p",{className:"text-gray-600",children:"Upload your medical report for AI-powered analysis"})]}),Ae===0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"card",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Report Type"}),n.jsx("select",{className:"input",children:vle.map(Fe=>n.jsx("option",{children:Fe},Fe))})]}),n.jsxs("div",{className:"card",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Upload File"}),Y?n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Bn,{className:"w-10 h-10 text-primary-600"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium",children:Y.name}),n.jsxs("p",{className:"text-sm text-gray-500",children:[Y.size," MB"]})]})]}),n.jsx("button",{onClick:()=>se(null),className:"p-2 text-gray-400 hover:text-red-500",children:n.jsx(Yi,{className:"w-5 h-5"})})]}):n.jsxs("div",{onClick:()=>se({name:"blood_test_report.pdf",size:2.4}),className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center cursor-pointer hover:border-primary-400 transition-colors",children:[n.jsx(il,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop or click to upload"}),n.jsx("p",{className:"text-sm text-gray-500",children:"PDF, PNG, JPG - max 10MB"})]})]}),n.jsxs("button",{onClick:je,disabled:!Y,className:"btn-primary w-full flex items-center justify-center gap-2",children:[n.jsx(il,{className:"w-5 h-5"})," Analyze Report"]})]}),Ae===1&&n.jsxs("div",{className:"card text-center py-12",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-semibold",children:"Analyzing Your Report..."}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Our AI is extracting insights from your report"}),n.jsx("div",{className:"mt-6 space-y-2 text-left max-w-xs mx-auto",children:["Extracting text from PDF...","Analyzing health metrics...","Generating recommendations..."].map((Fe,et)=>n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx(eh,{className:"w-4 h-4 text-green-600"}),n.jsx("span",{children:Fe})]},et))})]}),Ae===2&&n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"card bg-green-50 border-2 border-green-200",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(eh,{className:"w-8 h-8 text-green-600"}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Analysis Complete!"}),n.jsx("p",{className:"text-green-700",children:"Your report has been analyzed successfully"})]})]})}),n.jsx("button",{onClick:()=>o("report"),className:"btn-primary w-full",children:"View Full Analysis"})]}),n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl text-sm text-blue-800",children:[n.jsx("strong",{children:"Note:"})," AI analysis is for informational purposes only. Always consult a healthcare provider."]})]}),Qe=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:c?"Manage Doctors":"Find Doctors"}),n.jsx("p",{className:"text-gray-600",children:c?"Add and manage platform doctors":"Book consultations with specialists"})]}),c&&n.jsxs("button",{onClick:()=>Be(!0),className:"btn-primary flex items-center gap-2",children:[n.jsx($l,{className:"w-4 h-4"})," Add Doctor"]})]}),n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(zb,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"text",placeholder:"Search doctors...",value:le,onChange:Fe=>H(Fe.target.value),className:"input pl-12"})]}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:j6.slice(0,5).map(Fe=>n.jsx("button",{onClick:()=>Ne(Fe),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${me===Fe?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:Fe},Fe))})]}),n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:We.map(Fe=>{var et;return n.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-xl flex items-center justify-center text-2xl font-bold text-primary-600",children:((et=Fe.name.split(" ")[1])==null?void 0:et[0])||Fe.name[0]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:Fe.name}),n.jsx("p",{className:"text-sm text-primary-600",children:Fe.specialization}),n.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[n.jsx(zA,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),n.jsx("span",{className:"text-sm font-medium",children:Fe.rating}),n.jsxs("span",{className:"text-sm text-gray-500",children:["(",Fe.reviews,")"]})]})]})]}),n.jsxs("div",{className:"mt-4 space-y-2 text-sm text-gray-600",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(cl,{className:"w-4 h-4"}),n.jsxs("span",{children:[Fe.experience," years experience"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(KT,{className:"w-4 h-4"}),n.jsx("span",{children:Fe.hospital})]})]}),n.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["",Fe.fee]}),n.jsx("span",{className:"text-sm text-gray-500",children:" / session"})]}),Fe.available?n.jsx("button",{onClick:()=>{R(Fe),F(0)},className:"btn-primary text-sm",children:"Book Now"}):n.jsx("span",{className:"px-3 py-1.5 bg-gray-100 text-gray-500 rounded-xl text-sm",children:"Unavailable"})]})]},Fe._id)})}),ee&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Add New Doctor"}),n.jsx("button",{onClick:()=>Be(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Yi,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Doctor Name"}),n.jsx("input",{type:"text",value:he.name,onChange:Fe=>Ce({...he,name:Fe.target.value}),className:"input",placeholder:"Dr. John Smith"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specialization"}),n.jsxs("select",{value:he.specialization,onChange:Fe=>Ce({...he,specialization:Fe.target.value}),className:"input",children:[n.jsx("option",{value:"",children:"Select"}),j6.slice(1).map(Fe=>n.jsx("option",{children:Fe},Fe))]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Experience (yrs)"}),n.jsx("input",{type:"number",value:he.experience,onChange:Fe=>Ce({...he,experience:Fe.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fee ()"}),n.jsx("input",{type:"number",value:he.fee,onChange:Fe=>Ce({...he,fee:Fe.target.value}),className:"input"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hospital/Clinic"}),n.jsx("input",{type:"text",value:he.hospital,onChange:Fe=>Ce({...he,hospital:Fe.target.value}),className:"input"})]}),n.jsx("button",{onClick:Ee,className:"btn-primary w-full",children:"Add Doctor"})]})]})})]}),rt=()=>{var Fe;return k&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[O<3&&n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-bold",children:O===0?"Book Appointment":O===1?"Select Slot":"Payment"}),n.jsx("button",{onClick:Ie,className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Yi,{className:"w-5 h-5"})})]}),O===0&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[n.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-full flex items-center justify-center text-xl font-bold text-primary-600",children:(Fe=k.name.split(" ")[1])==null?void 0:Fe[0]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold",children:k.name}),n.jsx("p",{className:"text-sm text-primary-600",children:k.specialization}),n.jsx("p",{className:"text-sm text-gray-500",children:k.hospital})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consultation Type"}),n.jsx("div",{className:"flex gap-4",children:["online","in-person"].map(et=>n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"radio",name:"type",checked:M.type===et,onChange:()=>Q({...M,type:et}),className:"text-primary-600"}),et==="online"?n.jsxs(n.Fragment,{children:[n.jsx(ah,{className:"w-4 h-4"})," Online"]}):n.jsxs(n.Fragment,{children:[n.jsx(KT,{className:"w-4 h-4"})," In-Person"]})]},et))})]}),n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl",children:[n.jsxs("p",{className:"text-sm text-blue-800",children:[n.jsx("strong",{children:"Consultation Fee:"})," ",k.fee]}),n.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Pay ",k.fee/2," now to confirm (50% advance)"]})]}),n.jsx("button",{onClick:fe,className:"btn-primary w-full",children:"Select Date & Time"})]}),O===1&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date"}),n.jsx("input",{type:"date",value:M.date,onChange:et=>Q({...M,date:et.target.value}),min:new Date().toISOString().split("T")[0],className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Slots"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:k.slots.map(et=>n.jsx("button",{onClick:()=>Q({...M,slot:et}),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${M.slot===et?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:et},et))})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>F(0),className:"flex-1 py-2.5 border border-gray-300 rounded-xl font-medium",children:"Back"}),n.jsx("button",{onClick:fe,disabled:!M.date||!M.slot,className:"flex-1 btn-primary",children:"Continue to Payment"})]})]}),O===2&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl space-y-2",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Doctor"}),n.jsx("span",{className:"font-medium",children:k.name})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Date"}),n.jsx("span",{className:"font-medium",children:M.date})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Time"}),n.jsx("span",{className:"font-medium",children:M.slot})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Type"}),n.jsx("span",{className:"font-medium capitalize",children:M.type})]}),n.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between",children:[n.jsx("span",{className:"font-semibold",children:"Amount to Pay"}),n.jsxs("span",{className:"font-bold text-primary-600",children:["",k.fee/2]})]})]}),n.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[n.jsx(dQ,{className:"w-5 h-5 text-gray-600"}),n.jsx("span",{className:"font-medium",children:"Payment Method"})]}),n.jsx("div",{className:"space-y-2",children:["UPI","Credit/Debit Card","Net Banking"].map(et=>n.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[n.jsx("input",{type:"radio",name:"payment",defaultChecked:et==="UPI"}),n.jsx("span",{children:et})]},et))})]}),n.jsxs("button",{onClick:fe,className:"btn-primary w-full flex items-center justify-center gap-2",children:[n.jsx(eI,{className:"w-4 h-4"})," Pay ",k.fee/2," Securely"]})]}),O===3&&n.jsxs("div",{className:"text-center py-6",children:[n.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(eh,{className:"w-8 h-8 text-green-600"})}),n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),n.jsx("p",{className:"text-gray-600 mb-4",children:"Your appointment has been scheduled"}),n.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-left space-y-2 mb-4",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Doctor:"})," ",k.name]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Date:"})," ",M.date," at ",M.slot]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Type:"})," ",M.type==="online"?"Video Consultation":"In-Person"]}),M.type==="online"&&n.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[n.jsxs("p",{className:"text-sm text-blue-800 font-medium flex items-center gap-2",children:[n.jsx(ah,{className:"w-4 h-4"})," Video Call Link"]}),n.jsxs("p",{className:"text-sm text-blue-600 mt-1 break-all",children:["https://meet.healthai.com/apt-",Math.random().toString(36).substr(2,6)]}),n.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Link will be available in your dashboard"})]})]}),n.jsx("button",{onClick:()=>{Ie(),o("dashboard")},className:"btn-primary w-full",children:"Go to Dashboard"})]})]})})},Nt=()=>{var Fe,et;return n.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),n.jsx("p",{className:"text-gray-600",children:"Manage your personal and health information"})]}),n.jsx("div",{className:"card gradient-bg text-white",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center",children:n.jsx(Cr,{className:"w-8 h-8"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Health Score"}),n.jsx("p",{className:"text-3xl font-bold",children:"78/100"})]}),n.jsxs("div",{className:"ml-auto text-right",children:[n.jsx("p",{className:"text-sm opacity-80",children:"BMI"}),n.jsx("p",{className:"text-2xl font-bold",children:"23.5"})]})]})}),n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(Xd,{className:"w-5 h-5 text-primary-600"})," Basic Information"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),n.jsx("input",{type:"text",value:Y2.name,className:"input",readOnly:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),n.jsx("input",{type:"email",value:Y2.email,className:"input bg-gray-50",disabled:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Age"}),n.jsx("input",{type:"number",value:He.age,onChange:$e=>Ue({...He,age:$e.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender"}),n.jsxs("select",{value:He.gender,onChange:$e=>Ue({...He,gender:$e.target.value}),className:"input",children:[n.jsx("option",{value:"male",children:"Male"}),n.jsx("option",{value:"female",children:"Female"}),n.jsx("option",{value:"other",children:"Other"})]})]})]})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Information"}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Height (cm)"}),n.jsx("input",{type:"number",value:He.height,onChange:$e=>Ue({...He,height:$e.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight (kg)"}),n.jsx("input",{type:"number",value:He.weight,onChange:$e=>Ue({...He,weight:$e.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blood Group"}),n.jsx("select",{value:He.bloodGroup,onChange:$e=>Ue({...He,bloodGroup:$e.target.value}),className:"input",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map($e=>n.jsx("option",{children:$e},$e))})]})]})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Medical History"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allergies"}),n.jsx("input",{type:"text",value:(Fe=He.allergies)==null?void 0:Fe.join(", "),className:"input",placeholder:"e.g., Penicillin, Peanuts"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chronic Conditions"}),n.jsx("input",{type:"text",value:(et=He.chronicConditions)==null?void 0:et.join(", "),className:"input",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),n.jsxs("button",{className:"btn-primary w-full flex items-center justify-center gap-2",onClick:()=>alert("Profile saved!"),children:[n.jsx(eh,{className:"w-5 h-5"})," Save Changes"]})]})},we=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("button",{onClick:()=>o("dashboard"),className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[n.jsx(ln,{className:"w-4 h-4"})," Back to Dashboard"]}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-xl flex items-center justify-center",children:n.jsx(Bn,{className:"w-7 h-7 text-primary-600"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Blood Test Report"}),n.jsx("p",{className:"text-gray-500",children:"Analyzed on Dec 5, 2024"})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:"text-3xl font-bold text-primary-600",children:"78"}),n.jsx("div",{className:"text-sm text-gray-500",children:"Health Score"})]})]}),n.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-100",children:[n.jsxs("button",{onClick:()=>E(!v),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-xl hover:bg-blue-100",children:[n.jsx(z3,{className:"w-4 h-4"}),v?"Hide":"Compare"]}),n.jsxs("button",{onClick:()=>I(!S),className:"flex items-center gap-2 px-4 py-2 bg-purple-50 text-purple-700 rounded-xl hover:bg-purple-100",children:[n.jsx(q3,{className:"w-4 h-4"}),"Ask AI"]})]})]}),v&&n.jsxs("div",{className:"card border-2 border-blue-200 bg-blue-50/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[n.jsx(z3,{className:"w-5 h-5 text-blue-600"})," Health Comparison"]}),n.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-700",children:" Improved"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[n.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[n.jsx("p",{className:"text-sm text-gray-500",children:"Previous (Oct)"}),n.jsx("p",{className:"text-2xl font-bold text-gray-400",children:"72/100"})]}),n.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[n.jsx("p",{className:"text-sm text-gray-500",children:"Current (Dec)"}),n.jsx("p",{className:"text-2xl font-bold text-primary-600",children:"78/100"})]})]}),n.jsx("p",{className:"text-gray-700 mb-4",children:L6.summary}),n.jsx("div",{className:"space-y-2 mb-4",children:L6.metricChanges.map((Fe,et)=>n.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ze,{trend:Fe.change}),n.jsx("span",{className:"font-medium",children:Fe.metric})]}),n.jsxs("div",{className:"text-sm",children:[n.jsx("span",{className:"text-gray-500",children:Fe.previous}),"  ",n.jsx("span",{className:"font-medium",children:Fe.current})]})]},et))})]}),S&&n.jsxs("div",{className:"card border-2 border-purple-200",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(q3,{className:"w-5 h-5 text-purple-600"})," Ask About Your Report"]}),n.jsxs("div",{className:"h-48 overflow-y-auto mb-4 space-y-3 p-3 bg-gray-50 rounded-xl",children:[h.length===0&&n.jsx("p",{className:"text-gray-500 text-center py-6",children:'Try: "What does my cholesterol mean?" or "Should I be worried?"'}),h.map((Fe,et)=>n.jsx("div",{className:`flex ${Fe.role==="user"?"justify-end":"justify-start"}`,children:n.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${Fe.role==="user"?"bg-purple-600 text-white":"bg-white border"}`,children:Fe.content})},et)),n.jsx("div",{ref:re})]}),n.jsxs("form",{onSubmit:ve,className:"flex gap-2",children:[n.jsx("input",{type:"text",value:g,onChange:Fe=>x(Fe.target.value),placeholder:"Ask a question...",className:"input flex-1"}),n.jsx("button",{type:"submit",className:"btn-primary px-4",children:n.jsx(ox,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[n.jsx(Cr,{className:"w-5 h-5 text-primary-600"})," Summary"]}),n.jsx("p",{className:"text-gray-700",children:ql.summary})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Metrics"}),n.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(ql.metrics).map(([Fe,et])=>n.jsxs("div",{className:`p-4 rounded-xl ${et.status==="normal"?"bg-green-50":"bg-yellow-50"}`,children:[n.jsx("p",{className:"text-sm text-gray-600 capitalize",children:Fe.replace(/([A-Z])/g," $1")}),n.jsxs("p",{className:"text-xl font-bold",children:[et.value," ",et.unit]}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Normal: ",et.normalRange]}),n.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${et.status==="normal"?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,children:et.status})]},Fe))})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[n.jsx(Vi,{className:"w-5 h-5 text-blue-600"})," Key Findings"]}),n.jsx("ul",{className:"space-y-2",children:ql.keyFindings.map((Fe,et)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),Fe]},et))})]}),n.jsxs("div",{className:"card border-l-4 border-orange-400",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[n.jsx(th,{className:"w-5 h-5 text-orange-600"})," Risk Factors"]}),n.jsx("ul",{className:"space-y-2",children:ql.riskFactors.map((Fe,et)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full mt-2"}),Fe]},et))})]})]}),n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(Xp,{className:"w-5 h-5 text-green-600"})," Diet"]}),n.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:ql.recommendations.diet.map((Fe,et)=>n.jsxs("div",{className:"p-4 bg-green-50 rounded-xl",children:[n.jsxs("div",{className:"flex justify-between mb-2",children:[n.jsx("span",{className:"font-medium text-green-800",children:Fe.item}),n.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${Fe.priority==="high"?"bg-green-200 text-green-800":"bg-gray-200"}`,children:Fe.priority})]}),n.jsx("p",{className:"text-sm text-green-700",children:Fe.reason})]},et))})]}),n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(Oy,{className:"w-5 h-5 text-blue-600"})," Exercise"]}),ql.recommendations.exercise.map((Fe,et)=>n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl mb-3",children:[n.jsxs("div",{className:"flex justify-between mb-2",children:[n.jsx("span",{className:"font-medium text-blue-800",children:Fe.activity}),n.jsxs("span",{className:"text-sm text-blue-600",children:[Fe.duration,"  ",Fe.frequency]})]}),n.jsx("p",{className:"text-sm text-blue-700",children:Fe.reason})]},et))]}),n.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(wg,{className:"w-5 h-5 text-primary-600"})," Recommended Doctors"]}),n.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:uR.filter(Fe=>ql.doctorConsultation.specializations.includes(Fe.specialization)).map(Fe=>n.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:Fe.name.split(" ")[1][0]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium",children:Fe.name}),n.jsx("p",{className:"text-sm text-primary-600",children:Fe.specialization})]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[n.jsx(zA,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),Fe.rating,"  ",n.jsx(cl,{className:"w-4 h-4"}),Fe.experience," yrs"]}),n.jsxs("div",{className:"flex justify-between mt-3 pt-3 border-t",children:[n.jsxs("span",{className:"font-semibold",children:["",Fe.fee]}),n.jsx("button",{onClick:()=>{R(Fe),o("doctors")},className:"text-sm bg-primary-600 text-white px-3 py-1.5 rounded-lg hover:bg-primary-700",children:"Book Now"})]})]},Fe._id))})]})]}),Rt=()=>n.jsxs("aside",{className:"w-64 bg-white border-r border-gray-200 fixed h-full flex flex-col",children:[n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-10 h-10 gradient-bg rounded-xl flex items-center justify-center",children:n.jsx(Cr,{className:"w-6 h-6 text-white"})}),n.jsx("span",{className:"text-xl font-bold text-gray-900",children:"HealthAI"})]}),n.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Demo Mode"})]}),n.jsx("nav",{className:"px-4 space-y-1 flex-1",children:[{id:"dashboard",icon:Wre,label:"Dashboard"},{id:"upload",icon:il,label:"Upload Report"},{id:"report",icon:Bn,label:"Report & Chat"},{id:"doctors",icon:wg,label:"Doctors"},{id:"profile",icon:Xd,label:"Profile"}].map(Fe=>n.jsxs("button",{onClick:()=>o(Fe.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${a===Fe.id?"bg-primary-50 text-primary-600":"text-gray-600 hover:bg-gray-50"}`,children:[n.jsx(Fe.icon,{className:"w-5 h-5"}),n.jsx("span",{className:"font-medium",children:Fe.label})]},Fe.id))}),n.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:c,onChange:Fe=>d(Fe.target.checked),className:"w-4 h-4 text-primary-600 rounded"}),n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Admin Mode"}),n.jsx(Sg,{className:"w-4 h-4 text-gray-400"})]})}),n.jsx("div",{className:"p-4 border-t border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[n.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:n.jsx("span",{className:"text-primary-600 font-semibold",children:"J"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:c?"Admin User":"John Doe"}),n.jsx("p",{className:"text-xs text-gray-500 truncate",children:c?"admin@healthai.com":"john@example.com"})]}),n.jsx(YR,{className:"w-5 h-5 text-gray-400"})]})})]});return n.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[n.jsx(Rt,{}),n.jsxs("main",{className:"flex-1 ml-64 p-8",children:[a==="dashboard"&&n.jsx(st,{}),a==="upload"&&n.jsx(bt,{}),a==="report"&&n.jsx(we,{}),a==="doctors"&&n.jsx(Qe,{}),a==="profile"&&n.jsx(Nt,{})]}),n.jsx(rt,{})]})}function _le(){const[a,o]=te.useState(null),[c,d]=te.useState(!0),[h,m]=te.useState("overview");te.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:v}=await xy.getStats();o(v)}catch{Ct.error("Failed to load stats")}finally{d(!1)}};if(c)return n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"})});const x=[{id:"overview",label:"Overview",icon:Cr},{id:"doctors",label:"Doctors",icon:AQ}];return n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Admin Dashboard"}),n.jsx("p",{className:"text-slate-500 mt-1",children:"Manage platform settings and monitor activity"})]}),n.jsx("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:x.map(({id:v,label:E,icon:S})=>n.jsxs("button",{onClick:()=>m(v),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${h===v?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[n.jsx(S,{className:"w-4 h-4"}),n.jsx("span",{children:E})]},v))}),h==="overview"&&n.jsx(yle,{stats:a}),h==="doctors"&&n.jsx(Ele,{})]})}function yle({stats:a}){var o,c,d,h;return a?n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:n.jsx(wg,{className:"w-5 h-5 text-blue-600"})}),n.jsx("p",{className:"text-sm text-slate-500",children:"Total Patients"}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((o=a.stats)==null?void 0:o.totalUsers)||0})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:n.jsx(dn,{className:"w-5 h-5 text-green-600"})}),n.jsx("p",{className:"text-sm text-slate-500",children:"Active Users"}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((c=a.stats)==null?void 0:c.activeUsers)||0})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:n.jsx(Bn,{className:"w-5 h-5 text-purple-600"})}),n.jsx("p",{className:"text-sm text-slate-500",children:"Total Reports"}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((d=a.stats)==null?void 0:d.totalReports)||0})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:n.jsx(Ln,{className:"w-5 h-5 text-amber-600"})}),n.jsx("p",{className:"text-sm text-slate-500",children:"Pending Doctors"}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((h=a.stats)==null?void 0:h.pendingDoctors)||0})]})]}):null}function Ele(){const[a,o]=te.useState([]),[c,d]=te.useState(!0),[h,m]=te.useState("all");te.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:I}=await xy.getDoctors();o(I.doctors||[])}catch{Ct.error("Failed to load doctors")}finally{d(!1)}},x=async I=>{try{await xy.approveDoctor(I),o(a.map(k=>k._id===I?{...k,approvalStatus:"approved",isListed:!0}:k)),Ct.success("Doctor approved!")}catch{Ct.error("Failed to approve")}},v=async I=>{try{await xy.rejectDoctor(I),o(a.map(k=>k._id===I?{...k,approvalStatus:"rejected",isListed:!1}:k)),Ct.success("Doctor rejected")}catch{Ct.error("Failed to reject")}},E=a.filter(I=>h==="all"?!0:I.approvalStatus===h),S=a.filter(I=>I.approvalStatus==="pending").length;return c?n.jsx(XA,{}):n.jsxs("div",{className:"space-y-4",children:[S>0&&n.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-center gap-4",children:[n.jsx(Ln,{className:"w-6 h-6 text-amber-500"}),n.jsx("div",{className:"flex-1",children:n.jsxs("p",{className:"font-medium text-amber-800",children:[S," Doctor(s) Pending Approval"]})}),n.jsx("button",{onClick:()=>m("pending"),className:"px-4 py-2 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600",children:"Review"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Doctor Management"}),n.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(I=>n.jsx("button",{onClick:()=>m(I),className:`px-3 py-1.5 rounded-lg text-sm font-medium capitalize ${h===I?"bg-cyan-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:I},I))})]}),n.jsxs("div",{className:"space-y-3",children:[E.map(I=>{var k,R;return n.jsx("div",{className:`p-4 rounded-xl border ${I.approvalStatus==="pending"?"bg-amber-50 border-amber-200":I.approvalStatus==="rejected"?"bg-red-50 border-red-200":"bg-slate-50 border-slate-200"}`,children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-white font-bold",children:(R=(k=I.name)==null?void 0:k[0])==null?void 0:R.toUpperCase()}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",I.name]}),n.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${I.approvalStatus==="approved"?"bg-green-100 text-green-700":I.approvalStatus==="rejected"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:I.approvalStatus})]}),n.jsx("p",{className:"text-sm text-cyan-600",children:I.specialization}),n.jsxs("p",{className:"text-xs text-slate-500",children:[I.experience," yrs  ",I.consultationFee||0]})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:I.approvalStatus==="pending"&&n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>x(I._id),className:"px-3 py-1.5 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 flex items-center gap-1",children:[n.jsx(dn,{className:"w-4 h-4"})," Approve"]}),n.jsxs("button",{onClick:()=>v(I._id),className:"px-3 py-1.5 bg-slate-200 text-red-600 text-sm font-medium rounded-lg hover:bg-slate-300 flex items-center gap-1",children:[n.jsx(nQ,{className:"w-4 h-4"})," Reject"]})]})})]})},I._id)}),E.length===0&&n.jsxs("div",{className:"text-center py-8 text-slate-500",children:[n.jsx(AQ,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),n.jsx("p",{children:"No doctors found"})]})]})]})]})}const Sle=[{id:"free",name:"Free",price:0,period:"forever",features:["1 Report analysis per month","Basic AI insights","View doctor listings","Email support"],color:"slate",icon:zA},{id:"basic",name:"Basic",price:0,period:"month",features:["5 Report analyses per month","Full AI analysis with deficiencies","Personalized diet plans","Supplement recommendations","Health trend tracking","Priority support"],color:"cyan",icon:nl,popular:!0},{id:"premium",name:"Premium",price:0,period:"month",features:["Unlimited report analyses","Advanced AI insights","Personalized diet & exercise plans","Supplement recommendations","Health trend analytics","Chat with AI about reports","Doctor recommendations","24/7 Priority support"],color:"violet",icon:WT}];function Cle(){var E;const{user:a}=aa(),[o,c]=te.useState(null),[d,h]=te.useState(!0),[m,g]=te.useState("monthly");te.useEffect(()=>{x()},[]);const x=async()=>{try{const{data:S}=await Dae.getSubscription();c(S)}catch{console.error("Failed to fetch subscription")}finally{h(!1)}},v=(o==null?void 0:o.plan)||((E=a==null?void 0:a.subscription)==null?void 0:E.plan)||"free";return d?n.jsx(XA,{}):n.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-fade-in",children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 bg-violet-500/20 text-violet-400 px-4 py-2 rounded-full text-sm font-semibold mb-4",children:[n.jsx(WT,{className:"w-4 h-4"}),"Subscription Plans"]}),n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Choose Your Plan"}),n.jsx("p",{className:"text-slate-400 max-w-lg mx-auto",children:"Unlock the full potential of AI-powered health insights with our premium plans"})]}),n.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-orange-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[n.jsx("div",{className:"absolute inset-0 opacity-10",children:n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),n.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:n.jsx(WT,{className:"w-7 h-7"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white/70 text-sm",children:"Current Plan"}),n.jsx("h2",{className:"text-2xl font-bold capitalize",children:v})]})]}),n.jsxs("div",{className:"flex items-center gap-6",children:[(o==null?void 0:o.endDate)&&n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-white/70 text-sm",children:"Renewal Date"}),n.jsx("p",{className:"font-semibold",children:new Date(o.endDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),n.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl",children:[n.jsx(Ti,{className:"w-4 h-4"}),n.jsx("span",{className:"font-medium capitalize",children:(o==null?void 0:o.status)||"Active"})]})]})]})]}),n.jsx("div",{className:"flex justify-center",children:n.jsxs("div",{className:"flex items-center gap-3 p-1 bg-slate-800 rounded-xl",children:[n.jsx("button",{onClick:()=>g("monthly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all ${m==="monthly"?"bg-slate-700 text-white":"text-slate-400"}`,children:"Monthly"}),n.jsxs("button",{onClick:()=>g("yearly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2 ${m==="yearly"?"bg-slate-700 text-white":"text-slate-400"}`,children:["Yearly",n.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded-full",children:"Save 20%"})]})]})}),n.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:Sle.map(S=>{const I=S.icon,k=v===S.id,R=m==="yearly"?Math.round(S.price*12*.8):S.price;return n.jsxs("div",{className:`bg-[#111827] rounded-2xl border p-6 relative ${S.popular?"border-cyan-500":"border-slate-700"} ${k?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-[#0a0f1a]":""}`,children:[S.popular&&n.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:n.jsx("span",{className:"bg-cyan-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg",children:"Most Popular"})}),n.jsxs("div",{className:"text-center mb-6 pt-2",children:[n.jsx("div",{className:`w-14 h-14 rounded-2xl mx-auto mb-4 flex items-center justify-center bg-${S.color}-500/20`,children:n.jsx(I,{className:`w-7 h-7 text-${S.color}-400`})}),n.jsx("h3",{className:"text-xl font-bold text-white",children:S.name}),n.jsxs("div",{className:"mt-4",children:[n.jsxs("span",{className:"text-4xl font-bold text-white",children:["",R]}),n.jsxs("span",{className:"text-slate-400",children:["/",m==="yearly"?"year":S.period]})]})]}),n.jsx("ul",{className:"space-y-3 mb-8",children:S.features.map((O,F)=>n.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[n.jsx("div",{className:`w-5 h-5 rounded-full bg-${S.color}-500/20 flex items-center justify-center flex-shrink-0 mt-0.5`,children:n.jsx(eh,{className:`w-3 h-3 text-${S.color}-400`})}),n.jsx("span",{className:"text-slate-400",children:O})]},F))}),n.jsx("button",{className:`w-full py-3 rounded-xl font-semibold transition-all ${k?"bg-slate-800 text-slate-500 cursor-default":S.popular?"bg-gradient-to-r from-purple-500 to-orange-500 text-white hover:opacity-90":"border-2 border-slate-700 text-slate-300 hover:border-cyan-500 hover:text-cyan-400"}`,disabled:k,children:k?"Current Plan":S.price===0?"Downgrade":"Upgrade Now"})]},S.id)})}),n.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:n.jsx(dQ,{className:"w-6 h-6 text-blue-400"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-white mb-2",children:"Secure Payment"}),n.jsx("p",{className:"text-slate-400 text-sm",children:"All payments are processed securely. You can upgrade, downgrade, or cancel your subscription at any time. Changes take effect immediately and unused time is prorated."})]})]})})]})}const Eb=[{id:"apple_watch",name:"Apple Watch",icon:GA,description:"Sync health data from your Apple Watch and iPhone",tags:["Heart Rate","Activity","Sleep"],color:"bg-slate-800",textColor:"text-slate-800"},{id:"google_fit",name:"Google Fit",icon:Cr,description:"Aggregates data from Android devices and apps",tags:["Activity","Nutrition","Weight"],color:"bg-blue-500",textColor:"text-blue-600"},{id:"fitbit",name:"Fitbit",icon:nl,description:"Track steps, heart rate, and sleep patterns",tags:["Steps","Heart","Sleep"],color:"bg-cyan-500",textColor:"text-cyan-600"},{id:"garmin",name:"Garmin Connect",icon:va,description:"High-fidelity GPS and heart rate data",tags:["Cardio","GPS","Training"],color:"bg-indigo-600",textColor:"text-indigo-600"},{id:"samsung",name:"Samsung Health",icon:XR,description:"Galaxy Watch and phone health data",tags:["Activity","Sleep","Stress"],color:"bg-purple-600",textColor:"text-purple-600"},{id:"oura",name:"Oura Ring",icon:ix,description:"Advanced sleep and recovery tracking",tags:["Sleep","Recovery","HRV"],color:"bg-slate-700",textColor:"text-slate-700"}];function Nle(){const[a,o]=te.useState([]),[c,d]=te.useState(!0),[h,m]=te.useState(!1),[g,x]=te.useState(!1),[v,E]=te.useState(null);te.useEffect(()=>{S()},[]);const S=async()=>{try{const{data:M}=await ig.getDashboard();M.devices&&o(M.devices)}catch(M){console.error("Failed to fetch devices:",M)}finally{d(!1)}},I=async()=>{m(!0);try{a.length>0?(await ig.generateDemoData(a[0].type),await S(),Ct.success("All devices synced successfully!")):Ct.error("No devices connected")}catch(M){console.error("Sync failed:",M),Ct.error("Failed to sync devices")}finally{m(!1)}},k=async M=>{try{const Q=Eb.find(Z=>Z.id===M);await ig.connectDevice(M,Q==null?void 0:Q.name),await ig.generateDemoData(M),await S(),x(!1),Ct.success(`${Q==null?void 0:Q.name} connected successfully!`)}catch(Q){console.error("Failed to connect:",Q),Ct.error("Failed to connect device")}},R=async M=>{try{await ig.disconnectDevice(M),await S(),Ct.success("Device disconnected")}catch(Q){console.error("Failed to disconnect:",Q),Ct.error("Failed to disconnect device")}},O=M=>{const Q=Eb.find(Z=>Z.id===M);return(Q==null?void 0:Q.icon)||GA},F=M=>{const Q=Eb.find(Z=>Z.id===M);return(Q==null?void 0:Q.color)||"bg-slate-600"};return c?n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500",children:"Loading devices..."})]})}):n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Connected Devices"}),n.jsxs("p",{className:"text-slate-500 mt-1 flex items-center gap-2",children:[n.jsx(cl,{className:"w-4 h-4"}),"Last synced: ",new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:I,disabled:h||a.length===0,className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl hover:bg-slate-50 transition-all disabled:opacity-50",children:[n.jsx(zre,{className:`w-4 h-4 ${h?"animate-spin":""}`}),"Sync All"]}),n.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-orange-500 text-white rounded-xl hover:shadow-lg transition-all",children:[n.jsx($l,{className:"w-4 h-4"}),"Add Device"]})]})]}),a.length===0&&n.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 flex items-start gap-3",children:[n.jsx("div",{className:"w-6 h-6 rounded-full bg-cyan-100 flex items-center justify-center shrink-0 mt-0.5",children:n.jsx(Ln,{className:"w-4 h-4 text-cyan-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-cyan-900 font-medium",children:"No devices connected yet"}),n.jsx("p",{className:"text-cyan-700 text-sm mt-1",children:"Connect your wearable devices to automatically track your health metrics and get personalized insights."})]})]}),a.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(qre,{className:"w-5 h-5 text-slate-600"}),n.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Your Devices"}),n.jsxs("span",{className:"px-2 py-0.5 bg-cyan-100 text-cyan-700 rounded-full text-xs font-medium",children:[a.length," connected"]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map((M,Q)=>{const Z=O(M.type),$=F(M.type),X=Math.floor(Math.random()*50)+50;return n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`w-12 h-12 rounded-xl ${$} flex items-center justify-center`,children:n.jsx(Z,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-slate-800 font-semibold",children:M.name}),n.jsx("p",{className:"text-slate-500 text-sm",children:M.type})]})]}),n.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:[n.jsx(dn,{className:"w-3 h-3"}),"Active"]})]}),n.jsx("div",{className:"flex gap-1 mb-4 h-16 bg-slate-50 rounded-lg p-2",children:[...Array(7)].map((be,me)=>{const Ne=30+Math.random()*70;return n.jsx("div",{className:"flex-1 bg-gradient-to-t from-purple-500 to-orange-500 rounded-sm",style:{height:`${Ne}%`,marginTop:"auto"}},me)})}),n.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-200",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[n.jsx(Vi,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Heart"})]}),n.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[n.jsx(Yre,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Steps"})]}),n.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[n.jsx(ix,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Sleep"})]})]}),n.jsxs("div",{className:"flex items-center gap-1 text-slate-500 text-xs",children:[n.jsx(Xre,{className:"w-4 h-4"}),X,"%"]})]}),n.jsxs("div",{className:"mt-4 flex gap-2",children:[n.jsx("button",{onClick:()=>I(),className:"flex-1 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm font-medium",children:"Sync Now"}),n.jsx("button",{onClick:()=>R(M.type),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm",children:"Disconnect"})]})]},Q)})})]}),n.jsxs("div",{children:[n.jsx("div",{className:"flex items-center justify-between mb-4",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(GA,{className:"w-5 h-5 text-slate-600"}),n.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Available Integrations"})]})}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Eb.map(M=>{const Q=M.icon,Z=a.some($=>$.type===M.id);return n.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[n.jsx("div",{className:`w-12 h-12 rounded-xl ${M.color} flex items-center justify-center shrink-0`,children:n.jsx(Q,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("p",{className:"text-slate-800 font-semibold",children:M.name}),Z&&n.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:"Connected"})]}),n.jsx("p",{className:"text-slate-500 text-sm mb-3",children:M.description}),n.jsx("div",{className:"flex flex-wrap gap-2",children:M.tags.map($=>n.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded-lg text-slate-600 text-xs",children:$},$))})]})]}),n.jsx("button",{onClick:()=>Z?R(M.id):k(M.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${Z?"bg-slate-100 text-slate-700 hover:bg-slate-200":"bg-gradient-to-r from-purple-500 to-orange-500 text-white hover:shadow-lg"}`,children:Z?"Disconnect":"Connect"})]})},M.id)})})]}),g&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-fade-in",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Connect a Device"}),n.jsx("button",{onClick:()=>x(!1),className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-slate-200 transition-colors",children:n.jsx(Yi,{className:"w-5 h-5"})})]}),n.jsx("p",{className:"text-slate-500 mb-6",children:"Select a device or service to connect"}),n.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:Eb.map(M=>{const Q=M.icon,Z=a.some($=>$.type===M.id);return n.jsxs("button",{onClick:()=>!Z&&k(M.id),disabled:Z,className:`w-full p-4 border rounded-xl transition-all flex items-center gap-4 text-left ${Z?"bg-slate-50 border-slate-200 opacity-60 cursor-not-allowed":"bg-white border-slate-200 hover:border-cyan-500 hover:shadow-sm"}`,children:[n.jsx("div",{className:`w-10 h-10 rounded-xl ${M.color} flex items-center justify-center shrink-0`,children:n.jsx(Q,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("p",{className:"text-slate-800 font-medium",children:M.name}),Z&&n.jsx(dn,{className:"w-4 h-4 text-emerald-500"})]}),n.jsx("p",{className:"text-slate-500 text-sm",children:M.description})]})]},M.id)})})]})})]})}function Tle(){var F,M,Q,Z,$,X,be,me,Ne,le,H,Ae,J,Y,se,oe,Te,he,Ce;const{patientId:a}=sx(),[o]=JV(),c=o.get("appointmentId"),[d,h]=te.useState(null),[m,g]=te.useState(!0),[x,v]=te.useState("overview");if(te.useEffect(()=>{(async()=>{try{const{data:Be}=await Wo.getPatientProfile(a,c);h(Be)}catch(Be){console.error("Failed to fetch patient profile:",Be)}finally{g(!1)}})()},[a,c]),m)return n.jsx(XA,{});if(!d)return n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 text-center py-16",children:[n.jsx("p",{className:"text-slate-400",children:"Patient not found or access denied."}),n.jsx(Os,{to:"/doctors",className:"mt-4 inline-block px-6 py-2 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl",children:"Go Back"})]});const{patient:E,healthSummary:S,healthReports:I,wearableSummary:k,appointmentHistory:R}=d,O=[{id:"overview",label:"Overview",icon:Xd},{id:"reports",label:"Health Reports",icon:Bn},{id:"wearables",label:"Wearable Data",icon:GA},{id:"history",label:"Appointment History",icon:Ti}];return n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs(Os,{to:"/doctor/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors",children:[n.jsx(ln,{className:"w-4 h-4"}),"Back to Dashboard"]}),n.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-6",children:[n.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center text-white text-3xl font-bold",children:(M=(F=E.name)==null?void 0:F.charAt(0))==null?void 0:M.toUpperCase()}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:E.name}),n.jsxs("div",{className:"flex flex-wrap gap-4 mt-2 text-sm text-slate-400",children:[E.email&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(ax,{className:"w-4 h-4"})," ",E.email]}),E.phone&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(sI,{className:"w-4 h-4"})," ",E.phone]}),((Q=E.profile)==null?void 0:Q.age)&&n.jsxs("span",{children:[E.profile.age," years old"]}),((Z=E.profile)==null?void 0:Z.gender)&&n.jsx("span",{className:"capitalize",children:E.profile.gender})]})]}),(S==null?void 0:S.healthScore)&&n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:`text-4xl font-bold ${S.healthScore>=80?"text-emerald-400":S.healthScore>=60?"text-amber-400":"text-red-400"}`,children:S.healthScore}),n.jsx("p",{className:"text-sm text-slate-400",children:"Health Score"})]})]})}),n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:O.map(ee=>n.jsxs("button",{onClick:()=>v(ee.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all whitespace-nowrap ${x===ee.id?"bg-cyan-500 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:[n.jsx(ee.icon,{className:"w-4 h-4"}),ee.label]},ee.id))}),x==="overview"&&n.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[n.jsx(Xd,{className:"w-5 h-5 text-cyan-400"})," Basic Information"]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[(($=E.profile)==null?void 0:$.height)&&n.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[n.jsx("p",{className:"text-sm text-slate-400",children:"Height"}),n.jsxs("p",{className:"font-semibold text-white",children:[E.profile.height," cm"]})]}),((X=E.profile)==null?void 0:X.weight)&&n.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[n.jsx("p",{className:"text-sm text-slate-400",children:"Weight"}),n.jsxs("p",{className:"font-semibold text-white",children:[E.profile.weight," kg"]})]}),((be=E.profile)==null?void 0:be.bloodGroup)&&n.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[n.jsx("p",{className:"text-sm text-slate-400",children:"Blood Group"}),n.jsx("p",{className:"font-semibold text-white",children:E.profile.bloodGroup})]}),((me=E.healthMetrics)==null?void 0:me.bmi)&&n.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[n.jsx("p",{className:"text-sm text-slate-400",children:"BMI"}),n.jsx("p",{className:"font-semibold text-white",children:E.healthMetrics.bmi.toFixed(1)})]})]}),((le=(Ne=E.profile)==null?void 0:Ne.allergies)==null?void 0:le.length)>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Allergies"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:E.profile.allergies.map((ee,Be)=>n.jsx("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:ee},Be))})]}),((Ae=(H=E.profile)==null?void 0:H.chronicConditions)==null?void 0:Ae.length)>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Chronic Conditions"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:E.profile.chronicConditions.map((ee,Be)=>n.jsx("span",{className:"px-3 py-1 bg-amber-500/20 text-amber-400 rounded-full text-sm",children:ee},Be))})]})]}),S&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[n.jsx(Vi,{className:"w-5 h-5 text-red-400"})," Health Summary"]}),((J=S.deficiencies)==null?void 0:J.length)>0&&n.jsxs("div",{className:"mb-4",children:[n.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["Deficiencies (",S.deficiencies.length,")"]}),n.jsx("div",{className:"space-y-2",children:S.deficiencies.slice(0,3).map((ee,Be)=>{var re,ve,fe;const He=typeof ee.currentValue=="object"?((re=ee.currentValue)==null?void 0:re.value)||JSON.stringify(ee.currentValue):ee.currentValue,Ue=typeof ee.normalRange=="object"?((ve=ee.normalRange)==null?void 0:ve.value)||JSON.stringify(ee.normalRange):ee.normalRange;return n.jsxs("div",{className:`p-3 rounded-xl ${ee.severity==="severe"?"bg-red-500/10 border border-red-500/30":ee.severity==="moderate"?"bg-amber-500/10 border border-amber-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"font-medium text-white",children:typeof ee.name=="object"?((fe=ee.name)==null?void 0:fe.value)||"Unknown":ee.name}),n.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${ee.severity==="severe"?"bg-red-500/20 text-red-400":ee.severity==="moderate"?"bg-amber-500/20 text-amber-400":"bg-yellow-500/20 text-yellow-400"}`,children:ee.severity})]}),n.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Current: ",He," | Normal: ",Ue]})]},Be)})})]}),((Y=S.riskFactors)==null?void 0:Y.length)>0&&n.jsxs("div",{className:"mb-4",children:[n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Risk Factors"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:S.riskFactors.map((ee,Be)=>n.jsx("span",{className:"px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm",children:typeof ee=="object"?(ee==null?void 0:ee.name)||(ee==null?void 0:ee.value)||JSON.stringify(ee):ee},Be))})]}),((se=S.keyFindings)==null?void 0:se.length)>0&&n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Key Findings"}),n.jsx("ul",{className:"space-y-1",children:S.keyFindings.slice(0,4).map((ee,Be)=>{const He=typeof ee=="object"?(ee==null?void 0:ee.title)||(ee==null?void 0:ee.finding)||(ee==null?void 0:ee.value)||JSON.stringify(ee):ee;return n.jsxs("li",{className:"text-sm text-slate-300 flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-400 mt-1",children:""}),He]},Be)})})]})]}),k&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 lg:col-span-2",children:[n.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[n.jsx(GA,{className:"w-5 h-5 text-blue-400"})," Wearable Data Summary"]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"p-4 bg-blue-500/10 rounded-xl text-center border border-blue-500/20",children:[n.jsx(Cr,{className:"w-6 h-6 text-blue-400 mx-auto mb-2"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:((oe=k.avgSteps)==null?void 0:oe.toLocaleString())||"N/A"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Avg Steps/Day"})]}),n.jsxs("div",{className:"p-4 bg-red-500/10 rounded-xl text-center border border-red-500/20",children:[n.jsx(Vi,{className:"w-6 h-6 text-red-400 mx-auto mb-2"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:k.avgHeartRate||"N/A"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Avg Heart Rate"})]}),n.jsxs("div",{className:"p-4 bg-indigo-500/10 rounded-xl text-center border border-indigo-500/20",children:[n.jsx(cl,{className:"w-6 h-6 text-indigo-400 mx-auto mb-2"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:k.avgSleepHours||"N/A"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Avg Sleep (hrs)"})]}),n.jsxs("div",{className:"p-4 bg-emerald-500/10 rounded-xl text-center border border-emerald-500/20",children:[n.jsx(GA,{className:"w-6 h-6 text-emerald-400 mx-auto mb-2"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:((Te=k.devices)==null?void 0:Te.length)||0}),n.jsx("p",{className:"text-sm text-slate-400",children:"Connected Devices"})]})]})]})]}),x==="reports"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Health Reports"}),(I==null?void 0:I.length)>0?n.jsx("div",{className:"space-y-3",children:I.map(ee=>n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-700 flex items-center justify-center",children:n.jsx(Bn,{className:"w-6 h-6 text-slate-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-white",children:ee.reportType}),n.jsx("p",{className:"text-sm text-slate-400",children:new Date(ee.createdAt).toLocaleDateString()})]})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[ee.healthScore&&n.jsxs("span",{className:`font-bold ${ee.healthScore>=80?"text-emerald-400":ee.healthScore>=60?"text-amber-400":"text-red-400"}`,children:["Score: ",ee.healthScore]}),n.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${ee.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,children:ee.status})]})]},ee._id))}):n.jsx("p",{className:"text-slate-400 text-center py-8",children:"No health reports available"})]}),x==="wearables"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Wearable Device Data"}),k?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Connected Devices"}),n.jsx("div",{className:"flex flex-wrap gap-3",children:(he=k.devices)==null?void 0:he.map((ee,Be)=>n.jsxs("div",{className:"px-4 py-2 bg-cyan-500/10 border border-cyan-500/20 rounded-xl flex items-center gap-2",children:[n.jsx(GA,{className:"w-4 h-4 text-cyan-400"}),n.jsx("span",{className:"font-medium text-cyan-300",children:ee.name||ee.type})]},Be))})]}),((Ce=k.recentMetrics)==null?void 0:Ce.length)>0&&n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Recent Activity (Last 7 Days)"}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-700",children:[n.jsx("th",{className:"text-left py-2 text-slate-400 font-medium",children:"Date"}),n.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Steps"}),n.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Calories"}),n.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Active Min"}),n.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Distance"})]})}),n.jsx("tbody",{children:k.recentMetrics.map((ee,Be)=>{var He,Ue;return n.jsxs("tr",{className:"border-b border-slate-700/50",children:[n.jsx("td",{className:"py-2 text-white",children:new Date(ee.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),n.jsx("td",{className:"py-2 text-right text-slate-300",children:(He=ee.steps)==null?void 0:He.toLocaleString()}),n.jsx("td",{className:"py-2 text-right text-slate-300",children:ee.caloriesBurned}),n.jsx("td",{className:"py-2 text-right text-slate-300",children:ee.activeMinutes}),n.jsxs("td",{className:"py-2 text-right text-slate-300",children:[(Ue=ee.distance)==null?void 0:Ue.toFixed(1)," km"]})]},Be)})})]})})]})]}):n.jsx("p",{className:"text-slate-400 text-center py-8",children:"No wearable data available"})]}),x==="history"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Appointment History"}),(R==null?void 0:R.length)>0?n.jsx("div",{className:"space-y-3",children:R.map(ee=>n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Ti,{className:"w-5 h-5 text-slate-400"}),n.jsx("span",{className:"font-semibold text-white",children:new Date(ee.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),n.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${ee.status==="completed"?"bg-emerald-500/20 text-emerald-400":ee.status==="scheduled"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}`,children:ee.status})]}),ee.doctor&&n.jsxs("p",{className:"text-sm text-slate-400",children:["Dr. ",ee.doctor.name," - ",ee.doctor.specialization]}),ee.symptoms&&n.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:[n.jsx("span",{className:"font-medium text-slate-400",children:"Symptoms:"})," ",ee.symptoms]}),ee.notes&&n.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[n.jsx("span",{className:"font-medium text-slate-400",children:"Notes:"})," ",ee.notes]})]},ee._id))}):n.jsx("p",{className:"text-slate-400 text-center py-8",children:"No appointment history"})]})]})}var _H={exports:{}};(function(a,o){(function(c,d){a.exports=d()})(O_,function(){function c(e,t){return t.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return s[r]}})}})}),Object.freeze(e)}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof O_<"u"?O_:typeof self<"u"?self:{};function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var m=function(e){try{return!!e()}catch{return!0}},g=!m(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),x=g,v=Function.prototype,E=v.call,S=x&&v.bind.bind(E,E),I=x?S:function(e){return function(){return E.apply(e,arguments)}},k=I({}.isPrototypeOf),R=function(e){return e&&e.Math===Math&&e},O=R(typeof globalThis=="object"&&globalThis)||R(typeof window=="object"&&window)||R(typeof self=="object"&&self)||R(typeof d=="object"&&d)||R(typeof d=="object"&&d)||function(){return this}()||Function("return this")(),F=g,M=Function.prototype,Q=M.apply,Z=M.call,$=typeof Reflect=="object"&&Reflect.apply||(F?Z.bind(Q):function(){return Z.apply(Q,arguments)}),X=I,be=X({}.toString),me=X("".slice),Ne=function(e){return me(be(e),8,-1)},le=Ne,H=I,Ae=function(e){if(le(e)==="Function")return H(e)},J=typeof document=="object"&&document.all,Y=J===void 0&&J!==void 0?function(e){return typeof e=="function"||e===J}:function(e){return typeof e=="function"},se={},oe=!m(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Te=g,he=Function.prototype.call,Ce=Te?he.bind(he):function(){return he.apply(he,arguments)},ee={},Be={}.propertyIsEnumerable,He=Object.getOwnPropertyDescriptor,Ue=He&&!Be.call({1:2},1);ee.f=Ue?function(e){var t=He(this,e);return!!t&&t.enumerable}:Be;var re,ve,fe=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ie=m,je=Ne,Ee=Object,We=I("".split),ze=Ie(function(){return!Ee("z").propertyIsEnumerable(0)})?function(e){return je(e)==="String"?We(e,""):Ee(e)}:Ee,st=function(e){return e==null},bt=st,Qe=TypeError,rt=function(e){if(bt(e))throw new Qe("Can't call method on "+e);return e},Nt=ze,we=rt,Rt=function(e){return Nt(we(e))},Fe=Y,et=function(e){return typeof e=="object"?e!==null:Fe(e)},$e={},Kt=$e,qt=O,Xe=Y,ht=function(e){return Xe(e)?e:void 0},dt=function(e,t){return arguments.length<2?ht(Kt[e])||ht(qt[e]):Kt[e]&&Kt[e][t]||qt[e]&&qt[e][t]},Dt=O.navigator,ss=Dt&&Dt.userAgent,$t=ss?String(ss):"",ls=O,Zt=$t,Rs=ls.process,es=ls.Deno,Zs=Rs&&Rs.versions||es&&es.version,pt=Zs&&Zs.v8;pt&&(ve=(re=pt.split("."))[0]>0&&re[0]<4?1:+(re[0]+re[1])),!ve&&Zt&&(!(re=Zt.match(/Edge\/(\d+)/))||re[1]>=74)&&(re=Zt.match(/Chrome\/(\d+)/))&&(ve=+re[1]);var Ut=ve,zt=Ut,rs=m,Ht=O.String,vt=!!Object.getOwnPropertySymbols&&!rs(function(){var e=Symbol("symbol detection");return!Ht(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&zt&&zt<41}),jt=vt&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ps=dt,Qs=Y,Is=k,ms=Object,Ws=jt?function(e){return typeof e=="symbol"}:function(e){var t=ps("Symbol");return Qs(t)&&Is(t.prototype,ms(e))},mi=String,qr=function(e){try{return mi(e)}catch{return"Object"}},oa=Y,Xi=qr,Ds=TypeError,An=function(e){if(oa(e))return e;throw new Ds(Xi(e)+" is not a function")},wa=An,Qi=st,fi=function(e,t){var s=e[t];return Qi(s)?void 0:wa(s)},Pn=Ce,Ri=Y,Hi=et,eA=TypeError,Al={exports:{}},wo=O,Ec=Object.defineProperty,Xo=O,Jo=function(e,t){try{Ec(wo,e,{value:t,configurable:!0,writable:!0})}catch{wo[e]=t}return t},so="__core-js_shared__",id=Al.exports=Xo[so]||Jo(so,{});(id.versions||(id.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var _o=Al.exports,ad=_o,$o=function(e,t){return ad[e]||(ad[e]=t||{})},JA=rt,$A=Object,yo=function(e){return $A(JA(e))},ph=yo,nm=I({}.hasOwnProperty),Un=Object.hasOwn||function(e,t){return nm(ph(e),t)},Eo=I,mh=0,im=Math.random(),fh=Eo(1.1.toString),ZA=function(e){return"Symbol("+(e===void 0?"":e)+")_"+fh(++mh+im,36)},am=$o,gh=Un,Sc=ZA,eu=vt,Dg=jt,Sn=O.Symbol,tu=am("wks"),Cc=Dg?Sn.for||Sn:Sn&&Sn.withoutSetter||Sc,Ur=function(e){return gh(tu,e)||(tu[e]=eu&&gh(Sn,e)?Sn[e]:Cc("Symbol."+e)),tu[e]},om=Ce,ro=et,gi=Ws,ul=fi,cm=function(e,t){var s,r;if(Ri(s=e.toString)&&!Hi(r=Pn(s,e))||Ri(s=e.valueOf)&&!Hi(r=Pn(s,e)))return r;throw new eA("Can't convert object to primitive value")},Bg=TypeError,Lg=Ur("toPrimitive"),Nc=function(e,t){if(!ro(e)||gi(e))return e;var s,r=ul(e,Lg);if(r){if(s=om(r,e,t),!ro(s)||gi(s))return s;throw new Bg("Can't convert object to primitive value")}return cm(e)},lm=Ws,su=function(e){var t=Nc(e,"string");return lm(t)?t:t+""},tA=et,hl=O.document,jg=tA(hl)&&tA(hl.createElement),bh=function(e){return jg?hl.createElement(e):{}},Pg=bh,ru=!oe&&!m(function(){return Object.defineProperty(Pg("div"),"a",{get:function(){return 7}}).a!==7}),dm=oe,Zo=Ce,Ug=ee,sA=fe,xh=Rt,Fg=su,er=Un,Mg=ru,Am=Object.getOwnPropertyDescriptor;se.f=dm?Am:function(e,t){if(e=xh(e),t=Fg(t),Mg)try{return Am(e,t)}catch{}if(er(e,t))return sA(!Zo(Ug.f,e,t),e[t])};var Vg=m,pl=Y,ml=/#|\.prototype\./,rA=function(e,t){var s=nu[Qg(e)];return s===nA||s!==vh&&(pl(t)?Vg(t):!!t)},Qg=rA.normalize=function(e){return String(e).replace(ml,".").toLowerCase()},nu=rA.data={},vh=rA.NATIVE="N",nA=rA.POLYFILL="P",um=rA,fl=An,Hg=g,wh=Ae(Ae.bind),So=function(e,t){return fl(e),t===void 0?e:Hg?wh(e,t):function(){return e.apply(t,arguments)}},_a={},Tc=oe&&m(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),_h=et,iu=String,yh=TypeError,ii=function(e){if(_h(e))return e;throw new yh(iu(e)+" is not an object")},Eh=oe,hm=ru,pm=Tc,Co=ii,Rc=su,mm=TypeError,gl=Object.defineProperty,fm=Object.getOwnPropertyDescriptor,L="enumerable",ae="configurable",Oe="writable";_a.f=Eh?pm?function(e,t,s){if(Co(e),t=Rc(t),Co(s),typeof e=="function"&&t==="prototype"&&"value"in s&&Oe in s&&!s[Oe]){var r=fm(e,t);r&&r[Oe]&&(e[t]=s.value,s={configurable:ae in s?s[ae]:r[ae],enumerable:L in s?s[L]:r[L],writable:!1})}return gl(e,t,s)}:gl:function(e,t,s){if(Co(e),t=Rc(t),Co(s),hm)try{return gl(e,t,s)}catch{}if("get"in s||"set"in s)throw new mm("Accessors not supported");return"value"in s&&(e[t]=s.value),e};var Ve=_a,tt=fe,yt=oe?function(e,t,s){return Ve.f(e,t,tt(1,s))}:function(e,t,s){return e[t]=s,e},Pt=O,ws=$,ks=Ae,Js=Y,lr=se.f,Fr=um,sn=$e,bi=So,Gr=yt,xi=Un,vi=function(e){var t=function(s,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(s);case 2:return new e(s,r)}return new e(s,r,i)}return ws(e,this,arguments)};return t.prototype=e.prototype,t},Ts=function(e,t){var s,r,i,l,A,u,p,f,b,w=e.target,_=e.global,C=e.stat,U=e.proto,B=_?Pt:C?Pt[w]:Pt[w]&&Pt[w].prototype,j=_?sn:sn[w]||Gr(sn,w,{})[w],K=j.prototype;for(l in t)r=!(s=Fr(_?l:w+(C?".":"#")+l,e.forced))&&B&&xi(B,l),u=j[l],r&&(p=e.dontCallGetSet?(b=lr(B,l))&&b.value:B[l]),A=r&&p?p:t[l],(s||U||typeof u!=typeof A)&&(f=e.bind&&r?bi(A,Pt):e.wrap&&r?vi(A):U&&Js(A)?ks(A):A,(e.sham||A&&A.sham||u&&u.sham)&&Gr(f,"sham",!0),Gr(j,l,f),U&&(xi(sn,i=w+"Prototype")||Gr(sn,i,{}),Gr(sn[i],l,A),e.real&&K&&(s||!K[l])&&Gr(K,l,A)))},bl=Math.ceil,ec=Math.floor,xl=Math.trunc||function(e){var t=+e;return(t>0?ec:bl)(t)},Sh=xl,od=function(e){var t=+e;return t!=t||t===0?0:Sh(t)},cd=od,iA=Math.max,aA=Math.min,Ic=function(e,t){var s=cd(e);return s<0?iA(s+t,0):aA(s,t)},Ji=od,oA=Math.min,ld=function(e){var t=Ji(e);return t>0?oA(t,9007199254740991):0},Ch=ld,No=function(e){return Ch(e.length)},ya=Rt,vl=Ic,au=No,Nh=function(e){return function(t,s,r){var i=ya(t),l=au(i);if(l===0)return!e&&-1;var A,u=vl(r,l);if(e&&s!=s){for(;l>u;)if((A=i[u++])!=A)return!0}else for(;l>u;u++)if((e||u in i)&&i[u]===s)return e||u||0;return!e&&-1}},Ua={includes:Nh(!0),indexOf:Nh(!1)},cA=Ua.includes;Ts({target:"Array",proto:!0,forced:m(function(){return!Array(1).includes()})},{includes:function(e){return cA(this,e,arguments.length>1?arguments[1]:void 0)}});var Th=O,Rh=$e,wi=function(e,t){var s=Rh[e+"Prototype"],r=s&&s[t];if(r)return r;var i=Th[e],l=i&&i.prototype;return l&&l[t]},lA=wi("Array","includes"),no=et,io=Ne,dd=Ur("match"),tc=function(e){var t;return no(e)&&((t=e[dd])!==void 0?!!t:io(e)==="RegExp")},Ad=tc,Ih=TypeError,dA={};dA[Ur("toStringTag")]="z";var Fn=String(dA)==="[object z]",gm=Fn,Oc=Y,ao=Ne,Oh=Ur("toStringTag"),kh=Object,Dh=ao(function(){return arguments}())==="Arguments",To=gm?ao:function(e){var t,s,r;return e===void 0?"Undefined":e===null?"Null":typeof(s=function(i,l){try{return i[l]}catch{}}(t=kh(e),Oh))=="string"?s:Dh?ao(t):(r=ao(t))==="Object"&&Oc(t.callee)?"Arguments":r},ud=To,hd=String,qn=function(e){if(ud(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return hd(e)},AA=Ur("match"),pd=Ts,uA=function(e){if(Ad(e))throw new Ih("The method doesn't accept regular expressions");return e},Ro=rt,sc=qn,Yr=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[AA]=!1,"/./"[e](t)}catch{}}return!1},un=I("".indexOf);pd({target:"String",proto:!0,forced:!Yr("includes")},{includes:function(e){return!!~un(sc(Ro(this)),sc(uA(e)),arguments.length>1?arguments[1]:void 0)}});var ai=wi("String","includes"),_i=k,wl=lA,Bh=ai,md=Array.prototype,ou=String.prototype,fx=function(e){var t=e.includes;return e===md||_i(md,e)&&t===md.includes?wl:typeof e=="string"||e===ou||_i(ou,e)&&t===ou.includes?Bh:t},nt=h(fx),gx=An,bx=yo,xx=ze,vx=No,cu=TypeError,Gg="Reduce of empty array with no initial value",wx=function(e){return function(t,s,r,i){var l=bx(t),A=xx(l),u=vx(l);if(gx(s),u===0&&r<2)throw new cu(Gg);var p=e?u-1:0,f=e?-1:1;if(r<2)for(;;){if(p in A){i=A[p],p+=f;break}if(p+=f,e?p<0:u<=p)throw new cu(Gg)}for(;e?p>=0:u>p;p+=f)p in A&&(i=s(i,A[p],p,l));return i}},_x={left:wx(!1)},yx=m,Lh=function(e,t){var s=[][e];return!!s&&yx(function(){s.call(null,t||function(){return 1},1)})},lu=O,Ex=$t,Sx=Ne,du=function(e){return Ex.slice(0,e.length)===e},Au=du("Bun/")?"BUN":du("Cloudflare-Workers")?"CLOUDFLARE":du("Deno/")?"DENO":du("Node.js/")?"NODE":lu.Bun&&typeof Bun.version=="string"?"BUN":lu.Deno&&typeof Deno.version=="object"?"DENO":Sx(lu.process)==="process"?"NODE":lu.window&&lu.document?"BROWSER":"REST",ca=Au==="NODE",Io=_x.left;Ts({target:"Array",proto:!0,forced:!ca&&Ut>79&&Ut<83||!Lh("reduce")},{reduce:function(e){var t=arguments.length;return Io(this,e,t,t>1?arguments[1]:void 0)}});var bm=wi("Array","reduce"),xm=k,Cx=bm,uu=Array.prototype,vm=function(e){var t=e.reduce;return e===uu||xm(uu,e)&&t===uu.reduce?Cx:t},wm=vm,Fa=h(wm),Kg=Ne,hA=Array.isArray||function(e){return Kg(e)==="Array"},_m=Ts,Wg=hA,NE=I([].reverse),Nx=[1,2];_m({target:"Array",proto:!0,forced:String(Nx)===String(Nx.reverse())},{reverse:function(){return Wg(this)&&(this.length=this.length),NE(this)}});var Tx=wi("Array","reverse"),TE=k,RE=Tx,zg=Array.prototype,IE=function(e){var t=e.reverse;return e===zg||TE(zg,e)&&t===zg.reverse?RE:t},Rx=IE,ym=h(Rx),qg=ZA,hu=$o("keys"),Em=function(e){return hu[e]||(hu[e]=qg(e))},OE=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Ix=Un,kE=Y,DE=yo,BE=OE,Ox=Em("IE_PROTO"),kc=Object,rc=kc.prototype,nc=BE?kc.getPrototypeOf:function(e){var t=DE(e);if(Ix(t,Ox))return t[Ox];var s=t.constructor;return kE(s)&&t instanceof s?s.prototype:t instanceof kc?rc:null},LE=I,kx=An,fd=et,Oo=function(e){return fd(e)||e===null},jE=String,PE=TypeError,Dx=function(e,t,s){try{return LE(kx(Object.getOwnPropertyDescriptor(e,t)[s]))}catch{}},Bx=et,Lx=rt,jx=function(e){if(Oo(e))return e;throw new PE("Can't set "+jE(e)+" as a prototype")},UE=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,s={};try{(e=Dx(Object.prototype,"__proto__","set"))(s,[]),t=s instanceof Array}catch{}return function(r,i){return Lx(r),jx(i),Bx(r)&&(t?e(r,i):r.__proto__=i),r}}():void 0),pA={},mA={},fA=Un,Yg=Rt,FE=Ua.indexOf,Px=mA,Ux=I([].push),Fx=function(e,t){var s,r=Yg(e),i=0,l=[];for(s in r)!fA(Px,s)&&fA(r,s)&&Ux(l,s);for(;t.length>i;)fA(r,s=t[i++])&&(~FE(l,s)||Ux(l,s));return l},Xg=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ME=Fx,VE=Xg.concat("length","prototype");pA.f=Object.getOwnPropertyNames||function(e){return ME(e,VE)};var jh={};jh.f=Object.getOwnPropertySymbols;var Mx=dt,Sm=pA,QE=jh,HE=ii,Vx=I([].concat),y=Mx("Reflect","ownKeys")||function(e){var t=Sm.f(HE(e)),s=QE.f;return s?Vx(t,s(e)):t},T=Un,V=y,z=se,ce=_a,de={},pe=Fx,_e=Xg,Se=Object.keys||function(e){return pe(e,_e)},ke=oe,Ke=Tc,ut=_a,De=ii,Ye=Rt,it=Se;de.f=ke&&!Ke?Object.defineProperties:function(e,t){De(e);for(var s,r=Ye(t),i=it(t),l=i.length,A=0;l>A;)ut.f(e,s=i[A++],r[s]);return e};var wt,At=dt("document","documentElement"),St=ii,Ot=de,Qt=Xg,Ft=mA,Bs=At,xs=bh,nr="prototype",_s="script",Nr=Em("IE_PROTO"),oi=function(){},dr=function(e){return"<"+_s+">"+e+"</"+_s+">"},ys=function(e){e.write(dr("")),e.close();var t=e.parentWindow.Object;return e=null,t},ts=function(){try{wt=new ActiveXObject("htmlfile")}catch{}var e,t,s;ts=typeof document<"u"?document.domain&&wt?ys(wt):(t=xs("iframe"),s="java"+_s+":",t.style.display="none",Bs.appendChild(t),t.src=String(s),(e=t.contentWindow.document).open(),e.write(dr("document.F=Object")),e.close(),e.F):ys(wt);for(var r=Qt.length;r--;)delete ts[nr][Qt[r]];return ts()};Ft[Nr]=!0;var Cn=Object.create||function(e,t){var s;return e!==null?(oi[nr]=St(e),s=new oi,oi[nr]=null,s[Nr]=e):s=ts(),t===void 0?s:Ot.f(s,t)},ir=et,Lr=yt,xn=Error,$i=I("".replace),Ea=String(new xn("zxcasd").stack),Mn=/\n\s*at [^:]*:[^\n]*/,la=Mn.test(Ea),Sa=fe,Ii=!m(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Sa(1,7)),e.stack!==7)}),Mr=yt,Zr=function(e,t){if(la&&typeof e=="string"&&!xn.prepareStackTrace)for(;t--;)e=$i(e,Mn,"");return e},Yn=Ii,Xr=Error.captureStackTrace,Xn={},ic=Xn,ci=Ur("iterator"),Ma=Array.prototype,rn=function(e){return e!==void 0&&(ic.Array===e||Ma[ci]===e)},Oi=To,Va=fi,Ca=st,oo=Xn,co=Ur("iterator"),Zi=function(e){if(!Ca(e))return Va(e,co)||Va(e,"@@iterator")||oo[Oi(e)]},lo=Ce,vn=An,Ao=ii,ac=qr,gA=Zi,_l=TypeError,ki=function(e,t){var s=arguments.length<2?gA(e):t;if(vn(s))return Ao(lo(s,e));throw new _l(ac(e)+" is not iterable")},Cm=Ce,Nm=ii,Tm=fi,pu=function(e,t,s){var r,i;Nm(e);try{if(!(r=Tm(e,"return"))){if(t==="throw")throw s;return s}r=Cm(r,e)}catch(l){i=!0,r=l}if(t==="throw")throw s;if(i)throw r;return Nm(r),s},GE=So,KE=Ce,Jg=ii,gd=qr,WE=rn,zE=No,Qx=k,Hx=ki,Rm=Zi,$g=pu,Gx=TypeError,bA=function(e,t){this.stopped=e,this.result=t},Im=bA.prototype,yl=function(e,t,s){var r,i,l,A,u,p,f,b=s&&s.that,w=!(!s||!s.AS_ENTRIES),_=!(!s||!s.IS_RECORD),C=!(!s||!s.IS_ITERATOR),U=!(!s||!s.INTERRUPTED),B=GE(t,b),j=function(q){return r&&$g(r,"normal"),new bA(!0,q)},K=function(q){return w?(Jg(q),U?B(q[0],q[1],j):B(q[0],q[1])):U?B(q,j):B(q)};if(_)r=e.iterator;else if(C)r=e;else{if(!(i=Rm(e)))throw new Gx(gd(e)+" is not iterable");if(WE(i)){for(l=0,A=zE(e);A>l;l++)if((u=K(e[l]))&&Qx(Im,u))return u;return new bA(!1)}r=Hx(e,i)}for(p=_?e.next:r.next;!(f=KE(p,r)).done;){try{u=K(f.value)}catch(q){$g(r,"throw",q)}if(typeof u=="object"&&u&&Qx(Im,u))return u}return new bA(!1)},Kx=qn,qE=Ts,Om=k,Wx=nc,mu=UE,bd=function(e,t,s){for(var r=V(t),i=ce.f,l=z.f,A=0;A<r.length;A++){var u=r[A];T(e,u)||s&&T(s,u)||i(e,u,l(t,u))}},Zg=Cn,km=yt,e0=fe,zx=function(e,t){ir(t)&&"cause"in t&&Lr(e,"cause",t.cause)},fu=function(e,t,s,r){Yn&&(Xr?Xr(e,t):Mr(e,"stack",Zr(s,r)))},YE=yl,qx=function(e,t){return e===void 0?arguments.length<2?"":t:Kx(e)},XE=Ur("toStringTag"),Ph=Error,JE=[].push,Dc=function(e,t){var s,r=Om(Uh,this);mu?s=mu(new Ph,r?Wx(this):Uh):(s=r?this:Zg(Uh),km(s,XE,"Error")),t!==void 0&&km(s,"message",qx(t)),fu(s,Dc,s.stack,1),arguments.length>2&&zx(s,arguments[2]);var i=[];return YE(e,JE,{that:i}),km(s,"errors",i),s};mu?mu(Dc,Ph):bd(Dc,Ph,{name:!0});var Uh=Dc.prototype=Zg(Ph.prototype,{constructor:e0(1,Dc),message:e0(1,""),name:e0(1,"AggregateError")});qE({global:!0},{AggregateError:Dc});var xA,uo,oc,xd=Y,Fh=O.WeakMap,t0=xd(Fh)&&/native code/.test(String(Fh)),s0=O,$E=et,r0=yt,Mh=Un,ZE=_o,yG=Em,EG=mA,_I="Object already initialized",eS=s0.TypeError,SG=s0.WeakMap;if(t0||ZE.state){var vd=ZE.state||(ZE.state=new SG);vd.get=vd.get,vd.has=vd.has,vd.set=vd.set,xA=function(e,t){if(vd.has(e))throw new eS(_I);return t.facade=e,vd.set(e,t),t},uo=function(e){return vd.get(e)||{}},oc=function(e){return vd.has(e)}}else{var Dm=yG("state");EG[Dm]=!0,xA=function(e,t){if(Mh(e,Dm))throw new eS(_I);return t.facade=e,r0(e,Dm,t),t},uo=function(e){return Mh(e,Dm)?e[Dm]:{}},oc=function(e){return Mh(e,Dm)}}var Vh,yI,EI,Qh={set:xA,get:uo,has:oc,enforce:function(e){return oc(e)?uo(e):xA(e,{})},getterFor:function(e){return function(t){var s;if(!$E(t)||(s=uo(t)).type!==e)throw new eS("Incompatible receiver, "+e+" required");return s}}},tS=oe,CG=Un,SI=Function.prototype,NG=tS&&Object.getOwnPropertyDescriptor,CI=CG(SI,"name"),NI={PROPER:CI&&(function(){}).name==="something",CONFIGURABLE:CI&&(!tS||tS&&NG(SI,"name").configurable)},TG=yt,gu=function(e,t,s,r){return r&&r.enumerable?e[t]=s:TG(e,t,s),e},RG=m,IG=Y,OG=et,kG=Cn,TI=nc,DG=gu,sS=Ur("iterator"),RI=!1;[].keys&&("next"in(EI=[].keys())?(yI=TI(TI(EI)))!==Object.prototype&&(Vh=yI):RI=!0);var BG=!OG(Vh)||RG(function(){var e={};return Vh[sS].call(e)!==e});IG((Vh=BG?{}:kG(Vh))[sS])||DG(Vh,sS,function(){return this});var II={IteratorPrototype:Vh,BUGGY_SAFARI_ITERATORS:RI},LG=To,jG=Fn?{}.toString:function(){return"[object "+LG(this)+"]"},PG=Fn,UG=_a.f,FG=yt,MG=Un,VG=jG,OI=Ur("toStringTag"),vA=function(e,t,s,r){var i=s?e:e&&e.prototype;i&&(MG(i,OI)||UG(i,OI,{configurable:!0,value:t}),r&&!PG&&FG(i,"toString",VG))},QG=II.IteratorPrototype,HG=Cn,GG=fe,KG=vA,WG=Xn,zG=function(){return this},rS=function(e,t,s,r){var i=t+" Iterator";return e.prototype=HG(QG,{next:GG(+!r,s)}),KG(e,i,!1,!0),WG[i]=zG,e},qG=Ts,YG=Ce,XG=NI,JG=rS,$G=nc,ZG=vA,kI=gu,DI=Xn,eK=II,tK=XG.PROPER,Yx=eK.BUGGY_SAFARI_ITERATORS,nS=Ur("iterator"),BI="keys",Xx="values",LI="entries",sK=function(){return this},jI=function(e,t,s,r,i,l,A){JG(s,t,r);var u,p,f,b=function(K){if(K===i&&B)return B;if(!Yx&&K&&K in C)return C[K];switch(K){case BI:case Xx:case LI:return function(){return new s(this,K)}}return function(){return new s(this)}},w=t+" Iterator",_=!1,C=e.prototype,U=C[nS]||C["@@iterator"]||i&&C[i],B=!Yx&&U||b(i),j=t==="Array"&&C.entries||U;if(j&&(u=$G(j.call(new e)))!==Object.prototype&&u.next&&(ZG(u,w,!0,!0),DI[w]=sK),tK&&i===Xx&&U&&U.name!==Xx&&(_=!0,B=function(){return YG(U,this)}),i)if(p={values:b(Xx),keys:l?B:b(BI),entries:b(LI)},A)for(f in p)(Yx||_||!(f in C))&&kI(C,f,p[f]);else qG({target:t,proto:!0,forced:Yx||_},p);return A&&C[nS]!==B&&kI(C,nS,B,{}),DI[t]=B,p},Jx=function(e,t){return{value:e,done:t}},rK=Rt,PI=Xn,UI=Qh;_a.f;var nK=jI,$x=Jx,FI="Array Iterator",iK=UI.set,aK=UI.getterFor(FI);nK(Array,"Array",function(e,t){iK(this,{type:FI,target:rK(e),index:0,kind:t})},function(){var e=aK(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,$x(void 0,!0);switch(e.kind){case"keys":return $x(s,!1);case"values":return $x(t[s],!1)}return $x([s,t[s]],!1)},"values"),PI.Arguments=PI.Array;var oK=_a,Zx=function(e,t,s){return oK.f(e,t,s)},cK=dt,lK=Zx,dK=oe,MI=Ur("species"),AK=k,uK=TypeError,iS=function(e,t){if(AK(t,e))return e;throw new uK("Incorrect invocation")},hK=Y,aS=_o,pK=I(Function.toString);hK(aS.inspectSource)||(aS.inspectSource=function(e){return pK(e)});var VI=aS.inspectSource,mK=I,fK=m,QI=Y,gK=To,bK=VI,HI=function(){},GI=dt("Reflect","construct"),oS=/^\s*(?:class|function)\b/,xK=mK(oS.exec),vK=!oS.test(HI),n0=function(e){if(!QI(e))return!1;try{return GI(HI,[],e),!0}catch{return!1}},KI=function(e){if(!QI(e))return!1;switch(gK(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return vK||!!xK(oS,bK(e))}catch{return!0}};KI.sham=!0;var i0,Bm,WI,cS,ev=!GI||fK(function(){var e;return n0(n0.call)||!n0(Object)||!n0(function(){e=!0})||e})?KI:n0,wK=ev,_K=qr,yK=TypeError,zI=ii,EK=function(e){if(wK(e))return e;throw new yK(_K(e)+" is not a constructor")},SK=st,CK=Ur("species"),lS=function(e,t){var s,r=zI(e).constructor;return r===void 0||SK(s=zI(r)[CK])?t:EK(s)},bu=I([].slice),NK=TypeError,Hh=function(e,t){if(e<t)throw new NK("Not enough arguments");return e},qI=/(?:ipad|iphone|ipod).*applewebkit/i.test($t),cc=O,TK=$,RK=So,YI=Y,IK=Un,XI=m,JI=At,OK=bu,$I=bh,kK=Hh,DK=qI,BK=ca,dS=cc.setImmediate,AS=cc.clearImmediate,LK=cc.process,uS=cc.Dispatch,jK=cc.Function,ZI=cc.MessageChannel,PK=cc.String,hS=0,a0={},eO="onreadystatechange";XI(function(){i0=cc.location});var pS=function(e){if(IK(a0,e)){var t=a0[e];delete a0[e],t()}},mS=function(e){return function(){pS(e)}},tO=function(e){pS(e.data)},sO=function(e){cc.postMessage(PK(e),i0.protocol+"//"+i0.host)};dS&&AS||(dS=function(e){kK(arguments.length,1);var t=YI(e)?e:jK(e),s=OK(arguments,1);return a0[++hS]=function(){TK(t,void 0,s)},Bm(hS),hS},AS=function(e){delete a0[e]},BK?Bm=function(e){LK.nextTick(mS(e))}:uS&&uS.now?Bm=function(e){uS.now(mS(e))}:ZI&&!DK?(cS=(WI=new ZI).port2,WI.port1.onmessage=tO,Bm=RK(cS.postMessage,cS)):cc.addEventListener&&YI(cc.postMessage)&&!cc.importScripts&&i0&&i0.protocol!=="file:"&&!XI(sO)?(Bm=sO,cc.addEventListener("message",tO,!1)):Bm=eO in $I("script")?function(e){JI.appendChild($I("script"))[eO]=function(){JI.removeChild(this),pS(e)}}:function(e){setTimeout(mS(e),0)});var tv={set:dS,clear:AS},rO=O,UK=oe,FK=Object.getOwnPropertyDescriptor,nO=function(e){if(!UK)return rO[e];var t=FK(rO,e);return t&&t.value},iO=function(){this.head=null,this.tail=null};iO.prototype={add:function(e){var t={item:e,next:null},s=this.tail;s?s.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Lm,fS,gS,bS,aO,oO=iO,MK=/ipad|iphone|ipod/i.test($t)&&typeof Pebble<"u",VK=/web0s(?!.*chrome)/i.test($t),jm=O,QK=nO,cO=So,xS=tv.set,HK=oO,GK=qI,KK=MK,WK=VK,vS=ca,lO=jm.MutationObserver||jm.WebKitMutationObserver,dO=jm.document,AO=jm.process,sv=jm.Promise,wS=QK("queueMicrotask");if(!wS){var rv=new HK,nv=function(){var e,t;for(vS&&(e=AO.domain)&&e.exit();t=rv.get();)try{t()}catch(s){throw rv.head&&Lm(),s}e&&e.enter()};GK||vS||WK||!lO||!dO?!KK&&sv&&sv.resolve?((bS=sv.resolve(void 0)).constructor=sv,aO=cO(bS.then,bS),Lm=function(){aO(nv)}):vS?Lm=function(){AO.nextTick(nv)}:(xS=cO(xS,jm),Lm=function(){xS(nv)}):(fS=!0,gS=dO.createTextNode(""),new lO(nv).observe(gS,{characterData:!0}),Lm=function(){gS.data=fS=!fS}),wS=function(e){rv.head||Lm(),rv.add(e)}}var uO=wS,Pm=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Gh=O.Promise,zK=O,o0=Gh,qK=Y,YK=um,XK=VI,JK=Ur,hO=Au,_S=Ut,pO=o0&&o0.prototype,$K=JK("species"),mO=qK(zK.PromiseRejectionEvent),ZK=YK("Promise",function(){var e=XK(o0),t=e!==String(o0);if(!t&&_S===66||!pO.catch||!pO.finally)return!0;if(!_S||_S<51||!/native code/.test(e)){var s=new o0(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((s.constructor={})[$K]=r,!(s.then(function(){})instanceof r))return!0}return!(t||hO!=="BROWSER"&&hO!=="DENO"||mO)}),c0={CONSTRUCTOR:ZK,REJECTION_EVENT:mO},wd={},fO=An,e9=TypeError,t9=function(e){var t,s;this.promise=new e(function(r,i){if(t!==void 0||s!==void 0)throw new e9("Bad Promise constructor");t=r,s=i}),this.resolve=fO(t),this.reject=fO(s)};wd.f=function(e){return new t9(e)};var yS,gO,bO,s9=Ts,iv=ca,xu=O,r9=$e,l0=Ce,n9=gu,i9=vA,a9=function(e){var t=cK(e);dK&&t&&!t[MI]&&lK(t,MI,{configurable:!0,get:function(){return this}})},o9=An,ES=Y,c9=et,l9=iS,d9=lS,xO=tv.set,SS=uO,A9=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},u9=Pm,h9=oO,vO=Qh,CS=Gh,wO=c0,_O=wd,av="Promise",yO=wO.CONSTRUCTOR,p9=wO.REJECTION_EVENT,NS=vO.getterFor(av),m9=vO.set,f9=CS&&CS.prototype,d0=CS,TS=f9,EO=xu.TypeError,RS=xu.document,IS=xu.process,OS=_O.f,g9=OS,b9=!!(RS&&RS.createEvent&&xu.dispatchEvent),SO="unhandledrejection",CO=function(e){var t;return!(!c9(e)||!ES(t=e.then))&&t},NO=function(e,t){var s,r,i,l=t.value,A=t.state===1,u=A?e.ok:e.fail,p=e.resolve,f=e.reject,b=e.domain;try{u?(A||(t.rejection===2&&v9(t),t.rejection=1),u===!0?s=l:(b&&b.enter(),s=u(l),b&&(b.exit(),i=!0)),s===e.promise?f(new EO("Promise-chain cycle")):(r=CO(s))?l0(r,s,p,f):p(s)):f(l)}catch(w){b&&!i&&b.exit(),f(w)}},TO=function(e,t){e.notified||(e.notified=!0,SS(function(){for(var s,r=e.reactions;s=r.get();)NO(s,e);e.notified=!1,t&&!e.rejection&&x9(e)}))},RO=function(e,t,s){var r,i;b9?((r=RS.createEvent("Event")).promise=t,r.reason=s,r.initEvent(e,!1,!0),xu.dispatchEvent(r)):r={promise:t,reason:s},!p9&&(i=xu["on"+e])?i(r):e===SO&&A9("Unhandled promise rejection",s)},x9=function(e){l0(xO,xu,function(){var t,s=e.facade,r=e.value;if(IO(e)&&(t=u9(function(){iv?IS.emit("unhandledRejection",r,s):RO(SO,s,r)}),e.rejection=iv||IO(e)?2:1,t.error))throw t.value})},IO=function(e){return e.rejection!==1&&!e.parent},v9=function(e){l0(xO,xu,function(){var t=e.facade;iv?IS.emit("rejectionHandled",t):RO("rejectionhandled",t,e.value)})},Um=function(e,t,s){return function(r){e(t,r,s)}},Fm=function(e,t,s){e.done||(e.done=!0,s&&(e=s),e.value=t,e.state=2,TO(e,!0))},kS=function(e,t,s){if(!e.done){e.done=!0,s&&(e=s);try{if(e.facade===t)throw new EO("Promise can't be resolved itself");var r=CO(t);r?SS(function(){var i={done:!1};try{l0(r,t,Um(kS,i,e),Um(Fm,i,e))}catch(l){Fm(i,l,e)}}):(e.value=t,e.state=1,TO(e,!1))}catch(i){Fm({done:!1},i,e)}}};yO&&(TS=(d0=function(e){l9(this,TS),o9(e),l0(yS,this);var t=NS(this);try{e(Um(kS,t),Um(Fm,t))}catch(s){Fm(t,s)}}).prototype,(yS=function(e){m9(this,{type:av,done:!1,notified:!1,parent:!1,reactions:new h9,rejection:!1,state:0,value:null})}).prototype=n9(TS,"then",function(e,t){var s=NS(this),r=OS(d9(this,d0));return s.parent=!0,r.ok=!ES(e)||e,r.fail=ES(t)&&t,r.domain=iv?IS.domain:void 0,s.state===0?s.reactions.add(r):SS(function(){NO(r,s)}),r.promise}),gO=function(){var e=new yS,t=NS(e);this.promise=e,this.resolve=Um(kS,t),this.reject=Um(Fm,t)},_O.f=OS=function(e){return e===d0||e===bO?new gO(e):g9(e)}),s9({global:!0,wrap:!0,forced:yO},{Promise:d0}),bO=r9.Promise,i9(d0,av,!1,!0),a9(av);var OO=Ur("iterator"),kO=!1;try{var w9=0,DO={next:function(){return{done:!!w9++}},return:function(){kO=!0}};DO[OO]=function(){return this},Array.from(DO,function(){throw 2})}catch{}var _9=Gh,y9=function(e,t){try{if(!t&&!kO)return!1}catch{return!1}var s=!1;try{var r={};r[OO]=function(){return{next:function(){return{done:s=!0}}}},e(r)}catch{}return s},ov=c0.CONSTRUCTOR||!y9(function(e){_9.all(e).then(void 0,function(){})}),E9=Ce,S9=An,C9=wd,N9=Pm,T9=yl;Ts({target:"Promise",stat:!0,forced:ov},{all:function(e){var t=this,s=C9.f(t),r=s.resolve,i=s.reject,l=N9(function(){var A=S9(t.resolve),u=[],p=0,f=1;T9(e,function(b){var w=p++,_=!1;f++,E9(A,t,b).then(function(C){_||(_=!0,u[w]=C,--f||r(u))},i)}),--f||r(u)});return l.error&&i(l.value),s.promise}});var R9=Ts,I9=c0.CONSTRUCTOR;Gh&&Gh.prototype,R9({target:"Promise",proto:!0,forced:I9,real:!0},{catch:function(e){return this.then(void 0,e)}});var O9=Ce,k9=An,D9=wd,B9=Pm,L9=yl;Ts({target:"Promise",stat:!0,forced:ov},{race:function(e){var t=this,s=D9.f(t),r=s.reject,i=B9(function(){var l=k9(t.resolve);L9(e,function(A){O9(l,t,A).then(s.resolve,r)})});return i.error&&r(i.value),s.promise}});var j9=wd;Ts({target:"Promise",stat:!0,forced:c0.CONSTRUCTOR},{reject:function(e){var t=j9.f(this);return(0,t.reject)(e),t.promise}});var P9=ii,U9=et,F9=wd,BO=function(e,t){if(P9(e),U9(t)&&t.constructor===e)return t;var s=F9.f(e);return(0,s.resolve)(t),s.promise},M9=Ts,V9=Gh,Q9=c0.CONSTRUCTOR,H9=BO,G9=dt("Promise"),K9=!Q9;M9({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return H9(K9&&this===G9?V9:this,e)}});var W9=Ce,z9=An,q9=wd,Y9=Pm,X9=yl;Ts({target:"Promise",stat:!0,forced:ov},{allSettled:function(e){var t=this,s=q9.f(t),r=s.resolve,i=s.reject,l=Y9(function(){var A=z9(t.resolve),u=[],p=0,f=1;X9(e,function(b){var w=p++,_=!1;f++,W9(A,t,b).then(function(C){_||(_=!0,u[w]={status:"fulfilled",value:C},--f||r(u))},function(C){_||(_=!0,u[w]={status:"rejected",reason:C},--f||r(u))})}),--f||r(u)});return l.error&&i(l.value),s.promise}});var J9=Ce,$9=An,Z9=dt,eW=wd,tW=Pm,sW=yl,LO="No one promise resolved";Ts({target:"Promise",stat:!0,forced:ov},{any:function(e){var t=this,s=Z9("AggregateError"),r=eW.f(t),i=r.resolve,l=r.reject,A=tW(function(){var u=$9(t.resolve),p=[],f=0,b=1,w=!1;sW(e,function(_){var C=f++,U=!1;b++,J9(u,t,_).then(function(B){U||w||(w=!0,i(B))},function(B){U||w||(U=!0,p[C]=B,--b||l(new s(p,LO)))})}),--b||l(new s(p,LO))});return A.error&&l(A.value),r.promise}});var rW=Ts,nW=$,iW=bu,aW=wd,oW=An,jO=Pm,DS=O.Promise,PO=!1;rW({target:"Promise",stat:!0,forced:!DS||!DS.try||jO(function(){DS.try(function(e){PO=e===8},8)}).error||!PO},{try:function(e){var t=arguments.length>1?iW(arguments,1):[],s=aW.f(this),r=jO(function(){return nW(oW(e),void 0,t)});return(r.error?s.reject:s.resolve)(r.value),s.promise}});var cW=wd;Ts({target:"Promise",stat:!0},{withResolvers:function(){var e=cW.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var lW=Ts,BS=Gh,dW=m,AW=dt,uW=Y,hW=lS,UO=BO,pW=BS&&BS.prototype;lW({target:"Promise",proto:!0,real:!0,forced:!!BS&&dW(function(){pW.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=hW(this,AW("Promise")),s=uW(e);return this.then(s?function(r){return UO(t,e()).then(function(){return r})}:e,s?function(r){return UO(t,e()).then(function(){throw r})}:e)}});var LS=I,mW=od,fW=qn,gW=rt,bW=LS("".charAt),FO=LS("".charCodeAt),xW=LS("".slice),MO=function(e){return function(t,s){var r,i,l=fW(gW(t)),A=mW(s),u=l.length;return A<0||A>=u?e?"":void 0:(r=FO(l,A))<55296||r>56319||A+1===u||(i=FO(l,A+1))<56320||i>57343?e?bW(l,A):r:e?xW(l,A,A+2):i-56320+(r-55296<<10)+65536}},jS={codeAt:MO(!1),charAt:MO(!0)},vW=jS.charAt,wW=qn,VO=Qh,_W=jI,QO=Jx,HO="String Iterator",yW=VO.set,EW=VO.getterFor(HO);_W(String,"String",function(e){yW(this,{type:HO,string:wW(e),index:0})},function(){var e,t=EW(this),s=t.string,r=t.index;return r>=s.length?QO(void 0,!0):(e=vW(s,r),t.index+=e.length,QO(e,!1))});var SW=$e.Promise,CW={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},NW=O,TW=vA,GO=Xn;for(var PS in CW)TW(NW[PS],PS),GO[PS]=GO.Array;var KO=SW,mt=h(KO),RW=wi("Array","values"),IW=To,OW=Un,kW=k,DW=RW,US=Array.prototype,BW={DOMTokenList:!0,NodeList:!0},LW=function(e){var t=e.values;return e===US||kW(US,e)&&t===US.values||OW(BW,IW(e))?DW:t},ho=h(LW),WO=qr,jW=TypeError,zO=bu,PW=Math.floor,FS=function(e,t){var s=e.length;if(s<8)for(var r,i,l=1;l<s;){for(i=l,r=e[l];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==l++&&(e[i]=r)}else for(var A=PW(s/2),u=FS(zO(e,0,A),t),p=FS(zO(e,A),t),f=u.length,b=p.length,w=0,_=0;w<f||_<b;)e[w+_]=w<f&&_<b?t(u[w],p[_])<=0?u[w++]:p[_++]:w<f?u[w++]:p[_++];return e},qO=FS,YO=$t.match(/firefox\/(\d+)/i),UW=!!YO&&+YO[1],FW=/MSIE|Trident/.test($t),XO=$t.match(/AppleWebKit\/(\d+)\./),MW=!!XO&&+XO[1],VW=Ts,JO=I,QW=An,HW=yo,$O=No,GW=function(e,t){if(!delete e[t])throw new jW("Cannot delete property "+WO(t)+" of "+WO(e))},ZO=qn,MS=m,KW=qO,WW=Lh,e5=UW,zW=FW,t5=Ut,s5=MW,vu=[],r5=JO(vu.sort),qW=JO(vu.push),YW=MS(function(){vu.sort(void 0)}),XW=MS(function(){vu.sort(null)}),JW=WW("sort"),n5=!MS(function(){if(t5)return t5<70;if(!(e5&&e5>3)){if(zW)return!0;if(s5)return s5<603;var e,t,s,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(r=0;r<47;r++)vu.push({k:t+r,v:s})}for(vu.sort(function(l,A){return A.v-l.v}),r=0;r<vu.length;r++)t=vu[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});VW({target:"Array",proto:!0,forced:YW||!XW||!JW||!n5},{sort:function(e){e!==void 0&&QW(e);var t=HW(this);if(n5)return e===void 0?r5(t):r5(t,e);var s,r,i=[],l=$O(t);for(r=0;r<l;r++)r in t&&qW(i,t[r]);for(KW(i,function(A){return function(u,p){return p===void 0?-1:u===void 0?1:A!==void 0?+A(u,p)||0:ZO(u)>ZO(p)?1:-1}}(e)),s=$O(i),r=0;r<s;)t[r]=i[r++];for(;r<l;)GW(t,r++);return t}});var $W=wi("Array","sort"),ZW=k,ez=$W,VS=Array.prototype,tz=function(e){var t=e.sort;return e===VS||ZW(VS,e)&&t===VS.sort?ez:t},Kh=h(tz),sz=Ts,rz=I,nz=Ic,iz=RangeError,i5=String.fromCharCode,a5=String.fromCodePoint,az=rz([].join);sz({target:"String",stat:!0,forced:!!a5&&a5.length!==1},{fromCodePoint:function(e){for(var t,s=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],nz(t,1114111)!==t)throw new iz(t+" is not a valid code point");s[i]=t<65536?i5(t):i5(55296+((t-=65536)>>10),t%1024+56320)}return az(s,"")}});var oz=m,cz=Ur("iterator"),cv=!oz(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(i,l){t.delete("b"),r+=l+i}),s.delete("a",2),s.delete("b",void 0),!e.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[cz]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),lz=gu,QS=Ts,o5=O,HS=nO,dz=dt,lv=Ce,El=I,A0=oe,c5=cv,l5=gu,Az=Zx,uz=function(e,t,s){for(var r in t)s&&s.unsafe&&e[r]?e[r]=t[r]:lz(e,r,t[r],s);return e},hz=vA,pz=rS,GS=Qh,d5=iS,KS=Y,mz=Un,fz=So,gz=To,bz=ii,A5=et,po=qn,xz=Cn,u5=fe,h5=ki,vz=Zi,dv=Jx,Mm=Hh,wz=qO,_z=Ur("iterator"),Vm="URLSearchParams",p5=Vm+"Iterator",m5=GS.set,Bc=GS.getterFor(Vm),yz=GS.getterFor(p5),f5=HS("fetch"),Av=HS("Request"),u0=HS("Headers"),WS=Av&&Av.prototype,g5=u0&&u0.prototype,Ez=o5.TypeError,Sz=o5.encodeURIComponent,Cz=String.fromCharCode,Nz=dz("String","fromCodePoint"),Tz=parseInt,uv=El("".charAt),b5=El([].join),wu=El([].push),x5=El("".replace),Rz=El([].shift),v5=El([].splice),w5=El("".split),_5=El("".slice),Iz=El(/./.exec),Oz=/\+/g,kz=/^[0-9a-f]+$/i,y5=function(e,t){var s=_5(e,t,t+2);return Iz(kz,s)?Tz(s,16):NaN},Dz=function(e){for(var t=0,s=128;s>0&&e&s;s>>=1)t++;return t},Bz=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},E5=function(e){for(var t=(e=x5(e,Oz," ")).length,s="",r=0;r<t;){var i=uv(e,r);if(i==="%"){if(uv(e,r+1)==="%"||r+3>t){s+="%",r++;continue}var l=y5(e,r+1);if(l!=l){s+=i,r++;continue}r+=2;var A=Dz(l);if(A===0)i=Cz(l);else{if(A===1||A>4){s+="",r++;continue}for(var u=[l],p=1;p<A&&!(++r+3>t||uv(e,r)!=="%");){var f=y5(e,r+1);if(f!=f){r+=3;break}if(f>191||f<128)break;wu(u,f),r+=2,p++}if(u.length!==A){s+="";continue}var b=Bz(u);b===null?s+="":i=Nz(b)}}s+=i,r++}return s},Lz=/[!'()~]|%20/g,jz={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Pz=function(e){return jz[e]},S5=function(e){return x5(Sz(e),Lz,Pz)},zS=pz(function(e,t){m5(this,{type:p5,target:Bc(e).entries,index:0,kind:t})},Vm,function(){var e=yz(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,dv(void 0,!0);var r=t[s];switch(e.kind){case"keys":return dv(r.key,!1);case"values":return dv(r.value,!1)}return dv([r.key,r.value],!1)},!0),C5=function(e){this.entries=[],this.url=null,e!==void 0&&(A5(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?uv(e,0)==="?"?_5(e,1):e:po(e)))};C5.prototype={type:Vm,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,s,r,i,l,A,u,p=this.entries,f=vz(e);if(f)for(s=(t=h5(e,f)).next;!(r=lv(s,t)).done;){if(l=(i=h5(bz(r.value))).next,(A=lv(l,i)).done||(u=lv(l,i)).done||!lv(l,i).done)throw new Ez("Expected sequence with length 2");wu(p,{key:po(A.value),value:po(u.value)})}else for(var b in e)mz(e,b)&&wu(p,{key:b,value:po(e[b])})},parseQuery:function(e){if(e)for(var t,s,r=this.entries,i=w5(e,"&"),l=0;l<i.length;)(t=i[l++]).length&&(s=w5(t,"="),wu(r,{key:E5(Rz(s)),value:E5(b5(s,"="))}))},serialize:function(){for(var e,t=this.entries,s=[],r=0;r<t.length;)e=t[r++],wu(s,S5(e.key)+"="+S5(e.value));return b5(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var hv=function(){d5(this,Qm);var e=m5(this,new C5(arguments.length>0?arguments[0]:void 0));A0||(this.size=e.entries.length)},Qm=hv.prototype;if(uz(Qm,{append:function(e,t){var s=Bc(this);Mm(arguments.length,2),wu(s.entries,{key:po(e),value:po(t)}),A0||this.length++,s.updateURL()},delete:function(e){for(var t=Bc(this),s=Mm(arguments.length,1),r=t.entries,i=po(e),l=s<2?void 0:arguments[1],A=l===void 0?l:po(l),u=0;u<r.length;){var p=r[u];if(p.key!==i||A!==void 0&&p.value!==A)u++;else if(v5(r,u,1),A!==void 0)break}A0||(this.size=r.length),t.updateURL()},get:function(e){var t=Bc(this).entries;Mm(arguments.length,1);for(var s=po(e),r=0;r<t.length;r++)if(t[r].key===s)return t[r].value;return null},getAll:function(e){var t=Bc(this).entries;Mm(arguments.length,1);for(var s=po(e),r=[],i=0;i<t.length;i++)t[i].key===s&&wu(r,t[i].value);return r},has:function(e){for(var t=Bc(this).entries,s=Mm(arguments.length,1),r=po(e),i=s<2?void 0:arguments[1],l=i===void 0?i:po(i),A=0;A<t.length;){var u=t[A++];if(u.key===r&&(l===void 0||u.value===l))return!0}return!1},set:function(e,t){var s=Bc(this);Mm(arguments.length,1);for(var r,i=s.entries,l=!1,A=po(e),u=po(t),p=0;p<i.length;p++)(r=i[p]).key===A&&(l?v5(i,p--,1):(l=!0,r.value=u));l||wu(i,{key:A,value:u}),A0||(this.size=i.length),s.updateURL()},sort:function(){var e=Bc(this);wz(e.entries,function(t,s){return t.key>s.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,s=Bc(this).entries,r=fz(e,arguments.length>1?arguments[1]:void 0),i=0;i<s.length;)r((t=s[i++]).value,t.key,this)},keys:function(){return new zS(this,"keys")},values:function(){return new zS(this,"values")},entries:function(){return new zS(this,"entries")}},{enumerable:!0}),l5(Qm,_z,Qm.entries,{}),l5(Qm,"toString",function(){return Bc(this).serialize()},{enumerable:!0}),A0&&Az(Qm,"size",{get:function(){return Bc(this).entries.length},configurable:!0,enumerable:!0}),hz(hv,Vm),QS({global:!0,forced:!c5},{URLSearchParams:hv}),!c5&&KS(u0)){var Uz=El(g5.has),Fz=El(g5.set),N5=function(e){if(A5(e)){var t,s=e.body;if(gz(s)===Vm)return t=e.headers?new u0(e.headers):new u0,Uz(t,"content-type")||Fz(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),xz(e,{body:u5(0,po(s)),headers:u5(0,t)})}return e};if(KS(f5)&&QS({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return f5(e,arguments.length>1?N5(arguments[1]):{})}}),KS(Av)){var qS=function(e){return d5(this,WS),new Av(e,arguments.length>1?N5(arguments[1]):{})};WS.constructor=qS,qS.prototype=WS,QS({global:!0,dontCallGetSet:!0,forced:!0},{Request:qS})}}var Lc,Mz={URLSearchParams:hv,getState:Bc},Vz=$e.URLSearchParams,T5=oe,Qz=I,Hz=Ce,Gz=m,YS=Se,Kz=jh,Wz=ee,zz=yo,qz=ze,Hm=Object.assign,R5=Object.defineProperty,Yz=Qz([].concat),Xz=!Hm||Gz(function(){if(T5&&Hm({b:1},Hm(R5({},"a",{enumerable:!0,get:function(){R5(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},s=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[s]=7,r.split("").forEach(function(i){t[i]=i}),Hm({},e)[s]!==7||YS(Hm({},t)).join("")!==r})?function(e,t){for(var s=zz(e),r=arguments.length,i=1,l=Kz.f,A=Wz.f;r>i;)for(var u,p=qz(arguments[i++]),f=l?Yz(YS(p),l(p)):YS(p),b=f.length,w=0;b>w;)u=f[w++],T5&&!Hz(A,p,u)||(s[u]=p[u]);return s}:Hm,Jz=ii,$z=pu,Zz=oe,eq=_a,tq=fe,XS=function(e,t,s){Zz?eq.f(e,t,tq(0,s)):e[t]=s},sq=So,rq=Ce,nq=yo,iq=function(e,t,s,r){try{return r?t(Jz(s)[0],s[1]):t(s)}catch(i){$z(e,"throw",i)}},aq=rn,oq=ev,cq=No,I5=XS,lq=ki,dq=Zi,O5=Array,Wh=I,JS=2147483647,Aq=/[^\0-\u007E]/,k5=/[.\u3002\uFF0E\uFF61]/g,D5="Overflow: input needs wider integers to process",B5=RangeError,uq=Wh(k5.exec),Gm=Math.floor,$S=String.fromCharCode,L5=Wh("".charCodeAt),j5=Wh([].join),_u=Wh([].push),hq=Wh("".replace),pq=Wh("".split),mq=Wh("".toLowerCase),P5=function(e){return e+22+75*(e<26)},fq=function(e,t,s){var r=0;for(e=s?Gm(e/700):e>>1,e+=Gm(e/t);e>455;)e=Gm(e/35),r+=36;return Gm(r+36*e/(e+38))},gq=function(e){var t=[];e=function(K){for(var q=[],ie=0,xe=K.length;ie<xe;){var ye=L5(K,ie++);if(ye>=55296&&ye<=56319&&ie<xe){var ue=L5(K,ie++);(64512&ue)==56320?_u(q,((1023&ye)<<10)+(1023&ue)+65536):(_u(q,ye),ie--)}else _u(q,ye)}return q}(e);var s,r,i=e.length,l=128,A=0,u=72;for(s=0;s<e.length;s++)(r=e[s])<128&&_u(t,$S(r));var p=t.length,f=p;for(p&&_u(t,"-");f<i;){var b=JS;for(s=0;s<e.length;s++)(r=e[s])>=l&&r<b&&(b=r);var w=f+1;if(b-l>Gm((JS-A)/w))throw new B5(D5);for(A+=(b-l)*w,l=b,s=0;s<e.length;s++){if((r=e[s])<l&&++A>JS)throw new B5(D5);if(r===l){for(var _=A,C=36;;){var U=C<=u?1:C>=u+26?26:C-u;if(_<U)break;var B=_-U,j=36-U;_u(t,$S(P5(U+B%j))),_=Gm(B/j),C+=36}_u(t,$S(P5(_))),u=fq(A,w,f===p),A=0,f++}}A++,l++}return j5(t,"")},bq=Ts,ZS=oe,xq=cv,eC=O,U5=So,jc=I,pv=gu,Pc=Zx,vq=iS,tC=Un,sC=Xz,Km=function(e){var t=nq(e),s=oq(this),r=arguments.length,i=r>1?arguments[1]:void 0,l=i!==void 0;l&&(i=sq(i,r>2?arguments[2]:void 0));var A,u,p,f,b,w,_=dq(t),C=0;if(!_||this===O5&&aq(_))for(A=cq(t),u=s?new this(A):O5(A);A>C;C++)w=l?i(t[C],C):t[C],I5(u,C,w);else for(u=s?new this:[],b=(f=lq(t,_)).next;!(p=rq(b,f)).done;C++)w=l?iq(f,i,[p.value,C],!0):p.value,I5(u,C,w);return u.length=C,u},Sl=bu,wq=jS.codeAt,_q=function(e){var t,s,r=[],i=pq(hq(mq(e),k5,"."),".");for(t=0;t<i.length;t++)s=i[t],_u(r,uq(Aq,s)?"xn--"+gq(s):s);return j5(r,".")},wA=qn,yq=vA,Eq=Hh,F5=Mz,M5=Qh,Sq=M5.set,mv=M5.getterFor("URL"),Cq=F5.URLSearchParams,Nq=F5.getState,h0=eC.URL,rC=eC.TypeError,fv=eC.parseInt,Tq=Math.floor,V5=Math.pow,Uc=jc("".charAt),Cl=jc(/./.exec),p0=jc([].join),Rq=jc(1.1.toString),Iq=jc([].pop),Wm=jc([].push),nC=jc("".replace),Oq=jc([].shift),kq=jc("".split),m0=jc("".slice),gv=jc("".toLowerCase),Dq=jc([].unshift),iC="Invalid scheme",zh="Invalid host",Q5="Invalid port",H5=/[a-z]/i,Bq=/[\d+-.a-z]/i,aC=/\d/,Lq=/^0x/i,jq=/^[0-7]+$/,Pq=/^\d+$/,G5=/^[\da-f]+$/i,Uq=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Fq=/[\0\t\n\r #/:<>?@[\\\]^|]/,Mq=/^[\u0000-\u0020]+/,Vq=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Qq=/[\t\n\r]/g,f0=function(e){var t,s,r,i;if(typeof e=="number"){for(t=[],s=0;s<4;s++)Dq(t,e%256),e=Tq(e/256);return p0(t,".")}if(typeof e=="object"){for(t="",r=function(l){for(var A=null,u=1,p=null,f=0,b=0;b<8;b++)l[b]!==0?(f>u&&(A=p,u=f),p=null,f=0):(p===null&&(p=b),++f);return f>u?p:A}(e),s=0;s<8;s++)i&&e[s]===0||(i&&(i=!1),r===s?(t+=s?":":"::",i=!0):(t+=Rq(e[s],16),s<7&&(t+=":")));return"["+t+"]"}return e},bv={},K5=sC({},bv,{" ":1,'"':1,"<":1,">":1,"`":1}),W5=sC({},K5,{"#":1,"?":1,"{":1,"}":1}),oC=sC({},W5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),yu=function(e,t){var s=wq(e,0);return s>32&&s<127&&!tC(t,e)?e:encodeURIComponent(e)},xv={ftp:21,file:null,http:80,https:443,ws:80,wss:443},g0=function(e,t){var s;return e.length===2&&Cl(H5,Uc(e,0))&&((s=Uc(e,1))===":"||!t&&s==="|")},z5=function(e){var t;return e.length>1&&g0(m0(e,0,2))&&(e.length===2||(t=Uc(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Hq=function(e){return e==="."||gv(e)==="%2e"},cC={},q5={},lC={},Y5={},X5={},dC={},J5={},$5={},vv={},wv={},AC={},uC={},hC={},pC={},Z5={},mC={},zm={},_d={},ek={},qh={},_A={},fC=function(e,t,s){var r,i,l,A=wA(e);if(t){if(i=this.parse(A))throw new rC(i);this.searchParams=null}else{if(s!==void 0&&(r=new fC(s,!0)),i=this.parse(A,null,r))throw new rC(i);(l=Nq(new Cq)).bindURL(this),this.searchParams=l}};fC.prototype={type:"URL",parse:function(e,t,s){var r,i,l,A,u,p=this,f=t||cC,b=0,w="",_=!1,C=!1,U=!1;for(e=wA(e),t||(p.scheme="",p.username="",p.password="",p.host=null,p.port=null,p.path=[],p.query=null,p.fragment=null,p.cannotBeABaseURL=!1,e=nC(e,Mq,""),e=nC(e,Vq,"$1")),e=nC(e,Qq,""),r=Km(e);b<=r.length;){switch(i=r[b],f){case cC:if(!i||!Cl(H5,i)){if(t)return iC;f=lC;continue}w+=gv(i),f=q5;break;case q5:if(i&&(Cl(Bq,i)||i==="+"||i==="-"||i==="."))w+=gv(i);else{if(i!==":"){if(t)return iC;w="",f=lC,b=0;continue}if(t&&(p.isSpecial()!==tC(xv,w)||w==="file"&&(p.includesCredentials()||p.port!==null)||p.scheme==="file"&&!p.host))return;if(p.scheme=w,t)return void(p.isSpecial()&&xv[p.scheme]===p.port&&(p.port=null));w="",p.scheme==="file"?f=pC:p.isSpecial()&&s&&s.scheme===p.scheme?f=Y5:p.isSpecial()?f=$5:r[b+1]==="/"?(f=X5,b++):(p.cannotBeABaseURL=!0,Wm(p.path,""),f=ek)}break;case lC:if(!s||s.cannotBeABaseURL&&i!=="#")return iC;if(s.cannotBeABaseURL&&i==="#"){p.scheme=s.scheme,p.path=Sl(s.path),p.query=s.query,p.fragment="",p.cannotBeABaseURL=!0,f=_A;break}f=s.scheme==="file"?pC:dC;continue;case Y5:if(i!=="/"||r[b+1]!=="/"){f=dC;continue}f=vv,b++;break;case X5:if(i==="/"){f=wv;break}f=_d;continue;case dC:if(p.scheme=s.scheme,i===Lc)p.username=s.username,p.password=s.password,p.host=s.host,p.port=s.port,p.path=Sl(s.path),p.query=s.query;else if(i==="/"||i==="\\"&&p.isSpecial())f=J5;else if(i==="?")p.username=s.username,p.password=s.password,p.host=s.host,p.port=s.port,p.path=Sl(s.path),p.query="",f=qh;else{if(i!=="#"){p.username=s.username,p.password=s.password,p.host=s.host,p.port=s.port,p.path=Sl(s.path),p.path.length--,f=_d;continue}p.username=s.username,p.password=s.password,p.host=s.host,p.port=s.port,p.path=Sl(s.path),p.query=s.query,p.fragment="",f=_A}break;case J5:if(!p.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){p.username=s.username,p.password=s.password,p.host=s.host,p.port=s.port,f=_d;continue}f=wv}else f=vv;break;case $5:if(f=vv,i!=="/"||Uc(w,b+1)!=="/")continue;b++;break;case vv:if(i!=="/"&&i!=="\\"){f=wv;continue}break;case wv:if(i==="@"){_&&(w="%40"+w),_=!0,l=Km(w);for(var B=0;B<l.length;B++){var j=l[B];if(j!==":"||U){var K=yu(j,oC);U?p.password+=K:p.username+=K}else U=!0}w=""}else if(i===Lc||i==="/"||i==="?"||i==="#"||i==="\\"&&p.isSpecial()){if(_&&w==="")return"Invalid authority";b-=Km(w).length+1,w="",f=AC}else w+=i;break;case AC:case uC:if(t&&p.scheme==="file"){f=mC;continue}if(i!==":"||C){if(i===Lc||i==="/"||i==="?"||i==="#"||i==="\\"&&p.isSpecial()){if(p.isSpecial()&&w==="")return zh;if(t&&w===""&&(p.includesCredentials()||p.port!==null))return;if(A=p.parseHost(w))return A;if(w="",f=zm,t)return;continue}i==="["?C=!0:i==="]"&&(C=!1),w+=i}else{if(w==="")return zh;if(A=p.parseHost(w))return A;if(w="",f=hC,t===uC)return}break;case hC:if(!Cl(aC,i)){if(i===Lc||i==="/"||i==="?"||i==="#"||i==="\\"&&p.isSpecial()||t){if(w!==""){var q=fv(w,10);if(q>65535)return Q5;p.port=p.isSpecial()&&q===xv[p.scheme]?null:q,w=""}if(t)return;f=zm;continue}return Q5}w+=i;break;case pC:if(p.scheme="file",i==="/"||i==="\\")f=Z5;else{if(!s||s.scheme!=="file"){f=_d;continue}switch(i){case Lc:p.host=s.host,p.path=Sl(s.path),p.query=s.query;break;case"?":p.host=s.host,p.path=Sl(s.path),p.query="",f=qh;break;case"#":p.host=s.host,p.path=Sl(s.path),p.query=s.query,p.fragment="",f=_A;break;default:z5(p0(Sl(r,b),""))||(p.host=s.host,p.path=Sl(s.path),p.shortenPath()),f=_d;continue}}break;case Z5:if(i==="/"||i==="\\"){f=mC;break}s&&s.scheme==="file"&&!z5(p0(Sl(r,b),""))&&(g0(s.path[0],!0)?Wm(p.path,s.path[0]):p.host=s.host),f=_d;continue;case mC:if(i===Lc||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&g0(w))f=_d;else if(w===""){if(p.host="",t)return;f=zm}else{if(A=p.parseHost(w))return A;if(p.host==="localhost"&&(p.host=""),t)return;w="",f=zm}continue}w+=i;break;case zm:if(p.isSpecial()){if(f=_d,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==Lc&&(f=_d,i!=="/"))continue}else p.fragment="",f=_A;else p.query="",f=qh;break;case _d:if(i===Lc||i==="/"||i==="\\"&&p.isSpecial()||!t&&(i==="?"||i==="#")){if((u=gv(u=w))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(p.shortenPath(),i==="/"||i==="\\"&&p.isSpecial()||Wm(p.path,"")):Hq(w)?i==="/"||i==="\\"&&p.isSpecial()||Wm(p.path,""):(p.scheme==="file"&&!p.path.length&&g0(w)&&(p.host&&(p.host=""),w=Uc(w,0)+":"),Wm(p.path,w)),w="",p.scheme==="file"&&(i===Lc||i==="?"||i==="#"))for(;p.path.length>1&&p.path[0]==="";)Oq(p.path);i==="?"?(p.query="",f=qh):i==="#"&&(p.fragment="",f=_A)}else w+=yu(i,W5);break;case ek:i==="?"?(p.query="",f=qh):i==="#"?(p.fragment="",f=_A):i!==Lc&&(p.path[0]+=yu(i,bv));break;case qh:t||i!=="#"?i!==Lc&&(i==="'"&&p.isSpecial()?p.query+="%27":p.query+=i==="#"?"%23":yu(i,bv)):(p.fragment="",f=_A);break;case _A:i!==Lc&&(p.fragment+=yu(i,K5))}b++}},parseHost:function(e){var t,s,r;if(Uc(e,0)==="["){if(Uc(e,e.length-1)!=="]"||(t=function(i){var l,A,u,p,f,b,w,_=[0,0,0,0,0,0,0,0],C=0,U=null,B=0,j=function(){return Uc(i,B)};if(j()===":"){if(Uc(i,1)!==":")return;B+=2,U=++C}for(;j();){if(C===8)return;if(j()!==":"){for(l=A=0;A<4&&Cl(G5,j());)l=16*l+fv(j(),16),B++,A++;if(j()==="."){if(A===0||(B-=A,C>6))return;for(u=0;j();){if(p=null,u>0){if(!(j()==="."&&u<4))return;B++}if(!Cl(aC,j()))return;for(;Cl(aC,j());){if(f=fv(j(),10),p===null)p=f;else{if(p===0)return;p=10*p+f}if(p>255)return;B++}_[C]=256*_[C]+p,++u!=2&&u!==4||C++}if(u!==4)return;break}if(j()===":"){if(B++,!j())return}else if(j())return;_[C++]=l}else{if(U!==null)return;B++,U=++C}}if(U!==null)for(b=C-U,C=7;C!==0&&b>0;)w=_[C],_[C--]=_[U+b-1],_[U+--b]=w;else if(C!==8)return;return _}(m0(e,1,-1)),!t))return zh;this.host=t}else if(this.isSpecial()){if(e=_q(e),Cl(Uq,e)||(t=function(i){var l,A,u,p,f,b,w,_=kq(i,".");if(_.length&&_[_.length-1]===""&&_.length--,(l=_.length)>4)return i;for(A=[],u=0;u<l;u++){if((p=_[u])==="")return i;if(f=10,p.length>1&&Uc(p,0)==="0"&&(f=Cl(Lq,p)?16:8,p=m0(p,f===8?1:2)),p==="")b=0;else{if(!Cl(f===10?Pq:f===8?jq:G5,p))return i;b=fv(p,f)}Wm(A,b)}for(u=0;u<l;u++)if(b=A[u],u===l-1){if(b>=V5(256,5-l))return null}else if(b>255)return null;for(w=Iq(A),u=0;u<A.length;u++)w+=A[u]*V5(256,3-u);return w}(e),t===null))return zh;this.host=t}else{if(Cl(Fq,e))return zh;for(t="",s=Km(e),r=0;r<s.length;r++)t+=yu(s[r],bv);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return tC(xv,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&g0(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,s=e.username,r=e.password,i=e.host,l=e.port,A=e.path,u=e.query,p=e.fragment,f=t+":";return i!==null?(f+="//",e.includesCredentials()&&(f+=s+(r?":"+r:"")+"@"),f+=f0(i),l!==null&&(f+=":"+l)):t==="file"&&(f+="//"),f+=e.cannotBeABaseURL?A[0]:A.length?"/"+p0(A,"/"):"",u!==null&&(f+="?"+u),p!==null&&(f+="#"+p),f},setHref:function(e){var t=this.parse(e);if(t)throw new rC(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new qm(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+f0(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(wA(e)+":",cC)},getUsername:function(){return this.username},setUsername:function(e){var t=Km(wA(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<t.length;s++)this.username+=yu(t[s],oC)}},getPassword:function(){return this.password},setPassword:function(e){var t=Km(wA(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<t.length;s++)this.password+=yu(t[s],oC)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?f0(e):f0(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,AC)},getHostname:function(){var e=this.host;return e===null?"":f0(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,uC)},getPort:function(){var e=this.port;return e===null?"":wA(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=wA(e))===""?this.port=null:this.parse(e,hC))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+p0(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,zm))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=wA(e))===""?this.query=null:(Uc(e,0)==="?"&&(e=m0(e,1)),this.query="",this.parse(e,qh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=wA(e))!==""?(Uc(e,0)==="#"&&(e=m0(e,1)),this.fragment="",this.parse(e,_A)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var qm=function(e){var t=vq(this,mo),s=Eq(arguments.length,1)>1?arguments[1]:void 0,r=Sq(t,new fC(e,!1,s));ZS||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},mo=qm.prototype,Fc=function(e,t){return{get:function(){return mv(this)[e]()},set:t&&function(s){return mv(this)[t](s)},configurable:!0,enumerable:!0}};if(ZS&&(Pc(mo,"href",Fc("serialize","setHref")),Pc(mo,"origin",Fc("getOrigin")),Pc(mo,"protocol",Fc("getProtocol","setProtocol")),Pc(mo,"username",Fc("getUsername","setUsername")),Pc(mo,"password",Fc("getPassword","setPassword")),Pc(mo,"host",Fc("getHost","setHost")),Pc(mo,"hostname",Fc("getHostname","setHostname")),Pc(mo,"port",Fc("getPort","setPort")),Pc(mo,"pathname",Fc("getPathname","setPathname")),Pc(mo,"search",Fc("getSearch","setSearch")),Pc(mo,"searchParams",Fc("getSearchParams")),Pc(mo,"hash",Fc("getHash","setHash"))),pv(mo,"toJSON",function(){return mv(this).serialize()},{enumerable:!0}),pv(mo,"toString",function(){return mv(this).serialize()},{enumerable:!0}),h0){var tk=h0.createObjectURL,sk=h0.revokeObjectURL;tk&&pv(qm,"createObjectURL",U5(tk,h0)),sk&&pv(qm,"revokeObjectURL",U5(sk,h0))}yq(qm,"URL"),bq({global:!0,forced:!xq,sham:!ZS},{URL:qm});var Gq=Ts,rk=m,Kq=Hh,nk=qn,Wq=cv,gC=dt("URL"),zq=Wq&&rk(function(){gC.canParse()}),qq=rk(function(){return gC.canParse.length!==1});Gq({target:"URL",stat:!0,forced:!zq||qq},{canParse:function(e){var t=Kq(arguments.length,1),s=nk(e),r=t<2||arguments[1]===void 0?void 0:nk(arguments[1]);try{return!!new gC(s,r)}catch{return!1}}});var Yq=Ts,Xq=Hh,ik=qn,Jq=cv,$q=dt("URL");Yq({target:"URL",stat:!0,forced:!Jq},{parse:function(e){var t=Xq(arguments.length,1),s=ik(e),r=t<2||arguments[1]===void 0?void 0:ik(arguments[1]);try{return new $q(s,r)}catch{return null}}});var _v=h($e.URL);let ak=!0,ok=!0;function yv(e,t,s){const r=e.match(t);return r&&r.length>=s&&parseInt(r[s],10)}function Yh(e,t,s){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(A,u){if(A!==t)return i.apply(this,arguments);const p=f=>{const b=s(f);b&&(u.handleEvent?u.handleEvent(b):u(b))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,p),i.apply(this,[A,p])};const l=r.removeEventListener;r.removeEventListener=function(A,u){if(A!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(u))return l.apply(this,arguments);const p=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[A,p])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(A){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),A&&this.addEventListener(t,this["_on"+t]=A)},enumerable:!0,configurable:!0})}function Zq(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ak=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function eY(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ok=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function ck(){if(typeof window=="object"){if(ak)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function bC(e,t){ok&&console.warn(e+" is deprecated, please use "+t+" instead.")}function lk(e){return Object.prototype.toString.call(e)==="[object Object]"}function dk(e){var t;return lk(e)?Fa(t=Object.keys(e)).call(t,function(s,r){const i=lk(e[r]),l=i?dk(e[r]):e[r],A=i&&!Object.keys(l).length;return l===void 0||A?s:Object.assign(s,{[r]:l})},{}):e}function xC(e,t,s){t&&!s.has(t.id)&&(s.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?xC(e,e.get(t[r]),s):r.endsWith("Ids")&&t[r].forEach(i=>{xC(e,e.get(i),s)})}))}function Ak(e,t,s){const r=s?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const l=[];return e.forEach(A=>{A.type==="track"&&A.trackIdentifier===t.id&&l.push(A)}),l.forEach(A=>{e.forEach(u=>{u.type===r&&u.trackId===A.id&&xC(e,u,i)})}),i}const uk=ck;function hk(e,t){const s=e&&e.navigator;if(!s.mediaDevices)return;const r=function(A){if(typeof A!="object"||A.mandatory||A.optional)return A;const u={};return Object.keys(A).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const f=typeof A[p]=="object"?A[p]:{ideal:A[p]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const b=function(w,_){return w?w+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(f.ideal!==void 0){u.optional=u.optional||[];let w={};typeof f.ideal=="number"?(w[b("min",p)]=f.ideal,u.optional.push(w),w={},w[b("max",p)]=f.ideal,u.optional.push(w)):(w[b("",p)]=f.ideal,u.optional.push(w))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[b("",p)]=f.exact):["min","max"].forEach(w=>{f[w]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[b(w,p)]=f[w])})}),A.advanced&&(u.optional=(u.optional||[]).concat(A.advanced)),u},i=function(A,u){if(t.version>=61)return u(A);if((A=JSON.parse(JSON.stringify(A)))&&typeof A.audio=="object"){const p=function(f,b,w){b in f&&!(w in f)&&(f[w]=f[b],delete f[b])};p((A=JSON.parse(JSON.stringify(A))).audio,"autoGainControl","googAutoGainControl"),p(A.audio,"noiseSuppression","googNoiseSuppression"),A.audio=r(A.audio)}if(A&&typeof A.video=="object"){let p=A.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const f=t.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||f)){let b;if(delete A.video.facingMode,p.exact==="environment"||p.ideal==="environment"?b=["back","rear"]:p.exact!=="user"&&p.ideal!=="user"||(b=["front"]),b)return s.mediaDevices.enumerateDevices().then(w=>{w=w.filter(C=>C.kind==="videoinput");let _=w.find(C=>b.some(U=>{var B;return nt(B=C.label.toLowerCase()).call(B,U)}));return!_&&w.length&&nt(b).call(b,"back")&&(_=w[w.length-1]),_&&(A.video.deviceId=p.exact?{exact:_.deviceId}:{ideal:_.deviceId}),A.video=r(A.video),uk("chrome: "+JSON.stringify(A)),u(A)})}A.video=r(A.video)}return uk("chrome: "+JSON.stringify(A)),u(A)},l=function(A){return t.version>=64?A:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[A.name]||A.name,message:A.message,constraint:A.constraint||A.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(A,u,p){i(A,f=>{s.webkitGetUserMedia(f,u,b=>{p&&p(l(b))})})}).bind(s),s.mediaDevices.getUserMedia){const A=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(u){return i(u,p=>A(p).then(f=>{if(p.audio&&!f.getAudioTracks().length||p.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return f},f=>mt.reject(l(f))))}}}function pk(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function mk(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(A=>A.track&&A.track.id===r.track.id):{track:r.track};const l=new Event("track");l.track=r.track,l.receiver=i,l.transceiver={receiver:i},l.streams=[s.stream],this.dispatchEvent(l)}),s.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(A=>A.track&&A.track.id===r.id):{track:r};const l=new Event("track");l.track=r,l.receiver=i,l.transceiver={receiver:i},l.streams=[s.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Yh(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function fk(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=i.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(A,u){let p=i.apply(this,arguments);return p||(p=t(this,A),this._senders.push(p)),p};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(A){l.apply(this,arguments);const u=this._senders.indexOf(A);u!==-1&&this._senders.splice(u,1)}}const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],s.apply(this,[i]),i.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(l=>{const A=this._senders.find(u=>u.track===l);A&&this._senders.splice(this._senders.indexOf(A),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function gk(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,r,i]=arguments;if(arguments.length>0&&typeof s=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof s!="function"))return t.apply(this,[]);const l=function(u){const p={};return u.result().forEach(f=>{const b={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(w=>{b[w]=f.stat(w)}),p[b.id]=b}),p},A=function(u){return new Map(Object.keys(u).map(p=>[p,u[p]]))};if(arguments.length>=2){const u=function(p){r(A(l(p)))};return t.apply(this,[u,s])}return new mt((u,p)=>{t.apply(this,[function(f){u(A(l(f)))},p])}).then(r,i)}}function bk(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=s.apply(this,[]);return i.forEach(l=>l._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(l=>Ak(l,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=s.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Yh(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>Ak(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const s=arguments[0];let r,i,l;return this.getSenders().forEach(A=>{A.track===s&&(r?l=!0:r=A)}),this.getReceivers().forEach(A=>(A.track===s&&(i?l=!0:i=A),A.track===s)),l||r&&i?mt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():mt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function xk(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,A){if(!A)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[A.id]?this._shimmedLocalStreams[A.id].indexOf(u)===-1&&this._shimmedLocalStreams[A.id].push(u):this._shimmedLocalStreams[A.id]=[A,u],u};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(p=>{if(this.getSenders().find(b=>b.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const A=this.getSenders();s.apply(this,arguments);const u=this.getSenders().filter(p=>A.indexOf(p)===-1);this._shimmedLocalStreams[l.id]=[l].concat(u)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(A=>{const u=this._shimmedLocalStreams[A].indexOf(l);u!==-1&&this._shimmedLocalStreams[A].splice(u,1),this._shimmedLocalStreams[A].length===1&&delete this._shimmedLocalStreams[A]}),i.apply(this,arguments)}}function vk(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return xk(e);const s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const p=s.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(f=>this._reverseStreams[f.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(f=>{if(this.getSenders().find(w=>w.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const f=new e.MediaStream(p.getTracks());this._streams[p.id]=f,this._reverseStreams[f.id]=p,p=f}r.apply(this,[p])};const i=e.RTCPeerConnection.prototype.removeStream;function l(p,f){let b=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(w=>{const _=p._reverseStreams[w],C=p._streams[_.id];b=b.replace(new RegExp(C.id,"g"),_.id)}),new RTCSessionDescription({type:f.type,sdp:b})}e.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},e.RTCPeerConnection.prototype.addTrack=function(p,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(C=>C===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[f.id];if(_)_.addTrack(p),mt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new e.MediaStream([p]);this._streams[f.id]=C,this._reverseStreams[C.id]=f,this.addStream(C)}return this.getSenders().find(C=>C.track===p)},["createOffer","createAnswer"].forEach(function(p){const f=e.RTCPeerConnection.prototype[p],b={[p](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[_=>{const C=l(this,_);w[0].apply(null,[C])},_=>{w[1]&&w[1].apply(null,_)},arguments[2]]):f.apply(this,arguments).then(_=>l(this,_))}};e.RTCPeerConnection.prototype[p]=b[p]});const A=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(p,f){let b=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(w=>{const _=p._reverseStreams[w],C=p._streams[_.id];b=b.replace(new RegExp(_.id,"g"),C.id)}),new RTCSessionDescription({type:f.type,sdp:b})}(this,arguments[0]),A.apply(this,arguments)):A.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const p=u.get.apply(this);return p.type===""?p:l(this,p)}}),e.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(w=>p.track===w)&&(f=this._streams[b])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function vC(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=e.RTCPeerConnection.prototype[s],i={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=i[s]})}function wk(e,t){Yh(e,"negotiationneeded",s=>{const r=s.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return s})}var _k=Object.freeze({__proto__:null,fixNegotiationNeeded:wk,shimAddTrackRemoveTrack:vk,shimAddTrackRemoveTrackWithNative:xk,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(s){return t(s).then(r=>{const i=s.video&&s.video.width,l=s.video&&s.video.height,A=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:A||3}},i&&(s.video.mandatory.maxWidth=i),l&&(s.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:fk,shimGetStats:gk,shimGetUserMedia:hk,shimMediaStream:pk,shimOnTrack:mk,shimPeerConnection:vC,shimSenderReceiverGetStats:bk});function yk(e,t){const s=e&&e.navigator,r=e&&e.MediaStreamTrack;if(s.getUserMedia=function(i,l,A){bC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(i).then(l,A)},!(t.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const i=function(A,u,p){u in A&&!(p in A)&&(A[p]=A[u],delete A[u])},l=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(A){return typeof A=="object"&&typeof A.audio=="object"&&(A=JSON.parse(JSON.stringify(A)),i(A.audio,"autoGainControl","mozAutoGainControl"),i(A.audio,"noiseSuppression","mozNoiseSuppression")),l(A)},r&&r.prototype.getSettings){const A=r.prototype.getSettings;r.prototype.getSettings=function(){const u=A.apply(this,arguments);return i(u,"mozAutoGainControl","autoGainControl"),i(u,"mozNoiseSuppression","noiseSuppression"),u}}if(r&&r.prototype.applyConstraints){const A=r.prototype.applyConstraints;r.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),i(u,"autoGainControl","mozAutoGainControl"),i(u,"noiseSuppression","mozNoiseSuppression")),A.apply(this,[u])}}}}function Ek(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wC(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const l=e.RTCPeerConnection.prototype[i],A={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=A[i]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,l,A]=arguments;return r.apply(this,[i||null]).then(u=>{if(t.version<53&&!l)try{u.forEach(p=>{p.type=s[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;u.forEach((f,b)=>{u.set(b,Object.assign({},f,{type:s[f.type]||f.type}))})}return u}).then(l,A)}}function Sk(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=s.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):mt.resolve(new Map)}}function Ck(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s}),Yh(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Nk(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){bC("removeStream","removeTrack"),this.getSenders().forEach(s=>{var r;s.track&&nt(r=t.getTracks()).call(r,s.track)&&this.removeTrack(s)})})}function Tk(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Rk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const r=s.length>0;r&&s.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:l}=i,A=l.getParameters();(!("encodings"in A)||A.encodings.length===1&&Object.keys(A.encodings[0]).length===0)&&(A.encodings=s,l.sendEncodings=s,this.setParametersPromises.push(l.setParameters(A).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return i})}function Ik(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const s=t.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function Ok(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?mt.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function kk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?mt.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Dk=Object.freeze({__proto__:null,shimAddTransceiver:Rk,shimCreateAnswer:kk,shimCreateOffer:Ok,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,mt.reject(r)}return s.video===!0?s.video={mediaSource:t}:s.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:Ik,shimGetUserMedia:yk,shimOnTrack:Ek,shimPeerConnection:wC,shimRTCDataChannel:Tk,shimReceiverGetStats:Ck,shimRemoveStream:Nk,shimSenderGetStats:Sk});function Bk(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(s){var r;this._localStreams||(this._localStreams=[]),nt(r=this._localStreams).call(r,s)||this._localStreams.push(s),s.getAudioTracks().forEach(i=>t.call(this,i,s)),s.getVideoTracks().forEach(i=>t.call(this,i,s))},e.RTCPeerConnection.prototype.addTrack=function(s){for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];return i&&i.forEach(A=>{var u;this._localStreams?nt(u=this._localStreams).call(u,A)||this._localStreams.push(A):this._localStreams=[A]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(t);if(s===-1)return;this._localStreams.splice(s,1);const r=t.getTracks();this.getSenders().forEach(i=>{nt(r).call(r,i.track)&&this.removeTrack(i)})})}}function Lk(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),nt(l=this._remoteStreams).call(l,i))return;this._remoteStreams.push(i);const A=new Event("addstream");A.stream=i,this.dispatchEvent(A)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(i)>=0)return;s._remoteStreams.push(i);const l=new Event("addstream");l.stream=i,s.dispatchEvent(l)})}),t.apply(s,arguments)}}}function jk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,s=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,l=t.setRemoteDescription,A=t.addIceCandidate;t.createOffer=function(p,f){const b=arguments.length>=2?arguments[2]:arguments[0],w=s.apply(this,[b]);return f?(w.then(p,f),mt.resolve()):w},t.createAnswer=function(p,f){const b=arguments.length>=2?arguments[2]:arguments[0],w=r.apply(this,[b]);return f?(w.then(p,f),mt.resolve()):w};let u=function(p,f,b){const w=i.apply(this,[p]);return b?(w.then(f,b),mt.resolve()):w};t.setLocalDescription=u,u=function(p,f,b){const w=l.apply(this,[p]);return b?(w.then(f,b),mt.resolve()):w},t.setRemoteDescription=u,u=function(p,f,b){const w=A.apply(this,[p]);return b?(w.then(f,b),mt.resolve()):w},t.addIceCandidate=u}function Pk(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const s=t.mediaDevices,r=s.getUserMedia.bind(s);t.mediaDevices.getUserMedia=i=>r(Uk(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(s,r,i){t.mediaDevices.getUserMedia(s).then(r,i)}).bind(t))}function Uk(e){return e&&e.video!==void 0?Object.assign({},e,{video:dk(e.video)}):e}function Fk(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(s,r){if(s&&s.iceServers){const i=[];for(let l=0;l<s.iceServers.length;l++){let A=s.iceServers[l];!A.hasOwnProperty("urls")&&A.hasOwnProperty("url")?(bC("RTCIceServer.url","RTCIceServer.urls"),A=JSON.parse(JSON.stringify(A)),A.urls=A.url,delete A.url,i.push(A)):i.push(s.iceServers[l])}s.iceServers=i}return new t(s,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Mk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Vk(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const r=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):s.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const i=this.getTransceivers().find(l=>l.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):s.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Qk(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Hk=Object.freeze({__proto__:null,shimAudioContext:Qk,shimCallbacksAPI:jk,shimConstraints:Uk,shimCreateOfferLegacy:Vk,shimGetUserMedia:Pk,shimLocalStreamsAPI:Bk,shimRTCIceServerUrls:Fk,shimRemoteStreamsAPI:Lk,shimTrackEventTransceiver:Mk}),Gk=`	
\v\f\r \u2028\u2029\uFEFF`,tY=rt,sY=qn,_C=Gk,Kk=I("".replace),rY=RegExp("^["+_C+"]+"),nY=RegExp("(^|[^"+_C+"])["+_C+"]+$"),iY=function(e){return function(t){var s=sY(tY(t));return 1&e&&(s=Kk(s,rY,"")),2&e&&(s=Kk(s,nY,"$1")),s}},aY={trim:iY(3)},oY=NI.PROPER,cY=m,Wk=Gk,lY=aY.trim;Ts({target:"String",proto:!0,forced:function(e){return cY(function(){return!!Wk[e]()||""[e]()!==""||oY&&Wk[e].name!==e})}("trim")},{trim:function(){return lY(this)}});var dY=wi("String","trim"),AY=k,uY=dY,yC=String.prototype,hY=function(e){var t=e.trim;return typeof e=="string"||e===yC||AY(yC,e)&&t===yC.trim?uY:t},da=h(hY),zk={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(s){return s.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(s){return s.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(s){const r=t.splitSections(s);return r&&r[0]},t.getMediaSections=function(s){const r=t.splitSections(s);return r.shift(),r},t.matchPrefix=function(s,r){return t.splitLines(s).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(s){let r;r=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let l=8;l<r.length;l+=2)switch(r[l]){case"raddr":i.relatedAddress=r[l+1];break;case"rport":i.relatedPort=parseInt(r[l+1],10);break;case"tcptype":i.tcpType=r[l+1];break;case"ufrag":i.ufrag=r[l+1],i.usernameFragment=r[l+1];break;default:i[r[l]]===void 0&&(i[r[l]]=r[l+1])}return i},t.writeCandidate=function(s){const r=[];r.push(s.foundation);const i=s.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(s.protocol.toUpperCase()),r.push(s.priority),r.push(s.address||s.ip),r.push(s.port);const l=s.type;return r.push("typ"),r.push(l),l!=="host"&&s.relatedAddress&&s.relatedPort&&(r.push("raddr"),r.push(s.relatedAddress),r.push("rport"),r.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(r.push("ufrag"),r.push(s.usernameFragment||s.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(s){return s.substring(14).split(" ")},t.parseRtpMap=function(s){let r=s.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(s){let r=s.payloadType;s.preferredPayloadType!==void 0&&(r=s.preferredPayloadType);const i=s.channels||s.numChannels||1;return"a=rtpmap:"+r+" "+s.name+"/"+s.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(s){const r=s.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},t.parseFmtp=function(s){const r={};let i;const l=s.substring(s.indexOf(" ")+1).split(";");for(let A=0;A<l.length;A++)i=l[A].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(s){let r="",i=s.payloadType;if(s.preferredPayloadType!==void 0&&(i=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const l=[];Object.keys(s.parameters).forEach(A=>{s.parameters[A]!==void 0?l.push(A+"="+s.parameters[A]):l.push(A)}),r+="a=fmtp:"+i+" "+l.join(";")+`\r
`}return r},t.parseRtcpFb=function(s){const r=s.substring(s.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(s){let r="",i=s.payloadType;return s.preferredPayloadType!==void 0&&(i=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(l=>{r+="a=rtcp-fb:"+i+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(s){const r=s.indexOf(" "),i={ssrc:parseInt(s.substring(7,r),10)},l=s.indexOf(":",r);return l>-1?(i.attribute=s.substring(r+1,l),i.value=s.substring(l+1)):i.attribute=s.substring(r+1),i},t.parseSsrcGroup=function(s){const r=s.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(s){const r=t.matchPrefix(s,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(s){const r=s.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(s,r){return{role:"auto",fingerprints:t.matchPrefix(s+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(s,r){let i="a=setup:"+r+`\r
`;return s.fingerprints.forEach(l=>{i+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),i},t.parseCryptoLine=function(s){const r=s.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?t.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const r=s.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},t.getCryptoParameters=function(s,r){return t.matchPrefix(s+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(s,r){const i=t.matchPrefix(s+r,"a=ice-ufrag:")[0],l=t.matchPrefix(s+r,"a=ice-pwd:")[0];return i&&l?{usernameFragment:i.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(s){let r="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(s){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(s)[0].split(" ");r.profile=i[2];for(let A=3;A<i.length;A++){const u=i[A],p=t.matchPrefix(s,"a=rtpmap:"+u+" ")[0];if(p){const f=t.parseRtpMap(p),b=t.matchPrefix(s,"a=fmtp:"+u+" ");switch(f.parameters=b.length?t.parseFmtp(b[0]):{},f.rtcpFeedback=t.matchPrefix(s,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),r.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(f.name.toUpperCase())}}}t.matchPrefix(s,"a=extmap:").forEach(A=>{r.headerExtensions.push(t.parseExtmap(A))});const l=t.matchPrefix(s,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(A=>{l.forEach(u=>{A.rtcpFeedback.find(p=>p.type===u.type&&p.parameter===u.parameter)||A.rtcpFeedback.push(u)})}),r},t.writeRtpDescription=function(s,r){let i="";i+="m="+s+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(A=>A.preferredPayloadType!==void 0?A.preferredPayloadType:A.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(A=>{i+=t.writeRtpMap(A),i+=t.writeFmtp(A),i+=t.writeRtcpFb(A)});let l=0;return r.codecs.forEach(A=>{A.maxptime>l&&(l=A.maxptime)}),l>0&&(i+="a=maxptime:"+l+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(A=>{i+=t.writeExtmap(A)}),i},t.parseRtpEncodingParameters=function(s){const r=[],i=t.parseRtpParameters(s),l=i.fecMechanisms.indexOf("RED")!==-1,A=i.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(s,"a=ssrc:").map(_=>t.parseSsrcMedia(_)).filter(_=>_.attribute==="cname"),p=u.length>0&&u[0].ssrc;let f;const b=t.matchPrefix(s,"a=ssrc-group:FID").map(_=>_.substring(17).split(" ").map(C=>parseInt(C,10)));b.length>0&&b[0].length>1&&b[0][0]===p&&(f=b[0][1]),i.codecs.forEach(_=>{if(_.name.toUpperCase()==="RTX"&&_.parameters.apt){let C={ssrc:p,codecPayloadType:parseInt(_.parameters.apt,10)};p&&f&&(C.rtx={ssrc:f}),r.push(C),l&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:p,mechanism:A?"red+ulpfec":"red"},r.push(C))}}),r.length===0&&p&&r.push({ssrc:p});let w=t.matchPrefix(s,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,r.forEach(_=>{_.maxBitrate=w})),r},t.parseRtcpParameters=function(s){const r={},i=t.matchPrefix(s,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const l=t.matchPrefix(s,"a=rtcp-rsize");r.reducedSize=l.length>0,r.compound=l.length===0;const A=t.matchPrefix(s,"a=rtcp-mux");return r.mux=A.length>0,r},t.writeRtcpParameters=function(s){let r="";return s.reducedSize&&(r+=`a=rtcp-rsize\r
`),s.mux&&(r+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(r+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),r},t.parseMsid=function(s){let r;const i=t.matchPrefix(s,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const l=t.matchPrefix(s,"a=ssrc:").map(A=>t.parseSsrcMedia(A)).filter(A=>A.attribute==="msid");return l.length>0?(r=l[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(s){const r=t.parseMLine(s),i=t.matchPrefix(s,"a=max-message-size:");let l;i.length>0&&(l=parseInt(i[0].substring(19),10)),isNaN(l)&&(l=65536);const A=t.matchPrefix(s,"a=sctp-port:");if(A.length>0)return{port:parseInt(A[0].substring(12),10),protocol:r.fmt,maxMessageSize:l};const u=t.matchPrefix(s,"a=sctpmap:");if(u.length>0){const p=u[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:l}}},t.writeSctpDescription=function(s,r){let i=[];return i=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(s,r,i){let l;const A=r!==void 0?r:2;return l=s||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+l+" "+A+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(s,r){const i=t.splitLines(s);for(let l=0;l<i.length;l++)switch(i[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[l].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(s){return t.splitLines(s)[0].split(" ")[0].substring(2)},t.isRejected=function(s){return s.split(" ",2)[1]==="0"},t.parseMLine=function(s){const r=t.splitLines(s)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(s){const r=t.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const r=t.splitLines(s);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(zk);var qk=zk.exports,Ym=h(qk),pY=c({__proto__:null,default:Ym},[qk]);function Ev(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const r=new t(s),i=Ym.parseCandidate(s.candidate),l=Object.assign(r,i);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(s)},e.RTCIceCandidate.prototype=t.prototype,Yh(e,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new e.RTCIceCandidate(s.candidate),writable:"false"}),s))}function EC(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Yh(e,"icecandidate",t=>{if(t.candidate){const s=Ym.parseCandidate(t.candidate.candidate);s.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return t})}function Sv(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(u){if(!u||!u.sdp)return!1;const p=Ym.splitSections(u.sdp);return p.shift(),p.some(f=>{const b=Ym.parseMLine(f);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},r=function(u){const p=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const f=parseInt(p[1],10);return f!=f?-1:f},i=function(u){let p=65536;return t.browser==="firefox"&&(p=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),p},l=function(u,p){let f=65536;t.browser==="firefox"&&t.version===57&&(f=65535);const b=Ym.matchPrefix(u.sdp,"a=max-message-size:");return b.length>0?f=parseInt(b[0].substr(19),10):t.browser==="firefox"&&p!==-1&&(f=2147483637),f},A=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const u=r(arguments[0]),p=i(u),f=l(arguments[0],u);let b;b=p===0&&f===0?Number.POSITIVE_INFINITY:p===0||f===0?Math.max(p,f):Math.min(p,f);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>b}),this._sctp=w}return A.apply(this,arguments)}}function Cv(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const l=r.send;r.send=function(){const A=arguments[0],u=A.length||A.size||A.byteLength;if(r.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return l.apply(r,arguments)}}const s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=s.apply(this,arguments);return t(r,this),r},Yh(e,"datachannel",r=>(t(r.channel,r.target),r))}function SC(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const r=t[s];t[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const l=i.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const A=new Event("connectionstatechange",i);l.dispatchEvent(A)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function CC(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(l=>da(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return s.apply(this,arguments)}}function Nv(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?mt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),mt.resolve())})}function Tv(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return s.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?s.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>s.apply(this,[i]))})}var mY=Object.freeze({__proto__:null,removeExtmapAllowMixed:CC,shimAddIceCandidateNullOrEmpty:Nv,shimConnectionState:SC,shimMaxMessageSize:Sv,shimParameterlessSetLocalDescription:Tv,shimRTCIceCandidate:Ev,shimRTCIceCandidateRelayProtocol:EC,shimSendThrowTypeError:Cv});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=ck,r=function(l){const A={browser:null,version:null};if(l===void 0||!l.navigator)return A.browser="Not a browser.",A;const{navigator:u}=l;if(u.mozGetUserMedia)A.browser="firefox",A.version=yv(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)A.browser="chrome",A.version=yv(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return A.browser="Not a supported browser.",A;A.browser="safari",A.version=yv(u.userAgent,/AppleWebKit\/(\d+)\./,1),A.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return A}(e),i={browserDetails:r,commonShim:mY,extractVersion:yv,disableLog:Zq,disableWarnings:eY,sdp:pY};switch(r.browser){case"chrome":if(!_k||!vC||!t.shimChrome)return s("Chrome shim is not included in this adapter release."),i;if(r.version===null)return s("Chrome shim can not determine version, not shimming."),i;s("adapter.js shimming chrome."),i.browserShim=_k,Nv(e,r),Tv(e),hk(e,r),pk(e),vC(e,r),mk(e),vk(e,r),fk(e),gk(e),bk(e),wk(e,r),Ev(e),EC(e),SC(e),Sv(e,r),Cv(e),CC(e,r);break;case"firefox":if(!Dk||!wC||!t.shimFirefox)return s("Firefox shim is not included in this adapter release."),i;s("adapter.js shimming firefox."),i.browserShim=Dk,Nv(e,r),Tv(e),yk(e,r),wC(e,r),Ek(e),Nk(e),Sk(e),Ck(e),Tk(e),Rk(e),Ik(e),Ok(e),kk(e),Ev(e),SC(e),Sv(e,r),Cv(e);break;case"safari":if(!Hk||!t.shimSafari)return s("Safari shim is not included in this adapter release."),i;s("adapter.js shimming safari."),i.browserShim=Hk,Nv(e,r),Tv(e),Fk(e),Vk(e),jk(e),Bk(e),Lk(e),Mk(e),Pk(e),Qk(e),Ev(e),EC(e),Sv(e,r),Cv(e),CC(e,r);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var fY=m,Yk=O.RegExp,gY=!fY(function(){var e=!0;try{Yk(".","d")}catch{e=!1}var t={},s="",r=e?"dgimsy":"gimsy",i=function(u,p){Object.defineProperty(t,u,{get:function(){return s+=p,!0}})},l={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var A in e&&(l.hasIndices="d"),l)i(A,l[A]);return Object.getOwnPropertyDescriptor(Yk.prototype,"flags").get.call(t)!==r||s!==r}),bY=ii,xY=Ce,vY=Un,wY=k,Xk={correct:gY},_Y=function(){var e=bY(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},yY=RegExp.prototype,NC=Xk.correct?function(e){return e.flags}:function(e){return Xk.correct||!wY(yY,e)||vY(e,"flags")?e.flags:xY(_Y,e)},TC=I,EY=Math.floor,RC=TC("".charAt),SY=TC("".replace),IC=TC("".slice),CY=/\$([$&'`]|\d{1,2})/g,NY=Ts,TY=Ce,OC=I,Jk=rt,RY=Y,IY=et,OY=tc,Xm=qn,kY=fi,DY=NC,BY=function(e,t,s,r,i,l){var A=s+e.length,u=r.length,p=CY;return SY(l,p,function(f,b){var w;switch(RC(b,0)){case"$":return"$";case"&":return e;case"`":return IC(t,0,s);case"'":return IC(t,A);case"<":w=i[IC(b,1,-1)];break;default:var _=+b;if(_===0)return f;if(_>u){var C=EY(_/10);return C===0?f:C<=u?r[C-1]===void 0?RC(b,1):r[C-1]+RC(b,1):f}w=r[_-1]}return w===void 0?"":w})},LY=Ur("replace"),jY=TypeError,kC=OC("".indexOf),PY=OC("".replace),$k=OC("".slice),UY=Math.max;NY({target:"String",proto:!0},{replaceAll:function(e,t){var s,r,i,l,A,u,p,f,b,w,_=Jk(this),C=0,U="";if(IY(e)){if((s=OY(e))&&(r=Xm(Jk(DY(e))),!~kC(r,"g")))throw new jY("`.replaceAll` does not allow non-global regexes");if(i=kY(e,LY))return TY(i,e,_,t);if(s)return PY(Xm(_),e,t)}for(l=Xm(_),A=Xm(e),(u=RY(t))||(t=Xm(t)),p=A.length,f=UY(1,p),b=kC(l,A);b!==-1;)w=u?Xm(t(A,b,l)):BY(A,l,b,[],void 0,t),U+=$k(l,C,b)+w,C=b+p,b=b+f>l.length?-1:kC(l,A,b+f);return C<l.length&&(U+=$k(l,C)),U}});var FY=wi("String","replaceAll"),MY=k,VY=FY,DC=String.prototype,QY=function(e){var t=e.replaceAll;return typeof e=="string"||e===DC||MY(DC,e)&&t===DC.replaceAll?VY:t},HY=h(QY),BC=O;Ts({global:!0,forced:BC.globalThis!==BC},{globalThis:BC});var Zk=h(O),LC={exports:{}};(function(e,t){(function(s,r){var i="function",l="undefined",A="object",u="string",p="major",f="model",b="name",w="type",_="vendor",C="version",U="architecture",B="console",j="mobile",K="tablet",q="smarttv",ie="wearable",xe="embedded",ye="Amazon",ue="Apple",Re="ASUS",Ge="BlackBerry",Ze="Browser",_t="Chrome",ns="Firefox",Jt="Google",bs="Honor",As="Huawei",Xs="LG",Br="Microsoft",qe="Motorola",lt="Nvidia",It="OnePlus",Je="Opera",D="OPPO",ne="Samsung",ge="Sharp",ot="Sony",os="Xiaomi",yr="Zebra",Wn="Facebook",bc="Chromium OS",Gu="Mac OS",T_=" Browser",Wf=function(yn){for(var On={},Or=0;Or<yn.length;Or++)On[yn[Or].toUpperCase()]=yn[Or];return On},R_=function(yn,On){return typeof yn===u&&kp(On).indexOf(kp(yn))!==-1},kp=function(yn){return yn.toLowerCase()},vb=function(yn,On){if(typeof yn===u)return yn=yn.replace(/^\s\s*/,""),typeof On===l?yn:yn.substring(0,500)},Dp=function(yn,On){for(var Or,za,Wl,on,BA,Ks,zl=0;zl<On.length&&!BA;){var Bp=On[zl],Vd=On[zl+1];for(Or=za=0;Or<Bp.length&&!BA&&Bp[Or];)if(BA=Bp[Or++].exec(yn))for(Wl=0;Wl<Vd.length;Wl++)Ks=BA[++za],typeof(on=Vd[Wl])===A&&on.length>0?on.length===2?typeof on[1]==i?this[on[0]]=on[1].call(this,Ks):this[on[0]]=on[1]:on.length===3?typeof on[1]!==i||on[1].exec&&on[1].test?this[on[0]]=Ks?Ks.replace(on[1],on[2]):r:this[on[0]]=Ks?on[1].call(this,Ks,on[2]):r:on.length===4&&(this[on[0]]=Ks?on[3].call(this,Ks.replace(on[1],on[2])):r):this[on]=Ks||r;zl+=2}},Ku=function(yn,On){for(var Or in On)if(typeof On[Or]===A&&On[Or].length>0){for(var za=0;za<On[Or].length;za++)if(R_(On[Or][za],yn))return Or==="?"?r:Or}else if(R_(On[Or],yn))return Or==="?"?r:Or;return On.hasOwnProperty("*")?On["*"]:yn},Q3={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},H3={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[b,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,C],[/opios[\/ ]+([\w\.]+)/i],[C,[b,Je+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[C,[b,Je+" GX"]],[/\bopr\/([\w\.]+)/i],[C,[b,Je]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[C,[b,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[C,[b,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[b,C],[/quark(?:pc)?\/([-\w\.]+)/i],[C,[b,"Quark"]],[/\bddg\/([\w\.]+)/i],[C,[b,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[b,"UC"+Ze]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[C,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[b,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[C,[b,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[C,[b,"Smart Lenovo "+Ze]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure "+Ze],C],[/\bfocus\/([\w\.]+)/i],[C,[b,ns+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[b,Je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[b,Je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[b,"MIUI"+T_]],[/fxios\/([\w\.-]+)/i],[C,[b,ns]],[/\bqihoobrowser\/?([\w\.]*)/i],[C,[b,"360"]],[/\b(qq)\/([\w\.]+)/i],[[b,/(.+)/,"$1Browser"],C],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1"+T_],C],[/samsungbrowser\/([\w\.]+)/i],[C,[b,ne+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[C,[b,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[b,"Sogou Mobile"],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[b,C],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[b],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[C,b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,Wn],C],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[b,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[b,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[C,[b,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[b,_t+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,_t+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[b,"Android "+Ze]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[b,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[C,Ku,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[b,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],C],[/(wolvic|librewolf)\/([\w\.]+)/i],[b,C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[b,ns+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[b,[C,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[b,[C,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[U,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[U,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[U,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[U,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[U,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[U,/ower/,"",kp]],[/ sun4\w[;\)]/i],[[U,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[U,kp]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[_,ne],[w,K]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[_,ne],[w,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[_,ue],[w,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[_,ue],[w,K]],[/(macintosh);/i],[f,[_,ue]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[_,ge],[w,j]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[f,[_,bs],[w,K]],[/honor([-\w ]+)[;\)]/i],[f,[_,bs],[w,j]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[f,[_,As],[w,K]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[_,As],[w,j]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[f,/_/g," "],[_,os],[w,K]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[f,/_/g," "],[_,os],[w,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[_,D],[w,j]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[f,[_,Ku,{OnePlus:["304","403","203"],"*":D}],[w,K]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[_,"Vivo"],[w,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[_,"Realme"],[w,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[_,qe],[w,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[_,qe],[w,K]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[_,Xs],[w,K]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[_,Xs],[w,j]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[f,[_,"Lenovo"],[w,K]],[/(nokia) (t[12][01])/i],[_,f,[w,K]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[f,/_/g," "],[w,j],[_,"Nokia"]],[/(pixel (c|tablet))\b/i],[f,[_,Jt],[w,K]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[_,Jt],[w,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[_,ot],[w,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[_,ot],[w,K]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[_,It],[w,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[_,ye],[w,K]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[_,ye],[w,j]],[/(playbook);[-\w\),; ]+(rim)/i],[f,_,[w,K]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[_,Ge],[w,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[_,Re],[w,K]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[_,Re],[w,j]],[/(nexus 9)/i],[f,[_,"HTC"],[w,K]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[f,/_/g," "],[w,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[f,[_,"TCL"],[w,K]],[/(itel) ((\w+))/i],[[_,kp],f,[w,Ku,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[_,"Acer"],[w,K]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[_,"Meizu"],[w,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[_,"Ulefone"],[w,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[_,"Energizer"],[w,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[_,"Cat"],[w,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[_,"Smartfren"],[w,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[_,"Nothing"],[w,j]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[f,[_,"Archos"],[w,K]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[f,[_,"Archos"],[w,j]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[_,f,[w,K]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[_,f,[w,j]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,f,[w,K]],[/(surface duo)/i],[f,[_,Br],[w,K]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[_,"Fairphone"],[w,j]],[/(u304aa)/i],[f,[_,"AT&T"],[w,j]],[/\bsie-(\w*)/i],[f,[_,"Siemens"],[w,j]],[/\b(rct\w+) b/i],[f,[_,"RCA"],[w,K]],[/\b(venue[\d ]{2,7}) b/i],[f,[_,"Dell"],[w,K]],[/\b(q(?:mv|ta)\w+) b/i],[f,[_,"Verizon"],[w,K]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[_,"Barnes & Noble"],[w,K]],[/\b(tm\d{3}\w+) b/i],[f,[_,"NuVision"],[w,K]],[/\b(k88) b/i],[f,[_,"ZTE"],[w,K]],[/\b(nx\d{3}j) b/i],[f,[_,"ZTE"],[w,j]],[/\b(gen\d{3}) b.+49h/i],[f,[_,"Swiss"],[w,j]],[/\b(zur\d{3}) b/i],[f,[_,"Swiss"],[w,K]],[/\b((zeki)?tb.*\b) b/i],[f,[_,"Zeki"],[w,K]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],f,[w,K]],[/\b(ns-?\w{0,9}) b/i],[f,[_,"Insignia"],[w,K]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[_,"NextBook"],[w,K]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],f,[w,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],f,[w,j]],[/\b(ph-1) /i],[f,[_,"Essential"],[w,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[_,"Envizen"],[w,K]],[/\b(trio[-\w\. ]+) b/i],[f,[_,"MachSpeed"],[w,K]],[/\btu_(1491) b/i],[f,[_,"Rotor"],[w,K]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[f,[_,lt],[w,K]],[/(sprint) (\w+)/i],[_,f,[w,j]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[_,Br],[w,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[_,yr],[w,K]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[_,yr],[w,j]],[/smart-tv.+(samsung)/i],[_,[w,q]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[_,ne],[w,q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,Xs],[w,q]],[/(apple) ?tv/i],[_,[f,ue+" TV"],[w,q]],[/crkey/i],[[f,_t+"cast"],[_,Jt],[w,q]],[/droid.+aft(\w+)( bui|\))/i],[f,[_,ye],[w,q]],[/(shield \w+ tv)/i],[f,[_,lt],[w,q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[_,ge],[w,q]],[/(bravia[\w ]+)( bui|\))/i],[f,[_,ot],[w,q]],[/(mi(tv|box)-?\w+) bui/i],[f,[_,os],[w,q]],[/Hbbtv.*(technisat) (.*);/i],[_,f,[w,q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,vb],[f,vb],[w,q]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[f,[w,q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,f,[w,B]],[/droid.+; (shield)( bui|\))/i],[f,[_,lt],[w,B]],[/(playstation \w+)/i],[f,[_,ot],[w,B]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[_,Br],[w,B]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[f,[_,ne],[w,ie]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[_,f,[w,ie]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[f,[_,D],[w,ie]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[_,ue],[w,ie]],[/(opwwe\d{3})/i],[f,[_,It],[w,ie]],[/(moto 360)/i],[f,[_,qe],[w,ie]],[/(smartwatch 3)/i],[f,[_,ot],[w,ie]],[/(g watch r)/i],[f,[_,Xs],[w,ie]],[/droid.+; (wt63?0{2,3})\)/i],[f,[_,yr],[w,ie]],[/droid.+; (glass) \d/i],[f,[_,Jt],[w,ie]],[/(pico) (4|neo3(?: link|pro)?)/i],[_,f,[w,ie]],[/; (quest( \d| pro)?)/i],[f,[_,Wn],[w,ie]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[w,xe]],[/(aeobc)\b/i],[f,[_,ye],[w,xe]],[/(homepod).+mac os/i],[f,[_,ue],[w,xe]],[/windows iot/i],[[w,xe]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[w,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[w,K]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,K]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,j]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[f,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[b,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[b,C],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[b,C],[/ladybird\//i],[[b,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,C],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[b,[C,Ku,Q3]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[C,Ku,Q3],[b,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,Gu],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,b],[/(ubuntu) ([\w\.]+) like android/i],[[b,/(.+)/,"$1 Touch"],C],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[b,C],[/\(bb(10);/i],[C,[b,Ge]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[C,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[b,ns+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[b,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[b,_t+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,bc],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,C],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[b,C]]},Kl=function(yn,On){if(typeof yn===A&&(On=yn,yn=r),!(this instanceof Kl))return new Kl(yn,On).getResult();var Or=typeof s!==l&&s.navigator?s.navigator:r,za=yn||(Or&&Or.userAgent?Or.userAgent:""),Wl=Or&&Or.userAgentData?Or.userAgentData:r,on=On?function(Ks,zl){var Bp={};for(var Vd in Ks)zl[Vd]&&zl[Vd].length%2==0?Bp[Vd]=zl[Vd].concat(Ks[Vd]):Bp[Vd]=Ks[Vd];return Bp}(H3,On):H3,BA=Or&&Or.userAgent==za;return this.getBrowser=function(){var Ks={};return Ks[b]=r,Ks[C]=r,Dp.call(Ks,za,on.browser),Ks[p]=function(zl){return typeof zl===u?zl.replace(/[^\d\.]/g,"").split(".")[0]:r}(Ks[C]),BA&&Or&&Or.brave&&typeof Or.brave.isBrave==i&&(Ks[b]="Brave"),Ks},this.getCPU=function(){var Ks={};return Ks[U]=r,Dp.call(Ks,za,on.cpu),Ks},this.getDevice=function(){var Ks={};return Ks[_]=r,Ks[f]=r,Ks[w]=r,Dp.call(Ks,za,on.device),BA&&!Ks[w]&&Wl&&Wl.mobile&&(Ks[w]=j),BA&&Ks[f]=="Macintosh"&&Or&&typeof Or.standalone!==l&&Or.maxTouchPoints&&Or.maxTouchPoints>2&&(Ks[f]="iPad",Ks[w]=K),Ks},this.getEngine=function(){var Ks={};return Ks[b]=r,Ks[C]=r,Dp.call(Ks,za,on.engine),Ks},this.getOS=function(){var Ks={};return Ks[b]=r,Ks[C]=r,Dp.call(Ks,za,on.os),BA&&!Ks[b]&&Wl&&Wl.platform&&Wl.platform!="Unknown"&&(Ks[b]=Wl.platform.replace(/chrome os/i,bc).replace(/macos/i,Gu)),Ks},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return za},this.setUA=function(Ks){return za=typeof Ks===u&&Ks.length>500?vb(Ks,500):Ks,this},this.setUA(za),this};Kl.VERSION="0.7.41",Kl.BROWSER=Wf([b,C,p]),Kl.CPU=Wf([U]),Kl.DEVICE=Wf([f,_,w,B,j,q,K,ie,xe]),Kl.ENGINE=Kl.OS=Wf([b,C]),e.exports&&(t=e.exports=Kl),t.UAParser=Kl;var zf=typeof s!==l&&(s.jQuery||s.Zepto);if(zf&&!zf.ua){var I_=new Kl;zf.ua=I_.getResult(),zf.ua.get=function(){return I_.getUA()},zf.ua.set=function(yn){I_.setUA(yn);var On=I_.getResult();for(var Or in On)zf.ua[Or]=On[Or]}}})(typeof window=="object"?window:d)})(LC,LC.exports);var GY=h(LC.exports),eD=tv.clear;Ts({global:!0,bind:!0,forced:O.clearImmediate!==eD},{clearImmediate:eD});var tD=O,KY=$,WY=Y,zY=Au,qY=$t,YY=bu,XY=Hh,JY=tD.Function,$Y=/MSIE .\./.test(qY)||zY==="BUN"&&function(){var e=tD.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),ZY=Ts,sD=O,rD=tv.set,eX=function(e,t){var s=1;return $Y?function(r,i){var l=XY(arguments.length,1)>s,A=WY(r)?r:JY(r),u=l?YY(arguments,s):[],p=l?function(){KY(A,this,u)}:A;return e(p)}:e},nD=sD.setImmediate?eX(rD):rD;ZY({global:!0,bind:!0,forced:sD.setImmediate!==nD},{setImmediate:nD});var iD=h($e.setImmediate),tX=O,sX=uO,rX=An,nX=Hh,iX=oe;Ts({global:!0,dontCallGetSet:!0,forced:m(function(){return iX&&Object.getOwnPropertyDescriptor(tX,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){nX(arguments.length,1),sX(rX(e))}});var aD=h($e.queueMicrotask);function oD(e,t){return function(){return e.apply(t,arguments)}}const{toString:aX}=Object.prototype,{getPrototypeOf:jC}=Object,{iterator:Rv,toStringTag:cD}=Symbol,Iv=(PC=Object.create(null),e=>{const t=aX.call(e);return PC[t]||(PC[t]=t.slice(8,-1).toLowerCase())});var PC;const Nl=e=>(e=e.toLowerCase(),t=>Iv(t)===e),Ov=e=>t=>typeof t===e,{isArray:Jm}=Array,$m=Ov("undefined");function b0(e){return e!==null&&!$m(e)&&e.constructor!==null&&!$m(e.constructor)&&ko(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const lD=Nl("ArrayBuffer"),oX=Ov("string"),ko=Ov("function"),dD=Ov("number"),x0=e=>e!==null&&typeof e=="object",kv=e=>{if(Iv(e)!=="object")return!1;const t=jC(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||cD in e||Rv in e)},cX=Nl("Date"),lX=Nl("File"),dX=Nl("Blob"),AX=Nl("FileList"),uX=Nl("URLSearchParams"),[hX,pX,mX,fX]=["ReadableStream","Request","Response","Headers"].map(Nl);function v0(e,t){let s,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Jm(e))for(s=0,r=e.length;s<r;s++)t.call(null,e[s],s,e);else{if(b0(e))return;const l=i?Object.getOwnPropertyNames(e):Object.keys(e),A=l.length;let u;for(s=0;s<A;s++)u=l[s],t.call(null,e[u],u,e)}}function AD(e,t){if(b0(e))return null;t=t.toLowerCase();const s=Object.keys(e);let r,i=s.length;for(;i-- >0;)if(r=s[i],t===r.toLowerCase())return r;return null}const Xh=Zk!==void 0?Zk:typeof self<"u"?self:typeof window<"u"?window:O_,uD=e=>!$m(e)&&e!==Xh,gX=(UC=typeof Uint8Array<"u"&&jC(Uint8Array),e=>UC&&e instanceof UC);var UC;const bX=Nl("HTMLFormElement"),hD=(e=>{let{hasOwnProperty:t}=e;return(s,r)=>t.call(s,r)})(Object.prototype),xX=Nl("RegExp"),pD=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),r={};v0(s,(i,l)=>{let A;(A=t(i,l,e))!==!1&&(r[l]=A||i)}),Object.defineProperties(e,r)},vX=Nl("AsyncFunction"),mD=(fD=typeof iD=="function",gD=ko(Xh.postMessage),fD?iD:gD?(FC="axios@".concat(Math.random()),Dv=[],Xh.addEventListener("message",e=>{let{source:t,data:s}=e;t===Xh&&s===FC&&Dv.length&&Dv.shift()()},!1),e=>{Dv.push(e),Xh.postMessage(FC,"*")}):e=>setTimeout(e));var fD,gD,FC,Dv;const wX=aD!==void 0?aD.bind(Xh):typeof process<"u"&&process.nextTick||mD;var gt={isArray:Jm,isArrayBuffer:lD,isBuffer:b0,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ko(e.append)&&((t=Iv(e))==="formdata"||t==="object"&&ko(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&lD(e.buffer),t},isString:oX,isNumber:dD,isBoolean:e=>e===!0||e===!1,isObject:x0,isPlainObject:kv,isEmptyObject:e=>{if(!x0(e)||b0(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:hX,isRequest:pX,isResponse:mX,isHeaders:fX,isUndefined:$m,isDate:cX,isFile:lX,isBlob:dX,isRegExp:xX,isFunction:ko,isStream:e=>x0(e)&&ko(e.pipe),isURLSearchParams:uX,isTypedArray:gX,isFileList:AX,forEach:v0,merge:function e(){const{caseless:t,skipUndefined:s}=uD(this)&&this||{},r={},i=(l,A)=>{const u=t&&AD(r,A)||A;kv(r[u])&&kv(l)?r[u]=e(r[u],l):kv(l)?r[u]=e({},l):Jm(l)?r[u]=l.slice():s&&$m(l)||(r[u]=l)};for(let l=0,A=arguments.length;l<A;l++)arguments[l]&&v0(arguments[l],i);return r},extend:function(e,t,s){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return v0(t,(i,l)=>{s&&ko(i)?e[l]=oD(i,s):e[l]=i},{allOwnKeys:r}),e},trim:e=>da(e)?da(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,s,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,r)=>{let i,l,A;const u={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),l=i.length;l-- >0;)A=i[l],r&&!r(A,e,t)||u[A]||(t[A]=e[A],u[A]=!0);e=s!==!1&&jC(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:Iv,kindOfTest:Nl,endsWith:(e,t,s)=>{e=String(e),(s===void 0||s>e.length)&&(s=e.length),s-=t.length;const r=e.indexOf(t,s);return r!==-1&&r===s},toArray:e=>{if(!e)return null;if(Jm(e))return e;let t=e.length;if(!dD(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{const s=(e&&e[Rv]).call(e);let r;for(;(r=s.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let s;const r=[];for(;(s=e.exec(t))!==null;)r.push(s);return r},isHTMLForm:bX,hasOwnProperty:hD,hasOwnProp:hD,reduceDescriptors:pD,freezeMethods:e=>{pD(e,(t,s)=>{if(ko(e)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const r=e[s];ko(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{const s={},r=i=>{i.forEach(l=>{s[l]=!0})};return Jm(e)?r(e):r(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,r){return s.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:AD,global:Xh,isContextDefined:uD,isSpecCompliantForm:function(e){return!!(e&&ko(e.append)&&e[cD]==="FormData"&&e[Rv])},toJSONObject:e=>{const t=new Array(10),s=(r,i)=>{if(x0(r)){if(t.indexOf(r)>=0)return;if(b0(r))return r;if(!("toJSON"in r)){t[i]=r;const l=Jm(r)?[]:{};return v0(r,(A,u)=>{const p=s(A,i+1);!$m(p)&&(l[u]=p)}),t[i]=void 0,l}}return r};return s(e,0)},isAsyncFn:vX,isThenable:e=>e&&(x0(e)||ko(e))&&ko(e.then)&&ko(e.catch),setImmediate:mD,asap:wX,isIterable:e=>e!=null&&ko(e[Rv])};function fr(e,t,s,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}gt.inherits(fr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:gt.toJSONObject(this.config),code:this.code,status:this.status}}});const bD=fr.prototype,xD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{xD[e]={value:e}}),Object.defineProperties(fr,xD),Object.defineProperty(bD,"isAxiosError",{value:!0}),fr.from=(e,t,s,r,i,l)=>{const A=Object.create(bD);gt.toFlatObject(e,A,function(f){return f!==Error.prototype},f=>f!=="isAxiosError");const u=e&&e.message?e.message:"Error",p=t==null&&e?e.code:t;return fr.call(A,u,p,s,r,i),e&&A.cause==null&&Object.defineProperty(A,"cause",{value:e,configurable:!0}),A.name=e&&e.name||"Error",l&&Object.assign(A,l),A};function MC(e){return gt.isPlainObject(e)||gt.isArray(e)}function vD(e){return gt.endsWith(e,"[]")?e.slice(0,-2):e}function wD(e,t,s){return e?e.concat(t).map(function(r,i){return r=vD(r),!s&&i?"["+r+"]":r}).join(s?".":""):t}const _X=gt.toFlatObject(gt,{},null,function(e){return/^is[A-Z]/.test(e)});function Bv(e,t,s){if(!gt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(s=gt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,C){return!gt.isUndefined(C[_])})).metaTokens,i=s.visitor||f,l=s.dots,A=s.indexes,u=(s.Blob||typeof Blob<"u"&&Blob)&&gt.isSpecCompliantForm(t);if(!gt.isFunction(i))throw new TypeError("visitor must be a function");function p(_){if(_===null)return"";if(gt.isDate(_))return _.toISOString();if(gt.isBoolean(_))return _.toString();if(!u&&gt.isBlob(_))throw new fr("Blob is not supported. Use a Buffer instead.");return gt.isArrayBuffer(_)||gt.isTypedArray(_)?u&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function f(_,C,U){let B=_;if(_&&!U&&typeof _=="object"){if(gt.endsWith(C,"{}"))C=r?C:C.slice(0,-2),_=JSON.stringify(_);else if(gt.isArray(_)&&function(j){return gt.isArray(j)&&!j.some(MC)}(_)||(gt.isFileList(_)||gt.endsWith(C,"[]"))&&(B=gt.toArray(_)))return C=vD(C),B.forEach(function(j,K){!gt.isUndefined(j)&&j!==null&&t.append(A===!0?wD([C],K,l):A===null?C:C+"[]",p(j))}),!1}return!!MC(_)||(t.append(wD(U,C,l),p(_)),!1)}const b=[],w=Object.assign(_X,{defaultVisitor:f,convertValue:p,isVisitable:MC});if(!gt.isObject(e))throw new TypeError("data must be an object");return function _(C,U){if(!gt.isUndefined(C)){if(b.indexOf(C)!==-1)throw Error("Circular reference detected in "+U.join("."));b.push(C),gt.forEach(C,function(B,j){(!(gt.isUndefined(B)||B===null)&&i.call(t,B,gt.isString(j)?da(j).call(j):j,U,w))===!0&&_(B,U?U.concat(j):[j])}),b.pop()}}(e),t}function _D(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function VC(e,t){this._pairs=[],e&&Bv(e,this,t)}const yD=VC.prototype;function yX(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ED(e,t,s){if(!t)return e;const r=s&&s.encode||yX;gt.isFunction(s)&&(s={serialize:s});const i=s&&s.serialize;let l;if(l=i?i(t,s):gt.isURLSearchParams(t)?t.toString():new VC(t,s).toString(r),l){const A=e.indexOf("#");A!==-1&&(e=e.slice(0,A)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}yD.append=function(e,t){this._pairs.push([e,t])},yD.toString=function(e){const t=e?function(s){return e.call(this,s,_D)}:_D;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};var SD=class{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){gt.forEach(this.handlers,function(t){t!==null&&e(t)})}},CD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ND={exports:{}},EX=Ts,SX=oe,TD=_a.f;EX({target:"Object",stat:!0,forced:Object.defineProperty!==TD,sham:!SX},{defineProperty:TD});var RD=$e.Object,CX=ND.exports=function(e,t,s){return RD.defineProperty(e,t,s)};RD.defineProperty.sham&&(CX.sham=!0);var ID=h(ND.exports),NX=TypeError,OD=hA,TX=ev,RX=et,IX=Ur("species"),kD=Array,OX=function(e){var t;return OD(e)&&(t=e.constructor,(TX(t)&&(t===kD||OD(t.prototype))||RX(t)&&(t=t[IX])===null)&&(t=void 0)),t===void 0?kD:t},DD=function(e,t){return new(OX(e))(t===0?0:t)},kX=m,DX=Ut,BX=Ur("species"),BD=function(e){return DX>=51||!kX(function(){var t=[];return(t.constructor={})[BX]=function(){return{foo:1}},t[e](Boolean).foo!==1})},LX=Ts,jX=m,PX=hA,UX=et,FX=yo,MX=No,LD=function(e){if(e>9007199254740991)throw NX("Maximum allowed index exceeded");return e},jD=XS,VX=DD,QX=BD,HX=Ut,PD=Ur("isConcatSpreadable"),GX=HX>=51||!jX(function(){var e=[];return e[PD]=!1,e.concat()[0]!==e}),KX=function(e){if(!UX(e))return!1;var t=e[PD];return t!==void 0?!!t:PX(e)};LX({target:"Array",proto:!0,forced:!GX||!QX("concat")},{concat:function(e){var t,s,r,i,l,A=FX(this),u=VX(A,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(KX(l=t===-1?A:arguments[t]))for(i=MX(l),LD(p+i),s=0;s<i;s++,p++)s in l&&jD(u,p,l[s]);else LD(p+1),jD(u,p++,l);return u.length=p,u}});var UD={},WX=Ne,zX=Rt,FD=pA.f,qX=bu,MD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];UD.f=function(e){return MD&&WX(e)==="Window"?function(t){try{return FD(t)}catch{return qX(MD)}}(e):FD(zX(e))};var Zm={},YX=Ur;Zm.f=YX;var VD=$e,XX=Un,JX=Zm,$X=_a.f,li=function(e){var t=VD.Symbol||(VD.Symbol={});XX(t,e)||$X(t,e,{value:JX.f(e)})},ZX=Ce,eJ=dt,tJ=Ur,sJ=gu,QD=function(){var e=eJ("Symbol"),t=e&&e.prototype,s=t&&t.valueOf,r=tJ("toPrimitive");t&&!t[r]&&sJ(t,r,function(i){return ZX(s,this)},{})},rJ=So,nJ=ze,iJ=yo,aJ=No,oJ=DD,HD=I([].push),cJ=function(e){var t=e===1,s=e===2,r=e===3,i=e===4,l=e===6,A=e===7,u=e===5||l;return function(p,f,b,w){for(var _,C,U=iJ(p),B=nJ(U),j=aJ(B),K=rJ(f,b),q=0,ie=w||oJ,xe=t?ie(p,j):s||A?ie(p,0):void 0;j>q;q++)if((u||q in B)&&(C=K(_=B[q],q,U),e))if(t)xe[q]=C;else if(C)switch(e){case 3:return!0;case 5:return _;case 6:return q;case 2:HD(xe,_)}else switch(e){case 4:return!1;case 7:HD(xe,_)}return l?-1:r||i?i:xe}},GD={forEach:cJ(0)},Lv=Ts,w0=O,QC=Ce,lJ=I,ef=oe,tf=vt,dJ=m,Aa=Un,AJ=k,HC=ii,jv=Rt,GC=su,uJ=qn,KC=fe,sf=Cn,KD=Se,hJ=pA,WD=UD,pJ=jh,zD=se,qD=_a,mJ=de,YD=ee,XD=gu,fJ=Zx,WC=$o,JD=mA,$D=ZA,gJ=Ur,bJ=Zm,xJ=li,vJ=QD,wJ=vA,ZD=Qh,Pv=GD.forEach,Do=Em("hidden"),Uv="Symbol",_0="prototype",_J=ZD.set,eB=ZD.getterFor(Uv),Tl=Object[_0],Jh=w0.Symbol,Fv=Jh&&Jh[_0],yJ=w0.RangeError,EJ=w0.TypeError,zC=w0.QObject,tB=zD.f,$h=qD.f,sB=WD.f,SJ=YD.f,rB=lJ([].push),yA=WC("symbols"),y0=WC("op-symbols"),CJ=WC("wks"),qC=!zC||!zC[_0]||!zC[_0].findChild,nB=function(e,t,s){var r=tB(Tl,t);r&&delete Tl[t],$h(e,t,s),r&&e!==Tl&&$h(Tl,t,r)},YC=ef&&dJ(function(){return sf($h({},"a",{get:function(){return $h(this,"a",{value:7}).a}})).a!==7})?nB:$h,XC=function(e,t){var s=yA[e]=sf(Fv);return _J(s,{type:Uv,tag:e,description:t}),ef||(s.description=t),s},Mv=function(e,t,s){e===Tl&&Mv(y0,t,s),HC(e);var r=GC(t);return HC(s),Aa(yA,r)?(s.enumerable?(Aa(e,Do)&&e[Do][r]&&(e[Do][r]=!1),s=sf(s,{enumerable:KC(0,!1)})):(Aa(e,Do)||$h(e,Do,KC(1,sf(null))),e[Do][r]=!0),YC(e,r,s)):$h(e,r,s)},JC=function(e,t){HC(e);var s=jv(t),r=KD(s).concat(cB(s));return Pv(r,function(i){ef&&!QC(iB,s,i)||Mv(e,i,s[i])}),e},iB=function(e){var t=GC(e),s=QC(SJ,this,t);return!(this===Tl&&Aa(yA,t)&&!Aa(y0,t))&&(!(s||!Aa(this,t)||!Aa(yA,t)||Aa(this,Do)&&this[Do][t])||s)},aB=function(e,t){var s=jv(e),r=GC(t);if(s!==Tl||!Aa(yA,r)||Aa(y0,r)){var i=tB(s,r);return!i||!Aa(yA,r)||Aa(s,Do)&&s[Do][r]||(i.enumerable=!0),i}},oB=function(e){var t=sB(jv(e)),s=[];return Pv(t,function(r){Aa(yA,r)||Aa(JD,r)||rB(s,r)}),s},cB=function(e){var t=e===Tl,s=sB(t?y0:jv(e)),r=[];return Pv(s,function(i){!Aa(yA,i)||t&&!Aa(Tl,i)||rB(r,yA[i])}),r};tf||(Jh=function(){if(AJ(Fv,this))throw new EJ("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?uJ(arguments[0]):void 0,t=$D(e),s=function(r){var i=this===void 0?w0:this;i===Tl&&QC(s,y0,r),Aa(i,Do)&&Aa(i[Do],t)&&(i[Do][t]=!1);var l=KC(1,r);try{YC(i,t,l)}catch(A){if(!(A instanceof yJ))throw A;nB(i,t,l)}};return ef&&qC&&YC(Tl,t,{configurable:!0,set:s}),XC(t,e)},XD(Fv=Jh[_0],"toString",function(){return eB(this).tag}),XD(Jh,"withoutSetter",function(e){return XC($D(e),e)}),YD.f=iB,qD.f=Mv,mJ.f=JC,zD.f=aB,hJ.f=WD.f=oB,pJ.f=cB,bJ.f=function(e){return XC(gJ(e),e)},ef&&fJ(Fv,"description",{configurable:!0,get:function(){return eB(this).description}})),Lv({global:!0,wrap:!0,forced:!tf,sham:!tf},{Symbol:Jh}),Pv(KD(CJ),function(e){xJ(e)}),Lv({target:Uv,stat:!0,forced:!tf},{useSetter:function(){qC=!0},useSimple:function(){qC=!1}}),Lv({target:"Object",stat:!0,forced:!tf,sham:!ef},{create:function(e,t){return t===void 0?sf(e):JC(sf(e),t)},defineProperty:Mv,defineProperties:JC,getOwnPropertyDescriptor:aB}),Lv({target:"Object",stat:!0,forced:!tf},{getOwnPropertyNames:oB}),vJ(),wJ(Jh,Uv),JD[Do]=!0;var lB=vt&&!!Symbol.for&&!!Symbol.keyFor,NJ=Ts,TJ=dt,RJ=Un,IJ=qn,dB=$o,OJ=lB,$C=dB("string-to-symbol-registry"),kJ=dB("symbol-to-string-registry");NJ({target:"Symbol",stat:!0,forced:!OJ},{for:function(e){var t=IJ(e);if(RJ($C,t))return $C[t];var s=TJ("Symbol")(t);return $C[t]=s,kJ[s]=t,s}});var DJ=Ts,BJ=Un,LJ=Ws,jJ=qr,PJ=lB,AB=$o("symbol-to-string-registry");DJ({target:"Symbol",stat:!0,forced:!PJ},{keyFor:function(e){if(!LJ(e))throw new TypeError(jJ(e)+" is not a symbol");if(BJ(AB,e))return AB[e]}});var uB=hA,UJ=Y,hB=Ne,FJ=qn,pB=I([].push),MJ=Ts,mB=dt,fB=$,VJ=Ce,E0=I,gB=m,bB=Y,xB=Ws,vB=bu,QJ=function(e){if(UJ(e))return e;if(uB(e)){for(var t=e.length,s=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?pB(s,i):typeof i!="number"&&hB(i)!=="Number"&&hB(i)!=="String"||pB(s,FJ(i))}var l=s.length,A=!0;return function(u,p){if(A)return A=!1,p;if(uB(this))return p;for(var f=0;f<l;f++)if(s[f]===u)return p}}},HJ=vt,GJ=String,Eu=mB("JSON","stringify"),Vv=E0(/./.exec),wB=E0("".charAt),KJ=E0("".charCodeAt),WJ=E0("".replace),zJ=E0(1.1.toString),qJ=/[\uD800-\uDFFF]/g,_B=/^[\uD800-\uDBFF]$/,yB=/^[\uDC00-\uDFFF]$/,EB=!HJ||gB(function(){var e=mB("Symbol")("stringify detection");return Eu([e])!=="[null]"||Eu({a:e})!=="{}"||Eu(Object(e))!=="{}"}),SB=gB(function(){return Eu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Eu("\uDEAD")!=='"\\udead"'}),YJ=function(e,t){var s=vB(arguments),r=QJ(t);if(bB(r)||e!==void 0&&!xB(e))return s[1]=function(i,l){if(bB(r)&&(l=VJ(r,this,GJ(i),l)),!xB(l))return l},fB(Eu,null,s)},XJ=function(e,t,s){var r=wB(s,t-1),i=wB(s,t+1);return Vv(_B,e)&&!Vv(yB,i)||Vv(yB,e)&&!Vv(_B,r)?"\\u"+zJ(KJ(e,0),16):e};Eu&&MJ({target:"JSON",stat:!0,forced:EB||SB},{stringify:function(e,t,s){var r=vB(arguments),i=fB(EB?YJ:Eu,null,r);return SB&&typeof i=="string"?WJ(i,qJ,XJ):i}});var CB=jh,JJ=yo;Ts({target:"Object",stat:!0,forced:!vt||m(function(){CB.f(1)})},{getOwnPropertySymbols:function(e){var t=CB.f;return t?t(JJ(e)):[]}}),li("asyncDispose"),li("asyncIterator"),li("dispose"),li("hasInstance"),li("isConcatSpreadable"),li("iterator"),li("match"),li("matchAll"),li("replace"),li("search"),li("species"),li("split");var $J=QD;li("toPrimitive"),$J();var ZJ=dt,e$=vA;li("toStringTag"),e$(ZJ("Symbol"),"Symbol"),li("unscopables"),vA(O.JSON,"JSON",!0);var t$=$e.Symbol,s$=Ur,r$=_a.f,NB=s$("metadata"),TB=Function.prototype;TB[NB]===void 0&&r$(TB,NB,{value:null}),li("metadata");var n$=t$,i$=I,ZC=dt("Symbol"),a$=ZC.keyFor,o$=i$(ZC.prototype.valueOf),RB=ZC.isRegisteredSymbol||function(e){try{return a$(o$(e))!==void 0}catch{return!1}};Ts({target:"Symbol",stat:!0},{isRegisteredSymbol:RB});for(var c$=$o,IB=dt,l$=I,d$=Ws,A$=Ur,Qv=IB("Symbol"),OB=Qv.isWellKnownSymbol,kB=IB("Object","getOwnPropertyNames"),u$=l$(Qv.prototype.valueOf),DB=c$("wks"),e1=0,BB=kB(Qv),h$=BB.length;e1<h$;e1++)try{var LB=BB[e1];d$(Qv[LB])&&A$(LB)}catch{}var jB=function(e){if(OB&&OB(e))return!0;try{for(var t=u$(e),s=0,r=kB(DB),i=r.length;s<i;s++)if(DB[r[s]]==t)return!0}catch{}return!1};Ts({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:jB}),li("customMatcher"),li("observable"),Ts({target:"Symbol",stat:!0},{isRegistered:RB}),Ts({target:"Symbol",stat:!0,forced:!0},{isWellKnown:jB}),li("matcher"),li("metadataKey"),li("patternMatch"),li("replaceAll");var rf=h(n$),PB=h(Zm.f("iterator"));function S0(e){return S0=typeof rf=="function"&&typeof PB=="symbol"?function(t){return typeof t}:function(t){return t&&typeof rf=="function"&&t.constructor===rf&&t!==rf.prototype?"symbol":typeof t},S0(e)}var p$=h(Zm.f("toPrimitive"));function m$(e){var t=function(s,r){if(S0(s)!="object"||!s)return s;var i=s[p$];if(i!==void 0){var l=i.call(s,r);if(S0(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(s)}(e,"string");return S0(t)=="symbol"?t:t+""}function P(e,t,s){return(t=m$(t))in e?ID(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var UB=h(Vz),f$={isBrowser:!0,classes:{URLSearchParams:UB!==void 0?UB:VC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const t1=typeof window<"u"&&typeof document<"u",s1=typeof navigator=="object"&&navigator||void 0,g$=t1&&(!s1||["ReactNative","NativeScript","NS"].indexOf(s1.product)<0),b$=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",x$=t1&&window.location.href||"http://localhost";function FB(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function MB(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?FB(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):FB(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}var Qa=MB(MB({},Object.freeze({__proto__:null,hasBrowserEnv:t1,hasStandardBrowserEnv:g$,hasStandardBrowserWebWorkerEnv:b$,navigator:s1,origin:x$})),f$);function VB(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function v$(e,t){return Bv(e,new Qa.classes.URLSearchParams,function(s){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?VB(Object(i),!0).forEach(function(l){P(s,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):VB(Object(i)).forEach(function(l){Object.defineProperty(s,l,Object.getOwnPropertyDescriptor(i,l))})}return s}({visitor:function(s,r,i,l){return Qa.isNode&&gt.isBuffer(s)?(this.append(r,s.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}var w$=jS.charAt,QB=Ce,_$=ii,y$=Y,E$=Ne,S$=/./.exec,C$=TypeError,N$=Ts,HB=Ce,GB=Ae,T$=rS,Hv=Jx,KB=rt,WB=ld,C0=qn,R$=ii,I$=et,O$=Ne,k$=tc,zB=NC,D$=fi,B$=m,L$=lS,j$=function(e,t,s){return t+(s?w$(e,t).length:1)},P$=function(e,t){var s=e.exec;if(y$(s)){var r=QB(s,e,t);return r!==null&&_$(r),r}if(E$(e)==="RegExp")return QB(S$,e,t);throw new C$("RegExp#exec called on incompatible receiver")},qB=Qh,U$=Ur("matchAll"),YB="RegExp String",XB=YB+" Iterator",F$=qB.set,M$=qB.getterFor(XB),V$=TypeError,r1=GB("".indexOf),Gv=GB("".matchAll),n1=!!Gv&&!B$(function(){Gv("a",/./)}),Q$=T$(function(e,t,s,r){F$(this,{type:XB,regexp:e,string:t,global:s,unicode:r,done:!1})},YB,function(){var e=M$(this);if(e.done)return Hv(void 0,!0);var t=e.regexp,s=e.string,r=P$(t,s);return r===null?(e.done=!0,Hv(void 0,!0)):e.global?(C0(r[0])===""&&(t.lastIndex=j$(s,WB(t.lastIndex),e.unicode)),Hv(r,!1)):(e.done=!0,Hv(r,!1))}),JB=function(e){var t,s,r,i=R$(this),l=C0(e),A=L$(i,RegExp),u=C0(zB(i));return t=new A(A===RegExp?i.source:i,u),s=!!~r1(u,"g"),r=!!~r1(u,"u"),t.lastIndex=WB(i.lastIndex),new Q$(t,l,s,r)};N$({target:"String",proto:!0,forced:n1},{matchAll:function(e){var t,s,r,i,l=KB(this);if(I$(e)){if(k$(e)&&(t=C0(KB(zB(e))),!~r1(t,"g")))throw new V$("`.matchAll` does not allow non-global regexes");if(n1)return Gv(l,e);if((r=D$(e,U$))===void 0&&O$(e)==="RegExp"&&(r=JB),r)return HB(r,e,l)}else if(n1)return Gv(l,e);return s=C0(l),i=new RegExp(e,"g"),HB(JB,i,s)}});var H$=wi("String","matchAll"),G$=k,K$=H$,i1=String.prototype,W$=function(e){var t=e.matchAll;return typeof e=="string"||e===i1||G$(i1,e)&&t===i1.matchAll?K$:t},z$=h(W$);function $B(e){function t(s,r,i,l){let A=s[l++];if(A==="__proto__")return!0;const u=Number.isFinite(+A),p=l>=s.length;return A=!A&&gt.isArray(i)?i.length:A,p?(gt.hasOwnProp(i,A)?i[A]=[i[A],r]:i[A]=r,!u):(i[A]&&gt.isObject(i[A])||(i[A]=[]),t(s,r,i[A],l)&&gt.isArray(i[A])&&(i[A]=function(f){const b={},w=Object.keys(f);let _;const C=w.length;let U;for(_=0;_<C;_++)U=w[_],b[U]=f[U];return b}(i[A])),!u)}if(gt.isFormData(e)&&gt.isFunction(e.entries)){const s={};return gt.forEachEntry(e,(r,i)=>{t(function(l){return z$(gt).call(gt,/\w+|\[(\w*)]/g,l).map(A=>A[0]==="[]"?"":A[1]||A[0])}(r),i,s,0)}),s}return null}const a1={transitional:CD,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",r=s.indexOf("application/json")>-1,i=gt.isObject(e);if(i&&gt.isHTMLForm(e)&&(e=new FormData(e)),gt.isFormData(e))return r?JSON.stringify($B(e)):e;if(gt.isArrayBuffer(e)||gt.isBuffer(e)||gt.isStream(e)||gt.isFile(e)||gt.isBlob(e)||gt.isReadableStream(e))return e;if(gt.isArrayBufferView(e))return e.buffer;if(gt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return v$(e,this.formSerializer).toString();if((l=gt.isFileList(e))||s.indexOf("multipart/form-data")>-1){const A=this.env&&this.env.FormData;return Bv(l?{"files[]":e}:e,A&&new A,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(A,u,p){if(gt.isString(A))try{return(u||JSON.parse)(A),da(gt).call(gt,A)}catch(f){if(f.name!=="SyntaxError")throw f}return(p||JSON.stringify)(A)}(e)):e}],transformResponse:[function(e){const t=this.transitional||a1.transitional,s=t&&t.forcedJSONParsing,r=this.responseType==="json";if(gt.isResponse(e)||gt.isReadableStream(e))return e;if(e&&gt.isString(e)&&(s&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(l){if(i)throw l.name==="SyntaxError"?fr.from(l,fr.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qa.classes.FormData,Blob:Qa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};gt.forEach(["delete","get","head","post","put","patch"],e=>{a1.headers[e]={}});var o1=a1;const q$=gt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ZB=Symbol("internals");function N0(e){var t;return e&&da(t=String(e)).call(t).toLowerCase()}function Kv(e){return e===!1||e==null?e:gt.isArray(e)?e.map(Kv):String(e)}function c1(e,t,s,r,i){return gt.isFunction(r)?r.call(this,t,s):(i&&(t=s),gt.isString(t)?gt.isString(r)?t.indexOf(r)!==-1:gt.isRegExp(r)?r.test(t):void 0:void 0)}class Wv{constructor(t){t&&this.set(t)}set(t,s,r){const i=this;function l(p,f,b){const w=N0(f);if(!w)throw new Error("header name must be a non-empty string");const _=gt.findKey(i,w);(!_||i[_]===void 0||b===!0||b===void 0&&i[_]!==!1)&&(i[_||f]=Kv(p))}const A=(p,f)=>gt.forEach(p,(b,w)=>l(b,w,f));if(gt.isPlainObject(t)||t instanceof this.constructor)A(t,s);else if(gt.isString(t)&&(t=da(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(da(u=t).call(u)))A((p=>{const f={};let b,w,_;return p&&p.split(`
`).forEach(function(C){var U,B;_=C.indexOf(":"),b=da(U=C.substring(0,_)).call(U).toLowerCase(),w=da(B=C.substring(_+1)).call(B),!b||f[b]&&q$[b]||(b==="set-cookie"?f[b]?f[b].push(w):f[b]=[w]:f[b]=f[b]?f[b]+", "+w:w)}),f})(t),s);else if(gt.isObject(t)&&gt.isIterable(t)){let p,f,b={};for(const w of t){if(!gt.isArray(w))throw TypeError("Object iterator must return a key-value pair");b[f=w[0]]=(p=b[f])?gt.isArray(p)?[...p,w[1]]:[p,w[1]]:w[1]}A(b,s)}else t!=null&&l(s,t,r);var u;return this}get(t,s){if(t=N0(t)){const r=gt.findKey(this,t);if(r){const i=this[r];if(!s)return i;if(s===!0)return function(l){const A=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let p;for(;p=u.exec(l);)A[p[1]]=p[2];return A}(i);if(gt.isFunction(s))return s.call(this,i,r);if(gt.isRegExp(s))return s.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,s){if(t=N0(t)){const r=gt.findKey(this,t);return!(!r||this[r]===void 0||s&&!c1(0,this[r],r,s))}return!1}delete(t,s){const r=this;let i=!1;function l(A){if(A=N0(A)){const u=gt.findKey(r,A);!u||s&&!c1(0,r[u],u,s)||(delete r[u],i=!0)}}return gt.isArray(t)?t.forEach(l):l(t),i}clear(t){const s=Object.keys(this);let r=s.length,i=!1;for(;r--;){const l=s[r];t&&!c1(0,this[l],l,t,!0)||(delete this[l],i=!0)}return i}normalize(t){const s=this,r={};return gt.forEach(this,(i,l)=>{var A;const u=gt.findKey(r,l);if(u)return s[u]=Kv(i),void delete s[l];const p=t?function(f){return da(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(b,w,_)=>w.toUpperCase()+_)}(l):da(A=String(l)).call(A);p!==l&&delete s[l],s[p]=Kv(i),r[p]=!0}),this}concat(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return this.constructor.concat(this,...s)}toJSON(t){const s=Object.create(null);return gt.forEach(this,(r,i)=>{r!=null&&r!==!1&&(s[i]=t&&gt.isArray(r)?r.join(", "):r)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[s,r]=t;return s+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const s=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];return i.forEach(A=>s.set(A)),s}static accessor(t){const s=(this[ZB]=this[ZB]={accessors:{}}).accessors,r=this.prototype;function i(l){const A=N0(l);s[A]||(function(u,p){const f=gt.toCamelCase(" "+p);["get","set","has"].forEach(b=>{Object.defineProperty(u,b+f,{value:function(w,_,C){return this[b].call(this,p,w,_,C)},configurable:!0})})}(r,l),s[A]=!0)}return gt.isArray(t)?t.forEach(i):i(t),this}}Wv.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),gt.reduceDescriptors(Wv.prototype,(e,t)=>{let{value:s}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(i){this[r]=i}}}),gt.freezeMethods(Wv);var Rl=Wv;function l1(e,t){const s=this||o1,r=t||s,i=Rl.from(r.headers);let l=r.data;return gt.forEach(e,function(A){l=A.call(s,l,i.normalize(),t?t.status:void 0)}),i.normalize(),l}function eL(e){return!(!e||!e.__CANCEL__)}function nf(e,t,s){fr.call(this,e??"canceled",fr.ERR_CANCELED,t,s),this.name="CanceledError"}function tL(e,t,s){const r=s.config.validateStatus;s.status&&r&&!r(s.status)?t(new fr("Request failed with status code "+s.status,[fr.ERR_BAD_REQUEST,fr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}gt.inherits(nf,fr,{__CANCEL__:!0});const zv=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=function(l,A){l=l||10;const u=new Array(l),p=new Array(l);let f,b=0,w=0;return A=A!==void 0?A:1e3,function(_){const C=Date.now(),U=p[w];f||(f=C),u[b]=_,p[b]=C;let B=w,j=0;for(;B!==b;)j+=u[B++],B%=l;if(b=(b+1)%l,b===w&&(w=(w+1)%l),C-f<A)return;const K=U&&C-U;return K?Math.round(1e3*j/K):void 0}}(50,250);return function(l,A){let u,p,f=0,b=1e3/A;const w=function(_){f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),u=null,p&&(clearTimeout(p),p=null),l(..._)};return[function(){const _=Date.now(),C=_-f;for(var U=arguments.length,B=new Array(U),j=0;j<U;j++)B[j]=arguments[j];C>=b?w(B,_):(u=B,p||(p=setTimeout(()=>{p=null,w(u)},b-C)))},()=>u&&w(u)]}(l=>{const A=l.loaded,u=l.lengthComputable?l.total:void 0,p=A-r,f=i(p);r=A,e({loaded:A,total:u,progress:u?A/u:void 0,bytes:p,rate:f||void 0,estimated:f&&u&&A<=u?(u-A)/f:void 0,event:l,lengthComputable:u!=null,[t?"download":"upload"]:!0})},s)},sL=(e,t)=>{const s=e!=null;return[r=>t[0]({lengthComputable:s,total:e,loaded:r}),t[1]]},rL=e=>function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return gt.asap(()=>e(...s))};var Y$=Qa.hasStandardBrowserEnv?((e,t)=>s=>(s=new _v(s,Qa.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new _v(Qa.origin),Qa.navigator&&/(msie|trident)/i.test(Qa.navigator.userAgent)):()=>!0,X$=Qa.hasStandardBrowserEnv?{write(e,t,s,r,i,l,A){if(typeof document>"u")return;const u=["".concat(e,"=").concat(encodeURIComponent(t))];gt.isNumber(s)&&u.push("expires=".concat(new Date(s).toUTCString())),gt.isString(r)&&u.push("path=".concat(r)),gt.isString(i)&&u.push("domain=".concat(i)),l===!0&&u.push("secure"),gt.isString(A)&&u.push("SameSite=".concat(A)),document.cookie=u.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function nL(e,t,s){let r=!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t);return e&&(r||s==0)?function(i,l){return l?i.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):i}(e,t):t}function iL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function d1(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?iL(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):iL(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const aL=e=>e instanceof Rl?d1({},e):e;function Zh(e,t){t=t||{};const s={};function r(f,b,w,_){return gt.isPlainObject(f)&&gt.isPlainObject(b)?gt.merge.call({caseless:_},f,b):gt.isPlainObject(b)?gt.merge({},b):gt.isArray(b)?b.slice():b}function i(f,b,w,_){return gt.isUndefined(b)?gt.isUndefined(f)?void 0:r(void 0,f,0,_):r(f,b,0,_)}function l(f,b){if(!gt.isUndefined(b))return r(void 0,b)}function A(f,b){return gt.isUndefined(b)?gt.isUndefined(f)?void 0:r(void 0,f):r(void 0,b)}function u(f,b,w){return w in t?r(f,b):w in e?r(void 0,f):void 0}const p={url:l,method:l,data:l,baseURL:A,transformRequest:A,transformResponse:A,paramsSerializer:A,timeout:A,timeoutMessage:A,withCredentials:A,withXSRFToken:A,adapter:A,responseType:A,xsrfCookieName:A,xsrfHeaderName:A,onUploadProgress:A,onDownloadProgress:A,decompress:A,maxContentLength:A,maxBodyLength:A,beforeRedirect:A,transport:A,httpAgent:A,httpsAgent:A,cancelToken:A,socketPath:A,responseEncoding:A,validateStatus:u,headers:(f,b,w)=>i(aL(f),aL(b),0,!0)};return gt.forEach(Object.keys(d1(d1({},e),t)),function(f){const b=p[f]||i,w=b(e[f],t[f],f);gt.isUndefined(w)&&b!==u||(s[f]=w)}),s}var oL=e=>{const t=Zh({},e);let{data:s,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:l,headers:A,auth:u}=t;if(t.headers=A=Rl.from(A),t.url=ED(nL(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),u&&A.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),gt.isFormData(s)){if(Qa.hasStandardBrowserEnv||Qa.hasStandardBrowserWebWorkerEnv)A.setContentType(void 0);else if(gt.isFunction(s.getHeaders)){const p=s.getHeaders(),f=["content-type","content-length"];Object.entries(p).forEach(b=>{let[w,_]=b;nt(f).call(f,w.toLowerCase())&&A.set(w,_)})}}if(Qa.hasStandardBrowserEnv&&(r&&gt.isFunction(r)&&(r=r(t)),r||r!==!1&&Y$(t.url))){const p=i&&l&&X$.read(l);p&&A.set(i,p)}return t},J$=typeof XMLHttpRequest<"u"&&function(e){return new mt(function(t,s){const r=oL(e);let i=r.data;const l=Rl.from(r.headers).normalize();let A,u,p,f,b,{responseType:w,onUploadProgress:_,onDownloadProgress:C}=r;function U(){f&&f(),b&&b(),r.cancelToken&&r.cancelToken.unsubscribe(A),r.signal&&r.signal.removeEventListener("abort",A)}let B=new XMLHttpRequest;function j(){if(!B)return;const q=Rl.from("getAllResponseHeaders"in B&&B.getAllResponseHeaders());tL(function(ie){t(ie),U()},function(ie){s(ie),U()},{data:w&&w!=="text"&&w!=="json"?B.response:B.responseText,status:B.status,statusText:B.statusText,headers:q,config:e,request:B}),B=null}B.open(r.method.toUpperCase(),r.url,!0),B.timeout=r.timeout,"onloadend"in B?B.onloadend=j:B.onreadystatechange=function(){B&&B.readyState===4&&(B.status!==0||B.responseURL&&B.responseURL.indexOf("file:")===0)&&setTimeout(j)},B.onabort=function(){B&&(s(new fr("Request aborted",fr.ECONNABORTED,e,B)),B=null)},B.onerror=function(q){const ie=new fr(q&&q.message?q.message:"Network Error",fr.ERR_NETWORK,e,B);ie.event=q||null,s(ie),B=null},B.ontimeout=function(){let q=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const ie=r.transitional||CD;r.timeoutErrorMessage&&(q=r.timeoutErrorMessage),s(new fr(q,ie.clarifyTimeoutError?fr.ETIMEDOUT:fr.ECONNABORTED,e,B)),B=null},i===void 0&&l.setContentType(null),"setRequestHeader"in B&&gt.forEach(l.toJSON(),function(q,ie){B.setRequestHeader(ie,q)}),gt.isUndefined(r.withCredentials)||(B.withCredentials=!!r.withCredentials),w&&w!=="json"&&(B.responseType=r.responseType),C&&([p,b]=zv(C,!0),B.addEventListener("progress",p)),_&&B.upload&&([u,f]=zv(_),B.upload.addEventListener("progress",u),B.upload.addEventListener("loadend",f)),(r.cancelToken||r.signal)&&(A=q=>{B&&(s(!q||q.type?new nf(null,e,B):q),B.abort(),B=null)},r.cancelToken&&r.cancelToken.subscribe(A),r.signal&&(r.signal.aborted?A():r.signal.addEventListener("abort",A)));const K=function(q){const ie=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return ie&&ie[1]||""}(r.url);K&&Qa.protocols.indexOf(K)===-1?s(new fr("Unsupported protocol "+K+":",fr.ERR_BAD_REQUEST,e)):B.send(i||null)})},$$=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let r,i=new AbortController;const l=function(f){if(!r){r=!0,u();const b=f instanceof Error?f:this.reason;i.abort(b instanceof fr?b:new nf(b instanceof Error?b.message:b))}};let A=t&&setTimeout(()=>{A=null,l(new fr("timeout ".concat(t," of ms exceeded"),fr.ETIMEDOUT))},t);const u=()=>{e&&(A&&clearTimeout(A),A=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(l):f.removeEventListener("abort",l)}),e=null)};e.forEach(f=>f.addEventListener("abort",l));const{signal:p}=i;return p.unsubscribe=()=>gt.asap(u),p}},A1=h(KO),cL=Zm.f("asyncIterator"),Z$=h(cL);function u1(e,t){this.v=e,this.k=t}function Na(e){return function(){return new T0(e.apply(this,arguments))}}function T0(e){var t,s;function r(l,A){try{var u=e[l](A),p=u.value,f=p instanceof u1;A1.resolve(f?p.v:p).then(function(b){if(f){var w=l==="return"?"return":"next";if(!p.k||b.done)return r(w,b);b=e[w](b).value}i(u.done?"return":"normal",b)},function(b){r("throw",b)})}catch(b){i("throw",b)}}function i(l,A){switch(l){case"return":t.resolve({value:A,done:!0});break;case"throw":t.reject(A);break;default:t.resolve({value:A,done:!1})}(t=t.next)?r(t.key,t.arg):s=null}this._invoke=function(l,A){return new A1(function(u,p){var f={key:l,arg:A,resolve:u,reject:p,next:null};s?s=s.next=f:(t=s=f,r(l,A))})},typeof e.return!="function"&&(this.return=void 0)}function vs(e){return new u1(e,0)}function af(e){var t={},s=!1;function r(i,l){return s=!0,l=new A1(function(A){A(e[i](l))}),{done:!1,value:new u1(l,1)}}return t[rf!==void 0&&PB||"@@iterator"]=function(){return this},t.next=function(i){return s?(s=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(s)throw s=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return s?(s=!1,i):r("return",i)}),t}T0.prototype[typeof rf=="function"&&Z$||"@@asyncIterator"]=function(){return this},T0.prototype.next=function(e){return this._invoke("next",e)},T0.prototype.throw=function(e){return this._invoke("throw",e)},T0.prototype.return=function(e){return this._invoke("return",e)};var qv=h(cL);function h1(e){var t,s,r,i=2;for(typeof Symbol<"u"&&(s=qv,r=Symbol.iterator);i--;){if(s&&(t=e[s])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new Yv(t.call(e));s="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Yv(e){function t(s){if(Object(s)!==s)return mt.reject(new TypeError(s+" is not an object."));var r=s.done;return mt.resolve(s.value).then(function(i){return{value:i,done:r}})}return Yv=function(s){this.s=s,this.n=s.next},Yv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var r=this.s.return;return r===void 0?mt.resolve({value:s,done:!0}):t(r.apply(this.s,arguments))},throw:function(s){var r=this.s.return;return r===void 0?mt.reject(s):t(r.apply(this.s,arguments))}},new Yv(e)}const eZ=function*(e,t){let s=e.byteLength;if(!t||s<t)return void(yield e);let r,i=0;for(;i<s;)r=i+t,yield e.slice(i,r),i=r},tZ=function(){var e=Na(function*(t,s){var r,i=!1,l=!1;try{for(var A,u=h1(sZ(t));i=!(A=yield vs(u.next())).done;i=!1){const p=A.value;yield*af(h1(eZ(p,s)))}}catch(p){l=!0,r=p}finally{try{i&&u.return!=null&&(yield vs(u.return()))}finally{if(l)throw r}}});return function(t,s){return e.apply(this,arguments)}}(),sZ=function(){var e=Na(function*(t){if(t[qv])return void(yield*af(h1(t)));const s=t.getReader();try{for(;;){const{done:r,value:i}=yield vs(s.read());if(r)break;yield i}}finally{yield vs(s.cancel())}});return function(t){return e.apply(this,arguments)}}(),lL=(e,t,s,r)=>{const i=tZ(e,t);let l,A=0,u=p=>{l||(l=!0,r&&r(p))};return new ReadableStream({async pull(p){try{const{done:f,value:b}=await i.next();if(f)return u(),void p.close();let w=b.byteLength;if(s){let _=A+=w;s(_)}p.enqueue(new Uint8Array(b))}catch(f){throw u(f),f}},cancel:p=>(u(p),i.return())},{highWaterMark:2})};function dL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function AL(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?dL(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):dL(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const{isFunction:Xv}=gt,rZ=(e=>{let{Request:t,Response:s}=e;return{Request:t,Response:s}})(gt.global),{ReadableStream:uL,TextEncoder:hL}=gt.global,pL=function(e){try{for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return!!e(...s)}catch{return!1}},nZ=e=>{e=gt.merge.call({skipUndefined:!0},rZ,e);const{fetch:t,Request:s,Response:r}=e,i=t?Xv(t):typeof fetch=="function",l=Xv(s),A=Xv(r);if(!i)return!1;const u=i&&Xv(uL),p=i&&(typeof hL=="function"?(f=new hL,U=>f.encode(U)):async U=>new Uint8Array(await new s(U).arrayBuffer()));var f;const b=l&&u&&pL(()=>{let U=!1;const B=new s(Qa.origin,{body:new uL,method:"POST",get duplex(){return U=!0,"half"}}).headers.has("Content-Type");return U&&!B}),w=A&&u&&pL(()=>gt.isReadableStream(new r("").body)),_={stream:w&&(U=>U.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(U=>{!_[U]&&(_[U]=(B,j)=>{let K=B&&B[U];if(K)return K.call(B);throw new fr("Response type '".concat(U,"' is not supported"),fr.ERR_NOT_SUPPORT,j)})});const C=async(U,B)=>{const j=gt.toFiniteNumber(U.getContentLength());return j??(async K=>K==null?0:gt.isBlob(K)?K.size:gt.isSpecCompliantForm(K)?(await new s(Qa.origin,{method:"POST",body:K}).arrayBuffer()).byteLength:gt.isArrayBufferView(K)||gt.isArrayBuffer(K)?K.byteLength:(gt.isURLSearchParams(K)&&(K+=""),gt.isString(K)?(await p(K)).byteLength:void 0))(B)};return async U=>{let{url:B,method:j,data:K,signal:q,cancelToken:ie,timeout:xe,onDownloadProgress:ye,onUploadProgress:ue,responseType:Re,headers:Ge,withCredentials:Ze="same-origin",fetchOptions:_t}=oL(U),ns=t||fetch;Re=Re?(Re+"").toLowerCase():"text";let Jt=$$([q,ie&&ie.toAbortSignal()],xe),bs=null;const As=Jt&&Jt.unsubscribe&&(()=>{Jt.unsubscribe()});let Xs;try{if(ue&&b&&j!=="get"&&j!=="head"&&(Xs=await C(Ge,K))!==0){let D,ne=new s(B,{method:"POST",body:K,duplex:"half"});if(gt.isFormData(K)&&(D=ne.headers.get("content-type"))&&Ge.setContentType(D),ne.body){const[ge,ot]=sL(Xs,zv(rL(ue)));K=lL(ne.body,65536,ge,ot)}}gt.isString(Ze)||(Ze=Ze?"include":"omit");const Br=l&&"credentials"in s.prototype,qe=AL(AL({},_t),{},{signal:Jt,method:j.toUpperCase(),headers:Ge.normalize().toJSON(),body:K,duplex:"half",credentials:Br?Ze:void 0});bs=l&&new s(B,qe);let lt=await(l?ns(bs,_t):ns(B,qe));const It=w&&(Re==="stream"||Re==="response");if(w&&(ye||It&&As)){const D={};["status","statusText","headers"].forEach(os=>{D[os]=lt[os]});const ne=gt.toFiniteNumber(lt.headers.get("content-length")),[ge,ot]=ye&&sL(ne,zv(rL(ye),!0))||[];lt=new r(lL(lt.body,65536,ge,()=>{ot&&ot(),As&&As()}),D)}Re=Re||"text";let Je=await _[gt.findKey(_,Re)||"text"](lt,U);return!It&&As&&As(),await new mt((D,ne)=>{tL(D,ne,{data:Je,headers:Rl.from(lt.headers),status:lt.status,statusText:lt.statusText,config:U,request:bs})})}catch(Br){throw As&&As(),Br&&Br.name==="TypeError"&&/Load failed|fetch/i.test(Br.message)?Object.assign(new fr("Network Error",fr.ERR_NETWORK,U,bs),{cause:Br.cause||Br}):fr.from(Br,Br&&Br.code,U,bs)}}},iZ=new Map,mL=e=>{let t=e&&e.env||{};const{fetch:s,Request:r,Response:i}=t,l=[r,i,s];let A,u,p=l.length,f=iZ;for(;p--;)A=l[p],u=f.get(A),u===void 0&&f.set(A,u=p?new Map:nZ(t)),f=u;return u};mL();const p1={http:null,xhr:J$,fetch:{get:mL}};gt.forEach(p1,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const fL=e=>"- ".concat(e),aZ=e=>gt.isFunction(e)||e===null||e===!1;var gL={getAdapter:function(e,t){e=gt.isArray(e)?e:[e];const{length:s}=e;let r,i;const l={};for(let A=0;A<s;A++){let u;if(r=e[A],i=r,!aZ(r)&&(i=p1[(u=String(r)).toLowerCase()],i===void 0))throw new fr("Unknown adapter '".concat(u,"'"));if(i&&(gt.isFunction(i)||(i=i.get(t))))break;l[u||"#"+A]=i}if(!i){const A=Object.entries(l).map(u=>{let[p,f]=u;return"adapter ".concat(p," ")+(f===!1?"is not supported by the environment":"is not available in the build")});throw new fr("There is no suitable adapter to dispatch the request "+(s?A.length>1?`since :
`+A.map(fL).join(`
`):" "+fL(A[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:p1};function m1(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new nf(null,e)}function bL(e){return m1(e),e.headers=Rl.from(e.headers),e.data=l1.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),gL.getAdapter(e.adapter||o1.adapter,e)(e).then(function(t){return m1(e),t.data=l1.call(e,e.transformResponse,t),t.headers=Rl.from(t.headers),t},function(t){return eL(t)||(m1(e),t&&t.response&&(t.response.data=l1.call(e,e.transformResponse,t.response),t.response.headers=Rl.from(t.response.headers))),mt.reject(t)})}const xL="1.13.2",Jv={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Jv[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const vL={};Jv.transitional=function(e,t,s){function r(i,l){return"[Axios v"+xL+"] Transitional option '"+i+"'"+l+(s?". "+s:"")}return(i,l,A)=>{if(e===!1)throw new fr(r(l," has been removed"+(t?" in "+t:"")),fr.ERR_DEPRECATED);return t&&!vL[l]&&(vL[l]=!0,console.warn(r(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,l,A)}},Jv.spelling=function(e){return(t,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};var $v={assertOptions:function(e,t,s){if(typeof e!="object")throw new fr("options must be an object",fr.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const l=r[i],A=t[l];if(A){const u=e[l],p=u===void 0||A(u,l,e);if(p!==!0)throw new fr("option "+l+" must be "+p,fr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new fr("Unknown option "+l,fr.ERR_BAD_OPTION)}},validators:Jv};const yd=$v.validators;let Zv=class{constructor(e){this.defaults=e||{},this.interceptors={request:new SD,response:new SD}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Zh(this.defaults,t);const{transitional:s,paramsSerializer:r,headers:i}=t;s!==void 0&&$v.assertOptions(s,{silentJSONParsing:yd.transitional(yd.boolean),forcedJSONParsing:yd.transitional(yd.boolean),clarifyTimeoutError:yd.transitional(yd.boolean)},!1),r!=null&&(gt.isFunction(r)?t.paramsSerializer={serialize:r}:$v.assertOptions(r,{encode:yd.function,serialize:yd.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),$v.assertOptions(t,{baseUrl:yd.spelling("baseURL"),withXsrfToken:yd.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=i&&gt.merge(i.common,i[t.method]);i&&gt.forEach(["delete","get","head","post","put","patch","common"],C=>{delete i[C]}),t.headers=Rl.concat(l,i);const A=[];let u=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(t)===!1||(u=u&&C.synchronous,A.unshift(C.fulfilled,C.rejected))});const p=[];let f;this.interceptors.response.forEach(function(C){p.push(C.fulfilled,C.rejected)});let b,w=0;if(!u){const C=[bL.bind(this),void 0];for(C.unshift(...A),C.push(...p),b=C.length,f=mt.resolve(t);w<b;)f=f.then(C[w++],C[w++]);return f}b=A.length;let _=t;for(;w<b;){const C=A[w++],U=A[w++];try{_=C(_)}catch(B){U.call(this,B);break}}try{f=bL.call(this,_)}catch(C){return mt.reject(C)}for(w=0,b=p.length;w<b;)f=f.then(p[w++],p[w++]);return f}getUri(e){return ED(nL((e=Zh(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};gt.forEach(["delete","get","head","options"],function(e){Zv.prototype[e]=function(t,s){return this.request(Zh(s||{},{method:e,url:t,data:(s||{}).data}))}}),gt.forEach(["post","put","patch"],function(e){function t(s){return function(r,i,l){return this.request(Zh(l||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Zv.prototype[e]=t(),Zv.prototype[e+"Form"]=t(!0)});var ew=Zv;class f1{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let s;this.promise=new mt(function(i){s=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let l=r._listeners.length;for(;l-- >0;)r._listeners[l](i);r._listeners=null}),this.promise.then=i=>{let l;const A=new mt(u=>{r.subscribe(u),l=u}).then(i);return A.cancel=function(){r.unsubscribe(l)},A},t(function(i,l,A){r.reason||(r.reason=new nf(i,l,A),s(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const s=this._listeners.indexOf(t);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const t=new AbortController,s=r=>{t.abort(r)};return this.subscribe(s),t.signal.unsubscribe=()=>this.unsubscribe(s),t.signal}static source(){let t;return{token:new f1(function(r){t=r}),cancel:t}}}var oZ=f1;const g1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(g1).forEach(e=>{let[t,s]=e;g1[s]=t});var cZ=g1;const Gi=function e(t){const s=new ew(t),r=oD(ew.prototype.request,s);return gt.extend(r,ew.prototype,s,{allOwnKeys:!0}),gt.extend(r,s,null,{allOwnKeys:!0}),r.create=function(i){return e(Zh(t,i))},r}(o1);Gi.Axios=ew,Gi.CanceledError=nf,Gi.CancelToken=oZ,Gi.isCancel=eL,Gi.VERSION=xL,Gi.toFormData=Bv,Gi.AxiosError=fr,Gi.Cancel=Gi.CanceledError,Gi.all=function(e){return mt.all(e)},Gi.spread=function(e){return function(t){return e.apply(null,t)}},Gi.isAxiosError=function(e){return gt.isObject(e)&&e.isAxiosError===!0},Gi.mergeConfig=Zh,Gi.AxiosHeaders=Rl,Gi.formToJSON=e=>$B(gt.isHTMLForm(e)?new FormData(e):e),Gi.getAdapter=gL.getAdapter,Gi.HttpStatusCode=cZ,Gi.default=Gi;var Ta=Gi;const lZ=()=>{};function R0(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:lZ};return e.promise=new mt((t,s)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,s(r))}}),e}const tw=new Map,sw=new Map,Ed=new Map;let Vn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ys=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const wL=new GY;let Il=wL.getResult(),b1=null;function zs(e){if(!b1){Il=wL.getResult();const t=function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return Ys.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ys.CHROME;case"Safari":case"Mobile Safari":return Ys.SAFARI;case"Edge":return Ys.EDGE;case"Firefox":return Ys.FIREFOX;case"QQ":case"QQBrowser":return Ys.QQ;case"Opera":return Ys.OPERA;case"WeChat":return Ys.WECHAT;default:return u.browser.name||""}}(Il),s=_L(Il),r=function(u){return u.os.name==="Windows"?u.os.version?u.os.name+" "+u.os.version:u.os.name:u.os.name||""}(Il),i=Il.os.version,l=_L(Il,!1),A=Il.device.type;if(!(t&&s&&r&&i))return{name:t,version:s,os:r,osVersion:i,browserVersion:l,deviceType:A};b1={name:t,version:s,os:r,osVersion:i,browserVersion:l,deviceType:A}}return b1}function _L(e){let t,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",s?t.split(".")[0]:t}function rw(){return zs().os}function yL(){const e=zs();return"".concat(e.os," ").concat(e.osVersion)}function nw(){const e=zs();return!!(Il.engine.name==="WebKit"&&e.os===Vn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ys.SAFARI||Ki()&&e.name!==Ys.SAFARI)}function EA(){return zs().name===Ys.CHROME}function Jn(){return zs().name===Ys.SAFARI}function EL(){const e=zs();if(e.name!==Ys.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function SL(){return zs().name===Ys.EDGE}function Tr(){return zs().name===Ys.FIREFOX}function Ki(){return zs().os===Vn.IOS}function Ol(e){const t=zs();return!(t.name!==Ys.CHROME||!t.osVersion)&&Number(t.version)>=e}function CL(e){const t=zs();return!(t.name!==Ys.CHROME||!t.osVersion)&&Number(t.version)<e}function x1(e,t,s){const r=zs();return!(r.name!==e||!r.osVersion)&&(s?Number(r.version)>=t&&Number(r.version)<=s:Number(r.version)===t)}function Su(e){const t=zs();return!(t.name!==Ys.EDGE||!t.osVersion)&&Number(t.version)>=e}function v1(e){const t=zs();return!(t.name!==Ys.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function NL(e){const t=zs();return!(t.name!==Ys.SAFARI||!t.osVersion)&&Number(t.version)>=e}function TL(e,t,s){const r=zs();if(r.os!==Vn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return s?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function RL(e,t,s){const r=zs();if(r.os!==Vn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return s?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function w1(e,t,s){const r=zs();if(r.name!==Ys.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return s?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function ep(e){const t=zs();return!(t.name!==Ys.OPERA||!t.osVersion)&&Number(t.version)>=e}function IL(){const e=zs();if(e.os!==Vn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function of(){const e=zs();if(e.os!==Vn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function _1(){const e=zs();if(e.os!==Vn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function OL(){const e=zs();if(e.os!==Vn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Mc(){return Jn()&&navigator.maxTouchPoints>0}function kL(){return zs().name===Ys.WECHAT}function DL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function BL(){const e=rw();return function(){const{deviceType:t}=zs();return t==="mobile"||t==="tablet"}()||e===Vn.ANDROID||e===Vn.IOS||e===Vn.HARMONY_OS}function Sd(){const e=zs();return e.name!==Ys.EDGE&&e.name!==Ys.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function I0(){return rw()===Vn.ANDROID}function O0(){const e=zs();return I0()&&(e.name===Ys.CHROME||e.name===Ys.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function cs(e,t,s){return(t=function(r){var i=function(l,A){if(typeof l!="object"||!l)return l;var u=l[Symbol.toPrimitive];if(u!==void 0){var p=u.call(l,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function LL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function ct(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?LL(Object(s),!0).forEach(function(r){cs(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):LL(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let W=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Me=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(t),cs(this,"code",void 0),cs(this,"message",void 0),cs(this,"data",void 0),cs(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Vc(e,t){if(typeof e!="boolean")throw new Me(W.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function hn(e,t,s){if(!nt(s).call(s,e))throw new Me(W.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(s)))}function gr(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<s||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new Me(W.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(s,", ").concat(r,"]. integer only"))}function y1(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Me(W.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&gr(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&gr(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&gr(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&gr(e.ideal,"".concat(t,".ideal"),1,1/0)}else gr(e,t,1,1/0)}function di(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Me(W.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!jL(e,s,r,i))throw new Me(W.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(s,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function SA(e,t){if(!Array.isArray(e))throw new Me(W.INVALID_PARAMS,"".concat(t," should be an array"))}function Kr(e){return e==null}function jL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=s&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let l=0;l<i.length;l+=1){const A=i.charCodeAt(l);if(A<0||A>255)return!1}return!0}(e))}function PL(e,t,s){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,s);const r=e.getUint32(t,s),i=e.getUint32(t+4,s),l=0,A=+!s;return BigInt(r*A+i*l)<<BigInt(32)|BigInt(r*l+i*A)}function UL(e,t,s,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,s,r);const i=Number(s>>BigInt(32)),l=Number(s&BigInt(4294967295));e.setUint32(t,i,r),e.setUint32(t+4,l,r)}var k0=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(k0||{}),E1=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(E1||{});const FL=new class{constructor(){cs(this,"_clientSize",null),cs(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),cs(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),cs(this,"getStyle",e=>window.getComputedStyle(e,null)),cs(this,"checkCssVisibleProperty",e=>{var t;let s=!0;const r=this.getStyle(e),{display:i,visibility:l,opacity:A,filter:u}=r;return(i==="none"||nt(t=["hidden","collapse"]).call(t,l)||Number(A)<.1)&&(s=!1),!!s&&(u&&u.split(" ").filter(p=>{var f;const b=p.split("(")[0];return nt(f=["brightness","blur","opacity"]).call(f,b)}).map(p=>{const[f,b]=p.split(/\(|\)/);return[f,Number(b.match(/^[0-9\.]+/))]}).forEach(p=>{const[f,b]=p;switch(f){case"brightness":(b<.1||b>3)&&(s=!1);break;case"blur":b>3&&(s=!1);break;case"opacity":b<.1&&(s=!1)}}),s)}),cs(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let s=!0,r=!0;const i=A=>t(A);let l=e;for(;l&&r;)i(l)||(s=!1,r=!1),l=l.parentElement,l||(r=!1);return s}),cs(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),cs(this,"getSizeAboutClient",e=>{const{width:t,height:s,left:r,right:i,top:l,bottom:A}=e.getBoundingClientRect(),u=this.getClientWidth(),p=this.getClientHeight();return{width:t,height:s,left:r,right:i,top:l,bottom:A,clientWidth:u,clientHeight:p,clientMin:Math.min(u,p)}}),cs(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(e,t,s)}),cs(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),cs(this,"checkCoverForAPoint",(e,t,s)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==s}),cs(this,"getPointPositionList",()=>{const{width:e,height:t,left:s,top:r}=this._clientSize,i=e/6,l=t/6,A=[],u=10**6;for(let p=0;p<5;p++)for(let f=0;f<5;f++){const b=(s*u+(p===0?.1:p===4?(i*p*u-1e5)/u:i*p)*u)/u,w=(r*u+(f===0?.1:f===4?(l*f*u-1e5)/u:l*f)*u)/u;A.push({x:b,y:w})}return[...A]}),cs(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),cs(this,"checkSizeIsVisible",(e,t,s)=>(e>50||s/e<=10)&&(t>50||s/t<=10)),cs(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:s,bottom:r,clientHeight:i,clientWidth:l,clientMin:A}=this._clientSize;let u,p,f,b;if(e<0)u=0;else{if(!(e<l))return!1;u=e}if(t<0)return!1;if(p=t<l?t:l,s<0)f=0;else{if(!(s<i))return!1;f=s}if(r<0)return!1;b=r<i?r:i;const w=p-u,_=b-f;return this.checkSizeIsVisible(w,_,A)}),cs(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),cs(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(k0.COVERED);{const t=this.checkActualSize(),s=this.checkSizeOfPartInClient();return t&&!s?this.returnHiddenResult(k0.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(k0.SIZE)}}return this.returnHiddenResult(k0.STYLE)}return this.returnHiddenResult(E1.UNMOUNTED)}return this.returnHiddenResult(E1.INVALID_HTML_ELEMENT)}),cs(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function S1(e){return new TextEncoder().encode(e)}const ML=function(e,t){const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s},C1=async e=>function(t,s){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(s).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",S1(e)),16);let jr=class{constructor(){cs(this,"_events",{}),cs(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const s=this._events[e];this._indexOfListener(s,t)===-1&&s.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const s=this._events[e];this._indexOfListener(s,t)===-1&&s.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const s=this._events[e],r=this._indexOfListener(s,t);r!==-1&&s.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];for(let l=0;l<t.length;l+=1){const A=t[l];A.once&&this.off(e,A.listener),A.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];[...this._events[e]||[]].forEach(i=>{i.once&&this.off(e,i.listener);try{i.listener.apply(this,s)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let s=e.length;for(;s--;)if(e[s].listener===t)return s;return-1}},D0=null;function VL(){if(D0)return D0;if(window.electron)return D0=window.electron;if(!window.require)return null;try{return D0=window.require("electron"),D0}catch{return null}}let kr=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e}({}),br=function(e){return e.TRACER="tracer",e}({});function QL(e){return gr(e.timeout,"config.timeout",0,1e5),gr(e.timeoutFactor,"config.timeoutFactor",0,100,!1),gr(e.maxRetryCount,"config.maxRetryConfig",0,1/0),gr(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let dZ=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Us=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e}({});function tp(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function HL(e){return di(e.turnServerURL,"turnServerURL"),di(e.username,"username"),di(e.password,"password"),e.udpport&&gr(e.udpport,"udpport",1,99999,!0),e.forceturn&&Vc(e.forceturn,"forceturn"),e.security&&Vc(e.security,"security"),e.tcpport&&gr(e.tcpport,"tcpport",1,99999,!0),!0}let cf=function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e}({});function N1(e){return e.level!==void 0&&hn(e.level,"level",[1,2,3]),e.delay!==void 0&&gr(e.delay,"delay",0,3e3,!0),!0}let Es=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e}({}),T1=function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e}({}),yi=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ua=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),sp=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function wn(e,t){for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?mt.reject(new Me(W.UNEXPECTED_ERROR,"can not emit promise")):new mt((l,A)=>{e.emit(t,...r,l,A)})}function wr(e,t){if(e.getListeners(t).length===0)return mt.resolve();for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];return wn(e,t,...r)}function fo(e,t){if(e.getListeners(t).length===0)return null;for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];return rp(e,t,...r)}function rp(e,t){let s=null,r=null;for(var i=arguments.length,l=new Array(i>2?i-2:0),A=2;A<i;A++)l[A-2]=arguments[A];if(e.emit(t,...l,u=>{s=u},u=>{r=u}),r!==null)throw r;if(s===null)throw new Me(W.UNEXPECTED_ERROR,"handler is not sync");return s}const Wr=new class extends jr{set networkState(e){this.emit(sp.NETWORK_STATE_CHANGE,e,this._networkState),e===ua.ONLINE?this.emit(sp.ONLINE):e===ua.OFFLINE&&(this.onlineWaiter=new mt(t=>{this.once(sp.ONLINE,()=>{this.onlineWaiter=void 0,t(ua.ONLINE)})}),this.emit(sp.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ua.ONLINE}constructor(){super(),cs(this,"_moduleName","network-indicator"),cs(this,"_networkState",ua.ONLINE),cs(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ua.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ua.OFFLINE})}},Ra=[];for(let e=0;e<256;++e)Ra.push((e+256).toString(16).slice(1));const GL=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let R1;const AZ=new Uint8Array(16);function uZ(){return GL?GL():function(s,r,i){var l,A,u,p;const f=(l=(A=(s=s||{}).random)!==null&&A!==void 0?A:(u=(p=s).rng)===null||u===void 0?void 0:u.call(p))!==null&&l!==void 0?l:function(){if(!R1){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");R1=crypto.getRandomValues.bind(crypto)}return R1(AZ)}();if(f.length<16)throw new Error("Random bytes length must be >= 16");if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,r){if((i=i||0)<0||i+16>r.length)throw new RangeError("UUID byte range ".concat(i,":").concat(i+15," is out of buffer bounds"));for(let b=0;b<16;++b)r[i+b]=f[b];return r}return function(b){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Ra[b[w+0]]+Ra[b[w+1]]+Ra[b[w+2]]+Ra[b[w+3]]+"-"+Ra[b[w+4]]+Ra[b[w+5]]+"-"+Ra[b[w+6]]+Ra[b[w+7]]+"-"+Ra[b[w+8]]+Ra[b[w+9]]+"-"+Ra[b[w+10]]+Ra[b[w+11]]+Ra[b[w+12]]+Ra[b[w+13]]+Ra[b[w+14]]+Ra[b[w+15]]).toLowerCase()}(f)}(e,t,void 0);var e,t}function iw(e,t){const s=e.indexOf(t);s!==-1&&e.splice(s,1)}function lf(e){const t=[];return e.forEach(s=>{t.indexOf(s)===-1&&t.push(s)}),t}function aw(e){mt!==void 0?mt.resolve().then(e):setTimeout(e,0)}function Rr(e){return JSON.parse(JSON.stringify(e))}function np(e){try{return Rr(e)}catch{return e}}const KL={};function Cu(e,t){KL[t]||(KL[t]=!0,e())}function ip(e){const t=window.atob(e),s=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)s[r]=t.charCodeAt(r);return s}function Nu(e){let t="";for(let s=0;s<e.length;s+=1)t+=String.fromCharCode(e[s]);return window.btoa(t)}function WL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(e);if(s.length>t)s=s.slice(0,t);else if(s.length<t){const r=new Uint8Array(t);r.set(s),s=r}return s}function zL(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=Fa(t).call(t,(A,u)=>A+u.length,0),i=new Uint8Array(new ArrayBuffer(r));let l=0;return t.forEach(A=>{i.set(A,l),l+=A.length}),i}function Cd(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function qL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(s=>{t+=typeof s=="string"?Cd(s):s.size}),t+138}function hZ(e){const t=new Me(W.TIMEOUT,"timeout");return new mt((s,r)=>{window.setTimeout(()=>r(t),e)})}function Qn(e){return new mt(t=>{window.setTimeout(t,e)})}function ar(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,e).toLowerCase();return s.length===e?"".concat(t).concat(s):"".concat(t).concat(s)+ar(e-s.length,"")}function ap(){let e,t=!1;try{var s;e=HY(s=uZ()).call(s,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=ar(32,"")),e.toUpperCase()}const B0=()=>{},YL=new class{constructor(){cs(this,"fnMap",new Map)}throttleByKey(e,t,s,r){for(var i=arguments.length,l=new Array(i>4?i-4:0),A=4;A<i;A++)l[A-4]=arguments[A];if(this.fnMap.has(t)){const u=this.fnMap.get(t);if(u.threshold!==s){u.fn(...u.args),clearTimeout(u.timer);const p=window.setTimeout(()=>{const f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:p,args:l,skipFn:r})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,ct(ct({},u),{},{fn:e,args:l,skipFn:r}))}else{const u=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:u,args:l,skipFn:r})}}},XL=YL.throttleByKey.bind(YL);function JL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function I1(e,t){if(!JL(e)||!JL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const s=[...e];for(let r=0;r<t.length;r++)s[r]=I1(e[r],t[r]);return s}{const s=ct({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?s[r]=I1(e[r],t[r]):s[r]=t[r]);return s}}function $L(e,t){let s=[0];if(s=new Array(t).fill(0),e===0)return s;let r=0;for(;e>0&&(s[r]=255&e,e>>=8,r++,r!==t););return s}function df(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function O1(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function k1(e){return Fa(e).call(e,(t,s)=>t+s,0)}function ZL(e){const t="0123456789abcdef";function s(ie){let xe,ye="";for(xe=0;xe<=3;xe++)ye+=t.charAt(ie>>8*xe+4&15)+t.charAt(ie>>8*xe&15);return ye}function r(ie,xe){const ye=(65535&ie)+(65535&xe);return(ie>>16)+(xe>>16)+(ye>>16)<<16|65535&ye}function i(ie,xe,ye,ue,Re,Ge){return r(function(Ze,_t){return Ze<<_t|Ze>>>32-_t}(r(r(xe,ie),r(ue,Ge)),Re),ye)}function l(ie,xe,ye,ue,Re,Ge,Ze){return i(xe&ye|~xe&ue,ie,xe,Re,Ge,Ze)}function A(ie,xe,ye,ue,Re,Ge,Ze){return i(xe&ue|ye&~ue,ie,xe,Re,Ge,Ze)}function u(ie,xe,ye,ue,Re,Ge,Ze){return i(xe^ye^ue,ie,xe,Re,Ge,Ze)}function p(ie,xe,ye,ue,Re,Ge,Ze){return i(ye^(xe|~ue),ie,xe,Re,Ge,Ze)}const f=function(ie){let xe;const ye=1+(ie.length+8>>6),ue=new Array(16*ye);for(xe=0;xe<16*ye;xe++)ue[xe]=0;for(xe=0;xe<ie.length;xe++)ue[xe>>2]|=ie.charCodeAt(xe)<<xe%4*8;return ue[xe>>2]|=128<<xe%4*8,ue[16*ye-2]=8*ie.length,ue}(e);let b,w,_,C,U,B=1732584193,j=-271733879,K=-1732584194,q=271733878;for(b=0;b<f.length;b+=16)w=B,_=j,C=K,U=q,B=l(B,j,K,q,f[b+0],7,-680876936),q=l(q,B,j,K,f[b+1],12,-389564586),K=l(K,q,B,j,f[b+2],17,606105819),j=l(j,K,q,B,f[b+3],22,-1044525330),B=l(B,j,K,q,f[b+4],7,-176418897),q=l(q,B,j,K,f[b+5],12,1200080426),K=l(K,q,B,j,f[b+6],17,-1473231341),j=l(j,K,q,B,f[b+7],22,-45705983),B=l(B,j,K,q,f[b+8],7,1770035416),q=l(q,B,j,K,f[b+9],12,-1958414417),K=l(K,q,B,j,f[b+10],17,-42063),j=l(j,K,q,B,f[b+11],22,-1990404162),B=l(B,j,K,q,f[b+12],7,1804603682),q=l(q,B,j,K,f[b+13],12,-40341101),K=l(K,q,B,j,f[b+14],17,-1502002290),j=l(j,K,q,B,f[b+15],22,1236535329),B=A(B,j,K,q,f[b+1],5,-165796510),q=A(q,B,j,K,f[b+6],9,-1069501632),K=A(K,q,B,j,f[b+11],14,643717713),j=A(j,K,q,B,f[b+0],20,-373897302),B=A(B,j,K,q,f[b+5],5,-701558691),q=A(q,B,j,K,f[b+10],9,38016083),K=A(K,q,B,j,f[b+15],14,-660478335),j=A(j,K,q,B,f[b+4],20,-405537848),B=A(B,j,K,q,f[b+9],5,568446438),q=A(q,B,j,K,f[b+14],9,-1019803690),K=A(K,q,B,j,f[b+3],14,-187363961),j=A(j,K,q,B,f[b+8],20,1163531501),B=A(B,j,K,q,f[b+13],5,-1444681467),q=A(q,B,j,K,f[b+2],9,-51403784),K=A(K,q,B,j,f[b+7],14,1735328473),j=A(j,K,q,B,f[b+12],20,-1926607734),B=u(B,j,K,q,f[b+5],4,-378558),q=u(q,B,j,K,f[b+8],11,-2022574463),K=u(K,q,B,j,f[b+11],16,1839030562),j=u(j,K,q,B,f[b+14],23,-35309556),B=u(B,j,K,q,f[b+1],4,-1530992060),q=u(q,B,j,K,f[b+4],11,1272893353),K=u(K,q,B,j,f[b+7],16,-155497632),j=u(j,K,q,B,f[b+10],23,-1094730640),B=u(B,j,K,q,f[b+13],4,681279174),q=u(q,B,j,K,f[b+0],11,-358537222),K=u(K,q,B,j,f[b+3],16,-722521979),j=u(j,K,q,B,f[b+6],23,76029189),B=u(B,j,K,q,f[b+9],4,-640364487),q=u(q,B,j,K,f[b+12],11,-421815835),K=u(K,q,B,j,f[b+15],16,530742520),j=u(j,K,q,B,f[b+2],23,-995338651),B=p(B,j,K,q,f[b+0],6,-198630844),q=p(q,B,j,K,f[b+7],10,1126891415),K=p(K,q,B,j,f[b+14],15,-1416354905),j=p(j,K,q,B,f[b+5],21,-57434055),B=p(B,j,K,q,f[b+12],6,1700485571),q=p(q,B,j,K,f[b+3],10,-1894986606),K=p(K,q,B,j,f[b+10],15,-1051523),j=p(j,K,q,B,f[b+1],21,-2054922799),B=p(B,j,K,q,f[b+8],6,1873313359),q=p(q,B,j,K,f[b+15],10,-30611744),K=p(K,q,B,j,f[b+6],15,-1560198380),j=p(j,K,q,B,f[b+13],21,1309151649),B=p(B,j,K,q,f[b+4],6,-145523070),q=p(q,B,j,K,f[b+11],10,-1120210379),K=p(K,q,B,j,f[b+2],15,718787259),j=p(j,K,q,B,f[b+9],21,-343485551),B=r(B,w),j=r(j,_),K=r(K,C),q=r(q,U);return s(B)+s(j)+s(K)+s(q)}let pZ=1,ej=console,$n=class{static setLogger(e){ej=e}constructor(e,t){cs(this,"id",void 0),cs(this,"lockingPromise",mt.resolve()),cs(this,"locks",0),cs(this,"name",""),cs(this,"lockId",void 0),this.lockId=pZ++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");ej.debug("".concat(s," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const s=new mt(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>s),r}};function Af(e,t){return function(s,r,i){const l=i.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const A=this[t];if(!A)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const u=await A.lock("From ".concat(e,".").concat(r));try{for(var p=arguments.length,f=new Array(p),b=0;b<p;b++)f[b]=arguments[b];return await l.apply(this,f)}finally{u()}},i}}const pn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function ow(e,t){const s=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,s)}function kl(e,t,s,r){const i=Object.assign({},pn,r);let l=i.timeout;const A=async()=>{await function(f){return new mt(b=>{window.setTimeout(b,f)})}(l),l*=i.timeoutFactor,l=Math.min(i.maxRetryTimeout,l)};let u=!1;const p=new mt(async(f,b)=>{t=t||(()=>!1),s=s||(()=>!0);for(let w=0;w<i.maxRetryCount;w+=1){if(u)return b(new Me(W.OPERATION_ABORTED));try{const _=await e();if(!t(_,w)||w+1===i.maxRetryCount)return f(_);await A()}catch(_){if(!s(_,w)||w+1===i.maxRetryCount)return b(_);await A()}}});return p.cancel=()=>u=!0,p}let cw,D1=class{constructor(e){cs(this,"input",[]),cs(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Fa(e=this.input).call(e,(t,s)=>t+s)/this.input.length}},lw=0,B1=0;function L1(e,t,s,r){return new mt((i,l)=>{t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),lw+=Cd(t.data)):s&&(t.data.size?lw+=t.data.size:t.data instanceof FormData?lw+=qL(t.data):lw+=Cd(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ta.request(t).then(A=>{typeof A.data=="string"?B1+=Cd(A.data):A.data instanceof ArrayBuffer||A.data instanceof Uint8Array?B1+=A.data.byteLength:B1+=Cd(JSON.stringify(A.data)),i(A.data)}).catch(A=>{Ta.isCancel(A)?l(new Me(W.OPERATION_ABORTED,"cancel token canceled")):A.code==="ECONNABORTED"?l(new Me(W.NETWORK_TIMEOUT,A.message)):A.response?l(new Me(W.NETWORK_RESPONSE_ERROR,A.response.status)):l(new Me(W.NETWORK_ERROR,A.message))})})}async function mZ(e,t){const s=new Blob([t.data],{type:"buffer"});return await L1(e,ct(ct({},t),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const tj=()=>window.isSecureContext!==void 0;function Qc(e){if(Array.isArray(e))return e.map(s=>s);if(!sj(e))return e;const t={};for(const s in e){const r=e[s];sj(r)||Array.isArray(r)?t[s]=Qc(r):t[s]=r}return t}function sj(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let j1=class{constructor(e){cs(this,"input",[]),cs(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Hc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},L0={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Hc,remoteCandidate:Hc},updateInterval:0},rj={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},nj={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},ij={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},aj={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let P1=class{constructor(e,t){cs(this,"onFirstVideoReceived",void 0),cs(this,"onFirstVideoDecoded",void 0),cs(this,"onFirstAudioReceived",void 0),cs(this,"onFirstVideoDecodedTimeout",void 0),cs(this,"onFirstAudioDecoded",void 0),cs(this,"onSelectedLocalCandidateChanged",void 0),cs(this,"onSelectedRemoteCandidateChanged",void 0),cs(this,"videoIsReady",!1),cs(this,"videoIsReady2",{}),cs(this,"pc",void 0),cs(this,"options",void 0),cs(this,"intervalTimer",void 0),cs(this,"stats",Qc(L0)),cs(this,"isFirstVideoReceived",{}),cs(this,"isFirstVideoDecoded",{}),cs(this,"isFirstAudioReceived",{}),cs(this,"isFirstAudioDecoded",{}),cs(this,"isFirstVideoDecodedTimeout",{}),cs(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new mt(e=>{e({local:ct({},Hc),remote:ct({},Hc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,l=0,A=0;for(const u of s)e[u].forEach((p,f)=>{if(!this.lossRateWindowStats[t-1][u][f]||!this.lossRateWindowStats[0][u][f])return;const b=this.lossRateWindowStats[t-1][u][f].packets-this.lossRateWindowStats[0][u][f].packets,w=this.lossRateWindowStats[t-1][u][f].packetsLost-this.lossRateWindowStats[0][u][f].packetsLost;u==="videoSend"||u==="audioSend"?(r+=b,l+=w):(i+=b,A+=w),Number.isNaN(b)||Number.isNaN(b)?p.packetLostRate=0:p.packetLostRate=b<=0||w<=0?0:w/(b+w)});e.sendPacketLossRate=r<=0||l<=0?0:l/(r+l),e.recvPacketLossRate=i<=0||A<=0?0:A/(i+A)}},fZ=class extends P1{constructor(){super(...arguments),cs(this,"_stats",L0),cs(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Qc(L0);const s=t.filter(i=>i.type==="ssrc");this.processSSRCStats(s);const r=t.find(i=>i.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var s;const r=nt(s=t.id).call(s,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=Qc(nj);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=Qc(rj),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),l){const A=l.stats,u=Date.now()-l.lts;i.framesDecodeFreezeTime=A.framesDecodeFreezeTime,i.framesDecodeInterval=A.framesDecodeInterval,i.framesDecodeCount>A.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(l.lts=Date.now(),i.framesDecodeInterval=u,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<l.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:ct({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=Qc(aj);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=Qc(ij);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new mt((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(s=>{const r={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(i=>{r[i]=s.stat(i)}),t.push(r)}),t}},uf=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),dw=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),U1=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Bo=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var hf=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(hf||{});function j0(e,t,s,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:hf.kNone;if(!t)return;const l=Number(t[s]);if(typeof l!="number")return;const A=Number(t[r]);if(typeof A!="number")return;if(!e)return A?l/A*i:void 0;const u=Number(e[s]);if(typeof u!="number")return;const p=Number(e[r]);if(typeof p!="number")return;const f=A-p;return f?(l-u)/f*i:void 0}let oj=class extends P1{constructor(){super(...arguments),cs(this,"_stats",L0),cs(this,"report",void 0),cs(this,"lastDecodeVideoReceiverStats",new Map),cs(this,"lastVideoFramesRecv",new Map),cs(this,"lastVideoFramesSent",new Map),cs(this,"lastVideoFramesDecode",new Map),cs(this,"lastVideoFramesOutput",new Map),cs(this,"lastVideoJBDelay",new Map),cs(this,"lastAudioJBDelay",new Map),cs(this,"mediaBytesSent",new Map),cs(this,"mediaBytesRetransmit",new Map),cs(this,"mediaBytesTargetEncode",new Map),cs(this,"lastDecodeAudioReceiverStats",new Map),cs(this,"lastAudioConcealment",new Map),cs(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Qc(L0),this.report.forEach(e=>{switch(e.type){case Bo.OUTBOUND:case Bo.INBOUND:{const t=e.mediaType||e.kind,s=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Bo.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||s)&&this.processVideoOutboundStats(e):e.type===Bo.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||s)&&this.processVideoInboundStats(e));break}case Bo.TRANSPORT:{this.processTransportStats(e);const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Bo.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:ct({},Hc),remote:ct({},Hc)};return e.forEach(s=>{let r;if(s.type===Bo.TRANSPORT&&(r=e.get(s.selectedCandidatePairId)),s.type===Bo.CANDIDATE_PAIR&&s.selected&&(r=s),r){const i=(l,A)=>{l.type=A.type,l.id=A.id,A.address&&(l.address=A.address),A.candidateType&&(l.candidateType=A.candidateType),A.port&&(l.port=A.port),A.priority&&(l.priority=A.priority),A.protocol&&(l.protocol=A.protocol),A.relayProtocol&&(l.relayProtocol=A.relayProtocol)};if(r.localCandidateId){const l=e.get(r.localCandidateId);l&&i(t.local,l)}if(r.remoteCandidateId){const l=e.get(r.remoteCandidateId);l&&i(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Bo.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Bo.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Bo.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ct({},t),ct({},this.stats.selectedCandidatePair.localCandidate)),e.type===Bo.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ct({},t),ct({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=Qc(aj),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const s=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=j0(s,t,"totalProcessingDelay","jitterBufferEmittedCount",hf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,s,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,ct({},t))}calculateAudioFreeze(e,t,s){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,l=s.timestamp,A=l-i;if(A<=0)return;const u=e.concealedSamples-t.concealedSamples-0,p=r.nonSilent+u,f=e.totalSamplesReceived-t.totalSamplesReceived;if(f<=0)return;const b=80*f/A,w=200*f/A,_=A/f;let C=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,p>b&&(r.plc80>0?(e.freezeSamples80+=u,e.freezeMs80+=Math.round(u*_)):(e.freezeSamples80+=p,e.freezeMs80+=Math.round(p*_)),C=r.plc80+1);let U=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,p>w&&(r.plc200>0?(e.freezeSamples200+=u,e.freezeMs200+=Math.round(u*_)):(e.freezeSamples200+=p,e.freezeMs200+=Math.round(p*_)),U=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:u,lts:l,plc80:C,plc200:U})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(A=>A.ssrc===e.ssrc);t||(t=Qc(rj),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const s=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const A=t.decodedFrame?t.decodedFrame.width:0,u=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,A,u),this.isFirstVideoDecoded[t.ssrc]=!0}if(s){const A=s.stats,u=l-s.lts;t.framesDecodeFreezeTime=A.framesDecodeFreezeTime,t.framesDecodeInterval=A.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>A.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(s.lts=Date.now(),t.framesDecodeInterval=u,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<A.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(s.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-s.qpSum)/(e.framesDecoded-s.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=j0(s==null?void 0:s.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=j0(s==null?void 0:s.stats,t,"totalProcessingDelay","framesDecodeCount",hf.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=j0(s==null?void 0:s.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",hf.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=j0(s==null?void 0:s.stats,t,"totalInterFrameDelay","framesDecodeCount",hf.kMillisecondsFromSeconds),r&&l-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((l-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&l-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((l-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ct({},t),lts:s?s.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=Qc(nj),this._stats.videoSend.push(t));const s=this.mediaBytesSent.get(e.ssrc);if(s)s.add(e.bytesSent);else{const r=new j1(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new j1(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new j1(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,l=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*l/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Bo.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(s=>s.ssrc===e.ssrc);if(t||(t=Qc(ij),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const s=this.findRemoteStatsId(e.ssrc,Bo.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var s;const r=Array.from(ho(s=this.report).call(s)).find(i=>i.type===t&&i.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const s=this.report.get(e);s&&s.width&&s.height&&s.framesPerSecond&&(t.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(e,t){const s=this.report.get(e);s&&(t.inputLevel=s.audioLevel)}processVideoTrackSenderStats(e,t,s){var r,i,l,A;const u=t?this.report.get(t):void 0,p=(r=u==null?void 0:u.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof p!="number")return;let f=(i=u==null?void 0:u.frameWidth)!==null&&i!==void 0?i:e.frameWidth,b=(l=u==null?void 0:u.frameHeight)!==null&&l!==void 0?l:e.frameHeight,w=(A=u==null?void 0:u.framesPerSecond)!==null&&A!==void 0?A:e.framesPerSecond;if(typeof f=="number"&&typeof b=="number"||(f=0,b=0),w==null){const _=Date.now(),C=this.lastVideoFramesSent.get(s.ssrc);C&&_-C.lts>=800?(w=Math.round((p-C.count)/((_-C.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:p,lts:_,rate:w})):C?w=C.rate:this.lastVideoFramesSent.set(s.ssrc,{count:p,lts:_,rate:0})}s.sentFrame={width:f,height:b,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(e,t,s){var r,i,l,A,u;const p=t?this.report.get(t):void 0,f=(r=p==null?void 0:p.framesReceived)!==null&&r!==void 0?r:e.framesReceived,b=(i=p==null?void 0:p.frameWidth)!==null&&i!==void 0?i:e.frameWidth,w=(l=p==null?void 0:p.frameHeight)!==null&&l!==void 0?l:e.frameHeight,_=(A=p==null?void 0:p.jitterBufferDelay)!==null&&A!==void 0?A:e.jitterBufferDelay,C=(u=p==null?void 0:p.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount;if(typeof f=="number"){const U=this.lastVideoFramesRecv.get(s.ssrc),B=Date.now();s.framesReceivedCount=f;let j=0;U&&B-U.lts>=800?(j=Math.round((f-U.count)/((B-U.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:f,lts:B,rate:j})):U?j=U.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:f,lts:B,rate:0}),s.receivedFrame={width:b||0,height:w||0,frameRate:j||0},s.decodedFrame={width:b||0,height:w||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:b||0,height:w||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(_&&C){const U=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let B=U.jitterBufferMs;const j=C-U.jitterBufferEmittedCount;j>0&&(B=1e3*(_-U.jitterBufferDelay)/j),s.jitterBufferMs=B,s.currentDelayMs=Math.round(B),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:C,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(e,t,s){var r,i,l,A;const u=t?this.report.get(t):void 0,p=(r=(i=u==null?void 0:u.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,f=(l=(A=u==null?void 0:u.echoReturnLossEnhancement)!==null&&A!==void 0?A:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;s.aecReturnLoss=p,s.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(e,t,s){var r,i,l,A,u,p,f,b,w;const _=t?this.report.get(t):void 0,C=(r=_==null?void 0:_.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,U=(i=_==null?void 0:_.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,B=(l=_==null?void 0:_.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,j=(A=_==null?void 0:_.jitterBufferEmittedCount)!==null&&A!==void 0?A:e.jitterBufferEmittedCount,K=(u=_==null?void 0:_.audioLevel)!==null&&u!==void 0?u:e==null?void 0:e.audioLevel,q=(p=_==null?void 0:_.totalSamplesDuration)!==null&&p!==void 0?p:e==null?void 0:e.totalSamplesDuration,ie=(f=_==null?void 0:_.concealedSamples)!==null&&f!==void 0?f:e.concealedSamples,xe=(b=_==null?void 0:_.silentConcealedSamples)!==null&&b!==void 0?b:e.silentConcealedSamples,ye=(w=_==null?void 0:_.concealmentEvents)!==null&&w!==void 0?w:e.concealmentEvents;if(typeof U=="number"&&(s.totalSamplesReceived=U),typeof xe=="number"&&(s.silentConcealedSamples=xe),typeof ye=="number"&&(s.concealmentEvents=ye),typeof ie=="number"&&(s.concealedSamples=ie),C&&U&&(s.accelerateRate=C/U),B&&j){const Re=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ge=Re.jitterBufferMs;const Ze=j-Re.jitterBufferEmittedCount;Ze>0&&(Ge=1e3*(B-Re.jitterBufferDelay)/Ze),s.jitterBufferMs=Math.round(Ge),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:B,jitterBufferEmittedCount:j,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=K;let ue=1920;q&&U&&(ue=U/q/50,s.receivedFrames=Math.round(U/ue)),ie&&(s.droppedFrames=Math.round(ie/ue))}processRemoteInboundStats(e,t){const s=this.report.get(e);s&&(t.packetsLost=s.packetsLost,s.roundTripTime&&(t.rttMs=1e3*s.roundTripTime),s.jitter&&(t.jitterMs=1e3*s.jitter),s.timestamp&&(t.timestamp=s.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const s=t.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let e=0,t=null,s=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{s=s===null?i.diffMean():s+i.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},gZ=class extends P1{updateStats(){return mt.resolve()}};function Aw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const A=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return A&&A[0]?Number(A[0].split("/")[1]):null}();return l?l<76?new fZ(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new oj(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(A){if(!window.RTCStatsReport)return!1;const u=A.getStats();return!!(u instanceof mt||function(p){return!!p&&(typeof p=="object"||typeof p=="function")&&typeof p.then=="function"}(u))}(e)?new oj(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new gZ(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const cj="websdk_ng_install_id";function F1(){try{if(G("INSTALL_ID"))return G("INSTALL_ID");let e=window.localStorage.getItem(cj);return e||(e=ap(),window.localStorage.setItem(cj,e)),pr("INSTALL_ID",e),e}catch{return}}const lc=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const s=t[1],r=t[2];return"".concat(s,".").concat(r)}return"4.0.0.999"}("4.24.2"),M1=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let op=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Ei=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const r=s.join(""),i=[];for(let u=0;u<6;u++)i.push("1");const l=i.join(""),A={};return A[e]=r,A[t]=l,Object.assign(A,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ei;const uw={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},V1={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Q1="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",H1={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},or=ct(ct(ct(ct({},H1),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:V1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},uw),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function pr(e,t,s){var r,i,l;nt(r=Object.keys(or)).call(r,e)&&(!s&&nt(i=Object.keys(Lo)).call(i,e)||(or[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(or.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,or.USE_NEW_NETWORK_CONFIG=l,l&&(or.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],or.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],or.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],or.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],or.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",or.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",or.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(or.ENABLE_INSTANT_VIDEO=!0,or.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(or.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(or.NEW_TURN_MODE||(or.NEW_TURN_MODE=4))))}function G(e){if(e==="TURN_DOMAINS"){const t=or.TURN_DOMAINS;return nt(t).call(t,G("TURN_DOMAIN"))?t:[G("TURN_DOMAIN")].concat(t)}return or[e]}M1||(or.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],or.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],or.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],or.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],or.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],or.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],or.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",or.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",or.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",or.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",or.AREAS=["NORTH_AMERICA","OVERSEA"]);let lj=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Lo={};var is=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(is||{});let cp=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const dj=128,bZ=96,Aj=1e3,pf=10;let xZ=0;var uj=(()=>{var e={8:(r,i,l)=>{l.r(i),l.d(i,{Parser:()=>Ze,Printer:()=>As,parse:()=>lt,print:()=>It});const A=`
`,u="".concat("\r").concat(A),p=" ";let f;function b(Je){return Je>="0"&&Je<="9"}function w(Je){return Je>="!"&&Je<="~"}function _(Je){return w(Je)||Je>=""&&Je<=""}function C(Je){return Je==="!"||Je>="#"&&Je<="'"||Je>="*"&&Je<="+"||Je>="-"&&Je<="."||Je>="0"&&Je<="9"||Je>="A"&&Je<="Z"||Je>="^"&&Je<="~"}function U(Je){return Je>="1"&&Je<="9"}function B(Je){return Je>="A"&&Je<="Z"||Je>="a"&&Je<="z"}function j(Je){return Je==="d"||Je==="h"||Je==="m"||Je==="s"}function K(Je){return Je>""&&Je<"	"||Je>"\v"&&Je<"\f"||Je>""&&Je<""}function q(Je){return B(Je)||b(Je)||Je==="+"||Je==="/"}function ie(Je){return b(Je)||B(Je)||Je==="+"||Je==="/"||Je==="-"||Je==="_"}function xe(Je){return B(Je)||b(Je)||Je==="+"||Je==="/"}function ye(Je,D){var ne=Object.keys(Je);if(Object.getOwnPropertySymbols){var ge=Object.getOwnPropertySymbols(Je);D&&(ge=ge.filter(function(ot){return Object.getOwnPropertyDescriptor(Je,ot).enumerable})),ne.push.apply(ne,ge)}return ne}function ue(Je){for(var D=1;D<arguments.length;D++){var ne=arguments[D]!=null?arguments[D]:{};D%2?ye(Object(ne),!0).forEach(function(ge){Re(Je,ge,ne[ge])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Je,Object.getOwnPropertyDescriptors(ne)):ye(Object(ne)).forEach(function(ge){Object.defineProperty(Je,ge,Object.getOwnPropertyDescriptor(ne,ge))})}return Je}function Re(Je,D,ne){return D in Je?Object.defineProperty(Je,D,{value:ne,enumerable:!0,configurable:!0,writable:!0}):Je[D]=ne,Je}(function(Je){Je.VERSION="v",Je.ORIGIN="o",Je.SESSION_NAME="s",Je.INFORMATION="i",Je.URI="u",Je.EMAIL="e",Je.PHONE="p",Je.CONNECTION="c",Je.BANDWIDTH="b",Je.TIME="t",Je.REPEAT="r",Je.ZONE_ADJUSTMENTS="z",Je.KEY="k",Je.ATTRIBUTE="a",Je.MEDIA="m"})(f||(f={}));class Ge{consumeText(D,ne){let ge=ne;for(;ge<D.length;){const ot=D[ge];if(ot==="\0"||ot==="\r"||ot===A)break;ge+=1}if(ge-ne==0)throw new Error("Invalid text, at ".concat(D));return ge}consumeUnicastAddress(D,ne,ge){return this.consumeTill(D,ne,p)}consumeOneOrMore(D,ne,ge){let ot=ne;for(;ge(D[ot]);)ot++;if(ot-ne==0)throw new Error("Invalid rule at ".concat(ne,"."));return ot}consumeSpace(D,ne){if(D[ne]===p)return ne+1;throw new Error("Invalid space at ".concat(ne,"."))}consumeIP4Address(D,ne){let ge=ne;for(let ot=0;ot<4;ot++)if(ge=this.consumeDecimalUChar(D,ge),ot!==3){if(D[ge]!==".")throw new Error("Invalid IP4 address.");ge++}return ge}consumeDecimalUChar(D,ne){let ge=ne;for(let os=0;os<3&&b(D[ge]);os++,ge++);if(ge-ne==0)throw new Error("Invalid decimal uchar.");const ot=parseInt(D.slice(ne,ge));if(ot>=0&&ot<=255)return ge;throw new Error("Invalid decimal uchar")}consumeIP6Address(D,ne){let ge=this.consumeHexpart(D,ne);return D[ge]===":"&&(ge+=1,ge=this.consumeIP4Address(D,ge)),ge}consumeHexpart(D,ne){let ge=ne;if(D[ge]===":"&&D[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(D,ge)}catch{}return ge}if(ge=this.consumeHexseq(D,ge),D[ge]===":"&&D[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(D,ge)}catch{}return ge}return ge}consumeHexseq(D,ne){let ge=ne;for(;ge=this.consumeHex4(D,ge),D[ge]===":"&&D[ge+1]!==":";)ge+=1;return ge}consumeHex4(D,ne){let ge=0;for(;ge<4;ge++)if(!((ot=D[ne+ge])>="0"&&ot<="9"||ot>="a"&&ot<="f"||ot>="A"&&ot<="F")){if(ge===0)throw new Error("Invalid hex 4");break}var ot;return ne+ge}consumeFQDN(D,ne){let ge=ne;for(;b(D[ge])||B(D[ge])||D[ge]==="-"||D[ge]===".";)ge+=1;if(ge-ne<4)throw new Error("Invalid FQDN");return ge}consumeExtnAddr(D,ne){return this.consumeOneOrMore(D,ne,_)}consumeMulticastAddress(D,ne,ge){switch(ge){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(D,ne);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(D,ne);default:try{return this.consumeFQDN(D,ne)}catch{return this.consumeExtnAddr(D,ne)}}}consumeIP6MulticastAddress(D,ne){const ge=this.consumeHexpart(D,ne);return D[ge]==="/"?this.consumeInteger(D,ge+1):ge}consumeIP4MulticastAddress(D,ne){let ge=ne+3;const ot=D.slice(ne,ge),os=parseInt(ot);if(os<224||os>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let yr=0;yr<3;yr++){if(D[ge]!==".")throw new Error("Invalid IP4 multicast address.");ge+=1,ge=this.consumeDecimalUChar(D,ge)}return D[ge]==="/"&&(ge+=1),ge=this.consumeTTL(D,ge),D[ge]==="/"&&(ge=this.consumeInteger(D,ge)),ge}consumeInteger(D,ne){if(!U(D[ne]))throw new Error("Invalid integer.");for(ne+=1;b(D[ne]);)ne+=1;return ne}consumeTTL(D,ne){if(D[ne]==="0")return ne+1;if(!U(D[ne]))throw new Error("Invalid TTL.");ne+=1;for(let ge=0;ge<2&&b(D[ne]);ge++)ne+=1;return ne}consumeToken(D,ne){return this.consumeOneOrMore(D,ne,C)}consumeTime(D,ne){let ge=ne;if(D[ge]==="0")return ge+1;for(U(D[ge])&&(ge+=1);b(D[ge]);)ge++;if(ge-ne<10)throw new Error("Invalid time");return ge}consumeAddress(D,ne){return this.consumeTill(D,ne,p)}consumeTypedTime(D,ne){let ge=ne;return ge=this.consumeOneOrMore(D,ge,b),j(D[ge])?ge+1:ge}consumeRepeatInterval(D,ne){if(!U(D[ne]))throw new Error("Invalid repeat interval");for(ne+=1;b(D[ne]);)ne+=1;return j(D[ne])&&(ne+=1),ne}consumePort(D,ne){return this.consumeOneOrMore(D,ne,b)}consume(D,ne,ge){for(let ot=0;ot<ge.length;ot++){if(ne+ot>=D.length)throw new Error("consume exceeding value length");if(D[ne+ot]!==ge[ot])throw new Error("consume ".concat(ge," failed at ").concat(ot))}return ne+ge.length}consumeTill(D,ne,ge){let ot=ne;for(;ot<D.length&&(typeof ge!="string"||D[ot]!==ge)&&(typeof ge!="function"||!ge(D[ot]));)ot++;return ot}}class Ze extends Ge{constructor(){super(),Re(this,"records",[]),Re(this,"currentLine",0)}parse(D){const ne=this.probeEOL(D);this.records=D.split(ne).filter(Ku=>!!da(Ku).call(Ku)).map(this.parseLine),this.currentLine=0;const ge=this.parseVersion(),ot=this.parseOrigin(),os=this.parseSessionName(),yr=this.parseInformation(),Wn=this.parseUri(),bc=this.parseEmail(),Gu=this.parsePhone(),T_=this.parseConnection(),Wf=this.parseBandWidth(),R_=this.parseTimeFields(),kp=this.parseKey(),vb=this.parseSessionAttribute(),Dp=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ge,origin:ot,sessionName:os,information:yr,uri:Wn,emails:bc,phones:Gu,connection:T_,bandwidths:Wf,timeFields:R_,key:kp,attributes:vb,mediaDescriptions:Dp}}getCurrentRecord(){const D=this.records[this.currentLine];if(!D)throw new Error("Record doesn't exit.");return D}probeEOL(D){for(let ne=0;ne<D.length;ne++)if(D[ne]===A)return D[ne-1]==="\r"?u:A;throw new Error("Invalid newline character.")}parseLine(D,ne){if(D.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ge=D[0];if(D[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ge,value:D.slice(2),line:ne,cur:0}}parseSessionAttribute(){const D=new ns;for(;this.currentLine<this.records.length;){const ne=this.getCurrentRecord();if(ne.type!==f.ATTRIBUTE)break;const ge={attField:this.extractOneOrMore(ne,ot=>C(ot)&&ot!==":"),_cur:0};ne.value[ne.cur]===":"&&(ne.cur+=1,ge.attValue=this.extractOneOrMore(ne,K)),D.parse(ge),this.currentLine++}return D.digest()}parseMediaAttributes(D){const ne=new Jt(D);for(;this.currentLine<this.records.length;){const ge=this.getCurrentRecord();if(ge.type!==f.ATTRIBUTE)break;const ot={attField:this.extractOneOrMore(ge,os=>C(os)&&os!==":"),_cur:0};ge.value[ge.cur]===":"&&(ge.cur+=1,ot.attValue=this.extractOneOrMore(ge,K)),ne.parse(ot),this.currentLine++}return ne.digest()}parseKey(){const D=this.getCurrentRecord();if(D.type===f.KEY){if(D.value==="prompt"||D.value==="clear:"||D.value==="base64:"||D.value==="uri:")return D.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const D=this.getCurrentRecord();if(D.type===f.ZONE_ADJUSTMENTS){const ne=[];for(;;)try{const ge=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);let ot=!1;D.value[D.cur]==="-"&&(ot=!0,D.cur+=1);const os=this.extract(D,this.consumeTypedTime);ne.push({time:ge,typedTime:os,back:ot})}catch{break}if(ne.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ne}return[]}parseRepeat(){const D=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==f.REPEAT)break;{const ge=this.extract(ne,this.consumeRepeatInterval),ot=this.parseTypedTime(ne);D.push({repeatInterval:ge,typedTimes:ot}),this.currentLine++}}return D}parseTypedTime(D){const ne=[];for(;;)try{this.consumeSpaceForRecord(D),ne.push(this.extract(D,this.consumeTypedTime))}catch{break}if(ne.length===0)throw new Error("Invalid typed time.");return ne}parseTime(){const D=this.getCurrentRecord(),ne=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);const ge=this.extract(D,this.consumeTime);return this.currentLine++,{startTime:ne,stopTime:ge}}parseBandWidth(){const D=[];for(;this.currentLine<this.records.length;){const ne=this.getCurrentRecord();if(ne.type!==f.BANDWIDTH)break;{const ge=this.extractOneOrMore(ne,C);if(ne.value[ne.cur]!==":")throw new Error("Invalid bandwidth field.");ne.cur++;const ot=this.extractOneOrMore(ne,b);D.push({bwtype:ge,bandwidth:ot}),this.currentLine++}}return D}parseVersion(){const D=this.getCurrentRecord();if(D.type!==f.VERSION)throw new Error("first sdp record must be version");const ne=D.value.slice(0,this.consumeOneOrMore(D.value,0,b));if(ne.length!==D.value.length)throw new Error('invalid proto version, "v='.concat(D.value,'"'));return this.currentLine++,ne}parseOrigin(){const D=this.getCurrentRecord();if(D.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");const ne=this.extractOneOrMore(D,_);this.consumeSpaceForRecord(D);const ge=this.extractOneOrMore(D,b);this.consumeSpaceForRecord(D);const ot=this.extractOneOrMore(D,b);this.consumeSpaceForRecord(D);const os=this.extractOneOrMore(D,C);this.consumeSpaceForRecord(D);const yr=this.extractOneOrMore(D,C);this.consumeSpaceForRecord(D);const Wn=this.extract(D,this.consumeUnicastAddress);return this.currentLine++,{username:ne,sessId:ge,sessVersion:ot,nettype:os,addrtype:yr,unicastAddress:Wn}}parseSessionName(){const D=this.getCurrentRecord();if(D.type===f.SESSION_NAME){const ne=this.extract(D,this.consumeText);return this.currentLine++,ne}}parseInformation(){const D=this.getCurrentRecord();if(D.type!==f.INFORMATION)return;const ne=this.extract(D,this.consumeText);return this.currentLine++,ne}parseUri(){const D=this.getCurrentRecord();if(D.type===f.URI)return this.currentLine++,D.value}parseEmail(){const D=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==f.EMAIL)break;D.push(ne.value),this.currentLine++}return D}parsePhone(){const D=[];for(;;){const ne=this.getCurrentRecord();if(ne.type!==f.PHONE)break;D.push(ne.value),this.currentLine++}return D}parseConnection(){const D=this.getCurrentRecord();if(D.type===f.CONNECTION){const ne=this.extractOneOrMore(D,C);this.consumeSpaceForRecord(D);const ge=this.extractOneOrMore(D,C);this.consumeSpaceForRecord(D);const ot=this.extract(D,this.consumeAddress);return this.currentLine++,{nettype:ne,addrtype:ge,address:ot}}}parseMedia(){const D=this.getCurrentRecord(),ne=this.extract(D,this.consumeToken);this.consumeSpaceForRecord(D);let ge=this.extract(D,this.consumePort);D.value[D.cur]==="/"&&(D.cur+=1,ge+=this.extract(D,this.consumeInteger)),this.consumeSpaceForRecord(D);const ot=[];for(ot.push(this.extract(D,this.consumeToken));D.value[D.cur]==="/";)D.cur+=1,ot.push(this.extract(D,this.consumeToken));if(ot.length===0)throw new Error("Invalid proto");const os=this.parseFmt(D);return this.currentLine++,{mediaType:ne,port:ge,protos:ot,fmts:os}}parseTimeFields(){const D=[];for(;this.getCurrentRecord().type===f.TIME;){const ne=this.parseTime(),ge=this.parseRepeat(),ot=this.parseZone();D.push({time:ne,repeats:ge,zones:ot})}return D}parseMediaDescription(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){const ne=this.parseMedia(),ge=this.parseInformation(),ot=this.parseConnections(),os=this.parseBandWidth(),yr=this.parseKey(),Wn=this.parseMediaAttributes(ne);D.push({media:ne,information:ge,connections:ot,bandwidths:os,key:yr,attributes:Wn})}return D}parseConnections(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)D.push(this.parseConnection());return D}parseFmt(D){const ne=[];for(;;)try{this.consumeSpaceForRecord(D),ne.push(this.extract(D,this.consumeToken))}catch{break}if(ne.length===0)throw new Error("Invalid fmts");return ne}extract(D,ne){for(var ge=arguments.length,ot=new Array(ge>2?ge-2:0),os=2;os<ge;os++)ot[os-2]=arguments[os];const yr=ne.call(this,D.value,D.cur,...ot),Wn=D.value.slice(D.cur,yr);return D.cur=yr,Wn}extractOneOrMore(D,ne){const ge=this.consumeOneOrMore(D.value,D.cur,ne),ot=D.value.slice(D.cur,ge);return D.cur=ge,ot}consumeSpaceForRecord(D){if(D.value[D.cur]!==p)throw new Error("Invalid space at ".concat(D.cur,"."));D.cur+=1}}class _t extends Ge{constructor(){super(...arguments),Re(this,"attributes",void 0),Re(this,"digested",!1)}extractOneOrMore(D,ne,ge){const ot=this.consumeOneOrMore(D.attValue,D._cur,ne),os=D.attValue.slice(D._cur,ot),[yr,Wn]=ge||[];if(typeof yr=="number"&&os.length<yr)throw new Error("error in length, should be more or equal than ".concat(yr," characters."));if(typeof Wn=="number"&&os.length>Wn)throw new Error("error in length, should be less or equal than ".concat(Wn," characters."));return D._cur=ot,os}consumeAttributeSpace(D){if(D.attValue[D._cur]!==p)throw new Error("Invalid space at ".concat(D._cur,"."));D._cur+=1}extract(D,ne){if(!D.attValue)throw new Error("Nothing to extract from attValue.");for(var ge=arguments.length,ot=new Array(ge>2?ge-2:0),os=2;os<ge;os++)ot[os-2]=arguments[os];const yr=ne.call(this,D.attValue,D._cur,...ot),Wn=D.attValue.slice(D._cur,yr);return D._cur=yr,Wn}atEnd(D){if(!D.attValue)throw new Error;return D._cur>=D.attValue.length}peekChar(D){if(!D.attValue)throw new Error;return D.attValue[D._cur]}peek(D,ne){if(!D.attValue)throw new Error;for(let ge=0;ge<ne.length;ge++)if(ne[ge]!==D.attValue[D._cur+ge])return!1;return!0}parseIceUfrag(D){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(D,q,[4,256])}parseIcePwd(D){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(D,q,[22,256])}parseIceOptions(D){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ne=[];for(;!this.atEnd(D);){ne.push(this.extractOneOrMore(D,q));try{this.consumeAttributeSpace(D)}catch(ge){if(this.atEnd(D))break;throw ge}}this.attributes.iceOptions=ne}parseFingerprint(D){const ne=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ge=this.extract(D,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ne,fingerprint:ge})}parseExtmap(D){const ne=this.extractOneOrMore(D,b);let ge;this.peekChar(D)==="/"&&(this.extract(D,this.consume,"/"),ge=this.extract(D,this.consumeToken)),this.consumeAttributeSpace(D);const ot=this.extract(D,this.consumeTill,p),os=ue(ue({entry:parseInt(ne,10)},ge&&{direction:ge}),{},{extensionName:ot});this.peekChar(D)===p&&(this.consumeAttributeSpace(D),os.extensionAttributes=this.extract(D,this.consumeTill)),this.attributes.extmaps.push(os)}parseSetup(D){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ne=this.extract(D,this.consumeTill);if(ne!=="active"&&ne!=="passive"&&ne!=="actpass"&&ne!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ne}}class ns extends _t{constructor(){super(...arguments),Re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"group":this.parseGroup(D);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"fingerprint":this.parseFingerprint(D);break;case"setup":this.parseSetup(D);break;case"tls-id":this.parseTlsId(D);break;case"identity":this.parseIdentity(D);break;case"extmap":this.parseExtmap(D);break;case"msid-semantic":this.parseMsidSemantic(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(ne){throw console.error("parsing session attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),ne}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(D){const ne=this.extract(D,this.consumeToken),ge=[];for(;!this.atEnd(D)&&this.peekChar(D)===p;)this.consumeAttributeSpace(D),ge.push(this.extract(D,this.consumeToken));this.attributes.groups.push({semantic:ne,identificationTag:ge})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(D){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(D,ie)}parseIdentity(D){const ne=this.extractOneOrMore(D,xe),ge=[];for(;!this.atEnd(D)&&this.peekChar(D)===p;){this.consumeAttributeSpace(D);const ot=this.extract(D,this.consumeToken);this.extract(D,this.consume,"=");const os=this.extractOneOrMore(D,yr=>yr!==p&&K(yr));ge.push({name:ot,value:os})}this.attributes.identities.push({assertionValue:ne,extensions:ge})}parseMsidSemantic(D){this.peekChar(D)===p&&this.consumeAttributeSpace(D);const ne={semantic:this.extract(D,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(D)}catch{break}if(this.peekChar(D)==="*"){this.extract(D,this.consume,"*"),ne.applyForAll=!0;break}{const ge=this.extract(D,this.consumeTill,p);ne.identifierList.push(ge)}}this.attributes.msidSemantic=ne}}class Jt extends _t{constructor(D){super(),Re(this,"attributes",void 0),D.protos.indexOf("RTP")!==-1||D.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"extmap":this.parseExtmap(D);break;case"setup":this.parseSetup(D);break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"candidate":this.parseCandidate(D);break;case"remote-candidate":this.parseRemoteCandidate(D);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(D);break;case"rtpmap":this.parseRtpmap(D);break;case"ptime":this.parsePtime(D);break;case"maxptime":this.parseMaxPtime(D);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(D);break;case"ssrc":this.parseSSRC(D);break;case"fmtp":this.parseFmtp(D);break;case"rtcp-fb":this.parseRtcpFb(D);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(D);break;case"mid":this.parseMid(D);break;case"msid":this.parseMsid(D);break;case"imageattr":this.parseImageAttr(D);break;case"rid":this.parseRid(D);break;case"simulcast":this.parseSimulcast(D);break;case"sctp-port":this.parseSctpPort(D);break;case"max-message-size":this.parseMaxMessageSize(D);break;case"ssrc-group":this.parseSSRCGroup(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(ne){throw console.error("parsing media attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),ne}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}parseCandidate(D){const ne=this.extractOneOrMore(D,q,[1,32]);this.consumeAttributeSpace(D);const ge=this.extractOneOrMore(D,b,[1,5]);this.consumeAttributeSpace(D);const ot=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const os=this.extractOneOrMore(D,b,[1,10]);this.consumeAttributeSpace(D);const yr=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const Wn=this.extract(D,this.consumePort);this.consumeAttributeSpace(D),this.extract(D,this.consume,"typ"),this.consumeAttributeSpace(D);const bc={foundation:ne,componentId:ge,transport:ot,priority:os,connectionAddress:yr,port:Wn,type:this.extract(D,this.consumeToken),extension:{}};for(this.peek(D," raddr")&&(this.extract(D,this.consume," raddr"),this.consumeAttributeSpace(D),bc.relAddr=this.extract(D,this.consumeAddress)),this.peek(D," rport")&&(this.extract(D,this.consume," rport"),this.consumeAttributeSpace(D),bc.relPort=this.extract(D,this.consumePort));this.peekChar(D)===p;){this.consumeAttributeSpace(D);const Gu=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D),bc.extension[Gu]=this.extractOneOrMore(D,w)}this.attributes.candidates.push(bc)}parseRemoteCandidate(D){const ne=[];for(;;){const ge=this.extractOneOrMore(D,b,[1,5]);this.consumeAttributeSpace(D);const ot=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const os=this.extract(D,this.consumePort);ne.push({componentId:ge,connectionAddress:ot,port:os});try{this.consumeAttributeSpace(D)}catch{break}}this.attributes.remoteCandidatesList.push(ne)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(D){const ne=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ge=this.extract(D,this.consumeTill,"/");this.extract(D,this.consume,"/");const ot={encodingName:ge,clockRate:this.extractOneOrMore(D,b)};this.atEnd(D)||this.peekChar(D)!=="/"||(this.extract(D,this.consume,"/"),ot.encodingParameters=parseInt(this.extract(D,this.consumeTill),10));const os=this.attributes.payloads.find(yr=>yr.payloadType===parseInt(ne,10));os?os.rtpMap=ot:this.attributes.payloads.push({payloadType:parseInt(ne,10),rtpMap:ot,rtcpFeedbacks:[]})}parsePtime(D){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(D,this.consumeTill)}parseMaxPtime(D){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(D,this.consumeTill)}parseDirection(D){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=D.attField}parseSSRC(D){const ne=this.extractOneOrMore(D,b);this.consumeAttributeSpace(D);const ge=this.extract(D,this.consumeTill,":");let ot;this.peekChar(D)===":"&&(this.extract(D,this.consume,":"),ot=this.extract(D,this.consumeTill));const os=this.attributes.ssrcs.find(yr=>yr.ssrcId===parseInt(ne,10));os?os.attributes[ge]=ot:this.attributes.ssrcs.push({ssrcId:parseInt(ne,10),attributes:{[ge]:ot}})}parseFmtp(D){const ne=this.extract(D,this.consumeTill,p);this.consumeAttributeSpace(D);const ge=this.extract(D,this.consumeTill),ot={};ge.split(";").forEach(yr=>{let[Wn,bc]=yr.split("=");Wn=da(Wn).call(Wn);const Gu=typeof bc=="string"?da(bc).call(bc):null;typeof Wn=="string"&&Wn.length>0&&(ot[Wn]=Gu)});const os=this.attributes.payloads.find(yr=>yr.payloadType===parseInt(ne,10));os?os.fmtp={parameters:ot}:this.attributes.payloads.push({payloadType:parseInt(ne,10),rtcpFeedbacks:[],fmtp:{parameters:ot}})}parseFmtParameters(D){const ne={},ge=this.extract(D,this.consumeTill,"=");D._cur++;const ot=this.extract(D,this.consumeTill,";");for(ne[ge]=ot;D.attValue[D._cur]===";";){const os=this.extract(D,this.consumeTill,"=");D._cur++;const yr=this.extract(D,this.consumeTill,";");ne[os]=yr}return ne}parseRtcpFb(D){let ne="";ne=this.peekChar(D)==="*"?this.extract(D,this.consume,"*"):this.extract(D,this.consumeTill,p),this.consumeAttributeSpace(D);const ge=this.extract(D,this.consumeTill,p);let ot;if(ge==="trr-int")ot={type:ge,interval:this.extract(D,this.consumeTill)};else{const os={type:ge};this.peekChar(D)===p&&(this.consumeAttributeSpace(D),os.parameter=this.extract(D,this.consumeToken),this.peekChar(D)===p&&(os.additional=this.extract(D,this.consumeTill))),ot=os}if(ne==="*")this.attributes.rtcpFeedbackWildcards.push(ot);else{const os=this.attributes.payloads.find(yr=>yr.payloadType===parseInt(ne,10));os?os.rtcpFeedbacks.push(ot):this.attributes.payloads.push({payloadType:parseInt(ne,10),rtcpFeedbacks:[ot]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(D){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ne={port:this.extract(D,this.consumePort)};this.peekChar(D)===p&&(this.consumeAttributeSpace(D),ne.netType=this.extractOneOrMore(D,C),this.consumeAttributeSpace(D),ne.addressType=this.extractOneOrMore(D,C),this.consumeAttributeSpace(D),ne.address=this.extract(D,this.consumeAddress)),this.attributes.rtcp=ne}parseMsid(D){const ne={id:this.extractOneOrMore(D,C,[1,64])};this.peekChar(D)===p&&(this.consumeAttributeSpace(D),ne.appdata=this.extractOneOrMore(D,C,[1,64])),this.attributes.msids.push(ne)}parseImageAttr(D){this.attributes.imageattr.push(D.attValue)}parseRid(D){const ne=this.extractOneOrMore(D,ot=>B(ot)||b(ot)||ot==="_"||ot==="-");this.consumeAttributeSpace(D);const ge={id:ne,direction:this.extract(D,this.consumeToken),params:[]};if(this.peekChar(D)===p){if(this.consumeAttributeSpace(D),this.peek(D,"pt=")){this.extract(D,this.consume,"pt=");const ot=[];for(;;){const os=this.extract(D,this.consumeToken);ot.push(os);try{this.extract(D,this.consume,",")}catch{break}}ge.payloads=ot,this.peekChar(D)===p&&this.extract(D,this.consume,p)}for(;;){const ot=this.extract(D,this.consumeToken);switch(ot){case"depend":{const os={type:ot,rids:this.extract(D,this.consume,"=").split(",")};ge.params.push(os);break}default:{const os={type:ot};this.peekChar(D)==="="&&(this.extract(D,this.consume,"="),os.val=this.extract(D,this.consumeTill,";")),ge.params.push(os)}}try{this.extract(D,this.consume,";")}catch{break}}}this.attributes.rids.push(ge)}parseSimulcast(D){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=D.attValue,this.extract(D,this.consumeTill)}parseSctpPort(D){this.attributes.sctpPort=this.extractOneOrMore(D,b,[1,5])}parseMaxMessageSize(D){this.attributes.maxMessageSize=this.extractOneOrMore(D,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(D){this.attributes.mid=this.extract(D,this.consumeToken)}parseSSRCGroup(D){const ne=this.extract(D,this.consumeToken),ge=[];for(;;)try{this.consumeAttributeSpace(D);const ot=this.extract(D,this.consumeInteger);ge.push(parseInt(ot,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ne,ssrcIds:ge})}}function bs(Je,D,ne){return D in Je?Object.defineProperty(Je,D,{value:ne,enumerable:!0,configurable:!0,writable:!0}):Je[D]=ne,Je}class As{constructor(){bs(this,"eol",u)}print(D,ne){let ge="";return ne&&(this.eol=ne),ge+=this.printVersion(D.version),ge+=this.printOrigin(D.origin),ge+=this.printSessionName(D.sessionName),ge+=this.printInformation(D.information),ge+=this.printUri(D.uri),ge+=this.printEmail(D.emails),ge+=this.printPhone(D.phones),ge+=this.printConnection(D.connection),ge+=this.printBandwidth(D.bandwidths),ge+=this.printTimeFields(D.timeFields),ge+=this.printKey(D.key),ge+=this.printSessionAttributes(D.attributes),ge+=this.printMediaDescription(D.mediaDescriptions),ge}printVersion(D){return"v=".concat(D).concat(this.eol)}printOrigin(D){return"o=".concat(D.username," ").concat(D.sessId," ").concat(D.sessVersion," ").concat(D.nettype," ").concat(D.addrtype," ").concat(D.unicastAddress).concat(this.eol)}printSessionName(D){return D?"s=".concat(D).concat(this.eol):""}printInformation(D){return D?"i=".concat(D).concat(this.eol):""}printUri(D){return D?"u=".concat(D).concat(this.eol):""}printEmail(D){let ne="";for(const ge of D)ne+="e=".concat(ge).concat(this.eol);return ne}printPhone(D){let ne="";for(const ge of D)ne+="e=".concat(ge).concat(this.eol);return ne}printConnection(D){return D?"c=".concat(D.nettype," ").concat(D.addrtype," ").concat(D.address).concat(this.eol):""}printBandwidth(D){let ne="";for(const ge of D)ne+="b=".concat(ge.bwtype,":").concat(ge.bandwidth).concat(this.eol);return ne}printTimeFields(D){let ne="";for(const ge of D){ne+="t=".concat(ge.time.startTime," ").concat(ge.time.startTime).concat(this.eol);for(const ot of ge.repeats)ne+="r=".concat(ot.repeatInterval," ").concat(ot.typedTimes.join(" ")).concat(this.eol);ge.zoneAdjustments&&(ne+="z=",ne+="z=".concat(ge.zoneAdjustments.map(ot=>"".concat(ot.time," ").concat(ot.back?"-":""," ").concat(ot.typedTime)).join(" ")).concat(this.eol),ne+=this.eol)}return ne}printKey(D){return D?"k=".concat(D).concat(this.eol):""}printAttributes(D){let ne="";for(const ge of D)ne+="a=".concat(ge.attField).concat(ge.attValue?":".concat(ge.attValue):"").concat(this.eol);return ne}printMediaDescription(D){let ne="";for(const ge of D)ne+=this.printMedia(ge.media),ne+=this.printInformation(ge.information),ne+=this.printConnections(ge.connections),ne+=this.printBandwidth(ge.bandwidths),ne+=this.printKey(ge.key),ne+=this.printMediaAttributes(ge);return ne}printConnections(D){let ne="";for(const ge of D)ne+=this.printConnection(ge);return ne}printMedia(D){return"m=".concat(D.mediaType," ").concat(D.port," ").concat(D.protos.join("/")," ").concat(D.fmts.join(" ")).concat(this.eol)}printSessionAttributes(D){return new Br(this.eol).print(D)}printMediaAttributes(D){return new qe(this.eol).print(D)}}class Xs{constructor(D){bs(this,"eol",void 0),this.eol=D}printIceUfrag(D){return D===void 0?"":"a=ice-ufrag:".concat(D).concat(this.eol)}printIcePwd(D){return D===void 0?"":"a=ice-pwd:".concat(D).concat(this.eol)}printIceOptions(D){return D===void 0?"":"a=ice-options:".concat(D.join(p)).concat(this.eol)}printFingerprints(D){return D.length>0?D.map(ne=>"a=fingerprint:".concat(ne.hashFunction).concat(p).concat(ne.fingerprint)).join(this.eol)+this.eol:""}printExtmap(D){return D.map(ne=>"a=extmap:".concat(ne.entry).concat(ne.direction?"/".concat(ne.direction):"").concat(p).concat(ne.extensionName).concat(ne.extensionAttributes?"".concat(p).concat(ne.extensionAttributes):"").concat(this.eol)).join("")}printSetup(D){return D===void 0?"":"a=setup:".concat(D).concat(this.eol)}printUnrecognized(D){return D.map(ne=>"a=".concat(ne.attField).concat(ne.attValue?":".concat(ne.attValue):"").concat(this.eol)).join("")}}class Br extends Xs{print(D){let ne="";return ne+=this.printGroups(D.groups),ne+=this.printMsidSemantic(D.msidSemantic),ne+=this.printIceLite(D.iceLite),ne+=this.printIceUfrag(D.iceUfrag),ne+=this.printIcePwd(D.icePwd),ne+=this.printIceOptions(D.iceOptions),ne+=this.printFingerprints(D.fingerprints),ne+=this.printSetup(D.setup),ne+=this.printTlsId(D.tlsId),ne+=this.printIdentity(D.identities),ne+=this.printExtmap(D.extmaps),ne+=this.printUnrecognized(D.unrecognized),ne}printGroups(D){let ne="";return D.length>0&&(ne+=D.map(ge=>"a=group:".concat(ge.semantic).concat(ge.identificationTag.map(ot=>"".concat(p).concat(ot)).join("")).concat(this.eol)).join("")),ne}printIceLite(D){return D===void 0?"":"a=ice-lite"+this.eol}printTlsId(D){return D?"a=tls-id:".concat(D).concat(this.eol):""}printIdentity(D){return D.length===0?"":D.map(ne=>"a=identity:".concat(ne.assertionValue).concat(ne.extensions.map(ge=>"".concat(p).concat(ge.name).concat(ge.value?"=".concat(ge.value):"")))).join(this.eol)+this.eol}printMsidSemantic(D){if(!D)return"";let ne="a=msid-semantic:".concat(D.semantic);return D.applyForAll?ne+="".concat(p,"*"):D.identifierList.length>0&&(ne+=D.identifierList.map(ge=>"".concat(p).concat(ge))),ne+this.eol}}class qe extends Xs{print(D){const ne=D.attributes;let ge="";return ge+=this.printRTCP(ne.rtcp),ge+=this.printIceUfrag(ne.iceUfrag),ge+=this.printIcePwd(ne.icePwd),ge+=this.printIceOptions(ne.iceOptions),ge+=this.printCandidates(ne.candidates),ge+=this.printRemoteCandidatesList(ne.remoteCandidatesList),ge+=this.printEndOfCandidates(ne.endOfCandidates),ge+=this.printFingerprints(ne.fingerprints),ge+=this.printSetup(ne.setup),ge+=this.printMid(ne.mid),ge+=this.printExtmap(ne.extmaps),ge+=this.printRTPRelated(ne),ge+=this.printPtime(ne.ptime),ge+=this.printMaxPtime(ne.maxPtime),ge+=this.printDirection(ne.direction),ge+=this.printSSRCGroups(ne.ssrcGroups),ge+=this.printSSRC(ne.ssrcs),ge+=this.printRTCPMux(ne.rtcpMux),ge+=this.printRTCPMuxOnly(ne.rtcpMuxOnly),ge+=this.printRTCPRsize(ne.rtcpRsize),ge+=this.printMSId(ne.msids),ge+=this.printImageattr(ne.imageattr),ge+=this.printRid(ne.rids),ge+=this.printSimulcast(ne.simulcast),ge+=this.printSCTPPort(ne.sctpPort),ge+=this.printMaxMessageSize(ne.maxMessageSize),ge+=this.printUnrecognized(ne.unrecognized),ge}printCandidates(D){return D.map(ne=>"a=candidate:".concat(ne.foundation).concat(p).concat(ne.componentId).concat(p).concat(ne.transport).concat(p).concat(ne.priority).concat(p).concat(ne.connectionAddress).concat(p).concat(ne.port).concat(p,"typ").concat(p).concat(ne.type).concat(ne.relAddr?"".concat(p,"raddr").concat(p).concat(ne.relAddr):"").concat(ne.relPort?"".concat(p,"rport").concat(p).concat(ne.relPort):"").concat(Object.keys(ne.extension).map(ge=>"".concat(p).concat(ge).concat(p).concat(ne.extension[ge])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(D){return D.map(ne=>"a=remote-candidates:".concat(ne.join(p)).concat(this.eol)).join("")}printEndOfCandidates(D){return D===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(D){if(!D.payloads)return"";const ne=D.payloads;let ge="";ge+=D.rtcpFeedbackWildcards.map(ot=>this.printRTCPFeedback("*",ot)).join("");for(const ot of ne)ge+=this.printRtpMap(ot.payloadType,ot.rtpMap),ge+=this.printFmtp(ot.payloadType,ot.fmtp),ge+=ot.rtcpFeedbacks.map(os=>this.printRTCPFeedback(ot.payloadType,os)).join("");return ge}printFmtp(D,ne){if(!ne)return"";const ge=Object.keys(ne.parameters);return ge.length===1&&ne.parameters[ge[0]]===null?"a=fmtp:".concat(D).concat(p).concat(ge[0]).concat(this.eol):"a=fmtp:".concat(D).concat(p).concat(Object.keys(ne.parameters).map(ot=>"".concat(ot,"=").concat(ne.parameters[ot])).join(";")).concat(this.eol)}printRtpMap(D,ne){return ne?"a=rtpmap:".concat(D).concat(p).concat(ne.encodingName,"/").concat(ne.clockRate).concat(ne.encodingParameters?"/".concat(ne.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(D,ne){let ge="a=rtcp-fb:".concat(D).concat(p),ot=ne;return ot.type==="trr-int"?ge+="ttr-int".concat(p).concat(ot.interval):(ge+="".concat(ot.type),ot.parameter&&(ge+="".concat(p).concat(ot.parameter),ot.additional&&(ge+="".concat(p).concat(ot.additional)))),ge+this.eol}printPtime(D){return D===void 0?"":"a=ptime:".concat(D).concat(this.eol)}printMaxPtime(D){return D===void 0?"":"a=maxptime:".concat(D).concat(this.eol)}printDirection(D){return D===void 0?"":"a=".concat(D).concat(this.eol)}printSSRC(D){return D.map(ne=>Object.keys(ne.attributes).map(ge=>"a=ssrc:".concat(ne.ssrcId.toString(10)).concat(p).concat(ge).concat(ne.attributes[ge]?":".concat(ne.attributes[ge]):"").concat(this.eol)).join("")).join("")}printRTCPMux(D){return D===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(D){return D===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(D){return D===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(D){if(D===void 0)return"";let ne="a=rtcp:".concat(D.port);return D.netType&&(ne+="".concat(p).concat(D.netType)),D.addressType&&(ne+="".concat(p).concat(D.addressType)),D.address&&(ne+="".concat(p).concat(D.address)),ne+this.eol}printMSId(D){return D.map(ne=>"a=msid:".concat(ne.id).concat(ne.appdata?"".concat(p).concat(ne.appdata):"").concat(this.eol)).join("")}printImageattr(D){return D.map(ne=>"a=imageattr:".concat(ne).concat(this.eol)).join("")}printRid(D){return D.map(ne=>{let ge="a=rid:".concat(ne.id).concat(p).concat(ne.direction);return ne.payloads&&(ge+="".concat(p,"pt=").concat(ne.payloads.join(","))),ne.params.length>0&&(ge+="".concat(p).concat(ne.params.map(ot=>ot.type==="depend"?"depend=".concat(ot.rids.join(",")):"".concat(ot.type,"=").concat(ot.val)).join(";"))),ge+this.eol}).join("")}printSimulcast(D){return D===void 0?"":"a=simulcast:".concat(D).concat(this.eol)}printSCTPPort(D){return D===void 0?"":"a=sctp-port:".concat(D).concat(this.eol)}printMaxMessageSize(D){return D===void 0?"":"a=max-message-size:".concat(D).concat(this.eol)}printMid(D){return D===void 0?"":"a=mid:".concat(D).concat(this.eol)}printSSRCGroups(D){return D.map(ne=>"a=ssrc-group:".concat(ne.semantic).concat(ne.ssrcIds.map(ge=>"".concat(p).concat(ge.toString(10))).join("")).concat(this.eol)).join("")}}function lt(Je){return new Ze().parse(Je)}function It(Je,D){return new As().print(Je,D)}}},t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,s),i.exports}return s.d=(r,i)=>{for(var l in i)s.o(i,l)&&!s.o(r,l)&&Object.defineProperty(r,l,{enumerable:!0,get:i[l]})},s.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),s.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},s(8)})();function ha(e){return uj.parse(e)}function CA(e,t){return uj.print(e,t)}var vZ=wi("Array","keys"),wZ=To,_Z=Un,yZ=k,EZ=vZ,G1=Array.prototype,SZ={DOMTokenList:!0,NodeList:!0},CZ=function(e){var t=e.keys;return e===G1||yZ(G1,e)&&t===G1.keys||_Z(SZ,wZ(e))?EZ:t},Wi=h(CZ);function zr(e,t,s){return(t=function(r){var i=function(l,A){if(typeof l!="object"||!l)return l;var u=l[Symbol.toPrimitive];if(u!==void 0){var p=u.call(l,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function hj(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function fs(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?hj(Object(s),!0).forEach(function(r){zr(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):hj(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function hw(e,t){return hw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,r){return s.__proto__=r,s},hw(e,t)}function K1(){K1=function(i,l){return new s(i,void 0,l)};var e=RegExp.prototype,t=new WeakMap;function s(i,l,A){var u=RegExp(i,l);return t.set(u,A||t.get(i)),hw(u,s.prototype)}function r(i,l){var A,u=t.get(l);return Fa(A=Object.keys(u)).call(A,function(p,f){var b=u[f];if(typeof b=="number")p[f]=i[b];else{for(var w=0;i[b[w]]===void 0&&w+1<b.length;)w++;p[f]=i[b[w]]}return p},Object.create(null))}return function(i,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(l&&l.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),l&&hw(i,l)}(s,RegExp),s.prototype.exec=function(i){var l=e.exec.call(this,i);if(l){l.groups=r(l,this);var A=l.indices;A&&(A.groups=r(A,this))}return l},s.prototype[Symbol.replace]=function(i,l){if(typeof l=="string"){var A=t.get(this);return e[Symbol.replace].call(this,i,l.replace(/\$<([^>]+)(>|$)/g,function(p,f,b){if(b==="")return p;var w=A[f];return Array.isArray(w)?"$"+w.join("$"):typeof w=="number"?"$"+w:""}))}if(typeof l=="function"){var u=this;return e[Symbol.replace].call(this,i,function(){var p=arguments;return typeof p[p.length-1]!="object"&&(p=[].slice.call(p)).push(r(p,u)),l.apply(this,p)})}return e[Symbol.replace].call(this,i,l)},K1.apply(this,arguments)}const pj=new class extends jr{constructor(){super(...arguments),zr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class NZ{constructor(t){zr(this,"logger",void 0),zr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];this.logger.debug(...this.prefixLists,...s)}info(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];this.logger.info(...this.prefixLists,...s)}warning(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];this.logger.warning(...this.prefixLists,...s)}error(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];this.logger.error(...this.prefixLists,...s)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function W1(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function mj(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const dc={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},pw=Date.now(),P0=e=>{for(const t in dc)if(Object.prototype.hasOwnProperty.call(dc,t)&&dc[t]===e)return t;return"DEFAULT"},N=new class{constructor(){zr(this,"proxyServerURL",void 0),zr(this,"logLevel",dc.DEBUG),zr(this,"uploadState","collecting"),zr(this,"uploadLogWaitingList",[]),zr(this,"uploadLogUploadingList",[]),zr(this,"uploadErrorCount",0),zr(this,"currentLogID",0),zr(this,"url",void 0),zr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[dc.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[dc.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[dc.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[dc.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[dc.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){pr("UPLOAD_LOG",!0)}disableLogUpload(){pr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new NZ(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-pw<100)return void setTimeout(()=>{this.log(...t)},Date.now()-pw);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=W1()+" Agora-SDK [".concat(P0(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=W1()+" %cAgora-SDK [".concat(P0(r),"]:");let l=[];if(!G("USE_NEW_LOG"))switch(r){case dc.DEBUG:l=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case dc.INFO:l=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case dc.WARNING:l=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case dc.ERROR:l=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-pw<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-pw);const r=Math.max(0,Math.min(4,t[0]));t[0]=W1()+" Agora-SDK [".concat(P0(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!G("UPLOAD_LOG"))return;for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];Array.isArray(s[0])?s[0][0]=mj()+" Agora-SDK [".concat(P0(e),"]:"):s[0]=mj()+" Agora-SDK [".concat(P0(e),"]:");let i="";s.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),i+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:lc,process_id:G("PROCESS_ID"),payload:JSON.stringify(e)};return kl(async()=>{const s=await Ta.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(G("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(G("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(s.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=s,r}},()=>(this.uploadLogUploadingList=[],!1),s=>{const r={status:-1,message:s.message,errorRange:e.map(i=>i.log_item_id)};return s.response?(r.status=s.response.status,r.data=s.response.data,r.headers=s.response.headers):s.request&&(r.status=s.request.status),pj.reportLogUploadError(r),!0},{timeout:G("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:G("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,G("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var fj;function TZ(e){return di(e.reportId,"params.reportId",0,100,!1),di(e.category,"params.category",0,100,!1),di(e.event,"params.event",0,100,!1),di(e.label,"params.label",0,100,!1),gr(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(fj={}).FREE="free",fj.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const RZ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Nn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Dr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let IZ=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Yt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,s,r){const i=r.value;if(typeof i=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var A,u=arguments.length,p=new Array(u),f=0;f<u;f++)p[f]=arguments[f];let b=p;if(e.argsMap)try{b=e.argsMap(this,...p)}catch(_){N.warning(_),b=[]}try{JSON.stringify(b)}catch{N.warning("arguments for method ".concat(l,".").concat(String(s)," not serializable for apiInvoke.")),b=[]}const w=(e.report||kt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((A=this.store)===null||A===void 0?void 0:A.clientId)||this._ID,name:"".concat(l,".").concat(String(s)),options:b,tag:br.TRACER,reportResult:e.reportResult},e.throttleTime);try{const _=i.apply(this,p);return _ instanceof mt?_.then(C=>(w.onSuccess(e.reportResult&&C),C)).catch(C=>{throw w.onError(C),C}):(w.onSuccess(e.reportResult&&_),_)}catch(_){throw w.onError(_),_}}}return r}}const kt=new class{constructor(){zr(this,"baseInfoMap",new Map),zr(this,"proxyServer",void 0),zr(this,"eventUploadTimer",void 0),zr(this,"setSessionIdTimer",void 0),zr(this,"url",void 0),zr(this,"sids",new Set),zr(this,"backupUrl",void 0),zr(this,"_appId",void 0),zr(this,"_aid",0),zr(this,"keyEventUploadPendingItems",[]),zr(this,"normalEventUploadPendingItems",[]),zr(this,"apiInvokeUploadPendingItems",[]),zr(this,"apiInvokeCount",0),zr(this,"apiInvokeLoggedCount",0),zr(this,"ltsList",[]),zr(this,"lastSendNormalEventTime",Date.now()),zr(this,"customReportCounterTimer",void 0),zr(this,"customReportCount",0),zr(this,"extApiInvoke",async e=>{for(const t of e){const s=fs(fs({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:br.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),G("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),G("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[s,r]=t;return s+r}),16)||0}reportApiInvoke(e,t,s){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,l=!!G("SHOW_REPORT_INVOKER_LOG"),A=!!G("SHOW_REPORT_USER_INVOKER_LOG"),u=l||A&&t.id;u&&(this.apiInvokeLoggedCount+=1);const p=this.apiInvokeLoggedCount;function f(C,U){if(u){let B="[apiInvoke-".concat(p,"]");if(t.id&&(B+="[".concat(t.id,"]")),t.name&&(B+="[".concat(t.name,"]"),t.name===kr.JOIN))return N.info("".concat(B," ").concat(C));N.info("".concat(B," ").concat(C),C==="start"?t.options:U||"")}}const b=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});f("start");let w=!1;Qn(t.timeout).then(()=>{w||(this.sendApiInvoke(fs(fs({},b()),{},{error:W.API_INVOKE_TIMEOUT,success:!1})),f("timeout"))});const _=new Me(W.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:C=>{const U=()=>{if(w)throw _;return w=!0,this.sendApiInvoke(fs(fs({},b()),{},{success:!0},t.reportResult&&{result:C})),f("onSuccess"),C};return s?XL(U,t.name+"Success",s,()=>w=!0):U()},onError:C=>{const U=()=>{if(w)throw C;w=!0,this.sendApiInvoke(fs(fs({},b()),{},{success:!1,error:C})),f("onFailure",C.toString())};return s?XL(U,t.name+"Error",s,()=>w=!0):U()}}}_send(e,t,s){this.send({type:e,data:t},s)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const s=Date.now(),r=this.createBaseInfo(e,s);r.cname=t.cname,r.rteUrl=t.rteUrl;const i=Object.assign({},{willUploadConsoleLog:G("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:M1?"global":"oversea",areas:G("AREAS")&&G("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:A,channelMode:u,isABTestSuccess:p,lsid:f,clientRole:b}=t,w=Date.now(),_=fs(fs({},r),{},{eventType:Nn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Q1,lts:w,elapse:w-s,extend:JSON.stringify(i),mode:t.mode,process:G("PROCESS_ID"),appType:G("APP_TYPE"),success:!0,version:lc,stringUid:l,channelProfile:A,channelMode:u,isABTestSuccess:p,lsid:f,clientType:nt(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:b,serviceId:G("PROCESS_ID"),extensionID:G("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var C;this.send({type:Dr.SESSION,data:_},!0)}reportRteDetail(e){const t=this.baseInfoMap.get(e);if(!t)return;const s=t.info,r=Date.now(),i=fs(fs({},s),{},{eventType:Nn.RTE_DETAIL,lts:r,success:!0,elapse:r-t.startTime,vid:s.vid===void 0?0:Number(s.vid),ua:navigator.userAgent});this.send({type:Dr.RTE_DETAIL,data:i},!0)}joinChooseServer(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info;t.vid&&(r.vid=t.vid);const i=Date.now(),l=fs(fs({},r),{},{role:t.role,eventType:Nn.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-s.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Dr.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs({},r),{},{eventType:Nn.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-s.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Dr.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:l,addr:A,isProxy:u}=t,p=i-s.startTime,f=fs(fs({},r),{},{eventType:Nn.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:p,eventElapse:i-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:F1(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:u?1:0}),b=f.success?1:0;if(t.succ&&(s.lastJoinSuccessTime=i),A)if(f.signalChannel==="1"){const w=K1(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),_=A.match(w);f.gatewayIp=_&&_.groups?_.groups.ip:"",f.gatewayPort=_&&_.groups?_.groups.port:""}else if(u){const w=A.match(/h=(\d{1,3}-){3}\d{1,3}/g),_=A.match(/p=[0-9]{1,6}/g);f.gatewayIp=w&&w.length?w[0].split("=")[1].replace(/-/g,"."):"",f.gatewayPort=_&&_.length?_[0].split("=")[1]:""}else{const w=A.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),_=A.match(/(:|p=)[0-9]{1,6}/g);f.gatewayIp=w&&w.length?w[0].split("//")[1].replace(/-/g,"."):"",f.gatewayPort=_&&_.length?_[0].split(/:|p=/g)[1]:""}if(l)this.send({type:Dr.JOIN_GATEWAY,data:f},!0);else{let w={isSuccess:b,port:f.gatewayPort};delete f.success,delete f.eventType,delete f.firstSuccess,delete f.gatewayPort,f.vid=Number(f.vid);const _=Object.assign({},f,w,{eventType:Nn.REJOIN_GATEWAY});this.send({type:Dr.RE_JOIN_GATEWAY,data:_},!0)}}joinChannelTimeout(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=Date.now(),i=fs(fs({},s.info),{},{lts:r,timeout:t,elapse:r-s.startTime});this.send({type:Dr.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs({},r),{},{eventType:Nn.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-s.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Dr.PUBLISH,data:l},!0)}subscribe(e,t,s){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,l=Date.now(),A=fs(fs({},i),{},{eventType:Nn.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?A.peerSuid=t.peerid:A.peer=t.peerid,this.send({type:Dr.SUBSCRIBE,data:A},!0)}wsCompressorInit(e){var t;const s=[...Wi(t=this.baseInfoMap).call(t)],r=s.length?s[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const l=i.info,A=Date.now(),u=fs(fs({},l),{},{eventType:Nn.WS_COMPRESSOR_INIT,lts:A,eventElapse:e.eventElapse,elapse:A-i.startTime,status:e.status?1:2});this.send({type:Dr.WS_COMPRESSOR_INIT,data:u},!0)}firstXLAPeerFirstVideoFrame(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=t.peerPubStatusMs-(s.lastJoinSuccessTime||i),A=fs(fs({},r),{},{elapse:i-s.startTime,eventType:Nn.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:l,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>l?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:Dr.XLA_PEER_FIRST_VIDEO_FRAME,data:A},!0)}firstRemoteVideoDecode(e,t,s,r){const i=this.baseInfoMap.get(e);if(!i)return;const l=i.info,A=Date.now(),u=fs(fs(fs({},l),r),{},{elapse:A-i.startTime,eventType:t,lts:A,firstDecodeFrame:Math.max((r.firstFrame||A)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:s,data:u},!0)}firstRemoteFrame(e,t,s,r){const i=this.baseInfoMap.get(e);if(!i)return;const l=i.info,A=Date.now(),u=fs(fs(fs({},l),r),{},{elapse:A-i.startTime,eventType:t,lts:A});this.send({type:s,data:u},!0)}abTest(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs(fs({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-s.startTime,eventType:Nn.AB_TEST,lts:i});this.send({type:Dr.AB_TEST,data:l},!0)}pcStats(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs(fs({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-s.startTime,eventType:Nn.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:Dr.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs(fs({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:Nn.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Dr.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,s,r){const i=this.baseInfoMap.get(e);if(!i)return;const l=i.info,A=Date.now(),u=fs(fs(fs({},l),r),{},{eventType:t,lts:A});this.send({type:s,data:u},!0)}streamSwitch(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs({},r),{},{eventType:Nn.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-s.startTime,success:t.succ});this.send({type:Dr.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs({},r),{},{eventType:Nn.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-s.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Dr.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs({},r),{},{eventType:Nn.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-s.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Dr.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?N.debug("reportProxyServerurl: ".concat(e)):N.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-s.startTime,joinChannelSuccessElapse:i-(s.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Dr.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now();(function(l,A,u){const p=l[A];if(!p||typeof p!="string")return[l];l[A]="";const f=Cd(JSON.stringify(l));let b=0;const w=[];let _=0;for(let C=0;C<p.length;C++)_+=p.charCodeAt(C)<=127?1:3,_<=u-f||(w[w.length]=ct(ct({},l),{},{[A]:p.substring(b,C)}),b=C,_=p.charCodeAt(C)<=127?1:3);return b!==p.length-1&&(w[w.length]=ct(ct({},l),{},{[A]:p.substring(b)})),w})(fs(fs(fs({},r),t),{},{elapse:i-s.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:Dr.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs(fs({},r),t),{},{elapse:i-s.startTime,lts:i});this.send({type:Dr.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs(fs({},r),t),{},{elapse:i-s.startTime,lts:i,extend:t.extend||void 0});this.send({type:Dr.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=fs(fs(fs({},r),t),{},{elapse:i-s.startTime,lts:i});this.send({type:Dr.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>G("CUSTOM_REPORT_LIMIT"))throw new Me(W.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),r=t.map(i=>({type:Dr.USER_ANALYTICS,data:fs(fs({sid:e},i),{},{lts:s})}));try{G("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw N.error("send custom report message failed",i.toString()),new Me(W.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=G("NOT_REPORT_EVENT");if(e.tag&&nt(t)&&nt(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const s=this.baseInfoMap.get(e.sid);if(!s)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:l}=s.info;let A;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Me){const{code:p,message:f}=e.error;A=p||f||e.error.toString()}else A=e.error.toString();const u={invokeId:e.invokeId,sid:e.sid,cname:r,cid:l,uid:i,lts:e.lts,success:e.success,elapse:e.lts-s.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?A:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Dr.API_INVOKE,data:u},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(s=>s!==null);t&&e.forEach(s=>{s&&(s.sid=t,this.sendApiInvoke(Object.assign({},s)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const s=[],r=[];for(;e.length;){const l=e.shift();s.length<20?s.push(l):r.push(l)}e.push(...r);for(const l of[...s]){var i;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),Kh(i=this.ltsList).call(i,(A,u)=>A-u))}return t||(this.lastSendNormalEventTime=Date.now()),G("ENABLE_EVENT_REPORT")&&s.length&&(G("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((l=>A=>{G("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-G("NORMAL_EVENT_QUEUE_CAPACITY")),N.warning("report: drop normal events"))))})(s)),e}async postDataToStatsCollector2(e){Wr.networkState===ua.OFFLINE&&await mt.race([Wr.onlineWaiter,Qn(2*pn.maxRetryTimeout)]);const t=i=>{let l=new Uint8Array;return i.forEach(A=>{const u=S1(JSON.stringify(A.data)),p=new ArrayBuffer(5),f=(w=>{let _=0;return Object.entries(Dr).forEach(C=>{let[U,B]=C;B===w.type&&(_=IZ[U])}),_})(A),b=new DataView(p);b.setUint16(0,u.byteLength,!0),b.setUint8(2,255&f),b.setUint8(3,f>>>8&255),b.setUint8(4,f>>>16&255),l=ML(l,new Uint8Array(p)),l=ML(l,u)}),l},s="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await L1(r,{timeout:1e4,data:t(e),headers:fs(fs({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(i===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(u=>{const p=u&&u.data.sid&&this.baseInfoMap.get(u.data.sid);return p&&p.info.vid&&+p.info.vid||0})(e[0]),r=s?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(u=>JSON.stringify(u)),vid:s,aid:r};Wr.networkState===ua.OFFLINE&&await mt.race([Wr.onlineWaiter,Qn(2*pn.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let A=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(G("EVENT_REPORT_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(l));for(let u=0;u<2;u+=1){u===1&&(A=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(G("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(l)));try{t?await mZ(A,{timeout:1e4,data:i}):await L1(A,{timeout:1e4,data:i})}catch(p){if(u===1)throw p;continue}return}}createBaseInfo(e,t){const s=Object.assign({},RZ);return s.sid=e,this.baseInfoMap.set(e,{info:s,startTime:t}),s}reportResourceTiming(e,t){const s=performance.getEntriesByName(e),r=s[s.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:br.TRACER}).onSuccess()}};pj.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Wr.networkState,kt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:br.TRACER}).onSuccess("logUploadError")});let Le=class extends Me{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),zr(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,N)}throw(){super.throw(N)}};const Hn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function Ls(){return Hn}function gj(){return"setSinkId"in HTMLAudioElement.prototype&&(!G("RESTRICTION_SET_PLAYBACK_DEVICE")||(EA()||SL())&&!BL())}function mw(){return!Hn.supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Sd()}function U0(e){return!(Tr()||CL(87)||mw()||!G("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}function bj(e){return G("ENABLE_INSTANT_VIDEO")?G("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB"))}function xj(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function vj(){if(xj()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return Ol(141)||Su(141)||ep(141)}function wj(){if(xj()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return Ol(141)||Su(141)||ep(125)}let Ai=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function mf(e,t,s){return{sampleRate:e,stereo:t,bitrate:s}}function qs(e,t,s,r,i){return{width:e,height:t,frameRate:s,bitrateMin:r,bitrateMax:i}}function Gc(e,t,s,r,i){return{width:{max:e},height:{max:t},frameRate:s,bitrateMin:r,bitrateMax:i}}function z1(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const OZ={"90p":qs(160,90),"90p_1":qs(160,90),"120p":qs(160,120,15,30,65),"120p_1":qs(160,120,15,30,65),"120p_3":qs(120,120,15,30,50),"120p_4":qs(212,120),"180p":qs(320,180,15,30,140),"180p_1":qs(320,180,15,30,140),"180p_3":qs(180,180,15,30,100),"180p_4":qs(240,180,15,30,120),"240p":qs(320,240,15,40,200),"240p_1":qs(320,240,15,40,200),"240p_3":qs(240,240,15,40,140),"240p_4":qs(424,240,15,40,220),"360p":qs(640,360,15,80,400),"360p_1":qs(640,360,15,80,400),"360p_3":qs(360,360,15,80,260),"360p_4":qs(640,360,30,80,600),"360p_6":qs(360,360,30,80,400),"360p_7":qs(480,360,15,80,320),"360p_8":qs(480,360,30,80,490),"360p_9":qs(640,360,15,80,800),"360p_10":qs(640,360,24,80,800),"360p_11":qs(640,360,24,80,1e3),"480p":qs(640,480,15,100,500),"480p_1":qs(640,480,15,100,500),"480p_2":qs(640,480,30,100,1e3),"480p_3":qs(480,480,15,100,400),"480p_4":qs(640,480,30,100,750),"480p_6":qs(480,480,30,100,600),"480p_8":qs(848,480,15,100,610),"480p_9":qs(848,480,30,100,930),"480p_10":qs(640,480,10,100,400),"720p":qs(1280,720,15,120,1130),"720p_auto":qs(1280,720,30,900,3e3),"720p_1":qs(1280,720,15,120,1130),"720p_2":qs(1280,720,30,120,2e3),"720p_3":qs(1280,720,30,120,1710),"720p_5":qs(960,720,15,120,910),"720p_6":qs(960,720,30,120,1380),"1080p":qs(1920,1080,15,120,2080),"1080p_1":qs(1920,1080,15,120,2080),"1080p_2":qs(1920,1080,30,120,3e3),"1080p_3":qs(1920,1080,30,120,3150),"1080p_5":qs(1920,1080,60,120,4780),"1440p":qs(2560,1440,30,120,4850),"1440p_1":qs(2560,1440,30,120,4850),"1440p_2":qs(2560,1440,60,120,7350),"4k":qs(3840,2160,30,120,8910),"4k_1":qs(3840,2160,30,120,8910),"4k_3":qs(3840,2160,60,120,13500)},kZ={"480p":Gc(640,480,5),"480p_1":Gc(640,480,5),"480p_2":Gc(640,480,30),"480p_3":Gc(640,480,15),"720p":Gc(1280,720,5),"720p_auto":qs(1280,720,30,900,3e3),"720p_1":Gc(1280,720,5),"720p_2":Gc(1280,720,30),"720p_3":Gc(1280,720,15),"1080p":Gc(1920,1080,5),"1080p_1":Gc(1920,1080,5),"1080p_2":Gc(1920,1080,30),"1080p_3":Gc(1920,1080,15)},DZ={"1SL1TL":z1(1,1),"3SL3TL":z1(3,3),"2SL3TL":z1(2,3)};function Kc(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},OZ[e]):e}function q1(e){return typeof e=="string"?Object.assign({},kZ[e]):e}function fw(e){return typeof e=="string"?Object.assign({},DZ[e]):e}const BZ={speech_low_quality:mf(16e3,!1),speech_standard:mf(32e3,!1,18),music_standard:mf(48e3,!1),standard_stereo:mf(48e3,!0,56),high_quality:mf(48e3,!1,128),high_quality_stereo:mf(48e3,!0,192)};function gw(e){return typeof e=="string"?Object.assign({},BZ[e]):e}const lp=[];function _j(e){return hn(e,"mediaSource",["screen","window","application"]),!0}let Bt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),rr=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),ff=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),LZ=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),jZ=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),dp=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),gf=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Ac=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),bf=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),jo=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const Y1={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},X1={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},yj={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},PZ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Ej={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let pa=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Po=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),F0=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Ap=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Di=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Nd=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const J1={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let bw=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Vs(e,t,s,r,i){var l,A,u={};return Object.keys(r).forEach(function(p){u[p]=r[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Fa(l=ym(A=s.slice()).call(A)).call(l,function(p,f){return f(e,t,p)||p},u),i&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(i):void 0,u.initializer=void 0),u.initializer===void 0?(Object.defineProperty(e,t,u),null):u}function Pe(e,t,s){return(t=function(r){var i=function(l,A){if(typeof l!="object"||!l)return l;var u=l[Symbol.toPrimitive];if(u!==void 0){var p=u.call(l,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Sj(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Er(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Sj(Object(s),!0).forEach(function(r){Pe(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Sj(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class Cj extends jr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(dp.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||ar(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){nt(lp).call(lp,r)||lp.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Cu(()=>{var s;kt.reportApiInvoke(null,{name:kr.GET_MEDIA_STREAM_TRACK,options:[],tag:br.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===ff.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const s=lp.indexOf(t);s!==-1&&lp.splice(s,1)}(this),this.emit(gf.CLOSED),this.removeAllListeners(dp.SEI_RECEIVED)}_updateRtpTransceiver(t,s){if(s===ff.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(dp.TRANSCEIVER_UPDATED,t,s)}}class xf extends Cj{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,s){super(t,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new $n("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,s;return(t=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,N.debug("[".concat(this.getTrackId(),"] close")),this.emit(Bt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,s){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wr(this,Bt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(gf.TRACK_ENDED)}stateCheck(t,s){if(N.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(s,"]")),Vc(s,t),this._enabled&&this._muted&&t==="enabled"&&s===!1)throw new Me(W.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",N);if(!this._enabled&&!this._muted&&t==="muted"&&s===!0)throw new Me(W.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",N)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():mt.resolve([])}}const Nj=window.AudioContext||window.webkitAudioContext;let $1,Uo=null;const mr=new class extends jr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{N.info("ios15-interruption-start"),this.emit(Ai.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{N.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?N.info("ios15-interruption-end-canceled"):(Uo&&await Uo.suspend(),this.emit(Ai.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){N.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){N.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function vf(){if(!Uo){if(function(){if(!Nj)return void N.error("your browser is not support web audio");N.info("create audio context");const e=Er({},G("WEBAUDIO_INIT_OPTIONS"));N.debug("audio context init option:",JSON.stringify(e)),Uo=new Nj(e),mr.curState=Uo.state,Uo.onstatechange=()=>{mr.prevState=mr.curState,mr.curState=Uo?Uo.state:void 0;const{prevState:t,curState:s}=mr,r=s==="running",i=s==="interrupted",l=t==="running",A=t==="suspended",u=t==="interrupted",p=zs().osVersion;(Ki()||Mc())&&l&&i&&(N.info("ios".concat(p,"-interruption-start")),mr.emit(Ai.IOS_INTERRUPTION_START)),(Ki()||Mc())&&(A||u)&&r&&(N.info("ios".concat(p,"-interruption-end")),mr.emit(Ai.IOS_INTERRUPTION_END)),t!==s&&mr.emit(Ai.STATE_CHANGE,s,t)},setInterval(()=>{var t;const s=(t=Uo)===null||t===void 0?void 0:t.currentTime;mr.currentTime!==s?(mr.currentTimeStuckAt&&(N.debug("AudioContext current time resume at ".concat(s)),mr.currentTimeStuckAt=void 0),mr.currentTime=s):(s!==mr.currentTimeStuckAt&&(kt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:br.TRACER}).onSuccess(),N.warning("AudioContext current time stuck at ".concat(s))),mr.currentTimeStuckAt=s)},5e3),async function(t){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i,l=!1,A=!1,u=!1;function p(K){t.state==="running"?f(!1):Ki()||Mc()?t.state==="suspended"&&(f(!0),K&&t.resume().then(b,b)):t.state!=="closed"&&(f(!0),K&&t.resume().then(b,b))}function f(K){if(l!==K){l=K;for(let q=0,ie=s;q<ie.length;q+=1){const xe=ie[q];K?window.addEventListener(xe,w,{capture:!0,passive:!0}):window.removeEventListener(xe,w,{capture:!0,passive:!0})}}}function b(){p(!1)}function w(){p(!0)}function _(){let K;try{K=r.play(),K?K.then(B,B):(r.addEventListener("playing",B),r.addEventListener("abort",B),r.addEventListener("error",B))}catch{B()}}function C(K){u||(r.paused?K?(U(!1),u=!0,_()):U(!0):U(!1))}function U(K){if(A!==K){A=K;for(let q=0,ie=s;q<ie.length;q++){const xe=ie[q];K?window.addEventListener(xe,j,{capture:!0,passive:!0}):window.removeEventListener(xe,j,{capture:!0,passive:!0})}}}function B(){r.removeEventListener("playing",B),r.removeEventListener("abort",B),r.removeEventListener("error",B),u=!1,C(!1)}function j(){C(!0)}if(Ki()&&G("IOS_BG_TAG")){const K=t.createMediaStreamDestination(),q=document.createElement("div");q.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=q.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=K.stream,i=()=>{if(G("IOS_AUTO_RESTART_BG_TAG")&&r&&r.srcObject&&!u&&(!r.paused||A!==!0)){r.paused||r.pause();try{u=!0,_()}catch{u=!1}return!0}},C(!0)}return mr.on(Ai.STATE_CHANGE,function(){p(!0)}),p(!1),i}(Uo).then(t=>{$1=t})}(),!Uo)throw new Me(W.NOT_SUPPORTED,"can not create audio context");return Uo}return Uo}function up(e){if(function(){if(Z1!==null)return Z1;const r=vf(),i=r.createBufferSource(),l=r.createGain(),A=r.createGain();i.connect(l),i.connect(A),i.disconnect(l);let u=!1;try{i.disconnect(l)}catch{u=!0}return i.disconnect(),Z1=u,u}())return;const t=e.connect,s=e.disconnect;e.connect=(r,i,l)=>{var A;return e._inputNodes||(e._inputNodes=[]),nt(A=e._inputNodes).call(A,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,l)):t.call(e,r,i)),e},e.disconnect=(r,i,l)=>{s.call(e),r?iw(e._inputNodes,r):e._inputNodes=[];for(const A of e._inputNodes)t.call(e,A)}}let Z1=null;function eN(e,t){let s=!1;const r=1/t;if(G("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{s?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=vf();let l=i.createGain();l.gain.value=0,l.connect(i.destination);const A=()=>{if(s)return void(l=null);const u=i.createOscillator();u.onended=A,u.connect(l),u.start(0),u.stop(i.currentTime+r),e(i.currentTime)};A()}return()=>{s=!0}}class Tj{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=vf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ki()||Mc()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const s=Fa(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,s;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{N.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Rj extends jr{get processSourceNode(){return this.sourceNode}set processedNode(t){var s;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=vf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),up(this.outputNode),this.volumeLevelAnalyser=new Tj}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(jo.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const l=r.outputBuffer.getChannelData(i);for(let A=0;A<l.length;A+=1)l[A]=0}return r.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ls().webAudioMediaStreamDest)throw new Me(W.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&aw(()=>{mr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ki()||Mc()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let r;s.getFloatTimeDomainData?(r=new Float32Array(s.fftSize),s.getFloatTimeDomainData(r)):(r=new Uint8Array(s.fftSize),s.getByteTimeDomainData(r));let i=!1;for(let l=0;l<r.length;l++)r[l]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Qn(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,s;(t=this.processedNode)===null||t===void 0||t.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class tN extends Rj{get isFreeze(){return!1}constructor(t,s,r){var i;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(N.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void N.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>N.info("resume success")),N.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;const p=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(p),up(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),up(this.outputNode),this.emit(jo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=p,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Me(W.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(l),up(this.sourceNode),r){const u=r.clone();u.enabled=!0,this.clonedTrack=u,N.debug("create an unmuted track ".concat(u.id," from the original track ").concat(r.id," to get the volume"));const p=this.context.createMediaStreamSource(new MediaStream([u]));up(p),this.originVolumeLevelAnalyser=new Tj,this.originVolumeLevelAnalyser.updateSource(p)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const A=zs();s&&A.os===Vn.IOS&&Number((i=A.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(mr.on(Ai.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const s=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(s),up(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(jo.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),mr.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const s=t.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),N.debug("create an unmuted track ".concat(s.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([s]));up(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Ij(e,t,s){const r=(l,A)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||A:l:A,i={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function UZ(e,t){const s=await Oj(e.mediaSource),{sourceId:r,audio:i}=await function(l){let A=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new mt((u,p)=>{const f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const U=document.createElement("button");U.innerHTML="cancel",U.setAttribute("style","width: 85px;"),U.onclick=()=>{document.body.removeChild(K);const q=new Error("NotAllowedError");q.name="NotAllowedError",p(q)};let B=A;const j=document.createElement("div");if(A){const q=document.createElement("input");q.setAttribute("type","checkbox");const ie=document.createElement("span");q.setAttribute("style","margin-right: 6px;"),ie.innerText="Share audio",q.checked=B,q.onchange=()=>{B=q.checked},j.appendChild(q),j.appendChild(ie)}C.appendChild(j),C.appendChild(U),b.appendChild(w),b.appendChild(_),b.appendChild(C);const K=document.createElement("div");K.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),K.appendChild(f),K.appendChild(b),document.body.appendChild(K),l.map(q=>{if(q.id){const ie=document.createElement("div");ie.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let xe=q.thumbnail;try{const{width:ye}=xe.getSize();ye>1920&&(xe=xe.resize({width:1920}))}catch(ye){throw ye&&ye.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ye}ie.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+xe.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+q.name.replace(/[\u00A0-\u9999<>\&]/g,function(ye){return"&#"+ye.charCodeAt(0)+";"})+"</span>",ie.onclick=()=>{document.body.removeChild(K),u({sourceId:q.id,audio:B})},_.appendChild(ie)}})})}(s,t);return await Ij(r,e,i)}async function Oj(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const s=VL();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Me(W.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=s.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new mt((l,A)=>{s.desktopCapturer.getSources({types:t},(u,p)=>{u?A(u):l(p)})}));try{return await r}catch(l){throw new Me(W.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const sN=new $n("safari");let kj=!1,Dj=!1;async function Fo(e,t){let s=0,r=null;for(;s<2;)try{r=await FZ(e,t,s>0);break}catch(i){if(i instanceof Me)throw N.error("[".concat(t,"] ").concat(i.toString())),i;const l=xw(i.name||i.code||i,i.message);if(l.code===W.MEDIA_OPTION_INVALID){N.debug("[".concat(t,"] detect media option invalid, retry")),s+=1,await Qn(500);continue}throw N.error("[".concat(t,"] ").concat(l.toString())),l}if(!r)throw new Me(W.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function FZ(e,t,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Me(W.NOT_SUPPORTED,"can not find getUserMedia");s&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ls(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return N.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(VL())e.screen.sourceId?wf(i,await Ij(e.screen.sourceId,e.screen,!!e.screenAudio)):wf(i,await UZ(e.screen,!!e.screenAudio));else if(EA()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new Me(W.NOT_SUPPORTED,"This browser does not support screen sharing");N.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const _=await(A=e.screen.extensionId,u=t,new mt((C,U)=>{try{chrome.runtime.sendMessage(A,{getStream:!0},B=>{if(!B||!B.streamId)return N.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),B),void U(new Me(W.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(B.streamId)})}catch(B){N.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(A,")"),B.toString()),U(new Me(W.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=_,wf(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var l;e.screen.mediaSource&&_j(e.screen.mediaSource);const _={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:U,systemAudio:B,preferCurrentTab:j,windowAudio:K,monitorTypeSurfaces:q}=e.screen,ie={selfBrowserSurface:C,surfaceSwitching:U,systemAudio:B,preferCurrentTab:j,windowAudio:K,monitorTypeSurfaces:q};!C&&delete ie.selfBrowserSurface,!U&&delete ie.surfaceSwitching,!B&&delete ie.systemAudio,!j&&delete ie.preferCurrentTab,!K&&delete ie.windowAudio,!q&&delete ie.monitorTypeSurfaces,N.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:_,audio:e.screenAudio,controls:ie})),wf(i,await navigator.mediaDevices.getDisplayMedia(Er({video:_,audio:e.screenAudio},ie)))}else{if(!Tr())throw N.error("[".concat(t,"] This browser does not support screenSharing")),new Me(W.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&_j(e.screen.mediaSource);const _={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};N.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(_))),wf(i,await navigator.mediaDevices.getUserMedia(_))}}var A,u;if(!e.video&&!e.audio)return i;let p={video:e.video,audio:e.audio},f=G("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),p=I1(p,f)}catch{}N.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(p)),zs();let b,w=null;(Jn()||Ki()||nw())&&(w=await sN.lock());try{b=await navigator.mediaDevices.getUserMedia(p)}catch(_){throw w&&w(),_}return p.audio&&(kj=!0),p.video&&(Dj=!0),wf(i,b),w&&w(),i}function xw(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Me(W.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Me(W.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Me(W.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Me(W.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Me(W.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Me(W.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return N.error("getUserMedia unexpected error",e),new Me(W.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function wf(e,t){const s=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(r&&e.removeTrack(r),e.addTrack(l)),i&&(s&&e.removeTrack(s),e.addTrack(i))}const Mo=new class extends jr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Ap.STATE_CHANGE,e),this._state=e)}constructor(){super(),Pe(this,"_state",F0.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(G("ENUMERATE_DEVICES_INTERVAL")||(I0()||rw()===Vn.HARMONY_OS)&&Sd())&&this.updateDevicesInfo()},G("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>N.error(e.toString()))}async enumerateDevices(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Me(W.NOT_SUPPORTED,"enumerateDevices() not supported.");const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let l=!this.isAccessMicrophonePermission&&e,A=!this.isAccessCameraPermission&&t;i.audio&&(l=!1),i.video&&(A=!1);let u=null,p=null,f=null;if(!s&&(l||A)){if(sN.isLocked&&(N.debug("[device manager] wait GUM lock"),(await sN.lock())(),N.debug("[device manager] GUM unlock")),kj&&(l=!1,this.isAccessMicrophonePermission=!0),Dj&&(A=!1,this.isAccessCameraPermission=!0),N.debug("[device manager] check media device permissions",e,t,l,A),l&&A){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const w=xw(b.name||b.code||b,b.message);if(w.code===W.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{u=await navigator.mediaDevices.getUserMedia({audio:e})}catch(b){const w=xw(b.name||b.code||b,b.message);if(w.code===W.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(A){try{p=await navigator.mediaDevices.getUserMedia({video:t})}catch(b){const w=xw(b.name||b.code||b,b.message);if(w.code===W.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}N.debug("[device manager] mic permission",e,"cam permission",t)}try{const b=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(w=>w.stop()),p&&p.getTracks().forEach(w=>w.stop()),f&&f.getTracks().forEach(w=>w.stop()),u=null,p=null,f=null,b}catch(b){return u&&u.getTracks().forEach(w=>w.stop()),p&&p.getTracks().forEach(w=>w.stop()),f&&f.getTracks().forEach(w=>w.stop()),u=null,p=null,f=null,new Me(W.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(s=>{s.device.label===e&&(t=s.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===e);if(!t)throw new Me(W.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=F0.INITING;try{await this.updateDevicesInfo(),this.state=F0.INITEND}catch(e){throw this.state=F0.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(N.warning("Device Detection functionality cannot start properly.",e.toString()),e):new Me(W.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),s=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(A=>A.kind==="audioinput"&&A.deviceId==="default"),l=e.find(A=>A.kind==="audiooutput"&&A.deviceId==="default");i&&l?l.groupId===i.groupId?N.debug("[device-check] default input ".concat(i.label," and output ").concat(l.label," is the same group")):N.debug("[device-check] default input ".concat(i.label," and output ").concat(l.label," is not the same group")):N.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const l=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const A={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),A),s.push(A)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((i,l)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",s.push(i))}),this.state!==F0.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Ap.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Ap.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Ap.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),s=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of s)if(i.label&&i.deviceId){r.video=!0;break}return r}};let rN=!1;const Ia=new class extends jr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function Bj(){if(rN)return G("FLS_AUTOPLAY_EMITS")?(Ia.onAutoplayFailed&&Ia.onAutoplayFailed(),Ia.emit("autoplay-failed")):void 0;{const e=t=>{t.preventDefault(),rN=!1,O0()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};rN=!0,O0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),N.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ia.onAutoplayFailed?Ia.onAutoplayFailed():Ia.onAudioAutoplayFailed?N.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):N.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ia.emit("autoplay-failed")}}function Lj(e,t,s,r){if(!e)return;const i=kt.getBaseInfoBySessionId(e);if(!i)return;const l=i.info,A=Date.now(),u=Er(Er({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:A,elapse:A-i.startTime,cbRegistered:Ia.onAutoplayFailed||Ia.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:t,trackId:r,extend:void 0});kt.send({type:Dr.AUTOPLAY_FAILED,data:u},!0)}const MZ=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ea=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",e=>mt.all(Array.from(this.elementMap.entries()).map(async t=>{let[s,r]=t;const i=this.elementStateMap.get(s),l=r.srcObject.getAudioTracks()[0],A=l&&l.readyState;if(N.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(A," ").concat(e)),A==="live"){if(e)return r.pause(),r.play();if(mr.curState==="running")return of()?(r.pause(),r.play()):i&&i==="paused"?r.play():void 0}}))),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,s]=e;const r=s.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(N.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),mr.on(Ai.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mr.on(Ai.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),mr.on(Ai.STATE_CHANGE,()=>{Ki()&&mr.prevState==="suspended"&&mr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const s=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),s)try{await s.setSinkId(t)}catch(r){throw new Me(W.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,s,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Di.INIT),this.setVolume(t,s);const l=this.sinkIdMap.get(t);if(l)try{i.setSinkId(l).catch(u=>{N.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){N.warning("[".concat(t,"] set sink id failed"),u.toString())}const A=i.play();A&&A.then&&A.catch(u=>{r&&Lj(r,"audio",u.message,t),N.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(N.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),aw(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Bj()}))})}updateTrack(e,t){const s=this.elementMap.get(e);s&&(s.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const s=this.elementMap.get(e);s&&(t=Math.max(0,Math.min(100,t)),s.volume=t/100)}getVolume(e){const t=this.elementMap.get(e);return t?t.volume:0}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const s=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(s,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){MZ.forEach(s=>{t.addEventListener(s,r=>{const i=this.elementStateMap.get(e),l=r.type==="pause"?"paused":r.type;if(N.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(l)),r.type==="error"){const A=t==null?void 0:t.error;A&&N.error("[".concat(e,"] media error, code: ").concat(A.code,", message: ").concat(A.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(s=>{N.debug("Auto resume audio element success")}).catch(s=>{N.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new mt(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{O0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Jr(){return function(e,t,s){const r=s.value;return typeof r=="function"&&(s.value=function(){this._isClosed&&new Me(W.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",N);for(var i=arguments.length,l=new Array(i),A=0;A<i;A++)l[A]=arguments[A];const u=r.apply(this,l);return u instanceof mt?new mt((p,f)=>{u.then(p).catch(f)}):u}),s}}class jj extends jr{constructor(t){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Me(W.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Me(W.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(pa.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(pa.ON_TRACK,void 0)}}class Pj extends jr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=t,this.direction=s}async getConstraints(){return await wn(this,Po.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,s){var r;return N.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(s,t),wr(this,Po.REQUEST_UPDATE_CONSTRAINTS,Array.from(ho(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var s;if(this.constraintsMap.has(t))return N.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),wr(this,Po.REQUEST_UPDATE_CONSTRAINTS,Array.from(ho(s=this.constraintsMap).call(s)))}registerStats(t,s,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===s)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:s,cb:r})}unregisterStats(t,s){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===s);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:s,processorName:r,type:i,cb:l}of this.statsRegistry)try{const A=l();t.push({processorID:s,processorName:r,type:i,stats:A})}catch(A){N.error(new Me(W.UNEXPECTED_ERROR,A.message))}return t}registerUsage(t,s){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:s})}unregisterUsage(t){const s=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let r=s();r instanceof mt&&(r=await r),t.push(Er(Er({},r),{},{direction:this.direction}))}catch(r){N.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class Uj extends jr{constructor(t){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Me(W.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Me(W.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(pa.ON_TRACK,void 0),this.emit(pa.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(pa.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(pa.ON_NODE,this.inputNode))}}class Fj extends jr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,s,r){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=t,this.trackId=s,this.direction=r}async getConstraints(){return wn(this,Po.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,s){var r;return N.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(s,t),wr(this,Po.REQUEST_UPDATE_CONSTRAINTS,Array.from(ho(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var s;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),wr(this,Po.REQUEST_UPDATE_CONSTRAINTS,Array.from(ho(s=this.constraintsMap).call(s)))}registerStats(t,s,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===s)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:s,cb:r})}unregisterStats(t,s){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===s);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:s,processorName:r,type:i,cb:l}of this.statsRegistry)try{const A=l();t.push({processorID:s,processorName:r,type:i,stats:A})}catch(A){N.error(new Me(W.UNEXPECTED_ERROR,A.message))}return t}registerUsage(t,s){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:s})}unregisterUsage(t){const s=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let r=s();r instanceof mt&&(r=await r),t.push(Er(Er({},r),{},{direction:this.direction}))}catch(r){N.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class nN extends jr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new VZ}setVolume(){}createOutputTrack(){throw new Me(W.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class VZ{disconnect(){}connect(){}}function Mj(e){return new mt((t,s)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const l=Ki()?"canplay":"playing";i.addEventListener(l,()=>{const A=i.videoWidth,u=i.videoHeight;!A&&Tr()||(r=!0,i.srcObject=null,i.remove(),t([A,u]))}),i.srcObject=new MediaStream([e]),i.play().catch(B0),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function vw(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const s=Kc(e.encoderConfig);return s.width!=null&&(t.width=s.width),s.height!=null&&(t.height=s.height),!DL()&&s.frameRate&&(t.frameRate=s.frameRate),SL()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Tr()&&(t.frameRate={ideal:30,max:30}),t}function Vj(e){const t={};return DL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,EA()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function Qj(e){const t=Vj(e);if(e.encoderConfig){const s=gw(e.encoderConfig);t.channelCount=s.stereo?2:1,t.sampleRate=s.sampleRate,t.sampleSize=s.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),I0()&&(t.sampleRate=void 0),t}const Hj=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:s,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:l=s,width:A=r,height:u=i}=t;if(!l||!A||!u)return;A=df(A),u=df(u),l=df(l);const{max:p,min:f}=function(C,U,B){const j=200*Math.pow(B/15,.6)*Math.pow(C*U/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(A,u,l),{bitrateMax:b,bitrateMin:w}=t||{};b||N.debug("calculate bitrate: [w: ".concat(A,", h: ").concat(u,", fps: ").concat(l,"] => [brMax: ").concat(b,", brMin: ").concat(w,"]"));const{maxFramerate:_}=G("ENCODER_CONFIG_LIMIT");return _&&typeof _=="number"&&(l=Math.min(l,_)),{frameRate:l,bitrateMax:b||p,bitrateMin:w||f,scaleResolutionDownBy:1,scale:0}},Gj=async(e,t,s)=>await(async(r,i,l)=>{const A=function(f){const b=[];for(let w=0;w<f.length;w+=2)b.push(parseInt(f.slice(w,w+2),16));return Uint8Array.from(b)}(ZL(""+i+l)).slice(0,16),u=A.slice(0,12),p=await window.crypto.subtle.importKey("raw",A,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},p,r))})(e.buffer,t,s),iN=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new mt((s,r)=>{t.toBlob(async i=>{if(t.remove(),i){const l=await Kj(i);s({buffer:l,width:t.width,height:t.height})}else r(new Me(W.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},Kj=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var Wj,zj,qj,Yj,Xj,Jj,$j,Zj,eP,tP,sP,rP,nP,iP,aP,oP,cP,lP,Qr,dP,AP,uP,hP,pP,mP,Td,fP,gP,bP,xP,vP,wP,_P,yP,EP,SP,CP,NP,TP,Si;let $r=(Wj=Yt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),zj=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),qj=Jr(),Yj=Af("LocalAudioTrack","_enabledMutex"),Xj=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),Jj=Jr(),$j=Af("LocalAudioTrack","_enabledMutex"),Zj=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),eP=Jr(),tP=Jr(),sP=Jr(),rP=Yt({argsMap:e=>[e.getTrackId()]}),nP=Jr(),iP=Yt({argsMap:e=>[e.getTrackId()]}),aP=Jr(),oP=Yt({argsMap:e=>[e.getTrackId()]}),cP=Yt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),lP=Yt({argsMap:e=>[e.getTrackId()]}),Vs((Qr=class extends xf{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ea.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,s,r){super(e,s),Pe(this,"trackMediaType",bf.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new nN,G("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),G("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Jn()&&!Uo?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){gr(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ea.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void N.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,wr(this,Bt.NEED_REPLACE_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{N.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!gj())throw new Me(W.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ea.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,s){return this._setEnabled(e,t,s)}async _setEnabled(e,t,s){if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await wr(this,Bt.NEED_ENABLE_TRACK,this),N.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw s||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await wr(this,Bt.NEED_DISABLE_TRACK,this)}catch(r){throw s||(this._enabled=!0),N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await wr(this,Bt.NEED_MUTE_TRACK,this):await wr(this,Bt.NEED_UNMUTE_TRACK,this))}getStats(){return Cu(()=>{N.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),fo(this,Bt.GET_STATS)||Er({},Y1)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(jo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(jo.ON_AUDIO_BUFFER),this._source.on(jo.ON_AUDIO_BUFFER,s=>e(s))}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ea.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ea.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ea.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wr(this,Bt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return mt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Me(W.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Me(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(pa.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await wr(this,Bt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wr(this,Bt.NEED_REPLACE_TRACK,this))}),e.on(pa.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(pa.ON_TRACK),e.removeAllListeners(pa.ON_NODE)}bindProcessorContextEvents(e){e.on(Po.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Po.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof nN&&(this._trackSource=new tN(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new Fj(this._source.context,this.getTrackId(),"local"),t=new Uj(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(jo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ea.stop(this.getTrackId()),this._source.play()),wr(this,Bt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{N.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[Wj],Object.getOwnPropertyDescriptor(Qr.prototype,"setVolume"),Qr.prototype),Vs(Qr.prototype,"setPlaybackDevice",[zj,qj],Object.getOwnPropertyDescriptor(Qr.prototype,"setPlaybackDevice"),Qr.prototype),Vs(Qr.prototype,"setEnabled",[Yj,Xj,Jj],Object.getOwnPropertyDescriptor(Qr.prototype,"setEnabled"),Qr.prototype),Vs(Qr.prototype,"setMuted",[$j,Zj,eP],Object.getOwnPropertyDescriptor(Qr.prototype,"setMuted"),Qr.prototype),Vs(Qr.prototype,"getStats",[tP],Object.getOwnPropertyDescriptor(Qr.prototype,"getStats"),Qr.prototype),Vs(Qr.prototype,"setAudioFrameCallback",[sP],Object.getOwnPropertyDescriptor(Qr.prototype,"setAudioFrameCallback"),Qr.prototype),Vs(Qr.prototype,"play",[rP,nP],Object.getOwnPropertyDescriptor(Qr.prototype,"play"),Qr.prototype),Vs(Qr.prototype,"stop",[iP,aP],Object.getOwnPropertyDescriptor(Qr.prototype,"stop"),Qr.prototype),Vs(Qr.prototype,"close",[oP],Object.getOwnPropertyDescriptor(Qr.prototype,"close"),Qr.prototype),Vs(Qr.prototype,"pipe",[cP],Object.getOwnPropertyDescriptor(Qr.prototype,"pipe"),Qr.prototype),Vs(Qr.prototype,"unpipe",[lP],Object.getOwnPropertyDescriptor(Qr.prototype,"unpipe"),Qr.prototype),Qr),M0=(dP=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),AP=Jr(),uP=Af("MicrophoneAudioTrack","_enabledMutex"),hP=Yt({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),pP=Jr(),mP=Yt({argsMap:e=>[e.getTrackId()]}),Vs((Td=class extends $r{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,s,r){super(e,t.encoderConfig?gw(t.encoderConfig):{},r,G("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=t,this._constraints=s,this._originalConstraints=s,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(of()||_1())&&mr.bindInterruptDetectorTrack(this)}async setDevice(e){if(N.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Mo.getDeviceById(e),s={};s.audio=Er({},this._constraints),s.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Fo(s,this.getTrackId())}catch(i){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Fo({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Mo.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}N.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,s){if(t)return N.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),G("AUTO_RESET_AUDIO_ROUTE")&&(Ki()||Mc())){const A=navigator.audioSession;A&&(e||(A.type="playback"),A.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),s||(this._enabled=!1);try{await wr(this,Bt.NEED_DISABLE_TRACK,this)}catch(A){throw N.error("[".concat(this.getTrackId(),"] setEnabled false failed"),A.toString()),A}return}const i=Er({},this._constraints),l=Mo.searchDeviceIdByName(this._deviceName);l&&!i.deviceId&&(i.deviceId=l);try{s||(this._enabled=!0);const A=await Fo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(A.getAudioTracks()[0],!1),await wr(this,Bt.NEED_ENABLE_TRACK,this)}catch(A){throw s||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled true failed"),A.toString()),A}N.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(of()||_1())&&mr.unbindInterruptDetectorTrack(this),lp.some(e=>function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"}(e))||$1&&$1()&&(kt.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:br.TRACER}).onSuccess(),N.debug("restart background audio tag success"))}onTrackEnded(){if((Ki()||Mc())&&this._enabled&&!this._isClosed&&mr.duringInterruption){const e=async()=>{mr.off(Ai.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mr.on(Ai.IOS_INTERRUPTION_END,e)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(gf.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,s=Mo.searchDeviceIdByName(this._deviceName);if(s&&!t.deviceId&&(t.deviceId=s),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Fo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Po.REQUEST_UPDATE_CONSTRAINTS,async(t,s,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),s()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Po.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[dP,AP],Object.getOwnPropertyDescriptor(Td.prototype,"setDevice"),Td.prototype),Vs(Td.prototype,"setEnabled",[uP,hP,pP],Object.getOwnPropertyDescriptor(Td.prototype,"setEnabled"),Td.prototype),Vs(Td.prototype,"close",[mP],Object.getOwnPropertyDescriptor(Td.prototype,"close"),Td.prototype),Td),QZ=(fP=Yt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),gP=Jr(),bP=Yt({argsMap:e=>[e.getTrackId()]}),xP=Jr(),vP=Yt({argsMap:e=>[e.getTrackId()]}),wP=Jr(),_P=Yt({argsMap:e=>[e.getTrackId()]}),yP=Jr(),EP=Yt({argsMap:e=>[e.getTrackId()]}),SP=Jr(),CP=Yt({argsMap:e=>[e.getTrackId()]}),NP=Yt({argsMap:e=>[e.getTrackId()]}),TP=Jr(),Vs((Si=class extends $r{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,s,r){super(t.createOutputTrack(),s,r),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(jo.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(gf.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){gr(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[fP,gP],Object.getOwnPropertyDescriptor(Si.prototype,"startProcessAudioBuffer"),Si.prototype),Vs(Si.prototype,"pauseProcessAudioBuffer",[bP,xP],Object.getOwnPropertyDescriptor(Si.prototype,"pauseProcessAudioBuffer"),Si.prototype),Vs(Si.prototype,"seekAudioBuffer",[vP,wP],Object.getOwnPropertyDescriptor(Si.prototype,"seekAudioBuffer"),Si.prototype),Vs(Si.prototype,"resumeProcessAudioBuffer",[_P,yP],Object.getOwnPropertyDescriptor(Si.prototype,"resumeProcessAudioBuffer"),Si.prototype),Vs(Si.prototype,"stopProcessAudioBuffer",[EP,SP],Object.getOwnPropertyDescriptor(Si.prototype,"stopProcessAudioBuffer"),Si.prototype),Vs(Si.prototype,"close",[CP],Object.getOwnPropertyDescriptor(Si.prototype,"close"),Si.prototype),Vs(Si.prototype,"setAudioBufferPlaybackSpeed",[NP,TP],Object.getOwnPropertyDescriptor(Si.prototype,"setAudioBufferPlaybackSpeed"),Si.prototype),Si);class Tn extends $r{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=vf().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ar(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(N.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):N.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){N.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}iw(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(s=>{s instanceof Tn?s.emit(dp.TRANSCEIVER_UPDATED,t):s._updateRtpTransceiver(t)}))}}class HZ extends Rj{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(jo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=t,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):N.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const RP=new Map;function IP(e,t){if(e.length===0||t.length===0)return 1/0;const s=k1(e),r=k1(t);return Math.floor(r/s)}class aN{get rendFrameRate(){const t=Math.max(1,IP(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Di.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(N.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var s;t!==this._videoState&&(this._videoState=t,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(t){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onFirstVideoFrameRender",void 0),Pe(this,"onVideoBufferReady",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"renderFreezeAccTime2",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"isDestroyed",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"cancelRVFId",void 0),Pe(this,"internal",!1),Pe(this,"_render_interframe_delays",[]),Pe(this,"_render_interframe_delays_sizes",[]),Pe(this,"_videoState",Nd.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",Di.NONE),Pe(this,"_isInPage",!0),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return N.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&mr.curState==="running"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(yL())),OL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":s.type==="play"&&N.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Di.PLAYING;break;case"loadeddata":if(this.videoState=Nd.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Di.CANPLAY;break;case"stalled":this.videoElementStatus=Di.STALLED;break;case"suspend":this.videoElementStatus=Di.SUSPEND;break;case"pause":this.videoElementStatus=Di.PAUSED,Ki()||Mc()||Jn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Di.WAITING;break;case"abort":this.videoElementStatus=Di.ABORT;break;case"ended":this.videoElementStatus=Di.ENDED;break;case"emptied":this.videoElementStatus=Di.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=Di.ERROR,N.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>G("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,go.lastVisibleTime<go.lastHiddenTime||l<go.lastHiddenTime||l<go.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>G("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const A=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(A),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(yL())),OL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),mr.on(Ai.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mr.on(Ai.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const s=this.videoElement.play();s&&s.catch&&s.catch(i=>{t&&Lj(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(N.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):N.warning("[".concat(this.trackId,"] play warning: "),i)});const r=zs();if((r.name==="Safari"&&Number(r.version)===15||of())&&s&&s.then){const i=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const s=t.getContext("2d");if(!s)return N.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,t.width,t.height);const r=s.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new mt((l,A)=>{r.toBlob(async u=>{if(r.remove(),u){const p=await Kj(u);l({buffer:p,width:r.width,height:r.height})}else A(new Me(W.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,s<0?.1:s>1?1:s)})):await iN(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,mr.off(Ai.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mr.off(Ai.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Nd.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Di.INIT,!this.videoElementCheckInterval&&(OP.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(l){return l!==document.body&&document.body.contains(l)}(this.videoElement)},1e3),G("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,s;let l;const A=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",A),this.videoElementFreezeTimeout=window.setTimeout(u,G("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Nd.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Nd.VideoStateFrozen:document.addEventListener("visibilitychange",A))},p=(f,b)=>{if(this.videoElementStatus===Di.PLAYING){if(l){const C=b.presentationTime-l.presentationTime,U=b.presentedFrames-l.presentedFrames;this._render_interframe_delays_sizes.push(U),this._render_interframe_delays.push(C);const B=k1(this._render_interframe_delays_sizes),j=B-this._render_interframe_delays_sizes[0];if(B>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Nd.VideoStateStarting&&(this.videoState=Nd.VideoStateDecoding),this.videoState===Nd.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,G("VIDEO_FREEZE_DURATION"))),C<G("VIDEO_FREEZE_DURATION")&&this.videoState===Nd.VideoStateFrozen&&(this.videoState=Nd.VideoStateDecoding),C>G("VIDEO_FREEZE_DURATION")&&go.lastVisibleTime>=go.lastHiddenTime&&l.timestamp>go.lastVisibleTime&&l.timestamp>go.lastHiddenTime){const K=Math.min(66,IP(this._render_interframe_delays_sizes,this._render_interframe_delays)),q=Math.max(0,C-(U-1)*K);this.renderFreezeAccTime2+=q>K?q:0,this.renderFreezeAccTime+=C}}l=Er(Er({},b),{},{timestamp:f})}else this.isSkipCalcRenderFreezeTime()&&(l=Er(Er({},b),{},{timestamp:f}));var w,_;G("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(w=(_=this.videoElement).requestVideoFrameCallback)===null||w===void 0?void 0:w.call(_,p))};this.cancelRVFId=(t=(s=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(s,p)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),I0()&&!G("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=zs();this.config.noStyle||(r.name==="Safari"&&Number(r.version)===15||of()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Tr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Tr()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(l=>{N.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){var t,s;OP.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(s=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(s,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Di.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Di.DESTROYED||this.internal}handleAutoPlayFailed(){const t=s=>{s.preventDefault(),this.videoElement.play().then(()=>{N.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{N.error(r)}),this.autoplayFailed=!1,O0()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};O0()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),Bj()}}const OP=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class ww extends aN{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=t.element,this.internal=s,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const s=t.element;var r;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var s;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await iN(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",G("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var kP,DP,BP,LP,jP,PP,UP,FP,MP,VP,QP,HP,GP,KP,WP,zP,qP,YP,XP,JP,$P,ZP,eU,tU,sU,rU,nU,iU,js,aU,oU,cU,lU,dU,AU,uU,hU,Vo;let xr=(kP=Yt({argsMap:(e,t,s)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),DP=Jr(),BP=Yt({argsMap:e=>[e.getTrackId()]}),LP=Af("LocalVideoTrack","_enabledMutex"),jP=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),PP=Jr(),UP=Af("LocalVideoTrack","_enabledMutex"),FP=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),MP=Jr(),VP=Yt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),QP=Jr(),HP=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),GP=Jr(),KP=Jr(),WP=Yt({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),zP=Jr(),qP=Jr(),YP=Jr(),XP=Yt({argsMap:e=>[e.getTrackId()]}),JP=Jr(),$P=Jr(),ZP=Jr(),eU=Jr(),tU=Jr(),sU=Yt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rU=Yt({argsMap:e=>[e.getTrackId()]}),nU=Yt({argsMap:e=>[e.getTrackId()]}),iU=Yt({argsMap:(e,t,s)=>[e.getTrackId(),t.label,s]}),js=class yH extends xf{get videoHeight(){if(Jn()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Jn()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Di.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,s,r,i,l,A){if(super(t,l),Pe(this,"trackMediaType",bf.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_saveEncodeBitrateRatio",1),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Jn()){const{width:u,height:p}=t.getSettings();this._videoWidth=u,this._videoHeight=p}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=A||[],s&&this._hints.indexOf(rr.CUSTOM_TRACK)!==-1?this._encoderConfig=Rr(s):this._encoderConfig=s,this._hints.indexOf(rr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(x1(Ys.CHROME,115)&&rw().indexOf("Windows")!==-1){const u=function(p,f){if("VideoFrame"in window&&"TransformStream"in window&&Ls().supportWebRTCInsertableStream){const b=new MediaStreamTrackProcessor(p),w=new MediaStreamTrackGenerator({kind:"video"});let _,C,U=Date.now();const B=()=>{j&&(clearInterval(j),j=void 0),_&&(_.close(),_=void 0),p.stop(),C=void 0,w.removeEventListener("ended",B)};let j=window.setInterval(()=>{if(C&&_&&Date.now()-U>1e3)try{w.readyState==="live"?C.enqueue(_.clone()):B()}catch{B()}},1e3);const K=new TransformStream({transform:(q,ie)=>{w.readyState==="live"?(C=ie,U=Date.now(),_===void 0?(_=q,ie.enqueue(q.clone())):(ie.enqueue(_),_=q)):q.close()}});return w.addEventListener("ended",B),b.readable.pipeThrough(K).pipeTo(w.writable),w}}(t);u&&(N.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}s&&this._hints.indexOf(rr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new Pj(this.getTrackId(),"local"),this._processorDestination=new jj(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const r=Er(Er(Er({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new aN(r):this._player=new ww(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(gf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await wr(this,Bt.NEED_DISABLE_TRACK,this)}catch(r){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return s||(this._enabled=!1),void N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await wr(this,Bt.NEED_ENABLE_TRACK,this)}catch(r){throw N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await wr(this,Bt.NEED_MUTE_TRACK,this):await wr(this,Bt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),N.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await wr(this,Bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(N)}}}async setEncoderConfiguration(t,s){if(!this._enabled)throw new Me(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Kc(t),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=vw({encoderConfig:t});(Jn()||Ki()||Mc())&&(r.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const l=new Me(W.UNEXPECTED_ERROR,i.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(rr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wr(this,Bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(N)}}getStats(){return Cu(()=>{N.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),fo(this,Bt.GET_STATS)||Er({},X1)}async setBeautyEffect(t){N.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,s):await iN(t)}async findClosestProfile(){const{width:t,height:s,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:l,frameRate:A}=this._encoderConfig||{},u=df(this._videoWidth||t||i||0),p=df(this._videoHeight||s||l||0),f=function(b,w,_){if(!Array.isArray(G("VIDEO_ENCODER_CONFIG_LIST"))||G("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const C=Math.min(b,w);return!(C>=480)&&Er(Er({},G("VIDEO_ENCODER_CONFIG_LIST").find(U=>U.height>C)),{},{frameRate:_})}(u,p,df(r||A||15));if(f)return N.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(u,"x").concat(p," => ").concat(JSON.stringify(f))),this.setEncoderConfiguration(f)}async setBitrateLimit(t){N.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void N.error(W.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=t,await wr(this,Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=s,N.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}N.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return N.error(W.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,N.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){Mj(this._originMediaStreamTrack).then(t=>{let[s,r]=t;this._videoHeight=r,this._videoWidth=s}).catch(B0)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Me(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");N.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Kc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(rr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wr(this,Bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(N)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:s,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!s||!r)return;const{bitrateMax:i,bitrateMin:l}=this._encoderConfig;if(l==null||i==null){const{max:A,min:u}=function(p,f,b,w,_){const C=G("BITRATE_ADAPTER_TYPE");if(C==="DEFAULT_BITRATE")return{min:w,max:_};if(_===void 0){const U=Math.floor(200*Math.pow(b/15,.6)*Math.pow(p*f/640/360,.75));_=C==="STANDARD_BITRATE"?4*U:2*U,w=w??U}else w=w??Math.floor(_/10);return{min:w,max:_}}(t,s,r,l,i);if(this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=A,G("VIDEO_STANDARD_BITRATE_VERSION")&&l==null&&i==null){const[p,f]=function(b,w,_){const C=4*Math.floor(2e5*Math.pow(_/15,.6)*Math.pow(b*w/230400,.75)),U=b*w,B=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let K=ho(B).call(B).next().value,q=1;if(B.has(U))K=B.get(U);else{var ie;const _t=Kh(ie=Array.from(B.entries())).call(ie,(Jt,bs)=>{let[As]=Jt,[Xs]=bs;return As-Xs}),ns=_t.find(Jt=>{let[bs]=Jt;return bs>U});if(ns){const Jt=_t.indexOf(ns);if(Jt>0){const bs=_t[Jt-1],As=(U-bs[0])/(ns[0]-bs[0]);K=bs[1]+As*(ns[1]-bs[1])}else K=ns[1]}else K=_t[_t.length-1][1]}if(j.has(U))q=j.get(U);else{var xe;const _t=Kh(xe=Array.from(j.entries())).call(xe,(Jt,bs)=>{let[As]=Jt,[Xs]=bs;return As-Xs}),ns=_t.find(Jt=>{let[bs]=Jt;return bs>U});if(ns){const Jt=_t.indexOf(ns);if(Jt>0){const bs=_t[Jt-1],As=(U-bs[0])/(ns[0]-bs[0]);q=bs[1]+As*(ns[1]-bs[1])}else q=ns[1]}else q=_t[_t.length-1][1]}const ye=G("VIDEO_NEW_BITRATE_RATIO");ye&&ye>0&&(K=ye/100);const ue=Math.floor(C*K),Re=Math.floor(65e4*Math.pow(b*w/230400,.5)*Math.pow(_/15,.69));let Ge=ue;const Ze=G("VIDEO_STANDARD_BITRATE_VERSION");return Ze&&Ze>0&&(Ze===1?Ge=C:Ze===2?Ge=ue:Ze===3&&(Ge=Re)),[Math.floor(Ge/1e3),q]}(t,s,r);this._encoderConfig.bitrateMax=p,this._encoderConfig.bitrateMin=u?Math.min(u,p):p,this._saveEncodeBitrateRatio=f,N.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(s,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else N.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(s,", fps: ").concat(r,"] => [brMax: ").concat(A,", brMin: ").concat(u,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,s;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:l,slot:A}=i;if(this.isPlaying&&l instanceof HTMLVideoElement&&A instanceof HTMLElement){const u=FL.checkOneElementVisible(l),p=Object.assign({},u);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const f=kt.reportApiInvoke(null,{tag:br.TRACER,name:kr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(r){throw new Me(W.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Me(W.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Er(Er({},r),Kc(t))),r=np(r);const i=ar(8,"track-video-cloned-"),l=new yH(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,np(this._scalabilityMode),this._optimizationMode,i,np(this._hints));return t&&r&&l.setEncoderConfiguration(r),N.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(s)),l}async replaceTrack(t,s){if(!(t instanceof MediaStreamTrack))throw new Me(W.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Me(W.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Cu(()=>{kt.reportApiInvoke(null,{name:kr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:br.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!G("ENABLE_VIDEO_SEI")||!G("ENABLE_ENCODED_TRANSFORM"))return void N.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Me(W.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void N.warning("Video track is not published, SEI can not be send");const r=s.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):N.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(pa.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await wr(this,Bt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wr(this,Bt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(pa.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Po.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Po.REQUEST_CONSTRAINTS)}},Vs(js.prototype,"play",[kP,DP],Object.getOwnPropertyDescriptor(js.prototype,"play"),js.prototype),Vs(js.prototype,"stop",[BP],Object.getOwnPropertyDescriptor(js.prototype,"stop"),js.prototype),Vs(js.prototype,"setEnabled",[LP,jP,PP],Object.getOwnPropertyDescriptor(js.prototype,"setEnabled"),js.prototype),Vs(js.prototype,"setMuted",[UP,FP,MP],Object.getOwnPropertyDescriptor(js.prototype,"setMuted"),js.prototype),Vs(js.prototype,"setSaveEncodeBitrateRatio",[VP,QP],Object.getOwnPropertyDescriptor(js.prototype,"setSaveEncodeBitrateRatio"),js.prototype),Vs(js.prototype,"setEncoderConfiguration",[HP,GP],Object.getOwnPropertyDescriptor(js.prototype,"setEncoderConfiguration"),js.prototype),Vs(js.prototype,"getStats",[KP],Object.getOwnPropertyDescriptor(js.prototype,"getStats"),js.prototype),Vs(js.prototype,"setBeautyEffect",[WP,zP],Object.getOwnPropertyDescriptor(js.prototype,"setBeautyEffect"),js.prototype),Vs(js.prototype,"getCurrentFrameData",[qP],Object.getOwnPropertyDescriptor(js.prototype,"getCurrentFrameData"),js.prototype),Vs(js.prototype,"getCurrentFrameImage",[YP],Object.getOwnPropertyDescriptor(js.prototype,"getCurrentFrameImage"),js.prototype),Vs(js.prototype,"findClosestProfile",[XP,JP],Object.getOwnPropertyDescriptor(js.prototype,"findClosestProfile"),js.prototype),Vs(js.prototype,"setBitrateLimit",[$P],Object.getOwnPropertyDescriptor(js.prototype,"setBitrateLimit"),js.prototype),Vs(js.prototype,"setOptimizationMode",[ZP],Object.getOwnPropertyDescriptor(js.prototype,"setOptimizationMode"),js.prototype),Vs(js.prototype,"setScalabiltyMode",[eU],Object.getOwnPropertyDescriptor(js.prototype,"setScalabiltyMode"),js.prototype),Vs(js.prototype,"updateMediaStreamTrackResolution",[tU],Object.getOwnPropertyDescriptor(js.prototype,"updateMediaStreamTrackResolution"),js.prototype),Vs(js.prototype,"pipe",[sU],Object.getOwnPropertyDescriptor(js.prototype,"pipe"),js.prototype),Vs(js.prototype,"unpipe",[rU],Object.getOwnPropertyDescriptor(js.prototype,"unpipe"),js.prototype),Vs(js.prototype,"close",[nU],Object.getOwnPropertyDescriptor(js.prototype,"close"),js.prototype),Vs(js.prototype,"replaceTrack",[iU],Object.getOwnPropertyDescriptor(js.prototype,"replaceTrack"),js.prototype),js),_w=(aU=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),oU=Jr(),cU=Af("CameraVideoTrack","_enabledMutex"),lU=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),dU=Jr(),AU=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),uU=Jr(),hU=Yt({argsMap:e=>[e.getTrackId()]}),Vo=class EH extends xr{get __className__(){return"CameraVideoTrack"}constructor(t,s,r,i,l,A){super(t,Kc(s.encoderConfig),i,l,A),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(of()||_1())&&!function(){const u=zs();if(u.os!==Vn.IOS||!u.osVersion)return!1;const p=u.osVersion.split(".");return Number(p[0])===15&&Number(p[1])>=2}()&&kL()&&this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Kc(this._config.encoderConfig),mr.on(Ai.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mr.on(Ai.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(N.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const s=await Mo.getDeviceById(t),r={};r.video=Er({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Fo(r,this.getTrackId())}catch(l){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),i=await Fo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await Mo.getDeviceById(t);this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}N.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){N.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const s={video:Er(Er({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Fo(s,this.getTrackId())}catch(i){throw N.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Fo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Er({},s.video),N.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Fo({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await wr(this,Bt.NEED_ENABLE_TRACK,this)}catch(r){throw N.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await wr(this,Bt.NEED_DISABLE_TRACK,this)}catch(r){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,s){if(!this._enabled)throw new Me(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Kc(t),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=Rr(this._config);r.encoderConfig=t;const i=vw(r);(Jn()||Ki()||Mc())&&(i.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(l){const A=new Me(W.UNEXPECTED_ERROR,l.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),A.toString()),A}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(rr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wr(this,Bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(N)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ki()||Mc())&&this._enabled&&!this._isClosed&&mr.duringInterruption){const t=async()=>{mr.off(Ai.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};mr.on(Ai.IOS_INTERRUPTION_END,t)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(gf.TRACK_ENDED)}async renewMediaStreamTrack(t){const s=t||this._constraints,r=Mo.searchDeviceIdByName(this._deviceName);if(r&&!s.deviceId&&(s.deviceId={exact:r}),this._enabled){const i=await Fo({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),mr.off(Ai.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mr.off(Ai.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Er(Er({},r),Kc(t))),r=np(r);const i=ar(8,"track-cam-cloned-"),l=new EH(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,np(Er(Er({},this._config),{},{encoderConfig:r})),np(this._constraints),np(this._scalabilityMode),this._optimizationMode,i);return t&&r&&l.setEncoderConfiguration(r),N.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(s)),l}bindProcessorContextEvents(){this.processorContext.on(Po.REQUEST_UPDATE_CONSTRAINTS,async(t,s,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),s()}catch(i){r(i)}}),this.processorContext.on(Po.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Vs(Vo.prototype,"setDevice",[aU,oU],Object.getOwnPropertyDescriptor(Vo.prototype,"setDevice"),Vo.prototype),Vs(Vo.prototype,"setEnabled",[cU,lU,dU],Object.getOwnPropertyDescriptor(Vo.prototype,"setEnabled"),Vo.prototype),Vs(Vo.prototype,"setEncoderConfiguration",[AU,uU],Object.getOwnPropertyDescriptor(Vo.prototype,"setEncoderConfiguration"),Vo.prototype),Vs(Vo.prototype,"close",[hU],Object.getOwnPropertyDescriptor(Vo.prototype,"close"),Vo.prototype),Vo);function pU(e){const t=ar(8,"track-cus-"),s=kt.reportApiInvoke(null,{id:t,tag:br.TRACER,name:kr.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new $r(e.mediaStreamTrack,e.encoderConfig?gw(e.encoderConfig):{},t,!1);return N.info("create custom audio track success with config",e,"trackId",r.getTrackId()),s.onSuccess(r.getTrackId()),r}function oN(e,t,s,r){s.optimizationMode&&(r&&r.width&&r.height?(s.encoderConfig=Er(Er({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(t.contentHint=s.optimizationMode,t.contentHint===s.optimizationMode?N.debug("[".concat(e,"] set content hint to"),s.optimizationMode):N.debug("[".concat(e,"] set content hint failed")))):N.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var mU,fU,gU,bU,uc,xU,vU,wU,_U,yU,EU,SU,Ci;class CU extends Cj{getUserId(){return this._userId}constructor(t,s,r,i){super(t,"track-".concat(t.kind,"-").concat(s,"-").concat(i.clientId,"_").concat(ar(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,N.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let _f=(mU=Yt({argsMap:(e,t,s)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),fU=Yt({argsMap:e=>[e.getTrackId()]}),gU=Yt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),bU=Yt({argsMap:e=>[e.getTrackId()]}),Vs((uc=class extends CU{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Di.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,s,r,i){super(e,t,s,r),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",bf.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"_prePlayer",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new Pj(this.getTrackId(),"remote"),this.processorDestination=new jj(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Cu(()=>{N.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),fo(this,Bt.GET_STATS)||Er({},Ej)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Ac.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const s=Er(Er({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(s);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new aN(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(s)):this._player=new ww(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ac.FIRST_FRAME_DECODED),i&&this.safeEmit(Ac.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=l=>{this.safeEmit(Ac.VIDEO_STATE_CHANGED,l)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Ac.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Ac.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Mj(this._originMediaStreamTrack).then(e=>{let[t,s]=e;this._videoHeight=s,this._videoWidth=t}).catch(B0)}_updatePlayerSource(){N.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const s=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:i,slot:l}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&l instanceof HTMLElement){const A=FL.checkOneElementVisible(i),u=Object.assign({},A);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const p=kt.reportApiInvoke(null,{tag:br.TRACER,name:kr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(s){throw new Me(W.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Me(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(pa.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(pa.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(dp.SEI_RECEIVED,e)}}).prototype,"play",[mU],Object.getOwnPropertyDescriptor(uc.prototype,"play"),uc.prototype),Vs(uc.prototype,"stop",[fU],Object.getOwnPropertyDescriptor(uc.prototype,"stop"),uc.prototype),Vs(uc.prototype,"pipe",[gU],Object.getOwnPropertyDescriptor(uc.prototype,"pipe"),uc.prototype),Vs(uc.prototype,"unpipe",[bU],Object.getOwnPropertyDescriptor(uc.prototype,"unpipe"),uc.prototype),uc),yf=(xU=Yt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),vU=Yt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),wU=Yt({argsMap:(e,t)=>[e.getTrackId(),t]}),_U=Yt({argsMap:e=>[e.getTrackId()]}),yU=Yt({argsMap:e=>[e.getTrackId()]}),EU=Yt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),SU=Yt({argsMap:e=>[e.getTrackId()]}),Vs((Ci=class extends CU{get isPlaying(){return this._useAudioElement?ea.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,s,r){super(e,t,s,r),Pe(this,"trackMediaType",bf.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),G("DISABLE_WEBAUDIO")?(this._source=new nN,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new tN(e,!0),G("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(jo.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ac.FIRST_FRAME_DECODED)}),this.processorContext=new Fj(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Uj(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(jo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(jo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(jo.ON_AUDIO_BUFFER),this._source.on(jo.ON_AUDIO_BUFFER,s=>e(s))}setVolume(e){this._volume=e,this._useAudioElement?ea.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(ea.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,G("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!gj())throw new Me(W.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ea.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?ea.getVolume(this.getTrackId()):this._source instanceof tN?this._source.getAudioVolume():0}getStats(){return Cu(()=>{N.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),fo(this,Bt.GET_STATS)||Er({},yj)}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] use audio element to play")),ea.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(N.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ea.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ea.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Me(W.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Me(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Me(W.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(pa.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(pa.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(pa.ON_TRACK),this.processorDestination.removeAllListeners(pa.ON_NODE)}}).prototype,"setVolume",[xU],Object.getOwnPropertyDescriptor(Ci.prototype,"setVolume"),Ci.prototype),Vs(Ci.prototype,"setAmplifiedVolume",[vU],Object.getOwnPropertyDescriptor(Ci.prototype,"setAmplifiedVolume"),Ci.prototype),Vs(Ci.prototype,"setPlaybackDevice",[wU],Object.getOwnPropertyDescriptor(Ci.prototype,"setPlaybackDevice"),Ci.prototype),Vs(Ci.prototype,"play",[_U],Object.getOwnPropertyDescriptor(Ci.prototype,"play"),Ci.prototype),Vs(Ci.prototype,"stop",[yU],Object.getOwnPropertyDescriptor(Ci.prototype,"stop"),Ci.prototype),Vs(Ci.prototype,"pipe",[EU],Object.getOwnPropertyDescriptor(Ci.prototype,"pipe"),Ci.prototype),Vs(Ci.prototype,"unpipe",[SU],Object.getOwnPropertyDescriptor(Ci.prototype,"unpipe"),Ci.prototype),Ci);const go=new class extends jr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),Pe(this,"needUploadStats",[]),Pe(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),N.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class NU extends jr{constructor(t,s){super(),Pe(this,"trackMediaType",bf.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),Pe(this,"_datachannelEventMap",new Map),this._config=t,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return G("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,s;return(t=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,s;return(t=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new mt((t,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;s(new Me(W.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new Me(W.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Me(W.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[bw.OPEN,bw.CLOSE,bw.ERROR].forEach(s=>{const r=()=>{this.emit(s)};this._datachannelEventMap.set(s,r),t.addEventListener(s,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[r,i]=s;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class GZ extends NU{constructor(t){super(t),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=s.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(G("SHOW_DATASTREAM2_LOG")&&N.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let l=s.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(bw.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class KZ extends NU{send(t){if(this._originDataChannel){let s=t;s=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function yw(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>_v.revokeObjectURL(e),0),new Worker(_v.createObjectURL(e))}const TU=71,cN=1,lN=2,dN=1,RU=2;var Tu=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Tu||{});function AN(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=e.getUint8(0);if(s!==TU)return;const r=e.getUint16(1),i=cN+lN+r,l=new Uint8Array(e.byteLength-i);l.set(new Uint8Array(e.buffer,i,e.byteLength-i));const A={m:s,tlvLen:r,tlv:[],frame:l};let u=cN+lN;for(;u<i;){const p=e.getUint8(u),f=e.getUint16(u+dN),b=dN+RU;if(p===Tu.AUDIO_LEVEL){let w=e.getUint8(u+b);for(let _=1;_<f;_++)w=w<<8|e.getUint8(u+b+_);A.tlv.push({tag:p,length:f,value:t?127^w>>1:127&w})}else if(p===Tu.METADATA||p===Tu.AUDIO_64_BIT_PTS){const w=new Uint8Array(f);for(let _=0;_<f;_++)w[_]=e.getUint8(u+b+_);A.tlv.push({tag:p,length:f,value:w})}u+=b+f}return A}const Ew=new Map,Sw=127,hp=1e-10,uN=139/13,Cw=new Map;function hN(e,t,s){const r="".concat(e,"-").concat(t,"-").concat(s);let i=0;return Cw.has(r)?i=Cw.get(r):(i=Math.log(function(A,u){const p=A-u;u<p&&(u=p);let f=1;for(let b=A,w=1;b>u;b--,w++)f=f*b/w;return f}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(s)+s*e,Cw.set(r,i)),i<hp&&(i=hp),i}function IU(e,t,s){const r=t.length,i=e.length/r;let l=!1;for(let A=0,u=0;A<r;A++){let p=0;for(let f=u+i;u<f;u++)e[u]>s&&p++;t[A]!==p&&(t[A]=p,l=!0)}return l}window.cache=Cw;let WZ=0;class OU{constructor(t){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",hp),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",hp),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",hp),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=t||"".concat(WZ++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,s=this.levels,r=this.minLevel+uN;let i=!1;for(let l=0;l<t.length;++l){let A=s[l];A<r&&(A=0);const u=Math.floor(A/uN);t[l]!==u&&(t[l]=u,i=!0)}return i}computeLongs(){return IU(this.mediums,this.longs,4)}computeMediums(){return IU(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=hN(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=hN(this.longs[0],10,47),this.longSpeechActivityScore>hp&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=hN(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(ym(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let r=t;return t<0&&(r=0),t>Sw&&(r=Sw),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+uN?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>Sw&&(s=Sw),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class zZ{constructor(t){Pe(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?t=!0:setTimeout(this.execute.bind(this),s)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class pN{constructor(t,s,r){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=s,this.energyScore=r}}class qZ extends jr{constructor(t){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,s!=null&&(this.energyExpireTimeMs=s),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(s=>s.id===t)}levelChanged(t,s){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const l=i.levelChanged(s,r);return this.updateLoudestList(i,l,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(t){t.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(t){let s=this.speakers.get(t);return s||(s=new OU(t),this.speakers.set(t,s),this.maybeStartDecisionMaker()),s}updateLoudestList(t,s,r){const i=t.id===this.dominantId;if(s<0){let p=0;for(;p<this.loudest.length&&this.loudest[p]!==t;)++p;return new pN(i,p,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new pN(i,0,t.energyScore);const l=r-this.energyExpireTimeMs;let A=0;for(;A<this.loudest.length;){const p=this.loudest[A];if(p.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(A,1);else if(p.id!==t.id)++A;else if(this.loudest.splice(A,1),this.loudest.length<this.numLoudestToTrack)break}let u=0;for(;u<this.loudest.length&&!(this.loudest[u].energyScore<t.energyScore);)++u;return u<this.numLoudestToTrack&&(this.loudest.splice(u,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new pN(i,u,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new zZ(this),this.decisionMaker.execute())}makeDecision(t){let s=null,r=null;const i=this.speakers.size;let l=null;if(i===0)l=null;else if(i===1){var A;const u=ho(A=this.speakers).call(A).next().value;this.enableSilence&&u&&(l=u.id,u.evaluateSpeechActivityScores(t),t-u.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let u=this.dominantId==null?null:this.speakers.get(this.dominantId);if(u==null){const b=this.speakers.entries().next();b.value&&(l=b.value[0],u=b.value[1])}else l=u.id;u!=null&&u.evaluateSpeechActivityScores(t);const p=this.relativeSpeechActivities;let f=2;for(const b of this.speakers.entries()){const[w,_]=b;if(_===u)continue;_.evaluateSpeechActivityScores(t);for(let j=0;j<p.length;++j){const K=u==null?hp:u.getSpeechActivityScore(j);p[j]=Math.log(_.getSpeechActivityScore(j)/K)}const C=p[0],U=p[1],B=p[2];C>3&&U>2&&B>0&&U>f&&(f=U,l=w)}this.enableSilence&&u!=null&&l===u.id&&t-u.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(s=this.dominantId,this.dominantId=l,r=this.dominantId),r==null&&!this.enableSilence||r===s||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),s=300-(t-this.lastLevelIdleTime);let r=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=s;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const s=[];for(const i of ho(r=this.speakers).call(r)){var r;const l=t-i.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||i.id!==this.dominantId)?s.push(i.id):300<l&&i.levelTimedOut()}s.forEach(i=>this.speakers.delete(i))}}const Ef=new Map;let Dl=null,Nw=null;const kU=3;let pp=[];const Bl=new Map,Tw=new Map;class YZ{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=t,this.track=s,this.setActive(Bl.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:r}=function(){const i=[],l=[];return Array.from(ho(Bl).call(Bl)).forEach(A=>{A.active?i.push(A):l.push(A)}),{actives:i,inactives:l}}();if(s.length>3){let i;s.forEach(l=>{(!i||i.score>l.score)&&(i=l)}),i&&i.setActive(!1)}if(s.length<3&&r.length>0){let i;r.forEach(l=>{(!i||i.score<l.score)&&l.id!==this.id&&(i=l)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(s){let r;return Array.from(ho(Bl).call(Bl)).forEach(i=>{!i.active||i.id===s||i.samples<40||(!r||i.score<r.score)&&(r=i)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(s){let r;return Array.from(ho(Bl).call(Bl)).forEach(i=>{i.active||i.id===s||i.samples<40||(!r||i.score>r.score)&&(r=i)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Rw;function DU(e){const t=Bl.get(e);t&&(Bl.delete(e),t.clearTimer())}const Iw=new Map,XZ=new Map,mN="video/h264",fN="video/h265";function BU(e,t,s){let r=new Uint8Array(e,t,s),i=[],l=0;for(;i.length<s;)l+3<s&&r[l]===0&&r[l+1]===0&&r[l+2]===3&&(r[l+3]===0||r[l+3]===1||r[l+3]===2||r[l+3]===3)?(i.push(r[l],r[l+1],r[l+3]),l+=4):(i.push(r[l]),l++);return new Uint8Array(i)}function LU(e){const t=e.length;let s=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(s.push(e[r],e[r+1],3,e[r+2]),r+=3):(s.push(e[r]),r++);return new Uint8Array(s)}function jU(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const s=t+(e[t+2]===0?4:3);if(s>=e.length)return"";const r=e[s];return 128&r?"":(r>>1&63)>=32||s+1<e.length&&!(248&e[s+1])?fN:(31&r)<=31?mN:""}const Ow=new Map,V0=new Map;(function(){const e=zs();Hn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Hn.getStreamFromExtension=e.name===Ys.CHROME&&Number(e.version)>34,Hn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let s=!1;try{t.addTransceiver("audio"),s=!0}catch{}return t.close(),s}(),Hn.supportMinBitrate=e.name===Ys.CHROME||e.name===Ys.EDGE,Hn.supportSetRtpSenderParameters=function(){const t=zs();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Sd()||!(!Jn()&&!nw())||t.name===Ys.FIREFOX&&Number(t.version)>=64)}(),e.name===Ys.SAFARI&&(Number(e.version)>=14?Hn.supportDualStream=!0:Hn.supportDualStream=!1),Hn.webAudioMediaStreamDest=function(){const t=zs();return!(t.name===Ys.SAFARI&&Number(t.version)<12)}(),Hn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Hn.supportWebGL=typeof WebGLRenderingContext<"u",Hn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Sd()||(Hn.webAudioWithAEC=!0),Hn.supportShareAudio=function(){const t=zs();return(t.os===Vn.WIN_10||t.os===Vn.WIN_81||t.os===Vn.WIN_7||t.os===Vn.LINUX||t.os===Vn.MAC_OS||t.os===Vn.CHROMIUM_OS)&&t.name===Ys.CHROME&&Number(t.version)>=74}(),Hn.supportDataChannel=!!(Ol(76)||v1(68)||NL(14)),Hn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Tr()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Hn.supportWebRTCEncodedTransform=Ol(87)||EL()||v1(117),Hn.supportWebRTCInsertableStream=function(){const t=zs();return(t.name===Ys.CHROME||t.name===Ys.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Hn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Hn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Hn.supportSuppressLocalAudioPlayback=vj(),Hn.supportRestrictOwnAudio=wj(),aw(()=>{Hn.supportDualStreamEncoding=function(){const t=zs();return!!G("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&G("CHROME_DUAL_STREAM_USE_ENCODING"))}(),N.debug("browser ua: ",navigator.userAgent),N.info("browser info: ",e),N.info("browser compatibility: ",Hn)})})();const JZ=["CHINA","GLOBAL"],PU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],mp=[],Sf=[];function fp(e,t){return!!t&&mp.some(s=>s.uid===e&&s.channelName===t)}function gN(){return Sf.length>0}var $Z=GD.forEach,UU=Lh("forEach")?[].forEach:function(e){return $Z(this,e,arguments.length>1?arguments[1]:void 0)};Ts({target:"Array",proto:!0,forced:[].forEach!==UU},{forEach:UU});var ZZ=wi("Array","forEach"),eee=To,tee=Un,see=k,ree=ZZ,bN=Array.prototype,nee={DOMTokenList:!0,NodeList:!0},iee=function(e){var t=e.forEach;return e===bN||see(bN,e)&&t===bN.forEach||tee(nee,eee(e))?ree:t},aee=h(iee),oee=yo,FU=Se;Ts({target:"Object",stat:!0,forced:m(function(){FU(1)})},{keys:function(e){return FU(oee(e))}});var cee=h($e.Object.keys),lee=h(wm),dee=h(Rx),Aee=Ts,MU=hA,uee=ev,hee=et,VU=Ic,pee=No,mee=Rt,fee=XS,gee=Ur,bee=bu,xee=BD("slice"),vee=gee("species"),xN=Array,wee=Math.max;Aee({target:"Array",proto:!0,forced:!xee},{slice:function(e,t){var s,r,i,l=mee(this),A=pee(l),u=VU(e,A),p=VU(t===void 0?A:t,A);if(MU(l)&&(s=l.constructor,(uee(s)&&(s===xN||MU(s.prototype))||hee(s)&&(s=s[vee])===null)&&(s=void 0),s===xN||s===void 0))return bee(l,u,p);for(r=new(s===void 0?xN:s)(wee(p-u,0)),i=0;u<p;u++,i++)u in l&&fee(r,i,l[u]);return r.length=i,r}});var _ee=wi("Array","slice"),yee=k,Eee=_ee,vN=Array.prototype,See=function(e){var t=e.slice;return e===vN||yee(vN,e)&&t===vN.slice?Eee:t},Cee=h(See);function ft(e,t,s,r,i){var l,A,u,p={};return aee(l=cee(r)).call(l,function(f){p[f]=r[f]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=lee(A=dee(u=Cee(s).call(s)).call(u)).call(A,function(f,b){return b(e,t,f)||f},p),i&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(i):void 0,p.initializer=void 0),p.initializer===void 0?(ID(e,t,p),null):p}let kw=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),wN=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),hc=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e}({}),ma=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Gt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Fs=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Lt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e}({}),Mt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),gp=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),as=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e}({}),fa=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),us=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e}({});function Dw(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw N.error("Invalid Channel Name ".concat(e)),new Le(W.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Bw(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||jL(e,1,255)))throw new Le(W.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&N.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let NA=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Nee={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},_N={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function yN(e,t){di(e.url,"".concat(t,".url"),1,1e3,!1),Kr(e.x)||gr(e.x,"".concat(t,".x"),0,1e4),Kr(e.y)||gr(e.y,"".concat(t,".y"),0,1e4),Kr(e.width)||gr(e.width,"".concat(t,".width"),0,1e4),Kr(e.height)||gr(e.height,"".concat(t,".height"),0,1e4),Kr(e.zOrder)||gr(e.zOrder,"".concat(t,".zOrder"),0,255),Kr(e.alpha)||gr(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Tee={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Ru=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),EN=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Rn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function QU(e){if(!e.channelName)throw new Le(W.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Le(W.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&di(e.token,"info.token",1,2047),Bw(e.uid),Dw(e.channelName),!0}let Oa=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),TA=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ha=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Cf=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),cr=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),nn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e}({}),Lw=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Gn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),$s=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const HU=[$s.AFRICA,$s.ASIA,$s.CHINA,$s.EUROPE,$s.GLOBAL,$s.INDIA,$s.JAPAN,$s.NORTH_AMERICA,$s.OCEANIA,$s.OVERSEA,$s.SOUTH_AMERICA];let Bi=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const jw={CHINA:{},ASIA:{CODE:Bi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Bi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Bi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Bi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Bi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Bi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Bi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Bi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Bi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Bi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Bi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Bi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Bi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};M1&&(jw.CHINA={CODE:Bi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Ll=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e}({});function GU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class KU extends jr{constructor(t,s){super(),P(this,"onICEConnectionStateChange",void 0),P(this,"onConnectionStateChange",void 0),P(this,"onDTLSTransportStateChange",void 0),P(this,"onDTLSTransportError",void 0),P(this,"onICETransportStateChange",void 0),P(this,"onFirstAudioReceived",void 0),P(this,"onFirstVideoReceived",void 0),P(this,"onFirstAudioDecoded",void 0),P(this,"onFirstVideoDecoded",void 0),P(this,"onFirstVideoRender",void 0),P(this,"onFirstVideoBufferReady",void 0),P(this,"onFirstVideoDecodedTimeout",void 0),P(this,"onSelectedLocalCandidateChanged",void 0),P(this,"onSelectedRemoteCandidateChanged",void 0),P(this,"onICECandidateError",void 0),P(this,"getLocalVideoStats",void 0)}}class Pw extends KU{constructor(t,s){super(t,s),P(this,"establishPromise",void 0)}}let Tt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Zn=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),RA=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const WU=["disconnected","failed"];let at=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),tr=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Vt=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e}({}),Wc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),zc=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ei=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Iu=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),In=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Rd=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),pc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),jl=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Nf=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),an=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Tf=function(e){return e.ABORT="abort",e}({}),Ou=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Ree=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Iee={[kw.ACCESS_POINT]:{[ma.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ma.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ma.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ma.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ma.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ma.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ma.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[kw.UNILBS]:{[hc.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[hc.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[hc.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[hc.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[hc.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[hc.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[hc.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[hc.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[hc.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[hc.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[hc.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[hc.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[hc.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[kw.STRING_UID_ALLOCATOR]:{[wN.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[wN.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[wN.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Rf(e){const t=Iee[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const s=t[e%1e4];if(!s){if(Math.floor(e/1e4)===kw.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Oee={[Gt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Gt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Gt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Gt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Gt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Gt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Gt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Gt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Gt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Gt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Gt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Gt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Gt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Gt.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[Gt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Gt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Gt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Gt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Gt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Gt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Gt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Gt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Gt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Gt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Gt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Gt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Gt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Gt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Gt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Gt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Gt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Gt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Gt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Gt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Gt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Gt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Gt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Gt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Gt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Gt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Gt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Gt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Gt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Gt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Gt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Gt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Gt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Gt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Gt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Gt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Gt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Gt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Gt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Gt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Gt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Gt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Gt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Gt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Gt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Gt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Gt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Gt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Gt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Gt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Gt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function bp(e){return Oee[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function zU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function SN(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?zU(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):zU(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function CN(e,t){if(typeof e=="string")return e;const{proxy:s,host:r,port:i}=e;if(t){const l=G("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(l,"/ws/?p=").concat(Number(i)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const kee=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Dee=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Bee=/wss:\/\/(.+):([0-9]+)\/?/,Lee=/wss:\/\/(.[^\/]+)\/?/;let jee=0;class Pee{constructor(t,s){P(this,"id",0),P(this,"store",void 0),P(this,"recordIndex",void 0),P(this,"websockets",[]),P(this,"try443PortDuration",2e3),P(this,"forceCloseWSDuration",5e3),P(this,"try443PortTimeout",null),P(this,"forceCloseTimeout",null),P(this,"isTry443PortFailed",!1),P(this,"isNormalPortFailed",!1),P(this,"useDoubleDomain",!1),P(this,"useProxy",!1),P(this,"startTime",Date.now()),this.id=++jee,this.try443PortDuration=G("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const s=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];N.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...i)}createWebSocket(t,s,r){this.logger("createWebSocket:",t,{isTry443Port:s,hasTimeoutDetection:r});const i=G("GATEWAY_DOMAINS"),l=Date.now(),A=[],u=i.find(_=>{var C;return nt(C=t.host).call(C,_)});u||(this.useDoubleDomain=!1);const p=[];if(this.useDoubleDomain)i.forEach(_=>{p.push(CN(SN(SN({},t),{},{host:t.host.replace(u,_)}),s))});else{const _=SN({},t);if(s&&u){const C=i.find(U=>U!==u);C&&(_.host=_.host.replace(u,C))}p.push(CN(_,s))}try{p.forEach(_=>{const C=new WebSocket(_);C.binaryType="arraybuffer",A.push(C),this.logger("ws is connecting:",C.url)})}catch(_){if(this.logger("ws create failed"),A.forEach(C=>C.close()),A.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,s,r);if(!s&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new Le(W.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}const f=R0();this.store&&this.store.recordJoinChannelService({urls:A.map(_=>_.url),service:"gateway"},this.recordIndex),A.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(C=>{C!==_&&(C.onopen=null,C.onclose=null,C.onmessage=null,C.close(),this.logger("close backup websocket: ".concat(C.url)))}),this.websockets.length=0,f.resolve(_)},_.onclose=C=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(_.readyState));const U=A.every(B=>B.readyState===WebSocket.CLOSED||B.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(U)),U&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(C.reason)),f.reject({code:C.code,reason:Lw.A_ROUND_WS_FAILED})):!s&&U&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),s?this.isTry443PortFailed=U:this.isNormalPortFailed=U},_.onmessage=C=>this.logger("".concat(_.url," onmessage: ").concat(C.data))}),this.websockets.push(...A);const b=()=>{this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())},w=()=>{if(f.isResolved)return b();zs().os===Vn.MAC_OS&&Tr()&&b(),this.createWebSocket(t,!0,!0).then(_=>{f.resolve(_)}).catch(_=>{this.isNormalPortFailed&&f.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.forceCloseTimeout=null,b()},this.forceCloseWSDuration)};return r||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,b()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",f.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(t,s,r,i){return this.useDoubleDomain=!!s,typeof t=="string"&&(t=function(l){let A,u,p;return[,A,u,p]=l.match(kee)||[],A||([,u,p]=l.match(Dee)||[]),u&&p||([,u,p]=l.match(Bee)||[]),u&&p||([,u]=l.match(Lee)||[]),u||N.warning("un-destructible url: ",l),{proxy:A,host:u,port:p||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(N.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function qU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}class YU extends jr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var s;nt(s=["tryNext","recover"]).call(s,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(us.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(us.CONNECTED):this._state==="closed"?this.emit(us.CLOSED):this._state==="failed"&&this.emit(us.FAILED))}resetReconnectCount(t){N.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,s){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],A=arguments.length>5?arguments[5]:void 0;super(),P(this,"_websocketUrl",null),P(this,"connectionID",0),P(this,"currentURLIndex",0),P(this,"urls",[]),P(this,"_reconnectMode","tryNext"),P(this,"reconnectReason",void 0),P(this,"_initMutex",void 0),P(this,"name",void 0),P(this,"_state","closed"),P(this,"reconnectInterrupter",void 0),P(this,"websocket",void 0),P(this,"retryConfig",void 0),P(this,"reconnectCount",0),P(this,"forceCloseTimeout",5e3),P(this,"onlineReconnectListener",void 0),P(this,"useCompress",void 0),P(this,"tryDoubleDomain",!1),P(this,"use443PortOnly",!1),P(this,"wsInflateLength",0),P(this,"wsDeflateLength",0),P(this,"closeEstablishingWs",()=>{}),P(this,"store",void 0),P(this,"joinGatewayRecordIndex",void 0),this.store=A,this.name=t,this.retryConfig=function(w){for(var _=1;_<arguments.length;_++){var C=arguments[_]!=null?arguments[_]:{};_%2?qU(Object(C),!0).forEach(function(U){P(w,U,C[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(C)):qU(Object(C)).forEach(function(U){Object.defineProperty(w,U,Object.getOwnPropertyDescriptor(C,U))})}return w}({},s),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=l,this._initMutex=new $n("websocket",A?A.clientId:void 0);const{timeout:u,timeoutFactor:p}=s,f=Math.max(300,Math.floor(3*u/5)),b=Math.max(1.2,Math.floor(8*p)/10);ua.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=b),Wr.on(sp.NETWORK_STATE_CHANGE,(w,_)=>{w!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(w)),w===ua.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=b):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p))})}getConnection(){return this.websocket||void 0}async init(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=t,this.state="connecting";try{var i;const l=R0(),A=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),function(u){return!(mw()||G("USE_NEW_TOKEN")||!G("ENABLE_PREALLOC_PC")&&(u==null||!u.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(In.PRE_CONNECT_PC),this.createWebSocketConnection(A).then(l.resolve).catch(l.reject),this.once(us.CLOSED,()=>{l.reject(new Me(W.WS_DISCONNECT))}),this.once(us.CONNECTED,l.resolve),await l.promise}catch{}finally{r()}}close(t,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;s?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,s){if(!this.websocket)return void N.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),N.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:s})}sendMessage(t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Me(W.WS_ABORT,"websocket is not ready");try{s||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new Me(W.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var s;const r=R0();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=b=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),N.debug("[".concat(this.name,"] websocket opened:"),b),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},l=async b=>{var w;if(N.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new Me(W.WS_DISCONNECT,"websocket close: ".concat(b.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const _=fo(this,us.WILL_RECONNECT,this.reconnectMode,b.reason)||this.reconnectMode,C=await this.reconnectWithAction(_);if(this.state==="closed")return void N.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!C)return r.reject(new Me(W.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),this.close(!0);r.resolve()}},A=b=>{this.emit(us.ON_MESSAGE,b)},u=b=>{N.warn("[".concat(this.connectionID,"] ws open error ").concat(b))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),G("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=G("GATEWAY_WSS_ADDRESS")),N.debug("[".concat(this.name,"] start connect, url:"),t);const p=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;this._websocketUrl=CN(t);const b=await this.chooseBestWebsocketConnection(t);this.websocket=b,i&&i(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=A,this.websocket.onerror=u,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this.joinGatewayRecordIndex=p}catch(b){const w=this.state==="closed",_=b instanceof Me,C=_&&b.code===W.WS_ABORT,U=_&&b.code===W.WS_ERR,B=_?b.message:b&&(b.reason||b.toString());N.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(B)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:C?"aborted":"error",errors:[b]},p),w||U?(r.reject(w?new Me(W.WS_DISCONNECT,"websocket is closed: ".concat(B)):new Me(W.WS_ERR,"init websocket failed: ".concat(B))),U&&N.error("[".concat(this.name,"] init websocket failed: ").concat(B))):l&&l(b)}return r.promise}async reconnectWithAction(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;N.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Wr.isOnline||!Wr.onlineWaiter||(this.onlineReconnectListener=Wr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,s){const A=ow(this.reconnectCount,this.retryConfig);N.debug("[".concat(this.name,"] wait ").concat(A,"ms to reconnect websocket, mode: ").concat(t)),await mt.race([Qn(A),this.onlineReconnectListener||new mt(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(A,u)=>{this.emit(us.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(A)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);N.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(N.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await wn(this,us.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(A){var l;N.error("[".concat(this.name,"] reconnect failed ").concat(A&&A.toString()));const u=A==null||(l=A.data)===null||l===void 0?void 0:l.desc;if(Array.isArray(u)){if(nt(u).call(u,"dynamic key expired"))return this.emit(us.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(nt(u).call(u,"request downgrade fallback"))return this.emit(us.ON_FALLBACK),!1}return this.reconnectWithAction(t,s)}return!0}}class NN extends YU{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,s){const r=R0(),i=function(A,u){return new Pee(A,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new Me(W.WS_ABORT,"choose best websocket aborted"))};const l=G("GATEWAY_DOMAINS");return N.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,s).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Q0 extends YU{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,s){return new mt((r,i)=>{let l=!1;const A=[];this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),A.forEach(U=>{U.onclose=null,U.onopen=null,U.onmessage=null,U.close()}),i(new Me(W.WS_ABORT,"choose best websocket aborted"))};const u=G("GATEWAY_DOMAINS");let p;const f=t.indexOf("?h="),b=u.find(U=>f!==-1?nt(t).call(t,U,f):nt(t).call(t,U));N.debug("[choose-best-ws] currentDomain: ",b,", domains: ",u);let w=!this.tryDoubleDomain||!b;if(!w&&b){var _;const U=Date.now();try{u.forEach(B=>{const j=f===-1?t.replace(b,B):t.substr(0,f)+t.substr(f).replace(b,B),K=new WebSocket(j);K.binaryType="arraybuffer",A.push(K),N.debug("[choose-best-ws] ws is connecting:",K.url)})}catch{for(N.debug("[choose-best-ws] ws create failed, fallback to single url"),A.forEach(j=>j.close());A.length;)A.pop();w=!0}(_=this.store)===null||_===void 0||_.recordJoinChannelService({urls:A.map(B=>B.url),service:"gateway"},s),A.forEach(B=>{B.onopen=()=>{if(l)return;const j=Date.now()-U;N.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),A.filter(K=>K!==B).forEach(K=>{N.debug("[choose-best-ws]close backup websocket: ".concat(K.url)),K.close()}),l=!0,r(B)},B.onclose=j=>{p=j,!l&&(A.find(K=>!(K.readyState===WebSocket.CLOSED||K.readyState===WebSocket.CLOSING))||(N.debug("[choose-best-ws] all websocket is closed"),l=!0,i(p)))},B.onmessage=j=>{N.debug("[choose-best-ws]".concat(B.url," onmessage: ").concat(j.data))}}),Qn(this.forceCloseTimeout).then(()=>{A.forEach(B=>{B.readyState!==WebSocket.OPEN&&B.close()})})}if(w){var C;let U;N.debug("[choose-best-ws] use single url: ",t),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[t],service:"gateway"},s);try{U=new WebSocket(t),A.push(U),U.binaryType="arraybuffer"}catch(B){const j=new Me(W.WS_ERR,"init websocket failed! Error: ".concat(B.toString()));return N.error("[".concat(this.name,"]").concat(j)),void i(j)}U.onopen=()=>{r(U)},U.onclose=B=>{i(B)},U.onmessage=B=>{N.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(B.data))},Qn(this.forceCloseTimeout).then(()=>{U&&U.readyState!==WebSocket.OPEN&&U.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class XU extends jr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Fs.CONNECTED?this.emit(Lt.WS_CONNECTED):t===Fs.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):t===Fs.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,s){super(),P(this,"__name__","AgoraRTCSignal"),P(this,"_disconnectedReason",void 0),P(this,"_websocketReconnectReason",void 0),P(this,"_connectionState",Fs.CLOSED),P(this,"reconnectToken",void 0),P(this,"websocket",void 0),P(this,"openConnectionTime",void 0),P(this,"clientId",void 0),P(this,"lastMsgTime",Date.now()),P(this,"uploadCache",[]),P(this,"uploadCacheInterval",void 0),P(this,"rttRolling",new D1(5)),P(this,"pingpongTimer",void 0),P(this,"wsInflateDataTimer",void 0),P(this,"pingpongTimeoutCount",0),P(this,"ortc",void 0),P(this,"joinResponse",void 0),P(this,"multiIpOption",void 0),P(this,"initError",void 0),P(this,"spec",void 0),P(this,"store",void 0),P(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const l="res-@".concat(i._id);this.emit(l,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===as.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===as.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Us.UID_BANNED);break;case 15:this.close(Us.IP_BANNED);break;case 16:this.close(Us.CHANNEL_BANNED)}if(i._type===as.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Gt.ERR_LICENSE_MISSING:this.close(Us.LICENSE_MISSING);break;case Gt.ERR_LICENSE_EXPIRED:this.close(Us.LICENSE_EXPIRED);break;case Gt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Us.LICENSE_MINUTES_EXCEEDED);break;case Gt.ERR_LICENSE_PERIOD_INVALID:this.close(Us.LICENSE_PERIOD_INVALID);break;case Gt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Us.LICENSE_MULTIPLE_SDK_SERVICE);break;case Gt.ERR_LICENSE_ILLEGAL:this.close(Us.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new NN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Fs.CONNECTED&&this.reconnect("retry",yi.OFFLINE)})}async request(t,s,r,i){const l=ar(6,""),A={_id:l,_type:t,_message:s},u=this.websocket.connectionID,p=()=>new mt((U,B)=>{if(this.connectionState===Fs.CONNECTED)return U();const j=()=>{this.off(Lt.WS_CLOSED,K),U()},K=()=>{this.off(Lt.WS_CONNECTED,j),B(new Le(W.WS_ABORT))};this.once(Lt.WS_CONNECTED,j),this.once(Lt.WS_CLOSED,K),t!==Mt.PUBLISH&&t!==Mt.PUBLISH_DATASTREAM&&t!==Mt.SUBSCRIBE&&t!==Mt.SUBSCRIBE_DATASTREAM&&t!==Mt.UNSUBSCRIBE&&t!==Mt.UNSUBSCRIBE_DATASTREAM&&t!==Mt.UNPUBLISH&&t!==Mt.UNPUBLISH_DATASTREAM&&t!==Mt.CONTROL&&t!==Mt.RESTART_ICE||this.once(Lt.DISCONNECT_P2P,()=>{B(new Le(W.DISCONNECT_P2P))}),t!==Mt.PUBLISH&&t!==Mt.RESTART_ICE||this.once(Lt.ABORT_P2P_EXECUTION,()=>{B(new Le(W.DISCONNECT_P2P))})});if(this.connectionState!==Fs.CONNECTING&&this.connectionState!==Fs.RECONNECTING||t===Mt.JOIN||t===Mt.REJOIN||await p(),this.websocket.sendMessage(A,!0),i)return;const f=new mt((U,B)=>{let j=!1;const K=(ie,xe)=>{j=!0,U({isSuccess:ie==="success",message:xe||{}}),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.emit(Lt.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(l),K);const q=()=>{B(new Le(W.WS_ABORT,"type: ".concat(t))),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.off("res-@".concat(l),K)};this.once(Lt.WS_CLOSED,q),this.once(Lt.WS_RECONNECTING,q),Qn(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||j||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Lt.REQUEST_TIMEOUT,t,s))})});let b=null;try{b=await f}catch(U){if(this.connectionState===Fs.CLOSED||t===Mt.LEAVE)throw new Le(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?U.throw():t===Mt.JOIN||t===Mt.REJOIN?null:(await p(),await this.request(t,s))}if(b.isSuccess)return b.message;const w=Number(b.message.error_code||b.message.code),_=bp(w),C=new Le(W.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(b.message.error_str),{code:w,data:b.message,desc:_.desc});return _.action==="success"?b.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(_.desc,", action: ").concat(_.action)),w===Gt.ERR_TOO_MANY_BROADCASTERS?((t===Mt.JOIN||t===Mt.REJOIN)&&(this.initError=C,this.close()),C.throw()):_.action==="failed"?C.throw():_.action==="quit"?(this.initError=C,this.close(),C.throw()):(w===Gt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yi.MULTI_IP)):this.reconnect(_.action,yi.SERVER_ERROR),t===Mt.JOIN||t===Mt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new mt(r=>{const i=l=>{(!s||s(l))&&(this.off(t,i),r(l))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(gp.WRTC_STATS,s)}upload(t,s){const r={_type:t,_message:s};try{this.websocket.sendMessage(r)}catch{const l=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Fs.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,s){const r={_type:t,_message:s};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new mt((s,r)=>{this.once(Lt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Lt.WS_CLOSED,i=>r(this.initError||new Le(W.WS_ABORT,i))),this.connectionState=Fs.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Us.LEAVE,this.connectionState=Fs.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await wn(this,Lt.REQUEST_JOIN_INFO);this.store.joinReq();const s=await this.request(Mt.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!s)return this.emit(Lt.REPORT_JOIN_GATEWAY,Lw.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Fs.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Le(W.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=rp(this,Lt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const s=await this.request(Mt.REJOIN,t);return!!s&&(this.connectionState=Fs.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(r=>{this.emit(as.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(as.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(as.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(as.MUTE_AUDIO,{uid:r.uid}):this.emit(as.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(as.MUTE_VIDEO,{uid:r.uid}):this.emit(as.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(as.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(as.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(as.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(as.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(as.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){if(!this.ortc)return!1;const s={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Mt.DOWNGRADE_CODEC,s)}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);const s=bp(t.code);if(t.code===28&&"detail"in t&&(N.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Lt.RECOVER_NOTIFICATION,t.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?t.code===Gt.ERR_REPEAT_JOIN_CHANNEL&&G("IGNORE_UID_CHECK")?void this.close(Us.UID_CONFLICT):(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Us.UID_BANNED),void this.close()):t.code===Gt.K_VOS_FALLBACK&&"detail"in t?(N.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&G("ENABLE_QUALITY_FALLBACK")?void wn(this,Lt.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",s.desc)}).catch(r=>{N.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),r)}):t.detail==="fallback_hls"&&G("ENABLE_FALLBACK_TO_HLS")?(this.emit(Lt.VOS_FALLBACK,t.detail),void this.close(Us.FALLBACK_TO_HLS)):this.reconnect(s.action,s.desc)):void this.reconnect(s.action,yi.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=G("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yi.TIMEOUT):this.request(Mt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-s;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Mt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:s}=this.websocket.getWsInflateData();t!==0&&s!==0&&this.upload(gp.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(us.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(us.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(us.CLOSED,()=>{this.connectionState=Fs.CLOSED}),this.websocket.on(us.FAILED,()=>{this._disconnectedReason=Us.NETWORK_ERROR,this.connectionState=Fs.CLOSED}),this.websocket.on(us.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Fs.CONNECTED?this.connectionState=Fs.RECONNECTING:this.connectionState=Fs.CONNECTING}),this.websocket.on(us.WILL_RECONNECT,(t,s,r)=>{const i=rp(this,Lt.IS_P2P_DISCONNECTED),l=i||t!=="retry";i&&t==="retry"&&(N.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",s=Lw.P2P_DISCONNECTED),l&&(N.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Lt.REPORT_JOIN_GATEWAY,s||Lw.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Lt.DISCONNECT_P2P)),r(t)}),this.websocket.on(us.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{N.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",yi.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Le){if(t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Gt.ERR_NO_AUTHORIZED)return this.initError=new Le(W.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Us.TOKEN_EXPIRE);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yi.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(us.REQUEST_NEW_URLS,(t,s)=>{wn(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(us.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(as.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(In.PRE_CONNECT_PC,()=>{this.emit(Lt.PRE_CONNECT_PC)}),this.websocket.on(us.ON_FALLBACK,()=>{G("ENABLE_FALLBACK_TO_HLS")&&this.emit(Lt.VOS_FALLBACK,"fallback_hls")})}}let Uee=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),mn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function JU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Uw(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?JU(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):JU(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let TN=0;function qc(e){const t=G("TURN_DOMAINS");TN=(TN+1)%t.length;const s=t[TN]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(s):(N.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function Fw(e){try{const t=G("TURN_DOMAINS"),s=G("GATEWAY_DOMAINS").concat(t).find(r=>nt(e).call(e,r));return s?e.split(".".concat(s))[0].replace(/-/g,"."):e}catch{return N.debug("serverUrlToIp error, fallback to url",e),e}}function RN(e,t){e.addresses||(e.addresses=[]);const s=function(u,p){if(G("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return u.map(w=>{let{ip:_,port:C}=w;return{address:"".concat(_,":").concat(C)}});const f=G("GATEWAY_DOMAINS");let b=f[1]&&nt(p).call(p,f[1])?1:0;return u.map(w=>{let{domain_prefix:_,port:C,ip:U}=w;if(_)return{address:"".concat(_,".").concat(f[b++%f.length],":").concat(C)};const B=/^[\.\:\d]+$/.test(U),j=B?"".concat(U.replace(/[^\d]/g,"-"),".").concat(f[b++%f.length],":").concat(C):"".concat(U,":").concat(C);return B||N.debug("Cannot recognized as ip address: ".concat(U,", use as host3")),{ip:U,port:C,address:j}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const u=r.split(";");for(let p=0;p<u.length;p++){var i;const f=da(i=u[p]).call(i);s[p]&&f&&(s[p].ip6=f)}}const l=e.detail&&e.detail.candidate;let A;if(l){const[u,p]=l.split(":");u&&p&&(A={port:Number(p),ip:u,address:"".concat(u,":").concat(p)})}return{gatewayAddrs:s,apGatewayAddress:A,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function ka(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function $U(e){const t=e._encoderConfig;if(!t)return{};const s={resolution:t.width&&t.height?"".concat(ka(t.width),"x").concat(ka(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(s.maxFrameRate=t.frameRate,s.minFrameRate=t.frameRate):t.frameRate&&(s.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,s.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),s}function Mw(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function H0(e,t){let s,r,i;switch(t){case mn.CHOOSE_SERVER:r=4096,i="choose server";break;case mn.CLOUD_PROXY:r=1048576,i="proxy";break;case mn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case mn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new Le(W.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===r&&(s={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(A=>Uw(Uw({},A),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:Uw(Uw({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!s)throw new Le(W.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return s}async function ZU(e,t){return await mt.all(e.addresses.map(async s=>({address:qc(s.ip),tcpport:s.port,udpport:s.port,username:t&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Ei.username,password:t&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await C1(t.toString()):Ei.password})))}function IN(e,t){const s=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||s.height,i=t.videoWidth||s.width;return r&&i?Math.max(Math.min(r,i)/Math.min(ka(e.height),ka(e.width)),1):(N.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ku(e){let{candidateType:t,relayProtocol:s,type:r,address:i,port:l,protocol:A}=e;const u={candidateType:t,relayProtocol:s,protocol:A};if(r!=="local-candidate"){const p=i.split(".");p.length>=4&&(p[1]="*",p[2]="*"),u.address=p.join("."),u.port=l}return u}function Id(e){const t=e.split(":"),s=e.split(/[-.]/),r=nt(e).call(e,"-")?"-":".";let i=e;return t.length>1?s.length>1?(s[1]="**",i=s[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:s.length>1&&(i=s[0]+r+"**"),i}function e4(e,t){return e.getTransceivers().find(s=>s.sender.track===t||s.receiver.track===t)}function G0(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G("SVC_MODE");if(G("ENABLE_SVC"))return function(t){return t in dw}(e)?e:dw.L1T3}const t4={[Tt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Tt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function s4(e){e.send&&(If(Tt.VIDEO,e.send.videoExtensions),If(Tt.AUDIO,e.send.audioExtensions)),e.recv&&(If(Tt.VIDEO,e.recv.videoExtensions),If(Tt.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(If(Tt.VIDEO,e.sendrecv.videoExtensions),If(Tt.AUDIO,e.sendrecv.audioExtensions))}function r4(e,t){e.send&&(Vw(Tt.VIDEO,e.send.videoExtensions,t.send.videoExtensions),Vw(Tt.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(Vw(Tt.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),Vw(Tt.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function Vw(e,t,s){t.forEach(r=>{var i;const l=t4[e].find(u=>{var p;let{key:f}=u;return nt(p=r.extensionName).call(p,f)});if(!l)return;const A=s.find(u=>{let{extensionName:p}=u;return nt(p).call(p,l.key)});A&&nt(i=A.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=A.extensionName)})}function If(e,t){t.forEach(s=>{var r;const i=t4[e].find(l=>{var A;let{key:u}=l;return nt(A=s.extensionName).call(A,u)});nt(r=s.extensionName).call(r,"gdpr_forbidden")&&i&&(s.extensionName=i.extensionName)})}function n4(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||nt(e).call(e,"abs-send-time")}function Qw(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||nt(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function i4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function a4(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?i4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function K0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:l,filterAudioFec:A,filterAudioCodec:u,filterVideoCodec:p,unsupportedVideoUplinkCodec:f,unsupportedVideoDownlinkCodec:b}=t,{useXR:w}=s;let _=[],C=[],U=[],B=[],j=!1,K=!1;if(ha(e).mediaDescriptions.forEach(ie=>{r&&r!==ie.attributes.direction||(ie.media.mediaType!=="video"||j||(C=ie.attributes.payloads,B=ie.attributes.extmaps,j=!0),ie.media.mediaType!=="audio"||K||(_=ie.attributes.payloads,U=ie.attributes.extmaps,K=!0))}),!B||C.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!U||_.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(C.forEach(ie=>{var xe;(xe=ie.rtpMap)!==null&&xe!==void 0&&xe.clockRate&&(ie.rtpMap.clockRate=parseInt(ie.rtpMap.clockRate)),w&&ie.rtcpFeedbacks.push({type:"rrtr"})}),_.forEach(ie=>{var xe;(xe=ie.rtpMap)!==null&&xe!==void 0&&xe.clockRate&&(ie.rtpMap.clockRate=parseInt(ie.rtpMap.clockRate)),w&&ie.rtcpFeedbacks.push({type:"rrtr"})}),i&&(_=_.filter(ie=>{var xe;return((xe=ie.rtpMap)===null||xe===void 0?void 0:xe.encodingName.toLowerCase())!=="rtx"}),C=C.filter(ie=>{var xe;return((xe=ie.rtpMap)===null||xe===void 0?void 0:xe.encodingName.toLowerCase())!=="rtx"})),l){const ie=C.filter(ue=>{var Re;return/(red)|(ulpfec)|(flexfec)/i.test(((Re=ue.rtpMap)===null||Re===void 0?void 0:Re.encodingName)||"")}),xe=Du(ie,C).map(ue=>ue.payloadType),ye=[...ie.map(ue=>ue.payloadType),...xe];C=C.filter(ue=>!nt(ye).call(ye,ue.payloadType))}if(A&&(_=_.filter(ie=>{var xe;return!/(red)|(ulpfec)|(flexfec)/i.test(((xe=ie.rtpMap)===null||xe===void 0?void 0:xe.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(_=_.filter(ie=>{var xe;return nt(u).call(u,((xe=ie.rtpMap)===null||xe===void 0?void 0:xe.encodingName.toLowerCase())||"")})),p&&(p==null?void 0:p.length)>0){const ie=C.filter(xe=>{var ye;return nt(p).call(p,((ye=xe.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())||"")});C=ie.concat(i?[]:Du(ie,C))}const q=G("UNSUPPORTED_VIDEO_CODEC");if(q&&q.length>0){const ie=C.filter(ue=>ue.rtpMap&&nt(q).call(q,ue.rtpMap.encodingName.toLowerCase())),xe=Du(ie,C),ye=ie.concat(xe).map(ue=>ue.payloadType);C=C.filter(ue=>!nt(ye).call(ye,ue.payloadType)),N.debug("unsupportedVideoCodec: ".concat(q,", toBeRemoved: ").concat(ye))}if(f&&f.length>0&&r==="sendonly"){const ie=C.filter(ue=>ue.rtpMap&&nt(f).call(f,ue.rtpMap.encodingName.toLowerCase())),xe=Du(ie,C),ye=ie.concat(xe).map(ue=>ue.payloadType);C=C.filter(ue=>!nt(ye).call(ye,ue.payloadType)),N.debug("unsupportedVideoUplinkCodec: ".concat(f,", toBeRemoved: ").concat(ye))}if(b&&b.length>0&&r==="recvonly"){const ie=C.filter(ue=>ue.rtpMap&&nt(b).call(b,ue.rtpMap.encodingName.toLowerCase())),xe=Du(ie,C),ye=ie.concat(xe).map(ue=>ue.payloadType);C=C.filter(ue=>!nt(ye).call(ye,ue.payloadType)),N.debug("unsupportedVideoDownlinkCodec: ".concat(b,", toBeRemoved: ").concat(ye))}return{audioCodecs:_,videoCodecs:C,audioExtensions:U,videoExtensions:B}}function Od(e){const t=ha(e);let s,r;for(const i of t.mediaDescriptions){if(!s){const l=i.attributes.iceUfrag,A=i.attributes.icePwd;if(!l||!A)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:l,icePwd:A}}if(!r){const l=i.attributes.fingerprints;l.length>0&&(r={fingerprints:l})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:r}}function ON(e,t){const s=[],r=e.attributes.ssrcGroups.filter(A=>A.semantic==="FID"),i=e.attributes.ssrcGroups.find(A=>A.semantic==="SIM"),l=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(A=>{var u;const p=(u=r.find(f=>f.ssrcIds[0]===A))===null||u===void 0?void 0:u.ssrcIds[1];s.push({ssrcId:A,rtx:t?p:void 0})});else if(r.length>0){const A=r[0].ssrcIds[0],u=r[0].ssrcIds[1];s.push({ssrcId:A,rtx:t?u:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:l[0].ssrcId})}return s}function o4(e,t,s){const{cname:r}=e;let i=[];t&&(i=c4(t)),i.length===0&&(i=e.iceParameters.candidates.map(b=>({foundation:b.foundation,componentId:"1",transport:b.protocol,priority:b.priority.toString(),connectionAddress:b.ip,port:b.port.toString(),type:b.type,extension:{}})),N.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(b=>({hashFunction:b.algorithm,fingerprint:b.fingerprint}))},A={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let u;switch(e.dtlsParameters.role){case"server":u="passive";break;case"client":u="active";break;case"auto":u="actpass"}const p=z0(e.rtpCapabilities),f=[];return Array.isArray(s)&&s.length>0&&s.forEach(b=>{f.push({kind:Tt.VIDEO,ssrcMsg:[{ssrcId:b.v,rtx:b.v_rtx}],mslabel:"".concat(b.v,"_").concat(b.a)},{kind:Tt.AUDIO,ssrcMsg:[{ssrcId:b.a}],mslabel:"".concat(b.v,"_").concat(b.a)})}),{dtlsParameters:l,iceParameters:A,candidates:i,rtpCapabilities:p,setup:u,cname:r,preSSRCs:f}}function c4(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],N.debug("Using remote candidate from AP ".concat(Id(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),N.debug("Using IPV6 remote candidate from AP ".concat(Id(e.ip6),":").concat(e.port)))),t}function W0(e,t,s){const r=[],i=[];return e.forEach(l=>{let{ssrcId:A,rtx:u}=l;const p=ar(8,"track-"),f={ssrcId:A,attributes:a4({label:p,mslabel:s=s||ar(10,""),msid:"".concat(s," ").concat(p)},t&&{cname:t})};if(r.push(f),u!==void 0){const b={ssrcId:u,attributes:a4({label:p,mslabel:s,msid:"".concat(s," ").concat(p)},t&&{cname:t})};r.push(b),i.push({semantic:"FID",ssrcIds:[A,u]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:A}=l;return A})}),{ssrcs:r,ssrcGroups:i}}function xp(e,t){t instanceof $r&&e.attributes.payloads.forEach(s=>{var r;const i=(r=s.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),i==="opus"&&typeof G("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=G("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(l.bitrate&&!Tr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),t instanceof M0&&i==="opus"&&t._config.DTX&&(s.fmtp.parameters.usedtx="1"))})}function kN(e){const t=e.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function DN(e,t){var s;if(e.attributes.payloads.forEach(i=>{var l;((l=i.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())==="h264"&&i.fmtp&&i.fmtp.parameters&&G("ENABLE_UP_SPS_PPS")&&(i.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof xr&&t._encoderConfig&&t._hints.indexOf(rr.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ls().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var l,A;nt(l=["h264","h265","vp8","vp9","av1"]).call(l,((A=i.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ls().supportMinBitrate&&!nt(s=t._hints).call(s,rr.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var l,A;nt(l=["h264","h265","vp8","vp9","av1"]).call(l,((A=i.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(G("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function l4(e){if(e.media.mediaType!=="video")return;const t=zs();if(t.name!==Ys.SAFARI&&t.os!==Vn.IOS)return;const s=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1)}function Hw(e,t,s){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=s.videoExtensions,i=s.videoCodecs):(r=s.audioExtensions,i=s.audioCodecs),t.twcc===!0){const l=r.find(A=>Qw(A.extensionName));if(l){const A=l.extensionName;e.attributes.extmaps.find(p=>Qw(p.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:A}),function(p,f){return f.filter(b=>!!p.find(w=>w.payloadType===b.payloadType&&!!w.rtcpFeedbacks.find(_=>_.type==="transport-cc")))}(i,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(f=>f.type==="transport-cc")||p.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(A=>Qw(A.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(A=>{const u=A.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");u!==-1&&A.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){const l=r.find(A=>n4(A.extensionName));if(l){const A=l.extensionName;e.attributes.extmaps.find(p=>p.extensionName===A)||e.attributes.extmaps.push({entry:l.entry,extensionName:A}),function(p,f){return f.filter(b=>!!p.find(w=>w.payloadType===b.payloadType&&!!w.rtcpFeedbacks.find(_=>_.type==="goog-remb")))}(i,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(f=>f.type==="goog-remb")||p.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(A=>n4(A.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(A=>{const u=A.rtcpFeedbacks.findIndex(p=>p.type==="goog-remb");u!==-1&&A.rtcpFeedbacks.splice(u,1)})}}function BN(e,t,s){if(Tr()||e.media.mediaType!=="video"||!(t instanceof xr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!G("SIMULCAST")||s==="vp9"&&G("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=s==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===i.ssrcId),A={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let u=1;u<r;u++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+u,attributes:Rr(i.attributes)}),A.ssrcIds.push(i.ssrcId+u),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+u,attributes:Rr(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+u,l.ssrcIds[1]+u]}));e.attributes.ssrcGroups.unshift(A)}async function d4(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:dw.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const s=ha(t.sdp).mediaDescriptions[0];if(!s)return;const r=s.attributes.extmaps.find(i=>i.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),r}catch{return}}async function LN(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const r=(await s.createOffer()).sdp,{send:i,recv:l,sendrecv:A}=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const b=K0(f,u,p,"sendonly"),w=K0(f,u,p,"recvonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yc(b,w,"videoExtensions",_,C,U),Yc(b,w,"videoCodecs",_,C,U),Yc(b,w,"audioExtensions",_,C,U),Yc(b,w,"audioCodecs",_,C,U),G("RAISE_H264_BASELINE_PRIORITY")){const B=[],j=[];if(U.videoCodecs.forEach((K,q)=>{var ie;if(((ie=K.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLocaleLowerCase())==="h264"){var xe,ye;const ue=U.videoCodecs[q+1],Re=ue&&p4(K,ue),Ge=(xe=K.fmtp)===null||xe===void 0?void 0:xe.parameters["profile-level-id"],Ze=(ye=K.fmtp)===null||ye===void 0?void 0:ye.parameters["packetization-mode"];!Ge||Ge!==G("FIRST_H264_PROFILE_LEVEL_ID")||G("FIRST_PACKETIZATION_MODE")&&Ze!==G("FIRST_PACKETIZATION_MODE")?Re?j.push([K,ue]):j.push([K]):Re?B.push([K,ue]):B.push([K])}}),B.length>0&&j.length>0){N.debug("raising H264 baseline profile priority"),U.videoCodecs.forEach((q,ie)=>{var xe;if(((xe=q.rtpMap)===null||xe===void 0?void 0:xe.encodingName.toLocaleLowerCase())==="h264"){const ye=p4(q,U.videoCodecs[ie+1]),ue=B.shift()||j.shift()||[];ue.length>0&&(ye?U.videoCodecs.splice(ie,2,...ue):U.videoCodecs.splice(ie,1,...ue))}});const K=C.videoCodecs.filter(q=>{var ie,xe;return((ie=q.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLocaleLowerCase())==="h264"&&((xe=q.fmtp)===null||xe===void 0?void 0:xe.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID")});if(K.length>0){const q=Du(K,C.videoCodecs).map(xe=>xe.payloadType),ie=[...K.map(xe=>xe.payloadType),...q];C.videoCodecs=C.videoCodecs.filter(xe=>!nt(ie).call(ie,xe.payloadType))}G("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(q=>{var ie,xe;return!(((ie=q.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLocaleLowerCase())==="h264"&&((xe=q.fmtp)===null||xe===void 0?void 0:xe.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:_,recv:C,sendrecv:U}}return{send:_,recv:C,sendrecv:U}}(e,t,r);try{s.close()}catch{}return{send:i,recv:l,sendrecv:A}}function A4(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=K0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yc(e,t,"videoExtensions",s,r,i),Yc(e,t,"videoCodecs",s,r,i),Yc(e,t,"audioExtensions",s,r,i),Yc(e,t,"audioCodecs",s,r,i),G("RAISE_H264_BASELINE_PRIORITY")){const l=i.videoCodecs.findIndex(A=>A.rtpMap&&A.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&A.fmtp&&A.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const A=i.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(A<l){N.debug("raising H264 baseline profile priority");const u=i.videoCodecs[l];i.videoCodecs.splice(l,1),i.videoCodecs.splice(A,0,u)}A!==-1&&(r.videoCodecs=r.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:r,sendrecv:i}}function Yc(e,t,s,r,i,l){if(s==="videoExtensions"||s==="audioExtensions"){const A=[];return e[s].forEach(u=>{t[s].some((p,f)=>{if(u.entry===p.entry&&u.extensionName===p.extensionName)return A.push(f),!0})?l[s].push(u):r[s].push(u)}),void t[s].forEach((u,p)=>{A.indexOf(p)===-1&&i[s].push(u)})}if(s==="videoCodecs"||s==="audioCodecs"){const A=[];return e[s].forEach(u=>{t[s].some((p,f)=>{if(u.payloadType===p.payloadType&&JSON.stringify(u)===JSON.stringify(p))return A.push(f),!0})?l[s].push(u):r[s].push(u)}),void t[s].forEach((u,p)=>{A.indexOf(p)===-1&&i[s].push(u)})}}function z0(e){const{send:t,recv:s,sendrecv:r}=e;if(!r){if(!t||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:s}}let i,l;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=Rr(r),s?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...s.audioCodecs,...r.audioCodecs],l.videoCodecs=[...s.videoCodecs,...r.videoCodecs],l.audioExtensions=[...s.audioExtensions,...r.audioExtensions],l.videoExtensions=[...s.videoExtensions,...r.videoExtensions]):l=Rr(r),{send:i,recv:l}}function Of(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var s;return((s=t.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function q0(e,t,s,r){let i=[];if(e===Tt.VIDEO){if(G("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(l=>{var A;return nt(A=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(A,r)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===G("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let l=[];const A=[],u=[],p=[];if(s.videoCodecs.forEach(f=>{const b=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";nt(b).call(b,r)?l.push(f):nt(b).call(b,"vp9")?A.push(f):nt(b).call(b,"vp8")?u.push(f):nt(b).call(b,"h264")&&p.push(f)}),l.length===0){let f="";A.length!==0?(l=A,f="vp9"):u.length!==0?(l=u,f="vp8"):p.length!==0&&(l=p,f="h264"),N.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}l.length!==0&&(i=t.videoCodecs.filter(f=>l.some(b=>b.payloadType===f.payloadType)))}if(i.length===0&&(N.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),G("USE_PUB_RTX")||G("USE_SUB_RTX")){const l=Du(i,t.videoCodecs);i=[...i,...l]}}else{i=t.audioCodecs.filter(A=>{var u;return nt(u=A.rtpMap&&A.rtpMap.encodingName.toLowerCase()||"").call(u,r)});const l=t.audioCodecs.filter(A=>{var u;return nt(u=A.rtpMap&&A.rtpMap.encodingName.toLowerCase()||"").call(u,"red")});i.length===0&&(N.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(A=>{var u;return nt(u=A.rtpMap&&A.rtpMap.encodingName.toLowerCase()||"").call(u,"opus")})),G("ENABLE_AUDIO_RED")&&l.length!==0&&(i=[...l,...i])}return i}function Du(e,t){const s=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&nt(s).call(s,r.fmtp&&r.fmtp.parameters.apt))}async function Ga(e,t,s){const r=t.toString(),i=u4(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let A=l.sdp;A=jN(A,s||{}),i==null||i(A||""),await e.setLocalDescription({type:"answer",sdp:A})}function jN(e,t,s){if(G("FORBID_MODIFY_LOCAL_OFFER_SDP"))return e;const r=ha(e),{useXR:i}=t;return r.mediaDescriptions.forEach(l=>{var A;l.attributes.mid&&(Array.isArray(s)&&!nt(s).call(s,l.attributes.mid)||(l.media.mediaType==="audio"&&Of(l),l.media.mediaType==="video"&&function(u){u.media.mediaType==="video"&&G("ENABLE_DOWN_SPS_PPS")&&u.attributes.payloads.filter(p=>{var f;return((f=p.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())==="h264"}).forEach(p=>{p.fmtp||(p.fmtp={parameters:{}}),p.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(l),i&&nt(A=["audio","video"]).call(A,l.media.mediaType)&&l.attributes.payloads.forEach(u=>{u.rtcpFeedbacks.findIndex(p=>p.type==="rrtr")===-1&&u.rtcpFeedbacks.push({type:"rrtr"})})))}),CA(r)}function u4(e,t,s,r){if(G("SDP_LOGGING"))return N.upload("exchanging ".concat(s," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{u4(i,"answer",s==="local"?"remote":"local",r)}:void 0}async function h4(e,t,s){try{var r;if(!Ls().supportSetRtpSenderParameters||!function(p){return p==="vp9"||p==="av1"}(e)||!G("ENABLE_SVC"))return;const i={},l={},A=t.getParameters(),u=(r=A.encodings)===null||r===void 0?void 0:r[0];l.scalabilityMode=G0(s),u&&Object.assign(u,l),Object.assign(A,i),await t.setParameters(A),N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(A.encodings)))}catch(i){N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",i)}}function Gw(e){const t=G("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(s=>nt(e).call(e,s))}function p4(e,t){try{var s;return((s=e.fmtp)===null||s===void 0?void 0:s.parameters.apt)===t.payloadType.toString()}catch{return!1}}function m4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function bo(e,t){return typeof G(e)===t?G(e):void 0}function Fee(){try{const e=G("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?m4(Object(r),!0).forEach(function(i){P(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m4(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e)}catch(e){return N.debug("handle gateway attributes failed: ",e),{}}}const f4={};function kd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&N.debug("install service ".concat(e.name)),f4[e.name]=e}function Pl(e){const t=f4[e];if(!t)throw new Me(W.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function g4(e,t){return Pl("DataStream").create(e,t)}function Kw(){return Pl("InterceptFrame").create()}function b4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function ti(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?b4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):b4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const PN=new Map;class Mee extends jr{get state(){return this._state}set state(t){if(t===this._state)return;const s=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(nn.CONNECTION_STATE_CHANGE,t,s,this._disconnectedReason):this.emit(nn.CONNECTION_STATE_CHANGE,t,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){N.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,s){var r,i,l;super(),P(this,"store",void 0),P(this,"joinInfo",void 0),P(this,"key",void 0),P(this,"ntpOffset",0),P(this,"usingProxy",!1),P(this,"signal",void 0),P(this,"role",void 0),P(this,"isPreallocation",void 0),P(this,"isPreSub",void 0),P(this,"inChannelInfo",{joinAt:null,duration:0}),P(this,"spec",void 0),P(this,"_state","DISCONNECTED"),P(this,"_statsCollector",void 0),P(this,"_disconnectedReason",void 0),P(this,"isSignalRecover",!1),P(this,"hasChangeBGPAddress",!1),P(this,"trafficStatsInterval",void 0),P(this,"networkQualityInterval",void 0),P(this,"_joinGatewayStartTime",0),P(this,"_signalTimeout",!1),P(this,"_clientRoleOptions",void 0),P(this,"_isProactiveJoin",!1),this.store=t,this.spec=s,this.signal=this.store.useP2P?(r={spec:ti(ti({},s),{},{retryConfig:s.websocketRetryConfig}),store:t},(i=(l=Pl("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(l,r)):this.store.useDcSignal?function(A){return Pl("DataChannelSignal").create(A)}({spec:ti(ti({},s),{},{retryConfig:s.websocketRetryConfig}),store:t}):new XU(ti(ti({},s),{},{retryConfig:s.websocketRetryConfig}),t),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,s,r){if(this.store.useDcSignal){let b=!1;t.cloudProxyServer!=="disabled"?(N.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),b=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(N.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),b=!0):t.apResponse.addresses.some(w=>w.fingerprint)||G("FINGERPRINT")||(N.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),b=!0),b&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let l=PN.get(t.cname);if(l||(l=new Map,PN.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const b=new Le(W.UID_CONFLICT);throw kt.joinGateway(t.sid,{lts:i,succ:!1,ec:b.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),b}l.set(t.uid,!0),this.joinInfo=t,this.key=s;let A=0;this.joinGatewayStartTime=i;const u=t.proxyServer,p=this.store.useDcSignal?"datachannel":"websocket";try{N.debug("[".concat(this.store.clientId,"] use ").concat(p," join uid ").concat(A));const b=t.gatewayAddrs.map(_=>{let{address:C}=_;const[U,B]=C.split(":"),j={host:U,port:B};return t.proxyServer&&(j.proxy=t.proxyServer),j});let w;w=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(b),A=w.uid,N.debug("[".concat(this.store.clientId,"] ").concat(p," join uid ").concat(A," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(b){var f;throw b.code===W.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||kt.joinGateway(t.sid,{lts:i,succ:!1,ec:((f=b.data)===null||f===void 0?void 0:f.desc)||b.code,errorMsg:b.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!u||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),b&&b.code===W.INIT_DATACHANNEL_TIMEOUT?(N.warning("[".concat(this.store.clientId,"] User join datachannel failed"),b.toString()),this.resetSignal(),b):(N.error("[".concat(this.store.clientId,"] User join failed"),b.toString()),l.delete(t.uid),this.signal.close(),b)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),N.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(b=>{N.warning("[".concat(this.store.clientId,"] get traffic stats error"),b.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(nn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(nn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(nn.NETWORK_QUALITY,{uplinkNetworkQuality:Mw(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Mw(this._statsCollector.trafficStats.B_dnq)}):this.emit(nn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),A}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Us.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Fs.CONNECTED||await function(r,i){return i===1/0?r:mt.race([r,hZ(i)])}(this.signal.request(Mt.LEAVE,void 0,!0),3e3)}catch(r){N.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(s),s!==Us.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,s,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:G("PUB_EXTEND"),twcc:!!G("PUBLISH_TWCC"),rtx:!!G("USE_PUB_RTX")};try{return(await this.signal.request(Mt.PUBLISH,i,!0))._message}catch(l){if(r&&l.data&&l.data.code===Gt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,s),this.publish(t,s,!1);throw l}}async publishDataChannel(t,s,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(i=s.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Mt.PUBLISH_DATASTREAM,l,!0)}catch(A){if(r&&A.data&&A.data.code===Gt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),A.toString()),await this.tryUnpubDataChannelBeforeRepub(t,s),this.publishDataChannel(t,s,!1);throw A}}async unpublish(t,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Mt.UNPUBLISH,{stream_id:s,ortc:t},!0)}catch(r){N.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await mt.all(t.map(s=>this.signal.request(Mt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){N.warning("unpublish datachannels warning: ",s)}}async presubscribe(t,s,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX")||void 0,extend:G("SUB_EXTEND"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Mt.PRE_SUBSCRIBE,i,!0)}catch(l){if(r&&l.data&&l.data.code===Gt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,s,!1);throw l}}async subscribe(t,s,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX"),extend:G("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return(await this.signal.request(Mt.SUBSCRIBE,i,!0))._message}catch(l){if(r&&l.data&&l.data.code===Gt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,s),await this.subscribe(t,s,!1);throw l}}async subscribeDataChannel(t,s,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Mt.SUBSCRIBE_DATASTREAM,i,!0)}catch(l){if(r&&l.data&&l.data.code===Gt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,s),await this.subscribeDataChannel(t,s,!1);throw l}}async subscribeAll(t,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!G("USE_SUB_RTX"),twcc:!!G("SUBSCRIBE_TWCC"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Mt.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(s&&i.data&&i.data.code===Gt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const s=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,l=r.width,A=r.height,u=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(u=!1)),typeof A!="number"&&(A=A.exact||A.ideal||A.max||A.min||0,i||(u=!1)),u?{stream_type:0,width:l,height:A,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(s)return this.signal.request(Mt.SET_VIDEO_PROFILE,s);N.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,s){try{await this.signal.request(Mt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:s},!0)}catch(r){N.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await mt.all(t.map(r=>this.signal.request(Mt.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:s},!0)))}catch(r){N.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Mt.UNSUBSCRIBE_STREAMS,t,!0)}catch(s){N.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(t){const{iceParameters:s,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(Mt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Mt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Mt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,s){s&&(this._clientRoleOptions=Object.assign({},s)),G("CLIENT_ROLE_OPTIONS")&&(N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),G("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS")),N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const l=Object.assign({},s);delete l.delay,delete l.level,await this.signal.request(Mt.SET_CLIENT_ROLE,ti(ti({role:t,level:i,delay:r},l),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,s,r){await this.signal.request(Mt.SET_DUAL_STREAM_MODE,{mode:t},r,s)}async setRemoteVideoStreamType(t,s){await this.signal.request(Mt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:s})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Mt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,s){await this.signal.request(Mt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:s})}async pickSVCLayer(t,s){await this.signal.request(Mt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Mt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,s,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,s,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ti({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(Mt.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(Mt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=PN.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(s){let r;return r=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Ei.username,password:Ei.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ti(ti({},Ei),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Mt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(s=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===s.peer_uid);r&&r.B_st!==s.B_st&&aw(()=>{this.emit(nn.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var s,r,i,l;if(!this.joinInfo||!this.key)throw new Le(W.UNEXPECTED_ERROR,"can not generate join message, no join info");const A=Object.assign({},this.joinInfo.apResponse);let u=G("REPORT_APP_SCENARIO");if(typeof u!="string")try{u=JSON.stringify(u)}catch{u=void 0}var p;u&&u.length>128&&(u=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(nn.UPDATE_GATEWAY_CONFIG),p=this.store.clientId,nt(Sf).call(Sf,p)||Sf.push(p);const f=U0(this.store),b=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),w=bj(this.store),_=Fee(),C=Ol(87)||EL()||v1(117),U=(function(){const q=zs();if(q.name!==Ys.SAFARI||!q.browserVersion)return!1;const ie=q.browserVersion.split(".");return Number(ie[0])>18||Number(ie[0])===18&&Number(ie[1])>=4}()||TL(18,4,!1))&&w1(18,6,!0)&&this.spec.codec==="h264"&&G("ENABLE_ABSSENDTIME_AS_SENTTS"),B=!(((r=A.detail)===null||r===void 0?void 0:r[3])!=="CN"||!G("ENABLE_QUALITY_FALLBACK"))&&G("ENABLE_QUALITY_FALLBACK"),j=!!G("ENABLE_AP_MULTI_IP")&&((i=A.detail)===null||i===void 0?void 0:i[5])==="multi-ip",K=ti({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:lc,browser:navigator.userAgent,process_id:G("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:j||this.hasChangeBGPAddress,ap_response:A,extend:G("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:u,attributes:{userAttributes:ti(ti({enableEncodedTransform:(!!G("ENABLE_AUDIO_METADATA")||!!G("ENABLE_AUDIO_PTS"))&&C||!!G("ENABLE_AUDIO_TOPN")&&x1(Ys.CHROME,87,116)||void 0,enableAudioMetadata:!!G("ENABLE_AUDIO_METADATA")&&C,enableAudioPts:!!G("ENABLE_AUDIO_PTS")&&C,topnSmoothLevel:G("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:G("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:G("TOPN_SWITCH_HOLD_MS"),topnAudioGain:G("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:G("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:G("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:bo("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:bo("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:bo("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:G("USE_PUB_RTX")===!0||G("USE_SUB_RTX")===!0||void 0,disableFEC:G("DISABLE_FEC"),enableNTPReport:!!G("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:w,enableFulllinkAvSync:!!G("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:bo("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!G("FORCE_ENABLE_AUT_CC")||!mw()&&(!!G("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!G("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:bo("USE_XR","boolean"),enableLossbasedBwe:bo("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!G("FORCE_ENABLE_AUT_CC")||!mw()&&(!!G("ENABLE_AUT_CC")||void 0),enableCCFallback:bo("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:b,preSubNum:f?bo("PRE_SUB_NUM","number"):void 0,enablePubTWCC:bo("PUBLISH_TWCC","boolean"),enableSubTWCC:bo("SUBSCRIBE_TWCC","boolean"),enablePubRTX:bo("USE_PUB_RTX","boolean"),enableSubRTX:bo("USE_SUB_RTX","boolean"),enableSubSVC:G("ENABLE_SVC")?G("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0,enableSvcExtended:G("ENABLE_SVC")&&Array.isArray(G("SVC_EXTENDED"))&&G("SVC_EXTENDED").length!==0?G("SVC_EXTENDED"):void 0,enableVosFallback:G("ENABLE_VOS_FALLBACK"),enableQualityFallback:B},_),{},{audioDuplicate:bo("ENABLE_AUDIO_RED","boolean")?(l=bo("AUDIO_DUPLICATE_NUM","number"))!==null&&l!==void 0?l:2:void 0,senttsUsesAbsSendTime:!!U||void 0,enableDualStreamFlag:bo("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(K.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(K.aes_mode=this.joinInfo.aesmode,G("ENCRYPT_AES")?(K.aes_secret=this.joinInfo.aespassword,K.aes_encrypt=!0):K.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(K.aes_salt=this.joinInfo.aessalt)),A.addresses[this.signal.websocket.currentURLIndex]&&(K.ap_response.ticket=A.addresses[this.signal.websocket.currentURLIndex].ticket,delete A.addresses),this.joinInfo.defaultVideoStream!==void 0&&(K.default_video_stream=this.joinInfo.defaultVideoStream),K}getRejoinMessage(){if(!this.joinInfo)throw new Le(W.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Lt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Lt.WS_RECONNECTING,t=>{this.joinInfo&&kt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||yi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",kt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Lt.WS_CLOSED,t=>{let s;switch(t){case Us.LEAVE:s=yi.LEAVE;break;case Us.UID_BANNED:case Us.IP_BANNED:case Us.CHANNEL_BANNED:case Us.SERVER_ERROR:s=yi.SERVER_ERROR;break;case Us.FALLBACK:s=yi.FALLBACK;break;case Us.LICENSE_MISSING:case Us.LICENSE_EXPIRED:case Us.LICENSE_MINUTES_EXCEEDED:case Us.LICENSE_PERIOD_INVALID:case Us.LICENSE_MULTIPLE_SDK_SERVICE:case Us.LICENSE_ILLEGAL:case Us.TOKEN_EXPIRE:s=t;break;default:s=yi.NETWORK_ERROR}N.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+yi.NETWORK_ERROR)),this.joinInfo&&kt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Us.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=t,t!==Us.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Lt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=G("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(N.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(kt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void N.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));pr("EVENT_REPORT_DOMAIN",t[1]),pr("EVENT_REPORT_BACKUP_DOMAIN",t[1]),pr("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(as.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Lt.REQUEST_RECOVER,(t,s,r)=>{if(!this.joinInfo)return r(new Le(W.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,wn(this,nn.REQUEST_NEW_GATEWAY_LIST).then(s).catch(r)}),this.signal.on(Lt.REQUEST_JOIN_INFO,async(t,s,r)=>{var i,l,A;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const u=Rr((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(G("NEW_TURN_MODE")&&u&&((l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer)==="disabled"){var p;let _=u.servers.map(B=>"turnServerURL"in B&&G("USE_TURN_IP")?ti(ti({},B),{},{turnServerURL:Fw(B.turnServerURL)}):B),C=(p=u.serversFromGateway)===null||p===void 0?void 0:p.map(B=>G("USE_TURN_IP")?ti(ti({},B),{},{turnServerURL:Fw(B.turnServerURL)}):B);const U=this.signal.currentURLIndex;_.length>0&&(_=[_[U%_.length]],u.servers=_),Array.isArray(C)&&C.length>0&&(C=[C[0]],u.serversFromGateway=C),N.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(U))}const{iceParameters:f,dtlsParameters:b,rtpCapabilities:w}=await wn(this,nn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u,cloudProxyServer:(A=this.joinInfo)===null||A===void 0?void 0:A.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:b,rtpCapabilities:w,version:"2"}}))}catch(_){s(_)}}),this.signal.on(Lt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Lt.REPORT_JOIN_GATEWAY,(t,s)=>{if(!this.joinInfo)return;let r,i="";var l;t instanceof Le?(r=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,i=t.message):r=t,kt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(Lt.IS_P2P_DISCONNECTED,t=>{t(rp(this,nn.IS_P2P_DISCONNECTED))}),this.signal.on(Lt.DISCONNECT_P2P,()=>{this.emit(nn.DISCONNECT_P2P)}),this.signal.on(Lt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Lt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Lt.JOIN_RESPONSE,t=>{const s=this.getCurrentGatewayAddress();this.emit(nn.JOIN_RESPONSE,t,s)}),this.signal.on(Lt.PRE_CONNECT_PC,async(t,s)=>{if(this.joinInfo){var r,i;this.updateTurnConfigFromSignal();const A=this.getCurrentGatewayAddress(),u=Rr((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(G("NEW_TURN_MODE")&&u&&((i=this.joinInfo)===null||i===void 0?void 0:i.cloudProxyServer)==="disabled"){var l;let f=u.servers.map(_=>"turnServerURL"in _&&G("USE_TURN_IP")?ti(ti({},_),{},{turnServerURL:Fw(_.turnServerURL)}):_),b=(l=u.serversFromGateway)===null||l===void 0?void 0:l.map(_=>G("USE_TURN_IP")?ti(ti({},_),{},{turnServerURL:Fw(_.turnServerURL)}):_);const w=this.signal.currentURLIndex;f.length>0&&(f=[f[w%f.length]],u.servers=f),Array.isArray(b)&&b.length>0&&(b=[b[0]],u.serversFromGateway=b),N.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w,",in pre pc"))}const p=G("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(A&&p){const f=c4(A);wn(this,nn.PRE_CONNECT_PC,{candidates:f,fingerprint:p,turnServer:u}).then(b=>{t==null||t(b)}).catch(s||(()=>{}))}}}),this.signal.on(Lt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof G("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(G("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(Lt.VOS_FALLBACK,t=>{this.emit(nn.VOS_FALLBACK,t)}),this.signal.on(Lt.DATACHANNEL_FAILBACK,t=>{N.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(nn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,s){try{await this.signal.request(Mt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[s]},!0)}catch(r){throw N.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,s){try{await this.signal.request(Mt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(r){throw N.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,s){try{await this.signal.request(Mt.UNPUBLISH,{stream_id:t,ortc:s},!0)}catch(r){throw N.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,s){try{await this.signal.request(Mt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(r){throw N.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const s={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Mt.UNSUBSCRIBE_STREAMS,s,!0)}catch(r){throw N.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,s){const r={action:t.find(i=>i.stream_type===cr.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:s};try{await this.signal.request(Mt.CONTROL,r,!0,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,s){const r={action:t.find(i=>i.stream_type===cr.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:s};try{await this.signal.request(Mt.CONTROL,r,!0,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,s){const r={action:t===Tt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Mt.CONTROL,r,!0,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,s){const r={action:t===Tt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Mt.CONTROL,r,!0,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,s){this.signal.upload(t,s)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Mt.RESTART_ICE,s,!0)}catch(r){throw N.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,s){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,s||yi.P2P_FAILED)}getCurrentGatewayAddress(){var t,s;if(!G("GATEWAY_WSS_ADDRESS"))return G("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(N.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Mt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Us.FALLBACK)),this.store.useDcSignal=!1,this.signal=new XU(ti(ti({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(nn.RESET_SIGNAL)}}let Ww=0,UN=0;function Ul(e,t,s,r){return new mt((i,l)=>{t.timeout=t.timeout||G("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),Ww+=Cd(t.data)):s&&(t.data.size?Ww+=t.data.size:t.data instanceof FormData?Ww+=qL(t.data):Ww+=Cd(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ta.request(t).then(A=>{typeof A.data=="string"?UN+=Cd(A.data):A.data instanceof ArrayBuffer||A.data instanceof Uint8Array?UN+=A.data.byteLength:UN+=Cd(JSON.stringify(A.data)),r&&i({data:A.data,headers:A.headers}),i(A.data)}).catch(A=>{Ta.isCancel(A)?l(new Le(W.OPERATION_ABORTED,"cancel token canceled")):A.code==="ECONNABORTED"?l(new Le(W.NETWORK_TIMEOUT,A.message)):A.response?l(new Le(W.NETWORK_RESPONSE_ERROR,A.response.status)):l(new Le(W.NETWORK_ERROR,A.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(qe){var lt=0;return function(){return lt<qe.length?{done:!1,value:qe[lt++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(qe,lt,It){return qe==Array.prototype||qe==Object.prototype||(qe[lt]=It.value),qe},r,i=function(qe){qe=[typeof globalThis=="object"&&globalThis,qe,typeof window=="object"&&window,typeof self=="object"&&self,typeof d=="object"&&d];for(var lt=0;lt<qe.length;++lt){var It=qe[lt];if(It&&It.Math==Math)return It}throw Error("Cannot find global object")}(this);function l(qe,lt){if(lt)e:{var It=i;qe=qe.split(".");for(var Je=0;Je<qe.length-1;Je++){var D=qe[Je];if(!(D in It))break e;It=It[D]}(lt=lt(Je=It[qe=qe[qe.length-1]]))!=Je&&lt!=null&&s(It,qe,{configurable:!0,writable:!0,value:lt})}}function A(qe){return(qe={next:qe})[Symbol.iterator]=function(){return this},qe}function u(qe){var lt=typeof Symbol<"u"&&Symbol.iterator&&qe[Symbol.iterator];return lt?lt.call(qe):{next:t(qe)}}if(l("Symbol",function(qe){function lt(D,ne){this.A=D,s(this,"description",{configurable:!0,writable:!0,value:ne})}if(qe)return qe;lt.prototype.toString=function(){return this.A};var It="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Je=0;return function D(ne){if(this instanceof D)throw new TypeError("Symbol is not a constructor");return new lt(It+(ne||"")+"_"+Je++,ne)}}),l("Symbol.iterator",function(qe){if(qe)return qe;qe=Symbol("Symbol.iterator");for(var lt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),It=0;It<lt.length;It++){var Je=i[lt[It]];typeof Je=="function"&&typeof Je.prototype[qe]!="function"&&s(Je.prototype,qe,{configurable:!0,writable:!0,value:function(){return A(t(this))}})}return qe}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var p;e:{var f={};try{f.__proto__={a:!0},p=f.a;break e}catch{}p=!1}r=p?function(qe,lt){if(qe.__proto__=lt,qe.__proto__!==lt)throw new TypeError(qe+" is not extensible");return qe}:null}var b=r;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _(qe){if(qe.m)throw new TypeError("Generator is already running");qe.m=!0}function C(qe,lt){return qe.h=3,{value:lt}}function U(qe){this.g=new w,this.G=qe}function B(qe,lt,It,Je){try{var D=lt.call(qe.g.j,It);if(!(D instanceof Object))throw new TypeError("Iterator result "+D+" is not an object");if(!D.done)return qe.g.m=!1,D;var ne=D.value}catch(ge){return qe.g.j=null,qe.g.s(ge),j(qe)}return qe.g.j=null,Je.call(qe.g,ne),j(qe)}function j(qe){for(;qe.g.h;)try{var lt=qe.G(qe.g);if(lt)return qe.g.m=!1,{value:lt.value,done:!1}}catch(It){qe.g.v=void 0,qe.g.s(It)}if(qe.g.m=!1,qe.g.l){if(lt=qe.g.l,qe.g.l=null,lt.F)throw lt.D;return{value:lt.return,done:!0}}return{value:void 0,done:!0}}function K(qe){this.next=function(lt){return qe.o(lt)},this.throw=function(lt){return qe.s(lt)},this.return=function(lt){return function(It,Je){_(It.g);var D=It.g.j;return D?B(It,"return"in D?D.return:function(ne){return{value:ne,done:!0}},Je,It.g.return):(It.g.return(Je),j(It))}(qe,lt)},this[Symbol.iterator]=function(){return this}}function q(qe,lt){return lt=new K(new U(lt)),b&&qe.prototype&&b(lt,qe.prototype),lt}if(w.prototype.o=function(qe){this.v=qe},w.prototype.s=function(qe){this.l={D:qe,F:!0},this.h=this.C||this.u},w.prototype.return=function(qe){this.l={return:qe},this.h=this.u},U.prototype.o=function(qe){return _(this.g),this.g.j?B(this,this.g.j.next,qe,this.g.o):(this.g.o(qe),j(this))},U.prototype.s=function(qe){return _(this.g),this.g.j?B(this,this.g.j.throw,qe,this.g.o):(this.g.s(qe),j(this))},l("Array.prototype.entries",function(qe){return qe||function(){return function(lt,It){lt instanceof String&&(lt+="");var Je=0,D=!1,ne={next:function(){if(!D&&Je<lt.length){var ge=Je++;return{value:It(ge,lt[ge]),done:!1}}return D=!0,{done:!0,value:void 0}}};return ne[Symbol.iterator]=function(){return ne},ne}(this,function(lt,It){return[lt,It]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ie=function(qe,lt){for(var It=0;It<qe.length;It++)lt(qe[It])},xe=function(qe){return qe.replace(/\r?\n|\r/g,`\r
`)},ye=function(qe,lt,It){return lt instanceof Blob?(It=It!==void 0?It+"":typeof lt.name=="string"?lt.name:"blob",lt.name===It&&Object.prototype.toString.call(lt)!=="[object Blob]"||(lt=new File([lt],It)),[String(qe),lt]):[String(qe),String(lt)]},ue=function(qe,lt){if(qe.length<lt)throw new TypeError(lt+" argument required, but only "+qe.length+" present.")},Re=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ge=Re.FormData,Ze=Re.XMLHttpRequest&&Re.XMLHttpRequest.prototype.send,_t=Re.Request&&Re.fetch,ns=Re.navigator&&Re.navigator.sendBeacon,Jt=Re.Element&&Re.Element.prototype,bs=Re.Symbol&&Symbol.toStringTag;bs&&(Blob.prototype[bs]||(Blob.prototype[bs]="Blob"),"File"in Re&&!File.prototype[bs]&&(File.prototype[bs]="File"));try{new File([],"")}catch{Re.File=function(lt,It,Je){return lt=new Blob(lt,Je||{}),Object.defineProperties(lt,{name:{value:It},lastModified:{value:+(Je&&Je.lastModified!==void 0?new Date(Je.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),bs&&Object.defineProperty(lt,bs,{value:"File"}),lt}}var As=function(qe){return qe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Xs=function(qe){this.i=[];var lt=this;qe&&ie(qe.elements,function(It){if(It.name&&!It.disabled&&It.type!=="submit"&&It.type!=="button"&&!It.matches("form fieldset[disabled] *"))if(It.type==="file"){var Je=It.files&&It.files.length?It.files:[new File([],"",{type:"application/octet-stream"})];ie(Je,function(D){lt.append(It.name,D)})}else It.type==="select-multiple"||It.type==="select-one"?ie(It.options,function(D){!D.disabled&&D.selected&&lt.append(It.name,D.value)}):It.type==="checkbox"||It.type==="radio"?It.checked&&lt.append(It.name,It.value):(Je=It.type==="textarea"?xe(It.value):It.value,lt.append(It.name,Je))})};if((e=Xs.prototype).append=function(qe,lt,It){ue(arguments,2),this.i.push(ye(qe,lt,It))},e.delete=function(qe){ue(arguments,1);var lt=[];qe=String(qe),ie(this.i,function(It){It[0]!==qe&&lt.push(It)}),this.i=lt},e.entries=function qe(){var lt,It=this;return q(qe,function(Je){if(Je.h==1&&(lt=0),Je.h!=3)return lt<It.i.length?Je=C(Je,It.i[lt]):(Je.h=0,Je=void 0),Je;lt++,Je.h=2})},e.forEach=function(qe,lt){ue(arguments,1);for(var It=u(this),Je=It.next();!Je.done;Je=It.next()){var D=u(Je.value);Je=D.next().value,D=D.next().value,qe.call(lt,D,Je,this)}},e.get=function(qe){ue(arguments,1);var lt=this.i;qe=String(qe);for(var It=0;It<lt.length;It++)if(lt[It][0]===qe)return lt[It][1];return null},e.getAll=function(qe){ue(arguments,1);var lt=[];return qe=String(qe),ie(this.i,function(It){It[0]===qe&&lt.push(It[1])}),lt},e.has=function(qe){ue(arguments,1),qe=String(qe);for(var lt=0;lt<this.i.length;lt++)if(this.i[lt][0]===qe)return!0;return!1},e.keys=function qe(){var lt,It,Je,D,ne=this;return q(qe,function(ge){if(ge.h==1&&(lt=u(ne),It=lt.next()),ge.h!=3)return It.done?void(ge.h=0):(Je=It.value,D=u(Je),C(ge,D.next().value));It=lt.next(),ge.h=2})},e.set=function(qe,lt,It){ue(arguments,2),qe=String(qe);var Je=[],D=ye(qe,lt,It),ne=!0;ie(this.i,function(ge){ge[0]===qe?ne&&(ne=!Je.push(D)):Je.push(ge)}),ne&&Je.push(D),this.i=Je},e.values=function qe(){var lt,It,Je,D,ne=this;return q(qe,function(ge){if(ge.h==1&&(lt=u(ne),It=lt.next()),ge.h!=3)return It.done?void(ge.h=0):(Je=It.value,(D=u(Je)).next(),C(ge,D.next().value));It=lt.next(),ge.h=2})},Xs.prototype._asNative=function(){for(var qe=new Ge,lt=u(this),It=lt.next();!It.done;It=lt.next()){var Je=u(It.value);It=Je.next().value,Je=Je.next().value,qe.append(It,Je)}return qe},Xs.prototype._blob=function(){var qe="----formdata-polyfill-"+Math.random(),lt=[],It="--"+qe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Je,D){return typeof Je=="string"?lt.push(It+As(xe(D))+`"\r
\r
`+xe(Je)+`\r
`):lt.push(It+As(xe(D))+'"; filename="'+As(Je.name)+`"\r
Content-Type: `+(Je.type||"application/octet-stream")+`\r
\r
`,Je,`\r
`)}),lt.push("--"+qe+"--"),new Blob(lt,{type:"multipart/form-data; boundary="+qe})},Xs.prototype[Symbol.iterator]=function(){return this.entries()},Xs.prototype.toString=function(){return"[object FormData]"},Jt&&!Jt.matches&&(Jt.matches=Jt.matchesSelector||Jt.mozMatchesSelector||Jt.msMatchesSelector||Jt.oMatchesSelector||Jt.webkitMatchesSelector||function(qe){for(var lt=(qe=(this.document||this.ownerDocument).querySelectorAll(qe)).length;0<=--lt&&qe.item(lt)!==this;);return-1<lt}),bs&&(Xs.prototype[bs]="FormData"),Ze){var Br=Re.XMLHttpRequest.prototype.setRequestHeader;Re.XMLHttpRequest.prototype.setRequestHeader=function(qe,lt){Br.call(this,qe,lt),qe.toLowerCase()==="content-type"&&(this.B=!0)},Re.XMLHttpRequest.prototype.send=function(qe){qe instanceof Xs?(qe=qe._blob(),this.B||this.setRequestHeader("Content-Type",qe.type),Ze.call(this,qe)):Ze.call(this,qe)}}_t&&(Re.fetch=function(qe,lt){return lt&&lt.body&&lt.body instanceof Xs&&(lt.body=lt.body._blob()),_t.call(this,qe,lt)}),ns&&(Re.navigator.sendBeacon=function(qe,lt){return lt instanceof Xs&&(lt=lt._asNative()),ns.call(this,qe,lt)}),Re.FormData=Xs}})();const Y0=()=>{const e=G("AREAS");return e.length===0&&e.push($s.GLOBAL),Fa(e).call(e,(t,s,r)=>{const i=x4(s);return i?r===0?i:"".concat(t,",").concat(i):t},"")},x4=e=>e===$s.OVERSEA?"".concat(Bi.ASIA,",").concat(Bi.EUROPE,",").concat(Bi.AFRICA,",").concat(Bi.NORTH_AMERICA,",").concat(Bi.SOUTH_AMERICA,",").concat(Bi.OCEANIA):Bi[e],Vee=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(s=>{const r=jw[s],i=Object.keys(r);i&&i.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(r[l]))})}),t},zw={GLOBAL:{ASIA:[$s.CHINA,$s.JAPAN,$s.INDIA,$s.KOREA,$s.HKMC],EUROPE:[],NORTH_AMERICA:[$s.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},qw=Object.keys(zw[$s.GLOBAL]),FN=[$s.CHINA,$s.NORTH_AMERICA,$s.EUROPE,$s.ASIA,$s.JAPAN,$s.INDIA,$s.OCEANIA,$s.SOUTH_AMERICA,$s.AFRICA,$s.KOREA,$s.HKMC,$s.US],Qee=function(e,t){let s=[];if(nt(e).call(e,$s.GLOBAL)){const l=[$s.GLOBAL,$s.OVERSEA],A=Object.keys(jw);if(t===$s.GLOBAL)throw new Le(W.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===$s.CHINA)s=[$s.OVERSEA];else if(i=t,nt(qw).call(qw,i)){const u=(r=t,zw[$s.GLOBAL][r]||[]),p=[...l,t,...u];s=A.filter(f=>!nt(p).call(p,f))}else if(function(u){let p=!1;return qw.forEach(f=>{var b;nt(b=zw[$s.GLOBAL][f]).call(b,u)&&(p=!0)}),p}(t)){const u=function(f){let b;return qw.forEach(w=>{var _;nt(_=zw[$s.GLOBAL][w]).call(_,f)&&(b=w)}),b}(t),p=[...l,u,t];s=A.filter(f=>!nt(p).call(p,f))}else s=e;s=function(u){const p=[];return FN.forEach(f=>{nt(u).call(u,f)&&p.push(f)}),p.concat(u.filter(f=>!nt(FN).call(FN,f)))}(s)}else s=e;var r,i;return s};function v4(e){var t,s;if(!e&&nt(t=G("AREAS")).call(t,$s.EXTENSIONS))return N.debug("update area from ap : reset"),void MN(JZ,!0);if(!nt(s=G("AREAS")).call(s,$s.GLOBAL)||!e)return;let r=jw.EXTENSIONS;r&&(r={CODE:x4($s.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},N.debug("update area from ap success: ".concat(e,",config is "),r),pr("AREAS",[$s.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?pr(i,r[i][0]):pr(i,r[i])}))}function MN(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=kt.reportApiInvoke(null,{name:kr.SET_AREA,options:e,tag:br.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!nt(HU).call(HU,l))throw new Le(W.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:A}=e;if(!l)throw new Le(W.INVALID_PARAMS,"area code is needed");let u=l;typeof l=="string"&&(u=[l]),r=A?Qee(u,A):u}if(!t){if(Lo.AREAS){const l=new Le(W.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(l),void N.warning("setArea is prohibited because of config-distribute")}if(nt(r).call(r,$s.GLOBAL)&&G("AREAS")===$s.EXTENSIONS){const l=new Le(W.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(l),void N.warning("setArea is prohibited because of ap extensions")}}pr("AREAS",r,t);const i=Vee(r);Object.keys(i).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?pr(l,i[l][0]):pr(l,i[l])}),N.debug("set area success:",r.join(","))}catch(r){throw s.onError(r),r}s.onSuccess()}function w4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Dd(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?w4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):w4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let VN=1;function Hee(e,t,s,r,i){VN+=1;const l={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:VN,requestId:VN,version:lc,cname:s.cname},A={service_name:t,json_body:JSON.stringify(l)};let u,p,f=e[0];return kl(async()=>{u=Date.now();const b=await Ul(f,{data:A,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(p=Date.now()-u,b.code!==0){const C=new Le(W.UNEXPECTED_RESPONSE,"live streaming ap error, code"+b.code,{retry:!0,responseTime:p});throw N.error(C.toString()),C}const w=JSON.parse(b.json_body);if(w.code!==200){const C=new Le(W.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:p});throw N.error(C.toString()),C}if(!w.servers||w.servers.length===0){const C=new Le(W.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:p});throw N.error(C.toString()),C}const _=function(C,U){return{addressList:C.servers.map(B=>"wss://".concat(B.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(B.wss,"?serviceName=").concat(encodeURIComponent(U))),workerToken:C.workerToken,vid:C.vid}}(w,t);return G("LIVE_STREAMING_ADDRESS")&&(_.addressList=G("LIVE_STREAMING_ADDRESS")instanceof Array?G("LIVE_STREAMING_ADDRESS"):[G("LIVE_STREAMING_ADDRESS")]),Dd(Dd({},_),{},{responseTime:p})},(b,w)=>(kt.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(b.addressList),firstSuccess:w===0,responseTime:p,serverIp:e[w%e.length]}),!1),(b,w)=>(kt.apworkerEvent(s.sid,{success:!1,sc:b.data&&b.data.code||200,serviceName:t,responseTime:p,serverIp:e[w%e.length]}),!!(b.code!==W.OPERATION_ABORTED&&b.code!==W.UNEXPECTED_RESPONSE||b.data&&b.data.retry)&&(f=e[(w+1)%e.length],!0)),i)}let QN=1;function _4(e,t,s,r){let{url:i,areaCode:l}=e;const{clientId:A,sid:u}=t,p=Date.now();let f;const b=t.role,[w,_]=GN(t,l,[mn.CHOOSE_SERVER]);let C=Wr.networkState;return kl(async()=>{C&&Wr.networkState===ua.OFFLINE&&Wr.onlineWaiter&&await mt.race([Wr.onlineWaiter,Qn(r&&r.maxRetryTimeout||pn.maxRetryTimeout)]),C=Wr.networkState;const{data:U,headers:B}=await Ul(i,{data:w,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=B.http3==="1"?1:-1,kt.reportResourceTiming(i,u),E4(U,i,t,p,[mn.CHOOSE_SERVER],f);const j=H0(U,mn.CHOOSE_SERVER);return HN(j),RN(j,i)},U=>(U&&kt.joinChooseServer(u,{role:b,lts:p,succ:!0,csAddr:i,opid:_,serverList:U.gatewayAddrs.map(B=>B.address),ec:null,cid:U.cid.toString(),uid:U.uid.toString(),csIp:U.csIp,unilbsServerIds:[mn.CHOOSE_SERVER].toString(),isHttp3:f,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:U.res.detail&&U.res.detail[38],vid:U.vid}),!1),U=>U.code!==W.OPERATION_ABORTED&&(U.code===W.CAN_NOT_GET_GATEWAY_SERVER?U.data.retry:(kt.joinChooseServer(u,{role:b,lts:p,succ:!1,csAddr:i,serverList:null,opid:_,ec:U.code,csIp:U.data&&U.data.csIp,unilbsServerIds:[mn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:C}),isHttp3:f,corssRegionTagReq:t.apRequestDetail}),N.warning("[".concat(A||"sid-".concat(u.slice(0,6)),"] Choose server network error, retry"),U),!0)),r)}function y4(e,t,s,r){let i,{url:l,areaCode:A,serviceIds:u}=e;const p=Date.now(),f=t.role,[b,w]=GN(t,A,u);let _;return kl(async()=>{_&&Wr.networkState===ua.OFFLINE&&Wr.onlineWaiter&&await mt.race([Wr.onlineWaiter,Qn(r&&r.maxRetryTimeout||pn.maxRetryTimeout)]),_=Wr.networkState;const{data:C,headers:U}=await Ul(l,{data:b,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=U.http3==="1"?1:-1,kt.reportResourceTiming(l,t.sid),E4(C,l,t,p,u,i);const B=H0(C,mn.CHOOSE_SERVER),j=H0(C,t.cloudProxyServer==="proxy5"?mn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?mn.CLOUD_PROXY:mn.CLOUD_PROXY_FALLBACK),K=performance.getEntriesByName(l),q=K[K.length-1];let ie;return q&&(ie={name:q.name,protocol:"nextHopProtocol"in q?q.nextHopProtocol:"",dnscost:"domainLookupEnd"in q&&"domainLookupStart"in q&&typeof q.domainLookupEnd=="number"&&typeof q.domainLookupStart=="number"?q.domainLookupEnd-q.domainLookupStart:-1,tcpTlsCost:"connectEnd"in q&&"connectStart"in q&&typeof q.connectEnd=="number"&&typeof q.connectStart=="number"?q.connectEnd-q.connectStart:-1,reqCost:"requestStart"in q&&typeof q.requestStart=="number"&&"responseEnd"in q&&typeof q.responseEnd=="number"?q.responseEnd-q.requestStart:-1,handleCost:"leave_ts"in C&&"enter_ts"in C&&typeof C.leave_ts=="number"&&typeof C.enter_ts=="number"?C.leave_ts-C.enter_ts:-1}),HN(B),{gatewayInfo:RN(B,l),proxyInfo:j,url:l,resourceTimingInfo:ie}},C=>{var U;return C.gatewayInfo&&kt.joinChooseServer(t.sid,{role:f,lts:p,succ:!0,csAddr:l,serverList:C.gatewayInfo.gatewayAddrs.map(B=>B.address),ec:null,opid:w,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:C.gatewayInfo.res.detail&&C.gatewayInfo.res.detail[38],vid:(U=C.gatewayInfo)===null||U===void 0?void 0:U.vid,resourceTimingInfo:C.resourceTimingInfo?JSON.stringify(C.resourceTimingInfo):void 0}),C.proxyInfo&&kt.joinWebProxyAP(t.sid,{lts:p,sucess:1,apServerAddr:l,turnServerAddrList:C.proxyInfo.addresses.map(B=>B.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1},C=>C.code!==W.OPERATION_ABORTED&&(C.code===W.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(kt.joinWebProxyAP(t.sid,{lts:p,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:C.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:_})}),N.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),C),!0)),r)}const E4=(e,t,s,r,i,l)=>{const{sid:A,clientId:u,cloudProxyServer:p}=s,f=[],b=w=>{w.flag===4096?kt.joinChooseServer(A,{role:s.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:l,corssRegionTagReq:s.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||kt.joinWebProxyAP(A,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:w.error.code,eventType:p,unilbsServerIds:i.toString()})};if(e.response_body.forEach(w=>{const _=w.buffer.code;if(w.uri===23&&_===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const C={error:new Le(W.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:G("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:w.buffer.flag};f.push(C),b(C)}if(_!==0){const C=Rf(_),U={error:new Le(W.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:e.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?N.warning(U.error.toString()):f.push(U),b(U)}}),f.length)throw N.warning("[".concat(u||"sid-".concat(A.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(f.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new Le(W.CAN_NOT_GET_GATEWAY_SERVER,f.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!f.find(w=>w.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(w=>{var _;return w==null||(_=w.error)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.desc}).filter(w=>!!w))]})},HN=e=>{var t,s,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Le(W.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(G("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?v4(e.detail[23].toLowerCase()):v4()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((s=e.detail)===null||s===void 0?void 0:s[19])=="string"){const A=e.detail[19],u=A==null?void 0:A.split(";");for(let p=0;p<u.length;p++){var l;const f=da(l=u[p]).call(l);e.addresses[p]&&u&&(e.addresses[p].fingerprint=f)}}if(G("GATEWAY_ADDRESS")&&G("GATEWAY_ADDRESS").length>0){N.debug("assign gateway address to",G("GATEWAY_ADDRESS"));const A=G("GATEWAY_ADDRESS").map(u=>{var p,f;const b=(p=(f=e.addresses.find(w=>w.ip===u.ip&&w.port===u.port))===null||f===void 0?void 0:f.fingerprint)!==null&&p!==void 0?p:"";return{ip:u.ip,port:u.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:u.fingerprint||b}});e.addresses=A}},Gee=(e,t)=>{if(e.response_body&&e.response_body.length){const s=e.response_body[0];if(s.buffer.code!==0){const r=Rf(s.buffer.code);throw new Le(W.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return s.buffer.ticket}throw N.debug("update ticket request received ap response without response body:",t),new Le(W.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},GN=(e,t,s)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Dd(Dd(Dd({6:e.stringUid,11:t,12:G("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:s,uid:e.uid||0}}]};l.request_bodies.forEach(u=>{e.multiIP&&e.multiIP.gateway_ip&&(u.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const A=new FormData;return A.append("request",JSON.stringify(l)),[A,r]},Kee=(e,t)=>{const s=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,s]};let kf=0;function Df(e){return mt.all(e.map(t=>t.then(s=>{throw s},s=>s))).then(t=>{throw t},t=>t)}const X0=async e=>{let{fragementLength:t,referenceList:s,asyncMapHandler:r,allFailedhandler:i,promisesCollector:l}=e,A=0;const u=t;let p,f=0;const b=async()=>{const w=(()=>{const _=A*u,C=_+u;return s.slice(_,C).map(r)})();l&&l.push(...w);try{p=await Df(w)}catch(_){if(f+=u,A++,!(f>=s.length))return void await b();i(_)}w.forEach(_=>_.cancel())};return await b(),p},S4=async e=>{let{referenceList:t,asyncMapHandler:s,closeFn:r}=e;const i=t.length;let l=0;const A=async()=>{const u=s(t.shift());try{return await u}catch(p){if(l++,l>=i||r!=null&&r(p))throw p;return A()}};return A()};async function Wee(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],l=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],A=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new mt((p,f)=>{let b;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:_=>{_.close(),clearTimeout(b),p(!0)},error:_=>{clearTimeout(b),p(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const w=[t,s,r,i,l,A];for(let _=0;_<w.length;_++){const C=new EncodedVideoChunk({type:_==0?"key":"delta",timestamp:33333*_,duration:33333,data:new Uint8Array(w[_])});try{await e.decode(C)}catch{return void p(!1)}}})(),b=setTimeout(()=>{p(!1)},5e3)})}async function Yw(e,t,s,r){return{gatewayInfo:await async function(l,A,u,p){let f=null;const b=[],w=async()=>{const C=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(j=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:Y0()})),U=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),B=await X0({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(N.debug("[".concat(l.clientId,"] Connect to choose_server:"),j.url),_4(j,l,A,u)),allFailedhandler:j=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:b});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},U),B},_=async()=>{if(await Qn(1e3),f!==null)return f;const C=G("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:Y0()})),U=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),B=await X0({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(N.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),j.url),_4(j,l,A,u)),allFailedhandler:j=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:b});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},U),B};try{return f=await Df([w(),_()]),b.length&&b.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),f}catch(C){throw C[0]}}(e,t,s,r)}}async function C4(e,t,s,r,i){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await Yw(e,t,s,i);if(G("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:C}=await R4(e,t,s,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:_};const U=C.map(B=>({turnServerURL:B.address,tcpport:B.tcpport||Ei.tcpport,udpport:B.udpport||Ei.udpport,username:B.username||Ei.username,password:B.password||Ei.password,forceturn:!1,security:!0}));if(i.useP2P){var A;const B=(A=e.uid)!==null&&A!==void 0?A:_.uid,j="glb:".concat(B.toString()),K=await C1(j),q=C.map(ie=>({turnServerURL:ie.address,tcpport:ie.tcpport||Ei.tcpport,udpport:ie.udpport||Ei.udpport,username:j,password:K,forceturn:!1,security:!0}));U.push(...q)}return e.turnServer={mode:"manual",servers:U},{gatewayInfo:_}}return await Yw(e,t,s,i)}const{proxyInfo:u,gatewayInfo:p}=await R4(e,t,s,i),f={gatewayInfo:p},b=u.map(_=>({turnServerURL:_.address,tcpport:l==="proxy3"?void 0:_.tcpport?_.tcpport:Ei.tcpport,udpport:l==="proxy4"?void 0:_.udpport?_.udpport:Ei.udpport,username:_.username||Ei.username,password:_.password||Ei.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(i.useP2P){var w;const _=(w=e.uid)!==null&&w!==void 0?w:p.uid,C="glb:".concat(_.toString()),U=await C1(C),B=u.map(j=>({turnServerURL:j.address,tcpport:l==="proxy3"?void 0:j.tcpport||Ei.tcpport,udpport:l==="proxy4"?void 0:j.udpport||Ei.udpport,username:C,password:U,forceturn:l!=="proxy4",security:l==="proxy5"}));b.push(...B)}return e.turnServer={mode:"manual",servers:b},N.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),f}async function N4(e,t,s,r,i){const l=G("ACCOUNT_REGISTER").slice(0,G("AJAX_REQUEST_CONCURRENT"));let A=[];A=t.proxyServer?l.map(p=>"https://".concat(t.proxyServer,"/ap/?url=").concat(p+"/api/v1")):l.map(p=>"https://".concat(p,"/api/v1"));const u=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:A});try{const p=await async function(f,b,w,_,C){const U=Date.now(),B={sid:w.sid,opid:10,appid:w.appId,string_uid:b};let j=f[0];const K=await kl(()=>Ul(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:B,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(q,ie)=>{if(q.code===0){if(q.uid<=0||q.uid>=Math.pow(2,32))throw N.error("Invalid Uint Uid ".concat(b," => ").concat(q.uid),q),kt.reqUserAccount(B.sid,{lts:U,success:!1,serverAddr:j,stringUid:B.string_uid,uid:q.uid,errorCode:W.INVALID_UINT_UID_FROM_STRING_UID,extend:B}),new Le(W.INVALID_UINT_UID_FROM_STRING_UID);return kt.reqUserAccount(B.sid,{lts:U,success:!0,serverAddr:j,stringUid:B.string_uid,uid:q.uid,errorCode:null,extend:B}),!1}const xe=Rf(q.code);return xe.retry&&(j=f[(ie+1)%f.length]),kt.reqUserAccount(B.sid,{lts:U,success:!1,serverAddr:j,stringUid:B.string_uid,uid:q.uid,errorCode:xe.desc,extend:B}),xe.retry},(q,ie)=>q.code!==W.OPERATION_ABORTED&&(kt.reqUserAccount(B.sid,{lts:U,success:!1,serverAddr:j,stringUid:B.string_uid,uid:null,errorCode:q.code,extend:B}),j=f[(ie+1)%f.length],!0),C);if(K.code!==0){const q=Rf(K.code);throw new Le(W.UNEXPECTED_RESPONSE,q.desc)}return K}(A,e,t,s,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},u),p.uid}catch(p){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[p]},u),p}}async function zee(e,t,s){const r=G("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):r.map(l=>"https://".concat(l,"/api/v1"));try{return await S4({referenceList:i,asyncMapHandler:A=>async function(u,p,f,b){const w=Date.now(),_={sid:f.sid,opid:10,appid:f.appId,string_uid:p};try{const C=await Ul(u+"".concat(u.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(C.code!==0){const U=Rf(C.code);throw new Le(W.UNEXPECTED_RESPONSE,"preload sua error:".concat(U.desc),U)}if(C.uid<=0||C.uid>=Math.pow(2,32))throw new Le(W.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:u,req:_,uid:C.uid,elapse:Date.now()-w}}catch(C){throw C}}(A,e,t,s),closeFn:A=>A.code===W.OPERATION_ABORTED||A.code===W.UNEXPECTED_RESPONSE&&!A.data.retry})}catch(l){throw l}}async function qee(e,t,s){const r=G("CDS_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")),i=r.map(p=>function(f,b,w,_){const C=zs(),U={flag:64,cipher_method:0,features:Dd(Dd(Dd(Dd(Dd({install_id:F1(),device:C.name,system:C.os,system_general:navigator.userAgent,vendor:b.appId,version:lc,cname:b.cname,session_id:b.sid,proxyServer:b.proxyServer,sdk_type:Uee.WEB_RTC,browser_name:C.name,browser_version:C.version,user_agent:navigator.userAgent,channel_name:b.cname},b.stringUid&&{string_uid:b.stringUid}),b.uid&&{uid:b.uid+""}),C.os&&{os_name:C.os}),C.osVersion&&{os_version:C.osVersion}),{},{detail:""})};return kl(()=>Ul(f,{data:U,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,B=>B.code!==W.OPERATION_ABORTED,_)}(p,e,t,s));let l=null,A=null,u={};try{l=await Df(i)}catch(p){if(p.code===W.OPERATION_ABORTED)throw p;A=p}if(i.forEach(p=>p.cancel()),kt.reportApiInvoke(e.sid,{name:kr.REQUEST_CONFIG_DISTRIBUTE,options:{error:A,res:l}}).onSuccess(),l&&l.test_tags)try{u=function(p){if(!p.test_tags)return{};const f=p.test_tags,b=Object.keys(f),w={};return b.forEach(_=>{var C;const U=da(C=_.slice(4)).call(C),B=JSON.parse(f[_]),j=B[1];w[U]={tag:B[0]||"",value:j}}),w}(l)}catch{}return u}async function T4(e,t){const s=G("WEBCS_DOMAIN").concat(G("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Y0(),serviceIds:[mn.CHOOSE_SERVER,mn.CLOUD_PROXY_FALLBACK]}));try{return await S4({referenceList:s,asyncMapHandler:i=>async function(l,A,u){let p,{url:f,areaCode:b,serviceIds:w}=l;const _=Date.now(),[C,U]=GN(A,b,w);let B=Wr.networkState;try{B&&Wr.networkState===ua.OFFLINE&&Wr.onlineWaiter&&await mt.race([Wr.onlineWaiter,Qn(pn.maxRetryTimeout)]),B=Wr.networkState;const{data:j,headers:K}=await Ul(f,{data:C,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=K.http3==="1"?1:-1,(ye=>{const ue=[];if(ye.response_body.forEach(Re=>{const Ge=Re.buffer.code;if(Re.uri===23&&Ge===0&&!Re.buffer.edges_services)if(Re.buffer.flag===4194310)Re.buffer.edges_services=[];else{const Ze={error:new Le(W.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:G("NO_EDGES_RETRY"),csIp:ye.detail[502]}),flag:Re.buffer.flag};ue.push(Ze)}if(Ge!==0){const Ze=Rf(Ge),_t={error:new Le(W.CAN_NOT_GET_GATEWAY_SERVER,Ze.desc,{desc:Ze.desc,retry:Ze.retry,csIp:ye.detail[502]}),flag:Re.buffer.flag};Re.buffer.flag===4194310?N.warning(_t.error.toString()):ue.push(_t)}}),ue.length)throw new Le(W.CAN_NOT_GET_GATEWAY_SERVER,ue.map(Re=>"flag: ".concat(Re.flag,", message: ").concat(Re.error.message)).join(" | "),{retry:!!ue.find(Re=>Re.error.data.retry),csIp:ye.detail[502],desc:[...new Set(ue.map(Re=>{var Ge;return Re==null||(Ge=Re.error)===null||Ge===void 0||(Ge=Ge.data)===null||Ge===void 0?void 0:Ge.desc}).filter(Re=>!!Re))]})})(j);const ie=H0(j,mn.CHOOSE_SERVER),xe=H0(j,mn.CLOUD_PROXY_FALLBACK);return HN(ie),{gatewayInfo:RN(ie,f),proxyInfo:xe,opid:U,requestTime:_,url:f,isHttp3:p,elapse:Date.now()-_}}catch(j){throw j}}(i,e,t),closeFn:i=>i.code===W.OPERATION_ABORTED||i.code===W.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function R4(e,t,s,r){const i=G("PROXY_SERVER_TYPE3"),l=(C,U,B)=>{let j=B||i;return Array.isArray(j)&&(j=U%2==0&&i[1]||i[0]),"https://".concat(j,"/ap/?url=").concat(C)};let A=null;const u=[],p=async()=>{const C=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((j,K)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(j,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):l("".concat(j,"/api/v2/transpond/webrtc?v=2"),K),{url:q,areaCode:Y0(),serviceIds:[mn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?mn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?mn.CLOUD_PROXY:mn.CLOUD_PROXY_FALLBACK]}}),U=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),B=await X0({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(N.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),y4(j,e,t,s)),allFailedhandler:j=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:u});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},U),B},f=async()=>{if(await Qn(1e3),A!==null)return A;const C=G("WEBCS_DOMAIN_BACKUP_LIST").map((j,K)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(j,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):l("".concat(j,"/api/v2/transpond/webrtc?v=2"),K),{url:q,areaCode:Y0(),serviceIds:[mn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?mn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?mn.CLOUD_PROXY:mn.CLOUD_PROXY_FALLBACK]}}),U=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),B=await X0({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(N.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),y4(j,e,t,s)),allFailedhandler:j=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:u});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},U),B};let b,w,_;try{({gatewayInfo:b,proxyInfo:w,url:_}=await Df([p(),f()]))}catch(C){throw C[0]}if(u.length&&u.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),!b||!w)throw new Le(W.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=_,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&_){const C=/^https?:\/\/(.+?)(\/.*)?$/.exec(_)[1];nt(i).call(i,C)&&(e.proxyServer=C,N.setProxyServer(C),kt.setProxyServer(C))}return A={gatewayInfo:b,proxyInfo:await ZU(w,b.uid)},A}async function Yee(e,t,s){const r=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),i=r.map(l=>function(A,u,p,f){const b={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:lc,cname:u.cname,uid:u.uid.toString(),requestId:QN,seq:QN};QN+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(b)};return kl(async()=>{const _=await Ul(A,{data:w,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_.code!==0){const U=new Le(W.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_.code,{retry:!0});throw N.error(U.toString()),U}const C=JSON.parse(_.json_body);if(C.code!==200){const U=new Le(W.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw N.error(U.toString()),U}if(!C.servers||C.servers.length===0){const U=new Le(W.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw N.error(U.toString()),U}return{vid:C.vid,workerToken:C.workerToken,addressList:(G("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(U.wss))}},void 0,_=>!!(_.code!==W.OPERATION_ABORTED&&_.code!==W.UNEXPECTED_RESPONSE||_.data&&_.data.retry),f)}(l,e,t,s));try{const l=await Df(i);return i.forEach(A=>A.cancel()),l}catch(l){throw l[0]}}async function Xee(e,t,s){let r=null;const i=[],l=async A=>{const u=G(A?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v2/transpond/webrtc?v=2"):"https://".concat(p,"/api/v2/transpond/webrtc?v=2"));return A&&(await Qn(1e3),r!==null)?r:await X0({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:p=>(N.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(A?"backup":""," choose_server:"),p),function(f,b,w,_){const[C]=Kee(b,[mn.CHOOSE_SERVER]);let U=Wr.networkState;return kl(async()=>{U&&Wr.networkState===ua.OFFLINE&&Wr.onlineWaiter&&await mt.race([Wr.onlineWaiter,Qn(_&&_.maxRetryTimeout||pn.maxRetryTimeout)]),U=Wr.networkState;const B=await Ul(f,{data:C,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return Gee(B,f)},()=>!1,B=>B.code!==W.OPERATION_ABORTED&&(B.code===W.UPDATE_TICKET_FAILED?B.data.retry:(N.warning("[".concat(b.clientId,"] update ticket network error, retry"),B),!0)),_)}(p,e,t,s)),allFailedhandler:p=>{throw p[0]},promisesCollector:i})};try{return r=await Df([l(!1),l(!0)]),i.length&&i.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),r}catch(A){throw A[0]}}function I4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function KN(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?I4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):I4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class Jee extends jr{get isSuccess(){return!!this.configs}constructor(t,s){super(),P(this,"configs",void 0),P(this,"store",void 0),P(this,"joinInfo",void 0),P(this,"cancelToken",void 0),P(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),P(this,"interval",void 0),P(this,"mutex",void 0),P(this,"mutableParamsRead",!1),P(this,"configCache",{}),P(this,"limit_bitrate",void 0),this.mutex=new $n("config-distribute",t),this.store=s}startGetConfigDistribute(t,s){this.joinInfo=t,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),G("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},G("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,kt.reportApiInvoke(null,{options:void 0,name:kr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:br.TRACER}).onSuccess(JSON.stringify(Lo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void N.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const s=await this.mutex.lock();try{t=await qee(this.joinInfo,this.cancelToken,this.retryConfig),N.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(i){var l;const A=Kh(l=Object.keys(i).filter(f=>/^webrtc_ng_global_parameter/.test(f))).call(l);for(let f=0;f<A.length;f++)for(let b=A.length-1;b>f;b--){const w=A[b],_=i[w].value;if(typeof _.__priority=="number"){const C=_.__priority,U=A[b-1],B=i[U].value;if(typeof B.__priority=="number"){if(!(C>B.__priority))continue;{const j=w;A[b]=A[b-1],A[b-1]=j}}else{const j=w;A[b]=A[b-1],A[b-1]=j}}}const u=Date.now(),p={};return A.forEach(f=>{const b=i[f].value.__expires;b&&b<=u||(p[f]=i[f])}),p}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new Le(W.NETWORK_RESPONSE_ERROR,r);N.warning("[config-distribute] ".concat(i.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){GU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Ll.UPDATE_BITRATE_LIMIT,t):this.emit(Ll.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&KN({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const s={},r=Object.keys(t),i=[];r.forEach(l=>{const A=t[l].value;s[l]=A;const u=A.__id;if(u&&this.configCache[l]&&this.configCache[l].__id===u)return;const p=A.__type,f=t[l].value,b=t[l].tag;let w=0;p?p===lj.REALTIME&&(w=1):Object.keys(f).some(_=>Object.prototype.hasOwnProperty.call(H1,_)||!gN()&&Object.prototype.hasOwnProperty.call(uw,_)?(w=1,!0):void 0),i.push({tag:b,isApplied:w,feature:l,params:JSON.stringify(A)})}),i.forEach(l=>{let{tag:A,feature:u,params:p,isApplied:f}=l;this.store.sessionId&&kt.abTest(this.store.sessionId,{intSucc:1,isApplied:f,tag:A,feature:u,params:p,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){N.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(t){const s=function(i){const l={};return Object.keys(i).forEach(A=>{const u=i[A].value,p=u.__expires,f=u.__type;Object.keys(u).forEach(b=>{b==="__id"||b==="__type"||b==="__priority"||b==="__expires"||Object.prototype.hasOwnProperty.call(l,b)||(l[b]=KN(KN({value:u[b]},p&&{expires:p}),f&&{type:f}))})}),l}(t);try{var r;const i=(r=s.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete s.LIMIT_BITRATE,i&&GU(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(t),function(u){try{const p=Date.now();Object.keys(u).forEach(f=>{const{value:b,type:w,expires:_}=u[f];_&&_<=p||((w===lj.REALTIME||Object.prototype.hasOwnProperty.call(H1,f))&&(Lo[f]=b,or[f]=b,N.debug("Update realtime parameters from config distribute",f,b)),w||gN()||!Object.prototype.hasOwnProperty.call(uw,f)||(Lo[f]=b,or[f]=b,N.debug("Update gateway parameters from config distribute",f,b)))})}catch(p){N.error("Error update config immediately: ".concat(u),p.message)}}(s);const l=JSON.stringify(s),A=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",A),N.debug("Caching global parameters ".concat(l))}catch(i){N.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const s=Date.now();Object.keys(t).forEach(r=>{switch(r){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(or,r)){const{value:l,expires:A}=t[r];if(A&&A<=s)return;O1(or[r],l)||(Lo[r]=l,or[r]=l,this.emit(Ll.UPDATE_CLIENT_ROLE_OPTIONS,l),N.debug("Updating client role options: ".concat(JSON.stringify(l))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(or,r)){var i;const{value:l,expires:A}=t[r];if(A&&A<=s)return;typeof l=="number"&&nt(i=[0,1,4,5,6,7,8,9]).call(i,l)&&(Lo[r]={value:l},or[r]=l,this.emit(Ll.UPDATE_REMOTE_VIDEO_STREAM_TYPE,l),N.debug("Updating client remote stream type: ".concat(JSON.stringify(l))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(or,r)){const{value:l,expires:A}=t[r];if(A&&A<=s)return;O1(or[r],l)||(Lo[r]=l,or[r]=l,this.emit(Ll.FALLBACK_TO_HLS,l),N.debug("Updating enable force hls: ".concat(JSON.stringify(l))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(or,r)){const{value:l,expires:A}=t[r];if(A&&A<=s)return;O1(or[r],l)||(Lo[r]=l,or[r]=l,this.emit(Ll.UPDATE_VOS_CONFIGURE,l),N.debug("Updating vos configure: ".concat(JSON.stringify(l))))}}})}catch(s){N.error("Error handling global parameter config:",s.message)}}}class $ee extends jr{constructor(){super(...arguments),P(this,"resultStorage",new Map)}setLocalAudioStats(t,s,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,s))}setLocalVideoStats(t,s,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,s)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,s)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,s){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(s))}setRemoteVideoStats(t,s){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(s))}record(t,s,r){if(G("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const l=t==="VIDEO_ENCODE_FAILED"?G("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=l){var A;const u=nt(A=i.result).call(A,!0);i.isPrevNormal&&!u&&this.emit("exception",WN[t],t,s),!i.isPrevNormal&&u&&this.emit("exception",WN[t]+2e3,t+"_RECOVER",s),i.isPrevNormal=u,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,s){return s instanceof Tn&&!s.isActive||!!s.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,s){let r=null;s._encoderConfig&&s._encoderConfig.frameRate&&(r=ka(s._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var s;return!(!t.codecType||nt(s=G("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,s){return!!s.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,s){return s instanceof Tn&&!s.isActive||!!s.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const WN={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Li=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(s.length>0){const r=s[s.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(s.length>0){const r=s[s.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function O4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function vp(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?O4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):O4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class J0{constructor(t){P(this,"store",void 0),P(this,"onStatsException",void 0),P(this,"onUploadPublishDuration",void 0),P(this,"onStatsChanged",void 0),P(this,"onVideoCodecChanged",void 0),P(this,"localStats",new Map),P(this,"remoteStats",new Map),P(this,"updateStatsInterval",void 0),P(this,"trafficStats",void 0),P(this,"trafficStatsPeerList",[]),P(this,"uplinkStats",void 0),P(this,"exceptionMonitor",void 0),P(this,"p2pChannel",void 0),P(this,"scalabilityMode",dw.L1T1),P(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new $ee,this.exceptionMonitor.on("exception",(s,r,i)=>{this.onStatsException&&this.onStatsException(s,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(at.LocalAudioTrack)||vp({},Y1)}getLocalVideoTrackStats(){return this.localStats.get(at.LocalVideoTrack)||vp({},X1)}getRemoteAudioTrackStats(t){const s=(l,A)=>{if(!this.trafficStats)return A;const u=this.trafficStats.peer_delay.find(p=>p.peer_uid===l);return u&&(A.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),A},r={};if(t){var i;const l=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;l&&(r[t]=s(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[A,{audioStats:u}]=l;u&&(r[A]=s(A,u))});return r}getRemoteNetworkQualityStats(t){const s={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(s[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[l,{networkStats:A}]=i;A&&(s[l]=A)});return s}getNetworkQuality(){let t=0,s=0;return this.trafficStats&&(t=Mw(this.trafficStats.B_unq),s=Mw(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:s}}getRemoteVideoTrackStats(t){const s=(l,A)=>{if(!this.trafficStats)return A;const u=this.trafficStats.peer_delay.find(p=>p.peer_uid===l);return u&&(A.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),A},r={};if(t){var i;const l=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;l&&(r[t]=s(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[A,{videoStats:u}]=l;u&&(r[A]=s(A,u))});return r}getRTCStats(){let t=0,s=0,r=0,i=0;const l=this.localStats.get(at.LocalAudioTrack);l&&(t+=l.sendBytes,s+=l.sendBitrate);const A=this.localStats.get(at.LocalVideoTrack);A&&(t+=A.sendBytes,s+=A.sendBitrate);const u=this.localStats.get(at.LocalVideoLowTrack);u&&(t+=u.sendBytes,s+=u.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:b,videoStats:w}=f;b&&(r+=b.receiveBytes,i+=b.receiveBitrate),w&&(r+=w.receiveBytes,i+=w.receiveBitrate)});let p=1;return this.trafficStats&&(p+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:p,SendBitrate:s,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),t.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(s.peer_uid),l=i!=null&&i.videoSSRC?Li.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,A=i!=null&&i.audioSSRC?Li.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,l>A?l:A),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&N.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,s,r){if(!t)return!1;const i=!!r&&s.framesDecodeFreezeTime>r.framesDecodeFreezeTime,l=!r||s.framesDecodeCount>r.framesDecodeCount;return i||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(s=>{let[r,i]=s;switch(r){case at.LocalVideoTrack:case at.LocalVideoLowTrack:{const u=i,p=vp({},X1),f=t.getStats(),b=t.getLocalMedia(r);if(f){const w=f.videoSend.find(_=>_.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(w){const _=t.getLocalVideoSize(),C=t.getEncoderConfig(at.LocalVideoTrack);var l;(w.codec==="H264"||w.codec==="H265"||w.codec==="VP8"||w.codec==="VP9"||w.codec==="AV1X"||w.codec==="AV1")&&(p.codecType=w.codec,(u==null?void 0:u.codecType)!==w.codec&&((l=this.onVideoCodecChanged)===null||l===void 0||l.call(this,w.codec.toLocaleLowerCase()))),p.sendBytes=w.bytes,p.sendBitrate=u?8*Math.max(0,p.sendBytes-u.sendBytes):0,w.inputFrame?(p.captureFrameRate=w.inputFrame.frameRate,p.captureResolutionHeight=w.inputFrame.height,p.captureResolutionWidth=w.inputFrame.width):_&&(p.captureResolutionWidth=_.width,p.captureResolutionHeight=_.height),w.sentFrame?(p.sendFrameRate=w.sentFrame.frameRate,p.sendResolutionHeight=w.sentFrame.height,p.sendResolutionWidth=w.sentFrame.width):_&&(p.sendResolutionWidth=_.width,p.sendResolutionHeight=_.height),w.avgEncodeMs&&(p.encodeDelay=w.avgEncodeMs),C&&C.bitrateMax?p.targetSendBitrate=1e3*C.bitrateMax:w.targetBitrate&&(p.targetSendBitrate=w.targetBitrate),p.sendPackets=w.packets,p.sendPacketsLost=w.packetsLost,p.sendJitterMs=w.jitterMs,p.sendRttMs=w.rttMs,p.totalDuration=u?u.totalDuration+1:1,p.totalFreezeTime=u?u.totalFreezeTime:0,this.isLocalVideoFreeze(w)&&(p.totalFreezeTime+=1),w.scalabilityMode&&this.scalabilityMode!==w.scalabilityMode&&(N.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(w.scalabilityMode)),this.scalabilityMode=w.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var A;this.localStats.set(r,p),((u==null?void 0:u.sendResolutionWidth)!==p.sendResolutionWidth||(u==null?void 0:u.sendResolutionHeight)!==p.sendResolutionHeight)&&((A=this.onStatsChanged)===null||A===void 0||A.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&b&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,b.track,p);break}case at.LocalAudioTrack:{const u=i,p=vp({},Y1),f=t.getStats(),b=t.getLocalMedia(r);if(f){const w=f.audioSend.find(_=>_.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(w){if(w.codec!=="opus"&&w.codec!=="aac"&&w.codec!=="PCMU"&&w.codec!=="PCMA"&&w.codec!=="G722"||(p.codecType=w.codec),w.inputLevel)p.sendVolumeLevel=Math.round(32767*w.inputLevel);else{const _=t.getLocalAudioVolume();_&&(p.sendVolumeLevel=Math.round(32767*_))}p.sendBytes=w.bytes,p.sendPackets=w.packets,p.sendPacketsLost=w.packetsLost,p.sendJitterMs=w.jitterMs,p.sendRttMs=w.rttMs,p.sendBitrate=u?8*Math.max(0,p.sendBytes-u.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(at.LocalAudioTrack,p),p&&b&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,b.track,p);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(s=>{var r,i;let[l,{videoStats:A,audioStats:u,videoPcStats:p}]=s;const f=u,b=A,w=p,_=vp({},yj),C=vp({},Ej),U=vp({},PZ),{audioTrack:B,videoTrack:j,audioSSRC:K,videoSSRC:q}=t.getRemoteMedia(l);let ie;ie=this.store.useP2P?t.getStats(!0):t.getStats();const xe=(r=ie)===null||r===void 0?void 0:r.audioRecv.find(Ge=>Ge.ssrc===K),ye=(i=ie)===null||i===void 0?void 0:i.videoRecv.find(Ge=>Ge.ssrc===q),ue=this.trafficStats&&this.trafficStats.peer_delay.find(Ge=>Ge.peer_uid===l);if(xe&&(xe.codec!=="opus"&&xe.codec!=="aac"&&xe.codec!=="PCMU"&&xe.codec!=="PCMA"&&xe.codec!=="G722"||(_.codecType=xe.codec),xe.outputLevel?_.receiveLevel=Math.round(32767*xe.outputLevel):B&&(_.receiveLevel=Math.round(32767*B.getVolumeLevel())),_.receiveBytes=xe.bytes,_.receivePackets=xe.packets,_.receivePacketsLost=xe.packetsLost,_.receivePacketsDiscarded=xe.packetsDiscarded,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=f?8*Math.max(0,_.receiveBytes-f.receiveBytes):0,_.totalDuration=f?f.totalDuration+1:1,_.totalFreezeTime=f?f.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=xe.jitterBufferMs,_.totalDuration>10&&J0.isRemoteAudioFreeze(B)&&(_.totalFreezeTime+=1)),ye){var Re;ye.codec!=="H264"&&ye.codec!=="H265"&&ye.codec!=="VP8"&&ye.codec!=="VP9"&&ye.codec!=="AV1X"&&ye.codec!=="AV1"||(C.codecType=ye.codec),C.receiveBytes=ye.bytes,C.receiveBitrate=b?8*Math.max(0,C.receiveBytes-b.receiveBytes):0,C.decodeFrameRate=ye.decodeFrameRate<0?0:ye.decodeFrameRate,C.renderFrameRate=ye.decodeFrameRate<0?0:ye.decodeFrameRate,ye.outputFrame&&(C.renderFrameRate=ye.outputFrame.frameRate),ye.receivedFrame?(C.receiveFrameRate=ye.receivedFrame.frameRate,C.receiveResolutionHeight=ye.receivedFrame.height,C.receiveResolutionWidth=ye.receivedFrame.width):j&&(C.receiveResolutionHeight=j._videoHeight||0,C.receiveResolutionWidth=j._videoWidth||0),ye.framesRateFirefox!==void 0&&(C.receiveFrameRate=Math.round(ye.framesRateFirefox)),C.receivePackets=ye.packets,C.receivePacketsLost=ye.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost);const Ge=b?b.totalFreezeTime:0,Ze=b?b.totalDuration:0;C.totalDuration=b?b.totalDuration+1:1,C.totalFreezeTime=(Re=ye.totalFreezesDuration)!==null&&Re!==void 0?Re:Ge||0,C.receiveDelay=ye.jitterBufferMs||0;const _t=!!q&&t.getRemoteVideoIsReady(q);ye.totalFreezesDuration===void 0&&j&&_t&&J0.isRemoteVideoFreeze(j,ye,w)&&(C.totalFreezeTime+=1),C.freezeRate=Math.max(0,Math.min((C.totalFreezeTime-Ge)/(C.totalDuration-Ze),1))}ue&&(_.end2EndDelay=ue.B_ad,C.end2EndDelay=ue.B_vd,_.transportDelay=ue.B_ed,C.transportDelay=ue.B_ed,_.currentPacketLossRate=ue.B_ealr4/100,C.currentPacketLossRate=ue.B_evlr4/100,U.uplinkNetworkQuality=ue.B_punq?ue.B_punq:0,U.downlinkNetworkQuality=ue.B_pdnq?ue.B_pdnq:0),this.remoteStats.set(l,{audioStats:_,videoStats:C,videoPcStats:ye,networkStats:U}),B&&this.exceptionMonitor.setRemoteAudioStats(B,_),j&&this.exceptionMonitor.setRemoteVideoStats(j,C)})}}class k4{constructor(){P(this,"destChannelMediaInfos",new Map),P(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){QU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){QU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Dw(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function D4(e){if(!(e instanceof k4))return new Le(W.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),s=e.getDestChannelMediaInfo();if(!t)return new Le(W.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Le(W.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Bu{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,s){P(this,"uid",void 0),P(this,"_uintid",void 0),P(this,"_trust_in_room_",!0),P(this,"_trust_audio_enabled_state_",!0),P(this,"_trust_video_enabled_state_",!0),P(this,"_trust_audio_mute_state_",!0),P(this,"_trust_video_mute_state_",!0),P(this,"_audio_muted_",!1),P(this,"_video_muted_",!1),P(this,"_audio_enabled_",!0),P(this,"_video_enabled_",!0),P(this,"_audio_added_",!1),P(this,"_video_added_",!1),P(this,"_is_pre_created",!1),P(this,"_video_pre_subscribed",!1),P(this,"_audio_pre_subscribed",!1),P(this,"_trust_video_stream_added_state_",!0),P(this,"_trust_audio_stream_added_state_",!0),P(this,"_audioTrack",void 0),P(this,"_videoTrack",void 0),P(this,"_dataChannels",[]),P(this,"_audioSSRC",void 0),P(this,"_videoSSRC",void 0),P(this,"_audioOrtc",void 0),P(this,"_videoOrtc",void 0),P(this,"_cname",void 0),P(this,"_rtxSsrcId",void 0),P(this,"_videoMid",void 0),P(this,"_audioMid",void 0),this.uid=t,this._uintid=s}}function B4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function zN(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?B4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):B4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const Zee=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),Xw="9",qN=2e4,Jw=4e4;let L4=class{get localCapabilities(){return Rr(this._localCapabilities)}get rtpCapabilities(){return Rr(this._rtpCapabilities)}get candidates(){return Rr(this._candidates)}get iceParameters(){return Rr(this._iceParameters)}get dtlsParameters(){return Rr(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];P(this,"sessionDesc",void 0),P(this,"_localCapabilities",void 0),P(this,"_rtpCapabilities",void 0),P(this,"_candidates",void 0),P(this,"_originCandidates",void 0),P(this,"_iceParameters",void 0),P(this,"_isUseExtmapAllowMixed",void 0),P(this,"_isUseLocalCodecs",void 0),P(this,"_isUseDataChannel",void 0),P(this,"_dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname",void 0),P(this,"useLocalCodecsMids",[]),P(this,"preloadSsrcs",[]),P(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=s,this._isUseDataChannel=r,e=Rr(e);const{iceParameters:i,dtlsParameters:l,candidates:A,rtpCapabilities:u,setup:p,localCapabilities:f,cname:b}=e;this._rtpCapabilities=u,this._candidates=A,this._originCandidates=Rr(A),this._iceParameters=i,this._dtlsParameters=l,this._localCapabilities=f,this.setup=p,this.cname=b,[this.sessionDesc]=this.updateRemoteRTPCapabilities(u),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var s;return nt(s=this.preloadSsrcs).call(s,t)})}preloadRemoteMedia(e){let t=0;const s=[],r=[];for(;e>0;){const i=[zN({ssrcId:Jw+t},G("USE_SUB_RTX")?{rtx:Jw+t+1}:{})],l="".concat(Jw+t,"_").concat(qN+t),{ssrcs:A,ssrcGroups:u}=W0(i,this.cname,G("SYNC_GROUP")?l:void 0),p=this.preCreateOrRecycleSendMedia("video",A,u,void 0),f=[{ssrcId:qN+t}],b="".concat(Jw+t,"_").concat(qN+t),{ssrcs:w,ssrcGroups:_}=W0(f,this.cname,G("SYNC_GROUP")?b:void 0),C=this.preCreateOrRecycleSendMedia("audio",w,_,void 0);e--,t+=2,s.push(p,C),r.push(A[0].ssrcId,w[0].ssrcId)}return this.useLocalCodecsMids.push(...s),this.preloadSsrcs=r,{mids:s,preSSRCs:r,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,s,r){const i=this.rtpCapabilities.send.videoCodecs,l=this._isUseLocalCodecs||i.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;N.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const A=e===Tt.VIDEO?l.videoCodecs:l.audioCodecs,u=e===Tt.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let f={media:{mediaType:e,port:Xw,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};return f=this.mungSendMediaDesc(f,r),this.sessionDesc.mediaDescriptions.push(f),this.updateBundleMids(),p}toString(){return CA(this.sessionDesc)}send(e,t,s,r){const{ssrcs:i,ssrcGroups:l}=W0(t,this.cname,G("SYNC_GROUP")?s:void 0),A=this.findPreloadMediaDesc(i);if(A){if(Tr()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,A.attributes.mid),r&&(r.twcc||r.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(A);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(A,r),{mid:A.attributes.mid,needExchangeSDP:!0}}return{mid:A.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(e,i);let p;return u===-1||u===1&&(Jn()||function(){const f=zs();return!(f.name!==Ys.CHROME||!f.osVersion)&&Number(f.version)<=90}()||Ol(143)||Su(143)||G("RESERVE_MID_1_MLINE")||G("ENABLE_ENCODED_TRANSFORM")&&EA())||u===0&&!function(f){const b=zs();return!(b.name!==Ys.FIREFOX||!b.osVersion)&&Number(b.version)===f}(138)&&G("USE_SUB_RTX")||IL()?(p=this.createOrRecycleSendMedia(e,i,l,"sendonly",r),this.updateBundleMids()):(p=Rr(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=i,p.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,r)),Tr()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(i=>{let{kind:l,ssrcMsg:A,mslabel:u}=i;return this.send(l,A,u)}),s=[];let r=!1;return t.forEach(i=>{let{mid:l,needExchangeSDP:A}=i;A&&(r=!0),s.push(l)}),{mids:s,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(s=>{s.attributes.mid==="0"||Tr()||IL()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>nt(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>nt(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="recvonly"})}receive(e,t,s,r){e.forEach((i,l)=>{this.createOrRecycleRecvMedia(i,[],"recvonly",t,s,r[l])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||ha((s=this._isUseExtmapAllowMixed,this._isUseDataChannel?Zee(s):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(s?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var s;this._rtpCapabilities=e;let r=!1;const i=this.rtpCapabilities.send,l=this.localCapabilities.send,A=this.localCapabilities.recv,u=A.videoCodecs,p=A.audioCodecs,f=A.videoExtensions,b=A.audioExtensions;for(const U of t.mediaDescriptions){var w;if(U.attributes.direction!=="sendonly"||typeof U.attributes.mid!="string"||!nt(w=this.useLocalCodecsMids).call(w,U.attributes.mid)){if(r=!0,U.attributes.iceUfrag=this._iceParameters.iceUfrag,U.attributes.icePwd=this._iceParameters.icePwd,U.attributes.fingerprints=this._dtlsParameters.fingerprints,U.attributes.candidates=this._candidates,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var _;U.media.fmts=u.map(j=>j.payloadType.toString(10)),U.attributes.payloads=u,U.attributes.extmaps=f;const B=U.attributes.mid;typeof B!="string"||nt(_=this.useLocalCodecsMids).call(_,B)||this.useLocalCodecsMids.push(B)}else if(i.videoCodecs.length===0){const B=l.videoCodecs.filter(j=>{var K,q;return(K=j.rtpMap)===null||K===void 0?void 0:nt(q=K.encodingName.toLowerCase()).call(q,"vp8")});B.length===0&&B.push(l.videoCodecs[0]),U.media.fmts=B.map(j=>j.payloadType.toString(10)),U.attributes.payloads=B,U.attributes.extmaps=[]}else U.media.fmts=i.videoCodecs.map(B=>B.payloadType.toString(10)),U.attributes.payloads=i.videoCodecs,U.attributes.extmaps=i.videoExtensions;if(U.media.mediaType==="audio")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var C;U.media.fmts=p.map(j=>j.payloadType.toString(10)),U.attributes.payloads=p,U.attributes.extmaps=b;const B=U.attributes.mid;typeof B!="string"||nt(C=this.useLocalCodecsMids).call(C,B)||this.useLocalCodecsMids.push(B)}else if(i.audioCodecs.length===0){const B=l.audioCodecs.filter(j=>{var K,q;return(K=j.rtpMap)===null||K===void 0?void 0:nt(q=K.encodingName.toLowerCase()).call(q,"opus")})||[l.audioCodecs[0]];U.media.fmts=B.map(j=>j.payloadType.toString(10)),U.attributes.payloads=B,U.attributes.extmaps=[]}else U.media.fmts=i.audioCodecs.map(B=>B.payloadType.toString(10)),U.attributes.payloads=i.audioCodecs,U.attributes.extmaps=i.audioExtensions,Of(U)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,r]}updateCandidates(e){const t=this._originCandidates.filter(r=>r.transport==="udp"),s=[];if(t.forEach(r=>{s.push(zN(zN({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),t.length!==0){switch(e){case Zn.TCP_RELAY:this._candidates=s;break;case Zn.UDP_TCP_RELAY:case Zn.RELAY:this._candidates=[...t,...s];break;default:this._candidates=t}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Rr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const r=s.media.mediaType===e&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(Tr()){if(r){const i=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(i||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!i||i!==s.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(const s of this.sessionDesc.mediaDescriptions)if(s.media.mediaType==="application")return{mediaDesc:s,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:Xw,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,s,r,i,l){const A=e._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,p=q0(A,u,this.localCapabilities.send,A===Tt.VIDEO?r:i),f=A===Tt.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let w={media:{mediaType:A,port:Xw,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};w=this.mungRecvMediaDsec(w,e,l);const _=this.findFirstClosedMedia(A);if(_){const C=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[C]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(i=>i.fingerprint)),s=new Set(e.map(i=>i.fingerprint));let r=!1;t.size!==s.size&&(r=!0);for(const i of t)s.has(i)||(r=!0);return r}updateRemoteCodec(e,t,s){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(w=>w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||"").filter(w=>{var _;return nt(_=Object.keys(cp)).call(_,w)}))],i=new Set(t);if(r.every(w=>i.has(w)))return N.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const l=this._rtpCapabilities.recv.videoCodecs.filter(w=>t.some(_=>{var C;return nt(C=w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||"").call(C,_)}));if(l.length===0)return N.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const A=[...new Set(l.map(w=>w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||""))];let u;if(N.debug("updateRemoteCodec, from ".concat(r," to ").concat(A)),e.length===0)u=this.sessionDesc.mediaDescriptions.filter(w=>w.media.mediaType==="video"&&w.attributes.direction==="recvonly");else if(u=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&w.media.mediaType==="video"&&nt(e).call(e,w.attributes.mid)&&w.attributes.direction==="recvonly"),u.length!==e.length)return N.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(G("USE_PUB_RTX")||G("USE_SUB_RTX")){const w=Du(l,this.rtpCapabilities.recv.videoCodecs);l.push(...w)}this._rtpCapabilities.recv.videoCodecs=l;const p=this.localCapabilities.send,f=this.rtpCapabilities.recv,b=q0(Tt.VIDEO,f,p,s);return u.forEach(w=>{const _=b.map(C=>C.payloadType.toString(10));N.debug("updateRemoteCodec mid: ".concat(w.attributes.mid,", from"),w.attributes.payloads,"to",b),w.attributes.payloads=b,w.media.fmts=_}),N.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,s,r,i){const l=this.rtpCapabilities.send.videoCodecs,A=this._isUseLocalCodecs||l.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,u=e===Tt.VIDEO?A.videoCodecs:A.audioCodecs,p=e===Tt.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let b={media:{mediaType:e,port:Xw,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};b=this.mungSendMediaDesc(b,i);const w=this.findFirstClosedMedia(e);if(w){const _=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[_]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,s){const r=Rr(e);return kN(r),xp(r,t),DN(r,t),l4(r),Hw(r,s,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const s=Rr(e);return s.attributes&&s.attributes.payloads&&Array.isArray(s.attributes.payloads)&&s.attributes.payloads.length>0&&s.attributes.payloads.forEach(r=>{r.rtpMap&&r.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&G("ENABLE_DOWN_SPS_PPS")&&(r.fmtp&&r.fmtp.parameters||(r.fmtp={parameters:{}}),r.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),Hw(s,t,this.localCapabilities.recv),Of(s),s}updateRecvMedia(e,t){const s=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(s!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=r}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Tr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var s;return((s=t.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function j4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function IA(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?j4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):j4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}var Bf=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Bf||{});const $w=new Map;function P4(e,t,s,r){let{scale:i}=e;if(i===0&&r===Bf.UP||i>=t.length-1&&r===Bf.DOWN)return e;let l=IA(IA({},e),{},{scale:r===Bf.DOWN?++i:--i});switch(s){case"maintain-framerate":l=IA(IA({},l),t[i].motion);break;case"maintain-resolution":l=IA(IA({},l),t[i].detail);break;case"balanced":l=IA(IA({},l),t[i].balanced)}return l}function U4(e,t){if(t){const s={overUse:0,underUse:0,adaptationList:F4(t)};$w.set(e,s)}else $w.delete(e)}function F4(e){const t=IA({},e),{bitrateMax:s,frameRate:r,scaleResolutionDownBy:i,bitrateMin:l}=t,{MIN_FRAME_RATE:A,MAX_THRESHOLD_FRAMERATE:u,MAX_SCALE:p,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:b,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:_,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:U,BALANCE_BITRATE_FACTOR:B,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:K,MOTION_RESOLUTION_FACTOR:q,MOTION_BITRATE_FACTOR:ie,DETAIL_FRAMERATE_FACTOR:xe,DETAIL_BITRATE_FACTOR:ye}=V1,ue=Math.min(t.frameRate,u),Re=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(_,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(C,1)*ue),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:s,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:s,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:s,bitrateMin:l}}];for(let Ge=1;Ge<=p;Ge++){const Ze={bwe_up:Math.round(Math.pow(w,Ge)*s),bwe_down:Math.round(Math.pow(_,Ge+1)*s),fps_up:Math.round(Math.pow(U,Ge)*ue),fps_down:Math.round(Math.pow(C,Ge+1)*ue)},_t={scaleResolutionDownBy:i/Math.pow(K,Ge),frameRate:Math.max(Math.round(Math.pow(j,Ge)*r),A),bitrateMax:Math.max(Math.round(Math.pow(B,Ge)*s),b),bitrateMin:Math.max(Math.round(Math.pow(B,Ge)*l),f)},ns={scaleResolutionDownBy:i/Math.pow(q,Ge),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(ie,Ge)*s),b),bitrateMin:Math.max(Math.round(Math.pow(ie,Ge)*l),f)},Jt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(xe,Ge)*r),A),bitrateMax:Math.max(Math.round(Math.pow(ye,Ge)*s),b),bitrateMin:Math.max(Math.round(Math.pow(ye,Ge)*l),f)};Re.push({scale:Ge,threshold:Ze,balanced:_t,motion:ns,detail:Jt})}return Re}function ete(e,t,s,r,i,l){const A=$w.get(e)||{overUse:0,underUse:0,adaptationList:F4(i)},{adaptationList:u}=A;$w.set(e,A);const{OVERUSE_TIMES_THRESHOLD:p,UNDERUSE_TIMES_THRESHOLD:f}=V1,{scale:b}=r;let w,_;return typeof t=="number"&&t>0&&function(C,U,B,j){if(U>=B.length)return!1;let{threshold:{fps_down:K}}=B[U];return G("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(K=B[0].threshold.fps_down),C<K}(t,b,u,l)&&(A.overUse++,_=uf.CPU,A.overUse>p)||typeof s=="number"&&s>0&&function(C,U,B){if(U>=B.length)return!1;const{threshold:{bwe_down:j}}=B[U];return C<j}(s,b,u)&&(A.overUse++,_=uf.BANDWIDTH,A.overUse>p)?(A.overUse=0,A.underUse=0,w=P4(r,u,l,Bf.DOWN),[w,_]):(typeof t=="number"&&t>0&&typeof s=="number"&&s>0&&function(C,U,B,j){if(U===0)return;let{threshold:{fps_up:K}}=B[U];return G("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(K=B[1].threshold.fps_up),C>K}(t,b,u,l)&&function(C,U,B){if(U===0)return;const{threshold:{bwe_up:j}}=B[U];return C>j}(s,b,u)&&(A.underUse++,A.underUse>f&&(A.overUse=0,A.underUse=0,w=P4(r,u,l,Bf.UP),w.scale===0&&(_=uf.NONE))),[w,_])}function M4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function YN(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?M4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):M4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function V4(e){var t;return!!G("ENABLE_AG_ADAPTATION")&&!!(e instanceof _w||nt(t=e._hints).call(t,rr.CUSTOM_TRACK))&&(!!G("FORCE_SUPPORT_AG_ADAPTATION")||!!(TL(14,0,!1)&&RL(17,4,!0)||NL(14)&&w1(17,4,!0)))}const Zw=new Map;function Q4(e,t,s,r,i,l){if(Lf(e,s),i(t),r!=="balanced"&&r!=="maintain-framerate"&&r!=="maintain-resolution")return;let A=-1;U4(e,t);const u=window.setInterval(()=>{const f=Zw.get(e);if(!G("ENABLE_AG_ADAPTATION")||!f)return Lf(e,s),void i(t);const b=l();if(b.sendPackets>0&&b.OutgoingAvailableBandwidth>0){if(A===-1)return void(A=Date.now());if(Date.now()-A<1e3)return;const w=b.sendFrameRate,_=b.OutgoingAvailableBandwidth,[C,U]=ete(e,w,_,f.adaptationConfig,t,r);U&&(s.qualityLimitationReason=U),C&&f.adaptationConfig.scale!==C.scale&&(N.debug("[".concat(e,"] applyAdaptation: ").concat(s.qualityLimitationReason,`
           sendFps `).concat(w,", bwe ").concat(_,", switch from ").concat(f.adaptationConfig.scale," to ").concat(C.scale," ")),f.adaptationConfig=YN(YN({},f.adaptationConfig),C),i(C))}},G("CHECK_LOCAL_STATS_INTERVAL")),p=YN({},t);Zw.set(e,{timer:u,adaptationConfig:p,originConfig:t,adaptationFunc:i}),N.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}function Lf(e,t){const s=Zw.get(e);if(s){const{timer:r}=s;window.clearTimeout(r),Zw.delete(e)}t.qualityLimitationReason=uf.NONE,U4(e)}function tte(e,t){var s;let r;switch(t){case at.LocalAudioTrack:r=cr.Audio;break;case at.LocalVideoTrack:r=nt(s=e._hints).call(s,rr.SCREEN_TRACK)?cr.Screen:cr.High;break;case at.LocalVideoLowTrack:r=cr.Low}return r}function XN(e){const t=Ls();if(e.some(s=>s._bypassWebAudio))throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function JN(e,t){XN(e);const s=new Tn;return e.forEach(r=>s.addAudioTrack(r)),s}const ste=!Ls().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Sd();function $0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return s={spec:t,store:e},Pl("DataChannelConnection").create(s);var s;return ste?function(i){return Pl("PlanBConnection").create(i)}({spec:t,store:e}):new Qo(t,e)}function $N(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function ZN(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(tp(e.turnServer.servers))return!1;if(G("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Hs;function H4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Fl(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?H4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):H4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let Qo=(Hs=class Up extends Pw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return nt(s=Object.keys(cp)).call(s,t)}))]}constructor(t,s){super(t,s),P(this,"id",ar(5,"connection-")),P(this,"store",void 0),P(this,"peerConnection",void 0),P(this,"forceTurn",!1),P(this,"remoteSDP",void 0),P(this,"initialOffer",void 0),P(this,"transportEventReceiver",void 0),P(this,"statsFilter",void 0),P(this,"extension",{useXR:G("USE_XR")}),P(this,"localCapabilities",void 0),P(this,"remoteCodecs",void 0),P(this,"localCandidateCount",0),P(this,"allCandidatesReceived",!1),P(this,"isPreallocation",!1),P(this,"isPreRender",!1),P(this,"preMediaMap",new Map),P(this,"dataStreamChannelMap",new Map),P(this,"establishPromise",void 0),P(this,"recoveredDataChannelIds",[]),P(this,"currentDataChannelId",1),P(this,"supportAV1RtpSpec",!1),P(this,"mutex",void 0),P(this,"qualityLimitationReason",uf.NONE),P(this,"isFirstConnected",!1),this.store=s,this.forceTurn=ZN(t),this.mutex=new $n("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Up.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Aw(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Tr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,s){if(this.remoteCodecs=s,!this.remoteSDP)return void N.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(t,s,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else N.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Od(s.sdp),i=await LN({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=z0(i),this.initialOffer=s,G("ENABLE_SVC")&&this.store.codec=="av1"){const A=await d4();var t;A&&(this.supportAV1RtpSpec=!0,(t=i.send)===null||t===void 0||t.videoExtensions.push(A))}let l;return s.sdp&&Gw(s.sdp)&&(l=Rr(i),s4(l)),Fl(Fl({},r),{},{rtpCapabilities:l||i,offerSDP:s.sdp})}catch(s){throw new Me(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&Gw(this.initialOffer.sdp)&&r4(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new L4(Fl(Fl({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&U0(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),r=jN(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),U0(this.store))if(t.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const A=G("PRE_SUB_NUM"),{mids:u,preSSRCs:p}=this.remoteSDP.preloadRemoteMedia(A);await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(p)),this.presetMedia(u,p)}else{const{preSSRCs:A=[]}=t,u=A.map(f=>f.ssrcMsg[0].ssrcId);if(A.length===0)return;const{mids:p}=this.remoteSDP.batchSend(A.map(f=>Object.assign({},f)));await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(p,u)}}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}presetMedia(t,s){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&r===l.mid&&l.receiver.track){const A=l.receiver.track;let u;A.kind==="video"&&G("ENABLE_PRE_RENDER")&&(u=new ww({trackId:"track-".concat(A.kind,"-unknown-").concat(this.store.clientId,"_").concat(ar(5,""))},!0),u.updateVideoTrack(A),u.onFirstVideoFrameRender=()=>{var p;const f=this.preMediaMap.get(s[i]);f&&(f.firstVideoRender=Date.now()),(p=this.onFirstVideoRender)===null||p===void 0||p.call(this,s[i])},u.onVideoBufferReady=()=>{var p;(p=this.onFirstVideoBufferReady)===null||p===void 0||p.call(this,s[i])},u.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(s[i],{mid:r,track:A,player:u,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:r}=t;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const A=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||A}const{preSSRCs:i=[]}=t,l=i.map(A=>A.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const A=[],u=[];if(Array.from(this.preMediaMap.entries()).every(p=>{let[f,{mid:b,player:w,track:_}]=p;return A.push(b),u.push(f),this.preMediaMap.delete(f),w&&w.destroy(),!0}),A.length>0&&(this.remoteSDP.stopSending(A),await Ga(this.peerConnection,this.remoteSDP,this.extension),N.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),kt.reportApiInvoke(this.store.sessionId,{name:kr.PRELOAD_MEDIA_FAILED,options:[i,u],tag:br.TRACER}).onSuccess()),i.length>0){const{mids:p}=this.remoteSDP.batchSend(i.map(f=>Object.assign({},f)));await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(p,l)}}s?(await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):N.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(t,s,r){var i=this;return Na(function*(){const l=yield vs(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const A=[],u=G0();t.forEach(j=>{const K=i.peerConnection.addTransceiver(j._mediaStreamTrack,Fl({direction:"sendonly"},j.trackMediaType==="video"&&i.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));A.push(K),j._updateRtpTransceiver(K)}),Tr()&&G("SIMULCAST")===!0&&(yield vs(i.applySimulcastForFirefox(A,t)));const p=yield vs(i.peerConnection.createOffer()),f=i.remoteSDP.predictReceivingMids(t.length),b=i.mungSendOfferSDP(p.sdp,t,f),w=ha(b),_=f.map(j=>{const K=w.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return ON(K,G("USE_PUB_RTX"))});let C;try{C=yield _}catch(j){C=[],i.remoteSDP.receive(t,s,r,C);const K=i.remoteSDP.toString();throw yield vs(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield vs(i.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield vs(i.stopSending(f,!0)),j}i.remoteSDP.receive(t,s,r,C);const U=i.remoteSDP.toString(),B=i.logSDPExchange(b,"offer","local","send");return yield vs(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield vs(i.applySimulcastEncodings(A,t)),yield vs(i.applySendEncodings(A,t)),B==null||B(U),yield vs(i.peerConnection.setRemoteDescription({type:"answer",sdp:U})),A.map((j,K)=>{const q=f[K];return{localSSRC:_[K],id:q,transceiver:j}})}catch(A){throw A instanceof Me?A:new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(A.toString()))}finally{l()}})()}async createDataChannels(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")N.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}s.forEach(l=>{l._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A),N.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else N.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof Me?r:new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const s=this.dataStreamChannelMap.get(t);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(t)}catch(s){throw s instanceof Me?s:new Me(W.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(t,s){const r=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(p=>{var f;Lf(this.id+p.mid,this),p.direction="inactive",(f=p.stop)===null||f===void 0||f.call(p)});const l=await this.peerConnection.createOffer(),A=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();A==null||A(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:A}=this.remoteSDP.send(t,s,r,i);A&&(await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const u=this.peerConnection.getTransceivers().find(p=>p.mid===l);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:l,transceiver:u}}catch(l){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(i=>{const l=this.peerConnection.getTransceivers().find(A=>A.mid===i);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:i,transceiver:l}})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(A=>{let[u,{mid:p,player:f}]=A;if(p===l)return this.preMediaMap.delete(u),f&&f.destroy(),!0})}),this.remoteSDP.stopSending(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(A=>{A.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(A,u)=>{A.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return Na(function*(){const r=yield vs(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ls().supportPCSetConfiguration,l=G("FORCE_TURN_TCP")||s.forceTurn;if(t===Zn.RELAY&&!i)return;if(i&&!l){const w=t===Zn.RELAY?"relay":"all",_=s.peerConnection.getConfiguration();_.iceTransportPolicy!==w&&(N.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(w,"]")),_.iceTransportPolicy=w,s.peerConnection.setConfiguration(_))}s.remoteSDP.updateCandidates(t);const A=yield vs(s.peerConnection.createOffer({iceRestart:!0}));if(!A.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=Od(A.sdp),{remoteIceParameters:p}=yield u.iceParameters;s.remoteSDP.restartICE(p);const f=s.remoteSDP.toString(),b=s.logSDPExchange(A.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield vs(s.peerConnection.setLocalDescription(A)),b==null||b(f),yield vs(s.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(i){N.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Zn.TCP_RELAY),await Ga(this.peerConnection,this.remoteSDP,this.extension)}catch(s){N.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(s=>{Lf(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:r}=s;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Fl(Fl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);const l=this.remoteSDP.toString(),A=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),A==null||A(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Me(W.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,s){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(s)?Tr()||await this.applySimulcastEncodings(r,[s]):await this.applySendEncodings(r,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){const r=this.peerConnection.getTransceivers().find(i=>i.mid===s);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const s=t[0].transport.iceTransport,{local:r,remote:i}=s.getSelectedCandidatePair();return{local:Fl(Fl({},Hc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Fl(Fl({},Hc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var s;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",l=Id(t.url||"");N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(l||"",", host_candidate:").concat(i)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const s={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&(tp(t.turnServer.servers)?s.iceServers=t.turnServer.servers:G("NEW_TURN_MODE")&&s.iceServers&&r==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&s.iceServers.push(...Up.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):s.iceServers.push(...Up.newTurnServerConfigToIceServers(t.turnServer.servers)),G("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Up.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Up.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(s.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&Ls().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{r.security?r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(qc(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{const i=G("NEW_TURN_MODE");i===1?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(qc(r.turnServerURL),":443?transport=tcp")}):i===4&&(s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(qc(r.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(t){const s=t.transport;if(s){this.transportEventReceiver=t,s.onstatechange=()=>{var i;s!=null&&s.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,s.state))},s.onerror=i=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in i?i.error:i)};const r=s.iceTransport;r&&(r.onstatechange=()=>{const i=s==null?void 0:s.iceTransport.state;var l;i&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:l}=r.getSelectedCandidatePair()||{};if(i&&l){const A=i.address+":"+i.port,u=l.address+":"+l.port;N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Id(A)),", remote ").concat(JSON.stringify(Id(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var r,i;if(s||(s=this.peerConnection.getSenders().find(j=>j.track===t._mediaStreamTrack)),!s)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ls().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},A={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const u=e4(this.peerConnection,t._mediaStreamTrack),p=Hj(t);if(V4(t)&&u&&s&&p&&this.getLocalVideoStats&&nt(r=["vp8","vp9"]).call(r,this.store.codec)){var f;const B=l.degradationPreference||(nt(f=t._hints).call(f,rr.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");Q4(this.id+u.mid,p,this,B,j=>{s&&this.updateAdaptation(s,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var b;const{bitrateMax:B,frameRate:j,scaleResolutionDownBy:K}=t._encoderConfig;B&&(A.maxBitrate=1e3*B),(nt(b=t._hints).call(b,rr.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(A.maxFramerate=ka(j)),K&&K>=1&&(A.scaleResolutionDownBy=K))}const{maxFramerate:w}=G("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(A.maxFramerate=A.maxFramerate?Math.min(A.maxFramerate,w):w),G("DSCP_TYPE")&&Sd()){var _;const B=G("DSCP_TYPE");nt(_=["very-low","low","medium","high"]).call(_,B)&&(A.networkPriority=B)}const C=s.getParameters(),U=(i=C.encodings)===null||i===void 0?void 0:i[0];Tr()&&!U&&(l.encodings=[A]),U&&Object.assign(U,A),Object.assign(C,l),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await s.setParameters(C),await h4(this.store.codec,s,G("SVC_MODE"))}async updateAdaptation(t,s){var r,i;if(!t)return N.debug("[updateAdaptation] no rtpSender found");if(!Ls().supportSetRtpSenderParameters)return N.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:A,frameRate:u,scaleResolutionDownBy:p}=s;A&&(l.maxBitrate=1e3*A),u&&(l.maxFramerate=ka(u)),p&&p>=1&&nt(r=["vp8","vp9"]).call(r,this.store.codec)&&(l.scaleResolutionDownBy=p);const f=t.getParameters(),b=(i=f.encodings)===null||i===void 0?void 0:i[0];b&&Object.assign(b,l),Object.assign(f,{});try{await t.setParameters(f),N.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(w){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?N.debug("[updateAdaptation] peerConnection not connected}"):N.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):N.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,s){try{if(!Ls().supportSetRtpSenderParameters||t.length!==s.length)return;for(let r=0;r<t.length;r++){const i=t[r],l=s[r];l instanceof xr&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,i.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,r){if(G("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const i=ha(t);return s.forEach((l,A)=>{const u=r[A],p=i.mediaDescriptions.find(f=>f.attributes.mid===u);p&&(xp(p,l),BN(p,l,this.store.codec))}),CA(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,s,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let p=0;p<t.length;p++){var r,i,l,A,u;const f=t[p],b=s[p];if(b instanceof xr&&!nt(r=b._hints).call(r,rr.LOW_STREAM)&&(i=b._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((l=b._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(A=b._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((u=b._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},_={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const C=f.sender.getParameters();await f.sender.setParameters(Object.assign(C,w))}}}async applySimulcastEncodings(t,s){if(!Tr()&&t.length===s.length)for(let r=0;r<t.length;r++){const i=s[r];if(i instanceof xr&&this.isVP8Simulcast(i)){const l=t[r],A={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,A))}}}isVP8Simulcast(t){var s,r,i,l,A;return!!(t instanceof xr&&G("SIMULCAST")&&this.store.codec==="vp8"&&!nt(s=t._hints).call(s,rr.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((A=t._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(t,s,r,i){if(G("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(s," SDP during P2PConnection.").concat(i,`
`),t),s==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(t);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(t){if(Ls().supportPCSetConfiguration){const s=Up.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}t.isPreallocation&&(this.isPreallocation=!0)}},ft(Hs.prototype,"updateRemoteRTPCapabilities",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"updateRemoteRTPCapabilities"),Hs.prototype),ft(Hs.prototype,"connect",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"connect"),Hs.prototype),ft(Hs.prototype,"updateRemoteConnect",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"updateRemoteConnect"),Hs.prototype),ft(Hs.prototype,"createDataChannels",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"createDataChannels"),Hs.prototype),ft(Hs.prototype,"receive",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"receive"),Hs.prototype),ft(Hs.prototype,"batchReceive",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"batchReceive"),Hs.prototype),ft(Hs.prototype,"stopReceiving",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"stopReceiving"),Hs.prototype),ft(Hs.prototype,"muteRemote",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"muteRemote"),Hs.prototype),ft(Hs.prototype,"unmuteRemote",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"unmuteRemote"),Hs.prototype),ft(Hs.prototype,"muteLocal",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"muteLocal"),Hs.prototype),ft(Hs.prototype,"unmuteLocal",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"unmuteLocal"),Hs.prototype),ft(Hs.prototype,"close",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"close"),Hs.prototype),ft(Hs.prototype,"updateEncoderConfig",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"updateEncoderConfig"),Hs.prototype),ft(Hs.prototype,"updateSendParameters",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"updateSendParameters"),Hs.prototype),ft(Hs.prototype,"replaceTrack",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"replaceTrack"),Hs.prototype),ft(Hs.prototype,"updateAdaptation",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"updateAdaptation"),Hs.prototype),ft(Hs.prototype,"getRemoteSSRC",[Da],Object.getOwnPropertyDescriptor(Hs.prototype,"getRemoteSSRC"),Hs.prototype),Hs);function Da(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From P2PConnection.".concat(t));try{for(var A=arguments.length,u=new Array(A),p=0;p<A;p++)u[p]=arguments[p];return await r.apply(this,u)}finally{l()}},s}function e2(e,t){let s=document.createElement("video"),r=document.createElement("canvas");s.setAttribute("style","display:none"),r.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),r.width=ka(t.width),r.height=ka(t.height);const i=ka(t.framerate||15);document.body.append(s),document.body.append(r);let l=e._mediaStreamTrack;s.srcObject=new MediaStream([l]),s.play().catch(B0);const A=r.getContext("2d");if(!A)throw new Le(W.UNEXPECTED_ERROR,"can not get canvas context");const u=Ls(),p=r.captureStream(u.supportRequestFrame?0:i).getVideoTracks()[0];p.canvas||(p.canvas=r),r.startCapture=()=>{if(!s)return r.stopCapture&&r.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const b=s.videoWidth,w=s.videoHeight/b,_=r.width*w;Math.abs(_-r.height)>=2&&(N.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(_)),r.height=_)}A.drawImage(s,0,0,r.width,r.height),p.requestFrame&&p.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,s.srcObject=new MediaStream([l]))},r.stopCapture=eN(()=>r.startCapture&&r.startCapture(),i);const f=p.stop;return p.stop=()=>{f.call(p),s&&(s.remove(),s.srcObject=null,s=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),N.debug("clean low stream renderer")},p}var G4=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(G4||{}),Ml=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Ml||{}),ds=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(ds||{}),Kn=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e}(Kn||{}),ui=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ui||{}),jf=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e}(jf||{}),t2=function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e}(t2||{});const wp=1e3,e_=6,Z0=3,rte=Math.max(e_,Z0,60);function Xt(e,t,s){s!=null&&Number.isFinite(s)&&(e[t]=Math.round(Math.max(0,s)))}function K4(e){const t={[ui.CONN_TYPE]:0,[ui.RTT]:e.rtt,[ui.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=e.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(t[ui.CONN_TYPE]=1),s==="tcp"&&(t[ui.CONN_TYPE]=3),s==="tls"&&(t[ui.CONN_TYPE]=4);break}case"srflx":t[ui.CONN_TYPE]=2;break;case"unknown":t[ui.CONN_TYPE]=5;break;default:t[ui.CONN_TYPE]=0}return t}function W4(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class z4 extends jr{constructor(t){super(),P(this,"store",void 0),P(this,"uploadWRTCStatsTimer",void 0),P(this,"uploadOutboundDenoiserStatsTimer",void 0),P(this,"uploadExtStatsTimer",void 0),P(this,"uploadExtUsageStatsTimer",void 0),P(this,"uploadInboundExtStatsTimer",void 0),P(this,"requestStats",void 0),P(this,"requestTransportStats",void 0),P(this,"requestLocalMedia",void 0),P(this,"requestRemoteMedia",void 0),P(this,"requestAllTracks",void 0),P(this,"requestVideoIsReady",void 0),P(this,"requestUploadStats",void 0),P(this,"requestUpload",void 0),P(this,"uploadOutboundStarted",!1),P(this,"uploadInboundStarted",!1),P(this,"uploadTransportStarted",!1),P(this,"uploadBaseStatsStarted",!1),P(this,"uploadExtensionUsageStarted",!1),P(this,"lastRecvStats",void 0),P(this,"lastSendStats",void 0),P(this,"lastRefRecvStats",void 0),P(this,"lastRefSendStats",void 0),P(this,"lastNormalRecvStats",void 0),P(this,"lastNormalSendStats",void 0),P(this,"lastExtendStats",{}),P(this,"needUploadStats",{}),P(this,"needUploadRenderFreezeTime",!0),P(this,"lastUploadCompensateTime",-1),P(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const s=t%Z0==0,r=t%e_==0,i=t%60==0;let l,A;if(this.uploadTransportStarted&&(l=this.requestStats(),this.store.useP2P&&(A=this.requestStats(!0))),!l&&this.uploadOutboundStarted&&(l=this.requestStats()),!A&&this.uploadInboundStarted&&(A=this.requestStats(!0)),l||A){var u;const p={};if(this.uploadTransportStarted&&l){const b=this.getTransportStats(l,s?this.lastRefSendStats:void 0,A,s);b&&(p.misc=[b])}if(this.uploadOutboundStarted&&l){const b=this.getOutboundStats(l,r?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,i);b&&(p.outbound=[b])}if(this.uploadInboundStarted&&A){this.uploadCompensateStats(t);const b=this.getInboundStats(A,r?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);b&&(p.inbound=b)}const f=(u=this.requestTransportStats)===null||u===void 0?void 0:u.call(this).connectState;if(f&&(Array.isArray(p.misc)?p.misc[0]&&p.misc[0].addition&&(p.misc[0].addition[jf.RTC_PEER_CONNECTION_STATE]=U1[f]):p.misc=[{addition:{[jf.RTC_PEER_CONNECTION_STATE]:U1[f]}}]),go.needUploadStats.length>0||r){const b=go.needUploadStats.shift()||(go.visibility==="visible"?1:0);Array.isArray(p.misc)?p.misc[0]&&p.misc[0].addition&&(p.misc[0].addition[jf.PAGE_VISIBILITY]=b):p.misc=[{addition:{[jf.PAGE_VISIBILITY]:b}}]}this.needUploadStats.sendType&&(Array.isArray(p.outbound)&&p.outbound[0]&&p.outbound[0].high&&(p.outbound[0].high[G4.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(p)}this.lastRecvStats=A,this.lastSendStats=l,r&&(this.lastNormalRecvStats=A,this.lastNormalSendStats=l),s&&(this.lastRefRecvStats=A,this.lastRefSendStats=l)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,go.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,r;const i=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[jf.RTC_PEER_CONNECTION_STATE]:U1[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===rte+1&&(t=1)},wp)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s=t%Z0==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const l=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const A={};if(this.uploadInboundStarted&&l){const u=this.requestRemoteMedia()||[],p=[];u.forEach(f=>{let[b,w]=f;const _={peer:b.uid};if(b._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(b._videoSSRC)&&w.has(Tt.VIDEO)&&b.videoTrack){const C=function(U,B,j){if(!B.videoRecv.find(q=>q.ssrc===U))return;const K={};if(j&&j._player){const q=j._player,{renderFreezeAccTime2:ie,videoElementStatus:xe}=q;if(go.visibility==="visible"&&xe===Di.PLAYING&&Ls().supportRequestVideoFrameCallback){const ye=Math.min(6e3,ie);q.renderFreezeAccTime2=Math.max(0,ie-ye),Xt(K,Ml.Video_Render_Freeze_Time_Render2,ye),G("USE_NEW_RENDER_FREEZE_TIME")&&Xt(K,Ml.Video_Render_Freeze_Time_Render,ye)}}return K}(b._videoSSRC,l,b.videoTrack);C&&(_.video=C)}_.video&&p.push(_)}),p.length>0&&(A.inbound=p,this.requestUploadStats(A))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,s,r,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[ui.RTT]:t.rtt,[ui.CONN_TYPE]:void 0,[ui.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const l=K4(t);if(this.store.useP2P){if(r){const A=K4(r);l[ui.CONN_TYPE]&&A[ui.CONN_TYPE]&&(l[ui.CONN_TYPE]+=A[ui.CONN_TYPE]<<3)}l[ui.CONN_TYPE]?l[ui.CONN_TYPE]+=110:l[ui.CONN_TYPE]=110}else{l[ui.CONN_TYPE]?l[ui.CONN_TYPE]+=100:l[ui.CONN_TYPE]=100;const A=function(u,p){return p?[Math.ceil(8*(u.transport.bytesSent-p.transport.bytesSent)/(u.timestamp-p.timestamp)),Math.ceil(8*(u.transport.bytesReceived-p.transport.bytesReceived)/(u.timestamp-p.timestamp))]:[0,0]}(t,s);l[t2.Transport_Send_Bitrate]=A[0],l[t2.Transport_Recv_Bitrate]=A[1]}return{addition:l}}getOutboundStats(t,s,r,i,l){if(!this.requestUploadStats||!this.requestLocalMedia)return;const A=this.requestLocalMedia();if(!A||A.length===0)return;let u,p,f;return A.forEach(b=>{let[w,{track:_,ssrcs:C}]=b;switch(w){case at.LocalVideoLowTrack:case at.LocalVideoTrack:if(w===at.LocalVideoTrack){var U;const B=function(ie,xe,ye,ue,Re,Ge){const Ze=xe.videoSend.find(bs=>bs.ssrc===ie);if(!Ze)return;const _t={},{sentFrame:ns,inputFrame:Jt}=Ze;if(ue&&(Xt(_t,Ml.Video_Send_Qp_Sum,Ze.qpSumPerFrame),Jt&&ns)){const bs=Jt.frameRate,As=ns.frameRate;_t[Ml.Video_Send_Freeze]=function(Xs,Br){let qe=!0;return qe=!(Xs<=5)&&(Xs<=10?Br<3:Xs<=20?Br<4:Br<5),qe}(bs,As)?1:0}if(Re){switch(ns&&(Xt(_t,ds.Video_Send_Height,ns.height),Xt(_t,ds.Video_Send_Width,ns.width),Xt(_t,ds.Video_Send_Frame_Rate,ns.frameRate)),_t[ds.Video_Send_Disabled]=ye._originMediaStreamTrack&&!ye._originMediaStreamTrack.enabled||ye._mediaStreamTrack&&!ye._mediaStreamTrack.enabled?1:0,Ze.adaptionChangeReason){case"none":_t[ds.Video_Send_Adaptation]=0;break;case"cpu":_t[ds.Video_Send_Adaptation]=1;break;case"bandwidth":_t[ds.Video_Send_Adaptation]=2;break;case"other":_t[ds.Video_Send_Adaptation]=3}let bs=0;Ze.adaptionChangeReason&&(bs+=W4(Ze.adaptionChangeReason)),xe.qualityLimitationReason&&(bs+=W4(xe.qualityLimitationReason)<<3),_t[ds.Video_Send_Adaptation]=bs,_t[ds.Video_Send_Player_Status]=J1[ye._player?ye._player.videoElementStatus:"uninit"],Xt(_t,ds.Video_Send_Nacks,Ze.nacksCount),Xt(_t,ds.Video_Send_Plis,Ze.plisCount),Xt(_t,ds.Video_Send_Firs,Ze.firsCount),Xt(_t,ds.Video_Send_Avg_Encode,Ze.avgEncodeMs),Xt(_t,ds.Video_Send_Huge_Frame_Sent,Ze.hugeFramesSent),Xt(_t,ds.Video_Send_Bytes_Retransmit,Ze.retransmittedBytesSent),Xt(_t,ds.Video_Send_Packages_Retransmit,Ze.retransmittedPacketsSent),Xt(_t,ds.Video_Send_Key_Frames_Encoded,Ze.keyFramesEncoded);const As=Re.videoSend.find(Xs=>Xs.ssrc===ie);if(As){let Xs=wp*Z0;As.timestamp&&Ze.timestamp&&(Xs=Ze.timestamp-As.timestamp),As.packets!=null&&Ze.packets!=null&&Xt(_t,ds.Video_Send_Package_Rate,1e3*(Ze.packets-As.packets)/Xs),Ze.packetsLost!=null&&As.packetsLost!=null&&Xt(_t,ds.Video_Send_Package_Lost,Ze.packetsLost-As.packetsLost),As.bytes!=null&&Ze.bytes!=null&&Xt(_t,ds.Video_Send_Bitrate,8*(Ze.bytes-As.bytes)/Xs)}}return _t}(C[0].ssrcId,t,_,s,r),j=_.__className__==="CameraVideoTrack"?3:nt(U=_._hints).call(U,rr.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==j||l)&&(this.needUploadStats={sendType:j},this.lastExtendStats.sendType=j);const K=_&&function(ie,xe,ye,ue){const Re=xe.videoSend.find(Ze=>Ze.ssrc===ie);if(!Re)return null;const Ge={};if(ue){const Ze=Re.inputFrame,_t=Ze&&Ze.height||ye.videoHeight||0,ns=Ze&&Ze.width||ye.videoWidth||0,Jt=Ze&&Ze.frameRate||0;Xt(Ge,ds.Video_Capture_Height,_t),Xt(Ge,ds.Video_Capture_Width,ns),Xt(Ge,ds.Video_Capture_Frame_Rate,Jt)}return Ge}(C[0].ssrcId,t,_,!!r),q=function(ie,xe){const ye={};return xe&&(Xt(ye,ds.Video_Send_Retransmit,ie.bitrate.retransmit),Xt(ye,ds.Video_Send_Target_Encoded,ie.bitrate.targetEncoded),Xt(ye,ds.Video_Send_Actual_Encoded,ie.bitrate.actualEncoded),Xt(ye,ds.Video_Send_Transmit,ie.bitrate.transmit),Xt(ye,ds.Video_Send_Bandwidth,ie.sendBandwidth)),ye}(t,!!r);p=Object.assign({},B,K,q)}else f=function(B,j,K,q,ie){const xe=j.videoSend.find(ue=>ue.ssrc===B);if(!xe)return;const ye={};if(q){const ue=xe.sentFrame;ue&&(Xt(ye,ds.Video_Send_Low_Height,ue.height),Xt(ye,ds.Video_Send_Low_Width,ue.width),Xt(ye,ds.Video_Send_Low_Frame_Rate,ue.frameRate));const Re=q.videoSend.find(Ge=>Ge.ssrc===B);if(Re){let Ge=wp*e_;Re.timestamp&&xe.timestamp&&(Ge=xe.timestamp-Re.timestamp),Re.packets!=null&&xe.packets!=null&&Xt(ye,ds.Video_Send_Low_Package_Rate,1e3*(xe.packets-Re.packets)/Ge),xe.packetsLost!=null&&Re.packetsLost!=null&&Xt(ye,ds.Video_Send_Low_Package_Lost,xe.packetsLost-Re.packetsLost),Re.bytes!=null&&xe.bytes!=null&&Xt(ye,ds.Video_Send_Low_Bitrate,8*(xe.bytes-Re.bytes)/Ge)}}return ye}(C[0].ssrcId,t,0,r);break;case at.LocalAudioTrack:u=_&&function(B,j,K,q,ie,xe){const ye=j.audioSend.find(Re=>Re.ssrc===B);if(!ye)return;const ue={};if(ie){ue[ds.Audio_Send_Disabled]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0;const Re=100*K._source.getAccurateVolumeLevel(),Ge=ye.inputLevel;if(Ge!=null){const _t=Math.ceil(50*Math.log10(100*Ge+1));Xt(ue,ds.Audio_Send_Level,_t)}Xt(ue,ds.Audio_Capture_PCM_Level,Re),Xt(ue,ds.Audio_Send_AEC_Return_Loss,ye.aecReturnLoss),Xt(ue,ds.Audio_Send_AEC_Return_Loss_Enhancement,ye.aecReturnLossEnhancement),Xt(ue,ds.Audio_Send_Bytes_Retransmit,ye.retransmittedBytesSent),Xt(ue,ds.Audio_Send_Packages_Retransmit,ye.retransmittedPacketsSent),ue[ds.Audio_Send_Freeze]=0;const Ze=ie.audioSend.find(_t=>_t.ssrc===B);if(Ze){let _t=wp*e_;Ze.timestamp&&ye.timestamp&&(_t=ye.timestamp-Ze.timestamp),Ze.bytes!=null&&ye.bytes!=null&&Xt(ue,ds.Audio_Send_Bitrate,8*(ye.bytes-Ze.bytes)/_t),Ze.packets!=null&&ye.packets!=null&&Xt(ue,ds.Audio_Send_Package_Rate,1e3*(ye.packets-Ze.packets)/_t)}}return ue}(C[0].ssrcId,t,_,0,r)}}),{high:p,low:f,audio:u}}getInboundStats(t,s,r,i){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],A=[];return l.forEach(u=>{let[p,f]=u;const b={peer:p.uid};let w;if(f.has(Tt.VIDEO)&&p.videoTrack){const _=p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)||!1,C=p.videoTrack?function(U,B,j,K,q,ie,xe,ye){const ue=B.videoRecv.find(As=>As.ssrc===U);if(!ue)return;const Re={},{receivedFrame:Ge,outputFrame:Ze,decodeFrameRate:_t}=ue;Xt(Re,Kn.Video_Render_Frame_Rate_Decode,_t),ue.framesRateFirefox&&Xt(Re,Kn.Video_Recv_Frame_Rate,ue.framesRateFirefox),Ge&&Xt(Re,Kn.Video_Recv_Frame_Rate,Ge.frameRate),Xt(Re,Kn.Video_Recv_Frame_Dropped,ue.framesDroppedCount),Xt(Re,Kn.Video_Recv_Bytes_Retransmit,ue.retransmittedBytesReceived),Xt(Re,Kn.Video_Recv_Packages_Retransmit,ue.retransmittedPacketsReceived),Xt(Re,Kn.Video_Recv_Packages_Discarded,ue.packetsDiscarded),Xt(Re,Kn.Video_Recv_Avg_Decode,ue.avgDecodeMs),Xt(Re,Kn.Video_Recv_Avg_Processing_Delay,ue.avgProcessingDelayMs),Xt(Re,Kn.Video_Recv_Avg_Assembly_Time,ue.avgFramesAssembledFromMultiplePacketsMs),Xt(Re,Kn.Video_Recv_Avg_Inter_Frame_Delay,ue.avgInterFrameDelayMs),Xt(Re,Kn.Video_Recv_Key_Frames_Decoded,ue.keyFramesDecoded);const ns=ye&&ye.videoRecv.find(As=>As.ssrc===U);if(ns){const As=B.timestamp-ye.timestamp||wp;ue.packetsLost!=null&&ns.packetsLost!=null&&Xt(Re,Kn.Video_Recv_Package_Lost,ue.packetsLost-ns.packetsLost),ns.bytes!=null&&ue.bytes!=null&&Xt(Re,Kn.Video_Recv_Bitrate,8*(ue.bytes-ns.bytes)/As),ns.packets!=null&&ue.packets!=null&&Xt(Re,Kn.Video_Recv_Package_Rate,1e3*(ue.packets-ns.packets)/As)}const Jt=ie&&ie.videoRecv.find(As=>As.ssrc===U);if(Jt&&(Xt(Re,Ml.Video_Recv_Qp_Sum,ue.qpSumPerFrame),Re[Ml.Video_Recv_Freeze]=K&&J0.isRemoteVideoFreeze(j,ue,Jt)?1:0),xe){var bs;const As=xe.videoRecv.find(Br=>Br.ssrc===U);Ge?(Xt(Re,ds.Video_Recv_Height,Ge.height),Xt(Re,ds.Video_Recv_Width,Ge.width)):j&&(Xt(Re,ds.Video_Recv_Height,j._videoHeight||0),Xt(Re,ds.Video_Recv_Width,j._videoWidth||0)),Ze&&Xt(Re,ds.Video_Recv_Frame_Rate_Output,Ze.frameRate);const Xs=(bs=j._player)===null||bs===void 0?void 0:bs.rendFrameRate.toFixed(0);if(Xs&&Xt(Re,ds.Video_Render_Frame_Rate_Render,+Xs),Xt(Re,ds.Video_Recv_Jitter_Buffer,ue.jitterBufferMs),Xt(Re,ds.Video_Recv_Current_Delay,ue.currentDelayMs),Xt(Re,ds.Video_Recv_Firs,ue.firsCount),Xt(Re,ds.Video_Recv_Nacks,ue.nacksCount),Xt(Re,ds.Video_Recv_Plis,ue.plisCount),j){Re[ds.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const Br=j._player;if(Br){const{freezeTimeCounterList:qe,renderFreezeAccTime:lt,renderFreezeAccTime2:It,videoElementStatus:Je}=Br;if(qe&&qe.length>0&&Xt(Re,Ml.Video_Render_Freeze_Time,qe.splice(0,1)[0]),q&&go.visibility==="visible"&&Je===Di.PLAYING&&Ls().supportRequestVideoFrameCallback){const D=Math.min(6e3,It);Br.renderFreezeAccTime2=Math.max(0,It-D),Xt(Re,Ml.Video_Render_Freeze_Time_Render2,D);const ne=Math.min(6e3,lt);Br.renderFreezeAccTime=Math.max(0,lt-ne),Xt(Re,Ml.Video_Render_Freeze_Time_Render,G("USE_NEW_RENDER_FREEZE_TIME")?D:ne)}if(typeof ue.totalFreezesDuration=="number"){const D=As&&As.totalFreezesDuration?ue.totalFreezesDuration-As.totalFreezesDuration:ue.totalFreezesDuration;Xt(Re,ds.Video_Render_Freeze_Duration,1e3*D)}}}if(Re[ds.Video_Recv_Player_Status]=J1[j._player?j._player.videoElementStatus:"uninit"],As&&ue.totalInterFrameDelay!==void 0&&ue.totalSquaredInterFrameDelay!==void 0&&As.totalInterFrameDelay!==void 0&&As.totalSquaredInterFrameDelay!==void 0){const Br=ue.totalInterFrameDelay-As.totalInterFrameDelay,qe=ue.totalSquaredInterFrameDelay-As.totalSquaredInterFrameDelay,lt=ue.framesDecodeCount-As.framesDecodeCount,It=Br/lt*1e3,Je=Math.round(1e3*Math.sqrt((qe-Math.pow(Br,2)/lt)/lt));!isNaN(Je)&&It+Je>Math.max(3*It,It+150)&&(Re[ds.Video_Recv_I_Frame_Delay]=Je)}}return Re}(p._videoSSRC,t,p.videoTrack,_===!0,this.needUploadRenderFreezeTime,s,r,i):void 0;if(C&&(b.video=C),p.videoTrack){const U=t.videoRecv.find(B=>B.ssrc===p._videoSSRC);U&&U.estimatedPlayoutTimestamp&&(w=U.estimatedPlayoutTimestamp)}}if(f.has(Tt.AUDIO)&&p.audioTrack){const _=p.audioTrack?function(C,U,B,j,K,q){const ie=U.audioRecv.find(Re=>Re.ssrc===C);if(!ie)return;const xe={};Xt(xe,Kn.Audio_Recv_Jitter,ie.jitterMs),Xt(xe,Kn.Audio_Recv_Bytes_Retransmit,ie.retransmittedBytesReceived),Xt(xe,Kn.Audio_Recv_Packages_Retransmit,ie.retransmittedPacketsReceived),Xt(xe,Kn.Audio_Recv_Packages_Discarded,ie.packetsDiscarded),Xt(xe,Kn.Audio_Recv_Avg_Processing_Delay,ie.avgProcessingDelayMs);const ye=q&&q.audioRecv.find(Re=>Re.ssrc===C);if(ye){const Re=wp;ie.packets!=null&&ye.packets!=null&&Xt(xe,Kn.Audio_Recv_Package_Rate,1e3*(ie.packets-ye.packets)/Re),ie.packetsLost!=null&&ye.packetsLost!=null&&Xt(xe,Kn.Audio_Recv_Package_Lost,ie.packetsLost-ye.packetsLost)}if(j){const{receivedFrames:Re,droppedFrames:Ge}=ie;Re!=null&&Ge!=null&&(xe[Ml.Audio_Recv_Freeze]=(ue=Re)===0||100*Ge/ue>20?1:0)}var ue;if(K){const Re=100*B._source.getAccurateVolumeLevel(),Ge=ie.outputLevel;if(Ge!=null){const _t=Math.ceil(50*Math.log10(100*Ge+1));Xt(xe,ds.Audio_Render_Level,_t)}Xt(xe,ds.Audio_Recv_PCM_Level,Re),B&&(xe[ds.Audio_Recv_Disabled]=B._originMediaStreamTrack.enabled&&B._mediaStreamTrack.enabled?0:1),Xt(xe,ds.Audio_Recv_Jitter_Buffer,ie.jitterBufferMs),Xt(xe,ds.Audio_Recv_Current_Delay,ie.jitterBufferMs),xe[ds.Audio_Recv_Player_Status]=J1[ea.getPlayerState(B.getTrackId())];const Ze=K.audioRecv.find(_t=>_t.ssrc===C);if(Ze){Ze.bytes!=null&&ie.bytes!=null&&Xt(xe,ds.Audio_Recv_Bitrate,8*(ie.bytes-Ze.bytes)/(wp*Z0));const _t=ie.concealedSamples-Ze.concealedSamples;_t>0&&Xt(xe,ds.Audio_Recv_Concealed_Samples,_t);const ns=ie.totalSamplesReceived-Ze.totalSamplesReceived;ns>0&&Xt(xe,ds.Audio_Recv_Total_Samples_Received,ns);const Jt=ie.freezeSamples80-Ze.freezeSamples80;Jt>0&&Xt(xe,ds.Audio_Render_Freeze_Samples_80ms,Jt);const bs=ie.freezeSamples200-Ze.freezeSamples200;bs>0&&Xt(xe,ds.Audio_Render_Freeze_Samples_200ms,bs);const As=ie.freezeMs80-Ze.freezeMs80;Xt(xe,ds.Audio_Render_Freeze_Time_80ms,As<0?0:As);const Xs=ie.freezeMs200-Ze.freezeMs200;Xt(xe,ds.Audio_Render_Freeze_Time_200ms,Xs<0?0:Xs)}}return xe}(p._audioSSRC,t,p.audioTrack,s,r,i):void 0;if(_&&(b.audio=_),p.audioTrack&&w){const C=t.audioRecv.find(U=>U.ssrc===p._audioSSRC);if(C&&C.estimatedPlayoutTimestamp){const U=C.estimatedPlayoutTimestamp-w;b.audio?b.audio[Kn.Audio_Recv_AV_Sync_TIME]=U:b.audio={[Kn.Audio_Recv_AV_Sync_TIME]:U}}}}(b.video||b.audio)&&A.push(b)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,A}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(s=>s instanceof M0);if(t&&t._external.getDenoiserStats){const s=t._external.getDenoiserStats();s&&this.requestUpload(gp.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[s,r]=t;r.has(Tt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(Tt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),r={connectionInterval:G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let i=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const f of l)!f.muted&&f.enabled&&(i=i.concat(await f.getProcessorUsage()));const A=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[f,b]of A)b.has(Tt.VIDEO)&&f.videoTrack&&(i=i.concat(await f.videoTrack.getProcessorUsage())),b.has(Tt.AUDIO)&&f.audioTrack&&(i=i.concat(await f.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(f,b){const w={};for(const{id:B,value:j,level:K,direction:q}of f){var _;const ie=(_=b.get(B))!==null&&_!==void 0?_:0,xe=j===2?ie+G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ie;var C,U;b.set(B,xe),w[B]?(j===2&&(w[B].value=j),K>w[B].level&&(w[B].level=K),q==="remote"&&(w[B].remoteUidCount+=1),w[B].totalTs=(C=b.get(B))!==null&&C!==void 0?C:0):w[B]={value:j,level:K,remoteUidCount:q==="local"?0:1,totalTs:(U=b.get(B))!==null&&U!==void 0?U:0}}return Object.keys(w).map(B=>{const{level:j,value:K,totalTs:q}=w[B];return{id:B,level:j,value:K,totalTs:q}})}(i,t);const u=Date.now(),p=u>s?u:s+1;this.requestUpload&&this.requestUpload(gp.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:p})},G("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,go.stopCollectStats()}}const nte=G("ICE_RESTART_INTERVAL");let t_=new Map,Pf=new Map,Lu=[Zn.UDP_TCP_RELAY,Zn.TCP_RELAY,Zn.RELAY],s2=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ls().supportPCSetConfiguration;function q4(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t_.get(e.id);s&&(window.clearTimeout(s),t_.delete(e.id));const r=Pf.get(e.id);t&&r&&r.index===Lu.length-1&&(N.debug("[".concat(e.id,"] reset ICE restart policy")),Pf.delete(e.id))}function Y4(e,t,s){if(t_.size===0&&Pf.size===0&&(Array.isArray(G("RESTART_SEQUENCE"))&&G("RESTART_SEQUENCE").length>0&&!function(u,p){if(u.length!==p.length)return!1;for(let f=0;f<u.length;f+=1){const b=u[f];if(u.filter(w=>w===b).length!==p.filter(w=>w===b).length)return!1}return!0}(Lu,G("RESTART_SEQUENCE"))&&(Lu=G("RESTART_SEQUENCE").filter(u=>{var p;if(nt(p=Object.values(Zn)).call(p,u))return!0}),N.debug("use reconnection policy from config distribution, queues: ".concat(Lu.join(" => ")))),s2=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ls().supportPCSetConfiguration),Lu.length===0)return void s();let r,{index:i=0,type:l}=Pf.get(e.id)||{};if(s2&&l===Zn.RELAY)return void s();let A=l&&i>=Lu.length-1;if(s2)l=Zn.RELAY;else{if(A)return void s();l?(i++,l=Lu[i]):(l=Lu[0],i=0)}N.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(i)),t(l),Pf.set(e.id,{index:i,type:l}),r=window.setTimeout(()=>Y4(e,t,s),nte),t_.set(e.id,r)}var Ps;function X4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Bd(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?X4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):X4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function J4(e){var t,s,r,i=2;for(typeof Symbol<"u"&&(s=qv,r=Symbol.iterator);i--;){if(s&&(t=e[s])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new s_(t.call(e));s="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function s_(e){function t(s){if(Object(s)!==s)return mt.reject(new TypeError(s+" is not an object."));var r=s.done;return mt.resolve(s.value).then(function(i){return{value:i,done:r}})}return s_=function(s){this.s=s,this.n=s.next},s_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var r=this.s.return;return r===void 0?mt.resolve({value:s,done:!0}):t(r.apply(this.s,arguments))},throw:function(s){var r=this.s.return;return r===void 0?mt.reject(s):t(r.apply(this.s,arguments))}},new s_(e)}let _p=(Ps=class extends jr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Vt.StateChange,t,this._state)}constructor(e,t){super(),P(this,"isPlanB",void 0),P(this,"store",void 0),P(this,"statsUploader",void 0),P(this,"connection",void 0),P(this,"localTrackMap",new Map),P(this,"remoteUserMap",new Map),P(this,"localDataChannels",[]),P(this,"remoteDataChannelMap",new Map),P(this,"pendingLocalTracks",[]),P(this,"pendingRemoteTracks",[]),P(this,"pendingLocalDataChannels",[]),P(this,"pendingRemoteDataChannels",[]),P(this,"statsCollector",void 0),P(this,"shouldForwardP2PCreation",void 0),P(this,"iceFailedCount",0),P(this,"dtlsFailedCount",0),P(this,"mutex",void 0),P(this,"_state",tr.Disconnected),P(this,"_pcStatsUploadType",G("NEW_ICE_RESTART")?RA.FIRST_CONNECTION:RA.OLD_FIRST_CONNECTION),P(this,"_isStartRestartIce",!1),P(this,"_restartTimer",void 0),P(this,"_isTryConnecting",!1),P(this,"_iceError",null),P(this,"_forceTurn",!1),P(this,"_isWaitPcToRePub",!1),P(this,"handleMuteLocalTrack",async(s,r,i)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==tr.Connected)return void i(new Me(W.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const A=this.filterTobeMutedTracks(s);if(A.length===0)return void r();const u=A.find(f=>f[0]==="videoLowTrack");if(u){const f=u[1];this.store.enableInstantMuteRestore?(f.track._originMediaStreamTrack.enabled=!1,N.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):f.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?N.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(A.map(f=>{let[,{id:b}]=f;return b}));const p=this.createMuteMessage(A);await wr(this,Vt.RequestMuteLocal,p),r()}catch(A){i(A)}finally{l()}}),P(this,"handleUnmuteLocalTrack",async(s,r,i)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==tr.Connected)return void i(new Me(W.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const A=this.filterTobeUnmutedTracks(s);if(A.length===0)return void r();const u=A.find(f=>f[0]==="videoLowTrack");if(u){const f=u[1];if(this.store.enableInstantMuteRestore)f.track._originMediaStreamTrack.enabled=!0,N.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(f.track._originMediaStreamTrack.stop(),!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding){const b=s._mediaStreamTrack.clone();f.track._mediaStreamTrack=b,f.track._originMediaStreamTrack=b}else{const b=e2(s,rp(this,Vt.RequestLowStreamParameter));f.track._mediaStreamTrack=b,f.track._originMediaStreamTrack=b}await new mt((b,w)=>{this.handleReplaceTrack(f.track,b,w,!0)})}}this.store.enableInstantMuteRestore?N.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(A.map(f=>{let[,{id:b}]=f;return b}));const p=this.createUnmuteMessage(A);await wr(this,Vt.RequestUnmuteLocal,p),r()}catch(A){i(A)}finally{l()}}),P(this,"handleUpdateVideoEncoder",async(s,r,i,l)=>{let A;l||(A=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const p=this.localTrackMap.get(at.LocalVideoTrack);if(!this.connection||!p||p.track!==s||this.state!==tr.Connected)return void r();const{id:f,track:b}=p;await this.connection.updateSendParameters(f,b),await this.connection.updateEncoderConfig(f,b),this.emit(Vt.UpdateVideoEncoder,b),r()}catch(p){i(p)}finally{var u;(u=A)===null||u===void 0||u()}}),P(this,"handleUpdateVideoSendParameters",async(s,r,i)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const A=this.localTrackMap.get(at.LocalVideoTrack);if(!this.connection||!A||A.track!==s||this.state!==tr.Connected)return void r();const{id:u,track:p}=A;await this.connection.updateSendParameters(u,p),r()}catch(A){i(A)}finally{l()}}),P(this,"handleReplaceMixingTrack",async(s,r,i,l)=>{if(!this.connection||this.state!==tr.Connected)return void r();const A=JN([s]);let u;N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(A.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,A),r()}catch(f){i(f)}finally{var p;(p=u)===null||p===void 0||p()}}),P(this,"handleReplaceTrack",async(s,r,i,l)=>{let A;N.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof l=="boolean"&&l||(A=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;const f=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:w}]=b;return s===w});if(!this.connection||!f||this.state!==tr.Connected)return void r();if(await((u=this.connection)===null||u===void 0?void 0:u.replaceTrack(s,f[1].id)),this.isPlanB){const b=f[1];b.id=s._mediaStreamTrack.id,this.localTrackMap.set(f[0],b)}if(f[0]===at.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding){const b=this.localTrackMap.get(at.LocalVideoLowTrack);if(b){const w=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=w,b.track._originMediaStreamTrack=w,await new mt((_,C)=>{this.handleReplaceTrack(b.track,_,C,!0)})}}r()}catch(f){i(f)}finally{var p;(p=A)===null||p===void 0||p()}}),P(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),P(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),P(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),P(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),P(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new z4(this.store),this.bindStatsUploaderEvents(),this.mutex=new $n("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ls().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Sd(),this.shouldForwardP2PCreation=G("FORWARD_P2P_CREATION")&&Ls().supportPCSetConfiguration&&BL(),this.shouldForwardP2PCreation&&(this.connection=$0(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var s;this.state=tr.New,this._forceTurn=ZN(e),N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=$0(this.store,e),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Me(W.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=G("NEW_ICE_RESTART")?RA.FIRST_CONNECTION:RA.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Me(W.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==tr.Connected){this.store.peerConnectionStart();const t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=tr.Connected,t}if(this.connection instanceof Qo&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),kt.reportApiInvoke(this.store.sessionId,{name:kr.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:br.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Vt.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var l;let[A]=i;return nt(l=[at.LocalVideoLowTrack,at.LocalVideoTrack]).call(l,A)}),s=t.map(i=>{let[,{id:l}]=i;return l}),r=t.map(i=>{let[l]=i;return l});if(this.connection instanceof Qo||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(kt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!nt(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(l=>nt(e).call(e,l));i&&(this.store.codec=i,N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(s,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Qo&&this.connection.peerConnectionState!=="closed"&&nt(e=[tr.New,tr.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==tr.Connected){if(this.state===tr.Disconnected)throw new Me(W.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(s=>{var r;nt(r=this.pendingLocalDataChannels).call(r,s)||this.pendingLocalDataChannels.push(s)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(s=>{const r=Date.now();this.store.publish(s.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(s=>{this.localDataChannels.push(s);const r=Date.now();this.store.publish(s.id+"","datachannel",void 0,r)}),e.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(e,t,s){var r=this;return Na(function*(){const i=yield vs(r.mutex.lock("From P2PChannel.publish"));try{var l;const A=r.connection&&nt(l=["disconnected","failed"]).call(l,r.connection.peerConnectionState);if(!r.connection||r.state!==tr.Connected||A){if(r.state===tr.Disconnected)throw new Me(W.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const p=e.filter(f=>r.pendingLocalTracks.indexOf(f)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(p),void(A&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Li.markPublishStart(r.store.clientId,r.store.pubId);const u=r.filterTobePublishedTracks(e,t,s);if(u.length===0)return void(yield vs(r.tryToUnmuteAudio(e)));yield*af(J4(r.doPublish(r.connection,u)))}finally{i()}})()}doPublish(e,t){var s=this;return Na(function*(){t.forEach(_=>{let{track:C,type:U}=_;const B=Date.now();s.store.publish(C.getTrackId(),U===at.LocalAudioTrack?"audio":"video",B)}),s.bindLocalTrackEvents(t);const r=t.map(_=>{let{track:C}=_;return C}),i=yield vs(e.send(r,s.store.codec,s.store.audioCodec)),l=(yield vs(i.next())).value,A=s.createGatewayPublishMessage(t,l);let u;try{u=yield A}catch(_){throw i.throw(_),(_==null?void 0:_.code)===W.WS_ABORT&&t.forEach(C=>{let{track:U}=C;s.pendingLocalTracks.indexOf(U)===-1&&s.pendingLocalTracks.push(U)}),s.unbindLocalTrackEvents(t),_}const p=s.mapPubResToRemoteConfig(A,u,r),f=(yield vs(i.next(p))).value;if(s.state===tr.Disconnected)throw new Me(W.UNEXPECTED_ERROR,"PeerConnection already disconnected.");G("ENABLE_VIDEO_SEI");const b=G("ENABLE_ENCODED_TRANSFORM"),w=G("ENABLE_AUDIO_METADATA");r.forEach(async _=>{const C=_.getRTCRtpTransceiver();if(!C||!b)return;const{interceptLocalVideoFrame:U,interceptLocalAudioFrame:B}=Kw();_.trackMediaType===Tt.VIDEO?await U(C.sender,_):_.trackMediaType===Tt.AUDIO&&await B(C.sender,{metadata:w?()=>{const j=_.metadata.shift();return j&&j.value}:void 0})}),t.forEach(_=>{let{type:C}=_;s.statsCollector.addLocalStats(C)}),s.assignLocalTracks(t,f),s.statsUploader.startUploadOutboundStats(),t.forEach(_=>{let{track:C,type:U}=_;const B=Date.now();s.store.publish(C.getTrackId(),U===at.LocalAudioTrack?"audio":"video",void 0,B)})})()}async updateVideoStreamParameter(e,t){const s=this.localTrackMap.get(t);if(!s||!this.connection)return;if(!(s.track instanceof xr))return N.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=s,i=function(l,A){const u={};return l.height&&l.width&&(u.scaleResolutionDownBy=IN(l,A)),u.maxFramerate=l.framerate?ka(l.framerate):void 0,u.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,u}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==at.LocalVideoLowTrack||!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const l=r._originMediaStreamTrack;if(!l.canvas)return N.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(A,u){const p=A.canvas;u.width&&(p.width=ka(u.width)),u.height&&(p.height=ka(u.height)),u.framerate&&(p.stopCapture&&p.stopCapture(),p.stopCapture=eN(()=>{!p.startCapture&&p.stopCapture&&p.stopCapture(),p.startCapture&&p.startCapture()},ka(u.framerate)))})(l,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),N.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return Na(function*(){if(!t.connection||t.state!==tr.Connected)return;const s=yield vs(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(at.LocalVideoTrack);if(!i)throw new Me(W.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(at.LocalVideoLowTrack))throw new Me(W.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(i.track,e),type:at.LocalVideoLowTrack}];if(yield*af(J4(t.doPublish(t.connection,l))),i.track.muted||!i.track.enabled){var r;const A=(r=t.localTrackMap.get(at.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;A!==void 0&&(yield vs(t.connection.muteLocal([A])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await wn(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(N.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await wn(this,Vt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:s,kind:r}=this.pendingRemoteTracks[t];(r!==Tt.AUDIO||s._audio_added_&&s._audioSSRC)&&(r!==Tt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await wn(this,Vt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:s}of this.pendingRemoteTracks)await this.subscribe(t,s,s===Tt.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:s}=t;this.emit(Vt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==tr.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const s=t.find(r=>r[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==tr.Connected)return void e.forEach(s=>{const r=this.pendingLocalDataChannels.indexOf(s);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(s=>{const r=this.localDataChannels.indexOf(s);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==tr.Connected)return;const e=this.localTrackMap.get(at.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[at.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const s=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:l}]=r;return{type:i,track:l}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(e,t){if(!this.connection||this.state!==tr.Connected)throw new Me(W.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(s.length!==0)return await this.connection.createDataChannels(e.uid,s),s.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const l=this.pendingRemoteDataChannels.findIndex(A=>{let{user:u,id:p}=A;return u.uid===e.uid&&p===r.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),s.map(r=>r.id)}async subscribe(e,t,s,r,i){var l;if(!this.connection||this.state!==tr.Connected)throw new Me(W.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let A,u,p,f;const b=this.connection.getPreMedia(s);if(b)N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),p=b.transceiver,A=b.track,u=b.mid,f=b.player,b.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:b.firstVideoRender});else if(i){const C=i.find(B=>{let{stream_type:j}=B;return j===t});if(!C)throw new Me(W.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const U=await this.connection.receive(t,C.ssrcs,String(e._uintid),C.attributes);(this.connection instanceof Qo||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(p=U.transceiver),A=U.track,u=U.id}else{const C=await this.connection.receive(t,[{ssrcId:s,rtx:r}],String(e._uintid),void 0);(this.connection instanceof Qo||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(p=C.transceiver),A=C.track,u=C.id}if(t===Tt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(A):(e._audioTrack=new yf(A,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(A):(e._videoTrack=new _f(A,e.uid,e._uintid,this.store,f),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Ac.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Ac.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),f?e._videoTrack.once(Ac.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Ac.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack)),p&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:U}=Kw();t==Tt.VIDEO?await C(p.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(B=>{var j;return(j=e._videoTrack)===null||j===void 0?void 0:j._onSei(B)}),onFirstFrame:B=>{var j;const K=Array.from(Wi(j=this.remoteUserMap).call(j)).find(q=>q._videoSSRC===B.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:B.type,rtpTimestamp:B.rtpTimestamp,framePayloadType:B.payloadType,frameDataLength:B.length,mimeType:B.mimeType})}}):t==Tt.AUDIO&&await U(p.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:B=>{this.safeEmit(Vt.AudioMetadata,B)},onPts:B=>{this.safeEmit(Vt.AudioPts,B)}})}const w=this.remoteUserMap.get(e);w?w.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(C=>{let{user:U,kind:B}=C;return U.uid===e.uid&&t===B});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Vt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==tr.Connected)throw new Me(W.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var l;let{user:A,mediaType:u}=i;return!((l=this.remoteUserMap.get(A))!==null&&l!==void 0&&l.has(u))});const t=[],s=new Map;e.forEach(i=>{if(!this.connection)return;const l=this.connection.getPreMedia(i.ssrcId);if(l){const{track:A,mid:u,transceiver:p,player:f}=l;s.set(i.ssrcId,{track:A,id:u,transceiver:p,player:f})}else t.push(i)});const r=await this.connection.batchReceive(t.map(i=>{let{user:l,mediaType:A,ssrcId:u,rtxSsrcId:p}=i;return{kind:A,ssrcMsg:[{ssrcId:u,rtx:p}],mslabel:String(l._uintid)}}));t.forEach((i,l)=>{s.set(i.ssrcId,r[l])});for(const{user:i,mediaType:l,ssrcId:A}of e){const u=s.get(A);if(!u)return void N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(l,", ").concat(A));const{track:p,id:f,transceiver:b,player:w}=u;if(b&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:B}=Kw();l==Tt.VIDEO?await U(b.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(j=>{var K;return(K=i._videoTrack)===null||K===void 0?void 0:K._onSei(j)}),onFirstFrame:j=>{var K;const q=Array.from(Wi(K=this.remoteUserMap).call(K)).find(ie=>ie._videoSSRC===j.ssrc);q&&this.store.firstVideoFrameDecoded(q.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):l==Tt.AUDIO&&await B(b.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(Vt.AudioMetadata,j)},onPts:j=>{this.safeEmit(Vt.AudioPts,j)}})}if(l===Tt.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(p):(i._audioTrack=new yf(p,i.uid,i._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),b&&i._audioTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(p):(i._videoTrack=new _f(p,i.uid,i._uintid,this.store,w),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),b&&i._videoTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(i,i._videoTrack)),G("ENABLE_VIDEO_SEI")&&b){const{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:B}=Kw();l==Tt.VIDEO?await U(b.receiver,{onSei:j=>{var K;(K=i._videoTrack)===null||K===void 0||K._onSei(j)},onFirstFrame:j=>{var K;const q=Array.from(Wi(K=this.remoteUserMap).call(K)).find(ie=>ie._videoSSRC===j.ssrc);q&&this.store.firstVideoFrameDecoded(q.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):l==Tt.AUDIO&&await B(b.receiver)}const _=this.remoteUserMap.get(i);_?_.set(l,f):this.remoteUserMap.set(i,new Map([[l,f]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const C=this.pendingRemoteTracks.findIndex(U=>{let{user:B,kind:j}=U;return B.uid===i.uid&&l===j});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(Vt.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,s){const r=this.pendingRemoteTracks.filter(A=>{let{user:u,kind:p}=A;return t!==void 0?u.uid===e.uid&&t===p:u.uid===e.uid});if(r.forEach(A=>{const u=this.pendingRemoteTracks.indexOf(A);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===tr.Connected||s||r.forEach(A=>{let{kind:u}=A;var p;if(u===Tt.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(u===Tt.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==tr.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(A=>{let[,{id:u}]=A;return u}));const l=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(A=>{let[u,{kind:p}]=A;var f,b;if(p===Tt.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),p===Tt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),s||((b=u._videoTrack)===null||b===void 0||b._destroy(),u._videoTrack=void 0);else if(p===Tt.AUDIO){var w;this.unbindRemoteTrackEvents(u._audioTrack),!s&&((w=u._audioTrack)===null||w===void 0||w._destroy(),u._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const l=this.pendingRemoteDataChannels.findIndex(A=>A.id===i.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(e,t);if(s.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return s.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),s.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:l}of e){const A=this.pendingRemoteTracks.filter(u=>{let{user:p,kind:f}=u;return l!==void 0?p.uid===i.uid&&l===f:p.uid===i.uid});A.forEach(u=>{const p=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(p,1)}),t=t.concat(A)}if(!this.connection||this.state!==tr.Connected)return void t.forEach(i=>{let{user:l,kind:A}=i;var u;if(A===Tt.AUDIO)(u=l._audioTrack)===null||u===void 0||u._destroy(),l._audioTrack=void 0;else if(A===Tt.VIDEO){var p;(p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0}});const s=Fa(e).call(e,(i,l)=>{let{user:A,mediaType:u}=l;const p=this.filterTobeUnSubscribedTracks(A,u);return i.concat(p)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(i=>{let[,{id:l}]=i;return l}));const r=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(i=>{let[l,{kind:A}]=i;var u,p;if(A===Tt.VIDEO&&l._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),A===Tt.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0;else if(A===Tt.AUDIO){var f;this.unbindRemoteTrackEvents(l._audioTrack),(f=l._audioTrack)===null||f===void 0||f._destroy(),l._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==tr.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Tt.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(t)||N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(at.LocalAudioTrack),s=t&&t.track;s&&s.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(at.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Tn){const s=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==at.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===at.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[r]=s;return!(e&&r===at.LocalVideoLowTrack)}).map(s=>{let[,{track:r}]=s;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,s,r,i){if(e){const A=this.localTrackMap.get(at.LocalAudioTrack),u=r?this.localTrackMap.get(at.LocalVideoLowTrack):this.localTrackMap.get(at.LocalVideoTrack);kt.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:A==null?void 0:A.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(rr.SCREEN_TRACK))!==-1,audio:!!A,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var l;s||(s=[]);const A=s.find(p=>p instanceof $r),u=r?(l=this.localTrackMap.get(at.LocalVideoTrack))===null||l===void 0?void 0:l.track:s.find(p=>p instanceof xr);kt.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:A==null?void 0:A.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(rr.SCREEN_TRACK))!==-1,audio:!!A,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,s,r){const i=r===Tt.VIDEO?s._videoSSRC:s._audioSSRC;i&&kt.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Tt.VIDEO,audio:r===Tt.AUDIO,peerid:s.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new $n("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=$0(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(at.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Tn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(s=>{t.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=tr.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(at.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(at.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof xr||t&&t.track instanceof $r?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;const s=Array.from(Wi(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[r]=s;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(at.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Kh(e).call(e,(s,r)=>s.level-r.level),e}async disconnectForReconnect(){this.connection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=tr.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&((s=t._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=$0(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:r}]=e;switch(s){case at.LocalVideoTrack:nt(t=r._hints).call(t,rr.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case at.LocalAudioTrack:r instanceof Tn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case at.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Wi(s).call(s)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Vt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Wi(s).call(s)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const s of this.pendingRemoteDataChannels){const{user:r,id:i}=s;if((e instanceof Bu?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const s of this.pendingRemoteTracks){const{user:r,kind:i}=s;if((e instanceof Bu?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Na(function*(){if(!t.connection||t.state!==tr.Connected)return;const s=yield vs(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield vs(t.connection.restartICE(e));const l=yield vs(r.next());if(l.done)return;const A=l.value,u=yield A;switch($N(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Zn.UDP_TCP_RELAY:t._pcStatsUploadType=RA.UDP_TCP_RESTART;break;case Zn.TCP_RELAY:t._pcStatsUploadType=RA.TCP_RESTART;break;case Zn.RELAY:t._pcStatsUploadType=RA.RELAY_RESTART;break;default:t._pcStatsUploadType=RA.OLD_RESTART}t._isTryConnecting=!0,r.next(u)}catch(l){var i;(i=r)===null||i===void 0||i.throw(l)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(at.LocalVideoTrack),s=this.localTrackMap.get(at.LocalAudioTrack),r=e.videoSend.find(C=>C.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(C=>C.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!r||!i)return 1;const l=fo(this,Vt.NeedSignalRTT),A=r?r.rttMs:void 0,u=i?i.rttMs:void 0,p=A&&u?(A+u)/2:A||u,f=(p&&l?(p+l)/2:p||l)||0,b=100*e.sendPacketLossRate*.7/50+.3*f/1500,w=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,_=t==null?void 0:t.track;if(_&&_._encoderConfig&&_._hints.indexOf(rr.SCREEN_TRACK)===-1){const C=_._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(C&&U){const B=(1e3*C-U)/(1e3*C);return PU[B<.15?0:B<.3?1:B<.45?2:B<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[r]=s;const i=r._audioSSRC,l=r._videoSSRC,A=e.audioRecv.find(U=>U.ssrc===i),u=e.videoRecv.find(U=>U.ssrc===l);if(!A&&!u)return void(t+=1);const p=fo(this,Vt.NeedSignalRTT),f=e.rtt,b=(f&&p?(f+p)/2:f||p)||0,w=A?A.jitterMs:void 0,_=e.recvPacketLossRate;let C=.7*_*100/50+.3*b/1500;w&&(C=.6*_*100/50+.2*b/1500+.2*w/400),t+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new mt((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}async replaceTrack(e,t){var s;if(N.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==tr.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:A}]=l;return e===A});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(t,r[1].id)),this.isPlanB){const l=r[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,l)}if(i===at.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding){const l=this.localTrackMap.get(at.LocalVideoLowTrack);if(l){const A=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=A,l.track._originMediaStreamTrack=A,await new mt((u,p)=>{this.handleReplaceTrack(l.track,u,p,!0)})}}}filterTobePublishedTracks(e,t,s){const r=[],i=this.getAllTracks();e=lf(e=e.filter(p=>i.indexOf(p)===-1));let l,A=!1;const u=this.localTrackMap.get(at.LocalAudioTrack);for(const p of e){if(p instanceof xr&&(this.localTrackMap.has(at.LocalVideoTrack)||A?new Me(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:p,type:at.LocalVideoTrack}),A=!0),t)){const f=this.getLowVideoTrack(p,s);r.push({track:f,type:at.LocalVideoLowTrack})}if(p instanceof $r)if(u){const f=u.track;if(f instanceof Tn)XN([p]),f.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0);else{const b=JN([f,p]);N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(b.getTrackId(),"]")),this.replaceTrack(f,b)}}else l instanceof Tn?(XN([p]),l.addAudioTrack(p)):l||!p._useAudioElement&&Ls().webAudioMediaStreamDest&&!p._bypassWebAudio?l=JN(l?[p,l]:[p]):l=p}return l&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),r.push({track:l,type:at.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],s=this.getAllTracks();e=lf(e=e.filter(r=>s.indexOf(r)!==-1));for(const r of e){if(r instanceof $r){const i=this.localTrackMap.get(at.LocalAudioTrack);if(!i)continue;i.track instanceof Tn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([at.LocalAudioTrack,i]),i.track.close())):t.push([at.LocalAudioTrack,i])}if(r instanceof xr){const i=this.localTrackMap.get(at.LocalVideoTrack);if(!i)continue;t.push([at.LocalVideoTrack,i]);const l=this.localTrackMap.get(at.LocalVideoLowTrack);l&&t.push([at.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=lf(e)).filter(t=>this.localDataChannels.findIndex(s=>s.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=lf(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:s,type:r}=t;switch(r){case at.LocalVideoTrack:s.addListener(Bt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Bt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case at.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case at.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Tn?e.trackList.forEach(s=>{s.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Bt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Bt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Bt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[s,{track:r}]=t;return{track:r,type:s}})),e.forEach(t=>{let{track:s,type:r}=t;switch(r){case at.LocalVideoTrack:s.off(Bt.GET_STATS,this.handleGetLocalVideoStats),s.off(Bt.GET_RTC_STATS,this.handleGetRTCStats),s.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case at.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case at.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Tn?e.trackList.forEach(t=>{t.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Bt.GET_STATS,this.handleGetLocalAudioStats),t.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Bt.GET_STATS,this.handleGetLocalAudioStats),e.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Bt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof _f&&t.addListener(Bt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),t instanceof yf&&t.addListener(Bt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Bt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(Tt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(Tt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((s,r)=>{var i;let l,A,{track:u,type:p}=s;switch(p){case at.LocalAudioTrack:l=cr.Audio,A={dtx:u instanceof M0&&u._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case at.LocalVideoTrack:l=nt(i=u._hints).call(i,rr.SCREEN_TRACK)?cr.Screen:cr.High,A=Bd(Bd({},$U(u)),{},{codec:this.store.codec,svc_mode:G0()});break;case at.LocalVideoLowTrack:l=cr.Low,A=Bd(Bd({},$U(u)),{},{codec:this.store.codec,svc_mode:G0()})}return{stream_type:l,attributes:A,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case at.LocalVideoTrack:r=nt(s=l._hints).call(s,rr.SCREEN_TRACK)?cr.Screen:cr.High;break;case at.LocalAudioTrack:r=cr.Audio;break;case at.LocalVideoLowTrack:r=cr.Low}return{stream_type:r,ssrcs:A,mid:u}})}assignLocalTracks(e,t){e.forEach((s,r)=>{let{track:i,type:l}=s;this.localTrackMap.set(l,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[s]=t;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Vt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Qo&&!Tr()&&G("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},G("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Qo&&q4(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=RA.DISCONNECTED_OR_FAILED,fo(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(i=>i.getTrackId()),r=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));kt.reportApiInvoke(this.store.sessionId,{name:kr.REPUB_AFTER_PC_CONNECTED,options:s.concat(r),tag:br.TRACER}).onSuccess(),this.republish()}if(G("NEW_ICE_RESTART")&&e instanceof Qo&&!Tr()&&!this._forceTurn&&!this.store.useDcSignal){if(nt(WU).call(WU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=i=>{$N(e)&&(N.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),fo(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE,i))},r=()=>{$N(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),N.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{Y4(e,s,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&G("ICE_RESTART")&&fo(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),kt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:br.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var s;const r=Array.from(Wi(s=this.remoteUserMap).call(s)).find(l=>l._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Ac.FIRST_FRAME_DECODED),kt.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_DECODE,Dr.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var s;const r=Array.from(Wi(s=this.remoteUserMap).call(s)).find(i=>i._audioSSRC===t);r&&kt.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_RECEIVED,Dr.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,s,r)=>{var i;const l=Array.from(Wi(i=this.remoteUserMap).call(i)).find(A=>A._videoSSRC===t);l&&this.store.firstVideoFrameDecoded(l.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,s,r)},e.onFirstVideoRender=t=>{var s;const r=Array.from(Wi(s=this.remoteUserMap).call(s)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r),this.emit(Vt.FirstVideoPreRender,r.uid,t))},e.onFirstVideoReceived=t=>{var s;const r=Array.from(Wi(s=this.remoteUserMap).call(s)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),kt.firstRemoteFrame(this.store.sessionId,Nn.FIRST_VIDEO_RECEIVED,Dr.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var s;const r=Array.from(Wi(s=this.remoteUserMap).call(s)).find(i=>i._videoSSRC===t);r&&this.emit(Vt.FirstVideoBufferReady,r.uid,t)},e.onSelectedLocalCandidateChanged=(t,s)=>{const r=t.candidateType==="relay",i=s.candidateType==="relay";s.candidateType!=="unknown"&&r===i||this.emit(Vt.ConnectionTypeChange,r),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ku(s))," -> ").concat(JSON.stringify(ku(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,s)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ku(s))," -> ").concat(JSON.stringify(ku(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Bd(Bd({},t),s)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){N.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===tr.Connected?(N.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=$0(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof Qo&&function(t){Pf.delete(t.id),q4(t)}(e),e.close(),this.emit(Vt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const s=this.localTrackMap.get(at.LocalAudioTrack);if(e instanceof $r&&(s==null?void 0:s.track)instanceof Tn)return s.track.isActive||t.push([at.LocalAudioTrack,s]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:l}]=i;return e===l});if(r&&(t.push(r),r[0]===at.LocalVideoTrack)){const i=this.localTrackMap.get(at.LocalVideoLowTrack);i&&t.push([at.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],s=this.localTrackMap.get(at.LocalAudioTrack);if(e instanceof $r&&(s==null?void 0:s.track)instanceof Tn)return s.track.isActive&&t.push([at.LocalAudioTrack,s]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:l}]=i;return e===l});if(r)if(r[0]===at.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(at.LocalVideoLowTrack);i&&t.push([at.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case at.LocalAudioTrack:r=cr.Audio;break;case at.LocalVideoTrack:r=nt(s=l._hints).call(s,rr.SCREEN_TRACK)?cr.Screen:cr.High;break;case at.LocalVideoLowTrack:r=cr.Low}return{stream_type:r,ssrcs:A,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case at.LocalAudioTrack:r=cr.Audio;break;case at.LocalVideoTrack:r=nt(s=l._hints).call(s,rr.SCREEN_TRACK)?cr.Screen:cr.High;break;case at.LocalVideoLowTrack:r=cr.Low}return{stream_type:r,ssrcs:A,mid:u}})}filterTobeUnSubscribedTracks(e,t){const s=[],r=this.remoteUserMap.get(e);if(!r)return s;if(t){const i=r.get(t);if(!i)return s;s.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[l,A]=i;s.push([e,{kind:l,id:A}])});return s}filterTobeUnSubscribedDataChannels(e,t){const s=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&s.push(r)}),s}createUnsubscribeMessage(e){const t=[];return e.forEach(s=>{let[r,{kind:i,id:l}]=s;switch(i){case Tt.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Tt.VIDEO,ssrcId:r._videoSSRC}));case Tt.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Tt.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(s=>{let[r,{kind:i}]=s;if(t.has(r)){let l=t.get(r);i===Tt.VIDEO?l|=Gn.Video:l|=Gn.Audio,t.set(r,l)}else i===Tt.VIDEO?t.set(r,Gn.Video):t.set(r,Gn.Audio)}),{users:Array.from(t.entries()).map(s=>{let[r,i]=s;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[s,{kind:r}]=t;const i=this.remoteUserMap.get(s);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(at.LocalVideoTrack),s=this.localTrackMap.get(at.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new mt((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new mt((r,i)=>{this.handleUpdateVideoEncoder(s.track,r,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof Qo&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Qo)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof Qo&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,s){return e.map((r,i)=>{var l;let{stream_type:A}=r;const u=(l=t.find(p=>{let{stream_type:f}=p;return A===f}))===null||l===void 0?void 0:l.attributes;if(u&&G("DISABLE_SCREEN_SHARE_REMB")){const p=s[i]._hints;(nt(p).call(p,rr.SCREEN_TRACK)||nt(p).call(p,rr.SCREEN_LOW_TRACK))&&(u.remb=!1,N.debug("disable remb for screen share, hints:",p))}return u})}async tryToUnmuteAudio(e){for(let s=0;s<e.length;s++)if(e[s]instanceof $r){var t;const r=this.filterTobeUnmutedTracks(e[s]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(l=>{let[,{id:A}]=l;return A})));const i=this.createUnmuteMessage(r);return void await wr(this,Vt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Vt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Vt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Qn(ow(this.dtlsFailedCount,pn)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await wn(this,Vt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Vt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(at.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof xr)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof xr).length>1)throw new Me(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof $r).length>1&&(e.some(t=>t instanceof $r&&t._bypassWebAudio)||!Ls().webAudioMediaStreamDest))throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof xr&&this.pendingLocalTracks.some(s=>s instanceof xr))throw new Me(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof $r&&this.pendingLocalTracks.some(s=>s instanceof $r)&&(!Ls().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof $r&&s._bypassWebAudio)))throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var s;const r=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding,i=Bd(Bd({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=r?e._mediaStreamTrack.clone():e2(e,i);const A=ar(8,"track-low-"),u=new xr(l,Bd(Bd({},r&&{scaleResolutionDownBy:IN(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,A);return u.on(dp.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,ff.LOW_STREAM)}),u._hints.push(rr.LOW_STREAM),nt(s=e._hints).call(s,rr.SCREEN_TRACK)&&u._hints.push(rr.SCREEN_LOW_TRACK),e.on("sei-to-send",p=>{u.emit("sei-to-send",p)}),e.addListener(Bt.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Qo){var i,l,A,u;const p=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:b,peerConnectionState:w}=this.connection,{local:_,remote:C}=await this.connection.getSelectedCandidatePair();kt.pcStats(this.store.sessionId,{startTime:p,eventElapse:e-p||0,iceconnectionsate:f,dtlsstate:b,connectionstate:w,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=_==null?void 0:_.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(l=_.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(_.address,":").concat(_.port),selectedRemoteCandidateProtocol:(A=C.protocol)!==null&&A!==void 0?A:"",selectedRemoteCandidateType:(u=C.candidateType)!==null&&u!==void 0?u:"",selectedRemoteCandidateAddress:"".concat(C.address,":").concat(C.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,s=t.firstVideoFrameDecoded.find(b=>b.userId===e.uid);if(!s)return;const{isInternalUpload:r,isExternalUpload:i}=s;if(r&&i)return;const{subscribeEnd:l,firstPreRender:A,peerPublishDuration:u,peerPubStatusMs:p}=s;let{firstRender:f=0}=s;if(l&&(f||A)&&u&&p){s.isInternalUpload=!0;const{playEnd:b}=s;b&&(s.isExternalUpload=!0);const{firstPreRender:w=0}=s;f=w||f;const _=e.videoTrack,C={peer:e._uintid,width:(_==null?void 0:_._videoWidth)||0,height:(_==null?void 0:_._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:u,peerPubStatusMs:p,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:w||0,firstRender:b?Math.max(f,b):Math.max(f,l),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:bj(this.store),firstReceivedEncodedFrame:s.firstReceivedEncodedFrame||0,frameType:s.frameType||"",rtpTimestamp:s.rtpTimestamp||0,framePayloadType:s.framePayloadType||0,frameDataLength:s.frameDataLength||0,mimeType:s.mimeType||""};kt.firstXLAPeerFirstVideoFrame(this.store.sessionId,C)}}reportVideoFirstFrameDecoded(e,t,s,r){var i;const l=Array.from(Wi(i=this.remoteUserMap).call(i)).find(A=>A._videoSSRC===e);if(l){r||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const A=this.store.keyMetrics,u=A.subscribe.find(p=>p.userId===l.uid&&p.type==="video");kt.firstRemoteVideoDecode(this.store.sessionId,Nn.FIRST_VIDEO_DECODE,Dr.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:s,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:A.requestAPEnd||0,apStart:A.requestAPStart||0,joinGwEnd:A.joinGatewayEnd||0,joinGwStart:A.joinGatewayStart||0,pcEnd:A.peerConnectionEnd||0,pcStart:A.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:r?1:0,firstFrame:(u==null?void 0:u.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const l=await this.connection.getRemoteSSRC(i);return l!==void 0&&l!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===at.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ff.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},ft(Ps.prototype,"startP2PConnection",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"startP2PConnection"),Ps.prototype),ft(Ps.prototype,"connect",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"connect"),Ps.prototype),ft(Ps.prototype,"updateRemoteRTPCapabilities",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"updateRemoteRTPCapabilities"),Ps.prototype),ft(Ps.prototype,"publishDataChannel",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"publishDataChannel"),Ps.prototype),ft(Ps.prototype,"unpublish",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"unpublish"),Ps.prototype),ft(Ps.prototype,"unpublishDataChannel",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"unpublishDataChannel"),Ps.prototype),ft(Ps.prototype,"unpublishLowStream",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"unpublishLowStream"),Ps.prototype),ft(Ps.prototype,"subscribeDataChannel",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"subscribeDataChannel"),Ps.prototype),ft(Ps.prototype,"subscribe",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"subscribe"),Ps.prototype),ft(Ps.prototype,"massSubscribe",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"massSubscribe"),Ps.prototype),ft(Ps.prototype,"unsubscribe",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"unsubscribe"),Ps.prototype),ft(Ps.prototype,"unsubscribeDataChannel",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"unsubscribeDataChannel"),Ps.prototype),ft(Ps.prototype,"massUnsubscribe",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"massUnsubscribe"),Ps.prototype),ft(Ps.prototype,"muteRemote",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"muteRemote"),Ps.prototype),ft(Ps.prototype,"unmuteRemote",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"unmuteRemote"),Ps.prototype),ft(Ps.prototype,"hasRemoteMediaWithLock",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"hasRemoteMediaWithLock"),Ps.prototype),ft(Ps.prototype,"disconnectForReconnect",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"disconnectForReconnect"),Ps.prototype),ft(Ps.prototype,"updateBitrateLimit",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"updateBitrateLimit"),Ps.prototype),ft(Ps.prototype,"remoteMediaSsrcChanged",[ta],Object.getOwnPropertyDescriptor(Ps.prototype,"remoteMediaSsrcChanged"),Ps.prototype),Ps);function ta(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From P2PChannel.".concat(t));try{for(var A=arguments.length,u=new Array(A),p=0;p<A;p++)u[p]=arguments[p];return await r.apply(this,u)}finally{l()}},s}function $4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Z4(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?$4(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const ite=Date.now(),ate=20,r2=new Map,r_=new Map;async function eF(e){const t=r2.get(e),s=Array.isArray(t)&&t[t.length-1],r=r_.get(e);if(!s)return void(r.isSyncing=!1);const i={uid:s.uid,payload:s.payload};r.firstRecvTs===0&&(r.firstRecvTs=s.recvTs,r.firstSendTs=s.sendTs);const l=s.sendTs-r.firstSendTs,A=l-(Date.now()-r.firstRecvTs);A>0&&(r.firstRecvTs=Date.now()-l);let u=s.mediaDelay+A;u<=0?(t.pop(),tF(s.context,i),u=0):u=Math.min(u,ate),setTimeout(()=>t.length&&eF(e),u)}function tF(e,t){e.safeEmit(Es.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function ote(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return tF(s,{uid:e.uid,payload:e.payload});const r="".concat(s.id,"-").concat(e.uid),i=r2.get(r)||[],l=i.findIndex(f=>e.sendTs>=f.sendTs),A=Z4(Z4({},e),{},{context:s,mediaDelay:t,recvTs:Date.now()});l===-1?i.push(A):i.splice(l,0,A),r2.set(r,i);let u=!1;var p;r_.has(r)?u=!((p=r_.get(r))===null||p===void 0||!p.isSyncing):r_.set(r,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||eF(r)}const cte=zs().name;function sF(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function rF(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?sF(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):sF(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const Uf="websdk_ng_cache_parameter",lte=G("MAX_PRELOAD_ASYNC_LENGTH"),dte=1e4,yp=new Map,Ep=[];let n2=null,i2=0,a2=0;const n_=new Map,nF=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),Ate=function(e,t){const s=[];let r=0;const i=async()=>{const l=s.shift();l&&await l(),s.length>0&&r<t?i():r--};return async function(){for(var l=arguments.length,A=new Array(l),u=0;u<l;u++)A[u]=arguments[u];return new mt(async(p,f)=>{s.push(async()=>{try{const b=await e(...A);p(b)}catch(b){f(b)}}),r<t&&(r++,i())})}}(c2,lte),o2=Ta.CancelToken.source();class ute{constructor(){P(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const t=this._audioContext.sampleRate,s=10*t,r=this._audioContext.createBuffer(2,s,t),i=this._audioContext.createBufferSource();i.buffer=r;const l=this._audioContext.createMediaStreamDestination();return i.connect(l),i.start(),l.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function c2(e,t,s,r,i,l,A){try{if(!G("ENABLE_PRELOAD"))return;if(!Ls().supportWebCrypto)return void Cu(()=>{N.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Me(W.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&di(s,"token",1,2047),di(e,"appid",1,2047),Dw(t),r&&Bw(r);const u=ap();N.debug("preload channel ".concat(t,", uid is ").concat(r));const p={appId:e,cname:t,token:s||e,uid:typeof r!="string"?r:null,sid:u,proxyServer:i,role:A};let f,b;typeof r=="string"?(p.stringUid=r,[b,f]=await mt.all([zee(r,{sid:u,appId:e},o2.token),T4(rF(rF({},p),{},{token:s||e,uid:0}),o2.token)]),p.uid=b.uid,f.gatewayInfo.uid=p.uid,f.gatewayInfo.res.uid=p.uid):(l&&(p.stringUid=l),f=await T4(p,o2.token));const w={sid:u,appId:e,cname:t,token:s||e,uid:p.stringUid||r,intUid:p.uid||f.gatewayInfo.uid,stringUid:p.stringUid,ts:Date.now(),sua:b,ap:f};await d2(w),i2++}catch(u){throw a2++,function(p){n2||(n2=window.setTimeout(()=>{let b="";n_.forEach((w,_)=>{b+="".concat(_,": ").concat(w," ;")}),kt.reportApiInvoke(null,{name:kr.PRELOAD,options:{success:i2,failed:a2,err:b}}).onError(p),i2=0,a2=0,n_.clear(),n2=null},dte));const f=n_.get(p.code)||0;n_.set(p.code,f+1)}(u),u}}async function l2(e){try{if(G("AP_REQUEST_DETAIL")||G("ENABLE_ROLE_SELECT_EDGE"))return;const t=iF(e);if(!t||e.cloudProxyServer!=="disabled")return;const s=await async function(r,i){try{const l=await window.crypto.subtle.importKey("raw",WL(i),"AES-GCM",!1,["decrypt"]),A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:nF},l,ip(r));return JSON.parse(window.atob(Nu(new Uint8Array(A))))}catch{return}}(t,e.token||e.appId);if(!s||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(s,e))return;if(s&&Date.now()-s.ts<G("AP_CACHE_LIFETIME"))return s}catch(t){N.warn("Error get preloadInfo",t.message)}}function iF(e){let t;try{if(t=cF(Uf),!t)return;const s=JSON.parse(t),r=lF(e),i=function(A,u){for(let p=A.length-1;p>=0;p--)if(u(A[p]))return p;return-1}(s,A=>r in A);if(i===-1)return;const l=s.splice(i,1)[0];return i_(Uf,JSON.stringify(s)),l[r]}catch(s){N.warn("Error delete preload info: ".concat(t),s.message),i_(Uf,"")}}async function d2(e){let t;try{e.uid&&iF({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const s=lF(e),r=await async function(l,A){try{const u=await window.crypto.subtle.importKey("raw",WL(A),"AES-GCM",!1,["encrypt"]),p=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:nF},u,ip(window.btoa(JSON.stringify(l))));return Nu(new Uint8Array(p))}catch{return}}(e,e.token||e.appId);if(!r)return;t=cF(Uf);const i=t?JSON.parse(t):[];i.push({[s]:r}),i.length>G("AP_CACHE_NUM")&&i.shift(),i_(Uf,JSON.stringify(i))}catch(s){N.warn("Error caching server parameters:",s.message),i_(Uf,"")}}function A2(e){if(e){let t=yp.get(e);t&&(window.clearTimeout(t),t=null,yp.delete(e)),nt(Ep).call(Ep,e)||e.cloudProxyServer!=="disabled"||Ep.push(e)}if(yp.size<G("AP_CACHE_NUM")&&Ep.length>0){const t=Ep.shift();yp.set(t,window.setTimeout(async()=>{const{appId:s,cname:r,token:i,stringUid:l,uid:A,proxyServer:u,role:p}=t;try{await Ate(s,r,i,A,u,l,p),yp.has(t)&&A2(t)}catch(f){N.warn("update preload failed",f.message),aF(t)}},G("AP_UPDATE_INTERVAL")))}}function aF(e){const t=Ep.indexOf(e);t!==-1&&Ep.splice(t,1);let s=yp.get(e);s&&(window.clearTimeout(s),s=null,yp.delete(e),A2())}function oF(e,t){const s=e.sua,r=e.ap;t&&s&&kt.reqUserAccount(e.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:t,uid:e.intUid,errorCode:null,extend:s.req}),kt.reportResourceTiming(e.ap.url,e.sid),kt.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[mn.CHOOSE_SERVER,mn.CLOUD_PROXY_FALLBACK].toString()}),kt.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[mn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function cF(e){return window.atob(window.localStorage.getItem(e)||"")}function i_(e,t){window.localStorage.setItem(e,window.btoa(t))}function lF(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),ZL(t)}function hte(e){let t=function(){const s=fte.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,r){let i=s.appId;i!==void 0&&(fn(r,10),ju(r,i));let l=s.cid;l!==void 0&&(fn(r,16),fn(r,l));let A=s.cname;A!==void 0&&(fn(r,26),ju(r,A));let u=s.deviceId;u!==void 0&&(fn(r,34),ju(r,u));let p=s.elapse;p!==void 0&&(fn(r,40),Pu(r,p));let f=s.fileSize;f!==void 0&&(fn(r,48),Pu(r,Ff(f)));let b=s.height;b!==void 0&&(fn(r,56),Pu(r,Ff(b)));let w=s.jpg;w!==void 0&&(fn(r,66),fn(r,w.length),AF(r,w));let _=s.networkType;_!==void 0&&(fn(r,72),Pu(r,Ff(_)));let C=s.osType;C!==void 0&&(fn(r,80),Pu(r,Ff(C)));let U=s.requestId;U!==void 0&&(fn(r,90),ju(r,U));let B=s.sdkVersion;B!==void 0&&(fn(r,98),ju(r,B));let j=s.sequence;j!==void 0&&(fn(r,104),Pu(r,Ff(j)));let K=s.sid;K!==void 0&&(fn(r,114),ju(r,K));let q=s.timestamp;q!==void 0&&(fn(r,120),Pu(r,q));let ie=s.uid;ie!==void 0&&(fn(r,128),fn(r,ie));let xe=s.vid;xe!==void 0&&(fn(r,136),fn(r,xe));let ye=s.width;ye!==void 0&&(fn(r,144),Pu(r,Ff(ye)));let ue=s.service;ue!==void 0&&(fn(r,152),fn(r,ue));let Re=s.callbackData;Re!==void 0&&(fn(r,162),fn(r,Re.length),AF(r,Re));let Ge=s.ticket;Ge!==void 0&&(fn(r,170),ju(r,Ge));let Ze=s.vendorConfigs;Ze!==void 0&&(fn(r,178),ju(r,Ze))}(e,t),function(s){let r=s.bytes,i=s.limit;return r.length===i?r:r.subarray(0,i)}(t)}function pte(e){return function(s){let r={};e:for(;!gte(s);){let i=eb(s);switch(i>>>3){case 0:break e;case 1:r.code=eb(s);break;case 2:r.msg=uF(s,eb(s));break;case 3:r.requestId=uF(s,eb(s));break;case 4:r.timestamp=bte(s,!1);break;default:mte(s,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function mte(e,t){switch(t){case 0:for(;128&Xc(e););break;case 2:u2(e,eb(e));break;case 5:u2(e,4);break;case 1:u2(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Ff(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let fte=[];function u2(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function gte(e){return e.offset>=e.limit}function a_(e,t){let s=e.bytes,r=e.offset,i=e.limit,l=r+t;if(l>s.length){let A=new Uint8Array(2*l);A.set(s),e.bytes=A}return e.offset=l,l>i&&(e.limit=l),r}function dF(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function AF(e,t){let s=a_(e,t.length);e.bytes.set(t,s)}function uF(e,t){let s=dF(e,t),r=String.fromCharCode,i=e.bytes,l="",A="";for(let u=0;u<t;u++){let p,f,b,w,_=i[u+s];128&_?(224&_)==192?u+1>=t?A+=l:(p=i[u+s+1],(192&p)!=128?A+=l:(w=(31&_)<<6|63&p,w<128?A+=l:(A+=r(w),u++))):(240&_)==224?u+2>=t?A+=l:(p=i[u+s+1],f=i[u+s+2],(49344&(p|f<<8))!=32896?A+=l:(w=(15&_)<<12|(63&p)<<6|63&f,w<2048||w>=55296&&w<=57343?A+=l:(A+=r(w),u+=2))):(248&_)==240?u+3>=t?A+=l:(p=i[u+s+1],f=i[u+s+2],b=i[u+s+3],(12632256&(p|f<<8|b<<16))!=8421504?A+=l:(w=(7&_)<<18|(63&p)<<12|(63&f)<<6|63&b,w<65536||w>1114111?A+=l:(w-=65536,A+=r(55296+(w>>10),56320+(1023&w)),u+=3))):A+=l:A+=r(_)}return A}function ju(e,t){let s=t.length,r=0;for(let A=0;A<s;A++){let u=t.charCodeAt(A);u>=55296&&u<=56319&&A+1<s&&(u=(u<<10)+t.charCodeAt(++A)-56613888),r+=u<128?1:u<2048?2:u<65536?3:4}fn(e,r);let i=a_(e,r),l=e.bytes;for(let A=0;A<s;A++){let u=t.charCodeAt(A);u>=55296&&u<=56319&&A+1<s&&(u=(u<<10)+t.charCodeAt(++A)-56613888),u<128?l[i++]=u:(u<2048?l[i++]=u>>6&31|192:(u<65536?l[i++]=u>>12&15|224:(l[i++]=u>>18&7|240,l[i++]=u>>12&63|128),l[i++]=u>>6&63|128),l[i++]=63&u|128)}}function Xc(e){return e.bytes[dF(e,1)]}function hF(e,t){let s=a_(e,1);e.bytes[s]=t}function eb(e){let t,s=0,r=0;do t=Xc(e),s<32&&(r|=(127&t)<<s),s+=7;while(128&t);return r}function fn(e,t){for(t>>>=0;t>=128;)hF(e,127&t|128),t>>>=7;hF(e,t)}function bte(e,t){let s,r=0,i=0,l=0;return s=Xc(e),r=127&s,128&s&&(s=Xc(e),r|=(127&s)<<7,128&s&&(s=Xc(e),r|=(127&s)<<14,128&s&&(s=Xc(e),r|=(127&s)<<21,128&s&&(s=Xc(e),i=127&s,128&s&&(s=Xc(e),i|=(127&s)<<7,128&s&&(s=Xc(e),i|=(127&s)<<14,128&s&&(s=Xc(e),i|=(127&s)<<21,128&s&&(s=Xc(e),l=127&s,128&s&&(s=Xc(e),l|=(127&s)<<7))))))))),{low:r|i<<28,high:i>>>4|l<<24,unsigned:t}}function Pu(e,t){let s=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,l=i===0?r===0?s<16384?s<128?1:2:s<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,A=a_(e,l),u=e.bytes;switch(l){case 10:u[A+9]=i>>>7&1;case 9:u[A+8]=l!==9?128|i:127&i;case 8:u[A+7]=l!==8?r>>>21|128:r>>>21&127;case 7:u[A+6]=l!==7?r>>>14|128:r>>>14&127;case 6:u[A+5]=l!==6?r>>>7|128:r>>>7&127;case 5:u[A+4]=l!==5?128|r:127&r;case 4:u[A+3]=l!==4?s>>>21|128:s>>>21&127;case 3:u[A+2]=l!==3?s>>>14|128:s>>>14&127;case 2:u[A+1]=l!==2?s>>>7|128:s>>>7&127;case 1:u[A]=l!==1?128|s:127&s}}const pF={},mF={},o_=4294967296,xte=o_*o_,fF=xte/2;bF(0,!0);const gF=bF(0),vte=tb(0,-2147483648,!1),wte=tb(-1,2147483647,!1);function bF(e,t){let s,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=mF[e],r)?r:(s=tb(e,0,!0),i&&(mF[e]=s),s):(i=-128<=(e|=0)&&e<128)&&(r=pF[e],r)?r:(s=tb(e,e<0?-1:0,!1),i&&(pF[e]=s),s)}function tb(e,t,s){return{low:0|e,high:0|t,unsigned:!!s}}function xF(e,t){if(isNaN(e))return gF;{if(e<=-fF)return vte;if(e+1>=fF)return wte}return e<0?gF:tb(e%o_|0,e/o_|0,t)}function vF(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}class h2 extends jr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const s=this._connectionState;this._connectionState=t,this.emit(jl.CONNECTION_STATE_CHANGE,t,s)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var s;super(),P(this,"name","AgoraRTCImageModeration"),P(this,"_connectionState",pc.CONNECTING),P(this,"_sequence",0),P(this,"_moderationStartTime",void 0),P(this,"_workerConnection",void 0),P(this,"_workerMessageLengthLimit",void 0),P(this,"_qualityRatio",void 0),P(this,"_connectInfo",void 0),P(this,"_cancelTokenSource",Ta.CancelToken.source()),P(this,"_retryConfig",void 0),P(this,"_moderationInterval",void 0),P(this,"_moderationTimer",null),P(this,"_moderationMode",1),P(this,"_quality",1),P(this,"_qualityTimer",null),P(this,"_ticket",void 0),P(this,"_moderationIntervalMinimum",void 0),P(this,"_uploadFailedNum",0),P(this,"_uploadNum",0),P(this,"_uploadTimer",null),P(this,"_extraInfo",void 0),P(this,"_vendor",""),P(this,"_encoder",new TextEncoder),P(this,"_moderationId",void 0),P(this,"inspectImage",()=>{if(this.connectionState!==pc.CONNECTED)throw new Le(W.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===pc.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ar(5,"image-moderation-"),this._workerMessageLengthLimit=G("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=G("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=t.interval)!==null&&s!==void 0?s:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=G("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Q0("worker-"+this._moderationId,pn),this.on(jl.STATE_CHANGE,(r,i)=>{N.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Nf[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,s){this.emit(jl.STATE_CHANGE,Nf.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=s,new mt((i,l)=>{this.on(jl.CONNECTION_STATE_CHANGE,(A,u)=>{A===pc.CONNECTED&&i()}),this.requestAP(t,r,s).then(A=>{this.connectWorker(A)}).catch(A=>{l(A)})})}updateConfig(t){var s;this._moderationInterval=(s=t.interval)!==null&&s!==void 0?s:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),N.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===pc.CONNECTED&&this.inspectImage()}async requestAP(t,s,r){const i=G("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),l=await function(p,f,b,w){let{appId:_,areaCode:C,cname:U,sid:B,token:j,uid:K}=f;kf++;const q="moderation_plugin",ie={service_name:q,json_body:JSON.stringify({appId:_,areaCode:C,cname:U,command:"allocateEdge",requestId:kf,seq:kf,sid:B,appToken:j,ts:Date.now(),uid:K+""})};let xe,ye,ue=p[0];return kl(async()=>{xe=Date.now();const Re=await Ul(ue,{data:ie,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-xe,Re.code!==0){const Jt=new Le(W.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Re.code,{retry:!0,responseTime:ye});throw N.error(Jt.toString()),Jt}const Ge=JSON.parse(Re.json_body);if(Ge.code!==200){const Jt=new Le(W.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ge.code,", reason: ").concat(Ge.reason),{code:Ge.code,responseTime:ye});throw N.error(Jt.toString()),Jt}if(!Ge.servers||!Array.isArray(Ge.servers)||Ge.servers.length===0){const Jt=new Le(W.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ge.code,responseTime:ye});throw N.error(Jt.toString()),Jt}if(!Ge.servers.some(Jt=>!!Jt.wss)){const Jt=new Le(W.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ge.code,responseTime:ye});throw N.error(Jt.toString()),Jt}const Ze=G("IMAGE_MODERATION_WORKER_WSS");if(Ze)return{addressList:[Ze],workerToken:Ge.workerToken,vid:Ge.vid,responseTime:ye};const _t=G("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ge.servers.map(Jt=>{let{address:bs,wss:As}=Jt;if(bs&&As)return"wss://".concat(bs.replace(/\./g,"-"),".").concat(_t,":").concat(As,"/moderation")}).filter(Jt=>!!Jt),workerToken:Ge.workerToken,vid:Ge.vid,ticket:Ge.appTicket,responseTime:ye}},(Re,Ge)=>(kt.apworkerEvent(B,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(Re.addressList),firstSuccess:Ge===0,responseTime:ye,serverIp:p[Ge%p.length]}),!1),(Re,Ge)=>(kt.apworkerEvent(B,{success:!1,sc:Re.data&&Re.data.code||200,serviceName:q,responseTime:ye,serverIp:p[Ge%p.length]}),!!(Re.code!==W.OPERATION_ABORTED&&Re.code!==W.UNEXPECTED_RESPONSE||Re.data&&Re.data.retry)&&(ue=p[(Ge+1)%p.length],!0)),w)}(i,t,s,r);this.emit(jl.STATE_CHANGE,Nf.AP_CONNECTED);const{addressList:A,ticket:u}=l;return this._ticket=u,A}async connectWorker(t){this.emit(jl.STATE_CHANGE,Nf.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(us.CONNECTED,async()=>{this.emit(jl.STATE_CHANGE,Nf.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=pc.CONNECTED}),this._workerConnection.on(us.CLOSED,()=>{this.connectionState=pc.CLOSED}),this._workerConnection.on(us.FAILED,()=>{this.connectionState=pc.CLOSED}),this._workerConnection.on(us.RECONNECTING,()=>{this.connectionState=this.connectionState===pc.CONNECTED?pc.RECONNECTING:pc.CONNECTING}),this._workerConnection.on(us.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const s=pte(new Uint8Array(t.data));G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,N.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{kt.reportApiInvoke(this._connectInfo.sid||null,{name:kr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:br.TRACER}).onError(new Le(W.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},G("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else N.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(us.WILL_RECONNECT,(t,s,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(us.REQUEST_NEW_URLS,(t,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(s)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=fo(this,jl.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,s);this._workerConnection.sendMessage(r,!0,!0)}else G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being published can be inspected")}async generateRequestData(t,s){let{appId:r,cname:i,cid:l,vid:A,sid:u,uid:p}=s;const f=Date.now(),b=await t.getCurrentFrameImage("image/jpeg",this.quality),w=await Gj(b,r,i),_=this._sequence+"-"+l+"-"+p+"-"+f+"-"+ar(12,""),C={appId:r,cid:l,cname:i,deviceId:"",elapse:h2.intToLong(Number(f-this._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:w,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.2",sequence:this._sequence,sid:u,timestamp:xF(f),uid:p,vid:A,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete C.callbackData;const U=hte(C);if(U.byteLength<this._workerMessageLengthLimit){if(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const B=function(j){for(var K=1;K<arguments.length;K++){var q=arguments[K]!=null?arguments[K]:{};K%2?vF(Object(q),!0).forEach(function(ie){P(j,ie,q[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(q)):vF(Object(q)).forEach(function(ie){Object.defineProperty(j,ie,Object.getOwnPropertyDescriptor(q,ie))})}return j}({},C);delete B.jpg,N.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(B))}return U}{const B=this.quality*this._qualityRatio;return this.quality=B,await this.generateRequestData(t,{appId:r,cname:i,cid:l,vid:A,sid:u,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ta.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=pc.CLOSED,this.emit(jl.STATE_CHANGE,Nf.CLOSED)}}function wF(e){if(gr(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Le(W.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Le(W.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const _te={name:"ImageModeration",create:function(e){let{config:t}=e;return wF(t),new h2(t)}};var _F,yF,EF,SF,CF,NF,TF,RF,IF,OF,kF,DF,BF,LF,jF,PF,UF,FF,MF,VF,QF,HF,GF,KF,WF,zF,qF,YF,XF,JF,$F,ZF,eM,tM,sM,rM,nM,iM,aM,oM,cM,lM,Et;function dM(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Jc(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?dM(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):dM(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}$n.setLogger(N);let yte=(_F=Yt(),yF=Yt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof xf))return[t];t=[t]}return t.map(s=>s?Object(s).toString():"null")}}),EF=Yt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==bf.DATA?(Array.isArray(t)||(t=[t]),t.map(s=>s.getTrackId())):[t.getChannelId()])}),SF=Yt({argsMap:(e,t,s,r)=>[typeof t=="object"?t.uid:t,s,r]}),CF=Yt({argsMap:(e,t,s)=>[t,s]}),NF=Yt({argsMap:(e,t)=>t.map(s=>{let{user:r,mediaType:i}=s;return[r==null?void 0:r.uid,i]})}),TF=Yt({argsMap:(e,t,s,r)=>[typeof t=="object"?t.uid:t,s,r]}),RF=Yt({argsMap:(e,t)=>t.map(s=>{let{user:r,mediaType:i}=s;return{uid:r==null?void 0:r.uid,mediaType:i}})}),IF=Yt(),OF=Yt(),kF=Yt(),DF=Yt(),BF=Yt(),LF=Yt(),jF=Yt(),PF=Yt(),UF=Yt(),FF=Yt(),MF=Yt(),VF=Yt(),QF=Yt(),HF=Yt(),GF=Yt(),KF=Yt(),WF=Yt({argsMap:(e,t)=>[t]}),zF=Yt(),qF=Yt(),YF=Yt(),XF=Yt(),JF=Yt(),$F=Yt(),ZF=Yt(),eM=Yt(),tM=Yt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),sM=Yt(),rM=Yt(),nM=Yt(),iM=Yt(),aM=Yt(),oM=Yt(),cM=Yt({reportResult:!0}),lM=Yt(),Et=class extends jr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let s;if(super(),P(this,"store",void 0),P(this,"_uid",void 0),P(this,"_channelName",void 0),P(this,"_uintUid",void 0),P(this,"_users",[]),P(this,"_config",void 0),P(this,"_clientId",void 0),P(this,"_appId",void 0),P(this,"_sessionId",null),P(this,"_key",void 0),P(this,"_rtmConfig",{}),P(this,"_joinInfo",void 0),P(this,"_gateway",void 0),P(this,"_statsCollector",void 0),P(this,"_configDistribute",void 0),P(this,"_leaveMutex",void 0),P(this,"_publishMutex",void 0),P(this,"_renewTokenMutex",void 0),P(this,"_subscribeMutex",void 0),P(this,"_encryptionMode","none"),P(this,"_encryptionSecret",null),P(this,"_encryptionSalt",null),P(this,"_encryptDataStream",!1),P(this,"_encryptDataStreamKey",null),P(this,"_encryptDataStreamIv",null),P(this,"_proxyServer",void 0),P(this,"_turnServer",{servers:[],mode:"auto"}),P(this,"_cloudProxyServerMode","disabled"),P(this,"_isDualStreamEnabled",!1),P(this,"_defaultStreamFallbackType",void 0),P(this,"_lowStreamParameter",void 0),P(this,"_streamFallbackTypeCacheMap",new Map),P(this,"_remoteStreamTypeCacheMap",new Map),P(this,"_axiosCancelSource",Ta.CancelToken.source()),P(this,"_audioVolumeIndicationInterval",void 0),P(this,"_networkQualityInterval",void 0),P(this,"_userOfflineTimeout",void 0),P(this,"_streamRemovedTimeout",void 0),P(this,"_rteDetailInterval",void 0),P(this,"_liveTranscodeStreamingClient",void 0),P(this,"_liveRawStreamingClient",void 0),P(this,"_channelMediaRelayClient",void 0),P(this,"_networkQualitySensitivity","normal"),P(this,"_p2pChannel",void 0),P(this,"_useLocalAccessPoint",!1),P(this,"_setLocalAPVersion",void 0),P(this,"_joinAndNotLeaveYet",!1),P(this,"_numberOfJoinCount",0),P(this,"_joinResponse",null),P(this,"_remoteDefaultVideoStreamType",void 0),P(this,"_inspect",void 0),P(this,"_moderation",void 0),P(this,"_license",void 0),P(this,"_pendingPublishedUsers",[]),P(this,"ntpAlignErrorCount",0),P(this,"remoteInboundOffset",0),P(this,"_peerConnectionState",void 0),P(this,"_pendingRtpCapabilityChange",void 0),P(this,"_fallbackServerInfo",void 0),P(this,"_dualStreamMode",void 0),P(this,"_handleLocalTrackEnable",(i,l,A)=>{this.publish(i,!1).then(l).catch(A)}),P(this,"_handleLocalTrackDisable",(i,l,A)=>{this.unpublish(i).then(l).catch(A)}),P(this,"_handleUserOnline",i=>{if(G("BLOCK_LOCAL_CLIENT")&&fp(i.uid,this.channelName))return void N.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&N.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(A=>A.uid===i.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(Es.USER_JOINED,l));else{const A=new Bu(i.uid,i.uint_id||i.uid);this._users.push(A),N.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(A.uid,{userJoinNotify:Date.now()}),this.safeEmit(Es.USER_JOINED,A)}}),P(this,"_handleUserOffline",i=>{if(G("BLOCK_LOCAL_CLIENT")&&fp(i.uid,this.channelName))return;const l=this._users.find(A=>A.uid===i.uid);l&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:iw(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),N.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Es.USER_LEAVED,l,i.reason))}),P(this,"_handleAddAudioOrVideoStream",(i,l,A,u,p,f,b,w)=>{if(G("BLOCK_LOCAL_CLIENT")&&fp(l,this.channelName))return;const _=this._users.find(B=>B.uid===l);if(!_)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(i)),this.store.subscribe(_.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(_.uid,{videoAddNotify:Date.now()});const C=i==="audio"?_.hasAudio:_.hasVideo;_._uintid||(_._uintid=f||l),i==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,i==="audio"?(_._audio_added_=!0,A!==void 0&&(_._audioSSRC=A),u!==void 0&&(_._cname=u),b&&(_._audioOrtc=b)):(_._video_added_=!0,A!==void 0&&(_._videoSSRC=A),u!==void 0&&(_._cname=u),w!==void 0&&(_._rtxSsrcId=w),b&&(_._videoOrtc=b)),(i==="audio"?_.hasAudio:_.hasVideo)&&!C&&(N.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(i)),this.safeEmit(Es.USER_PUBLISHED,_,i)),i==="video"?kt.onGatewayStream(this._sessionId,Nn.ON_ADD_VIDEO_STREAM,Dr.ON_ADD_VIDEO_STREAM,{peer:f||l,ssrc:_._videoSSRC}):kt.onGatewayStream(this._sessionId,Nn.ON_ADD_AUDIO_STREAM,Dr.ON_ADD_AUDIO_STREAM,{peer:f||l,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,i,A).then(B=>{if(B&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof _p))return this._p2pChannel.unsubscribe(_,i,!0).then(()=>this._subscribe(_,i,!0).catch(j=>{N.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,i)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,i,!0).catch(B=>{N.error("[".concat(this._clientId,"] resubscribe error"),B.toString())}));const U=this._getEncodingName(p);i==="video"&&(U==="unknown"?this.safeEmit(Es.AV1_DECODABLE_RESULT,!1):Jn()||Ki()||(U==null?void 0:U.toLocaleLowerCase())!==cp.av1||Wee().then(B=>{G("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Es.AV1_DECODABLE_RESULT,B),B||this._gateway.downgradeCodec(U)}))}),P(this,"_handleRemoveStream",i=>{if(G("BLOCK_LOCAL_CLIENT")&&fp(i.uid,this.channelName))return;const l=this._users.find(u=>u.uid===i.uid);if(!l)return void N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));N.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let A=()=>{};l.hasAudio&&l.hasVideo?A=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Es.USER_UNPUBLISHED,l,"audio"),N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Es.USER_UNPUBLISHED,l,"video")}:l.hasVideo?A=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Es.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(A=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Es.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof _p&&this._p2pChannel.unsubscribe(l).then(u=>{if(u)return this._gateway.unsubscribe(u,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),kt.onGatewayStream(this._sessionId,Nn.ON_REMOVE_STREAM,Dr.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),A()}),P(this,"_handleSetStreamLocalEnable",(i,l,A)=>{if(G("BLOCK_LOCAL_CLIENT")&&fp(l,this.channelName))return;const u=this._users.find(b=>b.uid===l);if(!u)return void N.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));N.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(A?"enabled":"disabled"," with uid ").concat(l));const p=i==="audio"?u.hasAudio:u.hasVideo;if(i==="audio"){u._trust_audio_enabled_state_=!0;const b=u._audio_enabled_;if(u._audio_enabled_=A,u._audio_enabled_===b)return;{const w=u._audio_enabled_?"enable-local-audio":"disable-local-audio";N.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(w)),this.safeEmit(Es.USER_INFO_UPDATED,l,w)}}else{u._trust_video_enabled_state_=!0;const b=u._video_enabled_;if(u._video_enabled_=A,u._video_enabled_===b)return;{const w=u._video_enabled_?"enable-local-video":"disable-local-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(w)),this.safeEmit(Es.USER_INFO_UPDATED,l,w)}}const f=i==="audio"?u.hasAudio:u.hasVideo;return p!==f?!p&&f?(N.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(i)),void this.safeEmit(Es.USER_PUBLISHED,u,i)):(i==="video"&&u._videoTrack&&u._videoTrack._destroy(),i==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,i),N.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(i)),void this.safeEmit(Es.USER_UNPUBLISHED,u,i)):void 0}),P(this,"_handleMuteStream",(i,l,A)=>{if(G("BLOCK_LOCAL_CLIENT")&&fp(i,this.channelName))return;N.debug("[".concat(this._clientId,"] receive mute message"),i,l,A);const u=this._users.find(b=>b.uid===i);if(!u)return void N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const p=l==="audio"?u.hasAudio:u.hasVideo;if(l==="audio"){u._trust_audio_mute_state_=!0;const b=u._audio_muted_;if(u._audio_muted_=A,u._audio_muted_===b)return;{const w=u._audio_muted_?"mute-audio":"unmute-audio";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(w)),this.safeEmit(Es.USER_INFO_UPDATED,i,w)}}else{u._trust_video_mute_state_=!0;const b=u._video_muted_;if(u._video_muted_=A,u._video_muted_===b)return;{const w=u._video_muted_?"mute-video":"unmute-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(w)),this.safeEmit(Es.USER_INFO_UPDATED,i,w)}}const f=l==="audio"?u.hasAudio:u.hasVideo;if(p!==f){if(!p&&f)return(l==="audio"?u._audioSSRC:u._videoSSRC)?(N.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(l)),void this.safeEmit(Es.USER_PUBLISHED,u,l)):void N.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&u._videoTrack&&!u._video_pre_subscribed&&u._videoTrack._destroy(),l==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,l),N.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(l)),this.safeEmit(Es.USER_UNPUBLISHED,u,l)}}),P(this,"_handleP2PLost",async i=>{N.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():N.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),P(this,"_handleTokenWillExpire",()=>{N.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Es.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),P(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),N.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),P(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Es.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Es.NETWORK_QUALITY,i)}),P(this,"_handleP2PAddAudioOrVideoStream",(i,l,A,u)=>{const p=this._users.find(b=>b.uid===l);if(!p)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(i)),this.store.subscribe(p.uid,i,void 0,void 0,void 0,Date.now());const f=i==="audio"?p.hasAudio:p.hasVideo;i==="audio"?p._trust_audio_stream_added_state_=!0:p._trust_video_stream_added_state_=!0,i==="audio"?(p._audio_added_=!0,A!==void 0&&(p._audioSSRC=A),u!==void 0&&(p._audioMid=u)):(p._video_added_=!0,A!==void 0&&(p._videoSSRC=A),u!==void 0&&(p._videoMid=u)),(i==="audio"?p.hasAudio:p.hasVideo)&&!f&&(N.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published ").concat(i)),this.safeEmit(Es.USER_PUBLISHED,p,i)),this._p2pChannel.hasPendingRemoteMedia(p,i)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(p.uid," after reconnect.")),this._subscribe(p,i,!0).catch(b=>{N.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._config=e,this._clientId=t||ar(5,"client-"),this.store=new class{constructor(i,l,A,u,p){cs(this,"state",void 0),this.state={codec:i,audioCodec:l,mode:A,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:op.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!p}}dispatch(i){this.state=function(l,A){switch(A.type){case is.SET_SESSION_ID:return ct(ct({},l),{},{sessionId:A.sessionId});case is.SET_P2P_ID:return ct(ct({},l),{},{p2pId:A.p2pId});case is.SET_UID:return ct(ct({},l),{},{uid:A.uid});case is.SET_INT_UID:return ct(ct({},l),{},{intUid:A.intUid});case is.SET_PUB_ID:return ct(ct({},l),{},{pubId:A.pubId});case is.KEY_METRIC_CLIENT_CREATED:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{clientCreated:A.metric})});case is.KEY_METRIC_JOIN_START:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{joinStart:A.metric})});case is.KEY_METRIC_PRELOAD_START:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{preloadStart:A.metric})});case is.KEY_METRIC_PRELOAD_END:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{preloadEnd:A.metric})});case is.KEY_METRIC_JOIN_END:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{joinEnd:A.metric})});case is.KEY_METRIC_REQUEST_AP_START:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{requestAPStart:A.metric})});case is.KEY_METRIC_REQUEST_AP_END:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{requestAPEnd:A.metric})});case is.KEY_METRIC_REQUEST_SUA_END:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{requestSUAEnd:A.metric})});case is.KEY_METRIC_BEFORE_CONNECT:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{beforeConnect:A.metric})});case is.KEY_METRIC_PEER_RECEIVER:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{peerReceiver:A.metric})});case is.KEY_METRIC_SIGNAL_CONNECTED:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{signalConnected:A.metric})});case is.KEY_METRIC_JOIN_REQ:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{joinReq:A.metric})});case is.KEY_METRIC_JOIN_REP:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{joinRep:A.metric})});case is.KEY_METRIC_JOIN_GATEWAY_START:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{joinGatewayStart:A.metric})});case is.KEY_METRIC_JOIN_GATEWAY_END:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{joinGatewayEnd:A.metric})});case is.KEY_METRIC_PEER_CONNECTION_START:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{peerConnectionStart:A.metric})});case is.KEY_METRIC_PEER_CONNECTION_END:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{peerConnectionEnd:A.metric})});case is.KEY_METRIC_DESCRIPTION_START:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{descriptionStart:A.metric})});case is.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{signalChannelOpen:A.metric})});case is.KEY_METRIC_ICE_CONNECTION_END:return ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{iceConnectionEnd:A.metric})});case is.KEY_METRIC_PUBLISH:{const u=l.keyMetrics.publish,p=u.findIndex(f=>f.trackId===A.metric.trackId);return p!==-1?(u[p]=ct(ct({},u[p]),A.metric),ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{publish:[...u]})})):ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,A.metric]})})}case is.KEY_METRIC_SUBSCRIBE:{const u=l.keyMetrics.subscribe,p=u.findIndex(f=>f.userId===A.metric.userId&&f.type===A.metric.type);return p!==-1?(u[p]=ct(ct({},u[p]),A.metric),ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{subscribe:[...u]})})):ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,A.metric]})})}case is.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const u=l.keyMetrics.firstVideoFrameDecoded,p=u.findIndex(f=>f.userId===A.metric.userId);return p!==-1?(u[p]=ct(ct({},u[p]),A.metric),ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{firstVideoFrameDecoded:[...u]})})):ct(ct({},l),{},{keyMetrics:ct(ct({},l.keyMetrics),{},{firstVideoFrameDecoded:[...l.keyMetrics.firstVideoFrameDecoded,A.metric]})})}case is.RESET_FIRST_VIDEO_FRAME_DECODED:return l.keyMetrics.firstVideoFrameDecoded=[],l;case is.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=A.mode,l;case is.RECORD_JOIN_CHANNEL_SERVICE:return typeof A.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,A.record]:(l.joinChannelServiceRecords[A.index]=ct(ct({},l.joinChannelServiceRecords[A.index]),A.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case is.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case is.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},l;case is.SET_USE_P2P:return ct(ct({},l),{},{useP2P:A.val});case is.SET_TRANSPORT_TYPE:return ct(ct({},l),{},{p2pTransport:A.val});case is.SET_RTE_URL:return ct(ct({},l),{},{rteUrl:A.rteUrl});case is.SET_RTE_SID:return ct(ct({},l),{},{rteSid:A.rteSid});default:return l}}(this.state,i)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(i){this.state.useDcSignal=i}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(i){this.state.networkQualityProbe=i}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(i){this.dispatch({type:is.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set rteUrl(i){this.dispatch({type:is.SET_RTE_URL,rteUrl:i})}get rteUrl(){return this.state.rteUrl}set rteSid(i){this.dispatch({type:is.SET_RTE_SID,rteSid:i})}get rteSid(){return this.state.rteSid}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:is.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:is.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:is.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:is.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:is.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:is.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:is.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:is.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:is.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:is.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:is.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:is.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:is.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:is.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:is.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:is.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:is.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:is.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:is.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:is.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:is.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:is.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:is.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:is.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:is.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,l){this.dispatch({type:is.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ct({userId:i},l)})}descriptionStart(){this.dispatch({type:is.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:is.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:is.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,l,A,u){this.dispatch({type:is.KEY_METRIC_PUBLISH,metric:ct(ct({trackId:i,type:l},A&&{publishStart:A}),u&&{publishEnd:u})})}subscribe(i,l,A,u,p,f,b){this.dispatch({type:is.KEY_METRIC_SUBSCRIBE,metric:ct(ct(ct(ct(ct({userId:i,type:l},A&&{subscribeStart:A}),u&&{subscribeEnd:u}),p&&{firstFrame:p}),f&&{streamAdded:f}),b&&{firstDecoded:b})})}massSubscribe(i,l,A,u){i.forEach(p=>{this.dispatch({type:is.KEY_METRIC_SUBSCRIBE,metric:ct(ct(ct({userId:p.userId,type:p.type},l&&{subscribeStart:l}),A&&{subscribeEnd:A}),u&&{firstFrame:u})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,l){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(A=>A.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:is.RECORD_JOIN_CHANNEL_SERVICE,record:ct(ct({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:is.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:is.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:is.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:is.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,G("SIGNAL_CHANNEL")===1),this._leaveMutex=new $n("client-leave",this._clientId),this._publishMutex=new $n("client-publish",this._clientId),this._renewTokenMutex=new $n("client-renewtoken",this._clientId),this._subscribeMutex=new $n("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),N.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(lc," build: ").concat(Q1,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{N1(e.clientRoleOptions),s=Object.assign({},e.clientRoleOptions)}catch(i){N.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new J0(this.store),this._statsCollector.onStatsException=(i,l,A)=>{N.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(l,", uid: ").concat(A)),i===WN.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(u=>{u instanceof _w&&G("ENABLE_ENCODE_EXCEPTION")&&u.findClosestProfile()}),this.safeEmit(Es.EXCEPTION,{code:i,msg:l,uid:A})},this._statsCollector.onUploadPublishDuration=(i,l,A,u)=>{const p=this._users.find(f=>f.uid===i);p&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(p.uid,{peerPublishDuration:A,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(p)),kt.peerPublishStatus(this._sessionId,{subscribeElapse:u,audioPublishDuration:l,videoPublishDuration:A,peer:p._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(G("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const l=this.localTracks.find(A=>A instanceof xr);l&&l._saveEncodeBitrateRatio!==1&&l.setSaveEncodeBitrateRatio(i==="h264"?G("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Mee(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||pn,httpRetryConfig:e.httpRetryConfig||pn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:s}),this._configDistribute=new Jee(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},Pl("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new _p(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,s,r,i){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],A=arguments.length>6&&arguments[6]!==void 0&&arguments[6];pr("JOIN_GATEWAY_USE_443PORT_ONLY",l),pr("JOIN_GATEWAY_USE_DUAL_DOMAIN",A);const u=this._gateway.signal.websocket;return u instanceof NN&&(u.use443PortOnly=l,u.tryDoubleDomain=A),async function(p,f,b){tw.get(p)||tw.set(p,[]),sw.get(p)||sw.set(p,f),Ed.get(p)||Ed.set(p,0);const w=tw.get(p),_=sw.get(p);if(!w||!_)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ed.get(p)===_){const K=R0();w.push(K),await K.promise}Ed.set(p,Ed.get(p)+1);for(var C=arguments.length,U=new Array(C>3?C-3:0),B=3;B<C;B++)U[B-3]=arguments[B];const j=await b(...U);return Ed.set(p,Ed.get(p)-1),Ed.get(p)===_-1&&w.length>0&&(w[0].resolve(),w.shift()),Ed.get(p)===0&&(tw.set(p,[]),sw.set(p,0),Ed.set(p,0)),j}("client.join",G("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,s,r,i)}async join(e,t,s,r,i){const l=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const A=(cw||cw||(cw=(window.location.protocol.split(":")[0]||"").toUpperCase(),cw))==="HTTPS",u=tj()?window.isSecureContext:"Browser Not Support";(!tj()&&!A||!window.isSecureContext)&&N.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let p;kt.setAppId(e);try{if(!s&&s!==null)throw new Le(W.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&di(s,"token",1,2047),di(e,"appid",1,2047),Dw(t),r&&Bw(r),i)if(typeof i=="string")di(i,"optionalInfo",1,256),p=i;else{if(typeof i!="object")throw new Le(W.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:j,enableInstantMuteRestore:K,networkQualityProbe:q}=i;j&&(Vc(j,"autoSubscribe"),N.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(j)),this.store.autoSubscribe=j),K&&(Vc(K,"enableInstantMuteRestore"),N.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(K)),this.store.enableInstantMuteRestore=K),q&&(Vc(q,"networkQualityProbe"),N.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(q)),this.store.networkQualityProbe=q)}}}catch(j){throw kt.reportApiInvoke(ap(),{name:kr.JOIN,options:[e,t,s,r],states:{isHttps:A,isSecureContext:u},tag:br.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(N.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),N.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw kt.reportApiInvoke(ap(),{name:kr.JOIN,options:[e,t,s,r],states:{isHttps:A,isSecureContext:u},tag:br.TRACER}).onError(j),j}this._gateway.state="CONNECTING",this.store.preloadStart();const f=await l2({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:s||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const b=(f==null?void 0:f.sid)||ap();N.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=b,this.store.sessionId=this._sessionId);const w=kt.reportApiInvoke(this._sessionId,{id:this._clientId,name:kr.JOIN,options:[e,t,s,r],states:{isHttps:A,isSecureContext:u},tag:br.TRACER}),_=Jc(Jc(Jc({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:p,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!f},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:G("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(_.stringUid=r,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async j=>{const K=function(ye){const ue=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Re=new Uint8Array(new ArrayBuffer(ue.length));for(let Ge=0;Ge<ue.length;Ge+=1)Re[Ge]=ue.charCodeAt(Ge);return Re}(),q=await window.crypto.subtle.importKey("spki",K,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ie=S1(j),xe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,ie);return function(ye){let ue="";for(let Re=0;Re<ye.length;Re+=1)ue+=String.fromCharCode(ye[Re]);return window.btoa(ue)}(new Uint8Array(xe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,K=G("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(_.appId+this._encryptionSecret+this._encryptionSecret):j.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,ie,xe){const ye=await window.crypto.subtle.importKey("raw",ie,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=q==="aes-128-gcm2"?128:256,Re=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:Aj,hash:"SHA-256",salt:xe},ye,ue+bZ);return new Uint8Array(Re).subarray(ue/8)}(this._encryptionMode,K,ip(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,ie,xe){const ye=await window.crypto.subtle.importKey("raw",ie,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:Aj,hash:"SHA-256",salt:xe},ye,{name:"AES-GCM",length:ue},!0,["encrypt","decrypt"])}(this._encryptionMode,K,ip(this._encryptionSalt))}else u?N.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):N.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,N.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:_.stringUid});const C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&kt.joinChannelTimeout(this._sessionId,5)},5e3);try{var U;let j;const K=_.cloudProxyServer;if(nt(U=["proxy3","proxy4","proxy5"]).call(U,K)){const ue=G("PROXY_SERVER_TYPE3");Array.isArray(ue)?_.proxyServer=ue[0]:_.proxyServer=ue}if(kt.setProxyServer(_.proxyServer),N.setProxyServer(_.proxyServer),this.store.requestAPStart(),f){if(N.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(f.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=f.intUid),j={gatewayInfo:f.ap.gatewayInfo},G("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(f.ap.proxyInfo.addresses.length===0)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ue=(await ZU(f.ap.proxyInfo,f.ap.gatewayInfo.uid)).map(Re=>({turnServerURL:Re.address,tcpport:Re.tcpport||Ei.tcpport,udpport:Re.udpport||Ei.udpport,username:Re.username||Ei.username,password:Re.password||Ei.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:ue}}oF(f,_.stringUid)}else{if(_.stringUid&&!_.uid){let ue;[ue,j]=await mt.all([N4(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,this.store).finally(()=>{this.store.requestSUAEnd()}),C4(_,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),N.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(ue)),_.uid=ue,j.gatewayInfo.uid=ue,j.gatewayInfo.res.uid=ue}else j=await C4(_,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(Ll.UPDATE_BITRATE_LIMIT,ue=>{this._p2pChannel.updateBitrateLimit(ue)}),this._configDistribute.on(Ll.UPDATE_CLIENT_ROLE_OPTIONS,ue=>{this._setClientRoleOptions(ue)}),this._configDistribute.on(Ll.UPDATE_REMOTE_VIDEO_STREAM_TYPE,ue=>{var Re;nt(Re=[0,1,4,5,6,7,8,9]).call(Re,ue)&&(this.remoteUsers.forEach(Ge=>{this._remoteStreamTypeCacheMap.get(Ge.uid)!==ue&&this.setRemoteVideoStreamType(Ge.uid,ue)}),this.setRemoteDefaultVideoStreamType(ue))}),this._configDistribute.on(Ll.FALLBACK_TO_HLS,ue=>{ue&&this.safeEmit(Es.FALLBACK_TO_HLS,T1.CONFIG)}),this._configDistribute.on(Ll.UPDATE_VOS_CONFIGURE,ue=>{this._gateway.setConfigure(ue).catch(Re=>{N.debug("[".concat(this._clientId,"] auto set vos config failed"),Re)})})},0),this._key=s||e;const q=j.gatewayInfo,ie=_.uid?_.uid:q.uid;this._joinInfo=Jc(Jc({},_),{},{cid:q.cid,uid:ie,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=ie,this.store.cid=q.cid;const xe=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));w.onSuccess(xe),this._appId=e,this._channelName=_.cname,this._uid=xe,this.store.uid=xe,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Jn()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Jn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return N.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(ye)),setTimeout(()=>{N.startUpload()},5e3),this.store.joinEnd(),B=this,nt(mp).call(mp,B)||mp.push(B),this._cloudProxyServerMode==="disabled"&&Ls().supportWebCrypto&&G("ENABLE_PRELOAD")&&A2(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&kt.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&kt.reportRteDetail(this._sessionId)},G("RTE_DETAIL_REPORT_INTERVAL")||6e4),xe}catch(j){const K=Array.isArray(j)?j[0]:j;throw K&&K.code===W.OPERATION_ABORTED?N.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),K):N.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),K),K.code!==W.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),w.onError(K),K}var B}async _joinGateway(){if(!this._joinInfo||!this._key)throw new Le(W.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!G("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===W.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Us.FALLBACK),N.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new Le(W.INVALID_OPERATION);return kt.reportApiInvoke(this._sessionId,{name:kr.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:br.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){N.info("[".concat(this._clientId,"] Leaving channel"));const e=()=>{!Jn()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Jn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(s){const r=mp.indexOf(s);r!==-1&&mp.splice(r,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return N.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Us.LEAVE),N.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof xf))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Le(W.INVALID_PARAMS,"param list is empty");const s=e;if(this._gateway.role==="audience")throw new Le(W.INVALID_OPERATION,"audience can not publish stream");for(const i of s){if(!(i instanceof xf))throw new Le(W.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new Le(W.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}N.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&s.forEach(i=>{const l=this._configDistribute.getBitrateLimit();i instanceof xr&&l&&i.setBitrateLimit(l.uplink)});try{await this._publishHighStream(s),N.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw N.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new Le(W.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));gr(e.id,"id",0,65535,!0),Vc(e.ordered,"ordered"),di(e.metadata,"metadata",0,512),N.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new Le(W.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Le(W.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new Le(W.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(i){return g4(i,!1)}(e),r=await this._p2pChannel.publishDataChannel([s]);if(r.length>0){if(typeof s._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Le(W.CREATE_DATACHANNEL_ERROR);try{await mt.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await s._waitTillOpen()}catch(i){if(i.code!==W.DISCONNECT_P2P)throw i}}return N.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw N.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Le(W.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof xf))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);N.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(an.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),N.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw N.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{s&&s()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),N.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(s=>"".concat(s.id," "))," "));const t=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(e);s&&await this._gateway.unpublishDataChannel(s),N.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(s){throw N.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{t&&t()}}async subscribe(e,t,s){if(!(e instanceof Bu)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new Le(W.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,s):this._subscribe(e,t)}async presubscribe(e,t){if(hn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Le(W.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=t===Tt.AUDIO,r=t===Tt.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:A,rtxSsrcId:u,cname:p,uint_id:f}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new Le(W.UNEXPECTED_RESPONSE,"no ssrc id");let b=this._users.find(_=>_.uid===e);b||(b=new Bu(e,f||e),b._is_pre_created=!0,this._users.push(b)),p&&(b._cname=p),b._uintid||(b._uintid=f||e),s&&(b._audioSSRC=l,b._audio_pre_subscribed=!0,A&&(b._audioOrtc=A)),r&&(b._videoSSRC=l,b._video_pre_subscribed=!0,A&&(b._videoOrtc=A),u!=null&&(b._rtxSsrcId=u)),N.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(b,t,l,u,A);const w=s?b._audioTrack:b._videoTrack;if(!w)throw new Le(W.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0),r&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0),w}catch(l){throw N.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{i()}}async _subscribeDataChannel(e,t){var s;if(gr(t,"channelId",0,65535,!0),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e))throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Le(W.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Le(W.INVALID_REMOTE_USER,"user is not published");const i=(s=e._dataChannels)===null||s===void 0?void 0:s.find(u=>u.id===t);if(!i)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const u=await this._p2pChannel.subscribeDataChannel(e,[i]);if(u&&nt(u).call(u,i.id))try{var A;if(typeof i._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Le(W.CREATE_DATACHANNEL_ERROR);const p={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(A=i.metadata)!==null&&A!==void 0?A:""};await this._gateway.subscribeDataChannel(e.uid,p,!0),await i._waitTillOpen()}catch(p){if((p==null?void 0:p.code)!==W.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),p;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{l()}}async _p2pSubscribe(e,t,s){if(hn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new Le(W.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!s&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const i=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const A=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,A,u)}catch(A){throw A}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(A=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),A)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new Le(W.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{i()}}async _subscribe(e,t,s){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(hn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){const f=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){const f=new Le(W.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(s||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const f=new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let i=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,A=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?Tt.AUDIO:Tt.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const p=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const b=t==="audio"?e._audioSSRC:e._videoSSRC;b!==void 0&&b!==i&&(i=b,l=t==="audio"?e._audioOrtc:e._videoOrtc,A=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?Tt.AUDIO:Tt.VIDEO,ssrcId:i}),Li.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,A,l);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,u,!0)}catch(w){if((w==null?void 0:w.code)!==W.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),w;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(b){throw this._p2pChannel.reportSubscribeEvent(!1,b==null?void 0:b.code,e,t),b}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(b=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),b)});const f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new Le(W.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),f}catch(f){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{p()}}async massSubscribe(e){if(SA(e,"subscribeList"),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),s=new Map,r=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(u=>{let{user:p,mediaType:f}=u;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(f)}).join("; ")));const i=(e=[...e]).map(u=>{let{user:p,mediaType:f}=u;return{user:p,mediaType:f}}),l=await this._p2pChannel.globalLock();try{var A;for(let p=e.length-1;p>=0;p--){const f=e[p],{user:b,mediaType:w}=f;if(hn(w,"mediaType",["audio","video"]),!b){const B=new Le(W.INVALID_PARAMS,"user property does not exist in subscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),B}if(!this._users.find(B=>B===b)){const B=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");N.error("[".concat(this._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),i[p].error=B,e.splice(p,1);continue}if(w==="audio"&&(!b.hasAudio||b._audioSSRC===void 0)||w==="video"&&(!b.hasVideo||b._videoSSRC===void 0)){const B=new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);N.error("[".concat(this._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(w,", remote user is not published")),i[p].error=B,e.splice(p,1);continue}const C=Gn.Video|Gn.LwoVideo,U=s.get(b);if(U){if(w==="video"?U&C:U&Gn.Audio){e.splice(p,1),N.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(w," twice"));continue}s.set(b,U|(w==="video"?C:Gn.Audio))}else s.set(b,w==="video"?C:Gn.Audio)}for(let p=e.length-1;p>=0;p--){const f=e[p],{user:b,mediaType:w}=f,_=Gn.Video|Gn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(b,w)){await this._p2pChannel.unmuteRemoteNoLock(b,w);const C=s.get(b);s.set(b,w==="video"?C^_:C^Gn.Audio),e.splice(p,1)}}this.store.massSubscribe(e.map(p=>({userId:p.user.uid,type:p.mediaType})),t);let u=Fa(A=Array.from(s.entries())).call(A,(p,f)=>{let[b,w]=f;if(w===0)return p;const _={stream_id:b.uid,stream_type:w};return w&Gn.Audio&&(_.audio_ssrc=b._audioSSRC),w&Gn.Video&&(_.video_ssrc=b._videoSSRC),p.push(_),p},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:b,mediaType:w}=f;return{user:b,mediaType:w,ssrcId:w===Tt.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:w===Tt.VIDEO?b._rtxSsrcId:void 0}}));const p=new Map;if(u=u.filter(f=>f.video_ssrc&&!this._p2pChannel.isPreSubScribe(f.video_ssrc)||f.audio_ssrc&&!this._p2pChannel.isPreSubScribe(f.audio_ssrc)||!f.video_ssrc&&!f.audio_ssrc),u.length>0){const f=await this._gateway.subscribeAll(u,!0);((f==null?void 0:f.users)||[]).forEach(b=>{let{stream_id:w,video_error_code:_,audio_error_code:C,error_code:U}=b;(_||C||U)&&p.set(w,{video_error_code:_,audio_error_code:C,error_code:U})})}if(Array.from(p.entries()).length>0){const f=[];Array.from(p.entries()).forEach(b=>{let[w,_]=b;const C=this.remoteUsers.find(U=>U.uid===w);if(C){let U;_.error_code||_.video_error_code&&_.audio_error_code?U=void 0:_.video_error_code?U=Tt.VIDEO:_.audio_error_code&&(U=Tt.AUDIO),f.push({user:C,mediaType:U})}}),f.length>0&&await this._p2pChannel.massUnsubscribeNoLock(f)}for(const f of i){const b=p.get(f.user.uid);if(b){const w=b.error_code||f.mediaType==="audio"&&b.audio_error_code||f.mediaType==="video"&&b.video_error_code;if(w){const _=bp(w);N.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(_.desc)),f.error=new Le(W.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(_.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(i.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),i.forEach(f=>{var b;kt.subscribe(this.store.sessionId,{succ:!!f.error,ec:((b=f.error)===null||b===void 0?void 0:b.code)||null,video:f.mediaType===Tt.VIDEO,audio:f.mediaType===Tt.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===Tt.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(f.user._videoSSRC)},!0)}),N.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:b,mediaType:w}=f;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(w)}).join("; "))),i}catch(p){throw await this._p2pChannel.massUnsubscribeNoLock(e),p}}finally{l(),r()}}async unsubscribe(e,t,s){if(!(e instanceof Bu)){const l=this.remoteUsers.find(A=>A.uid===e);if(!l)throw new Le(W.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,s)}else await this._unsubscribeDataChannel(e,s);if(t&&hn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&iw(this._users,e),N.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===W.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&gr(t,"id",0,65535,!0),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(l=>l.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),N.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===W.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(SA(e,"unsubscribeList"),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");N.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(s=>{let{user:r,mediaType:i}=s;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let s=e.length-1;s>=0;s--){const{user:r,mediaType:i}=e[s];if(!r){const u=new Le(W.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(hn(i,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===r)){N.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(s,1);continue}const A=Gn.Video|Gn.LwoVideo;if(t.has(r)){const u=t.get(r);let p;switch(i){case"video":p=u&A;break;case"audio":p=u&Gn.Audio;break;default:p=u&(Gn.Audio|A)}if(p){N.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(s,1);continue}i?i==="audio"?t.set(r,u|Gn.Audio):i==="video"&&t.set(r,u|A):t.set(r,u|Gn.Audio|A)}else i?i==="audio"?t.set(r,Gn.Audio):i==="video"&&t.set(r,A):t.set(r,Gn.Audio|A)}try{const s=await this._p2pChannel.massUnsubscribe(e);s&&await this._gateway.massUnsubscribe(s),N.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:l}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(l,";")}).join()))}catch(s){if(s.code===W.DISCONNECT_P2P)return void N.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw N.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(e){(function(s){if(!s)throw new Me(W.INVALID_PARAMS);Kr(s.width)||y1(s.width,"streamParameter.width"),Kr(s.height)||y1(s.height,"streamParameter.height"),Kr(s.framerate)||y1(s.framerate,"streamParameter.framerate"),Kr(s.bitrate)||gr(s.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&N.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),N.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,at.LocalVideoLowTrack)}async setDualStreamMode(e,t){hn(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(s=>{N.warning("[".concat(this._clientId,"] set dual stream mode failed"),s.toString())}):N.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case cf.AUTO_SIMULCAST_STREAM:N.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case cf.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case cf.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(s){throw N.error("[".concat(this._clientId,"] set dual stream mode error"),s.toString()),s}}async enableDualStream(){if(!Ls().supportDualStream)throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Le(W.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Le(W.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=cf.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{N.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),N.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void N.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(at.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=cf.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{N.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),N.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){hn(r,"role",["audience","host"])}(e),t&&N1(t),this.mode==="rtc"||this.mode==="p2p")throw N.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Le(W.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Le(W.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Le(W.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==s&&G("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",yi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),N.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),s==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof _p){const{video_codec:r}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var l;return nt(l=Object.keys(cp)).call(l,i)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&N1(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{N.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const s=t.timestamp-Date.now();return Math.abs(s)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(di(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Le(W.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,kt.setProxyServer(this._proxyServer),N.setProxyServer(this._proxyServer),N.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Le(W.INVALID_OPERATION,"You have already set the proxy")}if(tp(e))return this._turnServer={servers:e,mode:"original-manual"},void N.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(s=>s.urls).join(","),"."));e.forEach(s=>HL(s)),this._turnServer={servers:e,mode:"manual"},N.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"you should set license before join channel");if(di(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Le(W.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,N.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Le(W.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let s;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Le(W.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Le(W.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"Stop proxy server after leave channel");kt.setProxyServer(),N.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Le(W.INVALID_PARAMS,"accessPoints is required.");SA(e.accessPoints.serverList,"accessPoints.serverList"),di(e.accessPoints.domain,"accessPoints.domain");const t=(_,C)=>{gr(_,C,0,65535,!0)};let s=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),s=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Le(W.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");G("CLOSE_AFB_FOR_LOCAL_AP")&&(pr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),pr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,l=e.accessPoints.serverList.map(_=>r.test(_)?"".concat(_.replace(/\./g,"-"),".").concat(i):_),A=l.map(_=>"".concat(_,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,pr("WEBCS_DOMAIN",A),pr("WEBCS_DOMAIN_BACKUP_LIST",A),pr("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(SA(e.report.hostname,"report.hostname"),pr("EVENT_REPORT_DOMAIN",e.report.hostname[0]),pr("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(pr("EVENT_REPORT_DOMAIN",l[0]),pr("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let u=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),u=e.report.port),pr("STATS_COLLECTOR_PORT",u),e.report?pr("ENABLE_EVENT_REPORT",!0):pr("ENABLE_EVENT_REPORT",!1);let p="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(SA(e.log.hostname,"log.hostname"),p=e.log.hostname[0]):p=l[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),pr("LOG_UPLOAD_SERVER","".concat(p,":").concat(f));let b=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(SA(e.cds.hostname,"cds.hostname"),b=e.cds.hostname):b=l;let w=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),w=e.cds.port),pr("CDS_AP",b.map(_=>"".concat(_,":").concat(w))),e.cds?pr("ENABLE_CONFIG_DISTRIBUTE",!0):pr("ENABLE_CONFIG_DISTRIBUTE",!1),N.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(SA(e,"serverList"),di(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Le(W.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>s.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,pr("WEBCS_DOMAIN",e),pr("WEBCS_DOMAIN_BACKUP_LIST",e),pr("GATEWAY_DOMAINS",[t]),pr("EVENT_REPORT_DOMAIN",e[0]),pr("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),pr("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),N.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(hn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw N.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else N.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){hn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const s=this._users.find(r=>r.uid===e);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw N.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}N.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){hn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(s){throw N.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}N.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,s,r){(function(l){hn(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),di(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(nt(i).call(i,e)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Le(W.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Le(W.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Vc(r,"encryptDataStream"),!nt(i).call(i,e))throw new Le(W.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||N.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,s&&(this._encryptionSalt=Nu(s))}async renewToken(e){if(di(e,"token",1,2047),!this._key||!this._joinInfo)throw new Le(W.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const s=await this._renewTokenMutex.lock();try{if(G("USE_NEW_TOKEN")){N.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await Xee(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pn);N.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else N.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});N.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,N.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?N.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Es.VOLUME_INDICATOR,e)},G("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Le(W.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Le(W.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Le(W.LIVE_STREAMING_TASK_CONFLICT);const s=t?NA.TRANSCODE:NA.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(e,s)}setLiveTranscoding(e){return this._createLiveStreamingClient(NA.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(e));if(!t.length)throw new Le(W.INVALID_PARAMS,"can not find live streaming url to stop");await mt.all(t.map(s=>s&&s.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){D4(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){D4(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof _p&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&nt(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,l,A){var u;const p=Fa(u=Array.from(A)).call(u,(B,j)=>B+j,0),f={serverTs:0,seq:xZ++,length:A.length,checkSum:p},b=new Uint8Array($L(p,2)),w=new ArrayBuffer(pf),_=new DataView(w);_.setUint32(0,f.serverTs),_.setUint16(4,f.seq),_.setUint16(6,f.length),_.setUint16(8,f.checkSum);const C=16-A.length%16;A=zL(A,new Uint8Array(C));const U=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:dj,additionalData:b},l,A);return zL(new Uint8Array(w),new Uint8Array(U))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Le(W.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Mt.DATA_STREAM,{payload:Nu(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-ite},!s)}sendMetadata(e){if(!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Le(W.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Mt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Nu(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(TZ),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can not send custom report, not joined");await kt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(G("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(s=>s.uid+"");Object.keys(e).forEach(s=>{nt(t).call(t,s)||delete e[s]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){hn(t.spatialLayer,"spatialLayer",[0,1,2,3]),hn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(s){throw N.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:s}=e;if(Vc(t,"apRTM"),gr(s,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=s,N.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(N.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Sf.indexOf(e);t!==-1&&Sf.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ta.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&aF(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&kt.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&kt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new $n("client-publish",this._clientId),this._subscribeMutex=new $n("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var s;const r=e||ap();e?N.debug("[".concat(this._clientId,"] new Session ").concat(r)):N.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,kt.addSid(r);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};kt.sessionInit(this._sessionId,Jc({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Le(W.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new Le(W.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");N.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await s.next()).value;if(r){try{await this._gateway.sendExtensionMessage(an.PUBLISH,r,!0)}catch(i){throw s.throw(i),i}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await s.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(l){if(l.code!==W.DISCONNECT_P2P)throw s.throw(l),l}await s.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof xr&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(l=>{N.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,e),(s==null?void 0:s.code)===W.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Le(W.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));N.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await s.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(l){if(l.code!==W.DISCONNECT_P2P)throw s.throw(l),l}s.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===W.WS_ABORT)return;throw s}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Le(W.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Pl("LiveStreaming").create(r));var r;return s.onLiveStreamError=(i,l)=>{kt.reportApiInvoke(this._sessionId,{name:kr.ON_LIVE_STREAM_ERROR,options:[i,l],tag:br.TRACER}).onSuccess(),this.safeEmit(Es.LIVE_STREAMING_ERROR,i,l)},s.onLiveStreamWarning=(i,l)=>{kt.reportApiInvoke(this._sessionId,{name:kr.ON_LIVE_STREAM_WARNING,options:[i,l],tag:br.TRACER}).onSuccess(),this.safeEmit(Es.LIVE_STREAMING_WARNING,i,l)},s.on(EN.REQUEST_WORKER_MANAGER_LIST,(i,l,A)=>{if(!this._joinInfo)return A(new Le(W.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(u,p,f,b){const w=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(_=>p.proxyServer?"https://".concat(p.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap"));return await Hee(w,u,p,f,b)})(i,this._joinInfo,this._axiosCancelSource.token,pn).then(l).catch(A)}),s};return e===NA.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Le(W.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:s}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:s}},Pl("ChannelMediaRelay").create(e));r.on("state",i=>{i===Ha.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Es.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(Es.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,l)=>{var A;i==="resolution"&&((A=this._channelMediaRelayClient)===null||A===void 0||A.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:s,deleted:r}=e,i=[];if(t){const l=[];this._users.forEach(A=>{A._dataChannels.forEach(u=>{s.every(p=>p.uid!==A._uintid||p.stream_id!==u.id)&&l.push({uid:A._uintid,stream_id:u.id,ordered:u.ordered,max_retrans_times:u.maxRetransmits,metadata:u.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(s)&&s.length>0&&s.forEach(l=>{const{uid:A,stream_id:u,ordered:p,max_retrans_times:f,metadata:b}=l,w=this._users.find(_=>_._uintid===A);if(!w)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(N.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(A)),nt(i).call(i,w)||i.push(w),w._uintid||(w._uintid=A),w._dataChannels.findIndex(_=>_.id===l.stream_id)===-1){const _={id:u,ordered:!!p,maxRetransmits:f,metadata:b},C=function(U){return g4(U,!0)}(_);w._dataChannels.push(C),N.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),t||this.safeEmit(Es.USER_PUBLISHED,w,"datachannel",_)}this._p2pChannel.hasPendingRemoteDataChannel(w,l.stream_id)&&(N.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,l.stream_id).catch(_=>{N.error("[".concat(this._clientId,"] resubscribe datachannel error"),_.toString())}))}),t&&(this.safeEmit(Es.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(l=>{const{uid:A,stream_id:u}=l,p=this._users.find(b=>b._uintid===A);if(!p)return void N.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const f=p._dataChannels.find(b=>b.id===l.stream_id);f&&(N.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(A)),this._p2pChannel.unsubscribeDataChannel(p,[f]).then(b=>{if(p._dataChannels=p._dataChannels.filter(w=>w!==f),b)return this._gateway.unsubscribeDataChannel(b,p.uid)}),N.info("[".concat(this._clientId,"] remote user ").concat(A," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(Es.USER_UNPUBLISHED,p,"datachannel",f._config))})}_getEncodingName(e){var t,s;if(!this._joinResponse)return;const r=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!r)return;for(const u of r){var i;if(u.payloadType===e)return u==null||(i=u.rtpMap)===null||i===void 0?void 0:i.encodingName}const l=(s=this._joinResponse.ortc.rtpCapabilities.recv)===null||s===void 0?void 0:s.videoCodecs;if(l)for(const u of l){var A;if(u.payloadType===e)return u==null||(A=u.rtpMap)===null||A===void 0?void 0:A.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){const t=this._users.find(s=>s.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){N.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const s=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Es.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),s()}}else N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(nn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void N.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),s=Date.now();Object.keys(t).forEach(r=>{const{value:i,type:l,expires:A}=t[r];A&&A<=s||l||gN()||!Object.prototype.hasOwnProperty.call(uw,r)||(Lo[r]=i,or[r]=i,N.debug("Update gateway parameters from config distribute",r,i))})}catch(t){N.error("Error update config from local cache",t.message)}})()}),this._gateway.on(nn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(nn.CONNECTION_STATE_CHANGE,(e,t,s)=>{var r;if(s===Us.FALLBACK)return;const i=()=>{this.safeEmit(Es.CONNECTION_STATE_CHANGE,e,t,s)};if(kt.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:kr.CONNECTION_STATE_CHANGE,options:[e,t,s],tag:br.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:s})),N.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(A=>{A._trust_in_room_=!1,A._trust_audio_enabled_state_=!1,A._trust_video_enabled_state_=!1,A._trust_audio_mute_state_=!1,A._trust_video_mute_state_=!1,A._trust_audio_stream_added_state_=!1,A._trust_video_stream_added_state_=!1,A._is_pre_created||(A._audio_pre_subscribed||(A._audioSSRC=void 0,A._audioOrtc=void 0),A._video_pre_subscribed||(A._videoSSRC=void 0,A._videoOrtc=void 0,A._rtxSsrcId=void 0),A._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((A,u)=>{this._gateway.setStreamFallbackOption(u,A).catch(p=>{N.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),p)})}),this._remoteStreamTypeCacheMap.forEach((A,u)=>{this._gateway.setRemoteVideoStreamType(u,A).catch(p=>{N.warning("[".concat(this._clientId,"] auto set remote stream type failed"),p)})}),G("VOS_CONFIGURE")&&Array.isArray(G("VOS_CONFIGURE"))&&G("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(G("VOS_CONFIGURE")).catch(A=>{N.debug("[".concat(this._clientId,"] auto set vos config failed"),A)}),N.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{N.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(A=>{N.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(A))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(A=>{N.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),A)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(A=>!A._trust_in_room_).forEach(A=>{N.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(A.uid)),this._handleUserOffline({uid:A.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(A=>{A._trust_audio_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(A.uid)),this._handleMuteStream(A.uid,Tt.AUDIO,!1)),A._trust_video_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(A.uid)),this._handleMuteStream(A.uid,Tt.VIDEO,!1)),A._trust_audio_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(A.uid)),this._handleSetStreamLocalEnable("audio",A.uid,!0)),A._trust_video_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(A.uid)),this._handleSetStreamLocalEnable("video",A.uid,!0)),A._trust_video_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(A.uid)),this._handleResetAddStream(A,"video")),A._trust_audio_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(A.uid)),this._handleResetAddStream(A,"audio")),A._video_added_||A._audio_added_||(N.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(A.uid)),this._handleRemoveStream({uid:A.uid,uint_id:A._uintid}))}))},1e3))}i()}),this._gateway.on(nn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new Le(W.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;if(this._fallbackServerInfo)s=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,kt.reportApiInvoke(this._sessionId,{name:kr.VOS_FALLBACK_CN,options:{cur:s.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:br.TRACER}).onSuccess(),N.info("[".concat(this._clientId,"] use fallback cn server info"));else{const i=await l2(Jc(Jc({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(s=i.ap,oF(i),this._joinInfo.preload=!0):(s=await Yw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const r=[];s.gatewayInfo.gatewayAddrs.forEach(i=>{let{address:l}=i;const[A,u]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:A,port:u}):r.push({host:A,port:u})}),e(r)}catch(s){t(s)}}),this._gateway.on(nn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Es.NETWORK_QUALITY,e)}),this._gateway.on(nn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Es.STREAM_TYPE_CHANGED,e,t),kt.reportApiInvoke(this._sessionId,{name:kr.STREAM_TYPE_CHANGE,options:[e,t],tag:br.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(nn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(nn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,s)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){s(r)}}),this._gateway.on(nn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let s;this._joinResponse=e,e.attributes?s=e.attributes.userAttributes.preSubSsrcs:N.debug("no attributes in joinResponse");const r=o4(e.ortc,t,s);this._p2pChannel.connect(r)}),this._gateway.on(nn.PRE_CONNECT_PC,async(e,t,s)=>{const{candidates:r,fingerprint:i,turnServer:l}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:u,cid:p}=this._joinInfo.apResponse,f="".concat(p,"_").concat(u);if(f.length<4||f.length>256)return void N.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(f.length));await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var A;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(p,"_").concat(u),icePwd:"".concat(p,"_").concat(u)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(A=G("FINGERPRINT"))!==null&&A!==void 0?A:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(b){b.code&&b.code===W.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),s(b)}}}),this._gateway.on(nn.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(Es.FALLBACK_TO_HLS,T1.VOSERROR)}),this._gateway.on(nn.RESET_SIGNAL,()=>{this._p2pChannel instanceof _p&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(nn.DATACHANNEL_FAILBACK,()=>{kt.reportApiInvoke(this._sessionId,{name:kr.DATACHANNEL_FAILBACK,options:{},tag:br.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(as.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(as.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(as.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(as.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(as.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(as.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(as.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(as.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(as.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Tt.AUDIO,!0)),this._gateway.signal.on(as.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Tt.AUDIO,!1)),this._gateway.signal.on(as.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Tt.VIDEO,!0)),this._gateway.signal.on(as.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Tt.VIDEO,!1)),this._gateway.signal.on(as.RECEIVE_METADATA,e=>{const t=ip(e.metadata);this.safeEmit(Es.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(as.ON_DATA_STREAM,async e=>{var t;if(!e)return;let s=ip(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&nt(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<pf)throw new Le(W.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(pf));s=await async function(l,A,u){const p=u.subarray(0,pf),f=p.slice(8,pf),b=(f[0]<<8)+f[1],w=(p[6]<<8)+p[7],_=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:dj,additionalData:new Uint8Array($L(b,2))},A,u.subarray(pf));return new Uint8Array(_).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),l=this.remoteUsers.find(u=>u.uid===e.uid),A=i==null?void 0:i.audioRecv.find(u=>u.ssrc===(l==null?void 0:l._audioSSRC));r=A==null?void 0:A.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),ote(Jc(Jc({},e),{},{payload:s}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(as.ON_CRYPT_ERROR,()=>{Cu(()=>{N.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Es.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(as.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(as.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{N.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Us.TOKEN_EXPIRE),this.safeEmit(Es.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(as.ON_STREAM_FALLBACK_UPDATE,e=>{N.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Es.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(as.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===cf.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{N.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(as.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),N.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(as.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(as.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Lt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Mt.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var s,r;const l=i.some(p=>{let{stream_type:f}=p;return f===cr.Audio}),A=i.some(p=>{let{stream_type:f}=p;return f!==cr.Audio}),u=i.some(p=>{let{stream_type:f}=p;return f===cr.Screen||f===cr.ScreenLow});t.state==="offer"&&kt.publish(this._joinInfo.sid,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:W.TIMEOUT,audio:l,video:A,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:u,audioName:l?(s=i.find(p=>{let{stream_type:f}=p;return f===cr.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:A?(r=i.find(p=>{let{stream_type:f}=p;return f!==cr.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Mt.SUBSCRIBE:t&&kt.subscribe(this._joinInfo.sid,{succ:!1,ec:W.TIMEOUT,audio:t.stream_type===Tt.AUDIO,video:t.stream_type===Tt.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(as.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(as.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;G("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!fp(r.string_id||r.stream_id,this.channelName)));const t=[],s=[];for(const r of e.users){let i=this._users.find(b=>b._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Bu(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Es.PUBLISHED_USER_LIST).length===0&&(N.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Es.USER_JOINED,i)));const l=Gn.Audio&r.stream_type,A=(Gn.Video|Gn.LwoVideo)&r.stream_type,u=(65280&r.stream_type)!=0,p=l&&i.hasAudio,f=A&&i.hasVideo;A&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),l&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),l&&!p&&this.getListeners(Es.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Es.USER_PUBLISHED,i,"audio")),A&&!f&&this.getListeners(Es.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Es.USER_PUBLISHED,i,"video")),(l&&!p||A&&!f||u)&&t.push(i),A&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&s.push({user:i,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&s.push({user:i,mediaType:"audio"})}s.length>0&&(N.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(r=>{N.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Es.PUBLISHED_USER_LIST).length>0?G("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(N.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Es.PUBLISHED_USER_LIST,t)):N.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(as.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;if(this._p2pChannel instanceof _p){if(this.role==="audience"&&G("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void N.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(s=>s.toLowerCase()).filter(s=>{var r;return nt(r=Object.keys(cp)).call(r,s)}))}}),this._gateway.signal.on(Lt.VOS_FALLBACK_PROMISE,async(e,t,s)=>{if(e==="FALLBACKCN"&&G("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return s(new Le(W.UNEXPECTED_ERROR,"can not recover, no join info"));N.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const i=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;const l=await Yw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,this.store);if(G("QUALITY_FALLBACK_REHEARSAL"))return kt.reportApiInvoke(this._sessionId,{name:kr.VOS_FALLBACK_CN,options:{cur:l.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:br.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=i,void s();this._fallbackServerInfo=l,t()}catch(l){var r;const A=l==null||(r=l.data)===null||r===void 0?void 0:r.desc;G("QUALITY_FALLBACK_REHEARSAL")?(kt.reportApiInvoke(this._sessionId,{name:kr.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+A||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:br.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=i):Array.isArray(A)&&nt(A).call(A,"request downgrade fallback")&&this.safeEmit(Es.FALLBACK_TO_HLS,T1.AP_ERROR),s(l)}}else s()})}_handleP2PEvents(){this._gateway.signal.on(as.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(an.PUBLISH,(e,t,s)=>{const{uid:r}=e;e.forEach(i=>{const{kind:l,ssrcs:A,mid:u,isMuted:p}=i;this._handleP2PAddAudioOrVideoStream(l,r,A[0].ssrcId,u);const f=this._users.find(b=>b.uid===r);return f&&this.store.useP2P?this._p2pChannel.mockSubscribe(f,l,A[0].ssrcId,u).then(()=>{t()}).catch(s):t(),this._handleMuteStream(r,l,!!p)})}),this._gateway.signal.on(an.CALL,async(e,t,s)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){s(i)}}),this._gateway.signal.on(Lt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(an.UNPUBLISH,async(e,t,s)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,l=this._users.find(A=>A.uid===i);if(!l)return N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async A=>{let{stream_type:u}=A;const p=u===cr.Audio?Tt.AUDIO:Tt.VIDEO;await this._p2pChannel.unsubscribe(l,p),this._handleMuteStream(i,p,!0)}),t()}catch(A){s(A)}}}),this._gateway.signal.on(an.CONTROL,async(e,t)=>{const{action:s}=e;switch(s){case Ou.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Tt.VIDEO,!0);break;case Ou.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Tt.AUDIO,!0);break;case Ou.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Tt.VIDEO,!1);break;case Ou.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Tt.AUDIO,!1)}}),this._gateway.signal.on(an.RESTART_ICE,async(e,t,s)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==fa.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){s(r)}}),this._gateway.signal.on(an.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:s}=e;this._p2pChannel.addRemoteCandidate(t,s)}}),this._p2pChannel.on(Vt.RequestP2PRestartICE,async(e,t,s)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(an.RESTART_ICE,e,r===fa.SEND_ONLY))}catch(r){s(r)}}),this._p2pChannel.on(Vt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(an.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Vt.RequestP2PMuteLocal,async(e,t,s)=>{try{await this._gateway.sendExtensionMessage(an.CONTROL,e,!0),t()}catch(r){s(r)}}),this._p2pChannel.on(Vt.RequestP2PUnmuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===W.DISCONNECT_P2P?t():s(r)}else t()}),this._p2pChannel.on(Vt.RequestP2PMuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===W.DISCONNECT_P2P?t():s(r)}else t()}),this._p2pChannel.on(Vt.StateChange,(e,t)=>{t===tr.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Vt.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Es.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Vt.RequestMuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===W.DISCONNECT_P2P?t():s(r)}else t()}),this._p2pChannel.on(Vt.RequestUnmuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===W.DISCONNECT_P2P?t():s(r)}else t()}),this._p2pChannel.on(Vt.RequestRePublish,(e,t,s)=>{this.publish(e,!1).then(t).catch(s)}),this._p2pChannel.on(Vt.RequestRePublishDataChannel,(e,t,s)=>{mt.all(e.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==W.DISCONNECT_P2P)throw l}})).then(t).catch(s)}),this._p2pChannel.on(Vt.RequestReSubscribe,async(e,t,s)=>{try{for(const{user:r,kind:i}of e)i===Tt.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){s(r)}}),this._p2pChannel.on(Vt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Vt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Vt.MediaReconnectStart,e=>{this.safeEmit(Es.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Vt.MediaReconnectEnd,e=>{this.safeEmit(Es.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Vt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Vt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),s=await t.next();if(s.done)return;const r=s.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(A){return void t.throw(A)}const{iceParameters:l}=function(A){const u=A.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}}(i);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(Vt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Vt.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:s,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:s,rtpCapabilities:r}),A=o4(i,l);await this._p2pChannel.connect(A),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Vt.RequestUnpublishForReconnectPC,async(e,t,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):s()}),this._p2pChannel.on(Vt.P2PLost,()=>{this.safeEmit(Es.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Vt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Vt.ConnectionTypeChange,e=>{this.safeEmit(Es.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(Vt.FirstVideoBufferReady,(e,t)=>{this.safeEmit(Es.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(Vt.FirstVideoPreRender,(e,t)=>{this.safeEmit(Es.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(Vt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Vt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Vt.AudioMetadata,e=>{this.safeEmit(Es.AUDIO_METADATA,e)}),this._p2pChannel.on(Vt.AudioPts,e=>{this.safeEmit(Es.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(t={config:e},Pl("ContentInspect").create(t));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:r,cname:i,sid:l,token:A,uid:u,cid:p,vid:f}=this._joinInfo;await s.init({appId:r,areaCode:"",cname:i,sid:l,token:A,uid:u,cid:p,vid:f?Number(f):0},pn)}catch(s){throw Array.isArray(s)?s[0]:s}var t}handleVideoInspectEvents(e){e.on(ei.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(Es.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,s),s===Wc.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Es.CONTENT_INSPECT_ERROR,new Le(W.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(ei.INSPECT_RESULT,(t,s)=>{var r;if((s==null?void 0:s.code)===W.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return N.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Es.CONTENT_INSPECT_RESULT,t,s)}),e.on(ei.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Vc(e,"enabled"),e){if(!t)throw new Le(W.INVALID_PARAMS,"config is required");if(wF(t),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(s={config:t},Pl("ImageModeration").create(s));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:l,sid:A,token:u,uid:p,cid:f,vid:b}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:l,sid:A,token:u,uid:p,cid:f,vid:b?Number(b):0},pn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var s;if(!this._moderation)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(jl.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(Es.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,s),t===pc.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Le(W.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(jl.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){hn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Le(W.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,N.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return N.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Vc(e,"enabled"),pr("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ft(Et.prototype,"leave",[_F],Object.getOwnPropertyDescriptor(Et.prototype,"leave"),Et.prototype),ft(Et.prototype,"publish",[yF],Object.getOwnPropertyDescriptor(Et.prototype,"publish"),Et.prototype),ft(Et.prototype,"unpublish",[EF],Object.getOwnPropertyDescriptor(Et.prototype,"unpublish"),Et.prototype),ft(Et.prototype,"subscribe",[SF],Object.getOwnPropertyDescriptor(Et.prototype,"subscribe"),Et.prototype),ft(Et.prototype,"presubscribe",[CF],Object.getOwnPropertyDescriptor(Et.prototype,"presubscribe"),Et.prototype),ft(Et.prototype,"massSubscribe",[NF],Object.getOwnPropertyDescriptor(Et.prototype,"massSubscribe"),Et.prototype),ft(Et.prototype,"unsubscribe",[TF],Object.getOwnPropertyDescriptor(Et.prototype,"unsubscribe"),Et.prototype),ft(Et.prototype,"massUnsubscribe",[RF],Object.getOwnPropertyDescriptor(Et.prototype,"massUnsubscribe"),Et.prototype),ft(Et.prototype,"setLowStreamParameter",[IF],Object.getOwnPropertyDescriptor(Et.prototype,"setLowStreamParameter"),Et.prototype),ft(Et.prototype,"setDualStreamMode",[OF],Object.getOwnPropertyDescriptor(Et.prototype,"setDualStreamMode"),Et.prototype),ft(Et.prototype,"enableDualStream",[kF],Object.getOwnPropertyDescriptor(Et.prototype,"enableDualStream"),Et.prototype),ft(Et.prototype,"disableDualStream",[DF],Object.getOwnPropertyDescriptor(Et.prototype,"disableDualStream"),Et.prototype),ft(Et.prototype,"setClientRole",[BF],Object.getOwnPropertyDescriptor(Et.prototype,"setClientRole"),Et.prototype),ft(Et.prototype,"_setClientRoleOptions",[LF],Object.getOwnPropertyDescriptor(Et.prototype,"_setClientRoleOptions"),Et.prototype),ft(Et.prototype,"setProxyServer",[jF],Object.getOwnPropertyDescriptor(Et.prototype,"setProxyServer"),Et.prototype),ft(Et.prototype,"setTurnServer",[PF],Object.getOwnPropertyDescriptor(Et.prototype,"setTurnServer"),Et.prototype),ft(Et.prototype,"setLicense",[UF],Object.getOwnPropertyDescriptor(Et.prototype,"setLicense"),Et.prototype),ft(Et.prototype,"startProxyServer",[FF],Object.getOwnPropertyDescriptor(Et.prototype,"startProxyServer"),Et.prototype),ft(Et.prototype,"stopProxyServer",[MF],Object.getOwnPropertyDescriptor(Et.prototype,"stopProxyServer"),Et.prototype),ft(Et.prototype,"setLocalAccessPointsV2",[VF],Object.getOwnPropertyDescriptor(Et.prototype,"setLocalAccessPointsV2"),Et.prototype),ft(Et.prototype,"setLocalAccessPoints",[QF],Object.getOwnPropertyDescriptor(Et.prototype,"setLocalAccessPoints"),Et.prototype),ft(Et.prototype,"setRemoteDefaultVideoStreamType",[HF],Object.getOwnPropertyDescriptor(Et.prototype,"setRemoteDefaultVideoStreamType"),Et.prototype),ft(Et.prototype,"setRemoteVideoStreamType",[GF],Object.getOwnPropertyDescriptor(Et.prototype,"setRemoteVideoStreamType"),Et.prototype),ft(Et.prototype,"setStreamFallbackOption",[KF],Object.getOwnPropertyDescriptor(Et.prototype,"setStreamFallbackOption"),Et.prototype),ft(Et.prototype,"setEncryptionConfig",[WF],Object.getOwnPropertyDescriptor(Et.prototype,"setEncryptionConfig"),Et.prototype),ft(Et.prototype,"renewToken",[zF],Object.getOwnPropertyDescriptor(Et.prototype,"renewToken"),Et.prototype),ft(Et.prototype,"enableAudioVolumeIndicator",[qF],Object.getOwnPropertyDescriptor(Et.prototype,"enableAudioVolumeIndicator"),Et.prototype),ft(Et.prototype,"startLiveStreaming",[YF],Object.getOwnPropertyDescriptor(Et.prototype,"startLiveStreaming"),Et.prototype),ft(Et.prototype,"setLiveTranscoding",[XF],Object.getOwnPropertyDescriptor(Et.prototype,"setLiveTranscoding"),Et.prototype),ft(Et.prototype,"stopLiveStreaming",[JF],Object.getOwnPropertyDescriptor(Et.prototype,"stopLiveStreaming"),Et.prototype),ft(Et.prototype,"startChannelMediaRelay",[$F],Object.getOwnPropertyDescriptor(Et.prototype,"startChannelMediaRelay"),Et.prototype),ft(Et.prototype,"updateChannelMediaRelay",[ZF],Object.getOwnPropertyDescriptor(Et.prototype,"updateChannelMediaRelay"),Et.prototype),ft(Et.prototype,"stopChannelMediaRelay",[eM],Object.getOwnPropertyDescriptor(Et.prototype,"stopChannelMediaRelay"),Et.prototype),ft(Et.prototype,"sendCustomReportMessage",[tM],Object.getOwnPropertyDescriptor(Et.prototype,"sendCustomReportMessage"),Et.prototype),ft(Et.prototype,"pickSVCLayer",[sM],Object.getOwnPropertyDescriptor(Et.prototype,"pickSVCLayer"),Et.prototype),ft(Et.prototype,"setRTMConfig",[rM],Object.getOwnPropertyDescriptor(Et.prototype,"setRTMConfig"),Et.prototype),ft(Et.prototype,"enableContentInspect",[nM],Object.getOwnPropertyDescriptor(Et.prototype,"enableContentInspect"),Et.prototype),ft(Et.prototype,"disableContentInspect",[iM],Object.getOwnPropertyDescriptor(Et.prototype,"disableContentInspect"),Et.prototype),ft(Et.prototype,"setImageModeration",[aM],Object.getOwnPropertyDescriptor(Et.prototype,"setImageModeration"),Et.prototype),ft(Et.prototype,"setP2PTransport",[oM],Object.getOwnPropertyDescriptor(Et.prototype,"setP2PTransport"),Et.prototype),ft(Et.prototype,"getJoinChannelServiceRecords",[cM],Object.getOwnPropertyDescriptor(Et.prototype,"getJoinChannelServiceRecords"),Et.prototype),ft(Et.prototype,"setPublishAudioFilterEnabled",[lM],Object.getOwnPropertyDescriptor(Et.prototype,"setPublishAudioFilterEnabled"),Et.prototype),Et);function AM(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=ar(5,"client-"),r=kt.reportApiInvoke(null,{id:s,name:kr.CREATE_CLIENT,options:[t],tag:br.TRACER});try{(function(i){hn(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),hn(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&hn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&di(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&HL(i.turnServer),i.httpRetryConfig!==void 0&&QL(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&QL(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(RL(16,0,!0)||w1(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",N.debug("browser not support vp9, force use vp8")),pr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new yte(Jc(Jc({forceWaitGatewayResponse:!0},t),{},{role:nt(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),s)}function Ete(){let e=!1;const t=zs();return(t.name===Ys.CHROME&&Number(t.version)>=58&&(Il.engine.name!=="WebKit"||function(){const s=zs();if(nw()){if(s.os===Vn.MAC_OS)return!0;if(s.os===Vn.IOS){const r=Il.os.version&&Il.os.version.split(".");if(r&&Number(r[0])===14&&r[1]&&Number(r[1])>=3||r&&Number(r[0])>14)return!0}}return!1}())||t.name===Ys.FIREFOX&&Number(t.version)>=56||t.name===Ys.OPERA&&Number(t.version)>=45||t.name===Ys.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(Ki()||Mc())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||kL()||zs().name===Ys.QQ)&&(e=!0),e}class sb{constructor(t,s){P(this,"id",0),P(this,"element",void 0),P(this,"peerPair",void 0),P(this,"context",void 0),P(this,"audioPlayerElement",void 0),P(this,"audioTrack",void 0),sb.count+=1,this.id=sb.count,this.element=t,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const s=document.createElement("audio");s.srcObject=new MediaStream([t.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const l=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(l),r.iceGatheringState==="complete"?r.localDescription:new mt(A=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&A(r.localDescription)}})},s=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await s(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await s(this.peerPair[0],i)}catch(r){throw new Le(W.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let s;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(s)}catch(i){throw new Le(W.LOCAL_AEC_ERROR,i.toString()).print()}if(!s)throw new Le(W.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=s.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,s=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){N.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var uM,c_;P(sb,"count",0);const Ste=window.AudioContext||window.webkitAudioContext,Cte=new(uM=Yt({report:kt}),ft((c_=class{constructor(){P(this,"units",[]),P(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return N.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ste);let t=this.units.find(s=>s&&s.getElement()===e);return t||(t=new sb(e,this.context),this.units.push(t)),t.startEchoCancellation(),N.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return zs().name!==Ys.SAFARI}}).prototype,"processExternalMediaAEC",[uM],Object.getOwnPropertyDescriptor(c_.prototype,"processExternalMediaAEC"),c_.prototype),c_);function hM(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function pM(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?hM(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):hM(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const p2=window||document;function mM(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!p2)return;const s=_n._cspEventHandlerPointer;if(s&&t)return void console.error(s,t);const r=i=>{if(!(i&&i.blockedURI&&(_n.onSecurityPolicyViolation||_n.getListeners(Rd.SECURITY_POLICY_VIOLATION).length>0)))return;const l=i.blockedURI;G("CSP_DETECTED_HOSTNAME_LIST").some(A=>nt(l).call(l,A))&&(_n.onSecurityPolicyViolation&&typeof _n.onSecurityPolicyViolation=="function"&&_n.onSecurityPolicyViolation(i),_n.getListeners(Rd.SECURITY_POLICY_VIOLATION).length>0&&_n.safeEmit(Rd.SECURITY_POLICY_VIOLATION,i))};s&&p2.removeEventListener("securitypolicyviolation",s),(t||e&&typeof e=="function"||_n.getListeners(Rd.SECURITY_POLICY_VIOLATION).length>0)&&p2.addEventListener("securitypolicyviolation",r),_n._cspEventHandlerPointer=r}var Nte=k,Tte=NC,fM=RegExp.prototype,Rte=function(e){return e===fM||Nte(fM,e)?Tte(e):e.flags},sa=h(Rte);function Mf(e){let t=e.length;for(;--t>=0;)e[t]=0}const m2=256,gM=286,rb=30,nb=15,f2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),l_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ite=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bM=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),OA=new Array(576);Mf(OA);const ib=new Array(60);Mf(ib);const ab=new Array(512);Mf(ab);const ob=new Array(256);Mf(ob);const g2=new Array(29);Mf(g2);const d_=new Array(rb);function b2(e,t,s,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let xM,vM,wM;function x2(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Mf(d_);const _M=e=>e<256?ab[e]:ab[256+(e>>>7)],cb=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ho=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,cb(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},Ld=(e,t,s)=>{Ho(e,s[2*t],s[2*t+1])},yM=(e,t)=>{let s=0;do s|=1&e,e>>>=1,s<<=1;while(--t>0);return s>>>1},EM=(e,t,s)=>{const r=new Array(16);let i,l,A=0;for(i=1;i<=nb;i++)A=A+s[i-1]<<1,r[i]=A;for(l=0;l<=t;l++){let u=e[2*l+1];u!==0&&(e[2*l]=yM(r[u]++,u))}},SM=e=>{let t;for(t=0;t<gM;t++)e.dyn_ltree[2*t]=0;for(t=0;t<rb;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},CM=e=>{e.bi_valid>8?cb(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},NM=(e,t,s,r)=>{const i=2*t,l=2*s;return e[i]<e[l]||e[i]===e[l]&&r[t]<=r[s]},v2=(e,t,s)=>{const r=e.heap[s];let i=s<<1;for(;i<=e.heap_len&&(i<e.heap_len&&NM(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!NM(t,r,e.heap[i],e.depth));)e.heap[s]=e.heap[i],s=i,i<<=1;e.heap[s]=r},TM=(e,t,s)=>{let r,i,l,A,u=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+u++],r+=(255&e.pending_buf[e.sym_buf+u++])<<8,i=e.pending_buf[e.sym_buf+u++],r===0?Ld(e,i,t):(l=ob[i],Ld(e,l+m2+1,t),A=f2[l],A!==0&&(i-=g2[l],Ho(e,i,A)),r--,l=_M(r),Ld(e,l,s),A=l_[l],A!==0&&(r-=d_[l],Ho(e,r,A)));while(u<e.sym_next);Ld(e,256,t)},w2=(e,t)=>{const s=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,l=t.stat_desc.elems;let A,u,p,f=-1;for(e.heap_len=0,e.heap_max=573,A=0;A<l;A++)s[2*A]!==0?(e.heap[++e.heap_len]=f=A,e.depth[A]=0):s[2*A+1]=0;for(;e.heap_len<2;)p=e.heap[++e.heap_len]=f<2?++f:0,s[2*p]=1,e.depth[p]=0,e.opt_len--,i&&(e.static_len-=r[2*p+1]);for(t.max_code=f,A=e.heap_len>>1;A>=1;A--)v2(e,s,A);p=l;do A=e.heap[1],e.heap[1]=e.heap[e.heap_len--],v2(e,s,1),u=e.heap[1],e.heap[--e.heap_max]=A,e.heap[--e.heap_max]=u,s[2*p]=s[2*A]+s[2*u],e.depth[p]=(e.depth[A]>=e.depth[u]?e.depth[A]:e.depth[u])+1,s[2*A+1]=s[2*u+1]=p,e.heap[1]=p++,v2(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((b,w)=>{const _=w.dyn_tree,C=w.max_code,U=w.stat_desc.static_tree,B=w.stat_desc.has_stree,j=w.stat_desc.extra_bits,K=w.stat_desc.extra_base,q=w.stat_desc.max_length;let ie,xe,ye,ue,Re,Ge,Ze=0;for(ue=0;ue<=nb;ue++)b.bl_count[ue]=0;for(_[2*b.heap[b.heap_max]+1]=0,ie=b.heap_max+1;ie<573;ie++)xe=b.heap[ie],ue=_[2*_[2*xe+1]+1]+1,ue>q&&(ue=q,Ze++),_[2*xe+1]=ue,xe>C||(b.bl_count[ue]++,Re=0,xe>=K&&(Re=j[xe-K]),Ge=_[2*xe],b.opt_len+=Ge*(ue+Re),B&&(b.static_len+=Ge*(U[2*xe+1]+Re)));if(Ze!==0){do{for(ue=q-1;b.bl_count[ue]===0;)ue--;b.bl_count[ue]--,b.bl_count[ue+1]+=2,b.bl_count[q]--,Ze-=2}while(Ze>0);for(ue=q;ue!==0;ue--)for(xe=b.bl_count[ue];xe!==0;)ye=b.heap[--ie],ye>C||(_[2*ye+1]!==ue&&(b.opt_len+=(ue-_[2*ye+1])*_[2*ye],_[2*ye+1]=ue),xe--)}})(e,t),EM(s,f,e.bl_count)},RM=(e,t,s)=>{let r,i,l=-1,A=t[1],u=0,p=7,f=4;for(A===0&&(p=138,f=3),t[2*(s+1)+1]=65535,r=0;r<=s;r++)i=A,A=t[2*(r+1)+1],++u<p&&i===A||(u<f?e.bl_tree[2*i]+=u:i!==0?(i!==l&&e.bl_tree[2*i]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,l=i,A===0?(p=138,f=3):i===A?(p=6,f=3):(p=7,f=4))},IM=(e,t,s)=>{let r,i,l=-1,A=t[1],u=0,p=7,f=4;for(A===0&&(p=138,f=3),r=0;r<=s;r++)if(i=A,A=t[2*(r+1)+1],!(++u<p&&i===A)){if(u<f)do Ld(e,i,e.bl_tree);while(--u!=0);else i!==0?(i!==l&&(Ld(e,i,e.bl_tree),u--),Ld(e,16,e.bl_tree),Ho(e,u-3,2)):u<=10?(Ld(e,17,e.bl_tree),Ho(e,u-3,3)):(Ld(e,18,e.bl_tree),Ho(e,u-11,7));u=0,l=i,A===0?(p=138,f=3):i===A?(p=6,f=3):(p=7,f=4)}};let OM=!1;const kM=(e,t,s,r)=>{Ho(e,0+(r?1:0),3),CM(e),cb(e,s),cb(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var Ote=e=>{OM||((()=>{let t,s,r,i,l;const A=new Array(16);for(r=0,i=0;i<28;i++)for(g2[i]=r,t=0;t<1<<f2[i];t++)ob[r++]=i;for(ob[r-1]=i,l=0,i=0;i<16;i++)for(d_[i]=l,t=0;t<1<<l_[i];t++)ab[l++]=i;for(l>>=7;i<rb;i++)for(d_[i]=l<<7,t=0;t<1<<l_[i]-7;t++)ab[256+l++]=i;for(s=0;s<=nb;s++)A[s]=0;for(t=0;t<=143;)OA[2*t+1]=8,t++,A[8]++;for(;t<=255;)OA[2*t+1]=9,t++,A[9]++;for(;t<=279;)OA[2*t+1]=7,t++,A[7]++;for(;t<=287;)OA[2*t+1]=8,t++,A[8]++;for(EM(OA,287,A),t=0;t<rb;t++)ib[2*t+1]=5,ib[2*t]=yM(t,5);xM=new b2(OA,f2,257,gM,nb),vM=new b2(ib,l_,0,rb,nb),wM=new b2(new Array(0),Ite,0,19,7)})(),OM=!0),e.l_desc=new x2(e.dyn_ltree,xM),e.d_desc=new x2(e.dyn_dtree,vM),e.bl_desc=new x2(e.bl_tree,wM),e.bi_buf=0,e.bi_valid=0,SM(e)},kte=(e,t,s,r)=>{let i,l,A=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(u=>{let p,f=4093624447;for(p=0;p<=31;p++,f>>>=1)if(1&f&&u.dyn_ltree[2*p]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(p=32;p<m2;p++)if(u.dyn_ltree[2*p]!==0)return 1;return 0})(e)),w2(e,e.l_desc),w2(e,e.d_desc),A=(u=>{let p;for(RM(u,u.dyn_ltree,u.l_desc.max_code),RM(u,u.dyn_dtree,u.d_desc.max_code),w2(u,u.bl_desc),p=18;p>=3&&u.bl_tree[2*bM[p]+1]===0;p--);return u.opt_len+=3*(p+1)+5+5+4,p})(e),i=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=i&&(i=l)):i=l=s+5,s+4<=i&&t!==-1?kM(e,t,s,r):e.strategy===4||l===i?(Ho(e,2+(r?1:0),3),TM(e,OA,ib)):(Ho(e,4+(r?1:0),3),((u,p,f,b)=>{let w;for(Ho(u,p-257,5),Ho(u,f-1,5),Ho(u,b-4,4),w=0;w<b;w++)Ho(u,u.bl_tree[2*bM[w]+1],3);IM(u,u.dyn_ltree,p-1),IM(u,u.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,A+1),TM(e,e.dyn_ltree,e.dyn_dtree)),SM(e),r&&CM(e)},Dte=(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,t===0?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(ob[s]+m2+1)]++,e.dyn_dtree[2*_M(t)]++),e.sym_next===e.sym_end),Bte=e=>{Ho(e,2,3),Ld(e,256,OA),(t=>{t.bi_valid===16?(cb(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Lte={_tr_init:Ote,_tr_stored_block:kM,_tr_flush_block:kte,_tr_tally:Dte,_tr_align:Bte},lb=(e,t,s,r)=>{let i=65535&e|0,l=e>>>16&65535|0,A=0;for(;s!==0;){A=s>2e3?2e3:s,s-=A;do i=i+t[r++]|0,l=l+i|0;while(--A);i%=65521,l%=65521}return i|l<<16|0};const jte=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var ga=(e,t,s,r)=>{const i=jte,l=r+s;e^=-1;for(let A=r;A<l;A++)e=e>>>8^i[255&(e^t[A])];return-1^e},Sp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},A_={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Pte,_tr_stored_block:_2,_tr_flush_block:Ute,_tr_tally:Uu,_tr_align:Fte}=Lte,{Z_NO_FLUSH:Fu,Z_PARTIAL_FLUSH:Mte,Z_FULL_FLUSH:Vte,Z_FINISH:$c,Z_BLOCK:DM,Z_OK:Ba,Z_STREAM_END:BM,Z_STREAM_ERROR:jd,Z_DATA_ERROR:Qte,Z_BUF_ERROR:y2,Z_DEFAULT_COMPRESSION:Hte,Z_FILTERED:Gte,Z_HUFFMAN_ONLY:u_,Z_RLE:Kte,Z_FIXED:Wte,Z_DEFAULT_STRATEGY:zte,Z_UNKNOWN:qte,Z_DEFLATED:h_}=A_,E2=286,Yte=30,Xte=19,Jte=2*E2+1,$te=15,Cp=258,Pd=262,Vf=42,Np=113,db=666,Tp=(e,t)=>(e.msg=Sp[t],t),LM=e=>2*e-(e>4?9:0),Mu=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Zte=e=>{let t,s,r,i=e.w_size;t=e.hash_size,r=t;do s=e.head[--r],e.head[r]=s>=i?s-i:0;while(--t);t=i,r=t;do s=e.prev[--r],e.prev[r]=s>=i?s-i:0;while(--t)};let Vu=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const mc=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),s!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,t.pending===0&&(t.pending_out=0))},fc=(e,t)=>{Ute(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,mc(e.strm)},en=(e,t)=>{e.pending_buf[e.pending++]=t},Ab=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},S2=(e,t,s,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),s),e.state.wrap===1?e.adler=lb(e.adler,t,i,s):e.state.wrap===2&&(e.adler=ga(e.adler,t,i,s)),e.next_in+=i,e.total_in+=i,i)},jM=(e,t)=>{let s,r,i=e.max_chain_length,l=e.strstart,A=e.prev_length,u=e.nice_match;const p=e.strstart>e.w_size-Pd?e.strstart-(e.w_size-Pd):0,f=e.window,b=e.w_mask,w=e.prev,_=e.strstart+Cp;let C=f[l+A-1],U=f[l+A];e.prev_length>=e.good_match&&(i>>=2),u>e.lookahead&&(u=e.lookahead);do if(s=t,f[s+A]===U&&f[s+A-1]===C&&f[s]===f[l]&&f[++s]===f[l+1]){l+=2,s++;do;while(f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&l<_);if(r=Cp-(_-l),l=_-Cp,r>A){if(e.match_start=t,A=r,r>=u)break;C=f[l+A-1],U=f[l+A]}}while((t=w[t&b])>p&&--i!=0);return A<=e.lookahead?A:e.lookahead},Qf=e=>{const t=e.w_size;let s,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Pd)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Zte(e),r+=t),e.strm.avail_in===0)break;if(s=S2(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=s,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Vu(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Vu(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Pd&&e.strm.avail_in!==0)},PM=(e,t)=>{let s,r,i,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,A=0,u=e.strm.avail_in;do{if(s=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,s>r+e.strm.avail_in&&(s=r+e.strm.avail_in),s>i&&(s=i),s<l&&(s===0&&t!==$c||t===Fu||s!==r+e.strm.avail_in)))break;A=t===$c&&s===r+e.strm.avail_in?1:0,_2(e,0,0,A),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,mc(e.strm),r&&(r>s&&(r=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,s-=r),s&&(S2(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(A===0);return u-=e.strm.avail_in,u&&(u>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=u&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-u,e.strm.next_in),e.strstart),e.strstart+=u,e.insert+=u>e.w_size-e.insert?e.w_size-e.insert:u),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),A?4:t!==Fu&&t!==$c&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(S2(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,l=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=l||(r||t===$c)&&t!==Fu&&e.strm.avail_in===0&&r<=i)&&(s=r>i?i:r,A=t===$c&&e.strm.avail_in===0&&s===r?1:0,_2(e,e.block_start,s,A),e.block_start+=s,mc(e.strm)),A?3:1)},C2=(e,t)=>{let s,r;for(;;){if(e.lookahead<Pd){if(Qf(e),e.lookahead<Pd&&t===Fu)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),s!==0&&e.strstart-s<=e.w_size-Pd&&(e.match_length=jM(e,s)),e.match_length>=3)if(r=Uu(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+1]);else r=Uu(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(fc(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===$c?(fc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(fc(e,!1),e.strm.avail_out===0)?1:2},Hf=(e,t)=>{let s,r,i;for(;;){if(e.lookahead<Pd){if(Qf(e),e.lookahead<Pd&&t===Fu)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,s!==0&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Pd&&(e.match_length=jM(e,s),e.match_length<=5&&(e.strategy===Gte||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Uu(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(fc(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Uu(e,0,e.window[e.strstart-1]),r&&fc(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Uu(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===$c?(fc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(fc(e,!1),e.strm.avail_out===0)?1:2};function Ud(e,t,s,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=r,this.func=i}const ub=[new Ud(0,0,0,0,PM),new Ud(4,4,8,4,C2),new Ud(4,5,16,8,C2),new Ud(4,6,32,32,C2),new Ud(4,4,16,16,Hf),new Ud(8,16,32,32,Hf),new Ud(8,16,128,128,Hf),new Ud(8,32,128,256,Hf),new Ud(32,128,258,1024,Hf),new Ud(32,258,258,4096,Hf)];function ese(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=h_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Jte),this.dyn_dtree=new Uint16Array(2*(2*Yte+1)),this.bl_tree=new Uint16Array(2*(2*Xte+1)),Mu(this.dyn_ltree),Mu(this.dyn_dtree),Mu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array($te+1),this.heap=new Uint16Array(2*E2+1),Mu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*E2+1),Mu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const hb=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Vf&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Np&&t.status!==db?1:0},UM=e=>{if(hb(e))return Tp(e,jd);e.total_in=e.total_out=0,e.data_type=qte;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Vf:Np,e.adler=t.wrap===2?0:1,t.last_flush=-2,Pte(t),Ba},FM=e=>{const t=UM(e);return t===Ba&&(s=>{s.window_size=2*s.w_size,Mu(s.head),s.max_lazy_match=ub[s.level].max_lazy,s.good_match=ub[s.level].good_length,s.nice_match=ub[s.level].nice_length,s.max_chain_length=ub[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(e.state),t},MM=(e,t,s,r,i,l)=>{if(!e)return jd;let A=1;if(t===Hte&&(t=6),r<0?(A=0,r=-r):r>15&&(A=2,r-=16),i<1||i>9||s!==h_||r<8||r>15||t<0||t>9||l<0||l>Wte||r===8&&A!==1)return Tp(e,jd);r===8&&(r=9);const u=new ese;return e.state=u,u.strm=e,u.status=Vf,u.wrap=A,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=i+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<i+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=t,u.strategy=l,u.method=s,FM(e)};var tse=(e,t)=>{if(hb(e)||t>DM||t<0)return e?Tp(e,jd):jd;const s=e.state;if(!e.output||e.avail_in!==0&&!e.input||s.status===db&&t!==$c)return Tp(e,e.avail_out===0?y2:jd);const r=s.last_flush;if(s.last_flush=t,s.pending!==0){if(mc(e),e.avail_out===0)return s.last_flush=-1,Ba}else if(e.avail_in===0&&LM(t)<=LM(r)&&t!==$c)return Tp(e,y2);if(s.status===db&&e.avail_in!==0)return Tp(e,y2);if(s.status===Vf&&s.wrap===0&&(s.status=Np),s.status===Vf){let i=h_+(s.w_bits-8<<4)<<8,l=-1;if(l=s.strategy>=u_||s.level<2?0:s.level<6?1:s.level===6?2:3,i|=l<<6,s.strstart!==0&&(i|=32),i+=31-i%31,Ab(s,i),s.strstart!==0&&(Ab(s,e.adler>>>16),Ab(s,65535&e.adler)),e.adler=1,s.status=Np,mc(e),s.pending!==0)return s.last_flush=-1,Ba}if(s.status===57){if(e.adler=0,en(s,31),en(s,139),en(s,8),s.gzhead)en(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),en(s,255&s.gzhead.time),en(s,s.gzhead.time>>8&255),en(s,s.gzhead.time>>16&255),en(s,s.gzhead.time>>24&255),en(s,s.level===9?2:s.strategy>=u_||s.level<2?4:0),en(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(en(s,255&s.gzhead.extra.length),en(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=ga(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(en(s,0),en(s,0),en(s,0),en(s,0),en(s,0),en(s,s.level===9?2:s.strategy>=u_||s.level<2?4:0),en(s,3),s.status=Np,mc(e),s.pending!==0)return s.last_flush=-1,Ba}if(s.status===69){if(s.gzhead.extra){let i=s.pending,l=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+l>s.pending_buf_size;){let u=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>i&&(e.adler=ga(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex+=u,mc(e),s.pending!==0)return s.last_flush=-1,Ba;i=0,l-=u}let A=new Uint8Array(s.gzhead.extra);s.pending_buf.set(A.subarray(s.gzindex,s.gzindex+l),s.pending),s.pending+=l,s.gzhead.hcrc&&s.pending>i&&(e.adler=ga(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let i,l=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>l&&(e.adler=ga(e.adler,s.pending_buf,s.pending-l,l)),mc(e),s.pending!==0)return s.last_flush=-1,Ba;l=0}i=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,en(s,i)}while(i!==0);s.gzhead.hcrc&&s.pending>l&&(e.adler=ga(e.adler,s.pending_buf,s.pending-l,l)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let i,l=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>l&&(e.adler=ga(e.adler,s.pending_buf,s.pending-l,l)),mc(e),s.pending!==0)return s.last_flush=-1,Ba;l=0}i=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,en(s,i)}while(i!==0);s.gzhead.hcrc&&s.pending>l&&(e.adler=ga(e.adler,s.pending_buf,s.pending-l,l))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(mc(e),s.pending!==0))return s.last_flush=-1,Ba;en(s,255&e.adler),en(s,e.adler>>8&255),e.adler=0}if(s.status=Np,mc(e),s.pending!==0)return s.last_flush=-1,Ba}if(e.avail_in!==0||s.lookahead!==0||t!==Fu&&s.status!==db){let i=s.level===0?PM(s,t):s.strategy===u_?((l,A)=>{let u;for(;;){if(l.lookahead===0&&(Qf(l),l.lookahead===0)){if(A===Fu)return 1;break}if(l.match_length=0,u=Uu(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,u&&(fc(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,A===$c?(fc(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(fc(l,!1),l.strm.avail_out===0)?1:2})(s,t):s.strategy===Kte?((l,A)=>{let u,p,f,b;const w=l.window;for(;;){if(l.lookahead<=Cp){if(Qf(l),l.lookahead<=Cp&&A===Fu)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(f=l.strstart-1,p=w[f],p===w[++f]&&p===w[++f]&&p===w[++f])){b=l.strstart+Cp;do;while(p===w[++f]&&p===w[++f]&&p===w[++f]&&p===w[++f]&&p===w[++f]&&p===w[++f]&&p===w[++f]&&p===w[++f]&&f<b);l.match_length=Cp-(b-f),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(u=Uu(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(u=Uu(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),u&&(fc(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,A===$c?(fc(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(fc(l,!1),l.strm.avail_out===0)?1:2})(s,t):ub[s.level].func(s,t);if(i!==3&&i!==4||(s.status=db),i===1||i===3)return e.avail_out===0&&(s.last_flush=-1),Ba;if(i===2&&(t===Mte?Fte(s):t!==DM&&(_2(s,0,0,!1),t===Vte&&(Mu(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),mc(e),e.avail_out===0))return s.last_flush=-1,Ba}return t!==$c?Ba:s.wrap<=0?BM:(s.wrap===2?(en(s,255&e.adler),en(s,e.adler>>8&255),en(s,e.adler>>16&255),en(s,e.adler>>24&255),en(s,255&e.total_in),en(s,e.total_in>>8&255),en(s,e.total_in>>16&255),en(s,e.total_in>>24&255)):(Ab(s,e.adler>>>16),Ab(s,65535&e.adler)),mc(e),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Ba:BM)},sse=(e,t)=>{let s=t.length;if(hb(e))return jd;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==Vf||r.lookahead)return jd;if(i===1&&(e.adler=lb(e.adler,t,s,0)),r.wrap=0,s>=r.w_size){i===0&&(Mu(r.head),r.strstart=0,r.block_start=0,r.insert=0);let p=new Uint8Array(r.w_size);p.set(t.subarray(s-r.w_size,s),0),t=p,s=r.w_size}const l=e.avail_in,A=e.next_in,u=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Qf(r);r.lookahead>=3;){let p=r.strstart,f=r.lookahead-2;do r.ins_h=Vu(r,r.ins_h,r.window[p+3-1]),r.prev[p&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=p,p++;while(--f);r.strstart=p,r.lookahead=2,Qf(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=A,e.input=u,e.avail_in=l,r.wrap=i,Ba},pb={deflateInit:(e,t)=>MM(e,t,h_,15,8,zte),deflateInit2:MM,deflateReset:FM,deflateResetKeep:UM,deflateSetHeader:(e,t)=>hb(e)||e.state.wrap!==2?jd:(e.state.gzhead=t,Ba),deflate:tse,deflateEnd:e=>{if(hb(e))return jd;const t=e.state.status;return e.state=null,t===Np?Tp(e,Qte):Ba},deflateSetDictionary:sse,deflateInfo:"pako deflate (from Nodeca project)"};const rse=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var p_={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const r in s)rse(s,r)&&(e[r]=s[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const s=new Uint8Array(t);for(let r=0,i=0,l=e.length;r<l;r++){let A=e[r];s.set(A,i),i+=A.length}return s}};let VM=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{VM=!1}const mb=new Uint8Array(256);for(let e=0;e<256;e++)mb[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;mb[254]=mb[254]=1;var fb={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,s,r,i,l,A=e.length,u=0;for(i=0;i<A;i++)s=e.charCodeAt(i),(64512&s)==55296&&i+1<A&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(s=65536+(s-55296<<10)+(r-56320),i++)),u+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(u),l=0,i=0;l<u;i++)s=e.charCodeAt(i),(64512&s)==55296&&i+1<A&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(s=65536+(s-55296<<10)+(r-56320),i++)),s<128?t[l++]=s:s<2048?(t[l++]=192|s>>>6,t[l++]=128|63&s):s<65536?(t[l++]=224|s>>>12,t[l++]=128|s>>>6&63,t[l++]=128|63&s):(t[l++]=240|s>>>18,t[l++]=128|s>>>12&63,t[l++]=128|s>>>6&63,t[l++]=128|63&s);return t},buf2string:(e,t)=>{const s=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const l=new Array(2*s);for(i=0,r=0;r<s;){let A=e[r++];if(A<128){l[i++]=A;continue}let u=mb[A];if(u>4)l[i++]=65533,r+=u-1;else{for(A&=u===2?31:u===3?15:7;u>1&&r<s;)A=A<<6|63&e[r++],u--;u>1?l[i++]=65533:A<65536?l[i++]=A:(A-=65536,l[i++]=55296|A>>10&1023,l[i++]=56320|1023&A)}}return((A,u)=>{if(u<65534&&A.subarray&&VM)return String.fromCharCode.apply(null,A.length===u?A:A.subarray(0,u));let p="";for(let f=0;f<u;f++)p+=String.fromCharCode(A[f]);return p})(l,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&(192&e[s])==128;)s--;return s<0||s===0?t:s+mb[e[s]]>t?s:t}},QM=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const HM=Object.prototype.toString,{Z_NO_FLUSH:nse,Z_SYNC_FLUSH:ise,Z_FULL_FLUSH:ase,Z_FINISH:ose,Z_OK:m_,Z_STREAM_END:cse,Z_DEFAULT_COMPRESSION:lse,Z_DEFAULT_STRATEGY:dse,Z_DEFLATED:Ase}=A_;function f_(e){this.options=p_.assign({level:lse,method:Ase,chunkSize:16384,windowBits:15,memLevel:8,strategy:dse},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new QM,this.strm.avail_out=0;let s=pb.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==m_)throw new Error(Sp[s]);if(t.header&&pb.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?fb.string2buf(t.dictionary):HM.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,s=pb.deflateSetDictionary(this.strm,r),s!==m_)throw new Error(Sp[s]);this._dict_set=!0}}function GM(e,t){const s=new f_(t);if(s.push(e,!0),s.err)throw s.msg||Sp[s.err];return s.result}f_.prototype.push=function(e,t){const s=this.strm,r=this.options.chunkSize;let i,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?ose:nse,typeof e=="string"?s.input=fb.string2buf(e):HM.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(r),s.next_out=0,s.avail_out=r),(l===ise||l===ase)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(i=pb.deflate(s,l),i===cse)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),i=pb.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===m_;if(s.avail_out!==0){if(l>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},f_.prototype.onData=function(e){this.chunks.push(e)},f_.prototype.onEnd=function(e){e===m_&&(this.result=p_.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var use={deflate:GM,deflateRaw:function(e,t){return(t=t||{}).raw=!0,GM(e,t)}};const g_=16209;var hse=function(e,t){let s,r,i,l,A,u,p,f,b,w,_,C,U,B,j,K,q,ie,xe,ye,ue,Re,Ge,Ze;const _t=e.state;s=e.next_in,Ge=e.input,r=s+(e.avail_in-5),i=e.next_out,Ze=e.output,l=i-(t-e.avail_out),A=i+(e.avail_out-257),u=_t.dmax,p=_t.wsize,f=_t.whave,b=_t.wnext,w=_t.window,_=_t.hold,C=_t.bits,U=_t.lencode,B=_t.distcode,j=(1<<_t.lenbits)-1,K=(1<<_t.distbits)-1;e:do{C<15&&(_+=Ge[s++]<<C,C+=8,_+=Ge[s++]<<C,C+=8),q=U[_&j];t:for(;;){if(ie=q>>>24,_>>>=ie,C-=ie,ie=q>>>16&255,ie===0)Ze[i++]=65535&q;else{if(!(16&ie)){if(!(64&ie)){q=U[(65535&q)+(_&(1<<ie)-1)];continue t}if(32&ie){_t.mode=16191;break e}e.msg="invalid literal/length code",_t.mode=g_;break e}xe=65535&q,ie&=15,ie&&(C<ie&&(_+=Ge[s++]<<C,C+=8),xe+=_&(1<<ie)-1,_>>>=ie,C-=ie),C<15&&(_+=Ge[s++]<<C,C+=8,_+=Ge[s++]<<C,C+=8),q=B[_&K];s:for(;;){if(ie=q>>>24,_>>>=ie,C-=ie,ie=q>>>16&255,!(16&ie)){if(!(64&ie)){q=B[(65535&q)+(_&(1<<ie)-1)];continue s}e.msg="invalid distance code",_t.mode=g_;break e}if(ye=65535&q,ie&=15,C<ie&&(_+=Ge[s++]<<C,C+=8,C<ie&&(_+=Ge[s++]<<C,C+=8)),ye+=_&(1<<ie)-1,ye>u){e.msg="invalid distance too far back",_t.mode=g_;break e}if(_>>>=ie,C-=ie,ie=i-l,ye>ie){if(ie=ye-ie,ie>f&&_t.sane){e.msg="invalid distance too far back",_t.mode=g_;break e}if(ue=0,Re=w,b===0){if(ue+=p-ie,ie<xe){xe-=ie;do Ze[i++]=w[ue++];while(--ie);ue=i-ye,Re=Ze}}else if(b<ie){if(ue+=p+b-ie,ie-=b,ie<xe){xe-=ie;do Ze[i++]=w[ue++];while(--ie);if(ue=0,b<xe){ie=b,xe-=ie;do Ze[i++]=w[ue++];while(--ie);ue=i-ye,Re=Ze}}}else if(ue+=b-ie,ie<xe){xe-=ie;do Ze[i++]=w[ue++];while(--ie);ue=i-ye,Re=Ze}for(;xe>2;)Ze[i++]=Re[ue++],Ze[i++]=Re[ue++],Ze[i++]=Re[ue++],xe-=3;xe&&(Ze[i++]=Re[ue++],xe>1&&(Ze[i++]=Re[ue++]))}else{ue=i-ye;do Ze[i++]=Ze[ue++],Ze[i++]=Ze[ue++],Ze[i++]=Ze[ue++],xe-=3;while(xe>2);xe&&(Ze[i++]=Ze[ue++],xe>1&&(Ze[i++]=Ze[ue++]))}break}}break}}while(s<r&&i<A);xe=C>>3,s-=xe,C-=xe<<3,_&=(1<<C)-1,e.next_in=s,e.next_out=i,e.avail_in=s<r?r-s+5:5-(s-r),e.avail_out=i<A?A-i+257:257-(i-A),_t.hold=_,_t.bits=C};const b_=15,pse=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),mse=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fse=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),gse=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var gb=(e,t,s,r,i,l,A,u)=>{const p=u.bits;let f,b,w,_,C,U,B=0,j=0,K=0,q=0,ie=0,xe=0,ye=0,ue=0,Re=0,Ge=0,Ze=null;const _t=new Uint16Array(16),ns=new Uint16Array(16);let Jt,bs,As,Xs=null;for(B=0;B<=b_;B++)_t[B]=0;for(j=0;j<r;j++)_t[t[s+j]]++;for(ie=p,q=b_;q>=1&&_t[q]===0;q--);if(ie>q&&(ie=q),q===0)return i[l++]=20971520,i[l++]=20971520,u.bits=1,0;for(K=1;K<q&&_t[K]===0;K++);for(ie<K&&(ie=K),ue=1,B=1;B<=b_;B++)if(ue<<=1,ue-=_t[B],ue<0)return-1;if(ue>0&&(e===0||q!==1))return-1;for(ns[1]=0,B=1;B<b_;B++)ns[B+1]=ns[B]+_t[B];for(j=0;j<r;j++)t[s+j]!==0&&(A[ns[t[s+j]]++]=j);if(e===0?(Ze=Xs=A,U=20):e===1?(Ze=pse,Xs=mse,U=257):(Ze=fse,Xs=gse,U=0),Ge=0,j=0,B=K,C=l,xe=ie,ye=0,w=-1,Re=1<<ie,_=Re-1,e===1&&Re>852||e===2&&Re>592)return 1;for(;;){Jt=B-ye,A[j]+1<U?(bs=0,As=A[j]):A[j]>=U?(bs=Xs[A[j]-U],As=Ze[A[j]-U]):(bs=96,As=0),f=1<<B-ye,b=1<<xe,K=b;do b-=f,i[C+(Ge>>ye)+b]=Jt<<24|bs<<16|As|0;while(b!==0);for(f=1<<B-1;Ge&f;)f>>=1;if(f!==0?(Ge&=f-1,Ge+=f):Ge=0,j++,--_t[B]==0){if(B===q)break;B=t[s+A[j]]}if(B>ie&&(Ge&_)!==w){for(ye===0&&(ye=ie),C+=K,xe=B-ye,ue=1<<xe;xe+ye<q&&(ue-=_t[xe+ye],!(ue<=0));)xe++,ue<<=1;if(Re+=1<<xe,e===1&&Re>852||e===2&&Re>592)return 1;w=Ge&_,i[w]=ie<<24|xe<<16|C-l|0}}return Ge!==0&&(i[C+Ge]=B-ye<<24|64<<16|0),u.bits=ie,0};const{Z_FINISH:KM,Z_BLOCK:bse,Z_TREES:x_,Z_OK:Rp,Z_STREAM_END:xse,Z_NEED_DICT:vse,Z_STREAM_ERROR:Zc,Z_DATA_ERROR:WM,Z_MEM_ERROR:zM,Z_BUF_ERROR:wse,Z_DEFLATED:qM}=A_,v_=16180,w_=16190,kA=16191,N2=16192,T2=16194,__=16199,y_=16200,R2=16206,si=16209,YM=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function _se(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ip=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<v_||t.mode>16211?1:0},XM=e=>{if(Ip(e))return Zc;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=v_,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Rp},JM=e=>{if(Ip(e))return Zc;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,XM(e)},$M=(e,t)=>{let s;if(Ip(e))return Zc;const r=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Zc:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=s,r.wbits=t,JM(e))},ZM=(e,t)=>{if(!e)return Zc;const s=new _se;e.state=s,s.strm=e,s.window=null,s.mode=v_;const r=$M(e,t);return r!==Rp&&(e.state=null),r};let I2,O2,e3=!0;const yse=e=>{if(e3){I2=new Int32Array(512),O2=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(gb(1,e.lens,0,288,I2,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;gb(2,e.lens,0,32,O2,0,e.work,{bits:5}),e3=!1}e.lencode=I2,e.lenbits=9,e.distcode=O2,e.distbits=5},t3=(e,t,s,r)=>{let i;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),r>=l.wsize?(l.window.set(t.subarray(s-l.wsize,s),0),l.wnext=0,l.whave=l.wsize):(i=l.wsize-l.wnext,i>r&&(i=r),l.window.set(t.subarray(s-r,s-r+i),l.wnext),(r-=i)?(l.window.set(t.subarray(s-r,s),0),l.wnext=r,l.whave=l.wsize):(l.wnext+=i,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=i))),0};var Ese=(e,t)=>{let s,r,i,l,A,u,p,f,b,w,_,C,U,B,j,K,q,ie,xe,ye,ue,Re,Ge=0;const Ze=new Uint8Array(4);let _t,ns;const Jt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ip(e)||!e.output||!e.input&&e.avail_in!==0)return Zc;s=e.state,s.mode===kA&&(s.mode=N2),A=e.next_out,i=e.output,p=e.avail_out,l=e.next_in,r=e.input,u=e.avail_in,f=s.hold,b=s.bits,w=u,_=p,Re=Rp;e:for(;;)switch(s.mode){case v_:if(s.wrap===0){s.mode=N2;break}for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(2&s.wrap&&f===35615){s.wbits===0&&(s.wbits=15),s.check=0,Ze[0]=255&f,Ze[1]=f>>>8&255,s.check=ga(s.check,Ze,2,0),f=0,b=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",s.mode=si;break}if((15&f)!==qM){e.msg="unknown compression method",s.mode=si;break}if(f>>>=4,b-=4,ue=8+(15&f),s.wbits===0&&(s.wbits=ue),ue>15||ue>s.wbits){e.msg="invalid window size",s.mode=si;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&f?16189:kA,f=0,b=0;break;case 16181:for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(s.flags=f,(255&sa(s))!==qM){e.msg="unknown compression method",s.mode=si;break}if(57344&sa(s)){e.msg="unknown header flags set",s.mode=si;break}s.head&&(s.head.text=f>>8&1),512&sa(s)&&4&s.wrap&&(Ze[0]=255&f,Ze[1]=f>>>8&255,s.check=ga(s.check,Ze,2,0)),f=0,b=0,s.mode=16182;case 16182:for(;b<32;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.head&&(s.head.time=f),512&sa(s)&&4&s.wrap&&(Ze[0]=255&f,Ze[1]=f>>>8&255,Ze[2]=f>>>16&255,Ze[3]=f>>>24&255,s.check=ga(s.check,Ze,4,0)),f=0,b=0,s.mode=16183;case 16183:for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.head&&(s.head.xflags=255&f,s.head.os=f>>8),512&sa(s)&&4&s.wrap&&(Ze[0]=255&f,Ze[1]=f>>>8&255,s.check=ga(s.check,Ze,2,0)),f=0,b=0,s.mode=16184;case 16184:if(1024&sa(s)){for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.length=f,s.head&&(s.head.extra_len=f),512&sa(s)&&4&s.wrap&&(Ze[0]=255&f,Ze[1]=f>>>8&255,s.check=ga(s.check,Ze,2,0)),f=0,b=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&sa(s)&&(C=s.length,C>u&&(C=u),C&&(s.head&&(ue=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(r.subarray(l,l+C),ue)),512&sa(s)&&4&s.wrap&&(s.check=ga(s.check,r,C,l)),u-=C,l+=C,s.length-=C),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&sa(s)){if(u===0)break e;C=0;do ue=r[l+C++],s.head&&ue&&s.length<65536&&(s.head.name+=String.fromCharCode(ue));while(ue&&C<u);if(512&sa(s)&&4&s.wrap&&(s.check=ga(s.check,r,C,l)),u-=C,l+=C,ue)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&sa(s)){if(u===0)break e;C=0;do ue=r[l+C++],s.head&&ue&&s.length<65536&&(s.head.comment+=String.fromCharCode(ue));while(ue&&C<u);if(512&sa(s)&&4&s.wrap&&(s.check=ga(s.check,r,C,l)),u-=C,l+=C,ue)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&sa(s)){for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(4&s.wrap&&f!==(65535&s.check)){e.msg="header crc mismatch",s.mode=si;break}f=0,b=0}s.head&&(s.head.hcrc=sa(s)>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=kA;break;case 16189:for(;b<32;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}e.adler=s.check=YM(f),f=0,b=0,s.mode=w_;case w_:if(s.havedict===0)return e.next_out=A,e.avail_out=p,e.next_in=l,e.avail_in=u,s.hold=f,s.bits=b,vse;e.adler=s.check=1,s.mode=kA;case kA:if(t===bse||t===x_)break e;case N2:if(s.last){f>>>=7&b,b-=7&b,s.mode=R2;break}for(;b<3;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}switch(s.last=1&f,f>>>=1,b-=1,3&f){case 0:s.mode=16193;break;case 1:if(yse(s),s.mode=__,t===x_){f>>>=2,b-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=si}f>>>=2,b-=2;break;case 16193:for(f>>>=7&b,b-=7&b;b<32;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",s.mode=si;break}if(s.length=65535&f,f=0,b=0,s.mode=T2,t===x_)break e;case T2:s.mode=16195;case 16195:if(C=s.length,C){if(C>u&&(C=u),C>p&&(C=p),C===0)break e;i.set(r.subarray(l,l+C),A),u-=C,l+=C,p-=C,A+=C,s.length-=C;break}s.mode=kA;break;case 16196:for(;b<14;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(s.nlen=257+(31&f),f>>>=5,b-=5,s.ndist=1+(31&f),f>>>=5,b-=5,s.ncode=4+(15&f),f>>>=4,b-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=si;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;b<3;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.lens[Jt[s.have++]]=7&f,f>>>=3,b-=3}for(;s.have<19;)s.lens[Jt[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,_t={bits:s.lenbits},Re=gb(0,s.lens,0,19,s.lencode,0,s.work,_t),s.lenbits=_t.bits,Re){e.msg="invalid code lengths set",s.mode=si;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ge=s.lencode[f&(1<<s.lenbits)-1],j=Ge>>>24,K=Ge>>>16&255,q=65535&Ge,!(j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(q<16)f>>>=j,b-=j,s.lens[s.have++]=q;else{if(q===16){for(ns=j+2;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(f>>>=j,b-=j,s.have===0){e.msg="invalid bit length repeat",s.mode=si;break}ue=s.lens[s.have-1],C=3+(3&f),f>>>=2,b-=2}else if(q===17){for(ns=j+3;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}f>>>=j,b-=j,ue=0,C=3+(7&f),f>>>=3,b-=3}else{for(ns=j+7;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}f>>>=j,b-=j,ue=0,C=11+(127&f),f>>>=7,b-=7}if(s.have+C>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=si;break}for(;C--;)s.lens[s.have++]=ue}}if(s.mode===si)break;if(s.lens[256]===0){e.msg="invalid code -- missing end-of-block",s.mode=si;break}if(s.lenbits=9,_t={bits:s.lenbits},Re=gb(1,s.lens,0,s.nlen,s.lencode,0,s.work,_t),s.lenbits=_t.bits,Re){e.msg="invalid literal/lengths set",s.mode=si;break}if(s.distbits=6,s.distcode=s.distdyn,_t={bits:s.distbits},Re=gb(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,_t),s.distbits=_t.bits,Re){e.msg="invalid distances set",s.mode=si;break}if(s.mode=__,t===x_)break e;case __:s.mode=y_;case y_:if(u>=6&&p>=258){e.next_out=A,e.avail_out=p,e.next_in=l,e.avail_in=u,s.hold=f,s.bits=b,hse(e,_),A=e.next_out,i=e.output,p=e.avail_out,l=e.next_in,r=e.input,u=e.avail_in,f=s.hold,b=s.bits,s.mode===kA&&(s.back=-1);break}for(s.back=0;Ge=s.lencode[f&(1<<s.lenbits)-1],j=Ge>>>24,K=Ge>>>16&255,q=65535&Ge,!(j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(K&&!(240&K)){for(ie=j,xe=K,ye=q;Ge=s.lencode[ye+((f&(1<<ie+xe)-1)>>ie)],j=Ge>>>24,K=Ge>>>16&255,q=65535&Ge,!(ie+j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}f>>>=ie,b-=ie,s.back+=ie}if(f>>>=j,b-=j,s.back+=j,s.length=q,K===0){s.mode=16205;break}if(32&K){s.back=-1,s.mode=kA;break}if(64&K){e.msg="invalid literal/length code",s.mode=si;break}s.extra=15&K,s.mode=16201;case 16201:if(s.extra){for(ns=s.extra;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.length+=f&(1<<s.extra)-1,f>>>=s.extra,b-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ge=s.distcode[f&(1<<s.distbits)-1],j=Ge>>>24,K=Ge>>>16&255,q=65535&Ge,!(j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(!(240&K)){for(ie=j,xe=K,ye=q;Ge=s.distcode[ye+((f&(1<<ie+xe)-1)>>ie)],j=Ge>>>24,K=Ge>>>16&255,q=65535&Ge,!(ie+j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}f>>>=ie,b-=ie,s.back+=ie}if(f>>>=j,b-=j,s.back+=j,64&K){e.msg="invalid distance code",s.mode=si;break}s.offset=q,s.extra=15&K,s.mode=16203;case 16203:if(s.extra){for(ns=s.extra;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.offset+=f&(1<<s.extra)-1,f>>>=s.extra,b-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=si;break}s.mode=16204;case 16204:if(p===0)break e;if(C=_-p,s.offset>C){if(C=s.offset-C,C>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=si;break}C>s.wnext?(C-=s.wnext,U=s.wsize-C):U=s.wnext-C,C>s.length&&(C=s.length),B=s.window}else B=i,U=A-s.offset,C=s.length;C>p&&(C=p),p-=C,s.length-=C;do i[A++]=B[U++];while(--C);s.length===0&&(s.mode=y_);break;case 16205:if(p===0)break e;i[A++]=s.length,p--,s.mode=y_;break;case R2:if(s.wrap){for(;b<32;){if(u===0)break e;u--,f|=r[l++]<<b,b+=8}if(_-=p,e.total_out+=_,s.total+=_,4&s.wrap&&_&&(e.adler=s.check=sa(s)?ga(s.check,i,_,A-_):lb(s.check,i,_,A-_)),_=p,4&s.wrap&&(sa(s)?f:YM(f))!==s.check){e.msg="incorrect data check",s.mode=si;break}f=0,b=0}s.mode=16207;case 16207:if(s.wrap&&sa(s)){for(;b<32;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(4&s.wrap&&f!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=si;break}f=0,b=0}s.mode=16208;case 16208:Re=xse;break e;case si:Re=WM;break e;case 16210:return zM;default:return Zc}return e.next_out=A,e.avail_out=p,e.next_in=l,e.avail_in=u,s.hold=f,s.bits=b,(s.wsize||_!==e.avail_out&&s.mode<si&&(s.mode<R2||t!==KM))&&t3(e,e.output,e.next_out,_-e.avail_out),w-=e.avail_in,_-=e.avail_out,e.total_in+=w,e.total_out+=_,s.total+=_,4&s.wrap&&_&&(e.adler=s.check=sa(s)?ga(s.check,i,_,e.next_out-_):lb(s.check,i,_,e.next_out-_)),e.data_type=s.bits+(s.last?64:0)+(s.mode===kA?128:0)+(s.mode===__||s.mode===T2?256:0),(w===0&&_===0||t===KM)&&Re===Rp&&(Re=wse),Re},DA={inflateReset:JM,inflateReset2:$M,inflateResetKeep:XM,inflateInit:e=>ZM(e,15),inflateInit2:ZM,inflate:Ese,inflateEnd:e=>{if(Ip(e))return Zc;let t=e.state;return t.window&&(t.window=null),e.state=null,Rp},inflateGetHeader:(e,t)=>{if(Ip(e))return Zc;const s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,Rp):Zc},inflateSetDictionary:(e,t)=>{const s=t.length;let r,i,l;return Ip(e)?Zc:(r=e.state,r.wrap!==0&&r.mode!==w_?Zc:r.mode===w_&&(i=1,i=lb(i,t,s,0),i!==r.check)?WM:(l=t3(e,t,s,s),l?(r.mode=16210,zM):(r.havedict=1,Rp)))},inflateInfo:"pako inflate (from Nodeca project)"},Sse=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const s3=Object.prototype.toString,{Z_NO_FLUSH:Cse,Z_FINISH:Nse,Z_OK:bb,Z_STREAM_END:k2,Z_NEED_DICT:D2,Z_STREAM_ERROR:Tse,Z_DATA_ERROR:r3,Z_MEM_ERROR:Rse}=A_;function E_(e){this.options=p_.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new QM,this.strm.avail_out=0;let s=DA.inflateInit2(this.strm,t.windowBits);if(s!==bb)throw new Error(Sp[s]);if(this.header=new Sse,DA.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=fb.string2buf(t.dictionary):s3.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=DA.inflateSetDictionary(this.strm,t.dictionary),s!==bb)))throw new Error(Sp[s])}function n3(e,t){const s=new E_(t);if(s.push(e),s.err)throw s.msg||Sp[s.err];return s.result}E_.prototype.push=function(e,t){const s=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let l,A,u;if(this.ended)return!1;for(A=t===~~t?t:t===!0?Nse:Cse,s3.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(r),s.next_out=0,s.avail_out=r),l=DA.inflate(s,A),l===D2&&i&&(l=DA.inflateSetDictionary(s,i),l===bb?l=DA.inflate(s,A):l===r3&&(l=D2));s.avail_in>0&&l===k2&&s.state.wrap>0&&e[s.next_in]!==0;)DA.inflateReset(s),l=DA.inflate(s,A);switch(l){case Tse:case r3:case D2:case Rse:return this.onEnd(l),this.ended=!0,!1}if(u=s.avail_out,s.next_out&&(s.avail_out===0||l===k2))if(this.options.to==="string"){let p=fb.utf8border(s.output,s.next_out),f=s.next_out-p,b=fb.buf2string(s.output,p);s.next_out=f,s.avail_out=r-f,f&&s.output.set(s.output.subarray(p,p+f),0),this.onData(b)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(l!==bb||u!==0){if(l===k2)return l=DA.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},E_.prototype.onData=function(e){this.chunks.push(e)},E_.prototype.onEnd=function(e){e===bb&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=p_.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ise={inflate:n3,inflateRaw:function(e,t){return(t=t||{}).raw=!0,n3(e,t)}};const{deflate:Ose,deflateRaw:kse}=use,{inflate:Dse,inflateRaw:Bse}=Ise;var Lse=Ose,jse=kse,Pse=Dse,Use=Bse,i3=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(i3||{});class Fse{constructor(){P(this,"_sequence",0),P(this,"_startTime",Date.now()),P(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const u=new Uint8Array(4);u.set([1,0,0,0]);const p={id:0,length:4,data:u.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[p]};s.commonPacketHeader.extension=1,s.extension=f,s.payload=this.compress(t),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;G("SHOW_DATASTREAM2_LOG")&&N.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const r=new ArrayBuffer(s.commonPacketHeader.length),i=new Uint8Array(r),l=new DataView(r);let A=0;if(l.setUint16(A,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),A+=2,l.setUint32(A,s.commonPacketHeader.sequence,!0),A+=4,l.setUint16(A,s.commonStreamHeader,!0),A+=2,s.extension){const u=this.serializeExtension(s.extension);i.set(new Uint8Array(u),A),A+=u.byteLength}if(i.set(new Uint8Array(s.payload),A),A+=s.payload.byteLength,A!==s.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const s=new DataView(t);let r=0;const i=s.getUint16(r,!0);r+=2;const l={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:s.getUint16(r+2,!0)<<16|s.getUint16(r,!0)};let A,u;if(r+=4,G("SHOW_DATASTREAM2_LOG")&&N.debug("receive data header: ".concat(JSON.stringify(l))),s.getUint16(r,!0),r+=2,l.extension){u=this.deserializeExtension(t.slice(r)),r+=2+u.length,A=t.slice(r);let p=!1;if(u.datas.length>0){const f=u.datas.find(b=>b.id===0);f&&(p=(1&new DataView(f.data).getUint32(0,!0))==1)}A=p?this.decompress(A):A}else A=t.slice(8);return A}serializeExtension(t){const{profile:s,length:r,datas:i}=t,l=new ArrayBuffer(r+2),A=new Uint8Array(l),u=new DataView(l);let p=0;if(u.setUint8(p++,s),u.setUint8(p++,r),i.forEach(f=>{s?(u.setUint8(p++,f.id),u.setUint8(p++,f.length),A.set(new Uint8Array(f.data),p),p+=f.data.byteLength):(u.setUint8(p++,f.id|f.length<<4),A.set(new Uint8Array(f.data),p),p+=f.data.byteLength)}),p!==r+2)throw Error("serialize extension error, is ".concat(p,"!==").concat(r+2));return l}deserializeExtension(t){const s=new DataView(t);let r=0;const i=s.getUint8(r);r++;const l=s.getUint8(r);r++;const A=i===i3.TWO_BYTE,u=[],p=new DataView(t,2);let f=0;for(;f<l;){let b=0,w=0,_=new ArrayBuffer(0);A?(b=p.getUint8(f),f++,w=p.getUint8(f),f++):(b=15&p.getUint8(f),w=p.getUint8(f)>>4,f++),w>0&&(_=p.buffer.slice(f+2,f+2+w),f+=_.byteLength),u.push({id:b,length:w,data:_})}if(f!==l)throw Error("parse error");return{profile:i,length:l,datas:u}}decompress(t){return Pse(new Uint8Array(t))}compress(t){return Lse(new Uint8Array(t))}}const Mse={name:"DataStream",create:(e,t)=>{const s=t?new GZ(e):new KZ(e);return s.useDataStream(new Fse),s}};class Vse extends jr{constructor(t,s,r){super(),P(this,"ws",void 0),P(this,"requestId",1),P(this,"heartBeatTimer",void 0),P(this,"joinInfo",void 0),P(this,"clientId",void 0),P(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),P(this,"onClose",i=>{this.emit("close"),this.dispose()}),P(this,"onMessage",i=>{const l=JSON.parse(i.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=s,this.ws=new Q0("cross-channel-".concat(this.clientId),r),this.ws.on(us.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(us.CONNECTED,this.onOpen),this.ws.on(us.ON_MESSAGE,this.onMessage),this.ws.on(us.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const s=this.requestId++;return t.requestId=s,t.seq=s,this.ws.sendMessage(t),s}waitStatus(t){return new mt((s,r)=>{const i=window.setTimeout(()=>{r(new Le(W.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(i),l.state&&l.state!==0?r(new Le(W.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new Le(W.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new Le(W.WS_DISCONNECT);const s=()=>new mt((A,u)=>{this.ws.once(us.CLOSED,()=>u(new Le(W.WS_ABORT))),this.ws.once(us.CONNECTED,A)});this.ws.state!=="connected"&&await s();const r=this.sendMessage(t),i=new mt((A,u)=>{const p=()=>{u(new Le(W.WS_ABORT))};this.ws.once(us.RECONNECTING,p),this.ws.once(us.CLOSED,p),this.once("req_".concat(r),A),Qn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(us.RECONNECTING,p),this.ws.off(us.CLOSED,p),u(new Le(W.TIMEOUT,"cross channel ws request timeout"))})}),l=await i;if(!l||l.code!==200)throw new Le(W.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(us.REQUEST_NEW_URLS),this.ws.on(us.REQUEST_NEW_URLS,s=>{s(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const s=this.requestId++;return t.requestId=s,this.ws.sendMessage(t),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Qse extends jr{set state(t){t!==this._state&&(t!==Ha.RELAY_STATE_FAILURE&&(this.errorCode=Cf.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,s,r,i,l){super(),P(this,"joinInfo",void 0),P(this,"sid",void 0),P(this,"clientId",void 0),P(this,"cancelToken",Ta.CancelToken.source()),P(this,"workerToken",void 0),P(this,"requestId",0),P(this,"signal",void 0),P(this,"prevChannelMediaConfig",void 0),P(this,"httpRetryConfig",void 0),P(this,"_resolution",void 0),P(this,"_state",Ha.RELAY_STATE_IDLE),P(this,"errorCode",Cf.RELAY_OK),P(this,"onStatus",A=>{N.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(A))),A&&A.command&&(A.command==="onAudioPacketReceived"&&this.emit("event",TA.PACKET_RECEIVED_AUDIO_FROM_SRC),A.command==="onVideoPacketReceived"&&this.emit("event",TA.PACKET_RECEIVED_VIDEO_FROM_SRC),A.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Cf.SRC_TOKEN_EXPIRED,this.state=Ha.RELAY_STATE_FAILURE),A.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Cf.DEST_TOKEN_EXPIRED,this.state=Ha.RELAY_STATE_FAILURE))}),P(this,"onReconnect",async()=>{N.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",TA.NETWORK_DISCONNECTED),this.state=Ha.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(A=>{this.state!==Ha.RELAY_STATE_IDLE&&(N.error("auto restart channel media relay failed",A.toString()),this.errorCode=Cf.SERVER_CONNECTION_LOST,this.state=Ha.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=s,this.sid=ap(),this.signal=new Vse(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==Ha.RELAY_STATE_IDLE)throw new Le(W.INVALID_OPERATION);this.state=Ha.RELAY_STATE_CONNECTING,await this.connect(),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Le(W.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Le(W.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Le(W.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ha.RELAY_STATE_RUNNING)throw new Le(W.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ha.RELAY_STATE_RUNNING)throw new Le(W.INVALID_OPERATION);const s=this.genMessage(Oa.SetVideoProfile);await this.signal.request(s),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),N.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ha.RELAY_STATE_IDLE,this.dispose()}dispose(){N.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ta.CancelToken.source(),this.state=Ha.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Yee(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",TA.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const s=this.genMessage(Oa.SetSdkProfile,t);await this.signal.request(s),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Oa.SetSourceChannel,t);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",TA.PACKET_JOINED_SRC_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(Oa.SetSourceUserId,t);await this.signal.request(i),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(Oa.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",TA.PACKET_JOINED_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const A=this.genMessage(Oa.StartPacketTransfer,t);await this.signal.request(A),this.emit("event",TA.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ha.RELAY_STATE_RUNNING,N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const s=this.genMessage(Oa.UpdateDestChannel,t);await this.signal.request(s),this.emit("event",TA.PACKET_UPDATE_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Oa.StopPacketTransfer);await this.signal.request(t),N.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,s){const r=[],i=[],l=[];this.requestId+=1;const A={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:lc,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};A.sdkVersion==="4.24.2"&&(A.sdkVersion="0.0.1");let u=null,p=null;switch(t){case Oa.SetSdkProfile:return A.clientRequest={command:"SetSdkProfile",type:"multi_channel"},A;case Oa.SetSourceChannel:if(p=s&&s.getSrcChannelMediaInfo(),!p)throw new Le(W.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceChannel",uid:"0",channelName:p.channelName,token:p.token||this.joinInfo.appId},A;case Oa.SetSourceUserId:if(p=s&&s.getSrcChannelMediaInfo(),!p)throw new Le(W.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceUserId",uid:p.uid+""},A;case Oa.SetDestChannel:if(u=s&&s.getDestChannelMediaInfo(),!u)throw new Le(W.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{r.push(f.channelName),i.push(f.uid+""),l.push(f.token||this.joinInfo.appId)}),A.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:l},A;case Oa.StartPacketTransfer:return A.clientRequest={command:"StartPacketTransfer"},A;case Oa.Reconnect:return A.clientRequest={command:"Reconnect"},A;case Oa.StopPacketTransfer:return A.clientRequest={command:"StopPacketTransfer"},A;case Oa.UpdateDestChannel:if(u=s&&s.getDestChannelMediaInfo(),!u)throw new Le(W.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{r.push(f.channelName),i.push(f.uid+""),l.push(f.token||this.joinInfo.appId)}),A.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:l},A;case Oa.SetVideoProfile:A.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return A}}const Hse={name:"ChannelMediaRelay",create:function(e){return new Qse(e.joinInfo,e.clientId,e.websocketRetryConfig||pn,e.httpRetryConfig||pn,e.resolution)}};function a3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function xb(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?a3(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class Gse extends jr{constructor(t,s,r,i){super(),P(this,"spec",void 0),P(this,"token",void 0),P(this,"websocket",void 0),P(this,"pingpongTimer",void 0),P(this,"reconnectMode","retry"),P(this,"serviceMode",void 0),P(this,"reqId",0),P(this,"commandReqId",0),P(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),P(this,"handleWebSocketMessage",l=>{if(!l.data)return;const A=JSON.parse(l.data);A.requestId?this.emit("@".concat(A.requestId,"-").concat(A.sid),A):(kt.workerEvent(this.spec.sid,{actionType:"status",serverCode:A.code,workerType:this.serviceMode===NA.TRANSCODE?1:2}),this.emit(Ru.PUBLISH_STREAM_STATUS,A))}),this.spec=s,this.token=t,this.serviceMode=i,this.websocket=new Q0("live-streaming",r),this.websocket.on(us.CONNECTED,this.handleWebSocketOpen),this.websocket.on(us.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(us.REQUEST_NEW_URLS,(l,A)=>{wn(this,Ru.REQUEST_NEW_ADDRESS).then(l).catch(A)}),this.websocket.on(us.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,s,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,A=this.reqId;if(!A||!this.websocket)throw new Le(W.UNEXPECTED_ERROR);const u=xb({command:t,sdkVersion:lc==="4.24.2"?"0.0.1":lc,seq:A,requestId:A,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Le(W.WS_DISCONNECT);const p=()=>new mt((_,C)=>{this.websocket.once(us.CLOSED,()=>C(new Le(W.WS_ABORT))),this.websocket.once(us.CONNECTED,_)});this.websocket.state!=="connected"&&await p(),u.clientRequest&&(u.clientRequest.workerToken=this.token);const f=new mt((_,C)=>{const U=()=>{C(new Le(W.WS_ABORT))};this.websocket.once(us.RECONNECTING,U),this.websocket.once(us.CLOSED,U),this.once("@".concat(A,"-").concat(this.spec.sid),B=>{_(B)})});i&&kt.workerEvent(this.spec.sid,xb(xb({},i),{},{requestId:l,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const b=Date.now();this.websocket.sendMessage(u);let w=null;try{w=await f}catch(_){if(this.websocket.state==="closed")throw _;return await p(),await this.request(t,s,r)}return i&&kt.workerEvent(this.spec.sid,xb(xb({},i),{},{requestId:l,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-b})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=lc==="4.24.2"?"0.0.1":lc;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Rn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void N.warning("live stream response already exists stream");case Rn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Rn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Rn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Le(W.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Rn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Rn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Le(W.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Rn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Le(W.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ru.WARNING,s,t.serverResponse.url)}case Rn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Le(W.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ru.WARNING,s,t.serverResponse.url)}case Rn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Rn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Le(W.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Rn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Le(W.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ru.WARNING,s,t.serverResponse.url)}case Rn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Rn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Rn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Rn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Rn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Rn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Le(W.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(B0)},6e3)}}function o3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Ka(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?o3(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class Kse extends jr{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pn;super(),P(this,"onLiveStreamWarning",void 0),P(this,"onLiveStreamError",void 0),P(this,"spec",void 0),P(this,"retryTimeout",1e4),P(this,"connection",void 0),P(this,"httpRetryConfig",void 0),P(this,"wsRetryConfig",void 0),P(this,"streamingTasks",new Map),P(this,"isStartingStreamingTask",!1),P(this,"taskMutex",new $n("live-streaming")),P(this,"cancelToken",Ta.CancelToken.source()),P(this,"transcodingConfig",void 0),P(this,"uapResponse",void 0),P(this,"lastTaskId",1),P(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=s}async setTranscodingConfig(t){const s=Ka(Ka({},Tee),t);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(N.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(A=>Ka(Ka(Ka({},Nee),A),{},{zOrder:A.zOrder?A.zOrder+1:1}))),function(A){Kr(A.width)||gr(A.width,"config.width",0,1e4),Kr(A.height)||gr(A.height,"config.height",0,1e4),Kr(A.videoBitrate)||gr(A.videoBitrate,"config.videoBitrate",1,1e6),Kr(A.videoFrameRate)||gr(A.videoFrameRate,"config.videoFrameRate"),Kr(A.lowLatency)||Vc(A.lowLatency,"config.lowLatency"),Kr(A.audioSampleRate)||hn(A.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Kr(A.audioBitrate)||gr(A.audioBitrate,"config.audioBitrate",1,128),Kr(A.audioChannels)||hn(A.audioChannels,"config.audioChannels",[1,2,3,4,5]),Kr(A.videoGop)||gr(A.videoGop,"config.videoGop"),Kr(A.videoCodecProfile)||hn(A.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Kr(A.userCount)||gr(A.userCount,"config.userCount",0,17),Kr(A.backgroundColor)||gr(A.backgroundColor,"config.backgroundColor",0,16777215),Kr(A.userConfigExtraInfo)||di(A.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),A.transcodingUsers&&!Kr(A.transcodingUsers)&&(SA(A.transcodingUsers,"config.transcodingUsers"),A.transcodingUsers.forEach((u,p)=>{Bw(u.uid),Kr(u.x)||gr(u.x,"transcodingUser[".concat(p,"].x"),0,1e4),Kr(u.y)||gr(u.y,"transcodingUser[".concat(p,"].y"),0,1e4),Kr(u.width)||gr(u.width,"transcodingUser[".concat(p,"].width"),0,1e4),Kr(u.height)||gr(u.height,"transcodingUser[".concat(p,"].height"),0,1e4),Kr(u.zOrder)||gr(u.zOrder-1,"transcodingUser[".concat(p,"].zOrder"),0,100),Kr(u.alpha)||gr(u.alpha,"transcodingUser[".concat(p,"].alpha"),0,1,!1)})),Kr(A.watermark)||yN(A.watermark,"watermark"),Kr(A.backgroundImage)||yN(A.backgroundImage,"backgroundImage"),A.images&&!Kr(A.images)&&(SA(A.images,"config.images"),A.images.forEach((u,p)=>{yN(u,"images[".concat(p,"]"))}))}(s);const r=[];s.images&&r.push(...s.images.map(A=>Ka(Ka(Ka({},_N),A),{},{zOrder:255}))),s.backgroundImage&&(r.push(Ka(Ka(Ka({},_N),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(r.push(Ka(Ka(Ka({},_N),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=r,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(A=>Ka({},A)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const i=(s.userConfigs||[]).map(A=>typeof A.uid=="number"?mt.resolve(A.uid):N4(A.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await mt.all(i)).forEach((A,u)=>{s.userConfigs&&s.userConfigs[u]&&(s.userConfigs[u].uid=A)}),this.transcodingConfig=s,this.connection)try{var l;const A=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ho(l=this.streamingTasks).call(l)).map(u=>u.taskId).join("#")});N.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(A.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(A){if(!A.data||!A.data.retry)throw A;A.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{N.warning("[".concat(this.spec.clientId,"] live streaming receive error"),A.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,A).then(()=>{N.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(p=>{N.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,p.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,p)})})}}async startLiveStreamingTask(t,s,r){if(!this.transcodingConfig&&s===NA.TRANSCODE)throw new Le(W.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};N.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(s));const l=await this.taskMutex.lock();if(!this.connection&&r)return void l();if(this.streamingTasks.get(t)&&!r)return l(),new Le(W.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(u){throw l(),u}switch(s){case NA.TRANSCODE:i.transcodingConfig=Ka({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const A=this.lastTaskId++;try{const u=new mt((f,b)=>{Qn(this.retryTimeout).then(()=>{if(r)return b(r);const w=this.statusError.get(t);return w?(this.statusError.delete(t),b(w)):void 0})}),p=await mt.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:s===NA.TRANSCODE?1:2,requestByUser:!r,tid:A.toString()}),u]);this.isStartingStreamingTask=!1,N.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(t,{clientRequest:i,mode:s,url:t,taskId:A}),l()}catch(u){if(l(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||r)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,s,u)):await this.startLiveStreamingTask(t,s,u)}}stopLiveStreamingTask(t){return new mt((s,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new Le(W.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=i.mode;i.abortTask=()=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:l===NA.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(A=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(A.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(r)})}resetAllTask(){var t;const s=Array.from(ho(t=this.streamingTasks).call(t));this.terminate();for(const r of s)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ta.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Le(W.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await wn(this,EN.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=s,this.connection=new Gse(s.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ru.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(Ru.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Ru.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new Le(W.UNEXPECTED_ERROR,"can not get new live streaming address list"));wn(this,EN.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,r(l.addressList)}).catch(i)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(t){const s=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(s),i=t.reason;switch(t.code){case Rn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Rn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const A=new Le(W.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return N.error(A.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,A);if(!this.isStartingStreamingTask)return;this.statusError.set(s,A)}case Rn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const A=new Le(W.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,A)}case Rn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Rn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const A=Array.from(ho(l=this.streamingTasks).call(l));for(const u of A)u.abortTask?u.abortTask():(N.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{N.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(p=>{N.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,p)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Wse={name:"LiveStreaming",create:function(e){return new Kse(e.joinInfo,e.websocketRetryConfig||pn,e.httpRetryConfig||pn)}};function zse(e){let t=d3();return function(s,r){let i=s.appId;i!==void 0&&(Ar(r,10),Fd(r,i));let l=s.cid;l!==void 0&&(Ar(r,16),Ar(r,l));let A=s.cname;A!==void 0&&(Ar(r,26),Fd(r,A));let u=s.deviceId;u!==void 0&&(Ar(r,34),Fd(r,u));let p=s.elapse;p!==void 0&&(Ar(r,40),Qu(r,p));let f=s.fileSize;f!==void 0&&(Ar(r,48),Qu(r,Gf(f)));let b=s.height;b!==void 0&&(Ar(r,56),Qu(r,Gf(b)));let w=s.jpg;w!==void 0&&(Ar(r,66),Ar(r,w.length),function(Br,qe){let lt=Kf(Br,qe.length);Br.bytes.set(qe,lt)}(r,w));let _=s.networkType;_!==void 0&&(Ar(r,72),Qu(r,Gf(_)));let C=s.osType;C!==void 0&&(Ar(r,80),Qu(r,Gf(C)));let U=s.requestId;U!==void 0&&(Ar(r,90),Fd(r,U));let B=s.sdkVersion;B!==void 0&&(Ar(r,98),Fd(r,B));let j=s.sequence;j!==void 0&&(Ar(r,104),Qu(r,Gf(j)));let K=s.sid;K!==void 0&&(Ar(r,114),Fd(r,K));let q=s.timestamp;q!==void 0&&(Ar(r,120),Qu(r,q));let ie=s.uid;ie!==void 0&&(Ar(r,128),Ar(r,ie));let xe=s.vid;xe!==void 0&&(Ar(r,136),Ar(r,xe));let ye=s.width;ye!==void 0&&(Ar(r,144),Qu(r,Gf(ye)));let ue=s.service;ue!==void 0&&(Ar(r,152),Ar(r,ue));let Re=s.callbackData;Re!==void 0&&(Ar(r,162),Fd(r,Re));let Ge=s.jpgEncryption;Ge!==void 0&&(Ar(r,168),Ar(r,Ge));let Ze=s.requestType;Ze!==void 0&&(Ar(r,176),Ar(r,Ze));let _t=s.scorePorn;_t!==void 0&&(Ar(r,185),U2(r,_t));let ns=s.scoreSexy;ns!==void 0&&(Ar(r,193),U2(r,ns));let Jt=s.scoreNeutral;Jt!==void 0&&(Ar(r,201),U2(r,Jt));let bs=s.scene;bs!==void 0&&(Ar(r,208),Ar(r,bs));let As=s.ossFilePrefix;As!==void 0&&(Ar(r,218),Fd(r,As));let Xs=s.serviceVendor;if(Xs!==void 0)for(let Br of Xs){Ar(r,226);let qe=d3();Xse(Br,qe),Ar(r,qe.limit),ere(r,qe),Zse(qe)}}(e,t),function(s){let r=s.bytes,i=s.limit;return r.length===i?r:r.subarray(0,i)}(t)}function qse(e){return function(s){let r={};e:for(;!A3(s);){let i=Md(s);switch(i>>>3){case 0:break e;case 1:r.code=Md(s);break;case 2:r.msg=u3(s,Md(s));break;case 3:{let l=Jse(s);r.data=Yse(s),s.limit=l;break}default:c3(s,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function Yse(e){let t={};e:for(;!A3(e);){let s=Md(e);switch(s>>>3){case 0:break e;case 1:t.requestId=u3(e,Md(e));break;case 2:t.requestType=Md(e)>>>0;break;case 3:t.scorePorn=P2(e);break;case 4:t.scoreSexy=P2(e);break;case 5:t.scoreNeutral=P2(e);break;case 6:t.requestScene=Md(e)>>>0;break;case 7:t.scene=Md(e)>>>0;break;default:c3(e,7&s)}}return t}function Xse(e,t){let s=e.service;s!==void 0&&(Ar(t,8),Ar(t,s));let r=e.vendor;r!==void 0&&(Ar(t,16),Ar(t,r));let i=e.token;i!==void 0&&(Ar(t,26),Fd(t,i));let l=e.callbackUrl;l!==void 0&&(Ar(t,34),Fd(t,l))}function Jse(e){let t=Md(e),s=e.limit;return e.limit=e.offset+t,s}function c3(e,t){switch(t){case 0:for(;128&h3(e););break;case 2:L2(e,Md(e));break;case 5:L2(e,4);break;case 1:L2(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let $se=new Float32Array(1);new Uint8Array($se.buffer);let B2=new Float64Array(1),Wa=new Uint8Array(B2.buffer);function Gf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let l3=[];function d3(){const e=l3.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Zse(e){l3.push(e)}function L2(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function A3(e){return e.offset>=e.limit}function Kf(e,t){let s=e.bytes,r=e.offset,i=e.limit,l=r+t;if(l>s.length){let A=new Uint8Array(2*l);A.set(s),e.bytes=A}return e.offset=l,l>i&&(e.limit=l),r}function j2(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function u3(e,t){let s=j2(e,t),r=String.fromCharCode,i=e.bytes,l="",A="";for(let u=0;u<t;u++){let p,f,b,w,_=i[u+s];128&_?(224&_)==192?u+1>=t?A+=l:(p=i[u+s+1],(192&p)!=128?A+=l:(w=(31&_)<<6|63&p,w<128?A+=l:(A+=r(w),u++))):(240&_)==224?u+2>=t?A+=l:(p=i[u+s+1],f=i[u+s+2],(49344&(p|f<<8))!=32896?A+=l:(w=(15&_)<<12|(63&p)<<6|63&f,w<2048||w>=55296&&w<=57343?A+=l:(A+=r(w),u+=2))):(248&_)==240?u+3>=t?A+=l:(p=i[u+s+1],f=i[u+s+2],b=i[u+s+3],(12632256&(p|f<<8|b<<16))!=8421504?A+=l:(w=(7&_)<<18|(63&p)<<12|(63&f)<<6|63&b,w<65536||w>1114111?A+=l:(w-=65536,A+=r(55296+(w>>10),56320+(1023&w)),u+=3))):A+=l:A+=r(_)}return A}function Fd(e,t){let s=t.length,r=0;for(let A=0;A<s;A++){let u=t.charCodeAt(A);u>=55296&&u<=56319&&A+1<s&&(u=(u<<10)+t.charCodeAt(++A)-56613888),r+=u<128?1:u<2048?2:u<65536?3:4}Ar(e,r);let i=Kf(e,r),l=e.bytes;for(let A=0;A<s;A++){let u=t.charCodeAt(A);u>=55296&&u<=56319&&A+1<s&&(u=(u<<10)+t.charCodeAt(++A)-56613888),u<128?l[i++]=u:(u<2048?l[i++]=u>>6&31|192:(u<65536?l[i++]=u>>12&15|224:(l[i++]=u>>18&7|240,l[i++]=u>>12&63|128),l[i++]=u>>6&63|128),l[i++]=63&u|128)}}function ere(e,t){let s=Kf(e,t.limit),r=e.bytes,i=t.bytes;for(let l=0,A=t.limit;l<A;l++)r[l+s]=i[l]}function h3(e){return e.bytes[j2(e,1)]}function p3(e,t){let s=Kf(e,1);e.bytes[s]=t}function P2(e){let t=j2(e,8),s=e.bytes;return Wa[0]=s[t++],Wa[1]=s[t++],Wa[2]=s[t++],Wa[3]=s[t++],Wa[4]=s[t++],Wa[5]=s[t++],Wa[6]=s[t++],Wa[7]=s[t++],B2[0]}function U2(e,t){let s=Kf(e,8),r=e.bytes;B2[0]=t,r[s++]=Wa[0],r[s++]=Wa[1],r[s++]=Wa[2],r[s++]=Wa[3],r[s++]=Wa[4],r[s++]=Wa[5],r[s++]=Wa[6],r[s++]=Wa[7]}function Md(e){let t,s=0,r=0;do t=h3(e),s<32&&(r|=(127&t)<<s),s+=7;while(128&t);return r}function Ar(e,t){for(t>>>=0;t>=128;)p3(e,127&t|128),t>>>=7;p3(e,t)}function Qu(e,t){let s=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,l=i===0?r===0?s<16384?s<128?1:2:s<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,A=Kf(e,l),u=e.bytes;switch(l){case 10:u[A+9]=i>>>7&1;case 9:u[A+8]=l!==9?128|i:127&i;case 8:u[A+7]=l!==8?r>>>21|128:r>>>21&127;case 7:u[A+6]=l!==7?r>>>14|128:r>>>14&127;case 6:u[A+5]=l!==6?r>>>7|128:r>>>7&127;case 5:u[A+4]=l!==5?128|r:127&r;case 4:u[A+3]=l!==4?s>>>21|128:s>>>21&127;case 3:u[A+2]=l!==3?s>>>14|128:s>>>14&127;case 2:u[A+1]=l!==2?s>>>7|128:s>>>7&127;case 1:u[A]=l!==1?128|s:127&s}}function m3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}const tre=new Map([["moderation",1],["supervise",2]]);class sre extends jr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const s=this._connectionState;this._connectionState=t,this.emit(ei.CONNECTION_STATE_CHANGE,s,t)}get inspectType(){return this._inspectType}set inspectType(t){var s;this._inspectMode=Fa(s=t.map(r=>tre.get(r)||0)).call(s,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),P(this,"name","AgoraRTCVideoContentInspect"),P(this,"_connectionState",Wc.CONNECTING),P(this,"_innerConnectionState",void 0),P(this,"sequence",0),P(this,"inspectStartTime",void 0),P(this,"workerManagerConnection",void 0),P(this,"workerConnection",void 0),P(this,"workerMessageLengthLimit",void 0),P(this,"inspectIntervalMinimum",void 0),P(this,"qualityRatio",void 0),P(this,"_connectInfo",void 0),P(this,"_cancelTokenSource",Ta.CancelToken.source()),P(this,"_retryConfig",void 0),P(this,"wmSequence",0),P(this,"inspectInterval",void 0),P(this,"inspectTimer",null),P(this,"ossFilePrefix",void 0),P(this,"extraInfo",void 0),P(this,"_inspectType",void 0),P(this,"_inspectMode",void 0),P(this,"_quality",1),P(this,"qualityTimer",null),P(this,"_inspectId",void 0),P(this,"_needWorkUrlOnly",!1),P(this,"inspectImage",()=>{if(this.connectionState!==Wc.CONNECTED)throw new Le(W.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Wc.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ar(5,"inspect-"),this.workerMessageLengthLimit=G("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=G("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=G("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Q0("worker-manager-"+this._inspectId,pn),this.on(ei.STATE_CHANGE,(s,r)=>{this._innerConnectionState=s,N.debug("[".concat(this._inspectId,"] Inspect operation :").concat(zc[s]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Q0("worker-"+this._inspectId,pn),this.handleWorkerEvents()}async init(t,s){this.emit(ei.STATE_CHANGE,zc.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=s,new mt((i,l)=>{this.on(ei.CONNECTION_STATE_CHANGE,(A,u)=>{u===Wc.CONNECTED&&i()}),this.requestAP(t,r,s).then(A=>{this.connectWorkerManager(A)}).catch(A=>{l(A)})})}async requestAP(t,s,r){const i=G("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),l=await function(u,p,f,b){let{appId:w,areaCode:_,cname:C,sid:U,token:B,uid:j}=p;kf++;const K="image_moderation_api",q={service_name:K,json_body:JSON.stringify({appId:w,areaCode:_,cname:C,command:"allocateEdge",requestId:kf,seq:kf,sid:U,token:B,ts:Date.now(),uid:j+""})};let ie,xe,ye=u[0];return kl(async()=>{ie=Date.now();const ue=await Ul(ye,{data:q,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(xe=Date.now()-ie,ue.code!==0){const Jt=new Le(W.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ue.code,{retry:!0,responseTime:xe});throw N.error(Jt.toString()),Jt}const Re=JSON.parse(ue.json_body);if(Re.code!==200){const Jt=new Le(W.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Re.code,", reason: ").concat(Re.reason),{code:Re.code,responseTime:xe});throw N.error(Jt.toString()),Jt}if(!Re.servers||!Array.isArray(Re.servers)||Re.servers.length===0){const Jt=new Le(W.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Re.code,responseTime:xe});throw N.error(Jt.toString()),Jt}const Ge=G("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(Ge)return{addressList:[Ge],workerToken:Re.workerToken,vid:Re.vid,responseTime:xe};const Ze=G("VIDEO_INSPECT_WORKER_MANAGER_HOST"),_t=G("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Re.servers.map(Jt=>{let{address:bs,wss:As}=Jt;if(bs&&As)return"wss://".concat(bs.replace(/\./g,"-"),".").concat(Ze,":").concat(_t||As)}).filter(Jt=>!!Jt),workerToken:Re.workerToken,vid:Re.vid,responseTime:xe}},(ue,Re)=>(kt.apworkerEvent(U,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(ue.addressList),firstSuccess:Re===0,responseTime:xe,serverIp:u[Re%u.length]}),!1),(ue,Re)=>(kt.apworkerEvent(U,{success:!1,sc:ue.data&&ue.data.code||200,serviceName:K,responseTime:xe,serverIp:u[Re%u.length]}),!!(ue.code!==W.OPERATION_ABORTED&&ue.code!==W.UNEXPECTED_RESPONSE||ue.data&&ue.data.retry)&&(ye=u[(Re+1)%u.length],!0)),b)}(i,t,s,r);this.emit(ei.STATE_CHANGE,zc.AP_CONNECTED);const{addressList:A}=l;return this.wmSequence++,A}async connectWorkerManager(t){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(ei.STATE_CHANGE,zc.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(us.CONNECTED,async()=>{this.emit(ei.STATE_CHANGE,zc.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(us.CLOSED,()=>{this._innerConnectionState<zc.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(us.FAILED,()=>{this._innerConnectionState<zc.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(us.RECONNECTING,()=>{this._innerConnectionState<zc.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(us.ON_MESSAGE,async t=>{this.emit(ei.STATE_CHANGE,zc.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw N.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new Le(W.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&s))throw N.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new Le(W.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=G("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,l=s.replace(/:\d+\/?$/,":".concat(i));this.emit(ei.STATE_CHANGE,zc.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(ei.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(us.WILL_RECONNECT,(t,s,r)=>{r(t)}),this.workerManagerConnection.on(us.REQUEST_NEW_URLS,(t,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(s)})}handleWorkerEvents(){this.workerConnection.on(us.CONNECTED,async()=>{this.emit(ei.STATE_CHANGE,zc.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Wc.CONNECTED}),this.workerConnection.on(us.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=qse(new Uint8Array(t.data));if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&N.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ei.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var s;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},l=Fa(s=Object.keys(i)).call(s,(u,p)=>i[u]>i[p]?u:p,"porn"),A=Object.keys(i).find(u=>u===l);this.emit(ei.INSPECT_RESULT,A)}else this.emit(ei.INSPECT_RESULT,void 0,new Le(W.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(ei.INSPECT_RESULT,void 0,new Le(W.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else N.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ei.INSPECT_RESULT,void 0,new Le(W.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(us.CLOSED,()=>{this.connectionState=Wc.CLOSED}),this.workerConnection.on(us.FAILED,()=>{this.connectionState=Wc.CLOSED}),this.workerConnection.on(us.RECONNECTING,()=>{this.connectionState=this.connectionState===Wc.CONNECTED?Wc.RECONNECTING:Wc.CONNECTING}),this.workerConnection.on(us.WILL_RECONNECT,(t,s,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(us.REQUEST_NEW_URLS,(t,s)=>{this.workerManagerConnection.close(),this.once(ei.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{s(r)})})}async requestToInspectImage(){this.sequence++;const t=fo(this,ei.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(ei.INSPECT_RESULT,void 0,new Le(W.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,s);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(ei.INSPECT_RESULT,void 0,new Le(W.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,s){let{appId:r,cname:i,cid:l,vid:A,sid:u,uid:p}=s;const f=Date.now(),b=await t.getCurrentFrameImage("image/jpeg",this.quality),w=await Gj(b,r,i),_=this.sequence+"-"+l+"-"+p+"-"+f+"-"+ar(12,""),C={appId:r,cid:l,cname:i,deviceId:"",elapse:(U=Number(f-this.inspectStartTime),{low:U|=0,high:U>>31,unsigned:U>=0}),fileSize:w.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:w,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.2",sequence:this.sequence,sid:u,timestamp:xF(f),uid:p,vid:A,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var U;this.extraInfo===void 0&&delete C.callbackData,this.ossFilePrefix===void 0&&delete C.ossFilePrefix;const B=zse(C);if(B.byteLength<this.workerMessageLengthLimit){if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(K){for(var q=1;q<arguments.length;q++){var ie=arguments[q]!=null?arguments[q]:{};q%2?m3(Object(ie),!0).forEach(function(xe){P(K,xe,ie[xe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(ie)):m3(Object(ie)).forEach(function(xe){Object.defineProperty(K,xe,Object.getOwnPropertyDescriptor(ie,xe))})}return K}({},C);delete j.jpg,N.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return B}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(t,{appId:r,cname:i,cid:l,vid:A,sid:u,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ta.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Wc.CLOSED,this.emit(ei.STATE_CHANGE,zc.CLOSED)}}const rre={name:"ContentInspect",create:function(e){let{config:t}=e;return function(s){if(!s)throw new Le(W.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Le(W.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(s.inspectType)];r.forEach(i=>{var l;if(!nt(l=["supervise","moderation"]).call(l,i))throw new Le(W.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),s.inspectType=r}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Le(W.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new sre(t)}};var f3=h($e.Object.getOwnPropertySymbols),nre=Ts,ire=Ua.indexOf,are=Lh,F2=Ae([].indexOf),g3=!!F2&&1/F2([1],1,-0)<0;nre({target:"Array",proto:!0,forced:g3||!are("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return g3?F2(this,e,t)||0:ire(this,e,t)}});var ore=wi("Array","indexOf"),cre=k,lre=ore,M2=Array.prototype,dre=function(e){var t=e.indexOf;return e===M2||cre(M2,e)&&t===M2.indexOf?lre:t},b3=h(dre);function Are(e,t){if(e==null)return{};var s,r,i=function(A,u){if(A==null)return{};var p={};for(var f in A)if({}.hasOwnProperty.call(A,f)){if(b3(u).call(u,f)!==-1)continue;p[f]=A[f]}return p}(e,t);if(f3){var l=f3(e);for(r=0;r<l.length;r++)s=l[r],b3(t).call(t,s)===-1&&{}.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}let x3=class{get localCapabilities(){return Rr(this._localCapabilities)}get rtpCapabilities(){return Rr(this._rtpCapabilities)}get candidates(){return Rr(this._candidates)}get iceParameters(){return Rr(this._iceParameters)}get dtlsParameters(){return Rr(this._dtlsParameters)}constructor(e){P(this,"sessionDesc",void 0),P(this,"_localCapabilities",void 0),P(this,"_rtpCapabilities",void 0),P(this,"_candidates",void 0),P(this,"_iceParameters",void 0),P(this,"_dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname","o/i14u9pJrxRKAsu"),P(this,"firefoxSsrcMidMap",new Map),e=Rr(e);const{remoteIceParameters:t,remoteDtlsParameters:s,candidates:r,remoteRTPCapabilities:i,localCapabilities:l,direction:A,setup:u,videoCodec:p,audioCodec:f}=e;let b;this.setup=u,b=A===fa.RECEIVE_ONLY?ha(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ha(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=s,this._localCapabilities=l;const w=A===fa.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_=A===fa.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=A===fa.RECEIVE_ONLY?i.send.videoCodecs:q0(Tt.VIDEO,w,_,p),U=A===fa.RECEIVE_ONLY?i.send.audioCodecs:q0(Tt.AUDIO,w,_,f);for(const B of b.mediaDescriptions)B.attributes.iceUfrag=t.iceUfrag,B.attributes.icePwd=t.icePwd,B.attributes.fingerprints=s.fingerprints,B.attributes.candidates=r,B.attributes.setup=this.setup,B.media.mediaType==="application"&&(B.attributes.sctpPort="5000"),B.media.mediaType==="video"&&(B.media.fmts=C.map(j=>j.payloadType.toString(10)),B.attributes.payloads=C,B.attributes.extmaps=w.videoExtensions),B.media.mediaType==="audio"&&(B.media.fmts=U.map(j=>j.payloadType.toString(10)),B.attributes.payloads=U,B.attributes.extmaps=w.audioExtensions,Of(B));this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return CA(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,s,r,i){s=s.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:A}=W0(t,this.cname,G("SYNC_GROUP")?s:void 0),u=this.findPreloadMediaDesc(l);if(u){if(Tr()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,u.attributes.mid),i&&(i.twcc||i.remb)){const p=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(u,i),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const p=this.findAvailableMediaIndex(e,l,r);let f;return p===-1?(f=this.createOrRecycleSendMedia(e,l,A,"sendonly",r,i),this.updateBundleMids()):(f=Rr(this.sessionDesc.mediaDescriptions[p]),f.attributes.direction="sendonly",f.attributes.ssrcs=l,f.attributes.ssrcGroups=A,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(f,i)),Tr()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,s){const r=[];return e.forEach(i=>{const l=i._mediaStreamTrack.kind,A=this.findAvailableRecvMediaIndex(l);let u,p=!1;A===-1?(p=!0,u=this.createOrRecycleRecvMedia(i,[],"recvonly",t,s),this.updateBundleMids()):(u=Rr(this.sessionDesc.mediaDescriptions[A]),u.attributes.direction="recvonly"),r.push({mid:u.attributes.mid,needCreateTransceiver:p})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:s,address:r,port:i,type:l,relatedAddress:A,relatedPort:u,priority:p}=new RTCIceCandidate(e),f={foundation:t??"",componentId:"1",transport:s??"",priority:p?p+"":"",connectionAddress:r??"",port:i?i+"":"",type:l?l+"":"",relAddr:A??"",relPort:u?u+"":"",extension:{}};this.candidates.some(b=>b.priority===f.priority&&b.connectionAddress===f.connectionAddress&&b.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,s,r,i){const l=e._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,u=q0(l,A,this.localCapabilities.send,l===Tt.AUDIO?i:r),p=l===Tt.VIDEO?A.videoExtensions:A.audioExtensions,f="".concat(++this.currentMidIndex);let b={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};b=this.mungRecvMediaDsec(b,e);const w=this.findFirstClosedMedia(l);if(w){const _=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[_]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>nt(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>nt(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,s){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Tr()){if(i){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!l||l!==r.attributes.mid)}return!1}return i&&r.attributes.mid===s})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const s=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&s})}predictReceivingMids(e){const t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}restartICE(e){e=Rr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,s,r,i,l){const A=this.rtpCapabilities.send,u=e===Tt.VIDEO?A.videoCodecs:A.audioCodecs,p=e===Tt.VIDEO?A.videoExtensions:A.audioExtensions;Tr()&&(i="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};f=this.mungSendMediaDesc(f,l);const b=this.findFirstClosedMedia(e);if(b){const w=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[w]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,t,s){const r=Rr(e);return kN(r),xp(r,t),DN(r,t),l4(r),Hw(r,s,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const s=Rr(e);return Hw(s,t,this.localCapabilities.recv),Of(s),s}updateRecvMedia(e,t){const s=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(s!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var s;return((s=t.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Tr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const ure=["sdp"];var Ir;function v3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Hu(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?v3(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):v3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let w3=(Ir=class ag extends KU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,s,r){super(t,s),P(this,"direction",void 0),P(this,"name",void 0),P(this,"store",void 0),P(this,"spec",void 0),P(this,"peerConnection",void 0),P(this,"initialOffer",void 0),P(this,"transport",void 0),P(this,"statsFilter",void 0),P(this,"localCandidateCount",0),P(this,"_isInRestartIce",!1),P(this,"mutex",void 0),P(this,"onLocalCandidate",void 0),P(this,"remoteSDP",void 0),P(this,"pendingCandidates",[]),P(this,"localCapabilities",void 0),P(this,"isReady",!1),P(this,"restartCnt",0),P(this,"curTurnServerIndex",0),this.store=s,this.spec=t,this.mutex=new $n("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(ag.resolvePCConfiguration(t,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??fa.SEND_ONLY,this.name=this.direction===fa.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Aw(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Tr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const s=await LN();if(this.localCapabilities=z0(s),t){const{sdp:r}=t,i=Are(t,ure),l=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=K0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yc(w,b,"videoExtensions",_,C,U),Yc(w,b,"videoCodecs",_,C,U),Yc(w,b,"audioExtensions",_,C,U),Yc(w,b,"audioCodecs",_,C,U),G("RAISE_H264_BASELINE_PRIORITY")){const B=U.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(B!==-1){const j=U.videoCodecs.findIndex(K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<B){N.debug("raising H264 baseline profile priority");const K=U.videoCodecs[B];U.videoCodecs.splice(B,1),U.videoCodecs.splice(j,0,K)}j!==-1&&G("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(K=>!(K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:_,recv:C,sendrecv:U}}({},{},r);this.remoteSDP=new x3({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const A=await this.peerConnection.createAnswer();if(!A.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const u=Od(A.sdp);await this.peerConnection.setLocalDescription(A);const p=await A4({},{},A.sdp);this.localCapabilities=z0(p);const f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),Hu(Hu({},u),{},{sdp:A.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Od(r.sdp);return this.initialOffer=r,Hu(Hu({},i),{},{sdp:r.sdp})}}catch(s){throw new Me(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:r,dtlsParameters:i}=t,l=await A4({},{},s);this.remoteSDP=new x3({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const A=this.peerConnection.getTransceivers()[0];A!=null&&A.sender&&A.sender.transport&&this.tryBindTransportEvents(A.sender.transport)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Me(W.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(t,s,r){var i=this;return Na(function*(){const l=yield vs(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const A=[],u=i.remoteSDP.receive(t,s,r);t.forEach((j,K)=>{if(u[K].needCreateTransceiver){const q=i.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});A.push(q),j._updateRtpTransceiver(q)}else{const q=i.peerConnection.getTransceivers().find(ie=>ie.mid===u[K].mid);if(!q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[K].mid));A.push(q),j._updateRtpTransceiver(q)}}),Tr()&&G("SIMULCAST")===!0&&(yield vs(i.applySimulcastForFirefox(A,t)));const p=u.map(j=>j.mid),f=yield vs(i.peerConnection.createOffer()),b=i.mungSendOfferSDP(f.sdp,t,p),w=ha(b),_=p.map(j=>{const K=w.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return ON(K,G("USE_PUB_RTX"))}),C=A.map((j,K)=>{const q=p[K];return{localSSRC:_[K],id:q}});yield vs(i.peerConnection.setLocalDescription({type:"offer",sdp:b}));try{yield C}catch(j){const K=i.remoteSDP.toString();throw yield vs(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield vs(i.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield vs(i.stopSending(p,!0)),j}yield vs(i.applySimulcastEncodings(A,t)),yield vs(i.applySendEncodings(A,t));const U=i.remoteSDP.toString(),B=i.logSDPExchange(b,"offer","local","send");return B==null||B(U),yield vs(i.setRemoteDescription({type:"answer",sdp:U})),A.map((j,K)=>{const q=p[K];return{localSSRC:_[K],id:q}})}catch(A){throw A instanceof Me?A:new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(A.toString()))}finally{l()}})()}async stopSending(t,s){const r=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(p=>{var f;p.direction="inactive",(f=p.stop)===null||f===void 0||f.call(p)});const l=await this.peerConnection.createOffer(),A=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();A==null||A(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:A}=this.remoteSDP.send(t,s,r,i);if(A){const p=this.remoteSDP.toString(),f=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const b=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(b.sdp,l,t);f==null||f(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(p=>p.mid===l);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(l){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:A}=this.remoteSDP.send(t,s,r,i);if(A){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(f.sdp,l,t);p==null||p(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===op.Auto&&(this.store.p2pTransport=op.SdRtn,Ls().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ag.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ls().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ag.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Od(s.sdp);return this.store.descriptionStart(),this.direction===fa.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===fa.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Od(s.sdp);return await this.peerConnection.setLocalDescription(s),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);const l=this.remoteSDP.toString(),A=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),A==null||A(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Me(W.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,s){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(s)?Tr()||await this.applySimulcastEncodings(r,[s]):await this.applySendEncodings(r,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){const r=this.peerConnection.getTransceivers().find(i=>i.mid===s);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const s=t[0].transport.iceTransport,{local:r,remote:i}=s.getSelectedCandidatePair();return{local:Hu(Hu({},Hc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Hu(Hu({},Hc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,s;nt(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var s;t.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var l;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(tp(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...ag.turnServerConfigToIceServers(t.turnServer.servers,s,r)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...ag.turnServerConfigToIceServers(t.turnServer.serversFromGateway,s,r)),nt(l=[op.Relay,op.SdRtn]).call(l,s)&&(i.iceTransportPolicy="relay"),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(A=>{A.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&Ls().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),N.debug("P2PConnection p2pTransport is ".concat(s)),i}static turnServerConfigToIceServers(t,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],l=t.filter(u=>u.tcpport);N.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(r));const A=l.length>r?l[r]:l[0];switch(s){case op.SdRtn:const u=t.filter(f=>{var b;return nt(b=f.username).call(b,"glb:")&&f.turnServerURL==f.turnServerURL}),p=u.length>r?u[r]:u[0];p&&(i.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(qc(p.turnServerURL),":").concat(p.tcpport,"?transport=udp")}),i.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(qc(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}));break;case op.Relay:A&&(i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turn:".concat(A.turnServerURL,":").concat(A.tcpport,"?transport=udp")}),i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turns:".concat(qc(A.turnServerURL),":").concat(A.tcpport,"?transport=tcp")}));break;default:A&&(i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turn:".concat(A.turnServerURL,":").concat(A.tcpport,"?transport=udp")}),i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turns:".concat(qc(A.turnServerURL),":").concat(A.tcpport,"?transport=tcp")}),i.push({username:A.username,credential:A.password,credentialType:"password",urls:"stun:".concat(A.turnServerURL,":").concat(A.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const s=t.iceTransport;s&&(s.onstatechange=()=>{const r=t==null?void 0:t.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:r,remote:i}=s.getSelectedCandidatePair()||{};if(r&&i){const l=r.address+":"+r.port,A=i.address+":"+i.port;N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Id(l)),", remote ").concat(JSON.stringify(Id(A))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var r;if(s||(s=this.peerConnection.getSenders().find(b=>b.track===t._mediaStreamTrack)),!s)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ls().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},l={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var A;const{bitrateMax:b,frameRate:w,scaleResolutionDownBy:_}=t._encoderConfig;b&&(l.maxBitrate=1e3*b),nt(A=t._hints).call(A,rr.LOW_STREAM)&&(w&&(l.maxFramerate=ka(w)),_&&_>=1&&(l.scaleResolutionDownBy=_))}if(G("DSCP_TYPE")&&Sd()){var u;const b=G("DSCP_TYPE");nt(u=["very-low","low","medium","high"]).call(u,b)&&(l.networkPriority=b)}const p=s.getParameters(),f=(r=p.encodings)===null||r===void 0?void 0:r[0];Tr()&&!f&&(i.encodings=[l]),f&&Object.assign(f,l),Object.assign(p,i),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await s.setParameters(p)}async applySendEncodings(t,s){try{if(!Ls().supportSetRtpSenderParameters||t.length!==s.length)return;for(let r=0;r<t.length;r++){const i=t[r],l=s[r];l instanceof xr&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,i.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,r){const i=ha(t);return s.forEach((l,A)=>{const u=r[A],p=i.mediaDescriptions.find(f=>f.attributes.mid===u);p&&(xp(p,l),BN(p,l,this.store.codec))}),CA(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,s,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let p=0;p<t.length;p++){var r,i,l,A,u;const f=t[p],b=s[p];if(b instanceof xr&&!nt(r=b._hints).call(r,rr.LOW_STREAM)&&(i=b._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((l=b._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(A=b._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((u=b._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},_={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const C=f.sender.getParameters();await f.sender.setParameters(Object.assign(C,w))}}}async applySimulcastEncodings(t,s){if(!Tr()&&t.length===s.length)for(let r=0;r<t.length;r++){const i=s[r];if(i instanceof xr&&this.isVP8Simulcast(i)){const l=t[r],A={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,A))}}}isVP8Simulcast(t){var s,r,i,l,A;return!!(t instanceof xr&&G("SIMULCAST")&&this.store.codec==="vp8"&&!nt(s=t._hints).call(s,rr.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((A=t._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(t,s,r,i){if(G("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(s," SDP during P2PConnection.").concat(i,`
`),t),s==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(A=>{A.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();i==null||i(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async A=>{A.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();i==null||i(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(t,s){var r;if(s=s??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const l=(i=ha(s).mediaDescriptions.find(A=>A.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(t){var s;await this.peerConnection.setRemoteDescription(t),nt(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,s,r){const i=ha(t),l=i.mediaDescriptions.find(A=>A.attributes.mid===s);return l&&r===Tt.AUDIO&&l.media.mediaType==="audio"&&Of(l),CA(i)}},ft(Ir.prototype,"establish",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"establish"),Ir.prototype),ft(Ir.prototype,"connect",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"connect"),Ir.prototype),ft(Ir.prototype,"receive",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"receive"),Ir.prototype),ft(Ir.prototype,"mockReceive",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"mockReceive"),Ir.prototype),ft(Ir.prototype,"stopReceiving",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"stopReceiving"),Ir.prototype),ft(Ir.prototype,"restartICE",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"restartICE"),Ir.prototype),ft(Ir.prototype,"close",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"close"),Ir.prototype),ft(Ir.prototype,"updateEncoderConfig",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"updateEncoderConfig"),Ir.prototype),ft(Ir.prototype,"updateSendParameters",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"updateSendParameters"),Ir.prototype),ft(Ir.prototype,"replaceTrack",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"replaceTrack"),Ir.prototype),ft(Ir.prototype,"muteLocal",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"muteLocal"),Ir.prototype),ft(Ir.prototype,"unmuteLocal",[el],Object.getOwnPropertyDescriptor(Ir.prototype,"unmuteLocal"),Ir.prototype),Ir);function el(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From P2PConnection.".concat(t));try{for(var A=arguments.length,u=new Array(A),p=0;p<A;p++)u[p]=arguments[p];return await r.apply(this,u)}finally{l()}},s}let Vl=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var _3,y3,E3,S3,C3,N3,T3,R3,I3,O3,k3,Vr;function D3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function S_(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?D3(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):D3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let hre=(_3=Ql(Vl.SEND_ONLY),y3=Ql(Vl.SEND_ONLY),E3=Ql(),S3=Ql(Vl.RECEIVE_ONLY),C3=Ql(Vl.RECEIVE_ONLY),N3=Ql(Vl.RECEIVE_ONLY),T3=Ql(Vl.RECEIVE_ONLY),R3=Ql(Vl.RECEIVE_ONLY),I3=Ql(Vl.RECEIVE_ONLY),O3=Ql(),k3=Ql(Vl.RECEIVE_ONLY),Vr=class extends jr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Vt.StateChange,t,this._state)}constructor(e,t){super(),P(this,"isPlanB",!1),P(this,"store",void 0),P(this,"statsUploader",void 0),P(this,"sendConnection",void 0),P(this,"recvConnection",void 0),P(this,"localTrackMap",new Map),P(this,"remoteUserMap",new Map),P(this,"localDataChannels",[]),P(this,"pendingLocalTracks",[]),P(this,"pendingRemoteTracks",[]),P(this,"statsCollector",void 0),P(this,"dtlsFailedCount",0),P(this,"sendMutex",void 0),P(this,"recvMutex",void 0),P(this,"_state",tr.Disconnected),P(this,"_restartStates",["disconnected","failed"]),P(this,"reconnectInterval",void 0),P(this,"uploadUnplinkStarted",!1),P(this,"uploadDownlinkStarted",!1),P(this,"uplinkStateUploadInterval",void 0),P(this,"downlinkStatsUploadInterval",void 0),P(this,"handleMuteLocalTrack",async(s,r,i)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==tr.Connected)return void i(new Me(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const p=this.filterTobeMutedTracks(s);if(p.length===0)return void r();const f=p.find(C=>C[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(p.map(C=>{let[,{id:U}]=C;return U}));let b=!1;var A,u;s.trackMediaType==="video"?b=!((A=this.localTrackMap.get(at.LocalAudioTrack))===null||A===void 0||!A.track._muted):b=((u=this.localTrackMap.get(at.LocalVideoTrack))===null||u===void 0?void 0:u.id)===void 0;const w=this.createMuteMessage(p);await wr(this,Vt.RequestMuteLocal,w);const _=s.trackMediaType==="video"?Ou.MUTE_LOCAL_VIDEO:Ou.MUTE_LOCAL_AUDIO;await wr(this,Vt.RequestP2PMuteLocal,{action:_,message:w,isMuteAll:b}),r()}catch(p){i(p)}finally{l()}}),P(this,"handleUnmuteLocalTrack",async(s,r,i)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==tr.Connected)return void i(new Me(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const A=this.filterTobeUnmutedTracks(s);if(A.length===0)return void r();await this.sendConnection.unmuteLocal(A.map(f=>{let[,{id:b}]=f;return b}));const u=this.createUnmuteMessage(A),p=s.trackMediaType==="video"?Ou.UNMUTE_LOCAL_VIDEO:Ou.UNMUTE_LOCAL_AUDIO;await wr(this,Vt.RequestP2PMuteLocal,{action:p,message:u}),r()}catch(A){i(A)}finally{l()}}),P(this,"handleUpdateVideoEncoder",async(s,r,i,l)=>{let A;typeof l=="boolean"&&l||(A=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const p=this.localTrackMap.get(at.LocalVideoTrack);if(!this.sendConnection||!p||p.track!==s||this.state!==tr.Connected)return void r();const{id:f,track:b}=p;f&&(await this.sendConnection.updateSendParameters(f,b),await this.sendConnection.updateEncoderConfig(f,b),this.emit(Vt.UpdateVideoEncoder,b)),r()}catch(p){i(p)}finally{var u;(u=A)===null||u===void 0||u()}}),P(this,"handleUpdateVideoSendParameters",async(s,r,i)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const A=this.localTrackMap.get(at.LocalVideoTrack);if(!this.sendConnection||!A||A.track!==s||this.state!==tr.Connected)return void r();const{id:u,track:p}=A;u&&await this.sendConnection.updateSendParameters(u,p),r()}catch(A){i(A)}finally{l()}}),P(this,"handleReplaceTrack",async(s,r,i,l)=>{let A;N.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof l=="boolean"&&l||(A=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var u;const f=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:w}]=b;return s===w});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==tr.Connected)return void r();if(await((u=this.sendConnection)===null||u===void 0?void 0:u.replaceTrack(s,f[1].id)),f[0]===at.LocalVideoTrack&&Ls().supportDualStreamEncoding){const b=this.localTrackMap.get(at.LocalVideoLowTrack);if(b){const w=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=w,b.track._originMediaStreamTrack=w,await new mt((_,C)=>{this.handleReplaceTrack(b.track,_,C,!0)})}}r()}catch(f){i(f)}finally{var p;(p=A)===null||p===void 0||p()}}),P(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),P(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),P(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),P(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new z4(e),this.bindStatsUploaderEvents(),this.sendMutex=new $n("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new $n("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},G("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Me(W.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Me(W.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let s;try{if(t){this.recvConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new w3(e,this.store,fa.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=tr.New,this.sendConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new w3(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{s&&s()}}async p2pConnect(e){if(!this.sendConnection)throw new Me(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=tr.Connected}async addRemoteCandidate(e,t){if(t===fa.RECEIVE_ONLY){if(!this.sendConnection)throw new Me(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Me(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,s){var r=this;return Na(function*(){const i=yield vs(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==tr.Connected){r.throwIfTrackTypeNotMatch(e);const f=e.filter(b=>r.pendingLocalTracks.indexOf(b)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(f))}r.store.pubId=r.store.pubId+1,Li.markPublishStart(r.store.clientId,r.store.pubId);const l=r.filterTobePublishedTracks(e,t,s);if(l.length===0)return void(yield vs(r.tryToUnmuteAudio(e)));l.forEach(f=>{let{track:b,type:w}=f;const _=Date.now();r.store.publish(b.getTrackId(),w===at.LocalAudioTrack?"audio":"video",_)}),r.bindLocalTrackEvents(l);const A=yield vs(r.sendConnection.send(l.map(f=>{let{track:b}=f;return b}),r.store.codec,r.store.audioCodec)),u=(yield vs(A.next())).value,p=r.createGatewayPublishMessage(l,u);try{yield p}catch(f){throw A.throw(f),(f==null?void 0:f.code)===W.WS_ABORT&&l.forEach(b=>{let{track:w}=b;r.pendingLocalTracks.indexOf(w)===-1&&r.pendingLocalTracks.push(w)}),r.unbindLocalTrackEvents(l),f}yield vs(A.next()),l.forEach(f=>{let{type:b}=f;r.statsCollector.addLocalStats(b)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(l,u),l.forEach(f=>{let{track:b,type:w}=f;const _=Date.now();r.store.publish(b.getTrackId(),w===at.LocalAudioTrack?"audio":"video",void 0,_)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==tr.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!nt(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const s=t.find(i=>i[0]==="videoLowTrack");s&&s[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:l}]=i;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[l,{track:A}]=i;return{type:l,track:A}})),t.forEach(i=>{let[l]=i;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===tr.Connected)return s&&s[1].track.close(),r;e.forEach(i=>{const l=this.pendingLocalTracks.indexOf(i);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],s=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:l,ssrcs:A}]=r;const u={stream_type:tte(l,i),ssrcs:A};l._muted||!l._enabled?t.push(u):s.push(u)}),t.length>0&&t.forEach(r=>{wr(this,Vt.RequestMuteLocal,[r])}),s.length>0&&s.forEach(r=>{wr(this,Vt.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Na(function*(){throw new Me(W.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await wn(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Me(W.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,s,r){var i;if(!this.recvConnection)throw new Me(W.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:l,mid:A,transceiver:u}=await this.recvConnection.receive(t,[{ssrcId:s}],String(e.uid),r);t===Tt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new yf(l,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=s,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new _f(l,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack));const p=this.remoteUserMap.get(e);p?p.set(t,A):this.remoteUserMap.set(e,new Map([[t,A]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const f=this.pendingRemoteTracks.findIndex(b=>{let{user:w,kind:_}=b;return w.uid===e.uid&&t===_});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Vt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,s,r){if(!this.recvConnection)throw new Me(W.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:s}],String(e.uid),r)}async unsubscribe(e,t,s){const r=this.pendingRemoteTracks.filter(l=>{let{user:A,kind:u}=l;return t!==void 0?A.uid===e.uid&&t===u:A.uid===e.uid});if(r.forEach(l=>{const A=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(A,1)}),this.recvConnection||s||r.forEach(l=>{let{kind:A}=l;var u;if(A===Tt.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(A===Tt.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(l=>{let[,{id:A}]=l;return A})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(l=>{let[A,{kind:u}]=l;var p,f;if(u===Tt.VIDEO&&A._videoSSRC&&((p=this.recvConnection)===null||p===void 0||p.setStatsRemoteVideoIsReady(A._videoSSRC,!1)),u===Tt.VIDEO)this.unbindRemoteTrackEvents(A._videoTrack),s||((f=A._videoTrack)===null||f===void 0||f._destroy(),A._videoTrack=void 0);else if(u===Tt.AUDIO){var b;this.unbindRemoteTrackEvents(A._audioTrack),!s&&((b=A._audioTrack)===null||b===void 0||b._destroy(),A._audioTrack=void 0)}}),i.forEach(l=>{let[,{kind:A}]=l;wr(this,Vt.RequestP2PMuteRemote,A)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,s]=t;[Tt.VIDEO,Tt.AUDIO].forEach(r=>{s.has(r)?wr(this,Vt.RequestP2PUnmuteRemote,r):wr(this,Vt.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Me(W.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Me(W.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Me(W.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Me(W.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Tt.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(t)||N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(at.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Tn){const s=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==at.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===at.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[r]=s;return!(e&&r===at.LocalVideoLowTrack)}).map(s=>{let[,{track:r}]=s;return r})}reportPublishEvent(e,t,s,r,i){if(e){const A=this.localTrackMap.get(at.LocalAudioTrack),u=r?this.localTrackMap.get(at.LocalVideoLowTrack):this.localTrackMap.get(at.LocalVideoTrack);kt.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:A==null?void 0:A.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(rr.SCREEN_TRACK))!==-1,audio:!!A,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var l;s||(s=[]);const A=s.find(p=>p instanceof $r),u=r?(l=this.localTrackMap.get(at.LocalVideoTrack))===null||l===void 0?void 0:l.track:s.find(p=>p instanceof xr);kt.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:A==null?void 0:A.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(rr.SCREEN_TRACK))!==-1,audio:!!A,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,s,r){const i=r===Tt.VIDEO?s._videoSSRC:s._audioSSRC;i&&kt.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Tt.VIDEO,audio:r===Tt.AUDIO,peerid:s.uid,subscribeRequestid:r===Tt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,i)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new $n("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new $n("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(at.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Tn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(s=>{t.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=tr.Disconnected}getStats(e){var t,s;return e?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(at.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(at.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof xr||t&&t.track instanceof $r?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;const s=Array.from(Wi(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[r]=s;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(at.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Kh(e).call(e,(s,r)=>s.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=tr.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&((s=t._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:r}]=e;switch(s){case at.LocalVideoTrack:nt(t=r._hints).call(t,rr.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case at.LocalAudioTrack:r instanceof Tn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case at.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Wi(s).call(s)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Vt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const s of this.pendingRemoteTracks){const{user:r,kind:i}=s;if((e instanceof Bu?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let s,r;if(e===fa.SEND_ONLY){if(!this.sendConnection)throw new Me(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new Me(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const l=await wn(this,Vt.RequestP2PRestartICE,{direction:fa.RECEIVE_ONLY,iceParameter:i});await r.restartICE(l),r.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(at.LocalVideoTrack),s=this.localTrackMap.get(at.LocalAudioTrack),r=e.videoSend.find(C=>{var U;return C.ssrc===(t==null||(U=t.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)}),i=e.audioSend.find(C=>{var U;return C.ssrc===(s==null||(U=s.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)});if(!r||!i)return 1;const l=fo(this,Vt.NeedSignalRTT),A=r?r.rttMs:void 0,u=i?i.rttMs:void 0,p=A&&u?(A+u)/2:A||u,f=(p&&l?(p+l)/2:p||l)||0,b=100*e.sendPacketLossRate*.7/50+.3*f/1500,w=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,_=t==null?void 0:t.track;if(_&&_._encoderConfig&&_._hints.indexOf(rr.SCREEN_TRACK)===-1){const C=_._encoderConfig.bitrateMax,U=e.bitrate.actualEncoded;if(C&&U){const B=(1e3*C-U)/(1e3*C);return PU[B<.15?0:B<.3?1:B<.45?2:B<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[r]=s;const i=r._audioSSRC,l=r._videoSSRC,A=e.audioRecv.find(U=>U.ssrc===i),u=e.videoRecv.find(U=>U.ssrc===l);if(!A&&!u)return void(t+=1);const p=fo(this,Vt.NeedSignalRTT),f=e.rtt,b=(f&&p?(f+p)/2:f||p)||0,w=A?A.jitterMs:void 0,_=e.recvPacketLossRate;let C=.7*_*100/50+.3*b/1500;w&&(C=.6*_*100/50+.2*b/1500+.2*w/400),t+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new mt((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}filterTobePublishedTracks(e,t,s){const r=[],i=Ls(),l=this.getAllTracks();e=lf(e=e.filter(p=>l.indexOf(p)===-1));let A=!1,u=!1;for(const p of e){if(p instanceof xr&&(this.localTrackMap.has(at.LocalVideoTrack)||A?new Me(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:p,type:at.LocalVideoTrack}),A=!0),t)){const f=this.getLowVideoTrack(p,s);r.push({track:f,type:at.LocalVideoLowTrack})}if(p instanceof $r){const f=this.localTrackMap.get(at.LocalAudioTrack);if(f){if(!(f.track instanceof Tn))throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(u){const b=r.find(w=>{let{type:_}=w;return _===at.LocalAudioTrack});if(!(b.track instanceof Tn))throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(p)}else{if(!i.webAudioMediaStreamDest||p instanceof Tn||p._bypassWebAudio)r.push({track:p,type:at.LocalAudioTrack});else{const b=new Tn;b.addAudioTrack(p),r.push({track:b,type:at.LocalAudioTrack})}u=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],s=this.getAllTracks();e=lf(e=e.filter(r=>s.indexOf(r)!==-1));for(const r of e){if(r instanceof $r){const i=this.localTrackMap.get(at.LocalAudioTrack);if(!i)continue;i.track instanceof Tn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([at.LocalAudioTrack,i]),i.track.close())):t.push([at.LocalAudioTrack,i])}if(r instanceof xr){const i=this.localTrackMap.get(at.LocalVideoTrack);if(!i)continue;t.push([at.LocalVideoTrack,i]);const l=this.localTrackMap.get(at.LocalVideoLowTrack);l&&t.push([at.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:s,type:r}=t;switch(r){case at.LocalVideoTrack:s.addListener(Bt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case at.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case at.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Tn?e.trackList.forEach(s=>{s.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Bt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Bt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[s,{track:r}]=t;return{track:r,type:s}})),e.forEach(t=>{let{track:s,type:r}=t;switch(r){case at.LocalVideoTrack:s.off(Bt.GET_STATS,this.handleGetLocalVideoStats),s.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case at.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case at.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Tn?e.trackList.forEach(t=>{t.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Bt.GET_STATS,this.handleGetLocalAudioStats),t.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Bt.GET_STATS,this.handleGetLocalAudioStats),e.off(Bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof _f&&t.addListener(Bt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),t instanceof yf&&t.addListener(Bt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Bt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(Tt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(Tt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((s,r)=>{var i;let l,{track:A,type:u}=s;switch(u){case at.LocalAudioTrack:l=cr.Audio;break;case at.LocalVideoTrack:l=nt(i=A._hints).call(i,rr.SCREEN_TRACK)?cr.Screen:cr.High;break;case at.LocalVideoLowTrack:l=cr.Low}return{kind:u===at.LocalAudioTrack?Tt.AUDIO:Tt.VIDEO,stream_type:l,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:A.muted||!A.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case at.LocalVideoTrack:r=nt(s=l._hints).call(s,rr.SCREEN_TRACK)?cr.Screen:cr.High;break;case at.LocalAudioTrack:r=cr.Audio;break;case at.LocalVideoLowTrack:r=cr.Low}return{stream_type:r,ssrcs:A,mid:u}})}assignLocalTracks(e,t){e.forEach((s,r)=>{let{track:i,type:l}=s;this.localTrackMap.set(l,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[s]=t;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var s;N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Vt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),nt(s=this._restartStates).call(s,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Qn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),kt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:br.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var s;const r=Array.from(Wi(s=this.remoteUserMap).call(s)).find(l=>l._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Ac.FIRST_FRAME_DECODED),kt.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_DECODE,Dr.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var s;const r=Array.from(Wi(s=this.remoteUserMap).call(s)).find(i=>i._audioSSRC===t);r&&kt.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_RECEIVED,Dr.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,s,r)=>{this.reportVideoFirstFrameDecoded(t,s,r)},e.onFirstVideoReceived=t=>{var s;const r=Array.from(Wi(s=this.remoteUserMap).call(s)).find(i=>i._videoSSRC===t);r&&kt.firstRemoteFrame(this.store.sessionId,Nn.FIRST_VIDEO_RECEIVED,Dr.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,s)=>{const r=t.candidateType==="relay",i=s.candidateType==="relay";s.candidateType!=="unknown"&&r===i||this.emit(Vt.ConnectionTypeChange,r),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ku(s))," -> ").concat(JSON.stringify(ku(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,s)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ku(s))," -> ").concat(JSON.stringify(ku(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Vt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===fa.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,N.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===fa.SEND_ONLY?this.restartICE(e):wn(this,Vt.RequestP2PRestartICE,{direction:fa.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const s=this.localTrackMap.get(at.LocalAudioTrack);if(e instanceof $r&&(s==null?void 0:s.track)instanceof Tn)return s.track.isActive||t.push([at.LocalAudioTrack,s]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:l}]=i;return e===l});if(r&&(t.push(r),r[0]===at.LocalVideoTrack)){const i=this.localTrackMap.get(at.LocalVideoLowTrack);i&&t.push([at.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],s=this.localTrackMap.get(at.LocalAudioTrack);if(e instanceof $r&&(s==null?void 0:s.track)instanceof Tn)return s.track.isActive&&t.push([at.LocalAudioTrack,s]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:l}]=i;return e===l});if(r)if(r[0]===at.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(at.LocalVideoLowTrack);i&&t.push([at.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case at.LocalAudioTrack:r=cr.Audio;break;case at.LocalVideoTrack:r=nt(s=l._hints).call(s,rr.SCREEN_TRACK)?cr.Screen:cr.High;break;case at.LocalVideoLowTrack:r=cr.Low}return{stream_type:r,ssrcs:A,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case at.LocalAudioTrack:r=cr.Audio;break;case at.LocalVideoTrack:r=nt(s=l._hints).call(s,rr.SCREEN_TRACK)?cr.Screen:cr.High;break;case at.LocalVideoLowTrack:r=cr.Low}return{stream_type:r,ssrcs:A,mid:u}})}filterTobeUnSubscribedTracks(e,t){const s=[],r=this.remoteUserMap.get(e);if(!r)return s;if(t){const i=r.get(t);if(!i)return s;s.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[l,A]=i;s.push([e,{kind:l,id:A}])});return s}createUnsubscribeMessage(e){const t=[];return e.forEach(s=>{let[r,{kind:i,id:l}]=s;switch(i){case Tt.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Tt.VIDEO,ssrcId:r._videoSSRC}));case Tt.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Tt.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[s,{kind:r}]=t;const i=this.remoteUserMap.get(s);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(at.LocalVideoTrack),s=this.localTrackMap.get(at.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new mt((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new mt((r,i)=>{this.handleUpdateVideoEncoder(s.track,r,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof $r){const s=this.filterTobeUnmutedTracks(e[t]);if(s.length===0)continue;const r=this.createUnmuteMessage(s);return void await wr(this,Vt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Vt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Vt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Qn(ow(this.dtlsFailedCount,pn)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(at.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof xr)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof xr).length>1)throw new Me(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof $r).length>1&&(e.some(t=>t instanceof $r&&t._bypassWebAudio)||!Ls().webAudioMediaStreamDest))throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof xr&&this.pendingLocalTracks.some(s=>s instanceof xr))throw new Me(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof $r&&this.pendingLocalTracks.some(s=>s instanceof $r)&&(!Ls().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof $r&&s._bypassWebAudio)))throw new Me(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const s=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding,r=S_(S_({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=s?e._mediaStreamTrack.clone():e2(e,r);const l=ar(8,"track-low-"),A=new xr(i,S_(S_({},s&&{scaleResolutionDownBy:IN(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,l);return A.on(dp.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,ff.LOW_STREAM)}),A._hints.push(rr.LOW_STREAM),e.addListener(Bt.NEED_CLOSE,()=>{A.close()}),A}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,s,r){var i;const l=Array.from(Wi(i=this.remoteUserMap).call(i)).find(A=>A._videoSSRC===e);if(l){r||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const A=this.store.keyMetrics,u=A.subscribe.find(p=>p.userId===l.uid&&p.type==="video");kt.firstRemoteVideoDecode(this.store.sessionId,Nn.FIRST_VIDEO_DECODE,Dr.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:s,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:A.requestAPEnd||0,apStart:A.requestAPStart||0,joinGwEnd:A.joinGatewayEnd||0,joinGwStart:A.joinGatewayStart||0,pcEnd:A.peerConnectionEnd||0,pcStart:A.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const l=await this.recvConnection.getRemoteSSRC(i);return l!==void 0&&l!==s}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Me(W.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Me(W.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Me(W.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Me(W.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Me(W.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Me(W.NOT_SUPPORTED)}async preConnect(e){throw new Me(W.NOT_SUPPORTED)}getEstablishParams(){throw new Me(W.NOT_SUPPORTED)}async reSubscribe(e){throw new Me(W.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new Me(W.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===at.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ff.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},ft(Vr.prototype,"p2pConnect",[_3],Object.getOwnPropertyDescriptor(Vr.prototype,"p2pConnect"),Vr.prototype),ft(Vr.prototype,"unpublish",[y3],Object.getOwnPropertyDescriptor(Vr.prototype,"unpublish"),Vr.prototype),ft(Vr.prototype,"unpublishLowStream",[E3],Object.getOwnPropertyDescriptor(Vr.prototype,"unpublishLowStream"),Vr.prototype),ft(Vr.prototype,"subscribe",[S3],Object.getOwnPropertyDescriptor(Vr.prototype,"subscribe"),Vr.prototype),ft(Vr.prototype,"mockSubscribe",[C3],Object.getOwnPropertyDescriptor(Vr.prototype,"mockSubscribe"),Vr.prototype),ft(Vr.prototype,"unsubscribe",[N3],Object.getOwnPropertyDescriptor(Vr.prototype,"unsubscribe"),Vr.prototype),ft(Vr.prototype,"muteRemote",[T3],Object.getOwnPropertyDescriptor(Vr.prototype,"muteRemote"),Vr.prototype),ft(Vr.prototype,"unmuteRemote",[R3],Object.getOwnPropertyDescriptor(Vr.prototype,"unmuteRemote"),Vr.prototype),ft(Vr.prototype,"hasRemoteMediaWithLock",[I3],Object.getOwnPropertyDescriptor(Vr.prototype,"hasRemoteMediaWithLock"),Vr.prototype),ft(Vr.prototype,"disconnectForReconnect",[O3],Object.getOwnPropertyDescriptor(Vr.prototype,"disconnectForReconnect"),Vr.prototype),ft(Vr.prototype,"remoteMediaSsrcChanged",[k3],Object.getOwnPropertyDescriptor(Vr.prototype,"remoteMediaSsrcChanged"),Vr.prototype),Vr);function Ql(e){return function(t,s,r){const i=t[s];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var l=arguments.length,A=new Array(l),u=0;u<l;u++)A[u]=arguments[u];switch(e){case Vl.SEND_ONLY:{const p=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await i.apply(this,A)}finally{p()}}case Vl.RECEIVE_ONLY:{const p=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await i.apply(this,A)}finally{p()}}default:{const p=await this.sendMutex.lock("From P2PChannel2.".concat(s)),f=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await i.apply(this,A)}finally{p(),f()}}}},r}}class Op extends jr{constructor(t,s){super(),P(this,"signal",void 0),P(this,"token",void 0),P(this,"tokenTimeout",void 0),P(this,"tokenInterval",void 0),P(this,"_sequence",0),P(this,"userMap",new Map),P(this,"encoder",new TextEncoder),this.signal=t,this.token=s;const r=()=>{this.signal.connectionState===Fs.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*G("P2P_TOKEN_INTERVAL"))};r()}async send(t,s,r,i,l){var A;if(this.userMap.size===0)return;const u=Array.from(ho(A=this.userMap).call(A))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),i=i??ar(6,""),l=l??this._sequence++;const p={_id:i,_type:t,_seq:l,_message:s,token:"".concat(this.token,"_").concat(u)};G("SHOW_P2P_LOG")&&N.debug("send message",p,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(p)).forEach(b=>{this.signal.request(Mt.DATA_STREAM,{payload:Nu(this.encoder.encode(b))})});const f=new mt((b,w)=>{const _=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),C),this.off("res-@".concat(i),B),this.off(Tf.ABORT,U),N.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?w(new Me(W.INVALID_REMOTE_USER)):w(new Me(W.TIMEOUT))},G("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{_&&window.clearTimeout(_),this.off(Tf.ABORT,U),r&&b()},U=()=>{_&&window.clearTimeout(_),this.off("res-@".concat(i,"_ack"),C),this.off("res-@".concat(i),B),w(new Me(W.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(Tf.ABORT,U),this.once("res-@".concat(i,"_ack"),C);const B=(K,q)=>{j=!0,_&&window.clearTimeout(_),this.off("res-@".concat(i,"_ack"),C),this.off(Tf.ABORT,U),K==="success"?b(q):w(new Me(W.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let j=!1;r||(this.once("res-@".concat(i),B),Qn(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||N.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(p))}))});try{return await f}catch(b){if(b.code===W.TIMEOUT)return await this.send(t,s,r,i,l);throw b}}onMessage(t){var s;const{_uid:r}=t;let i,l=this.userMap.get(r);if(l)i=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==an.CHECK)return;const{token:f}=t;i=new Map,l={uid:r,isStart:!0,token:f,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,l),this.signal.emit(as.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var A;const{id:f,total:b}=t,w=(A=i.get(f))!==null&&A!==void 0?A:[];if(w.push(t),i.has(f)||i.set(f,w),w.length!==b)return;{const _=Kh(w).call(w,(C,U)=>C.index-U.index).map(C=>C.payload).join("");i.delete(f),(t=JSON.parse(_))._uid=r}}const{_type:u,token:p}=t;if(nt(s=[an.ACK,an.CHECK]).call(s,u))return u===an.CHECK&&this.handleCheckToken(l,p),void this.receiveMessage(t);p==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):N.debug('Receive unexpected message", '.concat(p,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:ar(6,""),token:this.token,_type:an.CHECK};G("SHOW_P2P_LOG")&&N.debug("send message",t),this.signal.request(Mt.DATA_STREAM,{payload:Nu(this.encoder.encode(JSON.stringify(t)))})}ack(t){const s={_id:t,_type:an.ACK,token:this.token};G("SHOW_P2P_LOG")&&N.debug("send message",s),this.signal.request(Mt.DATA_STREAM,{payload:Nu(this.encoder.encode(JSON.stringify(s)))})}response(t,s,r){this.send(an.RESPONSE,JSON.stringify({success:!r,message:s}),!0,t)}handleReceivedMessage(t){const s=()=>{this.userMap.forEach(f=>{const{receivedMessagesMap:b,nextExpectedSequenceNumber:w}=f;for(;b.has(w);){const _=b.get(w);b.delete(w),this.receiveMessage(_),f.nextExpectedSequenceNumber++}})};if(!t)return void s();const{_uid:r,_seq:i}=t,l=this.userMap.get(r),{receivedMessagesMap:A,isStart:u,nextExpectedSequenceNumber:p}=l;if(i<p)return this.ack(t._id),void N.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));A.set(i,t),u&&i===p&&(this.receiveMessage(t),A.delete(p),l.nextExpectedSequenceNumber++,s())}receiveMessage(t){const{_id:s,_type:r,_message:i,_uid:l}=t;if(G("SHOW_P2P_LOG")&&N.debug("receive message",t),s){let A;switch(t._type!==an.ACK&&(i&&(A=JSON.parse(i)),this.ack(t._id)),t._type){case an.CANDIDATE:case an.CONTROL:this.signal.emit(r,A,l);break;case an.PUBLISH:case an.UNPUBLISH:case an.RESTART_ICE:case an.CALL:A.uid=l,wn(this.signal,r,A).then(u=>{this.response(t._id,u)}).catch(()=>{this.response(t._id,void 0,!0)});break;case an.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case an.RESPONSE:{const{success:u,message:p}=A;this.emit("res-@".concat(s),u?"success":"failed",p);break}}}}splitMessage(t){if(t.length<Op.MAX_MESSAGE_SIZE)return[t];const s=[],{remoteToken:r}=JSON.parse(t),i=ar(6,"");let l=0,A=800;const u=Math.ceil(t.length/A);for(;t.length>0;){l++;const p={id:i,index:l,total:u,payload:t.slice(0,A),token:"".concat(this.token,"_").concat(r)};JSON.stringify(p).length>Op.MAX_MESSAGE_SIZE?A-=50:(s.push(p),t=t.slice(A))}return s.map(p=>JSON.stringify(p))}handleCheckToken(t,s){return t.token!==s?(N.debug("token changed, from ".concat(t.token," to ").concat(s)),this.reset(t.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{N.debug("token timeout, ".concat(s)),this.reset(t.uid)},G("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await wn(this.signal,an.CALL,void 0),s=await this.send(an.CALL,t);this.signal.emit(Lt.P2P_CONNECTION,s,!0)}async reset(t,s){const r=this.userMap.get(t);r&&(this.emit(Tf.ABORT),this.signal.emit(as.ON_USER_OFFLINE,{uid:r.uid,reason:Ree.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(N.debug("change local token from ".concat(s," to ").concat(s)),this.token=ar(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Tf.ABORT)}}P(Op,"MAX_SIZE",1),P(Op,"MAX_MESSAGE_SIZE",1024);class pre extends jr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Fs.CONNECTED?this.emit(Lt.WS_CONNECTED):t===Fs.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):t===Fs.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,s){super(),P(this,"__name__","P2PSignal"),P(this,"_disconnectedReason",void 0),P(this,"_websocketReconnectReason",void 0),P(this,"_connectionState",Fs.CLOSED),P(this,"reconnectToken",void 0),P(this,"p2pToken",void 0),P(this,"websocket",void 0),P(this,"openConnectionTime",void 0),P(this,"clientId",void 0),P(this,"lastMsgTime",Date.now()),P(this,"uploadCache",[]),P(this,"uploadCacheInterval",void 0),P(this,"rttRolling",new D1(5)),P(this,"pingpongTimer",void 0),P(this,"pingpongTimeoutCount",0),P(this,"joinResponse",void 0),P(this,"multiIpOption",void 0),P(this,"initError",void 0),P(this,"spec",void 0),P(this,"store",void 0),P(this,"_external_signal",void 0),P(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const l="res-@".concat(i._id);this.emit(l,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case as.ON_DATA_STREAM:return void this.handleDataStream(i._message);case as.MUTE_AUDIO:case as.MUTE_VIDEO:case as.ON_P2P_LOST:case as.ON_USER_ONLINE:return;case as.ON_USER_OFFLINE:const{uid:l}=i._message;return N.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(i._type,i._message),i._type===as.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===as.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Us.UID_BANNED);break;case 15:this.close(Us.IP_BANNED);break;case 16:this.close(Us.CHANNEL_BANNED)}if(i._type===as.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Gt.ERR_LICENSE_MISSING:this.close(Us.LICENSE_MISSING);break;case Gt.ERR_LICENSE_EXPIRED:this.close(Us.LICENSE_EXPIRED);break;case Gt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Us.LICENSE_MINUTES_EXCEEDED);break;case Gt.ERR_LICENSE_PERIOD_INVALID:this.close(Us.LICENSE_PERIOD_INVALID);break;case Gt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Us.LICENSE_MULTIPLE_SDK_SERVICE);break;case Gt.ERR_LICENSE_ILLEGAL:this.close(Us.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new NN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Fs.CONNECTED&&this.reconnect("retry",yi.OFFLINE)}),this.p2pToken=ar(6,""),this._external_signal=new Op(this,this.p2pToken)}async request(t,s,r,i){const l=ar(6,""),A={_id:l,_type:t,_message:s},u=this.websocket.connectionID,p=()=>new mt((U,B)=>{if(this.connectionState===Fs.CONNECTED)return U();const j=()=>{this.off(Lt.WS_CLOSED,K),U()},K=()=>{this.off(Lt.WS_CONNECTED,j),B(new Me(W.WS_ABORT))};this.once(Lt.WS_CONNECTED,j),this.once(Lt.WS_CLOSED,K)});if(this.connectionState!==Fs.CONNECTING&&this.connectionState!==Fs.RECONNECTING||t===Mt.JOIN||t===Mt.REJOIN||await p(),this.websocket.sendMessage(A,!0),i)return;const f=new mt((U,B)=>{let j=!1;const K=(ie,xe)=>{j=!0,U({isSuccess:ie==="success",message:xe||{}}),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.emit(Lt.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(l),K);const q=()=>{B(new Me(W.WS_ABORT,"type: ".concat(t))),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.off("res-@".concat(l),K)};this.once(Lt.WS_CLOSED,q),this.once(Lt.WS_RECONNECTING,q),Qn(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||j||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Lt.REQUEST_TIMEOUT,t,s))})});let b=null;try{b=await f}catch(U){if(this.connectionState===Fs.CLOSED||t===Mt.LEAVE)throw new Me(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?U.throw():t===Mt.JOIN||t===Mt.REJOIN?null:(await p(),await this.request(t,s))}if(b.isSuccess)return b.message;const w=Number(b.message.error_code||b.message.code),_=bp(w),C=new Me(W.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(b.message.error_str),{code:w,data:b.message,desc:_.desc});return _.action==="success"?b.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(_.desc,", action: ").concat(_.action)),w===Gt.ERR_TOO_MANY_BROADCASTERS?((t===Mt.JOIN||t===Mt.REJOIN)&&(this.initError=C,this.close()),C.throw()):_.action==="failed"?C.throw():_.action==="quit"?(this.initError=C,this.close(),C.throw()):(w===Gt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yi.MULTI_IP)):this.reconnect(_.action,yi.SERVER_ERROR),t===Mt.JOIN||t===Mt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new mt(r=>{const i=l=>{(!s||s(l))&&(this.off(t,i),r(l))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(gp.WRTC_STATS,s)}upload(t,s){const r={_type:t,_message:s};try{this.websocket.sendMessage(r)}catch{const l=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Fs.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,s){const r={_type:t,_message:s};this.websocket.sendMessage(r)}async sendExtensionMessage(t,s,r){return await this._external_signal.send(t,s,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new mt((s,r)=>{this.once(Lt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Lt.WS_CLOSED,()=>r(this.initError||new Me(W.WS_ABORT))),this.connectionState=Fs.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Us.LEAVE,this.connectionState=Fs.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ar(6,""),this._external_signal.clear(),this._external_signal=new Op(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION);const t=await wn(this,Lt.REQUEST_JOIN_INFO),s=await this.request(Mt.JOIN,t);if(!s)return this.emit(Lt.REPORT_JOIN_GATEWAY,W.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Fs.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){return!1}handleDataStream(t){try{var s;const r=ip(t.payload),i=new TextDecoder().decode(r),l=JSON.parse(i);"total"in l&&"id"in l||nt(s=Object.values(an)).call(s,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(as.ON_DATA_STREAM,t)}catch{this.emit(as.ON_DATA_STREAM,t)}}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);const s=bp(t.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?t.code===Gt.ERR_REPEAT_JOIN_CHANNEL&&G("IGNORE_UID_CHECK")?void this.close(Us.UID_CONFLICT):(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Us.UID_BANNED),void this.close()):void this.reconnect(s.action,yi.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=G("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yi.TIMEOUT):this.request(Mt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-s;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Mt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(us.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(us.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(us.CLOSED,()=>{this.connectionState=Fs.CLOSED}),this.websocket.on(us.FAILED,()=>{this._disconnectedReason=Us.NETWORK_ERROR,this.connectionState=Fs.CLOSED}),this.websocket.on(us.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Fs.CONNECTED?this.connectionState=Fs.RECONNECTING:this.connectionState=Fs.CONNECTING}),this.websocket.on(us.WILL_RECONNECT,(t,s,r)=>{t!=="retry"?(N.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):N.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(us.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Me&&t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Gt.ERR_NO_AUTHORIZED)return N.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",yi.SERVER_ERROR);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yi.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(us.REQUEST_NEW_URLS,(t,s)=>{wn(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(us.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(as.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const mre={name:"P2PChannel",create:function(e){let{store:t,statsCollector:s}=e;return new hre(t,s)},createSubmodule:function(e){let{store:t,spec:s}=e;return new pre(s,t)}};function B3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function L3(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?B3(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):B3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class fre{constructor(t){P(this,"sessionDesc",void 0),P(this,"localCapabilities",void 0),P(this,"rtpCapabilities",void 0),P(this,"candidates",void 0),P(this,"_originCandidates",void 0),P(this,"iceParameters",void 0),P(this,"dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname",void 0),t=Rr(t);const{iceParameters:s,dtlsParameters:r,candidates:i,rtpCapabilities:l,setup:A,localCapabilities:u,sdkCodec:p,cname:f}=t,b=ha(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=i,this._originCandidates=Rr(i),this.iceParameters=s,this.dtlsParameters=r,this.setup=A,this.localCapabilities=u,this.cname=f;for(let w=0;w<b.mediaDescriptions.length;w++){const _=b.mediaDescriptions[w];if(_.attributes.iceUfrag=s.iceUfrag,_.attributes.icePwd=s.icePwd,_.attributes.fingerprints=r.fingerprints,_.attributes.candidates=i,_.attributes.setup=A,_.media.mediaType==="video"){_.media.fmts=l.videoCodecs.map(B=>B.payloadType.toString(10));const C=l.videoCodecs.filter(B=>{var j,K;return(j=B.rtpMap)===null||j===void 0?void 0:nt(K=j.encodingName.toLowerCase()).call(K,p)}),U=l.videoCodecs.filter(B=>!nt(C).call(C,B));_.attributes.payloads=[...C,...U],_.attributes.extmaps=l.videoExtensions}_.media.mediaType==="audio"&&(_.media.fmts=l.audioCodecs.map(C=>C.payloadType.toString(10)),_.attributes.payloads=l.audioCodecs,_.attributes.extmaps=l.audioExtensions),b.mediaDescriptions[w]=this.mungMediaDesc(_)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return CA(this.sessionDesc)}send(t,s,r){const{ssrcs:i,ssrcGroups:l}=W0(s,this.cname),A=this.sessionDesc.mediaDescriptions.find(f=>t===Tt.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),u=i[0].attributes.label,p=i[0].attributes.mslabel;return A.attributes.ssrcs=A.attributes.ssrcs.concat(i),A.attributes.ssrcGroups=A.attributes.ssrcGroups.concat(l),{id:u,mslabel:p}}batchSend(t){return t.map(s=>{let{kind:r,ssrcMsg:i}=s;return this.send(r,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(s=>{const r=[],i=[],l=[];s.attributes.ssrcs.forEach(A=>{nt(t).call(t,A.attributes.label||"")?l.push(A):r.push(A)}),s.attributes.ssrcGroups.forEach(A=>{var u;nt(u=l.map(p=>p.ssrcId)).call(u,A.ssrcIds[0])||i.push(A)}),s.attributes.ssrcs=r,s.attributes.ssrcGroups=i})}mute(t){const s=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(t){const s=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(t,s,r){t.forEach((i,l)=>{const A=i._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===A.kind),p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],i);this.sessionDesc.mediaDescriptions[u]=p})}stopReceiving(t){}updateCandidates(t){const s=this._originCandidates.filter(i=>i.transport==="udp"),r=[];if(s.forEach(i=>{r.push(L3(L3({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),s.length!==0){switch(t){case Zn.TCP_RELAY:this.candidates=r;break;case Zn.UDP_TCP_RELAY:case Zn.RELAY:this.candidates=[...s,...r];break;default:this.candidates=s}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Rr(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=t.iceUfrag,s.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const s=[];for(let r=0;r<t;r++)s.push((this.currentMidIndex+r+1).toString(10));return s}mungRecvMediaDsec(t,s){const r=Rr(t);return xp(r,s),DN(r,s),r}updateRecvMedia(t,s){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],s);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,s,r){const i=this.sessionDesc.mediaDescriptions.find(A=>t===Tt.VIDEO?A.attributes.mid==="video":A.attributes.mid==="audio");if(i){const A=i.attributes.ssrcs.find(u=>u.attributes.label===s);var l;A&&(A.attributes.label=r,(l=A.attributes.msid)===null||l===void 0||l.replace(s,r))}}mungMediaDesc(t){const s=Rr(t);return kN(s),function(r){const i=r.attributes.extmaps.find(l=>Qw(l.extensionName));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach(l=>{const A=l.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");A!==-1&&l.rtcpFeedbacks.splice(A,1)})}(s),s}getSSRC(t){for(const s of this.sessionDesc.mediaDescriptions)for(const r of s.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var _r;function j3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function C_(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?j3(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):j3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let gre=(_r=class Ob extends Pw{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return nt(s=Object.keys(cp)).call(s,t)}))]}constructor(t,s){super(t,s),P(this,"store",void 0),P(this,"peerConnection",void 0),P(this,"remoteSDP",void 0),P(this,"initialOffer",void 0),P(this,"statsFilter",void 0),P(this,"useRTX",!1),P(this,"localCapabilities",void 0),P(this,"localCandidateCount",0),P(this,"allCandidatesReceived",!1),P(this,"establishPromise",void 0),P(this,"mutex",void 0),this.store=s,this.mutex=new $n("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Ob.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Aw(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Tr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Od(t.sdp),r=K0(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,C_(C_({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new Me(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new fre(C_(C_({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(t,s){throw new Me(W.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,s){var r=this;return Na(function*(){const i=yield vs(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(_=>r.peerConnection.addTrack(_._mediaStreamTrack)),A=yield vs(r.peerConnection.createOffer()),u=ha(A.sdp),p=t.map(_=>{const C=_._mediaStreamTrack,U=u.mediaDescriptions.find(B=>B.attributes.mid===C.kind);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return function(B,j,K){const q=B.attributes.ssrcs.filter(xe=>xe.attributes.label===j),ie=B.attributes.ssrcGroups;if(q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ie&&q.length>1){const xe=ie.find(ye=>ye.ssrcIds.indexOf(q[0].ssrcId)!==-1);return xe?[{ssrcId:xe.ssrcIds[0],rtx:K?xe.ssrcIds[1]:void 0}]:[{ssrcId:q[0].ssrcId}]}return[{ssrcId:q[0].ssrcId}]}(U,C.id,r.useRTX)});let f;try{f=yield p}catch(_){throw l.forEach(C=>{Jn()&&C.replaceTrack(null),r.peerConnection.removeTrack(C)}),_}const b=r.mungSendOfferSDP(A.sdp,t);r.remoteSDP.receive(t,s,f);const w=r.remoteSDP.toString();return yield vs(r.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield vs(r.applySendEncodings(l,t)),yield vs(r.peerConnection.setRemoteDescription({type:"answer",sdp:w})),t.map((_,C)=>{const U=_._mediaStreamTrack.id;return{localSSRC:p[C],id:U}})}catch(l){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(l=>{var A;return t.indexOf(((A=l.track)===null||A===void 0?void 0:A.id)||"")!==-1});if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(l=>{Jn()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:A}=this.remoteSDP.send(t,s,i),u=new mt((b,w)=>{const _=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(l)))},1e4),C=U=>{const B=zs();if((B.name==="Safari"&&Number(B.version)===11||Ki())&&U.track.id!==l&&U.streams[0].id===A){var j;const K=U.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(t,l,U.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(_),void b(K)}if(U.track.id===l)return this.peerConnection.removeEventListener("track",C),clearTimeout(_),void b(U.track)};this.peerConnection.addEventListener("track",C)}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await u,id:l}}catch(l){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(s.length!==t.length)throw new Error("sender' length doesn't match mids' length.");s.map(r=>{if(Jn()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(l=>l.active=!1),r.setParameters(i)}})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(l=>{var A;return t.indexOf(((A=l.track)===null||A===void 0?void 0:A.id)||"")!==-1});if(s.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async l=>{if(Jn()&&l.track)l.track.enabled=!0;else{const A=l.getParameters();A.encodings.forEach(u=>u.active=!0),await l.setParameters(A)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return Na(function*(){const r=yield vs(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ls().supportPCSetConfiguration;if(t===Zn.RELAY&&!i)return;if(i){const f=s.peerConnection.getConfiguration(),b=t===Zn.RELAY?"relay":"all";f.iceTransportPolicy!==b&&(N.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(b,"]")),f.iceTransportPolicy=b,s.peerConnection.setConfiguration(f))}t!==Zn.RELAY&&s.remoteSDP.updateCandidates(t);const l=yield vs(s.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const A=Od(l.sdp),{remoteIceParameters:u}=yield A.iceParameters;s.remoteSDP.restartICE(u);const p=s.remoteSDP.toString();yield vs(s.peerConnection.setLocalDescription(l)),yield vs(s.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(i){N.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Me(W.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,s){const r=this.peerConnection.getSenders().filter(i=>{var l;return((l=i.track)===null||l===void 0?void 0:l.id)===t});r.length===1&&await this.applySendEncodings(r,[s])}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){const r=this.peerConnection.getSenders().find(i=>{var l;return((l=i.track)===null||l===void 0?void 0:l.id)===s});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,s){throw new Me(W.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Me(W.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const s={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(tp(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...Ob.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Ob.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{r.security?r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(t,s){var r;if(s||(s=this.peerConnection.getSenders().find(f=>{var b;return((b=f.track)===null||b===void 0?void 0:b.id)===t._mediaStreamTrack.id})),!s)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ls().supportSetRtpSenderParameters)return N.warn("Browser not support set rtp-sender parameters");const i={},l={};if(t instanceof xr)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(G("DSCP_TYPE")&&Sd()){var A;const f=G("DSCP_TYPE");nt(A=["very-low","low","medium","high"]).call(A,f)&&(l.networkPriority=f)}const u=s.getParameters(),p=(r=u.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,l),Object.assign(u,i),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await s.setParameters(u)}async applySendEncodings(t,s){try{if(!Ls().supportSetRtpSenderParameters||t.length!==s.length)return;for(let r=0;r<t.length;r++){const i=t[r],l=s[r];i&&l&&await this.updateRtpSenderEncodings(l,i)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s){const r=ha(t);return s.forEach((i,l)=>{const A=i._mediaStreamTrack,u=r.mediaDescriptions.find(p=>p.attributes.mid===A.kind);u&&xp(u,i)}),CA(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,s,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(t).map((l,A)=>{let{id:u,mslabel:p}=l;const{kind:f}=t[A];return new mt((b,w)=>{const _=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(u)))},1e4),C=U=>{const B=zs();if(B.name==="Safari"&&Number(B.version)===11&&U.track.id!==u&&U.streams[0].id===p){var j;const K=U.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(f,u,U.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(_),void b({track:K,id:u})}if(U.track.id===u)return this.peerConnection.removeEventListener("track",C),clearTimeout(_),void b({track:U.track,id:u})};this.peerConnection.addEventListener("track",C)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await mt.all(s)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(t);return s==null?void 0:s[0].ssrcId}setConfiguration(t){if(Ls().supportPCSetConfiguration){const s=Ob.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}}},ft(_r.prototype,"connect",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"connect"),_r.prototype),ft(_r.prototype,"stopSending",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"stopSending"),_r.prototype),ft(_r.prototype,"receive",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"receive"),_r.prototype),ft(_r.prototype,"stopReceiving",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"stopReceiving"),_r.prototype),ft(_r.prototype,"muteRemote",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"muteRemote"),_r.prototype),ft(_r.prototype,"unmuteRemote",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"unmuteRemote"),_r.prototype),ft(_r.prototype,"muteLocal",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"muteLocal"),_r.prototype),ft(_r.prototype,"unmuteLocal",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"unmuteLocal"),_r.prototype),ft(_r.prototype,"close",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"close"),_r.prototype),ft(_r.prototype,"updateEncoderConfig",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"updateEncoderConfig"),_r.prototype),ft(_r.prototype,"updateSendParameters",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"updateSendParameters"),_r.prototype),ft(_r.prototype,"replaceTrack",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"replaceTrack"),_r.prototype),ft(_r.prototype,"getRemoteSSRC",[gc],Object.getOwnPropertyDescriptor(_r.prototype,"getRemoteSSRC"),_r.prototype),_r);function gc(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("Locking from P2PConnection.".concat(t));try{for(var A=arguments.length,u=new Array(A),p=0;p<A;p++)u[p]=arguments[p];return await r.apply(this,u)}finally{l()}},s}const bre={name:"PlanBConnection",create:function(e){let{store:t,spec:s}=e;return new gre(s,t)}},xre={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ls().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(Ew.has(e)||!e.track)return;const s={track:e.track};if(EA()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(A){return void N.error("create audio-encoded-streams error",A&&A.message)}const l=new TransformStream({transform(A,u){s.controller||(s.controller=u),e.track&&e.track.id!==s.track.id&&(N.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r));const p=t.metadata&&t.metadata();p?function(f,b){const{chunk:w,controller:_}=b,C=Tu.METADATA;w.data=function(U,B,j){const K=j.byteLength,q=K+dN+RU,ie=cN+lN+q,xe=new ArrayBuffer(U.byteLength+ie),ye=new DataView(xe);ye.setUint8(0,TU),ye.setUint16(1,q),ye.setUint8(3,B),ye.setUint16(4,K);for(let Re=0;Re<K;Re++)ye.setUint8(6+Re,j[Re]);const ue=new Uint8Array(ye.buffer);return ue.set(new Uint8Array(U),ie),ue.buffer}(w.data,C,f),_.enqueue(w)}(p,{chunk:A,controller:u}):u.enqueue(A)}});i.readable.pipeThrough(l).pipeTo(i.writable)}else if(Jn()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const i=yw(),l=new MessageChannel;await new mt(u=>i.onmessage=p=>{p.data==="registered"&&u(void 0)});const A=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=A,await new mt(u=>i.onmessage=p=>{p.data==="started"&&u(void 0)}),l.port1.onmessage=u=>{var p;if(u.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==s.track.id)N.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r);else if(u.data.getMetadata){const f=t.metadata&&t.metadata();f&&l.port1.postMessage({metadata:f})}},s.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Ew.get(e);if(i){Ew.delete(e);try{var l,A;(l=i.controller)===null||l===void 0||l.terminate(),(A=i.worker)===null||A===void 0||A.terminate()}catch(u){N.warning(u&&u.message)}}}Ew.set(e,s),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ls().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(Iw.has(e))return;const s={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(EA()&&!Ki()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");x1(Ys.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(A){return void N.error("create audio-encoded-streams error",A&&A.message)}const l=new TransformStream({transform(A,u){s.controller||(s.controller=u),e.track&&e.track.id!==s.track.id&&(N.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r)),t.enableTopn?function(p,f,b){var w;const _=AN(new DataView(f.data));if(!_)return b.enqueue(f);const C=p.track.id;XZ.set(C,p.track);const U=(w=_.tlv.find(xe=>xe.tag===Tu.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let B=0;typeof U=="number"&&(B=127-U);const j=Math.round(Math.pow(10,B/60)-1),{selected:K,speaker:q}=function(xe,ye){let ue=Ef.get(xe);if(ue||(ue=function(Re){const Ge=new OU;return Ef.set(Re,Ge),Dl||(Dl=new qZ(G("TOPN_SILENCE_THRESHOLD")||500),Dl.on("ActiveSpeakerChanged",Ze=>{Ze!=null&&(Nw=Ze)})),Dl.addSpeakers([Ge]),Ge}(xe)),Ef.size<=kU)return{selected:!0,speaker:ue};if(!Dl)throw new Error("no active speaker detector");return Dl.levelChanged(ue.id,ye),pp=Dl.loudest.map(Re=>Re.id),Nw&&!nt(pp).call(pp,Nw)&&pp.length>=kU&&pp.pop(),{selected:nt(pp).call(pp,ue.id)||ue.id===Nw,speaker:ue}}(p,j),ie=function(xe,ye,ue){const Re=Bl.get(xe)||new YZ(xe,ye);return Re.score=ue,Bl.set(xe,Re),function(Ge){if(Tw.set(Ge,!0),!Rw)return void(Rw=Date.now());const Ze=Date.now();Ze-Rw>1e3&&(Tw.get(Ge)?Tw.set(Ge,!1):(DU(Ge),Tw.delete(Ge)),Rw=Ze)}(xe),Re}(C,p.track,q.energyScore);ie.addSample(K),ie.active&&(f.data=_.frame.buffer,b.enqueue(f))}(e,A,u):t.enableMetadata||t.enablePts?function(p,f,b,w){const _=new DataView(p.data),C=_.getUint8(0);let U;if(128&C&&C!==71){const K=function(q){if(q.byteLength<=0)return[];const ie=[];let xe=0;for(;xe<q.byteLength;){const ue=(128&q.getUint8(xe))>>7,Re=127&q.getUint8(xe);if(!(ue&&xe+4<=q.byteLength)){xe++;break}{const Ge=q.getUint32(xe,!1),Ze=(16776192&Ge)>>10,_t=1023&Ge;ie.push({pt:Re,ts_offset:Ze,length:_t,data:new Uint8Array}),xe+=4}}let ye=q.byteLength-xe;for(const ue of ie){if(ue.length>ye)return console.warn("Broken red payload"),[];ue.length>0&&(ue.data=new Uint8Array(q.buffer,q.byteOffset+xe,ue.length),xe+=ue.length,ye-=ue.length)}if(ye>0){const ue={pt:ie.length>0?ie[ie.length-1].pt:0,ts_offset:0,length:ye,data:new Uint8Array(q.buffer,q.byteOffset+xe,ye)};ie.push(ue)}return ie}(_);if(K.length>0){const q=function(ie){let xe=0;for(let Re=0;Re<ie.length;Re++)xe+=Re<ie.length-1?4:1,xe+=ie[Re].length;const ye=new Uint8Array(xe);let ue=0;for(let Re=0;Re<ie.length;Re++)if(Re<ie.length-1){const Ge=(2147483648|(127&ie[Re].pt)<<24|(262143&ie[Re].ts_offset)<<10|1023&ie[Re].length)>>>0;ye[ue++]=Ge>>24&255,ye[ue++]=Ge>>16&255,ye[ue++]=Ge>>8&255,ye[ue++]=255&Ge}else ye[ue++]=127&ie[Re].pt;for(const Re of ie)ye.set(Re.data,ue),ue+=Re.length;return ye}(K.map(ie=>{const xe=new Uint8Array(ie.length);xe.set(ie.data);const ye=AN(new DataView(xe.buffer));return ye!=null&&ye.frame&&(ie.data=ye==null?void 0:ye.frame),U=ye,ie}));p.data=q.buffer}}else U=AN(_),U&&(p.data=U.frame.buffer);if(f.enqueue(p),!U)return;const B=U.tlv.find(K=>K.tag===Tu.METADATA);B&&b&&B.value instanceof Uint8Array&&b(B.value);const j=U.tlv.find(K=>K.tag===Tu.AUDIO_64_BIT_PTS);j&&w&&j.value instanceof Uint8Array&&j.value.length==8&&w(new DataView(j.value.buffer).getBigUint64(0,!0))}(A,u,t.onMetadata,t.onPts):u.enqueue(A)}});i.readable.pipeThrough(l).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const i=yw(),l=new MessageChannel;await new mt(u=>i.onmessage=p=>{p.data==="registered"&&u(void 0)});const A=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=A,await new mt(u=>i.onmessage=p=>{p.data==="started"&&u(void 0)}),l.port1.onmessage=u=>{var p;u.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==s.track.id?(N.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r)):u.data.metadata&&s.onMetadata?s.onMetadata(u.data.metadata):u.data.pts&&s.onPts&&s.onPts(u.data.pts)},s.worker=i}function r(){e.track.removeEventListener("ended",r),function(i){const l=Iw.get(i);if(l){(function(p){const f=Ef.get(p);f&&(Ef.delete(p),Dl&&(Dl.removeSpeakers([f]),Ef.size===0&&(Dl.destroy(),Dl=null)))})(i),DU(i.track.id),Iw.delete(i);try{var A,u;(A=l.controller)===null||A===void 0||A.terminate(),(u=l.worker)===null||u===void 0||u.terminate()}catch(p){N.warning(p&&p.message)}}}(e)}Iw.set(e,s),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Ls().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(Ow.has(e)||!e.track)return;const s={track:e.track};if(EA()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(u){return void N.error("create video-encoded-streams error",u&&u.message)}const l=[];t.on("sei-to-send",u=>{l.push(u)});const A=new TransformStream({transform(u,p){s.controller||(s.controller=p),e.track&&e.track.id!==s.track.id&&(N.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r));const f=jU(new Uint8Array(u.data)),b=l.shift();if(b){const w=function(_,C,U){switch(U){case mN:return function(B,j){const K=LU(j),q=K.length,ie=Math.floor(q/255),xe=q%255,ye=new Uint8Array(6+ie+1+q+B.byteLength);ye[0]=0,ye[1]=0,ye[2]=0,ye[3]=1,ye[4]=6,ye[5]=101;let ue=0;for(;ue<ie;)ye[6+ue]=255,ue++;return ye[6+ue]=xe,ue++,ye.set(K,6+ue),ye.set(new Uint8Array(B),6+ue+q),ye.buffer}(_,C);case fN:return function(B,j){const K=LU(j),q=K.length,ie=Math.floor(q/255),xe=q%255,ye=new Uint8Array(7+ie+1+q+1+B.byteLength);ye[0]=0,ye[1]=0,ye[2]=0,ye[3]=1,ye[4]=78,ye[5]=1,ye[6]=101;let ue=0;for(;ue<ie;)ye[7+ue]=255,ue++;return ye[7+ue]=xe,ue++,ye.set(K,7+ue),ue+=q,ye[7+ue]=128,ue++,ye.set(new Uint8Array(B),7+ue),ye.buffer}(_,C);default:return null}}(u.data,b,f);w&&(u.data=w)}p.enqueue(u)}});i.readable.pipeThrough(A).pipeTo(i.writable)}else{if(!Jn())return;{if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const i=yw(),l=new MessageChannel;await new mt(u=>i.onmessage=p=>{p.data==="registered"&&u(void 0)});const A=new RTCRtpScriptTransform(i,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=A,await new mt(u=>i.onmessage=p=>{p.data==="started"&&u(void 0)}),t.on("sei-to-send",u=>{l.port1.postMessage({sei:u})}),l.port1.onmessage=u=>{var p;u.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==s.track.id&&(N.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r))},s.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Ow.get(e);if(i){Ow.delete(e);try{var l,A;(l=i.controller)===null||l===void 0||l.terminate(),(A=i.worker)===null||A===void 0||A.terminate()}catch(u){N.warning(u&&u.message)}}}Ow.set(e,s),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ls().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(!e.track)return;if(V0.has(e)){const i=V0.get(e);return void(i&&(i.onSei=t.onSei))}const s={track:e.track,onSei:t.onSei};if(EA()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(A){return void N.error("create video-encoded-streams error",A&&A.message)}const l=new TransformStream({transform(A,u){if(s.controller||(s.controller=u),!s.firstFrameInfo){var p;const b=A.getMetadata()||{};s.firstFrameInfo=Er({type:A.type,rtpTimestamp:A.timestamp,payloadType:b.payloadType||0,ssrc:b.synchronizationSource||0,length:A.data.byteLength},"mimeType"in b?{mimeType:b.mimeType}:{}),(p=t.onFirstFrame)===null||p===void 0||p.call(t,s.firstFrameInfo)}e.track&&e.track.id!==s.track.id&&(N.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r));const f=function(b,w){switch(w){case mN:return function(_){const C=new DataView(_.data);let U=0;for(;U+4<_.data.byteLength;){if(C.getUint8(U+0)===0&&C.getUint8(U+1)===0&&C.getUint8(U+2)===0&&C.getUint8(U+3)===1&&C.getUint8(U+4)===6){let B=U+6,j=0,K=0;for(;(K=C.getUint8(B++))===255;)j+=255;j+=K;const q=BU(_.data,B,j);return new Uint8Array(q)}U++}return null}(b);case fN:return function(_){const C=new DataView(_.data);let U=0;for(;U+5<_.data.byteLength;){if(C.getUint8(U+0)===0&&C.getUint8(U+1)===0&&C.getUint8(U+2)===0&&C.getUint8(U+3)===1&&C.getUint8(U+4)===78&&C.getUint8(U+5)===1&&C.getUint8(U+6)===101){let B=U+7,j=0,K=0;for(;(K=C.getUint8(B++))===255;)j+=255;j+=K;const q=BU(_.data,B,j);return new Uint8Array(q)}U++}return null}(b);default:return null}}(A,jU(new Uint8Array(A.data)));f&&s.onSei&&s.onSei(f),u.enqueue(A)}});i.readable.pipeThrough(l).pipeTo(i.writable)}else if(Jn()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const i=yw(),l=new MessageChannel;await new mt(u=>i.onmessage=p=>{p.data==="registered"&&u(void 0)});const A=new RTCRtpScriptTransform(i,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=A,await new mt(u=>i.onmessage=p=>{p.data==="started"&&u(void 0)}),l.port1.onmessage=u=>{var p;if(u.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==s.track.id)N.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r);else if(u.data.sei&&s.onSei)s.onSei(u.data.sei);else if(u.data.firstFrameInfo&&t.onFirstFrame){var f;(f=t.onFirstFrame)===null||f===void 0||f.call(t,u.data.firstFrameInfo)}},s.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const l=V0.get(i);if(l){V0.delete(i);try{var A,u;(A=l.controller)===null||A===void 0||A.terminate(),(u=l.worker)===null||u===void 0||u.terminate()}catch(p){N.warning(p&&p.message)}}})(e)}V0.set(e,s),e.track.addEventListener("ended",r)}},vre={name:"InterceptFrame",create:()=>xre};var Gs;function P3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Hl(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?P3(Object(s),!0).forEach(function(r){P(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):P3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let wre=(Gs=class og extends Pw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return nt(s=Object.keys(cp)).call(s,t)}))]}constructor(t,s,r){super(t,s),P(this,"id",ar(5,"connection-")),P(this,"store",void 0),P(this,"peerConnection",void 0),P(this,"forceTurn",!1),P(this,"remoteSDP",void 0),P(this,"initialOffer",void 0),P(this,"transportEventReceiver",void 0),P(this,"statsFilter",void 0),P(this,"extension",{useXR:G("USE_XR")}),P(this,"localCapabilities",void 0),P(this,"remoteCodecs",void 0),P(this,"localCandidateCount",0),P(this,"allCandidatesReceived",!1),P(this,"isPreallocation",!1),P(this,"preMediaMap",new Map),P(this,"dataStreamChannelMap",new Map),P(this,"establishPromise",void 0),P(this,"recoveredDataChannelIds",[]),P(this,"currentDataChannelId",1),P(this,"supportAV1RtpSpec",!1),P(this,"mutex",void 0),P(this,"qualityLimitationReason",uf.NONE),P(this,"isFirstConnected",!1),this.store=s,this.forceTurn=ZN(t),this.mutex=new $n("NVConnectionExtension-mutex",s.clientId),this.peerConnection=r,this.isFirstConnected=!1,this.statsFilter=Aw(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Tr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,s){if(this.remoteCodecs=s,!this.remoteSDP)return void N.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(t,s,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else N.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Od(s.sdp),i=await LN({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=z0(i),this.initialOffer=s,G("ENABLE_SVC")&&this.store.codec=="av1"){const A=await d4();var t;A&&(this.supportAV1RtpSpec=!0,(t=i.send)===null||t===void 0||t.videoExtensions.push(A))}let l;return s.sdp&&Gw(s.sdp)&&(l=Rr(i),s4(l)),Hl(Hl({},r),{},{rtpCapabilities:l||i,offerSDP:s.sdp})}catch(s){throw new Me(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&Gw(this.initialOffer.sdp)&&r4(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new L4(Hl(Hl({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&U0(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),r=jN(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),U0(this.store))if(t.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const A=G("PRE_SUB_NUM"),{mids:u,preSSRCs:p}=this.remoteSDP.preloadRemoteMedia(A);await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(p)),this.presetMedia(u,p)}else{const{preSSRCs:A=[]}=t,u=A.map(f=>f.ssrcMsg[0].ssrcId);if(A.length===0)return;const{mids:p}=this.remoteSDP.batchSend(A.map(f=>Object.assign({},f)));await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(p,u)}}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(s.toString()))}}presetMedia(t,s){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&r===l.mid&&l.receiver.track){const A=l.receiver.track;let u;A.kind==="video"&&G("ENABLE_PRE_RENDER")&&(u=new ww({trackId:"track-".concat(A.kind,"-unknown-").concat(this.store.clientId,"_").concat(ar(5,""))},!0),u.updateVideoTrack(A),u.onFirstVideoFrameRender=()=>{var p;const f=this.preMediaMap.get(s[i]);f&&(f.firstVideoRender=Date.now()),(p=this.onFirstVideoRender)===null||p===void 0||p.call(this,s[i])},u.onVideoBufferReady=()=>{var p;(p=this.onFirstVideoBufferReady)===null||p===void 0||p.call(this,s[i])},u.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[i],{mid:r,track:A,player:u,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:r}=t;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const A=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||A}const{preSSRCs:i=[]}=t,l=i.map(A=>A.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const A=[],u=[];if(Array.from(this.preMediaMap.entries()).every(p=>{let[f,{mid:b,player:w,track:_}]=p;return A.push(b),u.push(f),this.preMediaMap.delete(f),w&&w.destroy(),!0}),A.length>0&&(this.remoteSDP.stopSending(A),await Ga(this.peerConnection,this.remoteSDP,this.extension),N.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),kt.reportApiInvoke(this.store.sessionId,{name:kr.PRELOAD_MEDIA_FAILED,options:[i,u],tag:br.TRACER}).onSuccess()),i.length>0){const{mids:p}=this.remoteSDP.batchSend(i.map(f=>Object.assign({},f)));await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(p,l)}}s?(await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):N.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(s.toString()))}}send(t,s,r){var i=this;return Na(function*(){const l=yield vs(i.mutex.lock("From NVConnectionExtension.send"));try{if(!i.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const A=[],u=G0();t.forEach(j=>{const K=i.peerConnection.addTransceiver(j._mediaStreamTrack,Hl({direction:"sendonly"},j.trackMediaType==="video"&&i.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));A.push(K),j._updateRtpTransceiver(K)}),Tr()&&G("SIMULCAST")===!0&&(yield vs(i.applySimulcastForFirefox(A,t)));const p=yield vs(i.peerConnection.createOffer()),f=i.remoteSDP.predictReceivingMids(t.length),b=i.mungSendOfferSDP(p.sdp,t,f),w=ha(b),_=f.map(j=>{const K=w.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return ON(K,G("USE_PUB_RTX"))});let C;try{C=yield _}catch(j){C=[],i.remoteSDP.receive(t,s,r,C);const K=i.remoteSDP.toString();throw yield vs(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield vs(i.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield vs(i.stopSending(f,!0)),j}i.remoteSDP.receive(t,s,r,C);const U=i.remoteSDP.toString(),B=i.logSDPExchange(b,"offer","local","send");return yield vs(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield vs(i.applySimulcastEncodings(A,t)),yield vs(i.applySendEncodings(A,t)),B==null||B(U),yield vs(i.peerConnection.setRemoteDescription({type:"answer",sdp:U})),A.map((j,K)=>{const q=f[K];return{localSSRC:_[K],id:q,transceiver:j}})}catch(A){throw A instanceof Me?A:new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(A.toString()))}finally{l()}})()}async createDataChannels(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")N.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}s.forEach(l=>{l._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A),N.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else N.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof Me?r:new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const s=this.dataStreamChannelMap.get(t);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(t)}catch(s){throw s instanceof Me?s:new Me(W.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(t,s){const r=s?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");i.map(p=>{var f;Lf(this.id+p.mid,this),p.direction="inactive",(f=p.stop)===null||f===void 0||f.call(p)});const l=await this.peerConnection.createOffer(),A=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();A==null||A(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:A}=this.remoteSDP.send(t,s,r,i);A&&(await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));const u=this.peerConnection.getTransceivers().find(p=>p.mid===l);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:l,transceiver:u}}catch(l){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Ga(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),s.map(i=>{const l=this.peerConnection.getTransceivers().find(A=>A.mid===i);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:i,transceiver:l}})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(A=>{let[u,{mid:p,player:f}]=A;if(p===l)return this.preMediaMap.delete(u),f&&f.destroy(),!0})}),this.remoteSDP.stopSending(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(A=>{A.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(A,u)=>{A.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Me(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return Na(function*(){const r=yield vs(s.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ls().supportPCSetConfiguration,l=G("FORCE_TURN_TCP")||s.forceTurn;if(t===Zn.RELAY&&!i)return;if(i&&!l){const w=t===Zn.RELAY?"relay":"all",_=s.peerConnection.getConfiguration();_.iceTransportPolicy!==w&&(N.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(w,"]")),_.iceTransportPolicy=w,s.peerConnection.setConfiguration(_))}s.remoteSDP.updateCandidates(t);const A=yield vs(s.peerConnection.createOffer({iceRestart:!0}));if(!A.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=Od(A.sdp),{remoteIceParameters:p}=yield u.iceParameters;s.remoteSDP.restartICE(p);const f=s.remoteSDP.toString(),b=s.logSDPExchange(A.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield vs(s.peerConnection.setLocalDescription(A)),b==null||b(f),yield vs(s.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(i){N.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Zn.TCP_RELAY),await Ga(this.peerConnection,this.remoteSDP,this.extension)}catch(s){N.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(s=>{Lf(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:r}=s;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Hl(Hl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);const l=this.remoteSDP.toString(),A=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),A==null||A(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Me(W.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,s){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(s)?Tr()||await this.applySimulcastEncodings(r,[s]):await this.applySendEncodings(r,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){const r=this.peerConnection.getTransceivers().find(i=>i.mid===s);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const s=t[0].transport.iceTransport,{local:r,remote:i}=s.getSelectedCandidatePair();return{local:Hl(Hl({},Hc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Hl(Hl({},Hc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var s;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",l=Id(t.url||"");N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(r,"), url: ").concat(l||"",", host_candidate:").concat(i)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const s={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&(tp(t.turnServer.servers)?s.iceServers=t.turnServer.servers:G("NEW_TURN_MODE")&&s.iceServers&&r==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&s.iceServers.push(...og.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):s.iceServers.push(...og.newTurnServerConfigToIceServers(t.turnServer.servers)),G("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...og.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...og.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(s.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&Ls().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{r.security?r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(qc(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{const i=G("NEW_TURN_MODE");i===1?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(qc(r.turnServerURL),":443?transport=tcp")}):i===4&&(s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(qc(r.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(t){const s=t.transport;if(s){this.transportEventReceiver=t,s.onstatechange=()=>{var i;s!=null&&s.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,s.state))},s.onerror=i=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in i?i.error:i)};const r=s.iceTransport;r&&(r.onstatechange=()=>{const i=s==null?void 0:s.iceTransport.state;var l;i&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:l}=r.getSelectedCandidatePair()||{};if(i&&l){const A=i.address+":"+i.port,u=l.address+":"+l.port;N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Id(A)),", remote ").concat(JSON.stringify(Id(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var r,i;if(s||(s=this.peerConnection.getSenders().find(j=>j.track===t._mediaStreamTrack)),!s)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ls().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},A={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const u=e4(this.peerConnection,t._mediaStreamTrack),p=Hj(t);if(V4(t)&&u&&s&&p&&this.getLocalVideoStats&&nt(r=["vp8","vp9"]).call(r,this.store.codec)){var f;const B=l.degradationPreference||(nt(f=t._hints).call(f,rr.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");Q4(this.id+u.mid,p,this,B,j=>{s&&this.updateAdaptation(s,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var b;const{bitrateMax:B,frameRate:j,scaleResolutionDownBy:K}=t._encoderConfig;B&&(A.maxBitrate=1e3*B),(nt(b=t._hints).call(b,rr.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(A.maxFramerate=ka(j)),K&&K>=1&&(A.scaleResolutionDownBy=K))}const{maxFramerate:w}=G("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(A.maxFramerate=A.maxFramerate?Math.min(A.maxFramerate,w):w),G("DSCP_TYPE")&&Sd()){var _;const B=G("DSCP_TYPE");nt(_=["very-low","low","medium","high"]).call(_,B)&&(A.networkPriority=B)}const C=s.getParameters(),U=(i=C.encodings)===null||i===void 0?void 0:i[0];Tr()&&!U&&(l.encodings=[A]),U&&Object.assign(U,A),Object.assign(C,l),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await s.setParameters(C),await h4(this.store.codec,s,G("SVC_MODE"))}async updateAdaptation(t,s){var r,i;if(!t)return N.debug("[updateAdaptation] no rtpSender found");if(!Ls().supportSetRtpSenderParameters)return N.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:A,frameRate:u,scaleResolutionDownBy:p}=s;A&&(l.maxBitrate=1e3*A),u&&(l.maxFramerate=ka(u)),p&&p>=1&&nt(r=["vp8","vp9"]).call(r,this.store.codec)&&(l.scaleResolutionDownBy=p);const f=t.getParameters(),b=(i=f.encodings)===null||i===void 0?void 0:i[0];b&&Object.assign(b,l),Object.assign(f,{});try{await t.setParameters(f),N.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(w){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?N.debug("[updateAdaptation] peerConnection not connected}"):N.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):N.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,s){try{if(!Ls().supportSetRtpSenderParameters||t.length!==s.length)return;for(let r=0;r<t.length;r++){const i=t[r],l=s[r];l instanceof xr&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,i.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,r){const i=ha(t);return s.forEach((l,A)=>{const u=r[A],p=i.mediaDescriptions.find(f=>f.attributes.mid===u);p&&(xp(p,l),BN(p,l,this.store.codec))}),CA(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,s,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let p=0;p<t.length;p++){var r,i,l,A,u;const f=t[p],b=s[p];if(b instanceof xr&&!nt(r=b._hints).call(r,rr.LOW_STREAM)&&(i=b._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((l=b._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(A=b._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((u=b._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},_={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const C=f.sender.getParameters();await f.sender.setParameters(Object.assign(C,w))}}}async applySimulcastEncodings(t,s){if(!Tr()&&t.length===s.length)for(let r=0;r<t.length;r++){const i=s[r];if(i instanceof xr&&this.isVP8Simulcast(i)){const l=t[r],A={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,A))}}}isVP8Simulcast(t){var s,r,i,l,A;return!!(t instanceof xr&&G("SIMULCAST")&&this.store.codec==="vp8"&&!nt(s=t._hints).call(s,rr.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((A=t._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(t,s,r,i){if(G("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(s," SDP during NVConnectionExtension.").concat(i,`
`),t),s==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(t);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(t){if(Ls().supportPCSetConfiguration){const s=og.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}t.isPreallocation&&(this.isPreallocation=!0)}},ft(Gs.prototype,"updateRemoteRTPCapabilities",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"updateRemoteRTPCapabilities"),Gs.prototype),ft(Gs.prototype,"connect",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"connect"),Gs.prototype),ft(Gs.prototype,"updateRemoteConnect",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"updateRemoteConnect"),Gs.prototype),ft(Gs.prototype,"createDataChannels",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"createDataChannels"),Gs.prototype),ft(Gs.prototype,"receive",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"receive"),Gs.prototype),ft(Gs.prototype,"batchReceive",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"batchReceive"),Gs.prototype),ft(Gs.prototype,"stopReceiving",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"stopReceiving"),Gs.prototype),ft(Gs.prototype,"muteRemote",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"muteRemote"),Gs.prototype),ft(Gs.prototype,"unmuteRemote",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"unmuteRemote"),Gs.prototype),ft(Gs.prototype,"muteLocal",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"muteLocal"),Gs.prototype),ft(Gs.prototype,"unmuteLocal",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"unmuteLocal"),Gs.prototype),ft(Gs.prototype,"close",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"close"),Gs.prototype),ft(Gs.prototype,"updateEncoderConfig",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"updateEncoderConfig"),Gs.prototype),ft(Gs.prototype,"updateSendParameters",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"updateSendParameters"),Gs.prototype),ft(Gs.prototype,"replaceTrack",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"replaceTrack"),Gs.prototype),ft(Gs.prototype,"updateAdaptation",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"updateAdaptation"),Gs.prototype),ft(Gs.prototype,"getRemoteSSRC",[La],Object.getOwnPropertyDescriptor(Gs.prototype,"getRemoteSSRC"),Gs.prototype),Gs);function La(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From NVConnectionExtension.".concat(t));try{for(var A=arguments.length,u=new Array(A),p=0;p<A;p++)u[p]=arguments[p];return await r.apply(this,u)}finally{l()}},s}var ur;function U3(e){var t,s,r,i=2;for(typeof Symbol<"u"&&(s=qv,r=Symbol.iterator);i--;){if(s&&(t=e[s])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new N_(t.call(e));s="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function N_(e){function t(s){if(Object(s)!==s)return mt.reject(new TypeError(s+" is not an object."));var r=s.done;return mt.resolve(s.value).then(function(i){return{value:i,done:r}})}return N_=function(s){this.s=s,this.n=s.next},N_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var r=this.s.return;return r===void 0?mt.resolve({value:s,done:!0}):t(r.apply(this.s,arguments))},throw:function(s){var r=this.s.return;return r===void 0?mt.reject(s):t(r.apply(this.s,arguments))}},new N_(e)}let _re=(ur=class vy extends Pw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,s){super(t,s),P(this,"name","DataChannelConnection"),P(this,"store",void 0),P(this,"peerConnection",void 0),P(this,"cname",void 0),P(this,"mutex",new $n("DataChannelConnection-mutex")),P(this,"dataChannel",void 0),P(this,"_p2pConnection",void 0),P(this,"establishPromise",void 0),P(this,"_nvMedia",void 0),this.store=s,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(vy.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new wre(t,s,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var s;return(s=this._p2pConnection)===null||s===void 0?void 0:s.getPreMedia(t)}isPreSub(){var t,s;return(t=(s=this._p2pConnection)===null||s===void 0?void 0:s.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new mt((s,r)=>{const i=setTimeout(()=>{this.closeSignal(),r(new Le(W.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},G("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(i),void s()},this.dataChannel.onerror=l=>{this.closeSignal(),r(l)},this.dataChannel.addEventListener("close",()=>{r(new Le(W.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,s){return this._p2pConnection.updateRemoteRTPCapabilities(t,s)}send(t,s,r){var i=this;return Na(function*(){const l=yield vs(i.mutex.lock("From DataChannelConnection.send"));try{return yield*af(U3(i._p2pConnection.send(t,s,r)))}finally{l()}})()}async stopSending(t,s){return this._p2pConnection.stopSending(t,s)}async createDataChannels(t,s){return this._p2pConnection.createDataChannels(t,s)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,s,r,i){return this._nvMedia?(N.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,s,this.cname)):(N.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,s,r,i))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var s=this;return Na(function*(){return yield*af(U3(s._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var s;return(s=this._nvMedia)===null||s===void 0||s.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,s){return await this._p2pConnection.updateEncoderConfig(t,s)}async updateSendParameters(t,s){return await this._p2pConnection.updateSendParameters(t,s)}setStatsRemoteVideoIsReady(t,s){this._p2pConnection.setStatsRemoteVideoIsReady(t,s)}async replaceTrack(t,s){return await this._p2pConnection.replaceTrack(t,s)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,s,r,i){if(G("SDP_LOGGING"))return N.upload("exchanging ".concat(r," ").concat(s," SDP during DataChannelConnection.").concat(i,`
`),t),s==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",i)}:void 0}static resolvePCConfiguration(t){const s={iceServers:[]};return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(tp(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...vy.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...vy.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(s.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&Ls().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{r.security?r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(qc(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),s}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var s;return(s=this.onICEConnectionStateChange)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var s;return(s=this.onConnectionStateChange)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var s;return(s=this.onDTLSTransportStateChange)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var s;return(s=this.onDTLSTransportError)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var s;return(s=this.onICETransportStateChange)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var s;return(s=this.onFirstAudioReceived)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var s;return(s=this.onFirstVideoReceived)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var s;return(s=this.onFirstAudioDecoded)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var s;return(s=this.onFirstVideoRender)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var s;return(s=this.onFirstVideoBufferReady)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,s,r)=>{var i;return(i=this.onFirstVideoDecoded)===null||i===void 0?void 0:i.call(this,t,s,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var s;return(s=this.onFirstVideoDecodedTimeout)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,s)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,s)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,s)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,s)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},ft(ur.prototype,"connect",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"connect"),ur.prototype),ft(ur.prototype,"updateRemoteRTPCapabilities",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"updateRemoteRTPCapabilities"),ur.prototype),ft(ur.prototype,"createDataChannels",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"createDataChannels"),ur.prototype),ft(ur.prototype,"receive",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"receive"),ur.prototype),ft(ur.prototype,"stopReceiving",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"stopReceiving"),ur.prototype),ft(ur.prototype,"muteRemote",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"muteRemote"),ur.prototype),ft(ur.prototype,"unmuteRemote",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"unmuteRemote"),ur.prototype),ft(ur.prototype,"muteLocal",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"muteLocal"),ur.prototype),ft(ur.prototype,"unmuteLocal",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"unmuteLocal"),ur.prototype),ft(ur.prototype,"close",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"close"),ur.prototype),ft(ur.prototype,"updateEncoderConfig",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"updateEncoderConfig"),ur.prototype),ft(ur.prototype,"updateSendParameters",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"updateSendParameters"),ur.prototype),ft(ur.prototype,"replaceTrack",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"replaceTrack"),ur.prototype),ft(ur.prototype,"getRemoteSSRC",[Go],Object.getOwnPropertyDescriptor(ur.prototype,"getRemoteSSRC"),ur.prototype),ur);function Go(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From DataChannelConnection.".concat(t));try{for(var A=arguments.length,u=new Array(A),p=0;p<A;p++)u[p]=arguments[p];return await r.apply(this,u)}finally{l()}},s}function F3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}class yre extends jr{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var s;nt(s=["tryNext","recover"]).call(s,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(In.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(In.CONNECTED):this._state==="closed"?this.emit(In.CLOSED):this._state==="failed"&&this.emit(In.FAILED))}constructor(t,s,r,i){super(),P(this,"connectionID",0),P(this,"currentURLIndex",0),P(this,"reconnectReason",void 0),P(this,"_reconnectMode","tryNext"),P(this,"_initMutex",void 0),P(this,"_name",void 0),P(this,"_state","closed"),P(this,"_reconnectInterrupter",void 0),P(this,"_url",void 0),P(this,"_retryConfig",void 0),P(this,"_reconnectCount",0),P(this,"_forceCloseTimeout",5e3),P(this,"_onlineReconnectListener",void 0),P(this,"_closeEstablishingTransmitter",()=>{}),P(this,"_store",void 0),P(this,"_joinChannelServiceRecordIndex",void 0),P(this,"_transmitter",void 0),P(this,"_useCompress",void 0),P(this,"_inflateLength",0),P(this,"_deflateLength",0),this._store=i,this._name=t,this._retryConfig=function(l){for(var A=1;A<arguments.length;A++){var u=arguments[A]!=null?arguments[A]:{};A%2?F3(Object(u),!0).forEach(function(p){P(l,p,u[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(u)):F3(Object(u)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(u,p))})}return l}({},s),this._useCompress=r}resetReconnectCount(t){N.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const r=this._transmitter;s?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,s){if(!this._transmitter)return void N.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),N.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(s)]},this._joinChannelServiceRecordIndex));const i=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),i&&i.bind(this._transmitter)({code:9999,reason:s})}getInflateData(){const t=this._inflateLength,s=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:s}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Gl=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class Ere{constructor(t,s,r){P(this,"version",1),P(this,"initialRTO",void 0),P(this,"maxBatchAckCount",void 0),P(this,"maxRTO",void 0),P(this,"initialRTT",void 0),P(this,"ID",void 0),P(this,"rtt",void 0),P(this,"packetNumber",1),P(this,"rtoRatioMap",new Map),P(this,"timeoutMap",new Map),P(this,"unorderedPacketQueue",[]),P(this,"batchAckPacketQueue",[]),P(this,"lastOrderedPacketNumber",0),P(this,"batchAckTimer",void 0),P(this,"sendImpl",void 0),P(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=s,this.ID=ar(7,"transmitter-"),this.initialRTO=(r==null?void 0:r.initialRTO)!==void 0?r.initialRTO:G("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:G("TRANSMITTER_INITIAL_RTT"),this.rtt=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:G("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(r==null?void 0:r.maxBatchAckCount)!==void 0?r.maxBatchAckCount:G("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(r==null?void 0:r.maxRTO)!==void 0?r.maxRTO:G("TRANSMITTER_MAX_RTO")}packetize(t,s){return{type:Gl.Default,version:this.version,packetNumber:s,payload:t}}serialize(t){switch(t.type){case Gl.Default:{let s;typeof t.payload=="string"?s=new TextEncoder().encode(t.payload):s=t.payload;const r=new ArrayBuffer(s.length+15),i=new DataView(r);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.packetNumber),UL(i,7,BigInt(t.sendTs)),new Uint8Array(i.buffer).set(s,15),r}case Gl.Ack:{const s=new ArrayBuffer(16),r=new DataView(s);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),UL(r,8,BigInt(t.ackSendTs)),s}}}deserialize(t){const s=new DataView(t),r=s.getUint16(0),i=s.getUint8(2);switch(i){case Gl.Default:{const l=s.getUint32(3),A=PL(s,7),u=t.slice(15),p=new Uint8Array(u);return{version:r,type:i,packetNumber:l,sendTs:Number(A),payload:p}}case Gl.Ack:{const l=s.getUint32(3),A=s.getUint8(7),u=PL(s,8);return{version:r,type:i,maxAckPacketNumber:l,shift:A,ackSendTs:Number(u)}}default:throw N.error("[".concat(this.ID,"] Unrecognized packet type ").concat(i)),new Error("Unrecognized packet type ".concat(i))}}sendMessage(t){G("DC_DEBUG_LOG")&&typeof t=="string"&&N.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));const s=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const r=this.calculateRTO(s),i=window.setTimeout(()=>{this.resendMessage(s)},r);this.timeoutMap.set(s.packetNumber,i),this.sendPacket(s)}onData(t){const s=this.deserialize(t);s.type===Gl.Default?this.ack(s):s.type===Gl.Ack&&(this.updateRTT(s,Math.round(performance.now())),this.clearRTO(s))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[s,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const s=this.calculateRTO(t),r=window.setTimeout(()=>{G("DC_DEBUG_LOG")&&typeof t.payload=="string"&&N.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(s)),this.resendMessage(t)},s);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){const s=this.rtoRatioMap.get(t.packetNumber);if(s===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const r=9*this.rtt/8*s;return this.rtoRatioMap.set(t.packetNumber,s+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,s){const r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(s-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const s=this.unorderedPacketQueue[0];if(!s){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(s.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const s={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Gl.Ack,version:this.version};G("DC_DEBUG_LOG")&&N.debug("[".concat(this.ID,"] sending ack packet"),s,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(s)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const s={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Gl.Ack,version:this.version};G("DC_DEBUG_LOG")&&N.debug("[".concat(this.ID,"] sending ack packet"),s,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(s)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Gl.Ack,version:this.version};G("DC_DEBUG_LOG")&&N.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Gl.Default&&(t.sendTs=Math.round(performance.now()));const s=this.serialize(t);this.sendImpl(s)}clearRTO(t){for(let s=t.maxAckPacketNumber-t.shift;s<=t.maxAckPacketNumber;s++){const r=this.timeoutMap.get(s);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(s),this.rtoRatioMap.delete(s)}}}class M3 extends yre{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),P(this,"_initMutex",void 0),P(this,"_reconnectInterrupter",void 0),P(this,"_url",void 0),P(this,"_transmitter",void 0),P(this,"_addresses",void 0),P(this,"_reliableTransmission",void 0),P(this,"_textEncoder",void 0),P(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new $n("datachannel");const{timeout:r,timeoutFactor:i}=s,l=Math.max(300,Math.floor(3*r/5)),A=Math.max(1.2,Math.floor(8*i)/10);ua.ONLINE&&(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=A),Wr.on(sp.NETWORK_STATE_CHANGE,(u,p)=>{u!==p&&(this.resetReconnectCount("network state change: ".concat(p," -> ").concat(u)),u===ua.ONLINE?(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=A):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=i))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=s;const r=(i,l)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(u=>u.fingerprint||G("FINGERPRINT"));const A=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(A).then(i).catch(l),this.once(In.CLOSED,()=>l(new Le(W.WS_DISCONNECT))),this.once(In.CONNECTED,()=>i())};return this._initMutex.lock().then(i=>new mt((l,A)=>{r(l,A)}).then(()=>{i()}).catch(()=>{i()}))}async sendMessage(t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Le(W.WS_ABORT,"datachannel is not ready");try{s||(t=JSON.stringify(t));const r=this._textEncoder.encode(t),i=jse(r,{raw:!0});this._reliableTransmission.sendMessage(i)}catch(r){throw new Le(W.WS_ERR,"send datachannel signal message error"+r.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const s=JSON.stringify(t);return{compressed:s,compressedLength:s.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new mt((s,r)=>{var i;const l=()=>{N.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),s()},A=async b=>{var w;if((w=this._closeEstablishingTransmitter)===null||w===void 0||w.call(this),N.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const _=fo(this,In.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,C=await this.reconnectWithAction(_);if(this.state==="closed")return void N.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!C)return r(new Le(W.WS_DISCONNECT,"datachannel reconnect failed: ".concat(b.code))),void this.close(!0);s()}else r(new Le(W.WS_DISCONNECT,"datachannel close: ".concat(b.code))),this.close()},u=async b=>{try{var w;(w=this._reliableTransmission)===null||w===void 0||w.onData(b.data)}catch(_){console.log(_)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),N.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const p=(i=this._store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),f=Date.now();wn(this,In.TO_CONNECT_DATACHANNEL).then(b=>{var w,_;if(!b)throw new Error("transmissonInfo not exist yet");const{transmitter:C,close:U}=b;this._transmitter=C,(w=this._store)===null||w===void 0||w.signalChannelOpen();const B=Date.now()-f;N.debug("[choose dc] dc open cost ".concat(B,"ms")),this._reliableTransmission=new Ere(j=>{var K;this._transmitter&&this._transmitter.readyState==="open"&&((K=this._transmitter)===null||K===void 0||K.send(j))},j=>{if(typeof j=="string")this.emit(In.ON_MESSAGE,j);else{const K=Use(j,{raw:!0}).buffer,q=this._textDecoder.decode(K);this.emit(In.ON_MESSAGE,q)}}),this._closeEstablishingTransmitter=()=>{var j;(j=this._reliableTransmission)===null||j===void 0||j.close(),this._reliableTransmission=void 0,U()},l&&l(),C.onclose=A,C.onmessage=u,(_=this._store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this._joinChannelServiceRecordIndex=p}).catch(b=>{var w;if((w=this._store)===null||w===void 0||w.recordJoinChannelService({endTs:Date.now(),status:b instanceof Le&&b.code===W.WS_ABORT?"aborted":"error",errors:[b]},p),this.state!=="closed"){if(b instanceof Le&&b.code===W.WS_ERR){const _=new Le(W.WS_ERR,"init datachannel failed! Error: ".concat(b.toString()));return N.error("[".concat(this._name,"]").concat(_)),void r(_)}A&&A(b)}else r(new Le(W.WS_DISCONNECT,"datachannel is closed: ".concat(b.toString())))})})}async reconnectWithAction(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Wr.networkState!==ua.OFFLINE||(this._onlineReconnectListener=Wr.onlineWaiter&&Wr.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let r=!0;if(this._reconnectInterrupter=()=>{r=!1},s){const u=ow(this._reconnectCount,this._retryConfig);N.debug("[".concat(this._name,"] wait ").concat(u,"ms to reconnect datachannel, mode: ").concat(t)),await mt.race([Qn(u),this._onlineReconnectListener||new mt(()=>{})])}if(this.state==="closed"||!r)return!1;this._reconnectCount+=1;const i=async(u,p)=>{this.emit(In.RECONNECT_CREATE_CONNECTION,p),await this.createTransmitterConnection(u)};try{if(t==="retry"){const u=this._addresses[this.currentURLIndex];await i(u,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let p=this.currentURLIndex;p<this._addresses.length;p++){if(this._addresses[p].fingerprint||G("FINGERPRINT")){this.currentURLIndex=p;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return N.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);N.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const u=this._addresses[this.currentURLIndex];await i(u,t)}else t==="recover"&&(N.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(In.FAILBACK));return!0}catch(u){var l,A;return N.error("[".concat(this._name,"] reconnect failed"),u.toString()),u!=null&&(l=u.data)!==null&&l!==void 0&&l.desc&&Array.isArray(u.data.desc)&&u.data.desc.length&&nt(A=u.data.desc).call(A,"dynamic key expired")?(this.emit(In.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,s)}}}class Sre extends jr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Fs.CONNECTED?this.emit(Lt.WS_CONNECTED):t===Fs.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):t===Fs.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(N.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:s,message:r}=t;this.emit(s,r),s===as.ON_NOTIFICATION&&this.handleNotification(r),s===as.ON_USER_BANNED&&this.handleUserBanned(r)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(Us.UID_BANNED);break;case 15:this.close(Us.IP_BANNED);break;case 16:this.close(Us.CHANNEL_BANNED)}}constructor(t,s){super(),P(this,"__name__","DataChannelSignal"),P(this,"_disconnectedReason",void 0),P(this,"_websocketReconnectReason",void 0),P(this,"_connectionState",Fs.CLOSED),P(this,"reconnectToken",void 0),P(this,"websocket",void 0),P(this,"openConnectionTime",void 0),P(this,"clientId",void 0),P(this,"lastMsgTime",Date.now()),P(this,"uploadCache",[]),P(this,"uploadCacheInterval",void 0),P(this,"rttRolling",new D1(5)),P(this,"pingpongTimer",void 0),P(this,"inflateDataTimer",void 0),P(this,"pingpongTimeoutCount",0),P(this,"ortc",void 0),P(this,"joinResponse",void 0),P(this,"multiIpOption",void 0),P(this,"initError",void 0),P(this,"spec",void 0),P(this,"store",void 0),P(this,"isJoining",!1),P(this,"pendingNotifications",[]),P(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,r);const i=JSON.parse(r);if(G("DC_DEBUG_LOG")&&N.debug("[datachannel-signal] received packet",i),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const l="res-@".concat(i._id);this.emit(l,i._result,i._message)}else Object.prototype.hasOwnProperty.call(i,"_type")&&(this.isJoining?i._type===as.ON_NOTIFICATION||i._type===as.ON_USER_BANNED?(this.emit(i._type,i._message),i._type===as.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===as.ON_USER_BANNED&&this.handleUserBanned(i._message)):(this.pendingNotifications.push({type:i._type,message:i._message}),N.debug("[".concat(this.clientId,"] cached notification during join: ").concat(i._type))):(this.emit(i._type,i._message),i._type===as.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===as.ON_USER_BANNED&&this.handleUserBanned(i._message)))}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new M3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Fs.CONNECTED&&this.reconnect("retry",Iu.OFFLINE)})}async request(t,s,r,i){const l=ar(6,""),A={_id:l,_type:t,_message:s},u=this.websocket.connectionID,p=()=>new mt((U,B)=>{if(this.connectionState===Fs.CONNECTED)return U();const j=()=>{this.off(Lt.WS_CLOSED,K),U()},K=()=>{this.off(Lt.WS_CONNECTED,j),B(new Le(W.WS_ABORT))};this.once(Lt.WS_CONNECTED,j),this.once(Lt.WS_CLOSED,K),t!==Mt.PUBLISH&&t!==Mt.SUBSCRIBE&&t!==Mt.UNSUBSCRIBE&&t!==Mt.UNPUBLISH&&t!==Mt.CONTROL&&t!==Mt.RESTART_ICE||this.once(Lt.DISCONNECT_P2P,()=>{B(new Le(W.DISCONNECT_P2P))}),t!==Mt.PUBLISH&&t!==Mt.RESTART_ICE||this.once(Lt.ABORT_P2P_EXECUTION,()=>{B(new Le(W.DISCONNECT_P2P))})});if(this.connectionState!==Fs.CONNECTING&&this.connectionState!==Fs.RECONNECTING||t===Mt.JOIN||t===Mt.REJOIN||await p(),t===Mt.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),G("DC_DEBUG_LOG")&&N.debug("[datachannel-signal] sendMessage",A),await this.websocket.sendMessage(A,!0,!1),i)return;const f=new mt((U,B)=>{let j=!1;const K=(ie,xe)=>{j=!0,U({isSuccess:ie==="success",message:xe||{}}),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.emit(Lt.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(l),K);const q=()=>{B(new Le(W.WS_ABORT,"type: ".concat(t))),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.off("res-@".concat(l),K)};this.once(Lt.WS_CLOSED,q),this.once(Lt.WS_RECONNECTING,q),Qn(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||j||(N.warning("dc request timeout, type: ".concat(t)),this.emit(Lt.REQUEST_TIMEOUT,t,s))})});let b=null;try{b=await f}catch(U){if(this.connectionState===Fs.CLOSED||t===Mt.LEAVE)throw new Le(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?U.throw():t===Mt.JOIN||t===Mt.REJOIN?null:(await p(),await this.request(t,s))}if(b.isSuccess)return b.message;const w=Number(b.message.error_code||b.message.code),_=bp(w),C=new Le(W.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(b.message.error_str),{code:w,data:b.message});return _.action==="success"?b.message:(N.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(_.desc,", action: ").concat(_.action)),w===Gt.ERR_TOO_MANY_BROADCASTERS?((t===Mt.JOIN||t===Mt.REJOIN)&&(this.initError=C,this.close()),C.throw()):_.action==="failed"?C.throw():_.action==="quit"?(this.initError=C,this.close(),C.throw()):(w===Gt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Iu.MULTI_IP)):this.reconnect(_.action,Iu.SERVER_ERROR),t===Mt.JOIN||t===Mt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new mt(r=>{const i=l=>{(!s||s(l))&&(this.off(t,i),r(l))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(gp.WRTC_STATS,s)}upload(t,s){const r={_type:t,_message:s};try{this.websocket.sendMessage(r)}catch{const l=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Fs.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,s){const r={_type:t,_message:s};await this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new mt((s,r)=>{this.once(Lt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Lt.WS_CLOSED,()=>r(this.initError||new Le(W.WS_ABORT))),this.connectionState=Fs.CONNECTING,this.websocket.init(t).catch(r),this.websocket.once(In.FAILBACK,()=>{r(new Le(W.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(N.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new Le(W.INIT_DATACHANNEL_TIMEOUT)))},G("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||Us.LEAVE,this.connectionState=Fs.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Us.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new M3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),G("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await wn(this,Lt.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const s=await this.request(Mt.JOIN,t);if(this.store.joinRep(),this.ortc=t==null?void 0:t.ortc,!s)return this.emit(Lt.REPORT_JOIN_GATEWAY,W.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Fs.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new Le(W.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=rp(this,Lt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const s=await this.request(Mt.REJOIN,t);return!!s&&(this.connectionState=Fs.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),G("DC_PINGPONG_INTERVAL")),s.peers&&s.peers.forEach(r=>{this.emit(as.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(as.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(as.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(as.MUTE_AUDIO,{uid:r.uid}):this.emit(as.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(as.MUTE_VIDEO,{uid:r.uid}):this.emit(as.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(as.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(as.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(as.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(as.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(as.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){if(!this.ortc)return!1;const s={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Mt.DOWNGRADE_CODEC,s)}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);const s=bp(t.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Us.UID_BANNED),void this.close()):void this.reconnect(s.action,Iu.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,G("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const t=G("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",Iu.FALLBACK):this.request(Mt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-s;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Mt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){const{inflateLength:t,deflateLength:s}=this.websocket.getInflateData();t!==0&&s!==0&&this.upload(gp.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(In.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(In.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(In.CLOSED,()=>{this.connectionState=Fs.CLOSED}),this.websocket.on(In.FAILED,()=>{this._disconnectedReason=Us.NETWORK_ERROR,this.connectionState=Fs.CLOSED}),this.websocket.on(In.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Fs.CONNECTED?this.connectionState=Fs.RECONNECTING:this.connectionState=Fs.CONNECTING}),this.websocket.on(In.WILL_RECONNECT,(t,s)=>{if(rp(this,Lt.IS_P2P_DISCONNECTED)&&t==="retry")return N.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Lt.NEED_RENEW_SESSION),this.emit(Lt.DISCONNECT_P2P),s("tryNext");t!=="retry"&&(N.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Lt.NEED_RENEW_SESSION),this.emit(Lt.DISCONNECT_P2P)),s(t)}),this.websocket.on(In.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{N.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Iu.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof Le&&t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Gt.ERR_NO_AUTHORIZED)return N.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Iu.SERVER_ERROR);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Iu.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(In.REQUEST_NEW_URLS,(t,s)=>{wn(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(In.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(as.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(In.TO_CONNECT_DATACHANNEL,(t,s)=>{wn(this,Lt.PRE_CONNECT_PC).then(t).catch(s)}),this.websocket.on(In.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Lt.DATACHANNEL_FAILBACK)})}}const Cre={name:"DataChannelConnection",create:function(e){let{store:t,spec:s}=e;return new _re(s,t)}},Nre={name:"DataChannelSignal",create:function(e){let{store:t,spec:s}=e;return new Sre(s,t)}};F1(),pr("PROCESS_ID","process-".concat(ar(8,""),"-").concat(ar(4,""),"-").concat(ar(4,""),"-").concat(ar(4,""),"-").concat(ar(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void N.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),s=Date.now();N.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(or,r)){const{value:i,expires:l}=t[r];if(l&&l<=s)return;Lo[r]=i,or[r]=i}})}catch(t){N.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Lo.AREAS)&&Lo.AREAS.length>0&&MN(Lo.AREAS,!0);const V3=(e,t,s)=>{N.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),pr(e,t,s)};kd(Hse,!1),kd(Wse,!1),kd(_te,!1),kd(rre,!1),kd(Mse,!1),kd(mre,!1),kd(bre,!1),kd(vre,!1),kd(Cre,!1),kd(Nre,!1);const _n=function(e){const t=new jr,s=e,r={getListeners:t.getListeners.bind(t),on:(i,l)=>(function(A,u){A===Rd.SECURITY_POLICY_VIOLATION&&mM(u,!0)}(i,l),t.on.bind(t)(i,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return pM(pM({},s),r)}({__TRACK_LIST__:lp,VERSION:lc,BUILD:Q1,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:V3,getParameter:G,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const s=await async function(r){let i;return Ls().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!s)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(s)}catch(t){throw new Le(W.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const t=kt.reportApiInvoke(null,{name:kr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:br.TRACER}),s=function(){let l=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],A=!1;try{const u=window.RTCPeerConnection,p=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;A=!(!u||!f),l&&!p&&(A=!1),A&&I0()&&CL(75)&&new u().close()}catch(u){N.error("check system requirement failed: ",u),A=!1}return A}(e),r=Ete();N.debug("checkSystemRequirements, api:",s,"browser",r);const i=s&&r;return t.onSuccess(i),G("IGNORE_RTC_DEVICE_CHECK")?s:i},getDevices:function(e){return Mo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Mo.getRecordingDevices(e)},getCameras:function(e){return Mo.getCamerasDevices(e)},getElectronScreenSources:Oj,getPlaybackDevices:function(e){return Mo.getSpeakers(e)},createClient:AM,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=G("CAMERA_CAPTURE_CONFIG"),s=ar(8,"track-cam-"),r=kt.reportApiInvoke(null,{id:s,tag:br.TRACER,name:kr.CREATE_CAM_VIDEO_TRACK,options:[Er({},e),t]});t&&(e.encoderConfig=t);const i=vw(e);let l=null;N.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{l=(await Fo({video:i},s)).getVideoTracks()[0]||null}catch(u){throw r.onError(u),u}if(!l){const u=new Me(W.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(u),u.throw(N)}if(e.optimizationMode&&oN(s,l,e,Kc(e.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const u=Kc(e.encoderConfig);e.encoderConfig=u,delete u.bitrateMax,delete u.bitrateMin}const A=new _w(l,e,i,e.scalabiltyMode?fw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return r.onSuccess(A.getTrackId()),N.info("create camera video success, trackId:",s),A},createCustomVideoTrack:function(e){const t=ar(8,"track-cus-"),s=kt.reportApiInvoke(null,{id:t,tag:br.TRACER,name:kr.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});G("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new xr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?fw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[rr.CUSTOM_TRACK]);return s.onSuccess(r.getTrackId()),N.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof t=="object"?function(_){const C=Vj(_);return vj()&&_.suppressLocalAudioPlayback&&(C.suppressLocalAudioPlayback=_.suppressLocalAudioPlayback),wj()&&_.restrictOwnAudio&&(C.restrictOwnAudio=!0),C}(t):void 0;s&&(t="auto");const r=ar(8,"track-scr-v-"),i=kt.reportApiInvoke(null,{id:r,tag:br.TRACER,name:kr.CREATE_SCREEN_VIDEO_TRACK,options:[Er({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(_){const C={};_.screenSourceType&&(C.mediaSource=_.screenSourceType),_.extensionId&&EA()&&(C.extensionId=_.extensionId);const{displaySurface:U,selfBrowserSurface:B,surfaceSwitching:j,systemAudio:K,preferCurrentTab:q,windowAudio:ie,monitorTypeSurfaces:xe}=_;(Ol(107)||Su(107)||ep(93))&&(U&&(hn(U,"displaySurface",["browser","window","monitor"]),C.displaySurface=U),B?(hn(B,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=B):C.selfBrowserSurface="include",j&&(hn(j,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=j)),(Ol(105)||Su(105)||ep(91))&&K&&(hn(K,"systemAudio",["exclude","include"]),C.systemAudio=K),(Ol(94)||Su(94)||ep(80))&&q&&(C.preferCurrentTab=!0),(Ol(141)||Su(141)||ep(125))&&ie&&(hn(ie,"windowAudio",["exclude","system"]),C.windowAudio=ie),(Ol(119)||Su(119)||ep(105))&&xe&&(hn(xe,"monitorTypeSurfaces",["exclude","include"]),C.monitorTypeSurfaces=xe),_.electronScreenSourceId&&(C.sourceId=_.electronScreenSourceId);const ye=_.encoderConfig?q1(_.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:ye?ye.width:void 0,maxHeight:ye?ye.height:void 0},ye&&(ye.frameRate&&(typeof ye.frameRate=="number"?(C.mandatory.maxFrameRate=ye.frameRate,C.mandatory.minFrameRate=ye.frameRate):(C.mandatory.maxFrameRate=ye.frameRate.max||ye.frameRate.ideal||ye.frameRate.exact||void 0,C.mandatory.minFrameRate=ye.frameRate.min||ye.frameRate.ideal||ye.frameRate.exact||void 0),C.frameRate=ye.frameRate),ye.width&&(C.width=ye.width),ye.height&&(C.height=ye.height)),C}(e);let A=null,u=null;const p=Ls();if(!p.supportShareAudio&&t==="enable"){const _=new Me(W.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(_),_.throw(N)}N.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const f=p.supportShareAudio&&t!=="disable";try{const _=await Fo({screen:l,screenAudio:f?s||!0:void 0},r);A=_.getVideoTracks()[0]||null,u=_.getAudioTracks()[0]||null}catch(_){throw i.onError(_),_}if(!A){const _=new Me(W.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(_),_.throw(N)}if(!u&&t==="enable"){A&&A.stop();const _=new Me(W.SHARE_AUDIO_NOT_ALLOWED);return i.onError(_),_.throw(N)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(oN(r,A,e,e.encoderConfig&&q1(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const b=new xr(A,e.encoderConfig?q1(e.encoderConfig):{},e.scalabiltyMode?fw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[rr.SCREEN_TRACK]);if(!u)return i.onSuccess(b.getTrackId()),N.info("create screen video track success","video:",b.getTrackId()),b;const w=new $r(u,void 0,ar(8,"track-scr-a-"),!1);return i.onSuccess([b.getTrackId(),w.getTrackId()]),N.info("create screen video track success","video:",b.getTrackId(),"audio:",w.getTrackId()),[b,w]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=G("CAMERA_CAPTURE_CONFIG"),r=ar(8,"track-mic-"),i=ar(8,"track-cam-"),l=kt.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:br.TRACER,name:kr.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,s]});s&&(t.encoderConfig=s);const A=vw(t),u=Qj(e);let p=null,f=null;N.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const _=await Fo({audio:u,video:A},"".concat(r,"-").concat(i));p=_.getAudioTracks()[0],f=_.getVideoTracks()[0]}catch(_){throw l.onError(_),_}if(!p||!f){const _=new Me(W.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(_),_.throw(N)}if(t.optimizationMode&&oN(i,f,t,Kc(t.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const _=Kc(t.encoderConfig);t.encoderConfig=_,delete _.bitrateMax,delete _.bitrateMin}const b=new M0(p,e,u,r),w=new _w(f,t,A,t.scalabiltyMode?fw(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return l.onSuccess([b.getTrackId(),w.getTrackId()]),N.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[b,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=ar(8,"track-mic-"),s=kt.reportApiInvoke(null,{id:t,tag:br.TRACER,name:kr.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=Qj(e);let i=null;N.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Fo({audio:r},t)).getAudioTracks()[0]||null}catch(A){throw s.onError(A),A}if(!i){const A=new Me(W.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(A),A.throw(N)}const l=new M0(i,e,r,t);return s.onSuccess(l.getTrackId()),N.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:pU,createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:s,encoderConfig:r}=e;let{source:i}=e;const l={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:s,encoderConfig:r},A=ar(8,"track-buf-"),u=kt.reportApiInvoke(null,{id:A,tag:br.TRACER,name:kr.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if(G("DISABLE_WEBAUDIO"))throw new Me(W.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");N.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",A);const p=i;if(!(i instanceof AudioBuffer))try{i=await async function(w,_){let C=null;if(typeof w=="string"){const B=RP.get(w);if(B)return N.debug("use cached audio resource: ",w),B;try{C=(await kl(()=>Ta.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new Me(W.FETCH_AUDIO_FILE_FAILED,j.toString())}}else C=await new mt((j,K)=>{const q=new FileReader;q.onload=ie=>{ie.target?j(ie.target.result):K(new Me(W.READ_LOCAL_AUDIO_FILE_ERROR))},q.onerror=()=>{K(new Me(W.READ_LOCAL_AUDIO_FILE_ERROR))},q.readAsArrayBuffer(w)});const U=await function(B){const j=vf();return new mt((K,q)=>{j.decodeAudioData(B,ie=>{K(ie)},ie=>{q(new Me(W.DECODE_AUDIO_FILE_FAILED,ie.toString()))})})}(C);return typeof w=="string"&&_&&RP.set(w,U),U}(i,s)}catch(w){return u.onError(w),w.throw(N)}const f=new HZ(i),b=new QZ(p,f,r?gw(r):{},A);return N.info("create buffer source audio track success, trackId:",A),u.onSuccess(b.getTrackId()),b},setAppType:function(e){if(N.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw N.debug("Invalid appType"),new Le(W.INVALID_PARAMS,"invalid app type",e);pr("APP_TYPE",Math.floor(e))},setLogLevel:function(e){N.setLogLevel(e)},enableLogUpload:function(){G("USE_NEW_LOG")?pr("UPLOAD_LOG",!0):N.enableLogUpload()},disableLogUpload:function(){G("USE_NEW_LOG")?pr("UPLOAD_LOG",!1):N.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new k4},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=kt.reportApiInvoke(null,{tag:br.TRACER,name:kr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof $r||e instanceof yf)){const p=new Le(W.INVALID_TRACK,"the parameter is not a audio track");return s.onError(p),p.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof $r?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let l=i,A=i;const u=Date.now();return new mt(p=>{const f=setInterval(()=>{const b=e.getVolumeLevel();l=b>l?b:l,A=b<A?b:A;const w=l-A>1e-4,_=Date.now()-u;if(w||_>t){clearInterval(f);const C=w,U={duration:_,deviceLabel:r,maxVolumeLevel:l,result:C};N.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(U))),s.onSuccess(U),p(C)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=kt.reportApiInvoke(null,{tag:br.TRACER,name:kr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof xr||e instanceof _f)){const w=new Le(W.INVALID_TRACK,"the parameter is not a video track");return s.onError(w),w.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof xr?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(Jn()||nw())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([i]),l.play();const A=document.createElement("canvas");A.width=160,A.height=120;let u=0,p=0;try{const w=Date.now();u=await function(_,C,U,B){let j,K=0,q=null;return new mt((ie,xe)=>{function ye(){K>B&&j&&(j(),ie(K));const ue=U.getContext("2d");if(!ue){const Ze=new Le(W.UNEXPECTED_ERROR,"can not get canvas 2d context.");return N.error(Ze.toString()),void xe(Ze)}ue.drawImage(_,0,0,160,120);const Re=ue.getImageData(0,0,U.width,U.height),Ge=Math.floor(Re.data.length/3);if(q){for(let Ze=0;Ze<Ge;Ze+=3)if(Re.data[Ze]!==q[Ze])return K+=1,void(q=Re.data);q=Re.data}else q=Re.data}setTimeout(()=>{j&&(j(),ie(K))},C),j=eN(()=>{ye()},30)})}(l,t,A,4),p=Date.now()-w}catch(w){throw s.onError(w),w}cte===Ys.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const f=u>4,b={duration:p,changedPicNum:u,deviceLabel:r,result:f};return N.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),s.onSuccess(b),f},setArea:MN,audioElementPlayCenter:ea,resumeAudioContext:function(){return ea.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Cte.processExternalMediaAEC(e)},registerExtensions:function(e){const t=G("PLUGIN_INFO")||[];e.forEach(s=>{"name"in s&&!nt(t).call(t,s.name)&&t.push(s.name);const r=s;r.__registered__=!0,r.logger.hookLog=N.extLog,r.reporter.hookApiInvoke=kt.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=G(i)})}),V3("PLUGIN_INFO",t)},ChannelMediaRelayError:Cf,ChannelMediaRelayEvent:TA,ChannelMediaRelayState:Ha,RemoteStreamFallbackType:jZ,RemoteStreamType:LZ,ConnectionDisconnectedReason:Us,AudienceLatencyLevelType:dZ,AREAS:$s,preload:async function(e,t,s,r){return c2(e,t,s,r)},startLastmileProbeTest:async function(e,t,s,r){let i={state:"unavailable"};await c2(e,t,s,r);const l=await l2({appId:e,cname:t,token:s||e,uid:r,cloudProxyServer:"disabled"});if(!l)return i;await d2(l);let A,u=AM({mode:"rtc",codec:"vp8"});try{A=await u.join(e,t,s,r,{networkQualityProbe:!0})}catch{return i}const p=new ute,f=p.createMuteAudioTrack();let b=await pU({mediaStreamTrack:f});await u.publish([b]);let[w,_,C]=await new mt((ie,xe)=>{const ye=setTimeout(()=>{clearTimeout(ye),ie([!0,null,"audio"])},5e3);u.on("user-published",async(ue,Re)=>{ue.uid===A&&(clearTimeout(ye),ie([!1,ue,Re]))})});if(w||!_)return await u.unpublish([b]),await u.leave(),b.close(),p.close(),i;await u.subscribe(_,C),await new mt((ie,xe)=>{const ye=setTimeout(()=>{clearTimeout(ye),ie(null)},5e3)});let U=u.getRTCStats(),B=u.getLocalAudioStats();const j=U.RTT,K=B.sendJitterMs,q=B.currentPacketLossRate;return i={state:"complete",rtt:j,packetLossRate:q,jitter:K,networkQuality:((ie,xe,ye)=>{let ue=1;if(ye>0){let ns=Math.log(100*ye)/Math.log(2)+1;ns=Math.min(5,Math.max(0,ns)),ue=1-ns/5}let Re=1;if(ie>0){let ns=Math.log(ie/40)/Math.log(2)+1;ns=Math.min(5,Math.max(0,ns)),Re=1-ns/5}let Ge=1;if(xe>0){let ns=Math.log(xe/10)/Math.log(2.5)+1;ns=Math.min(5,Math.max(0,ns)),Ge=1-ns/5}const Ze=.5*ue+.3*Re+.2*Ge;let _t=0;return _t=Ze>=.8?1:Ze>=.6?2:Ze>=.4?3:Ze>=.2?4:5,_t})(j,K,q)},await u.unsubscribe(_),await u.unpublish([b]),await u.leave(),b.close(),p.close(),await d2(l),i}});return Object.defineProperties(_n,{onAudioAutoplayFailed:{get:()=>Ia.onAudioAutoplayFailed,set:e=>{Ia.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ia.onAutoplayFailed,set:e=>{Ia.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>_n._onSecurityPolicyViolation,set(e){_n._onSecurityPolicyViolation=e,mM(e)}},__CLIENT_LIST__:{get:()=>G("SHOW_GLOBAL_CLIENT_LIST")?mp:[]}}),Mo.on(Ap.CAMERA_DEVICE_CHANGED,e=>{N.info("camera device changed",JSON.stringify(e)),_n.onCameraChanged&&_n.onCameraChanged(e),_n.safeEmit(Rd.CAMERA_CHANGED,e)}),Mo.on(Ap.RECORDING_DEVICE_CHANGED,e=>{N.info("microphone device changed",JSON.stringify(e)),_n.onMicrophoneChanged&&_n.onMicrophoneChanged(e),_n.safeEmit(Rd.MICROPHONE_CHANGED,e)}),Mo.on(Ap.PLAYOUT_DEVICE_CHANGED,e=>{N.debug("playout device changed",JSON.stringify(e)),_n.onPlaybackDeviceChanged&&_n.onPlaybackDeviceChanged(e),_n.safeEmit(Rd.PLAYBACK_DEVICE_CHANGED,e)}),ea.onAutoplayFailed=()=>{N.info("detect audio element autoplay failed"),Ia.onAudioAutoplayFailed&&Ia.onAudioAutoplayFailed()},mr.on("autoplay-failed",()=>{N.info("detect webaudio autoplay failed"),Ia.onAudioAutoplayFailed&&Ia.onAudioAutoplayFailed(),_n.safeEmit(Rd.AUTOPLAY_FAILED)}),mr.on(Ai.STATE_CHANGE,(e,t)=>{N.info("audio context state changed: ".concat(t," => ").concat(e)),_n.onAudioContextStateChanged&&_n.onAudioContextStateChanged(e,t),_n.safeEmit(Rd.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Wr.on(sp.NETWORK_STATE_CHANGE,(e,t)=>{N.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=_n),_n})})(_H);var Rle=_H.exports;const mg=kre(Rle);function Ile(){var Ue,re,ve,fe,Ie,je,Ee,We,ze,st,bt;const{appointmentId:a}=sx(),o=to(),[c,d]=te.useState(null),[h,m]=te.useState(!0),[g,x]=te.useState(!1),[v,E]=te.useState("video"),[S,I]=te.useState([]),[k,R]=te.useState(""),[O,F]=te.useState({video:!0,audio:!0,speaker:!0}),[M,Q]=te.useState(null),[Z,$]=te.useState(null),[X,be]=te.useState(null),[me,Ne]=te.useState([]),[le,H]=te.useState(!1),Ae=te.useRef(null),J=te.useRef(null);te.useEffect(()=>(oe(),Y(),()=>{se()}),[a]);const Y=()=>{const Qe=mg.createClient({mode:"rtc",codec:"vp8"});Qe.on("user-published",async(rt,Nt)=>{await Qe.subscribe(rt,Nt),Nt==="video"&&(Ne(we=>[...we.filter(Rt=>Rt.uid!==rt.uid),rt]),J.current&&rt.videoTrack.play(J.current)),Nt==="audio"&&rt.audioTrack.play()}),Qe.on("user-unpublished",rt=>{Ne(Nt=>Nt.filter(we=>we.uid!==rt.uid))}),Qe.on("user-left",rt=>{Ne(Nt=>Nt.filter(we=>we.uid!==rt.uid))}),Q(Qe)},se=async()=>{Z&&(Z.stop(),Z.close()),X&&(X.stop(),X.close()),M&&le&&await M.leave()},oe=async()=>{try{const{data:Qe}=await Wo.getAppointmentDetails(a);d(Qe)}catch{Ct.error("Failed to load appointment details"),o("/doctors")}finally{m(!1)}},Te=async()=>{if(!M||!(c!=null&&c.videoRoom)){Ct.error("Video call not available");return}try{const{config:Qe}=c.videoRoom;if(Qe.type==="agora"&&Qe.appId&&Qe.token){await M.join(Qe.appId,Qe.channelName,Qe.token,Qe.uid);const rt=await mg.createCameraVideoTrack(),Nt=await mg.createMicrophoneAudioTrack();$(rt),be(Nt),Ae.current&&rt.play(Ae.current),await M.publish([rt,Nt]),H(!0),Ct.success("Joined video call successfully")}else Ct.error("Video call configuration not available")}catch(Qe){console.error("Error joining video call:",Qe),Ct.error("Failed to join video call")}},he=async()=>{try{await se(),H(!1),Ne([]),Ct.success("Left video call")}catch(Qe){console.error("Error leaving video call:",Qe)}},Ce=async()=>{try{await Wo.startConsultation(a),x(!0),(c==null?void 0:c.type)==="video"&&await Te(),Ct.success("Consultation started")}catch{Ct.error("Failed to start consultation")}},ee=async()=>{try{le&&await he(),await Wo.endConsultation(a),x(!1),Ct.success("Consultation ended"),o("/consultation-summary/"+a)}catch{Ct.error("Failed to end consultation")}},Be=()=>{if(!k.trim())return;const Qe={id:Date.now(),text:k,sender:"patient",timestamp:new Date};I([...S,Qe]),R("")},He=async Qe=>{if(Qe==="video"&&Z){const rt=!O.video;await Z.setEnabled(rt),F(Nt=>({...Nt,video:rt}))}else if(Qe==="audio"&&X){const rt=!O.audio;await X.setEnabled(rt),F(Nt=>({...Nt,audio:rt}))}else Qe==="speaker"&&F(rt=>({...rt,speaker:!rt.speaker}))};return h?n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})}):c?n.jsxs("div",{className:"min-h-screen bg-[#0a0f1a]",children:[n.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:n.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:()=>o("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:n.jsx(ln,{className:"w-5 h-5 text-slate-400"})}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center text-lg font-bold text-white",children:((ve=(re=(Ue=c.doctor)==null?void 0:Ue.name)==null?void 0:re[0])==null?void 0:ve.toUpperCase())||"D"}),n.jsxs("div",{children:[n.jsxs("h1",{className:"text-lg font-bold text-white",children:["Dr. ",(fe=c.doctor)==null?void 0:fe.name]}),n.jsx("p",{className:"text-sm text-slate-400",children:(Ie=c.doctor)==null?void 0:Ie.specialization})]})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${c.status==="confirmed"?"bg-green-500/20 text-green-400":c.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-slate-500/20 text-slate-400"}`,children:c.status})})]})}),g?n.jsxs("div",{className:"h-[calc(100vh-80px)] flex",children:[n.jsxs("div",{className:"flex-1 bg-slate-900 relative",children:[v==="video"&&n.jsxs("div",{className:"h-full relative",children:[n.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:me.length>0?n.jsx("div",{ref:J,className:"w-full h-full",style:{background:"#1e293b"}}):n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center text-4xl font-bold text-white mx-auto mb-4",children:((st=(ze=(We=c.doctor)==null?void 0:We.name)==null?void 0:ze[0])==null?void 0:st.toUpperCase())||"D"}),n.jsxs("p",{className:"text-white text-lg",children:["Dr. ",(bt=c.doctor)==null?void 0:bt.name]}),n.jsx("p",{className:"text-slate-400",children:le?"Waiting for doctor to join...":"Video consultation ready"})]})}),le&&n.jsxs("div",{className:"absolute top-4 right-4 w-48 h-36 bg-slate-800 rounded-lg overflow-hidden border-2 border-slate-600",children:[n.jsx("div",{ref:Ae,className:"w-full h-full",style:{background:"#1e293b"}}),n.jsx("div",{className:"absolute bottom-2 left-2 text-white text-xs bg-black/50 px-2 py-1 rounded",children:"You"})]}),n.jsx("div",{className:"absolute top-4 left-4",children:n.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${le?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${le?"bg-green-400":"bg-yellow-400"} animate-pulse`}),le?"Connected":"Connecting..."]})}),le&&n.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:n.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/90 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm",children:[n.jsx(wg,{className:"w-4 h-4"}),me.length+1," participants"]})})]}),n.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2",children:n.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/90 backdrop-blur-sm rounded-full px-6 py-3",children:[n.jsx("button",{onClick:()=>He("audio"),className:`p-3 rounded-full transition-colors ${O.audio?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:O.audio?"Mute microphone":"Unmute microphone",children:O.audio?n.jsx(uQ,{className:"w-5 h-5"}):n.jsx(hQ,{className:"w-5 h-5"})}),n.jsx("button",{onClick:()=>He("video"),className:`p-3 rounded-full transition-colors ${O.video?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:O.video?"Turn off camera":"Turn on camera",children:O.video?n.jsx(tI,{className:"w-5 h-5"}):n.jsx(zT,{className:"w-5 h-5"})}),n.jsx("button",{onClick:()=>He("speaker"),className:`p-3 rounded-full transition-colors ${O.speaker?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:O.speaker?"Mute speaker":"Unmute speaker",children:O.speaker?n.jsx(Jre,{className:"w-5 h-5"}):n.jsx($re,{className:"w-5 h-5"})}),n.jsx("button",{className:"p-3 rounded-full bg-slate-700 text-white hover:bg-slate-600 transition-colors",title:"Share screen",children:n.jsx(Zre,{className:"w-5 h-5"})}),n.jsx("button",{onClick:ee,className:"p-3 rounded-full bg-red-500 hover:bg-red-600 text-white transition-colors",title:"End consultation",children:n.jsx(Yi,{className:"w-5 h-5"})})]})})]}),n.jsxs("div",{className:"w-80 bg-[#111827] border-l border-slate-700 flex flex-col",children:[n.jsx("div",{className:"p-4 border-b border-slate-700",children:n.jsx("h3",{className:"text-white font-medium",children:"Chat"})}),n.jsx("div",{className:"flex-1 p-4 overflow-y-auto space-y-3",children:S.map(Qe=>n.jsx("div",{className:`flex ${Qe.sender==="patient"?"justify-end":"justify-start"}`,children:n.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${Qe.sender==="patient"?"bg-cyan-500 text-white":"bg-slate-700 text-white"}`,children:Qe.text})},Qe.id))}),n.jsx("div",{className:"p-4 border-t border-slate-700",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",value:k,onChange:Qe=>R(Qe.target.value),onKeyPress:Qe=>Qe.key==="Enter"&&Be(),placeholder:"Type a message...",className:"flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500"}),n.jsx("button",{onClick:Be,className:"bg-cyan-500 hover:bg-cyan-600 text-white p-2 rounded-lg transition-colors",children:n.jsx(ox,{className:"w-4 h-4"})})]})})]})]}):n.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Appointment Details"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Ti,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Date & Time"}),n.jsxs("p",{className:"text-slate-400 text-sm",children:[new Date(c.date).toLocaleDateString()," at ",c.timeSlot]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(ah,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Consultation Type"}),n.jsx("p",{className:"text-slate-400 text-sm capitalize",children:c.type})]})]}),c.symptoms&&n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Bn,{className:"w-5 h-5 text-cyan-400 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Symptoms"}),n.jsx("p",{className:"text-slate-400 text-sm",children:c.symptoms})]})]})]})]}),n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Doctor Information"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(ZR,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Experience"}),n.jsxs("p",{className:"text-slate-400 text-sm",children:[((je=c.doctor)==null?void 0:je.experience)||"5+"," years"]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(KT,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Location"}),n.jsx("p",{className:"text-slate-400 text-sm",children:((Ee=c.doctor)==null?void 0:Ee.location)||"Online"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(zA,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Rating"}),n.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(Qe=>n.jsx(zA,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},Qe)),n.jsx("span",{className:"text-slate-400 text-sm ml-1",children:"(4.8)"})]})]})]})]})]})]}),n.jsx("div",{className:"mt-8 text-center",children:n.jsxs("button",{onClick:Ce,className:"bg-gradient-to-r from-purple-500 to-orange-500 hover:from-purple-600 hover:to-orange-600 text-white px-8 py-4 rounded-xl font-medium transition-all inline-flex items-center gap-2",children:[n.jsx(ah,{className:"w-5 h-5"}),"Start Consultation"]})})]})]}):n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Ln,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),n.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Appointment Not Found"}),n.jsx("p",{className:"text-slate-400",children:"The appointment you're looking for doesn't exist."})]})}function Ole(){const{appointmentId:a}=sx(),o=to(),[c,d]=te.useState(null),[h,m]=te.useState(!0),[g,x]=te.useState(0),[v,E]=te.useState(""),[S,I]=te.useState(!1),[k,R]=te.useState("summary");te.useEffect(()=>{O()},[a]);const O=async()=>{try{const{data:$}=await Wo.getConsultationSummary(a);d($)}catch{Ct.error("Failed to load consultation summary"),o("/doctors")}finally{m(!1)}},F=async()=>{if(g===0){Ct.error("Please provide a rating");return}I(!0);try{await Wo.submitReview(a,{rating:g,review:v}),Ct.success("Review submitted successfully"),d($=>({...$,reviewSubmitted:!0}))}catch{Ct.error("Failed to submit review")}finally{I(!1)}},M=async()=>{try{const $=await Wo.downloadPrescription(a),X=new Blob([$.data],{type:"application/pdf"}),be=window.URL.createObjectURL(X),me=document.createElement("a");me.href=be,me.download=`prescription-${a}.pdf`,me.click(),window.URL.revokeObjectURL(be)}catch{Ct.error("Failed to download prescription")}};if(h)return n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})});const Q={doctor:{name:"Dr. Sarah Johnson",specialization:"General Physician"},date:new Date().toISOString(),duration:"30 minutes",diagnosis:"Vitamin D deficiency with mild fatigue symptoms",prescription:[{medication:"Vitamin D3 Supplement",dosage:"1000 IU daily",duration:"3 months",instructions:"Take with food, preferably in the morning"},{medication:"Multivitamin",dosage:"1 tablet daily",duration:"1 month",instructions:"Take after breakfast"}],recommendations:["Get 15-20 minutes of sunlight exposure daily","Include vitamin D rich foods like fatty fish, eggs, and fortified milk","Regular exercise to improve energy levels","Follow-up blood test in 3 months"],followUp:{date:new Date(Date.now()+90*24*60*60*1e3).toISOString(),type:"Blood test review"},notes:"Patient reported fatigue and low energy levels. Blood work shows vitamin D deficiency at 18 ng/mL (normal: 30-100). Recommended supplementation and lifestyle changes.",reviewSubmitted:!1},Z=c||Q;return n.jsxs("div",{className:"min-h-screen bg-[#0a0f1a] pb-8",children:[n.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:n.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:()=>o("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:n.jsx(ln,{className:"w-5 h-5 text-slate-400"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-bold text-white",children:"Consultation Summary"}),n.jsxs("p",{className:"text-sm text-slate-400",children:[new Date(Z.date).toLocaleDateString(),"  ",Z.duration]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[n.jsx(tE,{className:"w-4 h-4"}),"Download"]}),n.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg transition-colors",children:[n.jsx(iQ,{className:"w-4 h-4"}),"Share"]})]})]})}),n.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[n.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 mb-6",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center text-xl font-bold text-white",children:Z.doctor.name[0]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h2",{className:"text-xl font-bold text-white",children:Z.doctor.name}),n.jsx("p",{className:"text-slate-400",children:Z.doctor.specialization})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:"flex items-center gap-1 mb-1",children:[1,2,3,4,5].map($=>n.jsx(zA,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},$))}),n.jsx("p",{className:"text-sm text-slate-400",children:"4.8 rating"})]})]})}),n.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-xl w-fit mb-6",children:[n.jsx("button",{onClick:()=>R("summary"),className:`px-4 py-2 rounded-lg font-medium transition-all ${k==="summary"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Summary"}),n.jsx("button",{onClick:()=>R("prescription"),className:`px-4 py-2 rounded-lg font-medium transition-all ${k==="prescription"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Prescription"}),n.jsx("button",{onClick:()=>R("followup"),className:`px-4 py-2 rounded-lg font-medium transition-all ${k==="followup"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Follow-up"})]}),n.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[k==="summary"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:n.jsx(Cr,{className:"w-5 h-5 text-blue-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Diagnosis"})]}),n.jsx("p",{className:"text-slate-300 leading-relaxed",children:Z.diagnosis})]}),n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:n.jsx(Bn,{className:"w-5 h-5 text-green-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Doctor's Notes"})]}),n.jsx("p",{className:"text-slate-300 leading-relaxed",children:Z.notes})]}),n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center",children:n.jsx(dn,{className:"w-5 h-5 text-cyan-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Recommendations"})]}),n.jsx("ul",{className:"space-y-3",children:Z.recommendations.map(($,X)=>n.jsxs("li",{className:"flex items-start gap-3",children:[n.jsx(dn,{className:"w-5 h-5 text-green-400 mt-0.5 shrink-0"}),n.jsx("span",{className:"text-slate-300",children:$})]},X))})]})]}),k==="prescription"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center",children:n.jsx(Zu,{className:"w-5 h-5 text-purple-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Prescription"})]}),n.jsx("div",{className:"space-y-4",children:Z.prescription.map(($,X)=>n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[n.jsxs("div",{className:"flex items-start justify-between mb-2",children:[n.jsx("h4",{className:"font-bold text-white",children:$.medication}),n.jsx("span",{className:"text-sm text-slate-400",children:$.duration})]}),n.jsx("p",{className:"text-cyan-400 font-medium mb-2",children:$.dosage}),n.jsx("p",{className:"text-slate-300 text-sm",children:$.instructions})]},X))}),n.jsx("div",{className:"mt-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(th,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-yellow-400 font-medium mb-1",children:"Important"}),n.jsx("p",{className:"text-slate-300 text-sm",children:"Take medications as prescribed. Do not stop or change dosage without consulting your doctor."})]})]})})]}),k==="followup"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center",children:n.jsx(Ti,{className:"w-5 h-5 text-orange-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Follow-up Care"})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx(cl,{className:"w-5 h-5 text-cyan-400"}),n.jsx("h4",{className:"font-bold text-white",children:"Next Appointment"})]}),n.jsxs("p",{className:"text-slate-300",children:[new Date(Z.followUp.date).toLocaleDateString()," - ",Z.followUp.type]})]}),n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[n.jsx("h4",{className:"font-bold text-white mb-2",children:"Health Tracking"}),n.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"Monitor your progress and upload follow-up reports to track improvements."}),n.jsx("button",{className:"bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"Upload Report"})]})]})]})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Quick Actions"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[n.jsx(Ti,{className:"w-5 h-5 text-cyan-400"}),n.jsx("span",{className:"text-white",children:"Book Follow-up"})]}),n.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[n.jsx(rx,{className:"w-5 h-5 text-cyan-400"}),n.jsx("span",{className:"text-white",children:"Message Doctor"})]}),n.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[n.jsx(ene,{className:"w-5 h-5 text-cyan-400"}),n.jsx("span",{className:"text-white",children:"Save to Health Records"})]})]})]}),!Z.reviewSubmitted&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Rate this Consultation"}),n.jsxs("div",{className:"mb-4",children:[n.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"How was your experience?"}),n.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map($=>n.jsx("button",{onClick:()=>x($),className:`p-1 transition-colors ${$<=g?"text-yellow-400":"text-slate-600 hover:text-slate-400"}`,children:n.jsx(zA,{className:"w-6 h-6 fill-current"})},$))})]}),n.jsx("textarea",{value:v,onChange:$=>E($.target.value),placeholder:"Share your feedback (optional)",className:"w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-400 resize-none h-20 focus:outline-none focus:border-cyan-500"}),n.jsx("button",{onClick:F,disabled:S||g===0,className:"w-full mt-4 bg-cyan-500 hover:bg-cyan-600 disabled:bg-slate-600 text-white py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:S?n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):n.jsxs(n.Fragment,{children:[n.jsx(ox,{className:"w-4 h-4"}),"Submit Review"]})})]}),n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Health Tracking"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-slate-300",children:"Vitamin D Level"}),n.jsx("span",{className:"text-yellow-400",children:"Improving"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-slate-300",children:"Energy Level"}),n.jsx("span",{className:"text-green-400",children:"Stable"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-slate-300",children:"Sleep Quality"}),n.jsx("span",{className:"text-cyan-400",children:"Good"})]})]})]})]})]})]})]})}function kle(){const[a,o]=te.useState(null),[c,d]=te.useState(null),[h,m]=te.useState(null),[g,x]=te.useState([]),[v,E]=te.useState(!1),[S,I]=te.useState(!0),[k,R]=te.useState(!0),O=te.useRef(null),F=te.useRef(null),M="e788e8f838484d4dafe4705d682df57c",Q="healthai-test";te.useEffect(()=>(Z(),()=>{be()}),[]);const Z=()=>{const le=mg.createClient({mode:"rtc",codec:"vp8"});le.on("user-published",async(H,Ae)=>{await le.subscribe(H,Ae),Ae==="video"&&(x(J=>[...J.filter(Y=>Y.uid!==H.uid),H]),F.current&&H.videoTrack.play(F.current)),Ae==="audio"&&H.audioTrack.play()}),le.on("user-unpublished",H=>{x(Ae=>Ae.filter(J=>J.uid!==H.uid))}),le.on("user-left",H=>{x(Ae=>Ae.filter(J=>J.uid!==H.uid))}),o(le)},$=async()=>{if(a)try{const le=Math.floor(Math.random()*1e4);let H=null;try{const se=await(await fetch("/api/doctors/generate-video-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelName:Q,uid:le})})).json();se.success&&(H=se.token,console.log("Generated token:",H?"Token received":"No token (testing mode)"))}catch(Y){console.log("Failed to get token from server, using null token:",Y)}await a.join(M,Q,H,le);const Ae=await mg.createCameraVideoTrack(),J=await mg.createMicrophoneAudioTrack();d(Ae),m(J),O.current&&Ae.play(O.current),await a.publish([Ae,J]),E(!0),Ct.success("Joined video call successfully!")}catch(le){console.error("Error joining channel:",le),Ct.error("Failed to join video call: "+le.message)}},X=async()=>{if(a)try{await be(),E(!1),x([]),Ct.success("Left video call")}catch(le){console.error("Error leaving channel:",le),Ct.error("Failed to leave video call")}},be=async()=>{c&&(c.stop(),c.close(),d(null)),h&&(h.stop(),h.close(),m(null)),a&&v&&await a.leave()},me=async()=>{if(c){const le=!S;await c.setEnabled(le),I(le)}},Ne=async()=>{if(h){const le=!k;await h.setEnabled(le),R(le)}};return n.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:n.jsxs("div",{className:"max-w-6xl mx-auto",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Video Call Test"}),n.jsx("p",{className:"text-slate-400",children:"Test your Agora.io video calling setup"}),n.jsx("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:n.jsxs("p",{className:"text-sm text-slate-300",children:[n.jsx("strong",{children:"Channel:"})," ",Q," | ",n.jsx("strong",{children:"App ID:"})," ",M.substring(0,8),"..."]})})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[n.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[n.jsx("div",{ref:O,className:"w-full h-full bg-slate-800"}),n.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:["You ",v?"(Live)":"(Preview)"]}),!S&&n.jsx("div",{className:"absolute inset-0 bg-slate-800 flex items-center justify-center",children:n.jsx(zT,{className:"w-16 h-16 text-slate-400"})})]}),n.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[g.length>0?n.jsx("div",{ref:F,className:"w-full h-full bg-slate-800"}):n.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(ah,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),n.jsx("p",{className:"text-slate-400",children:v?"Waiting for others to join...":"Remote participant will appear here"})]})}),g.length>0&&n.jsx("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:"Remote User"})]})]}),n.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[n.jsx("button",{onClick:Ne,className:`p-4 rounded-full transition-colors ${k?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!v,children:k?n.jsx(uQ,{className:"w-6 h-6"}):n.jsx(hQ,{className:"w-6 h-6"})}),n.jsx("button",{onClick:me,className:`p-4 rounded-full transition-colors ${S?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!v,children:S?n.jsx(ah,{className:"w-6 h-6"}):n.jsx(zT,{className:"w-6 h-6"})}),v?n.jsxs("button",{onClick:X,className:"bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[n.jsx(tne,{className:"w-5 h-5"}),"Leave Call"]}):n.jsxs("button",{onClick:$,className:"bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[n.jsx(sI,{className:"w-5 h-5"}),"Join Call"]})]}),n.jsx("div",{className:"text-center",children:n.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${v?"bg-green-500/20 text-green-400":"bg-slate-500/20 text-slate-400"}`,children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${v?"bg-green-400 animate-pulse":"bg-slate-400"}`}),v?`Connected (${g.length+1} participants)`:"Not connected"]})}),n.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Testing Instructions:"}),n.jsxs("ol",{className:"text-slate-300 space-y-2 list-decimal list-inside",children:[n.jsx("li",{children:'Click "Join Call" to start the video call'}),n.jsx("li",{children:"Allow camera and microphone permissions when prompted"}),n.jsx("li",{children:"Open this page in another browser tab/window to test with multiple participants"}),n.jsx("li",{children:"Test the mute/unmute and video on/off controls"}),n.jsx("li",{children:"Check that you can see and hear other participants"})]}),n.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:n.jsxs("p",{className:"text-blue-400 text-sm",children:[n.jsx("strong",{children:"Note:"})," This is using your Agora.io free tier (10,000 minutes/month). Perfect for testing and development!"]})}),n.jsxs("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[n.jsx("h4",{className:"text-yellow-400 font-medium mb-2",children:" Troubleshooting"}),n.jsxs("div",{className:"text-yellow-300 text-sm space-y-1",children:[n.jsx("p",{children:n.jsx("strong",{children:"If video call fails:"})}),n.jsx("p",{children:" Check browser console for error messages"}),n.jsx("p",{children:" Ensure camera/microphone permissions are granted"}),n.jsx("p",{children:" Try disabling token authentication in Agora Console"}),n.jsx("p",{children:" Check server logs for token generation issues"})]})]}),n.jsxs("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[n.jsx("h4",{className:"text-green-400 font-medium mb-2",children:" Quick Fix"}),n.jsx("div",{className:"text-green-300 text-sm",children:n.jsxs("p",{children:[n.jsx("strong",{children:"Easiest solution:"}),' Go to Agora Console  Project Settings  Change Authentication from "App ID + Token" to "App ID only"']})})]})]})]})})}function Dle(){const[a,o]=te.useState(""),[c,d]=te.useState(!1),[h,m]=te.useState(null),g=async x=>{if(x.preventDefault(),!a){Ct.error("Please enter an email address");return}d(!0),m(null);try{const E=await(await fetch("/api/doctors/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})})).json();E.success?(m({success:!0,message:E.message}),Ct.success("Test email sent successfully!")):(m({success:!1,message:E.message}),Ct.error("Failed to send email"))}catch(v){console.error("Email test error:",v),m({success:!1,message:v.message}),Ct.error("Failed to send email")}finally{d(!1)}};return n.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:n.jsxs("div",{className:"max-w-2xl mx-auto",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Email Test"}),n.jsx("p",{className:"text-slate-400",children:"Test your SMTP email configuration"})]}),n.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[n.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[n.jsx(ax,{className:"w-5 h-5 text-cyan-400"}),"Current SMTP Configuration"]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-slate-400",children:"Host:"}),n.jsx("span",{className:"text-white ml-2",children:"smtp.gmail.com"})]}),n.jsxs("div",{children:[n.jsx("span",{className:"text-slate-400",children:"Port:"}),n.jsx("span",{className:"text-white ml-2",children:"587"})]}),n.jsxs("div",{children:[n.jsx("span",{className:"text-slate-400",children:"User:"}),n.jsx("span",{className:"text-white ml-2",children:"tech@colabplatforms.com"})]}),n.jsxs("div",{children:[n.jsx("span",{className:"text-slate-400",children:"From:"}),n.jsx("span",{className:"text-white ml-2",children:"HealthAI <tech@colabplatforms.com>"})]})]})]}),n.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Send Test Email"}),n.jsxs("form",{onSubmit:g,className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Test Email Address"}),n.jsx("input",{type:"email",value:a,onChange:x=>o(x.target.value),placeholder:"Enter email to receive test appointment confirmation",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500",required:!0})]}),n.jsx("button",{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-purple-500 to-orange-500 hover:from-purple-600 hover:to-orange-600 disabled:from-slate-600 disabled:to-slate-600 text-white py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2",children:c?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Sending..."]}):n.jsxs(n.Fragment,{children:[n.jsx(ox,{className:"w-5 h-5"}),"Send Test Email"]})})]})]}),h&&n.jsxs("div",{className:`rounded-2xl p-6 ${h.success?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"}`,children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[h.success?n.jsx(dn,{className:"w-6 h-6 text-green-400"}):n.jsx(Ln,{className:"w-6 h-6 text-red-400"}),n.jsx("h3",{className:`text-lg font-bold ${h.success?"text-green-400":"text-red-400"}`,children:h.success?"Email Sent Successfully!":"Email Failed"})]}),n.jsx("p",{className:`${h.success?"text-green-300":"text-red-300"}`,children:h.message}),h.success&&n.jsxs("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:[n.jsx("h4",{className:"text-white font-medium mb-2",children:"What to expect:"}),n.jsxs("ul",{className:"text-slate-300 text-sm space-y-1",children:[n.jsx("li",{children:' Check your inbox for "Appointment Confirmation - HealthAI"'}),n.jsx("li",{children:" The email will contain appointment details and a join link"}),n.jsx("li",{children:" It may take a few minutes to arrive"}),n.jsx("li",{children:" Check spam folder if not received"})]})]})]}),n.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Email Features"}),n.jsxs("div",{className:"space-y-4 text-slate-300",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-white font-medium mb-2",children:" Appointment Confirmation"}),n.jsx("p",{className:"text-sm",children:"Professional HTML email with appointment details, doctor info, and video call join link."})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-white font-medium mb-2",children:" Automated Reminders"}),n.jsx("p",{className:"text-sm",children:"System sends reminders 24 hours before and 30 minutes before appointments."})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-white font-medium mb-2",children:" Mobile Responsive"}),n.jsx("p",{className:"text-sm",children:"Emails look great on all devices with touch-friendly buttons and responsive design."})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-white font-medium mb-2",children:" Professional Design"}),n.jsx("p",{className:"text-sm",children:"Branded emails with HealthAI colors, gradients, and professional layout."})]})]})]}),n.jsxs("div",{className:"mt-8 bg-yellow-500/10 border border-yellow-500/20 rounded-2xl p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-yellow-400 mb-4",children:"Troubleshooting"}),n.jsxs("div",{className:"space-y-2 text-yellow-300 text-sm",children:[n.jsxs("p",{children:[" ",n.jsx("strong",{children:"Gmail App Password:"})," Make sure you're using an app password, not your regular Gmail password"]}),n.jsxs("p",{children:[" ",n.jsx("strong",{children:"2FA Required:"})," Gmail requires 2-factor authentication to generate app passwords"]}),n.jsxs("p",{children:[" ",n.jsx("strong",{children:"Less Secure Apps:"}),' App passwords bypass the need for "less secure apps" setting']}),n.jsxs("p",{children:[" ",n.jsx("strong",{children:"Rate Limits:"})," Gmail has sending limits (500 emails/day for free accounts)"]}),n.jsxs("p",{children:[" ",n.jsx("strong",{children:"Spam Filters:"})," Test emails might go to spam initially"]})]})]})]})})}const Ble=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],PA={startTime:"09:00",endTime:"18:00",slotDuration:30};function Lle(){const[a,o]=te.useState(PA),[c,d]=te.useState({}),[h,m]=te.useState({}),[g,x]=te.useState(!1),[v,E]=te.useState(!0),S=()=>{const X=[],be=new Date;for(let me=0;me<7;me++){const Ne=new Date(be);Ne.setDate(be.getDate()+me),X.push({date:Ne.toISOString().split("T")[0],dayName:Ble[Ne.getDay()],displayDate:Ne.toLocaleDateString("en-US",{month:"short",day:"numeric"}),isToday:me===0})}return X},[I]=te.useState(S());te.useEffect(()=>{k()},[]);const k=async()=>{var X,be,me,Ne,le,H,Ae;try{const{data:J}=await Wo.getMyAvailability(),Y={startTime:((be=(X=J.availability)==null?void 0:X.settings)==null?void 0:be.startTime)||PA.startTime,endTime:((Ne=(me=J.availability)==null?void 0:me.settings)==null?void 0:Ne.endTime)||PA.endTime,slotDuration:((H=(le=J.availability)==null?void 0:le.settings)==null?void 0:H.slotDuration)||PA.slotDuration};o(Y),(Ae=J.availability)!=null&&Ae.blockedSlots&&m(J.availability.blockedSlots),R(Y)}catch(J){console.error("Failed to fetch availability:",J),R(PA)}finally{E(!1)}},R=X=>{X||(X=PA);const be={},me=X.startTime||PA.startTime,Ne=X.endTime||PA.endTime,le=X.slotDuration||PA.slotDuration,H=me.split(":"),Ae=Ne.split(":");if(H.length<2||Ae.length<2){console.error("Invalid time format");return}const J=parseInt(H[0],10),Y=parseInt(H[1],10),se=parseInt(Ae[0],10),oe=parseInt(Ae[1],10);I.forEach(Te=>{be[Te.date]=[];let he=J*60+Y;const Ce=se*60+oe;for(;he<Ce;){const ee=Math.floor(he/60),Be=he%60,He=`${ee.toString().padStart(2,"0")}:${Be.toString().padStart(2,"0")}`,Ue=new Date(`2000-01-01T${He}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});be[Te.date].push({time:He,display:Ue}),he+=le}}),d(be)},O=(X,be)=>{const me={...a,[X]:be};o(me),R(me)},F=(X,be)=>{m(me=>{const Ne=me[X]||[];return Ne.includes(be)?{...me,[X]:Ne.filter(le=>le!==be)}:{...me,[X]:[...Ne,be]}})},M=X=>{const be=c[X]||[];(h[X]||[]).length===be.length?m(Ne=>({...Ne,[X]:[]})):m(Ne=>({...Ne,[X]:be.map(le=>le.time)}))},Q=(X,be)=>(h[X]||[]).includes(be),Z=X=>{const be=c[X]||[],me=h[X]||[];return be.length>0&&me.length===be.length},$=async()=>{var X,be;x(!0);try{const me=await Wo.updateMyAvailability({settings:a,blockedSlots:h});console.log("Save response:",me.data),Ct.success("Availability saved successfully!")}catch(me){console.error("Failed to save:",me),Ct.error(((be=(X=me.response)==null?void 0:X.data)==null?void 0:be.message)||"Failed to save availability")}finally{x(!1)}};return v?n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500",children:"Loading availability..."})]})}):n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Manage Your Slots"}),n.jsx("p",{className:"text-slate-500 mt-1",children:"Set your operating hours and block unavailable times"})]}),n.jsxs("button",{onClick:$,disabled:g,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50",children:[g?n.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):n.jsx(oQ,{className:"w-5 h-5"}),"Save Changes"]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[n.jsx(cl,{className:"w-5 h-5 text-cyan-500"}),"Operating Hours"]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Start Time"}),n.jsx("select",{value:a.startTime,onChange:X=>O("startTime",X.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(X,be)=>{const me=`${be.toString().padStart(2,"0")}:00`,Ne=new Date(`2000-01-01T${me}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return n.jsx("option",{value:me,children:Ne},me)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"End Time"}),n.jsx("select",{value:a.endTime,onChange:X=>O("endTime",X.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(X,be)=>{const me=`${be.toString().padStart(2,"0")}:00`,Ne=new Date(`2000-01-01T${me}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return n.jsx("option",{value:me,children:Ne},me)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Slot Duration"}),n.jsxs("select",{value:a.slotDuration,onChange:X=>O("slotDuration",parseInt(X.target.value)),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:[n.jsx("option",{value:15,children:"15 minutes"}),n.jsx("option",{value:30,children:"30 minutes"}),n.jsx("option",{value:45,children:"45 minutes"}),n.jsx("option",{value:60,children:"60 minutes"})]})]})]}),n.jsxs("p",{className:"text-sm text-slate-400 mt-3",children:["Current: ",a.startTime," to ",a.endTime,", ",a.slotDuration," min slots"]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-100 border-2 border-emerald-300"}),n.jsx("span",{className:"text-slate-600",children:"Available"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 rounded-full bg-red-100 border-2 border-red-300"}),n.jsx("span",{className:"text-slate-600",children:"Blocked"})]}),n.jsx("p",{className:"text-slate-400 ml-auto",children:"Click on slots to block/unblock"})]}),n.jsx("div",{className:"space-y-4",children:I.map(X=>{const be=c[X.date]||[],me=Z(X.date);return n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Ti,{className:"w-5 h-5 text-cyan-500"}),n.jsxs("div",{children:[n.jsxs("h3",{className:"font-semibold text-slate-800",children:[X.dayName,X.isToday&&n.jsx("span",{className:"ml-2 text-xs bg-cyan-100 text-cyan-600 px-2 py-0.5 rounded-full",children:"Today"})]}),n.jsx("p",{className:"text-sm text-slate-500",children:X.displayDate})]})]}),n.jsx("button",{onClick:()=>M(X.date),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${me?"bg-emerald-100 text-emerald-600 hover:bg-emerald-200":"bg-red-100 text-red-600 hover:bg-red-200"}`,children:me?n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(eh,{className:"w-4 h-4"})," Unblock All"]}):n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Yi,{className:"w-4 h-4"})," Block Day"]})})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[be.map(Ne=>{const le=Q(X.date,Ne.time);return n.jsx("button",{onClick:()=>F(X.date,Ne.time),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${le?"bg-red-100 text-red-600 border border-red-200 hover:bg-red-200":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200"}`,children:Ne.display},Ne.time)}),be.length===0&&n.jsx("p",{className:"text-slate-400 text-sm py-2",children:"No slots - check your operating hours"})]})]},X.date)})}),n.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4",children:[n.jsx("h3",{className:"font-medium text-cyan-800 mb-2",children:" Quick Tips"}),n.jsxs("ul",{className:"text-sm text-cyan-700 space-y-1",children:[n.jsx("li",{children:" Set your operating hours above to auto-generate time slots"}),n.jsx("li",{children:" Click individual slots to block specific times"}),n.jsx("li",{children:' Use "Block Day" to mark entire days as unavailable'}),n.jsx("li",{children:" Don't forget to save your changes!"})]})]})]})}function hR(a,o){const c=(a||"").toLowerCase(),d=[{q:["idli"],e:String.fromCodePoint(129747)},{q:["dosa"],e:String.fromCodePoint(129374)},{q:["upma","poha"],e:String.fromCodePoint(129379)},{q:["paratha","chapati","roti","jowar","bajra","ragi","chilla","cheela"],e:String.fromCodePoint(129747)},{q:["oat","porridge"],e:String.fromCodePoint(129379)},{q:["egg","omelette","scrambled","boiled"],e:String.fromCodePoint(129370)},{q:["sandwich","toast","bread"],e:String.fromCodePoint(129386)},{q:["smoothie","shake"],e:String.fromCodePoint(129380)},{q:["pancake","waffle"],e:String.fromCodePoint(129374)},{q:["moong","besan"],e:String.fromCodePoint(129752)},{q:["dal","daal","lentil","rasam"],e:String.fromCodePoint(127858)},{q:["rice","biryani","pulao","khichdi"],e:String.fromCodePoint(127834)},{q:["chicken","murgh"],e:String.fromCodePoint(127831)},{q:["fish","salmon","tuna","pomfret"],e:String.fromCodePoint(128031)},{q:["mutton","lamb"],e:String.fromCodePoint(129385)},{q:["paneer","cottage","tofu"],e:String.fromCodePoint(129472)},{q:["salad","slaw","greens"],e:String.fromCodePoint(129367)},{q:["soup","broth","shorba"],e:String.fromCodePoint(127836)},{q:["curry","sabji","sabzi","bhaji"],e:String.fromCodePoint(127835)},{q:["wrap","roll","frankie"],e:String.fromCodePoint(127791)},{q:["nut","almond","walnut","cashew","makhana"],e:String.fromCodePoint(129372)},{q:["yogurt","curd","dahi","raita","lassi","buttermilk","chaas"],e:String.fromCodePoint(129371)},{q:["fruit","apple","guava","orange","banana","papaya","mango","jamun"],e:String.fromCodePoint(127822)},{q:["chana","sprout","chickpea","rajma"],e:String.fromCodePoint(129752)},{q:["karela","bitter","gourd","methi","spinach","palak"],e:String.fromCodePoint(129388)},{q:["tea","chai","coffee"],e:String.fromCodePoint(9749)},{q:["bowl","quinoa","grain"],e:String.fromCodePoint(129379)}];for(const{q:m,e:g}of d)if(m.some(x=>c.includes(x)))return g;return{breakfast:String.fromCodePoint(127749),lunch:String.fromCodePoint(127869,65039),snacks:String.fromCodePoint(127822),dinner:String.fromCodePoint(127769)}[o]||String.fromCodePoint(127869,65039)}const P6=["breakfast","lunch","snacks","dinner"],J2={breakfast:{label:"Breakfast",time:"7:00  9:00 AM",emoji:"",bg:"linear-gradient(135deg,#FFF9C4,#FFF176)"},lunch:{label:"Lunch",time:"12:00  2:00 PM",emoji:"",bg:"linear-gradient(135deg,#E8F5E9,#C8E6C9)"},snacks:{label:"Snacks",time:"Anytime",emoji:"",bg:"linear-gradient(135deg,#FFF3E0,#FFE0B2)"},dinner:{label:"Dinner",time:"7:00  9:00 PM",emoji:"",bg:"linear-gradient(135deg,#E8EAF6,#C5CAE9)"}};function pR(a){return typeof a=="string"?a:String((a==null?void 0:a.name)||(a==null?void 0:a.meal)||"Meal")}function SH(a){var c;if(typeof a=="string")return null;const o=((c=a==null?void 0:a.nutrients)==null?void 0:c.calories)||(a==null?void 0:a.calories);return o?String(o):null}function CH(a){var c;if(typeof a=="string")return null;const o=((c=a==null?void 0:a.nutrients)==null?void 0:c.protein)||(a==null?void 0:a.protein);return o?String(o):null}function jle(a){return typeof a=="string"?"":String((a==null?void 0:a.description)||(a==null?void 0:a.tip)||"")}function Ple({meal:a,mealType:o,onClose:c,onLogged:d}){var k,R;const h=pR(a),m=SH(a)||"200",g=CH(a)||"10",[x,v]=te.useState({name:h,calories:m,protein:g,carbs:typeof a=="object"&&(((k=a==null?void 0:a.nutrients)==null?void 0:k.carbs)||(a==null?void 0:a.carbs))||"25",fats:typeof a=="object"&&(((R=a==null?void 0:a.nutrients)==null?void 0:R.fats)||(a==null?void 0:a.fats))||"8",mealType:o==="snacks"?"snack":o,quantity:1,unit:"serving"}),[E,S]=te.useState(!1),I=async()=>{S(!0);try{await zQ.logMeal({mealType:x.mealType,foodItems:[{name:x.name,quantity:`${x.quantity} ${x.unit}`,nutrition:{calories:Number(x.calories),protein:Number(x.protein),carbs:Number(x.carbs),fats:Number(x.fats)}}],source:"meal_plan"}),Ct.success(`${x.name} logged to ${x.mealType}! `),d(),c()}catch{Ct.error("Failed to log food. Please try again.")}finally{S(!1)}};return n.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:200,display:"flex",alignItems:"flex-end",justifyContent:"center"},onClick:c,children:n.jsxs("div",{style:{background:"white",borderRadius:"28px 28px 0 0",padding:24,width:"100%",maxWidth:480,animation:"slideUp 0.3s ease"},onClick:O=>O.stopPropagation(),children:[n.jsx("style",{children:"@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}"}),n.jsx("div",{style:{width:40,height:4,background:"#E5E7EB",borderRadius:2,margin:"0 auto 20px"}}),n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20},children:[n.jsxs("div",{style:{flex:1},children:[n.jsx("h3",{style:{fontSize:18,fontWeight:800,color:"#1A1A2E",margin:0},children:"Log Food"}),n.jsx("p",{style:{fontSize:12,color:"#9CA3AF",margin:"3px 0 0"},children:"Add to your nutrition log"})]}),n.jsx("button",{onClick:c,style:{background:"#F3F4F6",border:"none",borderRadius:"50%",width:36,height:36,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(Yi,{size:16,color:"#374151"})})]}),n.jsxs("div",{style:{display:"flex",gap:14,marginBottom:20,alignItems:"center"},children:[n.jsx("div",{style:{width:70,height:70,borderRadius:16,background:"#F5F5F5",display:"flex",alignItems:"center",justifyContent:"center",fontSize:40,flexShrink:0,border:"2px solid #EEEEEE",animation:"foodBounce 1s ease-in-out infinite alternate"},children:hR(h,o)}),n.jsxs("div",{style:{flex:1},children:[n.jsx("input",{value:x.name,onChange:O=>v(F=>({...F,name:O.target.value})),style:{fontSize:16,fontWeight:700,color:"#1A1A2E",border:"none",outline:"none",background:"transparent",width:"100%"}}),n.jsx("div",{style:{display:"flex",gap:8,marginTop:4},children:["breakfast","lunch","snack","dinner"].map(O=>n.jsx("button",{onClick:()=>v(F=>({...F,mealType:O})),style:{padding:"3px 10px",borderRadius:50,border:"none",cursor:"pointer",fontSize:11,fontWeight:700,background:x.mealType===O?"#c084fc":"#F3F4F6",color:x.mealType===O?"white":"#6B7280"},children:O},O))})]})]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:20},children:[{label:"Calories (kcal)",key:"calories",emoji:""},{label:"Protein (g)",key:"protein",emoji:""},{label:"Carbs (g)",key:"carbs",emoji:""},{label:"Fats (g)",key:"fats",emoji:""}].map(O=>n.jsxs("div",{style:{background:"#F9FAFB",borderRadius:14,padding:"10px 14px"},children:[n.jsxs("p",{style:{fontSize:11,color:"#9CA3AF",fontWeight:600,margin:"0 0 4px"},children:[O.emoji," ",O.label]}),n.jsx("input",{type:"number",value:x[O.key],onChange:F=>v(M=>({...M,[O.key]:F.target.value})),style:{fontSize:18,fontWeight:800,color:"#1A1A2E",border:"none",outline:"none",background:"transparent",width:"100%"}})]},O.key))}),n.jsx("button",{onClick:I,disabled:E,style:{width:"100%",background:"linear-gradient(135deg,#c084fc,#fb923c)",color:"white",border:"none",borderRadius:50,padding:"14px",fontWeight:800,fontSize:16,cursor:E?"not-allowed":"pointer",opacity:E?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8,boxShadow:"0 6px 20px rgba(192,132,252,0.4)"},children:E?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{width:18,height:18,border:"2px solid rgba(255,255,255,0.4)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Logging..."]}):n.jsxs(n.Fragment,{children:[n.jsx(dn,{size:18}),"Log This Meal"]})})]})})}function P_({label:a,value:o,unit:c,gradient:d,emoji:h}){return n.jsxs("div",{style:{background:"white",borderRadius:18,padding:"14px 8px",textAlign:"center",boxShadow:"0 2px 10px rgba(0,0,0,0.06)",position:"relative",overflow:"hidden"},children:[n.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:4,background:d,borderRadius:"18px 18px 0 0"}}),n.jsx("div",{style:{fontSize:22,marginBottom:4,marginTop:2},children:h}),n.jsx("p",{style:{fontSize:18,fontWeight:900,color:"#1A1A2E",margin:"0 0 1px",lineHeight:1},children:o||""}),n.jsx("p",{style:{fontSize:9,color:"#9CA3AF",margin:"0 0 2px",fontWeight:700,textTransform:"uppercase"},children:c}),n.jsx("p",{style:{fontSize:10,color:"#6B7280",margin:0,fontWeight:700},children:a})]})}function Ule(){var Ue,re,ve,fe,Ie,je;const{user:a}=aa(),o=to(),[c,d]=te.useState(!0),[h,m]=te.useState(!1),[g,x]=te.useState(null),[v,E]=te.useState(null),[S,I]=te.useState([]),[k,R]=te.useState(null),[O,F]=te.useState(!1),[M,Q]=te.useState(null),[Z,$]=te.useState(!1),[X,be]=te.useState("all"),[me,Ne]=te.useState({}),[le,H]=te.useState(""),[Ae,J]=te.useState(null),[Y,se]=te.useState({});te.useEffect(()=>{window.scrollTo(0,0),oe(),Te(),Ce(),ee()},[]),te.useEffect(()=>{if(M&&(g!=null&&g.generatedAt)){const Ee=new Date(g.generatedAt),We=new Date(M.updatedAt||M.createdAt);$(We>Ee)}},[M,g]),te.useEffect(()=>{k&&he(k)},[k]);const oe=async()=>{var Ee;try{const We=localStorage.getItem("token"),ze=await fetch("/api/nutrition/goals",{headers:{Authorization:`Bearer ${We}`}});if(ze.status===404){F(!1);return}if(ze.ok){const st=await ze.json();st.success&&((Ee=st.healthGoal)!=null&&Ee.goalType)?(F(!0),Q(st.healthGoal)):F(!1)}}catch{F(!1)}},Te=async()=>{try{const{data:Ee}=await ll.getReports(),ze=(Array.isArray(Ee)?Ee:Ee.reports||[]).filter(st=>{var bt;return(bt=st.aiAnalysis)==null?void 0:bt.dietPlan});I(ze),ze.length>0&&!k&&R(ze[0]._id)}catch{}finally{d(!1)}},he=async Ee=>{var We;try{d(!0);const{data:ze}=await ll.getReport(Ee),st=ze.report;if(!((We=st.aiAnalysis)!=null&&We.dietPlan)){x(null);return}const bt=st.aiAnalysis.dietPlan;let Qe={protein:150,carbs:250,fats:65},rt=2e3,Nt=!1;try{const Rt=localStorage.getItem("token"),et=await(await fetch("/api/nutrition/goals",{headers:{Authorization:`Bearer ${Rt}`}})).json();et.healthGoal&&(rt=et.healthGoal.dailyCalorieTarget||2e3,Qe=et.healthGoal.macroTargets||Qe,Nt=!0)}catch{}const we=[...Array.isArray(bt.breakfast)?[]:[],...Array.isArray(bt.snacks)?bt.snacks:[],...Array.isArray(bt.midMorningSnack)?bt.midMorningSnack:[],...Array.isArray(bt.eveningSnack)?bt.eveningSnack:[]];x({mealPlan:{breakfast:Array.isArray(bt.breakfast)?bt.breakfast:[],lunch:Array.isArray(bt.lunch)?bt.lunch:[],snacks:we,dinner:Array.isArray(bt.dinner)?bt.dinner:[]},dailyCalorieTarget:rt,macroTargets:Qe,hasGoals:Nt,keyFoods:[],lifestyleRecommendations:Array.isArray(bt.tips)?bt.tips:[],createdAt:st.createdAt,source:"report",reportId:Ee})}catch{x(null),Ct.error("Failed to load diet plan from report")}finally{d(!1)}},Ce=async()=>{try{const Ee=localStorage.getItem("token"),We=await fetch("/api/diet-recommendations/diet-plan/active",{headers:{Authorization:`Bearer ${Ee}`}});if(We.status===404)return;const ze=await We.json();if(ze.success&&ze.dietPlan){const st=ze.dietPlan;st.mealPlan&&!st.mealPlan.snacks&&(st.mealPlan.snacks=[...Array.isArray(st.mealPlan.midMorningSnack)?st.mealPlan.midMorningSnack:[],...Array.isArray(st.mealPlan.eveningSnack)?st.mealPlan.eveningSnack:[]]),x(st)}}catch{}},ee=async()=>{try{const Ee=localStorage.getItem("token"),We=await fetch("/api/diet-recommendations/supplements/active",{headers:{Authorization:`Bearer ${Ee}`}});if(We.status===404)return;const ze=await We.json();ze.success&&ze.recommendations&&E(ze.recommendations)}catch{}},Be=async()=>{m(!0);try{const Ee=localStorage.getItem("token"),We=await fetch("/api/diet-recommendations/diet-plan/generate",{method:"POST",headers:{Authorization:`Bearer ${Ee}`,"Content-Type":"application/json"}});if(We.status===404){Ct.error("Diet plan service unavailable.");return}const ze=await We.json();ze.success?(x(ze.dietPlan),$(!1),Ct.success("AI diet plan generated! ")):Ct.error(ze.message||"Failed to generate plan")}catch{Ct.error("Failed to generate plan.")}finally{m(!1)}},He=M!=null&&M.goalType?M.goalType.replace(/_/g," ").replace(/\b\w/g,Ee=>Ee.toUpperCase()):"Healthy Living";return c?n.jsxs("div",{style:{minHeight:"100vh",background:"#FAF8F5",display:"flex",alignItems:"center",justifyContent:"center"},children:[n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{width:52,height:52,border:"4px solid #ede9fe",borderTopColor:"#c084fc",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 14px"}}),n.jsx("p",{style:{color:"#8B6F4E",fontWeight:600,fontSize:14},children:"Loading your meal plan..."})]}),n.jsx("style",{children:"@keyframes spin{to{transform:rotate(360deg)}} @keyframes foodBounce{0%{transform:scale(1) rotate(-3deg)}100%{transform:scale(1.1) rotate(3deg)}}"})]}):n.jsxs("div",{style:{minHeight:"100vh",background:"#FAF8F5",paddingBottom:100,fontFamily:"'Inter',sans-serif"},children:[n.jsx("style",{children:`
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
        @keyframes foodBounce{0%{transform:scale(1) rotate(-3deg)}100%{transform:scale(1.1) rotate(3deg)}}
        .meal-card{animation:fadeUp 0.35s ease both}
        .log-btn:hover{transform:scale(1.05)}
        ::-webkit-scrollbar{display:none}
      `}),n.jsxs("div",{style:{maxWidth:480,margin:"0 auto"},children:[n.jsxs("div",{style:{padding:"20px 20px 0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx("button",{onClick:()=>o(-1),style:{width:40,height:40,borderRadius:"50%",background:"white",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:n.jsx(ln,{size:18,color:"#1A1A2E"})}),n.jsx("h1",{style:{fontSize:26,fontWeight:800,color:"#1A1A2E",margin:0},children:"Meal Plan "}),n.jsx("button",{style:{width:40,height:40,borderRadius:"50%",background:"white",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:n.jsx(WA,{size:18,color:"#1A1A2E"})})]}),n.jsx("div",{style:{padding:"14px 20px 0"},children:n.jsxs("div",{style:{background:"white",borderRadius:16,display:"flex",alignItems:"center",gap:10,padding:"11px 16px",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[n.jsx(zb,{size:17,color:"#9CA3AF"}),n.jsx("input",{value:le,onChange:Ee=>H(Ee.target.value),placeholder:"Search meals",style:{border:"none",outline:"none",flex:1,fontSize:14,color:"#374151",background:"transparent"}}),n.jsx("button",{style:{background:"linear-gradient(135deg,#c084fc,#fb923c)",padding:"6px 10px",borderRadius:10,border:"none",cursor:"pointer",display:"flex",alignItems:"center"},children:n.jsx(sne,{size:14,color:"white"})})]})}),(!O||!g)&&n.jsx("div",{style:{padding:"16px 20px 0"},children:n.jsxs("div",{style:{background:"linear-gradient(135deg,#FFF9C4,#FFE082)",borderRadius:24,padding:20,display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden",boxShadow:"0 4px 16px rgba(255,193,7,0.25)"},children:[n.jsxs("div",{style:{flex:1},children:[n.jsx("h3",{style:{fontSize:17,fontWeight:800,color:"#1A1A2E",margin:"0 0 5px"},children:"Personalise Meal Plan"}),n.jsx("p",{style:{fontSize:12,color:"#6B5E3E",margin:"0 0 14px",lineHeight:1.5},children:O?"Generate your AI-powered personalized meal plan":"To personalize your menu, we still need information."}),O?n.jsx("button",{onClick:Be,disabled:h,style:{background:"#E8854A",color:"white",border:"none",borderRadius:50,padding:"11px 22px",fontWeight:700,fontSize:13,cursor:h?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:7,opacity:h?.7:1,boxShadow:"0 4px 12px rgba(232,133,74,0.35)"},children:h?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{width:15,height:15,border:"2px solid rgba(255,255,255,0.4)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Generating"]}):n.jsxs(n.Fragment,{children:[n.jsx(HA,{size:15}),"Generate Plan"]})}):n.jsxs(Os,{to:"/profile?tab=goals",style:{background:"#E8854A",color:"white",borderRadius:50,padding:"11px 22px",fontWeight:700,fontSize:13,textDecoration:"none",display:"inline-flex",alignItems:"center",gap:7,boxShadow:"0 4px 12px rgba(232,133,74,0.35)"},children:[n.jsx(Zl,{size:15}),"Fill in Data"]})]}),n.jsx("div",{style:{fontSize:68,lineHeight:1,marginLeft:12,flexShrink:0,filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.1))"},children:""})]})}),g&&n.jsxs("div",{style:{padding:"20px 20px 0"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{fontSize:19,fontWeight:800,color:"#1A1A2E",margin:0},children:"Daily Targets"}),n.jsxs("p",{style:{fontSize:11,color:"#9CA3AF",margin:"3px 0 0",fontWeight:500},children:["Goal: ",n.jsx("span",{style:{color:"#c084fc",fontWeight:700},children:He})]})]}),n.jsx(Os,{to:"/profile?tab=goals",style:{fontSize:12,fontWeight:700,color:"#c084fc",textDecoration:"none"},children:"Edit Goals"})]}),Z&&n.jsxs("div",{style:{background:"#FFF7ED",borderRadius:14,padding:"12px 14px",marginBottom:12,display:"flex",gap:10,alignItems:"center",border:"1px solid #FED7AA"},children:[n.jsx(Ln,{size:18,color:"#F97316"}),n.jsxs("div",{style:{flex:1},children:[n.jsx("p",{style:{fontSize:12,fontWeight:700,color:"#9A3412",margin:"0 0 3px"},children:"Goals updated! Plan may be outdated."}),n.jsx("button",{onClick:Be,disabled:h,style:{fontSize:11,color:"#E8854A",fontWeight:700,background:"none",border:"none",cursor:"pointer",padding:0},children:"Regenerate "})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8},children:[n.jsx(P_,{label:"Calories",value:g.dailyCalorieTarget,unit:"kcal",gradient:"linear-gradient(135deg,#FF6B6B,#FF8E53)",emoji:""}),n.jsx(P_,{label:"Protein",value:(Ue=g.macroTargets)==null?void 0:Ue.protein,unit:"g",gradient:"linear-gradient(135deg,#c084fc,#818CF8)",emoji:""}),n.jsx(P_,{label:"Carbs",value:(re=g.macroTargets)==null?void 0:re.carbs,unit:"g",gradient:"linear-gradient(135deg,#56ab2f,#a8e063)",emoji:""}),n.jsx(P_,{label:"Fats",value:(ve=g.macroTargets)==null?void 0:ve.fats,unit:"g",gradient:"linear-gradient(135deg,#f7971e,#ffd200)",emoji:""})]}),g.source==="report"&&!g.hasGoals&&n.jsxs("div",{style:{marginTop:10,background:"#FFF7ED",borderRadius:12,padding:"9px 13px",display:"flex",gap:7,alignItems:"center"},children:[n.jsx(Ln,{size:14,color:"#F97316"}),n.jsxs("p",{style:{fontSize:11,color:"#92400E",margin:0},children:["Using default targets. ",n.jsx(Os,{to:"/profile?tab=goals",style:{color:"#E8854A",fontWeight:700},children:"Set your goals "})]})]})]}),S.length>0&&n.jsx("div",{style:{padding:"16px 20px 0"},children:n.jsxs("div",{style:{background:"white",borderRadius:18,padding:14,boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:9},children:[n.jsx(Bn,{size:15,color:"#c084fc"}),n.jsx("span",{style:{fontWeight:700,fontSize:13,color:"#1A1A2E"},children:"Report-based Plan"}),n.jsx(Os,{to:"/upload",style:{marginLeft:"auto",background:"linear-gradient(135deg,#c084fc,#fb923c)",color:"white",borderRadius:50,padding:"3px 11px",fontSize:10,fontWeight:700,textDecoration:"none"},children:"+ Upload"})]}),n.jsx("select",{value:k||"",onChange:Ee=>R(Ee.target.value),style:{width:"100%",padding:"9px 13px",background:"#F9FAFB",border:"1.5px solid #E5E7EB",borderRadius:11,fontSize:12,color:"#374151",fontWeight:600,outline:"none",cursor:"pointer"},children:S.map(Ee=>n.jsxs("option",{value:Ee._id,children:[Ee.reportType,"  ",new Date(Ee.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]},Ee._id))})]})}),g?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{padding:"20px 20px 0"},children:n.jsx("div",{style:{overflowX:"auto",display:"flex",gap:8,paddingBottom:2},children:[{id:"all",label:"All",emoji:""},...P6.map(Ee=>({id:Ee,label:J2[Ee].label,emoji:J2[Ee].emoji}))].map(Ee=>n.jsxs("button",{onClick:()=>be(Ee.id),style:{whiteSpace:"nowrap",padding:"8px 16px",borderRadius:50,border:"none",cursor:"pointer",fontSize:13,fontWeight:700,background:X===Ee.id?"linear-gradient(135deg,#c084fc,#fb923c)":"white",color:X===Ee.id?"white":"#6B7280",boxShadow:X===Ee.id?"0 4px 12px rgba(192,132,252,0.35)":"0 2px 6px rgba(0,0,0,0.06)"},children:[Ee.emoji," ",Ee.label]},Ee.id))})}),P6.map(Ee=>{var bt;if(X!=="all"&&X!==Ee)return null;const We=((bt=g.mealPlan)==null?void 0:bt[Ee])||[];if(We.length===0)return null;const ze=J2[Ee],st=le?We.filter(Qe=>pR(Qe).toLowerCase().includes(le.toLowerCase())):We;return st.length===0?null:n.jsxs("div",{style:{padding:"20px 20px 0"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[n.jsxs("div",{children:[n.jsxs("h2",{style:{fontSize:20,fontWeight:800,color:"#1A1A2E",margin:0},children:[ze.emoji," ",ze.label]}),n.jsx("p",{style:{fontSize:11,color:"#9CA3AF",margin:"2px 0 0",fontWeight:500},children:ze.time})]}),n.jsxs("span",{style:{fontSize:12,fontWeight:700,color:"#c084fc"},children:[st.length," items"]})]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:st.map((Qe,rt)=>{const Nt=pR(Qe),we=SH(Qe),Rt=CH(Qe),Fe=jle(Qe),et=`${Ee}-${rt}`,$e=me[et],Kt=Y[et],qt={breakfast:"15 min",lunch:"25 min",snacks:"10 min",dinner:"35 min"}[Ee];return n.jsxs("div",{className:"meal-card",style:{background:ze.bg,borderRadius:22,padding:16,display:"flex",alignItems:"center",justifyContent:"space-between",position:"relative",overflow:"hidden",animationDelay:`${rt*.07}s`,boxShadow:"0 3px 14px rgba(0,0,0,0.06)"},children:[n.jsx("button",{onClick:()=>Ne(Xe=>({...Xe,[et]:!Xe[et]})),style:{position:"absolute",top:12,left:12,background:"rgba(255,255,255,0.75)",border:"none",borderRadius:"50%",width:30,height:30,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",backdropFilter:"blur(4px)",zIndex:2},children:n.jsx(Vi,{size:13,color:$e?"#EF4444":"#374151",fill:$e?"#EF4444":"none"})}),n.jsxs("div",{style:{flex:1,paddingTop:22,paddingRight:12},children:[n.jsx("h3",{style:{fontSize:15,fontWeight:800,color:"#1A1A2E",margin:"0 0 4px",lineHeight:1.3},children:Nt}),Fe&&n.jsx("p",{style:{fontSize:11,color:"#6B7280",margin:"0 0 6px",lineHeight:1.4,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:Fe}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,fontSize:12,color:"#6B7280",fontWeight:600},children:[n.jsx(cl,{size:12,color:"#6B7280"}),qt]}),we&&n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,fontSize:12,color:"#E8854A",fontWeight:700},children:[n.jsx(Jl,{size:12,color:"#E8854A"}),we," kcal"]}),Rt&&n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,fontSize:12,color:"#c084fc",fontWeight:700},children:[n.jsx(nl,{size:12,color:"#c084fc"}),Rt,"g"]})]}),n.jsx("button",{className:"log-btn",onClick:()=>J({meal:Qe,mealType:Ee}),style:{marginTop:10,display:"inline-flex",alignItems:"center",gap:5,background:Kt?"#D1FAE5":"white",color:Kt?"#059669":"#c084fc",border:`1.5px solid ${Kt?"#6EE7B7":"#c084fc"}`,borderRadius:50,padding:"5px 14px",fontSize:11,fontWeight:700,cursor:"pointer",transition:"all 0.2s ease"},children:Kt?n.jsxs(n.Fragment,{children:[n.jsx(dn,{size:12}),"Logged!"]}):n.jsxs(n.Fragment,{children:[n.jsx(rne,{size:12}),"Log Food"]})})]}),n.jsx("div",{style:{width:90,height:90,borderRadius:18,flexShrink:0,background:"rgba(255,255,255,0.6)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:52,boxShadow:"0 5px 18px rgba(0,0,0,0.1)",animation:`foodBounce ${.8+rt%3*.3}s ease-in-out infinite alternate`,border:"2px solid rgba(255,255,255,0.7)",userSelect:"none"},children:hR(Nt,Ee)})]},et)})})]},Ee)}),((fe=g.keyFoods)==null?void 0:fe.length)>0&&n.jsxs("div",{style:{padding:"20px 20px 0"},children:[n.jsx("h2",{style:{fontSize:19,fontWeight:800,color:"#1A1A2E",margin:"0 0 12px"},children:"Key Foods to Include"}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:g.keyFoods.map((Ee,We)=>n.jsxs("div",{style:{background:"white",borderRadius:16,padding:"13px 15px",display:"flex",gap:12,alignItems:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[n.jsx("div",{style:{width:38,height:38,borderRadius:11,background:"rgba(245,245,245,1)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:22,border:"1px solid #EEEEEE"},children:hR(Ee.name,"lunch")}),n.jsxs("div",{children:[n.jsx("p",{style:{fontWeight:700,color:"#1A1A2E",margin:"0 0 2px",fontSize:13},children:Ee.name}),n.jsx("p",{style:{fontSize:11,color:"#6B7280",margin:0},children:Ee.reason}),Ee.frequency&&n.jsx("span",{style:{fontSize:10,color:"#c084fc",fontWeight:700},children:Ee.frequency})]})]},We))})]}),((Ie=g.lifestyleRecommendations)==null?void 0:Ie.length)>0&&n.jsx("div",{style:{padding:"20px 20px 0"},children:n.jsxs("div",{style:{background:"linear-gradient(135deg,#c084fc,#fb923c)",borderRadius:22,padding:18},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12},children:[n.jsx(nne,{size:19,color:"white"}),n.jsx("h2",{style:{fontSize:17,fontWeight:800,color:"white",margin:0},children:"Lifestyle Tips"})]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:9},children:g.lifestyleRecommendations.map((Ee,We)=>n.jsxs("div",{style:{display:"flex",gap:9,alignItems:"flex-start"},children:[n.jsx(dn,{size:15,color:"rgba(255,255,255,0.85)",style:{flexShrink:0,marginTop:2}}),n.jsx("p",{style:{fontSize:12,color:"rgba(255,255,255,0.92)",margin:0,lineHeight:1.5},children:Ee})]},We))})]})}),((je=v==null?void 0:v.supplements)==null?void 0:je.length)>0&&n.jsxs("div",{style:{padding:"20px 20px 0"},children:[n.jsx("h2",{style:{fontSize:19,fontWeight:800,color:"#1A1A2E",margin:"0 0 12px"},children:"Supplements"}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:v.supplements.map((Ee,We)=>n.jsxs("div",{style:{background:"white",borderRadius:16,padding:14,boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:7},children:[n.jsx("p",{style:{fontWeight:800,color:"#1A1A2E",margin:0,fontSize:14},children:Ee.name}),Ee.priority&&n.jsx("span",{style:{fontSize:9,fontWeight:800,padding:"3px 9px",borderRadius:50,background:Ee.priority==="high"?"#FEE2E2":Ee.priority==="medium"?"#FEF3C7":"#D1FAE5",color:Ee.priority==="high"?"#DC2626":Ee.priority==="medium"?"#D97706":"#059669"},children:Ee.priority.toUpperCase()})]}),n.jsx("p",{style:{fontSize:11,color:"#6B7280",margin:"0 0 9px"},children:Ee.reason}),n.jsxs("div",{style:{display:"flex",gap:8},children:[Ee.dosage&&n.jsx("span",{style:{fontSize:11,background:"#F3F4F6",padding:"3px 9px",borderRadius:8,fontWeight:600,color:"#374151"},children:Ee.dosage}),Ee.timing&&n.jsx("span",{style:{fontSize:11,background:"#F3F4F6",padding:"3px 9px",borderRadius:8,fontWeight:600,color:"#374151"},children:Ee.timing})]})]},We))})]})]}):!c&&n.jsx("div",{style:{padding:"24px 20px 0"},children:n.jsxs("div",{style:{background:"white",borderRadius:26,padding:"38px 22px",textAlign:"center",boxShadow:"0 4px 18px rgba(0,0,0,0.06)"},children:[n.jsx("div",{style:{fontSize:68,marginBottom:14},children:""}),n.jsx("h3",{style:{fontSize:21,fontWeight:800,color:"#1A1A2E",margin:"0 0 9px"},children:O?"Ready to Generate!":"Set Your Goals First"}),n.jsx("p",{style:{fontSize:13,color:"#6B7280",margin:"0 0 22px",lineHeight:1.6},children:O?"Tap below to create your AI-powered personalized meal plan.":"Set your nutrition and fitness goals to receive a personalized meal plan."}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[O?n.jsx("button",{onClick:Be,disabled:h,style:{background:"linear-gradient(135deg,#c084fc,#fb923c)",color:"white",border:"none",borderRadius:50,padding:"13px 26px",fontWeight:800,fontSize:14,cursor:h?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,boxShadow:"0 6px 18px rgba(192,132,252,0.4)"},children:h?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{width:17,height:17,border:"2px solid rgba(255,255,255,0.4)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Generating"]}):n.jsxs(n.Fragment,{children:[n.jsx(HA,{size:17}),"Generate AI Meal Plan"]})}):n.jsxs(Os,{to:"/profile?tab=goals",style:{background:"linear-gradient(135deg,#c084fc,#fb923c)",color:"white",borderRadius:50,padding:"13px 26px",fontWeight:800,fontSize:14,textDecoration:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[n.jsx(Zl,{size:17}),"Set My Goals"]}),n.jsxs(Os,{to:"/upload",style:{background:"#F9FAFB",color:"#374151",borderRadius:50,padding:"13px 26px",fontWeight:700,fontSize:14,textDecoration:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:8,border:"1.5px solid #E5E7EB"},children:[n.jsx(Bn,{size:17}),"Upload Health Report"]})]})]})}),n.jsx("div",{style:{margin:"22px 20px 0",background:"#F9FAFB",borderRadius:14,padding:"13px 15px",border:"1px solid #E5E7EB"},children:n.jsxs("p",{style:{fontSize:11,color:"#6B7280",margin:0,lineHeight:1.6},children:[n.jsx("strong",{style:{color:"#374151"},children:" Disclaimer:"})," This meal plan is AI-generated for informational purposes only. Consult a registered dietitian before making significant dietary changes."]})})]}),Ae&&n.jsx(Ple,{meal:Ae.meal,mealType:Ae.mealType,onClose:()=>J(null),onLogged:()=>{const Ee=`${Ae.mealType}-logged`;se(We=>({...We,[Ee]:!0}))}})]})}function Fle(){var Y,se,oe;const{user:a}=aa(),o=Zy(),[c,d]=te.useState([]),[h,m]=te.useState(""),[g,x]=te.useState(!1),[v,E]=te.useState(!1),[S,I]=te.useState(""),[k,R]=te.useState(null),[O,F]=te.useState([]),[M,Q]=te.useState(!1),Z=te.useRef(null),$=te.useRef(null);te.useEffect(()=>{(async()=>{try{const he=localStorage.getItem("token"),Ce=await fetch("/api/health/reports",{headers:{Authorization:`Bearer ${he}`}});if(Ce.ok){const ee=await Ce.json();F(ee.reports||[])}}catch(he){console.error("Failed to load reports:",he)}})()},[]),te.useEffect(()=>{var he,Ce;a&&(async()=>{try{const ee=localStorage.getItem("token"),Be=await fetch("/api/chat/history",{headers:{Authorization:`Bearer ${ee}`}});if(Be.ok){const Ue=await Be.json();if(Ue.success&&Ue.messages&&Ue.messages.length>0){d(Ue.messages),localStorage.setItem(`chat_history_${a==null?void 0:a.id}`,JSON.stringify(Ue.messages));return}}const He=localStorage.getItem(`chat_history_${a==null?void 0:a.id}`);if(He){const Ue=JSON.parse(He);d(Ue)}else{const Ue=X();d([{role:"assistant",content:Ue,timestamp:new Date}])}}catch(ee){console.error("Failed to load chat history:",ee);const Be=localStorage.getItem(`chat_history_${a==null?void 0:a.id}`);if(Be)d(JSON.parse(Be));else{const He=X();d([{role:"assistant",content:He,timestamp:new Date}])}}})(),(he=o.state)!=null&&he.initialQuery?(m(o.state.initialQuery),setTimeout(()=>{const ee=document.querySelector("form");ee&&ee.requestSubmit()},500)):(Ce=o.state)!=null&&Ce.selectedText&&m(`Can you explain this: "${o.state.selectedText}"`)},[a==null?void 0:a.id,o.state,a==null?void 0:a.name]),te.useEffect(()=>{var Te;(Te=Z.current)==null||Te.scrollIntoView({behavior:"smooth"})},[c,S]);const X=()=>{let Te=`Hello ${(a==null?void 0:a.name)||"there"}!  I'm your AI health assistant.

`;return O&&O.length>0?(Te+=`I've reviewed your uploaded health reports:

`,O.slice(0,3).forEach(he=>{const Ce=new Date(he.uploadDate).toLocaleDateString();if(Te+=` **${he.reportType}** (${Ce})
`,he.analysis&&(Te+=`   ${he.analysis.substring(0,100)}...
`),he.metrics&&Object.keys(he.metrics).length>0){const ee=Object.keys(he.metrics).slice(0,2);Te+=`   Key metrics: ${ee.join(", ")}
`}Te+=`
`}),Te+=`I have a complete understanding of your health profile. Feel free to ask me about your reports, health concerns, or get personalized recommendations!

What would you like to know?`):Te+="I can help you understand your health reports, explain medical terms, provide diet guidance, and answer health-related questions. What would you like to know?",Te},be=(Te,he)=>{E(!0),I("");let Ce=0;const ee=setInterval(()=>{Ce<=Te.length?(I(Te.substring(0,Ce)),Ce++):(clearInterval(ee),E(!1),he())},15);return()=>clearInterval(ee)},me=async Te=>{try{const he=localStorage.getItem("token"),Ce=Te.slice(-2);await fetch("/api/chat/history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${he}`},body:JSON.stringify({messages:Ce})}),localStorage.setItem(`chat_history_${a==null?void 0:a.id}`,JSON.stringify(Te))}catch(he){console.error("Failed to save chat to backend:",he),localStorage.setItem(`chat_history_${a==null?void 0:a.id}`,JSON.stringify(Te))}},Ne=async()=>{if(confirm("Are you sure you want to clear the chat history?"))try{const Te=localStorage.getItem("token");await fetch("/api/chat/history",{method:"DELETE",headers:{Authorization:`Bearer ${Te}`}}),localStorage.removeItem(`chat_history_${a==null?void 0:a.id}`);const he=X();d([{role:"assistant",content:he,timestamp:new Date}]),Ct.success("Chat cleared")}catch(Te){console.error("Failed to clear chat:",Te),localStorage.removeItem(`chat_history_${a==null?void 0:a.id}`);const he=X();d([{role:"assistant",content:he,timestamp:new Date}]),Ct.error("Chat cleared locally")}},le=()=>{const Te=X();d([{role:"assistant",content:Te,timestamp:new Date}]),Q(!1),Ct.success("New chat started")},H=async Te=>{if(Te.preventDefault(),!h.trim()||g)return;const he={role:"user",content:h,timestamp:new Date};d(ee=>[...ee,he]);const Ce=h;m(""),x(!0);try{const ee=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:Ce,conversationHistory:c.slice(-10),userReports:O.map(He=>({type:He.reportType,date:He.uploadDate,analysis:He.analysis,metrics:He.metrics}))})});if(!ee.ok)throw new Error("Failed to get AI response");const Be=await ee.json();Be.success&&Be.response&&be(Be.response,()=>{const He={role:"assistant",content:Be.response,timestamp:new Date},Ue=[...c,he,He];d(Ue),I(""),me(Ue)})}catch(ee){console.error("AI Chat error:",ee),Ct.error("Failed to get response");const Be=Ae(Ce);be(Be,()=>{const He={role:"assistant",content:Be,timestamp:new Date},Ue=[...c,he,He];d(Ue),I(""),me(Ue)})}finally{x(!1)}},Ae=Te=>{const he=Te.toLowerCase();return he.includes("vitamin d")?`Based on your query about Vitamin D:

**What is Vitamin D?**
Vitamin D is essential for bone health, immune function, and overall wellbeing.

**Normal Range:** 30-100 ng/mL

**If Low:**
 Get 15-20 minutes of morning sunlight daily
 Eat fish, eggs, fortified milk
 Consider supplements (consult your doctor)`:he.includes("iron")||he.includes("hemoglobin")?`Regarding Iron and Hemoglobin:

**Importance:**
Iron is crucial for producing hemoglobin, which carries oxygen in your blood.

**Normal Hemoglobin:** 12-17 g/dL
**Normal Iron:** 60-170 mcg/dL

**To Increase Iron:**
 Red meat, spinach, dal
 Eat with Vitamin C foods
 Avoid tea/coffee with meals`:"Thank you for your question. I'm here to help with understanding your health reports, explaining medical terms, providing diet guidance, and answering health-related questions."},J=(Te,he)=>{navigator.clipboard.writeText(Te),R(he),setTimeout(()=>R(null),2e3),Ct.success("Copied to clipboard")};return n.jsxs("div",{className:"w-full h-full bg-white flex flex-col md:flex-row",children:[n.jsxs("div",{className:"md:hidden fixed top-0 left-0 right-0 z-30 bg-white border-b border-gray-200 px-4 py-2.5 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-xs font-bold shadow-md flex-shrink-0",children:((se=(Y=a==null?void 0:a.name)==null?void 0:Y[0])==null?void 0:se.toUpperCase())||"U"}),n.jsxs("h1",{className:"text-sm font-bold text-slate-800 truncate",children:[(()=>{const Te=new Date().getHours();return Te<12?"Good Morning":Te<18?"Good Afternoon":"Good Evening"})(),", ",((oe=a==null?void 0:a.name)==null?void 0:oe.split(" ")[0])||"there","!"]})]}),n.jsx("button",{className:"w-8 h-8 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all border border-gray-200 flex-shrink-0",children:n.jsx(WA,{className:"w-4 h-4 text-slate-700"})})]}),M&&n.jsx("div",{className:"fixed inset-0 bg-black/30 z-40 md:hidden",onClick:()=>Q(!1)}),n.jsxs("div",{className:`fixed md:static left-0 top-0 h-full w-64 bg-white border-r border-gray-200 flex flex-col transition-transform duration-300 z-50 md:z-auto ${M?"translate-x-0":"-translate-x-full md:translate-x-0"} md:translate-x-0 shrink-0`,children:[n.jsxs("div",{className:"p-3 border-b border-gray-200 flex items-center justify-between shrink-0",children:[n.jsx("h2",{className:"font-bold text-gray-900 text-xs",children:"Chat History"}),n.jsx("button",{onClick:()=>Q(!1),className:"p-1 hover:bg-gray-100 rounded md:hidden",children:n.jsx(Yi,{className:"w-4 h-4"})})]}),n.jsx("button",{onClick:le,className:"m-2 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 font-medium text-xs shrink-0",children:"+ New Chat"}),n.jsx("div",{className:"flex-1 overflow-y-auto px-2 space-y-1",children:n.jsxs("div",{className:"p-3 text-center",children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Chat history is saved automatically"}),n.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[c.length," messages in current chat"]})]})}),n.jsx("div",{className:"p-2 border-t border-gray-200 space-y-1 shrink-0",children:n.jsxs("button",{onClick:Ne,className:"w-full px-2 py-1.5 text-xs text-red-600 hover:bg-red-50 rounded-lg transition flex items-center justify-center gap-2",children:[n.jsx(pg,{className:"w-3 h-3"}),"Clear Chat"]})})]}),n.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[n.jsx("div",{className:"flex items-center px-3 py-2 border-b border-gray-200 bg-white shrink-0 mt-16 md:mt-0",children:n.jsx("button",{onClick:()=>Q(!M),className:"p-1.5 hover:bg-gray-100 rounded-lg transition md:hidden",title:"Toggle chat history",children:n.jsx(ZV,{className:"w-5 h-5 text-gray-700"})})}),n.jsxs("div",{ref:$,className:"flex-1 overflow-y-auto px-3 py-4 space-y-3 pb-24 md:pb-4",style:{userSelect:"text"},children:[c.map((Te,he)=>n.jsxs("div",{className:`flex gap-2 ${Te.role==="user"?"justify-end":"justify-start"}`,children:[Te.role==="assistant"&&n.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:n.jsx(V2,{className:"w-4 h-4 text-white"})}),n.jsxs("div",{className:`max-w-xs md:max-w-md rounded-2xl px-3 py-2 ${Te.role==="user"?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[n.jsx("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed",children:Te.content}),n.jsxs("div",{className:"flex items-center justify-between mt-1 gap-2",children:[n.jsx("span",{className:`text-xs ${Te.role==="user"?"text-blue-100":"text-gray-500"}`,children:Te.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),Te.role==="assistant"&&n.jsx("button",{onClick:()=>J(Te.content,he),className:"transition-colors p-0.5 rounded hover:bg-gray-200",title:"Copy response",children:k===he?n.jsx(eh,{className:"w-3 h-3 text-green-500"}):n.jsx(ine,{className:"w-3 h-3 text-gray-500"})})]})]}),Te.role==="user"&&n.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-gray-300",children:n.jsx(Xd,{className:"w-4 h-4 text-gray-700"})})]},he)),v&&S&&n.jsxs("div",{className:"flex gap-2 justify-start",children:[n.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:n.jsx(V2,{className:"w-4 h-4 text-white"})}),n.jsx("div",{className:"max-w-xs md:max-w-md bg-gray-100 rounded-2xl px-3 py-2",children:n.jsxs("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed text-gray-900",children:[S,n.jsx("span",{className:"inline-block w-1 h-3 ml-1 animate-pulse bg-blue-600"})]})})]}),g&&!v&&n.jsxs("div",{className:"flex gap-2 justify-start",children:[n.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:n.jsx(V2,{className:"w-4 h-4 text-white"})}),n.jsx("div",{className:"bg-gray-100 rounded-2xl px-3 py-2",children:n.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[n.jsx(dh,{className:"w-3 h-3 animate-spin text-blue-600"}),n.jsx("span",{className:"text-xs",children:"Analyzing..."})]})})]}),n.jsx("div",{ref:Z})]}),n.jsx("div",{className:"fixed md:relative bottom-0 left-0 right-0 md:bottom-auto border-t border-gray-200 bg-white p-3 shrink-0 md:w-auto",children:n.jsxs("form",{onSubmit:H,className:"flex gap-2 items-end",children:[n.jsxs("div",{className:"flex-1 relative",children:[n.jsx("input",{type:"text",value:h,onChange:Te=>m(Te.target.value),placeholder:"Ask...",className:"w-full px-3 py-2.5 bg-gray-50 rounded-2xl focus:outline-none transition-all text-sm border border-gray-200 focus:border-blue-500 focus:bg-white",disabled:g||v}),h&&n.jsx("button",{type:"button",onClick:()=>m(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-lg hover:opacity-70 transition-opacity text-gray-500",children:""})]}),n.jsx("button",{type:"submit",disabled:!h.trim()||g||v,className:"px-3 py-2.5 text-white rounded-2xl font-medium hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 flex-shrink-0 bg-blue-600 hover:bg-blue-700",title:h.trim()?"Send message":"Type a message first",children:g||v?n.jsx(dh,{className:"w-4 h-4 animate-spin"}):n.jsx(ox,{className:"w-4 h-4"})})]})})]})]})}function Mle(){var Zs,pt,Ut,zt,rs,Ht;const{user:a}=aa(),{invalidateCache:o}=dH(),c=to(),[d,h]=te.useState(!1),[m,g]=te.useState(!0),[x,v]=te.useState([]),[E,S]=te.useState(null),[I,k]=te.useState(null),[R,O]=te.useState(!1),[F,M]=te.useState(""),[Q,Z]=te.useState(0),[$,X]=te.useState(null),[be,me]=te.useState(""),[Ne,le]=te.useState(""),[H,Ae]=te.useState(!1),[J,Y]=te.useState(null),[se,oe]=te.useState(""),[Te,he]=te.useState(""),[Ce,ee]=te.useState(""),[Be,He]=te.useState(""),[Ue,re]=te.useState(null),[ve,fe]=te.useState([]),[Ie,je]=te.useState(""),Ee=vt=>{const jt=vt.toLowerCase();return jt.includes("roti")||jt.includes("naan")||jt.includes("paratha")?["1 pc","2 pcs","3 pcs","4 pcs"]:jt.includes("rice")||jt.includes("biryani")||jt.includes("khichdi")?["1 bowl","1 plate","1 cup","2 cups"]:jt.includes("samosa")||jt.includes("pakora")||jt.includes("momos")?["1 pc","2 pcs","3 pcs","5 pcs"]:jt.includes("idli")||jt.includes("dosa")||jt.includes("vada")?["1 pc","2 pcs","3 pcs","1 plate"]:jt.includes("pizza")||jt.includes("burger")?["1 slice","2 slices","1 whole","1 med"]:jt.includes("chicken")||jt.includes("paneer")||jt.includes("tikka")?["1 bowl","1 plate","150g","200g"]:["1 bowl","1 plate","1 piece","100g","150g"]},[We,ze]=te.useState([]);te.useEffect(()=>{st()},[]);const st=async()=>{h(!0);try{const jt={Authorization:`Bearer ${localStorage.getItem("token")}`},ps=new Date().toISOString().split("T")[0],[Qs,Is,ms]=await Promise.all([Hr.get("/api/nutrition/logs/today",{headers:jt}),Hr.get(`/api/nutrition/summary/daily?date=${ps}`,{headers:jt}),Hr.get("/api/nutrition/goals",{headers:jt}).catch(()=>({data:{healthGoal:null}}))]);v(Qs.data.foodLogs||[]),S(Is.data.summary),k(ms.data.healthGoal);const Ws=localStorage.getItem(`waterIntake_${ps}`);Z(Ws?parseInt(Ws):0),g(!1)}catch(vt){console.error("Failed to fetch data:",vt),Ct.error("Failed to load nutrition data"),g(!1)}finally{h(!1)}},bt=()=>{const vt=new Date().toISOString().split("T")[0],jt=Q+1;Z(jt),localStorage.setItem(`waterIntake_${vt}`,jt),Ct.success("Water added! ")},Qe=vt=>{if(!I){Ct.error("Please set your fitness goal first"),c("/profile?tab=goals");return}M(vt),O(!0),X(null),me(""),le(""),Ae(!1),Y(null),oe(""),he(""),ee(""),He(""),re(null)},rt=vt=>{var jt,ps,Qs,Is,ms,Ws,mi,qr,oa,Xi,Ds,An,wa,Qi;X(vt),M(vt.mealType),me(((ps=(jt=vt.foodItems)==null?void 0:jt[0])==null?void 0:ps.name)||""),le(""),Y({calories:((Qs=vt.totalNutrition)==null?void 0:Qs.calories)||0,protein:((Is=vt.totalNutrition)==null?void 0:Is.protein)||0,carbs:((ms=vt.totalNutrition)==null?void 0:ms.carbs)||0,fats:((Ws=vt.totalNutrition)==null?void 0:Ws.fats)||0}),oe(((qr=(mi=vt.totalNutrition)==null?void 0:mi.calories)==null?void 0:qr.toString())||""),he(((Xi=(oa=vt.totalNutrition)==null?void 0:oa.protein)==null?void 0:Xi.toString())||""),ee(((An=(Ds=vt.totalNutrition)==null?void 0:Ds.carbs)==null?void 0:An.toString())||""),He(((Qi=(wa=vt.totalNutrition)==null?void 0:wa.fats)==null?void 0:Qi.toString())||""),re({healthScore:vt.healthScore,healthScore10:vt.healthScore10,micronutrients:vt.micronutrients||[],enhancementTips:vt.enhancementTips||[],healthBenefitsSummary:vt.healthBenefitsSummary}),O(!0)},Nt=async()=>{var vt,jt,ps,Qs,Is;if(!be.trim()||!Ne.trim()){Ct.error("Please enter food name and quantity");return}Ae(!0);try{const ms=localStorage.getItem("token"),Ws=await Hr.post("/api/nutrition/quick-check",{foodDescription:`${Ne} ${be} ${Ie}`},{headers:{Authorization:`Bearer ${ms}`}});if(Ws.data.success&&((vt=Ws.data.data)!=null&&vt.foodItem)){const mi=Ws.data.data.foodItem.nutrition;re(Ws.data.data),Y(mi),oe(((jt=mi.calories)==null?void 0:jt.toString())||"0"),he(((ps=mi.protein)==null?void 0:ps.toString())||"0"),ee(((Qs=mi.carbs)==null?void 0:Qs.toString())||"0"),He(((Is=mi.fats)==null?void 0:Is.toString())||"0"),Ct.success("Food analyzed! ")}else Ct.error("Could not analyze food")}catch(ms){console.error("Analysis error:",ms),Ct.error("Failed to analyze food")}finally{Ae(!1)}},we=async()=>{if(!be.trim()||!J){Ct.error("Please analyze food first");return}try{const vt=localStorage.getItem("token");$?(await Hr.put(`/api/nutrition/logs/${$._id}`,{foodItems:[{name:`${Ne} ${be}`,nutrition:{calories:parseFloat(se)||0,protein:parseFloat(Te)||0,carbs:parseFloat(Ce)||0,fats:parseFloat(Be)||0}}]},{headers:{Authorization:`Bearer ${vt}`}}),Ct.success("Meal updated!")):(await Hr.post("/api/nutrition/log-meal",{mealType:F,foodItems:[{name:`${Ne} ${be}`,nutrition:{calories:parseFloat(se)||0,protein:parseFloat(Te)||0,carbs:parseFloat(Ce)||0,fats:parseFloat(Be)||0}}],healthScore:Ue==null?void 0:Ue.healthScore,healthScore10:Ue==null?void 0:Ue.healthScore10,micronutrients:Ue==null?void 0:Ue.micronutrients,enhancementTips:Ue==null?void 0:Ue.enhancementTips,healthBenefitsSummary:Ue==null?void 0:Ue.healthBenefitsSummary},{headers:{Authorization:`Bearer ${vt}`}}),Ct.success("Meal logged!")),O(!1),o(["dashboard"]),st()}catch(vt){console.error("Log meal error:",vt),Ct.error("Failed to log meal")}},Rt=async vt=>{if(confirm("Delete this meal?"))try{const jt=localStorage.getItem("token");await Hr.delete(`/api/nutrition/logs/${vt}`,{headers:{Authorization:`Bearer ${jt}`}}),Ct.success("Meal deleted"),o(["dashboard"]),st()}catch(jt){console.error("Delete error:",jt),Ct.error("Failed to delete meal")}},Fe=vt=>({breakfast:"",lunch:"",snack:"",dinner:""})[vt]||"";if(m&&d)return n.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:n.jsx(dh,{className:"w-8 h-8 animate-spin text-purple-500"})});const et=((I==null?void 0:I.dailyCalorieTarget)||2e3)-((E==null?void 0:E.totalCalories)||0),$e=(E==null?void 0:E.totalCalories)||0,Kt=(I==null?void 0:I.dailyCalorieTarget)||2e3,qt=Math.min($e/Kt*100,100),Xe=(E==null?void 0:E.totalProtein)||0,ht=((Zs=I==null?void 0:I.macroTargets)==null?void 0:Zs.protein)||150,dt=Math.min(Xe/ht*100,100),Dt=(E==null?void 0:E.totalCarbs)||0,ss=((pt=I==null?void 0:I.macroTargets)==null?void 0:pt.carbs)||250,$t=Math.min(Dt/ss*100,100),ls=(E==null?void 0:E.totalFats)||0,Zt=((Ut=I==null?void 0:I.macroTargets)==null?void 0:Ut.fats)||80,Rs=Math.min(ls/Zt*100,100),es=8;return n.jsxs("div",{className:"w-full min-h-screen pb-24",children:[n.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4 py-6 space-y-6",children:[n.jsxs("div",{className:"md:hidden flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-sm font-bold shadow-md flex-shrink-0",children:((rs=(zt=a==null?void 0:a.name)==null?void 0:zt[0])==null?void 0:rs.toUpperCase())||"U"}),n.jsxs("h1",{className:"text-sm font-bold text-slate-800 truncate",children:[(()=>{const vt=new Date().getHours();return vt<12?"Good Morning":vt<18?"Good Afternoon":"Good Evening"})(),", ",((Ht=a==null?void 0:a.name)==null?void 0:Ht.split(" ")[0])||"there","!"]})]}),n.jsx("button",{className:"w-9 h-9 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all flex-shrink-0",children:n.jsx(WA,{className:"w-4 h-4 text-slate-700"})})]}),n.jsxs("div",{className:"card card-gradient p-8 text-slate-800 shadow-2xl relative overflow-hidden ring-1 ring-white/50 border-none",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/20 rounded-full blur-3xl -mr-20 -mt-20"}),n.jsxs("div",{className:"flex items-start justify-between mb-8 relative z-10",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-600 mb-2",children:"Calories Remaining"}),n.jsxs("div",{className:"flex items-baseline gap-2",children:[n.jsx("span",{className:"text-6xl font-black tracking-tighter text-slate-900",children:Math.max(et,0).toLocaleString()}),n.jsx("span",{className:"text-slate-500 font-bold text-lg",children:"kcal"})]})]}),n.jsx("div",{className:"w-16 h-16 rounded-[1.5rem] bg-white/40 backdrop-blur-md flex items-center justify-center border border-white/50 shadow-inner group transition-transform duration-500 hover:rotate-6",children:n.jsx(Jl,{className:"w-8 h-8 text-orange-500 drop-shadow-md"})})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-slate-500 mb-4 px-1",children:[n.jsxs("span",{children:["GOAL: ",Kt]}),n.jsxs("span",{className:"text-purple-600",children:["CONSUMED: ",$e]})]}),n.jsx("div",{className:"relative h-4 bg-white/30 rounded-full overflow-hidden mb-8 border border-white/50",children:n.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 rounded-full transition-all duration-1000 ease-out shadow-[0_0_20px_rgba(139,92,246,0.3)]",style:{width:`${qt}%`}})}),n.jsx("div",{className:"grid grid-cols-3 gap-6 relative z-10",children:[{label:"Prot",value:Math.round(Xe),goal:ht,color:"from-purple-400 to-orange-600",text:"text-blue-600",bg:"bg-blue-50/50",iconSize:"w-2 h-2",percentage:dt},{label:"Carbs",value:Math.round(Dt),goal:ss,color:"from-purple-400 to-orange-600",text:"text-emerald-600",bg:"bg-emerald-50/50",iconSize:"w-2 h-2",percentage:$t},{label:"Fat",value:Math.round(ls),goal:Zt,color:"from-purple-400 to-orange-600",text:"text-amber-600",bg:"bg-amber-50/50",iconSize:"w-2 h-2",percentage:Rs}].map(vt=>n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2 px-1",children:[n.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${vt.text.replace("text-","bg-")}`}),n.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:vt.label})]}),n.jsxs("div",{className:`${vt.bg} backdrop-blur-md p-3 rounded-2xl border border-white/50 shadow-inner`,children:[n.jsxs("p",{className:"text-xl font-black text-slate-800 tracking-tight",children:[vt.value,n.jsx("span",{className:"text-[10px] ml-0.5",children:"g"})]}),n.jsx("div",{className:"w-full h-1.5 bg-white/40 rounded-full mt-2 overflow-hidden",children:n.jsx("div",{className:`h-full bg-gradient-to-r ${vt.color} rounded-full transition-all duration-700`,style:{width:`${vt.percentage}%`}})})]})]},vt.label))})]}),n.jsxs("div",{className:"card p-6 border-none shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 rounded-2xl bg-blue-50/50 backdrop-blur-md flex items-center justify-center border border-blue-100 shadow-inner",children:n.jsx(Fb,{className:"w-7 h-7 text-blue-500 drop-shadow-sm"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-black text-slate-800 tracking-tight",children:"HYDRATION"}),n.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:[Q," of ",es," glasses"]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-4xl font-black text-blue-600 tracking-tighter",children:Q}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] -mt-1",children:"Glasses"})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2.5 mb-6",children:[Array.from({length:es}).map((vt,jt)=>n.jsx("button",{onClick:bt,className:`w-10 h-11 rounded-xl flex items-center justify-center transition-all transform hover:scale-110 active:scale-95 border-2 ${jt<Q?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200":"bg-white/40 border-slate-100 text-slate-400 hover:border-blue-200"}`,children:n.jsx(Fb,{className:`w-5 h-5 ${jt<Q?"animate-bounce":""}`})},jt)),n.jsx("button",{onClick:bt,className:"w-10 h-11 rounded-xl flex items-center justify-center bg-slate-50 border-2 border-dashed border-slate-200 text-slate-400 hover:border-blue-300 hover:bg-white transition-all transition-all",children:n.jsx($l,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"w-full h-1.5 bg-slate-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-purple-400 to-orange-600 rounded-full transition-all duration-1000 ease-out",style:{width:`${Q/es*100}%`}})})]}),n.jsx("div",{className:"space-y-4",children:["breakfast","lunch","snack","dinner"].map(vt=>{const jt=x.filter(Qs=>Qs.mealType===vt),ps=jt.reduce((Qs,Is)=>{var ms;return Qs+(((ms=Is.totalNutrition)==null?void 0:ms.calories)||0)},0);return n.jsxs("div",{className:"card p-6 border-none shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/40 backdrop-blur-md flex items-center justify-center border border-white/50 shadow-inner text-3xl",children:Fe(vt)}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-black text-slate-800 tracking-tight uppercase",children:vt}),n.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:[jt.length," items  ",n.jsxs("span",{className:"text-purple-600",children:[ps," kcal"]})]})]})]}),n.jsx("button",{onClick:()=>Qe(vt),className:"w-12 h-12 rounded-[1.25rem] bg-slate-900 text-white flex items-center justify-center hover:bg-slate-800 transition-all shadow-xl hover:scale-110 active:scale-95 group",children:n.jsx($l,{className:"w-6 h-6 group-hover:rotate-90 transition-transform duration-300"})})]}),jt.length>0&&n.jsx("div",{className:"space-y-3",children:jt.map(Qs=>{var Is,ms,Ws,mi,qr,oa;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-2xl",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"font-semibold text-slate-800",children:((ms=(Is=Qs.foodItems)==null?void 0:Is[0])==null?void 0:ms.name)||"Food"}),n.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-slate-500",children:[n.jsxs("span",{children:["P: ",Math.round(((Ws=Qs.totalNutrition)==null?void 0:Ws.protein)||0),"g"]}),n.jsxs("span",{children:["C: ",Math.round(((mi=Qs.totalNutrition)==null?void 0:mi.carbs)||0),"g"]}),n.jsxs("span",{children:["F: ",Math.round(((qr=Qs.totalNutrition)==null?void 0:qr.fats)||0),"g"]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[Qs.healthScore10!==void 0&&n.jsxs("div",{className:`px-2 py-1 rounded-lg text-[10px] font-black shadow-sm flex flex-col items-center justify-center min-w-[32px] ${Qs.healthScore10*10>=80?"bg-emerald-50 text-emerald-600 border border-emerald-100":Qs.healthScore10*10>=60?"bg-amber-50 text-amber-600 border border-amber-100":"bg-rose-50 text-rose-600 border border-rose-100"}`,children:[n.jsx("span",{className:"leading-none",children:Math.round(Qs.healthScore10*10)}),n.jsx("span",{className:"text-[6px] opacity-70",children:"SCR"})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"font-black text-slate-800 leading-none",children:Math.round(((oa=Qs.totalNutrition)==null?void 0:oa.calories)||0)}),n.jsx("p",{className:"text-[8px] text-slate-400 font-bold uppercase tracking-tighter",children:"kcal"})]}),n.jsx("button",{onClick:()=>rt(Qs),className:"p-2 hover:bg-gray-200 rounded-lg transition-all ml-2",children:n.jsx(rQ,{className:"w-4 h-4 text-slate-600"})}),n.jsx("button",{onClick:()=>Rt(Qs._id),className:"p-2 hover:bg-red-100 rounded-lg transition-all",children:n.jsx(pg,{className:"w-4 h-4 text-red-500"})})]})]},Qs._id)})})]},vt)})})]}),R&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center md:justify-center",onClick:()=>O(!1),children:n.jsxs("div",{className:"bg-white w-full md:w-full md:max-w-lg rounded-t-3xl md:rounded-3xl p-6 pb-24 md:pb-6 max-h-[90vh] overflow-y-auto",onClick:vt=>vt.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-50 flex items-center justify-center",children:n.jsx(nx,{className:"w-5 h-5 text-purple-600"})}),n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-black text-slate-800 tracking-tight",children:[$?"Edit":"Add"," ",F.charAt(0).toUpperCase()+F.slice(1)]}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-0.5",children:"Track your nutrition"})]})]}),n.jsx("button",{onClick:()=>O(!1),className:"w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-all",children:n.jsx(Yi,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"space-y-4",children:J?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-6 duration-700 ease-out",children:[n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/5 to-orange-500/5 rounded-[2.5rem] blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 border border-slate-100 shadow-[0_20px_50px_rgba(0,0,0,0.04)] relative",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("h3",{className:"text-3xl font-black text-slate-800 tracking-tighter mb-1 truncate",title:be,children:be}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-emerald-50 text-emerald-600 rounded-full border border-emerald-100/50",children:[n.jsx(ane,{className:"w-3 h-3"}),n.jsx("span",{className:"text-[10px] font-black uppercase tracking-wider",children:"Verified by AI Health"})]})})]}),n.jsxs("div",{className:"bg-orange-50 rounded-2xl p-3 border border-orange-100 text-center min-w-[80px] shadow-sm",children:[n.jsx("p",{className:"text-[9px] font-black text-orange-400 uppercase tracking-widest mb-0.5",children:"SCORE"}),n.jsx("p",{className:"text-3xl font-black text-orange-600 leading-none",children:Math.round(((Ue==null?void 0:Ue.healthScore10)||(Ue==null?void 0:Ue.healthScore)/10)*10)}),n.jsx("p",{className:"text-[9px] font-black text-orange-400 uppercase tracking-tighter mt-1",children:"out of 100"})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"flex items-center justify-between px-1",children:n.jsx("h4",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em]",children:"MACRONUTRIENTS"})}),n.jsx("div",{className:"grid grid-cols-4 gap-2.5",children:[{label:"CALORIES",value:Math.round(J.calories),unit:"kcal",color:"text-orange-600",bg:"bg-slate-50"},{label:"PROTEIN",value:Math.round(J.protein),unit:"g",color:"text-blue-600",bg:"bg-slate-50"},{label:"CARBS",value:Math.round(J.carbs),unit:"g",color:"text-emerald-600",bg:"bg-slate-50"},{label:"FATS",value:Math.round(J.fats),unit:"g",color:"text-rose-600",bg:"bg-slate-50"}].map(vt=>n.jsxs("div",{className:`${vt.bg} rounded-[1.25rem] p-3 border border-slate-100/50 shadow-sm transition-all hover:scale-[1.02] hover:bg-white`,children:[n.jsx("p",{className:"text-[8px] font-black text-slate-400 uppercase tracking-tighter mb-1.5",children:vt.label}),n.jsxs("div",{className:"flex items-baseline gap-0.5",children:[n.jsx("span",{className:"text-lg font-black text-slate-800 leading-none",children:vt.value}),n.jsx("span",{className:"text-[9px] font-bold text-slate-400",children:vt.unit})]})]},vt.label))})]})]})]}),n.jsxs("div",{className:"bg-blue-50/40 rounded-[2.5rem] p-7 border border-blue-100 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-100/50 flex items-center justify-center text-blue-600",children:n.jsx(Cr,{className:"w-4 h-4"})}),n.jsx("h4",{className:"text-sm font-black text-slate-700 tracking-tight uppercase",children:"Micronutrients"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[((Ue==null?void 0:Ue.micronutrients)||[]).map((vt,jt)=>n.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-blue-100 shadow-sm",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-[11px] font-black text-slate-700 truncate",children:vt.name}),n.jsxs("span",{className:"text-[10px] font-black text-blue-600",children:[vt.percentage,"%"]})]}),n.jsx("p",{className:"text-xl font-black text-slate-800 mb-2",children:vt.value}),n.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-1000",style:{width:`${vt.percentage}%`}})})]},jt)),(!(Ue!=null&&Ue.micronutrients)||Ue.micronutrients.length===0)&&["Vitamin A","Vitamin C","Iron","Calcium"].map(vt=>n.jsxs("div",{className:"bg-white/80 rounded-2xl p-4 border border-blue-100 shadow-sm opacity-60",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-[11px] font-black text-slate-700",children:vt}),n.jsx("span",{className:"text-[10px] font-black text-blue-600",children:"--%"})]}),n.jsx("p",{className:"text-xl font-black text-slate-800 mb-2",children:"--"}),n.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full"})]},vt))]})]}),n.jsxs("div",{className:"bg-emerald-50/50 rounded-[2.5rem] p-7 border border-emerald-100 relative overflow-hidden group",children:[n.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-emerald-500 flex items-center justify-center text-white shadow-lg shadow-emerald-200 group-hover:rotate-12 transition-transform",children:n.jsx(sE,{className:"w-5 h-5"})}),n.jsx("h4",{className:"text-sm font-black text-emerald-900 tracking-tight uppercase",children:"Health Benefits"})]}),n.jsx("p",{className:"text-xs font-bold text-emerald-800/80 leading-relaxed",children:(Ue==null?void 0:Ue.healthBenefitsSummary)||(Ue==null?void 0:Ue.analysis)||"This meal provides essential nutrients for your daily requirements."})]}),n.jsxs("div",{className:"bg-amber-50/40 rounded-[2.5rem] p-7 border border-amber-100 group",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-white border border-amber-100 flex items-center justify-center text-orange-500 group-hover:scale-110 transition-transform",children:n.jsx(HA,{className:"w-5 h-5"})}),n.jsx("h4",{className:"text-sm font-black text-amber-900 tracking-tight uppercase",children:"Make it even Healthier"})]}),n.jsxs("div",{className:"space-y-3",children:[((Ue==null?void 0:Ue.enhancementTips)||[]).map((vt,jt)=>n.jsxs("div",{className:"bg-white rounded-[1.5rem] p-4 flex items-center gap-4 border border-amber-100 shadow-sm hover:shadow-md transition-all",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center text-white shrink-0",children:n.jsx($l,{className:"w-5 h-5"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"text-sm font-black text-slate-800 mb-0.5",children:vt.name||vt}),n.jsx("p",{className:"text-[10px] font-bold text-slate-500 truncate",children:vt.benefit||"Adds nutritional value"})]})]},jt)),(!(Ue!=null&&Ue.enhancementTips)||Ue.enhancementTips.length===0)&&n.jsx("div",{className:"text-center py-4 text-slate-400 text-xs font-bold uppercase tracking-widest italic",children:"Already optimal!"})]})]})]}),n.jsxs("div",{className:"flex gap-4 pt-4",children:[n.jsx("button",{onClick:()=>{Y(null),le("")},className:"flex-1 py-5 bg-slate-100 text-slate-600 rounded-[2rem] font-black text-sm uppercase tracking-widest hover:bg-slate-200 transition-all active:scale-95",children:"Back"}),n.jsxs("button",{onClick:we,className:"flex-[2] py-5 bg-slate-900 text-white rounded-[2rem] font-black text-sm uppercase tracking-widest shadow-2xl hover:bg-slate-800 transition-all active:scale-95 flex items-center justify-center gap-3 group relative overflow-hidden",children:[n.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1 bg-white/20 transform translate-y-2 group-hover:translate-y-0 transition-transform"}),n.jsxs("div",{className:"relative z-10 flex items-center gap-3",children:[n.jsx(dn,{className:"w-5 h-5 text-emerald-400 group-hover:scale-110 transition-transform"}),$?"Update Meal":"Add to Diary"]})]})]})]}):n.jsx(n.Fragment,{children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2 ml-1",children:"Food Name"}),n.jsx("input",{type:"text",value:be,onChange:vt=>{me(vt.target.value),ze(Ee(vt.target.value))},placeholder:"e.g., Chicken Salad",className:"w-full px-5 py-4 bg-slate-50/80 border-2 border-slate-100 rounded-[1.5rem] focus:border-purple-500 focus:bg-white focus:outline-none text-slate-900 font-bold transition-all placeholder:text-slate-400 shadow-inner",onKeyPress:vt=>vt.key==="Enter"&&Nt()})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3 ml-1",children:"Quantity"}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:We.map((vt,jt)=>n.jsx("button",{type:"button",onClick:()=>le(vt),className:`px-3 py-2 rounded-xl text-[11px] font-bold transition-all border-2 ${Ne===vt?"bg-purple-600 border-purple-600 text-white shadow-lg shadow-purple-200":"bg-white border-slate-100 text-slate-600 hover:border-purple-200"}`,children:vt},jt))}),n.jsx("input",{type:"text",value:Ne,onChange:vt=>le(vt.target.value),placeholder:"e.g., 1 bowl, 100g",className:"w-full px-5 py-3.5 bg-slate-50/80 border-2 border-slate-100 rounded-[1.5rem] focus:border-purple-500 focus:bg-white focus:outline-none text-slate-900 font-bold transition-all placeholder:text-slate-400 shadow-inner",onKeyPress:vt=>vt.key==="Enter"&&Nt()})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3 ml-1",children:"Preparation"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{label:"Fried",icon:""},{label:"Baked",icon:""},{label:"Grilled",icon:""},{label:"Home",icon:""},{label:"Dine-in",icon:""},{label:"Packaged",icon:""}].map(vt=>n.jsxs("button",{type:"button",onClick:()=>je(vt.label),className:`p-2.5 rounded-xl transition-all border-2 flex flex-col items-center gap-1.5 ${Ie===vt.label?"bg-purple-600 border-purple-600 text-white shadow-lg shadow-purple-200":"bg-white border-slate-100 text-slate-600 hover:border-purple-200"}`,children:[n.jsx("span",{className:"text-lg leading-none",children:vt.icon}),n.jsx("span",{className:"text-[9px] font-black uppercase tracking-tighter",children:vt.label})]},vt.label))})]}),n.jsxs("button",{onClick:Nt,disabled:H||!be.trim()||!Ne.trim(),className:"w-full bg-slate-900 text-white font-black py-5 rounded-[2rem] hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 transition-all shadow-[0_20px_40px_-12px_rgba(15,23,42,0.3)] uppercase tracking-widest text-sm relative overflow-hidden group active:scale-[0.98]",children:[n.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1 bg-white/20 transform translate-y-2 group-hover:translate-y-0 transition-transform"}),n.jsx("div",{className:"relative z-10 flex items-center gap-3",children:H?n.jsxs(n.Fragment,{children:[n.jsx(dh,{className:"w-5 h-5 animate-spin text-purple-400"}),"Analyzing..."]}):n.jsxs(n.Fragment,{children:[n.jsx(nl,{className:"w-5 h-5 text-purple-400 group-hover:animate-pulse"}),"Calculate Nutrition"]})})]})]})})})]})})]})}const Vle=()=>n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-pink-900 to-slate-900 p-4 sm:p-6 animate-pulse",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"h-8 bg-slate-700/50 rounded w-48 mb-2"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-64"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(a=>n.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-5 border border-slate-700/50",children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"h-5 bg-slate-700/50 rounded w-32 mb-2"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-24"})]}),n.jsx("div",{className:"w-10 h-10 bg-slate-700/50 rounded-lg"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-3 bg-slate-700/50 rounded w-full"}),n.jsx("div",{className:"h-3 bg-slate-700/50 rounded w-3/4"})]}),n.jsx("div",{className:"mt-4 h-9 bg-slate-700/50 rounded-lg"})]},a))})]});function Qle(){var I,k,R;const{user:a}=aa(),[o,c]=te.useState([]),[d,h]=te.useState(!0),[m,g]=te.useState("all");te.useEffect(()=>{window.scrollTo(0,0),x()},[]);const x=async()=>{try{const{data:O}=await ll.getReports();c(O)}catch{Ct.error("Failed to load reports")}finally{h(!1)}},v=async(O,F)=>{if(F.preventDefault(),F.stopPropagation(),!!window.confirm("Are you sure you want to delete this report? This action cannot be undone."))try{await ll.deleteReport(O),c(o.filter(M=>M._id!==O)),Ct.success("Report deleted successfully")}catch{Ct.error("Failed to delete report")}},E=m==="all"?o:o.filter(O=>O.reportType.toLowerCase().includes(m.toLowerCase())),S=["all",...new Set(o.map(O=>O.reportType))];return d?n.jsx(Vle,{}):n.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-fade-in p-6 pb-24",children:[n.jsxs("div",{className:"md:hidden flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-sm font-bold shadow-md flex-shrink-0",children:((k=(I=a==null?void 0:a.name)==null?void 0:I[0])==null?void 0:k.toUpperCase())||"U"}),n.jsxs("h1",{className:"text-sm font-bold text-slate-800 truncate",children:[(()=>{const O=new Date().getHours();return O<12?"Good Morning":O<18?"Good Afternoon":"Good Evening"})(),", ",((R=a==null?void 0:a.name)==null?void 0:R.split(" ")[0])||"there","!"]})]}),n.jsx("button",{className:"w-9 h-9 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all flex-shrink-0",children:n.jsx(WA,{className:"w-4 h-4 text-slate-700"})})]}),n.jsxs("div",{className:"card card-gradient p-8 text-slate-800 shadow-2xl relative overflow-hidden ring-1 ring-white/50 border-none",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/20 rounded-full blur-3xl -mr-20 -mt-20"}),n.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-6",children:[n.jsxs("div",{children:[n.jsxs(Os,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-500 hover:text-purple-600 font-black transition-all mb-4 text-[10px] uppercase tracking-widest group",children:[n.jsx("div",{className:"p-1.5 bg-white/50 rounded-lg group-hover:scale-110 transition-transform shadow-sm border border-white",children:n.jsx(ln,{className:"w-3.5 h-3.5"})}),"Back to Dashboard"]}),n.jsx("h1",{className:"text-3xl font-black text-slate-900 tracking-tight mb-2 uppercase",children:"Your Health Archive"}),n.jsxs("p",{className:"text-slate-500 text-sm font-bold opacity-80",children:["Track your progress across ",o.length," diagnostic reports"]})]}),n.jsxs(Os,{to:"/upload",className:"px-6 py-4 bg-slate-900 text-white rounded-[1.5rem] font-black hover:shadow-2xl transition-all flex items-center justify-center gap-3 text-sm uppercase tracking-widest active:scale-95 group shadow-xl",children:[n.jsx(il,{className:"w-4 h-4 group-hover:-translate-y-1 transition-transform"}),"Upload New Report"]})]})]}),o.length>0&&n.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n.jsx("div",{className:"card p-5 group hover:scale-[1.02] transition-all duration-300",children:n.jsxs("div",{className:"flex flex-col items-center sm:items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-purple-50 flex items-center justify-center shadow-inner group-hover:rotate-12 transition-transform",children:n.jsx(Bn,{className:"w-5 h-5 text-purple-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-3xl font-black text-slate-900 tracking-tighter leading-none",children:o.length}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-2",children:"Reports"})]})]})}),n.jsx("div",{className:"card p-5 group hover:scale-[1.02] transition-all duration-300",children:n.jsxs("div",{className:"flex flex-col items-center sm:items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-emerald-50 flex items-center justify-center shadow-inner group-hover:rotate-12 transition-transform",children:n.jsx(va,{className:"w-5 h-5 text-emerald-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-3xl font-black text-slate-900 tracking-tighter leading-none",children:o.filter(O=>O.status==="completed").length}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-2",children:"Analyzed"})]})]})}),n.jsx("div",{className:"card p-5 group hover:scale-[1.02] transition-all duration-300",children:n.jsxs("div",{className:"flex flex-col items-center sm:items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-amber-50 flex items-center justify-center shadow-inner group-hover:rotate-12 transition-transform",children:n.jsx(Ti,{className:"w-5 h-5 text-amber-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xl sm:text-2xl font-black text-slate-900 tracking-tighter leading-none pt-1",children:o.length>0?new Date(o[0].createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A"}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-2",children:"Latest"})]})]})})]}),n.jsx("div",{className:"flex gap-3 overflow-x-auto pb-4 snap-x snap-mandatory scrollbar-hide -mx-6 px-6 sm:mx-0 sm:px-0",children:S.map(O=>n.jsx("button",{onClick:()=>g(O),className:`px-5 py-2.5 rounded-2xl font-black whitespace-nowrap transition-all text-[11px] uppercase tracking-widest leading-none snap-start border-2 ${m===O?"bg-slate-900 border-slate-900 text-white shadow-xl scale-105":"bg-white/50 backdrop-blur-sm text-slate-600 border-white hover:border-purple-200 hover:bg-white"}`,children:O==="all"?"All Diagnostics":O},O))}),E.length>0?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"hidden sm:grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(O=>{var F;return n.jsxs("div",{className:"card p-6 border-none hover:shadow-2xl transition-all duration-300 group relative ring-1 ring-white/50",children:[n.jsx("button",{onClick:M=>v(O._id,M),className:"absolute top-4 right-4 w-9 h-9 rounded-xl bg-red-50 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all z-10 shadow-sm opacity-0 group-hover:opacity-100",children:n.jsx(pg,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex items-start gap-5 mb-6",children:[n.jsx("div",{className:"w-16 h-16 rounded-[1.25rem] bg-indigo-50 flex items-center justify-center shadow-inner group-hover:bg-indigo-100 transition-colors",children:n.jsx(Bn,{className:"w-8 h-8 text-indigo-600"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("span",{className:`text-[9px] font-black px-2.5 py-1 rounded-lg uppercase tracking-widest ${O.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:O.status})}),n.jsx("h3",{className:"text-xl font-black text-slate-800 leading-tight uppercase group-hover:text-purple-600 transition-colors mb-1",children:O.reportType}),n.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-[10px] font-black uppercase tracking-widest font-mono",children:[n.jsx(Ti,{className:"w-3 h-3"}),new Date(O.reportDate||O.createdAt).toLocaleDateString()]})]})]}),((F=O.aiAnalysis)==null?void 0:F.healthScore)&&n.jsxs("div",{className:"bg-slate-50/50 backdrop-blur-md rounded-2xl p-4 border border-white/50 mb-6 shadow-inner flex items-center justify-between",children:[n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Health Score"}),n.jsxs("div",{className:"flex items-baseline gap-1",children:[n.jsx("span",{className:"text-3xl font-black text-slate-900 tracking-tighter",children:O.aiAnalysis.healthScore}),n.jsx("span",{className:"text-slate-400 font-bold text-xs",children:"/100"})]})]}),n.jsxs(Os,{to:`/reports/${O._id}`,onClick:()=>window.scrollTo(0,0),className:"w-full py-4 bg-white border-2 border-slate-100 text-slate-800 rounded-2xl font-black text-xs uppercase tracking-widest hover:border-purple-600 hover:text-purple-600 transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[n.jsx(Kp,{className:"w-4 h-4"}),"Analysis Details"]})]},O._id)})}),n.jsx("div",{className:"sm:hidden",children:E.length<=3?n.jsx("div",{className:"grid grid-cols-1 gap-4",children:E.map(O=>{var F;return n.jsxs("div",{className:"card p-5 relative border-none ring-1 ring-white/50",children:[n.jsx("button",{onClick:M=>v(O._id,M),className:"absolute top-3 right-3 w-8 h-8 rounded-xl bg-red-50 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all z-10",children:n.jsx(pg,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-[1rem] bg-indigo-50 flex items-center justify-center flex-shrink-0 shadow-inner",children:n.jsx(Bn,{className:"w-6 h-6 text-indigo-600"})}),n.jsxs("div",{className:"flex-1 min-w-0 pr-8",children:[n.jsx("div",{className:"flex items-start justify-between gap-2 mb-1",children:n.jsx("h3",{className:"text-sm font-black text-slate-800 truncate uppercase",children:O.reportType})}),n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("span",{className:`text-[8px] font-black px-2 py-0.5 rounded-md uppercase tracking-widest whitespace-nowrap ${O.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:O.status})}),n.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 font-mono mb-2",children:new Date(O.reportDate||O.createdAt).toLocaleDateString()}),((F=O.aiAnalysis)==null?void 0:F.healthScore)&&n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"Score:"}),n.jsx("span",{className:"text-lg font-black text-slate-900 tracking-tighter",children:O.aiAnalysis.healthScore}),n.jsx("span",{className:"text-[10px] text-slate-400 font-bold",children:"/100"})]})]})]}),n.jsxs(Os,{to:`/reports/${O._id}`,onClick:()=>window.scrollTo(0,0),className:"w-full py-3 bg-white border-2 border-slate-100 text-slate-800 rounded-xl font-black text-[10px] uppercase tracking-widest hover:border-purple-600 hover:text-purple-600 transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[n.jsx(Kp,{className:"w-3 h-3"}),"Details"]})]},O._id)})}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex overflow-x-auto gap-4 pb-6 snap-x snap-mandatory scrollbar-hide -mx-6 px-6",children:E.map(O=>{var F;return n.jsxs("div",{className:"min-w-[280px] card p-5 relative snap-start flex-shrink-0 border-none ring-1 ring-white/50",children:[n.jsx("button",{onClick:M=>v(O._id,M),className:"absolute top-3 right-3 w-8 h-8 rounded-xl bg-red-50 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all z-10",children:n.jsx(pg,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex items-start gap-4 mb-4 pr-8",children:[n.jsx("div",{className:"w-12 h-12 rounded-[1rem] bg-indigo-50 flex items-center justify-center flex-shrink-0 shadow-inner",children:n.jsx(Bn,{className:"w-6 h-6 text-indigo-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-sm font-black text-slate-800 mb-1 uppercase truncate",children:O.reportType}),n.jsx("span",{className:`text-[8px] px-2 py-0.5 rounded-md font-black uppercase tracking-widest inline-block ${O.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:O.status})]})]}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest font-mono mb-4",children:new Date(O.reportDate||O.createdAt).toLocaleDateString()}),((F=O.aiAnalysis)==null?void 0:F.healthScore)&&n.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50/50 backdrop-blur-md border border-white/50 rounded-xl mb-4 shadow-inner",children:[n.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Health Score"}),n.jsxs("div",{className:"flex items-baseline gap-1",children:[n.jsx("span",{className:"text-2xl font-black text-slate-900 tracking-tighter",children:O.aiAnalysis.healthScore}),n.jsx("span",{className:"text-[10px] text-slate-400 font-bold",children:"/100"})]})]}),n.jsxs(Os,{to:`/reports/${O._id}`,onClick:()=>window.scrollTo(0,0),className:"w-full py-3 bg-white border-2 border-slate-100 text-slate-800 rounded-xl font-black text-[10px] uppercase tracking-widest hover:border-purple-600 hover:text-purple-600 transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[n.jsx(Kp,{className:"w-3 h-3"}),"Details"]})]},O._id)})}),n.jsx("div",{className:"flex items-center justify-center gap-2 text-slate-400 text-[10px] font-black uppercase tracking-widest mt-2",children:n.jsx("span",{children:" Swipe for more "})})]})})]}):n.jsxs("div",{className:"text-center py-16 px-6 card border-none shadow-xl flex flex-col items-center max-w-lg mx-auto mt-12",children:[n.jsxs("div",{className:"w-24 h-24 bg-purple-50 rounded-3xl flex items-center justify-center mb-6 shadow-inner relative",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-3xl blur"}),n.jsx(Bn,{className:"w-12 h-12 text-purple-300 relative z-10"})]}),n.jsx("h3",{className:"text-xl font-black text-slate-800 tracking-tight mb-2 uppercase",children:"No Data Found"}),n.jsx("p",{className:"text-slate-500 mb-8 text-sm font-bold opacity-80 max-w-xs leading-relaxed",children:m==="all"?"Start your health journey by uploading your first diagnostic report.":`No ${m} diagnostic records exist yet.`}),n.jsxs(Os,{to:"/upload",className:"w-full sm:w-auto px-8 py-4 bg-slate-900 text-white rounded-[1.5rem] font-black hover:shadow-2xl transition-all flex items-center justify-center gap-3 text-sm uppercase tracking-widest active:scale-95 shadow-xl",children:[n.jsx(il,{className:"w-4 h-4"}),"Upload Report"]})]})]})}const Yf=[{id:"water",label:"Drink 8 glasses of water",icon:""},{id:"workout",label:"Workout/Yoga (30 mins)",icon:""},{id:"nutrition",label:"Healthy Nutrition (within goal)",icon:""},{id:"sleep",label:"Sleep 7-8 hours",icon:""}];function Hle(){const[a,o]=te.useState(()=>{const R=localStorage.getItem("challenge30DaysCurrentDay");return R?parseInt(R):1}),[c,d]=te.useState({}),[h,m]=te.useState(0),[g,x]=te.useState(!0);te.useEffect(()=>{window.scrollTo(0,0),v()},[]),te.useEffect(()=>{localStorage.setItem("challenge30DaysCurrentDay",a)},[a]);const v=async()=>{const R=localStorage.getItem("challenge30Days"),O=localStorage.getItem("challenge30DaysStreak");if(R)try{const F=JSON.parse(R);d(F),m(parseInt(O)||0)}catch(F){console.error("Error parsing saved data:",F)}try{const F=await Wt.get("/health/challenge"),M=F.data.challengeData||{},Q={};M&&typeof M=="object"&&Object.keys(M).forEach(Z=>{Q[Z]=M[Z]}),d(Q),m(F.data.streakDays||0),localStorage.setItem("challenge30Days",JSON.stringify(Q)),localStorage.setItem("challenge30DaysStreak",F.data.streakDays||0)}catch(F){console.error("Failed to load challenge data from server:",F)}finally{x(!1)}},E=async R=>{let O=0;const F=Object.keys(R).map(Number).sort((M,Q)=>Q-M);for(const M of F){const Q=R[M];if(Object.values(Q).filter(Boolean).length>=Yf.length)O++;else break}m(O),localStorage.setItem("challenge30Days",JSON.stringify(R)),localStorage.setItem("challenge30DaysStreak",O);try{const M=await Wt.post("/health/challenge",{challengeData:R});M.data.streakDays!==O&&(m(M.data.streakDays),localStorage.setItem("challenge30DaysStreak",M.data.streakDays))}catch(M){console.error("Failed to save challenge data to server:",M)}},S=(R,O)=>{var Q;const F={...c,[R]:{...c[R],[O]:!((Q=c[R])!=null&&Q[O])}};d(F),E(F),Object.values(F[R]).filter(Boolean).length===Yf.length&&Ct.success(" Amazing! You completed all tasks for today!")},I=R=>{const O=c[R]||{};return Object.values(O).filter(Boolean).length/Yf.length*100},k=()=>{let R=0;for(let O=1;O<=30;O++){const F=c[O]||{};Object.values(F).filter(Boolean).length>=Yf.length&&R++}return R};return n.jsx("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:g?n.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-600",children:"Loading your challenge..."})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-[#E2D5FF] rounded-[2.5rem] p-6 shadow-xl relative overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsx("button",{onClick:()=>o(Math.max(1,a-1)),className:"w-10 h-10 rounded-full bg-white/50 flex items-center justify-center text-slate-700 hover:bg-white transition-colors",children:n.jsx(ln,{className:"w-5 h-5"})}),n.jsx("div",{className:"text-center",children:n.jsxs("h2",{className:"text-xl font-bold text-indigo-900",children:[a===1?"Today, ":`Day ${a}, `,new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})]})}),n.jsx("button",{onClick:()=>o(Math.min(30,a+1)),className:"w-10 h-10 rounded-full bg-white/50 flex items-center justify-center text-slate-700 hover:bg-white transition-colors rotate-180",children:n.jsx(ln,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex justify-between items-end gap-2 overflow-x-auto pb-4 scrollbar-hide",children:(()=>{const R=["Sa","Su","Mo","Tu","We","Th","Fr"],O=Math.max(1,a-3);return Array.from({length:7},(M,Q)=>{const Z=O+Q;return Z>30?null:Z}).filter(Boolean).map(M=>{const Q=I(M),Z=M===a,$=R[(M-1)%7];return n.jsxs("div",{className:"flex flex-col items-center gap-3 min-w-[50px]",children:[n.jsx("span",{className:`text-sm font-semibold ${Z?"text-indigo-800":"text-slate-500"}`,children:$}),n.jsxs("button",{onClick:()=>o(M),className:`w-14 h-14 rounded-full flex items-center justify-center relative transition-all ${Z?"bg-white shadow-xl scale-110":"bg-white/30 hover:bg-white/50"}`,children:[n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",viewBox:"0 0 56 56",children:[n.jsx("circle",{cx:"28",cy:"28",r:"25",fill:"none",stroke:Z?"#EEF2FF":"rgba(255,255,255,0.2)",strokeWidth:"3"}),n.jsx("circle",{cx:"28",cy:"28",r:"25",fill:"none",stroke:"#818CF8",strokeWidth:"3",strokeDasharray:`${Q/100*157} 157`,strokeLinecap:"round",className:"transition-all duration-700 ease-out"})]}),Z?n.jsx(Jl,{className:"w-6 h-6 text-orange-500 relative z-10 fill-orange-500"}):n.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-200/50"})]}),n.jsx("span",{className:`text-xs font-bold ${Z?"text-indigo-800":"text-slate-500"}`,children:M})]},M)})})()})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-[2rem] p-5 shadow-md border border-slate-100 flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-orange-100 flex items-center justify-center",children:n.jsx(Jl,{className:"w-6 h-6 text-orange-500"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-black text-slate-800",children:h}),n.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Day Streak"})]})]}),n.jsxs("div",{className:"bg-white rounded-[2rem] p-5 shadow-md border border-slate-100 flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-indigo-100 flex items-center justify-center",children:n.jsx(GT,{className:"w-6 h-6 text-indigo-500"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-black text-slate-800",children:k()}),n.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Days Done"})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-xl font-bold text-slate-800",children:["Day ",a," Tasks"]}),n.jsxs("p",{className:"text-slate-500 text-sm",children:[Object.values(c[a]||{}).filter(Boolean).length," of ",Yf.length," completed"]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("div",{className:"text-2xl font-bold text-cyan-600",children:[I(a).toFixed(0),"%"]}),n.jsx("div",{className:"text-xs text-slate-500",children:"Progress"})]})]}),n.jsx("div",{className:"w-full bg-slate-100 rounded-full h-3 mb-6",children:n.jsx("div",{className:"h-3 rounded-full bg-gradient-to-r from-purple-500 to-orange-500 transition-all duration-500",style:{width:`${I(a)}%`}})}),n.jsx("div",{className:"space-y-3",children:Yf.map(R=>{var F;const O=(F=c[a])==null?void 0:F[R.id];return n.jsxs("button",{onClick:()=>S(a,R.id),className:`w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all ${O?"bg-emerald-50 border-emerald-200 hover:bg-emerald-100":"bg-white border-slate-200 hover:bg-slate-50"}`,children:[n.jsx("div",{className:"text-3xl",children:R.icon}),n.jsx("div",{className:"flex-1 text-left",children:n.jsx("p",{className:`font-medium ${O?"text-emerald-700 line-through":"text-slate-800"}`,children:R.label})}),n.jsx("div",{children:O?n.jsx(dn,{className:"w-6 h-6 text-emerald-500"}):n.jsx(one,{className:"w-6 h-6 text-slate-300"})})]},R.id)})})]}),n.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-orange-500 rounded-2xl p-6 text-white",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(ZR,{className:"w-6 h-6"}),n.jsx("h3",{className:"text-lg font-semibold",children:"Achievements"})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[n.jsxs("div",{className:`p-3 rounded-xl text-center ${h>=3?"bg-white/20":"bg-white/10 opacity-50"}`,children:[n.jsx("div",{className:"text-2xl mb-1",children:""}),n.jsx("p",{className:"text-xs font-medium",children:"3 Day Streak"})]}),n.jsxs("div",{className:`p-3 rounded-xl text-center ${h>=7?"bg-white/20":"bg-white/10 opacity-50"}`,children:[n.jsx("div",{className:"text-2xl mb-1",children:""}),n.jsx("p",{className:"text-xs font-medium",children:"1 Week Streak"})]}),n.jsxs("div",{className:`p-3 rounded-xl text-center ${k()>=15?"bg-white/20":"bg-white/10 opacity-50"}`,children:[n.jsx("div",{className:"text-2xl mb-1",children:""}),n.jsx("p",{className:"text-xs font-medium",children:"Half Way"})]}),n.jsxs("div",{className:`p-3 rounded-xl text-center ${k()>=30?"bg-white/20":"bg-white/10 opacity-50"}`,children:[n.jsx("div",{className:"text-2xl mb-1",children:""}),n.jsx("p",{className:"text-xs font-medium",children:"Champion"})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:" Tips for Success"}),n.jsxs("ul",{className:"space-y-2 text-slate-600",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-500 mt-1",children:""}),n.jsx("span",{children:"Complete all 4 tasks daily to maintain your streak"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-500 mt-1",children:""}),n.jsx("span",{children:"Set reminders on your phone for each task"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-500 mt-1",children:""}),n.jsx("span",{children:"Start with easier tasks and gradually increase difficulty"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-500 mt-1",children:""}),n.jsx("span",{children:"Share your progress with friends for accountability"})]})]})]})]})})}function Gle(){var R,O,F;const{user:a}=aa(),[o,c]=te.useState("HbA1c"),[d,h]=te.useState([]),[m,g]=te.useState(5.8),[x,v]=te.useState(108);te.useEffect(()=>{const M=localStorage.getItem("glucose_readings");if(M)h(JSON.parse(M));else{const Q=[{id:1,type:"Fasting",value:98,time:"Today  08:00 AM",status:"optimal",date:new Date().toISOString()},{id:2,type:"Post-Meal",value:142,time:"Today  01:30 PM",status:"monitor",date:new Date().toISOString()},{id:3,type:"HbA1c",value:5.8,time:"Feb 15  Last Lab",status:"target",date:"2026-02-15"}];h(Q),localStorage.setItem("glucose_readings",JSON.stringify(Q))}},[]);const E=[{day:"Tue",value:105},{day:"Wed",value:110},{day:"Thu",value:115},{day:"Fri",value:108},{day:"Sat",value:102},{day:"Sun",value:108}],S=M=>{switch(M){case"optimal":return"text-green-600 bg-green-100";case"monitor":return"text-orange-600 bg-orange-100";case"target":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},I=M=>{switch(M){case"optimal":return"OPTIMAL";case"monitor":return"MONITOR";case"target":return"TARGET";default:return"NORMAL"}},k=M=>{switch(M){case"Fasting":return"bg-green-100 text-green-600";case"Post-Meal":return"bg-orange-100 text-orange-600";case"HbA1c":return"bg-red-100 text-red-600";default:return"bg-gray-100 text-gray-600"}};return n.jsx("div",{className:"min-h-screen bg-gray-50 pb-20",children:n.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[n.jsxs("div",{className:"md:hidden flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-sm font-bold shadow-md flex-shrink-0",children:((O=(R=a==null?void 0:a.name)==null?void 0:R[0])==null?void 0:O.toUpperCase())||"U"}),n.jsxs("h1",{className:"text-sm font-bold text-slate-800 truncate",children:[(()=>{const M=new Date().getHours();return M<12?"Good Morning":M<18?"Good Afternoon":"Good Evening"})(),", ",((F=a==null?void 0:a.name)==null?void 0:F.split(" ")[0])||"there","!"]})]}),n.jsx("button",{className:"w-9 h-9 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all flex-shrink-0",children:n.jsx(WA,{className:"w-4 h-4 text-slate-700"})})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:"Diabetes Care"}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Glycemic Control & Trends"})]}),n.jsx("button",{className:"w-12 h-12 md:w-14 md:h-14 rounded-2xl bg-blue-600 text-white flex items-center justify-center shadow-lg hover:bg-blue-700 transition-all",children:n.jsx($l,{className:"w-6 h-6 md:w-7 md:h-7"})})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center",children:n.jsx(va,{className:"w-5 h-5 text-blue-600"})}),n.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"WEEKLY PROGRESS"})]}),n.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-lg text-sm font-medium text-slate-700",children:[o,n.jsx(lh,{className:"w-4 h-4"})]})]}),n.jsx("div",{className:"relative h-48 mb-4",children:n.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"chartGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:"0.3"}),n.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0"})]})}),n.jsx("path",{d:"M 0 40 Q 16.67 35 33.33 30 T 66.67 45 T 100 40 L 100 100 L 0 100 Z",fill:"url(#chartGradient)"}),n.jsx("path",{d:"M 0 40 Q 16.67 35 33.33 30 T 66.67 45 T 100 40",fill:"none",stroke:"#3b82f6",strokeWidth:"2",strokeLinecap:"round"})]})}),n.jsx("div",{className:"grid grid-cols-6 gap-2 text-center text-xs text-slate-500",children:E.map((M,Q)=>n.jsx("div",{children:M.day},Q))})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-5 text-white shadow-xl",children:[n.jsx("p",{className:"text-slate-400 text-xs uppercase tracking-wide mb-2",children:"CURRENT HBA1C"}),n.jsxs("div",{className:"flex items-baseline gap-2 mb-3",children:[n.jsx("span",{className:"text-4xl font-bold",children:m}),n.jsx("span",{className:"text-green-400 text-lg",children:"%"})]}),n.jsx("div",{className:"w-full h-2 bg-slate-700 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-purple-400 to-orange-400 rounded-full",style:{width:"60%"}})}),n.jsx("p",{className:"text-xs text-cyan-400 mt-2 uppercase tracking-wide",children:"Target Range"})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-lg border-2 border-slate-200",children:[n.jsx("p",{className:"text-slate-600 text-xs uppercase tracking-wide mb-2",children:"DAILY AVG"}),n.jsxs("div",{className:"flex items-baseline gap-2 mb-3",children:[n.jsx("span",{className:"text-4xl font-bold text-slate-900",children:x}),n.jsx("span",{className:"text-slate-500 text-sm",children:"mg/dL"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Cr,{className:"w-4 h-4 text-blue-600"}),n.jsx("span",{className:"text-xs text-blue-600 font-semibold uppercase",children:"Stable Baseline"})]})]})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"RECENT ACTIVITY"}),n.jsx(Os,{to:"/diabetes/history",className:"text-sm text-blue-600 font-semibold hover:underline",children:"View All"})]}),n.jsx("div",{className:"space-y-3",children:d.map(M=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-all",children:[n.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[n.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${k(M.type)}`,children:n.jsx(JR,{className:"w-6 h-6"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("h3",{className:"font-bold text-slate-900",children:[M.type," Reading"]}),n.jsx("p",{className:"text-sm text-slate-500",children:M.time})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"text-2xl font-bold text-slate-900",children:[M.value,n.jsx("span",{className:"text-sm text-slate-500 ml-1",children:M.type==="HbA1c"?"%":"MG/DL"})]}),n.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold uppercase ${S(M.status)}`,children:I(M.status)})]})]},M.id))})]}),n.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-orange-50 rounded-3xl p-6 border-2 border-blue-200",children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-600 flex items-center justify-center flex-shrink-0",children:n.jsx(zd,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-2",children:"SMART FORECAST"}),n.jsx("p",{className:"text-sm text-blue-800 leading-relaxed",children:"Your post-meal glucose has increased by 4% compared to last week. Consider tracking fiber intake to stabilize spikes."})]})]})}),n.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-lg",children:[n.jsx("h2",{className:"text-lg font-bold text-slate-900 mb-4",children:"Quick Tips"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(dn,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-slate-700",children:"Test fasting glucose before breakfast for accurate baseline readings"})]}),n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(dn,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-slate-700",children:"Check post-meal levels 2 hours after eating to monitor spikes"})]}),n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Ln,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-slate-700",children:"Aim for HbA1c below 7% for optimal diabetes management"})]})]})]})]})})}function NH({vital:a,onClose:o}){const[c,d]=te.useState("overview"),[h,m]=te.useState(null),[g,x]=te.useState(!0);if(!a)return console.error("VitalDetailsPopup: vital prop is null or undefined"),null;const{name:v="Unknown Metric",value:E="N/A",unit:S="",normalRange:I="N/A",status:k="normal",description:R="",recommendations:O=[],foodsToConsume:F=[],foodsToAvoid:M=[],symptoms:Q=[],severity:Z=""}=a||{};te.useEffect(()=>{v&&v!=="Unknown Metric"?(async()=>{try{x(!0),console.log(" Fetching AI info for vital:",v);const J=await ll.getMetricInfo({metricName:v,metricValue:E,normalRange:I,unit:S});J.data&&J.data.metricInfo&&(console.log(" Received AI info for vital:",v),m(J.data.metricInfo.en))}catch(J){console.error(" Error fetching AI info:",J)}finally{x(!1)}})():x(!1)},[v,E,I,S]);const X=(Ae=>{if(!Ae)return{min:0,max:100};const J=Ae.split("-").map(Y=>parseFloat(Y.trim()));return{min:J[0],max:J[1]}})(I),be=parseFloat(E),me=()=>be<X.min?0:be>X.max?100:(be-X.min)/(X.max-X.min)*100,le=k==="normal"?{bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-700",badge:"bg-emerald-100"}:k==="borderline"?{bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-700",badge:"bg-amber-100"}:{bg:"bg-red-50",border:"border-red-200",text:"text-red-700",badge:"bg-red-100"},H=me();return n.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",onClick:Ae=>{Ae.target===Ae.currentTarget&&o()},children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:Ae=>Ae.stopPropagation(),children:[n.jsxs("div",{className:`${le.bg} border-b-2 ${le.border} p-6 flex items-center justify-between sticky top-0 z-10`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:`w-12 h-12 rounded-xl ${le.badge} flex items-center justify-center`,children:[k==="normal"&&n.jsx(dn,{className:`w-6 h-6 ${le.text}`}),k==="borderline"&&n.jsx(Ln,{className:`w-6 h-6 ${le.text}`}),k==="high"&&n.jsx(va,{className:`w-6 h-6 ${le.text}`})]}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800",children:v}),n.jsx("p",{className:`text-sm ${le.text} font-medium capitalize`,children:k})]})]}),n.jsx("button",{onClick:o,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:n.jsx(Yi,{className:"w-6 h-6 text-slate-600"})})]}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[n.jsx("p",{className:"text-xs text-slate-600 font-medium mb-1",children:"Your Value"}),n.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[E," ",n.jsx("span",{className:"text-sm text-slate-500",children:S})]})]}),n.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-200",children:[n.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Normal Range"}),n.jsx("p",{className:"text-2xl font-bold text-blue-700",children:I})]}),n.jsxs("div",{className:`${le.bg} rounded-xl p-4 border-2 ${le.border}`,children:[n.jsx("p",{className:`text-xs ${le.text} font-medium mb-1`,children:"Status"}),n.jsx("p",{className:`text-2xl font-bold ${le.text} capitalize`,children:k})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"Range Indicator"}),n.jsxs("div",{className:"relative h-12 bg-gradient-to-r from-purple-200 via-pink-200 to-orange-200 rounded-xl overflow-hidden border-2 border-slate-200",children:[n.jsx("div",{className:"absolute top-0 bottom-0 bg-white/40 border-l-2 border-r-2 border-blue-500",style:{left:`${X.min/(X.max*1.2)*100}%`,right:`${100-X.max/(X.max*1.2)*100}%`}}),n.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-1 h-full bg-slate-800 border-2 border-white shadow-lg",style:{left:`${H}%`},children:n.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 left-0 w-8 h-8 bg-slate-800 rounded-full border-4 border-white shadow-lg"})})]}),n.jsxs("div",{className:"flex justify-between text-xs text-slate-600 font-medium",children:[n.jsx("span",{children:"Low"}),n.jsx("span",{children:"Normal"}),n.jsx("span",{children:"High"})]})]})]}),n.jsx("div",{className:"flex gap-2 border-b border-slate-200",children:[{id:"overview",label:"Overview"},{id:"recommendations",label:"What to Do"},{id:"foods",label:"Foods & Diet"}].map(Ae=>n.jsx("button",{onClick:()=>d(Ae.id),className:`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${c===Ae.id?"border-cyan-500 text-cyan-600":"border-transparent text-slate-600 hover:text-slate-800"}`,children:Ae.label},Ae.id))}),n.jsxs("div",{className:"space-y-4",children:[c==="overview"&&n.jsx("div",{className:"space-y-4",children:g?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-3"}),n.jsx("p",{className:"text-slate-500 text-sm",children:"Loading AI insights..."})]}):n.jsxs(n.Fragment,{children:[((h==null?void 0:h.whatIsIt)||R)&&n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200",children:[n.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[n.jsx(zd,{className:"w-4 h-4"}),"What is ",v,"?"]}),n.jsx("p",{className:"text-sm text-blue-900 leading-relaxed",children:(h==null?void 0:h.whatIsIt)||R||`${v} is a health metric that helps monitor your overall health.`})]}),n.jsxs("div",{className:`p-4 rounded-xl border-2 ${le.border} ${le.bg}`,children:[n.jsxs("h3",{className:`font-semibold ${le.text} mb-2 flex items-center gap-2`,children:[n.jsx(zd,{className:"w-4 h-4"}),"What This Means"]}),n.jsxs("p",{className:`text-sm ${le.text}`,children:[k==="normal"&&"Your value is within the normal range. Keep maintaining your current lifestyle and habits.",k==="borderline"&&"Your value is slightly outside the normal range. Consider making lifestyle adjustments and monitor regularly.",k==="high"&&"Your value is significantly outside the normal range. Consult with a healthcare provider and make necessary changes.",k==="low"&&"Your value is below the normal range. Consult with a healthcare provider for guidance."]})]}),(h==null?void 0:h.whenLowEffects)&&h.whenLowEffects.length>0&&n.jsxs("div",{className:"p-4 bg-amber-50 rounded-xl border border-amber-200",children:[n.jsxs("h3",{className:"font-semibold text-amber-900 mb-3 flex items-center gap-2",children:[n.jsx(rE,{className:"w-4 h-4"}),h.whenLowTitle||"When Low"]}),n.jsx("ul",{className:"space-y-2",children:h.whenLowEffects.map((Ae,J)=>n.jsxs("li",{className:"text-sm text-amber-800 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-amber-600 rounded-full mt-1.5 flex-shrink-0"}),Ae]},J))})]}),(h==null?void 0:h.whenHighEffects)&&h.whenHighEffects.length>0&&n.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[n.jsxs("h3",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[n.jsx(va,{className:"w-4 h-4"}),h.whenHighTitle||"When High"]}),n.jsx("ul",{className:"space-y-2",children:h.whenHighEffects.map((Ae,J)=>n.jsxs("li",{className:"text-sm text-red-800 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-red-600 rounded-full mt-1.5 flex-shrink-0"}),Ae]},J))})]}),!h&&Q&&Array.isArray(Q)&&Q.length>0&&n.jsxs("div",{className:"p-4 bg-amber-50 rounded-xl border border-amber-200",children:[n.jsxs("h3",{className:"font-semibold text-amber-900 mb-3 flex items-center gap-2",children:[n.jsx(Ln,{className:"w-4 h-4"}),"Associated Symptoms"]}),n.jsx("ul",{className:"space-y-2",children:Q.map((Ae,J)=>n.jsxs("li",{className:"text-sm text-amber-800 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-amber-600 rounded-full mt-1.5 flex-shrink-0"}),Ae]},J))})]})]})}),c==="recommendations"&&n.jsx("div",{className:"space-y-4",children:g?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-3"}),n.jsx("p",{className:"text-slate-500 text-sm",children:"Loading recommendations..."})]}):n.jsxs(n.Fragment,{children:[h!=null&&h.solutions&&h.solutions.length>0?n.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[n.jsxs("h3",{className:"font-semibold text-emerald-900 mb-3 flex items-center gap-2",children:[n.jsx(dn,{className:"w-4 h-4"}),"How to Improve"]}),n.jsx("ul",{className:"space-y-3",children:h.solutions.map((Ae,J)=>n.jsxs("li",{className:"text-sm text-emerald-800 flex items-start gap-3 p-3 bg-white rounded-lg",children:[n.jsx("span",{className:"w-6 h-6 bg-emerald-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",children:J+1}),n.jsx("span",{children:Ae})]},J))})]}):O&&Array.isArray(O)&&O.length>0?n.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[n.jsxs("h3",{className:"font-semibold text-emerald-900 mb-3 flex items-center gap-2",children:[n.jsx(dn,{className:"w-4 h-4"}),"Recommendations"]}),n.jsx("ul",{className:"space-y-3",children:O.map((Ae,J)=>n.jsxs("li",{className:"text-sm text-emerald-800 flex items-start gap-3 p-3 bg-white rounded-lg",children:[n.jsx("span",{className:"w-6 h-6 bg-emerald-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",children:J+1}),n.jsx("span",{children:Ae})]},J))})]}):n.jsxs("div",{className:"text-center py-8 text-slate-500",children:[n.jsx(zd,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),n.jsx("p",{children:"Consult with a healthcare professional for personalized recommendations."})]}),n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200",children:[n.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"General Tips"}),n.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Monitor this value regularly"]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Maintain a healthy lifestyle"]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Consult a healthcare provider if concerned"]})]})]})]})}),c==="foods"&&n.jsxs("div",{className:"space-y-4",children:[F&&Array.isArray(F)&&F.length>0&&n.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[n.jsxs("h3",{className:"font-semibold text-emerald-900 mb-3 flex items-center gap-2",children:[n.jsx(dn,{className:"w-4 h-4"}),"Foods to Consume"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:F.map((Ae,J)=>n.jsx("span",{className:"px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium",children:Ae},J))})]}),M&&Array.isArray(M)&&M.length>0&&n.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[n.jsxs("h3",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[n.jsx(Ln,{className:"w-4 h-4"}),"Foods to Avoid"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:M.map((Ae,J)=>n.jsx("span",{className:"px-3 py-1.5 bg-red-100 text-red-700 rounded-full text-sm font-medium",children:Ae},J))})]}),(!F||!Array.isArray(F)||F.length===0)&&(!M||!Array.isArray(M)||M.length===0)&&n.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-200",children:n.jsx("p",{className:"text-sm text-slate-600",children:"No specific dietary recommendations available."})})]})]}),Z&&n.jsx("div",{className:`p-4 rounded-xl border-2 ${Z==="severe"?"bg-red-50 border-red-200":Z==="moderate"?"bg-amber-50 border-amber-200":"bg-yellow-50 border-yellow-200"}`,children:n.jsxs("p",{className:`text-sm font-medium ${Z==="severe"?"text-red-700":Z==="moderate"?"text-amber-700":"text-yellow-700"}`,children:[n.jsx("strong",{children:"Severity:"})," ",Z.charAt(0).toUpperCase()+Z.slice(1)]})})]}),n.jsx("div",{className:"border-t border-slate-200 p-6 bg-slate-50",children:n.jsx("p",{className:"text-xs text-slate-600 text-center",children:"This information is for educational purposes only. Always consult with a healthcare provider for medical advice."})})]})})}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var mR=function(a,o){return mR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(c[h]=d[h])},mR(a,o)};function sd(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");mR(a,o);function c(){this.constructor=a}a.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}var fR=function(){return fR=Object.assign||function(o){for(var c,d=1,h=arguments.length;d<h;d++){c=arguments[d];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(o[m]=c[m])}return o},fR.apply(this,arguments)};function xo(a,o,c,d){function h(m){return m instanceof c?m:new c(function(g){g(m)})}return new(c||(c=Promise))(function(m,g){function x(S){try{E(d.next(S))}catch(I){g(I)}}function v(S){try{E(d.throw(S))}catch(I){g(I)}}function E(S){S.done?m(S.value):h(S.value).then(x,v)}E((d=d.apply(a,[])).next())})}function $a(a,o){var c={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},d,h,m,g;return g={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function x(E){return function(S){return v([E,S])}}function v(E){if(d)throw new TypeError("Generator is already executing.");for(;c;)try{if(d=1,h&&(m=E[0]&2?h.return:E[0]?h.throw||((m=h.return)&&m.call(h),0):h.next)&&!(m=m.call(h,E[1])).done)return m;switch(h=0,m&&(E=[E[0]&2,m.value]),E[0]){case 0:case 1:m=E;break;case 4:return c.label++,{value:E[1],done:!1};case 5:c.label++,h=E[1],E=[0];continue;case 7:E=c.ops.pop(),c.trys.pop();continue;default:if(m=c.trys,!(m=m.length>0&&m[m.length-1])&&(E[0]===6||E[0]===2)){c=0;continue}if(E[0]===3&&(!m||E[1]>m[0]&&E[1]<m[3])){c.label=E[1];break}if(E[0]===6&&c.label<m[1]){c.label=m[1],m=E;break}if(m&&c.label<m[2]){c.label=m[2],c.ops.push(E);break}m[2]&&c.ops.pop(),c.trys.pop();continue}E=o.call(a,c)}catch(S){E=[6,S],h=0}finally{d=m=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function U_(a,o,c){if(arguments.length===2)for(var d=0,h=o.length,m;d<h;d++)(m||!(d in o))&&(m||(m=Array.prototype.slice.call(o,0,d)),m[d]=o[d]);return a.concat(m||o)}var YA=function(){function a(o,c,d,h){this.left=o,this.top=c,this.width=d,this.height=h}return a.prototype.add=function(o,c,d,h){return new a(this.left+o,this.top+c,this.width+d,this.height+h)},a.fromClientRect=function(o,c){return new a(c.left+o.windowBounds.left,c.top+o.windowBounds.top,c.width,c.height)},a.fromDOMRectList=function(o,c){var d=Array.from(c).find(function(h){return h.width!==0});return d?new a(d.left+o.windowBounds.left,d.top+o.windowBounds.top,d.width,d.height):a.EMPTY},a.EMPTY=new a(0,0,0,0),a}(),mE=function(a,o){return YA.fromClientRect(a,o.getBoundingClientRect())},Kle=function(a){var o=a.body,c=a.documentElement;if(!o||!c)throw new Error("Unable to get document size");var d=Math.max(Math.max(o.scrollWidth,c.scrollWidth),Math.max(o.offsetWidth,c.offsetWidth),Math.max(o.clientWidth,c.clientWidth)),h=Math.max(Math.max(o.scrollHeight,c.scrollHeight),Math.max(o.offsetHeight,c.offsetHeight),Math.max(o.clientHeight,c.clientHeight));return new YA(0,0,d,h)},fE=function(a){for(var o=[],c=0,d=a.length;c<d;){var h=a.charCodeAt(c++);if(h>=55296&&h<=56319&&c<d){var m=a.charCodeAt(c++);(m&64512)===56320?o.push(((h&1023)<<10)+(m&1023)+65536):(o.push(h),c--)}else o.push(h)}return o},Pi=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];if(String.fromCodePoint)return String.fromCodePoint.apply(String,a);var c=a.length;if(!c)return"";for(var d=[],h=-1,m="";++h<c;){var g=a[h];g<=65535?d.push(g):(g-=65536,d.push((g>>10)+55296,g%1024+56320)),(h+1===c||d.length>16384)&&(m+=String.fromCharCode.apply(String,d),d.length=0)}return m},U6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wle=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var F_=0;F_<U6.length;F_++)Wle[U6.charCodeAt(F_)]=F_;var F6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kb=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var M_=0;M_<F6.length;M_++)kb[F6.charCodeAt(M_)]=M_;var zle=function(a){var o=a.length*.75,c=a.length,d,h=0,m,g,x,v;a[a.length-1]==="="&&(o--,a[a.length-2]==="="&&o--);var E=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(o):new Array(o),S=Array.isArray(E)?E:new Uint8Array(E);for(d=0;d<c;d+=4)m=kb[a.charCodeAt(d)],g=kb[a.charCodeAt(d+1)],x=kb[a.charCodeAt(d+2)],v=kb[a.charCodeAt(d+3)],S[h++]=m<<2|g>>4,S[h++]=(g&15)<<4|x>>2,S[h++]=(x&3)<<6|v&63;return E},qle=function(a){for(var o=a.length,c=[],d=0;d<o;d+=2)c.push(a[d+1]<<8|a[d]);return c},Yle=function(a){for(var o=a.length,c=[],d=0;d<o;d+=4)c.push(a[d+3]<<24|a[d+2]<<16|a[d+1]<<8|a[d]);return c},zp=5,dI=11,$2=2,Xle=dI-zp,TH=65536>>zp,Jle=1<<zp,Z2=Jle-1,$le=1024>>zp,Zle=TH+$le,ede=Zle,tde=32,sde=ede+tde,rde=65536>>dI,nde=1<<Xle,ide=nde-1,M6=function(a,o,c){return a.slice?a.slice(o,c):new Uint16Array(Array.prototype.slice.call(a,o,c))},ade=function(a,o,c){return a.slice?a.slice(o,c):new Uint32Array(Array.prototype.slice.call(a,o,c))},ode=function(a,o){var c=zle(a),d=Array.isArray(c)?Yle(c):new Uint32Array(c),h=Array.isArray(c)?qle(c):new Uint16Array(c),m=24,g=M6(h,m/2,d[4]/2),x=d[5]===2?M6(h,(m+d[4])/2):ade(d,Math.ceil((m+d[4])/4));return new cde(d[0],d[1],d[2],d[3],g,x)},cde=function(){function a(o,c,d,h,m,g){this.initialValue=o,this.errorValue=c,this.highStart=d,this.highValueIndex=h,this.index=m,this.data=g}return a.prototype.get=function(o){var c;if(o>=0){if(o<55296||o>56319&&o<=65535)return c=this.index[o>>zp],c=(c<<$2)+(o&Z2),this.data[c];if(o<=65535)return c=this.index[TH+(o-55296>>zp)],c=(c<<$2)+(o&Z2),this.data[c];if(o<this.highStart)return c=sde-rde+(o>>dI),c=this.index[c],c+=o>>zp&ide,c=this.index[c],c=(c<<$2)+(o&Z2),this.data[c];if(o<=1114111)return this.data[this.highValueIndex]}return this.errorValue},a}(),V6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lde=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var V_=0;V_<V6.length;V_++)lde[V6.charCodeAt(V_)]=V_;var dde="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Q6=50,Ade=1,RH=2,IH=3,ude=4,hde=5,H6=7,OH=8,G6=9,sh=10,gR=11,K6=12,bR=13,pde=14,Db=15,xR=16,Q_=17,Sb=18,mde=19,W6=20,vR=21,Cb=22,eT=23,Xf=24,vc=25,Bb=26,Lb=27,Jf=28,fde=29,Vp=30,gde=31,H_=32,G_=33,wR=34,_R=35,yR=36,Jb=37,ER=38,wy=39,_y=40,tT=41,kH=42,bde=43,xde=[9001,65288],DH="!",Pr="",K_="",SR=ode(dde),UA=[Vp,yR],CR=[Ade,RH,IH,hde],BH=[sh,OH],z6=[Lb,Bb],vde=CR.concat(BH),q6=[ER,wy,_y,wR,_R],wde=[Db,bR],_de=function(a,o){o===void 0&&(o="strict");var c=[],d=[],h=[];return a.forEach(function(m,g){var x=SR.get(m);if(x>Q6?(h.push(!0),x-=Q6):h.push(!1),["normal","auto","loose"].indexOf(o)!==-1&&[8208,8211,12316,12448].indexOf(m)!==-1)return d.push(g),c.push(xR);if(x===ude||x===gR){if(g===0)return d.push(g),c.push(Vp);var v=c[g-1];return vde.indexOf(v)===-1?(d.push(d[g-1]),c.push(v)):(d.push(g),c.push(Vp))}if(d.push(g),x===gde)return c.push(o==="strict"?vR:Jb);if(x===kH||x===fde)return c.push(Vp);if(x===bde)return m>=131072&&m<=196605||m>=196608&&m<=262141?c.push(Jb):c.push(Vp);c.push(x)}),[d,c,h]},sT=function(a,o,c,d){var h=d[c];if(Array.isArray(a)?a.indexOf(h)!==-1:a===h)for(var m=c;m<=d.length;){m++;var g=d[m];if(g===o)return!0;if(g!==sh)break}if(h===sh)for(var m=c;m>0;){m--;var x=d[m];if(Array.isArray(a)?a.indexOf(x)!==-1:a===x)for(var v=c;v<=d.length;){v++;var g=d[v];if(g===o)return!0;if(g!==sh)break}if(x!==sh)break}return!1},Y6=function(a,o){for(var c=a;c>=0;){var d=o[c];if(d===sh)c--;else return d}return 0},yde=function(a,o,c,d,h){if(c[d]===0)return Pr;var m=d-1;if(Array.isArray(h)&&h[m]===!0)return Pr;var g=m-1,x=m+1,v=o[m],E=g>=0?o[g]:0,S=o[x];if(v===RH&&S===IH)return Pr;if(CR.indexOf(v)!==-1)return DH;if(CR.indexOf(S)!==-1||BH.indexOf(S)!==-1)return Pr;if(Y6(m,o)===OH)return K_;if(SR.get(a[m])===gR||(v===H_||v===G_)&&SR.get(a[x])===gR||v===H6||S===H6||v===G6||[sh,bR,Db].indexOf(v)===-1&&S===G6||[Q_,Sb,mde,Xf,Jf].indexOf(S)!==-1||Y6(m,o)===Cb||sT(eT,Cb,m,o)||sT([Q_,Sb],vR,m,o)||sT(K6,K6,m,o))return Pr;if(v===sh)return K_;if(v===eT||S===eT)return Pr;if(S===xR||v===xR)return K_;if([bR,Db,vR].indexOf(S)!==-1||v===pde||E===yR&&wde.indexOf(v)!==-1||v===Jf&&S===yR||S===W6||UA.indexOf(S)!==-1&&v===vc||UA.indexOf(v)!==-1&&S===vc||v===Lb&&[Jb,H_,G_].indexOf(S)!==-1||[Jb,H_,G_].indexOf(v)!==-1&&S===Bb||UA.indexOf(v)!==-1&&z6.indexOf(S)!==-1||z6.indexOf(v)!==-1&&UA.indexOf(S)!==-1||[Lb,Bb].indexOf(v)!==-1&&(S===vc||[Cb,Db].indexOf(S)!==-1&&o[x+1]===vc)||[Cb,Db].indexOf(v)!==-1&&S===vc||v===vc&&[vc,Jf,Xf].indexOf(S)!==-1)return Pr;if([vc,Jf,Xf,Q_,Sb].indexOf(S)!==-1)for(var I=m;I>=0;){var k=o[I];if(k===vc)return Pr;if([Jf,Xf].indexOf(k)!==-1)I--;else break}if([Lb,Bb].indexOf(S)!==-1)for(var I=[Q_,Sb].indexOf(v)!==-1?g:m;I>=0;){var k=o[I];if(k===vc)return Pr;if([Jf,Xf].indexOf(k)!==-1)I--;else break}if(ER===v&&[ER,wy,wR,_R].indexOf(S)!==-1||[wy,wR].indexOf(v)!==-1&&[wy,_y].indexOf(S)!==-1||[_y,_R].indexOf(v)!==-1&&S===_y||q6.indexOf(v)!==-1&&[W6,Bb].indexOf(S)!==-1||q6.indexOf(S)!==-1&&v===Lb||UA.indexOf(v)!==-1&&UA.indexOf(S)!==-1||v===Xf&&UA.indexOf(S)!==-1||UA.concat(vc).indexOf(v)!==-1&&S===Cb&&xde.indexOf(a[x])===-1||UA.concat(vc).indexOf(S)!==-1&&v===Sb)return Pr;if(v===tT&&S===tT){for(var R=c[m],O=1;R>0&&(R--,o[R]===tT);)O++;if(O%2!==0)return Pr}return v===H_&&S===G_?Pr:K_},Ede=function(a,o){o||(o={lineBreak:"normal",wordBreak:"normal"});var c=_de(a,o.lineBreak),d=c[0],h=c[1],m=c[2];(o.wordBreak==="break-all"||o.wordBreak==="break-word")&&(h=h.map(function(x){return[vc,Vp,kH].indexOf(x)!==-1?Jb:x}));var g=o.wordBreak==="keep-all"?m.map(function(x,v){return x&&a[v]>=19968&&a[v]<=40959}):void 0;return[d,h,g]},Sde=function(){function a(o,c,d,h){this.codePoints=o,this.required=c===DH,this.start=d,this.end=h}return a.prototype.slice=function(){return Pi.apply(void 0,this.codePoints.slice(this.start,this.end))},a}(),Cde=function(a,o){var c=fE(a),d=Ede(c,o),h=d[0],m=d[1],g=d[2],x=c.length,v=0,E=0;return{next:function(){if(E>=x)return{done:!0,value:null};for(var S=Pr;E<x&&(S=yde(c,m,h,++E,g))===Pr;);if(S!==Pr||E===x){var I=new Sde(c,S,v,E);return v=E,{value:I,done:!1}}return{done:!0,value:null}}}},Nde=1,Tde=2,hx=4,X6=8,Fy=10,J6=47,Mb=92,Rde=9,Ide=32,W_=34,Nb=61,Ode=35,kde=36,Dde=37,z_=39,q_=40,Tb=41,Bde=95,Ko=45,Lde=33,jde=60,Pde=62,Ude=64,Fde=91,Mde=93,Vde=61,Qde=123,Y_=63,Hde=125,$6=124,Gde=126,Kde=128,Z6=65533,rT=42,Gp=43,Wde=44,zde=58,qde=59,$b=46,Yde=0,Xde=8,Jde=11,$de=14,Zde=31,eAe=127,Gd=-1,LH=48,jH=97,PH=101,tAe=102,sAe=117,rAe=122,UH=65,FH=69,MH=70,nAe=85,iAe=90,Za=function(a){return a>=LH&&a<=57},aAe=function(a){return a>=55296&&a<=57343},$f=function(a){return Za(a)||a>=UH&&a<=MH||a>=jH&&a<=tAe},oAe=function(a){return a>=jH&&a<=rAe},cAe=function(a){return a>=UH&&a<=iAe},lAe=function(a){return oAe(a)||cAe(a)},dAe=function(a){return a>=Kde},X_=function(a){return a===Fy||a===Rde||a===Ide},My=function(a){return lAe(a)||dAe(a)||a===Bde},e8=function(a){return My(a)||Za(a)||a===Ko},AAe=function(a){return a>=Yde&&a<=Xde||a===Jde||a>=$de&&a<=Zde||a===eAe},Ju=function(a,o){return a!==Mb?!1:o!==Fy},J_=function(a,o,c){return a===Ko?My(o)||Ju(o,c):My(a)?!0:!!(a===Mb&&Ju(a,o))},nT=function(a,o,c){return a===Gp||a===Ko?Za(o)?!0:o===$b&&Za(c):Za(a===$b?o:a)},uAe=function(a){var o=0,c=1;(a[o]===Gp||a[o]===Ko)&&(a[o]===Ko&&(c=-1),o++);for(var d=[];Za(a[o]);)d.push(a[o++]);var h=d.length?parseInt(Pi.apply(void 0,d),10):0;a[o]===$b&&o++;for(var m=[];Za(a[o]);)m.push(a[o++]);var g=m.length,x=g?parseInt(Pi.apply(void 0,m),10):0;(a[o]===FH||a[o]===PH)&&o++;var v=1;(a[o]===Gp||a[o]===Ko)&&(a[o]===Ko&&(v=-1),o++);for(var E=[];Za(a[o]);)E.push(a[o++]);var S=E.length?parseInt(Pi.apply(void 0,E),10):0;return c*(h+x*Math.pow(10,-g))*Math.pow(10,v*S)},hAe={type:2},pAe={type:3},mAe={type:4},fAe={type:13},gAe={type:8},bAe={type:21},xAe={type:9},vAe={type:10},wAe={type:11},_Ae={type:12},yAe={type:14},$_={type:23},EAe={type:1},SAe={type:25},CAe={type:24},NAe={type:26},TAe={type:27},RAe={type:28},IAe={type:29},OAe={type:31},NR={type:32},VH=function(){function a(){this._value=[]}return a.prototype.write=function(o){this._value=this._value.concat(fE(o))},a.prototype.read=function(){for(var o=[],c=this.consumeToken();c!==NR;)o.push(c),c=this.consumeToken();return o},a.prototype.consumeToken=function(){var o=this.consumeCodePoint();switch(o){case W_:return this.consumeStringToken(W_);case Ode:var c=this.peekCodePoint(0),d=this.peekCodePoint(1),h=this.peekCodePoint(2);if(e8(c)||Ju(d,h)){var m=J_(c,d,h)?Tde:Nde,g=this.consumeName();return{type:5,value:g,flags:m}}break;case kde:if(this.peekCodePoint(0)===Nb)return this.consumeCodePoint(),fAe;break;case z_:return this.consumeStringToken(z_);case q_:return hAe;case Tb:return pAe;case rT:if(this.peekCodePoint(0)===Nb)return this.consumeCodePoint(),yAe;break;case Gp:if(nT(o,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(o),this.consumeNumericToken();break;case Wde:return mAe;case Ko:var x=o,v=this.peekCodePoint(0),E=this.peekCodePoint(1);if(nT(x,v,E))return this.reconsumeCodePoint(o),this.consumeNumericToken();if(J_(x,v,E))return this.reconsumeCodePoint(o),this.consumeIdentLikeToken();if(v===Ko&&E===Pde)return this.consumeCodePoint(),this.consumeCodePoint(),CAe;break;case $b:if(nT(o,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(o),this.consumeNumericToken();break;case J6:if(this.peekCodePoint(0)===rT)for(this.consumeCodePoint();;){var S=this.consumeCodePoint();if(S===rT&&(S=this.consumeCodePoint(),S===J6))return this.consumeToken();if(S===Gd)return this.consumeToken()}break;case zde:return NAe;case qde:return TAe;case jde:if(this.peekCodePoint(0)===Lde&&this.peekCodePoint(1)===Ko&&this.peekCodePoint(2)===Ko)return this.consumeCodePoint(),this.consumeCodePoint(),SAe;break;case Ude:var I=this.peekCodePoint(0),k=this.peekCodePoint(1),R=this.peekCodePoint(2);if(J_(I,k,R)){var g=this.consumeName();return{type:7,value:g}}break;case Fde:return RAe;case Mb:if(Ju(o,this.peekCodePoint(0)))return this.reconsumeCodePoint(o),this.consumeIdentLikeToken();break;case Mde:return IAe;case Vde:if(this.peekCodePoint(0)===Nb)return this.consumeCodePoint(),gAe;break;case Qde:return wAe;case Hde:return _Ae;case sAe:case nAe:var O=this.peekCodePoint(0),F=this.peekCodePoint(1);return O===Gp&&($f(F)||F===Y_)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(o),this.consumeIdentLikeToken();case $6:if(this.peekCodePoint(0)===Nb)return this.consumeCodePoint(),xAe;if(this.peekCodePoint(0)===$6)return this.consumeCodePoint(),bAe;break;case Gde:if(this.peekCodePoint(0)===Nb)return this.consumeCodePoint(),vAe;break;case Gd:return NR}return X_(o)?(this.consumeWhiteSpace(),OAe):Za(o)?(this.reconsumeCodePoint(o),this.consumeNumericToken()):My(o)?(this.reconsumeCodePoint(o),this.consumeIdentLikeToken()):{type:6,value:Pi(o)}},a.prototype.consumeCodePoint=function(){var o=this._value.shift();return typeof o>"u"?-1:o},a.prototype.reconsumeCodePoint=function(o){this._value.unshift(o)},a.prototype.peekCodePoint=function(o){return o>=this._value.length?-1:this._value[o]},a.prototype.consumeUnicodeRangeToken=function(){for(var o=[],c=this.consumeCodePoint();$f(c)&&o.length<6;)o.push(c),c=this.consumeCodePoint();for(var d=!1;c===Y_&&o.length<6;)o.push(c),c=this.consumeCodePoint(),d=!0;if(d){var h=parseInt(Pi.apply(void 0,o.map(function(v){return v===Y_?LH:v})),16),m=parseInt(Pi.apply(void 0,o.map(function(v){return v===Y_?MH:v})),16);return{type:30,start:h,end:m}}var g=parseInt(Pi.apply(void 0,o),16);if(this.peekCodePoint(0)===Ko&&$f(this.peekCodePoint(1))){this.consumeCodePoint(),c=this.consumeCodePoint();for(var x=[];$f(c)&&x.length<6;)x.push(c),c=this.consumeCodePoint();var m=parseInt(Pi.apply(void 0,x),16);return{type:30,start:g,end:m}}else return{type:30,start:g,end:g}},a.prototype.consumeIdentLikeToken=function(){var o=this.consumeName();return o.toLowerCase()==="url"&&this.peekCodePoint(0)===q_?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===q_?(this.consumeCodePoint(),{type:19,value:o}):{type:20,value:o}},a.prototype.consumeUrlToken=function(){var o=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Gd)return{type:22,value:""};var c=this.peekCodePoint(0);if(c===z_||c===W_){var d=this.consumeStringToken(this.consumeCodePoint());return d.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Gd||this.peekCodePoint(0)===Tb)?(this.consumeCodePoint(),{type:22,value:d.value}):(this.consumeBadUrlRemnants(),$_)}for(;;){var h=this.consumeCodePoint();if(h===Gd||h===Tb)return{type:22,value:Pi.apply(void 0,o)};if(X_(h))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Gd||this.peekCodePoint(0)===Tb?(this.consumeCodePoint(),{type:22,value:Pi.apply(void 0,o)}):(this.consumeBadUrlRemnants(),$_);if(h===W_||h===z_||h===q_||AAe(h))return this.consumeBadUrlRemnants(),$_;if(h===Mb)if(Ju(h,this.peekCodePoint(0)))o.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),$_;else o.push(h)}},a.prototype.consumeWhiteSpace=function(){for(;X_(this.peekCodePoint(0));)this.consumeCodePoint()},a.prototype.consumeBadUrlRemnants=function(){for(;;){var o=this.consumeCodePoint();if(o===Tb||o===Gd)return;Ju(o,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},a.prototype.consumeStringSlice=function(o){for(var c=5e4,d="";o>0;){var h=Math.min(c,o);d+=Pi.apply(void 0,this._value.splice(0,h)),o-=h}return this._value.shift(),d},a.prototype.consumeStringToken=function(o){var c="",d=0;do{var h=this._value[d];if(h===Gd||h===void 0||h===o)return c+=this.consumeStringSlice(d),{type:0,value:c};if(h===Fy)return this._value.splice(0,d),EAe;if(h===Mb){var m=this._value[d+1];m!==Gd&&m!==void 0&&(m===Fy?(c+=this.consumeStringSlice(d),d=-1,this._value.shift()):Ju(h,m)&&(c+=this.consumeStringSlice(d),c+=Pi(this.consumeEscapedCodePoint()),d=-1))}d++}while(!0)},a.prototype.consumeNumber=function(){var o=[],c=hx,d=this.peekCodePoint(0);for((d===Gp||d===Ko)&&o.push(this.consumeCodePoint());Za(this.peekCodePoint(0));)o.push(this.consumeCodePoint());d=this.peekCodePoint(0);var h=this.peekCodePoint(1);if(d===$b&&Za(h))for(o.push(this.consumeCodePoint(),this.consumeCodePoint()),c=X6;Za(this.peekCodePoint(0));)o.push(this.consumeCodePoint());d=this.peekCodePoint(0),h=this.peekCodePoint(1);var m=this.peekCodePoint(2);if((d===FH||d===PH)&&((h===Gp||h===Ko)&&Za(m)||Za(h)))for(o.push(this.consumeCodePoint(),this.consumeCodePoint()),c=X6;Za(this.peekCodePoint(0));)o.push(this.consumeCodePoint());return[uAe(o),c]},a.prototype.consumeNumericToken=function(){var o=this.consumeNumber(),c=o[0],d=o[1],h=this.peekCodePoint(0),m=this.peekCodePoint(1),g=this.peekCodePoint(2);if(J_(h,m,g)){var x=this.consumeName();return{type:15,number:c,flags:d,unit:x}}return h===Dde?(this.consumeCodePoint(),{type:16,number:c,flags:d}):{type:17,number:c,flags:d}},a.prototype.consumeEscapedCodePoint=function(){var o=this.consumeCodePoint();if($f(o)){for(var c=Pi(o);$f(this.peekCodePoint(0))&&c.length<6;)c+=Pi(this.consumeCodePoint());X_(this.peekCodePoint(0))&&this.consumeCodePoint();var d=parseInt(c,16);return d===0||aAe(d)||d>1114111?Z6:d}return o===Gd?Z6:o},a.prototype.consumeName=function(){for(var o="";;){var c=this.consumeCodePoint();if(e8(c))o+=Pi(c);else if(Ju(c,this.peekCodePoint(0)))o+=Pi(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(c),o}},a}(),QH=function(){function a(o){this._tokens=o}return a.create=function(o){var c=new VH;return c.write(o),new a(c.read())},a.parseValue=function(o){return a.create(o).parseComponentValue()},a.parseValues=function(o){return a.create(o).parseComponentValues()},a.prototype.parseComponentValue=function(){for(var o=this.consumeToken();o.type===31;)o=this.consumeToken();if(o.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(o);var c=this.consumeComponentValue();do o=this.consumeToken();while(o.type===31);if(o.type===32)return c;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},a.prototype.parseComponentValues=function(){for(var o=[];;){var c=this.consumeComponentValue();if(c.type===32)return o;o.push(c),o.push()}},a.prototype.consumeComponentValue=function(){var o=this.consumeToken();switch(o.type){case 11:case 28:case 2:return this.consumeSimpleBlock(o.type);case 19:return this.consumeFunction(o)}return o},a.prototype.consumeSimpleBlock=function(o){for(var c={type:o,values:[]},d=this.consumeToken();;){if(d.type===32||DAe(d,o))return c;this.reconsumeToken(d),c.values.push(this.consumeComponentValue()),d=this.consumeToken()}},a.prototype.consumeFunction=function(o){for(var c={name:o.value,values:[],type:18};;){var d=this.consumeToken();if(d.type===32||d.type===3)return c;this.reconsumeToken(d),c.values.push(this.consumeComponentValue())}},a.prototype.consumeToken=function(){var o=this._tokens.shift();return typeof o>"u"?NR:o},a.prototype.reconsumeToken=function(o){this._tokens.unshift(o)},a}(),px=function(a){return a.type===15},Og=function(a){return a.type===17},En=function(a){return a.type===20},kAe=function(a){return a.type===0},TR=function(a,o){return En(a)&&a.value===o},HH=function(a){return a.type!==31},Eg=function(a){return a.type!==31&&a.type!==4},Jd=function(a){var o=[],c=[];return a.forEach(function(d){if(d.type===4){if(c.length===0)throw new Error("Error parsing function args, zero tokens for arg");o.push(c),c=[];return}d.type!==31&&c.push(d)}),c.length&&o.push(c),o},DAe=function(a,o){return o===11&&a.type===12||o===28&&a.type===29?!0:o===2&&a.type===3},Ah=function(a){return a.type===17||a.type===15},qi=function(a){return a.type===16||Ah(a)},GH=function(a){return a.length>1?[a[0],a[1]]:[a[0]]},Pa={type:17,number:0,flags:hx},AI={type:16,number:50,flags:hx},rh={type:16,number:100,flags:hx},jb=function(a,o,c){var d=a[0],h=a[1];return[jn(d,o),jn(typeof h<"u"?h:d,c)]},jn=function(a,o){if(a.type===16)return a.number/100*o;if(px(a))switch(a.unit){case"rem":case"em":return 16*a.number;case"px":default:return a.number}return a.number},KH="deg",WH="grad",zH="rad",qH="turn",gE={name:"angle",parse:function(a,o){if(o.type===15)switch(o.unit){case KH:return Math.PI*o.number/180;case WH:return Math.PI/200*o.number;case zH:return o.number;case qH:return Math.PI*2*o.number}throw new Error("Unsupported angle type")}},YH=function(a){return a.type===15&&(a.unit===KH||a.unit===WH||a.unit===zH||a.unit===qH)},XH=function(a){var o=a.filter(En).map(function(c){return c.value}).join(" ");switch(o){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Pa,Pa];case"to top":case"bottom":return al(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Pa,rh];case"to right":case"left":return al(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[rh,rh];case"to bottom":case"top":return al(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[rh,Pa];case"to left":case"right":return al(270)}return 0},al=function(a){return Math.PI*a/180},oh={name:"color",parse:function(a,o){if(o.type===18){var c=BAe[o.name];if(typeof c>"u")throw new Error('Attempting to parse an unsupported color function "'+o.name+'"');return c(a,o.values)}if(o.type===5){if(o.value.length===3){var d=o.value.substring(0,1),h=o.value.substring(1,2),m=o.value.substring(2,3);return nh(parseInt(d+d,16),parseInt(h+h,16),parseInt(m+m,16),1)}if(o.value.length===4){var d=o.value.substring(0,1),h=o.value.substring(1,2),m=o.value.substring(2,3),g=o.value.substring(3,4);return nh(parseInt(d+d,16),parseInt(h+h,16),parseInt(m+m,16),parseInt(g+g,16)/255)}if(o.value.length===6){var d=o.value.substring(0,2),h=o.value.substring(2,4),m=o.value.substring(4,6);return nh(parseInt(d,16),parseInt(h,16),parseInt(m,16),1)}if(o.value.length===8){var d=o.value.substring(0,2),h=o.value.substring(2,4),m=o.value.substring(4,6),g=o.value.substring(6,8);return nh(parseInt(d,16),parseInt(h,16),parseInt(m,16),parseInt(g,16)/255)}}if(o.type===20){var x=KA[o.value.toUpperCase()];if(typeof x<"u")return x}return KA.TRANSPARENT}},ch=function(a){return(255&a)===0},ba=function(a){var o=255&a,c=255&a>>8,d=255&a>>16,h=255&a>>24;return o<255?"rgba("+h+","+d+","+c+","+o/255+")":"rgb("+h+","+d+","+c+")"},nh=function(a,o,c,d){return(a<<24|o<<16|c<<8|Math.round(d*255)<<0)>>>0},t8=function(a,o){if(a.type===17)return a.number;if(a.type===16){var c=o===3?1:255;return o===3?a.number/100*c:Math.round(a.number/100*c)}return 0},s8=function(a,o){var c=o.filter(Eg);if(c.length===3){var d=c.map(t8),h=d[0],m=d[1],g=d[2];return nh(h,m,g,1)}if(c.length===4){var x=c.map(t8),h=x[0],m=x[1],g=x[2],v=x[3];return nh(h,m,g,v)}return 0};function iT(a,o,c){return c<0&&(c+=1),c>=1&&(c-=1),c<1/6?(o-a)*c*6+a:c<1/2?o:c<2/3?(o-a)*6*(2/3-c)+a:a}var r8=function(a,o){var c=o.filter(Eg),d=c[0],h=c[1],m=c[2],g=c[3],x=(d.type===17?al(d.number):gE.parse(a,d))/(Math.PI*2),v=qi(h)?h.number/100:0,E=qi(m)?m.number/100:0,S=typeof g<"u"&&qi(g)?jn(g,1):1;if(v===0)return nh(E*255,E*255,E*255,1);var I=E<=.5?E*(v+1):E+v-E*v,k=E*2-I,R=iT(k,I,x+1/3),O=iT(k,I,x),F=iT(k,I,x-1/3);return nh(R*255,O*255,F*255,S)},BAe={hsl:r8,hsla:r8,rgb:s8,rgba:s8},Vb=function(a,o){return oh.parse(a,QH.create(o).parseComponentValue())},KA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},LAe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(a,o){return o.map(function(c){if(En(c))switch(c.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},jAe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},bE=function(a,o){var c=oh.parse(a,o[0]),d=o[1];return d&&qi(d)?{color:c,stop:d}:{color:c,stop:null}},n8=function(a,o){var c=a[0],d=a[a.length-1];c.stop===null&&(c.stop=Pa),d.stop===null&&(d.stop=rh);for(var h=[],m=0,g=0;g<a.length;g++){var x=a[g].stop;if(x!==null){var v=jn(x,o);v>m?h.push(v):h.push(m),m=v}else h.push(null)}for(var E=null,g=0;g<h.length;g++){var S=h[g];if(S===null)E===null&&(E=g);else if(E!==null){for(var I=g-E,k=h[E-1],R=(S-k)/(I+1),O=1;O<=I;O++)h[E+O-1]=R*O;E=null}}return a.map(function(F,M){var Q=F.color;return{color:Q,stop:Math.max(Math.min(1,h[M]/o),0)}})},PAe=function(a,o,c){var d=o/2,h=c/2,m=jn(a[0],o)-d,g=h-jn(a[1],c);return(Math.atan2(g,m)+Math.PI*2)%(Math.PI*2)},UAe=function(a,o,c){var d=typeof a=="number"?a:PAe(a,o,c),h=Math.abs(o*Math.sin(d))+Math.abs(c*Math.cos(d)),m=o/2,g=c/2,x=h/2,v=Math.sin(d-Math.PI/2)*x,E=Math.cos(d-Math.PI/2)*x;return[h,m-E,m+E,g-v,g+v]},Xl=function(a,o){return Math.sqrt(a*a+o*o)},i8=function(a,o,c,d,h){var m=[[0,0],[0,o],[a,0],[a,o]];return m.reduce(function(g,x){var v=x[0],E=x[1],S=Xl(c-v,d-E);return(h?S<g.optimumDistance:S>g.optimumDistance)?{optimumCorner:x,optimumDistance:S}:g},{optimumDistance:h?1/0:-1/0,optimumCorner:null}).optimumCorner},FAe=function(a,o,c,d,h){var m=0,g=0;switch(a.size){case 0:a.shape===0?m=g=Math.min(Math.abs(o),Math.abs(o-d),Math.abs(c),Math.abs(c-h)):a.shape===1&&(m=Math.min(Math.abs(o),Math.abs(o-d)),g=Math.min(Math.abs(c),Math.abs(c-h)));break;case 2:if(a.shape===0)m=g=Math.min(Xl(o,c),Xl(o,c-h),Xl(o-d,c),Xl(o-d,c-h));else if(a.shape===1){var x=Math.min(Math.abs(c),Math.abs(c-h))/Math.min(Math.abs(o),Math.abs(o-d)),v=i8(d,h,o,c,!0),E=v[0],S=v[1];m=Xl(E-o,(S-c)/x),g=x*m}break;case 1:a.shape===0?m=g=Math.max(Math.abs(o),Math.abs(o-d),Math.abs(c),Math.abs(c-h)):a.shape===1&&(m=Math.max(Math.abs(o),Math.abs(o-d)),g=Math.max(Math.abs(c),Math.abs(c-h)));break;case 3:if(a.shape===0)m=g=Math.max(Xl(o,c),Xl(o,c-h),Xl(o-d,c),Xl(o-d,c-h));else if(a.shape===1){var x=Math.max(Math.abs(c),Math.abs(c-h))/Math.max(Math.abs(o),Math.abs(o-d)),I=i8(d,h,o,c,!1),E=I[0],S=I[1];m=Xl(E-o,(S-c)/x),g=x*m}break}return Array.isArray(a.size)&&(m=jn(a.size[0],d),g=a.size.length===2?jn(a.size[1],h):m),[m,g]},MAe=function(a,o){var c=al(180),d=[];return Jd(o).forEach(function(h,m){if(m===0){var g=h[0];if(g.type===20&&g.value==="to"){c=XH(h);return}else if(YH(g)){c=gE.parse(a,g);return}}var x=bE(a,h);d.push(x)}),{angle:c,stops:d,type:1}},Z_=function(a,o){var c=al(180),d=[];return Jd(o).forEach(function(h,m){if(m===0){var g=h[0];if(g.type===20&&["top","left","right","bottom"].indexOf(g.value)!==-1){c=XH(h);return}else if(YH(g)){c=(gE.parse(a,g)+al(270))%al(360);return}}var x=bE(a,h);d.push(x)}),{angle:c,stops:d,type:1}},VAe=function(a,o){var c=al(180),d=[],h=1,m=0,g=3,x=[];return Jd(o).forEach(function(v,E){var S=v[0];if(E===0){if(En(S)&&S.value==="linear"){h=1;return}else if(En(S)&&S.value==="radial"){h=2;return}}if(S.type===18){if(S.name==="from"){var I=oh.parse(a,S.values[0]);d.push({stop:Pa,color:I})}else if(S.name==="to"){var I=oh.parse(a,S.values[0]);d.push({stop:rh,color:I})}else if(S.name==="color-stop"){var k=S.values.filter(Eg);if(k.length===2){var I=oh.parse(a,k[1]),R=k[0];Og(R)&&d.push({stop:{type:16,number:R.number*100,flags:R.flags},color:I})}}}}),h===1?{angle:(c+al(180))%al(360),stops:d,type:h}:{size:g,shape:m,stops:d,position:x,type:h}},JH="closest-side",$H="farthest-side",ZH="closest-corner",e7="farthest-corner",t7="circle",s7="ellipse",r7="cover",n7="contain",QAe=function(a,o){var c=0,d=3,h=[],m=[];return Jd(o).forEach(function(g,x){var v=!0;if(x===0){var E=!1;v=g.reduce(function(I,k){if(E)if(En(k))switch(k.value){case"center":return m.push(AI),I;case"top":case"left":return m.push(Pa),I;case"right":case"bottom":return m.push(rh),I}else(qi(k)||Ah(k))&&m.push(k);else if(En(k))switch(k.value){case t7:return c=0,!1;case s7:return c=1,!1;case"at":return E=!0,!1;case JH:return d=0,!1;case r7:case $H:return d=1,!1;case n7:case ZH:return d=2,!1;case e7:return d=3,!1}else if(Ah(k)||qi(k))return Array.isArray(d)||(d=[]),d.push(k),!1;return I},v)}if(v){var S=bE(a,g);h.push(S)}}),{size:d,shape:c,stops:h,position:m,type:2}},ey=function(a,o){var c=0,d=3,h=[],m=[];return Jd(o).forEach(function(g,x){var v=!0;if(x===0?v=g.reduce(function(S,I){if(En(I))switch(I.value){case"center":return m.push(AI),!1;case"top":case"left":return m.push(Pa),!1;case"right":case"bottom":return m.push(rh),!1}else if(qi(I)||Ah(I))return m.push(I),!1;return S},v):x===1&&(v=g.reduce(function(S,I){if(En(I))switch(I.value){case t7:return c=0,!1;case s7:return c=1,!1;case n7:case JH:return d=0,!1;case $H:return d=1,!1;case ZH:return d=2,!1;case r7:case e7:return d=3,!1}else if(Ah(I)||qi(I))return Array.isArray(d)||(d=[]),d.push(I),!1;return S},v)),v){var E=bE(a,g);h.push(E)}}),{size:d,shape:c,stops:h,position:m,type:2}},HAe=function(a){return a.type===1},GAe=function(a){return a.type===2},uI={name:"image",parse:function(a,o){if(o.type===22){var c={url:o.value,type:0};return a.cache.addImage(o.value),c}if(o.type===18){var d=i7[o.name];if(typeof d>"u")throw new Error('Attempting to parse an unsupported image function "'+o.name+'"');return d(a,o.values)}throw new Error("Unsupported image type "+o.type)}};function KAe(a){return!(a.type===20&&a.value==="none")&&(a.type!==18||!!i7[a.name])}var i7={"linear-gradient":MAe,"-moz-linear-gradient":Z_,"-ms-linear-gradient":Z_,"-o-linear-gradient":Z_,"-webkit-linear-gradient":Z_,"radial-gradient":QAe,"-moz-radial-gradient":ey,"-ms-radial-gradient":ey,"-o-radial-gradient":ey,"-webkit-radial-gradient":ey,"-webkit-gradient":VAe},WAe={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(a,o){if(o.length===0)return[];var c=o[0];return c.type===20&&c.value==="none"?[]:o.filter(function(d){return Eg(d)&&KAe(d)}).map(function(d){return uI.parse(a,d)})}},zAe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(a,o){return o.map(function(c){if(En(c))switch(c.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},qAe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(a,o){return Jd(o).map(function(c){return c.filter(qi)}).map(GH)}},YAe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(a,o){return Jd(o).map(function(c){return c.filter(En).map(function(d){return d.value}).join(" ")}).map(XAe)}},XAe=function(a){switch(a){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},fg;(function(a){a.AUTO="auto",a.CONTAIN="contain",a.COVER="cover"})(fg||(fg={}));var JAe={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(a,o){return Jd(o).map(function(c){return c.filter($Ae)})}},$Ae=function(a){return En(a)||qi(a)},xE=function(a){return{name:"border-"+a+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},ZAe=xE("top"),eue=xE("right"),tue=xE("bottom"),sue=xE("left"),vE=function(a){return{name:"border-radius-"+a,initialValue:"0 0",prefix:!1,type:1,parse:function(o,c){return GH(c.filter(qi))}}},rue=vE("top-left"),nue=vE("top-right"),iue=vE("bottom-right"),aue=vE("bottom-left"),wE=function(a){return{name:"border-"+a+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(o,c){switch(c){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},oue=wE("top"),cue=wE("right"),lue=wE("bottom"),due=wE("left"),_E=function(a){return{name:"border-"+a+"-width",initialValue:"0",type:0,prefix:!1,parse:function(o,c){return px(c)?c.number:0}}},Aue=_E("top"),uue=_E("right"),hue=_E("bottom"),pue=_E("left"),mue={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fue={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(a,o){switch(o){case"rtl":return 1;case"ltr":default:return 0}}},gue={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(a,o){return o.filter(En).reduce(function(c,d){return c|bue(d.value)},0)}},bue=function(a){switch(a){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},xue={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(a,o){switch(o){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},vue={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(a,o){return o.type===20&&o.value==="normal"?0:o.type===17||o.type===15?o.number:0}},Vy;(function(a){a.NORMAL="normal",a.STRICT="strict"})(Vy||(Vy={}));var wue={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(a,o){switch(o){case"strict":return Vy.STRICT;case"normal":default:return Vy.NORMAL}}},_ue={name:"line-height",initialValue:"normal",prefix:!1,type:4},a8=function(a,o){return En(a)&&a.value==="normal"?1.2*o:a.type===17?o*a.number:qi(a)?jn(a,o):o},yue={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(a,o){return o.type===20&&o.value==="none"?null:uI.parse(a,o)}},Eue={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(a,o){switch(o){case"inside":return 0;case"outside":default:return 1}}},RR={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(a,o){switch(o){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},yE=function(a){return{name:"margin-"+a,initialValue:"0",prefix:!1,type:4}},Sue=yE("top"),Cue=yE("right"),Nue=yE("bottom"),Tue=yE("left"),Rue={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(a,o){return o.filter(En).map(function(c){switch(c.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Iue={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(a,o){switch(o){case"break-word":return"break-word";case"normal":default:return"normal"}}},EE=function(a){return{name:"padding-"+a,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Oue=EE("top"),kue=EE("right"),Due=EE("bottom"),Bue=EE("left"),Lue={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(a,o){switch(o){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},jue={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(a,o){switch(o){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Pue={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(a,o){return o.length===1&&TR(o[0],"none")?[]:Jd(o).map(function(c){for(var d={color:KA.TRANSPARENT,offsetX:Pa,offsetY:Pa,blur:Pa},h=0,m=0;m<c.length;m++){var g=c[m];Ah(g)?(h===0?d.offsetX=g:h===1?d.offsetY=g:d.blur=g,h++):d.color=oh.parse(a,g)}return d})}},Uue={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(a,o){switch(o){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Fue={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(a,o){if(o.type===20&&o.value==="none")return null;if(o.type===18){var c=Que[o.name];if(typeof c>"u")throw new Error('Attempting to parse an unsupported transform function "'+o.name+'"');return c(o.values)}return null}},Mue=function(a){var o=a.filter(function(c){return c.type===17}).map(function(c){return c.number});return o.length===6?o:null},Vue=function(a){var o=a.filter(function(v){return v.type===17}).map(function(v){return v.number}),c=o[0],d=o[1];o[2],o[3];var h=o[4],m=o[5];o[6],o[7],o[8],o[9],o[10],o[11];var g=o[12],x=o[13];return o[14],o[15],o.length===16?[c,d,h,m,g,x]:null},Que={matrix:Mue,matrix3d:Vue},o8={type:16,number:50,flags:hx},Hue=[o8,o8],Gue={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(a,o){var c=o.filter(qi);return c.length!==2?Hue:[c[0],c[1]]}},Kue={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(a,o){switch(o){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Qb;(function(a){a.NORMAL="normal",a.BREAK_ALL="break-all",a.KEEP_ALL="keep-all"})(Qb||(Qb={}));var Wue={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(a,o){switch(o){case"break-all":return Qb.BREAK_ALL;case"keep-all":return Qb.KEEP_ALL;case"normal":default:return Qb.NORMAL}}},zue={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(a,o){if(o.type===20)return{auto:!0,order:0};if(Og(o))return{auto:!1,order:o.number};throw new Error("Invalid z-index number parsed")}},a7={name:"time",parse:function(a,o){if(o.type===15)switch(o.unit.toLowerCase()){case"s":return 1e3*o.number;case"ms":return o.number}throw new Error("Unsupported time type")}},que={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(a,o){return Og(o)?o.number:1}},Yue={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Xue={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(a,o){return o.filter(En).map(function(c){switch(c.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(c){return c!==0})}},Jue={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(a,o){var c=[],d=[];return o.forEach(function(h){switch(h.type){case 20:case 0:c.push(h.value);break;case 17:c.push(h.number.toString());break;case 4:d.push(c.join(" ")),c.length=0;break}}),c.length&&d.push(c.join(" ")),d.map(function(h){return h.indexOf(" ")===-1?h:"'"+h+"'"})}},$ue={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},Zue={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(a,o){if(Og(o))return o.number;if(En(o))switch(o.value){case"bold":return 700;case"normal":default:return 400}return 400}},ehe={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(a,o){return o.filter(En).map(function(c){return c.value})}},the={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(a,o){switch(o){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},ia=function(a,o){return(a&o)!==0},she={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(a,o){if(o.length===0)return[];var c=o[0];return c.type===20&&c.value==="none"?[]:o}},rhe={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(a,o){if(o.length===0)return null;var c=o[0];if(c.type===20&&c.value==="none")return null;for(var d=[],h=o.filter(HH),m=0;m<h.length;m++){var g=h[m],x=h[m+1];if(g.type===20){var v=x&&Og(x)?x.number:1;d.push({counter:g.value,increment:v})}}return d}},nhe={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(a,o){if(o.length===0)return[];for(var c=[],d=o.filter(HH),h=0;h<d.length;h++){var m=d[h],g=d[h+1];if(En(m)&&m.value!=="none"){var x=g&&Og(g)?g.number:0;c.push({counter:m.value,reset:x})}}return c}},ihe={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(a,o){return o.filter(px).map(function(c){return a7.parse(a,c)})}},ahe={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(a,o){if(o.length===0)return null;var c=o[0];if(c.type===20&&c.value==="none")return null;var d=[],h=o.filter(kAe);if(h.length%2!==0)return null;for(var m=0;m<h.length;m+=2){var g=h[m].value,x=h[m+1].value;d.push({open:g,close:x})}return d}},c8=function(a,o,c){if(!a)return"";var d=a[Math.min(o,a.length-1)];return d?c?d.open:d.close:""},ohe={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(a,o){return o.length===1&&TR(o[0],"none")?[]:Jd(o).map(function(c){for(var d={color:255,offsetX:Pa,offsetY:Pa,blur:Pa,spread:Pa,inset:!1},h=0,m=0;m<c.length;m++){var g=c[m];TR(g,"inset")?d.inset=!0:Ah(g)?(h===0?d.offsetX=g:h===1?d.offsetY=g:h===2?d.blur=g:d.spread=g,h++):d.color=oh.parse(a,g)}return d})}},che={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(a,o){var c=[0,1,2],d=[];return o.filter(En).forEach(function(h){switch(h.value){case"stroke":d.push(1);break;case"fill":d.push(0);break;case"markers":d.push(2);break}}),c.forEach(function(h){d.indexOf(h)===-1&&d.push(h)}),d}},lhe={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},dhe={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(a,o){return px(o)?o.number:0}},Ahe=function(){function a(o,c){var d,h;this.animationDuration=gs(o,ihe,c.animationDuration),this.backgroundClip=gs(o,LAe,c.backgroundClip),this.backgroundColor=gs(o,jAe,c.backgroundColor),this.backgroundImage=gs(o,WAe,c.backgroundImage),this.backgroundOrigin=gs(o,zAe,c.backgroundOrigin),this.backgroundPosition=gs(o,qAe,c.backgroundPosition),this.backgroundRepeat=gs(o,YAe,c.backgroundRepeat),this.backgroundSize=gs(o,JAe,c.backgroundSize),this.borderTopColor=gs(o,ZAe,c.borderTopColor),this.borderRightColor=gs(o,eue,c.borderRightColor),this.borderBottomColor=gs(o,tue,c.borderBottomColor),this.borderLeftColor=gs(o,sue,c.borderLeftColor),this.borderTopLeftRadius=gs(o,rue,c.borderTopLeftRadius),this.borderTopRightRadius=gs(o,nue,c.borderTopRightRadius),this.borderBottomRightRadius=gs(o,iue,c.borderBottomRightRadius),this.borderBottomLeftRadius=gs(o,aue,c.borderBottomLeftRadius),this.borderTopStyle=gs(o,oue,c.borderTopStyle),this.borderRightStyle=gs(o,cue,c.borderRightStyle),this.borderBottomStyle=gs(o,lue,c.borderBottomStyle),this.borderLeftStyle=gs(o,due,c.borderLeftStyle),this.borderTopWidth=gs(o,Aue,c.borderTopWidth),this.borderRightWidth=gs(o,uue,c.borderRightWidth),this.borderBottomWidth=gs(o,hue,c.borderBottomWidth),this.borderLeftWidth=gs(o,pue,c.borderLeftWidth),this.boxShadow=gs(o,ohe,c.boxShadow),this.color=gs(o,mue,c.color),this.direction=gs(o,fue,c.direction),this.display=gs(o,gue,c.display),this.float=gs(o,xue,c.cssFloat),this.fontFamily=gs(o,Jue,c.fontFamily),this.fontSize=gs(o,$ue,c.fontSize),this.fontStyle=gs(o,the,c.fontStyle),this.fontVariant=gs(o,ehe,c.fontVariant),this.fontWeight=gs(o,Zue,c.fontWeight),this.letterSpacing=gs(o,vue,c.letterSpacing),this.lineBreak=gs(o,wue,c.lineBreak),this.lineHeight=gs(o,_ue,c.lineHeight),this.listStyleImage=gs(o,yue,c.listStyleImage),this.listStylePosition=gs(o,Eue,c.listStylePosition),this.listStyleType=gs(o,RR,c.listStyleType),this.marginTop=gs(o,Sue,c.marginTop),this.marginRight=gs(o,Cue,c.marginRight),this.marginBottom=gs(o,Nue,c.marginBottom),this.marginLeft=gs(o,Tue,c.marginLeft),this.opacity=gs(o,que,c.opacity);var m=gs(o,Rue,c.overflow);this.overflowX=m[0],this.overflowY=m[m.length>1?1:0],this.overflowWrap=gs(o,Iue,c.overflowWrap),this.paddingTop=gs(o,Oue,c.paddingTop),this.paddingRight=gs(o,kue,c.paddingRight),this.paddingBottom=gs(o,Due,c.paddingBottom),this.paddingLeft=gs(o,Bue,c.paddingLeft),this.paintOrder=gs(o,che,c.paintOrder),this.position=gs(o,jue,c.position),this.textAlign=gs(o,Lue,c.textAlign),this.textDecorationColor=gs(o,Yue,(d=c.textDecorationColor)!==null&&d!==void 0?d:c.color),this.textDecorationLine=gs(o,Xue,(h=c.textDecorationLine)!==null&&h!==void 0?h:c.textDecoration),this.textShadow=gs(o,Pue,c.textShadow),this.textTransform=gs(o,Uue,c.textTransform),this.transform=gs(o,Fue,c.transform),this.transformOrigin=gs(o,Gue,c.transformOrigin),this.visibility=gs(o,Kue,c.visibility),this.webkitTextStrokeColor=gs(o,lhe,c.webkitTextStrokeColor),this.webkitTextStrokeWidth=gs(o,dhe,c.webkitTextStrokeWidth),this.wordBreak=gs(o,Wue,c.wordBreak),this.zIndex=gs(o,zue,c.zIndex)}return a.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},a.prototype.isTransparent=function(){return ch(this.backgroundColor)},a.prototype.isTransformed=function(){return this.transform!==null},a.prototype.isPositioned=function(){return this.position!==0},a.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},a.prototype.isFloating=function(){return this.float!==0},a.prototype.isInlineLevel=function(){return ia(this.display,4)||ia(this.display,33554432)||ia(this.display,268435456)||ia(this.display,536870912)||ia(this.display,67108864)||ia(this.display,134217728)},a}(),uhe=function(){function a(o,c){this.content=gs(o,she,c.content),this.quotes=gs(o,ahe,c.quotes)}return a}(),l8=function(){function a(o,c){this.counterIncrement=gs(o,rhe,c.counterIncrement),this.counterReset=gs(o,nhe,c.counterReset)}return a}(),gs=function(a,o,c){var d=new VH,h=c!==null&&typeof c<"u"?c.toString():o.initialValue;d.write(h);var m=new QH(d.read());switch(o.type){case 2:var g=m.parseComponentValue();return o.parse(a,En(g)?g.value:o.initialValue);case 0:return o.parse(a,m.parseComponentValue());case 1:return o.parse(a,m.parseComponentValues());case 4:return m.parseComponentValue();case 3:switch(o.format){case"angle":return gE.parse(a,m.parseComponentValue());case"color":return oh.parse(a,m.parseComponentValue());case"image":return uI.parse(a,m.parseComponentValue());case"length":var x=m.parseComponentValue();return Ah(x)?x:Pa;case"length-percentage":var v=m.parseComponentValue();return qi(v)?v:Pa;case"time":return a7.parse(a,m.parseComponentValue())}break}},hhe="data-html2canvas-debug",phe=function(a){var o=a.getAttribute(hhe);switch(o){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},IR=function(a,o){var c=phe(a);return c===1||o===c},$d=function(){function a(o,c){if(this.context=o,this.textNodes=[],this.elements=[],this.flags=0,IR(c,3))debugger;this.styles=new Ahe(o,window.getComputedStyle(c,null)),DR(c)&&(this.styles.animationDuration.some(function(d){return d>0})&&(c.style.animationDuration="0s"),this.styles.transform!==null&&(c.style.transform="none")),this.bounds=mE(this.context,c),IR(c,4)&&(this.flags|=16)}return a}(),mhe="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",d8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pb=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ty=0;ty<d8.length;ty++)Pb[d8.charCodeAt(ty)]=ty;var fhe=function(a){var o=a.length*.75,c=a.length,d,h=0,m,g,x,v;a[a.length-1]==="="&&(o--,a[a.length-2]==="="&&o--);var E=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(o):new Array(o),S=Array.isArray(E)?E:new Uint8Array(E);for(d=0;d<c;d+=4)m=Pb[a.charCodeAt(d)],g=Pb[a.charCodeAt(d+1)],x=Pb[a.charCodeAt(d+2)],v=Pb[a.charCodeAt(d+3)],S[h++]=m<<2|g>>4,S[h++]=(g&15)<<4|x>>2,S[h++]=(x&3)<<6|v&63;return E},ghe=function(a){for(var o=a.length,c=[],d=0;d<o;d+=2)c.push(a[d+1]<<8|a[d]);return c},bhe=function(a){for(var o=a.length,c=[],d=0;d<o;d+=4)c.push(a[d+3]<<24|a[d+2]<<16|a[d+1]<<8|a[d]);return c},qp=5,hI=11,aT=2,xhe=hI-qp,o7=65536>>qp,vhe=1<<qp,oT=vhe-1,whe=1024>>qp,_he=o7+whe,yhe=_he,Ehe=32,She=yhe+Ehe,Che=65536>>hI,Nhe=1<<xhe,The=Nhe-1,A8=function(a,o,c){return a.slice?a.slice(o,c):new Uint16Array(Array.prototype.slice.call(a,o,c))},Rhe=function(a,o,c){return a.slice?a.slice(o,c):new Uint32Array(Array.prototype.slice.call(a,o,c))},Ihe=function(a,o){var c=fhe(a),d=Array.isArray(c)?bhe(c):new Uint32Array(c),h=Array.isArray(c)?ghe(c):new Uint16Array(c),m=24,g=A8(h,m/2,d[4]/2),x=d[5]===2?A8(h,(m+d[4])/2):Rhe(d,Math.ceil((m+d[4])/4));return new Ohe(d[0],d[1],d[2],d[3],g,x)},Ohe=function(){function a(o,c,d,h,m,g){this.initialValue=o,this.errorValue=c,this.highStart=d,this.highValueIndex=h,this.index=m,this.data=g}return a.prototype.get=function(o){var c;if(o>=0){if(o<55296||o>56319&&o<=65535)return c=this.index[o>>qp],c=(c<<aT)+(o&oT),this.data[c];if(o<=65535)return c=this.index[o7+(o-55296>>qp)],c=(c<<aT)+(o&oT),this.data[c];if(o<this.highStart)return c=She-Che+(o>>hI),c=this.index[c],c+=o>>qp&The,c=this.index[c],c=(c<<aT)+(o&oT),this.data[c];if(o<=1114111)return this.data[this.highValueIndex]}return this.errorValue},a}(),u8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",khe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var sy=0;sy<u8.length;sy++)khe[u8.charCodeAt(sy)]=sy;var Dhe=1,cT=2,lT=3,h8=4,p8=5,Bhe=7,m8=8,dT=9,AT=10,f8=11,g8=12,b8=13,x8=14,uT=15,Lhe=function(a){for(var o=[],c=0,d=a.length;c<d;){var h=a.charCodeAt(c++);if(h>=55296&&h<=56319&&c<d){var m=a.charCodeAt(c++);(m&64512)===56320?o.push(((h&1023)<<10)+(m&1023)+65536):(o.push(h),c--)}else o.push(h)}return o},jhe=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];if(String.fromCodePoint)return String.fromCodePoint.apply(String,a);var c=a.length;if(!c)return"";for(var d=[],h=-1,m="";++h<c;){var g=a[h];g<=65535?d.push(g):(g-=65536,d.push((g>>10)+55296,g%1024+56320)),(h+1===c||d.length>16384)&&(m+=String.fromCharCode.apply(String,d),d.length=0)}return m},Phe=Ihe(mhe),sl="",hT="",Uhe=function(a){return Phe.get(a)},Fhe=function(a,o,c){var d=c-2,h=o[d],m=o[c-1],g=o[c];if(m===cT&&g===lT)return sl;if(m===cT||m===lT||m===h8||g===cT||g===lT||g===h8)return hT;if(m===m8&&[m8,dT,f8,g8].indexOf(g)!==-1||(m===f8||m===dT)&&(g===dT||g===AT)||(m===g8||m===AT)&&g===AT||g===b8||g===p8||g===Bhe||m===Dhe)return sl;if(m===b8&&g===x8){for(;h===p8;)h=o[--d];if(h===x8)return sl}if(m===uT&&g===uT){for(var x=0;h===uT;)x++,h=o[--d];if(x%2===0)return sl}return hT},Mhe=function(a){var o=Lhe(a),c=o.length,d=0,h=0,m=o.map(Uhe);return{next:function(){if(d>=c)return{done:!0,value:null};for(var g=sl;d<c&&(g=Fhe(o,m,++d))===sl;);if(g!==sl||d===c){var x=jhe.apply(null,o.slice(h,d));return h=d,{value:x,done:!1}}return{done:!0,value:null}}}},Vhe=function(a){for(var o=Mhe(a),c=[],d;!(d=o.next()).done;)d.value&&c.push(d.value.slice());return c},Qhe=function(a){var o=123;if(a.createRange){var c=a.createRange();if(c.getBoundingClientRect){var d=a.createElement("boundtest");d.style.height=o+"px",d.style.display="block",a.body.appendChild(d),c.selectNode(d);var h=c.getBoundingClientRect(),m=Math.round(h.height);if(a.body.removeChild(d),m===o)return!0}}return!1},Hhe=function(a){var o=a.createElement("boundtest");o.style.width="50px",o.style.display="block",o.style.fontSize="12px",o.style.letterSpacing="0px",o.style.wordSpacing="0px",a.body.appendChild(o);var c=a.createRange();o.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var d=o.firstChild,h=fE(d.data).map(function(v){return Pi(v)}),m=0,g={},x=h.every(function(v,E){c.setStart(d,m),c.setEnd(d,m+v.length);var S=c.getBoundingClientRect();m+=v.length;var I=S.x>g.x||S.y>g.y;return g=S,E===0?!0:I});return a.body.removeChild(o),x},Ghe=function(){return typeof new Image().crossOrigin<"u"},Khe=function(){return typeof new XMLHttpRequest().responseType=="string"},Whe=function(a){var o=new Image,c=a.createElement("canvas"),d=c.getContext("2d");if(!d)return!1;o.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{d.drawImage(o,0,0),c.toDataURL()}catch{return!1}return!0},v8=function(a){return a[0]===0&&a[1]===255&&a[2]===0&&a[3]===255},zhe=function(a){var o=a.createElement("canvas"),c=100;o.width=c,o.height=c;var d=o.getContext("2d");if(!d)return Promise.reject(!1);d.fillStyle="rgb(0, 255, 0)",d.fillRect(0,0,c,c);var h=new Image,m=o.toDataURL();h.src=m;var g=OR(c,c,0,0,h);return d.fillStyle="red",d.fillRect(0,0,c,c),w8(g).then(function(x){d.drawImage(x,0,0);var v=d.getImageData(0,0,c,c).data;d.fillStyle="red",d.fillRect(0,0,c,c);var E=a.createElement("div");return E.style.backgroundImage="url("+m+")",E.style.height=c+"px",v8(v)?w8(OR(c,c,0,0,E)):Promise.reject(!1)}).then(function(x){return d.drawImage(x,0,0),v8(d.getImageData(0,0,c,c).data)}).catch(function(){return!1})},OR=function(a,o,c,d,h){var m="http://www.w3.org/2000/svg",g=document.createElementNS(m,"svg"),x=document.createElementNS(m,"foreignObject");return g.setAttributeNS(null,"width",a.toString()),g.setAttributeNS(null,"height",o.toString()),x.setAttributeNS(null,"width","100%"),x.setAttributeNS(null,"height","100%"),x.setAttributeNS(null,"x",c.toString()),x.setAttributeNS(null,"y",d.toString()),x.setAttributeNS(null,"externalResourcesRequired","true"),g.appendChild(x),x.appendChild(h),g},w8=function(a){return new Promise(function(o,c){var d=new Image;d.onload=function(){return o(d)},d.onerror=c,d.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(a))})},ja={get SUPPORT_RANGE_BOUNDS(){var a=Qhe(document);return Object.defineProperty(ja,"SUPPORT_RANGE_BOUNDS",{value:a}),a},get SUPPORT_WORD_BREAKING(){var a=ja.SUPPORT_RANGE_BOUNDS&&Hhe(document);return Object.defineProperty(ja,"SUPPORT_WORD_BREAKING",{value:a}),a},get SUPPORT_SVG_DRAWING(){var a=Whe(document);return Object.defineProperty(ja,"SUPPORT_SVG_DRAWING",{value:a}),a},get SUPPORT_FOREIGNOBJECT_DRAWING(){var a=typeof Array.from=="function"&&typeof window.fetch=="function"?zhe(document):Promise.resolve(!1);return Object.defineProperty(ja,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:a}),a},get SUPPORT_CORS_IMAGES(){var a=Ghe();return Object.defineProperty(ja,"SUPPORT_CORS_IMAGES",{value:a}),a},get SUPPORT_RESPONSE_TYPE(){var a=Khe();return Object.defineProperty(ja,"SUPPORT_RESPONSE_TYPE",{value:a}),a},get SUPPORT_CORS_XHR(){var a="withCredentials"in new XMLHttpRequest;return Object.defineProperty(ja,"SUPPORT_CORS_XHR",{value:a}),a},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var a=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(ja,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:a}),a}},Hb=function(){function a(o,c){this.text=o,this.bounds=c}return a}(),qhe=function(a,o,c,d){var h=Jhe(o,c),m=[],g=0;return h.forEach(function(x){if(c.textDecorationLine.length||x.trim().length>0)if(ja.SUPPORT_RANGE_BOUNDS){var v=_8(d,g,x.length).getClientRects();if(v.length>1){var E=pI(x),S=0;E.forEach(function(k){m.push(new Hb(k,YA.fromDOMRectList(a,_8(d,S+g,k.length).getClientRects()))),S+=k.length})}else m.push(new Hb(x,YA.fromDOMRectList(a,v)))}else{var I=d.splitText(x.length);m.push(new Hb(x,Yhe(a,d))),d=I}else ja.SUPPORT_RANGE_BOUNDS||(d=d.splitText(x.length));g+=x.length}),m},Yhe=function(a,o){var c=o.ownerDocument;if(c){var d=c.createElement("html2canvaswrapper");d.appendChild(o.cloneNode(!0));var h=o.parentNode;if(h){h.replaceChild(d,o);var m=mE(a,d);return d.firstChild&&h.replaceChild(d.firstChild,d),m}}return YA.EMPTY},_8=function(a,o,c){var d=a.ownerDocument;if(!d)throw new Error("Node has no owner document");var h=d.createRange();return h.setStart(a,o),h.setEnd(a,o+c),h},pI=function(a){if(ja.SUPPORT_NATIVE_TEXT_SEGMENTATION){var o=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(o.segment(a)).map(function(c){return c.segment})}return Vhe(a)},Xhe=function(a,o){if(ja.SUPPORT_NATIVE_TEXT_SEGMENTATION){var c=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(c.segment(a)).map(function(d){return d.segment})}return Zhe(a,o)},Jhe=function(a,o){return o.letterSpacing!==0?pI(a):Xhe(a,o)},$he=[32,160,4961,65792,65793,4153,4241],Zhe=function(a,o){for(var c=Cde(a,{lineBreak:o.lineBreak,wordBreak:o.overflowWrap==="break-word"?"break-word":o.wordBreak}),d=[],h,m=function(){if(h.value){var g=h.value.slice(),x=fE(g),v="";x.forEach(function(E){$he.indexOf(E)===-1?v+=Pi(E):(v.length&&d.push(v),d.push(Pi(E)),v="")}),v.length&&d.push(v)}};!(h=c.next()).done;)m();return d},epe=function(){function a(o,c,d){this.text=tpe(c.data,d.textTransform),this.textBounds=qhe(o,this.text,d,c)}return a}(),tpe=function(a,o){switch(o){case 1:return a.toLowerCase();case 3:return a.replace(spe,rpe);case 2:return a.toUpperCase();default:return a}},spe=/(^|\s|:|-|\(|\))([a-z])/g,rpe=function(a,o,c){return a.length>0?o+c.toUpperCase():a},c7=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.src=d.currentSrc||d.src,h.intrinsicWidth=d.naturalWidth,h.intrinsicHeight=d.naturalHeight,h.context.cache.addImage(h.src),h}return o}($d),l7=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.canvas=d,h.intrinsicWidth=d.width,h.intrinsicHeight=d.height,h}return o}($d),d7=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this,m=new XMLSerializer,g=mE(c,d);return d.setAttribute("width",g.width+"px"),d.setAttribute("height",g.height+"px"),h.svg="data:image/svg+xml,"+encodeURIComponent(m.serializeToString(d)),h.intrinsicWidth=d.width.baseVal.value,h.intrinsicHeight=d.height.baseVal.value,h.context.cache.addImage(h.svg),h}return o}($d),A7=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.value=d.value,h}return o}($d),kR=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.start=d.start,h.reversed=typeof d.reversed=="boolean"&&d.reversed===!0,h}return o}($d),npe=[{type:15,flags:0,unit:"px",number:3}],ipe=[{type:16,flags:0,number:50}],ape=function(a){return a.width>a.height?new YA(a.left+(a.width-a.height)/2,a.top,a.height,a.height):a.width<a.height?new YA(a.left,a.top+(a.height-a.width)/2,a.width,a.width):a},ope=function(a){var o=a.type===cpe?new Array(a.value.length+1).join(""):a.value;return o.length===0?a.placeholder||"":o},Qy="checkbox",Hy="radio",cpe="password",y8=707406591,mI=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;switch(h.type=d.type.toLowerCase(),h.checked=d.checked,h.value=ope(d),(h.type===Qy||h.type===Hy)&&(h.styles.backgroundColor=3739148031,h.styles.borderTopColor=h.styles.borderRightColor=h.styles.borderBottomColor=h.styles.borderLeftColor=2779096575,h.styles.borderTopWidth=h.styles.borderRightWidth=h.styles.borderBottomWidth=h.styles.borderLeftWidth=1,h.styles.borderTopStyle=h.styles.borderRightStyle=h.styles.borderBottomStyle=h.styles.borderLeftStyle=1,h.styles.backgroundClip=[0],h.styles.backgroundOrigin=[0],h.bounds=ape(h.bounds)),h.type){case Qy:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=npe;break;case Hy:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=ipe;break}return h}return o}($d),u7=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this,m=d.options[d.selectedIndex||0];return h.value=m&&m.text||"",h}return o}($d),h7=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.value=d.value,h}return o}($d),p7=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;h.src=d.src,h.width=parseInt(d.width,10)||0,h.height=parseInt(d.height,10)||0,h.backgroundColor=h.styles.backgroundColor;try{if(d.contentWindow&&d.contentWindow.document&&d.contentWindow.document.documentElement){h.tree=f7(c,d.contentWindow.document.documentElement);var m=d.contentWindow.document.documentElement?Vb(c,getComputedStyle(d.contentWindow.document.documentElement).backgroundColor):KA.TRANSPARENT,g=d.contentWindow.document.body?Vb(c,getComputedStyle(d.contentWindow.document.body).backgroundColor):KA.TRANSPARENT;h.backgroundColor=ch(m)?ch(g)?h.styles.backgroundColor:g:m}}catch{}return h}return o}($d),lpe=["OL","UL","MENU"],yy=function(a,o,c,d){for(var h=o.firstChild,m=void 0;h;h=m)if(m=h.nextSibling,g7(h)&&h.data.trim().length>0)c.textNodes.push(new epe(a,h,c.styles));else if(ug(h))if(w7(h)&&h.assignedNodes)h.assignedNodes().forEach(function(x){return yy(a,x,c,d)});else{var g=m7(a,h);g.styles.isVisible()&&(dpe(h,g,d)?g.flags|=4:Ape(g.styles)&&(g.flags|=2),lpe.indexOf(h.tagName)!==-1&&(g.flags|=8),c.elements.push(g),h.slot,h.shadowRoot?yy(a,h.shadowRoot,g,d):!Gy(h)&&!b7(h)&&!Ky(h)&&yy(a,h,g,d))}},m7=function(a,o){return BR(o)?new c7(a,o):x7(o)?new l7(a,o):b7(o)?new d7(a,o):upe(o)?new A7(a,o):hpe(o)?new kR(a,o):ppe(o)?new mI(a,o):Ky(o)?new u7(a,o):Gy(o)?new h7(a,o):v7(o)?new p7(a,o):new $d(a,o)},f7=function(a,o){var c=m7(a,o);return c.flags|=4,yy(a,o,c,c),c},dpe=function(a,o,c){return o.styles.isPositionedWithZIndex()||o.styles.opacity<1||o.styles.isTransformed()||fI(a)&&c.styles.isTransparent()},Ape=function(a){return a.isPositioned()||a.isFloating()},g7=function(a){return a.nodeType===Node.TEXT_NODE},ug=function(a){return a.nodeType===Node.ELEMENT_NODE},DR=function(a){return ug(a)&&typeof a.style<"u"&&!Ey(a)},Ey=function(a){return typeof a.className=="object"},upe=function(a){return a.tagName==="LI"},hpe=function(a){return a.tagName==="OL"},ppe=function(a){return a.tagName==="INPUT"},mpe=function(a){return a.tagName==="HTML"},b7=function(a){return a.tagName==="svg"},fI=function(a){return a.tagName==="BODY"},x7=function(a){return a.tagName==="CANVAS"},E8=function(a){return a.tagName==="VIDEO"},BR=function(a){return a.tagName==="IMG"},v7=function(a){return a.tagName==="IFRAME"},S8=function(a){return a.tagName==="STYLE"},fpe=function(a){return a.tagName==="SCRIPT"},Gy=function(a){return a.tagName==="TEXTAREA"},Ky=function(a){return a.tagName==="SELECT"},w7=function(a){return a.tagName==="SLOT"},C8=function(a){return a.tagName.indexOf("-")>0},gpe=function(){function a(){this.counters={}}return a.prototype.getCounterValue=function(o){var c=this.counters[o];return c&&c.length?c[c.length-1]:1},a.prototype.getCounterValues=function(o){var c=this.counters[o];return c||[]},a.prototype.pop=function(o){var c=this;o.forEach(function(d){return c.counters[d].pop()})},a.prototype.parse=function(o){var c=this,d=o.counterIncrement,h=o.counterReset,m=!0;d!==null&&d.forEach(function(x){var v=c.counters[x.counter];v&&x.increment!==0&&(m=!1,v.length||v.push(1),v[Math.max(0,v.length-1)]+=x.increment)});var g=[];return m&&h.forEach(function(x){var v=c.counters[x.counter];g.push(x.counter),v||(v=c.counters[x.counter]=[]),v.push(x.reset)}),g},a}(),N8={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},T8={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},bpe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},xpe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Zf=function(a,o,c,d,h,m){return a<o||a>c?Zb(a,h,m.length>0):d.integers.reduce(function(g,x,v){for(;a>=x;)a-=x,g+=d.values[v];return g},"")+m},_7=function(a,o,c,d){var h="";do c||a--,h=d(a)+h,a/=o;while(a*o>=o);return h},ji=function(a,o,c,d,h){var m=c-o+1;return(a<0?"-":"")+(_7(Math.abs(a),m,d,function(g){return Pi(Math.floor(g%m)+o)})+h)},jp=function(a,o,c){c===void 0&&(c=". ");var d=o.length;return _7(Math.abs(a),d,!1,function(h){return o[Math.floor(h%d)]})+c},cg=1,Yu=2,Xu=4,Ub=8,FA=function(a,o,c,d,h,m){if(a<-9999||a>9999)return Zb(a,4,h.length>0);var g=Math.abs(a),x=h;if(g===0)return o[0]+x;for(var v=0;g>0&&v<=4;v++){var E=g%10;E===0&&ia(m,cg)&&x!==""?x=o[E]+x:E>1||E===1&&v===0||E===1&&v===1&&ia(m,Yu)||E===1&&v===1&&ia(m,Xu)&&a>100||E===1&&v>1&&ia(m,Ub)?x=o[E]+(v>0?c[v-1]:"")+x:E===1&&v>0&&(x=c[v-1]+x),g=Math.floor(g/10)}return(a<0?d:"")+x},R8="",I8="",O8="",pT="",Zb=function(a,o,c){var d=c?". ":"",h=c?"":"",m=c?", ":"",g=c?" ":"";switch(o){case 0:return""+g;case 1:return""+g;case 2:return""+g;case 5:var x=ji(a,48,57,!0,d);return x.length<4?"0"+x:x;case 4:return jp(a,"",h);case 6:return Zf(a,1,3999,N8,3,d).toLowerCase();case 7:return Zf(a,1,3999,N8,3,d);case 8:return ji(a,945,969,!1,d);case 9:return ji(a,97,122,!1,d);case 10:return ji(a,65,90,!1,d);case 11:return ji(a,1632,1641,!0,d);case 12:case 49:return Zf(a,1,9999,T8,3,d);case 35:return Zf(a,1,9999,T8,3,d).toLowerCase();case 13:return ji(a,2534,2543,!0,d);case 14:case 30:return ji(a,6112,6121,!0,d);case 15:return jp(a,"",h);case 16:return jp(a,"",h);case 17:case 48:return FA(a,"",R8,"",h,Yu|Xu|Ub);case 47:return FA(a,"",I8,"",h,cg|Yu|Xu|Ub);case 42:return FA(a,"",R8,"",h,Yu|Xu|Ub);case 41:return FA(a,"",I8,"",h,cg|Yu|Xu|Ub);case 26:return FA(a,"","",O8,h,0);case 25:return FA(a,"","",O8,h,cg|Yu|Xu);case 31:return FA(a,"","",pT,m,cg|Yu|Xu);case 33:return FA(a,"","",pT,m,0);case 32:return FA(a,"","",pT,m,cg|Yu|Xu);case 18:return ji(a,2406,2415,!0,d);case 20:return Zf(a,1,19999,xpe,3,d);case 21:return ji(a,2790,2799,!0,d);case 22:return ji(a,2662,2671,!0,d);case 22:return Zf(a,1,10999,bpe,3,d);case 23:return jp(a,"");case 24:return jp(a,"");case 27:return ji(a,3302,3311,!0,d);case 28:return jp(a,"",h);case 29:return jp(a,"",h);case 34:return ji(a,3792,3801,!0,d);case 37:return ji(a,6160,6169,!0,d);case 38:return ji(a,4160,4169,!0,d);case 39:return ji(a,2918,2927,!0,d);case 40:return ji(a,1776,1785,!0,d);case 43:return ji(a,3046,3055,!0,d);case 44:return ji(a,3174,3183,!0,d);case 45:return ji(a,3664,3673,!0,d);case 46:return ji(a,3872,3881,!0,d);case 3:default:return ji(a,48,57,!0,d)}},y7="data-html2canvas-ignore",k8=function(){function a(o,c,d){if(this.context=o,this.options=d,this.scrolledElements=[],this.referenceElement=c,this.counters=new gpe,this.quoteDepth=0,!c.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(c.ownerDocument.documentElement,!1)}return a.prototype.toIFrame=function(o,c){var d=this,h=vpe(o,c);if(!h.contentWindow)return Promise.reject("Unable to find iframe window");var m=o.defaultView.pageXOffset,g=o.defaultView.pageYOffset,x=h.contentWindow,v=x.document,E=ype(h).then(function(){return xo(d,void 0,void 0,function(){var S,I;return $a(this,function(k){switch(k.label){case 0:return this.scrolledElements.forEach(Npe),x&&(x.scrollTo(c.left,c.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(x.scrollY!==c.top||x.scrollX!==c.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(x.scrollX-c.left,x.scrollY-c.top,0,0))),S=this.options.onclone,I=this.clonedReferenceElement,typeof I>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:v.fonts&&v.fonts.ready?[4,v.fonts.ready]:[3,2];case 1:k.sent(),k.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,_pe(v)]:[3,4];case 3:k.sent(),k.label=4;case 4:return typeof S=="function"?[2,Promise.resolve().then(function(){return S(v,I)}).then(function(){return h})]:[2,h]}})})});return v.open(),v.write(Spe(document.doctype)+"<html></html>"),Cpe(this.referenceElement.ownerDocument,m,g),v.replaceChild(v.adoptNode(this.documentElement),v.documentElement),v.close(),E},a.prototype.createElementClone=function(o){if(IR(o,2))debugger;if(x7(o))return this.createCanvasClone(o);if(E8(o))return this.createVideoClone(o);if(S8(o))return this.createStyleClone(o);var c=o.cloneNode(!1);return BR(c)&&(BR(o)&&o.currentSrc&&o.currentSrc!==o.src&&(c.src=o.currentSrc,c.srcset=""),c.loading==="lazy"&&(c.loading="eager")),C8(c)?this.createCustomElementClone(c):c},a.prototype.createCustomElementClone=function(o){var c=document.createElement("html2canvascustomelement");return mT(o.style,c),c},a.prototype.createStyleClone=function(o){try{var c=o.sheet;if(c&&c.cssRules){var d=[].slice.call(c.cssRules,0).reduce(function(m,g){return g&&typeof g.cssText=="string"?m+g.cssText:m},""),h=o.cloneNode(!1);return h.textContent=d,h}}catch(m){if(this.context.logger.error("Unable to access cssRules property",m),m.name!=="SecurityError")throw m}return o.cloneNode(!1)},a.prototype.createCanvasClone=function(o){var c;if(this.options.inlineImages&&o.ownerDocument){var d=o.ownerDocument.createElement("img");try{return d.src=o.toDataURL(),d}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",o)}}var h=o.cloneNode(!1);try{h.width=o.width,h.height=o.height;var m=o.getContext("2d"),g=h.getContext("2d");if(g)if(!this.options.allowTaint&&m)g.putImageData(m.getImageData(0,0,o.width,o.height),0,0);else{var x=(c=o.getContext("webgl2"))!==null&&c!==void 0?c:o.getContext("webgl");if(x){var v=x.getContextAttributes();(v==null?void 0:v.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",o)}g.drawImage(o,0,0)}return h}catch{this.context.logger.info("Unable to clone canvas as it is tainted",o)}return h},a.prototype.createVideoClone=function(o){var c=o.ownerDocument.createElement("canvas");c.width=o.offsetWidth,c.height=o.offsetHeight;var d=c.getContext("2d");try{return d&&(d.drawImage(o,0,0,c.width,c.height),this.options.allowTaint||d.getImageData(0,0,c.width,c.height)),c}catch{this.context.logger.info("Unable to clone video as it is tainted",o)}var h=o.ownerDocument.createElement("canvas");return h.width=o.offsetWidth,h.height=o.offsetHeight,h},a.prototype.appendChildNode=function(o,c,d){(!ug(c)||!fpe(c)&&!c.hasAttribute(y7)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(c)))&&(!this.options.copyStyles||!ug(c)||!S8(c))&&o.appendChild(this.cloneNode(c,d))},a.prototype.cloneChildNodes=function(o,c,d){for(var h=this,m=o.shadowRoot?o.shadowRoot.firstChild:o.firstChild;m;m=m.nextSibling)if(ug(m)&&w7(m)&&typeof m.assignedNodes=="function"){var g=m.assignedNodes();g.length&&g.forEach(function(x){return h.appendChildNode(c,x,d)})}else this.appendChildNode(c,m,d)},a.prototype.cloneNode=function(o,c){if(g7(o))return document.createTextNode(o.data);if(!o.ownerDocument)return o.cloneNode(!1);var d=o.ownerDocument.defaultView;if(d&&ug(o)&&(DR(o)||Ey(o))){var h=this.createElementClone(o);h.style.transitionProperty="none";var m=d.getComputedStyle(o),g=d.getComputedStyle(o,":before"),x=d.getComputedStyle(o,":after");this.referenceElement===o&&DR(h)&&(this.clonedReferenceElement=h),fI(h)&&Ipe(h);var v=this.counters.parse(new l8(this.context,m)),E=this.resolvePseudoContent(o,h,g,Gb.BEFORE);C8(o)&&(c=!0),E8(o)||this.cloneChildNodes(o,h,c),E&&h.insertBefore(E,h.firstChild);var S=this.resolvePseudoContent(o,h,x,Gb.AFTER);return S&&h.appendChild(S),this.counters.pop(v),(m&&(this.options.copyStyles||Ey(o))&&!v7(o)||c)&&mT(m,h),(o.scrollTop!==0||o.scrollLeft!==0)&&this.scrolledElements.push([h,o.scrollLeft,o.scrollTop]),(Gy(o)||Ky(o))&&(Gy(h)||Ky(h))&&(h.value=o.value),h}return o.cloneNode(!1)},a.prototype.resolvePseudoContent=function(o,c,d,h){var m=this;if(d){var g=d.content,x=c.ownerDocument;if(!(!x||!g||g==="none"||g==="-moz-alt-content"||d.display==="none")){this.counters.parse(new l8(this.context,d));var v=new uhe(this.context,d),E=x.createElement("html2canvaspseudoelement");mT(d,E),v.content.forEach(function(I){if(I.type===0)E.appendChild(x.createTextNode(I.value));else if(I.type===22){var k=x.createElement("img");k.src=I.value,k.style.opacity="1",E.appendChild(k)}else if(I.type===18){if(I.name==="attr"){var R=I.values.filter(En);R.length&&E.appendChild(x.createTextNode(o.getAttribute(R[0].value)||""))}else if(I.name==="counter"){var O=I.values.filter(Eg),F=O[0],M=O[1];if(F&&En(F)){var Q=m.counters.getCounterValue(F.value),Z=M&&En(M)?RR.parse(m.context,M.value):3;E.appendChild(x.createTextNode(Zb(Q,Z,!1)))}}else if(I.name==="counters"){var $=I.values.filter(Eg),F=$[0],X=$[1],M=$[2];if(F&&En(F)){var be=m.counters.getCounterValues(F.value),me=M&&En(M)?RR.parse(m.context,M.value):3,Ne=X&&X.type===0?X.value:"",le=be.map(function(J){return Zb(J,me,!1)}).join(Ne);E.appendChild(x.createTextNode(le))}}}else if(I.type===20)switch(I.value){case"open-quote":E.appendChild(x.createTextNode(c8(v.quotes,m.quoteDepth++,!0)));break;case"close-quote":E.appendChild(x.createTextNode(c8(v.quotes,--m.quoteDepth,!1)));break;default:E.appendChild(x.createTextNode(I.value))}}),E.className=LR+" "+jR;var S=h===Gb.BEFORE?" "+LR:" "+jR;return Ey(c)?c.className.baseValue+=S:c.className+=S,E}}},a.destroy=function(o){return o.parentNode?(o.parentNode.removeChild(o),!0):!1},a}(),Gb;(function(a){a[a.BEFORE=0]="BEFORE",a[a.AFTER=1]="AFTER"})(Gb||(Gb={}));var vpe=function(a,o){var c=a.createElement("iframe");return c.className="html2canvas-container",c.style.visibility="hidden",c.style.position="fixed",c.style.left="-10000px",c.style.top="0px",c.style.border="0",c.width=o.width.toString(),c.height=o.height.toString(),c.scrolling="no",c.setAttribute(y7,"true"),a.body.appendChild(c),c},wpe=function(a){return new Promise(function(o){if(a.complete){o();return}if(!a.src){o();return}a.onload=o,a.onerror=o})},_pe=function(a){return Promise.all([].slice.call(a.images,0).map(wpe))},ype=function(a){return new Promise(function(o,c){var d=a.contentWindow;if(!d)return c("No window assigned for iframe");var h=d.document;d.onload=a.onload=function(){d.onload=a.onload=null;var m=setInterval(function(){h.body.childNodes.length>0&&h.readyState==="complete"&&(clearInterval(m),o(a))},50)}})},Epe=["all","d","content"],mT=function(a,o){for(var c=a.length-1;c>=0;c--){var d=a.item(c);Epe.indexOf(d)===-1&&o.style.setProperty(d,a.getPropertyValue(d))}return o},Spe=function(a){var o="";return a&&(o+="<!DOCTYPE ",a.name&&(o+=a.name),a.internalSubset&&(o+=a.internalSubset),a.publicId&&(o+='"'+a.publicId+'"'),a.systemId&&(o+='"'+a.systemId+'"'),o+=">"),o},Cpe=function(a,o,c){a&&a.defaultView&&(o!==a.defaultView.pageXOffset||c!==a.defaultView.pageYOffset)&&a.defaultView.scrollTo(o,c)},Npe=function(a){var o=a[0],c=a[1],d=a[2];o.scrollLeft=c,o.scrollTop=d},Tpe=":before",Rpe=":after",LR="___html2canvas___pseudoelement_before",jR="___html2canvas___pseudoelement_after",D8=`{
    content: "" !important;
    display: none !important;
}`,Ipe=function(a){Ope(a,"."+LR+Tpe+D8+`
         .`+jR+Rpe+D8)},Ope=function(a,o){var c=a.ownerDocument;if(c){var d=c.createElement("style");d.textContent=o,a.appendChild(d)}},E7=function(){function a(){}return a.getOrigin=function(o){var c=a._link;return c?(c.href=o,c.href=c.href,c.protocol+c.hostname+c.port):"about:blank"},a.isSameOrigin=function(o){return a.getOrigin(o)===a._origin},a.setContext=function(o){a._link=o.document.createElement("a"),a._origin=a.getOrigin(o.location.href)},a._origin="about:blank",a}(),kpe=function(){function a(o,c){this.context=o,this._options=c,this._cache={}}return a.prototype.addImage=function(o){var c=Promise.resolve();return this.has(o)||(gT(o)||jpe(o))&&(this._cache[o]=this.loadImage(o)).catch(function(){}),c},a.prototype.match=function(o){return this._cache[o]},a.prototype.loadImage=function(o){return xo(this,void 0,void 0,function(){var c,d,h,m,g=this;return $a(this,function(x){switch(x.label){case 0:return c=E7.isSameOrigin(o),d=!fT(o)&&this._options.useCORS===!0&&ja.SUPPORT_CORS_IMAGES&&!c,h=!fT(o)&&!c&&!gT(o)&&typeof this._options.proxy=="string"&&ja.SUPPORT_CORS_XHR&&!d,!c&&this._options.allowTaint===!1&&!fT(o)&&!gT(o)&&!h&&!d?[2]:(m=o,h?[4,this.proxy(m)]:[3,2]);case 1:m=x.sent(),x.label=2;case 2:return this.context.logger.debug("Added image "+o.substring(0,256)),[4,new Promise(function(v,E){var S=new Image;S.onload=function(){return v(S)},S.onerror=E,(Ppe(m)||d)&&(S.crossOrigin="anonymous"),S.src=m,S.complete===!0&&setTimeout(function(){return v(S)},500),g._options.imageTimeout>0&&setTimeout(function(){return E("Timed out ("+g._options.imageTimeout+"ms) loading image")},g._options.imageTimeout)})];case 3:return[2,x.sent()]}})})},a.prototype.has=function(o){return typeof this._cache[o]<"u"},a.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},a.prototype.proxy=function(o){var c=this,d=this._options.proxy;if(!d)throw new Error("No proxy defined");var h=o.substring(0,256);return new Promise(function(m,g){var x=ja.SUPPORT_RESPONSE_TYPE?"blob":"text",v=new XMLHttpRequest;v.onload=function(){if(v.status===200)if(x==="text")m(v.response);else{var I=new FileReader;I.addEventListener("load",function(){return m(I.result)},!1),I.addEventListener("error",function(k){return g(k)},!1),I.readAsDataURL(v.response)}else g("Failed to proxy resource "+h+" with status code "+v.status)},v.onerror=g;var E=d.indexOf("?")>-1?"&":"?";if(v.open("GET",""+d+E+"url="+encodeURIComponent(o)+"&responseType="+x),x!=="text"&&v instanceof XMLHttpRequest&&(v.responseType=x),c._options.imageTimeout){var S=c._options.imageTimeout;v.timeout=S,v.ontimeout=function(){return g("Timed out ("+S+"ms) proxying "+h)}}v.send()})},a}(),Dpe=/^data:image\/svg\+xml/i,Bpe=/^data:image\/.*;base64,/i,Lpe=/^data:image\/.*/i,jpe=function(a){return ja.SUPPORT_SVG_DRAWING||!Upe(a)},fT=function(a){return Lpe.test(a)},Ppe=function(a){return Bpe.test(a)},gT=function(a){return a.substr(0,4)==="blob"},Upe=function(a){return a.substr(-3).toLowerCase()==="svg"||Dpe.test(a)},hs=function(){function a(o,c){this.type=0,this.x=o,this.y=c}return a.prototype.add=function(o,c){return new a(this.x+o,this.y+c)},a}(),eg=function(a,o,c){return new hs(a.x+(o.x-a.x)*c,a.y+(o.y-a.y)*c)},ry=function(){function a(o,c,d,h){this.type=1,this.start=o,this.startControl=c,this.endControl=d,this.end=h}return a.prototype.subdivide=function(o,c){var d=eg(this.start,this.startControl,o),h=eg(this.startControl,this.endControl,o),m=eg(this.endControl,this.end,o),g=eg(d,h,o),x=eg(h,m,o),v=eg(g,x,o);return c?new a(this.start,d,g,v):new a(v,x,m,this.end)},a.prototype.add=function(o,c){return new a(this.start.add(o,c),this.startControl.add(o,c),this.endControl.add(o,c),this.end.add(o,c))},a.prototype.reverse=function(){return new a(this.end,this.endControl,this.startControl,this.start)},a}(),rl=function(a){return a.type===1},Fpe=function(){function a(o){var c=o.styles,d=o.bounds,h=jb(c.borderTopLeftRadius,d.width,d.height),m=h[0],g=h[1],x=jb(c.borderTopRightRadius,d.width,d.height),v=x[0],E=x[1],S=jb(c.borderBottomRightRadius,d.width,d.height),I=S[0],k=S[1],R=jb(c.borderBottomLeftRadius,d.width,d.height),O=R[0],F=R[1],M=[];M.push((m+v)/d.width),M.push((O+I)/d.width),M.push((g+F)/d.height),M.push((E+k)/d.height);var Q=Math.max.apply(Math,M);Q>1&&(m/=Q,g/=Q,v/=Q,E/=Q,I/=Q,k/=Q,O/=Q,F/=Q);var Z=d.width-v,$=d.height-k,X=d.width-I,be=d.height-F,me=c.borderTopWidth,Ne=c.borderRightWidth,le=c.borderBottomWidth,H=c.borderLeftWidth,Ae=jn(c.paddingTop,o.bounds.width),J=jn(c.paddingRight,o.bounds.width),Y=jn(c.paddingBottom,o.bounds.width),se=jn(c.paddingLeft,o.bounds.width);this.topLeftBorderDoubleOuterBox=m>0||g>0?ri(d.left+H/3,d.top+me/3,m-H/3,g-me/3,cn.TOP_LEFT):new hs(d.left+H/3,d.top+me/3),this.topRightBorderDoubleOuterBox=m>0||g>0?ri(d.left+Z,d.top+me/3,v-Ne/3,E-me/3,cn.TOP_RIGHT):new hs(d.left+d.width-Ne/3,d.top+me/3),this.bottomRightBorderDoubleOuterBox=I>0||k>0?ri(d.left+X,d.top+$,I-Ne/3,k-le/3,cn.BOTTOM_RIGHT):new hs(d.left+d.width-Ne/3,d.top+d.height-le/3),this.bottomLeftBorderDoubleOuterBox=O>0||F>0?ri(d.left+H/3,d.top+be,O-H/3,F-le/3,cn.BOTTOM_LEFT):new hs(d.left+H/3,d.top+d.height-le/3),this.topLeftBorderDoubleInnerBox=m>0||g>0?ri(d.left+H*2/3,d.top+me*2/3,m-H*2/3,g-me*2/3,cn.TOP_LEFT):new hs(d.left+H*2/3,d.top+me*2/3),this.topRightBorderDoubleInnerBox=m>0||g>0?ri(d.left+Z,d.top+me*2/3,v-Ne*2/3,E-me*2/3,cn.TOP_RIGHT):new hs(d.left+d.width-Ne*2/3,d.top+me*2/3),this.bottomRightBorderDoubleInnerBox=I>0||k>0?ri(d.left+X,d.top+$,I-Ne*2/3,k-le*2/3,cn.BOTTOM_RIGHT):new hs(d.left+d.width-Ne*2/3,d.top+d.height-le*2/3),this.bottomLeftBorderDoubleInnerBox=O>0||F>0?ri(d.left+H*2/3,d.top+be,O-H*2/3,F-le*2/3,cn.BOTTOM_LEFT):new hs(d.left+H*2/3,d.top+d.height-le*2/3),this.topLeftBorderStroke=m>0||g>0?ri(d.left+H/2,d.top+me/2,m-H/2,g-me/2,cn.TOP_LEFT):new hs(d.left+H/2,d.top+me/2),this.topRightBorderStroke=m>0||g>0?ri(d.left+Z,d.top+me/2,v-Ne/2,E-me/2,cn.TOP_RIGHT):new hs(d.left+d.width-Ne/2,d.top+me/2),this.bottomRightBorderStroke=I>0||k>0?ri(d.left+X,d.top+$,I-Ne/2,k-le/2,cn.BOTTOM_RIGHT):new hs(d.left+d.width-Ne/2,d.top+d.height-le/2),this.bottomLeftBorderStroke=O>0||F>0?ri(d.left+H/2,d.top+be,O-H/2,F-le/2,cn.BOTTOM_LEFT):new hs(d.left+H/2,d.top+d.height-le/2),this.topLeftBorderBox=m>0||g>0?ri(d.left,d.top,m,g,cn.TOP_LEFT):new hs(d.left,d.top),this.topRightBorderBox=v>0||E>0?ri(d.left+Z,d.top,v,E,cn.TOP_RIGHT):new hs(d.left+d.width,d.top),this.bottomRightBorderBox=I>0||k>0?ri(d.left+X,d.top+$,I,k,cn.BOTTOM_RIGHT):new hs(d.left+d.width,d.top+d.height),this.bottomLeftBorderBox=O>0||F>0?ri(d.left,d.top+be,O,F,cn.BOTTOM_LEFT):new hs(d.left,d.top+d.height),this.topLeftPaddingBox=m>0||g>0?ri(d.left+H,d.top+me,Math.max(0,m-H),Math.max(0,g-me),cn.TOP_LEFT):new hs(d.left+H,d.top+me),this.topRightPaddingBox=v>0||E>0?ri(d.left+Math.min(Z,d.width-Ne),d.top+me,Z>d.width+Ne?0:Math.max(0,v-Ne),Math.max(0,E-me),cn.TOP_RIGHT):new hs(d.left+d.width-Ne,d.top+me),this.bottomRightPaddingBox=I>0||k>0?ri(d.left+Math.min(X,d.width-H),d.top+Math.min($,d.height-le),Math.max(0,I-Ne),Math.max(0,k-le),cn.BOTTOM_RIGHT):new hs(d.left+d.width-Ne,d.top+d.height-le),this.bottomLeftPaddingBox=O>0||F>0?ri(d.left+H,d.top+Math.min(be,d.height-le),Math.max(0,O-H),Math.max(0,F-le),cn.BOTTOM_LEFT):new hs(d.left+H,d.top+d.height-le),this.topLeftContentBox=m>0||g>0?ri(d.left+H+se,d.top+me+Ae,Math.max(0,m-(H+se)),Math.max(0,g-(me+Ae)),cn.TOP_LEFT):new hs(d.left+H+se,d.top+me+Ae),this.topRightContentBox=v>0||E>0?ri(d.left+Math.min(Z,d.width+H+se),d.top+me+Ae,Z>d.width+H+se?0:v-H+se,E-(me+Ae),cn.TOP_RIGHT):new hs(d.left+d.width-(Ne+J),d.top+me+Ae),this.bottomRightContentBox=I>0||k>0?ri(d.left+Math.min(X,d.width-(H+se)),d.top+Math.min($,d.height+me+Ae),Math.max(0,I-(Ne+J)),k-(le+Y),cn.BOTTOM_RIGHT):new hs(d.left+d.width-(Ne+J),d.top+d.height-(le+Y)),this.bottomLeftContentBox=O>0||F>0?ri(d.left+H+se,d.top+be,Math.max(0,O-(H+se)),F-(le+Y),cn.BOTTOM_LEFT):new hs(d.left+H+se,d.top+d.height-(le+Y))}return a}(),cn;(function(a){a[a.TOP_LEFT=0]="TOP_LEFT",a[a.TOP_RIGHT=1]="TOP_RIGHT",a[a.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",a[a.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(cn||(cn={}));var ri=function(a,o,c,d,h){var m=4*((Math.sqrt(2)-1)/3),g=c*m,x=d*m,v=a+c,E=o+d;switch(h){case cn.TOP_LEFT:return new ry(new hs(a,E),new hs(a,E-x),new hs(v-g,o),new hs(v,o));case cn.TOP_RIGHT:return new ry(new hs(a,o),new hs(a+g,o),new hs(v,E-x),new hs(v,E));case cn.BOTTOM_RIGHT:return new ry(new hs(v,o),new hs(v,o+x),new hs(a+g,E),new hs(a,E));case cn.BOTTOM_LEFT:default:return new ry(new hs(v,E),new hs(v-g,E),new hs(a,o+x),new hs(a,o))}},Wy=function(a){return[a.topLeftBorderBox,a.topRightBorderBox,a.bottomRightBorderBox,a.bottomLeftBorderBox]},Mpe=function(a){return[a.topLeftContentBox,a.topRightContentBox,a.bottomRightContentBox,a.bottomLeftContentBox]},zy=function(a){return[a.topLeftPaddingBox,a.topRightPaddingBox,a.bottomRightPaddingBox,a.bottomLeftPaddingBox]},Vpe=function(){function a(o,c,d){this.offsetX=o,this.offsetY=c,this.matrix=d,this.type=0,this.target=6}return a}(),ny=function(){function a(o,c){this.path=o,this.target=c,this.type=1}return a}(),Qpe=function(){function a(o){this.opacity=o,this.type=2,this.target=6}return a}(),Hpe=function(a){return a.type===0},S7=function(a){return a.type===1},Gpe=function(a){return a.type===2},B8=function(a,o){return a.length===o.length?a.some(function(c,d){return c===o[d]}):!1},Kpe=function(a,o,c,d,h){return a.map(function(m,g){switch(g){case 0:return m.add(o,c);case 1:return m.add(o+d,c);case 2:return m.add(o+d,c+h);case 3:return m.add(o,c+h)}return m})},C7=function(){function a(o){this.element=o,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return a}(),N7=function(){function a(o,c){if(this.container=o,this.parent=c,this.effects=[],this.curves=new Fpe(this.container),this.container.styles.opacity<1&&this.effects.push(new Qpe(this.container.styles.opacity)),this.container.styles.transform!==null){var d=this.container.bounds.left+this.container.styles.transformOrigin[0].number,h=this.container.bounds.top+this.container.styles.transformOrigin[1].number,m=this.container.styles.transform;this.effects.push(new Vpe(d,h,m))}if(this.container.styles.overflowX!==0){var g=Wy(this.curves),x=zy(this.curves);B8(g,x)?this.effects.push(new ny(g,6)):(this.effects.push(new ny(g,2)),this.effects.push(new ny(x,4)))}}return a.prototype.getEffects=function(o){for(var c=[2,3].indexOf(this.container.styles.position)===-1,d=this.parent,h=this.effects.slice(0);d;){var m=d.effects.filter(function(v){return!S7(v)});if(c||d.container.styles.position!==0||!d.parent){if(h.unshift.apply(h,m),c=[2,3].indexOf(d.container.styles.position)===-1,d.container.styles.overflowX!==0){var g=Wy(d.curves),x=zy(d.curves);B8(g,x)||h.unshift(new ny(x,6))}}else h.unshift.apply(h,m);d=d.parent}return h.filter(function(v){return ia(v.target,o)})},a}(),PR=function(a,o,c,d){a.container.elements.forEach(function(h){var m=ia(h.flags,4),g=ia(h.flags,2),x=new N7(h,a);ia(h.styles.display,2048)&&d.push(x);var v=ia(h.flags,8)?[]:d;if(m||g){var E=m||h.styles.isPositioned()?c:o,S=new C7(x);if(h.styles.isPositioned()||h.styles.opacity<1||h.styles.isTransformed()){var I=h.styles.zIndex.order;if(I<0){var k=0;E.negativeZIndex.some(function(O,F){return I>O.element.container.styles.zIndex.order?(k=F,!1):k>0}),E.negativeZIndex.splice(k,0,S)}else if(I>0){var R=0;E.positiveZIndex.some(function(O,F){return I>=O.element.container.styles.zIndex.order?(R=F+1,!1):R>0}),E.positiveZIndex.splice(R,0,S)}else E.zeroOrAutoZIndexOrTransformedOrOpacity.push(S)}else h.styles.isFloating()?E.nonPositionedFloats.push(S):E.nonPositionedInlineLevel.push(S);PR(x,S,m?S:c,v)}else h.styles.isInlineLevel()?o.inlineLevel.push(x):o.nonInlineLevel.push(x),PR(x,o,c,v);ia(h.flags,8)&&T7(h,v)})},T7=function(a,o){for(var c=a instanceof kR?a.start:1,d=a instanceof kR?a.reversed:!1,h=0;h<o.length;h++){var m=o[h];m.container instanceof A7&&typeof m.container.value=="number"&&m.container.value!==0&&(c=m.container.value),m.listValue=Zb(c,m.container.styles.listStyleType,!0),c+=d?-1:1}},Wpe=function(a){var o=new N7(a,null),c=new C7(o),d=[];return PR(o,c,c,d),T7(o.container,d),c},L8=function(a,o){switch(o){case 0:return ol(a.topLeftBorderBox,a.topLeftPaddingBox,a.topRightBorderBox,a.topRightPaddingBox);case 1:return ol(a.topRightBorderBox,a.topRightPaddingBox,a.bottomRightBorderBox,a.bottomRightPaddingBox);case 2:return ol(a.bottomRightBorderBox,a.bottomRightPaddingBox,a.bottomLeftBorderBox,a.bottomLeftPaddingBox);case 3:default:return ol(a.bottomLeftBorderBox,a.bottomLeftPaddingBox,a.topLeftBorderBox,a.topLeftPaddingBox)}},zpe=function(a,o){switch(o){case 0:return ol(a.topLeftBorderBox,a.topLeftBorderDoubleOuterBox,a.topRightBorderBox,a.topRightBorderDoubleOuterBox);case 1:return ol(a.topRightBorderBox,a.topRightBorderDoubleOuterBox,a.bottomRightBorderBox,a.bottomRightBorderDoubleOuterBox);case 2:return ol(a.bottomRightBorderBox,a.bottomRightBorderDoubleOuterBox,a.bottomLeftBorderBox,a.bottomLeftBorderDoubleOuterBox);case 3:default:return ol(a.bottomLeftBorderBox,a.bottomLeftBorderDoubleOuterBox,a.topLeftBorderBox,a.topLeftBorderDoubleOuterBox)}},qpe=function(a,o){switch(o){case 0:return ol(a.topLeftBorderDoubleInnerBox,a.topLeftPaddingBox,a.topRightBorderDoubleInnerBox,a.topRightPaddingBox);case 1:return ol(a.topRightBorderDoubleInnerBox,a.topRightPaddingBox,a.bottomRightBorderDoubleInnerBox,a.bottomRightPaddingBox);case 2:return ol(a.bottomRightBorderDoubleInnerBox,a.bottomRightPaddingBox,a.bottomLeftBorderDoubleInnerBox,a.bottomLeftPaddingBox);case 3:default:return ol(a.bottomLeftBorderDoubleInnerBox,a.bottomLeftPaddingBox,a.topLeftBorderDoubleInnerBox,a.topLeftPaddingBox)}},Ype=function(a,o){switch(o){case 0:return iy(a.topLeftBorderStroke,a.topRightBorderStroke);case 1:return iy(a.topRightBorderStroke,a.bottomRightBorderStroke);case 2:return iy(a.bottomRightBorderStroke,a.bottomLeftBorderStroke);case 3:default:return iy(a.bottomLeftBorderStroke,a.topLeftBorderStroke)}},iy=function(a,o){var c=[];return rl(a)?c.push(a.subdivide(.5,!1)):c.push(a),rl(o)?c.push(o.subdivide(.5,!0)):c.push(o),c},ol=function(a,o,c,d){var h=[];return rl(a)?h.push(a.subdivide(.5,!1)):h.push(a),rl(c)?h.push(c.subdivide(.5,!0)):h.push(c),rl(d)?h.push(d.subdivide(.5,!0).reverse()):h.push(d),rl(o)?h.push(o.subdivide(.5,!1).reverse()):h.push(o),h},R7=function(a){var o=a.bounds,c=a.styles;return o.add(c.borderLeftWidth,c.borderTopWidth,-(c.borderRightWidth+c.borderLeftWidth),-(c.borderTopWidth+c.borderBottomWidth))},qy=function(a){var o=a.styles,c=a.bounds,d=jn(o.paddingLeft,c.width),h=jn(o.paddingRight,c.width),m=jn(o.paddingTop,c.width),g=jn(o.paddingBottom,c.width);return c.add(d+o.borderLeftWidth,m+o.borderTopWidth,-(o.borderRightWidth+o.borderLeftWidth+d+h),-(o.borderTopWidth+o.borderBottomWidth+m+g))},Xpe=function(a,o){return a===0?o.bounds:a===2?qy(o):R7(o)},Jpe=function(a,o){return a===0?o.bounds:a===2?qy(o):R7(o)},bT=function(a,o,c){var d=Xpe(lg(a.styles.backgroundOrigin,o),a),h=Jpe(lg(a.styles.backgroundClip,o),a),m=$pe(lg(a.styles.backgroundSize,o),c,d),g=m[0],x=m[1],v=jb(lg(a.styles.backgroundPosition,o),d.width-g,d.height-x),E=Zpe(lg(a.styles.backgroundRepeat,o),v,m,d,h),S=Math.round(d.left+v[0]),I=Math.round(d.top+v[1]);return[E,S,I,g,x]},tg=function(a){return En(a)&&a.value===fg.AUTO},ay=function(a){return typeof a=="number"},$pe=function(a,o,c){var d=o[0],h=o[1],m=o[2],g=a[0],x=a[1];if(!g)return[0,0];if(qi(g)&&x&&qi(x))return[jn(g,c.width),jn(x,c.height)];var v=ay(m);if(En(g)&&(g.value===fg.CONTAIN||g.value===fg.COVER)){if(ay(m)){var E=c.width/c.height;return E<m!=(g.value===fg.COVER)?[c.width,c.width/m]:[c.height*m,c.height]}return[c.width,c.height]}var S=ay(d),I=ay(h),k=S||I;if(tg(g)&&(!x||tg(x))){if(S&&I)return[d,h];if(!v&&!k)return[c.width,c.height];if(k&&v){var R=S?d:h*m,O=I?h:d/m;return[R,O]}var F=S?d:c.width,M=I?h:c.height;return[F,M]}if(v){var Q=0,Z=0;return qi(g)?Q=jn(g,c.width):qi(x)&&(Z=jn(x,c.height)),tg(g)?Q=Z*m:(!x||tg(x))&&(Z=Q/m),[Q,Z]}var $=null,X=null;if(qi(g)?$=jn(g,c.width):x&&qi(x)&&(X=jn(x,c.height)),$!==null&&(!x||tg(x))&&(X=S&&I?$/d*h:c.height),X!==null&&tg(g)&&($=S&&I?X/h*d:c.width),$!==null&&X!==null)return[$,X];throw new Error("Unable to calculate background-size for element")},lg=function(a,o){var c=a[o];return typeof c>"u"?a[0]:c},Zpe=function(a,o,c,d,h){var m=o[0],g=o[1],x=c[0],v=c[1];switch(a){case 2:return[new hs(Math.round(d.left),Math.round(d.top+g)),new hs(Math.round(d.left+d.width),Math.round(d.top+g)),new hs(Math.round(d.left+d.width),Math.round(v+d.top+g)),new hs(Math.round(d.left),Math.round(v+d.top+g))];case 3:return[new hs(Math.round(d.left+m),Math.round(d.top)),new hs(Math.round(d.left+m+x),Math.round(d.top)),new hs(Math.round(d.left+m+x),Math.round(d.height+d.top)),new hs(Math.round(d.left+m),Math.round(d.height+d.top))];case 1:return[new hs(Math.round(d.left+m),Math.round(d.top+g)),new hs(Math.round(d.left+m+x),Math.round(d.top+g)),new hs(Math.round(d.left+m+x),Math.round(d.top+g+v)),new hs(Math.round(d.left+m),Math.round(d.top+g+v))];default:return[new hs(Math.round(h.left),Math.round(h.top)),new hs(Math.round(h.left+h.width),Math.round(h.top)),new hs(Math.round(h.left+h.width),Math.round(h.height+h.top)),new hs(Math.round(h.left),Math.round(h.height+h.top))]}},eme="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",j8="Hidden Text",tme=function(){function a(o){this._data={},this._document=o}return a.prototype.parseMetrics=function(o,c){var d=this._document.createElement("div"),h=this._document.createElement("img"),m=this._document.createElement("span"),g=this._document.body;d.style.visibility="hidden",d.style.fontFamily=o,d.style.fontSize=c,d.style.margin="0",d.style.padding="0",d.style.whiteSpace="nowrap",g.appendChild(d),h.src=eme,h.width=1,h.height=1,h.style.margin="0",h.style.padding="0",h.style.verticalAlign="baseline",m.style.fontFamily=o,m.style.fontSize=c,m.style.margin="0",m.style.padding="0",m.appendChild(this._document.createTextNode(j8)),d.appendChild(m),d.appendChild(h);var x=h.offsetTop-m.offsetTop+2;d.removeChild(m),d.appendChild(this._document.createTextNode(j8)),d.style.lineHeight="normal",h.style.verticalAlign="super";var v=h.offsetTop-d.offsetTop+2;return g.removeChild(d),{baseline:x,middle:v}},a.prototype.getMetrics=function(o,c){var d=o+" "+c;return typeof this._data[d]>"u"&&(this._data[d]=this.parseMetrics(o,c)),this._data[d]},a}(),I7=function(){function a(o,c){this.context=o,this.options=c}return a}(),sme=1e4,rme=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h._activeEffects=[],h.canvas=d.canvas?d.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),d.canvas||(h.canvas.width=Math.floor(d.width*d.scale),h.canvas.height=Math.floor(d.height*d.scale),h.canvas.style.width=d.width+"px",h.canvas.style.height=d.height+"px"),h.fontMetrics=new tme(document),h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-d.x,-d.y),h.ctx.textBaseline="bottom",h._activeEffects=[],h.context.logger.debug("Canvas renderer initialized ("+d.width+"x"+d.height+") with scale "+d.scale),h}return o.prototype.applyEffects=function(c){for(var d=this;this._activeEffects.length;)this.popEffect();c.forEach(function(h){return d.applyEffect(h)})},o.prototype.applyEffect=function(c){this.ctx.save(),Gpe(c)&&(this.ctx.globalAlpha=c.opacity),Hpe(c)&&(this.ctx.translate(c.offsetX,c.offsetY),this.ctx.transform(c.matrix[0],c.matrix[1],c.matrix[2],c.matrix[3],c.matrix[4],c.matrix[5]),this.ctx.translate(-c.offsetX,-c.offsetY)),S7(c)&&(this.path(c.path),this.ctx.clip()),this._activeEffects.push(c)},o.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},o.prototype.renderStack=function(c){return xo(this,void 0,void 0,function(){var d;return $a(this,function(h){switch(h.label){case 0:return d=c.element.container.styles,d.isVisible()?[4,this.renderStackContent(c)]:[3,2];case 1:h.sent(),h.label=2;case 2:return[2]}})})},o.prototype.renderNode=function(c){return xo(this,void 0,void 0,function(){return $a(this,function(d){switch(d.label){case 0:if(ia(c.container.flags,16))debugger;return c.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(c)]:[3,3];case 1:return d.sent(),[4,this.renderNodeContent(c)];case 2:d.sent(),d.label=3;case 3:return[2]}})})},o.prototype.renderTextWithLetterSpacing=function(c,d,h){var m=this;if(d===0)this.ctx.fillText(c.text,c.bounds.left,c.bounds.top+h);else{var g=pI(c.text);g.reduce(function(x,v){return m.ctx.fillText(v,x,c.bounds.top+h),x+m.ctx.measureText(v).width},c.bounds.left)}},o.prototype.createFontStyle=function(c){var d=c.fontVariant.filter(function(g){return g==="normal"||g==="small-caps"}).join(""),h=cme(c.fontFamily).join(", "),m=px(c.fontSize)?""+c.fontSize.number+c.fontSize.unit:c.fontSize.number+"px";return[[c.fontStyle,d,c.fontWeight,m,h].join(" "),h,m]},o.prototype.renderTextNode=function(c,d){return xo(this,void 0,void 0,function(){var h,m,g,x,v,E,S,I,k=this;return $a(this,function(R){return h=this.createFontStyle(d),m=h[0],g=h[1],x=h[2],this.ctx.font=m,this.ctx.direction=d.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",v=this.fontMetrics.getMetrics(g,x),E=v.baseline,S=v.middle,I=d.paintOrder,c.textBounds.forEach(function(O){I.forEach(function(F){switch(F){case 0:k.ctx.fillStyle=ba(d.color),k.renderTextWithLetterSpacing(O,d.letterSpacing,E);var M=d.textShadow;M.length&&O.text.trim().length&&(M.slice(0).reverse().forEach(function(Q){k.ctx.shadowColor=ba(Q.color),k.ctx.shadowOffsetX=Q.offsetX.number*k.options.scale,k.ctx.shadowOffsetY=Q.offsetY.number*k.options.scale,k.ctx.shadowBlur=Q.blur.number,k.renderTextWithLetterSpacing(O,d.letterSpacing,E)}),k.ctx.shadowColor="",k.ctx.shadowOffsetX=0,k.ctx.shadowOffsetY=0,k.ctx.shadowBlur=0),d.textDecorationLine.length&&(k.ctx.fillStyle=ba(d.textDecorationColor||d.color),d.textDecorationLine.forEach(function(Q){switch(Q){case 1:k.ctx.fillRect(O.bounds.left,Math.round(O.bounds.top+E),O.bounds.width,1);break;case 2:k.ctx.fillRect(O.bounds.left,Math.round(O.bounds.top),O.bounds.width,1);break;case 3:k.ctx.fillRect(O.bounds.left,Math.ceil(O.bounds.top+S),O.bounds.width,1);break}}));break;case 1:d.webkitTextStrokeWidth&&O.text.trim().length&&(k.ctx.strokeStyle=ba(d.webkitTextStrokeColor),k.ctx.lineWidth=d.webkitTextStrokeWidth,k.ctx.lineJoin=window.chrome?"miter":"round",k.ctx.strokeText(O.text,O.bounds.left,O.bounds.top+E)),k.ctx.strokeStyle="",k.ctx.lineWidth=0,k.ctx.lineJoin="miter";break}})}),[2]})})},o.prototype.renderReplacedElement=function(c,d,h){if(h&&c.intrinsicWidth>0&&c.intrinsicHeight>0){var m=qy(c),g=zy(d);this.path(g),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(h,0,0,c.intrinsicWidth,c.intrinsicHeight,m.left,m.top,m.width,m.height),this.ctx.restore()}},o.prototype.renderNodeContent=function(c){return xo(this,void 0,void 0,function(){var d,h,m,g,x,v,Z,Z,E,S,I,k,X,R,O,be,F,M,Q,Z,$,X,be;return $a(this,function(me){switch(me.label){case 0:this.applyEffects(c.getEffects(4)),d=c.container,h=c.curves,m=d.styles,g=0,x=d.textNodes,me.label=1;case 1:return g<x.length?(v=x[g],[4,this.renderTextNode(v,m)]):[3,4];case 2:me.sent(),me.label=3;case 3:return g++,[3,1];case 4:if(!(d instanceof c7))return[3,8];me.label=5;case 5:return me.trys.push([5,7,,8]),[4,this.context.cache.match(d.src)];case 6:return Z=me.sent(),this.renderReplacedElement(d,h,Z),[3,8];case 7:return me.sent(),this.context.logger.error("Error loading image "+d.src),[3,8];case 8:if(d instanceof l7&&this.renderReplacedElement(d,h,d.canvas),!(d instanceof d7))return[3,12];me.label=9;case 9:return me.trys.push([9,11,,12]),[4,this.context.cache.match(d.svg)];case 10:return Z=me.sent(),this.renderReplacedElement(d,h,Z),[3,12];case 11:return me.sent(),this.context.logger.error("Error loading svg "+d.svg.substring(0,255)),[3,12];case 12:return d instanceof p7&&d.tree?(E=new o(this.context,{scale:this.options.scale,backgroundColor:d.backgroundColor,x:0,y:0,width:d.width,height:d.height}),[4,E.render(d.tree)]):[3,14];case 13:S=me.sent(),d.width&&d.height&&this.ctx.drawImage(S,0,0,d.width,d.height,d.bounds.left,d.bounds.top,d.bounds.width,d.bounds.height),me.label=14;case 14:if(d instanceof mI&&(I=Math.min(d.bounds.width,d.bounds.height),d.type===Qy?d.checked&&(this.ctx.save(),this.path([new hs(d.bounds.left+I*.39363,d.bounds.top+I*.79),new hs(d.bounds.left+I*.16,d.bounds.top+I*.5549),new hs(d.bounds.left+I*.27347,d.bounds.top+I*.44071),new hs(d.bounds.left+I*.39694,d.bounds.top+I*.5649),new hs(d.bounds.left+I*.72983,d.bounds.top+I*.23),new hs(d.bounds.left+I*.84,d.bounds.top+I*.34085),new hs(d.bounds.left+I*.39363,d.bounds.top+I*.79)]),this.ctx.fillStyle=ba(y8),this.ctx.fill(),this.ctx.restore()):d.type===Hy&&d.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(d.bounds.left+I/2,d.bounds.top+I/2,I/4,0,Math.PI*2,!0),this.ctx.fillStyle=ba(y8),this.ctx.fill(),this.ctx.restore())),nme(d)&&d.value.length){switch(k=this.createFontStyle(m),X=k[0],R=k[1],O=this.fontMetrics.getMetrics(X,R).baseline,this.ctx.font=X,this.ctx.fillStyle=ba(m.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=ame(d.styles.textAlign),be=qy(d),F=0,d.styles.textAlign){case 1:F+=be.width/2;break;case 2:F+=be.width;break}M=be.add(F,0,0,-be.height/2+1),this.ctx.save(),this.path([new hs(be.left,be.top),new hs(be.left+be.width,be.top),new hs(be.left+be.width,be.top+be.height),new hs(be.left,be.top+be.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Hb(d.value,M),m.letterSpacing,O),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ia(d.styles.display,2048))return[3,20];if(d.styles.listStyleImage===null)return[3,19];if(Q=d.styles.listStyleImage,Q.type!==0)return[3,18];Z=void 0,$=Q.url,me.label=15;case 15:return me.trys.push([15,17,,18]),[4,this.context.cache.match($)];case 16:return Z=me.sent(),this.ctx.drawImage(Z,d.bounds.left-(Z.width+10),d.bounds.top),[3,18];case 17:return me.sent(),this.context.logger.error("Error loading list-style-image "+$),[3,18];case 18:return[3,20];case 19:c.listValue&&d.styles.listStyleType!==-1&&(X=this.createFontStyle(m)[0],this.ctx.font=X,this.ctx.fillStyle=ba(m.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",be=new YA(d.bounds.left,d.bounds.top+jn(d.styles.paddingTop,d.bounds.width),d.bounds.width,a8(m.lineHeight,m.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Hb(c.listValue,be),m.letterSpacing,a8(m.lineHeight,m.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),me.label=20;case 20:return[2]}})})},o.prototype.renderStackContent=function(c){return xo(this,void 0,void 0,function(){var d,h,Q,m,g,Q,x,v,Q,E,S,Q,I,k,Q,R,O,Q,F,M,Q;return $a(this,function(Z){switch(Z.label){case 0:if(ia(c.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(c.element)];case 1:Z.sent(),d=0,h=c.negativeZIndex,Z.label=2;case 2:return d<h.length?(Q=h[d],[4,this.renderStack(Q)]):[3,5];case 3:Z.sent(),Z.label=4;case 4:return d++,[3,2];case 5:return[4,this.renderNodeContent(c.element)];case 6:Z.sent(),m=0,g=c.nonInlineLevel,Z.label=7;case 7:return m<g.length?(Q=g[m],[4,this.renderNode(Q)]):[3,10];case 8:Z.sent(),Z.label=9;case 9:return m++,[3,7];case 10:x=0,v=c.nonPositionedFloats,Z.label=11;case 11:return x<v.length?(Q=v[x],[4,this.renderStack(Q)]):[3,14];case 12:Z.sent(),Z.label=13;case 13:return x++,[3,11];case 14:E=0,S=c.nonPositionedInlineLevel,Z.label=15;case 15:return E<S.length?(Q=S[E],[4,this.renderStack(Q)]):[3,18];case 16:Z.sent(),Z.label=17;case 17:return E++,[3,15];case 18:I=0,k=c.inlineLevel,Z.label=19;case 19:return I<k.length?(Q=k[I],[4,this.renderNode(Q)]):[3,22];case 20:Z.sent(),Z.label=21;case 21:return I++,[3,19];case 22:R=0,O=c.zeroOrAutoZIndexOrTransformedOrOpacity,Z.label=23;case 23:return R<O.length?(Q=O[R],[4,this.renderStack(Q)]):[3,26];case 24:Z.sent(),Z.label=25;case 25:return R++,[3,23];case 26:F=0,M=c.positiveZIndex,Z.label=27;case 27:return F<M.length?(Q=M[F],[4,this.renderStack(Q)]):[3,30];case 28:Z.sent(),Z.label=29;case 29:return F++,[3,27];case 30:return[2]}})})},o.prototype.mask=function(c){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(c.slice(0).reverse()),this.ctx.closePath()},o.prototype.path=function(c){this.ctx.beginPath(),this.formatPath(c),this.ctx.closePath()},o.prototype.formatPath=function(c){var d=this;c.forEach(function(h,m){var g=rl(h)?h.start:h;m===0?d.ctx.moveTo(g.x,g.y):d.ctx.lineTo(g.x,g.y),rl(h)&&d.ctx.bezierCurveTo(h.startControl.x,h.startControl.y,h.endControl.x,h.endControl.y,h.end.x,h.end.y)})},o.prototype.renderRepeat=function(c,d,h,m){this.path(c),this.ctx.fillStyle=d,this.ctx.translate(h,m),this.ctx.fill(),this.ctx.translate(-h,-m)},o.prototype.resizeImage=function(c,d,h){var m;if(c.width===d&&c.height===h)return c;var g=(m=this.canvas.ownerDocument)!==null&&m!==void 0?m:document,x=g.createElement("canvas");x.width=Math.max(1,d),x.height=Math.max(1,h);var v=x.getContext("2d");return v.drawImage(c,0,0,c.width,c.height,0,0,d,h),x},o.prototype.renderBackgroundImage=function(c){return xo(this,void 0,void 0,function(){var d,h,m,g,x,v;return $a(this,function(E){switch(E.label){case 0:d=c.styles.backgroundImage.length-1,h=function(S){var I,k,R,Ae,he,Ce,se,oe,le,O,Ae,he,Ce,se,oe,F,M,Q,Z,$,X,be,me,Ne,le,H,Ae,J,Y,se,oe,Te,he,Ce,ee,Be,He,Ue,re,ve,fe,Ie;return $a(this,function(je){switch(je.label){case 0:if(S.type!==0)return[3,5];I=void 0,k=S.url,je.label=1;case 1:return je.trys.push([1,3,,4]),[4,m.context.cache.match(k)];case 2:return I=je.sent(),[3,4];case 3:return je.sent(),m.context.logger.error("Error loading background-image "+k),[3,4];case 4:return I&&(R=bT(c,d,[I.width,I.height,I.width/I.height]),Ae=R[0],he=R[1],Ce=R[2],se=R[3],oe=R[4],le=m.ctx.createPattern(m.resizeImage(I,se,oe),"repeat"),m.renderRepeat(Ae,le,he,Ce)),[3,6];case 5:HAe(S)?(O=bT(c,d,[null,null,null]),Ae=O[0],he=O[1],Ce=O[2],se=O[3],oe=O[4],F=UAe(S.angle,se,oe),M=F[0],Q=F[1],Z=F[2],$=F[3],X=F[4],be=document.createElement("canvas"),be.width=se,be.height=oe,me=be.getContext("2d"),Ne=me.createLinearGradient(Q,$,Z,X),n8(S.stops,M).forEach(function(Ee){return Ne.addColorStop(Ee.stop,ba(Ee.color))}),me.fillStyle=Ne,me.fillRect(0,0,se,oe),se>0&&oe>0&&(le=m.ctx.createPattern(be,"repeat"),m.renderRepeat(Ae,le,he,Ce))):GAe(S)&&(H=bT(c,d,[null,null,null]),Ae=H[0],J=H[1],Y=H[2],se=H[3],oe=H[4],Te=S.position.length===0?[AI]:S.position,he=jn(Te[0],se),Ce=jn(Te[Te.length-1],oe),ee=FAe(S,he,Ce,se,oe),Be=ee[0],He=ee[1],Be>0&&He>0&&(Ue=m.ctx.createRadialGradient(J+he,Y+Ce,0,J+he,Y+Ce,Be),n8(S.stops,Be*2).forEach(function(Ee){return Ue.addColorStop(Ee.stop,ba(Ee.color))}),m.path(Ae),m.ctx.fillStyle=Ue,Be!==He?(re=c.bounds.left+.5*c.bounds.width,ve=c.bounds.top+.5*c.bounds.height,fe=He/Be,Ie=1/fe,m.ctx.save(),m.ctx.translate(re,ve),m.ctx.transform(1,0,0,fe,0,0),m.ctx.translate(-re,-ve),m.ctx.fillRect(J,Ie*(Y-ve)+ve,se,oe*Ie),m.ctx.restore()):m.ctx.fill())),je.label=6;case 6:return d--,[2]}})},m=this,g=0,x=c.styles.backgroundImage.slice(0).reverse(),E.label=1;case 1:return g<x.length?(v=x[g],[5,h(v)]):[3,4];case 2:E.sent(),E.label=3;case 3:return g++,[3,1];case 4:return[2]}})})},o.prototype.renderSolidBorder=function(c,d,h){return xo(this,void 0,void 0,function(){return $a(this,function(m){return this.path(L8(h,d)),this.ctx.fillStyle=ba(c),this.ctx.fill(),[2]})})},o.prototype.renderDoubleBorder=function(c,d,h,m){return xo(this,void 0,void 0,function(){var g,x;return $a(this,function(v){switch(v.label){case 0:return d<3?[4,this.renderSolidBorder(c,h,m)]:[3,2];case 1:return v.sent(),[2];case 2:return g=zpe(m,h),this.path(g),this.ctx.fillStyle=ba(c),this.ctx.fill(),x=qpe(m,h),this.path(x),this.ctx.fill(),[2]}})})},o.prototype.renderNodeBackgroundAndBorders=function(c){return xo(this,void 0,void 0,function(){var d,h,m,g,x,v,E,S,I=this;return $a(this,function(k){switch(k.label){case 0:return this.applyEffects(c.getEffects(2)),d=c.container.styles,h=!ch(d.backgroundColor)||d.backgroundImage.length,m=[{style:d.borderTopStyle,color:d.borderTopColor,width:d.borderTopWidth},{style:d.borderRightStyle,color:d.borderRightColor,width:d.borderRightWidth},{style:d.borderBottomStyle,color:d.borderBottomColor,width:d.borderBottomWidth},{style:d.borderLeftStyle,color:d.borderLeftColor,width:d.borderLeftWidth}],g=ime(lg(d.backgroundClip,0),c.curves),h||d.boxShadow.length?(this.ctx.save(),this.path(g),this.ctx.clip(),ch(d.backgroundColor)||(this.ctx.fillStyle=ba(d.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:k.sent(),this.ctx.restore(),d.boxShadow.slice(0).reverse().forEach(function(R){I.ctx.save();var O=Wy(c.curves),F=R.inset?0:sme,M=Kpe(O,-F+(R.inset?1:-1)*R.spread.number,(R.inset?1:-1)*R.spread.number,R.spread.number*(R.inset?-2:2),R.spread.number*(R.inset?-2:2));R.inset?(I.path(O),I.ctx.clip(),I.mask(M)):(I.mask(O),I.ctx.clip(),I.path(M)),I.ctx.shadowOffsetX=R.offsetX.number+F,I.ctx.shadowOffsetY=R.offsetY.number,I.ctx.shadowColor=ba(R.color),I.ctx.shadowBlur=R.blur.number,I.ctx.fillStyle=R.inset?ba(R.color):"rgba(0,0,0,1)",I.ctx.fill(),I.ctx.restore()}),k.label=2;case 2:x=0,v=0,E=m,k.label=3;case 3:return v<E.length?(S=E[v],S.style!==0&&!ch(S.color)&&S.width>0?S.style!==2?[3,5]:[4,this.renderDashedDottedBorder(S.color,S.width,x,c.curves,2)]:[3,11]):[3,13];case 4:return k.sent(),[3,11];case 5:return S.style!==3?[3,7]:[4,this.renderDashedDottedBorder(S.color,S.width,x,c.curves,3)];case 6:return k.sent(),[3,11];case 7:return S.style!==4?[3,9]:[4,this.renderDoubleBorder(S.color,S.width,x,c.curves)];case 8:return k.sent(),[3,11];case 9:return[4,this.renderSolidBorder(S.color,x,c.curves)];case 10:k.sent(),k.label=11;case 11:x++,k.label=12;case 12:return v++,[3,3];case 13:return[2]}})})},o.prototype.renderDashedDottedBorder=function(c,d,h,m,g){return xo(this,void 0,void 0,function(){var x,v,E,S,I,k,R,O,F,M,Q,Z,$,X,be,me,be,me;return $a(this,function(Ne){return this.ctx.save(),x=Ype(m,h),v=L8(m,h),g===2&&(this.path(v),this.ctx.clip()),rl(v[0])?(E=v[0].start.x,S=v[0].start.y):(E=v[0].x,S=v[0].y),rl(v[1])?(I=v[1].end.x,k=v[1].end.y):(I=v[1].x,k=v[1].y),h===0||h===2?R=Math.abs(E-I):R=Math.abs(S-k),this.ctx.beginPath(),g===3?this.formatPath(x):this.formatPath(v.slice(0,2)),O=d<3?d*3:d*2,F=d<3?d*2:d,g===3&&(O=d,F=d),M=!0,R<=O*2?M=!1:R<=O*2+F?(Q=R/(2*O+F),O*=Q,F*=Q):(Z=Math.floor((R+F)/(O+F)),$=(R-Z*O)/(Z-1),X=(R-(Z+1)*O)/Z,F=X<=0||Math.abs(F-$)<Math.abs(F-X)?$:X),M&&(g===3?this.ctx.setLineDash([0,O+F]):this.ctx.setLineDash([O,F])),g===3?(this.ctx.lineCap="round",this.ctx.lineWidth=d):this.ctx.lineWidth=d*2+1.1,this.ctx.strokeStyle=ba(c),this.ctx.stroke(),this.ctx.setLineDash([]),g===2&&(rl(v[0])&&(be=v[3],me=v[0],this.ctx.beginPath(),this.formatPath([new hs(be.end.x,be.end.y),new hs(me.start.x,me.start.y)]),this.ctx.stroke()),rl(v[1])&&(be=v[1],me=v[2],this.ctx.beginPath(),this.formatPath([new hs(be.end.x,be.end.y),new hs(me.start.x,me.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},o.prototype.render=function(c){return xo(this,void 0,void 0,function(){var d;return $a(this,function(h){switch(h.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ba(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),d=Wpe(c),[4,this.renderStack(d)];case 1:return h.sent(),this.applyEffects([]),[2,this.canvas]}})})},o}(I7),nme=function(a){return a instanceof h7||a instanceof u7?!0:a instanceof mI&&a.type!==Hy&&a.type!==Qy},ime=function(a,o){switch(a){case 0:return Wy(o);case 2:return Mpe(o);case 1:default:return zy(o)}},ame=function(a){switch(a){case 1:return"center";case 2:return"right";case 0:default:return"left"}},ome=["-apple-system","system-ui"],cme=function(a){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?a.filter(function(o){return ome.indexOf(o)===-1}):a},lme=function(a){sd(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.canvas=d.canvas?d.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),h.options=d,h.canvas.width=Math.floor(d.width*d.scale),h.canvas.height=Math.floor(d.height*d.scale),h.canvas.style.width=d.width+"px",h.canvas.style.height=d.height+"px",h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-d.x,-d.y),h.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+d.width+"x"+d.height+" at "+d.x+","+d.y+") with scale "+d.scale),h}return o.prototype.render=function(c){return xo(this,void 0,void 0,function(){var d,h;return $a(this,function(m){switch(m.label){case 0:return d=OR(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,c),[4,dme(d)];case 1:return h=m.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ba(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(h,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},o}(I7),dme=function(a){return new Promise(function(o,c){var d=new Image;d.onload=function(){o(d)},d.onerror=c,d.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(a))})},Ame=function(){function a(o){var c=o.id,d=o.enabled;this.id=c,this.enabled=d,this.start=Date.now()}return a.prototype.debug=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,U_([this.id,this.getTime()+"ms"],o)):this.info.apply(this,o))},a.prototype.getTime=function(){return Date.now()-this.start},a.prototype.info=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,U_([this.id,this.getTime()+"ms"],o))},a.prototype.warn=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,U_([this.id,this.getTime()+"ms"],o)):this.info.apply(this,o))},a.prototype.error=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,U_([this.id,this.getTime()+"ms"],o)):this.info.apply(this,o))},a.instances={},a}(),ume=function(){function a(o,c){var d;this.windowBounds=c,this.instanceName="#"+a.instanceCount++,this.logger=new Ame({id:this.instanceName,enabled:o.logging}),this.cache=(d=o.cache)!==null&&d!==void 0?d:new kpe(this,o)}return a.instanceCount=1,a}(),O7=function(a,o){return o===void 0&&(o={}),hme(a,o)};typeof window<"u"&&E7.setContext(window);var hme=function(a,o){return xo(void 0,void 0,void 0,function(){var c,d,h,m,g,x,v,E,S,I,k,R,O,F,M,Q,Z,$,X,be,Ne,me,Ne,le,H,Ae,J,Y,se,oe,Te,he,Ce,ee,Be,He,Ue,re,ve,fe;return $a(this,function(Ie){switch(Ie.label){case 0:if(!a||typeof a!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(c=a.ownerDocument,!c)throw new Error("Element is not attached to a Document");if(d=c.defaultView,!d)throw new Error("Document is not attached to a Window");return h={allowTaint:(le=o.allowTaint)!==null&&le!==void 0?le:!1,imageTimeout:(H=o.imageTimeout)!==null&&H!==void 0?H:15e3,proxy:o.proxy,useCORS:(Ae=o.useCORS)!==null&&Ae!==void 0?Ae:!1},m=fR({logging:(J=o.logging)!==null&&J!==void 0?J:!0,cache:o.cache},h),g={windowWidth:(Y=o.windowWidth)!==null&&Y!==void 0?Y:d.innerWidth,windowHeight:(se=o.windowHeight)!==null&&se!==void 0?se:d.innerHeight,scrollX:(oe=o.scrollX)!==null&&oe!==void 0?oe:d.pageXOffset,scrollY:(Te=o.scrollY)!==null&&Te!==void 0?Te:d.pageYOffset},x=new YA(g.scrollX,g.scrollY,g.windowWidth,g.windowHeight),v=new ume(m,x),E=(he=o.foreignObjectRendering)!==null&&he!==void 0?he:!1,S={allowTaint:(Ce=o.allowTaint)!==null&&Ce!==void 0?Ce:!1,onclone:o.onclone,ignoreElements:o.ignoreElements,inlineImages:E,copyStyles:E},v.logger.debug("Starting document clone with size "+x.width+"x"+x.height+" scrolled to "+-x.left+","+-x.top),I=new k8(v,a,S),k=I.clonedReferenceElement,k?[4,I.toIFrame(c,x)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return R=Ie.sent(),O=fI(k)||mpe(k)?Kle(k.ownerDocument):mE(v,k),F=O.width,M=O.height,Q=O.left,Z=O.top,$=pme(v,k,o.backgroundColor),X={canvas:o.canvas,backgroundColor:$,scale:(Be=(ee=o.scale)!==null&&ee!==void 0?ee:d.devicePixelRatio)!==null&&Be!==void 0?Be:1,x:((He=o.x)!==null&&He!==void 0?He:0)+Q,y:((Ue=o.y)!==null&&Ue!==void 0?Ue:0)+Z,width:(re=o.width)!==null&&re!==void 0?re:Math.ceil(F),height:(ve=o.height)!==null&&ve!==void 0?ve:Math.ceil(M)},E?(v.logger.debug("Document cloned, using foreign object rendering"),Ne=new lme(v,X),[4,Ne.render(k)]):[3,3];case 2:return be=Ie.sent(),[3,5];case 3:return v.logger.debug("Document cloned, element located at "+Q+","+Z+" with size "+F+"x"+M+" using computed rendering"),v.logger.debug("Starting DOM parsing"),me=f7(v,k),$===me.styles.backgroundColor&&(me.styles.backgroundColor=KA.TRANSPARENT),v.logger.debug("Starting renderer for element at "+X.x+","+X.y+" with size "+X.width+"x"+X.height),Ne=new rme(v,X),[4,Ne.render(me)];case 4:be=Ie.sent(),Ie.label=5;case 5:return(!((fe=o.removeContainer)!==null&&fe!==void 0)||fe)&&(k8.destroy(R)||v.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),v.logger.debug("Finished rendering"),[2,be]}})})},pme=function(a,o,c){var d=o.ownerDocument,h=d.documentElement?Vb(a,getComputedStyle(d.documentElement).backgroundColor):KA.TRANSPARENT,m=d.body?Vb(a,getComputedStyle(d.body).backgroundColor):KA.TRANSPARENT,g=typeof c=="string"?Vb(a,c):c===null?KA.TRANSPARENT:4294967295;return o===d.documentElement?ch(h)?ch(m)?g:m:h:g};const mme=Object.freeze(Object.defineProperty({__proto__:null,default:O7},Symbol.toStringTag,{value:"Module"})),fme="modulepreload",gme=function(a){return"/"+a},P8={},xT=function(o,c,d){let h=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),x=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));h=Promise.allSettled(c.map(v=>{if(v=gme(v),v in P8)return;P8[v]=!0;const E=v.endsWith(".css"),S=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${S}`))return;const I=document.createElement("link");if(I.rel=E?"stylesheet":fme,E||(I.as="script"),I.crossOrigin="",I.href=v,x&&I.setAttribute("nonce",x),document.head.appendChild(I),E)return new Promise((k,R)=>{I.addEventListener("load",k),I.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${v}`)))})}))}function m(g){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=g,window.dispatchEvent(x),!x.defaultPrevented)throw g}return h.then(g=>{for(const x of g||[])x.status==="rejected"&&m(x.reason);return o().catch(m)})};function bn(a){"@babel/helpers - typeof";return bn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},bn(a)}var ed=Uint8Array,_c=Uint16Array,gI=Int32Array,bI=new ed([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xI=new ed([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),U8=new ed([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k7=function(a,o){for(var c=new _c(31),d=0;d<31;++d)c[d]=o+=1<<a[d-1];for(var h=new gI(c[30]),d=1;d<30;++d)for(var m=c[d];m<c[d+1];++m)h[m]=m-c[d]<<5|d;return{b:c,r:h}},D7=k7(bI,2),bme=D7.b,UR=D7.r;bme[28]=258,UR[258]=28;var xme=k7(xI,0),F8=xme.r,FR=new _c(32768);for(var zn=0;zn<32768;++zn){var zu=(zn&43690)>>1|(zn&21845)<<1;zu=(zu&52428)>>2|(zu&13107)<<2,zu=(zu&61680)>>4|(zu&3855)<<4,FR[zn]=((zu&65280)>>8|(zu&255)<<8)>>1}var Kb=function(a,o,c){for(var d=a.length,h=0,m=new _c(o);h<d;++h)a[h]&&++m[a[h]-1];var g=new _c(o);for(h=1;h<o;++h)g[h]=g[h-1]+m[h-1]<<1;var x;if(c){x=new _c(1<<o);var v=15-o;for(h=0;h<d;++h)if(a[h])for(var E=h<<4|a[h],S=o-a[h],I=g[a[h]-1]++<<S,k=I|(1<<S)-1;I<=k;++I)x[FR[I]>>v]=E}else for(x=new _c(d),h=0;h<d;++h)a[h]&&(x[h]=FR[g[a[h]-1]++]>>15-a[h]);return x},$p=new ed(288);for(var zn=0;zn<144;++zn)$p[zn]=8;for(var zn=144;zn<256;++zn)$p[zn]=9;for(var zn=256;zn<280;++zn)$p[zn]=7;for(var zn=280;zn<288;++zn)$p[zn]=8;var Yy=new ed(32);for(var zn=0;zn<32;++zn)Yy[zn]=5;var vme=Kb($p,9,0),wme=Kb(Yy,5,0),B7=function(a){return(a+7)/8|0},_me=function(a,o,c){return(c==null||c>a.length)&&(c=a.length),new ed(a.subarray(o,c))},MA=function(a,o,c){c<<=o&7;var d=o/8|0;a[d]|=c,a[d+1]|=c>>8},Rb=function(a,o,c){c<<=o&7;var d=o/8|0;a[d]|=c,a[d+1]|=c>>8,a[d+2]|=c>>16},vT=function(a,o){for(var c=[],d=0;d<a.length;++d)a[d]&&c.push({s:d,f:a[d]});var h=c.length,m=c.slice();if(!h)return{t:j7,l:0};if(h==1){var g=new ed(c[0].s+1);return g[c[0].s]=1,{t:g,l:1}}c.sort(function(be,me){return be.f-me.f}),c.push({s:-1,f:25001});var x=c[0],v=c[1],E=0,S=1,I=2;for(c[0]={s:-1,f:x.f+v.f,l:x,r:v};S!=h-1;)x=c[c[E].f<c[I].f?E++:I++],v=c[E!=S&&c[E].f<c[I].f?E++:I++],c[S++]={s:-1,f:x.f+v.f,l:x,r:v};for(var k=m[0].s,d=1;d<h;++d)m[d].s>k&&(k=m[d].s);var R=new _c(k+1),O=MR(c[S-1],R,0);if(O>o){var d=0,F=0,M=O-o,Q=1<<M;for(m.sort(function(me,Ne){return R[Ne.s]-R[me.s]||me.f-Ne.f});d<h;++d){var Z=m[d].s;if(R[Z]>o)F+=Q-(1<<O-R[Z]),R[Z]=o;else break}for(F>>=M;F>0;){var $=m[d].s;R[$]<o?F-=1<<o-R[$]++-1:++d}for(;d>=0&&F;--d){var X=m[d].s;R[X]==o&&(--R[X],++F)}O=o}return{t:new ed(R),l:O}},MR=function(a,o,c){return a.s==-1?Math.max(MR(a.l,o,c+1),MR(a.r,o,c+1)):o[a.s]=c},M8=function(a){for(var o=a.length;o&&!a[--o];);for(var c=new _c(++o),d=0,h=a[0],m=1,g=function(v){c[d++]=v},x=1;x<=o;++x)if(a[x]==h&&x!=o)++m;else{if(!h&&m>2){for(;m>138;m-=138)g(32754);m>2&&(g(m>10?m-11<<5|28690:m-3<<5|12305),m=0)}else if(m>3){for(g(h),--m;m>6;m-=6)g(8304);m>2&&(g(m-3<<5|8208),m=0)}for(;m--;)g(h);m=1,h=a[x]}return{c:c.subarray(0,d),n:o}},Ib=function(a,o){for(var c=0,d=0;d<o.length;++d)c+=a[d]*o[d];return c},L7=function(a,o,c){var d=c.length,h=B7(o+2);a[h]=d&255,a[h+1]=d>>8,a[h+2]=a[h]^255,a[h+3]=a[h+1]^255;for(var m=0;m<d;++m)a[h+m+4]=c[m];return(h+4+d)*8},V8=function(a,o,c,d,h,m,g,x,v,E,S){MA(o,S++,c),++h[256];for(var I=vT(h,15),k=I.t,R=I.l,O=vT(m,15),F=O.t,M=O.l,Q=M8(k),Z=Q.c,$=Q.n,X=M8(F),be=X.c,me=X.n,Ne=new _c(19),le=0;le<Z.length;++le)++Ne[Z[le]&31];for(var le=0;le<be.length;++le)++Ne[be[le]&31];for(var H=vT(Ne,7),Ae=H.t,J=H.l,Y=19;Y>4&&!Ae[U8[Y-1]];--Y);var se=E+5<<3,oe=Ib(h,$p)+Ib(m,Yy)+g,Te=Ib(h,k)+Ib(m,F)+g+14+3*Y+Ib(Ne,Ae)+2*Ne[16]+3*Ne[17]+7*Ne[18];if(v>=0&&se<=oe&&se<=Te)return L7(o,S,a.subarray(v,v+E));var he,Ce,ee,Be;if(MA(o,S,1+(Te<oe)),S+=2,Te<oe){he=Kb(k,R,0),Ce=k,ee=Kb(F,M,0),Be=F;var He=Kb(Ae,J,0);MA(o,S,$-257),MA(o,S+5,me-1),MA(o,S+10,Y-4),S+=14;for(var le=0;le<Y;++le)MA(o,S+3*le,Ae[U8[le]]);S+=3*Y;for(var Ue=[Z,be],re=0;re<2;++re)for(var ve=Ue[re],le=0;le<ve.length;++le){var fe=ve[le]&31;MA(o,S,He[fe]),S+=Ae[fe],fe>15&&(MA(o,S,ve[le]>>5&127),S+=ve[le]>>12)}}else he=vme,Ce=$p,ee=wme,Be=Yy;for(var le=0;le<x;++le){var Ie=d[le];if(Ie>255){var fe=Ie>>18&31;Rb(o,S,he[fe+257]),S+=Ce[fe+257],fe>7&&(MA(o,S,Ie>>23&31),S+=bI[fe]);var je=Ie&31;Rb(o,S,ee[je]),S+=Be[je],je>3&&(Rb(o,S,Ie>>5&8191),S+=xI[je])}else Rb(o,S,he[Ie]),S+=Ce[Ie]}return Rb(o,S,he[256]),S+Ce[256]},yme=new gI([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),j7=new ed(0),Eme=function(a,o,c,d,h,m){var g=m.z||a.length,x=new ed(d+g+5*(1+Math.ceil(g/7e3))+h),v=x.subarray(d,x.length-h),E=m.l,S=(m.r||0)&7;if(o){S&&(v[0]=m.r>>3);for(var I=yme[o-1],k=I>>13,R=I&8191,O=(1<<c)-1,F=m.p||new _c(32768),M=m.h||new _c(O+1),Q=Math.ceil(c/3),Z=2*Q,$=function(Nt){return(a[Nt]^a[Nt+1]<<Q^a[Nt+2]<<Z)&O},X=new gI(25e3),be=new _c(288),me=new _c(32),Ne=0,le=0,H=m.i||0,Ae=0,J=m.w||0,Y=0;H+2<g;++H){var se=$(H),oe=H&32767,Te=M[se];if(F[oe]=Te,M[se]=oe,J<=H){var he=g-H;if((Ne>7e3||Ae>24576)&&(he>423||!E)){S=V8(a,v,0,X,be,me,le,Ae,Y,H-Y,S),Ae=Ne=le=0,Y=H;for(var Ce=0;Ce<286;++Ce)be[Ce]=0;for(var Ce=0;Ce<30;++Ce)me[Ce]=0}var ee=2,Be=0,He=R,Ue=oe-Te&32767;if(he>2&&se==$(H-Ue))for(var re=Math.min(k,he)-1,ve=Math.min(32767,H),fe=Math.min(258,he);Ue<=ve&&--He&&oe!=Te;){if(a[H+ee]==a[H+ee-Ue]){for(var Ie=0;Ie<fe&&a[H+Ie]==a[H+Ie-Ue];++Ie);if(Ie>ee){if(ee=Ie,Be=Ue,Ie>re)break;for(var je=Math.min(Ue,Ie-2),Ee=0,Ce=0;Ce<je;++Ce){var We=H-Ue+Ce&32767,ze=F[We],st=We-ze&32767;st>Ee&&(Ee=st,Te=We)}}}oe=Te,Te=F[oe],Ue+=oe-Te&32767}if(Be){X[Ae++]=268435456|UR[ee]<<18|F8[Be];var bt=UR[ee]&31,Qe=F8[Be]&31;le+=bI[bt]+xI[Qe],++be[257+bt],++me[Qe],J=H+ee,++Ne}else X[Ae++]=a[H],++be[a[H]]}}for(H=Math.max(H,J);H<g;++H)X[Ae++]=a[H],++be[a[H]];S=V8(a,v,E,X,be,me,le,Ae,Y,H-Y,S),E||(m.r=S&7|v[S/8|0]<<3,S-=7,m.h=M,m.p=F,m.i=H,m.w=J)}else{for(var H=m.w||0;H<g+E;H+=65535){var rt=H+65535;rt>=g&&(v[S/8|0]=E,rt=g),S=L7(v,S+1,a.subarray(H,rt))}m.i=g}return _me(x,0,d+B7(S)+h)},P7=function(){var a=1,o=0;return{p:function(c){for(var d=a,h=o,m=c.length|0,g=0;g!=m;){for(var x=Math.min(g+2655,m);g<x;++g)h+=d+=c[g];d=(d&65535)+15*(d>>16),h=(h&65535)+15*(h>>16)}a=d,o=h},d:function(){return a%=65521,o%=65521,(a&255)<<24|(a&65280)<<8|(o&255)<<8|o>>8}}},Sme=function(a,o,c,d,h){if(!h&&(h={l:1},o.dictionary)){var m=o.dictionary.subarray(-32768),g=new ed(m.length+a.length);g.set(m),g.set(a,m.length),a=g,h.w=m.length}return Eme(a,o.level==null?6:o.level,o.mem==null?h.l?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):20:12+o.mem,c,d,h)},U7=function(a,o,c){for(;c;++o)a[o]=c,c>>>=8},Cme=function(a,o){var c=o.level,d=c==0?0:c<6?1:c==9?3:2;if(a[0]=120,a[1]=d<<6|(o.dictionary&&32),a[1]|=31-(a[0]<<8|a[1])%31,o.dictionary){var h=P7();h.p(o.dictionary),U7(a,2,h.d())}};function VR(a,o){o||(o={});var c=P7();c.p(a);var d=Sme(a,o,o.dictionary?6:2,4);return Cme(d,o),U7(d,d.length-4,c.d()),d}var Nme=typeof TextDecoder<"u"&&new TextDecoder,Tme=0;try{Nme.decode(j7,{stream:!0}),Tme=1}catch{}function Rme(a){if(Array.isArray(a))return a}function Ime(a,o){var c=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(c!=null){var d,h,m,g,x=[],v=!0,E=!1;try{if(m=(c=c.call(a)).next,o!==0)for(;!(v=(d=m.call(c)).done)&&(x.push(d.value),x.length!==o);v=!0);}catch(S){E=!0,h=S}finally{try{if(!v&&c.return!=null&&(g=c.return(),Object(g)!==g))return}finally{if(E)throw h}}return x}}function Q8(a,o){(o==null||o>a.length)&&(o=a.length);for(var c=0,d=Array(o);c<o;c++)d[c]=a[c];return d}function Ome(a,o){if(a){if(typeof a=="string")return Q8(a,o);var c={}.toString.call(a).slice(8,-1);return c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set"?Array.from(a):c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?Q8(a,o):void 0}}function kme(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H8(a,o){return Rme(a)||Ime(a,o)||Ome(a,o)||kme()}function G8(a,o="utf8"){return new TextDecoder(o).decode(a)}const Dme=new TextEncoder;function Bme(a){return Dme.encode(a)}const Lme=1024*8,jme=(()=>{const a=new Uint8Array(4),o=new Uint32Array(a.buffer);return!((o[0]=1)&a[0])})(),wT={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class vI{constructor(o=Lme,c={}){gn(this,"buffer");gn(this,"byteLength");gn(this,"byteOffset");gn(this,"length");gn(this,"offset");gn(this,"lastWrittenByte");gn(this,"littleEndian");gn(this,"_data");gn(this,"_mark");gn(this,"_marks");let d=!1;typeof o=="number"?o=new ArrayBuffer(o):(d=!0,this.lastWrittenByte=o.byteLength);const h=c.offset?c.offset>>>0:0,m=o.byteLength-h;let g=h;(ArrayBuffer.isView(o)||o instanceof vI)&&(o.byteLength!==o.buffer.byteLength&&(g=o.byteOffset+h),o=o.buffer),d?this.lastWrittenByte=m:this.lastWrittenByte=0,this.buffer=o,this.length=m,this.byteLength=m,this.byteOffset=g,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,g,m),this._mark=0,this._marks=[]}available(o=1){return this.offset+o<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(o=1){return this.offset+=o,this}back(o=1){return this.offset-=o,this}seek(o){return this.offset=o,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const o=this._marks.pop();if(o===void 0)throw new Error("Mark stack empty");return this.seek(o),this}rewind(){return this.offset=0,this}ensureAvailable(o=1){if(!this.available(o)){const d=(this.offset+o)*2,h=new Uint8Array(d);h.set(new Uint8Array(this.buffer)),this.buffer=h.buffer,this.length=d,this.byteLength=d,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(o=1){return this.readArray(o,"uint8")}readArray(o,c){const d=wT[c].BYTES_PER_ELEMENT*o,h=this.byteOffset+this.offset,m=this.buffer.slice(h,h+d);if(this.littleEndian===jme&&c!=="uint8"&&c!=="int8"){const x=new Uint8Array(this.buffer.slice(h,h+d));x.reverse();const v=new wT[c](x.buffer);return this.offset+=d,v.reverse(),v}const g=new wT[c](m);return this.offset+=d,g}readInt16(){const o=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,o}readUint16(){const o=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,o}readInt32(){const o=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,o}readUint32(){const o=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,o}readFloat32(){const o=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,o}readFloat64(){const o=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,o}readBigInt64(){const o=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,o}readBigUint64(){const o=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,o}readChar(){return String.fromCharCode(this.readInt8())}readChars(o=1){let c="";for(let d=0;d<o;d++)c+=this.readChar();return c}readUtf8(o=1){return G8(this.readBytes(o))}decodeText(o=1,c="utf8"){return G8(this.readBytes(o),c)}writeBoolean(o){return this.writeUint8(o?255:0),this}writeInt8(o){return this.ensureAvailable(1),this._data.setInt8(this.offset++,o),this._updateLastWrittenByte(),this}writeUint8(o){return this.ensureAvailable(1),this._data.setUint8(this.offset++,o),this._updateLastWrittenByte(),this}writeByte(o){return this.writeUint8(o)}writeBytes(o){this.ensureAvailable(o.length);for(let c=0;c<o.length;c++)this._data.setUint8(this.offset++,o[c]);return this._updateLastWrittenByte(),this}writeInt16(o){return this.ensureAvailable(2),this._data.setInt16(this.offset,o,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(o){return this.ensureAvailable(2),this._data.setUint16(this.offset,o,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(o){return this.ensureAvailable(4),this._data.setInt32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(o){return this.ensureAvailable(4),this._data.setUint32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(o){return this.ensureAvailable(4),this._data.setFloat32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(o){return this.ensureAvailable(8),this._data.setFloat64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(o){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(o){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(o){return this.writeUint8(o.charCodeAt(0))}writeChars(o){for(let c=0;c<o.length;c++)this.writeUint8(o.charCodeAt(c));return this}writeUtf8(o){return this.writeBytes(Bme(o))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function kg(a){let o=a.length;for(;--o>=0;)a[o]=0}const Pme=3,Ume=258,F7=29,Fme=256,Mme=Fme+1+F7,M7=30,Vme=512,Qme=new Array((Mme+2)*2);kg(Qme);const Hme=new Array(M7*2);kg(Hme);const Gme=new Array(Vme);kg(Gme);const Kme=new Array(Ume-Pme+1);kg(Kme);const Wme=new Array(F7);kg(Wme);const zme=new Array(M7);kg(zme);const qme=(a,o,c,d)=>{let h=a&65535|0,m=a>>>16&65535|0,g=0;for(;c!==0;){g=c>2e3?2e3:c,c-=g;do h=h+o[d++]|0,m=m+h|0;while(--g);h%=65521,m%=65521}return h|m<<16|0};var QR=qme;const Yme=()=>{let a,o=[];for(var c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=a&1?3988292384^a>>>1:a>>>1;o[c]=a}return o},Xme=new Uint32Array(Yme()),Jme=(a,o,c,d)=>{const h=Xme,m=d+c;a^=-1;for(let g=d;g<m;g++)a=a>>>8^h[(a^o[g])&255];return a^-1};var Kd=Jme,HR={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},V7={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const $me=(a,o)=>Object.prototype.hasOwnProperty.call(a,o);var Zme=function(a){const o=Array.prototype.slice.call(arguments,1);for(;o.length;){const c=o.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(const d in c)$me(c,d)&&(a[d]=c[d])}}return a},efe=a=>{let o=0;for(let d=0,h=a.length;d<h;d++)o+=a[d].length;const c=new Uint8Array(o);for(let d=0,h=0,m=a.length;d<m;d++){let g=a[d];c.set(g,h),h+=g.length}return c},Q7={assign:Zme,flattenChunks:efe};let H7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{H7=!1}const ex=new Uint8Array(256);for(let a=0;a<256;a++)ex[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;ex[254]=ex[254]=1;var tfe=a=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(a);let o,c,d,h,m,g=a.length,x=0;for(h=0;h<g;h++)c=a.charCodeAt(h),(c&64512)===55296&&h+1<g&&(d=a.charCodeAt(h+1),(d&64512)===56320&&(c=65536+(c-55296<<10)+(d-56320),h++)),x+=c<128?1:c<2048?2:c<65536?3:4;for(o=new Uint8Array(x),m=0,h=0;m<x;h++)c=a.charCodeAt(h),(c&64512)===55296&&h+1<g&&(d=a.charCodeAt(h+1),(d&64512)===56320&&(c=65536+(c-55296<<10)+(d-56320),h++)),c<128?o[m++]=c:c<2048?(o[m++]=192|c>>>6,o[m++]=128|c&63):c<65536?(o[m++]=224|c>>>12,o[m++]=128|c>>>6&63,o[m++]=128|c&63):(o[m++]=240|c>>>18,o[m++]=128|c>>>12&63,o[m++]=128|c>>>6&63,o[m++]=128|c&63);return o};const sfe=(a,o)=>{if(o<65534&&a.subarray&&H7)return String.fromCharCode.apply(null,a.length===o?a:a.subarray(0,o));let c="";for(let d=0;d<o;d++)c+=String.fromCharCode(a[d]);return c};var rfe=(a,o)=>{const c=o||a.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(a.subarray(0,o));let d,h;const m=new Array(c*2);for(h=0,d=0;d<c;){let g=a[d++];if(g<128){m[h++]=g;continue}let x=ex[g];if(x>4){m[h++]=65533,d+=x-1;continue}for(g&=x===2?31:x===3?15:7;x>1&&d<c;)g=g<<6|a[d++]&63,x--;if(x>1){m[h++]=65533;continue}g<65536?m[h++]=g:(g-=65536,m[h++]=55296|g>>10&1023,m[h++]=56320|g&1023)}return sfe(m,h)},nfe=(a,o)=>{o=o||a.length,o>a.length&&(o=a.length);let c=o-1;for(;c>=0&&(a[c]&192)===128;)c--;return c<0||c===0?o:c+ex[a[c]]>o?c:o},GR={string2buf:tfe,buf2string:rfe,utf8border:nfe};function ife(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var afe=ife;const oy=16209,ofe=16191;var cfe=function(o,c){let d,h,m,g,x,v,E,S,I,k,R,O,F,M,Q,Z,$,X,be,me,Ne,le,H,Ae;const J=o.state;d=o.next_in,H=o.input,h=d+(o.avail_in-5),m=o.next_out,Ae=o.output,g=m-(c-o.avail_out),x=m+(o.avail_out-257),v=J.dmax,E=J.wsize,S=J.whave,I=J.wnext,k=J.window,R=J.hold,O=J.bits,F=J.lencode,M=J.distcode,Q=(1<<J.lenbits)-1,Z=(1<<J.distbits)-1;e:do{O<15&&(R+=H[d++]<<O,O+=8,R+=H[d++]<<O,O+=8),$=F[R&Q];t:for(;;){if(X=$>>>24,R>>>=X,O-=X,X=$>>>16&255,X===0)Ae[m++]=$&65535;else if(X&16){be=$&65535,X&=15,X&&(O<X&&(R+=H[d++]<<O,O+=8),be+=R&(1<<X)-1,R>>>=X,O-=X),O<15&&(R+=H[d++]<<O,O+=8,R+=H[d++]<<O,O+=8),$=M[R&Z];s:for(;;){if(X=$>>>24,R>>>=X,O-=X,X=$>>>16&255,X&16){if(me=$&65535,X&=15,O<X&&(R+=H[d++]<<O,O+=8,O<X&&(R+=H[d++]<<O,O+=8)),me+=R&(1<<X)-1,me>v){o.msg="invalid distance too far back",J.mode=oy;break e}if(R>>>=X,O-=X,X=m-g,me>X){if(X=me-X,X>S&&J.sane){o.msg="invalid distance too far back",J.mode=oy;break e}if(Ne=0,le=k,I===0){if(Ne+=E-X,X<be){be-=X;do Ae[m++]=k[Ne++];while(--X);Ne=m-me,le=Ae}}else if(I<X){if(Ne+=E+I-X,X-=I,X<be){be-=X;do Ae[m++]=k[Ne++];while(--X);if(Ne=0,I<be){X=I,be-=X;do Ae[m++]=k[Ne++];while(--X);Ne=m-me,le=Ae}}}else if(Ne+=I-X,X<be){be-=X;do Ae[m++]=k[Ne++];while(--X);Ne=m-me,le=Ae}for(;be>2;)Ae[m++]=le[Ne++],Ae[m++]=le[Ne++],Ae[m++]=le[Ne++],be-=3;be&&(Ae[m++]=le[Ne++],be>1&&(Ae[m++]=le[Ne++]))}else{Ne=m-me;do Ae[m++]=Ae[Ne++],Ae[m++]=Ae[Ne++],Ae[m++]=Ae[Ne++],be-=3;while(be>2);be&&(Ae[m++]=Ae[Ne++],be>1&&(Ae[m++]=Ae[Ne++]))}}else if(X&64){o.msg="invalid distance code",J.mode=oy;break e}else{$=M[($&65535)+(R&(1<<X)-1)];continue s}break}}else if(X&64)if(X&32){J.mode=ofe;break e}else{o.msg="invalid literal/length code",J.mode=oy;break e}else{$=F[($&65535)+(R&(1<<X)-1)];continue t}break}}while(d<h&&m<x);be=O>>3,d-=be,O-=be<<3,R&=(1<<O)-1,o.next_in=d,o.next_out=m,o.avail_in=d<h?5+(h-d):5-(d-h),o.avail_out=m<x?257+(x-m):257-(m-x),J.hold=R,J.bits=O};const sg=15,K8=852,W8=592,z8=0,_T=1,q8=2,lfe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),dfe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Afe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ufe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),hfe=(a,o,c,d,h,m,g,x)=>{const v=x.bits;let E=0,S=0,I=0,k=0,R=0,O=0,F=0,M=0,Q=0,Z=0,$,X,be,me,Ne,le=null,H;const Ae=new Uint16Array(sg+1),J=new Uint16Array(sg+1);let Y=null,se,oe,Te;for(E=0;E<=sg;E++)Ae[E]=0;for(S=0;S<d;S++)Ae[o[c+S]]++;for(R=v,k=sg;k>=1&&Ae[k]===0;k--);if(R>k&&(R=k),k===0)return h[m++]=1<<24|64<<16|0,h[m++]=1<<24|64<<16|0,x.bits=1,0;for(I=1;I<k&&Ae[I]===0;I++);for(R<I&&(R=I),M=1,E=1;E<=sg;E++)if(M<<=1,M-=Ae[E],M<0)return-1;if(M>0&&(a===z8||k!==1))return-1;for(J[1]=0,E=1;E<sg;E++)J[E+1]=J[E]+Ae[E];for(S=0;S<d;S++)o[c+S]!==0&&(g[J[o[c+S]]++]=S);if(a===z8?(le=Y=g,H=20):a===_T?(le=lfe,Y=dfe,H=257):(le=Afe,Y=ufe,H=0),Z=0,S=0,E=I,Ne=m,O=R,F=0,be=-1,Q=1<<R,me=Q-1,a===_T&&Q>K8||a===q8&&Q>W8)return 1;for(;;){se=E-F,g[S]+1<H?(oe=0,Te=g[S]):g[S]>=H?(oe=Y[g[S]-H],Te=le[g[S]-H]):(oe=96,Te=0),$=1<<E-F,X=1<<O,I=X;do X-=$,h[Ne+(Z>>F)+X]=se<<24|oe<<16|Te|0;while(X!==0);for($=1<<E-1;Z&$;)$>>=1;if($!==0?(Z&=$-1,Z+=$):Z=0,S++,--Ae[E]===0){if(E===k)break;E=o[c+g[S]]}if(E>R&&(Z&me)!==be){for(F===0&&(F=R),Ne+=I,O=E-F,M=1<<O;O+F<k&&(M-=Ae[O+F],!(M<=0));)O++,M<<=1;if(Q+=1<<O,a===_T&&Q>K8||a===q8&&Q>W8)return 1;be=Z&me,h[be]=R<<24|O<<16|Ne-m|0}}return Z!==0&&(h[Ne+Z]=E-F<<24|64<<16|0),x.bits=R,0};var Wb=hfe;const pfe=0,G7=1,K7=2,{Z_FINISH:Y8,Z_BLOCK:mfe,Z_TREES:cy,Z_OK:Zp,Z_STREAM_END:ffe,Z_NEED_DICT:gfe,Z_STREAM_ERROR:dl,Z_DATA_ERROR:W7,Z_MEM_ERROR:z7,Z_BUF_ERROR:bfe,Z_DEFLATED:X8}=V7,SE=16180,J8=16181,$8=16182,Z8=16183,eV=16184,tV=16185,sV=16186,rV=16187,nV=16188,iV=16189,Xy=16190,VA=16191,yT=16192,aV=16193,ET=16194,oV=16195,cV=16196,lV=16197,dV=16198,ly=16199,dy=16200,AV=16201,uV=16202,hV=16203,pV=16204,mV=16205,ST=16206,fV=16207,gV=16208,ni=16209,q7=16210,Y7=16211,xfe=852,vfe=592,wfe=15,_fe=wfe,bV=a=>(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24);function yfe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const sm=a=>{if(!a)return 1;const o=a.state;return!o||o.strm!==a||o.mode<SE||o.mode>Y7?1:0},X7=a=>{if(sm(a))return dl;const o=a.state;return a.total_in=a.total_out=o.total=0,a.msg="",o.wrap&&(a.adler=o.wrap&1),o.mode=SE,o.last=0,o.havedict=0,o.flags=-1,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new Int32Array(xfe),o.distcode=o.distdyn=new Int32Array(vfe),o.sane=1,o.back=-1,Zp},J7=a=>{if(sm(a))return dl;const o=a.state;return o.wsize=0,o.whave=0,o.wnext=0,X7(a)},$7=(a,o)=>{let c;if(sm(a))return dl;const d=a.state;return o<0?(c=0,o=-o):(c=(o>>4)+5,o<48&&(o&=15)),o&&(o<8||o>15)?dl:(d.window!==null&&d.wbits!==o&&(d.window=null),d.wrap=c,d.wbits=o,J7(a))},Z7=(a,o)=>{if(!a)return dl;const c=new yfe;a.state=c,c.strm=a,c.window=null,c.mode=SE;const d=$7(a,o);return d!==Zp&&(a.state=null),d},Efe=a=>Z7(a,_fe);let xV=!0,CT,NT;const Sfe=a=>{if(xV){CT=new Int32Array(512),NT=new Int32Array(32);let o=0;for(;o<144;)a.lens[o++]=8;for(;o<256;)a.lens[o++]=9;for(;o<280;)a.lens[o++]=7;for(;o<288;)a.lens[o++]=8;for(Wb(G7,a.lens,0,288,CT,0,a.work,{bits:9}),o=0;o<32;)a.lens[o++]=5;Wb(K7,a.lens,0,32,NT,0,a.work,{bits:5}),xV=!1}a.lencode=CT,a.lenbits=9,a.distcode=NT,a.distbits=5},eG=(a,o,c,d)=>{let h;const m=a.state;return m.window===null&&(m.wsize=1<<m.wbits,m.wnext=0,m.whave=0,m.window=new Uint8Array(m.wsize)),d>=m.wsize?(m.window.set(o.subarray(c-m.wsize,c),0),m.wnext=0,m.whave=m.wsize):(h=m.wsize-m.wnext,h>d&&(h=d),m.window.set(o.subarray(c-d,c-d+h),m.wnext),d-=h,d?(m.window.set(o.subarray(c-d,c),0),m.wnext=d,m.whave=m.wsize):(m.wnext+=h,m.wnext===m.wsize&&(m.wnext=0),m.whave<m.wsize&&(m.whave+=h))),0},Cfe=(a,o)=>{let c,d,h,m,g,x,v,E,S,I,k,R,O,F,M=0,Q,Z,$,X,be,me,Ne,le;const H=new Uint8Array(4);let Ae,J;const Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(sm(a)||!a.output||!a.input&&a.avail_in!==0)return dl;c=a.state,c.mode===VA&&(c.mode=yT),g=a.next_out,h=a.output,v=a.avail_out,m=a.next_in,d=a.input,x=a.avail_in,E=c.hold,S=c.bits,I=x,k=v,le=Zp;e:for(;;)switch(c.mode){case SE:if(c.wrap===0){c.mode=yT;break}for(;S<16;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if(c.wrap&2&&E===35615){c.wbits===0&&(c.wbits=15),c.check=0,H[0]=E&255,H[1]=E>>>8&255,c.check=Kd(c.check,H,2,0),E=0,S=0,c.mode=J8;break}if(c.head&&(c.head.done=!1),!(c.wrap&1)||(((E&255)<<8)+(E>>8))%31){a.msg="incorrect header check",c.mode=ni;break}if((E&15)!==X8){a.msg="unknown compression method",c.mode=ni;break}if(E>>>=4,S-=4,Ne=(E&15)+8,c.wbits===0&&(c.wbits=Ne),Ne>15||Ne>c.wbits){a.msg="invalid window size",c.mode=ni;break}c.dmax=1<<c.wbits,c.flags=0,a.adler=c.check=1,c.mode=E&512?iV:VA,E=0,S=0;break;case J8:for(;S<16;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if(c.flags=E,(c.flags&255)!==X8){a.msg="unknown compression method",c.mode=ni;break}if(c.flags&57344){a.msg="unknown header flags set",c.mode=ni;break}c.head&&(c.head.text=E>>8&1),c.flags&512&&c.wrap&4&&(H[0]=E&255,H[1]=E>>>8&255,c.check=Kd(c.check,H,2,0)),E=0,S=0,c.mode=$8;case $8:for(;S<32;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}c.head&&(c.head.time=E),c.flags&512&&c.wrap&4&&(H[0]=E&255,H[1]=E>>>8&255,H[2]=E>>>16&255,H[3]=E>>>24&255,c.check=Kd(c.check,H,4,0)),E=0,S=0,c.mode=Z8;case Z8:for(;S<16;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}c.head&&(c.head.xflags=E&255,c.head.os=E>>8),c.flags&512&&c.wrap&4&&(H[0]=E&255,H[1]=E>>>8&255,c.check=Kd(c.check,H,2,0)),E=0,S=0,c.mode=eV;case eV:if(c.flags&1024){for(;S<16;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}c.length=E,c.head&&(c.head.extra_len=E),c.flags&512&&c.wrap&4&&(H[0]=E&255,H[1]=E>>>8&255,c.check=Kd(c.check,H,2,0)),E=0,S=0}else c.head&&(c.head.extra=null);c.mode=tV;case tV:if(c.flags&1024&&(R=c.length,R>x&&(R=x),R&&(c.head&&(Ne=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Uint8Array(c.head.extra_len)),c.head.extra.set(d.subarray(m,m+R),Ne)),c.flags&512&&c.wrap&4&&(c.check=Kd(c.check,d,R,m)),x-=R,m+=R,c.length-=R),c.length))break e;c.length=0,c.mode=sV;case sV:if(c.flags&2048){if(x===0)break e;R=0;do Ne=d[m+R++],c.head&&Ne&&c.length<65536&&(c.head.name+=String.fromCharCode(Ne));while(Ne&&R<x);if(c.flags&512&&c.wrap&4&&(c.check=Kd(c.check,d,R,m)),x-=R,m+=R,Ne)break e}else c.head&&(c.head.name=null);c.length=0,c.mode=rV;case rV:if(c.flags&4096){if(x===0)break e;R=0;do Ne=d[m+R++],c.head&&Ne&&c.length<65536&&(c.head.comment+=String.fromCharCode(Ne));while(Ne&&R<x);if(c.flags&512&&c.wrap&4&&(c.check=Kd(c.check,d,R,m)),x-=R,m+=R,Ne)break e}else c.head&&(c.head.comment=null);c.mode=nV;case nV:if(c.flags&512){for(;S<16;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if(c.wrap&4&&E!==(c.check&65535)){a.msg="header crc mismatch",c.mode=ni;break}E=0,S=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=VA;break;case iV:for(;S<32;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}a.adler=c.check=bV(E),E=0,S=0,c.mode=Xy;case Xy:if(c.havedict===0)return a.next_out=g,a.avail_out=v,a.next_in=m,a.avail_in=x,c.hold=E,c.bits=S,gfe;a.adler=c.check=1,c.mode=VA;case VA:if(o===mfe||o===cy)break e;case yT:if(c.last){E>>>=S&7,S-=S&7,c.mode=ST;break}for(;S<3;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}switch(c.last=E&1,E>>>=1,S-=1,E&3){case 0:c.mode=aV;break;case 1:if(Sfe(c),c.mode=ly,o===cy){E>>>=2,S-=2;break e}break;case 2:c.mode=cV;break;case 3:a.msg="invalid block type",c.mode=ni}E>>>=2,S-=2;break;case aV:for(E>>>=S&7,S-=S&7;S<32;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if((E&65535)!==(E>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ni;break}if(c.length=E&65535,E=0,S=0,c.mode=ET,o===cy)break e;case ET:c.mode=oV;case oV:if(R=c.length,R){if(R>x&&(R=x),R>v&&(R=v),R===0)break e;h.set(d.subarray(m,m+R),g),x-=R,m+=R,v-=R,g+=R,c.length-=R;break}c.mode=VA;break;case cV:for(;S<14;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if(c.nlen=(E&31)+257,E>>>=5,S-=5,c.ndist=(E&31)+1,E>>>=5,S-=5,c.ncode=(E&15)+4,E>>>=4,S-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ni;break}c.have=0,c.mode=lV;case lV:for(;c.have<c.ncode;){for(;S<3;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}c.lens[Y[c.have++]]=E&7,E>>>=3,S-=3}for(;c.have<19;)c.lens[Y[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,Ae={bits:c.lenbits},le=Wb(pfe,c.lens,0,19,c.lencode,0,c.work,Ae),c.lenbits=Ae.bits,le){a.msg="invalid code lengths set",c.mode=ni;break}c.have=0,c.mode=dV;case dV:for(;c.have<c.nlen+c.ndist;){for(;M=c.lencode[E&(1<<c.lenbits)-1],Q=M>>>24,Z=M>>>16&255,$=M&65535,!(Q<=S);){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if($<16)E>>>=Q,S-=Q,c.lens[c.have++]=$;else{if($===16){for(J=Q+2;S<J;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if(E>>>=Q,S-=Q,c.have===0){a.msg="invalid bit length repeat",c.mode=ni;break}Ne=c.lens[c.have-1],R=3+(E&3),E>>>=2,S-=2}else if($===17){for(J=Q+3;S<J;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}E>>>=Q,S-=Q,Ne=0,R=3+(E&7),E>>>=3,S-=3}else{for(J=Q+7;S<J;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}E>>>=Q,S-=Q,Ne=0,R=11+(E&127),E>>>=7,S-=7}if(c.have+R>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ni;break}for(;R--;)c.lens[c.have++]=Ne}}if(c.mode===ni)break;if(c.lens[256]===0){a.msg="invalid code -- missing end-of-block",c.mode=ni;break}if(c.lenbits=9,Ae={bits:c.lenbits},le=Wb(G7,c.lens,0,c.nlen,c.lencode,0,c.work,Ae),c.lenbits=Ae.bits,le){a.msg="invalid literal/lengths set",c.mode=ni;break}if(c.distbits=6,c.distcode=c.distdyn,Ae={bits:c.distbits},le=Wb(K7,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,Ae),c.distbits=Ae.bits,le){a.msg="invalid distances set",c.mode=ni;break}if(c.mode=ly,o===cy)break e;case ly:c.mode=dy;case dy:if(x>=6&&v>=258){a.next_out=g,a.avail_out=v,a.next_in=m,a.avail_in=x,c.hold=E,c.bits=S,cfe(a,k),g=a.next_out,h=a.output,v=a.avail_out,m=a.next_in,d=a.input,x=a.avail_in,E=c.hold,S=c.bits,c.mode===VA&&(c.back=-1);break}for(c.back=0;M=c.lencode[E&(1<<c.lenbits)-1],Q=M>>>24,Z=M>>>16&255,$=M&65535,!(Q<=S);){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if(Z&&!(Z&240)){for(X=Q,be=Z,me=$;M=c.lencode[me+((E&(1<<X+be)-1)>>X)],Q=M>>>24,Z=M>>>16&255,$=M&65535,!(X+Q<=S);){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}E>>>=X,S-=X,c.back+=X}if(E>>>=Q,S-=Q,c.back+=Q,c.length=$,Z===0){c.mode=mV;break}if(Z&32){c.back=-1,c.mode=VA;break}if(Z&64){a.msg="invalid literal/length code",c.mode=ni;break}c.extra=Z&15,c.mode=AV;case AV:if(c.extra){for(J=c.extra;S<J;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}c.length+=E&(1<<c.extra)-1,E>>>=c.extra,S-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=uV;case uV:for(;M=c.distcode[E&(1<<c.distbits)-1],Q=M>>>24,Z=M>>>16&255,$=M&65535,!(Q<=S);){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if(!(Z&240)){for(X=Q,be=Z,me=$;M=c.distcode[me+((E&(1<<X+be)-1)>>X)],Q=M>>>24,Z=M>>>16&255,$=M&65535,!(X+Q<=S);){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}E>>>=X,S-=X,c.back+=X}if(E>>>=Q,S-=Q,c.back+=Q,Z&64){a.msg="invalid distance code",c.mode=ni;break}c.offset=$,c.extra=Z&15,c.mode=hV;case hV:if(c.extra){for(J=c.extra;S<J;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}c.offset+=E&(1<<c.extra)-1,E>>>=c.extra,S-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ni;break}c.mode=pV;case pV:if(v===0)break e;if(R=k-v,c.offset>R){if(R=c.offset-R,R>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ni;break}R>c.wnext?(R-=c.wnext,O=c.wsize-R):O=c.wnext-R,R>c.length&&(R=c.length),F=c.window}else F=h,O=g-c.offset,R=c.length;R>v&&(R=v),v-=R,c.length-=R;do h[g++]=F[O++];while(--R);c.length===0&&(c.mode=dy);break;case mV:if(v===0)break e;h[g++]=c.length,v--,c.mode=dy;break;case ST:if(c.wrap){for(;S<32;){if(x===0)break e;x--,E|=d[m++]<<S,S+=8}if(k-=v,a.total_out+=k,c.total+=k,c.wrap&4&&k&&(a.adler=c.check=c.flags?Kd(c.check,h,k,g-k):QR(c.check,h,k,g-k)),k=v,c.wrap&4&&(c.flags?E:bV(E))!==c.check){a.msg="incorrect data check",c.mode=ni;break}E=0,S=0}c.mode=fV;case fV:if(c.wrap&&c.flags){for(;S<32;){if(x===0)break e;x--,E+=d[m++]<<S,S+=8}if(c.wrap&4&&E!==(c.total&4294967295)){a.msg="incorrect length check",c.mode=ni;break}E=0,S=0}c.mode=gV;case gV:le=ffe;break e;case ni:le=W7;break e;case q7:return z7;case Y7:default:return dl}return a.next_out=g,a.avail_out=v,a.next_in=m,a.avail_in=x,c.hold=E,c.bits=S,(c.wsize||k!==a.avail_out&&c.mode<ni&&(c.mode<ST||o!==Y8))&&eG(a,a.output,a.next_out,k-a.avail_out),I-=a.avail_in,k-=a.avail_out,a.total_in+=I,a.total_out+=k,c.total+=k,c.wrap&4&&k&&(a.adler=c.check=c.flags?Kd(c.check,h,k,a.next_out-k):QR(c.check,h,k,a.next_out-k)),a.data_type=c.bits+(c.last?64:0)+(c.mode===VA?128:0)+(c.mode===ly||c.mode===ET?256:0),(I===0&&k===0||o===Y8)&&le===Zp&&(le=bfe),le},Nfe=a=>{if(sm(a))return dl;let o=a.state;return o.window&&(o.window=null),a.state=null,Zp},Tfe=(a,o)=>{if(sm(a))return dl;const c=a.state;return c.wrap&2?(c.head=o,o.done=!1,Zp):dl},Rfe=(a,o)=>{const c=o.length;let d,h,m;return sm(a)||(d=a.state,d.wrap!==0&&d.mode!==Xy)?dl:d.mode===Xy&&(h=1,h=QR(h,o,c,0),h!==d.check)?W7:(m=eG(a,o,c,c),m?(d.mode=q7,z7):(d.havedict=1,Zp))};var Ife=J7,Ofe=$7,kfe=X7,Dfe=Efe,Bfe=Z7,Lfe=Cfe,jfe=Nfe,Pfe=Tfe,Ufe=Rfe,Ffe="pako inflate (from Nodeca project)",QA={inflateReset:Ife,inflateReset2:Ofe,inflateResetKeep:kfe,inflateInit:Dfe,inflateInit2:Bfe,inflate:Lfe,inflateEnd:jfe,inflateGetHeader:Pfe,inflateSetDictionary:Ufe,inflateInfo:Ffe};function Mfe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Vfe=Mfe;const tG=Object.prototype.toString,{Z_NO_FLUSH:Qfe,Z_FINISH:Hfe,Z_OK:tx,Z_STREAM_END:TT,Z_NEED_DICT:RT,Z_STREAM_ERROR:Gfe,Z_DATA_ERROR:vV,Z_MEM_ERROR:Kfe}=V7;function mx(a){this.options=Q7.assign({chunkSize:1024*64,windowBits:15,to:""},a||{});const o=this.options;o.raw&&o.windowBits>=0&&o.windowBits<16&&(o.windowBits=-o.windowBits,o.windowBits===0&&(o.windowBits=-15)),o.windowBits>=0&&o.windowBits<16&&!(a&&a.windowBits)&&(o.windowBits+=32),o.windowBits>15&&o.windowBits<48&&(o.windowBits&15||(o.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new afe,this.strm.avail_out=0;let c=QA.inflateInit2(this.strm,o.windowBits);if(c!==tx)throw new Error(HR[c]);if(this.header=new Vfe,QA.inflateGetHeader(this.strm,this.header),o.dictionary&&(typeof o.dictionary=="string"?o.dictionary=GR.string2buf(o.dictionary):tG.call(o.dictionary)==="[object ArrayBuffer]"&&(o.dictionary=new Uint8Array(o.dictionary)),o.raw&&(c=QA.inflateSetDictionary(this.strm,o.dictionary),c!==tx)))throw new Error(HR[c])}mx.prototype.push=function(a,o){const c=this.strm,d=this.options.chunkSize,h=this.options.dictionary;let m,g,x;if(this.ended)return!1;for(o===~~o?g=o:g=o===!0?Hfe:Qfe,tG.call(a)==="[object ArrayBuffer]"?c.input=new Uint8Array(a):c.input=a,c.next_in=0,c.avail_in=c.input.length;;){for(c.avail_out===0&&(c.output=new Uint8Array(d),c.next_out=0,c.avail_out=d),m=QA.inflate(c,g),m===RT&&h&&(m=QA.inflateSetDictionary(c,h),m===tx?m=QA.inflate(c,g):m===vV&&(m=RT));c.avail_in>0&&m===TT&&c.state.wrap>0&&a[c.next_in]!==0;)QA.inflateReset(c),m=QA.inflate(c,g);switch(m){case Gfe:case vV:case RT:case Kfe:return this.onEnd(m),this.ended=!0,!1}if(x=c.avail_out,c.next_out&&(c.avail_out===0||m===TT))if(this.options.to==="string"){let v=GR.utf8border(c.output,c.next_out),E=c.next_out-v,S=GR.buf2string(c.output,v);c.next_out=E,c.avail_out=d-E,E&&c.output.set(c.output.subarray(v,v+E),0),this.onData(S)}else this.onData(c.output.length===c.next_out?c.output:c.output.subarray(0,c.next_out));if(!(m===tx&&x===0)){if(m===TT)return m=QA.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,!0;if(c.avail_in===0)break}}return!0};mx.prototype.onData=function(a){this.chunks.push(a)};mx.prototype.onEnd=function(a){a===tx&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Q7.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};function Wfe(a,o){const c=new mx(o);if(c.push(a),c.err)throw c.msg||HR[c.err];return c.result}var zfe=mx,qfe=Wfe,Yfe={Inflate:zfe,inflate:qfe};const{Inflate:Xfe,inflate:Jfe}=Yfe;var wV=Xfe,$fe=Jfe;const sG=[];for(let a=0;a<256;a++){let o=a;for(let c=0;c<8;c++)o&1?o=3988292384^o>>>1:o=o>>>1;sG[a]=o}const _V=4294967295;function Zfe(a,o,c){let d=a;for(let h=0;h<c;h++)d=sG[(d^o[h])&255]^d>>>8;return d}function ege(a,o){return(Zfe(_V,a,o)^_V)>>>0}function yV(a,o,c){const d=a.readUint32(),h=ege(new Uint8Array(a.buffer,a.byteOffset+a.offset-o-4,o),o);if(h!==d)throw new Error(`CRC mismatch for chunk ${c}. Expected ${d}, found ${h}`)}function rG(a,o,c){for(let d=0;d<c;d++)o[d]=a[d]}function nG(a,o,c,d){let h=0;for(;h<d;h++)o[h]=a[h];for(;h<c;h++)o[h]=a[h]+o[h-d]&255}function iG(a,o,c,d){let h=0;if(c.length===0)for(;h<d;h++)o[h]=a[h];else for(;h<d;h++)o[h]=a[h]+c[h]&255}function aG(a,o,c,d,h){let m=0;if(c.length===0){for(;m<h;m++)o[m]=a[m];for(;m<d;m++)o[m]=a[m]+(o[m-h]>>1)&255}else{for(;m<h;m++)o[m]=a[m]+(c[m]>>1)&255;for(;m<d;m++)o[m]=a[m]+(o[m-h]+c[m]>>1)&255}}function oG(a,o,c,d,h){let m=0;if(c.length===0){for(;m<h;m++)o[m]=a[m];for(;m<d;m++)o[m]=a[m]+o[m-h]&255}else{for(;m<h;m++)o[m]=a[m]+c[m]&255;for(;m<d;m++)o[m]=a[m]+tge(o[m-h],c[m],c[m-h])&255}}function tge(a,o,c){const d=a+o-c,h=Math.abs(d-a),m=Math.abs(d-o),g=Math.abs(d-c);return h<=m&&h<=g?a:m<=g?o:c}function sge(a,o,c,d,h,m){switch(a){case 0:rG(o,c,h);break;case 1:nG(o,c,h,m);break;case 2:iG(o,c,d,h);break;case 3:aG(o,c,d,h,m);break;case 4:oG(o,c,d,h,m);break;default:throw new Error(`Unsupported filter: ${a}`)}}const rge=new Uint16Array([255]),nge=new Uint8Array(rge.buffer),ige=nge[0]===255;function age(a){const{data:o,width:c,height:d,channels:h,depth:m}=a,g=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],x=Math.ceil(m/8)*h,v=new Uint8Array(d*c*x);let E=0;for(let S=0;S<7;S++){const I=g[S],k=Math.ceil((c-I.x)/I.xStep),R=Math.ceil((d-I.y)/I.yStep);if(k<=0||R<=0)continue;const O=k*x,F=new Uint8Array(O);for(let M=0;M<R;M++){const Q=o[E++],Z=o.subarray(E,E+O);E+=O;const $=new Uint8Array(O);sge(Q,Z,$,F,O,x),F.set($);for(let X=0;X<k;X++){const be=I.x+X*I.xStep,me=I.y+M*I.yStep;if(!(be>=c||me>=d))for(let Ne=0;Ne<x;Ne++)v[(me*c+be)*x+Ne]=$[X*x+Ne]}}}if(m===16){const S=new Uint16Array(v.buffer);if(ige)for(let I=0;I<S.length;I++)S[I]=oge(S[I]);return S}else return v}function oge(a){return(a&255)<<8|a>>8&255}const cge=new Uint16Array([255]),lge=new Uint8Array(cge.buffer),dge=lge[0]===255,Age=new Uint8Array(0);function EV(a){const{data:o,width:c,height:d,channels:h,depth:m}=a,g=Math.ceil(m/8)*h,x=Math.ceil(m/8*h*c),v=new Uint8Array(d*x);let E=Age,S=0,I,k;for(let R=0;R<d;R++){switch(I=o.subarray(S+1,S+1+x),k=v.subarray(R*x,(R+1)*x),o[S]){case 0:rG(I,k,x);break;case 1:nG(I,k,x,g);break;case 2:iG(I,k,E,x);break;case 3:aG(I,k,E,x,g);break;case 4:oG(I,k,E,x,g);break;default:throw new Error(`Unsupported filter: ${o[S]}`)}E=k,S+=x+1}if(m===16){const R=new Uint16Array(v.buffer);if(dge)for(let O=0;O<R.length;O++)R[O]=uge(R[O]);return R}else return v}function uge(a){return(a&255)<<8|a>>8&255}const Sy=Uint8Array.of(137,80,78,71,13,10,26,10);function SV(a){if(!hge(a.readBytes(Sy.length)))throw new Error("wrong PNG signature")}function hge(a){if(a.length<Sy.length)return!1;for(let o=0;o<Sy.length;o++)if(a[o]!==Sy[o])return!1;return!0}const pge="tEXt",mge=0,cG=new TextDecoder("latin1");function fge(a){if(bge(a),a.length===0||a.length>79)throw new Error("keyword length must be between 1 and 79")}const gge=/^[\u0000-\u00FF]*$/;function bge(a){if(!gge.test(a))throw new Error("invalid latin1 text")}function xge(a,o,c){const d=lG(o);a[d]=vge(o,c-d.length-1)}function lG(a){for(a.mark();a.readByte()!==mge;);const o=a.offset;a.reset();const c=cG.decode(a.readBytes(o-a.offset-1));return a.skip(1),fge(c),c}function vge(a,o){return cG.decode(a.readBytes(o))}const xc={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},IT={UNKNOWN:-1,DEFLATE:0},CV={UNKNOWN:-1,ADAPTIVE:0},OT={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Ay={NONE:0,BACKGROUND:1,PREVIOUS:2},kT={SOURCE:0,OVER:1};class wge extends vI{constructor(c,d={}){super(c);gn(this,"_checkCrc");gn(this,"_inflator");gn(this,"_png");gn(this,"_apng");gn(this,"_end");gn(this,"_hasPalette");gn(this,"_palette");gn(this,"_hasTransparency");gn(this,"_transparency");gn(this,"_compressionMethod");gn(this,"_filterMethod");gn(this,"_interlaceMethod");gn(this,"_colorType");gn(this,"_isAnimated");gn(this,"_numberOfFrames");gn(this,"_numberOfPlays");gn(this,"_frames");gn(this,"_writingDataChunks");const{checkCrc:h=!1}=d;this._checkCrc=h,this._inflator=new wV,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=IT.UNKNOWN,this._filterMethod=CV.UNKNOWN,this._interlaceMethod=OT.UNKNOWN,this._colorType=xc.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(SV(this);!this._end;){const c=this.readUint32(),d=this.readChars(4);this.decodeChunk(c,d)}return this.decodeImage(),this._png}decodeApng(){for(SV(this);!this._end;){const c=this.readUint32(),d=this.readChars(4);this.decodeApngChunk(c,d)}return this.decodeApngImage(),this._apng}decodeChunk(c,d){const h=this.offset;switch(d){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(c);break;case"IDAT":this.decodeIDAT(c);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(c);break;case"iCCP":this.decodeiCCP(c);break;case pge:xge(this._png.text,this,c);break;case"pHYs":this.decodepHYs();break;default:this.skip(c);break}if(this.offset-h!==c)throw new Error(`Length mismatch while decoding chunk ${d}`);this._checkCrc?yV(this,c+4,d):this.skip(4)}decodeApngChunk(c,d){const h=this.offset;switch(d!=="fdAT"&&d!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),d){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(c);break;default:this.decodeChunk(c,d),this.offset=h+c;break}if(this.offset-h!==c)throw new Error(`Length mismatch while decoding chunk ${d}`);this._checkCrc?yV(this,c+4,d):this.skip(4)}decodeIHDR(){const c=this._png;c.width=this.readUint32(),c.height=this.readUint32(),c.depth=_ge(this.readUint8());const d=this.readUint8();this._colorType=d;let h;switch(d){case xc.GREYSCALE:h=1;break;case xc.TRUECOLOUR:h=3;break;case xc.INDEXED_COLOUR:h=1;break;case xc.GREYSCALE_ALPHA:h=2;break;case xc.TRUECOLOUR_ALPHA:h=4;break;case xc.UNKNOWN:default:throw new Error(`Unknown color type: ${d}`)}if(this._png.channels=h,this._compressionMethod=this.readUint8(),this._compressionMethod!==IT.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const c={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(c)}decodePLTE(c){if(c%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${c}`);const d=c/3;this._hasPalette=!0;const h=[];this._palette=h;for(let m=0;m<d;m++)h.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(c){this._writingDataChunks=!0;const d=c,h=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,h,d)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(c)}decodeFDAT(c){this._writingDataChunks=!0;let d=c,h=this.offset+this.byteOffset;if(h+=4,d-=4,this._inflator.push(new Uint8Array(this.buffer,h,d)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(c)}decodetRNS(c){switch(this._colorType){case xc.GREYSCALE:case xc.TRUECOLOUR:{if(c%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${c}`);if(c/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${c/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(c/2);for(let d=0;d<c/2;d++)this._transparency[d]=this.readUint16();break}case xc.INDEXED_COLOUR:{if(c>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${c} vs ${this._palette.length})`);let d=0;for(;d<c;d++){const h=this.readByte();this._palette[d].push(h)}for(;d<this._palette.length;d++)this._palette[d].push(255);break}case xc.UNKNOWN:case xc.GREYSCALE_ALPHA:case xc.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(c){const d=lG(this),h=this.readUint8();if(h!==IT.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${h}`);const m=this.readBytes(c-d.length-2);this._png.iccEmbeddedProfile={name:d,profile:$fe(m)}}decodepHYs(){const c=this.readUint32(),d=this.readUint32(),h=this.readByte();this._png.resolution={x:c,y:d,unit:h}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let c=0;c<this._numberOfFrames;c++){const d={sequenceNumber:this._frames[c].sequenceNumber,delayNumber:this._frames[c].delayNumber,delayDenominator:this._frames[c].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},h=this._frames.at(c);if(h){if(h.data=EV({data:h.data,width:h.width,height:h.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),c===0||h.xOffset===0&&h.yOffset===0&&h.width===this._png.width&&h.height===this._png.height)d.data=h.data;else{const m=this._apng.frames.at(c-1);this.disposeFrame(h,m,d),this.addFrameDataToCanvas(d,h)}this._apng.frames.push(d)}}return this._apng}disposeFrame(c,d,h){switch(c.disposeOp){case Ay.NONE:break;case Ay.BACKGROUND:for(let m=0;m<this._png.height;m++)for(let g=0;g<this._png.width;g++){const x=(m*c.width+g)*this._png.channels;for(let v=0;v<this._png.channels;v++)h.data[x+v]=0}break;case Ay.PREVIOUS:h.data.set(d.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(c,d){const h=1<<this._png.depth,m=(g,x)=>{const v=((g+d.yOffset)*this._png.width+d.xOffset+x)*this._png.channels,E=(g*d.width+x)*this._png.channels;return{index:v,frameIndex:E}};switch(d.blendOp){case kT.SOURCE:for(let g=0;g<d.height;g++)for(let x=0;x<d.width;x++){const{index:v,frameIndex:E}=m(g,x);for(let S=0;S<this._png.channels;S++)c.data[v+S]=d.data[E+S]}break;case kT.OVER:for(let g=0;g<d.height;g++)for(let x=0;x<d.width;x++){const{index:v,frameIndex:E}=m(g,x);for(let S=0;S<this._png.channels;S++){const I=d.data[E+this._png.channels-1]/h,k=S%(this._png.channels-1)===0?1:d.data[E+S],R=Math.floor(I*k+(1-I)*c.data[v+S]);c.data[v+S]+=R}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var d;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const c=this._isAnimated?((d=this._frames)==null?void 0:d.at(0)).data:this._inflator.result;if(this._filterMethod!==CV.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===OT.NO_INTERLACE)this._png.data=EV({data:c,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===OT.ADAM7)this._png.data=age({data:c,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const c=this._inflator.result,d=this._frames.at(-1);d?d.data=c:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Ay.NONE,blendOp:kT.SOURCE,data:c}),this._inflator=new wV,this._writingDataChunks=!1}}function _ge(a){if(a!==1&&a!==2&&a!==4&&a!==8&&a!==16)throw new Error(`invalid bit depth: ${a}`);return a}var NV;(function(a){a[a.UNKNOWN=0]="UNKNOWN",a[a.METRE=1]="METRE"})(NV||(NV={}));function yge(a,o){return new wge(a,o).decode()}var sr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function DT(){sr.console&&typeof sr.console.log=="function"&&sr.console.log.apply(sr.console,arguments)}var Dn={log:DT,warn:function(a){sr.console&&(typeof sr.console.warn=="function"?sr.console.warn.apply(sr.console,arguments):DT.call(null,arguments))},error:function(a){sr.console&&(typeof sr.console.error=="function"?sr.console.error.apply(sr.console,arguments):DT(a))}};function BT(a,o,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){Fp(d.response,o,c)},d.onerror=function(){Dn.error("could not download file")},d.send()}function TV(a){var o=new XMLHttpRequest;o.open("HEAD",a,!1);try{o.send()}catch{}return o.status>=200&&o.status<=299}function uy(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(o)}}var Fp=sr.saveAs||((typeof window>"u"?"undefined":bn(window))!=="object"||window!==sr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(a,o,c){var d=sr.URL||sr.webkitURL,h=document.createElement("a");o=o||a.name||"download",h.download=o,h.rel="noopener",typeof a=="string"?(h.href=a,h.origin!==location.origin?TV(h.href)?BT(a,o,c):uy(h,h.target="_blank"):uy(h)):(h.href=d.createObjectURL(a),setTimeout(function(){d.revokeObjectURL(h.href)},4e4),setTimeout(function(){uy(h)},0))}:"msSaveOrOpenBlob"in navigator?function(a,o,c){if(o=o||a.name||"download",typeof a=="string")if(TV(a))BT(a,o,c);else{var d=document.createElement("a");d.href=a,d.target="_blank",setTimeout(function(){uy(d)})}else navigator.msSaveOrOpenBlob(function(h,m){return m===void 0?m={autoBom:!1}:bn(m)!=="object"&&(Dn.warn("Deprecated: Expected third argument to be a object"),m={autoBom:!m}),m.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}(a,c),o)}:function(a,o,c,d){if((d=d||open("","_blank"))&&(d.document.title=d.document.body.innerText="downloading..."),typeof a=="string")return BT(a,o,c);var h=a.type==="application/octet-stream",m=/constructor/i.test(sr.HTMLElement)||sr.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||h&&m)&&(typeof FileReader>"u"?"undefined":bn(FileReader))==="object"){var x=new FileReader;x.onloadend=function(){var S=x.result;S=g?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=S:location=S,d=null},x.readAsDataURL(a)}else{var v=sr.URL||sr.webkitURL,E=v.createObjectURL(a);d?d.location=E:location.href=E,d=null,setTimeout(function(){v.revokeObjectURL(E)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function dG(a){var o;a=a||"",this.ok=!1,a.charAt(0)=="#"&&(a=a.substr(1,6)),a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[a=(a=a.replace(/ /g,"")).toLowerCase()]||a;for(var c=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(x){return[parseInt(x[1]),parseInt(x[2]),parseInt(x[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(x){return[parseInt(x[1],16),parseInt(x[2],16),parseInt(x[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(x){return[parseInt(x[1]+x[1],16),parseInt(x[2]+x[2],16),parseInt(x[3]+x[3],16)]}}],d=0;d<c.length;d++){var h=c[d].re,m=c[d].process,g=h.exec(a);g&&(o=m(g),this.r=o[0],this.g=o[1],this.b=o[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var x=this.r.toString(16),v=this.g.toString(16),E=this.b.toString(16);return x.length==1&&(x="0"+x),v.length==1&&(v="0"+v),E.length==1&&(E="0"+E),"#"+x+v+E}}var Cy=sr.atob.bind(sr),RV=sr.btoa.bind(sr);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function LT(a,o){var c=a[0],d=a[1],h=a[2],m=a[3];c=qa(c,d,h,m,o[0],7,-680876936),m=qa(m,c,d,h,o[1],12,-389564586),h=qa(h,m,c,d,o[2],17,606105819),d=qa(d,h,m,c,o[3],22,-1044525330),c=qa(c,d,h,m,o[4],7,-176418897),m=qa(m,c,d,h,o[5],12,1200080426),h=qa(h,m,c,d,o[6],17,-1473231341),d=qa(d,h,m,c,o[7],22,-45705983),c=qa(c,d,h,m,o[8],7,1770035416),m=qa(m,c,d,h,o[9],12,-1958414417),h=qa(h,m,c,d,o[10],17,-42063),d=qa(d,h,m,c,o[11],22,-1990404162),c=qa(c,d,h,m,o[12],7,1804603682),m=qa(m,c,d,h,o[13],12,-40341101),h=qa(h,m,c,d,o[14],17,-1502002290),c=Ya(c,d=qa(d,h,m,c,o[15],22,1236535329),h,m,o[1],5,-165796510),m=Ya(m,c,d,h,o[6],9,-1069501632),h=Ya(h,m,c,d,o[11],14,643717713),d=Ya(d,h,m,c,o[0],20,-373897302),c=Ya(c,d,h,m,o[5],5,-701558691),m=Ya(m,c,d,h,o[10],9,38016083),h=Ya(h,m,c,d,o[15],14,-660478335),d=Ya(d,h,m,c,o[4],20,-405537848),c=Ya(c,d,h,m,o[9],5,568446438),m=Ya(m,c,d,h,o[14],9,-1019803690),h=Ya(h,m,c,d,o[3],14,-187363961),d=Ya(d,h,m,c,o[8],20,1163531501),c=Ya(c,d,h,m,o[13],5,-1444681467),m=Ya(m,c,d,h,o[2],9,-51403784),h=Ya(h,m,c,d,o[7],14,1735328473),c=Xa(c,d=Ya(d,h,m,c,o[12],20,-1926607734),h,m,o[5],4,-378558),m=Xa(m,c,d,h,o[8],11,-2022574463),h=Xa(h,m,c,d,o[11],16,1839030562),d=Xa(d,h,m,c,o[14],23,-35309556),c=Xa(c,d,h,m,o[1],4,-1530992060),m=Xa(m,c,d,h,o[4],11,1272893353),h=Xa(h,m,c,d,o[7],16,-155497632),d=Xa(d,h,m,c,o[10],23,-1094730640),c=Xa(c,d,h,m,o[13],4,681279174),m=Xa(m,c,d,h,o[0],11,-358537222),h=Xa(h,m,c,d,o[3],16,-722521979),d=Xa(d,h,m,c,o[6],23,76029189),c=Xa(c,d,h,m,o[9],4,-640364487),m=Xa(m,c,d,h,o[12],11,-421815835),h=Xa(h,m,c,d,o[15],16,530742520),c=Ja(c,d=Xa(d,h,m,c,o[2],23,-995338651),h,m,o[0],6,-198630844),m=Ja(m,c,d,h,o[7],10,1126891415),h=Ja(h,m,c,d,o[14],15,-1416354905),d=Ja(d,h,m,c,o[5],21,-57434055),c=Ja(c,d,h,m,o[12],6,1700485571),m=Ja(m,c,d,h,o[3],10,-1894986606),h=Ja(h,m,c,d,o[10],15,-1051523),d=Ja(d,h,m,c,o[1],21,-2054922799),c=Ja(c,d,h,m,o[8],6,1873313359),m=Ja(m,c,d,h,o[15],10,-30611744),h=Ja(h,m,c,d,o[6],15,-1560198380),d=Ja(d,h,m,c,o[13],21,1309151649),c=Ja(c,d,h,m,o[4],6,-145523070),m=Ja(m,c,d,h,o[11],10,-1120210379),h=Ja(h,m,c,d,o[2],15,718787259),d=Ja(d,h,m,c,o[9],21,-343485551),a[0]=ih(c,a[0]),a[1]=ih(d,a[1]),a[2]=ih(h,a[2]),a[3]=ih(m,a[3])}function CE(a,o,c,d,h,m){return o=ih(ih(o,a),ih(d,m)),ih(o<<h|o>>>32-h,c)}function qa(a,o,c,d,h,m,g){return CE(o&c|~o&d,a,o,h,m,g)}function Ya(a,o,c,d,h,m,g){return CE(o&d|c&~d,a,o,h,m,g)}function Xa(a,o,c,d,h,m,g){return CE(o^c^d,a,o,h,m,g)}function Ja(a,o,c,d,h,m,g){return CE(c^(o|~d),a,o,h,m,g)}function AG(a){var o,c=a.length,d=[1732584193,-271733879,-1732584194,271733878];for(o=64;o<=a.length;o+=64)LT(d,Ege(a.substring(o-64,o)));a=a.substring(o-64);var h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(o=0;o<a.length;o++)h[o>>2]|=a.charCodeAt(o)<<(o%4<<3);if(h[o>>2]|=128<<(o%4<<3),o>55)for(LT(d,h),o=0;o<16;o++)h[o]=0;return h[14]=8*c,LT(d,h),d}function Ege(a){var o,c=[];for(o=0;o<64;o+=4)c[o>>2]=a.charCodeAt(o)+(a.charCodeAt(o+1)<<8)+(a.charCodeAt(o+2)<<16)+(a.charCodeAt(o+3)<<24);return c}var IV="0123456789abcdef".split("");function Sge(a){for(var o="",c=0;c<4;c++)o+=IV[a>>8*c+4&15]+IV[a>>8*c&15];return o}function Cge(a){return String.fromCharCode(255&a,(65280&a)>>8,(16711680&a)>>16,(4278190080&a)>>24)}function KR(a){return AG(a).map(Cge).join("")}var Nge=function(a){for(var o=0;o<a.length;o++)a[o]=Sge(a[o]);return a.join("")}(AG("hello"))!="5d41402abc4b2a76b9719d911017c592";function ih(a,o){if(Nge){var c=(65535&a)+(65535&o);return(a>>16)+(o>>16)+(c>>16)<<16|65535&c}return a+o&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function WR(a,o){var c,d,h,m;if(a!==c){for(var g=(h=a,m=1+(256/a.length|0),new Array(m+1).join(h)),x=[],v=0;v<256;v++)x[v]=v;var E=0;for(v=0;v<256;v++){var S=x[v];E=(E+S+g.charCodeAt(v))%256,x[v]=x[E],x[E]=S}c=a,d=x}else x=d;var I=o.length,k=0,R=0,O="";for(v=0;v<I;v++)R=(R+(S=x[k=(k+1)%256]))%256,x[k]=x[R],x[R]=S,g=x[(x[k]+x[R])%256],O+=String.fromCharCode(o.charCodeAt(v)^g);return O}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var OV={print:4,modify:8,copy:16,"annot-forms":32};function dg(a,o,c,d){this.v=1,this.r=2;var h=192;a.forEach(function(x){if(OV.perm!==void 0)throw new Error("Invalid permission: "+x);h+=OV[x]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var m=(o+this.padding).substr(0,32),g=(c+this.padding).substr(0,32);this.O=this.processOwnerPassword(m,g),this.P=-(1+(255^h)),this.encryptionKey=KR(m+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(d)).substr(0,5),this.U=WR(this.encryptionKey,this.padding)}function Ag(a){if(/[^\u0000-\u00ff]/.test(a))throw new Error("Invalid PDF Name Object: "+a+", Only accept ASCII characters.");for(var o="",c=a.length,d=0;d<c;d++){var h=a.charCodeAt(d);o+=h<33||h===35||h===37||h===40||h===41||h===47||h===60||h===62||h===91||h===93||h===123||h===125||h>126?"#"+("0"+h.toString(16)).slice(-2):a[d]}return o}function kV(a){if(bn(a)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var o={};this.subscribe=function(c,d,h){if(h=h||!1,typeof c!="string"||typeof d!="function"||typeof h!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");o.hasOwnProperty(c)||(o[c]={});var m=Math.random().toString(35);return o[c][m]=[d,!!h],m},this.unsubscribe=function(c){for(var d in o)if(o[d][c])return delete o[d][c],Object.keys(o[d]).length===0&&delete o[d],!0;return!1},this.publish=function(c){if(o.hasOwnProperty(c)){var d=Array.prototype.slice.call(arguments,1),h=[];for(var m in o[c]){var g=o[c][m];try{g[0].apply(a,d)}catch(x){sr.console&&Dn.error("jsPDF PubSub Error",x.message,x)}g[1]&&h.push(m)}h.length&&h.forEach(this.unsubscribe)}},this.getTopics=function(){return o}}function Jy(a){if(!(this instanceof Jy))return new Jy(a);var o="opacity,stroke-opacity".split(",");for(var c in a)a.hasOwnProperty(c)&&o.indexOf(c)>=0&&(this[c]=a[c]);this.id="",this.objectNumber=-1}function uG(a,o){this.gState=a,this.matrix=o,this.id="",this.objectNumber=-1}function Qp(a,o,c,d,h){if(!(this instanceof Qp))return new Qp(a,o,c,d,h);this.type=a==="axial"?2:3,this.coords=o,this.colors=c,uG.call(this,d,h)}function hg(a,o,c,d,h){if(!(this instanceof hg))return new hg(a,o,c,d,h);this.boundingBox=a,this.xStep=o,this.yStep=c,this.stream="",this.cloneIndex=0,uG.call(this,d,h)}function Ms(a){var o,c=typeof arguments[0]=="string"?arguments[0]:"p",d=arguments[1],h=arguments[2],m=arguments[3],g=[],x=1,v=16,E="S",S=null;bn(a=a||{})==="object"&&(c=a.orientation,d=a.unit||d,h=a.format||h,m=a.compress||a.compressPdf||m,(S=a.encryption||null)!==null&&(S.userPassword=S.userPassword||"",S.ownerPassword=S.ownerPassword||"",S.userPermissions=S.userPermissions||[]),x=typeof a.userUnit=="number"?Math.abs(a.userUnit):1,a.precision!==void 0&&(o=a.precision),a.floatPrecision!==void 0&&(v=a.floatPrecision),E=a.defaultPathOperation||"S"),g=a.filters||(m===!0?["FlateEncode"]:g),d=d||"mm",c=(""+(c||"P")).toLowerCase();var I=a.putOnlyUsedFonts||!1,k={},R={internal:{},__private__:{}};R.__private__.PubSub=kV;var O="1.3",F=R.__private__.getPdfVersion=function(){return O};R.__private__.setPdfVersion=function(L){O=L};var M={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};R.__private__.getPageFormats=function(){return M};var Q=R.__private__.getPageFormat=function(L){return M[L]};h=h||"a4";var Z="compat",$="advanced",X=Z;function be(){this.saveGraphicsState(),we(new Ds(Rs,0,0,-Rs,0,gl()*Rs).toString()+" cm"),this.setFontSize(this.getFontSize()/Rs),E="n",X=$}function me(){this.restoreGraphicsState(),E="S",X=Z}var Ne=R.__private__.combineFontStyleAndFontWeight=function(L,ae){if(L=="bold"&&ae=="normal"||L=="bold"&&ae==400||L=="normal"&&ae=="italic"||L=="bold"&&ae=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ae&&(L=ae==400||ae==="normal"?L==="italic"?"italic":"normal":ae!=700&&ae!=="bold"||L!=="normal"?(ae==700?"bold":ae)+""+L:"bold"),L};R.advancedAPI=function(L){var ae=X===Z;return ae&&be.call(this),typeof L!="function"||(L(this),ae&&me.call(this)),this},R.compatAPI=function(L){var ae=X===$;return ae&&me.call(this),typeof L!="function"||(L(this),ae&&be.call(this)),this},R.isAdvancedAPI=function(){return X===$};var le,H=function(L){if(X!==$)throw new Error(L+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Ae=R.roundToPrecision=R.__private__.roundToPrecision=function(L,ae){var Oe=o||ae;if(isNaN(L)||isNaN(Oe))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return L.toFixed(Oe).replace(/0+$/,"")};le=R.hpf=R.__private__.hpf=typeof v=="number"?function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.hpf");return Ae(L,v)}:v==="smart"?function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.hpf");return Ae(L,L>-1&&L<1?16:5)}:function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.hpf");return Ae(L,16)};var J=R.f2=R.__private__.f2=function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.f2");return Ae(L,2)},Y=R.__private__.f3=function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.f3");return Ae(L,3)},se=R.scale=R.__private__.scale=function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.scale");return X===Z?L*Rs:X===$?L:void 0},oe=function(L){return se(function(ae){return X===Z?gl()-ae:X===$?ae:void 0}(L))};R.__private__.setPrecision=R.setPrecision=function(L){typeof parseInt(L,10)=="number"&&(o=parseInt(L,10))};var Te,he="00000000000000000000000000000000",Ce=R.__private__.getFileId=function(){return he},ee=R.__private__.setFileId=function(L){return he=L!==void 0&&/^[a-fA-F0-9]{32}$/.test(L)?L.toUpperCase():he.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),S!==null&&(gi=new dg(S.userPermissions,S.userPassword,S.ownerPassword,he)),he};R.setFileId=function(L){return ee(L),this},R.getFileId=function(){return Ce()};var Be=R.__private__.convertDateToPDFDate=function(L){var ae=L.getTimezoneOffset(),Oe=ae<0?"+":"-",Ve=Math.floor(Math.abs(ae/60)),tt=Math.abs(ae%60),yt=[Oe,fe(Ve),"'",fe(tt),"'"].join("");return["D:",L.getFullYear(),fe(L.getMonth()+1),fe(L.getDate()),fe(L.getHours()),fe(L.getMinutes()),fe(L.getSeconds()),yt].join("")},He=R.__private__.convertPDFDateToDate=function(L){var ae=parseInt(L.substr(2,4),10),Oe=parseInt(L.substr(6,2),10)-1,Ve=parseInt(L.substr(8,2),10),tt=parseInt(L.substr(10,2),10),yt=parseInt(L.substr(12,2),10),Pt=parseInt(L.substr(14,2),10);return new Date(ae,Oe,Ve,tt,yt,Pt,0)},Ue=R.__private__.setCreationDate=function(L){var ae;if(L===void 0&&(L=new Date),L instanceof Date)ae=Be(L);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(L))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ae=L}return Te=ae},re=R.__private__.getCreationDate=function(L){var ae=Te;return L==="jsDate"&&(ae=He(Te)),ae};R.setCreationDate=function(L){return Ue(L),this},R.getCreationDate=function(L){return re(L)};var ve,fe=R.__private__.padd2=function(L){return("0"+parseInt(L)).slice(-2)},Ie=R.__private__.padd2Hex=function(L){return("00"+(L=L.toString())).substr(L.length)},je=0,Ee=[],We=[],ze=0,st=[],bt=[],Qe=!1,rt=We;R.__private__.setCustomOutputDestination=function(L){Qe=!0,rt=L};var Nt=function(L){Qe||(rt=L)};R.__private__.resetCustomOutputDestination=function(){Qe=!1,rt=We};var we=R.__private__.out=function(L){return L=L.toString(),ze+=L.length+1,rt.push(L),rt},Rt=R.__private__.write=function(L){return we(arguments.length===1?L.toString():Array.prototype.join.call(arguments," "))},Fe=R.__private__.getArrayBuffer=function(L){for(var ae=L.length,Oe=new ArrayBuffer(ae),Ve=new Uint8Array(Oe);ae--;)Ve[ae]=L.charCodeAt(ae);return Oe},et=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];R.__private__.getStandardFonts=function(){return et};var $e=a.fontSize||16;R.__private__.setFontSize=R.setFontSize=function(L){return $e=X===$?L/Rs:L,this};var Kt,qt=R.__private__.getFontSize=R.getFontSize=function(){return X===Z?$e:$e*Rs},Xe=a.R2L||!1;R.__private__.setR2L=R.setR2L=function(L){return Xe=L,this},R.__private__.getR2L=R.getR2L=function(){return Xe};var ht,dt=R.__private__.setZoomMode=function(L){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(L))Kt=L;else if(isNaN(L)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(L)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+L+'" is not recognized.');Kt=L}else Kt=parseInt(L,10)};R.__private__.getZoomMode=function(){return Kt};var Dt,ss=R.__private__.setPageMode=function(L){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(L)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+L+'" is not recognized.');ht=L};R.__private__.getPageMode=function(){return ht};var $t=R.__private__.setLayoutMode=function(L){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(L)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+L+'" is not recognized.');Dt=L};R.__private__.getLayoutMode=function(){return Dt},R.__private__.setDisplayMode=R.setDisplayMode=function(L,ae,Oe){return dt(L),$t(ae),ss(Oe),this};var ls={title:"",subject:"",author:"",keywords:"",creator:""};R.__private__.getDocumentProperty=function(L){if(Object.keys(ls).indexOf(L)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ls[L]},R.__private__.getDocumentProperties=function(){return ls},R.__private__.setDocumentProperties=R.setProperties=R.setDocumentProperties=function(L){for(var ae in ls)ls.hasOwnProperty(ae)&&L[ae]&&(ls[ae]=L[ae]);return this},R.__private__.setDocumentProperty=function(L,ae){if(Object.keys(ls).indexOf(L)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ls[L]=ae};var Zt,Rs,es,Zs,pt,Ut={},zt={},rs=[],Ht={},vt={},jt={},ps={},Qs=null,Is=0,ms=[],Ws=new kV(R),mi=a.hotfixes||[],qr={},oa={},Xi=[],Ds=function L(ae,Oe,Ve,tt,yt,Pt){if(!(this instanceof L))return new L(ae,Oe,Ve,tt,yt,Pt);isNaN(ae)&&(ae=1),isNaN(Oe)&&(Oe=0),isNaN(Ve)&&(Ve=0),isNaN(tt)&&(tt=1),isNaN(yt)&&(yt=0),isNaN(Pt)&&(Pt=0),this._matrix=[ae,Oe,Ve,tt,yt,Pt]};Object.defineProperty(Ds.prototype,"sx",{get:function(){return this._matrix[0]},set:function(L){this._matrix[0]=L}}),Object.defineProperty(Ds.prototype,"shy",{get:function(){return this._matrix[1]},set:function(L){this._matrix[1]=L}}),Object.defineProperty(Ds.prototype,"shx",{get:function(){return this._matrix[2]},set:function(L){this._matrix[2]=L}}),Object.defineProperty(Ds.prototype,"sy",{get:function(){return this._matrix[3]},set:function(L){this._matrix[3]=L}}),Object.defineProperty(Ds.prototype,"tx",{get:function(){return this._matrix[4]},set:function(L){this._matrix[4]=L}}),Object.defineProperty(Ds.prototype,"ty",{get:function(){return this._matrix[5]},set:function(L){this._matrix[5]=L}}),Object.defineProperty(Ds.prototype,"a",{get:function(){return this._matrix[0]},set:function(L){this._matrix[0]=L}}),Object.defineProperty(Ds.prototype,"b",{get:function(){return this._matrix[1]},set:function(L){this._matrix[1]=L}}),Object.defineProperty(Ds.prototype,"c",{get:function(){return this._matrix[2]},set:function(L){this._matrix[2]=L}}),Object.defineProperty(Ds.prototype,"d",{get:function(){return this._matrix[3]},set:function(L){this._matrix[3]=L}}),Object.defineProperty(Ds.prototype,"e",{get:function(){return this._matrix[4]},set:function(L){this._matrix[4]=L}}),Object.defineProperty(Ds.prototype,"f",{get:function(){return this._matrix[5]},set:function(L){this._matrix[5]=L}}),Object.defineProperty(Ds.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ds.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ds.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ds.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Ds.prototype.join=function(L){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(le).join(L)},Ds.prototype.multiply=function(L){var ae=L.sx*this.sx+L.shy*this.shx,Oe=L.sx*this.shy+L.shy*this.sy,Ve=L.shx*this.sx+L.sy*this.shx,tt=L.shx*this.shy+L.sy*this.sy,yt=L.tx*this.sx+L.ty*this.shx+this.tx,Pt=L.tx*this.shy+L.ty*this.sy+this.ty;return new Ds(ae,Oe,Ve,tt,yt,Pt)},Ds.prototype.decompose=function(){var L=this.sx,ae=this.shy,Oe=this.shx,Ve=this.sy,tt=this.tx,yt=this.ty,Pt=Math.sqrt(L*L+ae*ae),ws=(L/=Pt)*Oe+(ae/=Pt)*Ve;Oe-=L*ws,Ve-=ae*ws;var ks=Math.sqrt(Oe*Oe+Ve*Ve);return ws/=ks,L*(Ve/=ks)<ae*(Oe/=ks)&&(L=-L,ae=-ae,ws=-ws,Pt=-Pt),{scale:new Ds(Pt,0,0,ks,0,0),translate:new Ds(1,0,0,1,tt,yt),rotate:new Ds(L,ae,-ae,L,0,0),skew:new Ds(1,0,ws,1,0,0)}},Ds.prototype.toString=function(L){return this.join(" ")},Ds.prototype.inversed=function(){var L=this.sx,ae=this.shy,Oe=this.shx,Ve=this.sy,tt=this.tx,yt=this.ty,Pt=1/(L*Ve-ae*Oe),ws=Ve*Pt,ks=-ae*Pt,Js=-Oe*Pt,lr=L*Pt;return new Ds(ws,ks,Js,lr,-ws*tt-Js*yt,-ks*tt-lr*yt)},Ds.prototype.applyToPoint=function(L){var ae=L.x*this.sx+L.y*this.shx+this.tx,Oe=L.x*this.shy+L.y*this.sy+this.ty;return new Tc(ae,Oe)},Ds.prototype.applyToRectangle=function(L){var ae=this.applyToPoint(L),Oe=this.applyToPoint(new Tc(L.x+L.w,L.y+L.h));return new _h(ae.x,ae.y,Oe.x-ae.x,Oe.y-ae.y)},Ds.prototype.clone=function(){var L=this.sx,ae=this.shy,Oe=this.shx,Ve=this.sy,tt=this.tx,yt=this.ty;return new Ds(L,ae,Oe,Ve,tt,yt)},R.Matrix=Ds;var An=R.matrixMult=function(L,ae){return ae.multiply(L)},wa=new Ds(1,0,0,1,0,0);R.unitMatrix=R.identityMatrix=wa;var Qi=function(L,ae){if(!vt[L]){var Oe=(ae instanceof Qp?"Sh":"P")+(Object.keys(Ht).length+1).toString(10);ae.id=Oe,vt[L]=Oe,Ht[Oe]=ae,Ws.publish("addPattern",ae)}};R.ShadingPattern=Qp,R.TilingPattern=hg,R.addShadingPattern=function(L,ae){return H("addShadingPattern()"),Qi(L,ae),this},R.beginTilingPattern=function(L){H("beginTilingPattern()"),yh(L.boundingBox[0],L.boundingBox[1],L.boundingBox[2]-L.boundingBox[0],L.boundingBox[3]-L.boundingBox[1],L.matrix)},R.endTilingPattern=function(L,ae){H("endTilingPattern()"),ae.stream=bt[ve].join(`
`),Qi(L,ae),Ws.publish("endTilingPattern",ae),Xi.pop().restore()};var fi,Pn=R.__private__.newObject=function(){var L=Ri();return Hi(L,!0),L},Ri=R.__private__.newObjectDeferred=function(){return je++,Ee[je]=function(){return ze},je},Hi=function(L,ae){return ae=typeof ae=="boolean"&&ae,Ee[L]=ze,ae&&we(L+" 0 obj"),L},eA=R.__private__.newAdditionalObject=function(){var L={objId:Ri(),content:""};return st.push(L),L},Al=Ri(),wo=Ri(),Ec=R.__private__.decodeColorString=function(L){var ae=L.split(" ");if(ae.length!==2||ae[1]!=="g"&&ae[1]!=="G")ae.length!==5||ae[4]!=="k"&&ae[4]!=="K"||(ae=[(1-ae[0])*(1-ae[3]),(1-ae[1])*(1-ae[3]),(1-ae[2])*(1-ae[3]),"r"]);else{var Oe=parseFloat(ae[0]);ae=[Oe,Oe,Oe,"r"]}for(var Ve="#",tt=0;tt<3;tt++)Ve+=("0"+Math.floor(255*parseFloat(ae[tt])).toString(16)).slice(-2);return Ve},Xo=R.__private__.encodeColorString=function(L){var ae;typeof L=="string"&&(L={ch1:L});var Oe=L.ch1,Ve=L.ch2,tt=L.ch3,yt=L.ch4,Pt=L.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Oe=="string"&&Oe.charAt(0)!=="#"){var ws=new dG(Oe);if(ws.ok)Oe=ws.toHex();else if(!/^\d*\.?\d*$/.test(Oe))throw new Error('Invalid color "'+Oe+'" passed to jsPDF.encodeColorString.')}if(typeof Oe=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Oe)&&(Oe="#"+Oe[1]+Oe[1]+Oe[2]+Oe[2]+Oe[3]+Oe[3]),typeof Oe=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Oe)){var ks=parseInt(Oe.substr(1),16);Oe=ks>>16&255,Ve=ks>>8&255,tt=255&ks}if(Ve===void 0||yt===void 0&&Oe===Ve&&Ve===tt)ae=typeof Oe=="string"?Oe+" "+Pt[0]:L.precision===2?J(Oe/255)+" "+Pt[0]:Y(Oe/255)+" "+Pt[0];else if(yt===void 0||bn(yt)==="object"){if(yt&&!isNaN(yt.a)&&yt.a===0)return["1.","1.","1.",Pt[1]].join(" ");ae=typeof Oe=="string"?[Oe,Ve,tt,Pt[1]].join(" "):L.precision===2?[J(Oe/255),J(Ve/255),J(tt/255),Pt[1]].join(" "):[Y(Oe/255),Y(Ve/255),Y(tt/255),Pt[1]].join(" ")}else ae=typeof Oe=="string"?[Oe,Ve,tt,yt,Pt[2]].join(" "):L.precision===2?[J(Oe),J(Ve),J(tt),J(yt),Pt[2]].join(" "):[Y(Oe),Y(Ve),Y(tt),Y(yt),Pt[2]].join(" ");return ae},Jo=R.__private__.getFilters=function(){return g},so=R.__private__.putStream=function(L){var ae=(L=L||{}).data||"",Oe=L.filters||Jo(),Ve=L.alreadyAppliedFilters||[],tt=L.addLength1||!1,yt=ae.length,Pt=L.objectId,ws=function(xi){return xi};if(S!==null&&Pt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");S!==null&&(ws=gi.encryptor(Pt,0));var ks={};Oe===!0&&(Oe=["FlateEncode"]);var Js=L.additionalKeyValues||[],lr=(ks=Ms.API.processDataByFilters!==void 0?Ms.API.processDataByFilters(ae,Oe):{data:ae,reverseChain:[]}).reverseChain+(Array.isArray(Ve)?Ve.join(" "):Ve.toString());if(ks.data.length!==0&&(Js.push({key:"Length",value:ks.data.length}),tt===!0&&Js.push({key:"Length1",value:yt})),lr.length!=0)if(lr.split("/").length-1==1)Js.push({key:"Filter",value:lr});else{Js.push({key:"Filter",value:"["+lr+"]"});for(var Fr=0;Fr<Js.length;Fr+=1)if(Js[Fr].key==="DecodeParms"){for(var sn=[],bi=0;bi<ks.reverseChain.split("/").length-1;bi+=1)sn.push("null");sn.push(Js[Fr].value),Js[Fr].value="["+sn.join(" ")+"]"}}we("<<");for(var Gr=0;Gr<Js.length;Gr++)we("/"+Js[Gr].key+" "+Js[Gr].value);we(">>"),ks.data.length!==0&&(we("stream"),we(ws(ks.data)),we("endstream"))},id=R.__private__.putPage=function(L){var ae=L.number,Oe=L.data,Ve=L.objId,tt=L.contentsObjId;Hi(Ve,!0),we("<</Type /Page"),we("/Parent "+L.rootDictionaryObjId+" 0 R"),we("/Resources "+L.resourceDictionaryObjId+" 0 R"),we("/MediaBox ["+parseFloat(le(L.mediaBox.bottomLeftX))+" "+parseFloat(le(L.mediaBox.bottomLeftY))+" "+le(L.mediaBox.topRightX)+" "+le(L.mediaBox.topRightY)+"]"),L.cropBox!==null&&we("/CropBox ["+le(L.cropBox.bottomLeftX)+" "+le(L.cropBox.bottomLeftY)+" "+le(L.cropBox.topRightX)+" "+le(L.cropBox.topRightY)+"]"),L.bleedBox!==null&&we("/BleedBox ["+le(L.bleedBox.bottomLeftX)+" "+le(L.bleedBox.bottomLeftY)+" "+le(L.bleedBox.topRightX)+" "+le(L.bleedBox.topRightY)+"]"),L.trimBox!==null&&we("/TrimBox ["+le(L.trimBox.bottomLeftX)+" "+le(L.trimBox.bottomLeftY)+" "+le(L.trimBox.topRightX)+" "+le(L.trimBox.topRightY)+"]"),L.artBox!==null&&we("/ArtBox ["+le(L.artBox.bottomLeftX)+" "+le(L.artBox.bottomLeftY)+" "+le(L.artBox.topRightX)+" "+le(L.artBox.topRightY)+"]"),typeof L.userUnit=="number"&&L.userUnit!==1&&we("/UserUnit "+L.userUnit),Ws.publish("putPage",{objId:Ve,pageContext:ms[ae],pageNumber:ae,page:Oe}),we("/Contents "+tt+" 0 R"),we(">>"),we("endobj");var yt=Oe.join(`
`);return X===$&&(yt+=`
Q`),Hi(tt,!0),so({data:yt,filters:Jo(),objectId:tt}),we("endobj"),Ve},_o=R.__private__.putPages=function(){var L,ae,Oe=[];for(L=1;L<=Is;L++)ms[L].objId=Ri(),ms[L].contentsObjId=Ri();for(L=1;L<=Is;L++)Oe.push(id({number:L,data:bt[L],objId:ms[L].objId,contentsObjId:ms[L].contentsObjId,mediaBox:ms[L].mediaBox,cropBox:ms[L].cropBox,bleedBox:ms[L].bleedBox,trimBox:ms[L].trimBox,artBox:ms[L].artBox,userUnit:ms[L].userUnit,rootDictionaryObjId:Al,resourceDictionaryObjId:wo}));Hi(Al,!0),we("<</Type /Pages");var Ve="/Kids [";for(ae=0;ae<Is;ae++)Ve+=Oe[ae]+" 0 R ";we(Ve+"]"),we("/Count "+Is),we(">>"),we("endobj"),Ws.publish("postPutPages")},ad=function(L){Ws.publish("putFont",{font:L,out:we,newObject:Pn,putStream:so}),L.isAlreadyPutted!==!0&&(L.objectNumber=Pn(),we("<<"),we("/Type /Font"),we("/BaseFont /"+Ag(L.postScriptName)),we("/Subtype /Type1"),typeof L.encoding=="string"&&we("/Encoding /"+L.encoding),we("/FirstChar 32"),we("/LastChar 255"),we(">>"),we("endobj"))},$o=function(L){L.objectNumber=Pn();var ae=[];ae.push({key:"Type",value:"/XObject"}),ae.push({key:"Subtype",value:"/Form"}),ae.push({key:"BBox",value:"["+[le(L.x),le(L.y),le(L.x+L.width),le(L.y+L.height)].join(" ")+"]"}),ae.push({key:"Matrix",value:"["+L.matrix.toString()+"]"});var Oe=L.pages[1].join(`
`);so({data:Oe,additionalKeyValues:ae,objectId:L.objectNumber}),we("endobj")},JA=function(L,ae){ae||(ae=21);var Oe=Pn(),Ve=function(Pt,ws){var ks,Js=[],lr=1/(ws-1);for(ks=0;ks<1;ks+=lr)Js.push(ks);if(Js.push(1),Pt[0].offset!=0){var Fr={offset:0,color:Pt[0].color};Pt.unshift(Fr)}if(Pt[Pt.length-1].offset!=1){var sn={offset:1,color:Pt[Pt.length-1].color};Pt.push(sn)}for(var bi="",Gr=0,xi=0;xi<Js.length;xi++){for(ks=Js[xi];ks>Pt[Gr+1].offset;)Gr++;var vi=Pt[Gr].offset,Ts=(ks-vi)/(Pt[Gr+1].offset-vi),bl=Pt[Gr].color,ec=Pt[Gr+1].color;bi+=Ie(Math.round((1-Ts)*bl[0]+Ts*ec[0]).toString(16))+Ie(Math.round((1-Ts)*bl[1]+Ts*ec[1]).toString(16))+Ie(Math.round((1-Ts)*bl[2]+Ts*ec[2]).toString(16))}return bi.trim()}(L.colors,ae),tt=[];tt.push({key:"FunctionType",value:"0"}),tt.push({key:"Domain",value:"[0.0 1.0]"}),tt.push({key:"Size",value:"["+ae+"]"}),tt.push({key:"BitsPerSample",value:"8"}),tt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),tt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),so({data:Ve,additionalKeyValues:tt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Oe}),we("endobj"),L.objectNumber=Pn(),we("<< /ShadingType "+L.type),we("/ColorSpace /DeviceRGB");var yt="/Coords ["+le(parseFloat(L.coords[0]))+" "+le(parseFloat(L.coords[1]))+" ";L.type===2?yt+=le(parseFloat(L.coords[2]))+" "+le(parseFloat(L.coords[3])):yt+=le(parseFloat(L.coords[2]))+" "+le(parseFloat(L.coords[3]))+" "+le(parseFloat(L.coords[4]))+" "+le(parseFloat(L.coords[5])),we(yt+="]"),L.matrix&&we("/Matrix ["+L.matrix.toString()+"]"),we("/Function "+Oe+" 0 R"),we("/Extend [true true]"),we(">>"),we("endobj")},$A=function(L,ae){var Oe=Ri(),Ve=Pn();ae.push({resourcesOid:Oe,objectOid:Ve}),L.objectNumber=Ve;var tt=[];tt.push({key:"Type",value:"/Pattern"}),tt.push({key:"PatternType",value:"1"}),tt.push({key:"PaintType",value:"1"}),tt.push({key:"TilingType",value:"1"}),tt.push({key:"BBox",value:"["+L.boundingBox.map(le).join(" ")+"]"}),tt.push({key:"XStep",value:le(L.xStep)}),tt.push({key:"YStep",value:le(L.yStep)}),tt.push({key:"Resources",value:Oe+" 0 R"}),L.matrix&&tt.push({key:"Matrix",value:"["+L.matrix.toString()+"]"}),so({data:L.stream,additionalKeyValues:tt,objectId:L.objectNumber}),we("endobj")},yo=function(L){for(var ae in L.objectNumber=Pn(),we("<<"),L)switch(ae){case"opacity":we("/ca "+J(L[ae]));break;case"stroke-opacity":we("/CA "+J(L[ae]))}we(">>"),we("endobj")},ph=function(L){Hi(L.resourcesOid,!0),we("<<"),we("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var ae in we("/Font <<"),Ut)Ut.hasOwnProperty(ae)&&(I===!1||I===!0&&k.hasOwnProperty(ae))&&we("/"+ae+" "+Ut[ae].objectNumber+" 0 R");we(">>")}(),function(){if(Object.keys(Ht).length>0){for(var ae in we("/Shading <<"),Ht)Ht.hasOwnProperty(ae)&&Ht[ae]instanceof Qp&&Ht[ae].objectNumber>=0&&we("/"+ae+" "+Ht[ae].objectNumber+" 0 R");Ws.publish("putShadingPatternDict"),we(">>")}}(),function(ae){if(Object.keys(Ht).length>0){for(var Oe in we("/Pattern <<"),Ht)Ht.hasOwnProperty(Oe)&&Ht[Oe]instanceof R.TilingPattern&&Ht[Oe].objectNumber>=0&&Ht[Oe].objectNumber<ae&&we("/"+Oe+" "+Ht[Oe].objectNumber+" 0 R");Ws.publish("putTilingPatternDict"),we(">>")}}(L.objectOid),function(){if(Object.keys(jt).length>0){var ae;for(ae in we("/ExtGState <<"),jt)jt.hasOwnProperty(ae)&&jt[ae].objectNumber>=0&&we("/"+ae+" "+jt[ae].objectNumber+" 0 R");Ws.publish("putGStateDict"),we(">>")}}(),function(){for(var ae in we("/XObject <<"),qr)qr.hasOwnProperty(ae)&&qr[ae].objectNumber>=0&&we("/"+ae+" "+qr[ae].objectNumber+" 0 R");Ws.publish("putXobjectDict"),we(">>")}(),we(">>"),we("endobj")},nm=function(L){zt[L.fontName]=zt[L.fontName]||{},zt[L.fontName][L.fontStyle]=L.id},Un=function(L,ae,Oe,Ve,tt){var yt={id:"F"+(Object.keys(Ut).length+1).toString(10),postScriptName:L,fontName:ae,fontStyle:Oe,encoding:Ve,isStandardFont:tt||!1,metadata:{}};return Ws.publish("addFont",{font:yt,instance:this}),Ut[yt.id]=yt,nm(yt),yt.id},Eo=R.__private__.pdfEscape=R.pdfEscape=function(L,ae){return function(Oe,Ve){var tt,yt,Pt,ws,ks,Js,lr,Fr,sn;if(Pt=(Ve=Ve||{}).sourceEncoding||"Unicode",ks=Ve.outputEncoding,(Ve.autoencode||ks)&&Ut[Zt].metadata&&Ut[Zt].metadata[Pt]&&Ut[Zt].metadata[Pt].encoding&&(ws=Ut[Zt].metadata[Pt].encoding,!ks&&Ut[Zt].encoding&&(ks=Ut[Zt].encoding),!ks&&ws.codePages&&(ks=ws.codePages[0]),typeof ks=="string"&&(ks=ws[ks]),ks)){for(lr=!1,Js=[],tt=0,yt=Oe.length;tt<yt;tt++)(Fr=ks[Oe.charCodeAt(tt)])?Js.push(String.fromCharCode(Fr)):Js.push(Oe[tt]),Js[tt].charCodeAt(0)>>8&&(lr=!0);Oe=Js.join("")}for(tt=Oe.length;lr===void 0&&tt!==0;)Oe.charCodeAt(tt-1)>>8&&(lr=!0),tt--;if(!lr)return Oe;for(Js=Ve.noBOM?[]:[254,255],tt=0,yt=Oe.length;tt<yt;tt++){if((sn=(Fr=Oe.charCodeAt(tt))>>8)>>8)throw new Error("Character at position "+tt+" of string '"+Oe+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Js.push(sn),Js.push(Fr-(sn<<8))}return String.fromCharCode.apply(void 0,Js)}(L,ae).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},mh=R.__private__.beginPage=function(L){bt[++Is]=[],ms[Is]={objId:0,contentsObjId:0,userUnit:Number(x),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(L[0]),topRightY:Number(L[1])}},ZA(Is),Nt(bt[ve])},im=function(L,ae){var Oe,Ve,tt;switch(c=ae||c,typeof L=="string"&&(Oe=Q(L.toLowerCase()),Array.isArray(Oe)&&(Ve=Oe[0],tt=Oe[1])),Array.isArray(L)&&(Ve=L[0]*Rs,tt=L[1]*Rs),isNaN(Ve)&&(Ve=h[0],tt=h[1]),(Ve>14400||tt>14400)&&(Dn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Ve=Math.min(14400,Ve),tt=Math.min(14400,tt)),h=[Ve,tt],c.substr(0,1)){case"l":tt>Ve&&(h=[tt,Ve]);break;case"p":Ve>tt&&(h=[tt,Ve])}mh(h),er(xh),we(nu),wh!==0&&we(wh+" J"),So!==0&&we(So+" j"),Ws.publish("addPage",{pageNumber:Is})},fh=function(L){L>0&&L<=Is&&(bt.splice(L,1),ms.splice(L,1),Is--,ve>Is&&(ve=Is),this.setPage(ve))},ZA=function(L){L>0&&L<=Is&&(ve=L)},am=R.__private__.getNumberOfPages=R.getNumberOfPages=function(){return bt.length-1},gh=function(L,ae,Oe){var Ve,tt=void 0;return Oe=Oe||{},L=L!==void 0?L:Ut[Zt].fontName,ae=ae!==void 0?ae:Ut[Zt].fontStyle,Ve=L.toLowerCase(),zt[Ve]!==void 0&&zt[Ve][ae]!==void 0?tt=zt[Ve][ae]:zt[L]!==void 0&&zt[L][ae]!==void 0?tt=zt[L][ae]:Oe.disableWarning===!1&&Dn.warn("Unable to look up font label for font '"+L+"', '"+ae+"'. Refer to getFontList() for available fonts."),tt||Oe.noFallback||(tt=zt.times[ae])==null&&(tt=zt.times.normal),tt},Sc=R.__private__.putInfo=function(){var L=Pn(),ae=function(Ve){return Ve};for(var Oe in S!==null&&(ae=gi.encryptor(L,0)),we("<<"),we("/Producer ("+Eo(ae("jsPDF "+Ms.version))+")"),ls)ls.hasOwnProperty(Oe)&&ls[Oe]&&we("/"+Oe.substr(0,1).toUpperCase()+Oe.substr(1)+" ("+Eo(ae(ls[Oe]))+")");we("/CreationDate ("+Eo(ae(Te))+")"),we(">>"),we("endobj")},eu=R.__private__.putCatalog=function(L){var ae=(L=L||{}).rootDictionaryObjId||Al;switch(Pn(),we("<<"),we("/Type /Catalog"),we("/Pages "+ae+" 0 R"),Kt||(Kt="fullwidth"),Kt){case"fullwidth":we("/OpenAction [3 0 R /FitH null]");break;case"fullheight":we("/OpenAction [3 0 R /FitV null]");break;case"fullpage":we("/OpenAction [3 0 R /Fit]");break;case"original":we("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Oe=""+Kt;Oe.substr(Oe.length-1)==="%"&&(Kt=parseInt(Kt)/100),typeof Kt=="number"&&we("/OpenAction [3 0 R /XYZ null null "+J(Kt)+"]")}switch(Dt||(Dt="continuous"),Dt){case"continuous":we("/PageLayout /OneColumn");break;case"single":we("/PageLayout /SinglePage");break;case"two":case"twoleft":we("/PageLayout /TwoColumnLeft");break;case"tworight":we("/PageLayout /TwoColumnRight")}ht&&we("/PageMode /"+ht),Ws.publish("putCatalog"),we(">>"),we("endobj")},Dg=R.__private__.putTrailer=function(){we("trailer"),we("<<"),we("/Size "+(je+1)),we("/Root "+je+" 0 R"),we("/Info "+(je-1)+" 0 R"),S!==null&&we("/Encrypt "+gi.oid+" 0 R"),we("/ID [ <"+he+"> <"+he+"> ]"),we(">>")},Sn=R.__private__.putHeader=function(){we("%PDF-"+O),we("%")},tu=R.__private__.putXRef=function(){var L="0000000000";we("xref"),we("0 "+(je+1)),we("0000000000 65535 f ");for(var ae=1;ae<=je;ae++)typeof Ee[ae]=="function"?we((L+Ee[ae]()).slice(-10)+" 00000 n "):Ee[ae]!==void 0?we((L+Ee[ae]).slice(-10)+" 00000 n "):we("0000000000 00000 n ")},Cc=R.__private__.buildDocument=function(){var L;je=0,ze=0,We=[],Ee=[],st=[],Al=Ri(),wo=Ri(),Nt(We),Ws.publish("buildDocument"),Sn(),_o(),function(){Ws.publish("putAdditionalObjects");for(var Oe=0;Oe<st.length;Oe++){var Ve=st[Oe];Hi(Ve.objId,!0),we(Ve.content),we("endobj")}Ws.publish("postPutAdditionalObjects")}(),L=[],function(){for(var Oe in Ut)Ut.hasOwnProperty(Oe)&&(I===!1||I===!0&&k.hasOwnProperty(Oe))&&ad(Ut[Oe])}(),function(){var Oe;for(Oe in jt)jt.hasOwnProperty(Oe)&&yo(jt[Oe])}(),function(){for(var Oe in qr)qr.hasOwnProperty(Oe)&&$o(qr[Oe])}(),function(Oe){var Ve;for(Ve in Ht)Ht.hasOwnProperty(Ve)&&(Ht[Ve]instanceof Qp?JA(Ht[Ve]):Ht[Ve]instanceof hg&&$A(Ht[Ve],Oe))}(L),Ws.publish("putResources"),L.forEach(ph),ph({resourcesOid:wo,objectOid:Number.MAX_SAFE_INTEGER}),Ws.publish("postPutResources"),S!==null&&(gi.oid=Pn(),we("<<"),we("/Filter /Standard"),we("/V "+gi.v),we("/R "+gi.r),we("/U <"+gi.toHexString(gi.U)+">"),we("/O <"+gi.toHexString(gi.O)+">"),we("/P "+gi.P),we(">>"),we("endobj")),Sc(),eu();var ae=ze;return tu(),Dg(),we("startxref"),we(""+ae),we("%%EOF"),Nt(bt[ve]),We.join(`
`)},Ur=R.__private__.getBlob=function(L){return new Blob([Fe(L)],{type:"application/pdf"})},om=R.output=R.__private__.output=(fi=function(L,ae){switch(typeof(ae=ae||{})=="string"?ae={filename:ae}:ae.filename=ae.filename||"generated.pdf",L){case void 0:return Cc();case"save":R.save(ae.filename);break;case"arraybuffer":return Fe(Cc());case"blob":return Ur(Cc());case"bloburi":case"bloburl":if(sr.URL!==void 0&&typeof sr.URL.createObjectURL=="function")return sr.URL&&sr.URL.createObjectURL(Ur(Cc()))||void 0;Dn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Oe="",Ve=Cc();try{Oe=RV(Ve)}catch{Oe=RV(unescape(encodeURIComponent(Ve)))}return"data:application/pdf;filename="+ae.filename+";base64,"+Oe;case"pdfobjectnewwindow":if(Object.prototype.toString.call(sr)==="[object Window]"){var tt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",yt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ae.pdfObjectUrl&&(tt=ae.pdfObjectUrl,yt="");var Pt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+tt+'"'+yt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ae)+");<\/script></body></html>",ws=sr.open();return ws!==null&&ws.document.write(Pt),ws}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(sr)==="[object Window]"){var ks='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ae.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ae.filename+'" width="500px" height="400px" /></body></html>',Js=sr.open();if(Js!==null){Js.document.write(ks);var lr=this;Js.document.documentElement.querySelector("#pdfViewer").onload=function(){Js.document.title=ae.filename,Js.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(lr.output("bloburl"))}}return Js}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(sr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Fr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ae)+'"></iframe></body></html>',sn=sr.open();if(sn!==null&&(sn.document.write(Fr),sn.document.title=ae.filename),sn||typeof safari>"u")return sn;break;case"datauri":case"dataurl":return sr.document.location.href=this.output("datauristring",ae);default:return null}},fi.foo=function(){try{return fi.apply(this,arguments)}catch(Oe){var L=Oe.stack||"";~L.indexOf(" at ")&&(L=L.split(" at ")[1]);var ae="Error in function "+L.split(`
`)[0].split("<")[0]+": "+Oe.message;if(!sr.console)throw new Error(ae);sr.console.error(ae,Oe),sr.alert&&alert(ae)}},fi.foo.bar=fi,fi.foo),ro=function(L){return Array.isArray(mi)===!0&&mi.indexOf(L)>-1};switch(d){case"pt":Rs=1;break;case"mm":Rs=72/25.4;break;case"cm":Rs=72/2.54;break;case"in":Rs=72;break;case"px":Rs=ro("px_scaling")==1?.75:96/72;break;case"pc":case"em":Rs=12;break;case"ex":Rs=6;break;default:if(typeof d!="number")throw new Error("Invalid unit: "+d);Rs=d}var gi=null;Ue(),ee();var ul=R.__private__.getPageInfo=R.getPageInfo=function(L){if(isNaN(L)||L%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ms[L].objId,pageNumber:L,pageContext:ms[L]}},cm=R.__private__.getPageInfoByObjId=function(L){if(isNaN(L)||L%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ae in ms)if(ms[ae].objId===L)break;return ul(ae)},Bg=R.__private__.getCurrentPageInfo=R.getCurrentPageInfo=function(){return{objId:ms[ve].objId,pageNumber:ve,pageContext:ms[ve]}};R.addPage=function(){return im.apply(this,arguments),this},R.setPage=function(){return ZA.apply(this,arguments),Nt.call(this,bt[ve]),this},R.insertPage=function(L){return this.addPage(),this.movePage(ve,L),this},R.movePage=function(L,ae){var Oe,Ve;if(L>ae){Oe=bt[L],Ve=ms[L];for(var tt=L;tt>ae;tt--)bt[tt]=bt[tt-1],ms[tt]=ms[tt-1];bt[ae]=Oe,ms[ae]=Ve,this.setPage(ae)}else if(L<ae){Oe=bt[L],Ve=ms[L];for(var yt=L;yt<ae;yt++)bt[yt]=bt[yt+1],ms[yt]=ms[yt+1];bt[ae]=Oe,ms[ae]=Ve,this.setPage(ae)}return this},R.deletePage=function(){return fh.apply(this,arguments),this},R.__private__.text=R.text=function(L,ae,Oe,Ve,tt){var yt,Pt,ws,ks,Js,lr,Fr,sn,bi,Gr=(Ve=Ve||{}).scope||this;if(typeof L=="number"&&typeof ae=="number"&&(typeof Oe=="string"||Array.isArray(Oe))){var xi=Oe;Oe=ae,ae=L,L=xi}if(arguments[3]instanceof Ds==0?(ws=arguments[4],ks=arguments[5],bn(Fr=arguments[3])==="object"&&Fr!==null||(typeof ws=="string"&&(ks=ws,ws=null),typeof Fr=="string"&&(ks=Fr,Fr=null),typeof Fr=="number"&&(ws=Fr,Fr=null),Ve={flags:Fr,angle:ws,align:ks})):(H("The transform parameter of text() with a Matrix value"),bi=tt),isNaN(ae)||isNaN(Oe)||L==null)throw new Error("Invalid arguments passed to jsPDF.text");if(L.length===0)return Gr;var vi,Ts="",bl=typeof Ve.lineHeightFactor=="number"?Ve.lineHeightFactor:sA,ec=Gr.internal.scaleFactor;function xl(Yr){return Yr=Yr.split("	").join(Array(Ve.TabLen||9).join(" ")),Eo(Yr,Fr)}function Sh(Yr){for(var un,ai=Yr.concat(),_i=[],wl=ai.length;wl--;)typeof(un=ai.shift())=="string"?_i.push(un):Array.isArray(Yr)&&(un.length===1||un[1]===void 0&&un[2]===void 0)?_i.push(un[0]):_i.push([un[0],un[1],un[2]]);return _i}function od(Yr,un){var ai;if(typeof Yr=="string")ai=un(Yr)[0];else if(Array.isArray(Yr)){for(var _i,wl,Bh=Yr.concat(),md=[],ou=Bh.length;ou--;)typeof(_i=Bh.shift())=="string"?md.push(un(_i)[0]):Array.isArray(_i)&&typeof _i[0]=="string"&&(wl=un(_i[0],_i[1],_i[2]),md.push([wl[0],wl[1],wl[2]]));ai=md}return ai}var cd=!1,iA=!0;if(typeof L=="string")cd=!0;else if(Array.isArray(L)){var aA=L.concat();Pt=[];for(var Ic,Ji=aA.length;Ji--;)(typeof(Ic=aA.shift())!="string"||Array.isArray(Ic)&&typeof Ic[0]!="string")&&(iA=!1);cd=iA}if(cd===!1)throw new Error('Type of text must be string or Array. "'+L+'" is not recognized.');typeof L=="string"&&(L=L.match(/[\r?\n]/)?L.split(/\r\n|\r|\n/g):[L]);var oA=$e/Gr.internal.scaleFactor,ld=oA*(bl-1);switch(Ve.baseline){case"bottom":Oe-=ld;break;case"top":Oe+=oA-ld;break;case"hanging":Oe+=oA-2*ld;break;case"middle":Oe+=oA/2-ld}if((lr=Ve.maxWidth||0)>0&&(typeof L=="string"?L=Gr.splitTextToSize(L,lr):Object.prototype.toString.call(L)==="[object Array]"&&(L=L.reduce(function(Yr,un){return Yr.concat(Gr.splitTextToSize(un,lr))},[]))),yt={text:L,x:ae,y:Oe,options:Ve,mutex:{pdfEscape:Eo,activeFontKey:Zt,fonts:Ut,activeFontSize:$e}},Ws.publish("preProcessText",yt),L=yt.text,ws=(Ve=yt.options).angle,bi instanceof Ds==0&&ws&&typeof ws=="number"){ws*=Math.PI/180,Ve.rotationDirection===0&&(ws=-ws),X===$&&(ws=-ws);var Ch=Math.cos(ws),No=Math.sin(ws);bi=new Ds(Ch,No,-No,Ch,0,0)}else ws&&ws instanceof Ds&&(bi=ws);X!==$||bi||(bi=wa),(Js=Ve.charSpace||fl)!==void 0&&(Ts+=le(se(Js))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(sn=Ve.horizontalScale)!==void 0&&(Ts+=le(100*sn)+` Tz
`),Ve.lang;var ya=-1,vl=Ve.renderingMode!==void 0?Ve.renderingMode:Ve.stroke,au=Gr.internal.getCurrentPageInfo().pageContext;switch(vl){case 0:case!1:case"fill":ya=0;break;case 1:case!0:case"stroke":ya=1;break;case 2:case"fillThenStroke":ya=2;break;case 3:case"invisible":ya=3;break;case 4:case"fillAndAddForClipping":ya=4;break;case 5:case"strokeAndAddPathForClipping":ya=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ya=6;break;case 7:case"addToPathForClipping":ya=7}var Nh=au.usedRenderingMode!==void 0?au.usedRenderingMode:-1;ya!==-1?Ts+=ya+` Tr
`:Nh!==-1&&(Ts+=`0 Tr
`),ya!==-1&&(au.usedRenderingMode=ya),ks=Ve.align||"left";var Ua,cA=$e*bl,Th=Gr.internal.pageSize.getWidth(),Rh=Ut[Zt];Js=Ve.charSpace||fl,lr=Ve.maxWidth||0,Fr=Object.assign({autoencode:!0,noBOM:!0},Ve.flags);var wi=[],lA=function(Yr){return Gr.getStringUnitWidth(Yr,{font:Rh,charSpace:Js,fontSize:$e,doKerning:!1})*$e/ec};if(Object.prototype.toString.call(L)==="[object Array]"){var no;Pt=Sh(L),ks!=="left"&&(Ua=Pt.map(lA));var io,dd=0;if(ks==="right"){ae-=Ua[0],L=[],Ji=Pt.length;for(var tc=0;tc<Ji;tc++)tc===0?(io=pl(ae),no=ml(Oe)):(io=se(dd-Ua[tc]),no=-cA),L.push([Pt[tc],io,no]),dd=Ua[tc]}else if(ks==="center"){ae-=Ua[0]/2,L=[],Ji=Pt.length;for(var Ad=0;Ad<Ji;Ad++)Ad===0?(io=pl(ae),no=ml(Oe)):(io=se((dd-Ua[Ad])/2),no=-cA),L.push([Pt[Ad],io,no]),dd=Ua[Ad]}else if(ks==="left"){L=[],Ji=Pt.length;for(var Ih=0;Ih<Ji;Ih++)L.push(Pt[Ih])}else if(ks==="justify"&&Rh.encoding==="Identity-H"){L=[],Ji=Pt.length,lr=lr!==0?lr:Th;for(var dA=0,Fn=0;Fn<Ji;Fn++)if(no=Fn===0?ml(Oe):-cA,io=Fn===0?pl(ae):dA,Fn<Ji-1){var gm=se((lr-Ua[Fn])/(Pt[Fn].split(" ").length-1)),Oc=Pt[Fn].split(" ");L.push([Oc[0]+" ",io,no]),dA=0;for(var ao=1;ao<Oc.length;ao++){var Oh=(lA(Oc[ao-1]+" "+Oc[ao])-lA(Oc[ao]))*ec+gm;ao==Oc.length-1?L.push([Oc[ao],Oh,0]):L.push([Oc[ao]+" ",Oh,0]),dA-=Oh}}else L.push([Pt[Fn],io,no]);L.push(["",dA,0])}else{if(ks!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(L=[],Ji=Pt.length,lr=lr!==0?lr:Th,Fn=0;Fn<Ji;Fn++){no=Fn===0?ml(Oe):-cA,io=Fn===0?pl(ae):0;var kh=Pt[Fn].split(" ").length-1,Dh=kh>0?(lr-Ua[Fn])/kh:0;Fn<Ji-1?wi.push(le(se(Dh))):wi.push(0),L.push([Pt[Fn],io,no])}}}(typeof Ve.R2L=="boolean"?Ve.R2L:Xe)===!0&&(L=od(L,function(Yr,un,ai){return[Yr.split("").reverse().join(""),un,ai]})),yt={text:L,x:ae,y:Oe,options:Ve,mutex:{pdfEscape:Eo,activeFontKey:Zt,fonts:Ut,activeFontSize:$e}},Ws.publish("postProcessText",yt),L=yt.text,vi=yt.mutex.isHex||!1;var To=Ut[Zt].encoding;To!=="WinAnsiEncoding"&&To!=="StandardEncoding"||(L=od(L,function(Yr,un,ai){return[xl(Yr),un,ai]})),Pt=Sh(L),L=[];for(var ud,hd,qn,AA=Array.isArray(Pt[0])?1:0,pd="",uA=function(Yr,un,ai){var _i="";return ai instanceof Ds?(ai=typeof Ve.angle=="number"?An(ai,new Ds(1,0,0,1,Yr,un)):An(new Ds(1,0,0,1,Yr,un),ai),X===$&&(ai=An(new Ds(1,0,0,-1,0,0),ai)),_i=ai.join(" ")+` Tm
`):_i=le(Yr)+" "+le(un)+` Td
`,_i},Ro=0;Ro<Pt.length;Ro++){switch(pd="",AA){case 1:qn=(vi?"<":"(")+Pt[Ro][0]+(vi?">":")"),ud=parseFloat(Pt[Ro][1]),hd=parseFloat(Pt[Ro][2]);break;case 0:qn=(vi?"<":"(")+Pt[Ro]+(vi?">":")"),ud=pl(ae),hd=ml(Oe)}wi!==void 0&&wi[Ro]!==void 0&&(pd=wi[Ro]+` Tw
`),Ro===0?L.push(pd+uA(ud,hd,bi)+qn):AA===0?L.push(pd+qn):AA===1&&L.push(pd+uA(ud,hd,bi)+qn)}L=AA===0?L.join(` Tj
T* `):L.join(` Tj
`),L+=` Tj
`;var sc=`BT
/`;return sc+=Zt+" "+$e+` Tf
`,sc+=le($e*bl)+` TL
`,sc+=nA+`
`,sc+=Ts,sc+=L,we(sc+="ET"),k[Zt]=!0,Gr};var Lg=R.__private__.clip=R.clip=function(L){return we(L==="evenodd"?"W*":"W"),this};R.clipEvenOdd=function(){return Lg("evenodd")},R.__private__.discardPath=R.discardPath=function(){return we("n"),this};var Nc=R.__private__.isValidStyle=function(L){var ae=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(L)!==-1&&(ae=!0),ae};R.__private__.setDefaultPathOperation=R.setDefaultPathOperation=function(L){return Nc(L)&&(E=L),this};var lm=R.__private__.getStyle=R.getStyle=function(L){var ae=E;switch(L){case"D":case"S":ae="S";break;case"F":ae="f";break;case"FD":case"DF":ae="B";break;case"f":case"f*":case"B":case"B*":ae=L}return ae},su=R.close=function(){return we("h"),this};R.stroke=function(){return we("S"),this},R.fill=function(L){return tA("f",L),this},R.fillEvenOdd=function(L){return tA("f*",L),this},R.fillStroke=function(L){return tA("B",L),this},R.fillStrokeEvenOdd=function(L){return tA("B*",L),this};var tA=function(L,ae){bn(ae)==="object"?bh(ae,L):we(L)},hl=function(L){L===null||X===$&&L===void 0||(L=lm(L),we(L))};function jg(L,ae,Oe,Ve,tt){var yt=new hg(ae||this.boundingBox,Oe||this.xStep,Ve||this.yStep,this.gState,tt||this.matrix);yt.stream=this.stream;var Pt=L+"$$"+this.cloneIndex+++"$$";return Qi(Pt,yt),yt}var bh=function(L,ae){var Oe=vt[L.key],Ve=Ht[Oe];if(Ve instanceof Qp)we("q"),we(Pg(ae)),Ve.gState&&R.setGState(Ve.gState),we(L.matrix.toString()+" cm"),we("/"+Oe+" sh"),we("Q");else if(Ve instanceof hg){var tt=new Ds(1,0,0,-1,0,gl());L.matrix&&(tt=tt.multiply(L.matrix||wa),Oe=jg.call(Ve,L.key,L.boundingBox,L.xStep,L.yStep,tt).id),we("q"),we("/Pattern cs"),we("/"+Oe+" scn"),Ve.gState&&R.setGState(Ve.gState),we(ae),we("Q")}},Pg=function(L){switch(L){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},ru=R.moveTo=function(L,ae){return we(le(se(L))+" "+le(oe(ae))+" m"),this},dm=R.lineTo=function(L,ae){return we(le(se(L))+" "+le(oe(ae))+" l"),this},Zo=R.curveTo=function(L,ae,Oe,Ve,tt,yt){return we([le(se(L)),le(oe(ae)),le(se(Oe)),le(oe(Ve)),le(se(tt)),le(oe(yt)),"c"].join(" ")),this};R.__private__.line=R.line=function(L,ae,Oe,Ve,tt){if(isNaN(L)||isNaN(ae)||isNaN(Oe)||isNaN(Ve)||!Nc(tt))throw new Error("Invalid arguments passed to jsPDF.line");return X===Z?this.lines([[Oe-L,Ve-ae]],L,ae,[1,1],tt||"S"):this.lines([[Oe-L,Ve-ae]],L,ae,[1,1]).stroke()},R.__private__.lines=R.lines=function(L,ae,Oe,Ve,tt,yt){var Pt,ws,ks,Js,lr,Fr,sn,bi,Gr,xi,vi,Ts;if(typeof L=="number"&&(Ts=Oe,Oe=ae,ae=L,L=Ts),Ve=Ve||[1,1],yt=yt||!1,isNaN(ae)||isNaN(Oe)||!Array.isArray(L)||!Array.isArray(Ve)||!Nc(tt)||typeof yt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(ru(ae,Oe),Pt=Ve[0],ws=Ve[1],Js=L.length,xi=ae,vi=Oe,ks=0;ks<Js;ks++)(lr=L[ks]).length===2?(xi=lr[0]*Pt+xi,vi=lr[1]*ws+vi,dm(xi,vi)):(Fr=lr[0]*Pt+xi,sn=lr[1]*ws+vi,bi=lr[2]*Pt+xi,Gr=lr[3]*ws+vi,xi=lr[4]*Pt+xi,vi=lr[5]*ws+vi,Zo(Fr,sn,bi,Gr,xi,vi));return yt&&su(),hl(tt),this},R.path=function(L){for(var ae=0;ae<L.length;ae++){var Oe=L[ae],Ve=Oe.c;switch(Oe.op){case"m":ru(Ve[0],Ve[1]);break;case"l":dm(Ve[0],Ve[1]);break;case"c":Zo.apply(this,Ve);break;case"h":su()}}return this},R.__private__.rect=R.rect=function(L,ae,Oe,Ve,tt){if(isNaN(L)||isNaN(ae)||isNaN(Oe)||isNaN(Ve)||!Nc(tt))throw new Error("Invalid arguments passed to jsPDF.rect");return X===Z&&(Ve=-Ve),we([le(se(L)),le(oe(ae)),le(se(Oe)),le(se(Ve)),"re"].join(" ")),hl(tt),this},R.__private__.triangle=R.triangle=function(L,ae,Oe,Ve,tt,yt,Pt){if(isNaN(L)||isNaN(ae)||isNaN(Oe)||isNaN(Ve)||isNaN(tt)||isNaN(yt)||!Nc(Pt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Oe-L,Ve-ae],[tt-Oe,yt-Ve],[L-tt,ae-yt]],L,ae,[1,1],Pt,!0),this},R.__private__.roundedRect=R.roundedRect=function(L,ae,Oe,Ve,tt,yt,Pt){if(isNaN(L)||isNaN(ae)||isNaN(Oe)||isNaN(Ve)||isNaN(tt)||isNaN(yt)||!Nc(Pt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ws=4/3*(Math.SQRT2-1);return tt=Math.min(tt,.5*Oe),yt=Math.min(yt,.5*Ve),this.lines([[Oe-2*tt,0],[tt*ws,0,tt,yt-yt*ws,tt,yt],[0,Ve-2*yt],[0,yt*ws,-tt*ws,yt,-tt,yt],[2*tt-Oe,0],[-tt*ws,0,-tt,-yt*ws,-tt,-yt],[0,2*yt-Ve],[0,-yt*ws,tt*ws,-yt,tt,-yt]],L+tt,ae,[1,1],Pt,!0),this},R.__private__.ellipse=R.ellipse=function(L,ae,Oe,Ve,tt){if(isNaN(L)||isNaN(ae)||isNaN(Oe)||isNaN(Ve)||!Nc(tt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var yt=4/3*(Math.SQRT2-1)*Oe,Pt=4/3*(Math.SQRT2-1)*Ve;return ru(L+Oe,ae),Zo(L+Oe,ae-Pt,L+yt,ae-Ve,L,ae-Ve),Zo(L-yt,ae-Ve,L-Oe,ae-Pt,L-Oe,ae),Zo(L-Oe,ae+Pt,L-yt,ae+Ve,L,ae+Ve),Zo(L+yt,ae+Ve,L+Oe,ae+Pt,L+Oe,ae),hl(tt),this},R.__private__.circle=R.circle=function(L,ae,Oe,Ve){if(isNaN(L)||isNaN(ae)||isNaN(Oe)||!Nc(Ve))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(L,ae,Oe,Oe,Ve)},R.setFont=function(L,ae,Oe){return Oe&&(ae=Ne(ae,Oe)),Zt=gh(L,ae,{disableWarning:!1}),this};var Ug=R.__private__.getFont=R.getFont=function(){return Ut[gh.apply(R,arguments)]};R.__private__.getFontList=R.getFontList=function(){var L,ae,Oe={};for(L in zt)if(zt.hasOwnProperty(L))for(ae in Oe[L]=[],zt[L])zt[L].hasOwnProperty(ae)&&Oe[L].push(ae);return Oe},R.addFont=function(L,ae,Oe,Ve,tt){var yt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&yt.indexOf(arguments[3])!==-1?tt=arguments[3]:arguments[3]&&yt.indexOf(arguments[3])==-1&&(Oe=Ne(Oe,Ve)),Un.call(this,L,ae,Oe,tt=tt||"Identity-H")};var sA,xh=a.lineWidth||.200025,Fg=R.__private__.getLineWidth=R.getLineWidth=function(){return xh},er=R.__private__.setLineWidth=R.setLineWidth=function(L){return xh=L,we(le(se(L))+" w"),this};R.__private__.setLineDash=Ms.API.setLineDash=Ms.API.setLineDashPattern=function(L,ae){if(L=L||[],ae=ae||0,isNaN(ae)||!Array.isArray(L))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return L=L.map(function(Oe){return le(se(Oe))}).join(" "),ae=le(se(ae)),we("["+L+"] "+ae+" d"),this};var Mg=R.__private__.getLineHeight=R.getLineHeight=function(){return $e*sA};R.__private__.getLineHeight=R.getLineHeight=function(){return $e*sA};var Am=R.__private__.setLineHeightFactor=R.setLineHeightFactor=function(L){return typeof(L=L||1.15)=="number"&&(sA=L),this},Vg=R.__private__.getLineHeightFactor=R.getLineHeightFactor=function(){return sA};Am(a.lineHeight);var pl=R.__private__.getHorizontalCoordinate=function(L){return se(L)},ml=R.__private__.getVerticalCoordinate=function(L){return X===$?L:ms[ve].mediaBox.topRightY-ms[ve].mediaBox.bottomLeftY-se(L)},rA=R.__private__.getHorizontalCoordinateString=R.getHorizontalCoordinateString=function(L){return le(pl(L))},Qg=R.__private__.getVerticalCoordinateString=R.getVerticalCoordinateString=function(L){return le(ml(L))},nu=a.strokeColor||"0 G";R.__private__.getStrokeColor=R.getDrawColor=function(){return Ec(nu)},R.__private__.setStrokeColor=R.setDrawColor=function(L,ae,Oe,Ve){return nu=Xo({ch1:L,ch2:ae,ch3:Oe,ch4:Ve,pdfColorType:"draw",precision:2}),we(nu),this};var vh=a.fillColor||"0 g";R.__private__.getFillColor=R.getFillColor=function(){return Ec(vh)},R.__private__.setFillColor=R.setFillColor=function(L,ae,Oe,Ve){return vh=Xo({ch1:L,ch2:ae,ch3:Oe,ch4:Ve,pdfColorType:"fill",precision:2}),we(vh),this};var nA=a.textColor||"0 g",um=R.__private__.getTextColor=R.getTextColor=function(){return Ec(nA)};R.__private__.setTextColor=R.setTextColor=function(L,ae,Oe,Ve){return nA=Xo({ch1:L,ch2:ae,ch3:Oe,ch4:Ve,pdfColorType:"text",precision:3}),this};var fl=a.charSpace,Hg=R.__private__.getCharSpace=R.getCharSpace=function(){return parseFloat(fl||0)};R.__private__.setCharSpace=R.setCharSpace=function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return fl=L,this};var wh=0;R.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},R.__private__.setLineCap=R.setLineCap=function(L){var ae=R.CapJoinStyles[L];if(ae===void 0)throw new Error("Line cap style of '"+L+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return wh=ae,we(ae+" J"),this};var So=0;R.__private__.setLineJoin=R.setLineJoin=function(L){var ae=R.CapJoinStyles[L];if(ae===void 0)throw new Error("Line join style of '"+L+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return So=ae,we(ae+" j"),this},R.__private__.setLineMiterLimit=R.__private__.setMiterLimit=R.setLineMiterLimit=R.setMiterLimit=function(L){if(L=L||0,isNaN(L))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return we(le(se(L))+" M"),this},R.GState=Jy,R.setGState=function(L){(L=typeof L=="string"?jt[ps[L]]:_a(null,L)).equals(Qs)||(we("/"+L.id+" gs"),Qs=L)};var _a=function(L,ae){if(!L||!ps[L]){var Oe=!1;for(var Ve in jt)if(jt.hasOwnProperty(Ve)&&jt[Ve].equals(ae)){Oe=!0;break}if(Oe)ae=jt[Ve];else{var tt="GS"+(Object.keys(jt).length+1).toString(10);jt[tt]=ae,ae.id=tt}return L&&(ps[L]=ae.id),Ws.publish("addGState",ae),ae}};R.addGState=function(L,ae){return _a(L,ae),this},R.saveGraphicsState=function(){return we("q"),rs.push({key:Zt,size:$e,color:nA}),this},R.restoreGraphicsState=function(){we("Q");var L=rs.pop();return Zt=L.key,$e=L.size,nA=L.color,Qs=null,this},R.setCurrentTransformationMatrix=function(L){return we(L.toString()+" cm"),this},R.comment=function(L){return we("#"+L),this};var Tc=function(L,ae){var Oe=L||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Oe},set:function(yt){isNaN(yt)||(Oe=parseFloat(yt))}});var Ve=ae||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Ve},set:function(yt){isNaN(yt)||(Ve=parseFloat(yt))}});var tt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return tt},set:function(yt){tt=yt.toString()}}),this},_h=function(L,ae,Oe,Ve){Tc.call(this,L,ae),this.type="rect";var tt=Oe||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return tt},set:function(Pt){isNaN(Pt)||(tt=parseFloat(Pt))}});var yt=Ve||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return yt},set:function(Pt){isNaN(Pt)||(yt=parseFloat(Pt))}}),this},iu=function(){this.page=Is,this.currentPage=ve,this.pages=bt.slice(0),this.pagesContext=ms.slice(0),this.x=es,this.y=Zs,this.matrix=pt,this.width=Eh(ve),this.height=pm(ve),this.outputDestination=rt,this.id="",this.objectNumber=-1};iu.prototype.restore=function(){Is=this.page,ve=this.currentPage,ms=this.pagesContext,bt=this.pages,es=this.x,Zs=this.y,pt=this.matrix,hm(ve,this.width),Co(ve,this.height),rt=this.outputDestination};var yh=function(L,ae,Oe,Ve,tt){Xi.push(new iu),Is=ve=0,bt=[],es=L,Zs=ae,pt=tt,mh([Oe,Ve])};for(var ii in R.beginFormObject=function(L,ae,Oe,Ve,tt){return yh(L,ae,Oe,Ve,tt),this},R.endFormObject=function(L){return function(ae){if(oa[ae])Xi.pop().restore();else{var Oe=new iu,Ve="Xo"+(Object.keys(qr).length+1).toString(10);Oe.id=Ve,oa[ae]=Ve,qr[Ve]=Oe,Ws.publish("addFormObject",Oe),Xi.pop().restore()}}(L),this},R.doFormObject=function(L,ae){var Oe=qr[oa[L]];return we("q"),we(ae.toString()+" cm"),we("/"+Oe.id+" Do"),we("Q"),this},R.getFormObject=function(L){var ae=qr[oa[L]];return{x:ae.x,y:ae.y,width:ae.width,height:ae.height,matrix:ae.matrix}},R.save=function(L,ae){return L=L||"generated.pdf",(ae=ae||{}).returnPromise=ae.returnPromise||!1,ae.returnPromise===!1?(Fp(Ur(Cc()),L),typeof Fp.unload=="function"&&sr.setTimeout&&setTimeout(Fp.unload,911),this):new Promise(function(Oe,Ve){try{var tt=Fp(Ur(Cc()),L);typeof Fp.unload=="function"&&sr.setTimeout&&setTimeout(Fp.unload,911),Oe(tt)}catch(yt){Ve(yt.message)}})},Ms.API)Ms.API.hasOwnProperty(ii)&&(ii==="events"&&Ms.API.events.length?function(L,ae){var Oe,Ve,tt;for(tt=ae.length-1;tt!==-1;tt--)Oe=ae[tt][0],Ve=ae[tt][1],L.subscribe.apply(L,[Oe].concat(typeof Ve=="function"?[Ve]:Ve))}(Ws,Ms.API.events):R[ii]=Ms.API[ii]);function Eh(L){return ms[L].mediaBox.topRightX-ms[L].mediaBox.bottomLeftX}function hm(L,ae){ms[L].mediaBox.topRightX=ae+ms[L].mediaBox.bottomLeftX}function pm(L){return ms[L].mediaBox.topRightY-ms[L].mediaBox.bottomLeftY}function Co(L,ae){ms[L].mediaBox.topRightY=ae+ms[L].mediaBox.bottomLeftY}var Rc=R.getPageWidth=function(L){return Eh(L=L||ve)/Rs},mm=R.setPageWidth=function(L,ae){hm(L,ae*Rs)},gl=R.getPageHeight=function(L){return pm(L=L||ve)/Rs},fm=R.setPageHeight=function(L,ae){Co(L,ae*Rs)};return R.internal={pdfEscape:Eo,getStyle:lm,getFont:Ug,getFontSize:qt,getCharSpace:Hg,getTextColor:um,getLineHeight:Mg,getLineHeightFactor:Vg,getLineWidth:Fg,write:Rt,getHorizontalCoordinate:pl,getVerticalCoordinate:ml,getCoordinateString:rA,getVerticalCoordinateString:Qg,collections:{},newObject:Pn,newAdditionalObject:eA,newObjectDeferred:Ri,newObjectDeferredBegin:Hi,getFilters:Jo,putStream:so,events:Ws,scaleFactor:Rs,pageSize:{getWidth:function(){return Rc(ve)},setWidth:function(L){mm(ve,L)},getHeight:function(){return gl(ve)},setHeight:function(L){fm(ve,L)}},encryptionOptions:S,encryption:gi,getEncryptor:function(L){return S!==null?gi.encryptor(L,0):function(ae){return ae}},output:om,getNumberOfPages:am,get pages(){return bt},out:we,f2:J,f3:Y,getPageInfo:ul,getPageInfoByObjId:cm,getCurrentPageInfo:Bg,getPDFVersion:F,Point:Tc,Rectangle:_h,Matrix:Ds,hasHotfix:ro},Object.defineProperty(R.internal.pageSize,"width",{get:function(){return Rc(ve)},set:function(L){mm(ve,L)},enumerable:!0,configurable:!0}),Object.defineProperty(R.internal.pageSize,"height",{get:function(){return gl(ve)},set:function(L){fm(ve,L)},enumerable:!0,configurable:!0}),(function(L){for(var ae=0,Oe=et.length;ae<Oe;ae++){var Ve=Un.call(this,L[ae][0],L[ae][1],L[ae][2],et[ae][3],!0);I===!1&&(k[Ve]=!0);var tt=L[ae][0].split("-");nm({id:Ve,fontName:tt[0],fontStyle:tt[1]||""})}Ws.publish("addFonts",{fonts:Ut,dictionary:zt})}).call(R,et),Zt="F1",im(h,c),Ws.publish("initialized"),R}dg.prototype.lsbFirstWord=function(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)},dg.prototype.toHexString=function(a){return a.split("").map(function(o){return("0"+(255&o.charCodeAt(0)).toString(16)).slice(-2)}).join("")},dg.prototype.hexToBytes=function(a){for(var o=[],c=0;c<a.length;c+=2)o.push(String.fromCharCode(parseInt(a.substr(c,2),16)));return o.join("")},dg.prototype.processOwnerPassword=function(a,o){return WR(KR(o).substr(0,5),a)},dg.prototype.encryptor=function(a,o){var c=KR(this.encryptionKey+String.fromCharCode(255&a,a>>8&255,a>>16&255,255&o,o>>8&255)).substr(0,10);return function(d){return WR(c,d)}},Jy.prototype.equals=function(a){var o,c="id,objectNumber,equals";if(!a||bn(a)!==bn(this))return!1;var d=0;for(o in this)if(!(c.indexOf(o)>=0)){if(this.hasOwnProperty(o)&&!a.hasOwnProperty(o)||this[o]!==a[o])return!1;d++}for(o in a)a.hasOwnProperty(o)&&c.indexOf(o)<0&&d--;return d===0},Ms.API={events:[]},Ms.version="4.2.0";var Ni=Ms.API,wI=1,rm=function(a){return a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},rg=function(a){return a.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},em=function(a){return a.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(o){var c=o.charCodeAt(0).toString(16).toUpperCase();return"#"+(c.length===1?"0"+c:c)})},hr=function(a){return a.toFixed(2)},qu=function(a){return a.toFixed(5)};Ni.__acroform__={};var Yo=function(a,o){a.prototype=Object.create(o.prototype),a.prototype.constructor=a},DV=function(a){return a*wI},Wd=function(a){var o=new pG,c=Ns.internal.getHeight(a)||0,d=Ns.internal.getWidth(a)||0;return o.BBox=[0,0,Number(hr(d)),Number(hr(c))],o},Tge=Ni.__acroform__.setBit=function(a,o){if(a=a||0,o=o||0,isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return a|1<<o},Rge=Ni.__acroform__.clearBit=function(a,o){if(a=a||0,o=o||0,isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return a&~(1<<o)},Ige=Ni.__acroform__.getBit=function(a,o){if(isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return a&1<<o?1:0},Ui=Ni.__acroform__.getBitForPdf=function(a,o){if(isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Ige(a,o-1)},Fi=Ni.__acroform__.setBitForPdf=function(a,o){if(isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Tge(a,o-1)},Mi=Ni.__acroform__.clearBitForPdf=function(a,o){if(isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Rge(a,o-1)},Oge=Ni.__acroform__.calculateCoordinates=function(a,o){var c=o.internal.getHorizontalCoordinate,d=o.internal.getVerticalCoordinate,h=a[0],m=a[1],g=a[2],x=a[3],v={};return v.lowerLeft_X=c(h)||0,v.lowerLeft_Y=d(m+x)||0,v.upperRight_X=c(h+g)||0,v.upperRight_Y=d(m)||0,[Number(hr(v.lowerLeft_X)),Number(hr(v.lowerLeft_Y)),Number(hr(v.upperRight_X)),Number(hr(v.upperRight_Y))]},kge=function(a){if(a.appearanceStreamContent)return a.appearanceStreamContent;if(a.V||a.DV){var o=[],c=a._V||a.DV,d=zR(a,c),h=a.scope.internal.getFont(a.fontName,a.fontStyle).id;o.push("/Tx BMC"),o.push("q"),o.push("BT"),o.push(a.scope.__private__.encodeColorString(a.color)),o.push("/"+h+" "+hr(d.fontSize)+" Tf"),o.push("1 0 0 1 0 0 Tm"),o.push(d.text),o.push("ET"),o.push("Q"),o.push("EMC");var m=Wd(a);return m.scope=a.scope,m.stream=o.join(`
`),m}},zR=function(a,o){var c=a.fontSize===0?a.maxFontSize:a.fontSize,d={text:"",fontSize:""},h=(o=(o=o.substr(0,1)=="("?o.substr(1):o).substr(o.length-1)==")"?o.substr(0,o.length-1):o).split(" ");h=a.multiline?h.map(function(J){return J.split(`
`)}):h.map(function(J){return[J]});var m=c,g=Ns.internal.getHeight(a)||0;g=g<0?-g:g;var x=Ns.internal.getWidth(a)||0;x=x<0?-x:x;var v=function(J,Y,se){if(J+1<h.length){var oe=Y+" "+h[J+1][0];return hy(oe,a,se).width<=x-4}return!1};m++;e:for(;m>0;){o="",m--;var E,S,I=hy("3",a,m).height,k=a.multiline?g-m:(g-I)/2,R=k+=2,O=0,F=0,M=0;if(m<=0){o=`(...) Tj
`,o+="% Width of Text: "+hy(o,a,m=12).width+", FieldWidth:"+x+`
`;break}for(var Q="",Z=0,$=0;$<h.length;$++)if(h.hasOwnProperty($)){var X=!1;if(h[$].length!==1&&M!==h[$].length-1){if((I+2)*(Z+2)+2>g)continue e;Q+=h[$][M],X=!0,F=$,$--}else{Q=(Q+=h[$][M]+" ").substr(Q.length-1)==" "?Q.substr(0,Q.length-1):Q;var be=parseInt($),me=v(be,Q,m),Ne=$>=h.length-1;if(me&&!Ne){Q+=" ",M=0;continue}if(me||Ne){if(Ne)F=be;else if(a.multiline&&(I+2)*(Z+2)+2>g)continue e}else{if(!a.multiline||(I+2)*(Z+2)+2>g)continue e;F=be}}for(var le="",H=O;H<=F;H++){var Ae=h[H];if(a.multiline){if(H===F){le+=Ae[M]+" ",M=(M+1)%Ae.length;continue}if(H===O){le+=Ae[Ae.length-1]+" ";continue}}le+=Ae[0]+" "}switch(le=le.substr(le.length-1)==" "?le.substr(0,le.length-1):le,S=hy(le,a,m).width,a.textAlign){case"right":E=x-S-2;break;case"center":E=(x-S)/2;break;default:E=2}o+=hr(E)+" "+hr(R)+` Td
`,o+="("+rm(le)+`) Tj
`,o+=-hr(E)+` 0 Td
`,R=-(m+2),S=0,O=X?F:F+1,Z++,Q=""}break}return d.text=o,d.fontSize=m,d},hy=function(a,o,c){var d=o.scope.internal.getFont(o.fontName,o.fontStyle),h=o.scope.getStringUnitWidth(a,{font:d,fontSize:parseFloat(c),charSpace:0})*parseFloat(c);return{height:o.scope.getStringUnitWidth("3",{font:d,fontSize:parseFloat(c),charSpace:0})*parseFloat(c)*1.5,width:h}},Dge={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Bge=function(a,o){var c={type:"reference",object:a};o.internal.getPageInfo(a.page).pageContext.annotations.find(function(d){return d.type===c.type&&d.object===c.object})===void 0&&o.internal.getPageInfo(a.page).pageContext.annotations.push(c)},Lge=function(a,o){if(o.scope=a,a.internal!==void 0&&(a.internal.acroformPlugin===void 0||a.internal.acroformPlugin.isInitialized===!1)){if(rd.FieldNum=0,a.internal.acroformPlugin=JSON.parse(JSON.stringify(Dge)),a.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");wI=a.internal.scaleFactor,a.internal.acroformPlugin.acroFormDictionaryRoot=new mG,a.internal.acroformPlugin.acroFormDictionaryRoot.scope=a,a.internal.acroformPlugin.acroFormDictionaryRoot._eventID=a.internal.events.subscribe("postPutResources",function(){(function(c){c.internal.events.unsubscribe(c.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete c.internal.acroformPlugin.acroFormDictionaryRoot._eventID,c.internal.acroformPlugin.printedOut=!0})(a)}),a.internal.events.subscribe("buildDocument",function(){(function(c){c.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var d=c.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var h in d)if(d.hasOwnProperty(h)){var m=d[h];m.objId=void 0,m.hasAnnotation&&Bge(m,c)}})(a)}),a.internal.events.subscribe("putCatalog",function(){(function(c){if(c.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");c.internal.write("/AcroForm "+c.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(a)}),a.internal.events.subscribe("postPutPages",function(c){(function(d,h){var m=!d;for(var g in d||(h.internal.newObjectDeferredBegin(h.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),h.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),d=d||h.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(d.hasOwnProperty(g)){var x=d[g],v=[],E=x.Rect;if(x.Rect&&(x.Rect=Oge(x.Rect,h)),h.internal.newObjectDeferredBegin(x.objId,!0),x.DA=Ns.createDefaultAppearanceStream(x),bn(x)==="object"&&typeof x.getKeyValueListForStream=="function"&&(v=x.getKeyValueListForStream()),x.Rect=E,x.hasAppearanceStream&&!x.appearanceStreamContent){var S=kge(x);v.push({key:"AP",value:"<</N "+S+">>"}),h.internal.acroformPlugin.xForms.push(S)}if(x.appearanceStreamContent){var I="";for(var k in x.appearanceStreamContent)if(x.appearanceStreamContent.hasOwnProperty(k)){var R=x.appearanceStreamContent[k];if(I+="/"+k+" ",I+="<<",Object.keys(R).length>=1||Array.isArray(R)){for(var g in R)if(R.hasOwnProperty(g)){var O=R[g];typeof O=="function"&&(O=O.call(h,x)),I+="/"+g+" "+O+" ",h.internal.acroformPlugin.xForms.indexOf(O)>=0||h.internal.acroformPlugin.xForms.push(O)}}else typeof(O=R)=="function"&&(O=O.call(h,x)),I+="/"+g+" "+O,h.internal.acroformPlugin.xForms.indexOf(O)>=0||h.internal.acroformPlugin.xForms.push(O);I+=">>"}v.push({key:"AP",value:`<<
`+I+">>"})}h.internal.putStream({additionalKeyValues:v,objectId:x.objId}),h.internal.out("endobj")}m&&function(F,M){for(var Q in F)if(F.hasOwnProperty(Q)){var Z=Q,$=F[Q];M.internal.newObjectDeferredBegin($.objId,!0),bn($)==="object"&&typeof $.putStream=="function"&&$.putStream(),delete F[Z]}}(h.internal.acroformPlugin.xForms,h)})(c,a)}),a.internal.acroformPlugin.isInitialized=!0}},hG=Ni.__acroform__.arrayToPdfArray=function(a,o,c){var d=function(g){return g};if(Array.isArray(a)){for(var h="[",m=0;m<a.length;m++)switch(m!==0&&(h+=" "),bn(a[m])){case"boolean":case"number":case"object":h+=a[m].toString();break;case"string":a[m].substr(0,1)==="/"?h+="/"+em(a[m].substr(1)):(o!==void 0&&c&&(d=c.internal.getEncryptor(o)),h+="("+rm(d(a[m].toString()))+")")}return h+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},jT=function(a,o,c){var d=function(h){return h};return o!==void 0&&c&&(d=c.internal.getEncryptor(o)),(a=a||"").toString(),"("+rm(d(a))+")"},Yd=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(a){this._objId=a}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Yd.prototype.toString=function(){return this.objId+" 0 R"},Yd.prototype.putStream=function(){var a=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:a,objectId:this.objId}),this.scope.internal.out("endobj")},Yd.prototype.getKeyValueListForStream=function(){var a=[],o=Object.getOwnPropertyNames(this).filter(function(m){return m!="content"&&m!="appearanceStreamContent"&&m!="scope"&&m!="objId"&&m.substring(0,1)!="_"});for(var c in o)if(Object.getOwnPropertyDescriptor(this,o[c]).configurable===!1){var d=o[c],h=this[d];h&&(Array.isArray(h)?a.push({key:d,value:hG(h,this.objId,this.scope)}):h instanceof Yd?(h.scope=this.scope,a.push({key:d,value:h.objId+" 0 R"})):typeof h!="function"&&a.push({key:d,value:h}))}return a};var pG=function(){Yd.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var a,o=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return o},set:function(c){o=c}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(c){a=c.trim()},get:function(){return a||null}})};Yo(pG,Yd);var mG=function(){Yd.call(this);var a,o=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return o.length>0?o:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return o}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(a){var c=function(d){return d};return this.scope&&(c=this.scope.internal.getEncryptor(this.objId)),"("+rm(c(a))+")"}},set:function(c){a=c}})};Yo(mG,Yd);var rd=function a(){Yd.call(this);var o=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return o},set:function(Q){if(isNaN(Q))throw new Error('Invalid value "'+Q+'" for attribute F supplied.');o=Q}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Ui(o,3)},set:function(Q){Q?this.F=Fi(o,3):this.F=Mi(o,3)}});var c=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return c},set:function(Q){if(isNaN(Q))throw new Error('Invalid value "'+Q+'" for attribute Ff supplied.');c=Q}});var d=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(d.length!==0)return d},set:function(Q){d=Q!==void 0?Q:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!d||isNaN(d[0])?0:d[0]},set:function(Q){d[0]=Q}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!d||isNaN(d[1])?0:d[1]},set:function(Q){d[1]=Q}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!d||isNaN(d[2])?0:d[2]},set:function(Q){d[2]=Q}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!d||isNaN(d[3])?0:d[3]},set:function(Q){d[3]=Q}});var h="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return h},set:function(Q){switch(Q){case"/Btn":case"/Tx":case"/Ch":case"/Sig":h=Q;break;default:throw new Error('Invalid value "'+Q+'" for attribute FT supplied.')}}});var m=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!m||m.length<1){if(this instanceof $y)return;m="FieldObject"+a.FieldNum++}var Q=function(Z){return Z};return this.scope&&(Q=this.scope.internal.getEncryptor(this.objId)),"("+rm(Q(m))+")"},set:function(Q){m=Q.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return m},set:function(Q){m=Q}});var g="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return g},set:function(Q){g=Q}});var x="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return x},set:function(Q){x=Q}});var v=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return v},set:function(Q){v=Q}});var E=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return E===void 0?50/wI:E},set:function(Q){E=Q}});var S="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return S},set:function(Q){S=Q}});var I="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!I||this instanceof $y||this instanceof Yp))return jT(I,this.objId,this.scope)},set:function(Q){Q=Q.toString(),I=Q}});var k=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(k)return this instanceof xa==0?jT(k,this.objId,this.scope):k},set:function(Q){Q=Q.toString(),k=this instanceof xa==0?Q.substr(0,1)==="("?rg(Q.substr(1,Q.length-2)):rg(Q):Q}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof xa==1?rg(k.substr(1,k.length-1)):k},set:function(Q){Q=Q.toString(),k=this instanceof xa==1?"/"+em(Q):Q}});var R=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(R)return R},set:function(Q){this.V=Q}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(R)return this instanceof xa==0?jT(R,this.objId,this.scope):R},set:function(Q){Q=Q.toString(),R=this instanceof xa==0?Q.substr(0,1)==="("?rg(Q.substr(1,Q.length-2)):rg(Q):Q}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof xa==1?rg(R.substr(1,R.length-1)):R},set:function(Q){Q=Q.toString(),R=this instanceof xa==1?"/"+em(Q):Q}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var O,F=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return F},set:function(Q){Q=!!Q,F=Q}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(O)return O},set:function(Q){O=Q}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,1)},set:function(Q){Q?this.Ff=Fi(this.Ff,1):this.Ff=Mi(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,2)},set:function(Q){Q?this.Ff=Fi(this.Ff,2):this.Ff=Mi(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,3)},set:function(Q){Q?this.Ff=Fi(this.Ff,3):this.Ff=Mi(this.Ff,3)}});var M=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(M!==null)return M},set:function(Q){if([0,1,2].indexOf(Q)===-1)throw new Error('Invalid value "'+Q+'" for attribute Q supplied.');M=Q}}),Object.defineProperty(this,"textAlign",{get:function(){var Q;switch(M){case 0:default:Q="left";break;case 1:Q="center";break;case 2:Q="right"}return Q},configurable:!0,enumerable:!0,set:function(Q){switch(Q){case"right":case 2:M=2;break;case"center":case 1:M=1;break;default:M=0}}})};Yo(rd,Yd);var gg=function(){rd.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var a=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return a},set:function(c){a=c}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return a},set:function(c){a=c}});var o=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return hG(o,this.objId,this.scope)},set:function(c){var d,h;h=[],typeof(d=c)=="string"&&(h=function(m,g,x){x||(x=1);for(var v,E=[];v=g.exec(m);)E.push(v[x]);return E}(d,/\((.*?)\)/g)),o=h}}),this.getOptions=function(){return o},this.setOptions=function(c){o=c,this.sort&&o.sort()},this.addOption=function(c){c=(c=c||"").toString(),o.push(c),this.sort&&o.sort()},this.removeOption=function(c,d){for(d=d||!1,c=(c=c||"").toString();o.indexOf(c)!==-1&&(o.splice(o.indexOf(c),1),d!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,18)},set:function(c){c?this.Ff=Fi(this.Ff,18):this.Ff=Mi(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,19)},set:function(c){this.combo===!0&&(c?this.Ff=Fi(this.Ff,19):this.Ff=Mi(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,20)},set:function(c){c?(this.Ff=Fi(this.Ff,20),o.sort()):this.Ff=Mi(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,22)},set:function(c){c?this.Ff=Fi(this.Ff,22):this.Ff=Mi(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,23)},set:function(c){c?this.Ff=Fi(this.Ff,23):this.Ff=Mi(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,27)},set:function(c){c?this.Ff=Fi(this.Ff,27):this.Ff=Mi(this.Ff,27)}}),this.hasAppearanceStream=!1};Yo(gg,rd);var bg=function(){gg.call(this),this.fontName="helvetica",this.combo=!1};Yo(bg,gg);var xg=function(){bg.call(this),this.combo=!0};Yo(xg,bg);var Ny=function(){xg.call(this),this.edit=!0};Yo(Ny,xg);var xa=function(){rd.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,15)},set:function(c){c?this.Ff=Fi(this.Ff,15):this.Ff=Mi(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,16)},set:function(c){c?this.Ff=Fi(this.Ff,16):this.Ff=Mi(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,17)},set:function(c){c?this.Ff=Fi(this.Ff,17):this.Ff=Mi(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,26)},set:function(c){c?this.Ff=Fi(this.Ff,26):this.Ff=Mi(this.Ff,26)}});var a,o={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var c=function(m){return m};if(this.scope&&(c=this.scope.internal.getEncryptor(this.objId)),Object.keys(o).length!==0){var d,h=[];for(d in h.push("<<"),o)h.push("/"+d+" ("+rm(c(o[d]))+")");return h.push(">>"),h.join(`
`)}},set:function(c){bn(c)==="object"&&(o=c)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return o.CA||""},set:function(c){typeof c=="string"&&(o.CA=c)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return a},set:function(c){var d=c==null?"":c.toString();d.substr(0,1)==="/"&&(d=d.substr(1)),a="/"+em(d)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return a.substr(1,a.length-1)},set:function(c){a="/"+em(c)}})};Yo(xa,rd);var Ty=function(){xa.call(this),this.pushButton=!0};Yo(Ty,xa);var vg=function(){xa.call(this),this.radio=!0,this.pushButton=!1;var a=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return a},set:function(o){a=o!==void 0?o:[]}})};Yo(vg,xa);var $y=function(){var a,o;rd.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return a},set:function(h){a=h}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return o},set:function(h){o=h}});var c,d={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var h=function(x){return x};this.scope&&(h=this.scope.internal.getEncryptor(this.objId));var m,g=[];for(m in g.push("<<"),d)g.push("/"+m+" ("+rm(h(d[m]))+")");return g.push(">>"),g.join(`
`)},set:function(h){bn(h)==="object"&&(d=h)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return d.CA||""},set:function(h){typeof h=="string"&&(d.CA=h)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return c},set:function(h){var m=h==null?"":h.toString();m.substr(0,1)==="/"&&(m=m.substr(1)),c="/"+em(m)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return c.substr(1,c.length-1)},set:function(h){var m=h==null?"":h.toString();m.substr(0,1)==="/"&&(m=m.substr(1)),c="/"+em(m)}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Ns.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Yo($y,rd),vg.prototype.setAppearance=function(a){if(!("createAppearanceStream"in a)||!("getCA"in a))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var o in this.Kids)if(this.Kids.hasOwnProperty(o)){var c=this.Kids[o];c.appearanceStreamContent=a.createAppearanceStream(c.optionName),c.caption=a.getCA()}},vg.prototype.createOption=function(a){var o=new $y;return o.Parent=this,o.optionName=a,this.Kids.push(o),jge.call(this.scope,o),o};var Ry=function(){xa.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Ns.CheckBox.createAppearanceStream()};Yo(Ry,xa);var Yp=function(){rd.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,13)},set:function(o){o?this.Ff=Fi(this.Ff,13):this.Ff=Mi(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,21)},set:function(o){o?this.Ff=Fi(this.Ff,21):this.Ff=Mi(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,23)},set:function(o){o?this.Ff=Fi(this.Ff,23):this.Ff=Mi(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,24)},set:function(o){o?this.Ff=Fi(this.Ff,24):this.Ff=Mi(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,25)},set:function(o){o?this.Ff=Fi(this.Ff,25):this.Ff=Mi(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,26)},set:function(o){o?this.Ff=Fi(this.Ff,26):this.Ff=Mi(this.Ff,26)}});var a=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return a},set:function(o){Number.isInteger(o)&&(a=o)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Yo(Yp,rd);var Iy=function(){Yp.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Ui(this.Ff,14)},set:function(a){a?this.Ff=Fi(this.Ff,14):this.Ff=Mi(this.Ff,14)}}),this.password=!0};Yo(Iy,Yp);var Ns={CheckBox:{createAppearanceStream:function(){return{N:{On:Ns.CheckBox.YesNormal},D:{On:Ns.CheckBox.YesPushDown,Off:Ns.CheckBox.OffPushDown}}},YesPushDown:function(a){var o=Wd(a);o.scope=a.scope;var c=[],d=a.scope.internal.getFont(a.fontName,a.fontStyle).id,h=a.scope.__private__.encodeColorString(a.color),m=zR(a,a.caption);return c.push("0.749023 g"),c.push("0 0 "+hr(Ns.internal.getWidth(a))+" "+hr(Ns.internal.getHeight(a))+" re"),c.push("f"),c.push("BMC"),c.push("q"),c.push("0 0 1 rg"),c.push("/"+d+" "+hr(m.fontSize)+" Tf "+h),c.push("BT"),c.push(m.text),c.push("ET"),c.push("Q"),c.push("EMC"),o.stream=c.join(`
`),o},YesNormal:function(a){var o=Wd(a);o.scope=a.scope;var c=a.scope.internal.getFont(a.fontName,a.fontStyle).id,d=a.scope.__private__.encodeColorString(a.color),h=[],m=Ns.internal.getHeight(a),g=Ns.internal.getWidth(a),x=zR(a,a.caption);return h.push("1 g"),h.push("0 0 "+hr(g)+" "+hr(m)+" re"),h.push("f"),h.push("q"),h.push("0 0 1 rg"),h.push("0 0 "+hr(g-1)+" "+hr(m-1)+" re"),h.push("W"),h.push("n"),h.push("0 g"),h.push("BT"),h.push("/"+c+" "+hr(x.fontSize)+" Tf "+d),h.push(x.text),h.push("ET"),h.push("Q"),o.stream=h.join(`
`),o},OffPushDown:function(a){var o=Wd(a);o.scope=a.scope;var c=[];return c.push("0.749023 g"),c.push("0 0 "+hr(Ns.internal.getWidth(a))+" "+hr(Ns.internal.getHeight(a))+" re"),c.push("f"),o.stream=c.join(`
`),o}},RadioButton:{Circle:{createAppearanceStream:function(a){var o={D:{Off:Ns.RadioButton.Circle.OffPushDown},N:{}};return o.N[a]=Ns.RadioButton.Circle.YesNormal,o.D[a]=Ns.RadioButton.Circle.YesPushDown,o},getCA:function(){return"l"},YesNormal:function(a){var o=Wd(a);o.scope=a.scope;var c=[],d=Ns.internal.getWidth(a)<=Ns.internal.getHeight(a)?Ns.internal.getWidth(a)/4:Ns.internal.getHeight(a)/4;d=Number((.9*d).toFixed(5));var h=Ns.internal.Bezier_C,m=Number((d*h).toFixed(5));return c.push("q"),c.push("1 0 0 1 "+qu(Ns.internal.getWidth(a)/2)+" "+qu(Ns.internal.getHeight(a)/2)+" cm"),c.push(d+" 0 m"),c.push(d+" "+m+" "+m+" "+d+" 0 "+d+" c"),c.push("-"+m+" "+d+" -"+d+" "+m+" -"+d+" 0 c"),c.push("-"+d+" -"+m+" -"+m+" -"+d+" 0 -"+d+" c"),c.push(m+" -"+d+" "+d+" -"+m+" "+d+" 0 c"),c.push("f"),c.push("Q"),o.stream=c.join(`
`),o},YesPushDown:function(a){var o=Wd(a);o.scope=a.scope;var c=[],d=Ns.internal.getWidth(a)<=Ns.internal.getHeight(a)?Ns.internal.getWidth(a)/4:Ns.internal.getHeight(a)/4;d=Number((.9*d).toFixed(5));var h=Number((2*d).toFixed(5)),m=Number((h*Ns.internal.Bezier_C).toFixed(5)),g=Number((d*Ns.internal.Bezier_C).toFixed(5));return c.push("0.749023 g"),c.push("q"),c.push("1 0 0 1 "+qu(Ns.internal.getWidth(a)/2)+" "+qu(Ns.internal.getHeight(a)/2)+" cm"),c.push(h+" 0 m"),c.push(h+" "+m+" "+m+" "+h+" 0 "+h+" c"),c.push("-"+m+" "+h+" -"+h+" "+m+" -"+h+" 0 c"),c.push("-"+h+" -"+m+" -"+m+" -"+h+" 0 -"+h+" c"),c.push(m+" -"+h+" "+h+" -"+m+" "+h+" 0 c"),c.push("f"),c.push("Q"),c.push("0 g"),c.push("q"),c.push("1 0 0 1 "+qu(Ns.internal.getWidth(a)/2)+" "+qu(Ns.internal.getHeight(a)/2)+" cm"),c.push(d+" 0 m"),c.push(d+" "+g+" "+g+" "+d+" 0 "+d+" c"),c.push("-"+g+" "+d+" -"+d+" "+g+" -"+d+" 0 c"),c.push("-"+d+" -"+g+" -"+g+" -"+d+" 0 -"+d+" c"),c.push(g+" -"+d+" "+d+" -"+g+" "+d+" 0 c"),c.push("f"),c.push("Q"),o.stream=c.join(`
`),o},OffPushDown:function(a){var o=Wd(a);o.scope=a.scope;var c=[],d=Ns.internal.getWidth(a)<=Ns.internal.getHeight(a)?Ns.internal.getWidth(a)/4:Ns.internal.getHeight(a)/4;d=Number((.9*d).toFixed(5));var h=Number((2*d).toFixed(5)),m=Number((h*Ns.internal.Bezier_C).toFixed(5));return c.push("0.749023 g"),c.push("q"),c.push("1 0 0 1 "+qu(Ns.internal.getWidth(a)/2)+" "+qu(Ns.internal.getHeight(a)/2)+" cm"),c.push(h+" 0 m"),c.push(h+" "+m+" "+m+" "+h+" 0 "+h+" c"),c.push("-"+m+" "+h+" -"+h+" "+m+" -"+h+" 0 c"),c.push("-"+h+" -"+m+" -"+m+" -"+h+" 0 -"+h+" c"),c.push(m+" -"+h+" "+h+" -"+m+" "+h+" 0 c"),c.push("f"),c.push("Q"),o.stream=c.join(`
`),o}},Cross:{createAppearanceStream:function(a){var o={D:{Off:Ns.RadioButton.Cross.OffPushDown},N:{}};return o.N[a]=Ns.RadioButton.Cross.YesNormal,o.D[a]=Ns.RadioButton.Cross.YesPushDown,o},getCA:function(){return"8"},YesNormal:function(a){var o=Wd(a);o.scope=a.scope;var c=[],d=Ns.internal.calculateCross(a);return c.push("q"),c.push("1 1 "+hr(Ns.internal.getWidth(a)-2)+" "+hr(Ns.internal.getHeight(a)-2)+" re"),c.push("W"),c.push("n"),c.push(hr(d.x1.x)+" "+hr(d.x1.y)+" m"),c.push(hr(d.x2.x)+" "+hr(d.x2.y)+" l"),c.push(hr(d.x4.x)+" "+hr(d.x4.y)+" m"),c.push(hr(d.x3.x)+" "+hr(d.x3.y)+" l"),c.push("s"),c.push("Q"),o.stream=c.join(`
`),o},YesPushDown:function(a){var o=Wd(a);o.scope=a.scope;var c=Ns.internal.calculateCross(a),d=[];return d.push("0.749023 g"),d.push("0 0 "+hr(Ns.internal.getWidth(a))+" "+hr(Ns.internal.getHeight(a))+" re"),d.push("f"),d.push("q"),d.push("1 1 "+hr(Ns.internal.getWidth(a)-2)+" "+hr(Ns.internal.getHeight(a)-2)+" re"),d.push("W"),d.push("n"),d.push(hr(c.x1.x)+" "+hr(c.x1.y)+" m"),d.push(hr(c.x2.x)+" "+hr(c.x2.y)+" l"),d.push(hr(c.x4.x)+" "+hr(c.x4.y)+" m"),d.push(hr(c.x3.x)+" "+hr(c.x3.y)+" l"),d.push("s"),d.push("Q"),o.stream=d.join(`
`),o},OffPushDown:function(a){var o=Wd(a);o.scope=a.scope;var c=[];return c.push("0.749023 g"),c.push("0 0 "+hr(Ns.internal.getWidth(a))+" "+hr(Ns.internal.getHeight(a))+" re"),c.push("f"),o.stream=c.join(`
`),o}}},createDefaultAppearanceStream:function(a){var o=a.scope.internal.getFont(a.fontName,a.fontStyle).id,c=a.scope.__private__.encodeColorString(a.color);return"/"+o+" "+a.fontSize+" Tf "+c}};Ns.internal={Bezier_C:.551915024494,calculateCross:function(a){var o=Ns.internal.getWidth(a),c=Ns.internal.getHeight(a),d=Math.min(o,c);return{x1:{x:(o-d)/2,y:(c-d)/2+d},x2:{x:(o-d)/2+d,y:(c-d)/2},x3:{x:(o-d)/2,y:(c-d)/2},x4:{x:(o-d)/2+d,y:(c-d)/2+d}}}},Ns.internal.getWidth=function(a){var o=0;return bn(a)==="object"&&(o=DV(a.Rect[2])),o},Ns.internal.getHeight=function(a){var o=0;return bn(a)==="object"&&(o=DV(a.Rect[3])),o};var jge=Ni.addField=function(a){if(Lge(this,a),!(a instanceof rd))throw new Error("Invalid argument passed to jsPDF.addField.");var o;return(o=a).scope.internal.acroformPlugin.printedOut&&(o.scope.internal.acroformPlugin.printedOut=!1,o.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),o.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(o),a.page=a.scope.internal.getCurrentPageInfo().pageNumber,this};Ni.AcroFormChoiceField=gg,Ni.AcroFormListBox=bg,Ni.AcroFormComboBox=xg,Ni.AcroFormEditBox=Ny,Ni.AcroFormButton=xa,Ni.AcroFormPushButton=Ty,Ni.AcroFormRadioButton=vg,Ni.AcroFormCheckBox=Ry,Ni.AcroFormTextField=Yp,Ni.AcroFormPasswordField=Iy,Ni.AcroFormAppearance=Ns,Ni.AcroForm={ChoiceField:gg,ListBox:bg,ComboBox:xg,EditBox:Ny,Button:xa,PushButton:Ty,RadioButton:vg,CheckBox:Ry,TextField:Yp,PasswordField:Iy,Appearance:Ns},Ms.AcroForm={ChoiceField:gg,ListBox:bg,ComboBox:xg,EditBox:Ny,Button:xa,PushButton:Ty,RadioButton:vg,CheckBox:Ry,TextField:Yp,PasswordField:Iy,Appearance:Ns};Ms.AcroForm;function fG(a){return a.reduce(function(o,c,d){return o[c]=d,o},{})}(function(a){var o="addImage_";a.__addimage__={};var c="UNKNOWN",d={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},h=a.__addimage__.getImageFileTypeByImageData=function(J,Y){var se,oe,Te,he,Ce,ee=c;if((Y=Y||c)==="RGBA"||J.data!==void 0&&J.data instanceof Uint8ClampedArray&&"height"in J&&"width"in J)return"RGBA";if(me(J))for(Ce in d)for(Te=d[Ce],se=0;se<Te.length;se+=1){for(he=!0,oe=0;oe<Te[se].length;oe+=1)if(Te[se][oe]!==void 0&&Te[se][oe]!==J[oe]){he=!1;break}if(he===!0){ee=Ce;break}}else for(Ce in d)for(Te=d[Ce],se=0;se<Te.length;se+=1){for(he=!0,oe=0;oe<Te[se].length;oe+=1)if(Te[se][oe]!==void 0&&Te[se][oe]!==J.charCodeAt(oe)){he=!1;break}if(he===!0){ee=Ce;break}}return ee===c&&Y!==c&&(ee=Y),ee},m=function J(Y){for(var se=this.internal.write,oe=this.internal.putStream,Te=(0,this.internal.getFilters)();Te.indexOf("FlateEncode")!==-1;)Te.splice(Te.indexOf("FlateEncode"),1);Y.objectId=this.internal.newObject();var he=[];if(he.push({key:"Type",value:"/XObject"}),he.push({key:"Subtype",value:"/Image"}),he.push({key:"Width",value:Y.width}),he.push({key:"Height",value:Y.height}),Y.colorSpace===Q.INDEXED?he.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(Y.palette.length/3-1)+" "+("sMask"in Y&&Y.sMask!==void 0?Y.objectId+2:Y.objectId+1)+" 0 R]"}):(he.push({key:"ColorSpace",value:"/"+Y.colorSpace}),Y.colorSpace===Q.DEVICE_CMYK&&he.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),he.push({key:"BitsPerComponent",value:Y.bitsPerComponent}),"decodeParameters"in Y&&Y.decodeParameters!==void 0&&he.push({key:"DecodeParms",value:"<<"+Y.decodeParameters+">>"}),"transparency"in Y&&Array.isArray(Y.transparency)&&Y.transparency.length>0){for(var Ce="",ee=0,Be=Y.transparency.length;ee<Be;ee++)Ce+=Y.transparency[ee]+" "+Y.transparency[ee]+" ";he.push({key:"Mask",value:"["+Ce+"]"})}Y.sMask!==void 0&&he.push({key:"SMask",value:Y.objectId+1+" 0 R"});var He=Y.filter!==void 0?["/"+Y.filter]:void 0;if(oe({data:Y.data,additionalKeyValues:he,alreadyAppliedFilters:He,objectId:Y.objectId}),se("endobj"),"sMask"in Y&&Y.sMask!==void 0){var Ue,re=(Ue=Y.sMaskBitsPerComponent)!==null&&Ue!==void 0?Ue:Y.bitsPerComponent,ve={width:Y.width,height:Y.height,colorSpace:"DeviceGray",bitsPerComponent:re,data:Y.sMask};"filter"in Y&&(ve.decodeParameters="/Predictor ".concat(Y.predictor," /Colors 1 /BitsPerComponent ").concat(re," /Columns ").concat(Y.width),ve.filter=Y.filter),J.call(this,ve)}if(Y.colorSpace===Q.INDEXED){var fe=this.internal.newObject();oe({data:le(new Uint8Array(Y.palette)),objectId:fe}),se("endobj")}},g=function(){var J=this.internal.collections[o+"images"];for(var Y in J)m.call(this,J[Y])},x=function(){var J,Y=this.internal.collections[o+"images"],se=this.internal.write;for(var oe in Y)se("/I"+(J=Y[oe]).index,J.objectId,"0","R")},v=function(){this.internal.collections[o+"images"]||(this.internal.collections[o+"images"]={},this.internal.events.subscribe("putResources",g),this.internal.events.subscribe("putXobjectDict",x))},E=function(){var J=this.internal.collections[o+"images"];return v.call(this),J},S=function(){return Object.keys(this.internal.collections[o+"images"]).length},I=function(J){return typeof a["process"+J.toUpperCase()]=="function"},k=function(J){return bn(J)==="object"&&J.nodeType===1},R=function(J,Y){if(J.nodeName==="IMG"&&J.hasAttribute("src")){var se=""+J.getAttribute("src");if(se.indexOf("data:image/")===0)return Cy(unescape(se).split("base64,").pop());var oe=a.loadFile(se,!0);if(oe!==void 0)return oe}if(J.nodeName==="CANVAS"){if(J.width===0||J.height===0)throw new Error("Given canvas must have data. Canvas width: "+J.width+", height: "+J.height);var Te;switch(Y){case"PNG":Te="image/png";break;case"WEBP":Te="image/webp";break;default:Te="image/jpeg"}return Cy(J.toDataURL(Te,1).split("base64,").pop())}},O=function(J){var Y=this.internal.collections[o+"images"];if(Y){for(var se in Y)if(J===Y[se].alias)return Y[se]}},F=function(J,Y,se){return J||Y||(J=-96,Y=-96),J<0&&(J=-1*se.width*72/J/this.internal.scaleFactor),Y<0&&(Y=-1*se.height*72/Y/this.internal.scaleFactor),J===0&&(J=Y*se.width/se.height),Y===0&&(Y=J*se.height/se.width),[J,Y]},M=function(J,Y,se,oe,Te,he){var Ce=F.call(this,se,oe,Te),ee=this.internal.getCoordinateString,Be=this.internal.getVerticalCoordinateString,He=E.call(this);if(se=Ce[0],oe=Ce[1],He[Te.index]=Te,he){he*=Math.PI/180;var Ue=Math.cos(he),re=Math.sin(he),ve=function(Ie){return Ie.toFixed(4)},fe=[ve(Ue),ve(re),ve(-1*re),ve(Ue),0,0,"cm"]}this.internal.write("q"),he?(this.internal.write([1,"0","0",1,ee(J),Be(Y+oe),"cm"].join(" ")),this.internal.write(fe.join(" ")),this.internal.write([ee(se),"0","0",ee(oe),"0","0","cm"].join(" "))):this.internal.write([ee(se),"0","0",ee(oe),ee(J),Be(Y+oe),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Te.index+" Do"),this.internal.write("Q")},Q=a.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};a.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var Z=a.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},$=a.__addimage__.sHashCode=function(J){var Y,se,oe=0;if(typeof J=="string")for(se=J.length,Y=0;Y<se;Y++)oe=(oe<<5)-oe+J.charCodeAt(Y),oe|=0;else if(me(J))for(se=J.byteLength/2,Y=0;Y<se;Y++)oe=(oe<<5)-oe+J[Y],oe|=0;return oe},X=a.__addimage__.validateStringAsBase64=function(J){(J=J||"").toString().trim();var Y=!0;return J.length===0&&(Y=!1),J.length%4!=0&&(Y=!1),/^[A-Za-z0-9+/]+$/.test(J.substr(0,J.length-2))===!1&&(Y=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(J.substr(-2))===!1&&(Y=!1),Y},be=a.__addimage__.extractImageFromDataUrl=function(J){if(J==null||!(J=J.trim()).startsWith("data:"))return null;var Y=J.indexOf(",");return Y<0?null:J.substring(0,Y).trim().endsWith("base64")?J.substring(Y+1):null};a.__addimage__.isArrayBuffer=function(J){return J instanceof ArrayBuffer};var me=a.__addimage__.isArrayBufferView=function(J){return J instanceof Int8Array||J instanceof Uint8Array||J instanceof Uint8ClampedArray||J instanceof Int16Array||J instanceof Uint16Array||J instanceof Int32Array||J instanceof Uint32Array||J instanceof Float32Array||J instanceof Float64Array},Ne=a.__addimage__.binaryStringToUint8Array=function(J){for(var Y=J.length,se=new Uint8Array(Y),oe=0;oe<Y;oe++)se[oe]=J.charCodeAt(oe);return se},le=a.__addimage__.arrayBufferToBinaryString=function(J){for(var Y="",se=me(J)?J:new Uint8Array(J),oe=0;oe<se.length;oe+=8192)Y+=String.fromCharCode.apply(null,se.subarray(oe,oe+8192));return Y};a.addImage=function(){var J,Y,se,oe,Te,he,Ce,ee,Be;if(typeof arguments[1]=="number"?(Y=c,se=arguments[1],oe=arguments[2],Te=arguments[3],he=arguments[4],Ce=arguments[5],ee=arguments[6],Be=arguments[7]):(Y=arguments[1],se=arguments[2],oe=arguments[3],Te=arguments[4],he=arguments[5],Ce=arguments[6],ee=arguments[7],Be=arguments[8]),bn(J=arguments[0])==="object"&&!k(J)&&"imageData"in J){var He=J;J=He.imageData,Y=He.format||Y||c,se=He.x||se||0,oe=He.y||oe||0,Te=He.w||He.width||Te,he=He.h||He.height||he,Ce=He.alias||Ce,ee=He.compression||ee,Be=He.rotation||He.angle||Be}var Ue=this.internal.getFilters();if(ee===void 0&&Ue.indexOf("FlateEncode")!==-1&&(ee="SLOW"),isNaN(se)||isNaN(oe))throw new Error("Invalid coordinates passed to jsPDF.addImage");v.call(this);var re=H.call(this,J,Y,Ce,ee);return M.call(this,se,oe,Te,he,re,Be),this};var H=function(J,Y,se,oe){var Te,he,Ce;if(typeof J=="string"&&h(J)===c){J=unescape(J);var ee=Ae(J,!1);(ee!==""||(ee=a.loadFile(J,!0))!==void 0)&&(J=ee)}if(k(J)&&(J=R(J,Y)),Y=h(J,Y),!I(Y))throw new Error("addImage does not support files of type '"+Y+"', please ensure that a plugin for '"+Y+"' support is added.");if(((Ce=se)==null||Ce.length===0)&&(se=function(Be){return typeof Be=="string"||me(Be)?$(Be):me(Be.data)?$(Be.data):null}(J)),(Te=O.call(this,se))||(J instanceof Uint8Array||Y==="RGBA"||(he=J,J=Ne(J)),Te=this["process"+Y.toUpperCase()](J,S.call(this),se,function(Be){return Be&&typeof Be=="string"&&(Be=Be.toUpperCase()),Be in a.image_compression?Be:Z.NONE}(oe),he)),!Te)throw new Error("An unknown error occurred whilst processing the image.");return Te},Ae=a.__addimage__.convertBase64ToBinaryString=function(J,Y){Y=typeof Y!="boolean"||Y;var se,oe="";if(typeof J=="string"){var Te;se=(Te=be(J))!==null&&Te!==void 0?Te:J;try{oe=Cy(se)}catch(he){if(Y)throw X(se)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+he.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return oe};a.getImageProperties=function(J){var Y,se,oe="";if(k(J)&&(J=R(J)),typeof J=="string"&&h(J)===c&&((oe=Ae(J,!1))===""&&(oe=a.loadFile(J)||""),J=oe),se=h(J),!I(se))throw new Error("addImage does not support files of type '"+se+"', please ensure that a plugin for '"+se+"' support is added.");if(J instanceof Uint8Array||(J=Ne(J)),!(Y=this["process"+se.toUpperCase()](J)))throw new Error("An unknown error occurred whilst processing the image");return Y.fileType=se,Y}})(Ms.API),function(a){var o=function(c){if(c!==void 0&&c!="")return!0};Ms.API.events.push(["addPage",function(c){this.internal.getPageInfo(c.pageNumber).pageContext.annotations=[]}]),a.events.push(["putPage",function(c){for(var d,h,m,g=this.internal.getCoordinateString,x=this.internal.getVerticalCoordinateString,v=this.internal.getPageInfoByObjId(c.objId),E=c.pageContext.annotations,S=!1,I=0;I<E.length&&!S;I++)switch((d=E[I]).type){case"link":(o(d.options.url)||o(d.options.pageNumber))&&(S=!0);break;case"reference":case"text":case"freetext":S=!0}if(S!=0){this.internal.write("/Annots [");for(var k=0;k<E.length;k++){d=E[k];var R=this.internal.pdfEscape,O=this.internal.getEncryptor(c.objId);switch(d.type){case"reference":this.internal.write(" "+d.object.objId+" 0 R ");break;case"text":var F=this.internal.newAdditionalObject(),M=this.internal.newAdditionalObject(),Q=this.internal.getEncryptor(F.objId),Z=d.title||"Note";m="<</Type /Annot /Subtype /Text "+(h="/Rect ["+g(d.bounds.x)+" "+x(d.bounds.y+d.bounds.h)+" "+g(d.bounds.x+d.bounds.w)+" "+x(d.bounds.y)+"] ")+"/Contents ("+R(Q(d.contents))+")",m+=" /Popup "+M.objId+" 0 R",m+=" /P "+v.objId+" 0 R",m+=" /T ("+R(Q(Z))+") >>",F.content=m;var $=F.objId+" 0 R";m="<</Type /Annot /Subtype /Popup "+(h="/Rect ["+g(d.bounds.x+30)+" "+x(d.bounds.y+d.bounds.h)+" "+g(d.bounds.x+d.bounds.w+30)+" "+x(d.bounds.y)+"] ")+" /Parent "+$,d.open&&(m+=" /Open true"),m+=" >>",M.content=m,this.internal.write(F.objId,"0 R",M.objId,"0 R");break;case"freetext":h="/Rect ["+g(d.bounds.x)+" "+x(d.bounds.y)+" "+g(d.bounds.x+d.bounds.w)+" "+x(d.bounds.y+d.bounds.h)+"] ";var X=d.color||"#000000";m="<</Type /Annot /Subtype /FreeText "+h+"/Contents ("+R(O(d.contents))+")",m+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+X+")",m+=" /Border [0 0 0]",m+=" >>",this.internal.write(m);break;case"link":if(d.options.name){var be=this.annotations._nameMap[d.options.name];d.options.pageNumber=be.page,d.options.top=be.y}else d.options.top||(d.options.top=0);if(h="/Rect ["+d.finalBounds.x+" "+d.finalBounds.y+" "+d.finalBounds.w+" "+d.finalBounds.h+"] ",m="",d.options.url)m="<</Type /Annot /Subtype /Link "+h+"/Border [0 0 0] /A <</S /URI /URI ("+R(O(d.options.url))+") >>";else if(d.options.pageNumber)switch(m="<</Type /Annot /Subtype /Link "+h+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(d.options.pageNumber).objId+" 0 R",d.options.magFactor=d.options.magFactor||"XYZ",d.options.magFactor){case"Fit":m+=" /Fit]";break;case"FitH":m+=" /FitH "+d.options.top+"]";break;case"FitV":d.options.left=d.options.left||0,m+=" /FitV "+d.options.left+"]";break;default:var me=x(d.options.top);d.options.left=d.options.left||0,d.options.zoom===void 0&&(d.options.zoom=0),m+=" /XYZ "+d.options.left+" "+me+" "+d.options.zoom+"]"}m!=""&&(m+=" >>",this.internal.write(m))}}this.internal.write("]")}}]),a.createAnnotation=function(c){var d=this.internal.getCurrentPageInfo();switch(c.type){case"link":this.link(c.bounds.x,c.bounds.y,c.bounds.w,c.bounds.h,c);break;case"text":case"freetext":d.pageContext.annotations.push(c)}},a.link=function(c,d,h,m,g){var x=this.internal.getCurrentPageInfo(),v=this.internal.getCoordinateString,E=this.internal.getVerticalCoordinateString;x.pageContext.annotations.push({finalBounds:{x:v(c),y:E(d),w:v(c+h),h:E(d+m)},options:g,type:"link"})},a.textWithLink=function(c,d,h,m){var g,x,v=this.getTextWidth(c),E=this.internal.getLineHeight()/this.internal.scaleFactor;if(m.maxWidth!==void 0){x=m.maxWidth;var S=this.splitTextToSize(c,x).length;g=Math.ceil(E*S)}else x=v,g=E;return this.text(c,d,h,m),h+=.2*E,m.align==="center"&&(d-=v/2),m.align==="right"&&(d-=v),this.link(d,h-E,x,g,m),v},a.getTextWidth=function(c){var d=this.internal.getFontSize();return this.getStringUnitWidth(c)*d/this.internal.scaleFactor}}(Ms.API),function(a){var o={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},c={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},d={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},h=[1570,1571,1573,1575];a.__arabicParser__={};var m=a.__arabicParser__.isInArabicSubstitutionA=function(F){return o[F.charCodeAt(0)]!==void 0},g=a.__arabicParser__.isArabicLetter=function(F){return typeof F=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(F)},x=a.__arabicParser__.isArabicEndLetter=function(F){return g(F)&&m(F)&&o[F.charCodeAt(0)].length<=2},v=a.__arabicParser__.isArabicAlfLetter=function(F){return g(F)&&h.indexOf(F.charCodeAt(0))>=0};a.__arabicParser__.arabicLetterHasIsolatedForm=function(F){return g(F)&&m(F)&&o[F.charCodeAt(0)].length>=1};var E=a.__arabicParser__.arabicLetterHasFinalForm=function(F){return g(F)&&m(F)&&o[F.charCodeAt(0)].length>=2};a.__arabicParser__.arabicLetterHasInitialForm=function(F){return g(F)&&m(F)&&o[F.charCodeAt(0)].length>=3};var S=a.__arabicParser__.arabicLetterHasMedialForm=function(F){return g(F)&&m(F)&&o[F.charCodeAt(0)].length==4},I=a.__arabicParser__.resolveLigatures=function(F){var M=0,Q=c,Z="",$=0;for(M=0;M<F.length;M+=1)Q[F.charCodeAt(M)]!==void 0?($++,typeof(Q=Q[F.charCodeAt(M)])=="number"&&(Z+=String.fromCharCode(Q),Q=c,$=0),M===F.length-1&&(Q=c,Z+=F.charAt(M-($-1)),M-=$-1,$=0)):(Q=c,Z+=F.charAt(M-$),M-=$,$=0);return Z};a.__arabicParser__.isArabicDiacritic=function(F){return F!==void 0&&d[F.charCodeAt(0)]!==void 0};var k=a.__arabicParser__.getCorrectForm=function(F,M,Q){return g(F)?m(F)===!1?-1:!E(F)||!g(M)&&!g(Q)||!g(Q)&&x(M)||x(F)&&!g(M)||x(F)&&v(M)||x(F)&&x(M)?0:S(F)&&g(M)&&!x(M)&&g(Q)&&E(Q)?3:x(F)||!g(Q)?1:2:-1},R=function(F){var M=0,Q=0,Z=0,$="",X="",be="",me=(F=F||"").split("\\s+"),Ne=[];for(M=0;M<me.length;M+=1){for(Ne.push(""),Q=0;Q<me[M].length;Q+=1)$=me[M][Q],X=me[M][Q-1],be=me[M][Q+1],g($)?(Z=k($,X,be),Ne[M]+=Z!==-1?String.fromCharCode(o[$.charCodeAt(0)][Z]):$):Ne[M]+=$;Ne[M]=I(Ne[M])}return Ne.join(" ")},O=a.__arabicParser__.processArabic=a.processArabic=function(){var F,M=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,Q=[];if(Array.isArray(M)){var Z=0;for(Q=[],Z=0;Z<M.length;Z+=1)Array.isArray(M[Z])?Q.push([R(M[Z][0]),M[Z][1],M[Z][2]]):Q.push([R(M[Z])]);F=Q}else F=R(M);return typeof arguments[0]=="string"?F:(arguments[0].text=F,arguments[0])};a.events.push(["preProcessText",O])}(Ms.API),Ms.API.autoPrint=function(a){var o;return(a=a||{}).variant=a.variant||"non-conform",a.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){o=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+o+" 0 R")})),this},function(a){var o=function(){var c=void 0;Object.defineProperty(this,"pdf",{get:function(){return c},set:function(x){c=x}});var d=150;Object.defineProperty(this,"width",{get:function(){return d},set:function(x){d=isNaN(x)||Number.isInteger(x)===!1||x<0?150:x,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=d+1)}});var h=300;Object.defineProperty(this,"height",{get:function(){return h},set:function(x){h=isNaN(x)||Number.isInteger(x)===!1||x<0?300:x,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=h+1)}});var m=[];Object.defineProperty(this,"childNodes",{get:function(){return m},set:function(x){m=x}});var g={};Object.defineProperty(this,"style",{get:function(){return g},set:function(x){g=x}}),Object.defineProperty(this,"parentNode",{})};o.prototype.getContext=function(c,d){var h;if((c=c||"2d")!=="2d")return null;for(h in d)this.pdf.context2d.hasOwnProperty(h)&&(this.pdf.context2d[h]=d[h]);return this.pdf.context2d._canvas=this,this.pdf.context2d},o.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},a.events.push(["initialized",function(){this.canvas=new o,this.canvas.pdf=this}])}(Ms.API),function(a){var o={left:0,top:0,bottom:0,right:0},c=!1,d=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},o),this.internal.__cell__.margins.width=this.getPageWidth(),h.call(this))},h=function(){this.internal.__cell__.lastCell=new m,this.internal.__cell__.pages=1},m=function(){var v=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return v},set:function(F){v=F}});var E=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return E},set:function(F){E=F}});var S=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return S},set:function(F){S=F}});var I=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return I},set:function(F){I=F}});var k=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return k},set:function(F){k=F}});var R=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return R},set:function(F){R=F}});var O=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return O},set:function(F){O=F}}),this};m.prototype.clone=function(){return new m(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},m.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},a.setHeaderFunction=function(v){return d.call(this),this.internal.__cell__.headerFunction=typeof v=="function"?v:void 0,this},a.getTextDimensions=function(v,E){d.call(this);var S=(E=E||{}).fontSize||this.getFontSize(),I=E.font||this.getFont(),k=E.scaleFactor||this.internal.scaleFactor,R=0,O=0,F=0,M=this;if(!Array.isArray(v)&&typeof v!="string"){if(typeof v!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");v=String(v)}var Q=E.maxWidth;Q>0?typeof v=="string"?v=this.splitTextToSize(v,Q):Object.prototype.toString.call(v)==="[object Array]"&&(v=v.reduce(function($,X){return $.concat(M.splitTextToSize(X,Q))},[])):v=Array.isArray(v)?v:[v];for(var Z=0;Z<v.length;Z++)R<(F=this.getStringUnitWidth(v[Z],{font:I})*S)&&(R=F);return R!==0&&(O=v.length),{w:R/=k,h:Math.max((O*S*this.getLineHeightFactor()-S*(this.getLineHeightFactor()-1))/k,0)}},a.cellAddPage=function(){d.call(this),this.addPage();var v=this.internal.__cell__.margins||o;return this.internal.__cell__.lastCell=new m(v.left,v.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var g=a.cell=function(){var v;v=arguments[0]instanceof m?arguments[0]:new m(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),d.call(this);var E=this.internal.__cell__.lastCell,S=this.internal.__cell__.padding,I=this.internal.__cell__.margins||o,k=this.internal.__cell__.tableHeaderRow,R=this.internal.__cell__.printHeaders;return E.lineNumber!==void 0&&(E.lineNumber===v.lineNumber?(v.x=(E.x||0)+(E.width||0),v.y=E.y||0):E.y+E.height+v.height+I.bottom>this.getPageHeight()?(this.cellAddPage(),v.y=I.top,R&&k&&(this.printHeaderRow(v.lineNumber,!0),v.y+=k[0].height)):v.y=E.y+E.height||v.y),v.text[0]!==void 0&&(this.rect(v.x,v.y,v.width,v.height,c===!0?"FD":void 0),v.align==="right"?this.text(v.text,v.x+v.width-S,v.y+S,{align:"right",baseline:"top"}):v.align==="center"?this.text(v.text,v.x+v.width/2,v.y+S,{align:"center",baseline:"top",maxWidth:v.width-S-S}):this.text(v.text,v.x+S,v.y+S,{align:"left",baseline:"top",maxWidth:v.width-S-S})),this.internal.__cell__.lastCell=v,this};a.table=function(v,E,S,I,k){if(d.call(this),!S)throw new Error("No data for PDF table.");var R,O,F,M,Q=[],Z=[],$=[],X={},be={},me=[],Ne=[],le=(k=k||{}).autoSize||!1,H=k.printHeaders!==!1,Ae=k.css&&k.css["font-size"]!==void 0?16*k.css["font-size"]:k.fontSize||12,J=k.margins||Object.assign({width:this.getPageWidth()},o),Y=typeof k.padding=="number"?k.padding:3,se=k.headerBackgroundColor||"#c8c8c8",oe=k.headerTextColor||"#000";if(h.call(this),this.internal.__cell__.printHeaders=H,this.internal.__cell__.margins=J,this.internal.__cell__.table_font_size=Ae,this.internal.__cell__.padding=Y,this.internal.__cell__.headerBackgroundColor=se,this.internal.__cell__.headerTextColor=oe,this.setFontSize(Ae),I==null)Z=Q=Object.keys(S[0]),$=Q.map(function(){return"left"});else if(Array.isArray(I)&&bn(I[0])==="object")for(Q=I.map(function(He){return He.name}),Z=I.map(function(He){return He.prompt||He.name||""}),$=I.map(function(He){return He.align||"left"}),R=0;R<I.length;R+=1)be[I[R].name]=.7499990551181103*I[R].width;else Array.isArray(I)&&typeof I[0]=="string"&&(Z=Q=I,$=Q.map(function(){return"left"}));if(le||Array.isArray(I)&&typeof I[0]=="string")for(R=0;R<Q.length;R+=1){for(X[M=Q[R]]=S.map(function(He){return He[M]}),this.setFont(void 0,"bold"),me.push(this.getTextDimensions(Z[R],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),O=X[M],this.setFont(void 0,"normal"),F=0;F<O.length;F+=1)me.push(this.getTextDimensions(O[F],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);be[M]=Math.max.apply(null,me)+Y+Y,me=[]}if(H){var Te={};for(R=0;R<Q.length;R+=1)Te[Q[R]]={},Te[Q[R]].text=Z[R],Te[Q[R]].align=$[R];var he=x.call(this,Te,be);Ne=Q.map(function(He){return new m(v,E,be[He],he,Te[He].text,void 0,Te[He].align)}),this.setTableHeaderRow(Ne),this.printHeaderRow(1,!1)}var Ce=I.reduce(function(He,Ue){return He[Ue.name]=Ue.align,He},{});for(R=0;R<S.length;R+=1){"rowStart"in k&&k.rowStart instanceof Function&&k.rowStart({row:R,data:S[R]},this);var ee=x.call(this,S[R],be);for(F=0;F<Q.length;F+=1){var Be=S[R][Q[F]];"cellStart"in k&&k.cellStart instanceof Function&&k.cellStart({row:R,col:F,data:Be},this),g.call(this,new m(v,E,be[Q[F]],ee,Be,R+2,Ce[Q[F]]))}}return this.internal.__cell__.table_x=v,this.internal.__cell__.table_y=E,this};var x=function(v,E){var S=this.internal.__cell__.padding,I=this.internal.__cell__.table_font_size,k=this.internal.scaleFactor;return Object.keys(v).map(function(R){var O=v[R];return this.splitTextToSize(O.hasOwnProperty("text")?O.text:O,E[R]-S-S)},this).map(function(R){return this.getLineHeightFactor()*R.length*I/k+S+S},this).reduce(function(R,O){return Math.max(R,O)},0)};a.setTableHeaderRow=function(v){d.call(this),this.internal.__cell__.tableHeaderRow=v},a.printHeaderRow=function(v,E){if(d.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var S;if(c=!0,typeof this.internal.__cell__.headerFunction=="function"){var I=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new m(I[0],I[1],I[2],I[3],void 0,-1)}this.setFont(void 0,"bold");for(var k=[],R=0;R<this.internal.__cell__.tableHeaderRow.length;R+=1){S=this.internal.__cell__.tableHeaderRow[R].clone(),E&&(S.y=this.internal.__cell__.margins.top||0,k.push(S)),S.lineNumber=v;var O=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),g.call(this,S),this.setTextColor(O)}k.length>0&&this.setTableHeaderRow(k),this.setFont(void 0,"normal"),c=!1}}(Ms.API);var gG={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},bG=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],qR=fG(bG),xG=[100,200,300,400,500,600,700,800,900],Pge=fG(xG);function PT(a){var o=a.family.replace(/"|'/g,"").toLowerCase(),c=function(m){return gG[m=m||"normal"]?m:"normal"}(a.style),d=function(m){return m?typeof m=="number"?m>=100&&m<=900&&m%100==0?m:400:/^\d00$/.test(m)?parseInt(m):m==="bold"?700:400:400}(a.weight),h=function(m){return typeof qR[m=m||"normal"]=="number"?m:"normal"}(a.stretch);return{family:o,style:c,weight:d,stretch:h,src:a.src||[],ref:a.ref||{name:o,style:[h,c,d].join(" ")}}}function BV(a,o,c,d){var h;for(h=c;h>=0&&h<o.length;h+=d)if(a[o[h]])return a[o[h]];for(h=c;h>=0&&h<o.length;h-=d)if(a[o[h]])return a[o[h]]}var Uge={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},LV={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function jV(a){return[a.stretch,a.style,a.weight,a.family].join(" ")}function PV(a){return a.trimLeft()}function Fge(a,o){for(var c=0;c<a.length;){if(a.charAt(c)===o)return[a.substring(0,c),a.substring(c+1)];c+=1}return null}function Mge(a){var o=a.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return o===null?null:[o[0],a.substring(o[0].length)]}var ng,py,UV,FV,MV,UT=["times"];function VV(a,o,c,d,h){var m=4,g=HV;switch(h){case Ms.API.image_compression.FAST:m=1,g=QV;break;case Ms.API.image_compression.MEDIUM:m=6,g=GV;break;case Ms.API.image_compression.SLOW:m=9,g=KV}a=function(v,E,S,I){for(var k,R=v.length/E,O=new Uint8Array(v.length+R),F=[Vge,QV,HV,GV,KV],M=0;M<R;M+=1){var Q=M*E,Z=v.subarray(Q,Q+E);if(I)O.set(I(Z,S,k),Q+M);else{for(var $=F.length,X=[],be=0;be<$;be+=1)X[be]=F[be](Z,S,k);var me=Hge(X.concat());O.set(X[me],Q+M)}k=Z}return O}(a,o,Math.ceil(c*d/8),g);var x=VR(a,{level:m});return Ms.API.__addimage__.arrayBufferToBinaryString(x)}function Vge(a){var o=Array.apply([],a);return o.unshift(0),o}function QV(a,o){var c=a.length,d=[];d[0]=1;for(var h=0;h<c;h+=1){var m=a[h-o]||0;d[h+1]=a[h]-m+256&255}return d}function HV(a,o,c){var d=a.length,h=[];h[0]=2;for(var m=0;m<d;m+=1){var g=c&&c[m]||0;h[m+1]=a[m]-g+256&255}return h}function GV(a,o,c){var d=a.length,h=[];h[0]=3;for(var m=0;m<d;m+=1){var g=a[m-o]||0,x=c&&c[m]||0;h[m+1]=a[m]+256-(g+x>>>1)&255}return h}function KV(a,o,c){var d=a.length,h=[];h[0]=4;for(var m=0;m<d;m+=1){var g=Qge(a[m-o]||0,c&&c[m]||0,c&&c[m-o]||0);h[m+1]=a[m]-g+256&255}return h}function Qge(a,o,c){if(a===o&&o===c)return a;var d=Math.abs(o-c),h=Math.abs(a-c),m=Math.abs(a+o-c-c);return d<=h&&d<=m?a:h<=m?o:c}function Hge(a){var o=a.map(function(c){return c.reduce(function(d,h){return d+Math.abs(h)},0)});return o.indexOf(Math.min.apply(null,o))}function FT(a,o,c){var d=o*c,h=Math.floor(d/8),m=16-(d-8*h+c),g=(1<<c)-1;return vG(a,h)>>m&g}function WV(a,o,c,d){var h=c*d,m=Math.floor(h/8),g=16-(h-8*m+d),x=(1<<d)-1,v=(o&x)<<g;(function(E,S,I){if(S+1<E.byteLength)E.setUint16(S,I,!1);else{var k=I>>8&255;E.setUint8(S,k)}})(a,m,vG(a,m)&~(x<<g)&65535|v)}function vG(a,o){return o+1<a.byteLength?a.getUint16(o,!1):a.getUint8(o)<<8}function Gge(a){var o=0;if(a[o++]!==71||a[o++]!==73||a[o++]!==70||a[o++]!==56||(a[o++]+1&253)!=56||a[o++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=a[o++]|a[o++]<<8,d=a[o++]|a[o++]<<8,h=a[o++],m=h>>7,g=1<<1+(7&h);a[o++],a[o++];var x=null,v=null;m&&(x=o,v=g,o+=3*g);var E=!0,S=[],I=0,k=null,R=0,O=null;for(this.width=c,this.height=d;E&&o<a.length;)switch(a[o++]){case 33:switch(a[o++]){case 255:if(a[o]!==11||a[o+1]==78&&a[o+2]==69&&a[o+3]==84&&a[o+4]==83&&a[o+5]==67&&a[o+6]==65&&a[o+7]==80&&a[o+8]==69&&a[o+9]==50&&a[o+10]==46&&a[o+11]==48&&a[o+12]==3&&a[o+13]==1&&a[o+16]==0)o+=14,O=a[o++]|a[o++]<<8,o++;else for(o+=12;;){if(!((J=a[o++])>=0))throw Error("Invalid block size");if(J===0)break;o+=J}break;case 249:if(a[o++]!==4||a[o+4]!==0)throw new Error("Invalid graphics extension block.");var F=a[o++];I=a[o++]|a[o++]<<8,k=a[o++],1&F||(k=null),R=F>>2&7,o++;break;case 254:for(;;){if(!((J=a[o++])>=0))throw Error("Invalid block size");if(J===0)break;o+=J}break;default:throw new Error("Unknown graphic control label: 0x"+a[o-1].toString(16))}break;case 44:var M=a[o++]|a[o++]<<8,Q=a[o++]|a[o++]<<8,Z=a[o++]|a[o++]<<8,$=a[o++]|a[o++]<<8,X=a[o++],be=X>>6&1,me=1<<1+(7&X),Ne=x,le=v,H=!1;X>>7&&(H=!0,Ne=o,le=me,o+=3*me);var Ae=o;for(o++;;){var J;if(!((J=a[o++])>=0))throw Error("Invalid block size");if(J===0)break;o+=J}S.push({x:M,y:Q,width:Z,height:$,has_local_palette:H,palette_offset:Ne,palette_size:le,data_offset:Ae,data_length:o-Ae,transparent_index:k,interlaced:!!be,delay:I,disposal:R});break;case 59:E=!1;break;default:throw new Error("Unknown gif block: 0x"+a[o-1].toString(16))}this.numFrames=function(){return S.length},this.loopCount=function(){return O},this.frameInfo=function(Y){if(Y<0||Y>=S.length)throw new Error("Frame index out of range.");return S[Y]},this.decodeAndBlitFrameBGRA=function(Y,se){var oe=this.frameInfo(Y),Te=oe.width*oe.height;if(Te>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var he=new Uint8Array(Te);zV(a,oe.data_offset,he,Te);var Ce=oe.palette_offset,ee=oe.transparent_index;ee===null&&(ee=256);var Be=oe.width,He=c-Be,Ue=Be,re=4*(oe.y*c+oe.x),ve=4*((oe.y+oe.height)*c+oe.x),fe=re,Ie=4*He;oe.interlaced===!0&&(Ie+=4*c*7);for(var je=8,Ee=0,We=he.length;Ee<We;++Ee){var ze=he[Ee];if(Ue===0&&(Ue=Be,(fe+=Ie)>=ve&&(Ie=4*He+4*c*(je-1),fe=re+(Be+He)*(je<<1),je>>=1)),ze===ee)fe+=4;else{var st=a[Ce+3*ze],bt=a[Ce+3*ze+1],Qe=a[Ce+3*ze+2];se[fe++]=Qe,se[fe++]=bt,se[fe++]=st,se[fe++]=255}--Ue}},this.decodeAndBlitFrameRGBA=function(Y,se){var oe=this.frameInfo(Y),Te=oe.width*oe.height;if(Te>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var he=new Uint8Array(Te);zV(a,oe.data_offset,he,Te);var Ce=oe.palette_offset,ee=oe.transparent_index;ee===null&&(ee=256);var Be=oe.width,He=c-Be,Ue=Be,re=4*(oe.y*c+oe.x),ve=4*((oe.y+oe.height)*c+oe.x),fe=re,Ie=4*He;oe.interlaced===!0&&(Ie+=4*c*7);for(var je=8,Ee=0,We=he.length;Ee<We;++Ee){var ze=he[Ee];if(Ue===0&&(Ue=Be,(fe+=Ie)>=ve&&(Ie=4*He+4*c*(je-1),fe=re+(Be+He)*(je<<1),je>>=1)),ze===ee)fe+=4;else{var st=a[Ce+3*ze],bt=a[Ce+3*ze+1],Qe=a[Ce+3*ze+2];se[fe++]=st,se[fe++]=bt,se[fe++]=Qe,se[fe++]=255}--Ue}}}function zV(a,o,c,d){for(var h=a[o++],m=1<<h,g=m+1,x=g+1,v=h+1,E=(1<<v)-1,S=0,I=0,k=0,R=a[o++],O=new Int32Array(4096),F=null;;){for(;S<16&&R!==0;)I|=a[o++]<<S,S+=8,R===1?R=a[o++]:--R;if(S<v)break;var M=I&E;if(I>>=v,S-=v,M!==m){if(M===g)break;for(var Q=M<x?M:F,Z=0,$=Q;$>m;)$=O[$]>>8,++Z;var X=$;if(k+Z+(Q!==M?1:0)>d)return void Dn.log("Warning, gif stream longer than expected.");c[k++]=X;var be=k+=Z;for(Q!==M&&(c[k++]=X),$=Q;Z--;)$=O[$],c[--be]=255&$,$>>=8;F!==null&&x<4096&&(O[x++]=F<<8|X,x>=E+1&&v<12&&(++v,E=E<<1|1)),F=M}else x=g+1,E=(1<<(v=h+1))-1,F=null}return k!==d&&Dn.log("Warning, gif stream shorter than expected."),c}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function MT(a){var o,c,d,h,m,g=Math.floor,x=new Array(64),v=new Array(64),E=new Array(64),S=new Array(64),I=new Array(65535),k=new Array(65535),R=new Array(64),O=new Array(64),F=[],M=0,Q=7,Z=new Array(64),$=new Array(64),X=new Array(64),be=new Array(256),me=new Array(2048),Ne=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],le=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],H=[0,1,2,3,4,5,6,7,8,9,10,11],Ae=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],J=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Y=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],se=[0,1,2,3,4,5,6,7,8,9,10,11],oe=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Te=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function he(re,ve){for(var fe=0,Ie=0,je=new Array,Ee=1;Ee<=16;Ee++){for(var We=1;We<=re[Ee];We++)je[ve[Ie]]=[],je[ve[Ie]][0]=fe,je[ve[Ie]][1]=Ee,Ie++,fe++;fe*=2}return je}function Ce(re){for(var ve=re[0],fe=re[1]-1;fe>=0;)ve&1<<fe&&(M|=1<<Q),fe--,--Q<0&&(M==255?(ee(255),ee(0)):ee(M),Q=7,M=0)}function ee(re){F.push(re)}function Be(re){ee(re>>8&255),ee(255&re)}function He(re,ve,fe,Ie,je){for(var Ee,We=je[0],ze=je[240],st=function($e,Kt){var qt,Xe,ht,dt,Dt,ss,$t,ls,Zt,Rs,es=0;for(Zt=0;Zt<8;++Zt){qt=$e[es],Xe=$e[es+1],ht=$e[es+2],dt=$e[es+3],Dt=$e[es+4],ss=$e[es+5],$t=$e[es+6];var Zs=qt+(ls=$e[es+7]),pt=qt-ls,Ut=Xe+$t,zt=Xe-$t,rs=ht+ss,Ht=ht-ss,vt=dt+Dt,jt=dt-Dt,ps=Zs+vt,Qs=Zs-vt,Is=Ut+rs,ms=Ut-rs;$e[es]=ps+Is,$e[es+4]=ps-Is;var Ws=.707106781*(ms+Qs);$e[es+2]=Qs+Ws,$e[es+6]=Qs-Ws;var mi=.382683433*((ps=jt+Ht)-(ms=zt+pt)),qr=.5411961*ps+mi,oa=1.306562965*ms+mi,Xi=.707106781*(Is=Ht+zt),Ds=pt+Xi,An=pt-Xi;$e[es+5]=An+qr,$e[es+3]=An-qr,$e[es+1]=Ds+oa,$e[es+7]=Ds-oa,es+=8}for(es=0,Zt=0;Zt<8;++Zt){qt=$e[es],Xe=$e[es+8],ht=$e[es+16],dt=$e[es+24],Dt=$e[es+32],ss=$e[es+40],$t=$e[es+48];var wa=qt+(ls=$e[es+56]),Qi=qt-ls,fi=Xe+$t,Pn=Xe-$t,Ri=ht+ss,Hi=ht-ss,eA=dt+Dt,Al=dt-Dt,wo=wa+eA,Ec=wa-eA,Xo=fi+Ri,Jo=fi-Ri;$e[es]=wo+Xo,$e[es+32]=wo-Xo;var so=.707106781*(Jo+Ec);$e[es+16]=Ec+so,$e[es+48]=Ec-so;var id=.382683433*((wo=Al+Hi)-(Jo=Pn+Qi)),_o=.5411961*wo+id,ad=1.306562965*Jo+id,$o=.707106781*(Xo=Hi+Pn),JA=Qi+$o,$A=Qi-$o;$e[es+40]=$A+_o,$e[es+24]=$A-_o,$e[es+8]=JA+ad,$e[es+56]=JA-ad,es++}for(Zt=0;Zt<64;++Zt)Rs=$e[Zt]*Kt[Zt],R[Zt]=Rs>0?Rs+.5|0:Rs-.5|0;return R}(re,ve),bt=0;bt<64;++bt)O[Ne[bt]]=st[bt];var Qe=O[0]-fe;fe=O[0],Qe==0?Ce(Ie[0]):(Ce(Ie[k[Ee=32767+Qe]]),Ce(I[Ee]));for(var rt=63;rt>0&&O[rt]==0;)rt--;if(rt==0)return Ce(We),fe;for(var Nt,we=1;we<=rt;){for(var Rt=we;O[we]==0&&we<=rt;)++we;var Fe=we-Rt;if(Fe>=16){Nt=Fe>>4;for(var et=1;et<=Nt;++et)Ce(ze);Fe&=15}Ee=32767+O[we],Ce(je[(Fe<<4)+k[Ee]]),Ce(I[Ee]),we++}return rt!=63&&Ce(We),fe}function Ue(re){re=Math.min(Math.max(re,1),100),m!=re&&(function(ve){for(var fe=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Ie=0;Ie<64;Ie++){var je=g((fe[Ie]*ve+50)/100);je=Math.min(Math.max(je,1),255),x[Ne[Ie]]=je}for(var Ee=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],We=0;We<64;We++){var ze=g((Ee[We]*ve+50)/100);ze=Math.min(Math.max(ze,1),255),v[Ne[We]]=ze}for(var st=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],bt=0,Qe=0;Qe<8;Qe++)for(var rt=0;rt<8;rt++)E[bt]=1/(x[Ne[bt]]*st[Qe]*st[rt]*8),S[bt]=1/(v[Ne[bt]]*st[Qe]*st[rt]*8),bt++}(re<50?Math.floor(5e3/re):Math.floor(200-2*re)),m=re)}this.encode=function(re,ve){ve&&Ue(ve),F=new Array,M=0,Q=7,Be(65496),Be(65504),Be(16),ee(74),ee(70),ee(73),ee(70),ee(0),ee(1),ee(1),ee(0),Be(1),Be(1),ee(0),ee(0),function(){Be(65499),Be(132),ee(0);for(var Xe=0;Xe<64;Xe++)ee(x[Xe]);ee(1);for(var ht=0;ht<64;ht++)ee(v[ht])}(),function(Xe,ht){Be(65472),Be(17),ee(8),Be(ht),Be(Xe),ee(3),ee(1),ee(17),ee(0),ee(2),ee(17),ee(1),ee(3),ee(17),ee(1)}(re.width,re.height),function(){Be(65476),Be(418),ee(0);for(var Xe=0;Xe<16;Xe++)ee(le[Xe+1]);for(var ht=0;ht<=11;ht++)ee(H[ht]);ee(16);for(var dt=0;dt<16;dt++)ee(Ae[dt+1]);for(var Dt=0;Dt<=161;Dt++)ee(J[Dt]);ee(1);for(var ss=0;ss<16;ss++)ee(Y[ss+1]);for(var $t=0;$t<=11;$t++)ee(se[$t]);ee(17);for(var ls=0;ls<16;ls++)ee(oe[ls+1]);for(var Zt=0;Zt<=161;Zt++)ee(Te[Zt])}(),Be(65498),Be(12),ee(3),ee(1),ee(0),ee(2),ee(17),ee(3),ee(17),ee(0),ee(63),ee(0);var fe=0,Ie=0,je=0;M=0,Q=7,this.encode.displayName="_encode_";for(var Ee,We,ze,st,bt,Qe,rt,Nt,we,Rt=re.data,Fe=re.width,et=re.height,$e=4*Fe,Kt=0;Kt<et;){for(Ee=0;Ee<$e;){for(bt=$e*Kt+Ee,rt=-1,Nt=0,we=0;we<64;we++)Qe=bt+(Nt=we>>3)*$e+(rt=4*(7&we)),Kt+Nt>=et&&(Qe-=$e*(Kt+1+Nt-et)),Ee+rt>=$e&&(Qe-=Ee+rt-$e+4),We=Rt[Qe++],ze=Rt[Qe++],st=Rt[Qe++],Z[we]=(me[We]+me[ze+256|0]+me[st+512|0]>>16)-128,$[we]=(me[We+768|0]+me[ze+1024|0]+me[st+1280|0]>>16)-128,X[we]=(me[We+1280|0]+me[ze+1536|0]+me[st+1792|0]>>16)-128;fe=He(Z,E,fe,o,d),Ie=He($,S,Ie,c,h),je=He(X,S,je,c,h),Ee+=32}Kt+=8}if(Q>=0){var qt=[];qt[1]=Q+1,qt[0]=(1<<Q+1)-1,Ce(qt)}return Be(65497),new Uint8Array(F)},a=a||50,function(){for(var re=String.fromCharCode,ve=0;ve<256;ve++)be[ve]=re(ve)}(),o=he(le,H),c=he(Y,se),d=he(Ae,J),h=he(oe,Te),function(){for(var re=1,ve=2,fe=1;fe<=15;fe++){for(var Ie=re;Ie<ve;Ie++)k[32767+Ie]=fe,I[32767+Ie]=[],I[32767+Ie][1]=fe,I[32767+Ie][0]=Ie;for(var je=-(ve-1);je<=-re;je++)k[32767+je]=fe,I[32767+je]=[],I[32767+je][1]=fe,I[32767+je][0]=ve-1+je;re<<=1,ve<<=1}}(),function(){for(var re=0;re<256;re++)me[re]=19595*re,me[re+256|0]=38470*re,me[re+512|0]=7471*re+32768,me[re+768|0]=-11059*re,me[re+1024|0]=-21709*re,me[re+1280|0]=32768*re+8421375,me[re+1536|0]=-27439*re,me[re+1792|0]=-5329*re}(),Ue(a)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Yl(a,o){if(this.pos=0,this.buffer=a,this.datav=new DataView(a.buffer),this.is_with_alpha=!!o,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function qV(a){function o(H){if(!H)throw Error("assert :P")}function c(H,Ae,J){for(var Y=0;4>Y;Y++)if(H[Ae+Y]!=J.charCodeAt(Y))return!0;return!1}function d(H,Ae,J,Y,se){for(var oe=0;oe<se;oe++)H[Ae+oe]=J[Y+oe]}function h(H,Ae,J,Y){for(var se=0;se<Y;se++)H[Ae+se]=J}function m(H){return new Int32Array(H)}function g(H,Ae){for(var J=[],Y=0;Y<H;Y++)J.push(new Ae);return J}function x(H,Ae){var J=[];return function Y(se,oe,Te){for(var he=Te[oe],Ce=0;Ce<he&&(se.push(Te.length>oe+1?[]:new Ae),!(Te.length<oe+1));Ce++)Y(se[Ce],oe+1,Te)}(J,0,H),J}var v=function(){var H=this;function Ae(y,T){for(var V=1<<T-1>>>0;y&V;)V>>>=1;return V?(y&V-1)+V:y}function J(y,T,V,z,ce){o(!(z%V));do y[T+(z-=V)]=ce;while(0<z)}function Y(y,T,V,z,ce){if(o(2328>=ce),512>=ce)var de=m(512);else if((de=m(ce))==null)return 0;return function(pe,_e,Se,ke,Ke,ut){var De,Ye,it=_e,wt=1<<Se,At=m(16),St=m(16);for(o(Ke!=0),o(ke!=null),o(pe!=null),o(0<Se),Ye=0;Ye<Ke;++Ye){if(15<ke[Ye])return 0;++At[ke[Ye]]}if(At[0]==Ke)return 0;for(St[1]=0,De=1;15>De;++De){if(At[De]>1<<De)return 0;St[De+1]=St[De]+At[De]}for(Ye=0;Ye<Ke;++Ye)De=ke[Ye],0<ke[Ye]&&(ut[St[De]++]=Ye);if(St[15]==1)return(ke=new se).g=0,ke.value=ut[0],J(pe,it,1,wt,ke),wt;var Ot,Qt=-1,Ft=wt-1,Bs=0,xs=1,nr=1,_s=1<<Se;for(Ye=0,De=1,Ke=2;De<=Se;++De,Ke<<=1){if(xs+=nr<<=1,0>(nr-=At[De]))return 0;for(;0<At[De];--At[De])(ke=new se).g=De,ke.value=ut[Ye++],J(pe,it+Bs,Ke,_s,ke),Bs=Ae(Bs,De)}for(De=Se+1,Ke=2;15>=De;++De,Ke<<=1){if(xs+=nr<<=1,0>(nr-=At[De]))return 0;for(;0<At[De];--At[De]){if(ke=new se,(Bs&Ft)!=Qt){for(it+=_s,Ot=1<<(Qt=De)-Se;15>Qt&&!(0>=(Ot-=At[Qt]));)++Qt,Ot<<=1;wt+=_s=1<<(Ot=Qt-Se),pe[_e+(Qt=Bs&Ft)].g=Ot+Se,pe[_e+Qt].value=it-_e-Qt}ke.g=De-Se,ke.value=ut[Ye++],J(pe,it+(Bs>>Se),Ke,_s,ke),Bs=Ae(Bs,De)}}return xs!=2*St[15]-1?0:wt}(y,T,V,z,ce,de)}function se(){this.value=this.g=0}function oe(){this.value=this.g=0}function Te(){this.G=g(5,se),this.H=m(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=g(lA,oe)}function he(y,T,V,z){o(y!=null),o(T!=null),o(2147483648>z),y.Ca=254,y.I=0,y.b=-8,y.Ka=0,y.oa=T,y.pa=V,y.Jd=T,y.Yc=V+z,y.Zc=4<=z?V+z-4+1:V,We(y)}function Ce(y,T){for(var V=0;0<T--;)V|=st(y,128)<<T;return V}function ee(y,T){var V=Ce(y,T);return ze(y)?-V:V}function Be(y,T,V,z){var ce,de=0;for(o(y!=null),o(T!=null),o(4294967288>z),y.Sb=z,y.Ra=0,y.u=0,y.h=0,4<z&&(z=4),ce=0;ce<z;++ce)de+=T[V+ce]<<8*ce;y.Ra=de,y.bb=z,y.oa=T,y.pa=V}function He(y){for(;8<=y.u&&y.bb<y.Sb;)y.Ra>>>=8,y.Ra+=y.oa[y.pa+y.bb]<<dd-8>>>0,++y.bb,y.u-=8;Ie(y)&&(y.h=1,y.u=0)}function Ue(y,T){if(o(0<=T),!y.h&&T<=io){var V=fe(y)&no[T];return y.u+=T,He(y),V}return y.h=1,y.u=0}function re(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function ve(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function fe(y){return y.Ra>>>(y.u&dd-1)>>>0}function Ie(y){return o(y.bb<=y.Sb),y.h||y.bb==y.Sb&&y.u>dd}function je(y,T){y.u=T,y.h=Ie(y)}function Ee(y){y.u>=tc&&(o(y.u>=tc),He(y))}function We(y){o(y!=null&&y.oa!=null),y.pa<y.Zc?(y.I=(y.oa[y.pa++]|y.I<<8)>>>0,y.b+=8):(o(y!=null&&y.oa!=null),y.pa<y.Yc?(y.b+=8,y.I=y.oa[y.pa++]|y.I<<8):y.Ka?y.b=0:(y.I<<=8,y.b+=8,y.Ka=1))}function ze(y){return Ce(y,1)}function st(y,T){var V=y.Ca;0>y.b&&We(y);var z=y.b,ce=V*T>>>8,de=(y.I>>>z>ce)+0;for(de?(V-=ce,y.I-=ce+1<<z>>>0):V=ce+1,z=V,ce=0;256<=z;)ce+=8,z>>=8;return z=7^ce+Ad[z],y.b-=z,y.Ca=(V<<z)-1,de}function bt(y,T,V){y[T+0]=V>>24&255,y[T+1]=V>>16&255,y[T+2]=V>>8&255,y[T+3]=255&V}function Qe(y,T){return y[T+0]|y[T+1]<<8}function rt(y,T){return Qe(y,T)|y[T+2]<<16}function Nt(y,T){return Qe(y,T)|Qe(y,T+2)<<16}function we(y,T){var V=1<<T;return o(y!=null),o(0<T),y.X=m(V),y.X==null?0:(y.Mb=32-T,y.Xa=T,1)}function Rt(y,T){o(y!=null),o(T!=null),o(y.Xa==T.Xa),d(T.X,0,y.X,0,1<<T.Xa)}function Fe(){this.X=[],this.Xa=this.Mb=0}function et(y,T,V,z){o(V!=null),o(z!=null);var ce=V[0],de=z[0];return ce==0&&(ce=(y*de+T/2)/T),de==0&&(de=(T*ce+y/2)/y),0>=ce||0>=de?0:(V[0]=ce,z[0]=de,1)}function $e(y,T){return y+(1<<T)-1>>>T}function Kt(y,T){return((4278255360&y)+(4278255360&T)>>>0&4278255360)+((16711935&y)+(16711935&T)>>>0&16711935)>>>0}function qt(y,T){H[T]=function(V,z,ce,de,pe,_e,Se){var ke;for(ke=0;ke<pe;++ke){var Ke=H[y](_e[Se+ke-1],ce,de+ke);_e[Se+ke]=Kt(V[z+ke],Ke)}}}function Xe(){this.ud=this.hd=this.jd=0}function ht(y,T){return((4278124286&(y^T))>>>1)+(y&T)>>>0}function dt(y){return 0<=y&&256>y?y:0>y?0:255<y?255:void 0}function Dt(y,T){return dt(y+(y-T+.5>>1))}function ss(y,T,V){return Math.abs(T-V)-Math.abs(y-V)}function $t(y,T,V,z,ce,de,pe){for(z=de[pe-1],V=0;V<ce;++V)de[pe+V]=z=Kt(y[T+V],z)}function ls(y,T,V,z,ce){var de;for(de=0;de<V;++de){var pe=y[T+de],_e=pe>>8&255,Se=16711935&(Se=(Se=16711935&pe)+((_e<<16)+_e));z[ce+de]=(4278255360&pe)+Se>>>0}}function Zt(y,T){T.jd=255&y,T.hd=y>>8&255,T.ud=y>>16&255}function Rs(y,T,V,z,ce,de){var pe;for(pe=0;pe<z;++pe){var _e=T[V+pe],Se=_e>>>8,ke=_e,Ke=255&(Ke=(Ke=_e>>>16)+((y.jd<<24>>24)*(Se<<24>>24)>>>5));ke=255&(ke=(ke+=(y.hd<<24>>24)*(Se<<24>>24)>>>5)+((y.ud<<24>>24)*(Ke<<24>>24)>>>5)),ce[de+pe]=(4278255360&_e)+(Ke<<16)+ke}}function es(y,T,V,z,ce){H[T]=function(de,pe,_e,Se,ke,Ke,ut,De,Ye){for(Se=ut;Se<De;++Se)for(ut=0;ut<Ye;++ut)ke[Ke++]=ce(_e[z(de[pe++])])},H[y]=function(de,pe,_e,Se,ke,Ke,ut){var De=8>>de.b,Ye=de.Ea,it=de.K[0],wt=de.w;if(8>De)for(de=(1<<de.b)-1,wt=(1<<De)-1;pe<_e;++pe){var At,St=0;for(At=0;At<Ye;++At)At&de||(St=z(Se[ke++])),Ke[ut++]=ce(it[St&wt]),St>>=De}else H["VP8LMapColor"+V](Se,ke,it,wt,Ke,ut,pe,_e,Ye)}}function Zs(y,T,V,z,ce){for(V=T+V;T<V;){var de=y[T++];z[ce++]=de>>16&255,z[ce++]=de>>8&255,z[ce++]=255&de}}function pt(y,T,V,z,ce){for(V=T+V;T<V;){var de=y[T++];z[ce++]=de>>16&255,z[ce++]=de>>8&255,z[ce++]=255&de,z[ce++]=de>>24&255}}function Ut(y,T,V,z,ce){for(V=T+V;T<V;){var de=(pe=y[T++])>>16&240|pe>>12&15,pe=240&pe|pe>>28&15;z[ce++]=de,z[ce++]=pe}}function zt(y,T,V,z,ce){for(V=T+V;T<V;){var de=(pe=y[T++])>>16&248|pe>>13&7,pe=pe>>5&224|pe>>3&31;z[ce++]=de,z[ce++]=pe}}function rs(y,T,V,z,ce){for(V=T+V;T<V;){var de=y[T++];z[ce++]=255&de,z[ce++]=de>>8&255,z[ce++]=de>>16&255}}function Ht(y,T,V,z,ce,de){if(de==0)for(V=T+V;T<V;)bt(z,((de=y[T++])[0]>>24|de[1]>>8&65280|de[2]<<8&16711680|de[3]<<24)>>>0),ce+=32;else d(z,ce,y,T,V)}function vt(y,T){H[T][0]=H[y+"0"],H[T][1]=H[y+"1"],H[T][2]=H[y+"2"],H[T][3]=H[y+"3"],H[T][4]=H[y+"4"],H[T][5]=H[y+"5"],H[T][6]=H[y+"6"],H[T][7]=H[y+"7"],H[T][8]=H[y+"8"],H[T][9]=H[y+"9"],H[T][10]=H[y+"10"],H[T][11]=H[y+"11"],H[T][12]=H[y+"12"],H[T][13]=H[y+"13"],H[T][14]=H[y+"0"],H[T][15]=H[y+"0"]}function jt(y){return y==Kg||y==hA||y==_m||y==Wg}function ps(){this.eb=[],this.size=this.A=this.fb=0}function Qs(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Is(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ps,this.f.kb=new Qs,this.sd=null}function ms(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ws(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function mi(y){return alert("todo:WebPSamplerProcessPlane"),y.T}function qr(y,T){var V=y.T,z=T.ba.f.RGBA,ce=z.eb,de=z.fb+y.ka*z.A,pe=Oo[T.ba.S],_e=y.y,Se=y.O,ke=y.f,Ke=y.N,ut=y.ea,De=y.W,Ye=T.cc,it=T.dc,wt=T.Mc,At=T.Nc,St=y.ka,Ot=y.ka+y.T,Qt=y.U,Ft=Qt+1>>1;for(St==0?pe(_e,Se,null,null,ke,Ke,ut,De,ke,Ke,ut,De,ce,de,null,null,Qt):(pe(T.ec,T.fc,_e,Se,Ye,it,wt,At,ke,Ke,ut,De,ce,de-z.A,ce,de,Qt),++V);St+2<Ot;St+=2)Ye=ke,it=Ke,wt=ut,At=De,Ke+=y.Rc,De+=y.Rc,de+=2*z.A,pe(_e,(Se+=2*y.fa)-y.fa,_e,Se,Ye,it,wt,At,ke,Ke,ut,De,ce,de-z.A,ce,de,Qt);return Se+=y.fa,y.j+Ot<y.o?(d(T.ec,T.fc,_e,Se,Qt),d(T.cc,T.dc,ke,Ke,Ft),d(T.Mc,T.Nc,ut,De,Ft),V--):1&Ot||pe(_e,Se,null,null,ke,Ke,ut,De,ke,Ke,ut,De,ce,de+z.A,null,null,Qt),V}function oa(y,T,V){var z=y.F,ce=[y.J];if(z!=null){var de=y.U,pe=T.ba.S,_e=pe==vm||pe==_m;T=T.ba.f.RGBA;var Se=[0],ke=y.ka;Se[0]=y.T,y.Kb&&(ke==0?--Se[0]:(--ke,ce[0]-=y.width),y.j+y.ka+y.T==y.o&&(Se[0]=y.o-y.j-ke));var Ke=T.eb;ke=T.fb+ke*T.A,y=wx(z,ce[0],y.width,de,Se,Ke,ke+(_e?0:3),T.A),o(V==Se),y&&jt(pe)&&cu(Ke,ke,_e,de,Se,T.A)}return 0}function Xi(y){var T=y.ma,V=T.ba.S,z=11>V,ce=V==xm||V==uu||V==vm||V==wm||V==12||jt(V);if(T.memory=null,T.Ib=null,T.Jb=null,T.Nd=null,!Th(T.Oa,y,ce?11:12))return 0;if(ce&&jt(V)&&Sh(),y.da)alert("todo:use_scaling");else{if(z){if(T.Ib=mi,y.Kb){if(V=y.U+1>>1,T.memory=m(y.U+2*V),T.memory==null)return 0;T.ec=T.memory,T.fc=0,T.cc=T.ec,T.dc=T.fc+y.U,T.Mc=T.cc,T.Nc=T.dc+V,T.Ib=qr,Sh()}}else alert("todo:EmitYUV");ce&&(T.Jb=oa,z&&ec())}if(z&&!Px){for(y=0;256>y;++y)Ux[y]=89858*(y-128)+mA>>pA,ME[y]=-22014*(y-128)+mA,Xg[y]=-45773*(y-128),Fx[y]=113618*(y-128)+mA>>pA;for(y=fA;y<Yg;++y)T=76283*(y-16)+mA>>pA,VE[y-fA]=Sc(T,255),jh[y-fA]=Sc(T+8>>4,15);Px=1}return 1}function Ds(y){var T=y.ma,V=y.U,z=y.T;return o(!(1&y.ka)),0>=V||0>=z?0:(V=T.Ib(y,T),T.Jb!=null&&T.Jb(y,T,V),T.Dc+=V,1)}function An(y){y.ma.memory=null}function wa(y,T,V,z){return Ue(y,8)!=47?0:(T[0]=Ue(y,14)+1,V[0]=Ue(y,14)+1,z[0]=Ue(y,1),Ue(y,3)!=0?0:!y.h)}function Qi(y,T){if(4>y)return y+1;var V=y-2>>1;return(2+(1&y)<<V)+Ue(T,V)+1}function fi(y,T){return 120<T?T-120:1<=(V=((V=zg[T-1])>>4)*y+(8-(15&V)))?V:1;var V}function Pn(y,T,V){var z=fe(V),ce=y[T+=255&z].g-8;return 0<ce&&(je(V,V.u+8),z=fe(V),T+=y[T].value,T+=z&(1<<ce)-1),je(V,V.u+y[T].g),y[T].value}function Ri(y,T,V){return V.g+=y.g,V.value+=y.value<<T>>>0,o(8>=V.g),y.g}function Hi(y,T,V){var z=y.xc;return o((T=z==0?0:y.vc[y.md*(V>>z)+(T>>z)])<y.Wb),y.Ya[T]}function eA(y,T,V,z){var ce=y.ab,de=y.c*T,pe=y.C;T=pe+T;var _e=V,Se=z;for(z=y.Ta,V=y.Ua;0<ce--;){var ke=y.gc[ce],Ke=pe,ut=T,De=_e,Ye=Se,it=(Se=z,_e=V,ke.Ea);switch(o(Ke<ut),o(ut<=ke.nc),ke.hc){case 2:Fn(De,Ye,(ut-Ke)*it,Se,_e);break;case 0:var wt=Ke,At=ut,St=Se,Ot=_e,Qt=(_s=ke).Ea;wt==0&&(Ih(De,Ye,null,null,1,St,Ot),$t(De,Ye+1,0,0,Qt-1,St,Ot+1),Ye+=Qt,Ot+=Qt,++wt);for(var Ft=1<<_s.b,Bs=Ft-1,xs=$e(Qt,_s.b),nr=_s.K,_s=_s.w+(wt>>_s.b)*xs;wt<At;){var Nr=nr,oi=_s,dr=1;for(dA(De,Ye,St,Ot-Qt,1,St,Ot);dr<Qt;){var ys=(dr&~Bs)+Ft;ys>Qt&&(ys=Qt),(0,kh[Nr[oi++]>>8&15])(De,Ye+ +dr,St,Ot+dr-Qt,ys-dr,St,Ot+dr),dr=ys}Ye+=Qt,Ot+=Qt,++wt&Bs||(_s+=xs)}ut!=ke.nc&&d(Se,_e-it,Se,_e+(ut-Ke-1)*it,it);break;case 1:for(it=De,At=Ye,Qt=(De=ke.Ea)-(Ot=De&~(St=(Ye=1<<ke.b)-1)),wt=$e(De,ke.b),Ft=ke.K,ke=ke.w+(Ke>>ke.b)*wt;Ke<ut;){for(Bs=Ft,xs=ke,nr=new Xe,_s=At+Ot,Nr=At+De;At<_s;)Zt(Bs[xs++],nr),Dh(nr,it,At,Ye,Se,_e),At+=Ye,_e+=Ye;At<Nr&&(Zt(Bs[xs++],nr),Dh(nr,it,At,Qt,Se,_e),At+=Qt,_e+=Qt),++Ke&St||(ke+=wt)}break;case 3:if(De==Se&&Ye==_e&&0<ke.b){for(At=Se,De=it=_e+(ut-Ke)*it-(Ot=(ut-Ke)*$e(ke.Ea,ke.b)),Ye=Se,St=_e,wt=[],Ot=(Qt=Ot)-1;0<=Ot;--Ot)wt[Ot]=Ye[St+Ot];for(Ot=Qt-1;0<=Ot;--Ot)At[De+Ot]=wt[Ot];gm(ke,Ke,ut,Se,it,Se,_e)}else gm(ke,Ke,ut,De,Ye,Se,_e)}_e=z,Se=V}Se!=V&&d(z,V,_e,Se,de)}function Al(y,T){var V=y.V,z=y.Ba+y.c*y.C,ce=T-y.C;if(o(T<=y.l.o),o(16>=ce),0<ce){var de=y.l,pe=y.Ta,_e=y.Ua,Se=de.width;if(eA(y,ce,V,z),ce=_e=[_e],o((V=y.C)<(z=T)),o(de.v<de.va),z>de.o&&(z=de.o),V<de.j){var ke=de.j-V;V=de.j,ce[0]+=ke*Se}if(V>=z?V=0:(ce[0]+=4*de.v,de.ka=V-de.j,de.U=de.va-de.v,de.T=z-V,V=1),V){if(_e=_e[0],11>(V=y.ca).S){var Ke=V.f.RGBA,ut=(z=V.S,ce=de.U,de=de.T,ke=Ke.eb,Ke.A),De=de;for(Ke=Ke.fb+y.Ma*Ke.A;0<De--;){var Ye=pe,it=_e,wt=ce,At=ke,St=Ke;switch(z){case bm:To(Ye,it,wt,At,St);break;case xm:ud(Ye,it,wt,At,St);break;case Kg:ud(Ye,it,wt,At,St),cu(At,St,0,wt,1,0);break;case Cx:AA(Ye,it,wt,At,St);break;case uu:Ht(Ye,it,wt,At,St,1);break;case hA:Ht(Ye,it,wt,At,St,1),cu(At,St,0,wt,1,0);break;case vm:Ht(Ye,it,wt,At,St,0);break;case _m:Ht(Ye,it,wt,At,St,0),cu(At,St,1,wt,1,0);break;case wm:hd(Ye,it,wt,At,St);break;case Wg:hd(Ye,it,wt,At,St),Gg(At,St,wt,1,0);break;case Fa:qn(Ye,it,wt,At,St);break;default:o(0)}_e+=Se,Ke+=ut}y.Ma+=de}else alert("todo:EmitRescaledRowsYUVA");o(y.Ma<=V.height)}}y.C=T,o(y.C<=y.i)}function wo(y){var T;if(0<y.ua)return 0;for(T=0;T<y.Wb;++T){var V=y.Ya[T].G,z=y.Ya[T].H;if(0<V[1][z[1]+0].g||0<V[2][z[2]+0].g||0<V[3][z[3]+0].g)return 0}return 1}function Ec(y,T,V,z,ce,de){if(y.Z!=0){var pe=y.qd,_e=y.rd;for(o(fd[y.Z]!=null);T<V;++T)fd[y.Z](pe,_e,z,ce,z,ce,de),pe=z,_e=ce,ce+=de;y.qd=pe,y.rd=_e}}function Xo(y,T){var V=y.l.ma,z=V.Z==0||V.Z==1?y.l.j:y.C;if(z=y.C<z?z:y.C,o(T<=y.l.o),T>z){var ce=y.l.width,de=V.ca,pe=V.tb+ce*z,_e=y.V,Se=y.Ba+y.c*z,ke=y.gc;o(y.ab==1),o(ke[0].hc==3),ao(ke[0],z,T,_e,Se,de,pe),Ec(V,z,T,de,pe,ce)}y.C=y.Ma=T}function Jo(y,T,V,z,ce,de,pe){var _e=y.$/z,Se=y.$%z,ke=y.m,Ke=y.s,ut=V+y.$,De=ut;ce=V+z*ce;var Ye=V+z*de,it=280+Ke.ua,wt=y.Pb?_e:16777216,At=0<Ke.ua?Ke.Wa:null,St=Ke.wc,Ot=ut<Ye?Hi(Ke,Se,_e):null;o(y.C<de),o(Ye<=ce);var Qt=!1;e:for(;;){for(;Qt||ut<Ye;){var Ft=0;if(_e>=wt){var Bs=ut-V;o((wt=y).Pb),wt.wd=wt.m,wt.xd=Bs,0<wt.s.ua&&Rt(wt.s.Wa,wt.s.vb),wt=_e+Rx}if(Se&St||(Ot=Hi(Ke,Se,_e)),o(Ot!=null),Ot.Qb&&(T[ut]=Ot.qb,Qt=!0),!Qt)if(Ee(ke),Ot.jc){Ft=ke,Bs=T;var xs=ut,nr=Ot.pd[fe(Ft)&lA-1];o(Ot.jc),256>nr.g?(je(Ft,Ft.u+nr.g),Bs[xs]=nr.value,Ft=0):(je(Ft,Ft.u+nr.g-256),o(256<=nr.value),Ft=nr.value),Ft==0&&(Qt=!0)}else Ft=Pn(Ot.G[0],Ot.H[0],ke);if(ke.h)break;if(Qt||256>Ft){if(!Qt)if(Ot.nd)T[ut]=(Ot.qb|Ft<<8)>>>0;else{if(Ee(ke),Qt=Pn(Ot.G[1],Ot.H[1],ke),Ee(ke),Bs=Pn(Ot.G[2],Ot.H[2],ke),xs=Pn(Ot.G[3],Ot.H[3],ke),ke.h)break;T[ut]=(xs<<24|Qt<<16|Ft<<8|Bs)>>>0}if(Qt=!1,++ut,++Se>=z&&(Se=0,++_e,pe!=null&&_e<=de&&!(_e%16)&&pe(y,_e),At!=null))for(;De<ut;)Ft=T[De++],At.X[(506832829*Ft&4294967295)>>>At.Mb]=Ft}else if(280>Ft){if(Ft=Qi(Ft-256,ke),Bs=Pn(Ot.G[4],Ot.H[4],ke),Ee(ke),Bs=fi(z,Bs=Qi(Bs,ke)),ke.h)break;if(ut-V<Bs||ce-ut<Ft)break e;for(xs=0;xs<Ft;++xs)T[ut+xs]=T[ut+xs-Bs];for(ut+=Ft,Se+=Ft;Se>=z;)Se-=z,++_e,pe!=null&&_e<=de&&!(_e%16)&&pe(y,_e);if(o(ut<=ce),Se&St&&(Ot=Hi(Ke,Se,_e)),At!=null)for(;De<ut;)Ft=T[De++],At.X[(506832829*Ft&4294967295)>>>At.Mb]=Ft}else{if(!(Ft<it))break e;for(Qt=Ft-280,o(At!=null);De<ut;)Ft=T[De++],At.X[(506832829*Ft&4294967295)>>>At.Mb]=Ft;Ft=ut,o(!(Qt>>>(Bs=At).Xa)),T[Ft]=Bs.X[Qt],Qt=!0}Qt||o(ke.h==Ie(ke))}if(y.Pb&&ke.h&&ut<ce)o(y.m.h),y.a=5,y.m=y.wd,y.$=y.xd,0<y.s.ua&&Rt(y.s.vb,y.s.Wa);else{if(ke.h)break e;pe!=null&&pe(y,_e>de?de:_e),y.a=0,y.$=ut-V}return 1}return y.a=3,0}function so(y){o(y!=null),y.vc=null,y.yc=null,y.Ya=null;var T=y.Wa;T!=null&&(T.X=null),y.vb=null,o(y!=null)}function id(){var y=new Js;return y==null?null:(y.a=0,y.xb=kx,vt("Predictor","VP8LPredictors"),vt("Predictor","VP8LPredictors_C"),vt("PredictorAdd","VP8LPredictorsAdd"),vt("PredictorAdd","VP8LPredictorsAdd_C"),Fn=ls,Dh=Rs,To=Zs,ud=pt,hd=Ut,qn=zt,AA=rs,H.VP8LMapColor32b=Oc,H.VP8LMapColor8b=Oh,y)}function _o(y,T,V,z,ce){var de=1,pe=[y],_e=[T],Se=z.m,ke=z.s,Ke=null,ut=0;e:for(;;){if(V)for(;de&&Ue(Se,1);){var De=pe,Ye=_e,it=z,wt=1,At=it.m,St=it.gc[it.ab],Ot=Ue(At,2);if(it.Oc&1<<Ot)de=0;else{switch(it.Oc|=1<<Ot,St.hc=Ot,St.Ea=De[0],St.nc=Ye[0],St.K=[null],++it.ab,o(4>=it.ab),Ot){case 0:case 1:St.b=Ue(At,3)+2,wt=_o($e(St.Ea,St.b),$e(St.nc,St.b),0,it,St.K),St.K=St.K[0];break;case 3:var Qt,Ft=Ue(At,8)+1,Bs=16<Ft?0:4<Ft?1:2<Ft?2:3;if(De[0]=$e(St.Ea,Bs),St.b=Bs,Qt=wt=_o(Ft,1,0,it,St.K)){var xs,nr=Ft,_s=St,Nr=1<<(8>>_s.b),oi=m(Nr);if(oi==null)Qt=0;else{var dr=_s.K[0],ys=_s.w;for(oi[0]=_s.K[0][0],xs=1;xs<1*nr;++xs)oi[xs]=Kt(dr[ys+xs],oi[xs-1]);for(;xs<4*Nr;++xs)oi[xs]=0;_s.K[0]=null,_s.K[0]=oi,Qt=1}}wt=Qt;break;case 2:break;default:o(0)}de=wt}}if(pe=pe[0],_e=_e[0],de&&Ue(Se,1)&&!(de=1<=(ut=Ue(Se,4))&&11>=ut)){z.a=3;break e}var ts;if(ts=de)t:{var Cn,ir,Lr,xn=z,$i=pe,Ea=_e,Mn=ut,la=V,Sa=xn.m,Ii=xn.s,Mr=[null],Zr=1,Yn=0,Xr=IE[Mn];s:for(;;){if(la&&Ue(Sa,1)){var Xn=Ue(Sa,3)+2,ic=$e($i,Xn),ci=$e(Ea,Xn),Ma=ic*ci;if(!_o(ic,ci,0,xn,Mr))break s;for(Mr=Mr[0],Ii.xc=Xn,Cn=0;Cn<Ma;++Cn){var rn=Mr[Cn]>>8&65535;Mr[Cn]=rn,rn>=Zr&&(Zr=rn+1)}}if(Sa.h)break s;for(ir=0;5>ir;++ir){var Oi=Tx[ir];!ir&&0<Mn&&(Oi+=1<<Mn),Yn<Oi&&(Yn=Oi)}var Va=g(Zr*Xr,se),Ca=Zr,oo=g(Ca,Te);if(oo==null)var co=null;else o(65536>=Ca),co=oo;var Zi=m(Yn);if(co==null||Zi==null||Va==null){xn.a=1;break s}var lo=Va;for(Cn=Lr=0;Cn<Zr;++Cn){var vn=co[Cn],Ao=vn.G,ac=vn.H,gA=0,_l=1,ki=0;for(ir=0;5>ir;++ir){Oi=Tx[ir],Ao[ir]=lo,ac[ir]=Lr,!ir&&0<Mn&&(Oi+=1<<Mn);n:{var Cm,Nm=Oi,Tm=xn,pu=Zi,GE=lo,KE=Lr,Jg=0,gd=Tm.m,WE=Ue(gd,1);if(h(pu,0,0,Nm),WE){var zE=Ue(gd,1)+1,Qx=Ue(gd,1),Hx=Ue(gd,Qx==0?1:8);pu[Hx]=1,zE==2&&(pu[Hx=Ue(gd,8)]=1);var Rm=1}else{var $g=m(19),Gx=Ue(gd,4)+4;if(19<Gx){Tm.a=3;var bA=0;break n}for(Cm=0;Cm<Gx;++Cm)$g[RE[Cm]]=Ue(gd,3);var Im=void 0,yl=void 0,Kx=Tm,qE=$g,Om=Nm,Wx=pu,mu=0,bd=Kx.m,Zg=8,km=g(128,se);r:for(;Y(km,0,7,qE,19);){if(Ue(bd,1)){var e0=2+2*Ue(bd,3);if((Im=2+Ue(bd,e0))>Om)break r}else Im=Om;for(yl=0;yl<Om&&Im--;){Ee(bd);var zx=km[0+(127&fe(bd))];je(bd,bd.u+zx.g);var fu=zx.value;if(16>fu)Wx[yl++]=fu,fu!=0&&(Zg=fu);else{var YE=fu==16,qx=fu-16,XE=Nx[qx],Ph=Ue(bd,NE[qx])+XE;if(yl+Ph>Om)break r;for(var JE=YE?Zg:0;0<Ph--;)Wx[yl++]=JE}}mu=1;break r}mu||(Kx.a=3),Rm=mu}(Rm=Rm&&!gd.h)&&(Jg=Y(GE,KE,8,pu,Nm)),Rm&&Jg!=0?bA=Jg:(Tm.a=3,bA=0)}if(bA==0)break s;if(_l&&TE[ir]==1&&(_l=lo[Lr].g==0),gA+=lo[Lr].g,Lr+=bA,3>=ir){var Dc,Uh=Zi[0];for(Dc=1;Dc<Oi;++Dc)Zi[Dc]>Uh&&(Uh=Zi[Dc]);ki+=Uh}}if(vn.nd=_l,vn.Qb=0,_l&&(vn.qb=(Ao[3][ac[3]+0].value<<24|Ao[1][ac[1]+0].value<<16|Ao[2][ac[2]+0].value)>>>0,gA==0&&256>Ao[0][ac[0]+0].value&&(vn.Qb=1,vn.qb+=Ao[0][ac[0]+0].value<<8)),vn.jc=!vn.Qb&&6>ki,vn.jc){var xA,uo=vn;for(xA=0;xA<lA;++xA){var oc=xA,xd=uo.pd[oc],Fh=uo.G[0][uo.H[0]+oc];256<=Fh.value?(xd.g=Fh.g+256,xd.value=Fh.value):(xd.g=0,xd.value=0,oc>>=Ri(Fh,8,xd),oc>>=Ri(uo.G[1][uo.H[1]+oc],16,xd),oc>>=Ri(uo.G[2][uo.H[2]+oc],0,xd),Ri(uo.G[3][uo.H[3]+oc],24,xd))}}}Ii.vc=Mr,Ii.Wb=Zr,Ii.Ya=co,Ii.yc=Va,ts=1;break t}ts=0}if(!(de=ts)){z.a=3;break e}if(0<ut){if(ke.ua=1<<ut,!we(ke.Wa,ut)){z.a=1,de=0;break e}}else ke.ua=0;var t0=z,s0=pe,$E=_e,r0=t0.s,Mh=r0.xc;if(t0.c=s0,t0.i=$E,r0.md=$e(s0,Mh),r0.wc=Mh==0?-1:(1<<Mh)-1,V){z.xb=LE;break e}if((Ke=m(pe*_e))==null){z.a=1,de=0;break e}de=(de=Jo(z,Ke,0,pe,_e,_e,null))&&!Se.h;break e}return de?(ce!=null?ce[0]=Ke:(o(Ke==null),o(V)),z.$=0,V||so(ke)):so(ke),de}function ad(y,T){var V=y.c*y.i,z=V+T+16*T;return o(y.c<=T),y.V=m(z),y.V==null?(y.Ta=null,y.Ua=0,y.a=1,0):(y.Ta=y.V,y.Ua=y.Ba+V+T,1)}function $o(y,T){var V=y.C,z=T-V,ce=y.V,de=y.Ba+y.c*V;for(o(T<=y.l.o);0<z;){var pe=16<z?16:z,_e=y.l.ma,Se=y.l.width,ke=Se*pe,Ke=_e.ca,ut=_e.tb+Se*V,De=y.Ta,Ye=y.Ua;eA(y,pe,ce,de),_x(De,Ye,Ke,ut,ke),Ec(_e,V,V+pe,Ke,ut,Se),z-=pe,ce+=pe*y.c,V+=pe}o(V==T),y.C=y.Ma=T}function JA(){this.ub=this.yd=this.td=this.Rb=0}function $A(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function yo(){this.Fb=this.Bb=this.Cb=0,this.Zb=m(4),this.Lb=m(4)}function ph(){this.Yb=function(){var y=[];return function T(V,z,ce){for(var de=ce[z],pe=0;pe<de&&(V.push(ce.length>z+1?[]:0),!(ce.length<z+1));pe++)T(V[pe],z+1,ce)}(y,0,[3,11]),y}()}function nm(){this.jb=m(3),this.Wc=x([4,8],ph),this.Xc=x([4,17],ph)}function Un(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new m(4),this.od=new m(4)}function Eo(){this.ld=this.La=this.dd=this.tc=0}function mh(){this.Na=this.la=0}function im(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function fh(){this.ad=m(384),this.Za=0,this.Ob=m(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function ZA(){this.uc=this.M=this.Nb=0,this.wa=Array(new Eo),this.Y=0,this.ya=Array(new fh),this.aa=0,this.l=new eu}function am(){this.y=m(16),this.f=m(8),this.ea=m(8)}function gh(){this.cb=this.a=0,this.sc="",this.m=new re,this.Od=new JA,this.Kc=new $A,this.ed=new Un,this.Qa=new yo,this.Ic=this.$c=this.Aa=0,this.D=new ZA,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=g(8,re),this.ia=0,this.pb=g(4,im),this.Pa=new nm,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new am),this.Hd=0,this.rb=Array(new mh),this.sb=0,this.wa=Array(new Eo),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new fh),this.L=this.aa=0,this.gd=x([4,2],Eo),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Sc(y,T){return 0>y?0:y>T?T:y}function eu(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Dg(){var y=new gh;return y!=null&&(y.a=0,y.sc="OK",y.cb=0,y.Xb=0,hu||(hu=Ur)),y}function Sn(y,T,V){return y.a==0&&(y.a=T,y.sc=V,y.cb=0),0}function tu(y,T,V){return 3<=V&&y[T+0]==157&&y[T+1]==1&&y[T+2]==42}function Cc(y,T){if(y==null)return 0;if(y.a=0,y.sc="OK",T==null)return Sn(y,2,"null VP8Io passed to VP8GetHeaders()");var V=T.data,z=T.w,ce=T.ha;if(4>ce)return Sn(y,7,"Truncated header.");var de=V[z+0]|V[z+1]<<8|V[z+2]<<16,pe=y.Od;if(pe.Rb=!(1&de),pe.td=de>>1&7,pe.yd=de>>4&1,pe.ub=de>>5,3<pe.td)return Sn(y,3,"Incorrect keyframe parameters.");if(!pe.yd)return Sn(y,4,"Frame not displayable.");z+=3,ce-=3;var _e=y.Kc;if(pe.Rb){if(7>ce)return Sn(y,7,"cannot parse picture header");if(!tu(V,z,ce))return Sn(y,3,"Bad code word");_e.c=16383&(V[z+4]<<8|V[z+3]),_e.Td=V[z+4]>>6,_e.i=16383&(V[z+6]<<8|V[z+5]),_e.Ud=V[z+6]>>6,z+=7,ce-=7,y.za=_e.c+15>>4,y.Ub=_e.i+15>>4,T.width=_e.c,T.height=_e.i,T.Da=0,T.j=0,T.v=0,T.va=T.width,T.o=T.height,T.da=0,T.ib=T.width,T.hb=T.height,T.U=T.width,T.T=T.height,h((de=y.Pa).jb,0,255,de.jb.length),o((de=y.Qa)!=null),de.Cb=0,de.Bb=0,de.Fb=1,h(de.Zb,0,0,de.Zb.length),h(de.Lb,0,0,de.Lb)}if(pe.ub>ce)return Sn(y,7,"bad partition length");he(de=y.m,V,z,pe.ub),z+=pe.ub,ce-=pe.ub,pe.Rb&&(_e.Ld=ze(de),_e.Kd=ze(de)),_e=y.Qa;var Se,ke=y.Pa;if(o(de!=null),o(_e!=null),_e.Cb=ze(de),_e.Cb){if(_e.Bb=ze(de),ze(de)){for(_e.Fb=ze(de),Se=0;4>Se;++Se)_e.Zb[Se]=ze(de)?ee(de,7):0;for(Se=0;4>Se;++Se)_e.Lb[Se]=ze(de)?ee(de,6):0}if(_e.Bb)for(Se=0;3>Se;++Se)ke.jb[Se]=ze(de)?Ce(de,8):255}else _e.Bb=0;if(de.Ka)return Sn(y,3,"cannot parse segment header");if((_e=y.ed).zd=ze(de),_e.Tb=Ce(de,6),_e.wb=Ce(de,3),_e.Pc=ze(de),_e.Pc&&ze(de)){for(ke=0;4>ke;++ke)ze(de)&&(_e.vd[ke]=ee(de,6));for(ke=0;4>ke;++ke)ze(de)&&(_e.od[ke]=ee(de,6))}if(y.L=_e.Tb==0?0:_e.zd?1:2,de.Ka)return Sn(y,3,"cannot parse filter header");var Ke=ce;if(ce=Se=z,z=Se+Ke,_e=Ke,y.Xb=(1<<Ce(y.m,2))-1,Ke<3*(ke=y.Xb))V=7;else{for(Se+=3*ke,_e-=3*ke,Ke=0;Ke<ke;++Ke){var ut=V[ce+0]|V[ce+1]<<8|V[ce+2]<<16;ut>_e&&(ut=_e),he(y.Jc[+Ke],V,Se,ut),Se+=ut,_e-=ut,ce+=3}he(y.Jc[+ke],V,Se,_e),V=Se<z?0:5}if(V!=0)return Sn(y,V,"cannot parse partitions");for(V=Ce(Se=y.m,7),ce=ze(Se)?ee(Se,4):0,z=ze(Se)?ee(Se,4):0,_e=ze(Se)?ee(Se,4):0,ke=ze(Se)?ee(Se,4):0,Se=ze(Se)?ee(Se,4):0,Ke=y.Qa,ut=0;4>ut;++ut){if(Ke.Cb){var De=Ke.Zb[ut];Ke.Fb||(De+=V)}else{if(0<ut){y.pb[ut]=y.pb[0];continue}De=V}var Ye=y.pb[ut];Ye.Sc[0]=ym[Sc(De+ce,127)],Ye.Sc[1]=qg[Sc(De+0,127)],Ye.Eb[0]=2*ym[Sc(De+z,127)],Ye.Eb[1]=101581*qg[Sc(De+_e,127)]>>16,8>Ye.Eb[1]&&(Ye.Eb[1]=8),Ye.Qc[0]=ym[Sc(De+ke,117)],Ye.Qc[1]=qg[Sc(De+Se,127)],Ye.lc=De+Se}if(!pe.Rb)return Sn(y,4,"Not a key frame.");for(ze(de),pe=y.Pa,V=0;4>V;++V){for(ce=0;8>ce;++ce)for(z=0;3>z;++z)for(_e=0;11>_e;++_e)ke=st(de,BE[V][ce][z][_e])?Ce(de,8):kE[V][ce][z][_e],pe.Wc[V][ce].Yb[z][_e]=ke;for(ce=0;17>ce;++ce)pe.Xc[V][ce]=pe.Wc[V][Ox[ce]]}return y.kc=ze(de),y.kc&&(y.Bd=Ce(de,8)),y.cb=1}function Ur(y,T,V,z,ce,de,pe){var _e=T[ce].Yb[V];for(V=0;16>ce;++ce){if(!st(y,_e[V+0]))return ce;for(;!st(y,_e[V+1]);)if(_e=T[++ce].Yb[0],V=0,ce==16)return 16;var Se=T[ce+1].Yb;if(st(y,_e[V+2])){var ke=y,Ke=0;if(st(ke,(De=_e)[(ut=V)+3]))if(st(ke,De[ut+6])){for(_e=0,ut=2*(Ke=st(ke,De[ut+8]))+(De=st(ke,De[ut+9+Ke])),Ke=0,De=Em[ut];De[_e];++_e)Ke+=Ke+st(ke,De[_e]);Ke+=3+(8<<ut)}else st(ke,De[ut+7])?(Ke=7+2*st(ke,165),Ke+=st(ke,145)):Ke=5+st(ke,159);else Ke=st(ke,De[ut+4])?3+st(ke,De[ut+5]):2;_e=Se[2]}else Ke=1,_e=Se[1];Se=pe+OE[ce],0>(ke=y).b&&We(ke);var ut,De=ke.b,Ye=(ut=ke.Ca>>1)-(ke.I>>De)>>31;--ke.b,ke.Ca+=Ye,ke.Ca|=1,ke.I-=(ut+1&Ye)<<De,de[Se]=((Ke^Ye)-Ye)*z[(0<ce)+0]}return 16}function om(y){var T=y.rb[y.sb-1];T.la=0,T.Na=0,h(y.zc,0,0,y.zc.length),y.ja=0}function ro(y,T,V,z,ce){ce=y[T+V+32*z]+(ce>>3),y[T+V+32*z]=-256&ce?0>ce?0:255:ce}function gi(y,T,V,z,ce,de){ro(y,T,0,V,z+ce),ro(y,T,1,V,z+de),ro(y,T,2,V,z-de),ro(y,T,3,V,z-ce)}function ul(y){return(20091*y>>16)+y}function cm(y,T,V,z){var ce,de=0,pe=m(16);for(ce=0;4>ce;++ce){var _e=y[T+0]+y[T+8],Se=y[T+0]-y[T+8],ke=(35468*y[T+4]>>16)-ul(y[T+12]),Ke=ul(y[T+4])+(35468*y[T+12]>>16);pe[de+0]=_e+Ke,pe[de+1]=Se+ke,pe[de+2]=Se-ke,pe[de+3]=_e-Ke,de+=4,T++}for(ce=de=0;4>ce;++ce)_e=(y=pe[de+0]+4)+pe[de+8],Se=y-pe[de+8],ke=(35468*pe[de+4]>>16)-ul(pe[de+12]),ro(V,z,0,0,_e+(Ke=ul(pe[de+4])+(35468*pe[de+12]>>16))),ro(V,z,1,0,Se+ke),ro(V,z,2,0,Se-ke),ro(V,z,3,0,_e-Ke),de++,z+=32}function Bg(y,T,V,z){var ce=y[T+0]+4,de=35468*y[T+4]>>16,pe=ul(y[T+4]),_e=35468*y[T+1]>>16;gi(V,z,0,ce+pe,y=ul(y[T+1]),_e),gi(V,z,1,ce+de,y,_e),gi(V,z,2,ce-de,y,_e),gi(V,z,3,ce-pe,y,_e)}function Lg(y,T,V,z,ce){cm(y,T,V,z),ce&&cm(y,T+16,V,z+4)}function Nc(y,T,V,z){uA(y,T+0,V,z,1),uA(y,T+32,V,z+128,1)}function lm(y,T,V,z){var ce;for(y=y[T+0]+4,ce=0;4>ce;++ce)for(T=0;4>T;++T)ro(V,z,T,ce,y)}function su(y,T,V,z){y[T+0]&&Yr(y,T+0,V,z),y[T+16]&&Yr(y,T+16,V,z+4),y[T+32]&&Yr(y,T+32,V,z+128),y[T+48]&&Yr(y,T+48,V,z+128+4)}function tA(y,T,V,z){var ce,de=m(16);for(ce=0;4>ce;++ce){var pe=y[T+0+ce]+y[T+12+ce],_e=y[T+4+ce]+y[T+8+ce],Se=y[T+4+ce]-y[T+8+ce],ke=y[T+0+ce]-y[T+12+ce];de[0+ce]=pe+_e,de[8+ce]=pe-_e,de[4+ce]=ke+Se,de[12+ce]=ke-Se}for(ce=0;4>ce;++ce)pe=(y=de[0+4*ce]+3)+de[3+4*ce],_e=de[1+4*ce]+de[2+4*ce],Se=de[1+4*ce]-de[2+4*ce],ke=y-de[3+4*ce],V[z+0]=pe+_e>>3,V[z+16]=ke+Se>>3,V[z+32]=pe-_e>>3,V[z+48]=ke-Se>>3,z+=64}function hl(y,T,V){var z,ce=T-32,de=ca,pe=255-y[ce-1];for(z=0;z<V;++z){var _e,Se=de,ke=pe+y[T-1];for(_e=0;_e<V;++_e)y[T+_e]=Se[ke+y[ce+_e]];T+=32}}function jg(y,T){hl(y,T,4)}function bh(y,T){hl(y,T,8)}function Pg(y,T){hl(y,T,16)}function ru(y,T){var V;for(V=0;16>V;++V)d(y,T+32*V,y,T-32,16)}function dm(y,T){var V;for(V=16;0<V;--V)h(y,T,y[T-1],16),T+=32}function Zo(y,T,V){var z;for(z=0;16>z;++z)h(T,V+32*z,y,16)}function Ug(y,T){var V,z=16;for(V=0;16>V;++V)z+=y[T-1+32*V]+y[T+V-32];Zo(z>>5,y,T)}function sA(y,T){var V,z=8;for(V=0;16>V;++V)z+=y[T-1+32*V];Zo(z>>4,y,T)}function xh(y,T){var V,z=8;for(V=0;16>V;++V)z+=y[T+V-32];Zo(z>>4,y,T)}function Fg(y,T){Zo(128,y,T)}function er(y,T,V){return y+2*T+V+2>>2}function Mg(y,T){var V,z=T-32;for(z=new Uint8Array([er(y[z-1],y[z+0],y[z+1]),er(y[z+0],y[z+1],y[z+2]),er(y[z+1],y[z+2],y[z+3]),er(y[z+2],y[z+3],y[z+4])]),V=0;4>V;++V)d(y,T+32*V,z,0,z.length)}function Am(y,T){var V=y[T-1],z=y[T-1+32],ce=y[T-1+64],de=y[T-1+96];bt(y,T+0,16843009*er(y[T-1-32],V,z)),bt(y,T+32,16843009*er(V,z,ce)),bt(y,T+64,16843009*er(z,ce,de)),bt(y,T+96,16843009*er(ce,de,de))}function Vg(y,T){var V,z=4;for(V=0;4>V;++V)z+=y[T+V-32]+y[T-1+32*V];for(z>>=3,V=0;4>V;++V)h(y,T+32*V,z,4)}function pl(y,T){var V=y[T-1+0],z=y[T-1+32],ce=y[T-1+64],de=y[T-1-32],pe=y[T+0-32],_e=y[T+1-32],Se=y[T+2-32],ke=y[T+3-32];y[T+0+96]=er(z,ce,y[T-1+96]),y[T+1+96]=y[T+0+64]=er(V,z,ce),y[T+2+96]=y[T+1+64]=y[T+0+32]=er(de,V,z),y[T+3+96]=y[T+2+64]=y[T+1+32]=y[T+0+0]=er(pe,de,V),y[T+3+64]=y[T+2+32]=y[T+1+0]=er(_e,pe,de),y[T+3+32]=y[T+2+0]=er(Se,_e,pe),y[T+3+0]=er(ke,Se,_e)}function ml(y,T){var V=y[T+1-32],z=y[T+2-32],ce=y[T+3-32],de=y[T+4-32],pe=y[T+5-32],_e=y[T+6-32],Se=y[T+7-32];y[T+0+0]=er(y[T+0-32],V,z),y[T+1+0]=y[T+0+32]=er(V,z,ce),y[T+2+0]=y[T+1+32]=y[T+0+64]=er(z,ce,de),y[T+3+0]=y[T+2+32]=y[T+1+64]=y[T+0+96]=er(ce,de,pe),y[T+3+32]=y[T+2+64]=y[T+1+96]=er(de,pe,_e),y[T+3+64]=y[T+2+96]=er(pe,_e,Se),y[T+3+96]=er(_e,Se,Se)}function rA(y,T){var V=y[T-1+0],z=y[T-1+32],ce=y[T-1+64],de=y[T-1-32],pe=y[T+0-32],_e=y[T+1-32],Se=y[T+2-32],ke=y[T+3-32];y[T+0+0]=y[T+1+64]=de+pe+1>>1,y[T+1+0]=y[T+2+64]=pe+_e+1>>1,y[T+2+0]=y[T+3+64]=_e+Se+1>>1,y[T+3+0]=Se+ke+1>>1,y[T+0+96]=er(ce,z,V),y[T+0+64]=er(z,V,de),y[T+0+32]=y[T+1+96]=er(V,de,pe),y[T+1+32]=y[T+2+96]=er(de,pe,_e),y[T+2+32]=y[T+3+96]=er(pe,_e,Se),y[T+3+32]=er(_e,Se,ke)}function Qg(y,T){var V=y[T+0-32],z=y[T+1-32],ce=y[T+2-32],de=y[T+3-32],pe=y[T+4-32],_e=y[T+5-32],Se=y[T+6-32],ke=y[T+7-32];y[T+0+0]=V+z+1>>1,y[T+1+0]=y[T+0+64]=z+ce+1>>1,y[T+2+0]=y[T+1+64]=ce+de+1>>1,y[T+3+0]=y[T+2+64]=de+pe+1>>1,y[T+0+32]=er(V,z,ce),y[T+1+32]=y[T+0+96]=er(z,ce,de),y[T+2+32]=y[T+1+96]=er(ce,de,pe),y[T+3+32]=y[T+2+96]=er(de,pe,_e),y[T+3+64]=er(pe,_e,Se),y[T+3+96]=er(_e,Se,ke)}function nu(y,T){var V=y[T-1+0],z=y[T-1+32],ce=y[T-1+64],de=y[T-1+96];y[T+0+0]=V+z+1>>1,y[T+2+0]=y[T+0+32]=z+ce+1>>1,y[T+2+32]=y[T+0+64]=ce+de+1>>1,y[T+1+0]=er(V,z,ce),y[T+3+0]=y[T+1+32]=er(z,ce,de),y[T+3+32]=y[T+1+64]=er(ce,de,de),y[T+3+64]=y[T+2+64]=y[T+0+96]=y[T+1+96]=y[T+2+96]=y[T+3+96]=de}function vh(y,T){var V=y[T-1+0],z=y[T-1+32],ce=y[T-1+64],de=y[T-1+96],pe=y[T-1-32],_e=y[T+0-32],Se=y[T+1-32],ke=y[T+2-32];y[T+0+0]=y[T+2+32]=V+pe+1>>1,y[T+0+32]=y[T+2+64]=z+V+1>>1,y[T+0+64]=y[T+2+96]=ce+z+1>>1,y[T+0+96]=de+ce+1>>1,y[T+3+0]=er(_e,Se,ke),y[T+2+0]=er(pe,_e,Se),y[T+1+0]=y[T+3+32]=er(V,pe,_e),y[T+1+32]=y[T+3+64]=er(z,V,pe),y[T+1+64]=y[T+3+96]=er(ce,z,V),y[T+1+96]=er(de,ce,z)}function nA(y,T){var V;for(V=0;8>V;++V)d(y,T+32*V,y,T-32,8)}function um(y,T){var V;for(V=0;8>V;++V)h(y,T,y[T-1],8),T+=32}function fl(y,T,V){var z;for(z=0;8>z;++z)h(T,V+32*z,y,8)}function Hg(y,T){var V,z=8;for(V=0;8>V;++V)z+=y[T+V-32]+y[T-1+32*V];fl(z>>4,y,T)}function wh(y,T){var V,z=4;for(V=0;8>V;++V)z+=y[T+V-32];fl(z>>3,y,T)}function So(y,T){var V,z=4;for(V=0;8>V;++V)z+=y[T-1+32*V];fl(z>>3,y,T)}function _a(y,T){fl(128,y,T)}function Tc(y,T,V){var z=y[T-V],ce=y[T+0],de=3*(ce-z)+du[1020+y[T-2*V]-y[T+V]],pe=Au[112+(de+4>>3)];y[T-V]=ca[255+z+Au[112+(de+3>>3)]],y[T+0]=ca[255+ce-pe]}function _h(y,T,V,z){var ce=y[T+0],de=y[T+V];return Io[255+y[T-2*V]-y[T-V]]>z||Io[255+de-ce]>z}function iu(y,T,V,z){return 4*Io[255+y[T-V]-y[T+0]]+Io[255+y[T-2*V]-y[T+V]]<=z}function yh(y,T,V,z,ce){var de=y[T-3*V],pe=y[T-2*V],_e=y[T-V],Se=y[T+0],ke=y[T+V],Ke=y[T+2*V],ut=y[T+3*V];return 4*Io[255+_e-Se]+Io[255+pe-ke]>z?0:Io[255+y[T-4*V]-de]<=ce&&Io[255+de-pe]<=ce&&Io[255+pe-_e]<=ce&&Io[255+ut-Ke]<=ce&&Io[255+Ke-ke]<=ce&&Io[255+ke-Se]<=ce}function ii(y,T,V,z){var ce=2*z+1;for(z=0;16>z;++z)iu(y,T+z,V,ce)&&Tc(y,T+z,V)}function Eh(y,T,V,z){var ce=2*z+1;for(z=0;16>z;++z)iu(y,T+z*V,1,ce)&&Tc(y,T+z*V,1)}function hm(y,T,V,z){var ce;for(ce=3;0<ce;--ce)ii(y,T+=4*V,V,z)}function pm(y,T,V,z){var ce;for(ce=3;0<ce;--ce)Eh(y,T+=4,V,z)}function Co(y,T,V,z,ce,de,pe,_e){for(de=2*de+1;0<ce--;){if(yh(y,T,V,de,pe))if(_h(y,T,V,_e))Tc(y,T,V);else{var Se=y,ke=T,Ke=V,ut=Se[ke-2*Ke],De=Se[ke-Ke],Ye=Se[ke+0],it=Se[ke+Ke],wt=Se[ke+2*Ke],At=27*(Ot=du[1020+3*(Ye-De)+du[1020+ut-it]])+63>>7,St=18*Ot+63>>7,Ot=9*Ot+63>>7;Se[ke-3*Ke]=ca[255+Se[ke-3*Ke]+Ot],Se[ke-2*Ke]=ca[255+ut+St],Se[ke-Ke]=ca[255+De+At],Se[ke+0]=ca[255+Ye-At],Se[ke+Ke]=ca[255+it-St],Se[ke+2*Ke]=ca[255+wt-Ot]}T+=z}}function Rc(y,T,V,z,ce,de,pe,_e){for(de=2*de+1;0<ce--;){if(yh(y,T,V,de,pe))if(_h(y,T,V,_e))Tc(y,T,V);else{var Se=y,ke=T,Ke=V,ut=Se[ke-Ke],De=Se[ke+0],Ye=Se[ke+Ke],it=Au[112+(4+(wt=3*(De-ut))>>3)],wt=Au[112+(wt+3>>3)],At=it+1>>1;Se[ke-2*Ke]=ca[255+Se[ke-2*Ke]+At],Se[ke-Ke]=ca[255+ut+wt],Se[ke+0]=ca[255+De-it],Se[ke+Ke]=ca[255+Ye-At]}T+=z}}function mm(y,T,V,z,ce,de){Co(y,T,V,1,16,z,ce,de)}function gl(y,T,V,z,ce,de){Co(y,T,1,V,16,z,ce,de)}function fm(y,T,V,z,ce,de){var pe;for(pe=3;0<pe;--pe)Rc(y,T+=4*V,V,1,16,z,ce,de)}function L(y,T,V,z,ce,de){var pe;for(pe=3;0<pe;--pe)Rc(y,T+=4,1,V,16,z,ce,de)}function ae(y,T,V,z,ce,de,pe,_e){Co(y,T,ce,1,8,de,pe,_e),Co(V,z,ce,1,8,de,pe,_e)}function Oe(y,T,V,z,ce,de,pe,_e){Co(y,T,1,ce,8,de,pe,_e),Co(V,z,1,ce,8,de,pe,_e)}function Ve(y,T,V,z,ce,de,pe,_e){Rc(y,T+4*ce,ce,1,8,de,pe,_e),Rc(V,z+4*ce,ce,1,8,de,pe,_e)}function tt(y,T,V,z,ce,de,pe,_e){Rc(y,T+4,1,ce,8,de,pe,_e),Rc(V,z+4,1,ce,8,de,pe,_e)}function yt(){this.ba=new Is,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ws,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Pt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ws(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function ks(){this.ua=0,this.Wa=new Fe,this.vb=new Fe,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Te,this.yc=new se}function Js(){this.xb=this.a=0,this.l=new eu,this.ca=new Is,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new ve,this.Pb=0,this.wd=new ve,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new ks,this.ab=0,this.gc=g(4,ws),this.Oc=0}function lr(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new eu,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Fr(y,T,V,z,ce,de,pe){for(y=y==null?0:y[T+0],T=0;T<pe;++T)ce[de+T]=y+V[z+T]&255,y=ce[de+T]}function sn(y,T,V,z,ce,de,pe){var _e;if(y==null)Fr(null,null,V,z,ce,de,pe);else for(_e=0;_e<pe;++_e)ce[de+_e]=y[T+_e]+V[z+_e]&255}function bi(y,T,V,z,ce,de,pe){if(y==null)Fr(null,null,V,z,ce,de,pe);else{var _e,Se=y[T+0],ke=Se,Ke=Se;for(_e=0;_e<pe;++_e)ke=Ke+(Se=y[T+_e])-ke,Ke=V[z+_e]+(-256&ke?0>ke?0:255:ke)&255,ke=Se,ce[de+_e]=Ke}}function Gr(y,T,V,z){var ce=T.width,de=T.o;if(o(y!=null&&T!=null),0>V||0>=z||V+z>de)return null;if(!y.Cc){if(y.ga==null){var pe;if(y.ga=new lr,(pe=y.ga==null)||(pe=T.width*T.o,o(y.Gb.length==0),y.Gb=m(pe),y.Uc=0,y.Gb==null?pe=0:(y.mb=y.Gb,y.nb=y.Uc,y.rc=null,pe=1),pe=!pe),!pe){pe=y.ga;var _e=y.Fa,Se=y.P,ke=y.qc,Ke=y.mb,ut=y.nb,De=Se+1,Ye=ke-1,it=pe.l;if(o(_e!=null&&Ke!=null&&T!=null),fd[0]=null,fd[1]=Fr,fd[2]=sn,fd[3]=bi,pe.ca=Ke,pe.tb=ut,pe.c=T.width,pe.i=T.height,o(0<pe.c&&0<pe.i),1>=ke)T=0;else if(pe.$a=3&_e[Se+0],pe.Z=_e[Se+0]>>2&3,pe.Lc=_e[Se+0]>>4&3,Se=_e[Se+0]>>6&3,0>pe.$a||1<pe.$a||4<=pe.Z||1<pe.Lc||Se)T=0;else if(it.put=Ds,it.ac=Xi,it.bc=An,it.ma=pe,it.width=T.width,it.height=T.height,it.Da=T.Da,it.v=T.v,it.va=T.va,it.j=T.j,it.o=T.o,pe.$a)e:{o(pe.$a==1),T=id();t:for(;;){if(T==null){T=0;break e}if(o(pe!=null),pe.mc=T,T.c=pe.c,T.i=pe.i,T.l=pe.l,T.l.ma=pe,T.l.width=pe.c,T.l.height=pe.i,T.a=0,Be(T.m,_e,De,Ye),!_o(pe.c,pe.i,1,T,null)||(T.ab==1&&T.gc[0].hc==3&&wo(T.s)?(pe.ic=1,_e=T.c*T.i,T.Ta=null,T.Ua=0,T.V=m(_e),T.Ba=0,T.V==null?(T.a=1,T=0):T=1):(pe.ic=0,T=ad(T,pe.c)),!T))break t;T=1;break e}pe.mc=null,T=0}else T=Ye>=pe.c*pe.i;pe=!T}if(pe)return null;y.ga.Lc!=1?y.Ga=0:z=de-V}o(y.ga!=null),o(V+z<=de);e:{if(T=(_e=y.ga).c,de=_e.l.o,_e.$a==0){if(De=y.rc,Ye=y.Vc,it=y.Fa,Se=y.P+1+V*T,ke=y.mb,Ke=y.nb+V*T,o(Se<=y.P+y.qc),_e.Z!=0)for(o(fd[_e.Z]!=null),pe=0;pe<z;++pe)fd[_e.Z](De,Ye,it,Se,ke,Ke,T),De=ke,Ye=Ke,Ke+=T,Se+=T;else for(pe=0;pe<z;++pe)d(ke,Ke,it,Se,T),De=ke,Ye=Ke,Ke+=T,Se+=T;y.rc=De,y.Vc=Ye}else{if(o(_e.mc!=null),T=V+z,o((pe=_e.mc)!=null),o(T<=pe.i),pe.C>=T)T=1;else if(_e.ic||ec(),_e.ic){_e=pe.V,De=pe.Ba,Ye=pe.c;var wt=pe.i,At=(it=1,Se=pe.$/Ye,ke=pe.$%Ye,Ke=pe.m,ut=pe.s,pe.$),St=Ye*wt,Ot=Ye*T,Qt=ut.wc,Ft=At<Ot?Hi(ut,ke,Se):null;o(At<=St),o(T<=wt),o(wo(ut));t:for(;;){for(;!Ke.h&&At<Ot;){if(ke&Qt||(Ft=Hi(ut,ke,Se)),o(Ft!=null),Ee(Ke),256>(wt=Pn(Ft.G[0],Ft.H[0],Ke)))_e[De+At]=wt,++At,++ke>=Ye&&(ke=0,++Se<=T&&!(Se%16)&&Xo(pe,Se));else{if(!(280>wt)){it=0;break t}wt=Qi(wt-256,Ke);var Bs,xs=Pn(Ft.G[4],Ft.H[4],Ke);if(Ee(Ke),!(At>=(xs=fi(Ye,xs=Qi(xs,Ke)))&&St-At>=wt)){it=0;break t}for(Bs=0;Bs<wt;++Bs)_e[De+At+Bs]=_e[De+At+Bs-xs];for(At+=wt,ke+=wt;ke>=Ye;)ke-=Ye,++Se<=T&&!(Se%16)&&Xo(pe,Se);At<Ot&&ke&Qt&&(Ft=Hi(ut,ke,Se))}o(Ke.h==Ie(Ke))}Xo(pe,Se>T?T:Se);break t}!it||Ke.h&&At<St?(it=0,pe.a=Ke.h?5:3):pe.$=At,T=it}else T=Jo(pe,pe.V,pe.Ba,pe.c,pe.i,T,$o);if(!T){z=0;break e}}V+z>=de&&(y.Cc=1),z=1}if(!z)return null;if(y.Cc&&((z=y.ga)!=null&&(z.mc=null),y.ga=null,0<y.Ga))return alert("todo:WebPDequantizeLevels"),null}return y.nb+V*ce}function xi(y,T,V,z,ce,de){for(;0<ce--;){var pe,_e=y,Se=T+(V?1:0),ke=y,Ke=T+(V?0:3);for(pe=0;pe<z;++pe){var ut=ke[Ke+4*pe];ut!=255&&(ut*=32897,_e[Se+4*pe+0]=_e[Se+4*pe+0]*ut>>23,_e[Se+4*pe+1]=_e[Se+4*pe+1]*ut>>23,_e[Se+4*pe+2]=_e[Se+4*pe+2]*ut>>23)}T+=de}}function vi(y,T,V,z,ce){for(;0<z--;){var de;for(de=0;de<V;++de){var pe=y[T+2*de+0],_e=15&(ke=y[T+2*de+1]),Se=4369*_e,ke=(240&ke|ke>>4)*Se>>16;y[T+2*de+0]=(240&pe|pe>>4)*Se>>16&240|(15&pe|pe<<4)*Se>>16>>4&15,y[T+2*de+1]=240&ke|_e}T+=ce}}function Ts(y,T,V,z,ce,de,pe,_e){var Se,ke,Ke=255;for(ke=0;ke<ce;++ke){for(Se=0;Se<z;++Se){var ut=y[T+Se];de[pe+4*Se]=ut,Ke&=ut}T+=V,pe+=_e}return Ke!=255}function bl(y,T,V,z,ce){var de;for(de=0;de<ce;++de)V[z+de]=y[T+de]>>8}function ec(){cu=xi,Gg=vi,wx=Ts,_x=bl}function xl(y,T,V){H[y]=function(z,ce,de,pe,_e,Se,ke,Ke,ut,De,Ye,it,wt,At,St,Ot,Qt){var Ft,Bs=Qt-1>>1,xs=_e[Se+0]|ke[Ke+0]<<16,nr=ut[De+0]|Ye[it+0]<<16;o(z!=null);var _s=3*xs+nr+131074>>2;for(T(z[ce+0],255&_s,_s>>16,wt,At),de!=null&&(_s=3*nr+xs+131074>>2,T(de[pe+0],255&_s,_s>>16,St,Ot)),Ft=1;Ft<=Bs;++Ft){var Nr=_e[Se+Ft]|ke[Ke+Ft]<<16,oi=ut[De+Ft]|Ye[it+Ft]<<16,dr=xs+Nr+nr+oi+524296,ys=dr+2*(Nr+nr)>>3;_s=ys+xs>>1,xs=(dr=dr+2*(xs+oi)>>3)+Nr>>1,T(z[ce+2*Ft-1],255&_s,_s>>16,wt,At+(2*Ft-1)*V),T(z[ce+2*Ft-0],255&xs,xs>>16,wt,At+(2*Ft-0)*V),de!=null&&(_s=dr+nr>>1,xs=ys+oi>>1,T(de[pe+2*Ft-1],255&_s,_s>>16,St,Ot+(2*Ft-1)*V),T(de[pe+2*Ft+0],255&xs,xs>>16,St,Ot+(2*Ft+0)*V)),xs=Nr,nr=oi}1&Qt||(_s=3*xs+nr+131074>>2,T(z[ce+Qt-1],255&_s,_s>>16,wt,At+(Qt-1)*V),de!=null&&(_s=3*nr+xs+131074>>2,T(de[pe+Qt-1],255&_s,_s>>16,St,Ot+(Qt-1)*V)))}}function Sh(){Oo[bm]=jE,Oo[xm]=Dx,Oo[Cx]=PE,Oo[uu]=Bx,Oo[vm]=Lx,Oo[wm]=jx,Oo[Fa]=UE,Oo[Kg]=Dx,Oo[hA]=Bx,Oo[_m]=Lx,Oo[Wg]=jx}function od(y){return y&-16384?0>y?0:255:y>>FE}function cd(y,T){return od((19077*y>>8)+(26149*T>>8)-14234)}function iA(y,T,V){return od((19077*y>>8)-(6419*T>>8)-(13320*V>>8)+8708)}function aA(y,T){return od((19077*y>>8)+(33050*T>>8)-17685)}function Ic(y,T,V,z,ce){z[ce+0]=cd(y,V),z[ce+1]=iA(y,T,V),z[ce+2]=aA(y,T)}function Ji(y,T,V,z,ce){z[ce+0]=aA(y,T),z[ce+1]=iA(y,T,V),z[ce+2]=cd(y,V)}function oA(y,T,V,z,ce){var de=iA(y,T,V);T=de<<3&224|aA(y,T)>>3,z[ce+0]=248&cd(y,V)|de>>5,z[ce+1]=T}function ld(y,T,V,z,ce){var de=240&aA(y,T)|15;z[ce+0]=240&cd(y,V)|iA(y,T,V)>>4,z[ce+1]=de}function Ch(y,T,V,z,ce){z[ce+0]=255,Ic(y,T,V,z,ce+1)}function No(y,T,V,z,ce){Ji(y,T,V,z,ce),z[ce+3]=255}function ya(y,T,V,z,ce){Ic(y,T,V,z,ce),z[ce+3]=255}function vl(y,T,V){H[y]=function(z,ce,de,pe,_e,Se,ke,Ke,ut){for(var De=Ke+(-2&ut)*V;Ke!=De;)T(z[ce+0],de[pe+0],_e[Se+0],ke,Ke),T(z[ce+1],de[pe+0],_e[Se+0],ke,Ke+V),ce+=2,++pe,++Se,Ke+=2*V;1&ut&&T(z[ce+0],de[pe+0],_e[Se+0],ke,Ke)}}function au(y,T,V){return V==0?y==0?T==0?6:5:T==0?4:0:V}function Nh(y,T,V,z,ce){switch(y>>>30){case 3:uA(T,V,z,ce,0);break;case 2:Ro(T,V,z,ce);break;case 1:Yr(T,V,z,ce)}}function Ua(y,T){var V,z,ce=T.M,de=T.Nb,pe=y.oc,_e=y.pc+40,Se=y.oc,ke=y.pc+584,Ke=y.oc,ut=y.pc+600;for(V=0;16>V;++V)pe[_e+32*V-1]=129;for(V=0;8>V;++V)Se[ke+32*V-1]=129,Ke[ut+32*V-1]=129;for(0<ce?pe[_e-1-32]=Se[ke-1-32]=Ke[ut-1-32]=129:(h(pe,_e-32-1,127,21),h(Se,ke-32-1,127,9),h(Ke,ut-32-1,127,9)),z=0;z<y.za;++z){var De=T.ya[T.aa+z];if(0<z){for(V=-1;16>V;++V)d(pe,_e+32*V-4,pe,_e+32*V+12,4);for(V=-1;8>V;++V)d(Se,ke+32*V-4,Se,ke+32*V+4,4),d(Ke,ut+32*V-4,Ke,ut+32*V+4,4)}var Ye=y.Gd,it=y.Hd+z,wt=De.ad,At=De.Hc;if(0<ce&&(d(pe,_e-32,Ye[it].y,0,16),d(Se,ke-32,Ye[it].f,0,8),d(Ke,ut-32,Ye[it].ea,0,8)),De.Za){var St=pe,Ot=_e-32+16;for(0<ce&&(z>=y.za-1?h(St,Ot,Ye[it].y[15],4):d(St,Ot,Ye[it+1].y,0,4)),V=0;4>V;V++)St[Ot+128+V]=St[Ot+256+V]=St[Ot+384+V]=St[Ot+0+V];for(V=0;16>V;++V,At<<=2)St=pe,Ot=_e+Mx[V],rc[De.Ob[V]](St,Ot),Nh(At,wt,16*+V,St,Ot)}else if(St=au(z,ce,De.Ob[0]),kc[St](pe,_e),At!=0)for(V=0;16>V;++V,At<<=2)Nh(At,wt,16*+V,pe,_e+Mx[V]);for(V=De.Gc,St=au(z,ce,De.Dd),nc[St](Se,ke),nc[St](Ke,ut),At=wt,St=Se,Ot=ke,255&(De=0|V)&&(170&De?sc(At,256,St,Ot):un(At,256,St,Ot)),De=Ke,At=ut,255&(V>>=8)&&(170&V?sc(wt,320,De,At):un(wt,320,De,At)),ce<y.Ub-1&&(d(Ye[it].y,0,pe,_e+480,16),d(Ye[it].f,0,Se,ke+224,8),d(Ye[it].ea,0,Ke,ut+224,8)),V=8*de*y.B,Ye=y.sa,it=y.ta+16*z+16*de*y.R,wt=y.qa,De=y.ra+8*z+V,At=y.Ha,St=y.Ia+8*z+V,V=0;16>V;++V)d(Ye,it+V*y.R,pe,_e+32*V,16);for(V=0;8>V;++V)d(wt,De+V*y.B,Se,ke+32*V,8),d(At,St+V*y.B,Ke,ut+32*V,8)}}function cA(y,T,V,z,ce,de,pe,_e,Se){var ke=[0],Ke=[0],ut=0,De=Se!=null?Se.kd:0,Ye=Se??new Pt;if(y==null||12>V)return 7;Ye.data=y,Ye.w=T,Ye.ha=V,T=[T],V=[V],Ye.gb=[Ye.gb];e:{var it=T,wt=V,At=Ye.gb;if(o(y!=null),o(wt!=null),o(At!=null),At[0]=0,12<=wt[0]&&!c(y,it[0],"RIFF")){if(c(y,it[0]+8,"WEBP")){At=3;break e}var St=Nt(y,it[0]+4);if(12>St||4294967286<St){At=3;break e}if(De&&St>wt[0]-8){At=7;break e}At[0]=St,it[0]+=12,wt[0]-=12}At=0}if(At!=0)return At;for(St=0<Ye.gb[0],V=V[0];;){e:{var Ot=y;wt=T,At=V;var Qt=ke,Ft=Ke,Bs=it=[0];if((_s=ut=[ut])[0]=0,8>At[0])At=7;else{if(!c(Ot,wt[0],"VP8X")){if(Nt(Ot,wt[0]+4)!=10){At=3;break e}if(18>At[0]){At=7;break e}var xs=Nt(Ot,wt[0]+8),nr=1+rt(Ot,wt[0]+12);if(2147483648<=nr*(Ot=1+rt(Ot,wt[0]+15))){At=3;break e}Bs!=null&&(Bs[0]=xs),Qt!=null&&(Qt[0]=nr),Ft!=null&&(Ft[0]=Ot),wt[0]+=18,At[0]-=18,_s[0]=1}At=0}}if(ut=ut[0],it=it[0],At!=0)return At;if(wt=!!(2&it),!St&&ut)return 3;if(de!=null&&(de[0]=!!(16&it)),pe!=null&&(pe[0]=wt),_e!=null&&(_e[0]=0),pe=ke[0],it=Ke[0],ut&&wt&&Se==null){At=0;break}if(4>V){At=7;break}if(St&&ut||!St&&!ut&&!c(y,T[0],"ALPH")){V=[V],Ye.na=[Ye.na],Ye.P=[Ye.P],Ye.Sa=[Ye.Sa];e:{xs=y,At=T,St=V;var _s=Ye.gb;Qt=Ye.na,Ft=Ye.P,Bs=Ye.Sa,nr=22,o(xs!=null),o(St!=null),Ot=At[0];var Nr=St[0];for(o(Qt!=null),o(Bs!=null),Qt[0]=null,Ft[0]=null,Bs[0]=0;;){if(At[0]=Ot,St[0]=Nr,8>Nr){At=7;break e}var oi=Nt(xs,Ot+4);if(4294967286<oi){At=3;break e}var dr=8+oi+1&-2;if(nr+=dr,0<_s&&nr>_s){At=3;break e}if(!c(xs,Ot,"VP8 ")||!c(xs,Ot,"VP8L")){At=0;break e}if(Nr[0]<dr){At=7;break e}c(xs,Ot,"ALPH")||(Qt[0]=xs,Ft[0]=Ot+8,Bs[0]=oi),Ot+=dr,Nr-=dr}}if(V=V[0],Ye.na=Ye.na[0],Ye.P=Ye.P[0],Ye.Sa=Ye.Sa[0],At!=0)break}V=[V],Ye.Ja=[Ye.Ja],Ye.xa=[Ye.xa];e:if(_s=y,At=T,St=V,Qt=Ye.gb[0],Ft=Ye.Ja,Bs=Ye.xa,xs=At[0],Ot=!c(_s,xs,"VP8 "),nr=!c(_s,xs,"VP8L"),o(_s!=null),o(St!=null),o(Ft!=null),o(Bs!=null),8>St[0])At=7;else{if(Ot||nr){if(_s=Nt(_s,xs+4),12<=Qt&&_s>Qt-12){At=3;break e}if(De&&_s>St[0]-8){At=7;break e}Ft[0]=_s,At[0]+=8,St[0]-=8,Bs[0]=nr}else Bs[0]=5<=St[0]&&_s[xs+0]==47&&!(_s[xs+4]>>5),Ft[0]=St[0];At=0}if(V=V[0],Ye.Ja=Ye.Ja[0],Ye.xa=Ye.xa[0],T=T[0],At!=0)break;if(4294967286<Ye.Ja)return 3;if(_e==null||wt||(_e[0]=Ye.xa?2:1),pe=[pe],it=[it],Ye.xa){if(5>V){At=7;break}_e=pe,De=it,wt=de,y==null||5>V?y=0:5<=V&&y[T+0]==47&&!(y[T+4]>>5)?(St=[0],_s=[0],Qt=[0],Be(Ft=new ve,y,T,V),wa(Ft,St,_s,Qt)?(_e!=null&&(_e[0]=St[0]),De!=null&&(De[0]=_s[0]),wt!=null&&(wt[0]=Qt[0]),y=1):y=0):y=0}else{if(10>V){At=7;break}_e=it,y==null||10>V||!tu(y,T+3,V-3)?y=0:(De=y[T+0]|y[T+1]<<8|y[T+2]<<16,wt=16383&(y[T+7]<<8|y[T+6]),y=16383&(y[T+9]<<8|y[T+8]),1&De||3<(De>>1&7)||!(De>>4&1)||De>>5>=Ye.Ja||!wt||!y?y=0:(pe&&(pe[0]=wt),_e&&(_e[0]=y),y=1))}if(!y||(pe=pe[0],it=it[0],ut&&(ke[0]!=pe||Ke[0]!=it)))return 3;Se!=null&&(Se[0]=Ye,Se.offset=T-Se.w,o(4294967286>T-Se.w),o(Se.offset==Se.ha-V));break}return At==0||At==7&&ut&&Se==null?(de!=null&&(de[0]|=Ye.na!=null&&0<Ye.na.length),z!=null&&(z[0]=pe),ce!=null&&(ce[0]=it),0):At}function Th(y,T,V){var z=T.width,ce=T.height,de=0,pe=0,_e=z,Se=ce;if(T.Da=y!=null&&0<y.Da,T.Da&&(_e=y.cd,Se=y.bd,de=y.v,pe=y.j,11>V||(de&=-2,pe&=-2),0>de||0>pe||0>=_e||0>=Se||de+_e>z||pe+Se>ce))return 0;if(T.v=de,T.j=pe,T.va=de+_e,T.o=pe+Se,T.U=_e,T.T=Se,T.da=y!=null&&0<y.da,T.da){if(!et(_e,Se,V=[y.ib],de=[y.hb]))return 0;T.ib=V[0],T.hb=de[0]}return T.ob=y!=null&&y.ob,T.Kb=y==null||!y.Sd,T.da&&(T.ob=T.ib<3*z/4&&T.hb<3*ce/4,T.Kb=0),1}function Rh(y){if(y==null)return 2;if(11>y.S){var T=y.f.RGBA;T.fb+=(y.height-1)*T.A,T.A=-T.A}else T=y.f.kb,y=y.height,T.O+=(y-1)*T.fa,T.fa=-T.fa,T.N+=(y-1>>1)*T.Ab,T.Ab=-T.Ab,T.W+=(y-1>>1)*T.Db,T.Db=-T.Db,T.F!=null&&(T.J+=(y-1)*T.lb,T.lb=-T.lb);return 0}function wi(y,T,V,z){if(z==null||0>=y||0>=T)return 2;if(V!=null){if(V.Da){var ce=V.cd,de=V.bd,pe=-2&V.v,_e=-2&V.j;if(0>pe||0>_e||0>=ce||0>=de||pe+ce>y||_e+de>T)return 2;y=ce,T=de}if(V.da){if(!et(y,T,ce=[V.ib],de=[V.hb]))return 2;y=ce[0],T=de[0]}}z.width=y,z.height=T;e:{var Se=z.width,ke=z.height;if(y=z.S,0>=Se||0>=ke||!(y>=bm&&13>y))y=2;else{if(0>=z.Rd&&z.sd==null){pe=de=ce=T=0;var Ke=(_e=Se*Vx[y])*ke;if(11>y||(de=(ke+1)/2*(T=(Se+1)/2),y==12&&(pe=(ce=Se)*ke)),(ke=m(Ke+2*de+pe))==null){y=1;break e}z.sd=ke,11>y?((Se=z.f.RGBA).eb=ke,Se.fb=0,Se.A=_e,Se.size=Ke):((Se=z.f.kb).y=ke,Se.O=0,Se.fa=_e,Se.Fd=Ke,Se.f=ke,Se.N=0+Ke,Se.Ab=T,Se.Cd=de,Se.ea=ke,Se.W=0+Ke+de,Se.Db=T,Se.Ed=de,y==12&&(Se.F=ke,Se.J=0+Ke+2*de),Se.Tc=pe,Se.lb=ce)}if(T=1,ce=z.S,de=z.width,pe=z.height,ce>=bm&&13>ce)if(11>ce)y=z.f.RGBA,T&=(_e=Math.abs(y.A))*(pe-1)+de<=y.size,T&=_e>=de*Vx[ce],T&=y.eb!=null;else{y=z.f.kb,_e=(de+1)/2,Ke=(pe+1)/2,Se=Math.abs(y.fa),ke=Math.abs(y.Ab);var ut=Math.abs(y.Db),De=Math.abs(y.lb),Ye=De*(pe-1)+de;T&=Se*(pe-1)+de<=y.Fd,T&=ke*(Ke-1)+_e<=y.Cd,T=(T&=ut*(Ke-1)+_e<=y.Ed)&Se>=de&ke>=_e&ut>=_e,T&=y.y!=null,T&=y.f!=null,T&=y.ea!=null,ce==12&&(T&=De>=de,T&=Ye<=y.Tc,T&=y.F!=null)}else T=0;y=T?0:2}}return y!=0||V!=null&&V.fd&&(y=Rh(z)),y}var lA=64,no=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],io=24,dd=32,tc=8,Ad=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];qt("Predictor0","PredictorAdd0"),H.Predictor0=function(){return 4278190080},H.Predictor1=function(y){return y},H.Predictor2=function(y,T,V){return T[V+0]},H.Predictor3=function(y,T,V){return T[V+1]},H.Predictor4=function(y,T,V){return T[V-1]},H.Predictor5=function(y,T,V){return ht(ht(y,T[V+1]),T[V+0])},H.Predictor6=function(y,T,V){return ht(y,T[V-1])},H.Predictor7=function(y,T,V){return ht(y,T[V+0])},H.Predictor8=function(y,T,V){return ht(T[V-1],T[V+0])},H.Predictor9=function(y,T,V){return ht(T[V+0],T[V+1])},H.Predictor10=function(y,T,V){return ht(ht(y,T[V-1]),ht(T[V+0],T[V+1]))},H.Predictor11=function(y,T,V){var z=T[V+0];return 0>=ss(z>>24&255,y>>24&255,(T=T[V-1])>>24&255)+ss(z>>16&255,y>>16&255,T>>16&255)+ss(z>>8&255,y>>8&255,T>>8&255)+ss(255&z,255&y,255&T)?z:y},H.Predictor12=function(y,T,V){var z=T[V+0];return(dt((y>>24&255)+(z>>24&255)-((T=T[V-1])>>24&255))<<24|dt((y>>16&255)+(z>>16&255)-(T>>16&255))<<16|dt((y>>8&255)+(z>>8&255)-(T>>8&255))<<8|dt((255&y)+(255&z)-(255&T)))>>>0},H.Predictor13=function(y,T,V){var z=T[V-1];return(Dt((y=ht(y,T[V+0]))>>24&255,z>>24&255)<<24|Dt(y>>16&255,z>>16&255)<<16|Dt(y>>8&255,z>>8&255)<<8|Dt(255&y,255&z))>>>0};var Ih=H.PredictorAdd0;H.PredictorAdd1=$t,qt("Predictor2","PredictorAdd2"),qt("Predictor3","PredictorAdd3"),qt("Predictor4","PredictorAdd4"),qt("Predictor5","PredictorAdd5"),qt("Predictor6","PredictorAdd6"),qt("Predictor7","PredictorAdd7"),qt("Predictor8","PredictorAdd8"),qt("Predictor9","PredictorAdd9"),qt("Predictor10","PredictorAdd10"),qt("Predictor11","PredictorAdd11"),qt("Predictor12","PredictorAdd12"),qt("Predictor13","PredictorAdd13");var dA=H.PredictorAdd2;es("ColorIndexInverseTransform","MapARGB","32b",function(y){return y>>8&255},function(y){return y}),es("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(y){return y},function(y){return y>>8&255});var Fn,gm=H.ColorIndexInverseTransform,Oc=H.MapARGB,ao=H.VP8LColorIndexInverseTransformAlpha,Oh=H.MapAlpha,kh=H.VP8LPredictorsAdd=[];kh.length=16,(H.VP8LPredictors=[]).length=16,(H.VP8LPredictorsAdd_C=[]).length=16,(H.VP8LPredictors_C=[]).length=16;var Dh,To,ud,hd,qn,AA,pd,uA,Ro,sc,Yr,un,ai,_i,wl,Bh,md,ou,fx,nt,gx,bx,xx,vx,cu,Gg,wx,_x,yx=m(511),Lh=m(2041),lu=m(225),Ex=m(767),Sx=0,du=Lh,Au=lu,ca=Ex,Io=yx,bm=0,xm=1,Cx=2,uu=3,vm=4,wm=5,Fa=6,Kg=7,hA=8,_m=9,Wg=10,NE=[2,3,7],Nx=[3,3,11],Tx=[280,256,256,256,40],TE=[0,1,1,1,0],RE=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],zg=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],IE=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Rx=8,ym=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],qg=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],hu=null,Em=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],OE=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Ix=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],kE=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],DE=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],BE=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Ox=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],kc=[],rc=[],nc=[],LE=1,kx=2,fd=[],Oo=[];xl("UpsampleRgbLinePair",Ic,3),xl("UpsampleBgrLinePair",Ji,3),xl("UpsampleRgbaLinePair",ya,4),xl("UpsampleBgraLinePair",No,4),xl("UpsampleArgbLinePair",Ch,4),xl("UpsampleRgba4444LinePair",ld,2),xl("UpsampleRgb565LinePair",oA,2);var jE=H.UpsampleRgbLinePair,PE=H.UpsampleBgrLinePair,Dx=H.UpsampleRgbaLinePair,Bx=H.UpsampleBgraLinePair,Lx=H.UpsampleArgbLinePair,jx=H.UpsampleRgba4444LinePair,UE=H.UpsampleRgb565LinePair,pA=16,mA=1<<pA-1,fA=-227,Yg=482,FE=6,Px=0,Ux=m(256),Fx=m(256),Xg=m(256),ME=m(256),VE=m(Yg-fA),jh=m(Yg-fA);vl("YuvToRgbRow",Ic,3),vl("YuvToBgrRow",Ji,3),vl("YuvToRgbaRow",ya,4),vl("YuvToBgraRow",No,4),vl("YuvToArgbRow",Ch,4),vl("YuvToRgba4444Row",ld,2),vl("YuvToRgb565Row",oA,2);var Mx=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Sm=[0,2,8],QE=[8,7,6,4,4,2,2,2,1,1,1,1],HE=1;this.WebPDecodeRGBA=function(y,T,V,z,ce){var de=xm,pe=new yt,_e=new Is;pe.ba=_e,_e.S=de,_e.width=[_e.width],_e.height=[_e.height];var Se=_e.width,ke=_e.height,Ke=new ms;if(Ke==null||y==null)var ut=2;else o(Ke!=null),ut=cA(y,T,V,Ke.width,Ke.height,Ke.Pd,Ke.Qd,Ke.format,null);if(ut!=0?Se=0:(Se!=null&&(Se[0]=Ke.width[0]),ke!=null&&(ke[0]=Ke.height[0]),Se=1),Se){_e.width=_e.width[0],_e.height=_e.height[0],z!=null&&(z[0]=_e.width),ce!=null&&(ce[0]=_e.height);e:{if(z=new eu,(ce=new Pt).data=y,ce.w=T,ce.ha=V,ce.kd=1,T=[0],o(ce!=null),((y=cA(ce.data,ce.w,ce.ha,null,null,null,T,null,ce))==0||y==7)&&T[0]&&(y=4),(T=y)==0){if(o(pe!=null),z.data=ce.data,z.w=ce.w+ce.offset,z.ha=ce.ha-ce.offset,z.put=Ds,z.ac=Xi,z.bc=An,z.ma=pe,ce.xa){if((y=id())==null){pe=1;break e}if(function(De,Ye){var it=[0],wt=[0],At=[0];t:for(;;){if(De==null)return 0;if(Ye==null)return De.a=2,0;if(De.l=Ye,De.a=0,Be(De.m,Ye.data,Ye.w,Ye.ha),!wa(De.m,it,wt,At)){De.a=3;break t}if(De.xb=kx,Ye.width=it[0],Ye.height=wt[0],!_o(it[0],wt[0],1,De,null))break t;return 1}return o(De.a!=0),0}(y,z)){if(z=(T=wi(z.width,z.height,pe.Oa,pe.ba))==0){t:{z=y;s:for(;;){if(z==null){z=0;break t}if(o(z.s.yc!=null),o(z.s.Ya!=null),o(0<z.s.Wb),o((V=z.l)!=null),o((ce=V.ma)!=null),z.xb!=0){if(z.ca=ce.ba,z.tb=ce.tb,o(z.ca!=null),!Th(ce.Oa,V,uu)){z.a=2;break s}if(!ad(z,V.width)||V.da)break s;if((V.da||jt(z.ca.S))&&ec(),11>z.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),z.ca.f.kb.F!=null&&ec()),z.Pb&&0<z.s.ua&&z.s.vb.X==null&&!we(z.s.vb,z.s.Wa.Xa)){z.a=1;break s}z.xb=0}if(!Jo(z,z.V,z.Ba,z.c,z.i,V.o,Al))break s;ce.Dc=z.Ma,z=1;break t}o(z.a!=0),z=0}z=!z}z&&(T=y.a)}else T=y.a}else{if((y=new Dg)==null){pe=1;break e}if(y.Fa=ce.na,y.P=ce.P,y.qc=ce.Sa,Cc(y,z)){if((T=wi(z.width,z.height,pe.Oa,pe.ba))==0){if(y.Aa=0,V=pe.Oa,o((ce=y)!=null),V!=null){if(0<(Se=0>(Se=V.Md)?0:100<Se?255:255*Se/100)){for(ke=Ke=0;4>ke;++ke)12>(ut=ce.pb[ke]).lc&&(ut.ia=Se*QE[0>ut.lc?0:ut.lc]>>3),Ke|=ut.ia;Ke&&(alert("todo:VP8InitRandom"),ce.ia=1)}ce.Ga=V.Id,100<ce.Ga?ce.Ga=100:0>ce.Ga&&(ce.Ga=0)}(function(De,Ye){if(De==null)return 0;if(Ye==null)return Sn(De,2,"NULL VP8Io parameter in VP8Decode().");if(!De.cb&&!Cc(De,Ye))return 0;if(o(De.cb),Ye.ac==null||Ye.ac(Ye)){Ye.ob&&(De.L=0);var it=Sm[De.L];if(De.L==2?(De.yb=0,De.zb=0):(De.yb=Ye.v-it>>4,De.zb=Ye.j-it>>4,0>De.yb&&(De.yb=0),0>De.zb&&(De.zb=0)),De.Va=Ye.o+15+it>>4,De.Hb=Ye.va+15+it>>4,De.Hb>De.za&&(De.Hb=De.za),De.Va>De.Ub&&(De.Va=De.Ub),0<De.L){var wt=De.ed;for(it=0;4>it;++it){var At;if(De.Qa.Cb){var St=De.Qa.Lb[it];De.Qa.Fb||(St+=wt.Tb)}else St=wt.Tb;for(At=0;1>=At;++At){var Ot=De.gd[it][At],Qt=St;if(wt.Pc&&(Qt+=wt.vd[0],At&&(Qt+=wt.od[0])),0<(Qt=0>Qt?0:63<Qt?63:Qt)){var Ft=Qt;0<wt.wb&&(Ft=4<wt.wb?Ft>>2:Ft>>1)>9-wt.wb&&(Ft=9-wt.wb),1>Ft&&(Ft=1),Ot.dd=Ft,Ot.tc=2*Qt+Ft,Ot.ld=40<=Qt?2:15<=Qt?1:0}else Ot.tc=0;Ot.La=At}}}it=0}else Sn(De,6,"Frame setup failed"),it=De.a;if(it=it==0){if(it){De.$c=0,0<De.Aa||(De.Ic=HE);t:{it=De.Ic,wt=4*(Ft=De.za);var Bs=32*Ft,xs=Ft+1,nr=0<De.L?Ft*(0<De.Aa?2:1):0,_s=(De.Aa==2?2:1)*Ft;if((Ot=wt+832+(At=3*(16*it+Sm[De.L])/2*Bs)+(St=De.Fa!=null&&0<De.Fa.length?De.Kc.c*De.Kc.i:0))!=Ot)it=0;else{if(Ot>De.Vb){if(De.Vb=0,De.Ec=m(Ot),De.Fc=0,De.Ec==null){it=Sn(De,1,"no memory during frame initialization.");break t}De.Vb=Ot}Ot=De.Ec,Qt=De.Fc,De.Ac=Ot,De.Bc=Qt,Qt+=wt,De.Gd=g(Bs,am),De.Hd=0,De.rb=g(xs+1,mh),De.sb=1,De.wa=nr?g(nr,Eo):null,De.Y=0,De.D.Nb=0,De.D.wa=De.wa,De.D.Y=De.Y,0<De.Aa&&(De.D.Y+=Ft),o(!0),De.oc=Ot,De.pc=Qt,Qt+=832,De.ya=g(_s,fh),De.aa=0,De.D.ya=De.ya,De.D.aa=De.aa,De.Aa==2&&(De.D.aa+=Ft),De.R=16*Ft,De.B=8*Ft,Ft=(Bs=Sm[De.L])*De.R,Bs=Bs/2*De.B,De.sa=Ot,De.ta=Qt+Ft,De.qa=De.sa,De.ra=De.ta+16*it*De.R+Bs,De.Ha=De.qa,De.Ia=De.ra+8*it*De.B+Bs,De.$c=0,Qt+=At,De.mb=St?Ot:null,De.nb=St?Qt:null,o(Qt+St<=De.Fc+De.Vb),om(De),h(De.Ac,De.Bc,0,wt),it=1}}if(it){if(Ye.ka=0,Ye.y=De.sa,Ye.O=De.ta,Ye.f=De.qa,Ye.N=De.ra,Ye.ea=De.Ha,Ye.Vd=De.Ia,Ye.fa=De.R,Ye.Rc=De.B,Ye.F=null,Ye.J=0,!Sx){for(it=-255;255>=it;++it)yx[255+it]=0>it?-it:it;for(it=-1020;1020>=it;++it)Lh[1020+it]=-128>it?-128:127<it?127:it;for(it=-112;112>=it;++it)lu[112+it]=-16>it?-16:15<it?15:it;for(it=-255;510>=it;++it)Ex[255+it]=0>it?0:255<it?255:it;Sx=1}pd=tA,uA=Lg,sc=Nc,Yr=lm,un=su,Ro=Bg,ai=mm,_i=gl,wl=ae,Bh=Oe,md=fm,ou=L,fx=Ve,nt=tt,gx=ii,bx=Eh,xx=hm,vx=pm,rc[0]=Vg,rc[1]=jg,rc[2]=Mg,rc[3]=Am,rc[4]=pl,rc[5]=rA,rc[6]=ml,rc[7]=Qg,rc[8]=vh,rc[9]=nu,kc[0]=Ug,kc[1]=Pg,kc[2]=ru,kc[3]=dm,kc[4]=sA,kc[5]=xh,kc[6]=Fg,nc[0]=Hg,nc[1]=bh,nc[2]=nA,nc[3]=um,nc[4]=So,nc[5]=wh,nc[6]=_a,it=1}else it=0}it&&(it=function(Nr,oi){for(Nr.M=0;Nr.M<Nr.Va;++Nr.M){var dr,ys=Nr.Jc[Nr.M&Nr.Xb],ts=Nr.m,Cn=Nr;for(dr=0;dr<Cn.za;++dr){var ir=ts,Lr=Cn,xn=Lr.Ac,$i=Lr.Bc+4*dr,Ea=Lr.zc,Mn=Lr.ya[Lr.aa+dr];if(Lr.Qa.Bb?Mn.$b=st(ir,Lr.Pa.jb[0])?2+st(ir,Lr.Pa.jb[2]):st(ir,Lr.Pa.jb[1]):Mn.$b=0,Lr.kc&&(Mn.Ad=st(ir,Lr.Bd)),Mn.Za=!st(ir,145)+0,Mn.Za){var la=Mn.Ob,Sa=0;for(Lr=0;4>Lr;++Lr){var Ii,Mr=Ea[0+Lr];for(Ii=0;4>Ii;++Ii){Mr=DE[xn[$i+Ii]][Mr];for(var Zr=Ix[st(ir,Mr[0])];0<Zr;)Zr=Ix[2*Zr+st(ir,Mr[Zr])];Mr=-Zr,xn[$i+Ii]=Mr}d(la,Sa,xn,$i,4),Sa+=4,Ea[0+Lr]=Mr}}else Mr=st(ir,156)?st(ir,128)?1:3:st(ir,163)?2:0,Mn.Ob[0]=Mr,h(xn,$i,Mr,4),h(Ea,0,Mr,4);Mn.Dd=st(ir,142)?st(ir,114)?st(ir,183)?1:3:2:0}if(Cn.m.Ka)return Sn(Nr,7,"Premature end-of-partition0 encountered.");for(;Nr.ja<Nr.za;++Nr.ja){if(Cn=ys,ir=(ts=Nr).rb[ts.sb-1],xn=ts.rb[ts.sb+ts.ja],dr=ts.ya[ts.aa+ts.ja],$i=ts.kc?dr.Ad:0)ir.la=xn.la=0,dr.Za||(ir.Na=xn.Na=0),dr.Hc=0,dr.Gc=0,dr.ia=0;else{var Yn,Xr;if(ir=xn,xn=Cn,$i=ts.Pa.Xc,Ea=ts.ya[ts.aa+ts.ja],Mn=ts.pb[Ea.$b],Lr=Ea.ad,la=0,Sa=ts.rb[ts.sb-1],Mr=Ii=0,h(Lr,la,0,384),Ea.Za)var Xn=0,ic=$i[3];else{Zr=m(16);var ci=ir.Na+Sa.Na;if(ci=hu(xn,$i[1],ci,Mn.Eb,0,Zr,0),ir.Na=Sa.Na=(0<ci)+0,1<ci)pd(Zr,0,Lr,la);else{var Ma=Zr[0]+3>>3;for(Zr=0;256>Zr;Zr+=16)Lr[la+Zr]=Ma}Xn=1,ic=$i[0]}var rn=15&ir.la,Oi=15&Sa.la;for(Zr=0;4>Zr;++Zr){var Va=1&Oi;for(Ma=Xr=0;4>Ma;++Ma)rn=rn>>1|(Va=(ci=hu(xn,ic,ci=Va+(1&rn),Mn.Sc,Xn,Lr,la))>Xn)<<7,Xr=Xr<<2|(3<ci?3:1<ci?2:Lr[la+0]!=0),la+=16;rn>>=4,Oi=Oi>>1|Va<<7,Ii=(Ii<<8|Xr)>>>0}for(ic=rn,Xn=Oi>>4,Yn=0;4>Yn;Yn+=2){for(Xr=0,rn=ir.la>>4+Yn,Oi=Sa.la>>4+Yn,Zr=0;2>Zr;++Zr){for(Va=1&Oi,Ma=0;2>Ma;++Ma)ci=Va+(1&rn),rn=rn>>1|(Va=0<(ci=hu(xn,$i[2],ci,Mn.Qc,0,Lr,la)))<<3,Xr=Xr<<2|(3<ci?3:1<ci?2:Lr[la+0]!=0),la+=16;rn>>=2,Oi=Oi>>1|Va<<5}Mr|=Xr<<4*Yn,ic|=rn<<4<<Yn,Xn|=(240&Oi)<<Yn}ir.la=ic,Sa.la=Xn,Ea.Hc=Ii,Ea.Gc=Mr,Ea.ia=43690&Mr?0:Mn.ia,$i=!(Ii|Mr)}if(0<ts.L&&(ts.wa[ts.Y+ts.ja]=ts.gd[dr.$b][dr.Za],ts.wa[ts.Y+ts.ja].La|=!$i),Cn.Ka)return Sn(Nr,7,"Premature end-of-file encountered.")}if(om(Nr),ts=oi,Cn=1,dr=(ys=Nr).D,ir=0<ys.L&&ys.M>=ys.zb&&ys.M<=ys.Va,ys.Aa==0)t:{if(dr.M=ys.M,dr.uc=ir,Ua(ys,dr),Cn=1,dr=(Xr=ys.D).Nb,ir=(Mr=Sm[ys.L])*ys.R,xn=Mr/2*ys.B,Zr=16*dr*ys.R,Ma=8*dr*ys.B,$i=ys.sa,Ea=ys.ta-ir+Zr,Mn=ys.qa,Lr=ys.ra-xn+Ma,la=ys.Ha,Sa=ys.Ia-xn+Ma,Oi=(rn=Xr.M)==0,Ii=rn>=ys.Va-1,ys.Aa==2&&Ua(ys,Xr),Xr.uc)for(Va=(ci=ys).D.M,o(ci.D.uc),Xr=ci.yb;Xr<ci.Hb;++Xr){Xn=Xr,ic=Va;var Ca=(oo=(ki=ci).D).Nb;Yn=ki.R;var oo=oo.wa[oo.Y+Xn],co=ki.sa,Zi=ki.ta+16*Ca*Yn+16*Xn,lo=oo.dd,vn=oo.tc;if(vn!=0)if(o(3<=vn),ki.L==1)0<Xn&&bx(co,Zi,Yn,vn+4),oo.La&&vx(co,Zi,Yn,vn),0<ic&&gx(co,Zi,Yn,vn+4),oo.La&&xx(co,Zi,Yn,vn);else{var Ao=ki.B,ac=ki.qa,gA=ki.ra+8*Ca*Ao+8*Xn,_l=ki.Ha,ki=ki.Ia+8*Ca*Ao+8*Xn;Ca=oo.ld,0<Xn&&(_i(co,Zi,Yn,vn+4,lo,Ca),Bh(ac,gA,_l,ki,Ao,vn+4,lo,Ca)),oo.La&&(ou(co,Zi,Yn,vn,lo,Ca),nt(ac,gA,_l,ki,Ao,vn,lo,Ca)),0<ic&&(ai(co,Zi,Yn,vn+4,lo,Ca),wl(ac,gA,_l,ki,Ao,vn+4,lo,Ca)),oo.La&&(md(co,Zi,Yn,vn,lo,Ca),fx(ac,gA,_l,ki,Ao,vn,lo,Ca))}}if(ys.ia&&alert("todo:DitherRow"),ts.put!=null){if(Xr=16*rn,rn=16*(rn+1),Oi?(ts.y=ys.sa,ts.O=ys.ta+Zr,ts.f=ys.qa,ts.N=ys.ra+Ma,ts.ea=ys.Ha,ts.W=ys.Ia+Ma):(Xr-=Mr,ts.y=$i,ts.O=Ea,ts.f=Mn,ts.N=Lr,ts.ea=la,ts.W=Sa),Ii||(rn-=Mr),rn>ts.o&&(rn=ts.o),ts.F=null,ts.J=null,ys.Fa!=null&&0<ys.Fa.length&&Xr<rn&&(ts.J=Gr(ys,ts,Xr,rn-Xr),ts.F=ys.mb,ts.F==null&&ts.F.length==0)){Cn=Sn(ys,3,"Could not decode alpha data.");break t}Xr<ts.j&&(Mr=ts.j-Xr,Xr=ts.j,o(!(1&Mr)),ts.O+=ys.R*Mr,ts.N+=ys.B*(Mr>>1),ts.W+=ys.B*(Mr>>1),ts.F!=null&&(ts.J+=ts.width*Mr)),Xr<rn&&(ts.O+=ts.v,ts.N+=ts.v>>1,ts.W+=ts.v>>1,ts.F!=null&&(ts.J+=ts.v),ts.ka=Xr-ts.j,ts.U=ts.va-ts.v,ts.T=rn-Xr,Cn=ts.put(ts))}dr+1!=ys.Ic||Ii||(d(ys.sa,ys.ta-ir,$i,Ea+16*ys.R,ir),d(ys.qa,ys.ra-xn,Mn,Lr+8*ys.B,xn),d(ys.Ha,ys.Ia-xn,la,Sa+8*ys.B,xn))}if(!Cn)return Sn(Nr,6,"Output aborted.")}return 1}(De,Ye)),Ye.bc!=null&&Ye.bc(Ye),it&=1}return it?(De.cb=0,it):0})(y,z)||(T=y.a)}}else T=y.a}T==0&&pe.Oa!=null&&pe.Oa.fd&&(T=Rh(pe.ba))}pe=T}de=pe!=0?null:11>de?_e.f.RGBA.eb:_e.f.kb.y}else de=null;return de};var Vx=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function E(H,Ae){for(var J="",Y=0;Y<4;Y++)J+=String.fromCharCode(H[Ae++]);return J}function S(H,Ae){return H[Ae+0]|H[Ae+1]<<8}function I(H,Ae){return(H[Ae+0]|H[Ae+1]<<8|H[Ae+2]<<16)>>>0}function k(H,Ae){return(H[Ae+0]|H[Ae+1]<<8|H[Ae+2]<<16|H[Ae+3]<<24)>>>0}new v;var R=[0],O=[0],F=[],M=new v,Q=a,Z=function(H,Ae){var J={},Y=0,se=!1,oe=0,Te=0;if(J.frames=[],!function(re,ve){for(var fe=0;fe<4;fe++)if(re[ve+fe]!="RIFF".charCodeAt(fe))return!0;return!1}(H,Ae)){for(k(H,Ae+=4),Ae+=8;Ae<H.length;){var he=E(H,Ae),Ce=k(H,Ae+=4);Ae+=4;var ee=Ce+(1&Ce);switch(he){case"VP8 ":case"VP8L":J.frames[Y]===void 0&&(J.frames[Y]={}),(Ue=J.frames[Y]).src_off=se?Te:Ae-8,Ue.src_size=oe+Ce+8,Y++,se&&(se=!1,oe=0,Te=0);break;case"VP8X":(Ue=J.header={}).feature_flags=H[Ae];var Be=Ae+4;Ue.canvas_width=1+I(H,Be),Be+=3,Ue.canvas_height=1+I(H,Be),Be+=3;break;case"ALPH":se=!0,oe=ee+8,Te=Ae-8;break;case"ANIM":(Ue=J.header).bgcolor=k(H,Ae),Be=Ae+4,Ue.loop_count=S(H,Be),Be+=2;break;case"ANMF":var He,Ue;(Ue=J.frames[Y]={}).offset_x=2*I(H,Ae),Ae+=3,Ue.offset_y=2*I(H,Ae),Ae+=3,Ue.width=1+I(H,Ae),Ae+=3,Ue.height=1+I(H,Ae),Ae+=3,Ue.duration=I(H,Ae),Ae+=3,He=H[Ae++],Ue.dispose=1&He,Ue.blend=He>>1&1}he!="ANMF"&&(Ae+=ee)}return J}}(Q,0);Z.response=Q,Z.rgbaoutput=!0,Z.dataurl=!1;var $=Z.header?Z.header:null,X=Z.frames?Z.frames:null;if($){$.loop_counter=$.loop_count,R=[$.canvas_height],O=[$.canvas_width];for(var be=0;be<X.length&&X[be].blend!=0;be++);}var me=X[0],Ne=M.WebPDecodeRGBA(Q,me.src_off,me.src_size,O,R);me.rgba=Ne,me.imgwidth=O[0],me.imgheight=R[0];for(var le=0;le<O[0]*R[0]*4;le++)F[le]=Ne[le];return this.width=O,this.height=R,this.data=F,this}/** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */function Kge(){var a,o=this.internal.__metadata__.metadata,c=unescape(encodeURIComponent(o));a=this.internal.__metadata__.rawXml?c:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+a.length+" >>"),this.internal.write("stream"),this.internal.write(a),this.internal.write("endstream"),this.internal.write("endobj")}function Wge(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}(function(a){var o,c,d,h,m,g,x,v,E,S=function(re){return re=re||{},this.isStrokeTransparent=re.isStrokeTransparent||!1,this.strokeOpacity=re.strokeOpacity||1,this.strokeStyle=re.strokeStyle||"#000000",this.fillStyle=re.fillStyle||"#000000",this.isFillTransparent=re.isFillTransparent||!1,this.fillOpacity=re.fillOpacity||1,this.font=re.font||"10px sans-serif",this.textBaseline=re.textBaseline||"alphabetic",this.textAlign=re.textAlign||"left",this.lineWidth=re.lineWidth||1,this.lineJoin=re.lineJoin||"miter",this.lineCap=re.lineCap||"butt",this.path=re.path||[],this.transform=re.transform!==void 0?re.transform.clone():new v,this.globalCompositeOperation=re.globalCompositeOperation||"normal",this.globalAlpha=re.globalAlpha||1,this.clip_path=re.clip_path||[],this.currentPoint=re.currentPoint||new g,this.miterLimit=re.miterLimit||10,this.lastPoint=re.lastPoint||new g,this.lineDashOffset=re.lineDashOffset||0,this.lineDash=re.lineDash||[],this.margin=re.margin||[0,0,0,0],this.prevPageLastElemOffset=re.prevPageLastElemOffset||0,this.ignoreClearRect=typeof re.ignoreClearRect!="boolean"||re.ignoreClearRect,this};a.events.push(["initialized",function(){this.context2d=new I(this),o=this.internal.f2,c=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString,h=this.internal.getHorizontalCoordinate,m=this.internal.getVerticalCoordinate,g=this.internal.Point,x=this.internal.Rectangle,v=this.internal.Matrix,E=new S}]);var I=function(re){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var ve=re;Object.defineProperty(this,"pdf",{get:function(){return ve}});var fe=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return fe},set:function(we){fe=!!we}});var Ie=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Ie},set:function(we){Ie=!!we}});var je=0;Object.defineProperty(this,"posX",{get:function(){return je},set:function(we){isNaN(we)||(je=we)}});var Ee=0;Object.defineProperty(this,"posY",{get:function(){return Ee},set:function(we){isNaN(we)||(Ee=we)}}),Object.defineProperty(this,"margin",{get:function(){return E.margin},set:function(we){var Rt;typeof we=="number"?Rt=[we,we,we,we]:((Rt=new Array(4))[0]=we[0],Rt[1]=we.length>=2?we[1]:Rt[0],Rt[2]=we.length>=3?we[2]:Rt[0],Rt[3]=we.length>=4?we[3]:Rt[1]),E.margin=Rt}});var We=!1;Object.defineProperty(this,"autoPaging",{get:function(){return We},set:function(we){We=we}});var ze=0;Object.defineProperty(this,"lastBreak",{get:function(){return ze},set:function(we){ze=we}});var st=[];Object.defineProperty(this,"pageBreaks",{get:function(){return st},set:function(we){st=we}}),Object.defineProperty(this,"ctx",{get:function(){return E},set:function(we){we instanceof S&&(E=we)}}),Object.defineProperty(this,"path",{get:function(){return E.path},set:function(we){E.path=we}});var bt=[];Object.defineProperty(this,"ctxStack",{get:function(){return bt},set:function(we){bt=we}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(we){var Rt;Rt=k(we),this.ctx.fillStyle=Rt.style,this.ctx.isFillTransparent=Rt.a===0,this.ctx.fillOpacity=Rt.a,this.pdf.setFillColor(Rt.r,Rt.g,Rt.b,{a:Rt.a}),this.pdf.setTextColor(Rt.r,Rt.g,Rt.b,{a:Rt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(we){var Rt=k(we);this.ctx.strokeStyle=Rt.style,this.ctx.isStrokeTransparent=Rt.a===0,this.ctx.strokeOpacity=Rt.a,Rt.a===0?this.pdf.setDrawColor(255,255,255):(Rt.a,this.pdf.setDrawColor(Rt.r,Rt.g,Rt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(we){["butt","round","square"].indexOf(we)!==-1&&(this.ctx.lineCap=we,this.pdf.setLineCap(we))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(we){isNaN(we)||(this.ctx.lineWidth=we,this.pdf.setLineWidth(we))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(we){["bevel","round","miter"].indexOf(we)!==-1&&(this.ctx.lineJoin=we,this.pdf.setLineJoin(we))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(we){isNaN(we)||(this.ctx.miterLimit=we,this.pdf.setMiterLimit(we))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(we){this.ctx.textBaseline=we}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(we){["right","end","center","left","start"].indexOf(we)!==-1&&(this.ctx.textAlign=we)}});var Qe=null,rt=null,Nt=null;Object.defineProperty(this,"fontFaces",{get:function(){return Nt},set:function(we){Qe=null,rt=null,Nt=we}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(we){var Rt;if(this.ctx.font=we,(Rt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(we))!==null){var Fe=Rt[1];Rt[2];var et=Rt[3],$e=Rt[4];Rt[5];var Kt=Rt[6],qt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec($e)[2];$e=Math.floor(qt==="px"?parseFloat($e)*this.pdf.internal.scaleFactor:qt==="em"?parseFloat($e)*this.pdf.getFontSize():parseFloat($e)*this.pdf.internal.scaleFactor),this.pdf.setFontSize($e);var Xe=function(es){var Zs,pt,Ut=[],zt=es.trim();if(zt==="")return UT;if(zt in LV)return[LV[zt]];for(;zt!=="";){switch(pt=null,Zs=(zt=PV(zt)).charAt(0)){case'"':case"'":pt=Fge(zt.substring(1),Zs);break;default:pt=Mge(zt)}if(pt===null||(Ut.push(pt[0]),(zt=PV(pt[1]))!==""&&zt.charAt(0)!==","))return UT;zt=zt.replace(/^,/,"")}return Ut}(Kt);if(this.fontFaces){var ht=function(es,Zs){var pt=es.getFontList(),Ut=JSON.stringify(pt);if(Qe===null||rt!==Ut){var zt=function(rs){var Ht=[];return Object.keys(rs).forEach(function(vt){rs[vt].forEach(function(jt){var ps=null;switch(jt){case"bold":ps={family:vt,weight:"bold"};break;case"italic":ps={family:vt,style:"italic"};break;case"bolditalic":ps={family:vt,weight:"bold",style:"italic"};break;case"":case"normal":ps={family:vt}}ps!==null&&(ps.ref={name:vt,style:jt},Ht.push(ps))})}),Ht}(pt);Qe=function(rs){for(var Ht={},vt=0;vt<rs.length;++vt){var jt=PT(rs[vt]),ps=jt.family,Qs=jt.stretch,Is=jt.style,ms=jt.weight;Ht[ps]=Ht[ps]||{},Ht[ps][Qs]=Ht[ps][Qs]||{},Ht[ps][Qs][Is]=Ht[ps][Qs][Is]||{},Ht[ps][Qs][Is][ms]=jt}return Ht}(zt.concat(Zs)),rt=Ut}return Qe}(this.pdf,this.fontFaces),dt=Xe.map(function(es){return{family:es,stretch:"normal",weight:et,style:Fe}}),Dt=function(es,Zs,pt){for(var Ut=(pt=pt||{}).defaultFontFamily||"times",zt=Object.assign({},Uge,pt.genericFontFamilies||{}),rs=null,Ht=null,vt=0;vt<Zs.length;++vt)if(zt[(rs=PT(Zs[vt])).family]&&(rs.family=zt[rs.family]),es.hasOwnProperty(rs.family)){Ht=es[rs.family];break}if(!(Ht=Ht||es[Ut]))throw new Error("Could not find a font-family for the rule '"+jV(rs)+"' and default family '"+Ut+"'.");if(Ht=function(jt,ps){if(ps[jt])return ps[jt];var Qs=qR[jt],Is=Qs<=qR.normal?-1:1,ms=BV(ps,bG,Qs,Is);if(!ms)throw new Error("Could not find a matching font-stretch value for "+jt);return ms}(rs.stretch,Ht),Ht=function(jt,ps){if(ps[jt])return ps[jt];for(var Qs=gG[jt],Is=0;Is<Qs.length;++Is)if(ps[Qs[Is]])return ps[Qs[Is]];throw new Error("Could not find a matching font-style for "+jt)}(rs.style,Ht),!(Ht=function(jt,ps){if(ps[jt])return ps[jt];if(jt===400&&ps[500])return ps[500];if(jt===500&&ps[400])return ps[400];var Qs=Pge[jt],Is=BV(ps,xG,Qs,jt<400?-1:1);if(!Is)throw new Error("Could not find a matching font-weight for value "+jt);return Is}(rs.weight,Ht)))throw new Error("Failed to resolve a font for the rule '"+jV(rs)+"'.");return Ht}(ht,dt);this.pdf.setFont(Dt.ref.name,Dt.ref.style)}else{var ss="";(et==="bold"||parseInt(et,10)>=700||Fe==="bold")&&(ss="bold"),Fe==="italic"&&(ss+="italic"),ss.length===0&&(ss="normal");for(var $t="",ls={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Zt=0;Zt<Xe.length;Zt++){if(this.pdf.internal.getFont(Xe[Zt],ss,{noFallback:!0,disableWarning:!0})!==void 0){$t=Xe[Zt];break}if(ss==="bolditalic"&&this.pdf.internal.getFont(Xe[Zt],"bold",{noFallback:!0,disableWarning:!0})!==void 0)$t=Xe[Zt],ss="bold";else if(this.pdf.internal.getFont(Xe[Zt],"normal",{noFallback:!0,disableWarning:!0})!==void 0){$t=Xe[Zt],ss="normal";break}}if($t===""){for(var Rs=0;Rs<Xe.length;Rs++)if(ls[Xe[Rs]]){$t=ls[Xe[Rs]];break}}$t=$t===""?"Times":$t,this.pdf.setFont($t,ss)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(we){this.ctx.globalCompositeOperation=we}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(we){this.ctx.globalAlpha=we}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(we){this.ctx.lineDashOffset=we,Ue.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(we){this.ctx.lineDash=we,Ue.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(we){this.ctx.ignoreClearRect=!!we}})};I.prototype.setLineDash=function(re){this.lineDash=re},I.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},I.prototype.fill=function(){X.call(this,"fill",!1)},I.prototype.stroke=function(){X.call(this,"stroke",!1)},I.prototype.beginPath=function(){this.path=[{type:"begin"}]},I.prototype.moveTo=function(re,ve){if(isNaN(re)||isNaN(ve))throw Dn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var fe=this.ctx.transform.applyToPoint(new g(re,ve));this.path.push({type:"mt",x:fe.x,y:fe.y}),this.ctx.lastPoint=new g(re,ve)},I.prototype.closePath=function(){var re=new g(0,0),ve=0;for(ve=this.path.length-1;ve!==-1;ve--)if(this.path[ve].type==="begin"&&bn(this.path[ve+1])==="object"&&typeof this.path[ve+1].x=="number"){re=new g(this.path[ve+1].x,this.path[ve+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new g(re.x,re.y)},I.prototype.lineTo=function(re,ve){if(isNaN(re)||isNaN(ve))throw Dn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var fe=this.ctx.transform.applyToPoint(new g(re,ve));this.path.push({type:"lt",x:fe.x,y:fe.y}),this.ctx.lastPoint=new g(fe.x,fe.y)},I.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),X.call(this,null,!0)},I.prototype.quadraticCurveTo=function(re,ve,fe,Ie){if(isNaN(fe)||isNaN(Ie)||isNaN(re)||isNaN(ve))throw Dn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var je=this.ctx.transform.applyToPoint(new g(fe,Ie)),Ee=this.ctx.transform.applyToPoint(new g(re,ve));this.path.push({type:"qct",x1:Ee.x,y1:Ee.y,x:je.x,y:je.y}),this.ctx.lastPoint=new g(je.x,je.y)},I.prototype.bezierCurveTo=function(re,ve,fe,Ie,je,Ee){if(isNaN(je)||isNaN(Ee)||isNaN(re)||isNaN(ve)||isNaN(fe)||isNaN(Ie))throw Dn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var We=this.ctx.transform.applyToPoint(new g(je,Ee)),ze=this.ctx.transform.applyToPoint(new g(re,ve)),st=this.ctx.transform.applyToPoint(new g(fe,Ie));this.path.push({type:"bct",x1:ze.x,y1:ze.y,x2:st.x,y2:st.y,x:We.x,y:We.y}),this.ctx.lastPoint=new g(We.x,We.y)},I.prototype.arc=function(re,ve,fe,Ie,je,Ee){if(isNaN(re)||isNaN(ve)||isNaN(fe)||isNaN(Ie)||isNaN(je))throw Dn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Ee=!!Ee,!this.ctx.transform.isIdentity){var We=this.ctx.transform.applyToPoint(new g(re,ve));re=We.x,ve=We.y;var ze=this.ctx.transform.applyToPoint(new g(0,fe)),st=this.ctx.transform.applyToPoint(new g(0,0));fe=Math.sqrt(Math.pow(ze.x-st.x,2)+Math.pow(ze.y-st.y,2))}Math.abs(je-Ie)>=2*Math.PI&&(Ie=0,je=2*Math.PI),this.path.push({type:"arc",x:re,y:ve,radius:fe,startAngle:Ie,endAngle:je,counterclockwise:Ee})},I.prototype.arcTo=function(re,ve,fe,Ie,je){throw new Error("arcTo not implemented.")},I.prototype.rect=function(re,ve,fe,Ie){if(isNaN(re)||isNaN(ve)||isNaN(fe)||isNaN(Ie))throw Dn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(re,ve),this.lineTo(re+fe,ve),this.lineTo(re+fe,ve+Ie),this.lineTo(re,ve+Ie),this.lineTo(re,ve),this.lineTo(re+fe,ve),this.lineTo(re,ve)},I.prototype.fillRect=function(re,ve,fe,Ie){if(isNaN(re)||isNaN(ve)||isNaN(fe)||isNaN(Ie))throw Dn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!R.call(this)){var je={};this.lineCap!=="butt"&&(je.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(je.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(re,ve,fe,Ie),this.fill(),je.hasOwnProperty("lineCap")&&(this.lineCap=je.lineCap),je.hasOwnProperty("lineJoin")&&(this.lineJoin=je.lineJoin)}},I.prototype.strokeRect=function(re,ve,fe,Ie){if(isNaN(re)||isNaN(ve)||isNaN(fe)||isNaN(Ie))throw Dn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");O.call(this)||(this.beginPath(),this.rect(re,ve,fe,Ie),this.stroke())},I.prototype.clearRect=function(re,ve,fe,Ie){if(isNaN(re)||isNaN(ve)||isNaN(fe)||isNaN(Ie))throw Dn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(re,ve,fe,Ie))},I.prototype.save=function(re){re=typeof re!="boolean"||re;for(var ve=this.pdf.internal.getCurrentPageInfo().pageNumber,fe=0;fe<this.pdf.internal.getNumberOfPages();fe++)this.pdf.setPage(fe+1),this.pdf.internal.out("q");if(this.pdf.setPage(ve),re){this.ctx.fontSize=this.pdf.internal.getFontSize();var Ie=new S(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Ie}},I.prototype.restore=function(re){re=typeof re!="boolean"||re;for(var ve=this.pdf.internal.getCurrentPageInfo().pageNumber,fe=0;fe<this.pdf.internal.getNumberOfPages();fe++)this.pdf.setPage(fe+1),this.pdf.internal.out("Q");this.pdf.setPage(ve),re&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},I.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var k=function(re){var ve,fe,Ie,je;if(re.isCanvasGradient===!0&&(re=re.getColor()),!re)return{r:0,g:0,b:0,a:0,style:re};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(re))ve=0,fe=0,Ie=0,je=0;else{var Ee=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(re);if(Ee!==null)ve=parseInt(Ee[1]),fe=parseInt(Ee[2]),Ie=parseInt(Ee[3]),je=1;else if((Ee=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(re))!==null)ve=parseInt(Ee[1]),fe=parseInt(Ee[2]),Ie=parseInt(Ee[3]),je=parseFloat(Ee[4]);else{if(je=1,typeof re=="string"&&re.charAt(0)!=="#"){var We=new dG(re);re=We.ok?We.toHex():"#000000"}re.length===4?(ve=re.substring(1,2),ve+=ve,fe=re.substring(2,3),fe+=fe,Ie=re.substring(3,4),Ie+=Ie):(ve=re.substring(1,3),fe=re.substring(3,5),Ie=re.substring(5,7)),ve=parseInt(ve,16),fe=parseInt(fe,16),Ie=parseInt(Ie,16)}}return{r:ve,g:fe,b:Ie,a:je,style:re}},R=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},O=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};I.prototype.fillText=function(re,ve,fe,Ie){if(isNaN(ve)||isNaN(fe)||typeof re!="string")throw Dn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Ie=isNaN(Ie)?void 0:Ie,!R.call(this)){var je=ee(this.ctx.transform.rotation),Ee=this.ctx.transform.scaleX;Y.call(this,{text:re,x:ve,y:fe,scale:Ee,angle:je,align:this.textAlign,maxWidth:Ie})}},I.prototype.strokeText=function(re,ve,fe,Ie){if(isNaN(ve)||isNaN(fe)||typeof re!="string")throw Dn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!O.call(this)){Ie=isNaN(Ie)?void 0:Ie;var je=ee(this.ctx.transform.rotation),Ee=this.ctx.transform.scaleX;Y.call(this,{text:re,x:ve,y:fe,scale:Ee,renderingMode:"stroke",angle:je,align:this.textAlign,maxWidth:Ie})}},I.prototype.measureText=function(re){if(typeof re!="string")throw Dn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var ve=this.pdf,fe=this.pdf.internal.scaleFactor,Ie=ve.internal.getFontSize(),je=ve.getStringUnitWidth(re)*Ie/ve.internal.scaleFactor;return new function(Ee){var We=(Ee=Ee||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return We}}),this}({width:je*=Math.round(96*fe/72*1e4)/1e4})},I.prototype.scale=function(re,ve){if(isNaN(re)||isNaN(ve))throw Dn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var fe=new v(re,0,0,ve,0,0);this.ctx.transform=this.ctx.transform.multiply(fe)},I.prototype.rotate=function(re){if(isNaN(re))throw Dn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var ve=new v(Math.cos(re),Math.sin(re),-Math.sin(re),Math.cos(re),0,0);this.ctx.transform=this.ctx.transform.multiply(ve)},I.prototype.translate=function(re,ve){if(isNaN(re)||isNaN(ve))throw Dn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var fe=new v(1,0,0,1,re,ve);this.ctx.transform=this.ctx.transform.multiply(fe)},I.prototype.transform=function(re,ve,fe,Ie,je,Ee){if(isNaN(re)||isNaN(ve)||isNaN(fe)||isNaN(Ie)||isNaN(je)||isNaN(Ee))throw Dn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var We=new v(re,ve,fe,Ie,je,Ee);this.ctx.transform=this.ctx.transform.multiply(We)},I.prototype.setTransform=function(re,ve,fe,Ie,je,Ee){re=isNaN(re)?1:re,ve=isNaN(ve)?0:ve,fe=isNaN(fe)?0:fe,Ie=isNaN(Ie)?1:Ie,je=isNaN(je)?0:je,Ee=isNaN(Ee)?0:Ee,this.ctx.transform=new v(re,ve,fe,Ie,je,Ee)};var F=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};I.prototype.drawImage=function(re,ve,fe,Ie,je,Ee,We,ze,st){var bt=this.pdf.getImageProperties(re),Qe=1,rt=1,Nt=1,we=1;Ie!==void 0&&ze!==void 0&&(Nt=ze/Ie,we=st/je,Qe=bt.width/Ie*ze/Ie,rt=bt.height/je*st/je),Ee===void 0&&(Ee=ve,We=fe,ve=0,fe=0),Ie!==void 0&&ze===void 0&&(ze=Ie,st=je),Ie===void 0&&ze===void 0&&(ze=bt.width,st=bt.height);var Rt=this.ctx.transform.decompose(),Fe=ee(Rt.rotate.shx),et=new v,$e=(et=(et=(et=et.multiply(Rt.translate)).multiply(Rt.skew)).multiply(Rt.scale)).applyToRectangle(new x(Ee-ve*Nt,We-fe*we,Ie*Qe,je*rt));if(this.autoPaging){for(var Kt,qt=M.call(this,$e),Xe=[],ht=0;ht<qt.length;ht+=1)Xe.indexOf(qt[ht])===-1&&Xe.push(qt[ht]);$(Xe);for(var dt=Xe[0],Dt=Xe[Xe.length-1],ss=dt;ss<Dt+1;ss++){this.pdf.setPage(ss);var $t=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ls=ss===1?this.posY+this.margin[0]:this.margin[0],Zt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Rs=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],es=ss===1?0:Zt+(ss-2)*Rs;if(this.ctx.clip_path.length!==0){var Zs=this.path;Kt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Z(Kt,this.posX+this.margin[3],-es+ls+this.ctx.prevPageLastElemOffset),be.call(this,"fill",!0),this.path=Zs}var pt=JSON.parse(JSON.stringify($e));pt=Z([pt],this.posX+this.margin[3],-es+ls+this.ctx.prevPageLastElemOffset)[0];var Ut=(ss>dt||ss<Dt)&&F.call(this);Ut&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],$t,Rs,null).clip().discardPath()),this.pdf.addImage(re,"JPEG",pt.x,pt.y,pt.w,pt.h,null,null,Fe),Ut&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(re,"JPEG",$e.x,$e.y,$e.w,$e.h,null,null,Fe)};var M=function(re,ve,fe){var Ie=[];ve=ve||this.pdf.internal.pageSize.width,fe=fe||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var je=this.posY+this.ctx.prevPageLastElemOffset;switch(re.type){default:case"mt":case"lt":Ie.push(Math.floor((re.y+je)/fe)+1);break;case"arc":Ie.push(Math.floor((re.y+je-re.radius)/fe)+1),Ie.push(Math.floor((re.y+je+re.radius)/fe)+1);break;case"qct":var Ee=Be(this.ctx.lastPoint.x,this.ctx.lastPoint.y,re.x1,re.y1,re.x,re.y);Ie.push(Math.floor((Ee.y+je)/fe)+1),Ie.push(Math.floor((Ee.y+Ee.h+je)/fe)+1);break;case"bct":var We=He(this.ctx.lastPoint.x,this.ctx.lastPoint.y,re.x1,re.y1,re.x2,re.y2,re.x,re.y);Ie.push(Math.floor((We.y+je)/fe)+1),Ie.push(Math.floor((We.y+We.h+je)/fe)+1);break;case"rect":Ie.push(Math.floor((re.y+je)/fe)+1),Ie.push(Math.floor((re.y+re.h+je)/fe)+1)}for(var ze=0;ze<Ie.length;ze+=1)for(;this.pdf.internal.getNumberOfPages()<Ie[ze];)Q.call(this);return Ie},Q=function(){var re=this.fillStyle,ve=this.strokeStyle,fe=this.font,Ie=this.lineCap,je=this.lineWidth,Ee=this.lineJoin;this.pdf.addPage(),this.fillStyle=re,this.strokeStyle=ve,this.font=fe,this.lineCap=Ie,this.lineWidth=je,this.lineJoin=Ee},Z=function(re,ve,fe){for(var Ie=0;Ie<re.length;Ie++)switch(re[Ie].type){case"bct":re[Ie].x2+=ve,re[Ie].y2+=fe;case"qct":re[Ie].x1+=ve,re[Ie].y1+=fe;default:re[Ie].x+=ve,re[Ie].y+=fe}return re},$=function(re){return re.sort(function(ve,fe){return ve-fe})},X=function(re,ve){var fe=this.fillStyle,Ie=this.strokeStyle,je=this.lineCap,Ee=this.lineWidth,We=Math.abs(Ee*this.ctx.transform.scaleX),ze=this.lineJoin;if(this.autoPaging){for(var st,bt,Qe=JSON.parse(JSON.stringify(this.path)),rt=JSON.parse(JSON.stringify(this.path)),Nt=[],we=0;we<rt.length;we++)if(rt[we].x!==void 0)for(var Rt=M.call(this,rt[we]),Fe=0;Fe<Rt.length;Fe+=1)Nt.indexOf(Rt[Fe])===-1&&Nt.push(Rt[Fe]);for(var et=0;et<Nt.length;et++)for(;this.pdf.internal.getNumberOfPages()<Nt[et];)Q.call(this);$(Nt);for(var $e=Nt[0],Kt=Nt[Nt.length-1],qt=$e;qt<Kt+1;qt++){this.pdf.setPage(qt),this.fillStyle=fe,this.strokeStyle=Ie,this.lineCap=je,this.lineWidth=We,this.lineJoin=ze;var Xe=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ht=qt===1?this.posY+this.margin[0]:this.margin[0],dt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Dt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ss=qt===1?0:dt+(qt-2)*Dt;if(this.ctx.clip_path.length!==0){var $t=this.path;st=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Z(st,this.posX+this.margin[3],-ss+ht+this.ctx.prevPageLastElemOffset),be.call(this,re,!0),this.path=$t}if(bt=JSON.parse(JSON.stringify(Qe)),this.path=Z(bt,this.posX+this.margin[3],-ss+ht+this.ctx.prevPageLastElemOffset),ve===!1||qt===0){var ls=(qt>$e||qt<Kt)&&F.call(this);ls&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Xe,Dt,null).clip().discardPath()),be.call(this,re,ve),ls&&this.pdf.restoreGraphicsState()}this.lineWidth=Ee}this.path=Qe}else this.lineWidth=We,be.call(this,re,ve),this.lineWidth=Ee},be=function(re,ve){if((re!=="stroke"||ve||!O.call(this))&&(re==="stroke"||ve||!R.call(this))){for(var fe,Ie,je=[],Ee=this.path,We=0;We<Ee.length;We++){var ze=Ee[We];switch(ze.type){case"begin":je.push({begin:!0});break;case"close":je.push({close:!0});break;case"mt":je.push({start:ze,deltas:[],abs:[]});break;case"lt":var st=je.length;if(Ee[We-1]&&!isNaN(Ee[We-1].x)&&(fe=[ze.x-Ee[We-1].x,ze.y-Ee[We-1].y],st>0)){for(;st>=0;st--)if(je[st-1].close!==!0&&je[st-1].begin!==!0){je[st-1].deltas.push(fe),je[st-1].abs.push(ze);break}}break;case"bct":fe=[ze.x1-Ee[We-1].x,ze.y1-Ee[We-1].y,ze.x2-Ee[We-1].x,ze.y2-Ee[We-1].y,ze.x-Ee[We-1].x,ze.y-Ee[We-1].y],je[je.length-1].deltas.push(fe);break;case"qct":var bt=Ee[We-1].x+2/3*(ze.x1-Ee[We-1].x),Qe=Ee[We-1].y+2/3*(ze.y1-Ee[We-1].y),rt=ze.x+2/3*(ze.x1-ze.x),Nt=ze.y+2/3*(ze.y1-ze.y),we=ze.x,Rt=ze.y;fe=[bt-Ee[We-1].x,Qe-Ee[We-1].y,rt-Ee[We-1].x,Nt-Ee[We-1].y,we-Ee[We-1].x,Rt-Ee[We-1].y],je[je.length-1].deltas.push(fe);break;case"arc":je.push({deltas:[],abs:[],arc:!0}),Array.isArray(je[je.length-1].abs)&&je[je.length-1].abs.push(ze)}}Ie=ve?null:re==="stroke"?"stroke":"fill";for(var Fe=!1,et=0;et<je.length;et++)if(je[et].arc)for(var $e=je[et].abs,Kt=0;Kt<$e.length;Kt++){var qt=$e[Kt];qt.type==="arc"?le.call(this,qt.x,qt.y,qt.radius,qt.startAngle,qt.endAngle,qt.counterclockwise,void 0,ve,!Fe):se.call(this,qt.x,qt.y),Fe=!0}else if(je[et].close===!0)this.pdf.internal.out("h"),Fe=!1;else if(je[et].begin!==!0){var Xe=je[et].start.x,ht=je[et].start.y;oe.call(this,je[et].deltas,Xe,ht),Fe=!0}Ie&&H.call(this,Ie),ve&&Ae.call(this)}},me=function(re){var ve=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,fe=ve*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return re-fe;case"top":return re+ve-fe;case"hanging":return re+ve-2*fe;case"middle":return re+ve/2-fe;default:return re}},Ne=function(re){return re+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};I.prototype.createLinearGradient=function(){var re=function(){};return re.colorStops=[],re.addColorStop=function(ve,fe){this.colorStops.push([ve,fe])},re.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},re.isCanvasGradient=!0,re},I.prototype.createPattern=function(){return this.createLinearGradient()},I.prototype.createRadialGradient=function(){return this.createLinearGradient()};var le=function(re,ve,fe,Ie,je,Ee,We,ze,st){for(var bt=he.call(this,fe,Ie,je,Ee),Qe=0;Qe<bt.length;Qe++){var rt=bt[Qe];Qe===0&&(st?J.call(this,rt.x1+re,rt.y1+ve):se.call(this,rt.x1+re,rt.y1+ve)),Te.call(this,re,ve,rt.x2,rt.y2,rt.x3,rt.y3,rt.x4,rt.y4)}ze?Ae.call(this):H.call(this,We)},H=function(re){switch(re){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Ae=function(){this.pdf.clip(),this.pdf.discardPath()},J=function(re,ve){this.pdf.internal.out(c(re)+" "+d(ve)+" m")},Y=function(re){var ve;switch(re.align){case"right":case"end":ve="right";break;case"center":ve="center";break;default:ve="left"}var fe,Ie,je,Ee=this.pdf.getTextDimensions(re.text),We=me.call(this,re.y),ze=Ne.call(this,We)-Ee.h,st=this.ctx.transform.applyToPoint(new g(re.x,We));if(this.autoPaging){var bt=this.ctx.transform.decompose(),Qe=new v;Qe=(Qe=(Qe=Qe.multiply(bt.translate)).multiply(bt.skew)).multiply(bt.scale);for(var rt=this.ctx.transform.applyToRectangle(new x(re.x,We,Ee.w,Ee.h)),Nt=Qe.applyToRectangle(new x(re.x,ze,Ee.w,Ee.h)),we=M.call(this,Nt),Rt=[],Fe=0;Fe<we.length;Fe+=1)Rt.indexOf(we[Fe])===-1&&Rt.push(we[Fe]);$(Rt);for(var et=Rt[0],$e=Rt[Rt.length-1],Kt=et;Kt<$e+1;Kt++){this.pdf.setPage(Kt);var qt=Kt===1?this.posY+this.margin[0]:this.margin[0],Xe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ht=this.pdf.internal.pageSize.height-this.margin[2],dt=ht-this.margin[0],Dt=this.pdf.internal.pageSize.width-this.margin[1],ss=Dt-this.margin[3],$t=Kt===1?0:Xe+(Kt-2)*dt;if(this.ctx.clip_path.length!==0){var ls=this.path;fe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Z(fe,this.posX+this.margin[3],-1*$t+qt),be.call(this,"fill",!0),this.path=ls}var Zt=Z([JSON.parse(JSON.stringify(Nt))],this.posX+this.margin[3],-$t+qt+this.ctx.prevPageLastElemOffset)[0];re.scale>=.01&&(Ie=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ie*re.scale),je=this.lineWidth,this.lineWidth=je*re.scale);var Rs=this.autoPaging!=="text";if(Rs||Zt.y+Zt.h<=ht){if(Rs||Zt.y>=qt&&Zt.x<=Dt){var es=Rs?re.text:this.pdf.splitTextToSize(re.text,re.maxWidth||Dt-Zt.x)[0],Zs=Z([JSON.parse(JSON.stringify(rt))],this.posX+this.margin[3],-$t+qt+this.ctx.prevPageLastElemOffset)[0],pt=Rs&&(Kt>et||Kt<$e)&&F.call(this);pt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ss,dt,null).clip().discardPath()),this.pdf.text(es,Zs.x,Zs.y,{angle:re.angle,align:ve,renderingMode:re.renderingMode}),pt&&this.pdf.restoreGraphicsState()}}else Zt.y<ht&&(this.ctx.prevPageLastElemOffset+=ht-Zt.y);re.scale>=.01&&(this.pdf.setFontSize(Ie),this.lineWidth=je)}}else re.scale>=.01&&(Ie=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ie*re.scale),je=this.lineWidth,this.lineWidth=je*re.scale),this.pdf.text(re.text,st.x+this.posX,st.y+this.posY,{angle:re.angle,align:ve,renderingMode:re.renderingMode,maxWidth:re.maxWidth}),re.scale>=.01&&(this.pdf.setFontSize(Ie),this.lineWidth=je)},se=function(re,ve,fe,Ie){fe=fe||0,Ie=Ie||0,this.pdf.internal.out(c(re+fe)+" "+d(ve+Ie)+" l")},oe=function(re,ve,fe){return this.pdf.lines(re,ve,fe,null,null)},Te=function(re,ve,fe,Ie,je,Ee,We,ze){this.pdf.internal.out([o(h(fe+re)),o(m(Ie+ve)),o(h(je+re)),o(m(Ee+ve)),o(h(We+re)),o(m(ze+ve)),"c"].join(" "))},he=function(re,ve,fe,Ie){for(var je=2*Math.PI,Ee=Math.PI/2;ve>fe;)ve-=je;var We=Math.abs(fe-ve);We<je&&Ie&&(We=je-We);for(var ze=[],st=Ie?-1:1,bt=ve;We>1e-5;){var Qe=bt+st*Math.min(We,Ee);ze.push(Ce.call(this,re,bt,Qe)),We-=Math.abs(Qe-bt),bt=Qe}return ze},Ce=function(re,ve,fe){var Ie=(fe-ve)/2,je=re*Math.cos(Ie),Ee=re*Math.sin(Ie),We=je,ze=-Ee,st=We*We+ze*ze,bt=st+We*je+ze*Ee,Qe=4/3*(Math.sqrt(2*st*bt)-bt)/(We*Ee-ze*je),rt=We-Qe*ze,Nt=ze+Qe*We,we=rt,Rt=-Nt,Fe=Ie+ve,et=Math.cos(Fe),$e=Math.sin(Fe);return{x1:re*Math.cos(ve),y1:re*Math.sin(ve),x2:rt*et-Nt*$e,y2:rt*$e+Nt*et,x3:we*et-Rt*$e,y3:we*$e+Rt*et,x4:re*Math.cos(fe),y4:re*Math.sin(fe)}},ee=function(re){return 180*re/Math.PI},Be=function(re,ve,fe,Ie,je,Ee){var We=re+.5*(fe-re),ze=ve+.5*(Ie-ve),st=je+.5*(fe-je),bt=Ee+.5*(Ie-Ee),Qe=Math.min(re,je,We,st),rt=Math.max(re,je,We,st),Nt=Math.min(ve,Ee,ze,bt),we=Math.max(ve,Ee,ze,bt);return new x(Qe,Nt,rt-Qe,we-Nt)},He=function(re,ve,fe,Ie,je,Ee,We,ze){var st,bt,Qe,rt,Nt,we,Rt,Fe,et,$e,Kt,qt,Xe,ht,dt=fe-re,Dt=Ie-ve,ss=je-fe,$t=Ee-Ie,ls=We-je,Zt=ze-Ee;for(bt=0;bt<41;bt++)et=(Rt=(Qe=re+(st=bt/40)*dt)+st*((Nt=fe+st*ss)-Qe))+st*(Nt+st*(je+st*ls-Nt)-Rt),$e=(Fe=(rt=ve+st*Dt)+st*((we=Ie+st*$t)-rt))+st*(we+st*(Ee+st*Zt-we)-Fe),bt==0?(Kt=et,qt=$e,Xe=et,ht=$e):(Kt=Math.min(Kt,et),qt=Math.min(qt,$e),Xe=Math.max(Xe,et),ht=Math.max(ht,$e));return new x(Math.round(Kt),Math.round(qt),Math.round(Xe-Kt),Math.round(ht-qt))},Ue=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var re,ve,fe=(re=this.ctx.lineDash,ve=this.ctx.lineDashOffset,JSON.stringify({lineDash:re,lineDashOffset:ve}));this.prevLineDash!==fe&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=fe)}}})(Ms.API),function(a){var o=function(g){var x,v,E,S,I,k,R,O,F,M;for(v=[],E=0,S=(g+=x="\0\0\0\0".slice(g.length%4||4)).length;S>E;E+=4)(I=(g.charCodeAt(E)<<24)+(g.charCodeAt(E+1)<<16)+(g.charCodeAt(E+2)<<8)+g.charCodeAt(E+3))!==0?(k=(I=((I=((I=((I=(I-(M=I%85))/85)-(F=I%85))/85)-(O=I%85))/85)-(R=I%85))/85)%85,v.push(k+33,R+33,O+33,F+33,M+33)):v.push(122);return function(Q,Z){for(var $=Z;$>0;$--)Q.pop()}(v,x.length),String.fromCharCode.apply(String,v)+"~>"},c=function(g){var x,v,E,S,I,k=String,R="length",O=255,F="charCodeAt",M="slice",Q="replace";for(g[M](-2),g=g[M](0,-2)[Q](/\s/g,"")[Q]("z","!!!!!"),E=[],S=0,I=(g+=x="uuuuu"[M](g[R]%5||5))[R];I>S;S+=5)v=52200625*(g[F](S)-33)+614125*(g[F](S+1)-33)+7225*(g[F](S+2)-33)+85*(g[F](S+3)-33)+(g[F](S+4)-33),E.push(O&v>>24,O&v>>16,O&v>>8,O&v);return function(Z,$){for(var X=$;X>0;X--)Z.pop()}(E,x[R]),k.fromCharCode.apply(k,E)},d=function(g){return g.split("").map(function(x){return("0"+x.charCodeAt().toString(16)).slice(-2)}).join("")+">"},h=function(g){var x=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((g=g.replace(/\s/g,"")).indexOf(">")!==-1&&(g=g.substr(0,g.indexOf(">"))),g.length%2&&(g+="0"),x.test(g)===!1)return"";for(var v="",E=0;E<g.length;E+=2)v+=String.fromCharCode("0x"+(g[E]+g[E+1]));return v},m=function(g){for(var x=new Uint8Array(g.length),v=g.length;v--;)x[v]=g.charCodeAt(v);return(x=VR(x)).reduce(function(E,S){return E+String.fromCharCode(S)},"")};a.processDataByFilters=function(g,x){var v=0,E=g||"",S=[];for(typeof(x=x||[])=="string"&&(x=[x]),v=0;v<x.length;v+=1)switch(x[v]){case"ASCII85Decode":case"/ASCII85Decode":E=c(E),S.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":E=o(E),S.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":E=h(E),S.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":E=d(E),S.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":E=m(E),S.push("/FlateDecode");break;default:throw new Error('The filter: "'+x[v]+'" is not implemented')}return{data:E,reverseChain:S.reverse().join(" ")}}}(Ms.API),function(a){a.loadFile=function(o,c,d){return function(h,m,g){m=m!==!1,g=typeof g=="function"?g:function(){};var x=void 0;try{x=function(v,E,S){var I=new XMLHttpRequest,k=0,R=function(O){var F=O.length,M=[],Q=String.fromCharCode;for(k=0;k<F;k+=1)M.push(Q(255&O.charCodeAt(k)));return M.join("")};if(I.open("GET",v,!E),I.overrideMimeType("text/plain; charset=x-user-defined"),E===!1&&(I.onload=function(){I.status===200?S(R(this.responseText)):S(void 0)}),I.send(null),E&&I.status===200)return R(I.responseText)}(h,m,g)}catch{}return x}(o,c,d)},a.allowFsRead=void 0,a.loadImageFile=a.loadFile}(Ms.API),function(a){function o(){return(sr.html2canvas?Promise.resolve(sr.html2canvas):xT(()=>Promise.resolve().then(()=>mme),void 0)).catch(function(x){return Promise.reject(new Error("Could not load html2canvas: "+x))}).then(function(x){return x.default?x.default:x})}function c(){return(sr.DOMPurify?Promise.resolve(sr.DOMPurify):xT(()=>import("./purify.es-B9ZVCkUG.js"),[])).catch(function(x){return Promise.reject(new Error("Could not load dompurify: "+x))}).then(function(x){return x.default?x.default:x})}var d=function(x){var v=bn(x);return v==="undefined"?"undefined":v==="string"||x instanceof String?"string":v==="number"||x instanceof Number?"number":v==="function"||x instanceof Function?"function":x&&x.constructor===Array?"array":x&&x.nodeType===1?"element":v==="object"?"object":"unknown"},h=function(x,v){var E=document.createElement(x);for(var S in v.className&&(E.className=v.className),v.innerHTML&&v.dompurify&&(E.innerHTML=v.dompurify.sanitize(v.innerHTML)),v.style)E.style[S]=v.style[S];return E},m=function x(v,E){for(var S=v.nodeType===3?document.createTextNode(v.nodeValue):v.cloneNode(!1),I=v.firstChild;I;I=I.nextSibling)E!==!0&&I.nodeType===1&&I.nodeName==="SCRIPT"||S.appendChild(x(I,E));return v.nodeType===1&&(v.nodeName==="CANVAS"?(S.width=v.width,S.height=v.height,S.getContext("2d").drawImage(v,0,0)):v.nodeName!=="TEXTAREA"&&v.nodeName!=="SELECT"||(S.value=v.value),S.addEventListener("load",function(){S.scrollTop=v.scrollTop,S.scrollLeft=v.scrollLeft},!0)),S},g=function x(v){var E=Object.assign(x.convert(Promise.resolve()),JSON.parse(JSON.stringify(x.template))),S=x.convert(Promise.resolve(),E);return(S=S.setProgress(1,x,1,[x])).set(v)};(g.prototype=Object.create(Promise.prototype)).constructor=g,g.convert=function(x,v){return x.__proto__=v||g.prototype,x},g.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},g.prototype.from=function(x,v){return this.then(function(){switch(v=v||function(E){switch(d(E)){case"string":return"string";case"element":return E.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(x),v){case"string":return this.then(c).then(function(E){return this.set({src:h("div",{innerHTML:x,dompurify:E})})});case"element":return this.set({src:x});case"canvas":return this.set({canvas:x});case"img":return this.set({img:x});default:return this.error("Unknown source type.")}})},g.prototype.to=function(x){switch(x){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},g.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var x={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},v=m(this.prop.src,this.opt.html2canvas.javascriptEnabled);v.tagName==="BODY"&&(x.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=h("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=h("div",{className:"html2pdf__container",style:x}),this.prop.container.appendChild(v),this.prop.container.firstChild.appendChild(h("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},g.prototype.toCanvas=function(){var x=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(x).then(o).then(function(v){var E=Object.assign({},this.opt.html2canvas);return delete E.onrendered,v(this.prop.container,E)}).then(function(v){(this.opt.html2canvas.onrendered||function(){})(v),this.prop.canvas=v,document.body.removeChild(this.prop.overlay)})},g.prototype.toContext2d=function(){var x=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(x).then(o).then(function(v){var E=this.opt.jsPDF,S=this.opt.fontFaces,I=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,k=Object.assign({async:!0,allowTaint:!0,scale:I,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete k.onrendered,E.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,E.context2d.posX=this.opt.x,E.context2d.posY=this.opt.y,E.context2d.margin=this.opt.margin,E.context2d.fontFaces=S,S)for(var R=0;R<S.length;++R){var O=S[R],F=O.src.find(function(M){return M.format==="truetype"});F&&E.addFont(F.url,O.ref.name,O.ref.style)}return k.windowHeight=k.windowHeight||0,k.windowHeight=k.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):k.windowHeight,E.context2d.save(!0),v(this.prop.container,k)}).then(function(v){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(v),this.prop.canvas=v,document.body.removeChild(this.prop.overlay)})},g.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var x=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=x})},g.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},g.prototype.output=function(x,v,E){return(E=E||"pdf").toLowerCase()==="img"||E.toLowerCase()==="image"?this.outputImg(x,v):this.outputPdf(x,v)},g.prototype.outputPdf=function(x,v){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(x,v)})},g.prototype.outputImg=function(x){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(x){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+x+'" is not supported.'}})},g.prototype.save=function(x){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(x?{filename:x}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},g.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},g.prototype.set=function(x){if(d(x)!=="object")return this;var v=Object.keys(x||{}).map(function(E){if(E in g.template.prop)return function(){this.prop[E]=x[E]};switch(E){case"margin":return this.setMargin.bind(this,x.margin);case"jsPDF":return function(){return this.opt.jsPDF=x.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,x.pageSize);default:return function(){this.opt[E]=x[E]}}},this);return this.then(function(){return this.thenList(v)})},g.prototype.get=function(x,v){return this.then(function(){var E=x in g.template.prop?this.prop[x]:this.opt[x];return v?v(E):E})},g.prototype.setMargin=function(x){return this.then(function(){switch(d(x)){case"number":x=[x,x,x,x];case"array":if(x.length===2&&(x=[x[0],x[1],x[0],x[1]]),x.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=x}).then(this.setPageSize)},g.prototype.setPageSize=function(x){function v(E,S){return Math.floor(E*S/72*96)}return this.then(function(){(x=x||Ms.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(x.inner={width:x.width-this.opt.margin[1]-this.opt.margin[3],height:x.height-this.opt.margin[0]-this.opt.margin[2]},x.inner.px={width:v(x.inner.width,x.k),height:v(x.inner.height,x.k)},x.inner.ratio=x.inner.height/x.inner.width),this.prop.pageSize=x})},g.prototype.setProgress=function(x,v,E,S){return x!=null&&(this.progress.val=x),v!=null&&(this.progress.state=v),E!=null&&(this.progress.n=E),S!=null&&(this.progress.stack=S),this.progress.ratio=this.progress.val/this.progress.state,this},g.prototype.updateProgress=function(x,v,E,S){return this.setProgress(x?this.progress.val+x:null,v||null,E?this.progress.n+E:null,S?this.progress.stack.concat(S):null)},g.prototype.then=function(x,v){var E=this;return this.thenCore(x,v,function(S,I){return E.updateProgress(null,null,1,[S]),Promise.prototype.then.call(this,function(k){return E.updateProgress(null,S),k}).then(S,I).then(function(k){return E.updateProgress(1),k})})},g.prototype.thenCore=function(x,v,E){E=E||Promise.prototype.then;var S=this;x&&(x=x.bind(S)),v&&(v=v.bind(S));var I=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?S:g.convert(Object.assign({},S),Promise.prototype),k=E.call(I,x,v);return g.convert(k,S.__proto__)},g.prototype.thenExternal=function(x,v){return Promise.prototype.then.call(this,x,v)},g.prototype.thenList=function(x){var v=this;return x.forEach(function(E){v=v.thenCore(E)}),v},g.prototype.catch=function(x){x&&(x=x.bind(this));var v=Promise.prototype.catch.call(this,x);return g.convert(v,this)},g.prototype.catchExternal=function(x){return Promise.prototype.catch.call(this,x)},g.prototype.error=function(x){return this.then(function(){throw new Error(x)})},g.prototype.using=g.prototype.set,g.prototype.saveAs=g.prototype.save,g.prototype.export=g.prototype.output,g.prototype.run=g.prototype.then,Ms.getPageSize=function(x,v,E){if(bn(x)==="object"){var S=x;x=S.orientation,v=S.unit||v,E=S.format||E}v=v||"mm",E=E||"a4",x=(""+(x||"P")).toLowerCase();var I,k=(""+E).toLowerCase(),R={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(v){case"pt":I=1;break;case"mm":I=72/25.4;break;case"cm":I=72/2.54;break;case"in":I=72;break;case"px":I=.75;break;case"pc":case"em":I=12;break;case"ex":I=6;break;default:throw"Invalid unit: "+v}var O,F=0,M=0;if(R.hasOwnProperty(k))F=R[k][1]/I,M=R[k][0]/I;else try{F=E[1],M=E[0]}catch{throw new Error("Invalid format: "+E)}if(x==="p"||x==="portrait")x="p",M>F&&(O=M,M=F,F=O);else{if(x!=="l"&&x!=="landscape")throw"Invalid orientation: "+x;x="l",F>M&&(O=M,M=F,F=O)}return{width:M,height:F,unit:v,k:I,orientation:x}},a.html=function(x,v){(v=v||{}).callback=v.callback||function(){},v.html2canvas=v.html2canvas||{},v.html2canvas.canvas=v.html2canvas.canvas||this.canvas,v.jsPDF=v.jsPDF||this,v.fontFaces=v.fontFaces?v.fontFaces.map(PT):null;var E=new g(v);return v.worker?E:E.from(x).doCallback()}}(Ms.API),Ms.API.addJS=function(a){var o,c,d=function(h){for(var m="",g=0;g<h.length;g++){var x=h[g];if(x==="("||x===")"){for(var v=0,E=g-1;E>=0&&h[E]==="\\";E--)v++;m+=v%2==0?"\\"+x:x}else m+=x}return m}(a);return this.internal.events.subscribe("postPutResources",function(){o=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(o+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),c=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+d+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){o!==void 0&&c!==void 0&&this.internal.out("/Names <</JavaScript "+o+" 0 R>>")}),this},function(a){var o;a.events.push(["postPutResources",function(){var c=this,d=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var h=c.outline.render().split(/\r\n/),m=0;m<h.length;m++){var g=h[m],x=d.exec(g);if(x!=null){var v=x[1];c.internal.newObjectDeferredBegin(v,!1)}c.internal.write(g)}if(this.outline.createNamedDestinations){var E=this.internal.pages.length,S=[];for(m=0;m<E;m++){var I=c.internal.newObject();S.push(I);var k=c.internal.getPageInfo(m+1);c.internal.write("<< /D["+k.objId+" 0 R /XYZ null null null]>> endobj")}var R=c.internal.newObject();for(c.internal.write("<< /Names [ "),m=0;m<S.length;m++)c.internal.write("(page_"+(m+1)+")"+S[m]+" 0 R");c.internal.write(" ] >>","endobj"),o=c.internal.newObject(),c.internal.write("<< /Dests "+R+" 0 R"),c.internal.write(">>","endobj")}}]),a.events.push(["putCatalog",function(){var c=this;c.outline.root.children.length>0&&(c.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&c.internal.write("/Names "+o+" 0 R"))}]),a.events.push(["initialized",function(){var c=this;c.outline={createNamedDestinations:!1,root:{children:[]}},c.outline.add=function(d,h,m){var g={title:h,options:m,children:[]};return d==null&&(d=this.root),d.children.push(g),g},c.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=c,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},c.outline.genIds_r=function(d){d.id=c.internal.newObjectDeferred();for(var h=0;h<d.children.length;h++)this.genIds_r(d.children[h])},c.outline.renderRoot=function(d){this.objStart(d),this.line("/Type /Outlines"),d.children.length>0&&(this.line("/First "+this.makeRef(d.children[0])),this.line("/Last "+this.makeRef(d.children[d.children.length-1]))),this.line("/Count "+this.count_r({count:0},d)),this.objEnd()},c.outline.renderItems=function(d){for(var h=this.ctx.pdf.internal.getVerticalCoordinateString,m=0;m<d.children.length;m++){var g=d.children[m];this.objStart(g),this.line("/Title "+this.makeString(g.title)),this.line("/Parent "+this.makeRef(d)),m>0&&this.line("/Prev "+this.makeRef(d.children[m-1])),m<d.children.length-1&&this.line("/Next "+this.makeRef(d.children[m+1])),g.children.length>0&&(this.line("/First "+this.makeRef(g.children[0])),this.line("/Last "+this.makeRef(g.children[g.children.length-1])));var x=this.count=this.count_r({count:0},g);if(x>0&&this.line("/Count "+x),g.options&&g.options.pageNumber){var v=c.internal.getPageInfo(g.options.pageNumber);this.line("/Dest ["+v.objId+" 0 R /XYZ 0 "+h(0)+" 0]")}this.objEnd()}for(var E=0;E<d.children.length;E++)this.renderItems(d.children[E])},c.outline.line=function(d){this.ctx.val+=d+`\r
`},c.outline.makeRef=function(d){return d.id+" 0 R"},c.outline.makeString=function(d){return"("+c.internal.pdfEscape(d)+")"},c.outline.objStart=function(d){this.ctx.val+=`\r
`+d.id+` 0 obj\r
<<\r
`},c.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},c.outline.count_r=function(d,h){for(var m=0;m<h.children.length;m++)d.count++,this.count_r(d,h.children[m]);return d.count}}])}(Ms.API),function(a){var o=[192,193,194,195,196,197,198,199];a.processJPEG=function(c,d,h,m,g,x){var v,E=this.decode.DCT_DECODE,S=null;if(typeof c=="string"||this.__addimage__.isArrayBuffer(c)||this.__addimage__.isArrayBufferView(c)){switch(c=g||c,c=this.__addimage__.isArrayBuffer(c)?new Uint8Array(c):c,v=function(I){for(var k,R=256*I.charCodeAt(4)+I.charCodeAt(5),O=I.length,F={width:0,height:0,numcomponents:1},M=4;M<O;M+=2){if(M+=R,o.indexOf(I.charCodeAt(M+1))!==-1){k=256*I.charCodeAt(M+5)+I.charCodeAt(M+6),F={width:256*I.charCodeAt(M+7)+I.charCodeAt(M+8),height:k,numcomponents:I.charCodeAt(M+9)};break}R=256*I.charCodeAt(M+2)+I.charCodeAt(M+3)}return F}(c=this.__addimage__.isArrayBufferView(c)?this.__addimage__.arrayBufferToBinaryString(c):c),v.numcomponents){case 1:x=this.color_spaces.DEVICE_GRAY;break;case 4:x=this.color_spaces.DEVICE_CMYK;break;case 3:x=this.color_spaces.DEVICE_RGB}S={data:c,width:v.width,height:v.height,colorSpace:x,bitsPerComponent:8,filter:E,index:d,alias:h}}return S}}(Ms.API),Ms.API.processPNG=function(a,o,c,d){if(this.__addimage__.isArrayBuffer(a)&&(a=new Uint8Array(a)),this.__addimage__.isArrayBufferView(a)){var h,m=yge(a,{checkCrc:!0}),g=m.width,x=m.height,v=m.channels,E=m.palette,S=m.depth;h=E&&v===1?function(le){for(var H=le.width,Ae=le.height,J=le.data,Y=le.palette,se=le.depth,oe=!1,Te=[],he=[],Ce=void 0,ee=!1,Be=0,He=0;He<Y.length;He++){var Ue=H8(Y[He],4),re=Ue[0],ve=Ue[1],fe=Ue[2],Ie=Ue[3];Te.push(re,ve,fe),Ie!=null&&(Ie===0?(Be++,he.length<1&&he.push(He)):Ie<255&&(ee=!0))}if(ee||Be>1){oe=!0,he=void 0;var je=H*Ae;Ce=new Uint8Array(je);for(var Ee=new DataView(J.buffer),We=0;We<je;We++){var ze=FT(Ee,We,se),st=H8(Y[ze],4)[3];Ce[We]=st}}else Be===0&&(he=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:oe?8:void 0,colorBytes:J,alphaBytes:Ce,needSMask:oe,palette:Te,mask:he}}(m):v===2||v===4?function(le){for(var H=le.data,Ae=le.width,J=le.height,Y=le.channels,se=le.depth,oe=Y===2?"DeviceGray":"DeviceRGB",Te=Y-1,he=Ae*J,Ce=Te,ee=he*Ce,Be=1*he,He=Math.ceil(ee*se/8),Ue=Math.ceil(Be*se/8),re=new Uint8Array(He),ve=new Uint8Array(Ue),fe=new DataView(H.buffer),Ie=new DataView(re.buffer),je=new DataView(ve.buffer),Ee=!1,We=0;We<he;We++){for(var ze=We*Y,st=0;st<Ce;st++)WV(Ie,FT(fe,ze+st,se),We*Ce+st,se);var bt=FT(fe,ze+Ce,se);bt<(1<<se)-1&&(Ee=!0),WV(je,bt,1*We,se)}return{colorSpace:oe,colorsPerPixel:Te,sMaskBitsPerComponent:Ee?se:void 0,colorBytes:re,alphaBytes:ve,needSMask:Ee}}(m):function(le){var H=le.data,Ae=le.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:Ae,colorsPerPixel:Ae==="DeviceGray"?1:3,colorBytes:H instanceof Uint16Array?function(J){for(var Y=J.length,se=new Uint8Array(2*Y),oe=new DataView(se.buffer,se.byteOffset,se.byteLength),Te=0;Te<Y;Te++)oe.setUint16(2*Te,J[Te],!1);return se}(H):H,needSMask:!1}}(m);var I,k,R,O=h,F=O.colorSpace,M=O.colorsPerPixel,Q=O.sMaskBitsPerComponent,Z=O.colorBytes,$=O.alphaBytes,X=O.needSMask,be=O.palette,me=O.mask,Ne=null;return d!==Ms.API.image_compression.NONE&&typeof VR=="function"?(Ne=function(le){var H;switch(le){case Ms.API.image_compression.FAST:H=11;break;case Ms.API.image_compression.MEDIUM:H=13;break;case Ms.API.image_compression.SLOW:H=14;break;default:H=12}return H}(d),I=this.decode.FLATE_DECODE,k="/Predictor ".concat(Ne," /Colors ").concat(M," /BitsPerComponent ").concat(S," /Columns ").concat(g),a=VV(Z,Math.ceil(g*M*S/8),M,S,d),X&&(R=VV($,Math.ceil(g*Q/8),1,Q,d))):(I=void 0,k=void 0,a=Z,X&&(R=$)),(this.__addimage__.isArrayBuffer(a)||this.__addimage__.isArrayBufferView(a))&&(a=this.__addimage__.arrayBufferToBinaryString(a)),(R&&this.__addimage__.isArrayBuffer(R)||this.__addimage__.isArrayBufferView(R))&&(R=this.__addimage__.arrayBufferToBinaryString(R)),{alias:c,data:a,index:o,filter:I,decodeParameters:k,transparency:me,palette:be,sMask:R,predictor:Ne,width:g,height:x,bitsPerComponent:S,sMaskBitsPerComponent:Q,colorSpace:F}}},function(a){a.processGIF89A=function(o,c,d,h){var m=new Gge(o),g=m.width,x=m.height,v=[];m.decodeAndBlitFrameRGBA(0,v);var E={data:v,width:g,height:x},S=new MT(100).encode(E,100);return a.processJPEG.call(this,S,c,d,h)},a.processGIF87A=a.processGIF89A}(Ms.API),Yl.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var a=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(a);for(var o=0;o<a;o++){var c=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),h=this.datav.getUint8(this.pos++,!0),m=this.datav.getUint8(this.pos++,!0);this.palette[o]={red:h,green:d,blue:c,quad:m}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Yl.prototype.parseBGR=function(){this.pos=this.offset;var a="bit"+this.bitPP,o=this.width*this.height*4;if(o>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(o);try{this[a]()}catch(c){Dn.log("bit decode error:"+c)}},Yl.prototype.bit1=function(){var a,o=Math.ceil(this.width/8),c=o%4;for(a=this.height-1;a>=0;a--){for(var d=this.bottom_up?a:this.height-1-a,h=0;h<o;h++)for(var m=this.datav.getUint8(this.pos++,!0),g=d*this.width*4+8*h*4,x=0;x<8&&8*h+x<this.width;x++){var v=this.palette[m>>7-x&1];this.data[g+4*x]=v.blue,this.data[g+4*x+1]=v.green,this.data[g+4*x+2]=v.red,this.data[g+4*x+3]=255}c!==0&&(this.pos+=4-c)}},Yl.prototype.bit4=function(){for(var a=Math.ceil(this.width/2),o=a%4,c=this.height-1;c>=0;c--){for(var d=this.bottom_up?c:this.height-1-c,h=0;h<a;h++){var m=this.datav.getUint8(this.pos++,!0),g=d*this.width*4+2*h*4,x=m>>4,v=15&m,E=this.palette[x];if(this.data[g]=E.blue,this.data[g+1]=E.green,this.data[g+2]=E.red,this.data[g+3]=255,2*h+1>=this.width)break;E=this.palette[v],this.data[g+4]=E.blue,this.data[g+4+1]=E.green,this.data[g+4+2]=E.red,this.data[g+4+3]=255}o!==0&&(this.pos+=4-o)}},Yl.prototype.bit8=function(){for(var a=this.width%4,o=this.height-1;o>=0;o--){for(var c=this.bottom_up?o:this.height-1-o,d=0;d<this.width;d++){var h=this.datav.getUint8(this.pos++,!0),m=c*this.width*4+4*d;if(h<this.palette.length){var g=this.palette[h];this.data[m]=g.red,this.data[m+1]=g.green,this.data[m+2]=g.blue,this.data[m+3]=255}else this.data[m]=255,this.data[m+1]=255,this.data[m+2]=255,this.data[m+3]=255}a!==0&&(this.pos+=4-a)}},Yl.prototype.bit15=function(){for(var a=this.width%3,o=parseInt("11111",2),c=this.height-1;c>=0;c--){for(var d=this.bottom_up?c:this.height-1-c,h=0;h<this.width;h++){var m=this.datav.getUint16(this.pos,!0);this.pos+=2;var g=(m&o)/o*255|0,x=(m>>5&o)/o*255|0,v=(m>>10&o)/o*255|0,E=m>>15?255:0,S=d*this.width*4+4*h;this.data[S]=v,this.data[S+1]=x,this.data[S+2]=g,this.data[S+3]=E}this.pos+=a}},Yl.prototype.bit16=function(){for(var a=this.width%3,o=parseInt("11111",2),c=parseInt("111111",2),d=this.height-1;d>=0;d--){for(var h=this.bottom_up?d:this.height-1-d,m=0;m<this.width;m++){var g=this.datav.getUint16(this.pos,!0);this.pos+=2;var x=(g&o)/o*255|0,v=(g>>5&c)/c*255|0,E=(g>>11)/o*255|0,S=h*this.width*4+4*m;this.data[S]=E,this.data[S+1]=v,this.data[S+2]=x,this.data[S+3]=255}this.pos+=a}},Yl.prototype.bit24=function(){for(var a=this.height-1;a>=0;a--){for(var o=this.bottom_up?a:this.height-1-a,c=0;c<this.width;c++){var d=this.datav.getUint8(this.pos++,!0),h=this.datav.getUint8(this.pos++,!0),m=this.datav.getUint8(this.pos++,!0),g=o*this.width*4+4*c;this.data[g]=m,this.data[g+1]=h,this.data[g+2]=d,this.data[g+3]=255}this.pos+=this.width%4}},Yl.prototype.bit32=function(){for(var a=this.height-1;a>=0;a--)for(var o=this.bottom_up?a:this.height-1-a,c=0;c<this.width;c++){var d=this.datav.getUint8(this.pos++,!0),h=this.datav.getUint8(this.pos++,!0),m=this.datav.getUint8(this.pos++,!0),g=this.datav.getUint8(this.pos++,!0),x=o*this.width*4+4*c;this.data[x]=m,this.data[x+1]=h,this.data[x+2]=d,this.data[x+3]=g}},Yl.prototype.getData=function(){return this.data},function(a){a.processBMP=function(o,c,d,h){var m=new Yl(o,!1),g=m.width,x=m.height,v={data:m.getData(),width:g,height:x},E=new MT(100).encode(v,100);return a.processJPEG.call(this,E,c,d,h)}}(Ms.API),qV.prototype.getData=function(){return this.data},function(a){a.processWEBP=function(o,c,d,h){var m=new qV(o),g=m.width,x=m.height,v={data:m.getData(),width:g,height:x},E=new MT(100).encode(v,100);return a.processJPEG.call(this,E,c,d,h)}}(Ms.API),Ms.API.processRGBA=function(a,o,c){for(var d=a.data,h=d.length,m=new Uint8Array(h/4*3),g=new Uint8Array(h/4),x=0,v=0,E=0;E<h;E+=4){var S=d[E],I=d[E+1],k=d[E+2],R=d[E+3];m[x++]=S,m[x++]=I,m[x++]=k,g[v++]=R}var O=this.__addimage__.arrayBufferToBinaryString(m);return{alpha:this.__addimage__.arrayBufferToBinaryString(g),data:O,index:o,alias:c,colorSpace:"DeviceRGB",bitsPerComponent:8,width:a.width,height:a.height}},Ms.API.setLanguage=function(a){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[a]!==void 0&&(this.internal.languageSettings.languageCode=a,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},ng=Ms.API,py=ng.getCharWidthsArray=function(a,o){var c,d,h=(o=o||{}).font||this.internal.getFont(),m=o.fontSize||this.internal.getFontSize(),g=o.charSpace||this.internal.getCharSpace(),x=o.widths?o.widths:h.metadata.Unicode.widths,v=x.fof?x.fof:1,E=o.kerning?o.kerning:h.metadata.Unicode.kerning,S=E.fof?E.fof:1,I=o.doKerning!==!1,k=0,R=a.length,O=0,F=x[0]||v,M=[];for(c=0;c<R;c++)d=a.charCodeAt(c),typeof h.metadata.widthOfString=="function"?M.push((h.metadata.widthOfGlyph(h.metadata.characterToGlyph(d))+g*(1e3/m)||0)/1e3):(k=I&&bn(E[d])==="object"&&!isNaN(parseInt(E[d][O],10))?E[d][O]/S:0,M.push((x[d]||F)/v+k)),O=d;return M},UV=ng.getStringUnitWidth=function(a,o){var c=(o=o||{}).fontSize||this.internal.getFontSize(),d=o.font||this.internal.getFont(),h=o.charSpace||this.internal.getCharSpace();return ng.processArabic&&(a=ng.processArabic(a)),typeof d.metadata.widthOfString=="function"?d.metadata.widthOfString(a,c,h)/c:py.apply(this,arguments).reduce(function(m,g){return m+g},0)},FV=function(a,o,c,d){for(var h=[],m=0,g=a.length,x=0;m!==g&&x+o[m]<c;)x+=o[m],m++;h.push(a.slice(0,m));var v=m;for(x=0;m!==g;)x+o[m]>d&&(h.push(a.slice(v,m)),x=0,v=m),x+=o[m],m++;return v!==m&&h.push(a.slice(v,m)),h},MV=function(a,o,c){c||(c={});var d,h,m,g,x,v,E,S=[],I=[S],k=c.textIndent||0,R=0,O=0,F=a.split(" "),M=py.apply(this,[" ",c])[0];if(v=c.lineIndent===-1?F[0].length+2:c.lineIndent||0){var Q=Array(v).join(" "),Z=[];F.map(function(X){(X=X.split(/\s*\n/)).length>1?Z=Z.concat(X.map(function(be,me){return(me&&be.length?`
`:"")+be})):Z.push(X[0])}),F=Z,v=UV.apply(this,[Q,c])}for(m=0,g=F.length;m<g;m++){var $=0;if(d=F[m],v&&d[0]==`
`&&(d=d.substr(1),$=1),k+R+(O=(h=py.apply(this,[d,c])).reduce(function(X,be){return X+be},0))>o||$){if(O>o){for(x=FV.apply(this,[d,h,o-(k+R),o]),S.push(x.shift()),S=[x.pop()];x.length;)I.push([x.shift()]);O=h.slice(d.length-(S[0]?S[0].length:0)).reduce(function(X,be){return X+be},0)}else S=[d];I.push(S),k=O+v,R=M}else S.push(d),k+=R+O,R=M}return E=v?function(X,be){return(be?Q:"")+X.join(" ")}:function(X){return X.join(" ")},I.map(E)},ng.splitTextToSize=function(a,o,c){var d,h=(c=c||{}).fontSize||this.internal.getFontSize(),m=(function(S){if(S.widths&&S.kerning)return{widths:S.widths,kerning:S.kerning};var I=this.internal.getFont(S.fontName,S.fontStyle),k="Unicode";return I.metadata[k]?{widths:I.metadata[k].widths||{0:1},kerning:I.metadata[k].kerning||{}}:{font:I.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,c);d=Array.isArray(a)?a:String(a).split(/\r?\n/);var g=1*this.internal.scaleFactor*o/h;m.textIndent=c.textIndent?1*c.textIndent*this.internal.scaleFactor/h:0,m.lineIndent=c.lineIndent;var x,v,E=[];for(x=0,v=d.length;x<v;x++)E=E.concat(MV.apply(this,[d[x],g,m]));return E},function(a){a.__fontmetrics__=a.__fontmetrics__||{};for(var o="0123456789abcdef",c="klmnopqrstuvwxyz",d={},h={},m=0;m<16;m++)d[c[m]]=o[m],h[o[m]]=c[m];var g=function(k){return"0x"+parseInt(k,10).toString(16)},x=a.__fontmetrics__.compress=function(k){var R,O,F,M,Q=["{"];for(var Z in k){if(R=k[Z],isNaN(parseInt(Z,10))?O="'"+Z+"'":(Z=parseInt(Z,10),O=(O=g(Z).slice(2)).slice(0,-1)+h[O.slice(-1)]),typeof R=="number")R<0?(F=g(R).slice(3),M="-"):(F=g(R).slice(2),M=""),F=M+F.slice(0,-1)+h[F.slice(-1)];else{if(bn(R)!=="object")throw new Error("Don't know what to do with value type "+bn(R)+".");F=x(R)}Q.push(O+F)}return Q.push("}"),Q.join("")},v=a.__fontmetrics__.uncompress=function(k){if(typeof k!="string")throw new Error("Invalid argument passed to uncompress.");for(var R,O,F,M,Q={},Z=1,$=Q,X=[],be="",me="",Ne=k.length-1,le=1;le<Ne;le+=1)(M=k[le])=="'"?R?(F=R.join(""),R=void 0):R=[]:R?R.push(M):M=="{"?(X.push([$,F]),$={},F=void 0):M=="}"?((O=X.pop())[0][O[1]]=$,F=void 0,$=O[0]):M=="-"?Z=-1:F===void 0?d.hasOwnProperty(M)?(be+=d[M],F=parseInt(be,16)*Z,Z=1,be=""):be+=M:d.hasOwnProperty(M)?(me+=d[M],$[F]=parseInt(me,16)*Z,Z=1,F=void 0,me=""):me+=M;return Q},E={codePages:["WinAnsiEncoding"],WinAnsiEncoding:v("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},S={Unicode:{Courier:E,"Courier-Bold":E,"Courier-BoldOblique":E,"Courier-Oblique":E,Helvetica:E,"Helvetica-Bold":E,"Helvetica-BoldOblique":E,"Helvetica-Oblique":E,"Times-Roman":E,"Times-Bold":E,"Times-BoldItalic":E,"Times-Italic":E}},I={Unicode:{"Courier-Oblique":v("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":v("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":v("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:v("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":v("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":v("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:v("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:v("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":v("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:v("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":v("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":v("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":v("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":v("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};a.events.push(["addFont",function(k){var R=k.font,O=I.Unicode[R.postScriptName];O&&(R.metadata.Unicode={},R.metadata.Unicode.widths=O.widths,R.metadata.Unicode.kerning=O.kerning);var F=S.Unicode[R.postScriptName];F&&(R.metadata.Unicode.encoding=F,R.encoding=F.codePages[0])}])}(Ms.API),function(a){var o=function(c){for(var d=c.length,h=new Uint8Array(d),m=0;m<d;m++)h[m]=c.charCodeAt(m);return h};a.API.events.push(["addFont",function(c){var d=void 0,h=c.font,m=c.instance;if(!h.isStandardFont){if(m===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+h.postScriptName+"').");if(typeof(d=m.existsFileInVFS(h.postScriptName)===!1?m.loadFile(h.postScriptName):m.getFileFromVFS(h.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+h.postScriptName+"').");(function(g,x){x=/^\x00\x01\x00\x00/.test(x)?o(x):o(Cy(x)),g.metadata=a.API.TTFFont.open(x),g.metadata.Unicode=g.metadata.Unicode||{encoding:{},kerning:{},widths:[]},g.metadata.glyIdsUsed=[0]})(h,d)}}])}(Ms),Ms.API.addSvgAsImage=function(a,o,c,d,h,m,g,x){if(isNaN(o)||isNaN(c))throw Dn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(d)||isNaN(h))throw Dn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var v=document.createElement("canvas");v.width=d,v.height=h;var E=v.getContext("2d");E.fillStyle="#fff",E.fillRect(0,0,v.width,v.height);var S={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},I=this;return(sr.canvg?Promise.resolve(sr.canvg):xT(()=>import("./index.es-QGJJl75w.js"),__vite__mapDeps([0,1,2]))).catch(function(k){return Promise.reject(new Error("Could not load canvg: "+k))}).then(function(k){return k.default?k.default:k}).then(function(k){return k.fromString(E,a,S)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(k){return k.render(S)}).then(function(){I.addImage(v.toDataURL("image/jpeg",1),o,c,d,h,g,x)})},Ms.API.putTotalPages=function(a){var o,c=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(o=new RegExp(a,"g"),c=this.internal.getNumberOfPages()):(o=new RegExp(this.pdfEscape16(a,this.internal.getFont()),"g"),c=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var d=1;d<=this.internal.getNumberOfPages();d++)for(var h=0;h<this.internal.pages[d].length;h++)this.internal.pages[d][h]=this.internal.pages[d][h].replace(o,c);return this},Ms.API.viewerPreferences=function(a,o){var c;a=a||{},o=o||!1;var d,h,m,g={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},x=Object.keys(g),v=[],E=0,S=0,I=0;function k(O,F){var M,Q=!1;for(M=0;M<O.length;M+=1)O[M]===F&&(Q=!0);return Q}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(g)),this.internal.viewerpreferences.isSubscribed=!1),c=this.internal.viewerpreferences.configuration,a==="reset"||o===!0){var R=x.length;for(I=0;I<R;I+=1)c[x[I]].value=c[x[I]].defaultValue,c[x[I]].explicitSet=!1}if(bn(a)==="object"){for(h in a)if(m=a[h],k(x,h)&&m!==void 0){if(c[h].type==="boolean"&&typeof m=="boolean")c[h].value=m;else if(c[h].type==="name"&&k(c[h].valueSet,m))c[h].value=m;else if(c[h].type==="integer"&&Number.isInteger(m))c[h].value=m;else if(c[h].type==="array"){for(E=0;E<m.length;E+=1)if(d=!0,m[E].length===1&&typeof m[E][0]=="number")v.push(String(m[E]-1));else if(m[E].length>1){for(S=0;S<m[E].length;S+=1)typeof m[E][S]!="number"&&(d=!1);d===!0&&v.push([m[E][0]-1,m[E][1]-1].join(" "))}c[h].value="["+v.join(" ")+"]"}else c[h].value=c[h].defaultValue;c[h].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var O,F=[];for(O in c)c[O].explicitSet===!0&&(c[O].type==="name"?F.push("/"+O+" /"+c[O].value):F.push("/"+O+" "+c[O].value));F.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+F.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=c,this},Ms.API.addMetadata=function(a,o){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:a,namespaceUri:o??"http://jspdf.default.namespaceuri/",rawXml:typeof o=="boolean"&&o},this.internal.events.subscribe("putCatalog",Wge),this.internal.events.subscribe("postPutResources",Kge)),this},function(a){var o=a.API,c=o.pdfEscape16=function(m,g){for(var x,v=g.metadata.Unicode.widths,E=["","0","00","000","0000"],S=[""],I=0,k=m.length;I<k;++I){if(x=g.metadata.characterToGlyph(m.charCodeAt(I)),g.metadata.glyIdsUsed.push(x),g.metadata.toUnicode[x]=m.charCodeAt(I),v.indexOf(x)==-1&&(v.push(x),v.push([parseInt(g.metadata.widthOfGlyph(x),10)])),x=="0")return S.join("");x=x.toString(16),S.push(E[4-x.length],x)}return S.join("")},d=function(m){var g,x,v,E,S,I,k;for(S=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,v=[],I=0,k=(x=Object.keys(m).sort(function(R,O){return R-O})).length;I<k;I++)g=x[I],v.length>=100&&(S+=`
`+v.length+` beginbfchar
`+v.join(`
`)+`
endbfchar`,v=[]),m[g]!==void 0&&m[g]!==null&&typeof m[g].toString=="function"&&(E=("0000"+m[g].toString(16)).slice(-4),g=("0000"+(+g).toString(16)).slice(-4),v.push("<"+g+"><"+E+">"));return v.length&&(S+=`
`+v.length+` beginbfchar
`+v.join(`
`)+`
endbfchar
`),S+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};o.events.push(["putFont",function(m){(function(g){var x=g.font,v=g.out,E=g.newObject,S=g.putStream;if(x.metadata instanceof a.API.TTFFont&&x.encoding==="Identity-H"){for(var I=x.metadata.Unicode.widths,k=x.metadata.subset.encode(x.metadata.glyIdsUsed,1),R="",O=0;O<k.length;O++)R+=String.fromCharCode(k[O]);var F=E();S({data:R,addLength1:!0,objectId:F}),v("endobj");var M=E();S({data:d(x.metadata.toUnicode),addLength1:!0,objectId:M}),v("endobj");var Q=E();v("<<"),v("/Type /FontDescriptor"),v("/FontName /"+Ag(x.fontName)),v("/FontFile2 "+F+" 0 R"),v("/FontBBox "+a.API.PDFObject.convert(x.metadata.bbox)),v("/Flags "+x.metadata.flags),v("/StemV "+x.metadata.stemV),v("/ItalicAngle "+x.metadata.italicAngle),v("/Ascent "+x.metadata.ascender),v("/Descent "+x.metadata.decender),v("/CapHeight "+x.metadata.capHeight),v(">>"),v("endobj");var Z=E();v("<<"),v("/Type /Font"),v("/BaseFont /"+Ag(x.fontName)),v("/FontDescriptor "+Q+" 0 R"),v("/W "+a.API.PDFObject.convert(I)),v("/CIDToGIDMap /Identity"),v("/DW 1000"),v("/Subtype /CIDFontType2"),v("/CIDSystemInfo"),v("<<"),v("/Supplement 0"),v("/Registry (Adobe)"),v("/Ordering ("+x.encoding+")"),v(">>"),v(">>"),v("endobj"),x.objectNumber=E(),v("<<"),v("/Type /Font"),v("/Subtype /Type0"),v("/ToUnicode "+M+" 0 R"),v("/BaseFont /"+Ag(x.fontName)),v("/Encoding /"+x.encoding),v("/DescendantFonts ["+Z+" 0 R]"),v(">>"),v("endobj"),x.isAlreadyPutted=!0}})(m)}]),o.events.push(["putFont",function(m){(function(g){var x=g.font,v=g.out,E=g.newObject,S=g.putStream;if(x.metadata instanceof a.API.TTFFont&&x.encoding==="WinAnsiEncoding"){for(var I=x.metadata.rawData,k="",R=0;R<I.length;R++)k+=String.fromCharCode(I[R]);var O=E();S({data:k,addLength1:!0,objectId:O}),v("endobj");var F=E();S({data:d(x.metadata.toUnicode),addLength1:!0,objectId:F}),v("endobj");var M=E();v("<<"),v("/Descent "+x.metadata.decender),v("/CapHeight "+x.metadata.capHeight),v("/StemV "+x.metadata.stemV),v("/Type /FontDescriptor"),v("/FontFile2 "+O+" 0 R"),v("/Flags 96"),v("/FontBBox "+a.API.PDFObject.convert(x.metadata.bbox)),v("/FontName /"+Ag(x.fontName)),v("/ItalicAngle "+x.metadata.italicAngle),v("/Ascent "+x.metadata.ascender),v(">>"),v("endobj"),x.objectNumber=E();for(var Q=0;Q<x.metadata.hmtx.widths.length;Q++)x.metadata.hmtx.widths[Q]=parseInt(x.metadata.hmtx.widths[Q]*(1e3/x.metadata.head.unitsPerEm));v("<</Subtype/TrueType/Type/Font/ToUnicode "+F+" 0 R/BaseFont/"+Ag(x.fontName)+"/FontDescriptor "+M+" 0 R/Encoding/"+x.encoding+" /FirstChar 29 /LastChar 255 /Widths "+a.API.PDFObject.convert(x.metadata.hmtx.widths)+">>"),v("endobj"),x.isAlreadyPutted=!0}})(m)}]);var h=function(m){var g,x=m.text||"",v=m.x,E=m.y,S=m.options||{},I=m.mutex||{},k=I.pdfEscape,R=I.activeFontKey,O=I.fonts,F=R,M="",Q=0,Z="",$=O[F].encoding;if(O[F].encoding!=="Identity-H")return{text:x,x:v,y:E,options:S,mutex:I};for(Z=x,F=R,Array.isArray(x)&&(Z=x[0]),Q=0;Q<Z.length;Q+=1)O[F].metadata.hasOwnProperty("cmap")&&(g=O[F].metadata.cmap.unicode.codeMap[Z[Q].charCodeAt(0)]),g||Z[Q].charCodeAt(0)<256&&O[F].metadata.hasOwnProperty("Unicode")?M+=Z[Q]:M+="";var X="";return parseInt(F.slice(1))<14||$==="WinAnsiEncoding"?X=k(M,F).split("").map(function(be){return be.charCodeAt(0).toString(16)}).join(""):$==="Identity-H"&&(X=c(M,O[F])),I.isHex=!0,{text:X,x:v,y:E,options:S,mutex:I}};o.events.push(["postProcessText",function(m){var g=m.text||"",x=[],v={text:g,x:m.x,y:m.y,options:m.options,mutex:m.mutex};if(Array.isArray(g)){var E=0;for(E=0;E<g.length;E+=1)Array.isArray(g[E])&&g[E].length===3?x.push([h(Object.assign({},v,{text:g[E][0]})).text,g[E][1],g[E][2]]):x.push(h(Object.assign({},v,{text:g[E]})).text);m.text=x}else m.text=h(Object.assign({},v,{text:g})).text}])}(Ms),function(a){var o=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};a.existsFileInVFS=function(c){return o.call(this),this.internal.vFS[c]!==void 0},a.addFileToVFS=function(c,d){return o.call(this),this.internal.vFS[c]=d,this},a.getFileFromVFS=function(c){return o.call(this),this.internal.vFS[c]!==void 0?this.internal.vFS[c]:null}}(Ms.API),function(a){a.__bidiEngine__=a.prototype.__bidiEngine__=function(d){var h,m,g,x,v,E,S,I=o,k=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],R=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],O={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},F={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},M=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],Q=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),Z=!1,$=0;this.__bidiEngine__={};var X=function(J){var Y=J.charCodeAt(),se=Y>>8,oe=F[se];return oe!==void 0?I[256*oe+(255&Y)]:se===252||se===253?"AL":Q.test(se)?"L":se===8?"R":"N"},be=function(J){for(var Y,se=0;se<J.length;se++){if((Y=X(J.charAt(se)))==="L")return!1;if(Y==="R")return!0}return!1},me=function(J,Y,se,oe){var Te,he,Ce,ee,Be=Y[oe];switch(Be){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":Z=!1;break;case"N":case"AN":break;case"EN":Z&&(Be="AN");break;case"AL":Z=!0,Be="R";break;case"WS":case"BN":Be="N";break;case"CS":oe<1||oe+1>=Y.length||(Te=se[oe-1])!=="EN"&&Te!=="AN"||(he=Y[oe+1])!=="EN"&&he!=="AN"?Be="N":Z&&(he="AN"),Be=he===Te?he:"N";break;case"ES":Be=(Te=oe>0?se[oe-1]:"B")==="EN"&&oe+1<Y.length&&Y[oe+1]==="EN"?"EN":"N";break;case"ET":if(oe>0&&se[oe-1]==="EN"){Be="EN";break}if(Z){Be="N";break}for(Ce=oe+1,ee=Y.length;Ce<ee&&Y[Ce]==="ET";)Ce++;Be=Ce<ee&&Y[Ce]==="EN"?"EN":"N";break;case"NSM":if(g&&!x){for(ee=Y.length,Ce=oe+1;Ce<ee&&Y[Ce]==="NSM";)Ce++;if(Ce<ee){var He=J[oe],Ue=He>=1425&&He<=2303||He===64286;if(Te=Y[Ce],Ue&&(Te==="R"||Te==="AL")){Be="R";break}}}Be=oe<1||(Te=Y[oe-1])==="B"?"N":se[oe-1];break;case"B":Z=!1,h=!0,Be=$;break;case"S":m=!0,Be="N"}return Be},Ne=function(J,Y,se){var oe=J.split("");return se&&le(oe,se,{hiLevel:$}),oe.reverse(),Y&&Y.reverse(),oe.join("")},le=function(J,Y,se){var oe,Te,he,Ce,ee,Be=-1,He=J.length,Ue=0,re=[],ve=$?R:k,fe=[];for(Z=!1,h=!1,m=!1,Te=0;Te<He;Te++)fe[Te]=X(J[Te]);for(he=0;he<He;he++){if(ee=Ue,re[he]=me(J,fe,re,he),oe=240&(Ue=ve[ee][O[re[he]]]),Ue&=15,Y[he]=Ce=ve[Ue][5],oe>0)if(oe===16){for(Te=Be;Te<he;Te++)Y[Te]=1;Be=-1}else Be=-1;if(ve[Ue][6])Be===-1&&(Be=he);else if(Be>-1){for(Te=Be;Te<he;Te++)Y[Te]=Ce;Be=-1}fe[he]==="B"&&(Y[he]=0),se.hiLevel|=Ce}m&&function(Ie,je,Ee){for(var We=0;We<Ee;We++)if(Ie[We]==="S"){je[We]=$;for(var ze=We-1;ze>=0&&Ie[ze]==="WS";ze--)je[ze]=$}}(fe,Y,He)},H=function(J,Y,se,oe,Te){if(!(Te.hiLevel<J)){if(J===1&&$===1&&!h)return Y.reverse(),void(se&&se.reverse());for(var he,Ce,ee,Be,He=Y.length,Ue=0;Ue<He;){if(oe[Ue]>=J){for(ee=Ue+1;ee<He&&oe[ee]>=J;)ee++;for(Be=Ue,Ce=ee-1;Be<Ce;Be++,Ce--)he=Y[Be],Y[Be]=Y[Ce],Y[Ce]=he,se&&(he=se[Be],se[Be]=se[Ce],se[Ce]=he);Ue=ee}Ue++}}},Ae=function(J,Y,se){var oe=J.split(""),Te={hiLevel:$};return se||(se=[]),le(oe,se,Te),function(he,Ce,ee){if(ee.hiLevel!==0&&S)for(var Be,He=0;He<he.length;He++)Ce[He]===1&&(Be=M.indexOf(he[He]))>=0&&(he[He]=M[Be+1])}(oe,se,Te),H(2,oe,Y,se,Te),H(1,oe,Y,se,Te),oe.join("")};return this.__bidiEngine__.doBidiReorder=function(J,Y,se){if(function(Te,he){if(he)for(var Ce=0;Ce<Te.length;Ce++)he[Ce]=Ce;x===void 0&&(x=be(Te)),E===void 0&&(E=be(Te))}(J,Y),g||!v||E)if(g&&v&&x^E)$=x?1:0,J=Ne(J,Y,se);else if(!g&&v&&E)$=x?1:0,J=Ae(J,Y,se),J=Ne(J,Y);else if(!g||x||v||E){if(g&&!v&&x^E)J=Ne(J,Y),x?($=0,J=Ae(J,Y,se)):($=1,J=Ae(J,Y,se),J=Ne(J,Y));else if(g&&x&&!v&&E)$=1,J=Ae(J,Y,se),J=Ne(J,Y);else if(!g&&!v&&x^E){var oe=S;x?($=1,J=Ae(J,Y,se),$=0,S=!1,J=Ae(J,Y,se),S=oe):($=0,J=Ae(J,Y,se),J=Ne(J,Y),$=1,S=!1,J=Ae(J,Y,se),S=oe,J=Ne(J,Y))}}else $=0,J=Ae(J,Y,se);else $=x?1:0,J=Ae(J,Y,se);return J},this.__bidiEngine__.setOptions=function(J){J&&(g=J.isInputVisual,v=J.isOutputVisual,x=J.isInputRtl,E=J.isOutputRtl,S=J.isSymmetricSwapping)},this.__bidiEngine__.setOptions(d),this.__bidiEngine__};var o=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],c=new a.__bidiEngine__({isInputVisual:!0});a.API.events.push(["postProcessText",function(d){var h=d.text;d.x,d.y;var m=d.options||{};d.mutex,m.lang;var g=[];if(m.isInputVisual=typeof m.isInputVisual!="boolean"||m.isInputVisual,c.setOptions(m),Object.prototype.toString.call(h)==="[object Array]"){var x=0;for(g=[],x=0;x<h.length;x+=1)Object.prototype.toString.call(h[x])==="[object Array]"?g.push([c.doBidiReorder(h[x][0]),h[x][1],h[x][2]]):g.push([c.doBidiReorder(h[x])]);d.text=g}else d.text=c.doBidiReorder(h);c.setOptions({isInputVisual:!0})}])}(Ms),Ms.API.TTFFont=function(){function a(o){var c;if(this.rawData=o,c=this.contents=new uh(o),this.contents.pos=4,c.readString(4)==="ttcf")throw new Error("TTCF not supported.");c.pos=0,this.parse(),this.subset=new o0e(this),this.registerTTF()}return a.open=function(o){return new a(o)},a.prototype.parse=function(){return this.directory=new zge(this.contents),this.head=new Yge(this),this.name=new e0e(this),this.cmap=new wG(this),this.toUnicode={},this.hhea=new Xge(this),this.maxp=new t0e(this),this.hmtx=new s0e(this),this.post=new $ge(this),this.os2=new Jge(this),this.loca=new a0e(this),this.glyf=new r0e(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},a.prototype.registerTTF=function(){var o,c,d,h,m;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var g,x,v,E;for(E=[],g=0,x=(v=this.bbox).length;g<x;g++)o=v[g],E.push(Math.round(o*this.scaleFactor));return E}).call(this),this.stemV=0,this.post.exists?(d=255&(h=this.post.italic_angle),32768&(c=h>>16)&&(c=-(1+(65535^c))),this.italicAngle=+(c+"."+d)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(m=this.familyClass)===1||m===2||m===3||m===4||m===5||m===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},a.prototype.characterToGlyph=function(o){var c;return((c=this.cmap.unicode)!=null?c.codeMap[o]:void 0)||0},a.prototype.widthOfGlyph=function(o){var c;return c=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(o).advance*c},a.prototype.widthOfString=function(o,c,d){var h,m,g,x;for(g=0,m=0,x=(o=""+o).length;0<=x?m<x:m>x;m=0<=x?++m:--m)h=o.charCodeAt(m),g+=this.widthOfGlyph(this.characterToGlyph(h))+d*(1e3/c)||0;return g*(c/1e3)},a.prototype.lineHeight=function(o,c){var d;return c==null&&(c=!1),d=c?this.lineGap:0,(this.ascender+d-this.decender)/1e3*o},a}();var nd,uh=function(){function a(o){this.data=o??[],this.pos=0,this.length=this.data.length}return a.prototype.readByte=function(){return this.data[this.pos++]},a.prototype.writeByte=function(o){return this.data[this.pos++]=o},a.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},a.prototype.writeUInt32=function(o){return this.writeByte(o>>>24&255),this.writeByte(o>>16&255),this.writeByte(o>>8&255),this.writeByte(255&o)},a.prototype.readInt32=function(){var o;return(o=this.readUInt32())>=2147483648?o-4294967296:o},a.prototype.writeInt32=function(o){return o<0&&(o+=4294967296),this.writeUInt32(o)},a.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},a.prototype.writeUInt16=function(o){return this.writeByte(o>>8&255),this.writeByte(255&o)},a.prototype.readInt16=function(){var o;return(o=this.readUInt16())>=32768?o-65536:o},a.prototype.writeInt16=function(o){return o<0&&(o+=65536),this.writeUInt16(o)},a.prototype.readString=function(o){var c,d;for(d=[],c=0;0<=o?c<o:c>o;c=0<=o?++c:--c)d[c]=String.fromCharCode(this.readByte());return d.join("")},a.prototype.writeString=function(o){var c,d,h;for(h=[],c=0,d=o.length;0<=d?c<d:c>d;c=0<=d?++c:--c)h.push(this.writeByte(o.charCodeAt(c)));return h},a.prototype.readShort=function(){return this.readInt16()},a.prototype.writeShort=function(o){return this.writeInt16(o)},a.prototype.readLongLong=function(){var o,c,d,h,m,g,x,v;return o=this.readByte(),c=this.readByte(),d=this.readByte(),h=this.readByte(),m=this.readByte(),g=this.readByte(),x=this.readByte(),v=this.readByte(),128&o?-1*(72057594037927940*(255^o)+281474976710656*(255^c)+1099511627776*(255^d)+4294967296*(255^h)+16777216*(255^m)+65536*(255^g)+256*(255^x)+(255^v)+1):72057594037927940*o+281474976710656*c+1099511627776*d+4294967296*h+16777216*m+65536*g+256*x+v},a.prototype.writeLongLong=function(o){var c,d;return c=Math.floor(o/4294967296),d=4294967295&o,this.writeByte(c>>24&255),this.writeByte(c>>16&255),this.writeByte(c>>8&255),this.writeByte(255&c),this.writeByte(d>>24&255),this.writeByte(d>>16&255),this.writeByte(d>>8&255),this.writeByte(255&d)},a.prototype.readInt=function(){return this.readInt32()},a.prototype.writeInt=function(o){return this.writeInt32(o)},a.prototype.read=function(o){var c,d;for(c=[],d=0;0<=o?d<o:d>o;d=0<=o?++d:--d)c.push(this.readByte());return c},a.prototype.write=function(o){var c,d,h,m;for(m=[],d=0,h=o.length;d<h;d++)c=o[d],m.push(this.writeByte(c));return m},a}(),zge=function(){var a;function o(c){var d,h,m;for(this.scalarType=c.readInt(),this.tableCount=c.readShort(),this.searchRange=c.readShort(),this.entrySelector=c.readShort(),this.rangeShift=c.readShort(),this.tables={},h=0,m=this.tableCount;0<=m?h<m:h>m;h=0<=m?++h:--h)d={tag:c.readString(4),checksum:c.readInt(),offset:c.readInt(),length:c.readInt()},this.tables[d.tag]=d}return o.prototype.encode=function(c){var d,h,m,g,x,v,E,S,I,k,R,O,F;for(F in R=Object.keys(c).length,v=Math.log(2),I=16*Math.floor(Math.log(R)/v),g=Math.floor(I/v),S=16*R-I,(h=new uh).writeInt(this.scalarType),h.writeShort(R),h.writeShort(I),h.writeShort(g),h.writeShort(S),m=16*R,E=h.pos+m,x=null,O=[],c)for(k=c[F],h.writeString(F),h.writeInt(a(k)),h.writeInt(E),h.writeInt(k.length),O=O.concat(k),F==="head"&&(x=E),E+=k.length;E%4;)O.push(0),E++;return h.write(O),d=2981146554-a(h.data),h.pos=x+8,h.writeUInt32(d),h.data},a=function(c){var d,h,m,g;for(c=_G.call(c);c.length%4;)c.push(0);for(m=new uh(c),h=0,d=0,g=c.length;d<g;d=d+=4)h+=m.readUInt32();return 4294967295&h},o}(),qge={}.hasOwnProperty,Zd=function(a,o){for(var c in o)qge.call(o,c)&&(a[c]=o[c]);function d(){this.constructor=a}return d.prototype=o.prototype,a.prototype=new d,a.__super__=o.prototype,a};nd=function(){function a(o){var c;this.file=o,c=this.file.directory.tables[this.tag],this.exists=!!c,c&&(this.offset=c.offset,this.length=c.length,this.parse(this.file.contents))}return a.prototype.parse=function(){},a.prototype.encode=function(){},a.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},a}();var Yge=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="head",a.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.revision=o.readInt(),this.checkSumAdjustment=o.readInt(),this.magicNumber=o.readInt(),this.flags=o.readShort(),this.unitsPerEm=o.readShort(),this.created=o.readLongLong(),this.modified=o.readLongLong(),this.xMin=o.readShort(),this.yMin=o.readShort(),this.xMax=o.readShort(),this.yMax=o.readShort(),this.macStyle=o.readShort(),this.lowestRecPPEM=o.readShort(),this.fontDirectionHint=o.readShort(),this.indexToLocFormat=o.readShort(),this.glyphDataFormat=o.readShort()},a.prototype.encode=function(o){var c;return(c=new uh).writeInt(this.version),c.writeInt(this.revision),c.writeInt(this.checkSumAdjustment),c.writeInt(this.magicNumber),c.writeShort(this.flags),c.writeShort(this.unitsPerEm),c.writeLongLong(this.created),c.writeLongLong(this.modified),c.writeShort(this.xMin),c.writeShort(this.yMin),c.writeShort(this.xMax),c.writeShort(this.yMax),c.writeShort(this.macStyle),c.writeShort(this.lowestRecPPEM),c.writeShort(this.fontDirectionHint),c.writeShort(o),c.writeShort(this.glyphDataFormat),c.data},a}(),YV=function(){function a(o,c){var d,h,m,g,x,v,E,S,I,k,R,O,F,M,Q,Z,$;switch(this.platformID=o.readUInt16(),this.encodingID=o.readShort(),this.offset=c+o.readInt(),I=o.pos,o.pos=this.offset,this.format=o.readUInt16(),this.length=o.readUInt16(),this.language=o.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(v=0;v<256;++v)this.codeMap[v]=o.readByte();break;case 4:for(R=o.readUInt16(),k=R/2,o.pos+=6,m=function(){var X,be;for(be=[],v=X=0;0<=k?X<k:X>k;v=0<=k?++X:--X)be.push(o.readUInt16());return be}(),o.pos+=2,F=function(){var X,be;for(be=[],v=X=0;0<=k?X<k:X>k;v=0<=k?++X:--X)be.push(o.readUInt16());return be}(),E=function(){var X,be;for(be=[],v=X=0;0<=k?X<k:X>k;v=0<=k?++X:--X)be.push(o.readUInt16());return be}(),S=function(){var X,be;for(be=[],v=X=0;0<=k?X<k:X>k;v=0<=k?++X:--X)be.push(o.readUInt16());return be}(),h=(this.length-o.pos+this.offset)/2,x=function(){var X,be;for(be=[],v=X=0;0<=h?X<h:X>h;v=0<=h?++X:--X)be.push(o.readUInt16());return be}(),v=Q=0,$=m.length;Q<$;v=++Q)for(M=m[v],d=Z=O=F[v];O<=M?Z<=M:Z>=M;d=O<=M?++Z:--Z)S[v]===0?g=d+E[v]:(g=x[S[v]/2+(d-O)-(k-v)]||0)!==0&&(g+=E[v]),this.codeMap[d]=65535&g}o.pos=I}return a.encode=function(o,c){var d,h,m,g,x,v,E,S,I,k,R,O,F,M,Q,Z,$,X,be,me,Ne,le,H,Ae,J,Y,se,oe,Te,he,Ce,ee,Be,He,Ue,re,ve,fe,Ie,je,Ee,We,ze,st,bt,Qe;switch(oe=new uh,g=Object.keys(o).sort(function(rt,Nt){return rt-Nt}),c){case"macroman":for(F=0,M=function(){var rt=[];for(O=0;O<256;++O)rt.push(0);return rt}(),Z={0:0},m={},Te=0,Be=g.length;Te<Be;Te++)Z[ze=o[h=g[Te]]]==null&&(Z[ze]=++F),m[h]={old:o[h],new:Z[o[h]]},M[h]=Z[o[h]];return oe.writeUInt16(1),oe.writeUInt16(0),oe.writeUInt32(12),oe.writeUInt16(0),oe.writeUInt16(262),oe.writeUInt16(0),oe.write(M),{charMap:m,subtable:oe.data,maxGlyphID:F+1};case"unicode":for(Y=[],I=[],$=0,Z={},d={},Q=E=null,he=0,He=g.length;he<He;he++)Z[be=o[h=g[he]]]==null&&(Z[be]=++$),d[h]={old:be,new:Z[be]},x=Z[be]-h,Q!=null&&x===E||(Q&&I.push(Q),Y.push(h),E=x),Q=h;for(Q&&I.push(Q),I.push(65535),Y.push(65535),Ae=2*(H=Y.length),le=2*Math.pow(Math.log(H)/Math.LN2,2),k=Math.log(le/2)/Math.LN2,Ne=2*H-le,v=[],me=[],R=[],O=Ce=0,Ue=Y.length;Ce<Ue;O=++Ce){if(J=Y[O],S=I[O],J===65535){v.push(0),me.push(0);break}if(J-(se=d[J].new)>=32768)for(v.push(0),me.push(2*(R.length+H-O)),h=ee=J;J<=S?ee<=S:ee>=S;h=J<=S?++ee:--ee)R.push(d[h].new);else v.push(se-J),me.push(0)}for(oe.writeUInt16(3),oe.writeUInt16(1),oe.writeUInt32(12),oe.writeUInt16(4),oe.writeUInt16(16+8*H+2*R.length),oe.writeUInt16(0),oe.writeUInt16(Ae),oe.writeUInt16(le),oe.writeUInt16(k),oe.writeUInt16(Ne),Ee=0,re=I.length;Ee<re;Ee++)h=I[Ee],oe.writeUInt16(h);for(oe.writeUInt16(0),We=0,ve=Y.length;We<ve;We++)h=Y[We],oe.writeUInt16(h);for(st=0,fe=v.length;st<fe;st++)x=v[st],oe.writeUInt16(x);for(bt=0,Ie=me.length;bt<Ie;bt++)X=me[bt],oe.writeUInt16(X);for(Qe=0,je=R.length;Qe<je;Qe++)F=R[Qe],oe.writeUInt16(F);return{charMap:d,subtable:oe.data,maxGlyphID:$+1}}},a}(),wG=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="cmap",a.prototype.parse=function(o){var c,d,h;for(o.pos=this.offset,this.version=o.readUInt16(),h=o.readUInt16(),this.tables=[],this.unicode=null,d=0;0<=h?d<h:d>h;d=0<=h?++d:--d)c=new YV(o,this.offset),this.tables.push(c),c.isUnicode&&this.unicode==null&&(this.unicode=c);return!0},a.encode=function(o,c){var d,h;return c==null&&(c="macroman"),d=YV.encode(o,c),(h=new uh).writeUInt16(0),h.writeUInt16(1),d.table=h.data.concat(d.subtable),d},a}(),Xge=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="hhea",a.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.ascender=o.readShort(),this.decender=o.readShort(),this.lineGap=o.readShort(),this.advanceWidthMax=o.readShort(),this.minLeftSideBearing=o.readShort(),this.minRightSideBearing=o.readShort(),this.xMaxExtent=o.readShort(),this.caretSlopeRise=o.readShort(),this.caretSlopeRun=o.readShort(),this.caretOffset=o.readShort(),o.pos+=8,this.metricDataFormat=o.readShort(),this.numberOfMetrics=o.readUInt16()},a}(),Jge=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="OS/2",a.prototype.parse=function(o){if(o.pos=this.offset,this.version=o.readUInt16(),this.averageCharWidth=o.readShort(),this.weightClass=o.readUInt16(),this.widthClass=o.readUInt16(),this.type=o.readShort(),this.ySubscriptXSize=o.readShort(),this.ySubscriptYSize=o.readShort(),this.ySubscriptXOffset=o.readShort(),this.ySubscriptYOffset=o.readShort(),this.ySuperscriptXSize=o.readShort(),this.ySuperscriptYSize=o.readShort(),this.ySuperscriptXOffset=o.readShort(),this.ySuperscriptYOffset=o.readShort(),this.yStrikeoutSize=o.readShort(),this.yStrikeoutPosition=o.readShort(),this.familyClass=o.readShort(),this.panose=function(){var c,d;for(d=[],c=0;c<10;++c)d.push(o.readByte());return d}(),this.charRange=function(){var c,d;for(d=[],c=0;c<4;++c)d.push(o.readInt());return d}(),this.vendorID=o.readString(4),this.selection=o.readShort(),this.firstCharIndex=o.readShort(),this.lastCharIndex=o.readShort(),this.version>0&&(this.ascent=o.readShort(),this.descent=o.readShort(),this.lineGap=o.readShort(),this.winAscent=o.readShort(),this.winDescent=o.readShort(),this.codePageRange=function(){var c,d;for(d=[],c=0;c<2;c=++c)d.push(o.readInt());return d}(),this.version>1))return this.xHeight=o.readShort(),this.capHeight=o.readShort(),this.defaultChar=o.readShort(),this.breakChar=o.readShort(),this.maxContext=o.readShort()},a}(),$ge=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="post",a.prototype.parse=function(o){var c,d,h;switch(o.pos=this.offset,this.format=o.readInt(),this.italicAngle=o.readInt(),this.underlinePosition=o.readShort(),this.underlineThickness=o.readShort(),this.isFixedPitch=o.readInt(),this.minMemType42=o.readInt(),this.maxMemType42=o.readInt(),this.minMemType1=o.readInt(),this.maxMemType1=o.readInt(),this.format){case 65536:case 196608:break;case 131072:var m;for(d=o.readUInt16(),this.glyphNameIndex=[],m=0;0<=d?m<d:m>d;m=0<=d?++m:--m)this.glyphNameIndex.push(o.readUInt16());for(this.names=[],h=[];o.pos<this.offset+this.length;)c=o.readByte(),h.push(this.names.push(o.readString(c)));return h;case 151552:return d=o.readUInt16(),this.offsets=o.read(d);case 262144:return this.map=(function(){var g,x,v;for(v=[],m=g=0,x=this.file.maxp.numGlyphs;0<=x?g<x:g>x;m=0<=x?++g:--g)v.push(o.readUInt32());return v}).call(this)}},a}(),Zge=function(a,o){this.raw=a,this.length=a.length,this.platformID=o.platformID,this.encodingID=o.encodingID,this.languageID=o.languageID},e0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="name",a.prototype.parse=function(o){var c,d,h,m,g,x,v,E,S,I,k;for(o.pos=this.offset,o.readShort(),c=o.readShort(),x=o.readShort(),d=[],m=0;0<=c?m<c:m>c;m=0<=c?++m:--m)d.push({platformID:o.readShort(),encodingID:o.readShort(),languageID:o.readShort(),nameID:o.readShort(),length:o.readShort(),offset:this.offset+x+o.readShort()});for(v={},m=S=0,I=d.length;S<I;m=++S)h=d[m],o.pos=h.offset,E=o.readString(h.length),g=new Zge(E,h),v[k=h.nameID]==null&&(v[k]=[]),v[h.nameID].push(g);this.strings=v,this.copyright=v[0],this.fontFamily=v[1],this.fontSubfamily=v[2],this.uniqueSubfamily=v[3],this.fontName=v[4],this.version=v[5];try{this.postscriptName=v[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=v[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=v[7],this.manufacturer=v[8],this.designer=v[9],this.description=v[10],this.vendorUrl=v[11],this.designerUrl=v[12],this.license=v[13],this.licenseUrl=v[14],this.preferredFamily=v[15],this.preferredSubfamily=v[17],this.compatibleFull=v[18],this.sampleText=v[19]},a}(),t0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="maxp",a.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.numGlyphs=o.readUInt16(),this.maxPoints=o.readUInt16(),this.maxContours=o.readUInt16(),this.maxCompositePoints=o.readUInt16(),this.maxComponentContours=o.readUInt16(),this.maxZones=o.readUInt16(),this.maxTwilightPoints=o.readUInt16(),this.maxStorage=o.readUInt16(),this.maxFunctionDefs=o.readUInt16(),this.maxInstructionDefs=o.readUInt16(),this.maxStackElements=o.readUInt16(),this.maxSizeOfInstructions=o.readUInt16(),this.maxComponentElements=o.readUInt16(),this.maxComponentDepth=o.readUInt16()},a}(),s0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="hmtx",a.prototype.parse=function(o){var c,d,h,m,g,x,v;for(o.pos=this.offset,this.metrics=[],c=0,x=this.file.hhea.numberOfMetrics;0<=x?c<x:c>x;c=0<=x?++c:--c)this.metrics.push({advance:o.readUInt16(),lsb:o.readInt16()});for(h=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var E,S;for(S=[],c=E=0;0<=h?E<h:E>h;c=0<=h?++E:--E)S.push(o.readInt16());return S}(),this.widths=(function(){var E,S,I,k;for(k=[],E=0,S=(I=this.metrics).length;E<S;E++)m=I[E],k.push(m.advance);return k}).call(this),d=this.widths[this.widths.length-1],v=[],c=g=0;0<=h?g<h:g>h;c=0<=h?++g:--g)v.push(this.widths.push(d));return v},a.prototype.forGlyph=function(o){return o in this.metrics?this.metrics[o]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[o-this.metrics.length]}},a}(),_G=[].slice,r0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="glyf",a.prototype.parse=function(){return this.cache={}},a.prototype.glyphFor=function(o){var c,d,h,m,g,x,v,E,S,I;return o in this.cache?this.cache[o]:(m=this.file.loca,c=this.file.contents,d=m.indexOf(o),(h=m.lengthOf(o))===0?this.cache[o]=null:(c.pos=this.offset+d,g=(x=new uh(c.read(h))).readShort(),E=x.readShort(),I=x.readShort(),v=x.readShort(),S=x.readShort(),this.cache[o]=g===-1?new i0e(x,E,I,v,S):new n0e(x,g,E,I,v,S),this.cache[o]))},a.prototype.encode=function(o,c,d){var h,m,g,x,v;for(g=[],m=[],x=0,v=c.length;x<v;x++)h=o[c[x]],m.push(g.length),h&&(g=g.concat(h.encode(d)));return m.push(g.length),{table:g,offsets:m}},a}(),n0e=function(){function a(o,c,d,h,m,g){this.raw=o,this.numberOfContours=c,this.xMin=d,this.yMin=h,this.xMax=m,this.yMax=g,this.compound=!1}return a.prototype.encode=function(){return this.raw.data},a}(),i0e=function(){function a(o,c,d,h,m){var g,x;for(this.raw=o,this.xMin=c,this.yMin=d,this.xMax=h,this.yMax=m,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],g=this.raw;x=g.readShort(),this.glyphOffsets.push(g.pos),this.glyphIDs.push(g.readUInt16()),32&x;)g.pos+=1&x?4:2,128&x?g.pos+=8:64&x?g.pos+=4:8&x&&(g.pos+=2)}return a.prototype.encode=function(){var o,c,d;for(c=new uh(_G.call(this.raw.data)),o=0,d=this.glyphIDs.length;o<d;++o)c.pos=this.glyphOffsets[o];return c.data},a}(),a0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return Zd(a,nd),a.prototype.tag="loca",a.prototype.parse=function(o){var c,d;return o.pos=this.offset,c=this.file.head.indexToLocFormat,this.offsets=c===0?(function(){var h,m;for(m=[],d=0,h=this.length;d<h;d+=2)m.push(2*o.readUInt16());return m}).call(this):(function(){var h,m;for(m=[],d=0,h=this.length;d<h;d+=4)m.push(o.readUInt32());return m}).call(this)},a.prototype.indexOf=function(o){return this.offsets[o]},a.prototype.lengthOf=function(o){return this.offsets[o+1]-this.offsets[o]},a.prototype.encode=function(o,c){for(var d=new Uint32Array(this.offsets.length),h=0,m=0,g=0;g<d.length;++g)if(d[g]=h,m<c.length&&c[m]==g){++m,d[g]=h;var x=this.offsets[g],v=this.offsets[g+1]-x;v>0&&(h+=v)}for(var E=new Array(4*d.length),S=0;S<d.length;++S)E[4*S+3]=255&d[S],E[4*S+2]=(65280&d[S])>>8,E[4*S+1]=(16711680&d[S])>>16,E[4*S]=(4278190080&d[S])>>24;return E},a}(),o0e=function(){function a(o){this.font=o,this.subset={},this.unicodes={},this.next=33}return a.prototype.generateCmap=function(){var o,c,d,h,m;for(c in h=this.font.cmap.tables[0].codeMap,o={},m=this.subset)d=m[c],o[c]=h[d];return o},a.prototype.glyphsFor=function(o){var c,d,h,m,g,x,v;for(h={},g=0,x=o.length;g<x;g++)h[m=o[g]]=this.font.glyf.glyphFor(m);for(m in c=[],h)(d=h[m])!=null&&d.compound&&c.push.apply(c,d.glyphIDs);if(c.length>0)for(m in v=this.glyphsFor(c))d=v[m],h[m]=d;return h},a.prototype.encode=function(o,c){var d,h,m,g,x,v,E,S,I,k,R,O,F,M,Q;for(h in d=wG.encode(this.generateCmap(),"unicode"),g=this.glyphsFor(o),R={0:0},Q=d.charMap)R[(v=Q[h]).old]=v.new;for(O in k=d.maxGlyphID,g)O in R||(R[O]=k++);return S=function(Z){var $,X;for($ in X={},Z)X[Z[$]]=$;return X}(R),I=Object.keys(S).sort(function(Z,$){return Z-$}),F=function(){var Z,$,X;for(X=[],Z=0,$=I.length;Z<$;Z++)x=I[Z],X.push(S[x]);return X}(),m=this.font.glyf.encode(g,F,R),E=this.font.loca.encode(m.offsets,F),M={cmap:this.font.cmap.raw(),glyf:m.table,loca:E,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(c)},this.font.os2.exists&&(M["OS/2"]=this.font.os2.raw()),this.font.directory.encode(M)},a}();Ms.API.PDFObject=function(){var a;function o(){}return a=function(c,d){return(Array(d+1).join("0")+c).slice(-d)},o.convert=function(c){var d,h,m,g;if(Array.isArray(c))return"["+function(){var x,v,E;for(E=[],x=0,v=c.length;x<v;x++)d=c[x],E.push(o.convert(d));return E}().join(" ")+"]";if(typeof c=="string")return"/"+c;if(c!=null&&c.isString)return"("+c+")";if(c instanceof Date)return"(D:"+a(c.getUTCFullYear(),4)+a(c.getUTCMonth(),2)+a(c.getUTCDate(),2)+a(c.getUTCHours(),2)+a(c.getUTCMinutes(),2)+a(c.getUTCSeconds(),2)+"Z)";if({}.toString.call(c)==="[object Object]"){for(h in m=["<<"],c)g=c[h],m.push("/"+h+" "+o.convert(g));return m.push(">>"),m.join(`
`)}return""+c},o}();function c0e(){var O,F,M,Q,Z,$,X,be,me,Ne,le,H,Ae,J;const{id:a}=sx(),[o,c]=te.useState(null),[d,h]=te.useState(!0),[m,g]=te.useState(null),[x,v]=te.useState(!1);te.useEffect(()=>{(async()=>{try{const{data:se}=await ll.getReport(a);c(se.report)}catch{Ct.error("Failed to load report")}finally{h(!1)}})()},[a]);const E=(Y,se)=>{const oe={name:Y,value:se.value,unit:se.unit||"",normalRange:se.normalRange||"N/A",status:se.status||"normal",description:se.description||"",recommendations:se.recommendations||[],foodsToConsume:se.foodsToConsume||[],foodsToAvoid:se.foodsToAvoid||[],symptoms:se.symptoms||[],severity:se.severity||""};g(oe),v(!0)},S=()=>{v(!1),g(null)},I=async()=>{const Y=document.getElementById("report-content");if(!Y){Ct.error("Could not find report content");return}const se=Ct.loading("Generating PDF...");try{const oe=Y.querySelectorAll(".no-pdf");oe.forEach(Ie=>Ie.style.display="none");const Te=await O7(Y,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff"});oe.forEach(Ie=>Ie.style.display="");const he=Te.toDataURL("image/png"),Ce=new Ms("p","mm","a4"),ee=Ce.internal.pageSize.getWidth(),Be=Ce.internal.pageSize.getHeight(),He=Te.width,Ue=Te.height,re=Math.min(ee/He,Be/Ue),ve=(ee-He*re)/2;Ce.addImage(he,"PNG",ve,0,He*re,Ue*re),Ce.save(`Health_Report_${o.reportType}_${a.substring(0,8)}.pdf`),Ct.success("Report downloaded successfully!",{id:se})}catch(oe){console.error("PDF Generation Error:",oe),Ct.error("Failed to generate PDF. Falling back to print...",{id:se}),window.print()}};if(d)return n.jsx(XA,{});if(!o)return n.jsx("div",{className:"text-center py-12 text-slate-400",children:"Report not found"});const{aiAnalysis:k}=o,R=(k==null?void 0:k.healthScore)||0;return n.jsxs("div",{id:"report-content",className:"max-w-6xl mx-auto space-y-6 animate-fade-in p-4 bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between no-pdf",children:[n.jsxs(Os,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[n.jsx(ln,{className:"w-4 h-4"})," Back to Dashboard"]}),n.jsx(Os,{to:`/reports/${a}`,className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:"Back to Report Details "})]}),n.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-orange-600 rounded-2xl p-8 text-white",children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[n.jsxs("div",{children:[(o.patientName||(k==null?void 0:k.patientName))&&n.jsxs("div",{className:"mb-3",children:[n.jsx("p",{className:"text-sm text-white/60 uppercase tracking-wide",children:"Patient Name"}),n.jsx("p",{className:"text-xl font-semibold",children:o.patientName||(k==null?void 0:k.patientName)})]}),n.jsxs("h1",{className:"text-3xl font-bold mb-2",children:[o.reportType," Analysis"]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-white/70",children:[n.jsxs("p",{children:["Analyzed on ",new Date(o.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),(o.reportDate||(k==null?void 0:k.reportDate))&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"hidden sm:inline",children:""}),n.jsxs("p",{children:["Report Date: ",new Date(o.reportDate||(k==null?void 0:k.reportDate)).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-5xl font-bold mb-2",children:R}),n.jsx("div",{className:"text-sm text-white/70",children:"Health Score"})]}),n.jsx("div",{className:"no-pdf flex flex-col gap-2",children:n.jsxs("button",{onClick:I,className:"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all flex items-center gap-2 text-sm font-medium border border-white/20",children:[n.jsx(tE,{className:"w-4 h-4"})," Download PDF"]})})]})}),(k==null?void 0:k.summary)&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-blue-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2",children:[n.jsx(Cr,{className:"w-6 h-6 text-cyan-500"})," Report Summary"]}),n.jsx("p",{className:"text-slate-700 leading-relaxed text-lg",children:k.summary})]}),((O=k==null?void 0:k.keyFindings)==null?void 0:O.length)>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Vi,{className:"w-6 h-6 text-red-500"})," Key Findings"]}),n.jsx("div",{className:"space-y-3",children:k.keyFindings.map((Y,se)=>n.jsxs("div",{className:"flex items-start gap-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:[n.jsx(dn,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-1"}),n.jsx("p",{className:"text-slate-700 text-base",children:Y})]},se))})]}),(k==null?void 0:k.metrics)&&Object.keys(k.metrics).length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Cr,{className:"w-6 h-6 text-cyan-500"})," All Health Metrics"]}),n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(k.metrics).map(([Y,se])=>n.jsxs("button",{onClick:()=>E(Y,se),className:`p-5 rounded-xl border-2 text-left transition-all hover:scale-105 hover:shadow-lg cursor-pointer ${se.status==="normal"?"bg-emerald-50 border-emerald-200 hover:border-emerald-300":se.status==="high"?"bg-red-50 border-red-200 hover:border-red-300":"bg-amber-50 border-amber-200 hover:border-amber-300"}`,children:[n.jsx("p",{className:"text-sm text-slate-600 font-medium mb-2",children:Y}),n.jsxs("p",{className:"text-2xl font-bold text-slate-800 mb-2",children:[se.value," ",n.jsx("span",{className:"text-sm font-normal text-slate-500",children:se.unit})]}),n.jsxs("p",{className:"text-xs text-slate-600 mb-3",children:["Normal: ",se.normalRange]}),n.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold ${se.status==="normal"?"bg-emerald-100 text-emerald-700":se.status==="high"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:se.status.toUpperCase()})]},Y))})]}),((F=k==null?void 0:k.deficiencies)==null?void 0:F.length)>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-amber-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(th,{className:"w-6 h-6 text-amber-500"})," Detected Deficiencies"]}),n.jsx("div",{className:"space-y-4",children:k.deficiencies.map((Y,se)=>{var oe;return n.jsxs("div",{className:`p-5 rounded-xl border-2 ${Y.severity==="Severe"?"bg-red-50 border-red-200":Y.severity==="Moderate"?"bg-amber-50 border-amber-200":"bg-yellow-50 border-yellow-200"}`,children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800",children:Y.name}),n.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${Y.severity==="Severe"?"bg-red-100 text-red-700":Y.severity==="Moderate"?"bg-amber-100 text-amber-700":"bg-yellow-100 text-yellow-700"}`,children:Y.severity})]}),Y.explanation&&n.jsx("p",{className:"text-slate-700 mb-3",children:Y.explanation}),((oe=Y.symptoms)==null?void 0:oe.length)>0&&n.jsxs("div",{className:"mb-3",children:[n.jsx("p",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Symptoms:"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:Y.symptoms.map((Te,he)=>n.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border border-slate-300",children:Te},he))})]}),Y.currentValue&&n.jsxs("p",{className:"text-sm text-slate-600",children:[n.jsx("strong",{children:"Current:"})," ",Y.currentValue," | ",n.jsx("strong",{children:"Normal:"})," ",Y.normalRange]})]},se)})})]}),(k==null?void 0:k.foodRecommendations)&&Object.keys(k.foodRecommendations).length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Xp,{className:"w-6 h-6 text-emerald-500"})," Recommended Food Categories"]}),n.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:Object.entries(k.foodRecommendations).map(([Y,se])=>n.jsxs("div",{className:"p-6 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[n.jsx("h3",{className:"font-bold text-emerald-700 mb-2 text-lg",children:Y}),se.explanation&&n.jsx("p",{className:"text-sm text-emerald-600 mb-3",children:se.explanation}),se.frequency&&n.jsxs("p",{className:"text-xs text-emerald-700 font-medium mb-3",children:["Frequency: ",se.frequency]}),se.foods&&n.jsx("div",{className:"flex flex-wrap gap-2",children:se.foods.map((oe,Te)=>n.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-full font-medium",children:oe},Te))})]},Y))})]}),(k==null?void 0:k.dietPlan)&&n.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-green-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2",children:[n.jsx(aQ,{className:"w-6 h-6 text-green-500"})," Personalized Meal Plan (4 Options Per Meal)"]}),n.jsx("p",{className:"text-slate-700 mb-8 font-medium text-lg",children:k.dietPlan.overview}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-8 mb-8",children:[((M=k.dietPlan.breakfast)==null?void 0:M.length)>0&&n.jsxs("div",{className:"p-6 bg-orange-50 rounded-2xl border-2 border-orange-200 shadow-sm transition-all hover:shadow-md",children:[n.jsx("h3",{className:"font-bold text-orange-700 mb-4 text-xl flex items-center gap-2",children:" Breakfast"}),n.jsx("div",{className:"space-y-4",children:k.dietPlan.breakfast.map((Y,se)=>n.jsxs("div",{className:"bg-white/60 p-4 rounded-xl border border-orange-100",children:[n.jsx("p",{className:"font-bold text-slate-800 text-base",children:Y.meal}),Y.nutrients&&n.jsxs("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-wider font-semibold",children:["Nutrients: ",Array.isArray(Y.nutrients)?Y.nutrients.join(", "):Y.nutrients]}),Y.tip&&n.jsxs("p",{className:"text-sm text-orange-600 italic mt-2",children:[" ",Y.tip]})]},se))})]}),((Q=k.dietPlan.lunch)==null?void 0:Q.length)>0&&n.jsxs("div",{className:"p-6 bg-blue-50 rounded-2xl border-2 border-blue-200 shadow-sm transition-all hover:shadow-md",children:[n.jsx("h3",{className:"font-bold text-blue-700 mb-4 text-xl flex items-center gap-2",children:" Lunch"}),n.jsx("div",{className:"space-y-4",children:k.dietPlan.lunch.map((Y,se)=>n.jsxs("div",{className:"bg-white/60 p-4 rounded-xl border border-blue-100",children:[n.jsx("p",{className:"font-bold text-slate-800 text-base",children:Y.meal}),Y.nutrients&&n.jsxs("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-wider font-semibold",children:["Nutrients: ",Array.isArray(Y.nutrients)?Y.nutrients.join(", "):Y.nutrients]}),Y.tip&&n.jsxs("p",{className:"text-sm text-blue-600 italic mt-2",children:[" ",Y.tip]})]},se))})]}),((Z=k.dietPlan.dinner)==null?void 0:Z.length)>0&&n.jsxs("div",{className:"p-6 bg-indigo-50 rounded-2xl border-2 border-indigo-200 shadow-sm transition-all hover:shadow-md",children:[n.jsx("h3",{className:"font-bold text-indigo-700 mb-4 text-xl flex items-center gap-2",children:" Dinner"}),n.jsx("div",{className:"space-y-4",children:k.dietPlan.dinner.map((Y,se)=>n.jsxs("div",{className:"bg-white/60 p-4 rounded-xl border border-indigo-100",children:[n.jsx("p",{className:"font-bold text-slate-800 text-base",children:Y.meal}),Y.nutrients&&n.jsxs("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-wider font-semibold",children:["Nutrients: ",Array.isArray(Y.nutrients)?Y.nutrients.join(", "):Y.nutrients]}),Y.tip&&n.jsxs("p",{className:"text-sm text-indigo-600 italic mt-2",children:[" ",Y.tip]})]},se))})]}),(($=k.dietPlan.snacks)==null?void 0:$.length)>0&&n.jsxs("div",{className:"p-6 bg-pink-50 rounded-2xl border-2 border-pink-200 shadow-sm transition-all hover:shadow-md",children:[n.jsx("h3",{className:"font-bold text-pink-700 mb-4 text-xl flex items-center gap-2",children:" Snacks"}),n.jsx("div",{className:"space-y-4",children:k.dietPlan.snacks.map((Y,se)=>n.jsxs("div",{className:"bg-white/60 p-4 rounded-xl border border-pink-100",children:[n.jsx("p",{className:"font-bold text-slate-800 text-base",children:Y.meal}),Y.nutrients&&n.jsxs("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-wider font-semibold",children:["Nutrients: ",Array.isArray(Y.nutrients)?Y.nutrients.join(", "):Y.nutrients]}),Y.tip&&n.jsxs("p",{className:"text-sm text-pink-600 italic mt-2",children:[" ",Y.tip]})]},se))})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[((X=k.dietPlan.foodsToIncrease)==null?void 0:X.length)>0&&n.jsxs("div",{className:"p-6 bg-emerald-50 rounded-2xl border-2 border-emerald-200",children:[n.jsx("h3",{className:"font-bold text-emerald-700 mb-4 text-lg",children:" Foods to Increase"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:k.dietPlan.foodsToIncrease.map((Y,se)=>n.jsx("span",{className:"bg-white px-3 py-1.5 rounded-lg border border-emerald-200 text-sm font-semibold text-emerald-800 shadow-sm",children:Y},se))})]}),((be=k.dietPlan.foodsToLimit)==null?void 0:be.length)>0&&n.jsxs("div",{className:"p-6 bg-red-50 rounded-2xl border-2 border-red-200",children:[n.jsx("h3",{className:"font-bold text-red-700 mb-4 text-lg",children:" Foods to Limit"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:k.dietPlan.foodsToLimit.map((Y,se)=>n.jsx("span",{className:"bg-white px-3 py-1.5 rounded-lg border border-red-200 text-sm font-semibold text-red-800 shadow-sm",children:Y},se))})]})]}),k.dietPlan.hydration&&n.jsxs("div",{className:"p-6 bg-cyan-50 rounded-2xl border-2 border-cyan-200 mb-6",children:[n.jsx("h3",{className:"font-bold text-cyan-700 mb-2 flex items-center gap-2",children:" Hydration"}),n.jsx("p",{className:"text-slate-700 font-medium",children:k.dietPlan.hydration})]}),((me=k.dietPlan.tips)==null?void 0:me.length)>0&&n.jsxs("div",{className:"p-6 bg-yellow-50 rounded-2xl border-2 border-yellow-200",children:[n.jsx("h3",{className:"font-bold text-yellow-700 mb-4 flex items-center gap-2",children:" Health Tips"}),n.jsx("ul",{className:"space-y-3",children:k.dietPlan.tips.map((Y,se)=>n.jsxs("li",{className:"text-slate-700 flex items-start gap-3",children:[n.jsx("span",{className:"bg-yellow-200 text-yellow-700 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5",children:se+1}),n.jsx("span",{className:"font-medium",children:Y})]},se))})]})]}),(k==null?void 0:k.supplementRecommendations)&&Object.keys(k.supplementRecommendations).length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Zu,{className:"w-6 h-6 text-blue-600"})," Recommended Supplements"]}),n.jsx("div",{className:"space-y-6",children:Object.entries(k.supplementRecommendations).map(([Y,se])=>n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-blue-700 mb-4 text-lg",children:Y}),Array.isArray(se)?n.jsx("div",{className:"space-y-3",children:se.map((oe,Te)=>n.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[n.jsxs("div",{className:"flex items-start justify-between mb-2",children:[n.jsx("p",{className:"font-semibold text-slate-800",children:oe.name}),oe.frequency&&n.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded font-medium",children:oe.frequency})]}),oe.dosage&&n.jsxs("p",{className:"text-sm text-slate-700 mb-1",children:[n.jsx("strong",{children:"Dosage:"})," ",oe.dosage]}),oe.timing&&n.jsxs("p",{className:"text-sm text-slate-700 mb-1",children:[n.jsx("strong",{children:"Timing:"})," ",oe.timing]}),oe.whyItHelps&&n.jsxs("p",{className:"text-sm text-slate-600 mb-1",children:[n.jsx("strong",{children:"Why:"})," ",oe.whyItHelps]}),oe.note&&n.jsxs("p",{className:"text-xs text-slate-600 italic",children:[" ",oe.note]})]},Te))}):null]},Y))})]}),(k==null?void 0:k.recommendations)&&Object.keys(k.recommendations).length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Vi,{className:"w-6 h-6 text-red-500"})," Health Recommendations"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[((Ne=k.recommendations.immediate)==null?void 0:Ne.length)>0&&n.jsxs("div",{className:"p-6 bg-red-50 rounded-xl border-2 border-red-200",children:[n.jsx("h3",{className:"font-bold text-red-700 mb-4 text-lg",children:" Immediate Actions"}),n.jsx("ul",{className:"space-y-2",children:k.recommendations.immediate.map((Y,se)=>n.jsxs("li",{className:"text-sm text-red-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full mt-1.5 flex-shrink-0"}),Y]},se))})]}),((le=k.recommendations.shortTerm)==null?void 0:le.length)>0&&n.jsxs("div",{className:"p-6 bg-amber-50 rounded-xl border-2 border-amber-200",children:[n.jsx("h3",{className:"font-bold text-amber-700 mb-4 text-lg",children:" Short-Term (2-4 weeks)"}),n.jsx("ul",{className:"space-y-2",children:k.recommendations.shortTerm.map((Y,se)=>n.jsxs("li",{className:"text-sm text-amber-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full mt-1.5 flex-shrink-0"}),Y]},se))})]}),((H=k.recommendations.longTerm)==null?void 0:H.length)>0&&n.jsxs("div",{className:"p-6 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[n.jsx("h3",{className:"font-bold text-emerald-700 mb-4 text-lg",children:" Long-Term (Ongoing)"}),n.jsx("ul",{className:"space-y-2",children:k.recommendations.longTerm.map((Y,se)=>n.jsxs("li",{className:"text-sm text-emerald-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full mt-1.5 flex-shrink-0"}),Y]},se))})]}),k.recommendations.diet&&n.jsxs("div",{className:"p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:[n.jsx("h3",{className:"font-bold text-blue-700 mb-4 text-lg",children:" Diet Recommendations"}),n.jsx("p",{className:"text-sm text-blue-700",children:k.recommendations.diet})]}),((Ae=k.recommendations.lifestyle)==null?void 0:Ae.length)>0&&n.jsxs("div",{className:"p-6 bg-violet-50 rounded-xl border-2 border-violet-200",children:[n.jsx("h3",{className:"font-bold text-violet-700 mb-4 text-lg",children:" Lifestyle Changes"}),n.jsx("ul",{className:"space-y-2",children:k.recommendations.lifestyle.map((Y,se)=>n.jsxs("li",{className:"text-sm text-violet-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-violet-500 rounded-full mt-1.5 flex-shrink-0"}),Y]},se))})]}),((J=k.recommendations.followUpTests)==null?void 0:J.length)>0&&n.jsxs("div",{className:"p-6 bg-cyan-50 rounded-xl border-2 border-cyan-200",children:[n.jsx("h3",{className:"font-bold text-cyan-700 mb-4 text-lg",children:" Follow-Up Tests"}),n.jsx("ul",{className:"space-y-2",children:k.recommendations.followUpTests.map((Y,se)=>n.jsxs("li",{className:"text-sm text-cyan-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full mt-1.5 flex-shrink-0"}),Y]},se))})]})]})]}),n.jsx("div",{className:"p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:n.jsxs("p",{className:"text-sm text-blue-700",children:[n.jsx("strong",{children:"Disclaimer:"})," This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider for medical decisions."]})}),x&&m&&n.jsx(NH,{vital:m,onClose:S})]})}function l0e(){var J,Y;const[a,o]=te.useState([]),[c,d]=te.useState(null),[h,m]=te.useState(null),[g,x]=te.useState(!0),[v,E]=te.useState(null),[S,I]=te.useState(!1),[k,R]=te.useState(null);te.useEffect(()=>{O()},[]),te.useEffect(()=>{if(c){const se=a.find(oe=>oe._id===c);m(se)}},[c,a]);const O=async()=>{try{const{data:se}=await ll.getReports();o(se),se.length>0&&d(se[0]._id)}catch(se){console.error("Failed to fetch reports:",se)}finally{x(!1)}},F=(se,oe)=>{if(!oe||typeof oe!="object")return;const Te={name:se||"Unknown Metric",value:oe.value!==void 0?oe.value:"N/A",unit:oe.unit||"",normalRange:oe.normalRange||"N/A",status:oe.status||"normal",description:oe.description||`Details for ${se}`,recommendations:Array.isArray(oe.recommendations)?oe.recommendations:[],foodsToConsume:Array.isArray(oe.foodsToConsume)?oe.foodsToConsume:[],foodsToAvoid:Array.isArray(oe.foodsToAvoid)?oe.foodsToAvoid:[],symptoms:Array.isArray(oe.symptoms)?oe.symptoms:[],severity:oe.severity||""};E(Te),I(!0)},M=()=>{I(!1),E(null)},Q=()=>{const se=new Set;return a.forEach(oe=>{var Te;(Te=oe.aiAnalysis)!=null&&Te.metrics&&Object.keys(oe.aiAnalysis.metrics).forEach(he=>se.add(he))}),Array.from(se).sort()},Z=se=>se?a.filter(oe=>{var Te,he;return(he=(Te=oe.aiAnalysis)==null?void 0:Te.metrics)==null?void 0:he[se]}).reverse().map(oe=>({date:new Date(oe.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"}),value:oe.aiAnalysis.metrics[se].value,unit:oe.aiAnalysis.metrics[se].unit,status:oe.aiAnalysis.metrics[se].status,normalRange:oe.aiAnalysis.metrics[se].normalRange,fullDate:new Date(oe.createdAt)})):[],$=se=>{if(se.length<2)return{direction:"stable",change:0,percentChange:0};const oe=se[se.length-1].value,Te=se[se.length-2].value,he=oe-Te,Ce=(he/Te*100).toFixed(1);let ee="stable";return he>0?ee="up":he<0&&(ee="down"),{direction:ee,change:he.toFixed(2),percentChange:Ce}},X=(se,oe)=>{if(oe.length<2)return{message:"Not enough data to analyze trend. Upload more reports to track progress.",color:"text-slate-600",bgColor:"bg-slate-50",icon:"info"};const Te=$(oe),he=oe[oe.length-1],Ce=he.status==="normal",ee=["Cholesterol","LDL","Triglycerides","Blood Sugar","Glucose","HbA1c","Blood Pressure","Systolic","Diastolic","Weight","BMI"],Be=["HDL","Hemoglobin","RBC","Vitamin D","Vitamin B12","Iron","Calcium"],He=ee.some(fe=>se.toLowerCase().includes(fe.toLowerCase())),Ue=Be.some(fe=>se.toLowerCase().includes(fe.toLowerCase()));let re=!1,ve="";return Te.direction==="stable"?Ce?(ve=` Your ${se} is stable and within normal range. Great job maintaining your health!`,re=!0):(ve=` Your ${se} remains outside normal range. Consider consulting your doctor for guidance.`,re=!1):Te.direction==="up"?Ue?(ve=` Your ${se} is increasing (${Te.change} ${he.unit}). This is a positive trend! Keep up the good work.`,re=!0):He?(ve=` Your ${se} is rising (${Te.change} ${he.unit}). Consider lifestyle changes to bring it down.`,re=!1):(ve=` Your ${se} increased by ${Te.change} ${he.unit}. ${Ce?"Still within normal range.":"Monitor this closely."}`,re=Ce):He?(ve=` Your ${se} is decreasing (${Te.change} ${he.unit}). Excellent progress! Keep it up.`,re=!0):Ue?(ve=` Your ${se} is dropping (${Te.change} ${he.unit}). You may need to improve this value.`,re=!1):(ve=` Your ${se} decreased by ${Math.abs(Te.change)} ${he.unit}. ${Ce?"Still within normal range.":"Monitor this closely."}`,re=Ce),{message:ve,color:re?"text-green-700":"text-amber-700",bgColor:re?"bg-green-50":"bg-amber-50",borderColor:re?"border-green-200":"border-amber-200",icon:re?"good":"warning"}};if(g)return n.jsx(XA,{});if(a.length===0)return n.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:[n.jsx("div",{className:"flex items-center gap-4 mb-6",children:n.jsxs(Os,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[n.jsx(ln,{className:"w-4 h-4"})," Back to Dashboard"]})}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-12 text-center",children:[n.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(Cr,{className:"w-10 h-10 text-red-500"})}),n.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-3",children:"No Vital Signs Available"}),n.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:"Upload your health report to view your vital signs and health metrics extracted from your reports."}),n.jsxs(Os,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-xl font-semibold hover:bg-red-600 transition-colors",children:[n.jsx(il,{className:"w-5 h-5"}),"Upload Report"]})]})]});const be=((J=h==null?void 0:h.aiAnalysis)==null?void 0:J.metrics)||{},me=Object.keys(be).length>0,Ne=Q(),le=k?Z(k):[],H=le.length>0?$(le):null,Ae=k&&le.length>0?X(k,le):null;return n.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fade-in p-4 pb-20",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsxs(Os,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors mb-2",children:[n.jsx(ln,{className:"w-4 h-4"})," Back to Dashboard"]}),n.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[n.jsx(Cr,{className:"w-8 h-8 text-red-500"}),"Vital Signs"]}),n.jsx("p",{className:"text-slate-600 mt-2",children:"View your health metrics from reports"})]}),a.length>1&&n.jsxs("div",{className:"relative",children:[n.jsx("select",{value:c||"",onChange:se=>d(se.target.value),className:"appearance-none px-4 py-3 pr-10 bg-white border-2 border-slate-200 rounded-xl text-sm font-medium text-slate-800 hover:border-cyan-400 focus:border-cyan-500 focus:outline-none cursor-pointer transition-colors",children:a.map(se=>n.jsxs("option",{value:se._id,children:[se.reportType," - ",new Date(se.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]},se._id))}),n.jsx(lh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"})]})]}),h&&n.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-orange-500 rounded-2xl p-6 text-white",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx(Bn,{className:"w-6 h-6"}),n.jsx("h2",{className:"text-xl font-bold",children:h.reportType})]}),n.jsxs("p",{className:"text-white/80 text-sm",children:["Report Date: ",new Date(h.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),((Y=h.aiAnalysis)==null?void 0:Y.healthScore)&&n.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg",children:[n.jsx("span",{className:"text-sm",children:"Health Score:"}),n.jsx("span",{className:"text-2xl font-bold",children:h.aiAnalysis.healthScore})]})]}),a.length>1&&Ne.length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Vital Progress Tracker"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"Select a vital to see its progress over time"})]}),n.jsxs("div",{className:"relative min-w-[200px]",children:[n.jsxs("select",{value:k||"",onChange:se=>R(se.target.value),className:"appearance-none w-full px-4 py-3 pr-10 bg-gradient-to-r from-purple-50 to-orange-50 border-2 border-cyan-200 rounded-xl text-sm font-medium text-slate-800 hover:border-cyan-400 focus:border-cyan-500 focus:outline-none cursor-pointer transition-colors",children:[n.jsx("option",{value:"",children:"Select Vital"}),Ne.map(se=>n.jsx("option",{value:se,children:se},se))]}),n.jsx(lh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-600 pointer-events-none"})]})]}),k&&le.length>0?n.jsxs("div",{className:"space-y-4",children:[H&&le.length>1&&n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Current Value"}),n.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[le[le.length-1].value," ",n.jsx("span",{className:"text-sm font-normal text-slate-500",children:le[le.length-1].unit})]}),n.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Normal: ",le[le.length-1].normalRange]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Trend"}),n.jsx("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full font-bold ${H.direction==="up"?"bg-blue-100 text-blue-700":H.direction==="down"?"bg-purple-100 text-purple-700":"bg-slate-100 text-slate-700"}`,children:H.direction==="up"?n.jsxs(n.Fragment,{children:[n.jsx(va,{className:"w-5 h-5"}),n.jsxs("span",{children:["+",H.change]})]}):H.direction==="down"?n.jsxs(n.Fragment,{children:[n.jsx(rE,{className:"w-5 h-5"}),n.jsx("span",{children:H.change})]}):n.jsxs(n.Fragment,{children:[n.jsx(Cg,{className:"w-5 h-5"}),n.jsx("span",{children:"Stable"})]})}),n.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[Math.abs(H.percentChange),"% change"]})]})]}),n.jsx("div",{className:"h-64 sm:h-80",children:n.jsx(Yb,{width:"100%",height:"100%",children:n.jsxs(QT,{data:le,children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"vitalGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.3}),n.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:0})]})}),n.jsx(nE,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),n.jsx(iE,{dataKey:"date",stroke:"#94a3b8",fontSize:12,tickLine:!1}),n.jsx(aE,{stroke:"#94a3b8",fontSize:12,tickLine:!1}),n.jsx($R,{contentStyle:{backgroundColor:"#fff",border:"2px solid #06b6d4",borderRadius:"12px",padding:"12px"},labelStyle:{color:"#64748b",fontWeight:"bold",marginBottom:"4px"},formatter:(se,oe,Te)=>[`${se} ${Te.payload.unit}`,k]}),n.jsx(HT,{type:"monotone",dataKey:"value",stroke:"#06b6d4",strokeWidth:3,fill:"url(#vitalGradient)",dot:{fill:"#06b6d4",strokeWidth:2,r:5},activeDot:{r:7,fill:"#0891b2"}})]})})}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:le.slice(-4).reverse().map((se,oe)=>n.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200",children:[n.jsx("p",{className:"text-xs text-slate-500 mb-1",children:se.date}),n.jsx("p",{className:"text-lg font-bold text-slate-800",children:se.value}),n.jsx("span",{className:`inline-block mt-1 px-2 py-0.5 rounded text-xs font-semibold ${se.status==="normal"?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:se.status})]},oe))}),Ae&&n.jsx("div",{className:`p-4 rounded-xl border-2 ${Ae.borderColor} ${Ae.bgColor}`,children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"flex-shrink-0 mt-0.5",children:Ae.icon==="good"?n.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center",children:n.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):Ae.icon==="warning"?n.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center",children:n.jsx(Ln,{className:"w-5 h-5 text-white"})}):n.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-400 flex items-center justify-center",children:n.jsx(Cr,{className:"w-5 h-5 text-white"})})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:`font-semibold mb-1 ${Ae.color}`,children:"Health Insight"}),n.jsx("p",{className:`text-sm ${Ae.color} leading-relaxed`,children:Ae.message})]})]})})]}):k?n.jsxs("div",{className:"text-center py-12 text-slate-400",children:[n.jsx(Cr,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),n.jsx("p",{children:"No data available for this vital across your reports"})]}):n.jsxs("div",{className:"text-center py-12 text-slate-400",children:[n.jsx(Cr,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),n.jsx("p",{children:"Select a vital from the dropdown to see its progress"})]})]}),me?n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-6",children:"Current Health Metrics"}),n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(be).map(([se,oe])=>n.jsxs("button",{onClick:()=>F(se,oe),className:`p-5 rounded-xl border-2 text-left transition-all hover:scale-105 hover:shadow-lg cursor-pointer ${oe.status==="normal"?"bg-emerald-50 border-emerald-200 hover:border-emerald-300":oe.status==="high"||oe.status==="low"?"bg-red-50 border-red-200 hover:border-red-300":"bg-amber-50 border-amber-200 hover:border-amber-300"}`,children:[n.jsx("p",{className:"text-sm text-slate-600 font-medium mb-2",children:se}),n.jsxs("p",{className:"text-2xl font-bold text-slate-800 mb-2",children:[oe.value," ",n.jsx("span",{className:"text-sm font-normal text-slate-500",children:oe.unit})]}),n.jsxs("p",{className:"text-xs text-slate-600 mb-3",children:["Normal: ",oe.normalRange]}),n.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold ${oe.status==="normal"?"bg-emerald-100 text-emerald-700":oe.status==="high"||oe.status==="low"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:oe.status.toUpperCase()})]},se))})]}):n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-12 text-center",children:[n.jsx(Cr,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-xl font-semibold text-slate-800 mb-2",children:"No Metrics Found"}),n.jsx("p",{className:"text-slate-600 mb-6",children:"This report doesn't contain any extracted health metrics. Try uploading a different report."}),n.jsxs(Os,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-xl font-semibold hover:bg-red-600 transition-colors",children:[n.jsx(il,{className:"w-5 h-5"}),"Upload New Report"]})]}),S&&v&&n.jsx(NH,{vital:v,onClose:M})]})}function d0e(){const[a,o]=te.useState([]),[c,d]=te.useState(null),[h,m]=te.useState(null),[g,x]=te.useState([]),[v,E]=te.useState(!0);te.useEffect(()=>{S()},[]),te.useEffect(()=>{if(c){const R=a.find(O=>O._id===c);m(R),I(R)}},[c,a]);const S=async()=>{try{const{data:R}=await ll.getReports();o(R),R.length>0&&d(R[0]._id)}catch(R){console.error("Failed to fetch reports:",R)}finally{E(!1)}},I=R=>{var F;if(!R){x([]);return}const O=[];(F=R.aiAnalysis)!=null&&F.supplementRecommendations&&Object.entries(R.aiAnalysis.supplementRecommendations).forEach(([M,Q])=>{Array.isArray(Q)&&Q.forEach(Z=>{O.push({...Z,category:M,reportId:R._id,reportType:R.reportType,reportDate:R.createdAt})})}),x(O)};if(v)return n.jsx(XA,{});if(a.length===0)return n.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:[n.jsx("div",{className:"flex items-center gap-4 mb-6",children:n.jsxs(Os,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[n.jsx(ln,{className:"w-4 h-4"})," Back to Dashboard"]})}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-12 text-center",children:[n.jsx("div",{className:"w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(Zu,{className:"w-10 h-10 text-purple-500"})}),n.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-3",children:"No Supplement Recommendations Yet"}),n.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:"Upload your health report to get personalized supplement recommendations based on your deficiencies and health conditions."}),n.jsxs(Os,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-purple-500 text-white rounded-xl font-semibold hover:bg-purple-600 transition-colors",children:[n.jsx(il,{className:"w-5 h-5"}),"Upload Report"]})]})]});if(g.length===0&&h)return n.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:[n.jsx("div",{className:"flex items-center gap-4 mb-6",children:n.jsxs(Os,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[n.jsx(ln,{className:"w-4 h-4"})," Back to Dashboard"]})}),a.length>1&&n.jsx("div",{className:"flex justify-end",children:n.jsxs("div",{className:"relative",children:[n.jsx("select",{value:c||"",onChange:R=>d(R.target.value),className:"appearance-none px-4 py-3 pr-10 bg-white border-2 border-slate-200 rounded-xl text-sm font-medium text-slate-800 hover:border-cyan-400 focus:border-cyan-500 focus:outline-none cursor-pointer transition-colors",children:a.map(R=>n.jsxs("option",{value:R._id,children:[R.reportType," - ",new Date(R.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]},R._id))}),n.jsx(lh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"})]})}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-12 text-center",children:[n.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(dn,{className:"w-10 h-10 text-green-500"})}),n.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-3",children:"No Supplements Needed"}),n.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:"Great news! This report doesn't show any deficiencies that require supplements. Keep maintaining your healthy lifestyle!"}),a.length>1?n.jsx("p",{className:"text-sm text-slate-500",children:"Try selecting a different report above to view its supplement recommendations."}):n.jsx(Os,{to:"/dashboard",className:"inline-flex items-center gap-2 px-6 py-3 bg-cyan-500 text-white rounded-xl font-semibold hover:bg-cyan-600 transition-colors",children:"Back to Dashboard"})]})]});const k=g.reduce((R,O)=>(R[O.category]||(R[O.category]=[]),R[O.category].push(O),R),{});return n.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fade-in p-4 pb-20",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsxs(Os,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors mb-2",children:[n.jsx(ln,{className:"w-4 h-4"})," Back to Dashboard"]}),n.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[n.jsx(Zu,{className:"w-8 h-8 text-purple-500"}),"Supplement Recommendations"]}),n.jsx("p",{className:"text-slate-600 mt-2",children:"Based on your selected health report"})]}),a.length>1&&n.jsxs("div",{className:"relative",children:[n.jsx("select",{value:c||"",onChange:R=>d(R.target.value),className:"appearance-none px-4 py-3 pr-10 bg-white border-2 border-slate-200 rounded-xl text-sm font-medium text-slate-800 hover:border-cyan-400 focus:border-cyan-500 focus:outline-none cursor-pointer transition-colors",children:a.map(R=>n.jsxs("option",{value:R._id,children:[R.reportType," - ",new Date(R.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]},R._id))}),n.jsx(lh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"})]})]}),h&&n.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-orange-500 rounded-2xl p-6 text-white",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx(Bn,{className:"w-6 h-6"}),n.jsx("h2",{className:"text-xl font-bold",children:h.reportType})]}),n.jsxs("p",{className:"text-white/80 text-sm",children:["Report Date: ",new Date(h.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),g.length>0&&n.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg",children:[n.jsx(Zu,{className:"w-5 h-5"}),n.jsxs("span",{className:"text-sm",children:[g.length," Supplement",g.length!==1?"s":""," Recommended"]})]})]}),n.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4 flex items-start gap-3",children:[n.jsx(zd,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"text-sm text-blue-800",children:[n.jsx("p",{className:"font-semibold mb-1",children:"Important Information"}),n.jsx("p",{children:"These recommendations are based on your selected health report. Always consult with a healthcare provider before starting any new supplements."})]})]}),Object.entries(k).map(([R,O])=>n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[n.jsxs("h2",{className:"text-xl font-bold text-purple-700 mb-4 flex items-center gap-2",children:[n.jsx(Zu,{className:"w-6 h-6"}),R]}),n.jsx("div",{className:"space-y-4",children:O.map((F,M)=>n.jsxs("div",{className:"p-5 bg-purple-50 rounded-xl border-2 border-purple-200",children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-1",children:F.name}),n.jsxs("p",{className:"text-xs text-slate-500",children:["From ",F.reportType,"  ",new Date(F.reportDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),F.frequency&&n.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-semibold",children:F.frequency})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-3",children:[F.dosage&&n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-600 font-semibold mb-1",children:"Dosage"}),n.jsx("p",{className:"text-sm text-slate-800",children:F.dosage})]}),F.timing&&n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-600 font-semibold mb-1",children:"Timing"}),n.jsx("p",{className:"text-sm text-slate-800",children:F.timing})]})]}),F.whyItHelps&&n.jsxs("div",{className:"mb-3",children:[n.jsx("p",{className:"text-xs text-slate-600 font-semibold mb-1",children:"Why It Helps"}),n.jsx("p",{className:"text-sm text-slate-700",children:F.whyItHelps})]}),F.note&&n.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[n.jsx(Ln,{className:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-xs text-amber-800",children:F.note})]})]},M))})]},R)),n.jsxs("div",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-6",children:[n.jsxs("h3",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[n.jsx(Ln,{className:"w-5 h-5 text-slate-600"}),"Disclaimer"]}),n.jsx("p",{className:"text-sm text-slate-600",children:"These supplement recommendations are generated based on your health reports and are for informational purposes only. They should not replace professional medical advice. Always consult with a qualified healthcare provider before starting any new supplements, especially if you have existing medical conditions or are taking medications."})]})]})}function A0e(){var je,Ee,We,ze,st,bt,Qe,rt,Nt,we,Rt,Fe,et,$e,Kt,qt;const a=to();te.useRef(!1);const[o,c]=te.useState(""),[d,h]=te.useState(null),[m,g]=te.useState(null),[x,v]=te.useState(!1),[E,S]=te.useState(!1),[I,k]=te.useState(null),[R,O]=te.useState(null),[F,M]=te.useState(!1),[Q,Z]=te.useState(!1),[$,X]=te.useState({quantity:"",prepMethod:"",additionalInfo:""}),[be,me]=te.useState(!1),[Ne]=te.useState(["Chicken Biryani","Paneer Tikka","Dal Makhani","Butter Chicken","Roti","Naan","Rice","Pasta","Pizza","Burger","Salad","Sandwich","Idli","Dosa","Samosa","Paratha","Chole Bhature","Rajma Chawal","Khichdi","Fried Rice","Momos","Spring Roll","Manchurian"]),[le,H]=te.useState([]),Ae=Xe=>{const ht=Xe.toLowerCase();return ht.includes("roti")||ht.includes("naan")||ht.includes("paratha")?["1 piece","2 pieces","3 pieces","4 pieces"]:ht.includes("rice")||ht.includes("biryani")||ht.includes("khichdi")||ht.includes("dal")||ht.includes("rajma")||ht.includes("chole")?["1 bowl","1 plate","1 cup","2 cups"]:ht.includes("samosa")||ht.includes("pakora")||ht.includes("momos")||ht.includes("spring roll")?["1 piece","2 pieces","3 pieces","5 pieces","1 plate"]:ht.includes("idli")||ht.includes("dosa")||ht.includes("vada")?["1 piece","2 pieces","3 pieces","1 plate"]:ht.includes("pizza")||ht.includes("burger")?["1 slice","2 slices","1 whole","1 medium","1 large"]:ht.includes("chicken")||ht.includes("paneer")||ht.includes("tikka")?["1 bowl","1 plate","100g","150g","200g"]:ht.includes("pasta")||ht.includes("noodles")||ht.includes("manchurian")?["1 bowl","1 plate","1 cup"]:ht.includes("salad")||ht.includes("sandwich")?["1 bowl","1 plate","1 piece","1 full"]:["1 bowl","1 plate","1 piece","100g","150g"]},[J,Y]=te.useState([]),[se,oe]=te.useState(!1),[Te,he]=te.useState("breakfast");te.useEffect(()=>{var dt;const Xe=sessionStorage.getItem("foodScanResult"),ht=sessionStorage.getItem("foodScanImage");if(console.log("Checking for persisted data...",{hasResult:!!Xe,hasImage:!!ht}),Xe)try{const Dt=JSON.parse(Xe);console.log(" Recovered persisted result:",(dt=Dt.foodItem)==null?void 0:dt.name),k(Dt),S(!0),ht&&O(ht),sessionStorage.removeItem("foodScanResult"),sessionStorage.removeItem("foodScanImage"),Ct.success("Food analysis recovered!",{duration:2e3})}catch(Dt){console.error(" Failed to recover persisted result:",Dt),sessionStorage.removeItem("foodScanResult"),sessionStorage.removeItem("foodScanImage")}},[]),te.useEffect(()=>{if(x){console.log(" Blocking navigation - analysis in progress");const Xe=dt=>{dt.preventDefault(),dt.returnValue=""};window.addEventListener("beforeunload",Xe);const ht=dt=>{dt.preventDefault(),window.history.pushState(null,"",window.location.pathname),Ct.error("Please wait for analysis to complete")};return window.addEventListener("popstate",ht),window.history.pushState(null,"",window.location.pathname),()=>{window.removeEventListener("beforeunload",Xe),window.removeEventListener("popstate",ht)}}},[x,a]),te.useEffect(()=>{var Xe;if(E&&I)return console.log("Modal is now visible with result:",(Xe=I.foodItem)==null?void 0:Xe.name),document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}},[E,I]);const Ce=Xe=>{const ht=Xe.target.value;if(c(ht),ht.trim().length>0){const dt=Ne.filter(Dt=>Dt.toLowerCase().includes(ht.toLowerCase()));H(dt.slice(0,5)),me(dt.length>0),Y(Ae(ht))}else me(!1),H([]),Y([])},ee=Xe=>{c(Xe),me(!1),H([]),Y(Ae(Xe))},Be=async Xe=>new Promise((ht,dt)=>{const Dt=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),ss=Xe.size>5*1024*1024;let $t=.5,ls=800;Dt?($t=ss?.3:.4,ls=ss?640:800):ss&&($t=.4,ls=960),console.log(" AGGRESSIVE Compression settings:",{isMobile:Dt,targetQuality:$t,maxDimension:ls,originalSize:(Xe.size/1024).toFixed(2)+" KB"});const Zt=new FileReader;Zt.readAsDataURL(Xe),Zt.onload=Rs=>{const es=new Image;es.src=Rs.target.result,es.onload=()=>{try{const Zs=document.createElement("canvas");let pt=es.width,Ut=es.height;pt>Ut?pt>ls&&(Ut=Math.round(Ut*ls/pt),pt=ls):Ut>ls&&(pt=Math.round(pt*ls/Ut),Ut=ls),console.log(" Resizing from",es.width,"x",es.height,"to",pt,"x",Ut),Zs.width=pt,Zs.height=Ut;const zt=Zs.getContext("2d",{alpha:!1,willReadFrequently:!1});zt.imageSmoothingEnabled=!0,zt.imageSmoothingQuality="low",zt.drawImage(es,0,0,pt,Ut),Zs.toBlob(rs=>{if(!rs){dt(new Error("Failed to compress image"));return}const Ht=new File([rs],Xe.name,{type:"image/jpeg",lastModified:Date.now()});console.log(" Original size:",(Xe.size/1024).toFixed(2),"KB"),console.log(" Compressed size:",(Ht.size/1024).toFixed(2),"KB"),console.log(" Compression ratio:",((1-Ht.size/Xe.size)*100).toFixed(1),"%"),Zs.width=0,Zs.height=0,zt.clearRect(0,0,1,1),es.src="",es.onload=null,Zt.onload=null,window.gc&&window.gc(),ht(Ht)},"image/jpeg",$t)}catch(Zs){console.error("Compression error:",Zs),dt(Zs)}},es.onerror=()=>{Zt.onload=null,dt(new Error("Failed to load image"))}},Zt.onerror=()=>{Zt.onload=null,dt(new Error("Failed to read file"))}}),He=async Xe=>{Xe.preventDefault(),Xe.stopPropagation();const ht=Xe.target.files[0];if(ht){if(ht.size>100*1024*1024){Ct.error("Image too large. Please use an image smaller than 100MB");return}Z(!0);const dt=Ct.loading("Compressing image...");try{await new Promise(ls=>setTimeout(ls,100));const Dt=await Be(ht),ss=3*1024*1024;if(Dt.size>ss){Ct.error(`Image still too large (${(Dt.size/1024/1024).toFixed(1)}MB). Try a smaller image or type the food name.`,{id:dt}),Z(!1);return}Ct.success(`Image ready! ${(Dt.size/1024).toFixed(0)}KB`,{id:dt}),h(Dt);const $t=new FileReader;$t.onloadend=()=>{g($t.result),$t.onloadend=null,$t.onerror=null},$t.onerror=()=>{Ct.error("Failed to preview image"),$t.onloadend=null,$t.onerror=null},$t.readAsDataURL(Dt)}catch(Dt){console.error("Compression error:",Dt),Ct.error("Failed to compress image. Please try a different image.",{id:dt})}finally{Z(!1)}}Xe.target.value=""},Ue=async Xe=>{M(!0);try{const ht=localStorage.getItem("token"),dt=await Hr.get(`/api/nutrition/food-image?foodName=${encodeURIComponent(Xe)}`,{headers:{Authorization:`Bearer ${ht}`}});if(dt.data.success&&dt.data.imageUrl){O(dt.data.imageUrl);try{sessionStorage.setItem("foodScanImage",dt.data.imageUrl)}catch{console.warn("Failed to persist food image")}}}catch(ht){console.error("Failed to fetch food image:",ht)}finally{M(!1)}},re=async()=>{var Dt,ss,$t,ls,Zt,Rs,es,Zs;if(!o.trim()&&!d){Ct.error("Please enter a food item or upload an image");return}if(d&&!$.quantity&&!$.prepMethod){Ct.error("Please provide quantity and preparation method for the image");return}const Xe=localStorage.getItem("token");if(!Xe){Ct.error("Please login to use this feature"),setTimeout(()=>{window.location.href="/login"},1500);return}v(!0),O(null);let ht=null,dt=!1;try{let pt=null;if(d){console.log("Converting image to base64..."),console.log("Image size:",(d.size/1024).toFixed(2),"KB");const Ht=new FileReader;pt=await new Promise((vt,jt)=>{Ht.onloadend=()=>{const ps=Ht.result.split(",")[1];console.log("Base64 conversion complete. Size:",(ps.length*.75/1024).toFixed(2),"KB"),Ht.onloadend=null,Ht.onerror=null,vt(ps)},Ht.onerror=ps=>{console.error("FileReader error:",ps),Ht.onloadend=null,Ht.onerror=null,jt(ps)},Ht.readAsDataURL(d)})}let Ut="";if(d&&($.quantity||$.prepMethod||$.additionalInfo)){const Ht=[];$.quantity&&Ht.push(`Quantity: ${$.quantity}`),$.prepMethod&&Ht.push(`Preparation: ${$.prepMethod}`),$.additionalInfo&&Ht.push($.additionalInfo),o&&Ht.push(`Additional info: ${o}`),Ut=Ht.join(", ")}else Ut=o;console.log("Sending analysis request..."),console.log("Token present:",!!Xe),console.log("Has image:",!!pt),console.log("Context text:",Ut);const zt=localStorage.getItem("token");if(!zt)throw new Error("Session expired during processing. Please login again.");const rs=await Hr.post("/api/nutrition/quick-check",{foodDescription:o||"Food from image",imageBase64:pt,additionalContext:Ut},{headers:{Authorization:`Bearer ${zt}`},timeout:6e4,skipAutoLogout:!0});if(console.log("API Response received:",rs.data),pt=null,!rs.data||!rs.data.data)throw new Error("Invalid response from server");ht=rs.data.data,dt=!0,console.log("Analysis successful, persisting result...");try{sessionStorage.setItem("foodScanResult",JSON.stringify(ht)),console.log(" Result persisted to sessionStorage")}catch(Ht){console.warn(" Failed to persist result:",Ht);try{localStorage.setItem("foodScanResult",JSON.stringify(ht)),console.log(" Result persisted to localStorage (fallback)")}catch{console.error(" Both storage methods failed")}}console.log("Setting state now..."),k(ht),S(!0),v(!1),console.log(" State updated, modal should be visible"),console.log("Modal state:",{showResultModal:!0,hasResult:!!ht}),(Dt=ht==null?void 0:ht.foodItem)!=null&&Dt.name&&Ue(ht.foodItem.name).then(()=>{if(R)try{sessionStorage.setItem("foodScanImage",R)}catch{console.warn("Failed to persist food image")}}),Ct.success("Food analyzed!");return}catch(pt){if(console.error("Analysis error:",pt),console.error("Error response:",pt.response),console.error("Error status:",(ss=pt.response)==null?void 0:ss.status),v(!1),(($t=pt.response)==null?void 0:$t.status)===401){Ct.error("Session expired. Please login again.",{duration:5e3}),setTimeout(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"},2e3);return}((ls=pt.response)==null?void 0:ls.status)===400&&((Rs=(Zt=pt.response)==null?void 0:Zt.data)==null?void 0:Rs.error)==="UNABLE_TO_DETECT_FOOD"?(h(null),g(null),Ct.error("Could not detect food in image. Please type the food name for accurate results.",{duration:5e3})):pt.code==="ECONNABORTED"?Ct.error("Request timeout. Please try again or use text description."):pt.message&&pt.message.includes("memory")?(Ct.error("Image too large for device. Please try a smaller image or type the food name."),h(null),g(null)):pt.message&&pt.message.includes("Network Error")?Ct.error("Network error. Please check your connection and try again."):Ct.error(((Zs=(es=pt.response)==null?void 0:es.data)==null?void 0:Zs.message)||"Failed to analyze food. Please try again.")}},ve=()=>{console.log("Resetting form..."),S(!1),k(null),O(null),c(""),h(null),g(null),X({quantity:"",prepMethod:"",additionalInfo:""}),oe(!1),he("breakfast"),sessionStorage.removeItem("foodScanResult"),sessionStorage.removeItem("foodScanImage"),localStorage.removeItem("foodScanResult"),localStorage.removeItem("foodScanImage"),window.gc&&window.gc()},fe=()=>{oe(!0)},Ie=async()=>{var Xe,ht;try{const dt=localStorage.getItem("token"),Dt={name:((Xe=I.foodItem)==null?void 0:Xe.name)||"Food from scan",quantity:$.quantity||"1 serving",nutrition:((ht=I.foodItem)==null?void 0:ht.nutrition)||{},notes:$.prepMethod?`Preparation: ${$.prepMethod}`:""};console.log("Logging meal with user input:",{quantity:$.quantity,prepMethod:$.prepMethod,foodItem:Dt}),(await Hr.post("/api/nutrition/log-meal",{mealType:Te,foodItems:[Dt],notes:"Logged from Quick Food Scan",healthScore:I.healthScore,healthScore10:I.healthScore10,micronutrients:I.micronutrients,enhancementTips:I.enhancementTips,healthBenefitsSummary:I.healthBenefitsSummary,timestamp:new Date},{headers:{Authorization:`Bearer ${dt}`},skipAutoLogout:!0})).data.success&&(Ct.success(`Meal logged to ${Te}! `),oe(!1),ve(),setTimeout(()=>{a("/nutrition#daily-target")},1e3))}catch(dt){console.error("Log meal error:",dt),Ct.error("Failed to log meal. Please try again.")}};return n.jsxs("div",{className:"min-h-screen bg-[#f8fafc] flex flex-col font-sans selection:bg-blue-100",children:[n.jsx("div",{className:"w-full px-6 py-5 bg-white/70 backdrop-blur-xl border-b border-white/40 sticky top-0 z-[100] shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07)]",children:n.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:()=>a(-1),className:"group p-2.5 bg-white rounded-2xl shadow-sm border border-slate-100 hover:bg-slate-50 transition-all active:scale-95",children:n.jsx(ln,{className:"w-5 h-5 text-slate-600 group-hover:text-blue-600 transition-colors"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-extrabold text-[#1e293b] leading-tight tracking-tight",children:"Food Scanner"}),n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"}),n.jsx("p",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-wider",children:"AI Nutrition Analysis"})]})]})]}),n.jsx("div",{className:"flex items-center gap-3",children:n.jsx("div",{className:"bg-blue-50/80 p-2 rounded-xl border border-blue-100",children:n.jsx($V,{className:"w-5 h-5 text-blue-600"})})})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto pb-32",children:n.jsxs("div",{className:"max-w-4xl mx-auto px-5 py-8 space-y-8",children:[!m&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-purple-600 to-orange-500 rounded-[2rem] blur opacity-20 group-hover:opacity-30 transition duration-1000"}),n.jsxs("div",{className:"relative bg-white rounded-[2rem] p-6 sm:p-8 shadow-[0_20px_50px_-12px_rgba(0,0,0,0.08)] border border-slate-100",children:[!o.trim()&&!m&&n.jsxs("div",{className:"flex flex-col items-center text-center mb-8 animate-in fade-in zoom-in duration-500",children:[n.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center mb-4 border border-blue-100/50",children:n.jsx(Y3,{className:"w-8 h-8 text-blue-600"})}),n.jsx("h2",{className:"text-2xl font-black text-[#1e293b] mb-2",children:"Track Your Meal"}),n.jsx("p",{className:"text-slate-500 text-sm max-w-[280px]",children:"Take a photo or type what you ate for instant nutritional insights."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 bg-blue-50 p-1.5 rounded-lg border border-blue-100",children:n.jsx(zd,{className:"w-4 h-4 text-blue-500"})}),n.jsx("input",{type:"text",value:o,onChange:Ce,onFocus:()=>{o.trim()&&le.length>0&&me(!0)},placeholder:"What's on your plate?",className:"w-full pl-14 pr-4 py-6 bg-slate-50/50 border-2 border-blue-400 rounded-2xl focus:outline-none focus:border-blue-600 focus:bg-white transition-all text-xl text-slate-800 font-black placeholder-slate-400 shadow-xl"}),be&&le.length>0&&n.jsx("div",{className:"absolute z-[110] w-full mt-2 bg-white/95 backdrop-blur-md border border-slate-200 rounded-2xl shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2",children:le.map((Xe,ht)=>n.jsxs("button",{onClick:()=>ee(Xe),className:"w-full px-5 py-3.5 text-left hover:bg-blue-50 transition-colors text-sm font-semibold text-slate-700 flex items-center gap-3 border-b border-slate-50 last:border-0",children:[n.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400"}),Xe]},ht))})]}),n.jsxs("div",{className:"flex items-center gap-4 py-2",children:[n.jsx("div",{className:"flex-1 h-[1px] bg-slate-100"}),n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]",children:"OR"}),n.jsx("div",{className:"flex-1 h-[1px] bg-slate-100"})]}),n.jsxs("div",{children:[n.jsx("input",{id:"camera-input",type:"file",accept:"image/*",capture:"environment",onChange:He,className:"hidden",disabled:Q}),n.jsxs("button",{onClick:()=>document.getElementById("camera-input").click(),disabled:Q,className:"w-full group relative overflow-hidden py-5 bg-slate-900 text-white rounded-2xl font-bold text-sm tracking-wide transition-all active:scale-[0.98] shadow-xl hover:shadow-2xl hover:bg-slate-800 disabled:opacity-75",children:[n.jsx("div",{className:"relative z-10 flex items-center justify-center gap-3",children:Q?n.jsxs(n.Fragment,{children:[n.jsx(dh,{className:"w-5 h-5 animate-spin text-blue-400"}),n.jsx("span",{children:"Optimizing Image..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(tI,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),n.jsx("span",{children:"Scan Food with Camera"})]})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-600/20 to-orange-500/20 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})]})]})]}),!o.trim()&&!m&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-emerald-50/50 p-4 rounded-3xl border border-emerald-100 flex flex-col gap-2",children:[n.jsx("div",{className:"w-8 h-8 bg-emerald-100 rounded-xl flex items-center justify-center",children:n.jsx(Jl,{className:"w-4 h-4 text-emerald-600"})}),n.jsx("p",{className:"text-xs font-bold text-emerald-900",children:"Track Calories"}),n.jsx("p",{className:"text-[10px] text-emerald-700/80 leading-snug",children:"Instantly see the energy content of your meals."})]}),n.jsxs("div",{className:"bg-amber-50/50 p-4 rounded-3xl border border-amber-100 flex flex-col gap-2",children:[n.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-xl flex items-center justify-center",children:n.jsx(nl,{className:"w-4 h-4 text-amber-600"})}),n.jsx("p",{className:"text-xs font-bold text-amber-900",children:"Health Score"}),n.jsx("p",{className:"text-[10px] text-amber-700/80 leading-snug",children:"Know how healthy your food choices are."})]})]})]}),(o.trim()||m)&&n.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4 duration-500",children:[m&&n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-purple-500 to-orange-500 rounded-[2.2rem] blur opacity-10"}),n.jsxs("div",{className:"relative rounded-[2rem] overflow-hidden border-4 border-white shadow-2xl",children:[n.jsx("img",{src:m,alt:"Scanned Food",className:"w-full h-72 object-cover transition-transform duration-700 group-hover:scale-105"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60"}),n.jsx("button",{onClick:()=>{h(null),g(null),X({quantity:"",prepMethod:"",additionalInfo:""})},className:"absolute top-4 right-4 p-2.5 bg-white/95 backdrop-blur-md rounded-2xl shadow-xl hover:bg-red-50 hover:text-red-500 transition-all active:scale-95",children:n.jsx(Yi,{className:"w-5 h-5"})}),n.jsx("div",{className:"absolute bottom-4 left-4 flex items-center gap-2",children:n.jsxs("div",{className:"bg-white/95 backdrop-blur-md text-blue-600 px-4 py-2 rounded-2xl text-[11px] font-black uppercase tracking-wider shadow-lg flex items-center gap-2",children:[n.jsx(dn,{className:"w-4 h-4"}),"Image Ready"]})})]})]}),n.jsxs("div",{className:"bg-white rounded-[2rem] p-6 sm:p-8 shadow-[0_20px_50px_-12px_rgba(0,0,0,0.06)] border border-slate-100 space-y-6",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[n.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-xl flex items-center justify-center",children:n.jsx(Jl,{className:"w-5 h-5 text-blue-600"})}),n.jsx("h3",{className:"text-xl font-extrabold text-[#1e293b]",children:"Refine Details"})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3 ml-1",children:"Serving Quantity"}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(J.length>0?J:["1 serving","1 bowl","1 plate","100g"]).map((Xe,ht)=>n.jsx("button",{type:"button",onClick:()=>X({...$,quantity:Xe}),className:`px-3 py-2 rounded-xl text-[11px] font-bold transition-all border-2 ${$.quantity===Xe?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200":"bg-white border-slate-100 text-slate-600 hover:border-blue-200"}`,children:Xe},ht))}),n.jsx("input",{type:"text",value:$.quantity,onChange:Xe=>X({...$,quantity:Xe.target.value}),placeholder:"Or specify exact amount",className:"w-full px-5 py-3.5 bg-slate-50/80 border-2 border-blue-200 rounded-xl focus:outline-none focus:border-blue-600 focus:bg-white transition-all text-sm font-semibold text-slate-800 placeholder-slate-400"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4 ml-1",children:"Preparation Method"}),n.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-2",children:[{label:"Fried",icon:""},{label:"Baked",icon:""},{label:"Grilled",icon:""},{label:"Home",icon:""},{label:"Dine-in",icon:""},{label:"Packaged",icon:""}].map(Xe=>n.jsxs("button",{type:"button",onClick:()=>X({...$,prepMethod:Xe.label}),className:`p-2.5 rounded-xl transition-all border-2 flex flex-col items-center gap-1.5 ${$.prepMethod===Xe.label?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200":"bg-white border-slate-100 text-slate-600 hover:border-blue-200"}`,children:[n.jsx("span",{className:"text-lg leading-none",children:Xe.icon}),n.jsx("span",{className:"text-[9px] font-black uppercase tracking-tighter",children:Xe.label})]},Xe.label))})]}),n.jsx("div",{className:"pt-4",children:n.jsxs("button",{onClick:re,disabled:x,className:"w-full group relative overflow-hidden py-5 bg-gradient-to-r from-purple-600 to-orange-600 text-white rounded-[2rem] font-black text-base tracking-widest transition-all active:scale-[0.98] shadow-[0_20px_40px_-12px_rgba(59,130,246,0.3)] disabled:opacity-50",children:[n.jsx("div",{className:"relative z-10 flex items-center justify-center gap-3 uppercase",children:x?n.jsxs(n.Fragment,{children:[n.jsx(dh,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{children:"Processing..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(nl,{className:"w-5 h-5 group-hover:animate-pulse"}),n.jsx("span",{children:"Analyze Now"})]})}),n.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1 bg-white/20 transform translate-y-2 group-hover:translate-y-0 transition-transform"})]})})]})]})]}),n.jsx("div",{className:"max-w-md mx-auto text-center",children:n.jsxs("div",{className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-50/50 backdrop-blur-sm rounded-full border border-blue-100 group",children:[n.jsx(zd,{className:"w-4 h-4 text-blue-500 group-hover:rotate-12 transition-transform"}),n.jsx("p",{className:"text-[11px] font-semibold text-blue-800 tracking-wide",children:"AI analysis is an estimate. Portions may impact accuracy."})]})})]})}),E&&I&&n.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[200] overflow-y-auto px-4 py-8",onClick:Xe=>{Xe.target===Xe.currentTarget&&ve()},children:n.jsxs("div",{className:"max-w-2xl mx-auto bg-white rounded-[2.5rem] shadow-[0_32px_64px_-12px_rgba(0,0,0,0.2)] overflow-hidden relative animate-in zoom-in-95 duration-300",onClick:Xe=>Xe.stopPropagation(),children:[n.jsx("div",{className:"relative p-8 pb-0",children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-8",children:[n.jsxs("div",{className:"flex items-center gap-6",children:[n.jsxs("div",{className:"relative w-32 h-32 flex-shrink-0",children:[n.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"58",stroke:"#f1f5f9",strokeWidth:"10",fill:"none"}),n.jsx("circle",{cx:"64",cy:"64",r:"58",stroke:I.healthScore10>=7?"#10b981":I.healthScore10>=4?"#f59e0b":"#ef4444",strokeWidth:"10",fill:"none",strokeDasharray:364.4,strokeDashoffset:364.4-Math.round((I.healthScore10||I.healthScore/10)*10)/100*364.4,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[n.jsx("span",{className:"text-4xl font-black text-slate-800",children:Math.round((I.healthScore10||I.healthScore/10)*10)}),n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"out of 100"})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest mb-2 ${I.isHealthy?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}`,children:[I.isHealthy?n.jsx(dn,{className:"w-3 h-3"}):n.jsx(Ln,{className:"w-3 h-3"}),I.isHealthy?"Healthy Choice":"Watch Portions"]}),n.jsx("h2",{className:"text-3xl font-black text-slate-800 leading-tight mb-1",children:(je=I.foodItem)==null?void 0:je.name}),n.jsxs("p",{className:"text-slate-500 font-bold flex items-center gap-2 uppercase text-[11px] tracking-widest",children:[n.jsx(nl,{className:"w-4 h-4 text-purple-500"}),((Ee=I.foodItem)==null?void 0:Ee.quantity)||"Standard Serving"]})]})]}),n.jsx("div",{className:"flex md:flex-col gap-2",children:n.jsx("button",{onClick:ve,className:"p-3 bg-slate-100 text-slate-400 rounded-2xl hover:bg-slate-200 transition-all active:scale-95",children:n.jsx(Yi,{className:"w-6 h-6"})})})]})}),n.jsx("div",{className:"px-8 mt-10",children:n.jsxs("div",{className:"bg-slate-50 rounded-[2.5rem] p-8 border border-slate-100 shadow-inner",children:[n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[{label:"Calories",value:(ze=(We=I.foodItem)==null?void 0:We.nutrition)==null?void 0:ze.calories,icon:Jl,color:"text-orange-500",bg:"bg-orange-100",b:"border-orange-200"},{label:"Protein",value:(bt=(st=I.foodItem)==null?void 0:st.nutrition)==null?void 0:bt.protein,icon:nl,color:"text-blue-500",bg:"bg-blue-100",b:"border-blue-200"},{label:"Carbs",value:(rt=(Qe=I.foodItem)==null?void 0:Qe.nutrition)==null?void 0:rt.carbs,icon:Cr,color:"text-emerald-500",bg:"bg-emerald-100",b:"border-emerald-200"},{label:"Fats",value:(we=(Nt=I.foodItem)==null?void 0:Nt.nutrition)==null?void 0:we.fats,icon:Vi,color:"text-rose-500",bg:"bg-rose-100",b:"border-rose-200"}].map(Xe=>{const ht=Xe.icon;return n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:`w-14 h-14 rounded-2xl ${Xe.bg} flex items-center justify-center mb-3 shadow-sm border ${Xe.b}`,children:n.jsx(ht,{className:`w-7 h-7 ${Xe.color}`})}),n.jsx("span",{className:"text-sm font-black text-slate-800",children:Xe.value||0}),n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:Xe.label})]},Xe.label)})}),n.jsx("div",{className:"flex flex-wrap justify-center gap-6 mt-8 pt-8 border-t border-slate-200",children:[{label:"Fiber",value:(Fe=(Rt=I.foodItem)==null?void 0:Rt.nutrition)==null?void 0:Fe.fiber,unit:"g"},{label:"Sugar",value:($e=(et=I.foodItem)==null?void 0:et.nutrition)==null?void 0:$e.sugar,unit:"g"},{label:"Sodium",value:(qt=(Kt=I.foodItem)==null?void 0:Kt.nutrition)==null?void 0:qt.sodium,unit:"mg"}].map(Xe=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-300"}),n.jsxs("span",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest",children:[Xe.label,":"]}),n.jsxs("span",{className:"text-xs font-black text-slate-800",children:[Xe.value||0,Xe.unit]})]},Xe.label))})]})}),n.jsxs("div",{className:"px-8 py-10 space-y-10",children:[n.jsxs("div",{className:"bg-blue-50/40 rounded-[2.5rem] p-7 border border-blue-100 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-100/50 flex items-center justify-center text-blue-600",children:n.jsx(Cr,{className:"w-4 h-4"})}),n.jsx("h4",{className:"text-sm font-black text-slate-700 tracking-tight uppercase",children:"Micronutrients Breakdown"})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(I.micronutrients||[]).map((Xe,ht)=>n.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-blue-100 shadow-sm",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-[11px] font-black text-slate-700 truncate",children:typeof Xe=="object"?Xe.name:Xe}),n.jsxs("span",{className:"text-[10px] font-black text-blue-600",children:[typeof Xe=="object"?Xe.percentage:"--","%"]})]}),n.jsx("p",{className:"text-xl font-black text-slate-800 mb-2",children:typeof Xe=="object"?Xe.value:"--"}),n.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-1000",style:{width:`${typeof Xe=="object"?Xe.percentage:0}%`}})})]},ht)),(!I.micronutrients||I.micronutrients.length===0)&&n.jsx("p",{className:"text-slate-400 text-xs italic p-4 text-center col-span-2",children:"No micronutrient data available"})]})]}),n.jsxs("div",{className:"bg-emerald-50/50 rounded-[2.5rem] p-7 border border-emerald-100 relative overflow-hidden group",children:[n.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-emerald-500 flex items-center justify-center text-white shadow-lg shadow-emerald-200 group-hover:rotate-12 transition-transform",children:n.jsx(sE,{className:"w-5 h-5"})}),n.jsx("h4",{className:"text-sm font-black text-emerald-900 tracking-tight uppercase",children:"Health Benefits"})]}),n.jsx("p",{className:"text-xs font-bold text-emerald-800/80 leading-relaxed",children:I.healthBenefitsSummary||I.analysis||"This meal provides essential nutrients for your daily requirements."})]}),n.jsxs("div",{className:"bg-amber-50/40 rounded-[2.5rem] p-7 border border-amber-100 group",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-white border border-amber-100 flex items-center justify-center text-orange-500 group-hover:scale-110 transition-transform",children:n.jsx(HA,{className:"w-5 h-5"})}),n.jsx("h4",{className:"text-sm font-black text-amber-900 tracking-tight uppercase",children:"Make it even Healthier"})]}),n.jsxs("div",{className:"space-y-3",children:[(I.enhancementTips||[]).map((Xe,ht)=>n.jsxs("div",{className:"bg-white rounded-[1.5rem] p-4 flex items-center gap-4 border border-amber-100 shadow-sm hover:shadow-md transition-all",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center text-white shrink-0",children:n.jsx($l,{className:"w-5 h-5"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"text-sm font-black text-slate-800 mb-0.5",children:typeof Xe=="object"?Xe.name:Xe}),n.jsx("p",{className:"text-[10px] font-bold text-slate-500 truncate",children:typeof Xe=="object"?Xe.benefit:"Adds nutritional value"})]})]},ht)),(!I.enhancementTips||I.enhancementTips.length===0)&&n.jsx("div",{className:"text-center py-4 text-slate-400 text-xs font-bold uppercase tracking-widest italic",children:"Already optimal!"})]})]}),n.jsxs("div",{className:"relative group p-1",children:[n.jsxs("h3",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4 flex items-center gap-2",children:[n.jsx(zd,{className:"w-4 h-4 text-blue-500"}),"Analysis Detail"]}),n.jsx("div",{className:"bg-white rounded-3xl p-6 border border-slate-100 shadow-sm",children:n.jsx("p",{className:"text-slate-600 font-medium leading-relaxed",children:I.analysis})})]})]}),I.warnings&&I.warnings.length>0&&n.jsxs("div",{className:"px-8 pb-10 space-y-4",children:[n.jsxs("h3",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1 flex items-center gap-2",children:[n.jsx(Ln,{className:"w-4 h-4 text-rose-500"}),"Nutritional Alerts"]}),n.jsx("div",{className:"grid gap-3",children:I.warnings.map((Xe,ht)=>n.jsxs("div",{className:"bg-rose-50/50 border border-rose-100 rounded-2xl p-4 flex items-center gap-4 group",children:[n.jsx("div",{className:"w-10 h-10 bg-rose-100 rounded-xl flex items-center justify-center shrink-0 group-hover:rotate-12 transition-transform",children:n.jsx(Ln,{className:"w-5 h-5 text-rose-600"})}),n.jsx("p",{className:"text-xs font-bold text-rose-900 leading-tight",children:Xe})]},ht))})]}),I.alternatives&&I.alternatives.length>0&&n.jsxs("div",{className:"space-y-4 px-8 pb-10",children:[n.jsxs("h3",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1 flex items-center gap-2",children:[n.jsx(Jl,{className:"w-4 h-4 text-emerald-500"}),"Smart Alternatives"]}),n.jsx("div",{className:"flex overflow-x-auto scrollbar-hide gap-5 -mx-8 px-8",children:I.alternatives.map((Xe,ht)=>{var dt;return n.jsxs("div",{className:"min-w-[280px] group bg-white border border-slate-100 rounded-[2rem] p-6 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all",children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"font-black text-slate-800 text-base leading-tight group-hover:text-emerald-600 transition-colors uppercase tracking-tight",children:Xe.name}),n.jsxs("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:[Xe.prepTime||"Quick"," Prep"]})]}),n.jsxs("div",{className:"bg-emerald-50 text-emerald-600 text-[11px] font-black px-3 py-1.5 rounded-xl border border-emerald-100",children:[(dt=Xe.nutrition)==null?void 0:dt.calories," Kcal"]})]}),n.jsxs("p",{className:"text-xs text-slate-500 font-medium leading-relaxed mb-6 line-clamp-2 italic",children:['"',Xe.description,'"']}),n.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-50",children:[n.jsx("div",{className:"flex gap-2",children:n.jsx("div",{className:"px-2 py-1 bg-blue-50 text-blue-600 text-[9px] font-black rounded-lg uppercase",children:"High Prot"})}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Satiety"}),n.jsxs("span",{className:"text-xs font-black text-slate-800",children:[Xe.satietyScore||8,"/10"]})]})]})]},ht)})})]}),n.jsxs("div",{className:"flex gap-4 pt-6",children:[n.jsx("button",{onClick:ve,className:"flex-1 py-5 bg-slate-100 text-slate-600 rounded-[2rem] font-black text-sm uppercase tracking-widest hover:bg-slate-200 transition-all active:scale-95",children:"Discard"}),n.jsxs("button",{onClick:fe,className:"flex-[2] py-5 bg-[#1e293b] text-white rounded-[2rem] font-black text-sm uppercase tracking-widest shadow-2xl hover:bg-slate-800 transition-all active:scale-95 flex items-center justify-center gap-3",children:[n.jsx(dn,{className:"w-5 h-5 text-blue-400"}),"Add to Diary"]})]})]})}),se&&n.jsx("div",{className:"fixed inset-0 bg-black/60 z-[10001] flex items-end sm:items-center justify-center",onClick:()=>oe(!1),children:n.jsxs("div",{className:"bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl p-6",onClick:Xe=>Xe.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Select Meal Type"}),n.jsx("button",{onClick:()=>oe(!1),className:"p-2 hover:bg-gray-100 rounded-full",children:n.jsx(Yi,{className:"w-5 h-5 text-gray-700"})})]}),n.jsx("div",{className:"space-y-3 mb-6",children:[{type:"breakfast",icon:"",label:"Breakfast",color:"from-purple-400 to-orange-400"},{type:"lunch",icon:"",label:"Lunch",color:"from-purple-400 to-orange-400"},{type:"dinner",icon:"",label:"Dinner",color:"from-purple-400 to-orange-400"},{type:"snack",icon:"",label:"Snacks",color:"from-purple-400 to-orange-400"}].map(Xe=>n.jsxs("button",{onClick:()=>he(Xe.type),className:`w-full p-4 rounded-xl flex items-center gap-4 transition-all ${Te===Xe.type?`bg-gradient-to-r ${Xe.color} text-white shadow-lg scale-105`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[n.jsx("span",{className:"text-3xl",children:Xe.icon}),n.jsx("div",{className:"flex-1 text-left",children:n.jsx("p",{className:"font-bold text-lg",children:Xe.label})}),Te===Xe.type&&n.jsx(dn,{className:"w-6 h-6"})]},Xe.type))}),n.jsxs("button",{onClick:Ie,className:"w-full py-3 bg-gradient-to-r from-purple-600 to-orange-600 text-white rounded-xl font-bold hover:shadow-lg transition-all",children:["Log to ",Te.charAt(0).toUpperCase()+Te.slice(1)]})]})}),x&&n.jsxs("div",{className:"fixed inset-0 bg-slate-900 z-[10000] flex items-center justify-center overflow-hidden",style:{position:"fixed",top:0,left:0,right:0,bottom:0,touchAction:"none"},children:[n.jsxs("div",{className:"absolute top-0 left-0 w-full h-full",children:[n.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-600/20 rounded-full blur-[120px] animate-pulse"}),n.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-purple-600/20 rounded-full blur-[120px] animate-pulse",style:{animationDelay:"1s"}})]}),n.jsxs("div",{className:"relative text-center px-8 w-full max-w-lg",children:[n.jsx("div",{className:"relative mb-12",children:n.jsxs("div",{className:"w-48 h-48 mx-auto relative",children:[n.jsx("div",{className:"absolute inset-0 border-[3px] border-dashed border-blue-400/30 rounded-full animate-spin",style:{animationDuration:"8s"}}),n.jsx("div",{className:"absolute inset-4 bg-gradient-to-br from-purple-500 to-orange-400 rounded-full p-1 shadow-[0_0_50px_rgba(59,130,246,0.5)]",children:n.jsxs("div",{className:"w-full h-full bg-slate-900 rounded-full flex items-center justify-center overflow-hidden",children:[n.jsx("div",{className:"absolute inset-x-0 h-1 bg-blue-400/50 blur-sm animate-[scan_2s_linear_infinite]"}),n.jsx(Y3,{className:"w-16 h-16 text-blue-400 drop-shadow-[0_0_10px_rgba(96,165,250,0.8)]"})]})})]})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("h2",{className:"text-4xl font-black text-white tracking-tighter",children:["Scanning ",n.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-orange-300",children:"Nutrition"})]}),n.jsx("p",{className:"text-slate-400 font-bold text-sm uppercase tracking-[0.3em]",children:"AI processing active"})]}),n.jsx("div",{className:"mt-12 space-y-3 bg-white/5 backdrop-blur-md rounded-[2.5rem] p-8 border border-white/10 shadow-2xl",children:[{text:"Optimizing high-res capture",active:!1,done:!0},{text:"Neural food recognition",active:!0,done:!1},{text:"Cross-referencing database",active:!1,done:!1},{text:"Calculating health impact",active:!1,done:!1}].map((Xe,ht)=>n.jsxs("div",{className:`flex items-center gap-4 transition-opacity duration-500 ${Xe.done||Xe.active?"opacity-100":"opacity-20"}`,children:[Xe.done?n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400 shadow-[0_0_10px_rgba(96,165,250,1)]"}):Xe.active?n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400 animate-ping"}):n.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-600"}),n.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${Xe.active?"text-blue-400":"text-slate-300"}`,children:Xe.text})]},ht))}),n.jsxs("div",{className:"mt-8 flex items-center justify-center gap-3",children:[n.jsx(zd,{className:"w-4 h-4 text-blue-400"}),n.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest leading-loose",children:"DO NOT DISCONNECT  ANALYZING COMPOSITION"})]})]}),n.jsx("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes scan {
                  0% { transform: translateY(-100%); opacity: 0; }
                  50% { opacity: 1; }
                  100% { transform: translateY(100%); opacity: 0; }
                }
                .scrollbar-hide::-webkit-scrollbar { display: none; }
                .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
              `}})]})]})}const u0e=({isOpen:a,onClose:o,onSave:c})=>{const[d,h]=te.useState(150),[m,g]=te.useState("fasting"),x=new Date;x.setMinutes(x.getMinutes()-x.getTimezoneOffset());const[v,E]=te.useState(x.toISOString().slice(0,16)),S=te.useRef(null),I=te.useRef(!1),k=40,R=400;te.useEffect(()=>{if(a&&S.current){const Ne=(d-k)*8-S.current.clientWidth/2;S.current.scrollLeft=Math.max(0,Ne)}},[a]);const O=()=>{if(!S.current)return;const me=8,Ne=S.current.scrollLeft,le=S.current.clientWidth/2,H=Math.round((Ne+le)/me)+k;H>=k&&H<=R&&h(H)},F=me=>{const Ne=parseInt(me.target.value);if(isNaN(Ne))h("");else if(h(Ne),S.current&&Ne>=k&&Ne<=R){const H=(Ne-k)*8-S.current.clientWidth/2;S.current.scrollLeft=Math.max(0,H)}},M=me=>{h(Ne=>{const le=Math.min(Math.max(Ne+me,k),R);if(S.current){const Ae=(le-k)*8-S.current.clientWidth/2;S.current.scrollLeft=Math.max(0,Ae)}return le})},Q=()=>{const me={value:d,type:m,time:new Date(v).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),timestamp:new Date(v).toISOString()};c(me),o(),h(150),g("fasting")},Z=()=>d>=70&&d<=130?"text-slate-800":d>130?"text-red-600":"text-yellow-600";if(!a)return null;const $=[{id:"fasting",label:"Fasting",description:"Reading taken after an overnight fast",icon:n.jsx("div",{className:"w-11 h-11 bg-gray-100 rounded-full flex items-center justify-center",children:n.jsx(cl,{className:"w-5 h-5 text-gray-500"})})},{id:"before-meal",label:"Before meal",description:"Reading taken within 15 minutes before a major meal",icon:n.jsx("div",{className:"w-11 h-11 bg-gray-100 rounded-full flex items-center justify-center",children:n.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})},{id:"after-meal",label:"After meal",description:"Reading taken 2 hours after a meal",icon:n.jsx("div",{className:"w-11 h-11 bg-gray-100 rounded-full flex items-center justify-center",children:n.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})},{id:"bedtime",label:"Bedtime",description:"Reading taken before going to sleep",icon:n.jsx("div",{className:"w-11 h-11 bg-gray-100 rounded-full flex items-center justify-center",children:n.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})}],X=R-k,be=[];for(let me=0;me<=X;me++){const Ne=k+me,le=Ne%10===0,H=Ne%5===0&&!le;be.push({val:Ne,isMajor:le,isMid:H})}return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300",onClick:o}),n.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-slide-up",children:n.jsxs("div",{className:"bg-white rounded-t-3xl shadow-2xl max-h-[92vh] overflow-y-auto",children:[n.jsx("div",{className:"flex justify-center pt-3 pb-1",children:n.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),n.jsxs("div",{className:"sticky top-0 bg-white px-5 py-3 flex items-center gap-3 z-10",children:[n.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:n.jsx(ln,{className:"w-5 h-5 text-slate-700"})}),n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Log Glucose"})]}),n.jsxs("div",{className:"px-5 pb-8",children:[n.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6 mb-6 text-center flex items-center justify-center",children:[n.jsx("input",{type:"number",value:d,onChange:F,className:`w-28 text-6xl font-extrabold ${Z()} tracking-tight text-center bg-transparent border-none outline-none focus:ring-0`}),n.jsx("span",{className:"text-lg text-gray-400 font-medium ml-1",children:"mg/dL"})]}),n.jsxs("div",{className:"mb-8 relative",children:[n.jsx("div",{className:"flex justify-center mb-1",children:n.jsx("div",{className:"w-0 h-0 border-l-[8px] border-r-[8px] border-t-[10px] border-l-transparent border-r-transparent border-t-blue-500"})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>M(-5),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(Cg,{className:"w-4 h-4 text-gray-600"})}),n.jsx("div",{ref:S,onScroll:O,className:"flex-1 overflow-x-auto scrollbar-hide relative",style:{scrollBehavior:I.current?"auto":"smooth",WebkitOverflowScrolling:"touch"},onTouchStart:()=>{I.current=!0},onTouchEnd:()=>{I.current=!1},onMouseDown:()=>{I.current=!0},onMouseUp:()=>{I.current=!1},children:n.jsx("div",{className:"flex items-end h-20",style:{width:`${X*8}px`,paddingLeft:"50%",paddingRight:"50%"},children:be.map((me,Ne)=>n.jsxs("div",{className:"flex flex-col items-center",style:{width:"8px",flexShrink:0},children:[n.jsx("div",{className:`w-px ${me.isMajor?"h-10 bg-gray-700":me.isMid?"h-6 bg-gray-400":"h-3 bg-gray-300"}`}),me.isMajor&&n.jsx("span",{className:"text-[10px] text-gray-500 mt-1 font-medium",children:me.val})]},Ne))})}),n.jsx("button",{onClick:()=>M(5),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx($l,{className:"w-4 h-4 text-gray-600"})})]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"When was this reading taken?"}),n.jsx("div",{className:"bg-gray-50 rounded-xl p-4 flex items-center justify-between border border-gray-200",children:n.jsx("input",{type:"datetime-local",value:v,onChange:me=>E(me.target.value),className:"bg-transparent text-gray-700 text-sm font-medium w-full outline-none"})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"Type of reading"}),n.jsx("div",{className:"space-y-3",children:$.map(me=>n.jsx("button",{onClick:()=>g(me.id),className:`w-full p-4 rounded-2xl border-2 transition-all duration-200 ${m===me.id?"border-blue-500 bg-blue-50/50 shadow-sm":"border-gray-200 bg-white hover:border-gray-300"}`,children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[me.icon,n.jsxs("div",{className:"text-left",children:[n.jsx("div",{className:"font-semibold text-slate-800 text-sm",children:me.label}),n.jsx("div",{className:"text-xs text-gray-500 mt-0.5 leading-relaxed",children:me.description})]})]}),n.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 ml-3 transition-all ${m===me.id?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:m===me.id&&n.jsx("div",{className:"w-2.5 h-2.5 bg-white rounded-full"})})]})},me.id))})]}),n.jsx("button",{onClick:Q,className:"w-full bg-gradient-to-r from-purple-500 to-orange-600 text-white py-4 rounded-full font-bold text-base hover:from-purple-600 hover:to-orange-700 transition-all shadow-lg shadow-blue-200 active:scale-[0.98]",children:"Save Reading"})]})]})}),n.jsx("style",{children:`
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.35s cubic-bezier(0.32, 0.72, 0, 1);
        }
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})},h0e=({isOpen:a,onClose:o,onSave:c})=>{const[d,h]=te.useState(5.7),m=new Date;m.setMinutes(m.getMinutes()-m.getTimezoneOffset());const[g,x]=te.useState(m.toISOString().slice(0,16)),v=te.useRef(null),E=te.useRef(!1),S=30,I=150;te.useEffect(()=>{if(a&&v.current){const X=(d*10-S)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,X)}},[a]);const k=()=>{if(!v.current)return;const $=8,X=v.current.scrollLeft,be=v.current.clientWidth/2,me=Math.round((X+be)/$)+S;me>=S&&me<=I&&h(me/10)},R=$=>{const X=parseFloat($.target.value);if(isNaN(X))h("");else if(h(X),v.current&&X*10>=S&&X*10<=I){const me=(X*10-S)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,me)}},O=$=>{h(X=>{const be=Math.min(Math.max(X*10+$,S),I),me=be/10;if(v.current){const le=(be-S)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,le)}return me})},F=()=>{const $={value:d,type:"hba1c",time:new Date(g).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),timestamp:new Date(g).toISOString()};c($),o()},M=()=>d>=4&&d<=5.6?"text-emerald-600":d>=5.7&&d<=6.4?"text-yellow-600":"text-red-600";if(!a)return null;const Q=I-S,Z=[];for(let $=0;$<=Q;$++){const X=S+$,be=X%10===0,me=X%5===0&&!be;Z.push({val:X/10,isMajor:be,isMid:me})}return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300",onClick:o}),n.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-slide-up",children:n.jsxs("div",{className:"bg-white rounded-t-3xl shadow-2xl max-h-[92vh] overflow-y-auto pb-4",children:[n.jsx("div",{className:"flex justify-center pt-3 pb-1",children:n.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),n.jsxs("div",{className:"sticky top-0 bg-white px-5 py-3 flex items-center gap-3 z-10",children:[n.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:n.jsx(ln,{className:"w-5 h-5 text-slate-700"})}),n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Log HbA1c"})]}),n.jsxs("div",{className:"px-5 pb-8",children:[n.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6 mb-6 text-center flex items-center justify-center",children:[n.jsx("input",{type:"number",step:"0.1",value:d,onChange:R,className:`w-32 text-6xl font-extrabold ${M()} tracking-tight text-center bg-transparent border-none outline-none focus:ring-0`}),n.jsx("span",{className:"text-lg text-gray-400 font-medium ml-1",children:"%"})]}),n.jsxs("div",{className:"mb-8 relative",children:[n.jsx("div",{className:"flex justify-center mb-1",children:n.jsx("div",{className:"w-0 h-0 border-l-[8px] border-r-[8px] border-t-[10px] border-l-transparent border-r-transparent border-t-blue-500"})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>O(-1),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(Cg,{className:"w-4 h-4 text-gray-600"})}),n.jsx("div",{ref:v,onScroll:k,className:"flex-1 overflow-x-auto scrollbar-hide relative",style:{scrollBehavior:E.current?"auto":"smooth",WebkitOverflowScrolling:"touch"},onTouchStart:()=>{E.current=!0},onTouchEnd:()=>{E.current=!1},onMouseDown:()=>{E.current=!0},onMouseUp:()=>{E.current=!1},children:n.jsx("div",{className:"flex items-end h-20",style:{width:`${Q*8}px`,paddingLeft:"50%",paddingRight:"50%"},children:Z.map(($,X)=>n.jsxs("div",{className:"flex flex-col items-center",style:{width:"8px",flexShrink:0},children:[n.jsx("div",{className:`w-px ${$.isMajor?"h-10 bg-gray-700":$.isMid?"h-6 bg-gray-400":"h-3 bg-gray-300"}`}),$.isMajor&&n.jsx("span",{className:"text-[10px] text-gray-500 mt-1 font-medium",children:$.val})]},X))})}),n.jsx("button",{onClick:()=>O(1),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx($l,{className:"w-4 h-4 text-gray-600"})})]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"When was this reading taken?"}),n.jsx("div",{className:"bg-gray-50 rounded-xl p-4 flex items-center justify-between border border-gray-200",children:n.jsx("input",{type:"datetime-local",value:g,onChange:$=>x($.target.value),className:"bg-transparent text-gray-700 text-sm font-medium w-full outline-none"})})]}),n.jsx("button",{onClick:F,className:"w-full bg-gradient-to-r from-purple-500 to-orange-600 text-white py-4 rounded-full font-bold text-base hover:from-purple-600 hover:to-orange-700 transition-all shadow-lg shadow-blue-200 active:scale-[0.98]",children:"Save Reading"})]})]})})]})},p0e=({isOpen:a,onClose:o,onSave:c})=>{const[d,h]=te.useState(70),m=new Date;m.setMinutes(m.getMinutes()-m.getTimezoneOffset());const[g,x]=te.useState(m.toISOString().slice(0,16)),v=te.useRef(null),E=te.useRef(!1),S=200,I=2500;te.useEffect(()=>{if(a&&v.current){const $=(d*10-S)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,$)}},[a]);const k=Z=>{const $=parseFloat(Z.target.value);if(isNaN($))h("");else if(h($),v.current&&$*10>=S&&$*10<=I){const be=($*10-S)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,be)}},R=Z=>{h($=>{const X=Math.min(Math.max($*10+Z,S),I),be=X/10;if(v.current){const Ne=(X-S)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,Ne)}return be})},O=()=>{const Z={value:d,type:"weight",time:new Date(g).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),timestamp:new Date(g).toISOString()};c(Z),o()};if(!a)return null;const F=[];for(let Z=0;Z<=(I-S)/10;Z++){const $=S/10+Z,X=$%5===0,be=$%1===0&&!X;F.push({val:$,isMajor:X,isMid:be})}const M=80,Q=()=>{if(!v.current)return;const Z=v.current.scrollLeft,$=v.current.clientWidth/2,X=Math.round((Z+$)/(M/10))+S;X>=S&&X<=I&&h(X/10)};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300",onClick:o}),n.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-slide-up",children:n.jsxs("div",{className:"bg-white rounded-t-3xl shadow-2xl max-h-[92vh] overflow-y-auto pb-4",children:[n.jsx("div",{className:"flex justify-center pt-3 pb-1",children:n.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),n.jsxs("div",{className:"sticky top-0 bg-white px-5 py-3 flex items-center gap-3 z-10",children:[n.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:n.jsx(ln,{className:"w-5 h-5 text-slate-700"})}),n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Log Weight"})]}),n.jsxs("div",{className:"px-5 pb-8",children:[n.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6 mb-6 text-center flex items-center justify-center",children:[n.jsx("input",{type:"number",step:"0.1",value:d,onChange:k,className:"w-36 text-6xl font-extrabold text-blue-900 tracking-tight text-center bg-transparent border-none outline-none focus:ring-0"}),n.jsx("span",{className:"text-lg text-gray-400 font-medium ml-1",children:"kg"})]}),n.jsxs("div",{className:"mb-8 relative",children:[n.jsx("div",{className:"flex justify-center mb-1",children:n.jsx("div",{className:"w-0 h-0 border-l-[8px] border-r-[8px] border-t-[10px] border-l-transparent border-r-transparent border-t-blue-500"})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>R(-10),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(Cg,{className:"w-4 h-4 text-gray-600"})}),n.jsx("div",{ref:v,onScroll:Q,className:"flex-1 overflow-x-auto scrollbar-hide relative",style:{scrollBehavior:E.current?"auto":"smooth",WebkitOverflowScrolling:"touch"},onTouchStart:()=>{E.current=!0},onTouchEnd:()=>{E.current=!1},onMouseDown:()=>{E.current=!0},onMouseUp:()=>{E.current=!1},children:n.jsx("div",{className:"flex items-end h-20",style:{width:`${F.length*M}px`,paddingLeft:"50%",paddingRight:"50%"},children:F.map((Z,$)=>n.jsxs("div",{className:"flex justify-between items-end",style:{width:`${M}px`,flexShrink:0},children:[n.jsxs("div",{className:"flex flex-col items-center flex-1",children:[n.jsx("div",{className:`w-px ${Z.isMajor?"h-10 bg-gray-700":"h-6 bg-gray-400"}`}),Z.isMajor&&n.jsx("span",{className:"text-[10px] text-gray-500 mt-1 font-medium",children:Z.val})]}),n.jsx("div",{className:"w-px h-3 bg-gray-300"}),n.jsx("div",{className:"w-px h-3 bg-gray-300"}),n.jsx("div",{className:"w-px h-3 bg-gray-300"})]},$))})}),n.jsx("button",{onClick:()=>R(10),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx($l,{className:"w-4 h-4 text-gray-600"})})]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"When was this reading taken?"}),n.jsx("div",{className:"bg-gray-50 rounded-xl p-4 flex items-center justify-between border border-gray-200",children:n.jsx("input",{type:"datetime-local",value:g,onChange:Z=>x(Z.target.value),className:"bg-transparent text-gray-700 text-sm font-medium w-full outline-none"})})]}),n.jsx("button",{onClick:O,className:"w-full bg-gradient-to-r from-purple-500 to-orange-600 text-white py-4 rounded-full font-bold text-base hover:from-purple-600 hover:to-orange-700 transition-all shadow-lg shadow-blue-200 active:scale-[0.98]",children:"Save Reading"})]})]})})]})},m0e=()=>{const a=to(),[o,c]=te.useState(!1),[d,h]=te.useState(!1),[m,g]=te.useState(!1),[x,v]=te.useState([]),[E,S]=te.useState([]),[I,k]=te.useState([]),[R,O]=te.useState([]),[F,M]=te.useState(108),[Q,Z]=te.useState("stable"),[$,X]=te.useState(!1),[be,me]=te.useState("108"),[Ne,le]=te.useState(!0),[H,Ae]=te.useState("blood_sugar"),[J,Y]=te.useState("Week"),[se,oe]=te.useState(!1),Te=te.useRef(null),he=te.useRef(null);te.useEffect(()=>{Ce()},[]);const Ce=async()=>{try{le(!0);const Qe=await Wt.get("/metrics/blood_sugar?limit=10");v(Qe.data);const[rt,Nt,we]=await Promise.all([Wt.get("/metrics/blood_sugar?limit=50"),Wt.get("/metrics/hba1c?limit=50"),Wt.get("/metrics/weight?limit=50")]);if(S(rt.data),k(Nt.data),O(we.data),Qe.data&&Qe.data.length>0){const Rt=Qe.data[0].value;M(Rt),me(String(Rt)),ee(Rt)}}catch(Qe){console.error("Error fetching metrics:",Qe)}finally{le(!1)}},ee=Qe=>{Qe>=70&&Qe<=130?Z("stable"):Qe>130?Z("high"):Z("low")},Be=async(Qe,rt,Nt,we,Rt)=>{try{const Fe={type:Qe,value:rt,unit:Nt,readingContext:we,recordedAt:Rt,notes:""};await Wt.post("/metrics",Fe),Ce()}catch(Fe){console.error("Error saving reading:",Fe)}},He=async Qe=>{await Be("blood_sugar",Qe.value,"mg/dL",Qe.type,Qe.timestamp)},Ue=async Qe=>{await Be("hba1c",Qe.value,"%","fasting",Qe.timestamp),Ae("hba1c")},re=async Qe=>{await Be("weight",Qe.value,"kg","general",Qe.timestamp),Ae("weight")},ve=()=>{X(!0),me(String(F)),setTimeout(()=>{var Qe;return(Qe=Te.current)==null?void 0:Qe.select()},50)},fe=Qe=>{const rt=Qe.target.value.replace(/[^0-9]/g,"");if(rt.length<=3){me(rt);const Nt=parseInt(rt)||0;Nt>=40&&Nt<=400&&(M(Nt),ee(Nt))}},Ie=()=>{X(!1);const Qe=parseInt(be)||108,rt=Math.min(Math.max(Qe,40),400);M(rt),me(String(rt)),ee(rt)},je=Qe=>{Qe.key==="Enter"&&Ie()},Ee=Qe=>{if(!he.current)return;const rt=he.current.getBoundingClientRect(),Nt=rt.left+rt.width/2,we=rt.top+rt.height*.85,Rt=Qe.touches?Qe.touches[0].clientX:Qe.clientX,Fe=Qe.touches?Qe.touches[0].clientY:Qe.clientY,et=Rt-Nt,$e=we-Fe;let Kt=Math.atan2(et,$e)*(180/Math.PI);Kt=Math.max(-135,Math.min(135,Kt));const qt=40,Xe=400,ht=Math.round(qt+(Kt+135)/270*(Xe-qt)),dt=Math.min(Math.max(ht,qt),Xe);M(dt),me(String(dt)),ee(dt)},We=()=>-135+(Math.min(Math.max(F,40),400)-40)/360*270,ze=()=>{let Qe=[];if(H==="blood_sugar"?Qe=E:H==="hba1c"?Qe=I:H==="weight"&&(Qe=R),!Qe||Qe.length===0)return[{day:"N/A",value:0}];const rt=[...Qe].sort((et,$e)=>new Date(et.recordedAt)-new Date($e.recordedAt)),Nt=new Date;let we=new Date;J==="Week"?we.setDate(Nt.getDate()-7):J==="Month"?we.setMonth(Nt.getMonth()-1):J==="3 Months"&&we.setMonth(Nt.getMonth()-3);const Rt=rt.filter(et=>new Date(et.recordedAt)>=we);return(Rt.length>0?Rt:rt.slice(-7)).map(et=>{const $e=new Date(et.recordedAt);return{day:$e.toLocaleDateString("en-US",{weekday:"short"}),value:et.value,fullDate:$e.toLocaleDateString()}})},st=()=>H==="hba1c"?[4,6,8,10]:H==="weight"?[50,70,90,110]:[1,48,95,142,190],bt=Qe=>{const{cx:rt,cy:Nt,value:we}=Qe;let Rt="#10b981";return H==="blood_sugar"&&(we>150&&(Rt="#f59e0b"),we<50&&(Rt="#ef4444")),n.jsx("circle",{cx:rt,cy:Nt,r:4,strokeWidth:2,stroke:"#fff",fill:Rt})};return n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-100 pb-28",children:[n.jsx("div",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur-md border-b border-white/40",children:n.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("button",{onClick:()=>a("/dashboard"),className:"mr-3 p-2 hover:bg-white/60 rounded-full transition-colors",children:n.jsx(ln,{className:"w-5 h-5 text-slate-700"})}),n.jsx("h1",{className:"text-lg font-bold text-slate-800",children:"Blood Sugar"})]}),n.jsx("div",{children:n.jsx("span",{className:`px-3 py-1 text-white rounded-full text-[11px] font-bold tracking-wide ${Q==="stable"?"bg-emerald-500":Q==="high"?"bg-red-500":"bg-yellow-500"}`,children:Q==="stable"?"IN RANGE":Q.toUpperCase()})})]})}),n.jsxs("div",{className:"px-3 md:px-4 py-4 space-y-6 max-w-7xl mx-auto",children:[n.jsx("p",{className:"text-center text-gray-500 text-sm",children:Q==="stable"?"Your current status is stable":`Your glucose is ${Q}`}),n.jsxs("div",{ref:he,className:"relative w-64 h-40 mx-auto cursor-pointer select-none",onClick:Ee,onMouseDown:Qe=>{const rt=we=>Ee(we),Nt=()=>{document.removeEventListener("mousemove",rt),document.removeEventListener("mouseup",Nt)};document.addEventListener("mousemove",rt),document.addEventListener("mouseup",Nt)},onTouchStart:Qe=>{Ee(Qe);const rt=we=>Ee(we),Nt=()=>{document.removeEventListener("touchmove",rt),document.removeEventListener("touchend",Nt)};document.addEventListener("touchmove",rt),document.addEventListener("touchend",Nt)},children:[n.jsxs("svg",{viewBox:"0 0 200 130",className:"w-full h-full",children:[n.jsx("path",{d:"M 20 120 A 80 80 0 0 1 180 120",fill:"none",stroke:"#e5e7eb",strokeWidth:"18",strokeLinecap:"round"}),n.jsx("path",{d:"M 20 120 A 80 80 0 0 1 55 45",fill:"none",stroke:"#22c55e",strokeWidth:"18",strokeLinecap:"round"}),n.jsx("path",{d:"M 55 45 A 80 80 0 0 1 100 30",fill:"none",stroke:"#f59e0b",strokeWidth:"18",strokeLinecap:"round"}),n.jsx("path",{d:"M 100 30 A 80 80 0 0 1 145 45",fill:"none",stroke:"#ef4444",strokeWidth:"18",strokeLinecap:"round"}),n.jsx("path",{d:"M 145 45 A 80 80 0 0 1 180 120",fill:"none",stroke:"#f3f4f6",strokeWidth:"18",strokeLinecap:"round"}),n.jsxs("g",{transform:`rotate(${We()}, 100, 120)`,className:"transition-transform duration-200",children:[n.jsx("line",{x1:"100",y1:"120",x2:"100",y2:"48",stroke:"#1e293b",strokeWidth:"3",strokeLinecap:"round"}),n.jsx("circle",{cx:"100",cy:"120",r:"6",fill:"#1e293b"}),n.jsx("circle",{cx:"100",cy:"120",r:"3",fill:"white"})]})]}),n.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 text-center",children:$?n.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[n.jsx("input",{ref:Te,type:"text",inputMode:"numeric",value:be,onChange:fe,onBlur:Ie,onKeyDown:je,className:"w-24 text-5xl font-extrabold text-center bg-transparent outline-none border-b-2 border-blue-500 text-slate-800",autoFocus:!0}),n.jsx("span",{className:"text-sm text-gray-400 font-semibold tracking-wider",children:"MG/DL"})]}):n.jsxs("button",{onClick:ve,className:"group",children:[n.jsx("div",{className:"text-5xl font-extrabold text-slate-800 leading-none group-hover:text-blue-600 transition-colors",children:F}),n.jsx("div",{className:"text-sm text-gray-400 font-semibold tracking-wider mt-1",children:"MG/DL"}),n.jsx("div",{className:"text-[10px] text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity",children:"tap to edit"})]})})]}),n.jsxs("div",{className:"flex justify-center gap-2 px-2 mt-8",children:[n.jsx("button",{onClick:()=>h(!0),className:"flex-1 bg-white border border-blue-100 shadow-sm text-blue-600 py-3 rounded-2xl font-bold text-[13px] hover:bg-blue-50 transition-colors",children:"Log HbA1c"}),n.jsx("button",{onClick:()=>c(!0),className:"flex-[1.5] bg-gradient-to-r from-purple-500 to-orange-600 text-white shadow-md shadow-blue-200 py-3 rounded-2xl font-bold text-[13px] hover:from-purple-600 hover:to-orange-700 transition-colors focus:scale-95",children:"+ Log Glucose"}),n.jsx("button",{onClick:()=>g(!0),className:"flex-1 bg-white border border-blue-100 shadow-sm text-blue-600 py-3 rounded-2xl font-bold text-[13px] hover:bg-blue-50 transition-colors",children:"Log Weight"})]}),n.jsxs("div",{className:"mt-8",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Trend"}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>oe(!se),className:"flex items-center gap-1.5 text-sm font-semibold text-blue-600 bg-blue-50/80 px-3 py-1.5 rounded-full",children:[H==="blood_sugar"?"Glucose":H==="hba1c"?"HbA1c":"Weight",n.jsx(lh,{className:"w-4 h-4"})]}),se&&n.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden z-20 w-36",children:[n.jsx("button",{onClick:()=>{Ae("blood_sugar"),oe(!1)},className:`w-full text-left px-4 py-2.5 text-sm font-medium hover:bg-blue-50 ${H==="blood_sugar"?"text-blue-600 bg-blue-50/50":"text-slate-700"}`,children:"Glucose"}),n.jsx("button",{onClick:()=>{Ae("hba1c"),oe(!1)},className:`w-full text-left px-4 py-2.5 text-sm font-medium hover:bg-blue-50 ${H==="hba1c"?"text-blue-600 bg-blue-50/50":"text-slate-700"}`,children:"HbA1c"}),n.jsx("button",{onClick:()=>{Ae("weight"),oe(!1)},className:`w-full text-left px-4 py-2.5 text-sm font-medium hover:bg-blue-50 ${H==="weight"?"text-blue-600 bg-blue-50/50":"text-slate-700"}`,children:"Weight"})]})]})]}),n.jsxs("div",{className:"bg-white/90 backdrop-blur-md rounded-3xl p-5 shadow-[0_4px_20px_rgba(0,0,0,0.04)] border border-white",children:[n.jsx("div",{className:"bg-gray-100/80 rounded-full p-1 flex items-center justify-between mb-4",children:["Week","Month","3 Months"].map(Qe=>n.jsx("button",{onClick:()=>Y(Qe),className:`flex-1 py-2 text-[13px] font-bold rounded-full transition-all ${J===Qe?"bg-[#1e293b] text-white shadow-md":"text-slate-500 hover:text-slate-700"}`,children:Qe},Qe))}),n.jsxs("div",{className:"flex justify-between items-end mb-4",children:[n.jsx("div",{children:n.jsxs("div",{className:"text-2xl font-extrabold text-[#112340] leading-none flex items-baseline gap-1",children:[(()=>{const rt=ze().filter(we=>we.day!=="N/A");if(rt.length===0)return"0%";const Nt=rt.filter(we=>H==="blood_sugar"?we.value>=70&&we.value<=130:H==="hba1c"?we.value<7:!0).length;return Math.round(Nt/rt.length*100)+"%"})()," ",n.jsx("span",{className:"text-sm font-bold text-slate-800",children:H==="blood_sugar"?"normal":H==="hba1c"?"goal":"recorded"})]})}),n.jsx("div",{className:"text-xs font-semibold text-slate-400",children:J==="Week"?"Last 7 days":J==="Month"?"Last 30 days":"Last 90 days"})]}),H==="blood_sugar"&&n.jsxs("div",{className:"flex items-center gap-4 mb-6 flex-wrap",children:[n.jsxs("div",{className:"flex items-center gap-1.5 text-[11.5px] font-bold text-slate-700",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#10b981]"})," ","Normal"]}),n.jsxs("div",{className:"flex items-center gap-1.5 text-[11.5px] font-bold text-slate-700",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#f59e0b]"})," High"]}),n.jsxs("div",{className:"flex items-center gap-1.5 text-[11.5px] font-bold text-slate-700",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#ef4444]"})," ","Critical"]}),n.jsxs("div",{className:"flex items-center gap-1.5 text-[11.5px] font-bold text-slate-700",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#d97706]"})," Low"]})]}),n.jsx("div",{className:"h-56 w-full -ml-3",children:n.jsx(Yb,{width:"100%",height:"100%",children:n.jsxs(cQ,{data:ze(),margin:{top:10,right:10,left:0,bottom:0},children:[n.jsx(nE,{strokeDasharray:"3 3",vertical:!0,horizontal:!0,stroke:"#f1f5f9"}),n.jsx(iE,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"#94a3b8",fontWeight:600},dy:10}),n.jsx(aE,{axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"#94a3b8",fontWeight:600},ticks:st(),domain:["dataMin - 10","dataMax + 10"]}),n.jsx(lQ,{type:"monotone",dataKey:"value",stroke:"#94a3b8",strokeWidth:1.5,dot:bt,isAnimationActive:!0})]})})}),H==="blood_sugar"&&n.jsxs("div",{className:"flex overflow-x-auto scrollbar-hide gap-2 mt-6 pb-1",children:[n.jsx("button",{className:"flex-shrink-0 bg-[#1e293b] text-white px-4 py-1.5 rounded-full text-xs font-bold",children:"All"}),n.jsxs("button",{className:"flex-shrink-0 bg-blue-50/50 text-[#1c5dfd] px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-blue-500 rotate-45"})," ","Fasting"]}),n.jsxs("button",{className:"flex-shrink-0 bg-blue-50/50 text-[#1c5dfd] px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-blue-500"})," ","Pre-meal"]}),n.jsxs("button",{className:"flex-shrink-0 bg-blue-50/50 text-[#1c5dfd] px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-blue-500 rotate-45"})," ","Post-meal"]}),n.jsxs("button",{className:"flex-shrink-0 bg-blue-50/50 text-[#1c5dfd] px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," ","Random"]})]})]})]}),(()=>{const Qe=H==="blood_sugar"?E:H==="hba1c"?I:R;return!Qe||Qe.length===0?null:n.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-3xl border border-white/60 shadow-sm p-4 sm:p-6 !mt-6",children:[n.jsxs("h3",{className:"text-sm font-bold text-slate-800 mb-3",children:["Recent ",H==="blood_sugar"?"Glucose":H==="hba1c"?"HbA1c":"Weight"," Logs"]}),n.jsx("div",{className:"space-y-2",children:Qe.slice(0,5).map((rt,Nt)=>{var Fe,et;const Rt=new Date(rt.recordedAt||rt.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/60 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center ${rt.value>=70&&rt.value<=130?"bg-green-100":rt.value>130?"bg-red-100":"bg-yellow-100"}`,children:n.jsx(JR,{className:`w-4 h-4 ${rt.value>=70&&rt.value<=130?"text-green-600":rt.value>130?"text-red-600":"text-yellow-600"}`})}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-sm font-semibold text-slate-700",children:[rt.value," ",rt.type==="hba1c"?"%":rt.type==="weight"?"kg":"mg/dL"]}),n.jsx("p",{className:"text-xs text-gray-400 capitalize",children:((Fe=rt.readingContext)==null?void 0:Fe.replace("-"," "))||((et=rt.type)==null?void 0:et.replace("_"," "))})]})]}),n.jsx("span",{className:"text-xs text-gray-400",children:Rt})]},Nt)})})]})})()]}),n.jsx(u0e,{isOpen:o,onClose:()=>c(!1),onSave:He}),n.jsx(h0e,{isOpen:d,onClose:()=>h(!1),onSave:Ue}),n.jsx(p0e,{isOpen:m,onClose:()=>g(!1),onSave:re})]})},zi=({children:a,allowedRoles:o})=>{const{user:c,loading:d}=aa();return d?n.jsx(XA,{}):c?o&&!o.includes(c.role)?c.role==="admin"?n.jsx(wc,{to:"/admin"}):c.role==="doctor"?n.jsx(wc,{to:"/doctor/dashboard"}):n.jsx(wc,{to:"/dashboard"}):a:n.jsx(wc,{to:"/login"})},f0e=({children:a})=>{const{user:o,loading:c,isAdmin:d}=aa();return c?n.jsx(XA,{}):o?d()?a:n.jsx(wc,{to:"/dashboard"}):n.jsx(wc,{to:"/login"})},VT=({children:a})=>{const{user:o,loading:c,isDoctor:d}=aa();return c?n.jsx(XA,{}):o?d()?a:n.jsx(wc,{to:"/dashboard"}):n.jsx(wc,{to:"/login"})};function g0e(){const{user:a,isAdmin:o,isDoctor:c}=aa(),d=()=>a?o()?n.jsx(wc,{to:"/admin"}):c()?n.jsx(wc,{to:"/doctor/dashboard"}):n.jsx(wc,{to:"/dashboard"}):n.jsx(ice,{});return n.jsxs("div",{className:"min-h-screen bg-fixed bg-gradient-to-br from-purple-50 via-pink-50 to-orange-100",children:[n.jsx(Mae,{}),n.jsxs(Dre,{children:[n.jsx(tn,{path:"/",element:n.jsx(nce,{})}),n.jsx(tn,{path:"/login",element:d()}),n.jsx(tn,{path:"/register",element:a?n.jsx(wc,{to:"/dashboard"}):n.jsx(oce,{})}),n.jsx(tn,{path:"/register/doctor",element:a?n.jsx(wc,{to:"/doctor/dashboard"}):n.jsx(lce,{})}),n.jsx(tn,{path:"/dashboard",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(gce,{})})})}),n.jsx(tn,{path:"/upload",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(hle,{})})})}),n.jsx(tn,{path:"/reports",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Qle,{})})})}),n.jsx(tn,{path:"/reports/:id",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(ple,{})})})}),n.jsx(tn,{path:"/reports/:id/summary",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(c0e,{})})})}),n.jsx(tn,{path:"/challenge",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Hle,{})})})}),n.jsx(tn,{path:"/diabetes",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Gle,{})})})}),n.jsx(tn,{path:"/doctors",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(fle,{})})})}),n.jsx(tn,{path:"/consultation/:appointmentId",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(Ile,{})})}),n.jsx(tn,{path:"/consultation-summary/:appointmentId",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Ole,{})})})}),n.jsx(tn,{path:"/wearables",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Nle,{})})})}),n.jsx(tn,{path:"/nutrition",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Mle,{})})})}),n.jsx(tn,{path:"/quick-food-scan",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(A0e,{})})})}),n.jsx(tn,{path:"/glucose-log",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(m0e,{})})})}),n.jsx(tn,{path:"/vital-signs",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(l0e,{})})})}),n.jsx(tn,{path:"/supplements",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(d0e,{})})})}),n.jsx(tn,{path:"/subscription",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Cle,{})})})}),n.jsx(tn,{path:"/diet-plan",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Ule,{})})})}),n.jsx(tn,{path:"/ai-chat",element:n.jsx(zi,{allowedRoles:["patient","client"],children:n.jsx(hi,{children:n.jsx(Fle,{})})})}),n.jsx(tn,{path:"/doctor/dashboard",element:n.jsx(VT,{children:n.jsx(hi,{isDoctor:!0,children:n.jsx(bce,{})})})}),n.jsx(tn,{path:"/doctor/availability",element:n.jsx(VT,{children:n.jsx(hi,{isDoctor:!0,children:n.jsx(Lle,{})})})}),n.jsx(tn,{path:"/patient/:patientId",element:n.jsx(VT,{children:n.jsx(hi,{isDoctor:!0,children:n.jsx(Tle,{})})})}),n.jsx(tn,{path:"/profile",element:n.jsx(zi,{children:n.jsx(hi,{children:n.jsx(gle,{})})})}),n.jsx(tn,{path:"/admin",element:n.jsx(f0e,{children:n.jsx(hi,{isAdmin:!0,children:n.jsx(_le,{})})})}),n.jsx(tn,{path:"/demo",element:n.jsx(wle,{})}),n.jsx(tn,{path:"/video-test",element:n.jsx(kle,{})}),n.jsx(tn,{path:"/email-test",element:n.jsx(Dle,{})})]})]})}qT.createRoot(document.getElementById("root")).render(n.jsx(XV.StrictMode,{children:n.jsx(Bre,{children:n.jsx(Bae,{children:n.jsxs(dce,{children:[n.jsx(g0e,{}),n.jsx(tie,{position:"top-right"})]})})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(a=>{console.log(" Service Worker registered:",a.scope)}).catch(a=>{console.log(" Service Worker registration failed:",a)})});export{bn as _};
