function Y_e(e,n){for(var a=0;a<n.length;a++){const o=n[a];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in e)){const p=Object.getOwnPropertyDescriptor(o,l);p&&Object.defineProperty(e,l,p.get?p:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const p of l)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function a(l){const p={};return l.integrity&&(p.integrity=l.integrity),l.referrerPolicy&&(p.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?p.credentials="include":l.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(l){if(l.ep)return;l.ep=!0;const p=a(l);fetch(l.href,p)}})();var bd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var yY={exports:{}},hx={},_Y={exports:{}},bn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p_=Symbol.for("react.element"),q_e=Symbol.for("react.portal"),X_e=Symbol.for("react.fragment"),J_e=Symbol.for("react.strict_mode"),Q_e=Symbol.for("react.profiler"),Z_e=Symbol.for("react.provider"),e0e=Symbol.for("react.context"),t0e=Symbol.for("react.forward_ref"),n0e=Symbol.for("react.suspense"),r0e=Symbol.for("react.memo"),i0e=Symbol.for("react.lazy"),A$=Symbol.iterator;function a0e(e){return e===null||typeof e!="object"?null:(e=A$&&e[A$]||e["@@iterator"],typeof e=="function"?e:null)}var EY={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bY=Object.assign,SY={};function Cm(e,n,a){this.props=e,this.context=n,this.refs=SY,this.updater=a||EY}Cm.prototype.isReactComponent={};Cm.prototype.setState=function(e,n){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")};Cm.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function wY(){}wY.prototype=Cm.prototype;function zD(e,n,a){this.props=e,this.context=n,this.refs=SY,this.updater=a||EY}var KD=zD.prototype=new wY;KD.constructor=zD;bY(KD,Cm.prototype);KD.isPureReactComponent=!0;var N$=Array.isArray,xY=Object.prototype.hasOwnProperty,YD={current:null},TY={key:!0,ref:!0,__self:!0,__source:!0};function CY(e,n,a){var o,l={},p=null,m=null;if(n!=null)for(o in n.ref!==void 0&&(m=n.ref),n.key!==void 0&&(p=""+n.key),n)xY.call(n,o)&&!TY.hasOwnProperty(o)&&(l[o]=n[o]);var y=arguments.length-2;if(y===1)l.children=a;else if(1<y){for(var E=Array(y),b=0;b<y;b++)E[b]=arguments[b+2];l.children=E}if(e&&e.defaultProps)for(o in y=e.defaultProps,y)l[o]===void 0&&(l[o]=y[o]);return{$$typeof:p_,type:e,key:p,ref:m,props:l,_owner:YD.current}}function s0e(e,n){return{$$typeof:p_,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function qD(e){return typeof e=="object"&&e!==null&&e.$$typeof===p_}function o0e(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(a){return n[a]})}var O$=/\/+/g;function XO(e,n){return typeof e=="object"&&e!==null&&e.key!=null?o0e(""+e.key):n.toString(36)}function fS(e,n,a,o,l){var p=typeof e;(p==="undefined"||p==="boolean")&&(e=null);var m=!1;if(e===null)m=!0;else switch(p){case"string":case"number":m=!0;break;case"object":switch(e.$$typeof){case p_:case q_e:m=!0}}if(m)return m=e,l=l(m),e=o===""?"."+XO(m,0):o,N$(l)?(a="",e!=null&&(a=e.replace(O$,"$&/")+"/"),fS(l,n,a,"",function(b){return b})):l!=null&&(qD(l)&&(l=s0e(l,a+(!l.key||m&&m.key===l.key?"":(""+l.key).replace(O$,"$&/")+"/")+e)),n.push(l)),1;if(m=0,o=o===""?".":o+":",N$(e))for(var y=0;y<e.length;y++){p=e[y];var E=o+XO(p,y);m+=fS(p,n,a,E,l)}else if(E=a0e(e),typeof E=="function")for(e=E.call(e),y=0;!(p=e.next()).done;)p=p.value,E=o+XO(p,y++),m+=fS(p,n,a,E,l);else if(p==="object")throw n=String(e),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return m}function Db(e,n,a){if(e==null)return e;var o=[],l=0;return fS(e,o,"","",function(p){return n.call(a,p,l++)}),o}function c0e(e){if(e._status===-1){var n=e._result;n=n(),n.then(function(a){(e._status===0||e._status===-1)&&(e._status=1,e._result=a)},function(a){(e._status===0||e._status===-1)&&(e._status=2,e._result=a)}),e._status===-1&&(e._status=0,e._result=n)}if(e._status===1)return e._result.default;throw e._result}var _a={current:null},mS={transition:null},l0e={ReactCurrentDispatcher:_a,ReactCurrentBatchConfig:mS,ReactCurrentOwner:YD};function RY(){throw Error("act(...) is not supported in production builds of React.")}bn.Children={map:Db,forEach:function(e,n,a){Db(e,function(){n.apply(this,arguments)},a)},count:function(e){var n=0;return Db(e,function(){n++}),n},toArray:function(e){return Db(e,function(n){return n})||[]},only:function(e){if(!qD(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};bn.Component=Cm;bn.Fragment=X_e;bn.Profiler=Q_e;bn.PureComponent=zD;bn.StrictMode=J_e;bn.Suspense=n0e;bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=l0e;bn.act=RY;bn.cloneElement=function(e,n,a){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=bY({},e.props),l=e.key,p=e.ref,m=e._owner;if(n!=null){if(n.ref!==void 0&&(p=n.ref,m=YD.current),n.key!==void 0&&(l=""+n.key),e.type&&e.type.defaultProps)var y=e.type.defaultProps;for(E in n)xY.call(n,E)&&!TY.hasOwnProperty(E)&&(o[E]=n[E]===void 0&&y!==void 0?y[E]:n[E])}var E=arguments.length-2;if(E===1)o.children=a;else if(1<E){y=Array(E);for(var b=0;b<E;b++)y[b]=arguments[b+2];o.children=y}return{$$typeof:p_,type:e.type,key:l,ref:p,props:o,_owner:m}};bn.createContext=function(e){return e={$$typeof:e0e,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Z_e,_context:e},e.Consumer=e};bn.createElement=CY;bn.createFactory=function(e){var n=CY.bind(null,e);return n.type=e,n};bn.createRef=function(){return{current:null}};bn.forwardRef=function(e){return{$$typeof:t0e,render:e}};bn.isValidElement=qD;bn.lazy=function(e){return{$$typeof:i0e,_payload:{_status:-1,_result:e},_init:c0e}};bn.memo=function(e,n){return{$$typeof:r0e,type:e,compare:n===void 0?null:n}};bn.startTransition=function(e){var n=mS.transition;mS.transition={};try{e()}finally{mS.transition=n}};bn.unstable_act=RY;bn.useCallback=function(e,n){return _a.current.useCallback(e,n)};bn.useContext=function(e){return _a.current.useContext(e)};bn.useDebugValue=function(){};bn.useDeferredValue=function(e){return _a.current.useDeferredValue(e)};bn.useEffect=function(e,n){return _a.current.useEffect(e,n)};bn.useId=function(){return _a.current.useId()};bn.useImperativeHandle=function(e,n,a){return _a.current.useImperativeHandle(e,n,a)};bn.useInsertionEffect=function(e,n){return _a.current.useInsertionEffect(e,n)};bn.useLayoutEffect=function(e,n){return _a.current.useLayoutEffect(e,n)};bn.useMemo=function(e,n){return _a.current.useMemo(e,n)};bn.useReducer=function(e,n,a){return _a.current.useReducer(e,n,a)};bn.useRef=function(e){return _a.current.useRef(e)};bn.useState=function(e){return _a.current.useState(e)};bn.useSyncExternalStore=function(e,n,a){return _a.current.useSyncExternalStore(e,n,a)};bn.useTransition=function(){return _a.current.useTransition()};bn.version="18.3.1";_Y.exports=bn;var J=_Y.exports;const me=Zn(J),d0e=Y_e({__proto__:null,default:me},[J]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u0e=J,h0e=Symbol.for("react.element"),p0e=Symbol.for("react.fragment"),f0e=Object.prototype.hasOwnProperty,m0e=u0e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,g0e={key:!0,ref:!0,__self:!0,__source:!0};function AY(e,n,a){var o,l={},p=null,m=null;a!==void 0&&(p=""+a),n.key!==void 0&&(p=""+n.key),n.ref!==void 0&&(m=n.ref);for(o in n)f0e.call(n,o)&&!g0e.hasOwnProperty(o)&&(l[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps,n)l[o]===void 0&&(l[o]=n[o]);return{$$typeof:h0e,type:e,key:p,ref:m,props:l,_owner:m0e.current}}hx.Fragment=p0e;hx.jsx=AY;hx.jsxs=AY;yY.exports=hx;var h=yY.exports,s1={},NY={exports:{}},vs={},OY={exports:{}},IY={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(ae,ce){var Se=ae.length;ae.push(ce);e:for(;0<Se;){var je=Se-1>>>1,fe=ae[je];if(0<l(fe,ce))ae[je]=ce,ae[Se]=fe,Se=je;else break e}}function a(ae){return ae.length===0?null:ae[0]}function o(ae){if(ae.length===0)return null;var ce=ae[0],Se=ae.pop();if(Se!==ce){ae[0]=Se;e:for(var je=0,fe=ae.length,He=fe>>>1;je<He;){var Ye=2*(je+1)-1,gt=ae[Ye],Vt=Ye+1,zn=ae[Vt];if(0>l(gt,Se))Vt<fe&&0>l(zn,gt)?(ae[je]=zn,ae[Vt]=Se,je=Vt):(ae[je]=gt,ae[Ye]=Se,je=Ye);else if(Vt<fe&&0>l(zn,Se))ae[je]=zn,ae[Vt]=Se,je=Vt;else break e}}return ce}function l(ae,ce){var Se=ae.sortIndex-ce.sortIndex;return Se!==0?Se:ae.id-ce.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;e.unstable_now=function(){return p.now()}}else{var m=Date,y=m.now();e.unstable_now=function(){return m.now()-y}}var E=[],b=[],T=1,x=null,A=3,D=!1,N=!1,L=!1,P=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(ae){for(var ce=a(b);ce!==null;){if(ce.callback===null)o(b);else if(ce.startTime<=ae)o(b),ce.sortIndex=ce.expirationTime,n(E,ce);else break;ce=a(b)}}function H(ae){if(L=!1,F(ae),!N)if(a(E)!==null)N=!0,ue(B);else{var ce=a(b);ce!==null&&be(H,ce.startTime-ae)}}function B(ae,ce){N=!1,L&&(L=!1,U(Q),Q=-1),D=!0;var Se=A;try{for(F(ce),x=a(E);x!==null&&(!(x.expirationTime>ce)||ae&&!le());){var je=x.callback;if(typeof je=="function"){x.callback=null,A=x.priorityLevel;var fe=je(x.expirationTime<=ce);ce=e.unstable_now(),typeof fe=="function"?x.callback=fe:x===a(E)&&o(E),F(ce)}else o(E);x=a(E)}if(x!==null)var He=!0;else{var Ye=a(b);Ye!==null&&be(H,Ye.startTime-ce),He=!1}return He}finally{x=null,A=Se,D=!1}}var z=!1,Y=null,Q=-1,re=5,de=-1;function le(){return!(e.unstable_now()-de<re)}function he(){if(Y!==null){var ae=e.unstable_now();de=ae;var ce=!0;try{ce=Y(!0,ae)}finally{ce?Re():(z=!1,Y=null)}}else z=!1}var Re;if(typeof V=="function")Re=function(){V(he)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,we=ve.port2;ve.port1.onmessage=he,Re=function(){we.postMessage(null)}}else Re=function(){P(he,0)};function ue(ae){Y=ae,z||(z=!0,Re())}function be(ae,ce){Q=P(function(){ae(e.unstable_now())},ce)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ae){ae.callback=null},e.unstable_continueExecution=function(){N||D||(N=!0,ue(B))},e.unstable_forceFrameRate=function(ae){0>ae||125<ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<ae?Math.floor(1e3/ae):5},e.unstable_getCurrentPriorityLevel=function(){return A},e.unstable_getFirstCallbackNode=function(){return a(E)},e.unstable_next=function(ae){switch(A){case 1:case 2:case 3:var ce=3;break;default:ce=A}var Se=A;A=ce;try{return ae()}finally{A=Se}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ae,ce){switch(ae){case 1:case 2:case 3:case 4:case 5:break;default:ae=3}var Se=A;A=ae;try{return ce()}finally{A=Se}},e.unstable_scheduleCallback=function(ae,ce,Se){var je=e.unstable_now();switch(typeof Se=="object"&&Se!==null?(Se=Se.delay,Se=typeof Se=="number"&&0<Se?je+Se:je):Se=je,ae){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=Se+fe,ae={id:T++,callback:ce,priorityLevel:ae,startTime:Se,expirationTime:fe,sortIndex:-1},Se>je?(ae.sortIndex=Se,n(b,ae),a(E)===null&&ae===a(b)&&(L?(U(Q),Q=-1):L=!0,be(H,Se-je))):(ae.sortIndex=fe,n(E,ae),N||D||(N=!0,ue(B))),ae},e.unstable_shouldYield=le,e.unstable_wrapCallback=function(ae){var ce=A;return function(){var Se=A;A=ce;try{return ae.apply(this,arguments)}finally{A=Se}}}})(IY);OY.exports=IY;var v0e=OY.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y0e=J,ms=v0e;function Xe(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var PY=new Set,dy={};function Ph(e,n){zf(e,n),zf(e+"Capture",n)}function zf(e,n){for(dy[e]=n,e=0;e<n.length;e++)PY.add(n[e])}var gl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),o1=Object.prototype.hasOwnProperty,_0e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I$={},P$={};function E0e(e){return o1.call(P$,e)?!0:o1.call(I$,e)?!1:_0e.test(e)?P$[e]=!0:(I$[e]=!0,!1)}function b0e(e,n,a,o){if(a!==null&&a.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return o?!1:a!==null?!a.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function S0e(e,n,a,o){if(n===null||typeof n>"u"||b0e(e,n,a,o))return!0;if(o)return!1;if(a!==null)switch(a.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Ea(e,n,a,o,l,p,m){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=o,this.attributeNamespace=l,this.mustUseProperty=a,this.propertyName=e,this.type=n,this.sanitizeURL=p,this.removeEmptyString=m}var Wi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Wi[e]=new Ea(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];Wi[n]=new Ea(n,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Wi[e]=new Ea(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Wi[e]=new Ea(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Wi[e]=new Ea(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Wi[e]=new Ea(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Wi[e]=new Ea(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Wi[e]=new Ea(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Wi[e]=new Ea(e,5,!1,e.toLowerCase(),null,!1,!1)});var XD=/[\-:]([a-z])/g;function JD(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(XD,JD);Wi[n]=new Ea(n,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(XD,JD);Wi[n]=new Ea(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(XD,JD);Wi[n]=new Ea(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Wi[e]=new Ea(e,1,!1,e.toLowerCase(),null,!1,!1)});Wi.xlinkHref=new Ea("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Wi[e]=new Ea(e,1,!1,e.toLowerCase(),null,!0,!0)});function QD(e,n,a,o){var l=Wi.hasOwnProperty(n)?Wi[n]:null;(l!==null?l.type!==0:o||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(S0e(n,a,l,o)&&(a=null),o||l===null?E0e(n)&&(a===null?e.removeAttribute(n):e.setAttribute(n,""+a)):l.mustUseProperty?e[l.propertyName]=a===null?l.type===3?!1:"":a:(n=l.attributeName,o=l.attributeNamespace,a===null?e.removeAttribute(n):(l=l.type,a=l===3||l===4&&a===!0?"":""+a,o?e.setAttributeNS(o,n,a):e.setAttribute(n,a))))}var Cl=y0e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,kb=Symbol.for("react.element"),_f=Symbol.for("react.portal"),Ef=Symbol.for("react.fragment"),ZD=Symbol.for("react.strict_mode"),c1=Symbol.for("react.profiler"),DY=Symbol.for("react.provider"),kY=Symbol.for("react.context"),ek=Symbol.for("react.forward_ref"),l1=Symbol.for("react.suspense"),d1=Symbol.for("react.suspense_list"),tk=Symbol.for("react.memo"),pd=Symbol.for("react.lazy"),LY=Symbol.for("react.offscreen"),D$=Symbol.iterator;function xv(e){return e===null||typeof e!="object"?null:(e=D$&&e[D$]||e["@@iterator"],typeof e=="function"?e:null)}var Mr=Object.assign,JO;function $v(e){if(JO===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);JO=n&&n[1]||""}return`
`+JO+e}var QO=!1;function ZO(e,n){if(!e||QO)return"";QO=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(b){var o=b}Reflect.construct(e,[],n)}else{try{n.call()}catch(b){o=b}e.call(n.prototype)}else{try{throw Error()}catch(b){o=b}e()}}catch(b){if(b&&o&&typeof b.stack=="string"){for(var l=b.stack.split(`
`),p=o.stack.split(`
`),m=l.length-1,y=p.length-1;1<=m&&0<=y&&l[m]!==p[y];)y--;for(;1<=m&&0<=y;m--,y--)if(l[m]!==p[y]){if(m!==1||y!==1)do if(m--,y--,0>y||l[m]!==p[y]){var E=`
`+l[m].replace(" at new "," at ");return e.displayName&&E.includes("<anonymous>")&&(E=E.replace("<anonymous>",e.displayName)),E}while(1<=m&&0<=y);break}}}finally{QO=!1,Error.prepareStackTrace=a}return(e=e?e.displayName||e.name:"")?$v(e):""}function w0e(e){switch(e.tag){case 5:return $v(e.type);case 16:return $v("Lazy");case 13:return $v("Suspense");case 19:return $v("SuspenseList");case 0:case 2:case 15:return e=ZO(e.type,!1),e;case 11:return e=ZO(e.type.render,!1),e;case 1:return e=ZO(e.type,!0),e;default:return""}}function u1(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Ef:return"Fragment";case _f:return"Portal";case c1:return"Profiler";case ZD:return"StrictMode";case l1:return"Suspense";case d1:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case kY:return(e.displayName||"Context")+".Consumer";case DY:return(e._context.displayName||"Context")+".Provider";case ek:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case tk:return n=e.displayName||null,n!==null?n:u1(e.type)||"Memo";case pd:n=e._payload,e=e._init;try{return u1(e(n))}catch{}}return null}function x0e(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=n.render,e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return u1(n);case 8:return n===ZD?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Ud(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function jY(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function T0e(e){var n=jY(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),o=""+e[n];if(!e.hasOwnProperty(n)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var l=a.get,p=a.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return l.call(this)},set:function(m){o=""+m,p.call(this,m)}}),Object.defineProperty(e,n,{enumerable:a.enumerable}),{getValue:function(){return o},setValue:function(m){o=""+m},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function Lb(e){e._valueTracker||(e._valueTracker=T0e(e))}function MY(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var a=n.getValue(),o="";return e&&(o=jY(e)?e.checked?"true":"false":e.value),e=o,e!==a?(n.setValue(e),!0):!1}function PS(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function h1(e,n){var a=n.checked;return Mr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??e._wrapperState.initialChecked})}function k$(e,n){var a=n.defaultValue==null?"":n.defaultValue,o=n.checked!=null?n.checked:n.defaultChecked;a=Ud(n.value!=null?n.value:a),e._wrapperState={initialChecked:o,initialValue:a,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function UY(e,n){n=n.checked,n!=null&&QD(e,"checked",n,!1)}function p1(e,n){UY(e,n);var a=Ud(n.value),o=n.type;if(a!=null)o==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+a):e.value!==""+a&&(e.value=""+a);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}n.hasOwnProperty("value")?f1(e,n.type,a):n.hasOwnProperty("defaultValue")&&f1(e,n.type,Ud(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(e.defaultChecked=!!n.defaultChecked)}function L$(e,n,a){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var o=n.type;if(!(o!=="submit"&&o!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+e._wrapperState.initialValue,a||n===e.value||(e.value=n),e.defaultValue=n}a=e.name,a!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,a!==""&&(e.name=a)}function f1(e,n,a){(n!=="number"||PS(e.ownerDocument)!==e)&&(a==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+a&&(e.defaultValue=""+a))}var Hv=Array.isArray;function kf(e,n,a,o){if(e=e.options,n){n={};for(var l=0;l<a.length;l++)n["$"+a[l]]=!0;for(a=0;a<e.length;a++)l=n.hasOwnProperty("$"+e[a].value),e[a].selected!==l&&(e[a].selected=l),l&&o&&(e[a].defaultSelected=!0)}else{for(a=""+Ud(a),n=null,l=0;l<e.length;l++){if(e[l].value===a){e[l].selected=!0,o&&(e[l].defaultSelected=!0);return}n!==null||e[l].disabled||(n=e[l])}n!==null&&(n.selected=!0)}}function m1(e,n){if(n.dangerouslySetInnerHTML!=null)throw Error(Xe(91));return Mr({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function j$(e,n){var a=n.value;if(a==null){if(a=n.children,n=n.defaultValue,a!=null){if(n!=null)throw Error(Xe(92));if(Hv(a)){if(1<a.length)throw Error(Xe(93));a=a[0]}n=a}n==null&&(n=""),a=n}e._wrapperState={initialValue:Ud(a)}}function VY(e,n){var a=Ud(n.value),o=Ud(n.defaultValue);a!=null&&(a=""+a,a!==e.value&&(e.value=a),n.defaultValue==null&&e.defaultValue!==a&&(e.defaultValue=a)),o!=null&&(e.defaultValue=""+o)}function M$(e){var n=e.textContent;n===e._wrapperState.initialValue&&n!==""&&n!==null&&(e.value=n)}function FY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function g1(e,n){return e==null||e==="http://www.w3.org/1999/xhtml"?FY(n):e==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var jb,BY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,a,o,l){MSApp.execUnsafeLocalFunction(function(){return e(n,a,o,l)})}:e}(function(e,n){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=n;else{for(jb=jb||document.createElement("div"),jb.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=jb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}});function uy(e,n){if(n){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=n;return}}e.textContent=n}var Xv={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},C0e=["Webkit","ms","Moz","O"];Object.keys(Xv).forEach(function(e){C0e.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),Xv[n]=Xv[e]})});function WY(e,n,a){return n==null||typeof n=="boolean"||n===""?"":a||typeof n!="number"||n===0||Xv.hasOwnProperty(e)&&Xv[e]?(""+n).trim():n+"px"}function GY(e,n){e=e.style;for(var a in n)if(n.hasOwnProperty(a)){var o=a.indexOf("--")===0,l=WY(a,n[a],o);a==="float"&&(a="cssFloat"),o?e.setProperty(a,l):e[a]=l}}var R0e=Mr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function v1(e,n){if(n){if(R0e[e]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(Xe(137,e));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(Xe(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(Xe(61))}if(n.style!=null&&typeof n.style!="object")throw Error(Xe(62))}}function y1(e,n){if(e.indexOf("-")===-1)return typeof n.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _1=null;function nk(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var E1=null,Lf=null,jf=null;function U$(e){if(e=g_(e)){if(typeof E1!="function")throw Error(Xe(280));var n=e.stateNode;n&&(n=vx(n),E1(e.stateNode,e.type,n))}}function $Y(e){Lf?jf?jf.push(e):jf=[e]:Lf=e}function HY(){if(Lf){var e=Lf,n=jf;if(jf=Lf=null,U$(e),n)for(e=0;e<n.length;e++)U$(n[e])}}function zY(e,n){return e(n)}function KY(){}var eI=!1;function YY(e,n,a){if(eI)return e(n,a);eI=!0;try{return zY(e,n,a)}finally{eI=!1,(Lf!==null||jf!==null)&&(KY(),HY())}}function hy(e,n){var a=e.stateNode;if(a===null)return null;var o=vx(a);if(o===null)return null;a=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(Xe(231,n,typeof a));return a}var b1=!1;if(gl)try{var Tv={};Object.defineProperty(Tv,"passive",{get:function(){b1=!0}}),window.addEventListener("test",Tv,Tv),window.removeEventListener("test",Tv,Tv)}catch{b1=!1}function A0e(e,n,a,o,l,p,m,y,E){var b=Array.prototype.slice.call(arguments,3);try{n.apply(a,b)}catch(T){this.onError(T)}}var Jv=!1,DS=null,kS=!1,S1=null,N0e={onError:function(e){Jv=!0,DS=e}};function O0e(e,n,a,o,l,p,m,y,E){Jv=!1,DS=null,A0e.apply(N0e,arguments)}function I0e(e,n,a,o,l,p,m,y,E){if(O0e.apply(this,arguments),Jv){if(Jv){var b=DS;Jv=!1,DS=null}else throw Error(Xe(198));kS||(kS=!0,S1=b)}}function Dh(e){var n=e,a=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,n.flags&4098&&(a=n.return),e=n.return;while(e)}return n.tag===3?a:null}function qY(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function V$(e){if(Dh(e)!==e)throw Error(Xe(188))}function P0e(e){var n=e.alternate;if(!n){if(n=Dh(e),n===null)throw Error(Xe(188));return n!==e?null:e}for(var a=e,o=n;;){var l=a.return;if(l===null)break;var p=l.alternate;if(p===null){if(o=l.return,o!==null){a=o;continue}break}if(l.child===p.child){for(p=l.child;p;){if(p===a)return V$(l),e;if(p===o)return V$(l),n;p=p.sibling}throw Error(Xe(188))}if(a.return!==o.return)a=l,o=p;else{for(var m=!1,y=l.child;y;){if(y===a){m=!0,a=l,o=p;break}if(y===o){m=!0,o=l,a=p;break}y=y.sibling}if(!m){for(y=p.child;y;){if(y===a){m=!0,a=p,o=l;break}if(y===o){m=!0,o=p,a=l;break}y=y.sibling}if(!m)throw Error(Xe(189))}}if(a.alternate!==o)throw Error(Xe(190))}if(a.tag!==3)throw Error(Xe(188));return a.stateNode.current===a?e:n}function XY(e){return e=P0e(e),e!==null?JY(e):null}function JY(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var n=JY(e);if(n!==null)return n;e=e.sibling}return null}var QY=ms.unstable_scheduleCallback,F$=ms.unstable_cancelCallback,D0e=ms.unstable_shouldYield,k0e=ms.unstable_requestPaint,Kr=ms.unstable_now,L0e=ms.unstable_getCurrentPriorityLevel,rk=ms.unstable_ImmediatePriority,ZY=ms.unstable_UserBlockingPriority,LS=ms.unstable_NormalPriority,j0e=ms.unstable_LowPriority,eq=ms.unstable_IdlePriority,px=null,Oc=null;function M0e(e){if(Oc&&typeof Oc.onCommitFiberRoot=="function")try{Oc.onCommitFiberRoot(px,e,void 0,(e.current.flags&128)===128)}catch{}}var $o=Math.clz32?Math.clz32:F0e,U0e=Math.log,V0e=Math.LN2;function F0e(e){return e>>>=0,e===0?32:31-(U0e(e)/V0e|0)|0}var Mb=64,Ub=4194304;function zv(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function jS(e,n){var a=e.pendingLanes;if(a===0)return 0;var o=0,l=e.suspendedLanes,p=e.pingedLanes,m=a&268435455;if(m!==0){var y=m&~l;y!==0?o=zv(y):(p&=m,p!==0&&(o=zv(p)))}else m=a&~l,m!==0?o=zv(m):p!==0&&(o=zv(p));if(o===0)return 0;if(n!==0&&n!==o&&!(n&l)&&(l=o&-o,p=n&-n,l>=p||l===16&&(p&4194240)!==0))return n;if(o&4&&(o|=a&16),n=e.entangledLanes,n!==0)for(e=e.entanglements,n&=o;0<n;)a=31-$o(n),l=1<<a,o|=e[a],n&=~l;return o}function B0e(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function W0e(e,n){for(var a=e.suspendedLanes,o=e.pingedLanes,l=e.expirationTimes,p=e.pendingLanes;0<p;){var m=31-$o(p),y=1<<m,E=l[m];E===-1?(!(y&a)||y&o)&&(l[m]=B0e(y,n)):E<=n&&(e.expiredLanes|=y),p&=~y}}function w1(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function tq(){var e=Mb;return Mb<<=1,!(Mb&4194240)&&(Mb=64),e}function tI(e){for(var n=[],a=0;31>a;a++)n.push(e);return n}function f_(e,n,a){e.pendingLanes|=n,n!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,n=31-$o(n),e[n]=a}function G0e(e,n){var a=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<a;){var l=31-$o(a),p=1<<l;n[l]=0,o[l]=-1,e[l]=-1,a&=~p}}function ik(e,n){var a=e.entangledLanes|=n;for(e=e.entanglements;a;){var o=31-$o(a),l=1<<o;l&n|e[o]&n&&(e[o]|=n),a&=~l}}var $n=0;function nq(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var rq,ak,iq,aq,sq,x1=!1,Vb=[],Rd=null,Ad=null,Nd=null,py=new Map,fy=new Map,gd=[],$0e="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function B$(e,n){switch(e){case"focusin":case"focusout":Rd=null;break;case"dragenter":case"dragleave":Ad=null;break;case"mouseover":case"mouseout":Nd=null;break;case"pointerover":case"pointerout":py.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":fy.delete(n.pointerId)}}function Cv(e,n,a,o,l,p){return e===null||e.nativeEvent!==p?(e={blockedOn:n,domEventName:a,eventSystemFlags:o,nativeEvent:p,targetContainers:[l]},n!==null&&(n=g_(n),n!==null&&ak(n)),e):(e.eventSystemFlags|=o,n=e.targetContainers,l!==null&&n.indexOf(l)===-1&&n.push(l),e)}function H0e(e,n,a,o,l){switch(n){case"focusin":return Rd=Cv(Rd,e,n,a,o,l),!0;case"dragenter":return Ad=Cv(Ad,e,n,a,o,l),!0;case"mouseover":return Nd=Cv(Nd,e,n,a,o,l),!0;case"pointerover":var p=l.pointerId;return py.set(p,Cv(py.get(p)||null,e,n,a,o,l)),!0;case"gotpointercapture":return p=l.pointerId,fy.set(p,Cv(fy.get(p)||null,e,n,a,o,l)),!0}return!1}function oq(e){var n=nh(e.target);if(n!==null){var a=Dh(n);if(a!==null){if(n=a.tag,n===13){if(n=qY(a),n!==null){e.blockedOn=n,sq(e.priority,function(){iq(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function gS(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var a=T1(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(a===null){a=e.nativeEvent;var o=new a.constructor(a.type,a);_1=o,a.target.dispatchEvent(o),_1=null}else return n=g_(a),n!==null&&ak(n),e.blockedOn=a,!1;n.shift()}return!0}function W$(e,n,a){gS(e)&&a.delete(n)}function z0e(){x1=!1,Rd!==null&&gS(Rd)&&(Rd=null),Ad!==null&&gS(Ad)&&(Ad=null),Nd!==null&&gS(Nd)&&(Nd=null),py.forEach(W$),fy.forEach(W$)}function Rv(e,n){e.blockedOn===n&&(e.blockedOn=null,x1||(x1=!0,ms.unstable_scheduleCallback(ms.unstable_NormalPriority,z0e)))}function my(e){function n(l){return Rv(l,e)}if(0<Vb.length){Rv(Vb[0],e);for(var a=1;a<Vb.length;a++){var o=Vb[a];o.blockedOn===e&&(o.blockedOn=null)}}for(Rd!==null&&Rv(Rd,e),Ad!==null&&Rv(Ad,e),Nd!==null&&Rv(Nd,e),py.forEach(n),fy.forEach(n),a=0;a<gd.length;a++)o=gd[a],o.blockedOn===e&&(o.blockedOn=null);for(;0<gd.length&&(a=gd[0],a.blockedOn===null);)oq(a),a.blockedOn===null&&gd.shift()}var Mf=Cl.ReactCurrentBatchConfig,MS=!0;function K0e(e,n,a,o){var l=$n,p=Mf.transition;Mf.transition=null;try{$n=1,sk(e,n,a,o)}finally{$n=l,Mf.transition=p}}function Y0e(e,n,a,o){var l=$n,p=Mf.transition;Mf.transition=null;try{$n=4,sk(e,n,a,o)}finally{$n=l,Mf.transition=p}}function sk(e,n,a,o){if(MS){var l=T1(e,n,a,o);if(l===null)uI(e,n,o,US,a),B$(e,o);else if(H0e(l,e,n,a,o))o.stopPropagation();else if(B$(e,o),n&4&&-1<$0e.indexOf(e)){for(;l!==null;){var p=g_(l);if(p!==null&&rq(p),p=T1(e,n,a,o),p===null&&uI(e,n,o,US,a),p===l)break;l=p}l!==null&&o.stopPropagation()}else uI(e,n,o,null,a)}}var US=null;function T1(e,n,a,o){if(US=null,e=nk(o),e=nh(e),e!==null)if(n=Dh(e),n===null)e=null;else if(a=n.tag,a===13){if(e=qY(n),e!==null)return e;e=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return US=e,null}function cq(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(L0e()){case rk:return 1;case ZY:return 4;case LS:case j0e:return 16;case eq:return 536870912;default:return 16}default:return 16}}var Sd=null,ok=null,vS=null;function lq(){if(vS)return vS;var e,n=ok,a=n.length,o,l="value"in Sd?Sd.value:Sd.textContent,p=l.length;for(e=0;e<a&&n[e]===l[e];e++);var m=a-e;for(o=1;o<=m&&n[a-o]===l[p-o];o++);return vS=l.slice(e,1<o?1-o:void 0)}function yS(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function Fb(){return!0}function G$(){return!1}function ys(e){function n(a,o,l,p,m){this._reactName=a,this._targetInst=l,this.type=o,this.nativeEvent=p,this.target=m,this.currentTarget=null;for(var y in e)e.hasOwnProperty(y)&&(a=e[y],this[y]=a?a(p):p[y]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Fb:G$,this.isPropagationStopped=G$,this}return Mr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Fb)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Fb)},persist:function(){},isPersistent:Fb}),n}var Rm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ck=ys(Rm),m_=Mr({},Rm,{view:0,detail:0}),q0e=ys(m_),nI,rI,Av,fx=Mr({},m_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lk,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Av&&(Av&&e.type==="mousemove"?(nI=e.screenX-Av.screenX,rI=e.screenY-Av.screenY):rI=nI=0,Av=e),nI)},movementY:function(e){return"movementY"in e?e.movementY:rI}}),$$=ys(fx),X0e=Mr({},fx,{dataTransfer:0}),J0e=ys(X0e),Q0e=Mr({},m_,{relatedTarget:0}),iI=ys(Q0e),Z0e=Mr({},Rm,{animationName:0,elapsedTime:0,pseudoElement:0}),eEe=ys(Z0e),tEe=Mr({},Rm,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),nEe=ys(tEe),rEe=Mr({},Rm,{data:0}),H$=ys(rEe),iEe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aEe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sEe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oEe(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=sEe[e])?!!n[e]:!1}function lk(){return oEe}var cEe=Mr({},m_,{key:function(e){if(e.key){var n=iEe[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=yS(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?aEe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lk,charCode:function(e){return e.type==="keypress"?yS(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?yS(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),lEe=ys(cEe),dEe=Mr({},fx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),z$=ys(dEe),uEe=Mr({},m_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lk}),hEe=ys(uEe),pEe=Mr({},Rm,{propertyName:0,elapsedTime:0,pseudoElement:0}),fEe=ys(pEe),mEe=Mr({},fx,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),gEe=ys(mEe),vEe=[9,13,27,32],dk=gl&&"CompositionEvent"in window,Qv=null;gl&&"documentMode"in document&&(Qv=document.documentMode);var yEe=gl&&"TextEvent"in window&&!Qv,dq=gl&&(!dk||Qv&&8<Qv&&11>=Qv),K$=" ",Y$=!1;function uq(e,n){switch(e){case"keyup":return vEe.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hq(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var bf=!1;function _Ee(e,n){switch(e){case"compositionend":return hq(n);case"keypress":return n.which!==32?null:(Y$=!0,K$);case"textInput":return e=n.data,e===K$&&Y$?null:e;default:return null}}function EEe(e,n){if(bf)return e==="compositionend"||!dk&&uq(e,n)?(e=lq(),vS=ok=Sd=null,bf=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return dq&&n.locale!=="ko"?null:n.data;default:return null}}var bEe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function q$(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!bEe[e.type]:n==="textarea"}function pq(e,n,a,o){$Y(o),n=VS(n,"onChange"),0<n.length&&(a=new ck("onChange","change",null,a,o),e.push({event:a,listeners:n}))}var Zv=null,gy=null;function SEe(e){xq(e,0)}function mx(e){var n=xf(e);if(MY(n))return e}function wEe(e,n){if(e==="change")return n}var fq=!1;if(gl){var aI;if(gl){var sI="oninput"in document;if(!sI){var X$=document.createElement("div");X$.setAttribute("oninput","return;"),sI=typeof X$.oninput=="function"}aI=sI}else aI=!1;fq=aI&&(!document.documentMode||9<document.documentMode)}function J$(){Zv&&(Zv.detachEvent("onpropertychange",mq),gy=Zv=null)}function mq(e){if(e.propertyName==="value"&&mx(gy)){var n=[];pq(n,gy,e,nk(e)),YY(SEe,n)}}function xEe(e,n,a){e==="focusin"?(J$(),Zv=n,gy=a,Zv.attachEvent("onpropertychange",mq)):e==="focusout"&&J$()}function TEe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return mx(gy)}function CEe(e,n){if(e==="click")return mx(n)}function REe(e,n){if(e==="input"||e==="change")return mx(n)}function AEe(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Ko=typeof Object.is=="function"?Object.is:AEe;function vy(e,n){if(Ko(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var a=Object.keys(e),o=Object.keys(n);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var l=a[o];if(!o1.call(n,l)||!Ko(e[l],n[l]))return!1}return!0}function Q$(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Z$(e,n){var a=Q$(e);e=0;for(var o;a;){if(a.nodeType===3){if(o=e+a.textContent.length,e<=n&&o>=n)return{node:a,offset:n-e};e=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Q$(a)}}function gq(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?gq(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function vq(){for(var e=window,n=PS();n instanceof e.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)e=n.contentWindow;else break;n=PS(e.document)}return n}function uk(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function NEe(e){var n=vq(),a=e.focusedElem,o=e.selectionRange;if(n!==a&&a&&a.ownerDocument&&gq(a.ownerDocument.documentElement,a)){if(o!==null&&uk(a)){if(n=o.start,e=o.end,e===void 0&&(e=n),"selectionStart"in a)a.selectionStart=n,a.selectionEnd=Math.min(e,a.value.length);else if(e=(n=a.ownerDocument||document)&&n.defaultView||window,e.getSelection){e=e.getSelection();var l=a.textContent.length,p=Math.min(o.start,l);o=o.end===void 0?p:Math.min(o.end,l),!e.extend&&p>o&&(l=o,o=p,p=l),l=Z$(a,p);var m=Z$(a,o);l&&m&&(e.rangeCount!==1||e.anchorNode!==l.node||e.anchorOffset!==l.offset||e.focusNode!==m.node||e.focusOffset!==m.offset)&&(n=n.createRange(),n.setStart(l.node,l.offset),e.removeAllRanges(),p>o?(e.addRange(n),e.extend(m.node,m.offset)):(n.setEnd(m.node,m.offset),e.addRange(n)))}}for(n=[],e=a;e=e.parentNode;)e.nodeType===1&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<n.length;a++)e=n[a],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var OEe=gl&&"documentMode"in document&&11>=document.documentMode,Sf=null,C1=null,ey=null,R1=!1;function eH(e,n,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;R1||Sf==null||Sf!==PS(o)||(o=Sf,"selectionStart"in o&&uk(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),ey&&vy(ey,o)||(ey=o,o=VS(C1,"onSelect"),0<o.length&&(n=new ck("onSelect","select",null,n,a),e.push({event:n,listeners:o}),n.target=Sf)))}function Bb(e,n){var a={};return a[e.toLowerCase()]=n.toLowerCase(),a["Webkit"+e]="webkit"+n,a["Moz"+e]="moz"+n,a}var wf={animationend:Bb("Animation","AnimationEnd"),animationiteration:Bb("Animation","AnimationIteration"),animationstart:Bb("Animation","AnimationStart"),transitionend:Bb("Transition","TransitionEnd")},oI={},yq={};gl&&(yq=document.createElement("div").style,"AnimationEvent"in window||(delete wf.animationend.animation,delete wf.animationiteration.animation,delete wf.animationstart.animation),"TransitionEvent"in window||delete wf.transitionend.transition);function gx(e){if(oI[e])return oI[e];if(!wf[e])return e;var n=wf[e],a;for(a in n)if(n.hasOwnProperty(a)&&a in yq)return oI[e]=n[a];return e}var _q=gx("animationend"),Eq=gx("animationiteration"),bq=gx("animationstart"),Sq=gx("transitionend"),wq=new Map,tH="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wd(e,n){wq.set(e,n),Ph(n,[e])}for(var cI=0;cI<tH.length;cI++){var lI=tH[cI],IEe=lI.toLowerCase(),PEe=lI[0].toUpperCase()+lI.slice(1);Wd(IEe,"on"+PEe)}Wd(_q,"onAnimationEnd");Wd(Eq,"onAnimationIteration");Wd(bq,"onAnimationStart");Wd("dblclick","onDoubleClick");Wd("focusin","onFocus");Wd("focusout","onBlur");Wd(Sq,"onTransitionEnd");zf("onMouseEnter",["mouseout","mouseover"]);zf("onMouseLeave",["mouseout","mouseover"]);zf("onPointerEnter",["pointerout","pointerover"]);zf("onPointerLeave",["pointerout","pointerover"]);Ph("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ph("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ph("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ph("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ph("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ph("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),DEe=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kv));function nH(e,n,a){var o=e.type||"unknown-event";e.currentTarget=a,I0e(o,n,void 0,e),e.currentTarget=null}function xq(e,n){n=(n&4)!==0;for(var a=0;a<e.length;a++){var o=e[a],l=o.event;o=o.listeners;e:{var p=void 0;if(n)for(var m=o.length-1;0<=m;m--){var y=o[m],E=y.instance,b=y.currentTarget;if(y=y.listener,E!==p&&l.isPropagationStopped())break e;nH(l,y,b),p=E}else for(m=0;m<o.length;m++){if(y=o[m],E=y.instance,b=y.currentTarget,y=y.listener,E!==p&&l.isPropagationStopped())break e;nH(l,y,b),p=E}}}if(kS)throw e=S1,kS=!1,S1=null,e}function mr(e,n){var a=n[P1];a===void 0&&(a=n[P1]=new Set);var o=e+"__bubble";a.has(o)||(Tq(n,e,2,!1),a.add(o))}function dI(e,n,a){var o=0;n&&(o|=4),Tq(a,e,o,n)}var Wb="_reactListening"+Math.random().toString(36).slice(2);function yy(e){if(!e[Wb]){e[Wb]=!0,PY.forEach(function(a){a!=="selectionchange"&&(DEe.has(a)||dI(a,!1,e),dI(a,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Wb]||(n[Wb]=!0,dI("selectionchange",!1,n))}}function Tq(e,n,a,o){switch(cq(n)){case 1:var l=K0e;break;case 4:l=Y0e;break;default:l=sk}a=l.bind(null,n,a,e),l=void 0,!b1||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(l=!0),o?l!==void 0?e.addEventListener(n,a,{capture:!0,passive:l}):e.addEventListener(n,a,!0):l!==void 0?e.addEventListener(n,a,{passive:l}):e.addEventListener(n,a,!1)}function uI(e,n,a,o,l){var p=o;if(!(n&1)&&!(n&2)&&o!==null)e:for(;;){if(o===null)return;var m=o.tag;if(m===3||m===4){var y=o.stateNode.containerInfo;if(y===l||y.nodeType===8&&y.parentNode===l)break;if(m===4)for(m=o.return;m!==null;){var E=m.tag;if((E===3||E===4)&&(E=m.stateNode.containerInfo,E===l||E.nodeType===8&&E.parentNode===l))return;m=m.return}for(;y!==null;){if(m=nh(y),m===null)return;if(E=m.tag,E===5||E===6){o=p=m;continue e}y=y.parentNode}}o=o.return}YY(function(){var b=p,T=nk(a),x=[];e:{var A=wq.get(e);if(A!==void 0){var D=ck,N=e;switch(e){case"keypress":if(yS(a)===0)break e;case"keydown":case"keyup":D=lEe;break;case"focusin":N="focus",D=iI;break;case"focusout":N="blur",D=iI;break;case"beforeblur":case"afterblur":D=iI;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":D=$$;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":D=J0e;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":D=hEe;break;case _q:case Eq:case bq:D=eEe;break;case Sq:D=fEe;break;case"scroll":D=q0e;break;case"wheel":D=gEe;break;case"copy":case"cut":case"paste":D=nEe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":D=z$}var L=(n&4)!==0,P=!L&&e==="scroll",U=L?A!==null?A+"Capture":null:A;L=[];for(var V=b,F;V!==null;){F=V;var H=F.stateNode;if(F.tag===5&&H!==null&&(F=H,U!==null&&(H=hy(V,U),H!=null&&L.push(_y(V,H,F)))),P)break;V=V.return}0<L.length&&(A=new D(A,N,null,a,T),x.push({event:A,listeners:L}))}}if(!(n&7)){e:{if(A=e==="mouseover"||e==="pointerover",D=e==="mouseout"||e==="pointerout",A&&a!==_1&&(N=a.relatedTarget||a.fromElement)&&(nh(N)||N[vl]))break e;if((D||A)&&(A=T.window===T?T:(A=T.ownerDocument)?A.defaultView||A.parentWindow:window,D?(N=a.relatedTarget||a.toElement,D=b,N=N?nh(N):null,N!==null&&(P=Dh(N),N!==P||N.tag!==5&&N.tag!==6)&&(N=null)):(D=null,N=b),D!==N)){if(L=$$,H="onMouseLeave",U="onMouseEnter",V="mouse",(e==="pointerout"||e==="pointerover")&&(L=z$,H="onPointerLeave",U="onPointerEnter",V="pointer"),P=D==null?A:xf(D),F=N==null?A:xf(N),A=new L(H,V+"leave",D,a,T),A.target=P,A.relatedTarget=F,H=null,nh(T)===b&&(L=new L(U,V+"enter",N,a,T),L.target=F,L.relatedTarget=P,H=L),P=H,D&&N)t:{for(L=D,U=N,V=0,F=L;F;F=hf(F))V++;for(F=0,H=U;H;H=hf(H))F++;for(;0<V-F;)L=hf(L),V--;for(;0<F-V;)U=hf(U),F--;for(;V--;){if(L===U||U!==null&&L===U.alternate)break t;L=hf(L),U=hf(U)}L=null}else L=null;D!==null&&rH(x,A,D,L,!1),N!==null&&P!==null&&rH(x,P,N,L,!0)}}e:{if(A=b?xf(b):window,D=A.nodeName&&A.nodeName.toLowerCase(),D==="select"||D==="input"&&A.type==="file")var B=wEe;else if(q$(A))if(fq)B=REe;else{B=TEe;var z=xEe}else(D=A.nodeName)&&D.toLowerCase()==="input"&&(A.type==="checkbox"||A.type==="radio")&&(B=CEe);if(B&&(B=B(e,b))){pq(x,B,a,T);break e}z&&z(e,A,b),e==="focusout"&&(z=A._wrapperState)&&z.controlled&&A.type==="number"&&f1(A,"number",A.value)}switch(z=b?xf(b):window,e){case"focusin":(q$(z)||z.contentEditable==="true")&&(Sf=z,C1=b,ey=null);break;case"focusout":ey=C1=Sf=null;break;case"mousedown":R1=!0;break;case"contextmenu":case"mouseup":case"dragend":R1=!1,eH(x,a,T);break;case"selectionchange":if(OEe)break;case"keydown":case"keyup":eH(x,a,T)}var Y;if(dk)e:{switch(e){case"compositionstart":var Q="onCompositionStart";break e;case"compositionend":Q="onCompositionEnd";break e;case"compositionupdate":Q="onCompositionUpdate";break e}Q=void 0}else bf?uq(e,a)&&(Q="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Q="onCompositionStart");Q&&(dq&&a.locale!=="ko"&&(bf||Q!=="onCompositionStart"?Q==="onCompositionEnd"&&bf&&(Y=lq()):(Sd=T,ok="value"in Sd?Sd.value:Sd.textContent,bf=!0)),z=VS(b,Q),0<z.length&&(Q=new H$(Q,e,null,a,T),x.push({event:Q,listeners:z}),Y?Q.data=Y:(Y=hq(a),Y!==null&&(Q.data=Y)))),(Y=yEe?_Ee(e,a):EEe(e,a))&&(b=VS(b,"onBeforeInput"),0<b.length&&(T=new H$("onBeforeInput","beforeinput",null,a,T),x.push({event:T,listeners:b}),T.data=Y))}xq(x,n)})}function _y(e,n,a){return{instance:e,listener:n,currentTarget:a}}function VS(e,n){for(var a=n+"Capture",o=[];e!==null;){var l=e,p=l.stateNode;l.tag===5&&p!==null&&(l=p,p=hy(e,a),p!=null&&o.unshift(_y(e,p,l)),p=hy(e,n),p!=null&&o.push(_y(e,p,l))),e=e.return}return o}function hf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function rH(e,n,a,o,l){for(var p=n._reactName,m=[];a!==null&&a!==o;){var y=a,E=y.alternate,b=y.stateNode;if(E!==null&&E===o)break;y.tag===5&&b!==null&&(y=b,l?(E=hy(a,p),E!=null&&m.unshift(_y(a,E,y))):l||(E=hy(a,p),E!=null&&m.push(_y(a,E,y)))),a=a.return}m.length!==0&&e.push({event:n,listeners:m})}var kEe=/\r\n?/g,LEe=/\u0000|\uFFFD/g;function iH(e){return(typeof e=="string"?e:""+e).replace(kEe,`
`).replace(LEe,"")}function Gb(e,n,a){if(n=iH(n),iH(e)!==n&&a)throw Error(Xe(425))}function FS(){}var A1=null,N1=null;function O1(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var I1=typeof setTimeout=="function"?setTimeout:void 0,jEe=typeof clearTimeout=="function"?clearTimeout:void 0,aH=typeof Promise=="function"?Promise:void 0,MEe=typeof queueMicrotask=="function"?queueMicrotask:typeof aH<"u"?function(e){return aH.resolve(null).then(e).catch(UEe)}:I1;function UEe(e){setTimeout(function(){throw e})}function hI(e,n){var a=n,o=0;do{var l=a.nextSibling;if(e.removeChild(a),l&&l.nodeType===8)if(a=l.data,a==="/$"){if(o===0){e.removeChild(l),my(n);return}o--}else a!=="$"&&a!=="$?"&&a!=="$!"||o++;a=l}while(a);my(n)}function Od(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return e}function sH(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(n===0)return e;n--}else a==="/$"&&n++}e=e.previousSibling}return null}var Am=Math.random().toString(36).slice(2),Tc="__reactFiber$"+Am,Ey="__reactProps$"+Am,vl="__reactContainer$"+Am,P1="__reactEvents$"+Am,VEe="__reactListeners$"+Am,FEe="__reactHandles$"+Am;function nh(e){var n=e[Tc];if(n)return n;for(var a=e.parentNode;a;){if(n=a[vl]||a[Tc]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(e=sH(e);e!==null;){if(a=e[Tc])return a;e=sH(e)}return n}e=a,a=e.parentNode}return null}function g_(e){return e=e[Tc]||e[vl],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function xf(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Xe(33))}function vx(e){return e[Ey]||null}var D1=[],Tf=-1;function Gd(e){return{current:e}}function yr(e){0>Tf||(e.current=D1[Tf],D1[Tf]=null,Tf--)}function or(e,n){Tf++,D1[Tf]=e.current,e.current=n}var Vd={},ia=Gd(Vd),Fa=Gd(!1),Eh=Vd;function Kf(e,n){var a=e.type.contextTypes;if(!a)return Vd;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===n)return o.__reactInternalMemoizedMaskedChildContext;var l={},p;for(p in a)l[p]=n[p];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=l),l}function Ba(e){return e=e.childContextTypes,e!=null}function BS(){yr(Fa),yr(ia)}function oH(e,n,a){if(ia.current!==Vd)throw Error(Xe(168));or(ia,n),or(Fa,a)}function Cq(e,n,a){var o=e.stateNode;if(n=n.childContextTypes,typeof o.getChildContext!="function")return a;o=o.getChildContext();for(var l in o)if(!(l in n))throw Error(Xe(108,x0e(e)||"Unknown",l));return Mr({},a,o)}function WS(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vd,Eh=ia.current,or(ia,e),or(Fa,Fa.current),!0}function cH(e,n,a){var o=e.stateNode;if(!o)throw Error(Xe(169));a?(e=Cq(e,n,Eh),o.__reactInternalMemoizedMergedChildContext=e,yr(Fa),yr(ia),or(ia,e)):yr(Fa),or(Fa,a)}var al=null,yx=!1,pI=!1;function Rq(e){al===null?al=[e]:al.push(e)}function BEe(e){yx=!0,Rq(e)}function $d(){if(!pI&&al!==null){pI=!0;var e=0,n=$n;try{var a=al;for($n=1;e<a.length;e++){var o=a[e];do o=o(!0);while(o!==null)}al=null,yx=!1}catch(l){throw al!==null&&(al=al.slice(e+1)),QY(rk,$d),l}finally{$n=n,pI=!1}}return null}var Cf=[],Rf=0,GS=null,$S=0,zs=[],Ks=0,bh=null,sl=1,ol="";function qu(e,n){Cf[Rf++]=$S,Cf[Rf++]=GS,GS=e,$S=n}function Aq(e,n,a){zs[Ks++]=sl,zs[Ks++]=ol,zs[Ks++]=bh,bh=e;var o=sl;e=ol;var l=32-$o(o)-1;o&=~(1<<l),a+=1;var p=32-$o(n)+l;if(30<p){var m=l-l%5;p=(o&(1<<m)-1).toString(32),o>>=m,l-=m,sl=1<<32-$o(n)+l|a<<l|o,ol=p+e}else sl=1<<p|a<<l|o,ol=e}function hk(e){e.return!==null&&(qu(e,1),Aq(e,1,0))}function pk(e){for(;e===GS;)GS=Cf[--Rf],Cf[Rf]=null,$S=Cf[--Rf],Cf[Rf]=null;for(;e===bh;)bh=zs[--Ks],zs[Ks]=null,ol=zs[--Ks],zs[Ks]=null,sl=zs[--Ks],zs[Ks]=null}var fs=null,ps=null,Cr=!1,Fo=null;function Nq(e,n){var a=Ys(5,null,null,0);a.elementType="DELETED",a.stateNode=n,a.return=e,n=e.deletions,n===null?(e.deletions=[a],e.flags|=16):n.push(a)}function lH(e,n){switch(e.tag){case 5:var a=e.type;return n=n.nodeType!==1||a.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(e.stateNode=n,fs=e,ps=Od(n.firstChild),!0):!1;case 6:return n=e.pendingProps===""||n.nodeType!==3?null:n,n!==null?(e.stateNode=n,fs=e,ps=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(a=bh!==null?{id:sl,overflow:ol}:null,e.memoizedState={dehydrated:n,treeContext:a,retryLane:1073741824},a=Ys(18,null,null,0),a.stateNode=n,a.return=e,e.child=a,fs=e,ps=null,!0):!1;default:return!1}}function k1(e){return(e.mode&1)!==0&&(e.flags&128)===0}function L1(e){if(Cr){var n=ps;if(n){var a=n;if(!lH(e,n)){if(k1(e))throw Error(Xe(418));n=Od(a.nextSibling);var o=fs;n&&lH(e,n)?Nq(o,a):(e.flags=e.flags&-4097|2,Cr=!1,fs=e)}}else{if(k1(e))throw Error(Xe(418));e.flags=e.flags&-4097|2,Cr=!1,fs=e}}}function dH(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;fs=e}function $b(e){if(e!==fs)return!1;if(!Cr)return dH(e),Cr=!0,!1;var n;if((n=e.tag!==3)&&!(n=e.tag!==5)&&(n=e.type,n=n!=="head"&&n!=="body"&&!O1(e.type,e.memoizedProps)),n&&(n=ps)){if(k1(e))throw Oq(),Error(Xe(418));for(;n;)Nq(e,n),n=Od(n.nextSibling)}if(dH(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Xe(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"){if(n===0){ps=Od(e.nextSibling);break e}n--}else a!=="$"&&a!=="$!"&&a!=="$?"||n++}e=e.nextSibling}ps=null}}else ps=fs?Od(e.stateNode.nextSibling):null;return!0}function Oq(){for(var e=ps;e;)e=Od(e.nextSibling)}function Yf(){ps=fs=null,Cr=!1}function fk(e){Fo===null?Fo=[e]:Fo.push(e)}var WEe=Cl.ReactCurrentBatchConfig;function Nv(e,n,a){if(e=a.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(Xe(309));var o=a.stateNode}if(!o)throw Error(Xe(147,e));var l=o,p=""+e;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===p?n.ref:(n=function(m){var y=l.refs;m===null?delete y[p]:y[p]=m},n._stringRef=p,n)}if(typeof e!="string")throw Error(Xe(284));if(!a._owner)throw Error(Xe(290,e))}return e}function Hb(e,n){throw e=Object.prototype.toString.call(n),Error(Xe(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function uH(e){var n=e._init;return n(e._payload)}function Iq(e){function n(U,V){if(e){var F=U.deletions;F===null?(U.deletions=[V],U.flags|=16):F.push(V)}}function a(U,V){if(!e)return null;for(;V!==null;)n(U,V),V=V.sibling;return null}function o(U,V){for(U=new Map;V!==null;)V.key!==null?U.set(V.key,V):U.set(V.index,V),V=V.sibling;return U}function l(U,V){return U=kd(U,V),U.index=0,U.sibling=null,U}function p(U,V,F){return U.index=F,e?(F=U.alternate,F!==null?(F=F.index,F<V?(U.flags|=2,V):F):(U.flags|=2,V)):(U.flags|=1048576,V)}function m(U){return e&&U.alternate===null&&(U.flags|=2),U}function y(U,V,F,H){return V===null||V.tag!==6?(V=EI(F,U.mode,H),V.return=U,V):(V=l(V,F),V.return=U,V)}function E(U,V,F,H){var B=F.type;return B===Ef?T(U,V,F.props.children,H,F.key):V!==null&&(V.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===pd&&uH(B)===V.type)?(H=l(V,F.props),H.ref=Nv(U,V,F),H.return=U,H):(H=TS(F.type,F.key,F.props,null,U.mode,H),H.ref=Nv(U,V,F),H.return=U,H)}function b(U,V,F,H){return V===null||V.tag!==4||V.stateNode.containerInfo!==F.containerInfo||V.stateNode.implementation!==F.implementation?(V=bI(F,U.mode,H),V.return=U,V):(V=l(V,F.children||[]),V.return=U,V)}function T(U,V,F,H,B){return V===null||V.tag!==7?(V=ph(F,U.mode,H,B),V.return=U,V):(V=l(V,F),V.return=U,V)}function x(U,V,F){if(typeof V=="string"&&V!==""||typeof V=="number")return V=EI(""+V,U.mode,F),V.return=U,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case kb:return F=TS(V.type,V.key,V.props,null,U.mode,F),F.ref=Nv(U,null,V),F.return=U,F;case _f:return V=bI(V,U.mode,F),V.return=U,V;case pd:var H=V._init;return x(U,H(V._payload),F)}if(Hv(V)||xv(V))return V=ph(V,U.mode,F,null),V.return=U,V;Hb(U,V)}return null}function A(U,V,F,H){var B=V!==null?V.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return B!==null?null:y(U,V,""+F,H);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case kb:return F.key===B?E(U,V,F,H):null;case _f:return F.key===B?b(U,V,F,H):null;case pd:return B=F._init,A(U,V,B(F._payload),H)}if(Hv(F)||xv(F))return B!==null?null:T(U,V,F,H,null);Hb(U,F)}return null}function D(U,V,F,H,B){if(typeof H=="string"&&H!==""||typeof H=="number")return U=U.get(F)||null,y(V,U,""+H,B);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case kb:return U=U.get(H.key===null?F:H.key)||null,E(V,U,H,B);case _f:return U=U.get(H.key===null?F:H.key)||null,b(V,U,H,B);case pd:var z=H._init;return D(U,V,F,z(H._payload),B)}if(Hv(H)||xv(H))return U=U.get(F)||null,T(V,U,H,B,null);Hb(V,H)}return null}function N(U,V,F,H){for(var B=null,z=null,Y=V,Q=V=0,re=null;Y!==null&&Q<F.length;Q++){Y.index>Q?(re=Y,Y=null):re=Y.sibling;var de=A(U,Y,F[Q],H);if(de===null){Y===null&&(Y=re);break}e&&Y&&de.alternate===null&&n(U,Y),V=p(de,V,Q),z===null?B=de:z.sibling=de,z=de,Y=re}if(Q===F.length)return a(U,Y),Cr&&qu(U,Q),B;if(Y===null){for(;Q<F.length;Q++)Y=x(U,F[Q],H),Y!==null&&(V=p(Y,V,Q),z===null?B=Y:z.sibling=Y,z=Y);return Cr&&qu(U,Q),B}for(Y=o(U,Y);Q<F.length;Q++)re=D(Y,U,Q,F[Q],H),re!==null&&(e&&re.alternate!==null&&Y.delete(re.key===null?Q:re.key),V=p(re,V,Q),z===null?B=re:z.sibling=re,z=re);return e&&Y.forEach(function(le){return n(U,le)}),Cr&&qu(U,Q),B}function L(U,V,F,H){var B=xv(F);if(typeof B!="function")throw Error(Xe(150));if(F=B.call(F),F==null)throw Error(Xe(151));for(var z=B=null,Y=V,Q=V=0,re=null,de=F.next();Y!==null&&!de.done;Q++,de=F.next()){Y.index>Q?(re=Y,Y=null):re=Y.sibling;var le=A(U,Y,de.value,H);if(le===null){Y===null&&(Y=re);break}e&&Y&&le.alternate===null&&n(U,Y),V=p(le,V,Q),z===null?B=le:z.sibling=le,z=le,Y=re}if(de.done)return a(U,Y),Cr&&qu(U,Q),B;if(Y===null){for(;!de.done;Q++,de=F.next())de=x(U,de.value,H),de!==null&&(V=p(de,V,Q),z===null?B=de:z.sibling=de,z=de);return Cr&&qu(U,Q),B}for(Y=o(U,Y);!de.done;Q++,de=F.next())de=D(Y,U,Q,de.value,H),de!==null&&(e&&de.alternate!==null&&Y.delete(de.key===null?Q:de.key),V=p(de,V,Q),z===null?B=de:z.sibling=de,z=de);return e&&Y.forEach(function(he){return n(U,he)}),Cr&&qu(U,Q),B}function P(U,V,F,H){if(typeof F=="object"&&F!==null&&F.type===Ef&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case kb:e:{for(var B=F.key,z=V;z!==null;){if(z.key===B){if(B=F.type,B===Ef){if(z.tag===7){a(U,z.sibling),V=l(z,F.props.children),V.return=U,U=V;break e}}else if(z.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===pd&&uH(B)===z.type){a(U,z.sibling),V=l(z,F.props),V.ref=Nv(U,z,F),V.return=U,U=V;break e}a(U,z);break}else n(U,z);z=z.sibling}F.type===Ef?(V=ph(F.props.children,U.mode,H,F.key),V.return=U,U=V):(H=TS(F.type,F.key,F.props,null,U.mode,H),H.ref=Nv(U,V,F),H.return=U,U=H)}return m(U);case _f:e:{for(z=F.key;V!==null;){if(V.key===z)if(V.tag===4&&V.stateNode.containerInfo===F.containerInfo&&V.stateNode.implementation===F.implementation){a(U,V.sibling),V=l(V,F.children||[]),V.return=U,U=V;break e}else{a(U,V);break}else n(U,V);V=V.sibling}V=bI(F,U.mode,H),V.return=U,U=V}return m(U);case pd:return z=F._init,P(U,V,z(F._payload),H)}if(Hv(F))return N(U,V,F,H);if(xv(F))return L(U,V,F,H);Hb(U,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,V!==null&&V.tag===6?(a(U,V.sibling),V=l(V,F),V.return=U,U=V):(a(U,V),V=EI(F,U.mode,H),V.return=U,U=V),m(U)):a(U,V)}return P}var qf=Iq(!0),Pq=Iq(!1),HS=Gd(null),zS=null,Af=null,mk=null;function gk(){mk=Af=zS=null}function vk(e){var n=HS.current;yr(HS),e._currentValue=n}function j1(e,n,a){for(;e!==null;){var o=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),e===a)break;e=e.return}}function Uf(e,n){zS=e,mk=Af=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&n&&(Ma=!0),e.firstContext=null)}function Zs(e){var n=e._currentValue;if(mk!==e)if(e={context:e,memoizedValue:n,next:null},Af===null){if(zS===null)throw Error(Xe(308));Af=e,zS.dependencies={lanes:0,firstContext:e}}else Af=Af.next=e;return n}var rh=null;function yk(e){rh===null?rh=[e]:rh.push(e)}function Dq(e,n,a,o){var l=n.interleaved;return l===null?(a.next=a,yk(n)):(a.next=l.next,l.next=a),n.interleaved=a,yl(e,o)}function yl(e,n){e.lanes|=n;var a=e.alternate;for(a!==null&&(a.lanes|=n),a=e,e=e.return;e!==null;)e.childLanes|=n,a=e.alternate,a!==null&&(a.childLanes|=n),a=e,e=e.return;return a.tag===3?a.stateNode:null}var fd=!1;function _k(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kq(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ul(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function Id(e,n,a){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,In&2){var l=o.pending;return l===null?n.next=n:(n.next=l.next,l.next=n),o.pending=n,yl(e,a)}return l=o.interleaved,l===null?(n.next=n,yk(o)):(n.next=l.next,l.next=n),o.interleaved=n,yl(e,a)}function _S(e,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194240)!==0)){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,ik(e,a)}}function hH(e,n){var a=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var l=null,p=null;if(a=a.firstBaseUpdate,a!==null){do{var m={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};p===null?l=p=m:p=p.next=m,a=a.next}while(a!==null);p===null?l=p=n:p=p.next=n}else l=p=n;a={baseState:o.baseState,firstBaseUpdate:l,lastBaseUpdate:p,shared:o.shared,effects:o.effects},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=n:e.next=n,a.lastBaseUpdate=n}function KS(e,n,a,o){var l=e.updateQueue;fd=!1;var p=l.firstBaseUpdate,m=l.lastBaseUpdate,y=l.shared.pending;if(y!==null){l.shared.pending=null;var E=y,b=E.next;E.next=null,m===null?p=b:m.next=b,m=E;var T=e.alternate;T!==null&&(T=T.updateQueue,y=T.lastBaseUpdate,y!==m&&(y===null?T.firstBaseUpdate=b:y.next=b,T.lastBaseUpdate=E))}if(p!==null){var x=l.baseState;m=0,T=b=E=null,y=p;do{var A=y.lane,D=y.eventTime;if((o&A)===A){T!==null&&(T=T.next={eventTime:D,lane:0,tag:y.tag,payload:y.payload,callback:y.callback,next:null});e:{var N=e,L=y;switch(A=n,D=a,L.tag){case 1:if(N=L.payload,typeof N=="function"){x=N.call(D,x,A);break e}x=N;break e;case 3:N.flags=N.flags&-65537|128;case 0:if(N=L.payload,A=typeof N=="function"?N.call(D,x,A):N,A==null)break e;x=Mr({},x,A);break e;case 2:fd=!0}}y.callback!==null&&y.lane!==0&&(e.flags|=64,A=l.effects,A===null?l.effects=[y]:A.push(y))}else D={eventTime:D,lane:A,tag:y.tag,payload:y.payload,callback:y.callback,next:null},T===null?(b=T=D,E=x):T=T.next=D,m|=A;if(y=y.next,y===null){if(y=l.shared.pending,y===null)break;A=y,y=A.next,A.next=null,l.lastBaseUpdate=A,l.shared.pending=null}}while(!0);if(T===null&&(E=x),l.baseState=E,l.firstBaseUpdate=b,l.lastBaseUpdate=T,n=l.shared.interleaved,n!==null){l=n;do m|=l.lane,l=l.next;while(l!==n)}else p===null&&(l.shared.lanes=0);wh|=m,e.lanes=m,e.memoizedState=x}}function pH(e,n,a){if(e=n.effects,n.effects=null,e!==null)for(n=0;n<e.length;n++){var o=e[n],l=o.callback;if(l!==null){if(o.callback=null,o=a,typeof l!="function")throw Error(Xe(191,l));l.call(o)}}}var v_={},Ic=Gd(v_),by=Gd(v_),Sy=Gd(v_);function ih(e){if(e===v_)throw Error(Xe(174));return e}function Ek(e,n){switch(or(Sy,n),or(by,e),or(Ic,v_),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:g1(null,"");break;default:e=e===8?n.parentNode:n,n=e.namespaceURI||null,e=e.tagName,n=g1(n,e)}yr(Ic),or(Ic,n)}function Xf(){yr(Ic),yr(by),yr(Sy)}function Lq(e){ih(Sy.current);var n=ih(Ic.current),a=g1(n,e.type);n!==a&&(or(by,e),or(Ic,a))}function bk(e){by.current===e&&(yr(Ic),yr(by))}var Lr=Gd(0);function YS(e){for(var n=e;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var fI=[];function Sk(){for(var e=0;e<fI.length;e++)fI[e]._workInProgressVersionPrimary=null;fI.length=0}var ES=Cl.ReactCurrentDispatcher,mI=Cl.ReactCurrentBatchConfig,Sh=0,jr=null,li=null,xi=null,qS=!1,ty=!1,wy=0,GEe=0;function Xi(){throw Error(Xe(321))}function wk(e,n){if(n===null)return!1;for(var a=0;a<n.length&&a<e.length;a++)if(!Ko(e[a],n[a]))return!1;return!0}function xk(e,n,a,o,l,p){if(Sh=p,jr=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,ES.current=e===null||e.memoizedState===null?KEe:YEe,e=a(o,l),ty){p=0;do{if(ty=!1,wy=0,25<=p)throw Error(Xe(301));p+=1,xi=li=null,n.updateQueue=null,ES.current=qEe,e=a(o,l)}while(ty)}if(ES.current=XS,n=li!==null&&li.next!==null,Sh=0,xi=li=jr=null,qS=!1,n)throw Error(Xe(300));return e}function Tk(){var e=wy!==0;return wy=0,e}function xc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xi===null?jr.memoizedState=xi=e:xi=xi.next=e,xi}function eo(){if(li===null){var e=jr.alternate;e=e!==null?e.memoizedState:null}else e=li.next;var n=xi===null?jr.memoizedState:xi.next;if(n!==null)xi=n,li=e;else{if(e===null)throw Error(Xe(310));li=e,e={memoizedState:li.memoizedState,baseState:li.baseState,baseQueue:li.baseQueue,queue:li.queue,next:null},xi===null?jr.memoizedState=xi=e:xi=xi.next=e}return xi}function xy(e,n){return typeof n=="function"?n(e):n}function gI(e){var n=eo(),a=n.queue;if(a===null)throw Error(Xe(311));a.lastRenderedReducer=e;var o=li,l=o.baseQueue,p=a.pending;if(p!==null){if(l!==null){var m=l.next;l.next=p.next,p.next=m}o.baseQueue=l=p,a.pending=null}if(l!==null){p=l.next,o=o.baseState;var y=m=null,E=null,b=p;do{var T=b.lane;if((Sh&T)===T)E!==null&&(E=E.next={lane:0,action:b.action,hasEagerState:b.hasEagerState,eagerState:b.eagerState,next:null}),o=b.hasEagerState?b.eagerState:e(o,b.action);else{var x={lane:T,action:b.action,hasEagerState:b.hasEagerState,eagerState:b.eagerState,next:null};E===null?(y=E=x,m=o):E=E.next=x,jr.lanes|=T,wh|=T}b=b.next}while(b!==null&&b!==p);E===null?m=o:E.next=y,Ko(o,n.memoizedState)||(Ma=!0),n.memoizedState=o,n.baseState=m,n.baseQueue=E,a.lastRenderedState=o}if(e=a.interleaved,e!==null){l=e;do p=l.lane,jr.lanes|=p,wh|=p,l=l.next;while(l!==e)}else l===null&&(a.lanes=0);return[n.memoizedState,a.dispatch]}function vI(e){var n=eo(),a=n.queue;if(a===null)throw Error(Xe(311));a.lastRenderedReducer=e;var o=a.dispatch,l=a.pending,p=n.memoizedState;if(l!==null){a.pending=null;var m=l=l.next;do p=e(p,m.action),m=m.next;while(m!==l);Ko(p,n.memoizedState)||(Ma=!0),n.memoizedState=p,n.baseQueue===null&&(n.baseState=p),a.lastRenderedState=p}return[p,o]}function jq(){}function Mq(e,n){var a=jr,o=eo(),l=n(),p=!Ko(o.memoizedState,l);if(p&&(o.memoizedState=l,Ma=!0),o=o.queue,Ck(Fq.bind(null,a,o,e),[e]),o.getSnapshot!==n||p||xi!==null&&xi.memoizedState.tag&1){if(a.flags|=2048,Ty(9,Vq.bind(null,a,o,l,n),void 0,null),Ti===null)throw Error(Xe(349));Sh&30||Uq(a,n,l)}return l}function Uq(e,n,a){e.flags|=16384,e={getSnapshot:n,value:a},n=jr.updateQueue,n===null?(n={lastEffect:null,stores:null},jr.updateQueue=n,n.stores=[e]):(a=n.stores,a===null?n.stores=[e]:a.push(e))}function Vq(e,n,a,o){n.value=a,n.getSnapshot=o,Bq(n)&&Wq(e)}function Fq(e,n,a){return a(function(){Bq(n)&&Wq(e)})}function Bq(e){var n=e.getSnapshot;e=e.value;try{var a=n();return!Ko(e,a)}catch{return!0}}function Wq(e){var n=yl(e,1);n!==null&&Ho(n,e,1,-1)}function fH(e){var n=xc();return typeof e=="function"&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xy,lastRenderedState:e},n.queue=e,e=e.dispatch=zEe.bind(null,jr,e),[n.memoizedState,e]}function Ty(e,n,a,o){return e={tag:e,create:n,destroy:a,deps:o,next:null},n=jr.updateQueue,n===null?(n={lastEffect:null,stores:null},jr.updateQueue=n,n.lastEffect=e.next=e):(a=n.lastEffect,a===null?n.lastEffect=e.next=e:(o=a.next,a.next=e,e.next=o,n.lastEffect=e)),e}function Gq(){return eo().memoizedState}function bS(e,n,a,o){var l=xc();jr.flags|=e,l.memoizedState=Ty(1|n,a,void 0,o===void 0?null:o)}function _x(e,n,a,o){var l=eo();o=o===void 0?null:o;var p=void 0;if(li!==null){var m=li.memoizedState;if(p=m.destroy,o!==null&&wk(o,m.deps)){l.memoizedState=Ty(n,a,p,o);return}}jr.flags|=e,l.memoizedState=Ty(1|n,a,p,o)}function mH(e,n){return bS(8390656,8,e,n)}function Ck(e,n){return _x(2048,8,e,n)}function $q(e,n){return _x(4,2,e,n)}function Hq(e,n){return _x(4,4,e,n)}function zq(e,n){if(typeof n=="function")return e=e(),n(e),function(){n(null)};if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function Kq(e,n,a){return a=a!=null?a.concat([e]):null,_x(4,4,zq.bind(null,n,e),a)}function Rk(){}function Yq(e,n){var a=eo();n=n===void 0?null:n;var o=a.memoizedState;return o!==null&&n!==null&&wk(n,o[1])?o[0]:(a.memoizedState=[e,n],e)}function qq(e,n){var a=eo();n=n===void 0?null:n;var o=a.memoizedState;return o!==null&&n!==null&&wk(n,o[1])?o[0]:(e=e(),a.memoizedState=[e,n],e)}function Xq(e,n,a){return Sh&21?(Ko(a,n)||(a=tq(),jr.lanes|=a,wh|=a,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,Ma=!0),e.memoizedState=a)}function $Ee(e,n){var a=$n;$n=a!==0&&4>a?a:4,e(!0);var o=mI.transition;mI.transition={};try{e(!1),n()}finally{$n=a,mI.transition=o}}function Jq(){return eo().memoizedState}function HEe(e,n,a){var o=Dd(e);if(a={lane:o,action:a,hasEagerState:!1,eagerState:null,next:null},Qq(e))Zq(n,a);else if(a=Dq(e,n,a,o),a!==null){var l=ma();Ho(a,e,o,l),eX(a,n,o)}}function zEe(e,n,a){var o=Dd(e),l={lane:o,action:a,hasEagerState:!1,eagerState:null,next:null};if(Qq(e))Zq(n,l);else{var p=e.alternate;if(e.lanes===0&&(p===null||p.lanes===0)&&(p=n.lastRenderedReducer,p!==null))try{var m=n.lastRenderedState,y=p(m,a);if(l.hasEagerState=!0,l.eagerState=y,Ko(y,m)){var E=n.interleaved;E===null?(l.next=l,yk(n)):(l.next=E.next,E.next=l),n.interleaved=l;return}}catch{}finally{}a=Dq(e,n,l,o),a!==null&&(l=ma(),Ho(a,e,o,l),eX(a,n,o))}}function Qq(e){var n=e.alternate;return e===jr||n!==null&&n===jr}function Zq(e,n){ty=qS=!0;var a=e.pending;a===null?n.next=n:(n.next=a.next,a.next=n),e.pending=n}function eX(e,n,a){if(a&4194240){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,ik(e,a)}}var XS={readContext:Zs,useCallback:Xi,useContext:Xi,useEffect:Xi,useImperativeHandle:Xi,useInsertionEffect:Xi,useLayoutEffect:Xi,useMemo:Xi,useReducer:Xi,useRef:Xi,useState:Xi,useDebugValue:Xi,useDeferredValue:Xi,useTransition:Xi,useMutableSource:Xi,useSyncExternalStore:Xi,useId:Xi,unstable_isNewReconciler:!1},KEe={readContext:Zs,useCallback:function(e,n){return xc().memoizedState=[e,n===void 0?null:n],e},useContext:Zs,useEffect:mH,useImperativeHandle:function(e,n,a){return a=a!=null?a.concat([e]):null,bS(4194308,4,zq.bind(null,n,e),a)},useLayoutEffect:function(e,n){return bS(4194308,4,e,n)},useInsertionEffect:function(e,n){return bS(4,2,e,n)},useMemo:function(e,n){var a=xc();return n=n===void 0?null:n,e=e(),a.memoizedState=[e,n],e},useReducer:function(e,n,a){var o=xc();return n=a!==void 0?a(n):n,o.memoizedState=o.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},o.queue=e,e=e.dispatch=HEe.bind(null,jr,e),[o.memoizedState,e]},useRef:function(e){var n=xc();return e={current:e},n.memoizedState=e},useState:fH,useDebugValue:Rk,useDeferredValue:function(e){return xc().memoizedState=e},useTransition:function(){var e=fH(!1),n=e[0];return e=$Ee.bind(null,e[1]),xc().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,a){var o=jr,l=xc();if(Cr){if(a===void 0)throw Error(Xe(407));a=a()}else{if(a=n(),Ti===null)throw Error(Xe(349));Sh&30||Uq(o,n,a)}l.memoizedState=a;var p={value:a,getSnapshot:n};return l.queue=p,mH(Fq.bind(null,o,p,e),[e]),o.flags|=2048,Ty(9,Vq.bind(null,o,p,a,n),void 0,null),a},useId:function(){var e=xc(),n=Ti.identifierPrefix;if(Cr){var a=ol,o=sl;a=(o&~(1<<32-$o(o)-1)).toString(32)+a,n=":"+n+"R"+a,a=wy++,0<a&&(n+="H"+a.toString(32)),n+=":"}else a=GEe++,n=":"+n+"r"+a.toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},YEe={readContext:Zs,useCallback:Yq,useContext:Zs,useEffect:Ck,useImperativeHandle:Kq,useInsertionEffect:$q,useLayoutEffect:Hq,useMemo:qq,useReducer:gI,useRef:Gq,useState:function(){return gI(xy)},useDebugValue:Rk,useDeferredValue:function(e){var n=eo();return Xq(n,li.memoizedState,e)},useTransition:function(){var e=gI(xy)[0],n=eo().memoizedState;return[e,n]},useMutableSource:jq,useSyncExternalStore:Mq,useId:Jq,unstable_isNewReconciler:!1},qEe={readContext:Zs,useCallback:Yq,useContext:Zs,useEffect:Ck,useImperativeHandle:Kq,useInsertionEffect:$q,useLayoutEffect:Hq,useMemo:qq,useReducer:vI,useRef:Gq,useState:function(){return vI(xy)},useDebugValue:Rk,useDeferredValue:function(e){var n=eo();return li===null?n.memoizedState=e:Xq(n,li.memoizedState,e)},useTransition:function(){var e=vI(xy)[0],n=eo().memoizedState;return[e,n]},useMutableSource:jq,useSyncExternalStore:Mq,useId:Jq,unstable_isNewReconciler:!1};function jo(e,n){if(e&&e.defaultProps){n=Mr({},n),e=e.defaultProps;for(var a in e)n[a]===void 0&&(n[a]=e[a]);return n}return n}function M1(e,n,a,o){n=e.memoizedState,a=a(o,n),a=a==null?n:Mr({},n,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Ex={isMounted:function(e){return(e=e._reactInternals)?Dh(e)===e:!1},enqueueSetState:function(e,n,a){e=e._reactInternals;var o=ma(),l=Dd(e),p=ul(o,l);p.payload=n,a!=null&&(p.callback=a),n=Id(e,p,l),n!==null&&(Ho(n,e,l,o),_S(n,e,l))},enqueueReplaceState:function(e,n,a){e=e._reactInternals;var o=ma(),l=Dd(e),p=ul(o,l);p.tag=1,p.payload=n,a!=null&&(p.callback=a),n=Id(e,p,l),n!==null&&(Ho(n,e,l,o),_S(n,e,l))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var a=ma(),o=Dd(e),l=ul(a,o);l.tag=2,n!=null&&(l.callback=n),n=Id(e,l,o),n!==null&&(Ho(n,e,o,a),_S(n,e,o))}};function gH(e,n,a,o,l,p,m){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,p,m):n.prototype&&n.prototype.isPureReactComponent?!vy(a,o)||!vy(l,p):!0}function tX(e,n,a){var o=!1,l=Vd,p=n.contextType;return typeof p=="object"&&p!==null?p=Zs(p):(l=Ba(n)?Eh:ia.current,o=n.contextTypes,p=(o=o!=null)?Kf(e,l):Vd),n=new n(a,p),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Ex,e.stateNode=n,n._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=l,e.__reactInternalMemoizedMaskedChildContext=p),n}function vH(e,n,a,o){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,o),n.state!==e&&Ex.enqueueReplaceState(n,n.state,null)}function U1(e,n,a,o){var l=e.stateNode;l.props=a,l.state=e.memoizedState,l.refs={},_k(e);var p=n.contextType;typeof p=="object"&&p!==null?l.context=Zs(p):(p=Ba(n)?Eh:ia.current,l.context=Kf(e,p)),l.state=e.memoizedState,p=n.getDerivedStateFromProps,typeof p=="function"&&(M1(e,n,p,a),l.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof l.getSnapshotBeforeUpdate=="function"||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(n=l.state,typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount(),n!==l.state&&Ex.enqueueReplaceState(l,l.state,null),KS(e,a,l,o),l.state=e.memoizedState),typeof l.componentDidMount=="function"&&(e.flags|=4194308)}function Jf(e,n){try{var a="",o=n;do a+=w0e(o),o=o.return;while(o);var l=a}catch(p){l=`
Error generating stack: `+p.message+`
`+p.stack}return{value:e,source:n,stack:l,digest:null}}function yI(e,n,a){return{value:e,source:null,stack:a??null,digest:n??null}}function V1(e,n){try{console.error(n.value)}catch(a){setTimeout(function(){throw a})}}var XEe=typeof WeakMap=="function"?WeakMap:Map;function nX(e,n,a){a=ul(-1,a),a.tag=3,a.payload={element:null};var o=n.value;return a.callback=function(){QS||(QS=!0,q1=o),V1(e,n)},a}function rX(e,n,a){a=ul(-1,a),a.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var l=n.value;a.payload=function(){return o(l)},a.callback=function(){V1(e,n)}}var p=e.stateNode;return p!==null&&typeof p.componentDidCatch=="function"&&(a.callback=function(){V1(e,n),typeof o!="function"&&(Pd===null?Pd=new Set([this]):Pd.add(this));var m=n.stack;this.componentDidCatch(n.value,{componentStack:m!==null?m:""})}),a}function yH(e,n,a){var o=e.pingCache;if(o===null){o=e.pingCache=new XEe;var l=new Set;o.set(n,l)}else l=o.get(n),l===void 0&&(l=new Set,o.set(n,l));l.has(a)||(l.add(a),e=dbe.bind(null,e,n,a),n.then(e,e))}function _H(e){do{var n;if((n=e.tag===13)&&(n=e.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return e;e=e.return}while(e!==null);return null}function EH(e,n,a,o,l){return e.mode&1?(e.flags|=65536,e.lanes=l,e):(e===n?e.flags|=65536:(e.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(n=ul(-1,1),n.tag=2,Id(a,n,1))),a.lanes|=1),e)}var JEe=Cl.ReactCurrentOwner,Ma=!1;function pa(e,n,a,o){n.child=e===null?Pq(n,null,a,o):qf(n,e.child,a,o)}function bH(e,n,a,o,l){a=a.render;var p=n.ref;return Uf(n,l),o=xk(e,n,a,o,p,l),a=Tk(),e!==null&&!Ma?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~l,_l(e,n,l)):(Cr&&a&&hk(n),n.flags|=1,pa(e,n,o,l),n.child)}function SH(e,n,a,o,l){if(e===null){var p=a.type;return typeof p=="function"&&!Lk(p)&&p.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(n.tag=15,n.type=p,iX(e,n,p,o,l)):(e=TS(a.type,null,o,n,n.mode,l),e.ref=n.ref,e.return=n,n.child=e)}if(p=e.child,!(e.lanes&l)){var m=p.memoizedProps;if(a=a.compare,a=a!==null?a:vy,a(m,o)&&e.ref===n.ref)return _l(e,n,l)}return n.flags|=1,e=kd(p,o),e.ref=n.ref,e.return=n,n.child=e}function iX(e,n,a,o,l){if(e!==null){var p=e.memoizedProps;if(vy(p,o)&&e.ref===n.ref)if(Ma=!1,n.pendingProps=o=p,(e.lanes&l)!==0)e.flags&131072&&(Ma=!0);else return n.lanes=e.lanes,_l(e,n,l)}return F1(e,n,a,o,l)}function aX(e,n,a){var o=n.pendingProps,l=o.children,p=e!==null?e.memoizedState:null;if(o.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},or(Of,ls),ls|=a;else{if(!(a&1073741824))return e=p!==null?p.baseLanes|a:a,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,or(Of,ls),ls|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=p!==null?p.baseLanes:a,or(Of,ls),ls|=o}else p!==null?(o=p.baseLanes|a,n.memoizedState=null):o=a,or(Of,ls),ls|=o;return pa(e,n,l,a),n.child}function sX(e,n){var a=n.ref;(e===null&&a!==null||e!==null&&e.ref!==a)&&(n.flags|=512,n.flags|=2097152)}function F1(e,n,a,o,l){var p=Ba(a)?Eh:ia.current;return p=Kf(n,p),Uf(n,l),a=xk(e,n,a,o,p,l),o=Tk(),e!==null&&!Ma?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~l,_l(e,n,l)):(Cr&&o&&hk(n),n.flags|=1,pa(e,n,a,l),n.child)}function wH(e,n,a,o,l){if(Ba(a)){var p=!0;WS(n)}else p=!1;if(Uf(n,l),n.stateNode===null)SS(e,n),tX(n,a,o),U1(n,a,o,l),o=!0;else if(e===null){var m=n.stateNode,y=n.memoizedProps;m.props=y;var E=m.context,b=a.contextType;typeof b=="object"&&b!==null?b=Zs(b):(b=Ba(a)?Eh:ia.current,b=Kf(n,b));var T=a.getDerivedStateFromProps,x=typeof T=="function"||typeof m.getSnapshotBeforeUpdate=="function";x||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(y!==o||E!==b)&&vH(n,m,o,b),fd=!1;var A=n.memoizedState;m.state=A,KS(n,o,m,l),E=n.memoizedState,y!==o||A!==E||Fa.current||fd?(typeof T=="function"&&(M1(n,a,T,o),E=n.memoizedState),(y=fd||gH(n,a,y,o,A,E,b))?(x||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(n.flags|=4194308)):(typeof m.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=E),m.props=o,m.state=E,m.context=b,o=y):(typeof m.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{m=n.stateNode,kq(e,n),y=n.memoizedProps,b=n.type===n.elementType?y:jo(n.type,y),m.props=b,x=n.pendingProps,A=m.context,E=a.contextType,typeof E=="object"&&E!==null?E=Zs(E):(E=Ba(a)?Eh:ia.current,E=Kf(n,E));var D=a.getDerivedStateFromProps;(T=typeof D=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(y!==x||A!==E)&&vH(n,m,o,E),fd=!1,A=n.memoizedState,m.state=A,KS(n,o,m,l);var N=n.memoizedState;y!==x||A!==N||Fa.current||fd?(typeof D=="function"&&(M1(n,a,D,o),N=n.memoizedState),(b=fd||gH(n,a,b,o,A,N,E)||!1)?(T||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(o,N,E),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(o,N,E)),typeof m.componentDidUpdate=="function"&&(n.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof m.componentDidUpdate!="function"||y===e.memoizedProps&&A===e.memoizedState||(n.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&A===e.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=N),m.props=o,m.state=N,m.context=E,o=b):(typeof m.componentDidUpdate!="function"||y===e.memoizedProps&&A===e.memoizedState||(n.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&A===e.memoizedState||(n.flags|=1024),o=!1)}return B1(e,n,a,o,p,l)}function B1(e,n,a,o,l,p){sX(e,n);var m=(n.flags&128)!==0;if(!o&&!m)return l&&cH(n,a,!1),_l(e,n,p);o=n.stateNode,JEe.current=n;var y=m&&typeof a.getDerivedStateFromError!="function"?null:o.render();return n.flags|=1,e!==null&&m?(n.child=qf(n,e.child,null,p),n.child=qf(n,null,y,p)):pa(e,n,y,p),n.memoizedState=o.state,l&&cH(n,a,!0),n.child}function oX(e){var n=e.stateNode;n.pendingContext?oH(e,n.pendingContext,n.pendingContext!==n.context):n.context&&oH(e,n.context,!1),Ek(e,n.containerInfo)}function xH(e,n,a,o,l){return Yf(),fk(l),n.flags|=256,pa(e,n,a,o),n.child}var W1={dehydrated:null,treeContext:null,retryLane:0};function G1(e){return{baseLanes:e,cachePool:null,transitions:null}}function cX(e,n,a){var o=n.pendingProps,l=Lr.current,p=!1,m=(n.flags&128)!==0,y;if((y=m)||(y=e!==null&&e.memoizedState===null?!1:(l&2)!==0),y?(p=!0,n.flags&=-129):(e===null||e.memoizedState!==null)&&(l|=1),or(Lr,l&1),e===null)return L1(n),e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(n.mode&1?e.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(m=o.children,e=o.fallback,p?(o=n.mode,p=n.child,m={mode:"hidden",children:m},!(o&1)&&p!==null?(p.childLanes=0,p.pendingProps=m):p=wx(m,o,0,null),e=ph(e,o,a,null),p.return=n,e.return=n,p.sibling=e,n.child=p,n.child.memoizedState=G1(a),n.memoizedState=W1,e):Ak(n,m));if(l=e.memoizedState,l!==null&&(y=l.dehydrated,y!==null))return QEe(e,n,m,o,y,l,a);if(p){p=o.fallback,m=n.mode,l=e.child,y=l.sibling;var E={mode:"hidden",children:o.children};return!(m&1)&&n.child!==l?(o=n.child,o.childLanes=0,o.pendingProps=E,n.deletions=null):(o=kd(l,E),o.subtreeFlags=l.subtreeFlags&14680064),y!==null?p=kd(y,p):(p=ph(p,m,a,null),p.flags|=2),p.return=n,o.return=n,o.sibling=p,n.child=o,o=p,p=n.child,m=e.child.memoizedState,m=m===null?G1(a):{baseLanes:m.baseLanes|a,cachePool:null,transitions:m.transitions},p.memoizedState=m,p.childLanes=e.childLanes&~a,n.memoizedState=W1,o}return p=e.child,e=p.sibling,o=kd(p,{mode:"visible",children:o.children}),!(n.mode&1)&&(o.lanes=a),o.return=n,o.sibling=null,e!==null&&(a=n.deletions,a===null?(n.deletions=[e],n.flags|=16):a.push(e)),n.child=o,n.memoizedState=null,o}function Ak(e,n){return n=wx({mode:"visible",children:n},e.mode,0,null),n.return=e,e.child=n}function zb(e,n,a,o){return o!==null&&fk(o),qf(n,e.child,null,a),e=Ak(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function QEe(e,n,a,o,l,p,m){if(a)return n.flags&256?(n.flags&=-257,o=yI(Error(Xe(422))),zb(e,n,m,o)):n.memoizedState!==null?(n.child=e.child,n.flags|=128,null):(p=o.fallback,l=n.mode,o=wx({mode:"visible",children:o.children},l,0,null),p=ph(p,l,m,null),p.flags|=2,o.return=n,p.return=n,o.sibling=p,n.child=o,n.mode&1&&qf(n,e.child,null,m),n.child.memoizedState=G1(m),n.memoizedState=W1,p);if(!(n.mode&1))return zb(e,n,m,null);if(l.data==="$!"){if(o=l.nextSibling&&l.nextSibling.dataset,o)var y=o.dgst;return o=y,p=Error(Xe(419)),o=yI(p,o,void 0),zb(e,n,m,o)}if(y=(m&e.childLanes)!==0,Ma||y){if(o=Ti,o!==null){switch(m&-m){case 4:l=2;break;case 16:l=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:l=32;break;case 536870912:l=268435456;break;default:l=0}l=l&(o.suspendedLanes|m)?0:l,l!==0&&l!==p.retryLane&&(p.retryLane=l,yl(e,l),Ho(o,e,l,-1))}return kk(),o=yI(Error(Xe(421))),zb(e,n,m,o)}return l.data==="$?"?(n.flags|=128,n.child=e.child,n=ube.bind(null,e),l._reactRetry=n,null):(e=p.treeContext,ps=Od(l.nextSibling),fs=n,Cr=!0,Fo=null,e!==null&&(zs[Ks++]=sl,zs[Ks++]=ol,zs[Ks++]=bh,sl=e.id,ol=e.overflow,bh=n),n=Ak(n,o.children),n.flags|=4096,n)}function TH(e,n,a){e.lanes|=n;var o=e.alternate;o!==null&&(o.lanes|=n),j1(e.return,n,a)}function _I(e,n,a,o,l){var p=e.memoizedState;p===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:l}:(p.isBackwards=n,p.rendering=null,p.renderingStartTime=0,p.last=o,p.tail=a,p.tailMode=l)}function lX(e,n,a){var o=n.pendingProps,l=o.revealOrder,p=o.tail;if(pa(e,n,o.children,a),o=Lr.current,o&2)o=o&1|2,n.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&TH(e,a,n);else if(e.tag===19)TH(e,a,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if(or(Lr,o),!(n.mode&1))n.memoizedState=null;else switch(l){case"forwards":for(a=n.child,l=null;a!==null;)e=a.alternate,e!==null&&YS(e)===null&&(l=a),a=a.sibling;a=l,a===null?(l=n.child,n.child=null):(l=a.sibling,a.sibling=null),_I(n,!1,l,a,p);break;case"backwards":for(a=null,l=n.child,n.child=null;l!==null;){if(e=l.alternate,e!==null&&YS(e)===null){n.child=l;break}e=l.sibling,l.sibling=a,a=l,l=e}_I(n,!0,a,null,p);break;case"together":_I(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function SS(e,n){!(n.mode&1)&&e!==null&&(e.alternate=null,n.alternate=null,n.flags|=2)}function _l(e,n,a){if(e!==null&&(n.dependencies=e.dependencies),wh|=n.lanes,!(a&n.childLanes))return null;if(e!==null&&n.child!==e.child)throw Error(Xe(153));if(n.child!==null){for(e=n.child,a=kd(e,e.pendingProps),n.child=a,a.return=n;e.sibling!==null;)e=e.sibling,a=a.sibling=kd(e,e.pendingProps),a.return=n;a.sibling=null}return n.child}function ZEe(e,n,a){switch(n.tag){case 3:oX(n),Yf();break;case 5:Lq(n);break;case 1:Ba(n.type)&&WS(n);break;case 4:Ek(n,n.stateNode.containerInfo);break;case 10:var o=n.type._context,l=n.memoizedProps.value;or(HS,o._currentValue),o._currentValue=l;break;case 13:if(o=n.memoizedState,o!==null)return o.dehydrated!==null?(or(Lr,Lr.current&1),n.flags|=128,null):a&n.child.childLanes?cX(e,n,a):(or(Lr,Lr.current&1),e=_l(e,n,a),e!==null?e.sibling:null);or(Lr,Lr.current&1);break;case 19:if(o=(a&n.childLanes)!==0,e.flags&128){if(o)return lX(e,n,a);n.flags|=128}if(l=n.memoizedState,l!==null&&(l.rendering=null,l.tail=null,l.lastEffect=null),or(Lr,Lr.current),o)break;return null;case 22:case 23:return n.lanes=0,aX(e,n,a)}return _l(e,n,a)}var dX,$1,uX,hX;dX=function(e,n){for(var a=n.child;a!==null;){if(a.tag===5||a.tag===6)e.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};$1=function(){};uX=function(e,n,a,o){var l=e.memoizedProps;if(l!==o){e=n.stateNode,ih(Ic.current);var p=null;switch(a){case"input":l=h1(e,l),o=h1(e,o),p=[];break;case"select":l=Mr({},l,{value:void 0}),o=Mr({},o,{value:void 0}),p=[];break;case"textarea":l=m1(e,l),o=m1(e,o),p=[];break;default:typeof l.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=FS)}v1(a,o);var m;a=null;for(b in l)if(!o.hasOwnProperty(b)&&l.hasOwnProperty(b)&&l[b]!=null)if(b==="style"){var y=l[b];for(m in y)y.hasOwnProperty(m)&&(a||(a={}),a[m]="")}else b!=="dangerouslySetInnerHTML"&&b!=="children"&&b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(dy.hasOwnProperty(b)?p||(p=[]):(p=p||[]).push(b,null));for(b in o){var E=o[b];if(y=l!=null?l[b]:void 0,o.hasOwnProperty(b)&&E!==y&&(E!=null||y!=null))if(b==="style")if(y){for(m in y)!y.hasOwnProperty(m)||E&&E.hasOwnProperty(m)||(a||(a={}),a[m]="");for(m in E)E.hasOwnProperty(m)&&y[m]!==E[m]&&(a||(a={}),a[m]=E[m])}else a||(p||(p=[]),p.push(b,a)),a=E;else b==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,y=y?y.__html:void 0,E!=null&&y!==E&&(p=p||[]).push(b,E)):b==="children"?typeof E!="string"&&typeof E!="number"||(p=p||[]).push(b,""+E):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&(dy.hasOwnProperty(b)?(E!=null&&b==="onScroll"&&mr("scroll",e),p||y===E||(p=[])):(p=p||[]).push(b,E))}a&&(p=p||[]).push("style",a);var b=p;(n.updateQueue=b)&&(n.flags|=4)}};hX=function(e,n,a,o){a!==o&&(n.flags|=4)};function Ov(e,n){if(!Cr)switch(e.tailMode){case"hidden":n=e.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Ji(e){var n=e.alternate!==null&&e.alternate.child===e.child,a=0,o=0;if(n)for(var l=e.child;l!==null;)a|=l.lanes|l.childLanes,o|=l.subtreeFlags&14680064,o|=l.flags&14680064,l.return=e,l=l.sibling;else for(l=e.child;l!==null;)a|=l.lanes|l.childLanes,o|=l.subtreeFlags,o|=l.flags,l.return=e,l=l.sibling;return e.subtreeFlags|=o,e.childLanes=a,n}function ebe(e,n,a){var o=n.pendingProps;switch(pk(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ji(n),null;case 1:return Ba(n.type)&&BS(),Ji(n),null;case 3:return o=n.stateNode,Xf(),yr(Fa),yr(ia),Sk(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&($b(n)?n.flags|=4:e===null||e.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Fo!==null&&(Q1(Fo),Fo=null))),$1(e,n),Ji(n),null;case 5:bk(n);var l=ih(Sy.current);if(a=n.type,e!==null&&n.stateNode!=null)uX(e,n,a,o,l),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!o){if(n.stateNode===null)throw Error(Xe(166));return Ji(n),null}if(e=ih(Ic.current),$b(n)){o=n.stateNode,a=n.type;var p=n.memoizedProps;switch(o[Tc]=n,o[Ey]=p,e=(n.mode&1)!==0,a){case"dialog":mr("cancel",o),mr("close",o);break;case"iframe":case"object":case"embed":mr("load",o);break;case"video":case"audio":for(l=0;l<Kv.length;l++)mr(Kv[l],o);break;case"source":mr("error",o);break;case"img":case"image":case"link":mr("error",o),mr("load",o);break;case"details":mr("toggle",o);break;case"input":k$(o,p),mr("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!p.multiple},mr("invalid",o);break;case"textarea":j$(o,p),mr("invalid",o)}v1(a,p),l=null;for(var m in p)if(p.hasOwnProperty(m)){var y=p[m];m==="children"?typeof y=="string"?o.textContent!==y&&(p.suppressHydrationWarning!==!0&&Gb(o.textContent,y,e),l=["children",y]):typeof y=="number"&&o.textContent!==""+y&&(p.suppressHydrationWarning!==!0&&Gb(o.textContent,y,e),l=["children",""+y]):dy.hasOwnProperty(m)&&y!=null&&m==="onScroll"&&mr("scroll",o)}switch(a){case"input":Lb(o),L$(o,p,!0);break;case"textarea":Lb(o),M$(o);break;case"select":case"option":break;default:typeof p.onClick=="function"&&(o.onclick=FS)}o=l,n.updateQueue=o,o!==null&&(n.flags|=4)}else{m=l.nodeType===9?l:l.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=FY(a)),e==="http://www.w3.org/1999/xhtml"?a==="script"?(e=m.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=m.createElement(a,{is:o.is}):(e=m.createElement(a),a==="select"&&(m=e,o.multiple?m.multiple=!0:o.size&&(m.size=o.size))):e=m.createElementNS(e,a),e[Tc]=n,e[Ey]=o,dX(e,n,!1,!1),n.stateNode=e;e:{switch(m=y1(a,o),a){case"dialog":mr("cancel",e),mr("close",e),l=o;break;case"iframe":case"object":case"embed":mr("load",e),l=o;break;case"video":case"audio":for(l=0;l<Kv.length;l++)mr(Kv[l],e);l=o;break;case"source":mr("error",e),l=o;break;case"img":case"image":case"link":mr("error",e),mr("load",e),l=o;break;case"details":mr("toggle",e),l=o;break;case"input":k$(e,o),l=h1(e,o),mr("invalid",e);break;case"option":l=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},l=Mr({},o,{value:void 0}),mr("invalid",e);break;case"textarea":j$(e,o),l=m1(e,o),mr("invalid",e);break;default:l=o}v1(a,l),y=l;for(p in y)if(y.hasOwnProperty(p)){var E=y[p];p==="style"?GY(e,E):p==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,E!=null&&BY(e,E)):p==="children"?typeof E=="string"?(a!=="textarea"||E!=="")&&uy(e,E):typeof E=="number"&&uy(e,""+E):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(dy.hasOwnProperty(p)?E!=null&&p==="onScroll"&&mr("scroll",e):E!=null&&QD(e,p,E,m))}switch(a){case"input":Lb(e),L$(e,o,!1);break;case"textarea":Lb(e),M$(e);break;case"option":o.value!=null&&e.setAttribute("value",""+Ud(o.value));break;case"select":e.multiple=!!o.multiple,p=o.value,p!=null?kf(e,!!o.multiple,p,!1):o.defaultValue!=null&&kf(e,!!o.multiple,o.defaultValue,!0);break;default:typeof l.onClick=="function"&&(e.onclick=FS)}switch(a){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return Ji(n),null;case 6:if(e&&n.stateNode!=null)hX(e,n,e.memoizedProps,o);else{if(typeof o!="string"&&n.stateNode===null)throw Error(Xe(166));if(a=ih(Sy.current),ih(Ic.current),$b(n)){if(o=n.stateNode,a=n.memoizedProps,o[Tc]=n,(p=o.nodeValue!==a)&&(e=fs,e!==null))switch(e.tag){case 3:Gb(o.nodeValue,a,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Gb(o.nodeValue,a,(e.mode&1)!==0)}p&&(n.flags|=4)}else o=(a.nodeType===9?a:a.ownerDocument).createTextNode(o),o[Tc]=n,n.stateNode=o}return Ji(n),null;case 13:if(yr(Lr),o=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Cr&&ps!==null&&n.mode&1&&!(n.flags&128))Oq(),Yf(),n.flags|=98560,p=!1;else if(p=$b(n),o!==null&&o.dehydrated!==null){if(e===null){if(!p)throw Error(Xe(318));if(p=n.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(Xe(317));p[Tc]=n}else Yf(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;Ji(n),p=!1}else Fo!==null&&(Q1(Fo),Fo=null),p=!0;if(!p)return n.flags&65536?n:null}return n.flags&128?(n.lanes=a,n):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(n.child.flags|=8192,n.mode&1&&(e===null||Lr.current&1?ui===0&&(ui=3):kk())),n.updateQueue!==null&&(n.flags|=4),Ji(n),null);case 4:return Xf(),$1(e,n),e===null&&yy(n.stateNode.containerInfo),Ji(n),null;case 10:return vk(n.type._context),Ji(n),null;case 17:return Ba(n.type)&&BS(),Ji(n),null;case 19:if(yr(Lr),p=n.memoizedState,p===null)return Ji(n),null;if(o=(n.flags&128)!==0,m=p.rendering,m===null)if(o)Ov(p,!1);else{if(ui!==0||e!==null&&e.flags&128)for(e=n.child;e!==null;){if(m=YS(e),m!==null){for(n.flags|=128,Ov(p,!1),o=m.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),n.subtreeFlags=0,o=a,a=n.child;a!==null;)p=a,e=o,p.flags&=14680066,m=p.alternate,m===null?(p.childLanes=0,p.lanes=e,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=m.childLanes,p.lanes=m.lanes,p.child=m.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=m.memoizedProps,p.memoizedState=m.memoizedState,p.updateQueue=m.updateQueue,p.type=m.type,e=m.dependencies,p.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),a=a.sibling;return or(Lr,Lr.current&1|2),n.child}e=e.sibling}p.tail!==null&&Kr()>Qf&&(n.flags|=128,o=!0,Ov(p,!1),n.lanes=4194304)}else{if(!o)if(e=YS(m),e!==null){if(n.flags|=128,o=!0,a=e.updateQueue,a!==null&&(n.updateQueue=a,n.flags|=4),Ov(p,!0),p.tail===null&&p.tailMode==="hidden"&&!m.alternate&&!Cr)return Ji(n),null}else 2*Kr()-p.renderingStartTime>Qf&&a!==1073741824&&(n.flags|=128,o=!0,Ov(p,!1),n.lanes=4194304);p.isBackwards?(m.sibling=n.child,n.child=m):(a=p.last,a!==null?a.sibling=m:n.child=m,p.last=m)}return p.tail!==null?(n=p.tail,p.rendering=n,p.tail=n.sibling,p.renderingStartTime=Kr(),n.sibling=null,a=Lr.current,or(Lr,o?a&1|2:a&1),n):(Ji(n),null);case 22:case 23:return Dk(),o=n.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(n.flags|=8192),o&&n.mode&1?ls&1073741824&&(Ji(n),n.subtreeFlags&6&&(n.flags|=8192)):Ji(n),null;case 24:return null;case 25:return null}throw Error(Xe(156,n.tag))}function tbe(e,n){switch(pk(n),n.tag){case 1:return Ba(n.type)&&BS(),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Xf(),yr(Fa),yr(ia),Sk(),e=n.flags,e&65536&&!(e&128)?(n.flags=e&-65537|128,n):null;case 5:return bk(n),null;case 13:if(yr(Lr),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(Xe(340));Yf()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return yr(Lr),null;case 4:return Xf(),null;case 10:return vk(n.type._context),null;case 22:case 23:return Dk(),null;case 24:return null;default:return null}}var Kb=!1,ea=!1,nbe=typeof WeakSet=="function"?WeakSet:Set,yt=null;function Nf(e,n){var a=e.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(o){Wr(e,n,o)}else a.current=null}function H1(e,n,a){try{a()}catch(o){Wr(e,n,o)}}var CH=!1;function rbe(e,n){if(A1=MS,e=vq(),uk(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var l=o.anchorOffset,p=o.focusNode;o=o.focusOffset;try{a.nodeType,p.nodeType}catch{a=null;break e}var m=0,y=-1,E=-1,b=0,T=0,x=e,A=null;t:for(;;){for(var D;x!==a||l!==0&&x.nodeType!==3||(y=m+l),x!==p||o!==0&&x.nodeType!==3||(E=m+o),x.nodeType===3&&(m+=x.nodeValue.length),(D=x.firstChild)!==null;)A=x,x=D;for(;;){if(x===e)break t;if(A===a&&++b===l&&(y=m),A===p&&++T===o&&(E=m),(D=x.nextSibling)!==null)break;x=A,A=x.parentNode}x=D}a=y===-1||E===-1?null:{start:y,end:E}}else a=null}a=a||{start:0,end:0}}else a=null;for(N1={focusedElem:e,selectionRange:a},MS=!1,yt=n;yt!==null;)if(n=yt,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,yt=e;else for(;yt!==null;){n=yt;try{var N=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var L=N.memoizedProps,P=N.memoizedState,U=n.stateNode,V=U.getSnapshotBeforeUpdate(n.elementType===n.type?L:jo(n.type,L),P);U.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var F=n.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Xe(163))}}catch(H){Wr(n,n.return,H)}if(e=n.sibling,e!==null){e.return=n.return,yt=e;break}yt=n.return}return N=CH,CH=!1,N}function ny(e,n,a){var o=n.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var l=o=o.next;do{if((l.tag&e)===e){var p=l.destroy;l.destroy=void 0,p!==void 0&&H1(n,a,p)}l=l.next}while(l!==o)}}function bx(e,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var o=a.create;a.destroy=o()}a=a.next}while(a!==n)}}function z1(e){var n=e.ref;if(n!==null){var a=e.stateNode;switch(e.tag){case 5:e=a;break;default:e=a}typeof n=="function"?n(e):n.current=e}}function pX(e){var n=e.alternate;n!==null&&(e.alternate=null,pX(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&(delete n[Tc],delete n[Ey],delete n[P1],delete n[VEe],delete n[FEe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function fX(e){return e.tag===5||e.tag===3||e.tag===4}function RH(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||fX(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function K1(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.nodeType===8?a.parentNode.insertBefore(e,n):a.insertBefore(e,n):(a.nodeType===8?(n=a.parentNode,n.insertBefore(e,a)):(n=a,n.appendChild(e)),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=FS));else if(o!==4&&(e=e.child,e!==null))for(K1(e,n,a),e=e.sibling;e!==null;)K1(e,n,a),e=e.sibling}function Y1(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.insertBefore(e,n):a.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(Y1(e,n,a),e=e.sibling;e!==null;)Y1(e,n,a),e=e.sibling}var Ui=null,Mo=!1;function ud(e,n,a){for(a=a.child;a!==null;)mX(e,n,a),a=a.sibling}function mX(e,n,a){if(Oc&&typeof Oc.onCommitFiberUnmount=="function")try{Oc.onCommitFiberUnmount(px,a)}catch{}switch(a.tag){case 5:ea||Nf(a,n);case 6:var o=Ui,l=Mo;Ui=null,ud(e,n,a),Ui=o,Mo=l,Ui!==null&&(Mo?(e=Ui,a=a.stateNode,e.nodeType===8?e.parentNode.removeChild(a):e.removeChild(a)):Ui.removeChild(a.stateNode));break;case 18:Ui!==null&&(Mo?(e=Ui,a=a.stateNode,e.nodeType===8?hI(e.parentNode,a):e.nodeType===1&&hI(e,a),my(e)):hI(Ui,a.stateNode));break;case 4:o=Ui,l=Mo,Ui=a.stateNode.containerInfo,Mo=!0,ud(e,n,a),Ui=o,Mo=l;break;case 0:case 11:case 14:case 15:if(!ea&&(o=a.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){l=o=o.next;do{var p=l,m=p.destroy;p=p.tag,m!==void 0&&(p&2||p&4)&&H1(a,n,m),l=l.next}while(l!==o)}ud(e,n,a);break;case 1:if(!ea&&(Nf(a,n),o=a.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=a.memoizedProps,o.state=a.memoizedState,o.componentWillUnmount()}catch(y){Wr(a,n,y)}ud(e,n,a);break;case 21:ud(e,n,a);break;case 22:a.mode&1?(ea=(o=ea)||a.memoizedState!==null,ud(e,n,a),ea=o):ud(e,n,a);break;default:ud(e,n,a)}}function AH(e){var n=e.updateQueue;if(n!==null){e.updateQueue=null;var a=e.stateNode;a===null&&(a=e.stateNode=new nbe),n.forEach(function(o){var l=hbe.bind(null,e,o);a.has(o)||(a.add(o),o.then(l,l))})}}function Po(e,n){var a=n.deletions;if(a!==null)for(var o=0;o<a.length;o++){var l=a[o];try{var p=e,m=n,y=m;e:for(;y!==null;){switch(y.tag){case 5:Ui=y.stateNode,Mo=!1;break e;case 3:Ui=y.stateNode.containerInfo,Mo=!0;break e;case 4:Ui=y.stateNode.containerInfo,Mo=!0;break e}y=y.return}if(Ui===null)throw Error(Xe(160));mX(p,m,l),Ui=null,Mo=!1;var E=l.alternate;E!==null&&(E.return=null),l.return=null}catch(b){Wr(l,n,b)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)gX(n,e),n=n.sibling}function gX(e,n){var a=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Po(n,e),bc(e),o&4){try{ny(3,e,e.return),bx(3,e)}catch(L){Wr(e,e.return,L)}try{ny(5,e,e.return)}catch(L){Wr(e,e.return,L)}}break;case 1:Po(n,e),bc(e),o&512&&a!==null&&Nf(a,a.return);break;case 5:if(Po(n,e),bc(e),o&512&&a!==null&&Nf(a,a.return),e.flags&32){var l=e.stateNode;try{uy(l,"")}catch(L){Wr(e,e.return,L)}}if(o&4&&(l=e.stateNode,l!=null)){var p=e.memoizedProps,m=a!==null?a.memoizedProps:p,y=e.type,E=e.updateQueue;if(e.updateQueue=null,E!==null)try{y==="input"&&p.type==="radio"&&p.name!=null&&UY(l,p),y1(y,m);var b=y1(y,p);for(m=0;m<E.length;m+=2){var T=E[m],x=E[m+1];T==="style"?GY(l,x):T==="dangerouslySetInnerHTML"?BY(l,x):T==="children"?uy(l,x):QD(l,T,x,b)}switch(y){case"input":p1(l,p);break;case"textarea":VY(l,p);break;case"select":var A=l._wrapperState.wasMultiple;l._wrapperState.wasMultiple=!!p.multiple;var D=p.value;D!=null?kf(l,!!p.multiple,D,!1):A!==!!p.multiple&&(p.defaultValue!=null?kf(l,!!p.multiple,p.defaultValue,!0):kf(l,!!p.multiple,p.multiple?[]:"",!1))}l[Ey]=p}catch(L){Wr(e,e.return,L)}}break;case 6:if(Po(n,e),bc(e),o&4){if(e.stateNode===null)throw Error(Xe(162));l=e.stateNode,p=e.memoizedProps;try{l.nodeValue=p}catch(L){Wr(e,e.return,L)}}break;case 3:if(Po(n,e),bc(e),o&4&&a!==null&&a.memoizedState.isDehydrated)try{my(n.containerInfo)}catch(L){Wr(e,e.return,L)}break;case 4:Po(n,e),bc(e);break;case 13:Po(n,e),bc(e),l=e.child,l.flags&8192&&(p=l.memoizedState!==null,l.stateNode.isHidden=p,!p||l.alternate!==null&&l.alternate.memoizedState!==null||(Ik=Kr())),o&4&&AH(e);break;case 22:if(T=a!==null&&a.memoizedState!==null,e.mode&1?(ea=(b=ea)||T,Po(n,e),ea=b):Po(n,e),bc(e),o&8192){if(b=e.memoizedState!==null,(e.stateNode.isHidden=b)&&!T&&e.mode&1)for(yt=e,T=e.child;T!==null;){for(x=yt=T;yt!==null;){switch(A=yt,D=A.child,A.tag){case 0:case 11:case 14:case 15:ny(4,A,A.return);break;case 1:Nf(A,A.return);var N=A.stateNode;if(typeof N.componentWillUnmount=="function"){o=A,a=A.return;try{n=o,N.props=n.memoizedProps,N.state=n.memoizedState,N.componentWillUnmount()}catch(L){Wr(o,a,L)}}break;case 5:Nf(A,A.return);break;case 22:if(A.memoizedState!==null){OH(x);continue}}D!==null?(D.return=A,yt=D):OH(x)}T=T.sibling}e:for(T=null,x=e;;){if(x.tag===5){if(T===null){T=x;try{l=x.stateNode,b?(p=l.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none"):(y=x.stateNode,E=x.memoizedProps.style,m=E!=null&&E.hasOwnProperty("display")?E.display:null,y.style.display=WY("display",m))}catch(L){Wr(e,e.return,L)}}}else if(x.tag===6){if(T===null)try{x.stateNode.nodeValue=b?"":x.memoizedProps}catch(L){Wr(e,e.return,L)}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===e)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===e)break e;for(;x.sibling===null;){if(x.return===null||x.return===e)break e;T===x&&(T=null),x=x.return}T===x&&(T=null),x.sibling.return=x.return,x=x.sibling}}break;case 19:Po(n,e),bc(e),o&4&&AH(e);break;case 21:break;default:Po(n,e),bc(e)}}function bc(e){var n=e.flags;if(n&2){try{e:{for(var a=e.return;a!==null;){if(fX(a)){var o=a;break e}a=a.return}throw Error(Xe(160))}switch(o.tag){case 5:var l=o.stateNode;o.flags&32&&(uy(l,""),o.flags&=-33);var p=RH(e);Y1(e,p,l);break;case 3:case 4:var m=o.stateNode.containerInfo,y=RH(e);K1(e,y,m);break;default:throw Error(Xe(161))}}catch(E){Wr(e,e.return,E)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function ibe(e,n,a){yt=e,vX(e)}function vX(e,n,a){for(var o=(e.mode&1)!==0;yt!==null;){var l=yt,p=l.child;if(l.tag===22&&o){var m=l.memoizedState!==null||Kb;if(!m){var y=l.alternate,E=y!==null&&y.memoizedState!==null||ea;y=Kb;var b=ea;if(Kb=m,(ea=E)&&!b)for(yt=l;yt!==null;)m=yt,E=m.child,m.tag===22&&m.memoizedState!==null?IH(l):E!==null?(E.return=m,yt=E):IH(l);for(;p!==null;)yt=p,vX(p),p=p.sibling;yt=l,Kb=y,ea=b}NH(e)}else l.subtreeFlags&8772&&p!==null?(p.return=l,yt=p):NH(e)}}function NH(e){for(;yt!==null;){var n=yt;if(n.flags&8772){var a=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:ea||bx(5,n);break;case 1:var o=n.stateNode;if(n.flags&4&&!ea)if(a===null)o.componentDidMount();else{var l=n.elementType===n.type?a.memoizedProps:jo(n.type,a.memoizedProps);o.componentDidUpdate(l,a.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var p=n.updateQueue;p!==null&&pH(n,p,o);break;case 3:var m=n.updateQueue;if(m!==null){if(a=null,n.child!==null)switch(n.child.tag){case 5:a=n.child.stateNode;break;case 1:a=n.child.stateNode}pH(n,m,a)}break;case 5:var y=n.stateNode;if(a===null&&n.flags&4){a=y;var E=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":E.autoFocus&&a.focus();break;case"img":E.src&&(a.src=E.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var b=n.alternate;if(b!==null){var T=b.memoizedState;if(T!==null){var x=T.dehydrated;x!==null&&my(x)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Xe(163))}ea||n.flags&512&&z1(n)}catch(A){Wr(n,n.return,A)}}if(n===e){yt=null;break}if(a=n.sibling,a!==null){a.return=n.return,yt=a;break}yt=n.return}}function OH(e){for(;yt!==null;){var n=yt;if(n===e){yt=null;break}var a=n.sibling;if(a!==null){a.return=n.return,yt=a;break}yt=n.return}}function IH(e){for(;yt!==null;){var n=yt;try{switch(n.tag){case 0:case 11:case 15:var a=n.return;try{bx(4,n)}catch(E){Wr(n,a,E)}break;case 1:var o=n.stateNode;if(typeof o.componentDidMount=="function"){var l=n.return;try{o.componentDidMount()}catch(E){Wr(n,l,E)}}var p=n.return;try{z1(n)}catch(E){Wr(n,p,E)}break;case 5:var m=n.return;try{z1(n)}catch(E){Wr(n,m,E)}}}catch(E){Wr(n,n.return,E)}if(n===e){yt=null;break}var y=n.sibling;if(y!==null){y.return=n.return,yt=y;break}yt=n.return}}var abe=Math.ceil,JS=Cl.ReactCurrentDispatcher,Nk=Cl.ReactCurrentOwner,Xs=Cl.ReactCurrentBatchConfig,In=0,Ti=null,ti=null,Bi=0,ls=0,Of=Gd(0),ui=0,Cy=null,wh=0,Sx=0,Ok=0,ry=null,ja=null,Ik=0,Qf=1/0,il=null,QS=!1,q1=null,Pd=null,Yb=!1,wd=null,ZS=0,iy=0,X1=null,wS=-1,xS=0;function ma(){return In&6?Kr():wS!==-1?wS:wS=Kr()}function Dd(e){return e.mode&1?In&2&&Bi!==0?Bi&-Bi:WEe.transition!==null?(xS===0&&(xS=tq()),xS):(e=$n,e!==0||(e=window.event,e=e===void 0?16:cq(e.type)),e):1}function Ho(e,n,a,o){if(50<iy)throw iy=0,X1=null,Error(Xe(185));f_(e,a,o),(!(In&2)||e!==Ti)&&(e===Ti&&(!(In&2)&&(Sx|=a),ui===4&&vd(e,Bi)),Wa(e,o),a===1&&In===0&&!(n.mode&1)&&(Qf=Kr()+500,yx&&$d()))}function Wa(e,n){var a=e.callbackNode;W0e(e,n);var o=jS(e,e===Ti?Bi:0);if(o===0)a!==null&&F$(a),e.callbackNode=null,e.callbackPriority=0;else if(n=o&-o,e.callbackPriority!==n){if(a!=null&&F$(a),n===1)e.tag===0?BEe(PH.bind(null,e)):Rq(PH.bind(null,e)),MEe(function(){!(In&6)&&$d()}),a=null;else{switch(nq(o)){case 1:a=rk;break;case 4:a=ZY;break;case 16:a=LS;break;case 536870912:a=eq;break;default:a=LS}a=TX(a,yX.bind(null,e))}e.callbackPriority=n,e.callbackNode=a}}function yX(e,n){if(wS=-1,xS=0,In&6)throw Error(Xe(327));var a=e.callbackNode;if(Vf()&&e.callbackNode!==a)return null;var o=jS(e,e===Ti?Bi:0);if(o===0)return null;if(o&30||o&e.expiredLanes||n)n=ew(e,o);else{n=o;var l=In;In|=2;var p=EX();(Ti!==e||Bi!==n)&&(il=null,Qf=Kr()+500,hh(e,n));do try{cbe();break}catch(y){_X(e,y)}while(!0);gk(),JS.current=p,In=l,ti!==null?n=0:(Ti=null,Bi=0,n=ui)}if(n!==0){if(n===2&&(l=w1(e),l!==0&&(o=l,n=J1(e,l))),n===1)throw a=Cy,hh(e,0),vd(e,o),Wa(e,Kr()),a;if(n===6)vd(e,o);else{if(l=e.current.alternate,!(o&30)&&!sbe(l)&&(n=ew(e,o),n===2&&(p=w1(e),p!==0&&(o=p,n=J1(e,p))),n===1))throw a=Cy,hh(e,0),vd(e,o),Wa(e,Kr()),a;switch(e.finishedWork=l,e.finishedLanes=o,n){case 0:case 1:throw Error(Xe(345));case 2:Xu(e,ja,il);break;case 3:if(vd(e,o),(o&130023424)===o&&(n=Ik+500-Kr(),10<n)){if(jS(e,0)!==0)break;if(l=e.suspendedLanes,(l&o)!==o){ma(),e.pingedLanes|=e.suspendedLanes&l;break}e.timeoutHandle=I1(Xu.bind(null,e,ja,il),n);break}Xu(e,ja,il);break;case 4:if(vd(e,o),(o&4194240)===o)break;for(n=e.eventTimes,l=-1;0<o;){var m=31-$o(o);p=1<<m,m=n[m],m>l&&(l=m),o&=~p}if(o=l,o=Kr()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*abe(o/1960))-o,10<o){e.timeoutHandle=I1(Xu.bind(null,e,ja,il),o);break}Xu(e,ja,il);break;case 5:Xu(e,ja,il);break;default:throw Error(Xe(329))}}}return Wa(e,Kr()),e.callbackNode===a?yX.bind(null,e):null}function J1(e,n){var a=ry;return e.current.memoizedState.isDehydrated&&(hh(e,n).flags|=256),e=ew(e,n),e!==2&&(n=ja,ja=a,n!==null&&Q1(n)),e}function Q1(e){ja===null?ja=e:ja.push.apply(ja,e)}function sbe(e){for(var n=e;;){if(n.flags&16384){var a=n.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var o=0;o<a.length;o++){var l=a[o],p=l.getSnapshot;l=l.value;try{if(!Ko(p(),l))return!1}catch{return!1}}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function vd(e,n){for(n&=~Ok,n&=~Sx,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var a=31-$o(n),o=1<<a;e[a]=-1,n&=~o}}function PH(e){if(In&6)throw Error(Xe(327));Vf();var n=jS(e,0);if(!(n&1))return Wa(e,Kr()),null;var a=ew(e,n);if(e.tag!==0&&a===2){var o=w1(e);o!==0&&(n=o,a=J1(e,o))}if(a===1)throw a=Cy,hh(e,0),vd(e,n),Wa(e,Kr()),a;if(a===6)throw Error(Xe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,Xu(e,ja,il),Wa(e,Kr()),null}function Pk(e,n){var a=In;In|=1;try{return e(n)}finally{In=a,In===0&&(Qf=Kr()+500,yx&&$d())}}function xh(e){wd!==null&&wd.tag===0&&!(In&6)&&Vf();var n=In;In|=1;var a=Xs.transition,o=$n;try{if(Xs.transition=null,$n=1,e)return e()}finally{$n=o,Xs.transition=a,In=n,!(In&6)&&$d()}}function Dk(){ls=Of.current,yr(Of)}function hh(e,n){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;if(a!==-1&&(e.timeoutHandle=-1,jEe(a)),ti!==null)for(a=ti.return;a!==null;){var o=a;switch(pk(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&BS();break;case 3:Xf(),yr(Fa),yr(ia),Sk();break;case 5:bk(o);break;case 4:Xf();break;case 13:yr(Lr);break;case 19:yr(Lr);break;case 10:vk(o.type._context);break;case 22:case 23:Dk()}a=a.return}if(Ti=e,ti=e=kd(e.current,null),Bi=ls=n,ui=0,Cy=null,Ok=Sx=wh=0,ja=ry=null,rh!==null){for(n=0;n<rh.length;n++)if(a=rh[n],o=a.interleaved,o!==null){a.interleaved=null;var l=o.next,p=a.pending;if(p!==null){var m=p.next;p.next=l,o.next=m}a.pending=o}rh=null}return e}function _X(e,n){do{var a=ti;try{if(gk(),ES.current=XS,qS){for(var o=jr.memoizedState;o!==null;){var l=o.queue;l!==null&&(l.pending=null),o=o.next}qS=!1}if(Sh=0,xi=li=jr=null,ty=!1,wy=0,Nk.current=null,a===null||a.return===null){ui=1,Cy=n,ti=null;break}e:{var p=e,m=a.return,y=a,E=n;if(n=Bi,y.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){var b=E,T=y,x=T.tag;if(!(T.mode&1)&&(x===0||x===11||x===15)){var A=T.alternate;A?(T.updateQueue=A.updateQueue,T.memoizedState=A.memoizedState,T.lanes=A.lanes):(T.updateQueue=null,T.memoizedState=null)}var D=_H(m);if(D!==null){D.flags&=-257,EH(D,m,y,p,n),D.mode&1&&yH(p,b,n),n=D,E=b;var N=n.updateQueue;if(N===null){var L=new Set;L.add(E),n.updateQueue=L}else N.add(E);break e}else{if(!(n&1)){yH(p,b,n),kk();break e}E=Error(Xe(426))}}else if(Cr&&y.mode&1){var P=_H(m);if(P!==null){!(P.flags&65536)&&(P.flags|=256),EH(P,m,y,p,n),fk(Jf(E,y));break e}}p=E=Jf(E,y),ui!==4&&(ui=2),ry===null?ry=[p]:ry.push(p),p=m;do{switch(p.tag){case 3:p.flags|=65536,n&=-n,p.lanes|=n;var U=nX(p,E,n);hH(p,U);break e;case 1:y=E;var V=p.type,F=p.stateNode;if(!(p.flags&128)&&(typeof V.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(Pd===null||!Pd.has(F)))){p.flags|=65536,n&=-n,p.lanes|=n;var H=rX(p,y,n);hH(p,H);break e}}p=p.return}while(p!==null)}SX(a)}catch(B){n=B,ti===a&&a!==null&&(ti=a=a.return);continue}break}while(!0)}function EX(){var e=JS.current;return JS.current=XS,e===null?XS:e}function kk(){(ui===0||ui===3||ui===2)&&(ui=4),Ti===null||!(wh&268435455)&&!(Sx&268435455)||vd(Ti,Bi)}function ew(e,n){var a=In;In|=2;var o=EX();(Ti!==e||Bi!==n)&&(il=null,hh(e,n));do try{obe();break}catch(l){_X(e,l)}while(!0);if(gk(),In=a,JS.current=o,ti!==null)throw Error(Xe(261));return Ti=null,Bi=0,ui}function obe(){for(;ti!==null;)bX(ti)}function cbe(){for(;ti!==null&&!D0e();)bX(ti)}function bX(e){var n=xX(e.alternate,e,ls);e.memoizedProps=e.pendingProps,n===null?SX(e):ti=n,Nk.current=null}function SX(e){var n=e;do{var a=n.alternate;if(e=n.return,n.flags&32768){if(a=tbe(a,n),a!==null){a.flags&=32767,ti=a;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ui=6,ti=null;return}}else if(a=ebe(a,n,ls),a!==null){ti=a;return}if(n=n.sibling,n!==null){ti=n;return}ti=n=e}while(n!==null);ui===0&&(ui=5)}function Xu(e,n,a){var o=$n,l=Xs.transition;try{Xs.transition=null,$n=1,lbe(e,n,a,o)}finally{Xs.transition=l,$n=o}return null}function lbe(e,n,a,o){do Vf();while(wd!==null);if(In&6)throw Error(Xe(327));a=e.finishedWork;var l=e.finishedLanes;if(a===null)return null;if(e.finishedWork=null,e.finishedLanes=0,a===e.current)throw Error(Xe(177));e.callbackNode=null,e.callbackPriority=0;var p=a.lanes|a.childLanes;if(G0e(e,p),e===Ti&&(ti=Ti=null,Bi=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Yb||(Yb=!0,TX(LS,function(){return Vf(),null})),p=(a.flags&15990)!==0,a.subtreeFlags&15990||p){p=Xs.transition,Xs.transition=null;var m=$n;$n=1;var y=In;In|=4,Nk.current=null,rbe(e,a),gX(a,e),NEe(N1),MS=!!A1,N1=A1=null,e.current=a,ibe(a),k0e(),In=y,$n=m,Xs.transition=p}else e.current=a;if(Yb&&(Yb=!1,wd=e,ZS=l),p=e.pendingLanes,p===0&&(Pd=null),M0e(a.stateNode),Wa(e,Kr()),n!==null)for(o=e.onRecoverableError,a=0;a<n.length;a++)l=n[a],o(l.value,{componentStack:l.stack,digest:l.digest});if(QS)throw QS=!1,e=q1,q1=null,e;return ZS&1&&e.tag!==0&&Vf(),p=e.pendingLanes,p&1?e===X1?iy++:(iy=0,X1=e):iy=0,$d(),null}function Vf(){if(wd!==null){var e=nq(ZS),n=Xs.transition,a=$n;try{if(Xs.transition=null,$n=16>e?16:e,wd===null)var o=!1;else{if(e=wd,wd=null,ZS=0,In&6)throw Error(Xe(331));var l=In;for(In|=4,yt=e.current;yt!==null;){var p=yt,m=p.child;if(yt.flags&16){var y=p.deletions;if(y!==null){for(var E=0;E<y.length;E++){var b=y[E];for(yt=b;yt!==null;){var T=yt;switch(T.tag){case 0:case 11:case 15:ny(8,T,p)}var x=T.child;if(x!==null)x.return=T,yt=x;else for(;yt!==null;){T=yt;var A=T.sibling,D=T.return;if(pX(T),T===b){yt=null;break}if(A!==null){A.return=D,yt=A;break}yt=D}}}var N=p.alternate;if(N!==null){var L=N.child;if(L!==null){N.child=null;do{var P=L.sibling;L.sibling=null,L=P}while(L!==null)}}yt=p}}if(p.subtreeFlags&2064&&m!==null)m.return=p,yt=m;else e:for(;yt!==null;){if(p=yt,p.flags&2048)switch(p.tag){case 0:case 11:case 15:ny(9,p,p.return)}var U=p.sibling;if(U!==null){U.return=p.return,yt=U;break e}yt=p.return}}var V=e.current;for(yt=V;yt!==null;){m=yt;var F=m.child;if(m.subtreeFlags&2064&&F!==null)F.return=m,yt=F;else e:for(m=V;yt!==null;){if(y=yt,y.flags&2048)try{switch(y.tag){case 0:case 11:case 15:bx(9,y)}}catch(B){Wr(y,y.return,B)}if(y===m){yt=null;break e}var H=y.sibling;if(H!==null){H.return=y.return,yt=H;break e}yt=y.return}}if(In=l,$d(),Oc&&typeof Oc.onPostCommitFiberRoot=="function")try{Oc.onPostCommitFiberRoot(px,e)}catch{}o=!0}return o}finally{$n=a,Xs.transition=n}}return!1}function DH(e,n,a){n=Jf(a,n),n=nX(e,n,1),e=Id(e,n,1),n=ma(),e!==null&&(f_(e,1,n),Wa(e,n))}function Wr(e,n,a){if(e.tag===3)DH(e,e,a);else for(;n!==null;){if(n.tag===3){DH(n,e,a);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(Pd===null||!Pd.has(o))){e=Jf(a,e),e=rX(n,e,1),n=Id(n,e,1),e=ma(),n!==null&&(f_(n,1,e),Wa(n,e));break}}n=n.return}}function dbe(e,n,a){var o=e.pingCache;o!==null&&o.delete(n),n=ma(),e.pingedLanes|=e.suspendedLanes&a,Ti===e&&(Bi&a)===a&&(ui===4||ui===3&&(Bi&130023424)===Bi&&500>Kr()-Ik?hh(e,0):Ok|=a),Wa(e,n)}function wX(e,n){n===0&&(e.mode&1?(n=Ub,Ub<<=1,!(Ub&130023424)&&(Ub=4194304)):n=1);var a=ma();e=yl(e,n),e!==null&&(f_(e,n,a),Wa(e,a))}function ube(e){var n=e.memoizedState,a=0;n!==null&&(a=n.retryLane),wX(e,a)}function hbe(e,n){var a=0;switch(e.tag){case 13:var o=e.stateNode,l=e.memoizedState;l!==null&&(a=l.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(Xe(314))}o!==null&&o.delete(n),wX(e,a)}var xX;xX=function(e,n,a){if(e!==null)if(e.memoizedProps!==n.pendingProps||Fa.current)Ma=!0;else{if(!(e.lanes&a)&&!(n.flags&128))return Ma=!1,ZEe(e,n,a);Ma=!!(e.flags&131072)}else Ma=!1,Cr&&n.flags&1048576&&Aq(n,$S,n.index);switch(n.lanes=0,n.tag){case 2:var o=n.type;SS(e,n),e=n.pendingProps;var l=Kf(n,ia.current);Uf(n,a),l=xk(null,n,o,e,l,a);var p=Tk();return n.flags|=1,typeof l=="object"&&l!==null&&typeof l.render=="function"&&l.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Ba(o)?(p=!0,WS(n)):p=!1,n.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,_k(n),l.updater=Ex,n.stateNode=l,l._reactInternals=n,U1(n,o,e,a),n=B1(null,n,o,!0,p,a)):(n.tag=0,Cr&&p&&hk(n),pa(null,n,l,a),n=n.child),n;case 16:o=n.elementType;e:{switch(SS(e,n),e=n.pendingProps,l=o._init,o=l(o._payload),n.type=o,l=n.tag=fbe(o),e=jo(o,e),l){case 0:n=F1(null,n,o,e,a);break e;case 1:n=wH(null,n,o,e,a);break e;case 11:n=bH(null,n,o,e,a);break e;case 14:n=SH(null,n,o,jo(o.type,e),a);break e}throw Error(Xe(306,o,""))}return n;case 0:return o=n.type,l=n.pendingProps,l=n.elementType===o?l:jo(o,l),F1(e,n,o,l,a);case 1:return o=n.type,l=n.pendingProps,l=n.elementType===o?l:jo(o,l),wH(e,n,o,l,a);case 3:e:{if(oX(n),e===null)throw Error(Xe(387));o=n.pendingProps,p=n.memoizedState,l=p.element,kq(e,n),KS(n,o,null,a);var m=n.memoizedState;if(o=m.element,p.isDehydrated)if(p={element:o,isDehydrated:!1,cache:m.cache,pendingSuspenseBoundaries:m.pendingSuspenseBoundaries,transitions:m.transitions},n.updateQueue.baseState=p,n.memoizedState=p,n.flags&256){l=Jf(Error(Xe(423)),n),n=xH(e,n,o,a,l);break e}else if(o!==l){l=Jf(Error(Xe(424)),n),n=xH(e,n,o,a,l);break e}else for(ps=Od(n.stateNode.containerInfo.firstChild),fs=n,Cr=!0,Fo=null,a=Pq(n,null,o,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Yf(),o===l){n=_l(e,n,a);break e}pa(e,n,o,a)}n=n.child}return n;case 5:return Lq(n),e===null&&L1(n),o=n.type,l=n.pendingProps,p=e!==null?e.memoizedProps:null,m=l.children,O1(o,l)?m=null:p!==null&&O1(o,p)&&(n.flags|=32),sX(e,n),pa(e,n,m,a),n.child;case 6:return e===null&&L1(n),null;case 13:return cX(e,n,a);case 4:return Ek(n,n.stateNode.containerInfo),o=n.pendingProps,e===null?n.child=qf(n,null,o,a):pa(e,n,o,a),n.child;case 11:return o=n.type,l=n.pendingProps,l=n.elementType===o?l:jo(o,l),bH(e,n,o,l,a);case 7:return pa(e,n,n.pendingProps,a),n.child;case 8:return pa(e,n,n.pendingProps.children,a),n.child;case 12:return pa(e,n,n.pendingProps.children,a),n.child;case 10:e:{if(o=n.type._context,l=n.pendingProps,p=n.memoizedProps,m=l.value,or(HS,o._currentValue),o._currentValue=m,p!==null)if(Ko(p.value,m)){if(p.children===l.children&&!Fa.current){n=_l(e,n,a);break e}}else for(p=n.child,p!==null&&(p.return=n);p!==null;){var y=p.dependencies;if(y!==null){m=p.child;for(var E=y.firstContext;E!==null;){if(E.context===o){if(p.tag===1){E=ul(-1,a&-a),E.tag=2;var b=p.updateQueue;if(b!==null){b=b.shared;var T=b.pending;T===null?E.next=E:(E.next=T.next,T.next=E),b.pending=E}}p.lanes|=a,E=p.alternate,E!==null&&(E.lanes|=a),j1(p.return,a,n),y.lanes|=a;break}E=E.next}}else if(p.tag===10)m=p.type===n.type?null:p.child;else if(p.tag===18){if(m=p.return,m===null)throw Error(Xe(341));m.lanes|=a,y=m.alternate,y!==null&&(y.lanes|=a),j1(m,a,n),m=p.sibling}else m=p.child;if(m!==null)m.return=p;else for(m=p;m!==null;){if(m===n){m=null;break}if(p=m.sibling,p!==null){p.return=m.return,m=p;break}m=m.return}p=m}pa(e,n,l.children,a),n=n.child}return n;case 9:return l=n.type,o=n.pendingProps.children,Uf(n,a),l=Zs(l),o=o(l),n.flags|=1,pa(e,n,o,a),n.child;case 14:return o=n.type,l=jo(o,n.pendingProps),l=jo(o.type,l),SH(e,n,o,l,a);case 15:return iX(e,n,n.type,n.pendingProps,a);case 17:return o=n.type,l=n.pendingProps,l=n.elementType===o?l:jo(o,l),SS(e,n),n.tag=1,Ba(o)?(e=!0,WS(n)):e=!1,Uf(n,a),tX(n,o,l),U1(n,o,l,a),B1(null,n,o,!0,e,a);case 19:return lX(e,n,a);case 22:return aX(e,n,a)}throw Error(Xe(156,n.tag))};function TX(e,n){return QY(e,n)}function pbe(e,n,a,o){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ys(e,n,a,o){return new pbe(e,n,a,o)}function Lk(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fbe(e){if(typeof e=="function")return Lk(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ek)return 11;if(e===tk)return 14}return 2}function kd(e,n){var a=e.alternate;return a===null?(a=Ys(e.tag,n,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=n,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&14680064,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,n=e.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a}function TS(e,n,a,o,l,p){var m=2;if(o=e,typeof e=="function")Lk(e)&&(m=1);else if(typeof e=="string")m=5;else e:switch(e){case Ef:return ph(a.children,l,p,n);case ZD:m=8,l|=8;break;case c1:return e=Ys(12,a,n,l|2),e.elementType=c1,e.lanes=p,e;case l1:return e=Ys(13,a,n,l),e.elementType=l1,e.lanes=p,e;case d1:return e=Ys(19,a,n,l),e.elementType=d1,e.lanes=p,e;case LY:return wx(a,l,p,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case DY:m=10;break e;case kY:m=9;break e;case ek:m=11;break e;case tk:m=14;break e;case pd:m=16,o=null;break e}throw Error(Xe(130,e==null?e:typeof e,""))}return n=Ys(m,a,n,l),n.elementType=e,n.type=o,n.lanes=p,n}function ph(e,n,a,o){return e=Ys(7,e,o,n),e.lanes=a,e}function wx(e,n,a,o){return e=Ys(22,e,o,n),e.elementType=LY,e.lanes=a,e.stateNode={isHidden:!1},e}function EI(e,n,a){return e=Ys(6,e,null,n),e.lanes=a,e}function bI(e,n,a){return n=Ys(4,e.children!==null?e.children:[],e.key,n),n.lanes=a,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function mbe(e,n,a,o,l){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tI(0),this.expirationTimes=tI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tI(0),this.identifierPrefix=o,this.onRecoverableError=l,this.mutableSourceEagerHydrationData=null}function jk(e,n,a,o,l,p,m,y,E){return e=new mbe(e,n,a,y,E),n===1?(n=1,p===!0&&(n|=8)):n=0,p=Ys(3,null,null,n),e.current=p,p.stateNode=e,p.memoizedState={element:o,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},_k(p),e}function gbe(e,n,a){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_f,key:o==null?null:""+o,children:e,containerInfo:n,implementation:a}}function CX(e){if(!e)return Vd;e=e._reactInternals;e:{if(Dh(e)!==e||e.tag!==1)throw Error(Xe(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Ba(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(Xe(171))}if(e.tag===1){var a=e.type;if(Ba(a))return Cq(e,a,n)}return n}function RX(e,n,a,o,l,p,m,y,E){return e=jk(a,o,!0,e,l,p,m,y,E),e.context=CX(null),a=e.current,o=ma(),l=Dd(a),p=ul(o,l),p.callback=n??null,Id(a,p,l),e.current.lanes=l,f_(e,l,o),Wa(e,o),e}function xx(e,n,a,o){var l=n.current,p=ma(),m=Dd(l);return a=CX(a),n.context===null?n.context=a:n.pendingContext=a,n=ul(p,m),n.payload={element:e},o=o===void 0?null:o,o!==null&&(n.callback=o),e=Id(l,n,m),e!==null&&(Ho(e,l,m,p),_S(e,l,m)),m}function tw(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function kH(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<n?a:n}}function Mk(e,n){kH(e,n),(e=e.alternate)&&kH(e,n)}function vbe(){return null}var AX=typeof reportError=="function"?reportError:function(e){console.error(e)};function Uk(e){this._internalRoot=e}Tx.prototype.render=Uk.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(Xe(409));xx(e,n,null,null)};Tx.prototype.unmount=Uk.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;xh(function(){xx(null,e,null,null)}),n[vl]=null}};function Tx(e){this._internalRoot=e}Tx.prototype.unstable_scheduleHydration=function(e){if(e){var n=aq();e={blockedOn:null,target:e,priority:n};for(var a=0;a<gd.length&&n!==0&&n<gd[a].priority;a++);gd.splice(a,0,e),a===0&&oq(e)}};function Vk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Cx(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function LH(){}function ybe(e,n,a,o,l){if(l){if(typeof o=="function"){var p=o;o=function(){var b=tw(m);p.call(b)}}var m=RX(n,o,e,0,null,!1,!1,"",LH);return e._reactRootContainer=m,e[vl]=m.current,yy(e.nodeType===8?e.parentNode:e),xh(),m}for(;l=e.lastChild;)e.removeChild(l);if(typeof o=="function"){var y=o;o=function(){var b=tw(E);y.call(b)}}var E=jk(e,0,!1,null,null,!1,!1,"",LH);return e._reactRootContainer=E,e[vl]=E.current,yy(e.nodeType===8?e.parentNode:e),xh(function(){xx(n,E,a,o)}),E}function Rx(e,n,a,o,l){var p=a._reactRootContainer;if(p){var m=p;if(typeof l=="function"){var y=l;l=function(){var E=tw(m);y.call(E)}}xx(n,m,e,l)}else m=ybe(a,n,e,l,o);return tw(m)}rq=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var a=zv(n.pendingLanes);a!==0&&(ik(n,a|1),Wa(n,Kr()),!(In&6)&&(Qf=Kr()+500,$d()))}break;case 13:xh(function(){var o=yl(e,1);if(o!==null){var l=ma();Ho(o,e,1,l)}}),Mk(e,1)}};ak=function(e){if(e.tag===13){var n=yl(e,134217728);if(n!==null){var a=ma();Ho(n,e,134217728,a)}Mk(e,134217728)}};iq=function(e){if(e.tag===13){var n=Dd(e),a=yl(e,n);if(a!==null){var o=ma();Ho(a,e,n,o)}Mk(e,n)}};aq=function(){return $n};sq=function(e,n){var a=$n;try{return $n=e,n()}finally{$n=a}};E1=function(e,n,a){switch(n){case"input":if(p1(e,a),n=a.name,a.type==="radio"&&n!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<a.length;n++){var o=a[n];if(o!==e&&o.form===e.form){var l=vx(o);if(!l)throw Error(Xe(90));MY(o),p1(o,l)}}}break;case"textarea":VY(e,a);break;case"select":n=a.value,n!=null&&kf(e,!!a.multiple,n,!1)}};zY=Pk;KY=xh;var _be={usingClientEntryPoint:!1,Events:[g_,xf,vx,$Y,HY,Pk]},Iv={findFiberByHostInstance:nh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ebe={bundleType:Iv.bundleType,version:Iv.version,rendererPackageName:Iv.rendererPackageName,rendererConfig:Iv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Cl.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=XY(e),e===null?null:e.stateNode},findFiberByHostInstance:Iv.findFiberByHostInstance||vbe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qb=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qb.isDisabled&&qb.supportsFiber)try{px=qb.inject(Ebe),Oc=qb}catch{}}vs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_be;vs.createPortal=function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vk(n))throw Error(Xe(200));return gbe(e,n,null,a)};vs.createRoot=function(e,n){if(!Vk(e))throw Error(Xe(299));var a=!1,o="",l=AX;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),n=jk(e,1,!1,null,null,a,!1,o,l),e[vl]=n.current,yy(e.nodeType===8?e.parentNode:e),new Uk(n)};vs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(Xe(188)):(e=Object.keys(e).join(","),Error(Xe(268,e)));return e=XY(n),e=e===null?null:e.stateNode,e};vs.flushSync=function(e){return xh(e)};vs.hydrate=function(e,n,a){if(!Cx(n))throw Error(Xe(200));return Rx(null,e,n,!0,a)};vs.hydrateRoot=function(e,n,a){if(!Vk(e))throw Error(Xe(405));var o=a!=null&&a.hydratedSources||null,l=!1,p="",m=AX;if(a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(p=a.identifierPrefix),a.onRecoverableError!==void 0&&(m=a.onRecoverableError)),n=RX(n,null,e,1,a??null,l,!1,p,m),e[vl]=n.current,yy(e),o)for(e=0;e<o.length;e++)a=o[e],l=a._getVersion,l=l(a._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[a,l]:n.mutableSourceEagerHydrationData.push(a,l);return new Tx(n)};vs.render=function(e,n,a){if(!Cx(n))throw Error(Xe(200));return Rx(null,e,n,!1,a)};vs.unmountComponentAtNode=function(e){if(!Cx(e))throw Error(Xe(40));return e._reactRootContainer?(xh(function(){Rx(null,null,e,!1,function(){e._reactRootContainer=null,e[vl]=null})}),!0):!1};vs.unstable_batchedUpdates=Pk;vs.unstable_renderSubtreeIntoContainer=function(e,n,a,o){if(!Cx(a))throw Error(Xe(200));if(e==null||e._reactInternals===void 0)throw Error(Xe(38));return Rx(e,n,a,!1,o)};vs.version="18.3.1-next-f1338f8080-20240426";function NX(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NX)}catch(e){console.error(e)}}NX(),NY.exports=vs;var bbe=NY.exports,jH=bbe;s1.createRoot=jH.createRoot,s1.hydrateRoot=jH.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ry(){return Ry=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Ry.apply(this,arguments)}var xd;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(xd||(xd={}));const MH="popstate";function Sbe(e){e===void 0&&(e={});function n(o,l){let{pathname:p,search:m,hash:y}=o.location;return Z1("",{pathname:p,search:m,hash:y},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function a(o,l){return typeof l=="string"?l:nw(l)}return xbe(n,a,null,e)}function Yr(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function Fk(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function wbe(){return Math.random().toString(36).substr(2,8)}function UH(e,n){return{usr:e.state,key:e.key,idx:n}}function Z1(e,n,a,o){return a===void 0&&(a=null),Ry({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof n=="string"?Nm(n):n,{state:a,key:n&&n.key||o||wbe()})}function nw(e){let{pathname:n="/",search:a="",hash:o=""}=e;return a&&a!=="?"&&(n+=a.charAt(0)==="?"?a:"?"+a),o&&o!=="#"&&(n+=o.charAt(0)==="#"?o:"#"+o),n}function Nm(e){let n={};if(e){let a=e.indexOf("#");a>=0&&(n.hash=e.substr(a),e=e.substr(0,a));let o=e.indexOf("?");o>=0&&(n.search=e.substr(o),e=e.substr(0,o)),e&&(n.pathname=e)}return n}function xbe(e,n,a,o){o===void 0&&(o={});let{window:l=document.defaultView,v5Compat:p=!1}=o,m=l.history,y=xd.Pop,E=null,b=T();b==null&&(b=0,m.replaceState(Ry({},m.state,{idx:b}),""));function T(){return(m.state||{idx:null}).idx}function x(){y=xd.Pop;let P=T(),U=P==null?null:P-b;b=P,E&&E({action:y,location:L.location,delta:U})}function A(P,U){y=xd.Push;let V=Z1(L.location,P,U);b=T()+1;let F=UH(V,b),H=L.createHref(V);try{m.pushState(F,"",H)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;l.location.assign(H)}p&&E&&E({action:y,location:L.location,delta:1})}function D(P,U){y=xd.Replace;let V=Z1(L.location,P,U);b=T();let F=UH(V,b),H=L.createHref(V);m.replaceState(F,"",H),p&&E&&E({action:y,location:L.location,delta:0})}function N(P){let U=l.location.origin!=="null"?l.location.origin:l.location.href,V=typeof P=="string"?P:nw(P);return V=V.replace(/ $/,"%20"),Yr(U,"No window.location.(origin|href) available to create URL for href: "+V),new URL(V,U)}let L={get action(){return y},get location(){return e(l,m)},listen(P){if(E)throw new Error("A history only accepts one active listener");return l.addEventListener(MH,x),E=P,()=>{l.removeEventListener(MH,x),E=null}},createHref(P){return n(l,P)},createURL:N,encodeLocation(P){let U=N(P);return{pathname:U.pathname,search:U.search,hash:U.hash}},push:A,replace:D,go(P){return m.go(P)}};return L}var VH;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(VH||(VH={}));function Tbe(e,n,a){return a===void 0&&(a="/"),Cbe(e,n,a)}function Cbe(e,n,a,o){let l=typeof n=="string"?Nm(n):n,p=Bk(l.pathname||"/",a);if(p==null)return null;let m=OX(e);Rbe(m);let y=null;for(let E=0;y==null&&E<m.length;++E){let b=Vbe(p);y=jbe(m[E],b)}return y}function OX(e,n,a,o){n===void 0&&(n=[]),a===void 0&&(a=[]),o===void 0&&(o="");let l=(p,m,y)=>{let E={relativePath:y===void 0?p.path||"":y,caseSensitive:p.caseSensitive===!0,childrenIndex:m,route:p};E.relativePath.startsWith("/")&&(Yr(E.relativePath.startsWith(o),'Absolute route path "'+E.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),E.relativePath=E.relativePath.slice(o.length));let b=Ld([o,E.relativePath]),T=a.concat(E);p.children&&p.children.length>0&&(Yr(p.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+b+'".')),OX(p.children,n,T,b)),!(p.path==null&&!p.index)&&n.push({path:b,score:kbe(b,p.index),routesMeta:T})};return e.forEach((p,m)=>{var y;if(p.path===""||!((y=p.path)!=null&&y.includes("?")))l(p,m);else for(let E of IX(p.path))l(p,m,E)}),n}function IX(e){let n=e.split("/");if(n.length===0)return[];let[a,...o]=n,l=a.endsWith("?"),p=a.replace(/\?$/,"");if(o.length===0)return l?[p,""]:[p];let m=IX(o.join("/")),y=[];return y.push(...m.map(E=>E===""?p:[p,E].join("/"))),l&&y.push(...m),y.map(E=>e.startsWith("/")&&E===""?"/":E)}function Rbe(e){e.sort((n,a)=>n.score!==a.score?a.score-n.score:Lbe(n.routesMeta.map(o=>o.childrenIndex),a.routesMeta.map(o=>o.childrenIndex)))}const Abe=/^:[\w-]+$/,Nbe=3,Obe=2,Ibe=1,Pbe=10,Dbe=-2,FH=e=>e==="*";function kbe(e,n){let a=e.split("/"),o=a.length;return a.some(FH)&&(o+=Dbe),n&&(o+=Obe),a.filter(l=>!FH(l)).reduce((l,p)=>l+(Abe.test(p)?Nbe:p===""?Ibe:Pbe),o)}function Lbe(e,n){return e.length===n.length&&e.slice(0,-1).every((o,l)=>o===n[l])?e[e.length-1]-n[n.length-1]:0}function jbe(e,n,a){let{routesMeta:o}=e,l={},p="/",m=[];for(let y=0;y<o.length;++y){let E=o[y],b=y===o.length-1,T=p==="/"?n:n.slice(p.length)||"/",x=Mbe({path:E.relativePath,caseSensitive:E.caseSensitive,end:b},T),A=E.route;if(!x)return null;Object.assign(l,x.params),m.push({params:l,pathname:Ld([p,x.pathname]),pathnameBase:$be(Ld([p,x.pathnameBase])),route:A}),x.pathnameBase!=="/"&&(p=Ld([p,x.pathnameBase]))}return m}function Mbe(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[a,o]=Ube(e.path,e.caseSensitive,e.end),l=n.match(a);if(!l)return null;let p=l[0],m=p.replace(/(.)\/+$/,"$1"),y=l.slice(1);return{params:o.reduce((b,T,x)=>{let{paramName:A,isOptional:D}=T;if(A==="*"){let L=y[x]||"";m=p.slice(0,p.length-L.length).replace(/(.)\/+$/,"$1")}const N=y[x];return D&&!N?b[A]=void 0:b[A]=(N||"").replace(/%2F/g,"/"),b},{}),pathname:p,pathnameBase:m,pattern:e}}function Ube(e,n,a){n===void 0&&(n=!1),a===void 0&&(a=!0),Fk(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let o=[],l="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,y,E)=>(o.push({paramName:y,isOptional:E!=null}),E?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(o.push({paramName:"*"}),l+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?l+="\\/*$":e!==""&&e!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,n?void 0:"i"),o]}function Vbe(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Fk(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),e}}function Bk(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let a=n.endsWith("/")?n.length-1:n.length,o=e.charAt(a);return o&&o!=="/"?null:e.slice(a)||"/"}const Fbe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Bbe=e=>Fbe.test(e);function Wbe(e,n){n===void 0&&(n="/");let{pathname:a,search:o="",hash:l=""}=typeof e=="string"?Nm(e):e,p;if(a)if(Bbe(a))p=a;else{if(a.includes("//")){let m=a;a=a.replace(/\/\/+/g,"/"),Fk(!1,"Pathnames cannot have embedded double slashes - normalizing "+(m+" -> "+a))}a.startsWith("/")?p=BH(a.substring(1),"/"):p=BH(a,n)}else p=n;return{pathname:p,search:Hbe(o),hash:zbe(l)}}function BH(e,n){let a=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(l=>{l===".."?a.length>1&&a.pop():l!=="."&&a.push(l)}),a.length>1?a.join("/"):"/"}function SI(e,n,a,o){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Gbe(e){return e.filter((n,a)=>a===0||n.route.path&&n.route.path.length>0)}function Wk(e,n){let a=Gbe(e);return n?a.map((o,l)=>l===a.length-1?o.pathname:o.pathnameBase):a.map(o=>o.pathnameBase)}function Gk(e,n,a,o){o===void 0&&(o=!1);let l;typeof e=="string"?l=Nm(e):(l=Ry({},e),Yr(!l.pathname||!l.pathname.includes("?"),SI("?","pathname","search",l)),Yr(!l.pathname||!l.pathname.includes("#"),SI("#","pathname","hash",l)),Yr(!l.search||!l.search.includes("#"),SI("#","search","hash",l)));let p=e===""||l.pathname==="",m=p?"/":l.pathname,y;if(m==null)y=a;else{let x=n.length-1;if(!o&&m.startsWith("..")){let A=m.split("/");for(;A[0]==="..";)A.shift(),x-=1;l.pathname=A.join("/")}y=x>=0?n[x]:"/"}let E=Wbe(l,y),b=m&&m!=="/"&&m.endsWith("/"),T=(p||m===".")&&a.endsWith("/");return!E.pathname.endsWith("/")&&(b||T)&&(E.pathname+="/"),E}const Ld=e=>e.join("/").replace(/\/\/+/g,"/"),$be=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Hbe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,zbe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Kbe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const PX=["post","put","patch","delete"];new Set(PX);const Ybe=["get",...PX];new Set(Ybe);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ay(){return Ay=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Ay.apply(this,arguments)}const $k=J.createContext(null),qbe=J.createContext(null),Hd=J.createContext(null),Ax=J.createContext(null),Rl=J.createContext({outlet:null,matches:[],isDataRoute:!1}),DX=J.createContext(null);function Xbe(e,n){let{relative:a}=n===void 0?{}:n;Om()||Yr(!1);let{basename:o,navigator:l}=J.useContext(Hd),{hash:p,pathname:m,search:y}=LX(e,{relative:a}),E=m;return o!=="/"&&(E=m==="/"?o:Ld([o,m])),l.createHref({pathname:E,search:y,hash:p})}function Om(){return J.useContext(Ax)!=null}function zd(){return Om()||Yr(!1),J.useContext(Ax).location}function kX(e){J.useContext(Hd).static||J.useLayoutEffect(e)}function ro(){let{isDataRoute:e}=J.useContext(Rl);return e?lSe():Jbe()}function Jbe(){Om()||Yr(!1);let e=J.useContext($k),{basename:n,future:a,navigator:o}=J.useContext(Hd),{matches:l}=J.useContext(Rl),{pathname:p}=zd(),m=JSON.stringify(Wk(l,a.v7_relativeSplatPath)),y=J.useRef(!1);return kX(()=>{y.current=!0}),J.useCallback(function(b,T){if(T===void 0&&(T={}),!y.current)return;if(typeof b=="number"){o.go(b);return}let x=Gk(b,JSON.parse(m),p,T.relative==="path");e==null&&n!=="/"&&(x.pathname=x.pathname==="/"?n:Ld([n,x.pathname])),(T.replace?o.replace:o.push)(x,T.state,T)},[n,o,m,p,e])}function Nx(){let{matches:e}=J.useContext(Rl),n=e[e.length-1];return n?n.params:{}}function LX(e,n){let{relative:a}=n===void 0?{}:n,{future:o}=J.useContext(Hd),{matches:l}=J.useContext(Rl),{pathname:p}=zd(),m=JSON.stringify(Wk(l,o.v7_relativeSplatPath));return J.useMemo(()=>Gk(e,JSON.parse(m),p,a==="path"),[e,m,p,a])}function Qbe(e,n){return Zbe(e,n)}function Zbe(e,n,a,o){Om()||Yr(!1);let{navigator:l}=J.useContext(Hd),{matches:p}=J.useContext(Rl),m=p[p.length-1],y=m?m.params:{};m&&m.pathname;let E=m?m.pathnameBase:"/";m&&m.route;let b=zd(),T;if(n){var x;let P=typeof n=="string"?Nm(n):n;E==="/"||(x=P.pathname)!=null&&x.startsWith(E)||Yr(!1),T=P}else T=b;let A=T.pathname||"/",D=A;if(E!=="/"){let P=E.replace(/^\//,"").split("/");D="/"+A.replace(/^\//,"").split("/").slice(P.length).join("/")}let N=Tbe(e,{pathname:D}),L=iSe(N&&N.map(P=>Object.assign({},P,{params:Object.assign({},y,P.params),pathname:Ld([E,l.encodeLocation?l.encodeLocation(P.pathname).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?E:Ld([E,l.encodeLocation?l.encodeLocation(P.pathnameBase).pathname:P.pathnameBase])})),p,a,o);return n&&L?J.createElement(Ax.Provider,{value:{location:Ay({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:xd.Pop}},L):L}function eSe(){let e=cSe(),n=Kbe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),a=e instanceof Error?e.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return J.createElement(J.Fragment,null,J.createElement("h2",null,"Unexpected Application Error!"),J.createElement("h3",{style:{fontStyle:"italic"}},n),a?J.createElement("pre",{style:l},a):null,null)}const tSe=J.createElement(eSe,null);class nSe extends J.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,a){return a.location!==n.location||a.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:a.error,location:a.location,revalidation:n.revalidation||a.revalidation}}componentDidCatch(n,a){console.error("React Router caught the following error during render",n,a)}render(){return this.state.error!==void 0?J.createElement(Rl.Provider,{value:this.props.routeContext},J.createElement(DX.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function rSe(e){let{routeContext:n,match:a,children:o}=e,l=J.useContext($k);return l&&l.static&&l.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=a.route.id),J.createElement(Rl.Provider,{value:n},o)}function iSe(e,n,a,o){var l;if(n===void 0&&(n=[]),a===void 0&&(a=null),o===void 0&&(o=null),e==null){var p;if(!a)return null;if(a.errors)e=a.matches;else if((p=o)!=null&&p.v7_partialHydration&&n.length===0&&!a.initialized&&a.matches.length>0)e=a.matches;else return null}let m=e,y=(l=a)==null?void 0:l.errors;if(y!=null){let T=m.findIndex(x=>x.route.id&&(y==null?void 0:y[x.route.id])!==void 0);T>=0||Yr(!1),m=m.slice(0,Math.min(m.length,T+1))}let E=!1,b=-1;if(a&&o&&o.v7_partialHydration)for(let T=0;T<m.length;T++){let x=m[T];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(b=T),x.route.id){let{loaderData:A,errors:D}=a,N=x.route.loader&&A[x.route.id]===void 0&&(!D||D[x.route.id]===void 0);if(x.route.lazy||N){E=!0,b>=0?m=m.slice(0,b+1):m=[m[0]];break}}}return m.reduceRight((T,x,A)=>{let D,N=!1,L=null,P=null;a&&(D=y&&x.route.id?y[x.route.id]:void 0,L=x.route.errorElement||tSe,E&&(b<0&&A===0?(dSe("route-fallback"),N=!0,P=null):b===A&&(N=!0,P=x.route.hydrateFallbackElement||null)));let U=n.concat(m.slice(0,A+1)),V=()=>{let F;return D?F=L:N?F=P:x.route.Component?F=J.createElement(x.route.Component,null):x.route.element?F=x.route.element:F=T,J.createElement(rSe,{match:x,routeContext:{outlet:T,matches:U,isDataRoute:a!=null},children:F})};return a&&(x.route.ErrorBoundary||x.route.errorElement||A===0)?J.createElement(nSe,{location:a.location,revalidation:a.revalidation,component:L,error:D,children:V(),routeContext:{outlet:null,matches:U,isDataRoute:!0}}):V()},null)}var jX=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(jX||{}),MX=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(MX||{});function aSe(e){let n=J.useContext($k);return n||Yr(!1),n}function sSe(e){let n=J.useContext(qbe);return n||Yr(!1),n}function oSe(e){let n=J.useContext(Rl);return n||Yr(!1),n}function UX(e){let n=oSe(),a=n.matches[n.matches.length-1];return a.route.id||Yr(!1),a.route.id}function cSe(){var e;let n=J.useContext(DX),a=sSe(),o=UX();return n!==void 0?n:(e=a.errors)==null?void 0:e[o]}function lSe(){let{router:e}=aSe(jX.UseNavigateStable),n=UX(MX.UseNavigateStable),a=J.useRef(!1);return kX(()=>{a.current=!0}),J.useCallback(function(l,p){p===void 0&&(p={}),a.current&&(typeof l=="number"?e.navigate(l):e.navigate(l,Ay({fromRouteId:n},p)))},[e,n])}const WH={};function dSe(e,n,a){WH[e]||(WH[e]=!0)}function uSe(e,n){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Zi(e){let{to:n,replace:a,state:o,relative:l}=e;Om()||Yr(!1);let{future:p,static:m}=J.useContext(Hd),{matches:y}=J.useContext(Rl),{pathname:E}=zd(),b=ro(),T=Gk(n,Wk(y,p.v7_relativeSplatPath),E,l==="path"),x=JSON.stringify(T);return J.useEffect(()=>b(JSON.parse(x),{replace:a,state:o,relative:l}),[b,x,l,a,o]),null}function Dr(e){Yr(!1)}function hSe(e){let{basename:n="/",children:a=null,location:o,navigationType:l=xd.Pop,navigator:p,static:m=!1,future:y}=e;Om()&&Yr(!1);let E=n.replace(/^\/*/,"/"),b=J.useMemo(()=>({basename:E,navigator:p,static:m,future:Ay({v7_relativeSplatPath:!1},y)}),[E,y,p,m]);typeof o=="string"&&(o=Nm(o));let{pathname:T="/",search:x="",hash:A="",state:D=null,key:N="default"}=o,L=J.useMemo(()=>{let P=Bk(T,E);return P==null?null:{location:{pathname:P,search:x,hash:A,state:D,key:N},navigationType:l}},[E,T,x,A,D,N,l]);return L==null?null:J.createElement(Hd.Provider,{value:b},J.createElement(Ax.Provider,{children:a,value:L}))}function pSe(e){let{children:n,location:a}=e;return Qbe(eP(n),a)}new Promise(()=>{});function eP(e,n){n===void 0&&(n=[]);let a=[];return J.Children.forEach(e,(o,l)=>{if(!J.isValidElement(o))return;let p=[...n,l];if(o.type===J.Fragment){a.push.apply(a,eP(o.props.children,p));return}o.type!==Dr&&Yr(!1),!o.props.index||!o.props.children||Yr(!1);let m={id:o.props.id||p.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(m.children=eP(o.props.children,p)),a.push(m)}),a}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tP(){return tP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},tP.apply(this,arguments)}function fSe(e,n){if(e==null)return{};var a={},o=Object.keys(e),l,p;for(p=0;p<o.length;p++)l=o[p],!(n.indexOf(l)>=0)&&(a[l]=e[l]);return a}function mSe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function gSe(e,n){return e.button===0&&(!n||n==="_self")&&!mSe(e)}function nP(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((n,a)=>{let o=e[a];return n.concat(Array.isArray(o)?o.map(l=>[a,l]):[[a,o]])},[]))}function vSe(e,n){let a=nP(e);return n&&n.forEach((o,l)=>{a.has(l)||n.getAll(l).forEach(p=>{a.append(l,p)})}),a}const ySe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],_Se="6";try{window.__reactRouterVersion=_Se}catch{}const ESe="startTransition",GH=d0e[ESe];function bSe(e){let{basename:n,children:a,future:o,window:l}=e,p=J.useRef();p.current==null&&(p.current=Sbe({window:l,v5Compat:!0}));let m=p.current,[y,E]=J.useState({action:m.action,location:m.location}),{v7_startTransition:b}=o||{},T=J.useCallback(x=>{b&&GH?GH(()=>E(x)):E(x)},[E,b]);return J.useLayoutEffect(()=>m.listen(T),[m,T]),J.useEffect(()=>uSe(o),[o]),J.createElement(hSe,{basename:n,children:a,location:y.location,navigationType:y.action,navigator:m,future:o})}const SSe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",wSe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Tn=J.forwardRef(function(n,a){let{onClick:o,relative:l,reloadDocument:p,replace:m,state:y,target:E,to:b,preventScrollReset:T,viewTransition:x}=n,A=fSe(n,ySe),{basename:D}=J.useContext(Hd),N,L=!1;if(typeof b=="string"&&wSe.test(b)&&(N=b,SSe))try{let F=new URL(window.location.href),H=b.startsWith("//")?new URL(F.protocol+b):new URL(b),B=Bk(H.pathname,D);H.origin===F.origin&&B!=null?b=B+H.search+H.hash:L=!0}catch{}let P=Xbe(b,{relative:l}),U=xSe(b,{replace:m,state:y,target:E,preventScrollReset:T,relative:l,viewTransition:x});function V(F){o&&o(F),F.defaultPrevented||U(F)}return J.createElement("a",tP({},A,{href:N||P,onClick:L||p?o:V,ref:a,target:E}))});var $H;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})($H||($H={}));var HH;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(HH||(HH={}));function xSe(e,n){let{target:a,replace:o,state:l,preventScrollReset:p,relative:m,viewTransition:y}=n===void 0?{}:n,E=ro(),b=zd(),T=LX(e,{relative:m});return J.useCallback(x=>{if(gSe(x,a)){x.preventDefault();let A=o!==void 0?o:nw(b)===nw(T);E(e,{replace:A,state:l,preventScrollReset:p,relative:m,viewTransition:y})}},[b,E,T,o,l,a,e,p,m,y])}function TSe(e){let n=J.useRef(nP(e)),a=J.useRef(!1),o=zd(),l=J.useMemo(()=>vSe(o.search,a.current?null:n.current),[o.search]),p=ro(),m=J.useCallback((y,E)=>{const b=nP(typeof y=="function"?y(l):y);a.current=!0,p("?"+b,E)},[p,l]);return[l,m]}let CSe={data:""},RSe=e=>{if(typeof window=="object"){let n=(e?e.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return n.nonce=window.__nonce__,n.parentNode||(e||document.head).appendChild(n),n.firstChild}return e||CSe},ASe=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,NSe=/\/\*[^]*?\*\/|  +/g,zH=/\n+/g,yd=(e,n)=>{let a="",o="",l="";for(let p in e){let m=e[p];p[0]=="@"?p[1]=="i"?a=p+" "+m+";":o+=p[1]=="f"?yd(m,p):p+"{"+yd(m,p[1]=="k"?"":n)+"}":typeof m=="object"?o+=yd(m,n?n.replace(/([^,])+/g,y=>p.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,E=>/&/.test(E)?E.replace(/&/g,y):y?y+" "+E:E)):p):m!=null&&(p=/^--/.test(p)?p:p.replace(/[A-Z]/g,"-$&").toLowerCase(),l+=yd.p?yd.p(p,m):p+":"+m+";")}return a+(n&&l?n+"{"+l+"}":l)+o},tl={},VX=e=>{if(typeof e=="object"){let n="";for(let a in e)n+=a+VX(e[a]);return n}return e},OSe=(e,n,a,o,l)=>{let p=VX(e),m=tl[p]||(tl[p]=(E=>{let b=0,T=11;for(;b<E.length;)T=101*T+E.charCodeAt(b++)>>>0;return"go"+T})(p));if(!tl[m]){let E=p!==e?e:(b=>{let T,x,A=[{}];for(;T=ASe.exec(b.replace(NSe,""));)T[4]?A.shift():T[3]?(x=T[3].replace(zH," ").trim(),A.unshift(A[0][x]=A[0][x]||{})):A[0][T[1]]=T[2].replace(zH," ").trim();return A[0]})(e);tl[m]=yd(l?{["@keyframes "+m]:E}:E,a?"":"."+m)}let y=a&&tl.g?tl.g:null;return a&&(tl.g=tl[m]),((E,b,T,x)=>{x?b.data=b.data.replace(x,E):b.data.indexOf(E)===-1&&(b.data=T?E+b.data:b.data+E)})(tl[m],n,o,y),m},ISe=(e,n,a)=>e.reduce((o,l,p)=>{let m=n[p];if(m&&m.call){let y=m(a),E=y&&y.props&&y.props.className||/^go/.test(y)&&y;m=E?"."+E:y&&typeof y=="object"?y.props?"":yd(y,""):y===!1?"":y}return o+l+(m??"")},"");function Ox(e){let n=this||{},a=e.call?e(n.p):e;return OSe(a.unshift?a.raw?ISe(a,[].slice.call(arguments,1),n.p):a.reduce((o,l)=>Object.assign(o,l&&l.call?l(n.p):l),{}):a,RSe(n.target),n.g,n.o,n.k)}let FX,rP,iP;Ox.bind({g:1});let El=Ox.bind({k:1});function PSe(e,n,a,o){yd.p=n,FX=e,rP=a,iP=o}function Kd(e,n){let a=this||{};return function(){let o=arguments;function l(p,m){let y=Object.assign({},p),E=y.className||l.className;a.p=Object.assign({theme:rP&&rP()},y),a.o=/ *go\d+/.test(E),y.className=Ox.apply(a,o)+(E?" "+E:"");let b=e;return e[0]&&(b=y.as||e,delete y.as),iP&&b[0]&&iP(y),FX(b,y)}return l}}var DSe=e=>typeof e=="function",rw=(e,n)=>DSe(e)?e(n):e,kSe=(()=>{let e=0;return()=>(++e).toString()})(),BX=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let n=matchMedia("(prefers-reduced-motion: reduce)");e=!n||n.matches}return e}})(),LSe=20,Hk="default",WX=(e,n)=>{let{toastLimit:a}=e.settings;switch(n.type){case 0:return{...e,toasts:[n.toast,...e.toasts].slice(0,a)};case 1:return{...e,toasts:e.toasts.map(m=>m.id===n.toast.id?{...m,...n.toast}:m)};case 2:let{toast:o}=n;return WX(e,{type:e.toasts.find(m=>m.id===o.id)?1:0,toast:o});case 3:let{toastId:l}=n;return{...e,toasts:e.toasts.map(m=>m.id===l||l===void 0?{...m,dismissed:!0,visible:!1}:m)};case 4:return n.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(m=>m.id!==n.toastId)};case 5:return{...e,pausedAt:n.time};case 6:let p=n.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(m=>({...m,pauseDuration:m.pauseDuration+p}))}}},CS=[],GX={toasts:[],pausedAt:void 0,settings:{toastLimit:LSe}},Cc={},$X=(e,n=Hk)=>{Cc[n]=WX(Cc[n]||GX,e),CS.forEach(([a,o])=>{a===n&&o(Cc[n])})},HX=e=>Object.keys(Cc).forEach(n=>$X(e,n)),jSe=e=>Object.keys(Cc).find(n=>Cc[n].toasts.some(a=>a.id===e)),Ix=(e=Hk)=>n=>{$X(n,e)},MSe={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},USe=(e={},n=Hk)=>{let[a,o]=J.useState(Cc[n]||GX),l=J.useRef(Cc[n]);J.useEffect(()=>(l.current!==Cc[n]&&o(Cc[n]),CS.push([n,o]),()=>{let m=CS.findIndex(([y])=>y===n);m>-1&&CS.splice(m,1)}),[n]);let p=a.toasts.map(m=>{var y,E,b;return{...e,...e[m.type],...m,removeDelay:m.removeDelay||((y=e[m.type])==null?void 0:y.removeDelay)||(e==null?void 0:e.removeDelay),duration:m.duration||((E=e[m.type])==null?void 0:E.duration)||(e==null?void 0:e.duration)||MSe[m.type],style:{...e.style,...(b=e[m.type])==null?void 0:b.style,...m.style}}});return{...a,toasts:p}},VSe=(e,n="blank",a)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:n,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...a,id:(a==null?void 0:a.id)||kSe()}),y_=e=>(n,a)=>{let o=VSe(n,e,a);return Ix(o.toasterId||jSe(o.id))({type:2,toast:o}),o.id},di=(e,n)=>y_("blank")(e,n);di.error=y_("error");di.success=y_("success");di.loading=y_("loading");di.custom=y_("custom");di.dismiss=(e,n)=>{let a={type:3,toastId:e};n?Ix(n)(a):HX(a)};di.dismissAll=e=>di.dismiss(void 0,e);di.remove=(e,n)=>{let a={type:4,toastId:e};n?Ix(n)(a):HX(a)};di.removeAll=e=>di.remove(void 0,e);di.promise=(e,n,a)=>{let o=di.loading(n.loading,{...a,...a==null?void 0:a.loading});return typeof e=="function"&&(e=e()),e.then(l=>{let p=n.success?rw(n.success,l):void 0;return p?di.success(p,{id:o,...a,...a==null?void 0:a.success}):di.dismiss(o),l}).catch(l=>{let p=n.error?rw(n.error,l):void 0;p?di.error(p,{id:o,...a,...a==null?void 0:a.error}):di.dismiss(o)}),e};var FSe=1e3,BSe=(e,n="default")=>{let{toasts:a,pausedAt:o}=USe(e,n),l=J.useRef(new Map).current,p=J.useCallback((x,A=FSe)=>{if(l.has(x))return;let D=setTimeout(()=>{l.delete(x),m({type:4,toastId:x})},A);l.set(x,D)},[]);J.useEffect(()=>{if(o)return;let x=Date.now(),A=a.map(D=>{if(D.duration===1/0)return;let N=(D.duration||0)+D.pauseDuration-(x-D.createdAt);if(N<0){D.visible&&di.dismiss(D.id);return}return setTimeout(()=>di.dismiss(D.id,n),N)});return()=>{A.forEach(D=>D&&clearTimeout(D))}},[a,o,n]);let m=J.useCallback(Ix(n),[n]),y=J.useCallback(()=>{m({type:5,time:Date.now()})},[m]),E=J.useCallback((x,A)=>{m({type:1,toast:{id:x,height:A}})},[m]),b=J.useCallback(()=>{o&&m({type:6,time:Date.now()})},[o,m]),T=J.useCallback((x,A)=>{let{reverseOrder:D=!1,gutter:N=8,defaultPosition:L}=A||{},P=a.filter(F=>(F.position||L)===(x.position||L)&&F.height),U=P.findIndex(F=>F.id===x.id),V=P.filter((F,H)=>H<U&&F.visible).length;return P.filter(F=>F.visible).slice(...D?[V+1]:[0,V]).reduce((F,H)=>F+(H.height||0)+N,0)},[a]);return J.useEffect(()=>{a.forEach(x=>{if(x.dismissed)p(x.id,x.removeDelay);else{let A=l.get(x.id);A&&(clearTimeout(A),l.delete(x.id))}})},[a,p]),{toasts:a,handlers:{updateHeight:E,startPause:y,endPause:b,calculateOffset:T}}},WSe=El`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,GSe=El`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,$Se=El`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,HSe=Kd("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${WSe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${GSe} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${$Se} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,zSe=El`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,KSe=Kd("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${zSe} 1s linear infinite;
`,YSe=El`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,qSe=El`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,XSe=Kd("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${YSe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${qSe} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,JSe=Kd("div")`
  position: absolute;
`,QSe=Kd("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,ZSe=El`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,ewe=Kd("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${ZSe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,twe=({toast:e})=>{let{icon:n,type:a,iconTheme:o}=e;return n!==void 0?typeof n=="string"?J.createElement(ewe,null,n):n:a==="blank"?null:J.createElement(QSe,null,J.createElement(KSe,{...o}),a!=="loading"&&J.createElement(JSe,null,a==="error"?J.createElement(HSe,{...o}):J.createElement(XSe,{...o})))},nwe=e=>`
0% {transform: translate3d(0,${e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,rwe=e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${e*-150}%,-1px) scale(.6); opacity:0;}
`,iwe="0%{opacity:0;} 100%{opacity:1;}",awe="0%{opacity:1;} 100%{opacity:0;}",swe=Kd("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,owe=Kd("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,cwe=(e,n)=>{let a=e.includes("top")?1:-1,[o,l]=BX()?[iwe,awe]:[nwe(a),rwe(a)];return{animation:n?`${El(o)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${El(l)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},lwe=J.memo(({toast:e,position:n,style:a,children:o})=>{let l=e.height?cwe(e.position||n||"top-center",e.visible):{opacity:0},p=J.createElement(twe,{toast:e}),m=J.createElement(owe,{...e.ariaProps},rw(e.message,e));return J.createElement(swe,{className:e.className,style:{...l,...a,...e.style}},typeof o=="function"?o({icon:p,message:m}):J.createElement(J.Fragment,null,p,m))});PSe(J.createElement);var dwe=({id:e,className:n,style:a,onHeightUpdate:o,children:l})=>{let p=J.useCallback(m=>{if(m){let y=()=>{let E=m.getBoundingClientRect().height;o(e,E)};y(),new MutationObserver(y).observe(m,{subtree:!0,childList:!0,characterData:!0})}},[e,o]);return J.createElement("div",{ref:p,className:n,style:a},l)},uwe=(e,n)=>{let a=e.includes("top"),o=a?{top:0}:{bottom:0},l=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:BX()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${n*(a?1:-1)}px)`,...o,...l}},hwe=Ox`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Xb=16,pwe=({reverseOrder:e,position:n="top-center",toastOptions:a,gutter:o,children:l,toasterId:p,containerStyle:m,containerClassName:y})=>{let{toasts:E,handlers:b}=BSe(a,p);return J.createElement("div",{"data-rht-toaster":p||"",style:{position:"fixed",zIndex:9999,top:Xb,left:Xb,right:Xb,bottom:Xb,pointerEvents:"none",...m},className:y,onMouseEnter:b.startPause,onMouseLeave:b.endPause},E.map(T=>{let x=T.position||n,A=b.calculateOffset(T,{reverseOrder:e,gutter:o,defaultPosition:n}),D=uwe(x,A);return J.createElement(dwe,{id:T.id,key:T.id,onHeightUpdate:b.updateHeight,className:T.visible?hwe:"",style:D},T.type==="custom"?rw(T.message,T):l?l(T):J.createElement(lwe,{toast:T,position:x}))}))},bt=di;function zX(e,n){return function(){return e.apply(n,arguments)}}const{toString:fwe}=Object.prototype,{getPrototypeOf:zk}=Object,{iterator:Px,toStringTag:KX}=Symbol,Dx=(e=>n=>{const a=fwe.call(n);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),qo=e=>(e=e.toLowerCase(),n=>Dx(n)===e),kx=e=>n=>typeof n===e,{isArray:Im}=Array,Zf=kx("undefined");function __(e){return e!==null&&!Zf(e)&&e.constructor!==null&&!Zf(e.constructor)&&Ga(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const YX=qo("ArrayBuffer");function mwe(e){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(e):n=e&&e.buffer&&YX(e.buffer),n}const gwe=kx("string"),Ga=kx("function"),qX=kx("number"),E_=e=>e!==null&&typeof e=="object",vwe=e=>e===!0||e===!1,RS=e=>{if(Dx(e)!=="object")return!1;const n=zk(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(KX in e)&&!(Px in e)},ywe=e=>{if(!E_(e)||__(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},_we=qo("Date"),Ewe=qo("File"),bwe=qo("Blob"),Swe=qo("FileList"),wwe=e=>E_(e)&&Ga(e.pipe),xwe=e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||Ga(e.append)&&((n=Dx(e))==="formdata"||n==="object"&&Ga(e.toString)&&e.toString()==="[object FormData]"))},Twe=qo("URLSearchParams"),[Cwe,Rwe,Awe,Nwe]=["ReadableStream","Request","Response","Headers"].map(qo),Owe=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function b_(e,n,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let o,l;if(typeof e!="object"&&(e=[e]),Im(e))for(o=0,l=e.length;o<l;o++)n.call(null,e[o],o,e);else{if(__(e))return;const p=a?Object.getOwnPropertyNames(e):Object.keys(e),m=p.length;let y;for(o=0;o<m;o++)y=p[o],n.call(null,e[y],y,e)}}function XX(e,n){if(__(e))return null;n=n.toLowerCase();const a=Object.keys(e);let o=a.length,l;for(;o-- >0;)if(l=a[o],n===l.toLowerCase())return l;return null}const ah=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,JX=e=>!Zf(e)&&e!==ah;function aP(){const{caseless:e,skipUndefined:n}=JX(this)&&this||{},a={},o=(l,p)=>{const m=e&&XX(a,p)||p;RS(a[m])&&RS(l)?a[m]=aP(a[m],l):RS(l)?a[m]=aP({},l):Im(l)?a[m]=l.slice():(!n||!Zf(l))&&(a[m]=l)};for(let l=0,p=arguments.length;l<p;l++)arguments[l]&&b_(arguments[l],o);return a}const Iwe=(e,n,a,{allOwnKeys:o}={})=>(b_(n,(l,p)=>{a&&Ga(l)?e[p]=zX(l,a):e[p]=l},{allOwnKeys:o}),e),Pwe=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Dwe=(e,n,a,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),a&&Object.assign(e.prototype,a)},kwe=(e,n,a,o)=>{let l,p,m;const y={};if(n=n||{},e==null)return n;do{for(l=Object.getOwnPropertyNames(e),p=l.length;p-- >0;)m=l[p],(!o||o(m,e,n))&&!y[m]&&(n[m]=e[m],y[m]=!0);e=a!==!1&&zk(e)}while(e&&(!a||a(e,n))&&e!==Object.prototype);return n},Lwe=(e,n,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=n.length;const o=e.indexOf(n,a);return o!==-1&&o===a},jwe=e=>{if(!e)return null;if(Im(e))return e;let n=e.length;if(!qX(n))return null;const a=new Array(n);for(;n-- >0;)a[n]=e[n];return a},Mwe=(e=>n=>e&&n instanceof e)(typeof Uint8Array<"u"&&zk(Uint8Array)),Uwe=(e,n)=>{const o=(e&&e[Px]).call(e);let l;for(;(l=o.next())&&!l.done;){const p=l.value;n.call(e,p[0],p[1])}},Vwe=(e,n)=>{let a;const o=[];for(;(a=e.exec(n))!==null;)o.push(a);return o},Fwe=qo("HTMLFormElement"),Bwe=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,o,l){return o.toUpperCase()+l}),KH=(({hasOwnProperty:e})=>(n,a)=>e.call(n,a))(Object.prototype),Wwe=qo("RegExp"),QX=(e,n)=>{const a=Object.getOwnPropertyDescriptors(e),o={};b_(a,(l,p)=>{let m;(m=n(l,p,e))!==!1&&(o[p]=m||l)}),Object.defineProperties(e,o)},Gwe=e=>{QX(e,(n,a)=>{if(Ga(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const o=e[a];if(Ga(o)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},$we=(e,n)=>{const a={},o=l=>{l.forEach(p=>{a[p]=!0})};return Im(e)?o(e):o(String(e).split(n)),a},Hwe=()=>{},zwe=(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n;function Kwe(e){return!!(e&&Ga(e.append)&&e[KX]==="FormData"&&e[Px])}const Ywe=e=>{const n=new Array(10),a=(o,l)=>{if(E_(o)){if(n.indexOf(o)>=0)return;if(__(o))return o;if(!("toJSON"in o)){n[l]=o;const p=Im(o)?[]:{};return b_(o,(m,y)=>{const E=a(m,l+1);!Zf(E)&&(p[y]=E)}),n[l]=void 0,p}}return o};return a(e,0)},qwe=qo("AsyncFunction"),Xwe=e=>e&&(E_(e)||Ga(e))&&Ga(e.then)&&Ga(e.catch),ZX=((e,n)=>e?setImmediate:n?((a,o)=>(ah.addEventListener("message",({source:l,data:p})=>{l===ah&&p===a&&o.length&&o.shift()()},!1),l=>{o.push(l),ah.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",Ga(ah.postMessage)),Jwe=typeof queueMicrotask<"u"?queueMicrotask.bind(ah):typeof process<"u"&&process.nextTick||ZX,Qwe=e=>e!=null&&Ga(e[Px]),Le={isArray:Im,isArrayBuffer:YX,isBuffer:__,isFormData:xwe,isArrayBufferView:mwe,isString:gwe,isNumber:qX,isBoolean:vwe,isObject:E_,isPlainObject:RS,isEmptyObject:ywe,isReadableStream:Cwe,isRequest:Rwe,isResponse:Awe,isHeaders:Nwe,isUndefined:Zf,isDate:_we,isFile:Ewe,isBlob:bwe,isRegExp:Wwe,isFunction:Ga,isStream:wwe,isURLSearchParams:Twe,isTypedArray:Mwe,isFileList:Swe,forEach:b_,merge:aP,extend:Iwe,trim:Owe,stripBOM:Pwe,inherits:Dwe,toFlatObject:kwe,kindOf:Dx,kindOfTest:qo,endsWith:Lwe,toArray:jwe,forEachEntry:Uwe,matchAll:Vwe,isHTMLForm:Fwe,hasOwnProperty:KH,hasOwnProp:KH,reduceDescriptors:QX,freezeMethods:Gwe,toObjectSet:$we,toCamelCase:Bwe,noop:Hwe,toFiniteNumber:zwe,findKey:XX,global:ah,isContextDefined:JX,isSpecCompliantForm:Kwe,toJSONObject:Ywe,isAsyncFn:qwe,isThenable:Xwe,setImmediate:ZX,asap:Jwe,isIterable:Qwe};function on(e,n,a,o,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),a&&(this.config=a),o&&(this.request=o),l&&(this.response=l,this.status=l.status?l.status:null)}Le.inherits(on,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Le.toJSONObject(this.config),code:this.code,status:this.status}}});const eJ=on.prototype,tJ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{tJ[e]={value:e}});Object.defineProperties(on,tJ);Object.defineProperty(eJ,"isAxiosError",{value:!0});on.from=(e,n,a,o,l,p)=>{const m=Object.create(eJ);Le.toFlatObject(e,m,function(T){return T!==Error.prototype},b=>b!=="isAxiosError");const y=e&&e.message?e.message:"Error",E=n==null&&e?e.code:n;return on.call(m,y,E,a,o,l),e&&m.cause==null&&Object.defineProperty(m,"cause",{value:e,configurable:!0}),m.name=e&&e.name||"Error",p&&Object.assign(m,p),m};const Zwe=null;function sP(e){return Le.isPlainObject(e)||Le.isArray(e)}function nJ(e){return Le.endsWith(e,"[]")?e.slice(0,-2):e}function YH(e,n,a){return e?e.concat(n).map(function(l,p){return l=nJ(l),!a&&p?"["+l+"]":l}).join(a?".":""):n}function exe(e){return Le.isArray(e)&&!e.some(sP)}const txe=Le.toFlatObject(Le,{},null,function(n){return/^is[A-Z]/.test(n)});function Lx(e,n,a){if(!Le.isObject(e))throw new TypeError("target must be an object");n=n||new FormData,a=Le.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(L,P){return!Le.isUndefined(P[L])});const o=a.metaTokens,l=a.visitor||T,p=a.dots,m=a.indexes,E=(a.Blob||typeof Blob<"u"&&Blob)&&Le.isSpecCompliantForm(n);if(!Le.isFunction(l))throw new TypeError("visitor must be a function");function b(N){if(N===null)return"";if(Le.isDate(N))return N.toISOString();if(Le.isBoolean(N))return N.toString();if(!E&&Le.isBlob(N))throw new on("Blob is not supported. Use a Buffer instead.");return Le.isArrayBuffer(N)||Le.isTypedArray(N)?E&&typeof Blob=="function"?new Blob([N]):Buffer.from(N):N}function T(N,L,P){let U=N;if(N&&!P&&typeof N=="object"){if(Le.endsWith(L,"{}"))L=o?L:L.slice(0,-2),N=JSON.stringify(N);else if(Le.isArray(N)&&exe(N)||(Le.isFileList(N)||Le.endsWith(L,"[]"))&&(U=Le.toArray(N)))return L=nJ(L),U.forEach(function(F,H){!(Le.isUndefined(F)||F===null)&&n.append(m===!0?YH([L],H,p):m===null?L:L+"[]",b(F))}),!1}return sP(N)?!0:(n.append(YH(P,L,p),b(N)),!1)}const x=[],A=Object.assign(txe,{defaultVisitor:T,convertValue:b,isVisitable:sP});function D(N,L){if(!Le.isUndefined(N)){if(x.indexOf(N)!==-1)throw Error("Circular reference detected in "+L.join("."));x.push(N),Le.forEach(N,function(U,V){(!(Le.isUndefined(U)||U===null)&&l.call(n,U,Le.isString(V)?V.trim():V,L,A))===!0&&D(U,L?L.concat(V):[V])}),x.pop()}}if(!Le.isObject(e))throw new TypeError("data must be an object");return D(e),n}function qH(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return n[o]})}function Kk(e,n){this._pairs=[],e&&Lx(e,this,n)}const rJ=Kk.prototype;rJ.append=function(n,a){this._pairs.push([n,a])};rJ.toString=function(n){const a=n?function(o){return n.call(this,o,qH)}:qH;return this._pairs.map(function(l){return a(l[0])+"="+a(l[1])},"").join("&")};function nxe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function iJ(e,n,a){if(!n)return e;const o=a&&a.encode||nxe;Le.isFunction(a)&&(a={serialize:a});const l=a&&a.serialize;let p;if(l?p=l(n,a):p=Le.isURLSearchParams(n)?n.toString():new Kk(n,a).toString(o),p){const m=e.indexOf("#");m!==-1&&(e=e.slice(0,m)),e+=(e.indexOf("?")===-1?"?":"&")+p}return e}class XH{constructor(){this.handlers=[]}use(n,a,o){return this.handlers.push({fulfilled:n,rejected:a,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){Le.forEach(this.handlers,function(o){o!==null&&n(o)})}}const aJ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},rxe=typeof URLSearchParams<"u"?URLSearchParams:Kk,ixe=typeof FormData<"u"?FormData:null,axe=typeof Blob<"u"?Blob:null,sxe={isBrowser:!0,classes:{URLSearchParams:rxe,FormData:ixe,Blob:axe},protocols:["http","https","file","blob","url","data"]},Yk=typeof window<"u"&&typeof document<"u",oP=typeof navigator=="object"&&navigator||void 0,oxe=Yk&&(!oP||["ReactNative","NativeScript","NS"].indexOf(oP.product)<0),cxe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",lxe=Yk&&window.location.href||"http://localhost",dxe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Yk,hasStandardBrowserEnv:oxe,hasStandardBrowserWebWorkerEnv:cxe,navigator:oP,origin:lxe},Symbol.toStringTag,{value:"Module"})),ra={...dxe,...sxe};function uxe(e,n){return Lx(e,new ra.classes.URLSearchParams,{visitor:function(a,o,l,p){return ra.isNode&&Le.isBuffer(a)?(this.append(o,a.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)},...n})}function hxe(e){return Le.matchAll(/\w+|\[(\w*)]/g,e).map(n=>n[0]==="[]"?"":n[1]||n[0])}function pxe(e){const n={},a=Object.keys(e);let o;const l=a.length;let p;for(o=0;o<l;o++)p=a[o],n[p]=e[p];return n}function sJ(e){function n(a,o,l,p){let m=a[p++];if(m==="__proto__")return!0;const y=Number.isFinite(+m),E=p>=a.length;return m=!m&&Le.isArray(l)?l.length:m,E?(Le.hasOwnProp(l,m)?l[m]=[l[m],o]:l[m]=o,!y):((!l[m]||!Le.isObject(l[m]))&&(l[m]=[]),n(a,o,l[m],p)&&Le.isArray(l[m])&&(l[m]=pxe(l[m])),!y)}if(Le.isFormData(e)&&Le.isFunction(e.entries)){const a={};return Le.forEachEntry(e,(o,l)=>{n(hxe(o),l,a,0)}),a}return null}function fxe(e,n,a){if(Le.isString(e))try{return(n||JSON.parse)(e),Le.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(a||JSON.stringify)(e)}const S_={transitional:aJ,adapter:["xhr","http","fetch"],transformRequest:[function(n,a){const o=a.getContentType()||"",l=o.indexOf("application/json")>-1,p=Le.isObject(n);if(p&&Le.isHTMLForm(n)&&(n=new FormData(n)),Le.isFormData(n))return l?JSON.stringify(sJ(n)):n;if(Le.isArrayBuffer(n)||Le.isBuffer(n)||Le.isStream(n)||Le.isFile(n)||Le.isBlob(n)||Le.isReadableStream(n))return n;if(Le.isArrayBufferView(n))return n.buffer;if(Le.isURLSearchParams(n))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let y;if(p){if(o.indexOf("application/x-www-form-urlencoded")>-1)return uxe(n,this.formSerializer).toString();if((y=Le.isFileList(n))||o.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return Lx(y?{"files[]":n}:n,E&&new E,this.formSerializer)}}return p||l?(a.setContentType("application/json",!1),fxe(n)):n}],transformResponse:[function(n){const a=this.transitional||S_.transitional,o=a&&a.forcedJSONParsing,l=this.responseType==="json";if(Le.isResponse(n)||Le.isReadableStream(n))return n;if(n&&Le.isString(n)&&(o&&!this.responseType||l)){const m=!(a&&a.silentJSONParsing)&&l;try{return JSON.parse(n,this.parseReviver)}catch(y){if(m)throw y.name==="SyntaxError"?on.from(y,on.ERR_BAD_RESPONSE,this,null,this.response):y}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ra.classes.FormData,Blob:ra.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Le.forEach(["delete","get","head","post","put","patch"],e=>{S_.headers[e]={}});const mxe=Le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),gxe=e=>{const n={};let a,o,l;return e&&e.split(`
`).forEach(function(m){l=m.indexOf(":"),a=m.substring(0,l).trim().toLowerCase(),o=m.substring(l+1).trim(),!(!a||n[a]&&mxe[a])&&(a==="set-cookie"?n[a]?n[a].push(o):n[a]=[o]:n[a]=n[a]?n[a]+", "+o:o)}),n},JH=Symbol("internals");function Pv(e){return e&&String(e).trim().toLowerCase()}function AS(e){return e===!1||e==null?e:Le.isArray(e)?e.map(AS):String(e)}function vxe(e){const n=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=a.exec(e);)n[o[1]]=o[2];return n}const yxe=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function wI(e,n,a,o,l){if(Le.isFunction(o))return o.call(this,n,a);if(l&&(n=a),!!Le.isString(n)){if(Le.isString(o))return n.indexOf(o)!==-1;if(Le.isRegExp(o))return o.test(n)}}function _xe(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,a,o)=>a.toUpperCase()+o)}function Exe(e,n){const a=Le.toCamelCase(" "+n);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+a,{value:function(l,p,m){return this[o].call(this,n,l,p,m)},configurable:!0})})}let $a=class{constructor(n){n&&this.set(n)}set(n,a,o){const l=this;function p(y,E,b){const T=Pv(E);if(!T)throw new Error("header name must be a non-empty string");const x=Le.findKey(l,T);(!x||l[x]===void 0||b===!0||b===void 0&&l[x]!==!1)&&(l[x||E]=AS(y))}const m=(y,E)=>Le.forEach(y,(b,T)=>p(b,T,E));if(Le.isPlainObject(n)||n instanceof this.constructor)m(n,a);else if(Le.isString(n)&&(n=n.trim())&&!yxe(n))m(gxe(n),a);else if(Le.isObject(n)&&Le.isIterable(n)){let y={},E,b;for(const T of n){if(!Le.isArray(T))throw TypeError("Object iterator must return a key-value pair");y[b=T[0]]=(E=y[b])?Le.isArray(E)?[...E,T[1]]:[E,T[1]]:T[1]}m(y,a)}else n!=null&&p(a,n,o);return this}get(n,a){if(n=Pv(n),n){const o=Le.findKey(this,n);if(o){const l=this[o];if(!a)return l;if(a===!0)return vxe(l);if(Le.isFunction(a))return a.call(this,l,o);if(Le.isRegExp(a))return a.exec(l);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,a){if(n=Pv(n),n){const o=Le.findKey(this,n);return!!(o&&this[o]!==void 0&&(!a||wI(this,this[o],o,a)))}return!1}delete(n,a){const o=this;let l=!1;function p(m){if(m=Pv(m),m){const y=Le.findKey(o,m);y&&(!a||wI(o,o[y],y,a))&&(delete o[y],l=!0)}}return Le.isArray(n)?n.forEach(p):p(n),l}clear(n){const a=Object.keys(this);let o=a.length,l=!1;for(;o--;){const p=a[o];(!n||wI(this,this[p],p,n,!0))&&(delete this[p],l=!0)}return l}normalize(n){const a=this,o={};return Le.forEach(this,(l,p)=>{const m=Le.findKey(o,p);if(m){a[m]=AS(l),delete a[p];return}const y=n?_xe(p):String(p).trim();y!==p&&delete a[p],a[y]=AS(l),o[y]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const a=Object.create(null);return Le.forEach(this,(o,l)=>{o!=null&&o!==!1&&(a[l]=n&&Le.isArray(o)?o.join(", "):o)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,a])=>n+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...a){const o=new this(n);return a.forEach(l=>o.set(l)),o}static accessor(n){const o=(this[JH]=this[JH]={accessors:{}}).accessors,l=this.prototype;function p(m){const y=Pv(m);o[y]||(Exe(l,m),o[y]=!0)}return Le.isArray(n)?n.forEach(p):p(n),this}};$a.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Le.reduceDescriptors($a.prototype,({value:e},n)=>{let a=n[0].toUpperCase()+n.slice(1);return{get:()=>e,set(o){this[a]=o}}});Le.freezeMethods($a);function xI(e,n){const a=this||S_,o=n||a,l=$a.from(o.headers);let p=o.data;return Le.forEach(e,function(y){p=y.call(a,p,l.normalize(),n?n.status:void 0)}),l.normalize(),p}function oJ(e){return!!(e&&e.__CANCEL__)}function Pm(e,n,a){on.call(this,e??"canceled",on.ERR_CANCELED,n,a),this.name="CanceledError"}Le.inherits(Pm,on,{__CANCEL__:!0});function cJ(e,n,a){const o=a.config.validateStatus;!a.status||!o||o(a.status)?e(a):n(new on("Request failed with status code "+a.status,[on.ERR_BAD_REQUEST,on.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function bxe(e){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return n&&n[1]||""}function Sxe(e,n){e=e||10;const a=new Array(e),o=new Array(e);let l=0,p=0,m;return n=n!==void 0?n:1e3,function(E){const b=Date.now(),T=o[p];m||(m=b),a[l]=E,o[l]=b;let x=p,A=0;for(;x!==l;)A+=a[x++],x=x%e;if(l=(l+1)%e,l===p&&(p=(p+1)%e),b-m<n)return;const D=T&&b-T;return D?Math.round(A*1e3/D):void 0}}function wxe(e,n){let a=0,o=1e3/n,l,p;const m=(b,T=Date.now())=>{a=T,l=null,p&&(clearTimeout(p),p=null),e(...b)};return[(...b)=>{const T=Date.now(),x=T-a;x>=o?m(b,T):(l=b,p||(p=setTimeout(()=>{p=null,m(l)},o-x)))},()=>l&&m(l)]}const iw=(e,n,a=3)=>{let o=0;const l=Sxe(50,250);return wxe(p=>{const m=p.loaded,y=p.lengthComputable?p.total:void 0,E=m-o,b=l(E),T=m<=y;o=m;const x={loaded:m,total:y,progress:y?m/y:void 0,bytes:E,rate:b||void 0,estimated:b&&y&&T?(y-m)/b:void 0,event:p,lengthComputable:y!=null,[n?"download":"upload"]:!0};e(x)},a)},QH=(e,n)=>{const a=e!=null;return[o=>n[0]({lengthComputable:a,total:e,loaded:o}),n[1]]},ZH=e=>(...n)=>Le.asap(()=>e(...n)),xxe=ra.hasStandardBrowserEnv?((e,n)=>a=>(a=new URL(a,ra.origin),e.protocol===a.protocol&&e.host===a.host&&(n||e.port===a.port)))(new URL(ra.origin),ra.navigator&&/(msie|trident)/i.test(ra.navigator.userAgent)):()=>!0,Txe=ra.hasStandardBrowserEnv?{write(e,n,a,o,l,p,m){if(typeof document>"u")return;const y=[`${e}=${encodeURIComponent(n)}`];Le.isNumber(a)&&y.push(`expires=${new Date(a).toUTCString()}`),Le.isString(o)&&y.push(`path=${o}`),Le.isString(l)&&y.push(`domain=${l}`),p===!0&&y.push("secure"),Le.isString(m)&&y.push(`SameSite=${m}`),document.cookie=y.join("; ")},read(e){if(typeof document>"u")return null;const n=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return n?decodeURIComponent(n[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Cxe(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Rxe(e,n){return n?e.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):e}function lJ(e,n,a){let o=!Cxe(n);return e&&(o||a==!1)?Rxe(e,n):n}const ez=e=>e instanceof $a?{...e}:e;function Th(e,n){n=n||{};const a={};function o(b,T,x,A){return Le.isPlainObject(b)&&Le.isPlainObject(T)?Le.merge.call({caseless:A},b,T):Le.isPlainObject(T)?Le.merge({},T):Le.isArray(T)?T.slice():T}function l(b,T,x,A){if(Le.isUndefined(T)){if(!Le.isUndefined(b))return o(void 0,b,x,A)}else return o(b,T,x,A)}function p(b,T){if(!Le.isUndefined(T))return o(void 0,T)}function m(b,T){if(Le.isUndefined(T)){if(!Le.isUndefined(b))return o(void 0,b)}else return o(void 0,T)}function y(b,T,x){if(x in n)return o(b,T);if(x in e)return o(void 0,b)}const E={url:p,method:p,data:p,baseURL:m,transformRequest:m,transformResponse:m,paramsSerializer:m,timeout:m,timeoutMessage:m,withCredentials:m,withXSRFToken:m,adapter:m,responseType:m,xsrfCookieName:m,xsrfHeaderName:m,onUploadProgress:m,onDownloadProgress:m,decompress:m,maxContentLength:m,maxBodyLength:m,beforeRedirect:m,transport:m,httpAgent:m,httpsAgent:m,cancelToken:m,socketPath:m,responseEncoding:m,validateStatus:y,headers:(b,T,x)=>l(ez(b),ez(T),x,!0)};return Le.forEach(Object.keys({...e,...n}),function(T){const x=E[T]||l,A=x(e[T],n[T],T);Le.isUndefined(A)&&x!==y||(a[T]=A)}),a}const dJ=e=>{const n=Th({},e);let{data:a,withXSRFToken:o,xsrfHeaderName:l,xsrfCookieName:p,headers:m,auth:y}=n;if(n.headers=m=$a.from(m),n.url=iJ(lJ(n.baseURL,n.url,n.allowAbsoluteUrls),e.params,e.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),Le.isFormData(a)){if(ra.hasStandardBrowserEnv||ra.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if(Le.isFunction(a.getHeaders)){const E=a.getHeaders(),b=["content-type","content-length"];Object.entries(E).forEach(([T,x])=>{b.includes(T.toLowerCase())&&m.set(T,x)})}}if(ra.hasStandardBrowserEnv&&(o&&Le.isFunction(o)&&(o=o(n)),o||o!==!1&&xxe(n.url))){const E=l&&p&&Txe.read(p);E&&m.set(l,E)}return n},Axe=typeof XMLHttpRequest<"u",Nxe=Axe&&function(e){return new Promise(function(a,o){const l=dJ(e);let p=l.data;const m=$a.from(l.headers).normalize();let{responseType:y,onUploadProgress:E,onDownloadProgress:b}=l,T,x,A,D,N;function L(){D&&D(),N&&N(),l.cancelToken&&l.cancelToken.unsubscribe(T),l.signal&&l.signal.removeEventListener("abort",T)}let P=new XMLHttpRequest;P.open(l.method.toUpperCase(),l.url,!0),P.timeout=l.timeout;function U(){if(!P)return;const F=$a.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders()),B={data:!y||y==="text"||y==="json"?P.responseText:P.response,status:P.status,statusText:P.statusText,headers:F,config:e,request:P};cJ(function(Y){a(Y),L()},function(Y){o(Y),L()},B),P=null}"onloadend"in P?P.onloadend=U:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(U)},P.onabort=function(){P&&(o(new on("Request aborted",on.ECONNABORTED,e,P)),P=null)},P.onerror=function(H){const B=H&&H.message?H.message:"Network Error",z=new on(B,on.ERR_NETWORK,e,P);z.event=H||null,o(z),P=null},P.ontimeout=function(){let H=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded";const B=l.transitional||aJ;l.timeoutErrorMessage&&(H=l.timeoutErrorMessage),o(new on(H,B.clarifyTimeoutError?on.ETIMEDOUT:on.ECONNABORTED,e,P)),P=null},p===void 0&&m.setContentType(null),"setRequestHeader"in P&&Le.forEach(m.toJSON(),function(H,B){P.setRequestHeader(B,H)}),Le.isUndefined(l.withCredentials)||(P.withCredentials=!!l.withCredentials),y&&y!=="json"&&(P.responseType=l.responseType),b&&([A,N]=iw(b,!0),P.addEventListener("progress",A)),E&&P.upload&&([x,D]=iw(E),P.upload.addEventListener("progress",x),P.upload.addEventListener("loadend",D)),(l.cancelToken||l.signal)&&(T=F=>{P&&(o(!F||F.type?new Pm(null,e,P):F),P.abort(),P=null)},l.cancelToken&&l.cancelToken.subscribe(T),l.signal&&(l.signal.aborted?T():l.signal.addEventListener("abort",T)));const V=bxe(l.url);if(V&&ra.protocols.indexOf(V)===-1){o(new on("Unsupported protocol "+V+":",on.ERR_BAD_REQUEST,e));return}P.send(p||null)})},Oxe=(e,n)=>{const{length:a}=e=e?e.filter(Boolean):[];if(n||a){let o=new AbortController,l;const p=function(b){if(!l){l=!0,y();const T=b instanceof Error?b:this.reason;o.abort(T instanceof on?T:new Pm(T instanceof Error?T.message:T))}};let m=n&&setTimeout(()=>{m=null,p(new on(`timeout ${n} of ms exceeded`,on.ETIMEDOUT))},n);const y=()=>{e&&(m&&clearTimeout(m),m=null,e.forEach(b=>{b.unsubscribe?b.unsubscribe(p):b.removeEventListener("abort",p)}),e=null)};e.forEach(b=>b.addEventListener("abort",p));const{signal:E}=o;return E.unsubscribe=()=>Le.asap(y),E}},Ixe=function*(e,n){let a=e.byteLength;if(a<n){yield e;return}let o=0,l;for(;o<a;)l=o+n,yield e.slice(o,l),o=l},Pxe=async function*(e,n){for await(const a of Dxe(e))yield*Ixe(a,n)},Dxe=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const n=e.getReader();try{for(;;){const{done:a,value:o}=await n.read();if(a)break;yield o}}finally{await n.cancel()}},tz=(e,n,a,o)=>{const l=Pxe(e,n);let p=0,m,y=E=>{m||(m=!0,o&&o(E))};return new ReadableStream({async pull(E){try{const{done:b,value:T}=await l.next();if(b){y(),E.close();return}let x=T.byteLength;if(a){let A=p+=x;a(A)}E.enqueue(new Uint8Array(T))}catch(b){throw y(b),b}},cancel(E){return y(E),l.return()}},{highWaterMark:2})},nz=64*1024,{isFunction:Jb}=Le,kxe=(({Request:e,Response:n})=>({Request:e,Response:n}))(Le.global),{ReadableStream:rz,TextEncoder:iz}=Le.global,az=(e,...n)=>{try{return!!e(...n)}catch{return!1}},Lxe=e=>{e=Le.merge.call({skipUndefined:!0},kxe,e);const{fetch:n,Request:a,Response:o}=e,l=n?Jb(n):typeof fetch=="function",p=Jb(a),m=Jb(o);if(!l)return!1;const y=l&&Jb(rz),E=l&&(typeof iz=="function"?(N=>L=>N.encode(L))(new iz):async N=>new Uint8Array(await new a(N).arrayBuffer())),b=p&&y&&az(()=>{let N=!1;const L=new a(ra.origin,{body:new rz,method:"POST",get duplex(){return N=!0,"half"}}).headers.has("Content-Type");return N&&!L}),T=m&&y&&az(()=>Le.isReadableStream(new o("").body)),x={stream:T&&(N=>N.body)};l&&["text","arrayBuffer","blob","formData","stream"].forEach(N=>{!x[N]&&(x[N]=(L,P)=>{let U=L&&L[N];if(U)return U.call(L);throw new on(`Response type '${N}' is not supported`,on.ERR_NOT_SUPPORT,P)})});const A=async N=>{if(N==null)return 0;if(Le.isBlob(N))return N.size;if(Le.isSpecCompliantForm(N))return(await new a(ra.origin,{method:"POST",body:N}).arrayBuffer()).byteLength;if(Le.isArrayBufferView(N)||Le.isArrayBuffer(N))return N.byteLength;if(Le.isURLSearchParams(N)&&(N=N+""),Le.isString(N))return(await E(N)).byteLength},D=async(N,L)=>{const P=Le.toFiniteNumber(N.getContentLength());return P??A(L)};return async N=>{let{url:L,method:P,data:U,signal:V,cancelToken:F,timeout:H,onDownloadProgress:B,onUploadProgress:z,responseType:Y,headers:Q,withCredentials:re="same-origin",fetchOptions:de}=dJ(N),le=n||fetch;Y=Y?(Y+"").toLowerCase():"text";let he=Oxe([V,F&&F.toAbortSignal()],H),Re=null;const ve=he&&he.unsubscribe&&(()=>{he.unsubscribe()});let we;try{if(z&&b&&P!=="get"&&P!=="head"&&(we=await D(Q,U))!==0){let je=new a(L,{method:"POST",body:U,duplex:"half"}),fe;if(Le.isFormData(U)&&(fe=je.headers.get("content-type"))&&Q.setContentType(fe),je.body){const[He,Ye]=QH(we,iw(ZH(z)));U=tz(je.body,nz,He,Ye)}}Le.isString(re)||(re=re?"include":"omit");const ue=p&&"credentials"in a.prototype,be={...de,signal:he,method:P.toUpperCase(),headers:Q.normalize().toJSON(),body:U,duplex:"half",credentials:ue?re:void 0};Re=p&&new a(L,be);let ae=await(p?le(Re,de):le(L,be));const ce=T&&(Y==="stream"||Y==="response");if(T&&(B||ce&&ve)){const je={};["status","statusText","headers"].forEach(gt=>{je[gt]=ae[gt]});const fe=Le.toFiniteNumber(ae.headers.get("content-length")),[He,Ye]=B&&QH(fe,iw(ZH(B),!0))||[];ae=new o(tz(ae.body,nz,He,()=>{Ye&&Ye(),ve&&ve()}),je)}Y=Y||"text";let Se=await x[Le.findKey(x,Y)||"text"](ae,N);return!ce&&ve&&ve(),await new Promise((je,fe)=>{cJ(je,fe,{data:Se,headers:$a.from(ae.headers),status:ae.status,statusText:ae.statusText,config:N,request:Re})})}catch(ue){throw ve&&ve(),ue&&ue.name==="TypeError"&&/Load failed|fetch/i.test(ue.message)?Object.assign(new on("Network Error",on.ERR_NETWORK,N,Re),{cause:ue.cause||ue}):on.from(ue,ue&&ue.code,N,Re)}}},jxe=new Map,uJ=e=>{let n=e&&e.env||{};const{fetch:a,Request:o,Response:l}=n,p=[o,l,a];let m=p.length,y=m,E,b,T=jxe;for(;y--;)E=p[y],b=T.get(E),b===void 0&&T.set(E,b=y?new Map:Lxe(n)),T=b;return b};uJ();const qk={http:Zwe,xhr:Nxe,fetch:{get:uJ}};Le.forEach(qk,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const sz=e=>`- ${e}`,Mxe=e=>Le.isFunction(e)||e===null||e===!1;function Uxe(e,n){e=Le.isArray(e)?e:[e];const{length:a}=e;let o,l;const p={};for(let m=0;m<a;m++){o=e[m];let y;if(l=o,!Mxe(o)&&(l=qk[(y=String(o)).toLowerCase()],l===void 0))throw new on(`Unknown adapter '${y}'`);if(l&&(Le.isFunction(l)||(l=l.get(n))))break;p[y||"#"+m]=l}if(!l){const m=Object.entries(p).map(([E,b])=>`adapter ${E} `+(b===!1?"is not supported by the environment":"is not available in the build"));let y=a?m.length>1?`since :
`+m.map(sz).join(`
`):" "+sz(m[0]):"as no adapter specified";throw new on("There is no suitable adapter to dispatch the request "+y,"ERR_NOT_SUPPORT")}return l}const hJ={getAdapter:Uxe,adapters:qk};function TI(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Pm(null,e)}function oz(e){return TI(e),e.headers=$a.from(e.headers),e.data=xI.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),hJ.getAdapter(e.adapter||S_.adapter,e)(e).then(function(o){return TI(e),o.data=xI.call(e,e.transformResponse,o),o.headers=$a.from(o.headers),o},function(o){return oJ(o)||(TI(e),o&&o.response&&(o.response.data=xI.call(e,e.transformResponse,o.response),o.response.headers=$a.from(o.response.headers))),Promise.reject(o)})}const pJ="1.13.2",jx={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{jx[e]=function(o){return typeof o===e||"a"+(n<1?"n ":" ")+e}});const cz={};jx.transitional=function(n,a,o){function l(p,m){return"[Axios v"+pJ+"] Transitional option '"+p+"'"+m+(o?". "+o:"")}return(p,m,y)=>{if(n===!1)throw new on(l(m," has been removed"+(a?" in "+a:"")),on.ERR_DEPRECATED);return a&&!cz[m]&&(cz[m]=!0,console.warn(l(m," has been deprecated since v"+a+" and will be removed in the near future"))),n?n(p,m,y):!0}};jx.spelling=function(n){return(a,o)=>(console.warn(`${o} is likely a misspelling of ${n}`),!0)};function Vxe(e,n,a){if(typeof e!="object")throw new on("options must be an object",on.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let l=o.length;for(;l-- >0;){const p=o[l],m=n[p];if(m){const y=e[p],E=y===void 0||m(y,p,e);if(E!==!0)throw new on("option "+p+" must be "+E,on.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new on("Unknown option "+p,on.ERR_BAD_OPTION)}}const NS={assertOptions:Vxe,validators:jx},Sc=NS.validators;let fh=class{constructor(n){this.defaults=n||{},this.interceptors={request:new XH,response:new XH}}async request(n,a){try{return await this._request(n,a)}catch(o){if(o instanceof Error){let l={};Error.captureStackTrace?Error.captureStackTrace(l):l=new Error;const p=l.stack?l.stack.replace(/^.+\n/,""):"";try{o.stack?p&&!String(o.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+p):o.stack=p}catch{}}throw o}}_request(n,a){typeof n=="string"?(a=a||{},a.url=n):a=n||{},a=Th(this.defaults,a);const{transitional:o,paramsSerializer:l,headers:p}=a;o!==void 0&&NS.assertOptions(o,{silentJSONParsing:Sc.transitional(Sc.boolean),forcedJSONParsing:Sc.transitional(Sc.boolean),clarifyTimeoutError:Sc.transitional(Sc.boolean)},!1),l!=null&&(Le.isFunction(l)?a.paramsSerializer={serialize:l}:NS.assertOptions(l,{encode:Sc.function,serialize:Sc.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),NS.assertOptions(a,{baseUrl:Sc.spelling("baseURL"),withXsrfToken:Sc.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let m=p&&Le.merge(p.common,p[a.method]);p&&Le.forEach(["delete","get","head","post","put","patch","common"],N=>{delete p[N]}),a.headers=$a.concat(m,p);const y=[];let E=!0;this.interceptors.request.forEach(function(L){typeof L.runWhen=="function"&&L.runWhen(a)===!1||(E=E&&L.synchronous,y.unshift(L.fulfilled,L.rejected))});const b=[];this.interceptors.response.forEach(function(L){b.push(L.fulfilled,L.rejected)});let T,x=0,A;if(!E){const N=[oz.bind(this),void 0];for(N.unshift(...y),N.push(...b),A=N.length,T=Promise.resolve(a);x<A;)T=T.then(N[x++],N[x++]);return T}A=y.length;let D=a;for(;x<A;){const N=y[x++],L=y[x++];try{D=N(D)}catch(P){L.call(this,P);break}}try{T=oz.call(this,D)}catch(N){return Promise.reject(N)}for(x=0,A=b.length;x<A;)T=T.then(b[x++],b[x++]);return T}getUri(n){n=Th(this.defaults,n);const a=lJ(n.baseURL,n.url,n.allowAbsoluteUrls);return iJ(a,n.params,n.paramsSerializer)}};Le.forEach(["delete","get","head","options"],function(n){fh.prototype[n]=function(a,o){return this.request(Th(o||{},{method:n,url:a,data:(o||{}).data}))}});Le.forEach(["post","put","patch"],function(n){function a(o){return function(p,m,y){return this.request(Th(y||{},{method:n,headers:o?{"Content-Type":"multipart/form-data"}:{},url:p,data:m}))}}fh.prototype[n]=a(),fh.prototype[n+"Form"]=a(!0)});let Fxe=class fJ{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(p){a=p});const o=this;this.promise.then(l=>{if(!o._listeners)return;let p=o._listeners.length;for(;p-- >0;)o._listeners[p](l);o._listeners=null}),this.promise.then=l=>{let p;const m=new Promise(y=>{o.subscribe(y),p=y}).then(l);return m.cancel=function(){o.unsubscribe(p)},m},n(function(p,m,y){o.reason||(o.reason=new Pm(p,m,y),a(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const a=this._listeners.indexOf(n);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const n=new AbortController,a=o=>{n.abort(o)};return this.subscribe(a),n.signal.unsubscribe=()=>this.unsubscribe(a),n.signal}static source(){let n;return{token:new fJ(function(l){n=l}),cancel:n}}};function Bxe(e){return function(a){return e.apply(null,a)}}function Wxe(e){return Le.isObject(e)&&e.isAxiosError===!0}const cP={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(cP).forEach(([e,n])=>{cP[n]=e});function mJ(e){const n=new fh(e),a=zX(fh.prototype.request,n);return Le.extend(a,fh.prototype,n,{allOwnKeys:!0}),Le.extend(a,n,null,{allOwnKeys:!0}),a.create=function(l){return mJ(Th(e,l))},a}const qr=mJ(S_);qr.Axios=fh;qr.CanceledError=Pm;qr.CancelToken=Fxe;qr.isCancel=oJ;qr.VERSION=pJ;qr.toFormData=Lx;qr.AxiosError=on;qr.Cancel=qr.CanceledError;qr.all=function(n){return Promise.all(n)};qr.spread=Bxe;qr.isAxiosError=Wxe;qr.mergeConfig=Th;qr.AxiosHeaders=$a;qr.formToJSON=e=>sJ(Le.isHTMLForm(e)?new FormData(e):e);qr.getAdapter=hJ.getAdapter;qr.HttpStatusCode=cP;qr.default=qr;const{Axios:rKe,AxiosError:iKe,CanceledError:aKe,isCancel:sKe,CancelToken:oKe,VERSION:cKe,all:lKe,Cancel:dKe,isAxiosError:uKe,spread:hKe,toFormData:pKe,AxiosHeaders:fKe,HttpStatusCode:mKe,formToJSON:gKe,getAdapter:vKe,mergeConfig:yKe}=qr,ct=qr.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});ct.interceptors.request.use(e=>{const n=localStorage.getItem("token");return n&&(e.headers.Authorization=`Bearer ${n}`),e});ct.interceptors.response.use(e=>e,e=>{var n;return((n=e.response)==null?void 0:n.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});const mh={uploadReport:e=>ct.post("/health/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),getReports:()=>ct.get("/health/reports"),getReport:e=>ct.get(`/health/reports/${e}`),getDashboard:()=>ct.get("/health/dashboard"),getHistory:e=>ct.get("/health/history",{params:{reportType:e}}),compareReport:e=>ct.get(`/health/reports/${e}/compare`),chatAboutReport:(e,n,a)=>ct.post(`/health/reports/${e}/chat`,{message:n,chatHistory:a}),askAI:e=>ct.post("/health/ai-chat",e)},Ua={getAll:e=>ct.get("/doctors",{params:e}),getById:e=>ct.get(`/doctors/${e}`),getRecommended:e=>ct.get("/doctors/recommended",{params:{specializations:e}}),bookAppointment:e=>ct.post("/doctors/book",e),getAppointments:()=>ct.get("/doctors/appointments"),getAppointment:e=>ct.get(`/doctors/appointments/${e}`),startConsultation:e=>ct.post(`/doctors/appointments/${e}/start`),endConsultation:e=>ct.post(`/doctors/appointments/${e}/end`),getConsultationSummary:e=>ct.get(`/doctors/appointments/${e}/summary`),submitReview:(e,n)=>ct.post(`/doctors/appointments/${e}/review`,n),downloadPrescription:e=>ct.get(`/doctors/appointments/${e}/prescription`,{responseType:"blob"}),getDashboard:()=>ct.get("/doctors/me/dashboard"),getMyProfile:()=>ct.get("/doctors/me/profile"),updateMyProfile:e=>ct.put("/doctors/me/profile",e),getMyAppointments:e=>ct.get("/doctors/me/appointments",{params:e}),updateAppointmentStatus:(e,n)=>ct.patch(`/doctors/me/appointments/${e}`,n),getPatientProfile:(e,n)=>ct.get(`/doctors/patient/${e}`,{params:{appointmentId:n}}),getDoctorAppointments:(e,n)=>ct.get(`/doctors/${e}/appointments`,{params:{status:n}}),getMyAvailability:()=>ct.get("/doctors/me/availability"),updateMyAvailability:e=>ct.put("/doctors/me/availability",e),generateTimeSlots:()=>ct.post("/doctors/me/generate-slots"),getDoctorAvailableSlots:(e,n)=>ct.get(`/doctors/${e}/available-slots`,{params:{date:n}}),checkSlotAvailability:(e,n,a)=>ct.get(`/doctors/${e}/check-slot`,{params:{date:n,timeSlot:a}})},_d={connectDevice:(e,n)=>ct.post("/wearables/connect",{deviceType:e,deviceName:n}),disconnectDevice:e=>ct.post(`/wearables/disconnect/${e}`),getDevices:()=>ct.get("/wearables/devices"),syncMetrics:(e,n)=>ct.post("/wearables/sync",{deviceType:e,metrics:n}),addHeartRate:(e,n,a)=>ct.post("/wearables/heart-rate",{deviceType:e,bpm:n,type:a}),addSleepData:(e,n)=>ct.post("/wearables/sleep",{deviceType:e,sleepData:n}),getDashboard:()=>ct.get("/wearables/dashboard"),generateDemoData:e=>ct.post("/wearables/demo-data",{deviceType:e})},OS={getStats:()=>ct.get("/admin/stats"),getUsers:e=>ct.get("/admin/users",{params:e}),getUserDetails:e=>ct.get(`/admin/users/${e}`),updateUserStatus:(e,n)=>ct.patch(`/admin/users/${e}/status`,{isActive:n}),getReports:e=>ct.get("/admin/reports",{params:e}),getDeficiencyRules:()=>ct.get("/admin/deficiency-rules"),createDeficiencyRule:e=>ct.post("/admin/deficiency-rules",e),updateDeficiencyRule:(e,n)=>ct.put(`/admin/deficiency-rules/${e}`,n),deleteDeficiencyRule:e=>ct.delete(`/admin/deficiency-rules/${e}`),getSupplements:()=>ct.get("/admin/supplements"),createSupplement:e=>ct.post("/admin/supplements",e),updateSupplement:(e,n)=>ct.put(`/admin/supplements/${e}`,n),deleteSupplement:e=>ct.delete(`/admin/supplements/${e}`),getDietPlans:e=>ct.get("/admin/diet-plans",{params:e}),createDietPlan:e=>ct.post("/admin/diet-plans",e),updateDietPlan:(e,n)=>ct.put(`/admin/diet-plans/${e}`,n),approveDietPlan:(e,n)=>ct.patch(`/admin/diet-plans/${e}/approve`,{status:n}),deleteDietPlan:e=>ct.delete(`/admin/diet-plans/${e}`),getDoctors:e=>ct.get("/admin/doctors",{params:e}),createDoctor:e=>ct.post("/admin/doctors",e),updateDoctor:(e,n)=>ct.put(`/admin/doctors/${e}`,n),approveDoctor:e=>ct.patch(`/admin/doctors/${e}/approve`),rejectDoctor:(e,n)=>ct.patch(`/admin/doctors/${e}/reject`,{reason:n}),deleteDoctor:e=>ct.delete(`/admin/doctors/${e}`),toggleDoctorVisibility:e=>ct.patch(`/admin/doctors/${e}/visibility`),getDoctorScheduleOverview:e=>ct.get(`/admin/doctors/${e}/schedule-overview`)},Gxe={getSubscription:()=>ct.get("/auth/subscription")},gJ=J.createContext(),Ha=()=>J.useContext(gJ),$xe=({children:e})=>{const[n,a]=J.useState(null),[o,l]=J.useState(!0);J.useEffect(()=>{const L=localStorage.getItem("token"),P=localStorage.getItem("user");L&&P&&(a(JSON.parse(P)),ct.defaults.headers.common.Authorization=`Bearer ${L}`),l(!1)},[]);const p=async(L,P)=>{const V=L.includes("@")?{email:L,password:P}:{phone:L,password:P},{data:F}=await ct.post("/auth/login",V);return localStorage.setItem("token",F.token),localStorage.setItem("user",JSON.stringify(F)),ct.defaults.headers.common.Authorization=`Bearer ${F.token}`,a(F),F},m=async(L,P,U,V={})=>{const{data:F}=await ct.post("/auth/register",{name:L,email:P,password:U,profile:V});return localStorage.setItem("token",F.token),localStorage.setItem("user",JSON.stringify(F)),ct.defaults.headers.common.Authorization=`Bearer ${F.token}`,a(F),F},y=async L=>{const{data:P}=await ct.post("/auth/register/doctor",L);return localStorage.setItem("token",P.token),localStorage.setItem("user",JSON.stringify(P)),ct.defaults.headers.common.Authorization=`Bearer ${P.token}`,a(P),P},E=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),delete ct.defaults.headers.common.Authorization,a(null)},b=L=>{a(L),localStorage.setItem("user",JSON.stringify(L))},T=()=>(n==null?void 0:n.role)==="admin",x=()=>(n==null?void 0:n.role)==="doctor",A=()=>(n==null?void 0:n.role)==="patient"||(n==null?void 0:n.role)==="client",D=()=>{var L;return((L=n==null?void 0:n.doctorProfile)==null?void 0:L.approvalStatus)==="approved"},N=()=>{var L;return((L=n==null?void 0:n.subscription)==null?void 0:L.status)==="active"};return h.jsx(gJ.Provider,{value:{user:n,login:p,register:m,registerDoctor:y,logout:E,updateUser:b,loading:o,isAdmin:T,isDoctor:x,isPatient:A,isDoctorApproved:D,isSubscribed:N},children:e})};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Hxe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zxe=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ze=(e,n)=>{const a=J.forwardRef(({color:o="currentColor",size:l=24,strokeWidth:p=2,absoluteStrokeWidth:m,className:y="",children:E,...b},T)=>J.createElement("svg",{ref:T,...Hxe,width:l,height:l,stroke:o,strokeWidth:m?Number(p)*24/Number(l):p,className:["lucide",`lucide-${zxe(e)}`,y].join(" "),...b},[...n.map(([x,A])=>J.createElement(x,A)),...Array.isArray(E)?E:[E]]));return a.displayName=`${e}`,a};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=Ze("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kc=Ze("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mx=Ze("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=Ze("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=Ze("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=Ze("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kxe=Ze("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vJ=Ze("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yJ=Ze("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yxe=Ze("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qxe=Ze("Bone",[["path",{d:"M17 10c.7-.7 1.69 0 2.5 0a2.5 2.5 0 1 0 0-5 .5.5 0 0 1-.5-.5 2.5 2.5 0 1 0-5 0c0 .81.7 1.8 0 2.5l-7 7c-.7.7-1.69 0-2.5 0a2.5 2.5 0 0 0 0 5c.28 0 .5.22.5.5a2.5 2.5 0 1 0 5 0c0-.81-.7-1.8 0-2.5Z",key:"w610uw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xxe=Ze("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CI=Ze("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _J=Ze("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=Ze("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EJ=Ze("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=Ze("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sh=Ze("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xk=Ze("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jxe=Ze("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qxe=Ze("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=Ze("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zxe=Ze("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eTe=Ze("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tTe=Ze("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bJ=Ze("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lP=Ze("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nTe=Ze("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jk=Ze("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lz=Ze("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SJ=Ze("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ux=Ze("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hi=Ze("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wJ=Ze("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aw=Ze("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=Ze("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rTe=Ze("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qk=Ze("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iTe=Ze("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aTe=Ze("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sTe=Ze("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dz=Ze("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uz=Ze("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dP=Ze("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xJ=Ze("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=Ze("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uP=Ze("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TJ=Ze("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hP=Ze("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vx=Ze("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CJ=Ze("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RJ=Ze("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AJ=Ze("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oTe=Ze("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fx=Ze("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cTe=Ze("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zk=Ze("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bx=Ze("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wx=Ze("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lTe=Ze("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NJ=Ze("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OJ=Ze("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sw=Ze("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dm=Ze("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=Ze("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dTe=Ze("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ny=Ze("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IJ=Ze("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pP=Ze("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=Ze("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PJ=Ze("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DJ=Ze("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uTe=Ze("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hTe=Ze("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pTe=Ze("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const em=Ze("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wo=Ze("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kJ=Ze("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=Ze("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ch=Ze("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fTe=Ze("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fP=Ze("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jd=Ze("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mTe=Ze("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gTe=Ze("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rc=Ze("Watch",[["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["polyline",{points:"12 10 12 12 13 13",key:"19dquz"}],["path",{d:"m16.13 7.66-.81-4.05a2 2 0 0 0-2-1.61h-2.68a2 2 0 0 0-2 1.61l-.78 4.05",key:"18k57s"}],["path",{d:"m7.88 16.36.8 4a2 2 0 0 0 2 1.61h2.72a2 2 0 0 0 2-1.61l.81-4.05",key:"16ny36"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LJ=Ze("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=Ze("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e2=Ze("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function vTe(){const[e,n]=J.useState(""),[a,o]=J.useState({x:0,y:0}),[l,p]=J.useState(!1),m=ro();J.useEffect(()=>{const E=()=>{const b=window.getSelection(),T=b.toString().trim();if(T.length>0){const A=b.getRangeAt(0).getBoundingClientRect();n(T),o({x:A.left+A.width/2,y:A.top-10}),p(!0)}else p(!1)};return document.addEventListener("mouseup",E),document.addEventListener("touchend",E),()=>{document.removeEventListener("mouseup",E),document.removeEventListener("touchend",E)}},[]);const y=()=>{m("/ai-chat",{state:{selectedText:e}}),p(!1)};return l?h.jsx("div",{className:"fixed z-50 animate-fade-in",style:{left:`${a.x}px`,top:`${a.y}px`,transform:"translate(-50%, -100%)"},children:h.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow-lg hover:shadow-xl transition-all text-sm font-medium",children:[h.jsx(Vx,{className:"w-4 h-4"}),"Ask AI"]})}):null}const yTe=[{path:"/dashboard",icon:Qk,label:"Dashboard"},{path:"/ai-chat",icon:Vx,label:"AI Assistant"},{path:"/doctors",icon:ga,label:"Appointments"},{path:"/upload",icon:hi,label:"My Reports"},{path:"/wearables",icon:Rc,label:"Devices"},{path:"/diet-plan",icon:gh,label:"Diet Plan"},{path:"/profile",icon:x_,label:"Profile"}],_Te=[{path:"/doctor/dashboard",icon:Qk,label:"Dashboard"},{path:"/doctor/availability",icon:gs,label:"Manage Slots"},{path:"/profile",icon:x_,label:"Profile"}],ETe=[{path:"/admin",icon:Qk,label:"Dashboard"},{path:"/profile",icon:x_,label:"Settings"}];function La({children:e,isAdmin:n,isDoctor:a}){var L,P,U,V,F,H;const{user:o,logout:l,isAdmin:p,isDoctor:m}=Ha(),y=zd(),E=ro(),[b,T]=J.useState(!1),x=()=>{l(),E("/")};let A=yTe,D="/dashboard",N="Patient Portal";return p()||n?(A=ETe,D="/admin",N="Admin Panel"):(m()||a)&&(A=_Te,D="/doctor/dashboard",N=((L=o==null?void 0:o.doctorProfile)==null?void 0:L.specialization)||"Doctor Portal"),h.jsxs("div",{className:"min-h-screen bg-slate-50 flex",children:[h.jsx("aside",{className:`fixed inset-y-0 right-0 lg:left-0 lg:right-auto z-50 w-64 bg-white border-l lg:border-r lg:border-l-0 border-slate-200 shadow-lg lg:shadow-sm transform transition-transform duration-300 ${b?"translate-x-0":"translate-x-full lg:translate-x-0"}`,children:h.jsxs("div",{className:"flex flex-col h-full",children:[h.jsx("div",{className:"p-6 border-b border-slate-100 shrink-0",children:h.jsxs(Tn,{to:D,className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center",children:h.jsx(ni,{className:"w-6 h-6 text-white"})}),h.jsxs("div",{children:[h.jsx("p",{className:"font-bold text-slate-800",children:"HealthAI"}),h.jsx("p",{className:"text-xs text-slate-500",children:N})]})]})}),h.jsx("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:A.map(({path:B,icon:z,label:Y})=>h.jsxs(Tn,{to:B,onClick:()=>T(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${y.pathname===B?"bg-cyan-50 text-cyan-600 border border-cyan-200":"text-slate-600 hover:bg-slate-50 hover:text-slate-800"}`,children:[h.jsx(z,{className:"w-5 h-5"}),h.jsx("span",{children:Y})]},B))}),h.jsx("div",{className:"p-4 border-t border-slate-100 shrink-0",children:h.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[h.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center shrink-0",children:h.jsx("span",{className:"text-white font-bold",children:(U=(P=o==null?void 0:o.name)==null?void 0:P[0])==null?void 0:U.toUpperCase()})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"text-sm font-medium text-slate-800 truncate",children:m()?`Dr. ${o==null?void 0:o.name}`:o==null?void 0:o.name}),h.jsx("p",{className:"text-xs text-slate-500 truncate",children:o==null?void 0:o.email})]}),h.jsx("button",{onClick:x,className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all shrink-0",title:"Logout",children:h.jsx(xJ,{className:"w-5 h-5"})})]})})]})}),b&&h.jsx("div",{className:"fixed inset-0 bg-black/20 z-40 lg:hidden",onClick:()=>T(!1)}),h.jsxs("div",{className:"flex-1 flex flex-col min-h-screen lg:ml-64",children:[h.jsx("header",{className:"sticky top-0 z-30 bg-white/80 backdrop-blur-xl border-b border-slate-200",children:h.jsxs("div",{className:"flex items-center justify-between px-4 lg:px-8 py-4",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("button",{onClick:()=>T(!0),className:"lg:hidden p-2 text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg",children:h.jsx(TJ,{className:"w-6 h-6"})}),h.jsx("h1",{className:"text-lg font-semibold text-slate-800 hidden sm:block",children:((V=A.find(B=>B.path===y.pathname))==null?void 0:V.label)||"Dashboard"})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"hidden md:flex items-center",children:h.jsxs("div",{className:"relative",children:[h.jsx(sw,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),h.jsx("input",{type:"text",placeholder:"Search...",className:"w-48 pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm text-slate-800 placeholder:text-slate-400 focus:outline-none focus:border-cyan-500"})]})}),h.jsxs("button",{className:"relative p-2 text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-xl transition-all",children:[h.jsx(Yxe,{className:"w-5 h-5"}),h.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"})]}),h.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center",children:h.jsx("span",{className:"text-white font-bold text-sm",children:(H=(F=o==null?void 0:o.name)==null?void 0:F[0])==null?void 0:H.toUpperCase()})})]})]})}),h.jsx("main",{className:"flex-1 p-4 lg:p-8",children:e})]}),h.jsx(vTe,{})]})}function bTe(){const[e,n]=J.useState(!1);return h.jsx("header",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200",children:h.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[h.jsxs("div",{className:"flex items-center justify-between h-16",children:[h.jsxs(Tn,{to:"/",className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-xl flex items-center justify-center",children:h.jsx(ni,{className:"w-5 h-5 text-white"})}),h.jsx("span",{className:"font-semibold text-slate-900 text-xl",children:"HealthAI"})]}),h.jsxs("nav",{className:"hidden md:flex items-center gap-8",children:[h.jsx("a",{href:"#features",className:"text-sm text-slate-600 hover:text-slate-900 transition-colors",children:"Features"}),h.jsx("a",{href:"#how-it-works",className:"text-sm text-slate-600 hover:text-slate-900 transition-colors",children:"How it works"}),h.jsx("a",{href:"#pricing",className:"text-sm text-slate-600 hover:text-slate-900 transition-colors",children:"Pricing"}),h.jsx("a",{href:"#testimonials",className:"text-sm text-slate-600 hover:text-slate-900 transition-colors",children:"Reviews"}),h.jsx("a",{href:"#faq",className:"text-sm text-slate-600 hover:text-slate-900 transition-colors",children:"FAQ"})]}),h.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[h.jsx(Tn,{to:"/login",className:"text-sm font-medium text-slate-600 hover:text-slate-900 transition-colors",children:"Log in"}),h.jsx(Tn,{to:"/register",className:"bg-blue-600 hover:bg-blue-700 text-white rounded-full px-5 py-2 text-sm font-medium transition-colors",children:"Get started"})]}),h.jsx("button",{className:"md:hidden p-2",onClick:()=>n(!e),children:e?h.jsx(zo,{className:"w-6 h-6"}):h.jsx(TJ,{className:"w-6 h-6"})})]}),e&&h.jsx("div",{className:"md:hidden py-4 border-t border-slate-200",children:h.jsxs("nav",{className:"flex flex-col gap-4",children:[h.jsx("a",{href:"#features",className:"text-sm text-slate-600 hover:text-slate-900",children:"Features"}),h.jsx("a",{href:"#how-it-works",className:"text-sm text-slate-600 hover:text-slate-900",children:"How it works"}),h.jsx("a",{href:"#pricing",className:"text-sm text-slate-600 hover:text-slate-900",children:"Pricing"}),h.jsx("a",{href:"#testimonials",className:"text-sm text-slate-600 hover:text-slate-900",children:"Reviews"}),h.jsx("a",{href:"#faq",className:"text-sm text-slate-600 hover:text-slate-900",children:"FAQ"}),h.jsxs("div",{className:"flex flex-col gap-2 pt-4",children:[h.jsx(Tn,{to:"/login",className:"text-sm font-medium text-slate-600 hover:text-slate-900 py-2",children:"Log in"}),h.jsx(Tn,{to:"/register",className:"bg-blue-600 text-white rounded-full py-2 px-4 text-sm font-medium text-center",children:"Get started"})]})]})})]})})}function STe(){const e=["https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face","https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face","https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face","https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face","https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop&crop=face"];return h.jsx("section",{className:"relative overflow-hidden pt-16 pb-20 md:pt-24 md:pb-32 bg-gradient-to-br from-slate-50 to-blue-50",children:h.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[h.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[h.jsxs("h1",{className:"text-4xl md:text-6xl lg:text-7xl font-bold text-slate-900 leading-tight tracking-tight mb-6",children:["AI-powered health insights for ",h.jsx("span",{className:"text-blue-600",children:"smarter, proactive"})," healthcare"]}),h.jsx("p",{className:"text-lg md:text-xl text-slate-600 max-w-2xl mx-auto mb-10 leading-relaxed",children:"Join 10,000+ people who've transformed their health with personalized AI analysis, nutrition plans, and expert doctor connectionsall from your medical reports."}),h.jsxs("div",{className:"flex items-center justify-center gap-6 mt-12",children:[h.jsx("div",{className:"flex -space-x-3",children:e.map((n,a)=>h.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-white bg-slate-100 overflow-hidden",children:h.jsx("img",{src:n,alt:`User ${a+1}`,className:"w-full h-full object-cover"})},a))}),h.jsxs("div",{className:"text-left",children:[h.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(n=>h.jsx(to,{className:"w-4 h-4 fill-amber-400 text-amber-400"},n))}),h.jsxs("p",{className:"text-sm text-slate-600",children:[h.jsx("span",{className:"font-semibold text-slate-900",children:"4.9/5"})," from 1,000+ reviews"]})]})]})]}),h.jsxs("div",{className:"mt-16 relative",children:[h.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-50 via-transparent to-transparent z-10"}),h.jsx("div",{className:"bg-white rounded-2xl md:rounded-3xl overflow-hidden shadow-2xl shadow-blue-600/10 border border-slate-200",children:h.jsx("img",{src:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/Banner-ai-diagnostic.jpg?v=1768294903",alt:"AI Health Dashboard",className:"w-full h-auto object-cover"})})]})]})})}function wTe(){const e=[{icon:Yo,title:"Personalized Health Analysis",description:"AI-powered analysis of your medical reports to identify health patterns, deficiencies, and risks."},{icon:Ny,title:"Preventive Care Insights",description:"Get proactive recommendations to prevent health issues before they become serious problems."},{icon:gs,title:"24/7 Health Monitoring",description:"Track your health metrics continuously with smart alerts and personalized recommendations."},{icon:IJ,title:"Health Tracking App",description:"Monitor your vitals, medications, and wellness goals in one beautiful, easy-to-use dashboard."},{icon:Ch,title:"Expert Doctor Network",description:"Connect with verified healthcare professionals recommended based on your specific health needs."},{icon:_J,title:"AI Health Assistant",description:"Get instant answers to health questions and personalized guidance from our AI health assistant."}];return h.jsx("section",{id:"features",className:"py-20 md:py-32 bg-white",children:h.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[h.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[h.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[h.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-600"}),h.jsx("span",{className:"text-sm uppercase tracking-wider text-slate-500 font-medium",children:"Features"})]}),h.jsx("h2",{className:"text-3xl md:text-5xl font-bold text-slate-900 mb-6",children:"Everything you need for better health, in one platform"}),h.jsx("p",{className:"text-lg text-slate-600",children:"We've reimagined healthcare to be proactive, not reactive. Here's how HealthAI keeps you thriving."})]}),h.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8",children:e.map((n,a)=>h.jsxs("div",{className:"group p-8 rounded-2xl bg-white border border-slate-200 hover:border-blue-300 hover:shadow-lg hover:shadow-blue-600/5 transition-all duration-300",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center mb-6 group-hover:bg-blue-100 transition-colors",children:h.jsx(n.icon,{className:"w-6 h-6 text-blue-600"})}),h.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-3",children:n.title}),h.jsx("p",{className:"text-slate-600 leading-relaxed",children:n.description})]},a))})]})})}function xTe(){const e=[{number:"01",title:"Upload your health reports",description:"Simply upload your medical reports, lab results, or health documents. Our AI supports all formats including PDFs and images.",image:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/reportupload.jpg?v=1768295339"},{number:"02",title:"Get AI-powered analysis",description:"Our advanced AI analyzes your health data and creates a comprehensive health profile with personalized insights and recommendations.",image:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/report-analysis.jpg?v=1768295338"},{number:"03",title:"Take action on insights",description:"Follow personalized nutrition plans, connect with recommended doctors, and track your health improvements over time.",image:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/Banner-ai-diagnostic.jpg?v=1768294903"}];return h.jsx("section",{id:"how-it-works",className:"py-20 md:py-32 bg-slate-50",children:h.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[h.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[h.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[h.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-600"}),h.jsx("span",{className:"text-sm uppercase tracking-wider text-slate-500 font-medium",children:"How it works"})]}),h.jsx("h2",{className:"text-3xl md:text-5xl font-bold text-slate-900 mb-6",children:"Three simple steps to better health"})]}),h.jsx("div",{className:"space-y-20",children:e.map((n,a)=>h.jsxs("div",{className:`flex flex-col ${a%2===1?"lg:flex-row-reverse":"lg:flex-row"} items-center gap-12 lg:gap-20`,children:[h.jsxs("div",{className:"flex-1 text-center lg:text-left",children:[h.jsx("span",{className:"text-6xl md:text-8xl font-bold text-blue-100",children:n.number}),h.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-slate-900 mt-4 mb-4",children:n.title}),h.jsx("p",{className:"text-lg text-slate-600 leading-relaxed mb-6",children:n.description}),h.jsxs("a",{href:"#",className:"inline-flex items-center text-blue-600 font-medium hover:gap-3 gap-2 transition-all",children:["Learn more ",h.jsx(vh,{className:"w-4 h-4"})]})]}),h.jsx("div",{className:"flex-1",children:h.jsx("div",{className:"bg-white rounded-2xl overflow-hidden shadow-xl border border-slate-200",children:h.jsx("img",{src:n.image,alt:n.title,className:"w-full h-auto object-cover"})})})]},a))})]})})}function TTe(){const e=[{name:"Basic",price:"0",period:"forever",description:"Perfect for getting started with AI health insights.",features:["Upload up to 3 reports per month","Basic AI health analysis","Health score tracking","Mobile app access","Email support"],popular:!1},{name:"Pro",price:"29",period:"per month",description:"Comprehensive health insights for serious health optimization.",features:["Unlimited report uploads","Advanced AI analysis","Personalized nutrition plans","Doctor recommendations","Priority support","Health trend analysis","Supplement recommendations"],popular:!0},{name:"Family",price:"49",period:"per month",description:"Complete health management for your entire family.",features:["Everything in Pro","Up to 5 family members","Family health dashboard","Shared health insights","Family doctor network","Emergency health alerts"],popular:!1}];return h.jsx("section",{id:"pricing",className:"py-20 md:py-32 bg-white",children:h.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[h.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[h.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[h.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-600"}),h.jsx("span",{className:"text-sm uppercase tracking-wider text-slate-500 font-medium",children:"Pricing"})]}),h.jsx("h2",{className:"text-3xl md:text-5xl font-bold text-slate-900 mb-6",children:"Simple, transparent pricing"}),h.jsx("p",{className:"text-lg text-slate-600",children:"No hidden fees. No surprises. Just powerful AI health insights at an affordable price."})]}),h.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:e.map((n,a)=>h.jsxs("div",{className:`relative p-8 rounded-2xl border ${n.popular?"bg-blue-600 text-white border-blue-600 shadow-2xl shadow-blue-600/25 scale-105":"bg-white border-slate-200"}`,children:[n.popular&&h.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:h.jsx("span",{className:"bg-slate-900 text-white text-sm font-medium px-4 py-1 rounded-full",children:"Most Popular"})}),h.jsx("h3",{className:`text-xl font-semibold mb-2 ${n.popular?"text-white":"text-slate-900"}`,children:n.name}),h.jsx("p",{className:`text-sm mb-6 ${n.popular?"text-blue-100":"text-slate-600"}`,children:n.description}),h.jsxs("div",{className:"mb-8",children:[h.jsxs("span",{className:`text-5xl font-bold ${n.popular?"text-white":"text-slate-900"}`,children:["$",n.price]}),h.jsx("span",{className:`text-sm ml-2 ${n.popular?"text-blue-100":"text-slate-600"}`,children:n.period})]}),h.jsx("ul",{className:"space-y-4 mb-8",children:n.features.map((o,l)=>h.jsxs("li",{className:"flex items-start gap-3",children:[h.jsx(va,{className:`w-5 h-5 shrink-0 mt-0.5 ${n.popular?"text-white":"text-blue-600"}`}),h.jsx("span",{className:`text-sm ${n.popular?"text-blue-50":"text-slate-600"}`,children:o})]},l))}),h.jsx(Tn,{to:"/register",className:`w-full rounded-full py-4 px-6 text-center font-medium transition-colors block ${n.popular?"bg-white text-blue-600 hover:bg-blue-50":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Get started"})]},a))})]})})}function CTe(){const[e,n]=J.useState(0),a=[{stars:5,quote:"HealthAI identified my vitamin D deficiency that my doctor missed. The personalized nutrition plan has completely transformed my energy levels and overall health. I feel like I have a personal health advisor in my pocket.",author:"Sarah Johnson",role:"Marketing Manager",location:"San Francisco",image:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face"},{stars:5,quote:"As a busy professional, I never had time to properly analyze my health reports. HealthAI does it instantly and gives me actionable insights. The doctor recommendations were spot-on and saved me months of searching.",author:"Michael Chen",role:"Software Engineer",location:"Seattle",image:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face"},{stars:5,quote:"The AI analysis caught early signs of metabolic issues that could have become serious. The preventive care recommendations and supplement guidance have been life-changing. This is the future of healthcare.",author:"Emily Rodriguez",role:"Fitness Instructor",location:"Austin",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face"}],o=()=>n(p=>(p+1)%a.length),l=()=>n(p=>(p-1+a.length)%a.length);return h.jsx("section",{id:"testimonials",className:"py-20 md:py-32 bg-slate-50",children:h.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[h.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[h.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[h.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-600"}),h.jsx("span",{className:"text-sm uppercase tracking-wider text-slate-500 font-medium",children:"Testimonials"})]}),h.jsx("h2",{className:"text-3xl md:text-5xl font-bold text-slate-900 mb-6",children:"Hear from our users"}),h.jsx("p",{className:"text-lg text-slate-600",children:"Join thousands who've transformed their health with AI-powered insights."})]}),h.jsxs("div",{className:"max-w-4xl mx-auto",children:[h.jsxs("div",{className:"relative bg-white rounded-3xl p-8 md:p-12 shadow-xl border border-slate-200",children:[h.jsx(lTe,{className:"absolute top-8 right-8 w-16 h-16 text-blue-100"}),h.jsx("div",{className:"flex gap-1 mb-6",children:[...Array(a[e].stars)].map((p,m)=>h.jsx(to,{className:"w-5 h-5 fill-amber-400 text-amber-400"},m))}),h.jsxs("blockquote",{className:"text-xl md:text-2xl text-slate-900 leading-relaxed mb-8",children:['"',a[e].quote,'"']}),h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("img",{src:a[e].image,alt:a[e].author,className:"w-14 h-14 rounded-full object-cover border-2 border-slate-200"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-slate-900",children:a[e].author}),h.jsxs("p",{className:"text-sm text-slate-600",children:[a[e].role,"  ",a[e].location]})]})]})]}),h.jsxs("div",{className:"flex items-center justify-center gap-4 mt-8",children:[h.jsx("button",{onClick:l,className:"w-12 h-12 rounded-full border border-slate-200 bg-white hover:bg-slate-50 flex items-center justify-center transition-colors",children:h.jsx(bl,{className:"w-5 h-5 text-slate-900"})}),h.jsx("div",{className:"flex gap-2",children:a.map((p,m)=>h.jsx("button",{onClick:()=>n(m),className:`w-2.5 h-2.5 rounded-full transition-colors ${m===e?"bg-blue-600":"bg-slate-300 hover:bg-slate-400"}`},m))}),h.jsx("button",{onClick:o,className:"w-12 h-12 rounded-full border border-slate-200 bg-white hover:bg-slate-50 flex items-center justify-center transition-colors",children:h.jsx(vh,{className:"w-5 h-5 text-slate-900"})})]})]})]})})}function RTe(){const[e,n]=J.useState(0),a=[{question:"What types of health reports can I upload?",answer:"HealthAI supports all common medical report formats including blood tests, lab results, imaging reports, and general health checkups. You can upload PDFs, images, or even photos of paper reports. Our AI can extract and analyze data from virtually any medical document."},{question:"How accurate is the AI analysis?",answer:"Our AI has been trained on millions of medical records and achieves 98% accuracy in data extraction and analysis. However, our insights are meant to supplement, not replace, professional medical advice. We always recommend consulting with healthcare professionals for serious health concerns."},{question:"Is my health data secure and private?",answer:"Absolutely. We use bank-level encryption to protect your data and are fully HIPAA compliant. Your health information is never shared with third parties without your explicit consent. You have complete control over your data and can delete it at any time."},{question:"Can I connect with real doctors through the platform?",answer:"Yes! Based on your AI analysis, we recommend verified healthcare professionals who specialize in your specific health needs. Our network includes thousands of doctors, specialists, and healthcare providers who understand our AI insights."},{question:"What if I don't have any medical reports?",answer:"No problem! You can start by taking our comprehensive health assessment, or we can help you understand what tests to request from your doctor. We also provide guidance on essential health screenings based on your age, gender, and health goals."},{question:"Can I cancel my subscription anytime?",answer:"Yes, you can cancel your subscription at any time with no penalties or fees. If you cancel mid-cycle, you'll continue to have access to all features until the end of your billing period. We also offer a 30-day money-back guarantee for new subscribers."}];return h.jsx("section",{id:"faq",className:"py-20 md:py-32 bg-white",children:h.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[h.jsxs("div",{className:"text-center mb-16",children:[h.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[h.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-600"}),h.jsx("span",{className:"text-sm uppercase tracking-wider text-slate-500 font-medium",children:"FAQ"})]}),h.jsx("h2",{className:"text-3xl md:text-5xl font-bold text-slate-900 mb-6",children:"Got questions?"}),h.jsx("p",{className:"text-lg text-slate-600",children:"We've got answers. If you can't find what you're looking for, chat with our team."})]}),h.jsx("div",{className:"space-y-4",children:a.map((o,l)=>h.jsxs("div",{className:"border border-slate-200 rounded-xl overflow-hidden bg-white",children:[h.jsxs("button",{onClick:()=>n(e===l?null:l),className:"w-full flex items-center justify-between p-6 text-left",children:[h.jsx("span",{className:"text-lg font-medium text-slate-900 pr-4",children:o.question}),h.jsx(Xk,{className:`w-5 h-5 text-slate-500 shrink-0 transition-transform duration-200 ${e===l?"rotate-180":""}`})]}),h.jsx("div",{className:`overflow-hidden transition-all duration-200 ${e===l?"max-h-96":"max-h-0"}`,children:h.jsx("p",{className:"px-6 pb-6 text-slate-600 leading-relaxed",children:o.answer})})]},l))})]})})}function ATe(){return h.jsx("section",{className:"py-20 md:py-32 bg-blue-600",children:h.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[h.jsx("h2",{className:"text-3xl md:text-5xl font-bold text-white mb-6",children:"Ready to transform your health with AI?"}),h.jsx("p",{className:"text-lg text-blue-100 mb-10 max-w-2xl mx-auto",children:"Join 10,000+ people who've made the switch to proactive, AI-powered healthcare. Your future self will thank you."}),h.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[h.jsxs(Tn,{to:"/register",className:"bg-white text-blue-600 hover:bg-blue-50 rounded-full px-8 py-4 text-base font-medium transition-all inline-flex items-center gap-2",children:["Start your free analysis",h.jsx(vh,{className:"w-5 h-5"})]}),h.jsx(Tn,{to:"/login",className:"rounded-full px-8 py-4 text-base font-medium border border-blue-400 text-white hover:bg-blue-700 bg-transparent transition-all",children:"Talk to our team"})]}),h.jsx("p",{className:"text-sm text-blue-200 mt-6",children:"Free forever plan  No credit card required  Cancel anytime"})]})})}function NTe(){return h.jsx("footer",{className:"bg-slate-900 text-white py-16",children:h.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[h.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8 mb-12",children:[h.jsxs("div",{className:"col-span-2 lg:col-span-1",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[h.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-xl flex items-center justify-center",children:h.jsx(ni,{className:"w-5 h-5 text-white"})}),h.jsx("span",{className:"font-semibold text-xl",children:"HealthAI"})]}),h.jsx("p",{className:"text-slate-400 text-sm mb-4",children:"AI-powered health insights for better living."})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold mb-4",children:"Product"}),h.jsxs("ul",{className:"space-y-3 text-sm",children:[h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Features"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Pricing"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Mobile App"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"API"})})]})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),h.jsxs("ul",{className:"space-y-3 text-sm",children:[h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"About"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Blog"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Careers"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Press"})})]})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold mb-4",children:"Resources"}),h.jsxs("ul",{className:"space-y-3 text-sm",children:[h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Help Center"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Health Guides"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Find a Doctor"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Partner with Us"})})]})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),h.jsxs("ul",{className:"space-y-3 text-sm",children:[h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Privacy Policy"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"Terms of Service"})}),h.jsx("li",{children:h.jsx("a",{href:"#",className:"text-slate-400 hover:text-white transition-colors",children:"HIPAA Compliance"})})]})]})]}),h.jsxs("div",{className:"pt-8 border-t border-slate-800 flex flex-col md:flex-row items-center justify-between gap-4",children:[h.jsx("p",{className:"text-sm text-slate-400",children:" 2024 HealthAI. All rights reserved."}),h.jsx("p",{className:"text-sm text-slate-400",children:"Made with  for better health"})]})]})})}function OTe(){return h.jsxs("div",{className:"min-h-screen bg-white",children:[h.jsx(bTe,{}),h.jsx(STe,{}),h.jsx(wTe,{}),h.jsx(xTe,{}),h.jsx(TTe,{}),h.jsx(CTe,{}),h.jsx(RTe,{}),h.jsx(ATe,{}),h.jsx(NTe,{})]})}function ITe(){const[e,n]=J.useState(""),[a,o]=J.useState(""),[l,p]=J.useState(!1),[m,y]=J.useState(!1),{login:E}=Ha(),b=ro(),T=async x=>{var A,D;x.preventDefault(),y(!0);try{const N=await E(e,a);bt.success("Welcome back!"),b(N.role==="admin"?"/admin":N.role==="doctor"?"/doctor/dashboard":"/dashboard")}catch(N){bt.error(((D=(A=N.response)==null?void 0:A.data)==null?void 0:D.message)||"Login failed")}finally{y(!1)}};return h.jsxs("div",{className:"min-h-screen flex bg-slate-50",children:[h.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-cyan-500 via-blue-500 to-indigo-600",children:[h.jsxs("div",{className:"absolute inset-0",children:[h.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),h.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),h.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[h.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:h.jsx(ni,{className:"w-10 h-10"})}),h.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Welcome to HealthAI"}),h.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Your AI-powered health companion for smarter healthcare decisions."})]})]}),h.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:h.jsxs("div",{className:"w-full max-w-md",children:[h.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[h.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center",children:h.jsx(ni,{className:"w-7 h-7 text-white"})}),h.jsx("span",{className:"text-2xl font-bold text-slate-800",children:"HealthAI"})]}),h.jsxs("div",{className:"text-center mb-8",children:[h.jsx("h2",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Sign In"}),h.jsx("p",{className:"text-slate-500",children:"Access your health dashboard"})]}),h.jsxs("form",{onSubmit:T,className:"space-y-5",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email Address"}),h.jsxs("div",{className:"relative",children:[h.jsx(w_,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"email",value:e,onChange:x=>n(x.target.value),className:"w-full bg-white border border-slate-200 rounded-xl py-3 pl-12 pr-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"you@example.com",required:!0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),h.jsxs("div",{className:"relative",children:[h.jsx(dP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:l?"text":"password",value:a,onChange:x=>o(x.target.value),className:"w-full bg-white border border-slate-200 rounded-xl py-3 pl-12 pr-12 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0}),h.jsx("button",{type:"button",onClick:()=>p(!l),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:l?h.jsx(SJ,{className:"w-5 h-5"}):h.jsx(Ux,{className:"w-5 h-5"})})]})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[h.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-slate-300 text-cyan-500 focus:ring-cyan-500"}),h.jsx("span",{className:"text-sm text-slate-600",children:"Remember me"})]}),h.jsx("a",{href:"#",className:"text-sm text-cyan-600 hover:text-cyan-700 font-medium",children:"Forgot password?"})]}),h.jsx("button",{type:"submit",disabled:m,className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:m?h.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):h.jsxs(h.Fragment,{children:["Sign In ",h.jsx(vh,{className:"w-5 h-5"})]})})]}),h.jsxs("p",{className:"text-center mt-8 text-slate-600",children:["Don't have an account?"," ",h.jsx(Tn,{to:"/register",className:"text-cyan-600 font-semibold hover:text-cyan-700",children:"Create one"})]}),h.jsx("div",{className:"mt-6 text-center",children:h.jsx(Tn,{to:"/register/doctor",className:"text-sm text-slate-500 hover:text-cyan-600",children:"Register as a Doctor "})}),h.jsxs("div",{className:"mt-8 p-4 bg-cyan-50 rounded-xl border border-cyan-200",children:[h.jsx("p",{className:"text-sm font-medium text-cyan-800 mb-2",children:"Demo Credentials"}),h.jsx("p",{className:"text-sm text-cyan-700",children:"Admin: admin@healthai.com / admin123"})]})]})})]})}function PTe(){const[e,n]=J.useState(1),[a,o]=J.useState(null),[l,p]=J.useState({name:"",email:"",password:"",confirmPassword:"",age:"",gender:"",dietaryPreference:"non-vegetarian"}),[m,y]=J.useState(!1),[E,b]=J.useState(!1),{register:T}=Ha(),x=ro(),A=N=>{o(N),N==="doctor"?x("/register/doctor"):n(2)},D=async N=>{var L,P;if(N.preventDefault(),l.password!==l.confirmPassword){bt.error("Passwords do not match");return}if(!l.age||!l.gender||!l.dietaryPreference){bt.error("Please provide your age, gender, and dietary preference for personalized health insights");return}b(!0);try{await T(l.name,l.email,l.password,{age:parseInt(l.age),gender:l.gender,dietaryPreference:l.dietaryPreference}),bt.success("Account created successfully!"),x("/dashboard")}catch(U){bt.error(((P=(L=U.response)==null?void 0:L.data)==null?void 0:P.message)||"Registration failed")}finally{b(!1)}};return e===1?h.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"w-full max-w-2xl",children:[h.jsxs("div",{className:"flex items-center justify-center gap-3 mb-8",children:[h.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center",children:h.jsx(ni,{className:"w-7 h-7 text-white"})}),h.jsx("span",{className:"text-2xl font-bold text-slate-800",children:"HealthAI"})]}),h.jsxs("div",{className:"text-center mb-8",children:[h.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Join HealthAI"}),h.jsx("p",{className:"text-slate-500",children:"Choose how you want to use our platform"})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[h.jsxs("button",{onClick:()=>A("patient"),className:"bg-white rounded-2xl border-2 border-slate-200 p-8 text-left hover:border-cyan-500 hover:shadow-lg transition-all group",children:[h.jsx("div",{className:"w-16 h-16 rounded-2xl bg-cyan-100 flex items-center justify-center mb-4 group-hover:bg-cyan-500 transition-colors",children:h.jsx(Yo,{className:"w-8 h-8 text-cyan-600 group-hover:text-white transition-colors"})}),h.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"I am a Patient"}),h.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"Upload health reports, get AI-powered insights, personalized diet plans, and connect with doctors."}),h.jsxs("ul",{className:"text-sm text-slate-600 space-y-2",children:[h.jsxs("li",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500"}),"AI Health Report Analysis"]}),h.jsxs("li",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500"}),"Personalized Diet Plans"]}),h.jsxs("li",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500"}),"Video Consultations"]})]}),h.jsxs("div",{className:"mt-6 flex items-center text-cyan-600 font-medium",children:["Get Started ",h.jsx(vh,{className:"w-4 h-4 ml-2"})]})]}),h.jsxs("button",{onClick:()=>A("doctor"),className:"bg-white rounded-2xl border-2 border-slate-200 p-8 text-left hover:border-blue-500 hover:shadow-lg transition-all group",children:[h.jsx("div",{className:"w-16 h-16 rounded-2xl bg-blue-100 flex items-center justify-center mb-4 group-hover:bg-blue-500 transition-colors",children:h.jsx(PJ,{className:"w-8 h-8 text-blue-600 group-hover:text-white transition-colors"})}),h.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"I am a Doctor"}),h.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"Join our platform to provide consultations, manage appointments, and help patients."}),h.jsxs("ul",{className:"text-sm text-slate-600 space-y-2",children:[h.jsxs("li",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"Manage Your Schedule"]}),h.jsxs("li",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"Video Consultations"]}),h.jsxs("li",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"View Patient Reports"]})]}),h.jsxs("div",{className:"mt-6 flex items-center text-blue-600 font-medium",children:["Apply Now ",h.jsx(vh,{className:"w-4 h-4 ml-2"})]})]})]}),h.jsxs("p",{className:"text-center mt-8 text-slate-600",children:["Already have an account?"," ",h.jsx(Tn,{to:"/login",className:"text-cyan-600 font-semibold hover:text-cyan-700",children:"Sign in"})]})]})}):h.jsxs("div",{className:"min-h-screen flex bg-slate-50",children:[h.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-cyan-500 via-blue-500 to-indigo-600",children:[h.jsxs("div",{className:"absolute inset-0",children:[h.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),h.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),h.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[h.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:h.jsx(Yo,{className:"w-10 h-10"})}),h.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Your Health Journey Starts Here"}),h.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Get personalized health insights, diet plans, and supplement recommendations based on your unique profile."})]})]}),h.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:h.jsxs("div",{className:"w-full max-w-md",children:[h.jsxs("button",{onClick:()=>n(1),className:"flex items-center gap-2 text-slate-500 hover:text-slate-700 mb-6",children:[h.jsx(bl,{className:"w-4 h-4"})," Back"]}),h.jsxs("div",{className:"text-center mb-8",children:[h.jsx("h2",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Create Patient Account"}),h.jsx("p",{className:"text-slate-500",children:"We need some details for personalized health insights"})]}),h.jsxs("form",{onSubmit:D,className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),h.jsxs("div",{className:"relative",children:[h.jsx(Sl,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"text",value:l.name,onChange:N=>p({...l,name:N.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl py-3 pl-12 pr-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"John Doe",required:!0})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),h.jsx("input",{type:"number",value:l.age,onChange:N=>p({...l,age:N.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"25",min:"1",max:"120",required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),h.jsxs("select",{value:l.gender,onChange:N=>p({...l,gender:N.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:outline-none",required:!0,children:[h.jsx("option",{value:"",children:"Select"}),h.jsx("option",{value:"male",children:"Male"}),h.jsx("option",{value:"female",children:"Female"}),h.jsx("option",{value:"other",children:"Other"})]})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),h.jsxs("select",{value:l.dietaryPreference,onChange:N=>p({...l,dietaryPreference:N.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:outline-none",required:!0,children:[h.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),h.jsx("option",{value:"vegetarian",children:"Vegetarian"}),h.jsx("option",{value:"vegan",children:"Vegan"}),h.jsx("option",{value:"eggetarian",children:"Eggetarian"})]}),h.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"This helps us recommend suitable diet plans"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email Address"}),h.jsxs("div",{className:"relative",children:[h.jsx(w_,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"email",value:l.email,onChange:N=>p({...l,email:N.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl py-3 pl-12 pr-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"you@example.com",required:!0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),h.jsxs("div",{className:"relative",children:[h.jsx(dP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:m?"text":"password",value:l.password,onChange:N=>p({...l,password:N.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl py-3 pl-12 pr-12 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0}),h.jsx("button",{type:"button",onClick:()=>y(!m),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:m?h.jsx(SJ,{className:"w-5 h-5"}):h.jsx(Ux,{className:"w-5 h-5"})})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm Password"}),h.jsxs("div",{className:"relative",children:[h.jsx(dP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"password",value:l.confirmPassword,onChange:N=>p({...l,confirmPassword:N.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl py-3 pl-12 pr-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0})]})]}),h.jsx("p",{className:"text-xs text-slate-500",children:"Your age, gender, and dietary preference help us provide personalized health interpretations, deficiency assessments, and suitable diet recommendations."}),h.jsx("button",{type:"submit",disabled:E,className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:E?h.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):h.jsxs(h.Fragment,{children:["Create Account ",h.jsx(vh,{className:"w-5 h-5"})]})})]}),h.jsxs("p",{className:"text-center mt-6 text-slate-600",children:["Already have an account?"," ",h.jsx(Tn,{to:"/login",className:"text-cyan-600 font-semibold hover:text-cyan-700",children:"Sign in"})]})]})})]})}const DTe=["General Physician","Cardiologist","Dermatologist","Endocrinologist","Gastroenterologist","Neurologist","Nutritionist","Oncologist","Orthopedic","Pediatrician","Psychiatrist","Pulmonologist"],hz=[{id:"license",name:"Medical License",description:"Valid medical license certificate"},{id:"degree",name:"Medical Degree",description:"MBBS/MD or equivalent degree certificate"},{id:"id_proof",name:"ID Proof",description:"Government issued ID (Aadhar/Passport)"}];function kTe(){const{registerDoctor:e}=Ha(),n=ro(),[a,o]=J.useState(!1),[l,p]=J.useState(1),[m,y]=J.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",specialization:"",qualifications:"",experience:"",hospital:"",licenseNumber:"",consultationFee:"",bio:""}),[E,b]=J.useState({}),T=N=>{y({...m,[N.target.name]:N.target.value})},x=(N,L)=>{L&&b(P=>({...P,[N]:{file:L,name:L.name,size:(L.size/1024).toFixed(1)+" KB"}}))},A=N=>{b(L=>{const P={...L};return delete P[N],P})},D=async N=>{var P,U;if(N.preventDefault(),m.password!==m.confirmPassword){bt.error("Passwords do not match");return}const L=hz.filter(V=>!E[V.id]);if(L.length>0){bt.error(`Please upload: ${L.map(V=>V.name).join(", ")}`);return}o(!0);try{const V=Object.entries(E).map(([F,H])=>({name:H.name,type:F,url:`pending_upload_${F}`}));await e({...m,qualifications:m.qualifications.split(",").map(F=>F.trim()).filter(Boolean),experience:parseInt(m.experience),consultationFee:parseInt(m.consultationFee)||500,documents:V}),bt.success("Registration successful! Your profile is pending approval."),n("/doctor/dashboard")}catch(V){bt.error(((U=(P=V.response)==null?void 0:P.data)==null?void 0:U.message)||"Registration failed")}finally{o(!1)}};return h.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"w-full max-w-2xl",children:[h.jsxs("div",{className:"text-center mb-8",children:[h.jsxs(Tn,{to:"/",className:"inline-flex items-center gap-2 mb-6",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center",children:h.jsx(ni,{className:"w-7 h-7 text-white"})}),h.jsx("span",{className:"text-2xl font-bold text-slate-800",children:"HealthAI"})]}),h.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Doctor Registration"}),h.jsx("p",{className:"text-slate-500",children:"Join our platform and connect with patients"})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 shadow-sm",children:[h.jsx("div",{className:"flex items-center justify-center gap-4 mb-8",children:[1,2,3].map(N=>h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold ${l>=N?"bg-cyan-500 text-white":"bg-slate-200 text-slate-400"}`,children:N}),h.jsx("span",{className:`text-sm hidden sm:block ${l>=N?"text-cyan-600 font-medium":"text-slate-400"}`,children:N===1?"Account":N===2?"Professional":"Documents"}),N<3&&h.jsx("div",{className:`w-8 h-1 rounded ${l>N?"bg-cyan-500":"bg-slate-200"}`})]},N))}),h.jsxs("form",{onSubmit:D,children:[l===1&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),h.jsx("input",{type:"text",name:"name",value:m.name,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"Dr. John Smith",required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),h.jsx("input",{type:"email",name:"email",value:m.email,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"doctor@example.com",required:!0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone"}),h.jsx("input",{type:"tel",name:"phone",value:m.phone,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"+91 98765 43210"})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),h.jsx("input",{type:"password",name:"password",value:m.password,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0,minLength:6})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm Password"}),h.jsx("input",{type:"password",name:"confirmPassword",value:m.confirmPassword,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0})]})]}),h.jsx("button",{type:"button",onClick:()=>p(2),className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all mt-4",children:"Continue "})]}),l===2&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Specialization"}),h.jsxs("select",{name:"specialization",value:m.specialization,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:outline-none",required:!0,children:[h.jsx("option",{value:"",children:"Select specialization"}),DTe.map(N=>h.jsx("option",{value:N,children:N},N))]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Experience (years)"}),h.jsx("input",{type:"number",name:"experience",value:m.experience,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"5",required:!0,min:0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Medical License Number"}),h.jsx("input",{type:"text",name:"licenseNumber",value:m.licenseNumber,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MCI-12345",required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Qualifications (comma separated)"}),h.jsx("input",{type:"text",name:"qualifications",value:m.qualifications,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MBBS, MD, FRCP"})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Hospital/Clinic"}),h.jsx("input",{type:"text",name:"hospital",value:m.hospital,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"City Hospital"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consultation Fee ()"}),h.jsx("input",{type:"number",name:"consultationFee",value:m.consultationFee,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"500",min:0})]})]}),h.jsxs("div",{className:"flex gap-3 mt-4",children:[h.jsxs("button",{type:"button",onClick:()=>p(1),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[h.jsx(bl,{className:"w-4 h-4"})," Back"]}),h.jsx("button",{type:"button",onClick:()=>p(3),className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:"Continue "})]})]}),l===3&&h.jsxs("div",{className:"space-y-4",children:[h.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:h.jsxs("p",{className:"text-sm text-amber-800",children:[h.jsx("strong",{children:"Important:"})," Please upload clear copies of the following documents. These will be reviewed by our admin team before your profile is approved."]})}),hz.map(N=>h.jsxs("div",{className:"border border-slate-200 rounded-xl p-4",children:[h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{children:[h.jsxs("h4",{className:"font-medium text-slate-800",children:[N.name," ",h.jsx("span",{className:"text-red-500",children:"*"})]}),h.jsx("p",{className:"text-sm text-slate-500",children:N.description})]}),E[N.id]?h.jsx(va,{className:"w-5 h-5 text-green-500"}):null]}),E[N.id]?h.jsxs("div",{className:"mt-3 flex items-center justify-between bg-slate-50 rounded-lg p-3",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(hi,{className:"w-5 h-5 text-cyan-500"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-slate-700",children:E[N.id].name}),h.jsx("p",{className:"text-xs text-slate-500",children:E[N.id].size})]})]}),h.jsx("button",{type:"button",onClick:()=>A(N.id),className:"p-1 text-slate-400 hover:text-red-500",children:h.jsx(zo,{className:"w-4 h-4"})})]}):h.jsxs("label",{className:"mt-3 flex items-center justify-center gap-2 p-4 border-2 border-dashed border-slate-200 rounded-lg cursor-pointer hover:border-cyan-500 hover:bg-cyan-50 transition-all",children:[h.jsx(Wo,{className:"w-5 h-5 text-slate-400"}),h.jsx("span",{className:"text-sm text-slate-500",children:"Click to upload"}),h.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:L=>x(N.id,L.target.files[0])})]})]},N.id)),h.jsxs("div",{className:"flex gap-3 mt-6",children:[h.jsxs("button",{type:"button",onClick:()=>p(2),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[h.jsx(bl,{className:"w-4 h-4"})," Back"]}),h.jsx("button",{type:"submit",disabled:a,className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:a?"Submitting...":"Submit Application"})]})]})]}),h.jsxs("p",{className:"text-center text-slate-500 mt-6",children:["Already have an account? ",h.jsx(Tn,{to:"/login",className:"text-cyan-600 hover:text-cyan-700 font-medium",children:"Sign in"})]})]}),h.jsxs("p",{className:"text-center text-sm text-slate-500 mt-6 flex items-center justify-center gap-2",children:[h.jsx(PJ,{className:"w-4 h-4"}),"Your profile will be reviewed by our admin team before being listed."]})]})})}function jJ(e){var n,a,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var l=e.length;for(n=0;n<l;n++)e[n]&&(a=jJ(e[n]))&&(o&&(o+=" "),o+=a)}else for(a in e)e[a]&&(o&&(o+=" "),o+=a);return o}function Cn(){for(var e,n,a=0,o="",l=arguments.length;a<l;a++)(e=arguments[a])&&(n=jJ(e))&&(o&&(o+=" "),o+=n);return o}var LTe=Array.isArray,za=LTe,jTe=typeof bd=="object"&&bd&&bd.Object===Object&&bd,MJ=jTe,MTe=MJ,UTe=typeof self=="object"&&self&&self.Object===Object&&self,VTe=MTe||UTe||Function("return this")(),Mc=VTe,FTe=Mc,BTe=FTe.Symbol,T_=BTe,pz=T_,UJ=Object.prototype,WTe=UJ.hasOwnProperty,GTe=UJ.toString,Dv=pz?pz.toStringTag:void 0;function $Te(e){var n=WTe.call(e,Dv),a=e[Dv];try{e[Dv]=void 0;var o=!0}catch{}var l=GTe.call(e);return o&&(n?e[Dv]=a:delete e[Dv]),l}var HTe=$Te,zTe=Object.prototype,KTe=zTe.toString;function YTe(e){return KTe.call(e)}var qTe=YTe,fz=T_,XTe=HTe,JTe=qTe,QTe="[object Null]",ZTe="[object Undefined]",mz=fz?fz.toStringTag:void 0;function eCe(e){return e==null?e===void 0?ZTe:QTe:mz&&mz in Object(e)?XTe(e):JTe(e)}var Al=eCe;function tCe(e){return e!=null&&typeof e=="object"}var Nl=tCe,nCe=Al,rCe=Nl,iCe="[object Symbol]";function aCe(e){return typeof e=="symbol"||rCe(e)&&nCe(e)==iCe}var km=aCe,sCe=za,oCe=km,cCe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,lCe=/^\w*$/;function dCe(e,n){if(sCe(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||oCe(e)?!0:lCe.test(e)||!cCe.test(e)||n!=null&&e in Object(n)}var t2=dCe;function uCe(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}var Yd=uCe;const Lm=Zn(Yd);var hCe=Al,pCe=Yd,fCe="[object AsyncFunction]",mCe="[object Function]",gCe="[object GeneratorFunction]",vCe="[object Proxy]";function yCe(e){if(!pCe(e))return!1;var n=hCe(e);return n==mCe||n==gCe||n==fCe||n==vCe}var n2=yCe;const sn=Zn(n2);var _Ce=Mc,ECe=_Ce["__core-js_shared__"],bCe=ECe,RI=bCe,gz=function(){var e=/[^.]+$/.exec(RI&&RI.keys&&RI.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function SCe(e){return!!gz&&gz in e}var wCe=SCe,xCe=Function.prototype,TCe=xCe.toString;function CCe(e){if(e!=null){try{return TCe.call(e)}catch{}try{return e+""}catch{}}return""}var VJ=CCe,RCe=n2,ACe=wCe,NCe=Yd,OCe=VJ,ICe=/[\\^$.*+?()[\]{}|]/g,PCe=/^\[object .+?Constructor\]$/,DCe=Function.prototype,kCe=Object.prototype,LCe=DCe.toString,jCe=kCe.hasOwnProperty,MCe=RegExp("^"+LCe.call(jCe).replace(ICe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function UCe(e){if(!NCe(e)||ACe(e))return!1;var n=RCe(e)?MCe:PCe;return n.test(OCe(e))}var VCe=UCe;function FCe(e,n){return e==null?void 0:e[n]}var BCe=FCe,WCe=VCe,GCe=BCe;function $Ce(e,n){var a=GCe(e,n);return WCe(a)?a:void 0}var kh=$Ce,HCe=kh,zCe=HCe(Object,"create"),Gx=zCe,vz=Gx;function KCe(){this.__data__=vz?vz(null):{},this.size=0}var YCe=KCe;function qCe(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}var XCe=qCe,JCe=Gx,QCe="__lodash_hash_undefined__",ZCe=Object.prototype,eRe=ZCe.hasOwnProperty;function tRe(e){var n=this.__data__;if(JCe){var a=n[e];return a===QCe?void 0:a}return eRe.call(n,e)?n[e]:void 0}var nRe=tRe,rRe=Gx,iRe=Object.prototype,aRe=iRe.hasOwnProperty;function sRe(e){var n=this.__data__;return rRe?n[e]!==void 0:aRe.call(n,e)}var oRe=sRe,cRe=Gx,lRe="__lodash_hash_undefined__";function dRe(e,n){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=cRe&&n===void 0?lRe:n,this}var uRe=dRe,hRe=YCe,pRe=XCe,fRe=nRe,mRe=oRe,gRe=uRe;function jm(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}jm.prototype.clear=hRe;jm.prototype.delete=pRe;jm.prototype.get=fRe;jm.prototype.has=mRe;jm.prototype.set=gRe;var vRe=jm;function yRe(){this.__data__=[],this.size=0}var _Re=yRe;function ERe(e,n){return e===n||e!==e&&n!==n}var r2=ERe,bRe=r2;function SRe(e,n){for(var a=e.length;a--;)if(bRe(e[a][0],n))return a;return-1}var $x=SRe,wRe=$x,xRe=Array.prototype,TRe=xRe.splice;function CRe(e){var n=this.__data__,a=wRe(n,e);if(a<0)return!1;var o=n.length-1;return a==o?n.pop():TRe.call(n,a,1),--this.size,!0}var RRe=CRe,ARe=$x;function NRe(e){var n=this.__data__,a=ARe(n,e);return a<0?void 0:n[a][1]}var ORe=NRe,IRe=$x;function PRe(e){return IRe(this.__data__,e)>-1}var DRe=PRe,kRe=$x;function LRe(e,n){var a=this.__data__,o=kRe(a,e);return o<0?(++this.size,a.push([e,n])):a[o][1]=n,this}var jRe=LRe,MRe=_Re,URe=RRe,VRe=ORe,FRe=DRe,BRe=jRe;function Mm(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Mm.prototype.clear=MRe;Mm.prototype.delete=URe;Mm.prototype.get=VRe;Mm.prototype.has=FRe;Mm.prototype.set=BRe;var Hx=Mm,WRe=kh,GRe=Mc,$Re=WRe(GRe,"Map"),i2=$Re,yz=vRe,HRe=Hx,zRe=i2;function KRe(){this.size=0,this.__data__={hash:new yz,map:new(zRe||HRe),string:new yz}}var YRe=KRe;function qRe(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}var XRe=qRe,JRe=XRe;function QRe(e,n){var a=e.__data__;return JRe(n)?a[typeof n=="string"?"string":"hash"]:a.map}var zx=QRe,ZRe=zx;function eAe(e){var n=ZRe(this,e).delete(e);return this.size-=n?1:0,n}var tAe=eAe,nAe=zx;function rAe(e){return nAe(this,e).get(e)}var iAe=rAe,aAe=zx;function sAe(e){return aAe(this,e).has(e)}var oAe=sAe,cAe=zx;function lAe(e,n){var a=cAe(this,e),o=a.size;return a.set(e,n),this.size+=a.size==o?0:1,this}var dAe=lAe,uAe=YRe,hAe=tAe,pAe=iAe,fAe=oAe,mAe=dAe;function Um(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Um.prototype.clear=uAe;Um.prototype.delete=hAe;Um.prototype.get=pAe;Um.prototype.has=fAe;Um.prototype.set=mAe;var a2=Um,FJ=a2,gAe="Expected a function";function s2(e,n){if(typeof e!="function"||n!=null&&typeof n!="function")throw new TypeError(gAe);var a=function(){var o=arguments,l=n?n.apply(this,o):o[0],p=a.cache;if(p.has(l))return p.get(l);var m=e.apply(this,o);return a.cache=p.set(l,m)||p,m};return a.cache=new(s2.Cache||FJ),a}s2.Cache=FJ;var BJ=s2;const vAe=Zn(BJ);var yAe=BJ,_Ae=500;function EAe(e){var n=yAe(e,function(o){return a.size===_Ae&&a.clear(),o}),a=n.cache;return n}var bAe=EAe,SAe=bAe,wAe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xAe=/\\(\\)?/g,TAe=SAe(function(e){var n=[];return e.charCodeAt(0)===46&&n.push(""),e.replace(wAe,function(a,o,l,p){n.push(l?p.replace(xAe,"$1"):o||a)}),n}),CAe=TAe;function RAe(e,n){for(var a=-1,o=e==null?0:e.length,l=Array(o);++a<o;)l[a]=n(e[a],a,e);return l}var o2=RAe,_z=T_,AAe=o2,NAe=za,OAe=km,Ez=_z?_z.prototype:void 0,bz=Ez?Ez.toString:void 0;function WJ(e){if(typeof e=="string")return e;if(NAe(e))return AAe(e,WJ)+"";if(OAe(e))return bz?bz.call(e):"";var n=e+"";return n=="0"&&1/e==-1/0?"-0":n}var IAe=WJ,PAe=IAe;function DAe(e){return e==null?"":PAe(e)}var GJ=DAe,kAe=za,LAe=t2,jAe=CAe,MAe=GJ;function UAe(e,n){return kAe(e)?e:LAe(e,n)?[e]:jAe(MAe(e))}var $J=UAe,VAe=km;function FAe(e){if(typeof e=="string"||VAe(e))return e;var n=e+"";return n=="0"&&1/e==-1/0?"-0":n}var Kx=FAe,BAe=$J,WAe=Kx;function GAe(e,n){n=BAe(n,e);for(var a=0,o=n.length;e!=null&&a<o;)e=e[WAe(n[a++])];return a&&a==o?e:void 0}var c2=GAe,$Ae=c2;function HAe(e,n,a){var o=e==null?void 0:$Ae(e,n);return o===void 0?a:o}var HJ=HAe;const Js=Zn(HJ);function zAe(e){return e==null}var KAe=zAe;const pn=Zn(KAe);var YAe=Al,qAe=za,XAe=Nl,JAe="[object String]";function QAe(e){return typeof e=="string"||!qAe(e)&&XAe(e)&&YAe(e)==JAe}var ZAe=QAe;const Rh=Zn(ZAe);var zJ={exports:{}},Hn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l2=Symbol.for("react.element"),d2=Symbol.for("react.portal"),Yx=Symbol.for("react.fragment"),qx=Symbol.for("react.strict_mode"),Xx=Symbol.for("react.profiler"),Jx=Symbol.for("react.provider"),Qx=Symbol.for("react.context"),eNe=Symbol.for("react.server_context"),Zx=Symbol.for("react.forward_ref"),eT=Symbol.for("react.suspense"),tT=Symbol.for("react.suspense_list"),nT=Symbol.for("react.memo"),rT=Symbol.for("react.lazy"),tNe=Symbol.for("react.offscreen"),KJ;KJ=Symbol.for("react.module.reference");function io(e){if(typeof e=="object"&&e!==null){var n=e.$$typeof;switch(n){case l2:switch(e=e.type,e){case Yx:case Xx:case qx:case eT:case tT:return e;default:switch(e=e&&e.$$typeof,e){case eNe:case Qx:case Zx:case rT:case nT:case Jx:return e;default:return n}}case d2:return n}}}Hn.ContextConsumer=Qx;Hn.ContextProvider=Jx;Hn.Element=l2;Hn.ForwardRef=Zx;Hn.Fragment=Yx;Hn.Lazy=rT;Hn.Memo=nT;Hn.Portal=d2;Hn.Profiler=Xx;Hn.StrictMode=qx;Hn.Suspense=eT;Hn.SuspenseList=tT;Hn.isAsyncMode=function(){return!1};Hn.isConcurrentMode=function(){return!1};Hn.isContextConsumer=function(e){return io(e)===Qx};Hn.isContextProvider=function(e){return io(e)===Jx};Hn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===l2};Hn.isForwardRef=function(e){return io(e)===Zx};Hn.isFragment=function(e){return io(e)===Yx};Hn.isLazy=function(e){return io(e)===rT};Hn.isMemo=function(e){return io(e)===nT};Hn.isPortal=function(e){return io(e)===d2};Hn.isProfiler=function(e){return io(e)===Xx};Hn.isStrictMode=function(e){return io(e)===qx};Hn.isSuspense=function(e){return io(e)===eT};Hn.isSuspenseList=function(e){return io(e)===tT};Hn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Yx||e===Xx||e===qx||e===eT||e===tT||e===tNe||typeof e=="object"&&e!==null&&(e.$$typeof===rT||e.$$typeof===nT||e.$$typeof===Jx||e.$$typeof===Qx||e.$$typeof===Zx||e.$$typeof===KJ||e.getModuleId!==void 0)};Hn.typeOf=io;zJ.exports=Hn;var nNe=zJ.exports,rNe=Al,iNe=Nl,aNe="[object Number]";function sNe(e){return typeof e=="number"||iNe(e)&&rNe(e)==aNe}var YJ=sNe;const oNe=Zn(YJ);var cNe=YJ;function lNe(e){return cNe(e)&&e!=+e}var dNe=lNe;const Vm=Zn(dNe);var Go=function(n){return n===0?0:n>0?1:-1},oh=function(n){return Rh(n)&&n.indexOf("%")===n.length-1},nt=function(n){return oNe(n)&&!Vm(n)},uNe=function(n){return pn(n)},pi=function(n){return nt(n)||Rh(n)},hNe=0,Fm=function(n){var a=++hNe;return"".concat(n||"").concat(a)},Ah=function(n,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!nt(n)&&!Rh(n))return o;var p;if(oh(n)){var m=n.indexOf("%");p=a*parseFloat(n.slice(0,m))/100}else p=+n;return Vm(p)&&(p=o),l&&p>a&&(p=a),p},Ed=function(n){if(!n)return null;var a=Object.keys(n);return a&&a.length?n[a[0]]:null},pNe=function(n){if(!Array.isArray(n))return!1;for(var a=n.length,o={},l=0;l<a;l++)if(!o[n[l]])o[n[l]]=!0;else return!0;return!1},Vi=function(n,a){return nt(n)&&nt(a)?function(o){return n+o*(a-n)}:function(){return a}};function ow(e,n,a){return!e||!e.length?null:e.find(function(o){return o&&(typeof n=="function"?n(o):Js(o,n))===a})}var fNe=function(n,a){return nt(n)&&nt(a)?n-a:Rh(n)&&Rh(a)?n.localeCompare(a):n instanceof Date&&a instanceof Date?n.getTime()-a.getTime():String(n).localeCompare(String(a))};function Ff(e,n){for(var a in e)if({}.hasOwnProperty.call(e,a)&&(!{}.hasOwnProperty.call(n,a)||e[a]!==n[a]))return!1;for(var o in n)if({}.hasOwnProperty.call(n,o)&&!{}.hasOwnProperty.call(e,o))return!1;return!0}function mP(e){"@babel/helpers - typeof";return mP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},mP(e)}var mNe=["viewBox","children"],gNe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],Sz=["points","pathLength"],AI={svg:mNe,polygon:Sz,polyline:Sz},u2=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],cw=function(n,a){if(!n||typeof n=="function"||typeof n=="boolean")return null;var o=n;if(J.isValidElement(n)&&(o=n.props),!Lm(o))return null;var l={};return Object.keys(o).forEach(function(p){u2.includes(p)&&(l[p]=a||function(m){return o[p](o,m)})}),l},vNe=function(n,a,o){return function(l){return n(a,o,l),null}},lw=function(n,a,o){if(!Lm(n)||mP(n)!=="object")return null;var l=null;return Object.keys(n).forEach(function(p){var m=n[p];u2.includes(p)&&typeof m=="function"&&(l||(l={}),l[p]=vNe(m,a,o))}),l},yNe=["children"],_Ne=["children"];function wz(e,n){if(e==null)return{};var a=ENe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function ENe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function gP(e){"@babel/helpers - typeof";return gP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},gP(e)}var xz={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},hl=function(n){return typeof n=="string"?n:n?n.displayName||n.name||"Component":""},Tz=null,NI=null,h2=function e(n){if(n===Tz&&Array.isArray(NI))return NI;var a=[];return J.Children.forEach(n,function(o){pn(o)||(nNe.isFragment(o)?a=a.concat(e(o.props.children)):a.push(o))}),NI=a,Tz=n,a};function Qs(e,n){var a=[],o=[];return Array.isArray(n)?o=n.map(function(l){return hl(l)}):o=[hl(n)],h2(e).forEach(function(l){var p=Js(l,"type.displayName")||Js(l,"type.name");o.indexOf(p)!==-1&&a.push(l)}),a}function ds(e,n){var a=Qs(e,n);return a&&a[0]}var Cz=function(n){if(!n||!n.props)return!1;var a=n.props,o=a.width,l=a.height;return!(!nt(o)||o<=0||!nt(l)||l<=0)},bNe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],SNe=function(n){return n&&n.type&&Rh(n.type)&&bNe.indexOf(n.type)>=0},qJ=function(n){return n&&gP(n)==="object"&&"clipDot"in n},wNe=function(n,a,o,l){var p,m=(p=AI==null?void 0:AI[l])!==null&&p!==void 0?p:[];return a.startsWith("data-")||!sn(n)&&(l&&m.includes(a)||gNe.includes(a))||o&&u2.includes(a)},un=function(n,a,o){if(!n||typeof n=="function"||typeof n=="boolean")return null;var l=n;if(J.isValidElement(n)&&(l=n.props),!Lm(l))return null;var p={};return Object.keys(l).forEach(function(m){var y;wNe((y=l)===null||y===void 0?void 0:y[m],m,a,o)&&(p[m]=l[m])}),p},vP=function e(n,a){if(n===a)return!0;var o=J.Children.count(n);if(o!==J.Children.count(a))return!1;if(o===0)return!0;if(o===1)return Rz(Array.isArray(n)?n[0]:n,Array.isArray(a)?a[0]:a);for(var l=0;l<o;l++){var p=n[l],m=a[l];if(Array.isArray(p)||Array.isArray(m)){if(!e(p,m))return!1}else if(!Rz(p,m))return!1}return!0},Rz=function(n,a){if(pn(n)&&pn(a))return!0;if(!pn(n)&&!pn(a)){var o=n.props||{},l=o.children,p=wz(o,yNe),m=a.props||{},y=m.children,E=wz(m,_Ne);return l&&y?Ff(p,E)&&vP(l,y):!l&&!y?Ff(p,E):!1}return!1},Az=function(n,a){var o=[],l={};return h2(n).forEach(function(p,m){if(SNe(p))o.push(p);else if(p){var y=hl(p.type),E=a[y]||{},b=E.handler,T=E.once;if(b&&(!T||!l[y])){var x=b(p,y,m);o.push(x),l[y]=!0}}}),o},xNe=function(n){var a=n&&n.type;return a&&xz[a]?xz[a]:null},TNe=function(n,a){return h2(a).indexOf(n)},CNe=["children","width","height","viewBox","className","style","title","desc"];function yP(){return yP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},yP.apply(this,arguments)}function RNe(e,n){if(e==null)return{};var a=ANe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function ANe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function _P(e){var n=e.children,a=e.width,o=e.height,l=e.viewBox,p=e.className,m=e.style,y=e.title,E=e.desc,b=RNe(e,CNe),T=l||{width:a,height:o,x:0,y:0},x=Cn("recharts-surface",p);return me.createElement("svg",yP({},un(b,!0,"svg"),{className:x,width:a,height:o,style:m,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height)}),me.createElement("title",null,y),me.createElement("desc",null,E),n)}var NNe=["children","className"];function EP(){return EP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},EP.apply(this,arguments)}function ONe(e,n){if(e==null)return{};var a=INe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function INe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var cr=me.forwardRef(function(e,n){var a=e.children,o=e.className,l=ONe(e,NNe),p=Cn("recharts-layer",o);return me.createElement("g",EP({className:p},un(l,!0),{ref:n}),a)}),pl=function(n,a){for(var o=arguments.length,l=new Array(o>2?o-2:0),p=2;p<o;p++)l[p-2]=arguments[p]};function PNe(e,n,a){var o=-1,l=e.length;n<0&&(n=-n>l?0:l+n),a=a>l?l:a,a<0&&(a+=l),l=n>a?0:a-n>>>0,n>>>=0;for(var p=Array(l);++o<l;)p[o]=e[o+n];return p}var DNe=PNe,kNe=DNe;function LNe(e,n,a){var o=e.length;return a=a===void 0?o:a,!n&&a>=o?e:kNe(e,n,a)}var jNe=LNe,MNe="\\ud800-\\udfff",UNe="\\u0300-\\u036f",VNe="\\ufe20-\\ufe2f",FNe="\\u20d0-\\u20ff",BNe=UNe+VNe+FNe,WNe="\\ufe0e\\ufe0f",GNe="\\u200d",$Ne=RegExp("["+GNe+MNe+BNe+WNe+"]");function HNe(e){return $Ne.test(e)}var XJ=HNe;function zNe(e){return e.split("")}var KNe=zNe,JJ="\\ud800-\\udfff",YNe="\\u0300-\\u036f",qNe="\\ufe20-\\ufe2f",XNe="\\u20d0-\\u20ff",JNe=YNe+qNe+XNe,QNe="\\ufe0e\\ufe0f",ZNe="["+JJ+"]",bP="["+JNe+"]",SP="\\ud83c[\\udffb-\\udfff]",eOe="(?:"+bP+"|"+SP+")",QJ="[^"+JJ+"]",ZJ="(?:\\ud83c[\\udde6-\\uddff]){2}",eQ="[\\ud800-\\udbff][\\udc00-\\udfff]",tOe="\\u200d",tQ=eOe+"?",nQ="["+QNe+"]?",nOe="(?:"+tOe+"(?:"+[QJ,ZJ,eQ].join("|")+")"+nQ+tQ+")*",rOe=nQ+tQ+nOe,iOe="(?:"+[QJ+bP+"?",bP,ZJ,eQ,ZNe].join("|")+")",aOe=RegExp(SP+"(?="+SP+")|"+iOe+rOe,"g");function sOe(e){return e.match(aOe)||[]}var oOe=sOe,cOe=KNe,lOe=XJ,dOe=oOe;function uOe(e){return lOe(e)?dOe(e):cOe(e)}var hOe=uOe,pOe=jNe,fOe=XJ,mOe=hOe,gOe=GJ;function vOe(e){return function(n){n=gOe(n);var a=fOe(n)?mOe(n):void 0,o=a?a[0]:n.charAt(0),l=a?pOe(a,1).join(""):n.slice(1);return o[e]()+l}}var yOe=vOe,_Oe=yOe,EOe=_Oe("toUpperCase"),bOe=EOe;const iT=Zn(bOe);function sr(e){return function(){return e}}const rQ=Math.cos,dw=Math.sin,Xo=Math.sqrt,uw=Math.PI,aT=2*uw,wP=Math.PI,xP=2*wP,Ju=1e-6,SOe=xP-Ju;function iQ(e){this._+=e[0];for(let n=1,a=e.length;n<a;++n)this._+=arguments[n]+e[n]}function wOe(e){let n=Math.floor(e);if(!(n>=0))throw new Error(`invalid digits: ${e}`);if(n>15)return iQ;const a=10**n;return function(o){this._+=o[0];for(let l=1,p=o.length;l<p;++l)this._+=Math.round(arguments[l]*a)/a+o[l]}}class xOe{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?iQ:wOe(n)}moveTo(n,a){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+a}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,a){this._append`L${this._x1=+n},${this._y1=+a}`}quadraticCurveTo(n,a,o,l){this._append`Q${+n},${+a},${this._x1=+o},${this._y1=+l}`}bezierCurveTo(n,a,o,l,p,m){this._append`C${+n},${+a},${+o},${+l},${this._x1=+p},${this._y1=+m}`}arcTo(n,a,o,l,p){if(n=+n,a=+a,o=+o,l=+l,p=+p,p<0)throw new Error(`negative radius: ${p}`);let m=this._x1,y=this._y1,E=o-n,b=l-a,T=m-n,x=y-a,A=T*T+x*x;if(this._x1===null)this._append`M${this._x1=n},${this._y1=a}`;else if(A>Ju)if(!(Math.abs(x*E-b*T)>Ju)||!p)this._append`L${this._x1=n},${this._y1=a}`;else{let D=o-m,N=l-y,L=E*E+b*b,P=D*D+N*N,U=Math.sqrt(L),V=Math.sqrt(A),F=p*Math.tan((wP-Math.acos((L+A-P)/(2*U*V)))/2),H=F/V,B=F/U;Math.abs(H-1)>Ju&&this._append`L${n+H*T},${a+H*x}`,this._append`A${p},${p},0,0,${+(x*D>T*N)},${this._x1=n+B*E},${this._y1=a+B*b}`}}arc(n,a,o,l,p,m){if(n=+n,a=+a,o=+o,m=!!m,o<0)throw new Error(`negative radius: ${o}`);let y=o*Math.cos(l),E=o*Math.sin(l),b=n+y,T=a+E,x=1^m,A=m?l-p:p-l;this._x1===null?this._append`M${b},${T}`:(Math.abs(this._x1-b)>Ju||Math.abs(this._y1-T)>Ju)&&this._append`L${b},${T}`,o&&(A<0&&(A=A%xP+xP),A>SOe?this._append`A${o},${o},0,1,${x},${n-y},${a-E}A${o},${o},0,1,${x},${this._x1=b},${this._y1=T}`:A>Ju&&this._append`A${o},${o},0,${+(A>=wP)},${x},${this._x1=n+o*Math.cos(p)},${this._y1=a+o*Math.sin(p)}`)}rect(n,a,o,l){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+a}h${o=+o}v${+l}h${-o}Z`}toString(){return this._}}function p2(e){let n=3;return e.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const o=Math.floor(a);if(!(o>=0))throw new RangeError(`invalid digits: ${a}`);n=o}return e},()=>new xOe(n)}function f2(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function aQ(e){this._context=e}aQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:this._context.lineTo(e,n);break}}};function sT(e){return new aQ(e)}function sQ(e){return e[0]}function oQ(e){return e[1]}function cQ(e,n){var a=sr(!0),o=null,l=sT,p=null,m=p2(y);e=typeof e=="function"?e:e===void 0?sQ:sr(e),n=typeof n=="function"?n:n===void 0?oQ:sr(n);function y(E){var b,T=(E=f2(E)).length,x,A=!1,D;for(o==null&&(p=l(D=m())),b=0;b<=T;++b)!(b<T&&a(x=E[b],b,E))===A&&((A=!A)?p.lineStart():p.lineEnd()),A&&p.point(+e(x,b,E),+n(x,b,E));if(D)return p=null,D+""||null}return y.x=function(E){return arguments.length?(e=typeof E=="function"?E:sr(+E),y):e},y.y=function(E){return arguments.length?(n=typeof E=="function"?E:sr(+E),y):n},y.defined=function(E){return arguments.length?(a=typeof E=="function"?E:sr(!!E),y):a},y.curve=function(E){return arguments.length?(l=E,o!=null&&(p=l(o)),y):l},y.context=function(E){return arguments.length?(E==null?o=p=null:p=l(o=E),y):o},y}function Qb(e,n,a){var o=null,l=sr(!0),p=null,m=sT,y=null,E=p2(b);e=typeof e=="function"?e:e===void 0?sQ:sr(+e),n=typeof n=="function"?n:sr(n===void 0?0:+n),a=typeof a=="function"?a:a===void 0?oQ:sr(+a);function b(x){var A,D,N,L=(x=f2(x)).length,P,U=!1,V,F=new Array(L),H=new Array(L);for(p==null&&(y=m(V=E())),A=0;A<=L;++A){if(!(A<L&&l(P=x[A],A,x))===U)if(U=!U)D=A,y.areaStart(),y.lineStart();else{for(y.lineEnd(),y.lineStart(),N=A-1;N>=D;--N)y.point(F[N],H[N]);y.lineEnd(),y.areaEnd()}U&&(F[A]=+e(P,A,x),H[A]=+n(P,A,x),y.point(o?+o(P,A,x):F[A],a?+a(P,A,x):H[A]))}if(V)return y=null,V+""||null}function T(){return cQ().defined(l).curve(m).context(p)}return b.x=function(x){return arguments.length?(e=typeof x=="function"?x:sr(+x),o=null,b):e},b.x0=function(x){return arguments.length?(e=typeof x=="function"?x:sr(+x),b):e},b.x1=function(x){return arguments.length?(o=x==null?null:typeof x=="function"?x:sr(+x),b):o},b.y=function(x){return arguments.length?(n=typeof x=="function"?x:sr(+x),a=null,b):n},b.y0=function(x){return arguments.length?(n=typeof x=="function"?x:sr(+x),b):n},b.y1=function(x){return arguments.length?(a=x==null?null:typeof x=="function"?x:sr(+x),b):a},b.lineX0=b.lineY0=function(){return T().x(e).y(n)},b.lineY1=function(){return T().x(e).y(a)},b.lineX1=function(){return T().x(o).y(n)},b.defined=function(x){return arguments.length?(l=typeof x=="function"?x:sr(!!x),b):l},b.curve=function(x){return arguments.length?(m=x,p!=null&&(y=m(p)),b):m},b.context=function(x){return arguments.length?(x==null?p=y=null:y=m(p=x),b):p},b}class lQ{constructor(n,a){this._context=n,this._x=a}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(n,a){switch(n=+n,a=+a,this._point){case 0:{this._point=1,this._line?this._context.lineTo(n,a):this._context.moveTo(n,a);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+n)/2,this._y0,this._x0,a,n,a):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+a)/2,n,this._y0,n,a);break}}this._x0=n,this._y0=a}}function TOe(e){return new lQ(e,!0)}function COe(e){return new lQ(e,!1)}const m2={draw(e,n){const a=Xo(n/uw);e.moveTo(a,0),e.arc(0,0,a,0,aT)}},ROe={draw(e,n){const a=Xo(n/5)/2;e.moveTo(-3*a,-a),e.lineTo(-a,-a),e.lineTo(-a,-3*a),e.lineTo(a,-3*a),e.lineTo(a,-a),e.lineTo(3*a,-a),e.lineTo(3*a,a),e.lineTo(a,a),e.lineTo(a,3*a),e.lineTo(-a,3*a),e.lineTo(-a,a),e.lineTo(-3*a,a),e.closePath()}},dQ=Xo(1/3),AOe=dQ*2,NOe={draw(e,n){const a=Xo(n/AOe),o=a*dQ;e.moveTo(0,-a),e.lineTo(o,0),e.lineTo(0,a),e.lineTo(-o,0),e.closePath()}},OOe={draw(e,n){const a=Xo(n),o=-a/2;e.rect(o,o,a,a)}},IOe=.8908130915292852,uQ=dw(uw/10)/dw(7*uw/10),POe=dw(aT/10)*uQ,DOe=-rQ(aT/10)*uQ,kOe={draw(e,n){const a=Xo(n*IOe),o=POe*a,l=DOe*a;e.moveTo(0,-a),e.lineTo(o,l);for(let p=1;p<5;++p){const m=aT*p/5,y=rQ(m),E=dw(m);e.lineTo(E*a,-y*a),e.lineTo(y*o-E*l,E*o+y*l)}e.closePath()}},OI=Xo(3),LOe={draw(e,n){const a=-Xo(n/(OI*3));e.moveTo(0,a*2),e.lineTo(-OI*a,-a),e.lineTo(OI*a,-a),e.closePath()}},Ws=-.5,Gs=Xo(3)/2,TP=1/Xo(12),jOe=(TP/2+1)*3,MOe={draw(e,n){const a=Xo(n/jOe),o=a/2,l=a*TP,p=o,m=a*TP+a,y=-p,E=m;e.moveTo(o,l),e.lineTo(p,m),e.lineTo(y,E),e.lineTo(Ws*o-Gs*l,Gs*o+Ws*l),e.lineTo(Ws*p-Gs*m,Gs*p+Ws*m),e.lineTo(Ws*y-Gs*E,Gs*y+Ws*E),e.lineTo(Ws*o+Gs*l,Ws*l-Gs*o),e.lineTo(Ws*p+Gs*m,Ws*m-Gs*p),e.lineTo(Ws*y+Gs*E,Ws*E-Gs*y),e.closePath()}};function UOe(e,n){let a=null,o=p2(l);e=typeof e=="function"?e:sr(e||m2),n=typeof n=="function"?n:sr(n===void 0?64:+n);function l(){let p;if(a||(a=p=o()),e.apply(this,arguments).draw(a,+n.apply(this,arguments)),p)return a=null,p+""||null}return l.type=function(p){return arguments.length?(e=typeof p=="function"?p:sr(p),l):e},l.size=function(p){return arguments.length?(n=typeof p=="function"?p:sr(+p),l):n},l.context=function(p){return arguments.length?(a=p??null,l):a},l}function hw(){}function pw(e,n,a){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+n)/6,(e._y0+4*e._y1+a)/6)}function hQ(e){this._context=e}hQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:pw(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:pw(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function VOe(e){return new hQ(e)}function pQ(e){this._context=e}pQ.prototype={areaStart:hw,areaEnd:hw,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._x2=e,this._y2=n;break;case 1:this._point=2,this._x3=e,this._y3=n;break;case 2:this._point=3,this._x4=e,this._y4=n,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+n)/6);break;default:pw(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function FOe(e){return new pQ(e)}function fQ(e){this._context=e}fQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var a=(this._x0+4*this._x1+e)/6,o=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(a,o):this._context.moveTo(a,o);break;case 3:this._point=4;default:pw(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function BOe(e){return new fQ(e)}function mQ(e){this._context=e}mQ.prototype={areaStart:hw,areaEnd:hw,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,n){e=+e,n=+n,this._point?this._context.lineTo(e,n):(this._point=1,this._context.moveTo(e,n))}};function WOe(e){return new mQ(e)}function Nz(e){return e<0?-1:1}function Oz(e,n,a){var o=e._x1-e._x0,l=n-e._x1,p=(e._y1-e._y0)/(o||l<0&&-0),m=(a-e._y1)/(l||o<0&&-0),y=(p*l+m*o)/(o+l);return(Nz(p)+Nz(m))*Math.min(Math.abs(p),Math.abs(m),.5*Math.abs(y))||0}function Iz(e,n){var a=e._x1-e._x0;return a?(3*(e._y1-e._y0)/a-n)/2:n}function II(e,n,a){var o=e._x0,l=e._y0,p=e._x1,m=e._y1,y=(p-o)/3;e._context.bezierCurveTo(o+y,l+y*n,p-y,m-y*a,p,m)}function fw(e){this._context=e}fw.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:II(this,this._t0,Iz(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){var a=NaN;if(e=+e,n=+n,!(e===this._x1&&n===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,II(this,Iz(this,a=Oz(this,e,n)),a);break;default:II(this,this._t0,a=Oz(this,e,n));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n,this._t0=a}}};function gQ(e){this._context=new vQ(e)}(gQ.prototype=Object.create(fw.prototype)).point=function(e,n){fw.prototype.point.call(this,n,e)};function vQ(e){this._context=e}vQ.prototype={moveTo:function(e,n){this._context.moveTo(n,e)},closePath:function(){this._context.closePath()},lineTo:function(e,n){this._context.lineTo(n,e)},bezierCurveTo:function(e,n,a,o,l,p){this._context.bezierCurveTo(n,e,o,a,p,l)}};function GOe(e){return new fw(e)}function $Oe(e){return new gQ(e)}function yQ(e){this._context=e}yQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,n=this._y,a=e.length;if(a)if(this._line?this._context.lineTo(e[0],n[0]):this._context.moveTo(e[0],n[0]),a===2)this._context.lineTo(e[1],n[1]);else for(var o=Pz(e),l=Pz(n),p=0,m=1;m<a;++p,++m)this._context.bezierCurveTo(o[0][p],l[0][p],o[1][p],l[1][p],e[m],n[m]);(this._line||this._line!==0&&a===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,n){this._x.push(+e),this._y.push(+n)}};function Pz(e){var n,a=e.length-1,o,l=new Array(a),p=new Array(a),m=new Array(a);for(l[0]=0,p[0]=2,m[0]=e[0]+2*e[1],n=1;n<a-1;++n)l[n]=1,p[n]=4,m[n]=4*e[n]+2*e[n+1];for(l[a-1]=2,p[a-1]=7,m[a-1]=8*e[a-1]+e[a],n=1;n<a;++n)o=l[n]/p[n-1],p[n]-=o,m[n]-=o*m[n-1];for(l[a-1]=m[a-1]/p[a-1],n=a-2;n>=0;--n)l[n]=(m[n]-l[n+1])/p[n];for(p[a-1]=(e[a]+l[a-1])/2,n=0;n<a-1;++n)p[n]=2*e[n+1]-l[n+1];return[l,p]}function HOe(e){return new yQ(e)}function oT(e,n){this._context=e,this._t=n}oT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(e,n);else{var a=this._x*(1-this._t)+e*this._t;this._context.lineTo(a,this._y),this._context.lineTo(a,n)}break}}this._x=e,this._y=n}};function zOe(e){return new oT(e,.5)}function KOe(e){return new oT(e,0)}function YOe(e){return new oT(e,1)}function tm(e,n){if((m=e.length)>1)for(var a=1,o,l,p=e[n[0]],m,y=p.length;a<m;++a)for(l=p,p=e[n[a]],o=0;o<y;++o)p[o][1]+=p[o][0]=isNaN(l[o][1])?l[o][0]:l[o][1]}function CP(e){for(var n=e.length,a=new Array(n);--n>=0;)a[n]=n;return a}function qOe(e,n){return e[n]}function XOe(e){const n=[];return n.key=e,n}function JOe(){var e=sr([]),n=CP,a=tm,o=qOe;function l(p){var m=Array.from(e.apply(this,arguments),XOe),y,E=m.length,b=-1,T;for(const x of p)for(y=0,++b;y<E;++y)(m[y][b]=[0,+o(x,m[y].key,b,p)]).data=x;for(y=0,T=f2(n(m));y<E;++y)m[T[y]].index=y;return a(m,T),m}return l.keys=function(p){return arguments.length?(e=typeof p=="function"?p:sr(Array.from(p)),l):e},l.value=function(p){return arguments.length?(o=typeof p=="function"?p:sr(+p),l):o},l.order=function(p){return arguments.length?(n=p==null?CP:typeof p=="function"?p:sr(Array.from(p)),l):n},l.offset=function(p){return arguments.length?(a=p??tm,l):a},l}function QOe(e,n){if((o=e.length)>0){for(var a,o,l=0,p=e[0].length,m;l<p;++l){for(m=a=0;a<o;++a)m+=e[a][l][1]||0;if(m)for(a=0;a<o;++a)e[a][l][1]/=m}tm(e,n)}}function ZOe(e,n){if((l=e.length)>0){for(var a=0,o=e[n[0]],l,p=o.length;a<p;++a){for(var m=0,y=0;m<l;++m)y+=e[m][a][1]||0;o[a][1]+=o[a][0]=-y/2}tm(e,n)}}function eIe(e,n){if(!(!((m=e.length)>0)||!((p=(l=e[n[0]]).length)>0))){for(var a=0,o=1,l,p,m;o<p;++o){for(var y=0,E=0,b=0;y<m;++y){for(var T=e[n[y]],x=T[o][1]||0,A=T[o-1][1]||0,D=(x-A)/2,N=0;N<y;++N){var L=e[n[N]],P=L[o][1]||0,U=L[o-1][1]||0;D+=P-U}E+=x,b+=D*x}l[o-1][1]+=l[o-1][0]=a,E&&(a-=b/E)}l[o-1][1]+=l[o-1][0]=a,tm(e,n)}}function Oy(e){"@babel/helpers - typeof";return Oy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Oy(e)}var tIe=["type","size","sizeType"];function RP(){return RP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},RP.apply(this,arguments)}function Dz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function kz(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Dz(Object(a),!0).forEach(function(o){nIe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Dz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function nIe(e,n,a){return n=rIe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function rIe(e){var n=iIe(e,"string");return Oy(n)=="symbol"?n:n+""}function iIe(e,n){if(Oy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Oy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function aIe(e,n){if(e==null)return{};var a=sIe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function sIe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var _Q={symbolCircle:m2,symbolCross:ROe,symbolDiamond:NOe,symbolSquare:OOe,symbolStar:kOe,symbolTriangle:LOe,symbolWye:MOe},oIe=Math.PI/180,cIe=function(n){var a="symbol".concat(iT(n));return _Q[a]||m2},lIe=function(n,a,o){if(a==="area")return n;switch(o){case"cross":return 5*n*n/9;case"diamond":return .5*n*n/Math.sqrt(3);case"square":return n*n;case"star":{var l=18*oIe;return 1.25*n*n*(Math.tan(l)-Math.tan(l*2)*Math.pow(Math.tan(l),2))}case"triangle":return Math.sqrt(3)*n*n/4;case"wye":return(21-10*Math.sqrt(3))*n*n/8;default:return Math.PI*n*n/4}},dIe=function(n,a){_Q["symbol".concat(iT(n))]=a},g2=function(n){var a=n.type,o=a===void 0?"circle":a,l=n.size,p=l===void 0?64:l,m=n.sizeType,y=m===void 0?"area":m,E=aIe(n,tIe),b=kz(kz({},E),{},{type:o,size:p,sizeType:y}),T=function(){var P=cIe(o),U=UOe().type(P).size(lIe(p,y,o));return U()},x=b.className,A=b.cx,D=b.cy,N=un(b,!0);return A===+A&&D===+D&&p===+p?me.createElement("path",RP({},N,{className:Cn("recharts-symbols",x),transform:"translate(".concat(A,", ").concat(D,")"),d:T()})):null};g2.registerSymbol=dIe;function nm(e){"@babel/helpers - typeof";return nm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},nm(e)}function AP(){return AP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},AP.apply(this,arguments)}function Lz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function uIe(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Lz(Object(a),!0).forEach(function(o){Iy(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Lz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function hIe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function pIe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,bQ(o.key),o)}}function fIe(e,n,a){return n&&pIe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function mIe(e,n,a){return n=mw(n),gIe(e,EQ()?Reflect.construct(n,a||[],mw(e).constructor):n.apply(e,a))}function gIe(e,n){if(n&&(nm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vIe(e)}function vIe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function EQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(EQ=function(){return!!e})()}function mw(e){return mw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},mw(e)}function yIe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&NP(e,n)}function NP(e,n){return NP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},NP(e,n)}function Iy(e,n,a){return n=bQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function bQ(e){var n=_Ie(e,"string");return nm(n)=="symbol"?n:n+""}function _Ie(e,n){if(nm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(nm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var $s=32,v2=function(e){function n(){return hIe(this,n),mIe(this,n,arguments)}return yIe(n,e),fIe(n,[{key:"renderIcon",value:function(o){var l=this.props.inactiveColor,p=$s/2,m=$s/6,y=$s/3,E=o.inactive?l:o.color;if(o.type==="plainline")return me.createElement("line",{strokeWidth:4,fill:"none",stroke:E,strokeDasharray:o.payload.strokeDasharray,x1:0,y1:p,x2:$s,y2:p,className:"recharts-legend-icon"});if(o.type==="line")return me.createElement("path",{strokeWidth:4,fill:"none",stroke:E,d:"M0,".concat(p,"h").concat(y,`
            A`).concat(m,",").concat(m,",0,1,1,").concat(2*y,",").concat(p,`
            H`).concat($s,"M").concat(2*y,",").concat(p,`
            A`).concat(m,",").concat(m,",0,1,1,").concat(y,",").concat(p),className:"recharts-legend-icon"});if(o.type==="rect")return me.createElement("path",{stroke:"none",fill:E,d:"M0,".concat($s/8,"h").concat($s,"v").concat($s*3/4,"h").concat(-$s,"z"),className:"recharts-legend-icon"});if(me.isValidElement(o.legendIcon)){var b=uIe({},o);return delete b.legendIcon,me.cloneElement(o.legendIcon,b)}return me.createElement(g2,{fill:E,cx:p,cy:p,size:$s,sizeType:"diameter",type:o.type})}},{key:"renderItems",value:function(){var o=this,l=this.props,p=l.payload,m=l.iconSize,y=l.layout,E=l.formatter,b=l.inactiveColor,T={x:0,y:0,width:$s,height:$s},x={display:y==="horizontal"?"inline-block":"block",marginRight:10},A={display:"inline-block",verticalAlign:"middle",marginRight:4};return p.map(function(D,N){var L=D.formatter||E,P=Cn(Iy(Iy({"recharts-legend-item":!0},"legend-item-".concat(N),!0),"inactive",D.inactive));if(D.type==="none")return null;var U=sn(D.value)?null:D.value;pl(!sn(D.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var V=D.inactive?b:D.color;return me.createElement("li",AP({className:P,style:x,key:"legend-item-".concat(N)},lw(o.props,D,N)),me.createElement(_P,{width:m,height:m,viewBox:T,style:A},o.renderIcon(D)),me.createElement("span",{className:"recharts-legend-item-text",style:{color:V}},L?L(U,D,N):U))})}},{key:"render",value:function(){var o=this.props,l=o.payload,p=o.layout,m=o.align;if(!l||!l.length)return null;var y={padding:0,margin:0,textAlign:p==="horizontal"?m:"left"};return me.createElement("ul",{className:"recharts-default-legend",style:y},this.renderItems())}}])}(J.PureComponent);Iy(v2,"displayName","Legend");Iy(v2,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var EIe=Hx;function bIe(){this.__data__=new EIe,this.size=0}var SIe=bIe;function wIe(e){var n=this.__data__,a=n.delete(e);return this.size=n.size,a}var xIe=wIe;function TIe(e){return this.__data__.get(e)}var CIe=TIe;function RIe(e){return this.__data__.has(e)}var AIe=RIe,NIe=Hx,OIe=i2,IIe=a2,PIe=200;function DIe(e,n){var a=this.__data__;if(a instanceof NIe){var o=a.__data__;if(!OIe||o.length<PIe-1)return o.push([e,n]),this.size=++a.size,this;a=this.__data__=new IIe(o)}return a.set(e,n),this.size=a.size,this}var kIe=DIe,LIe=Hx,jIe=SIe,MIe=xIe,UIe=CIe,VIe=AIe,FIe=kIe;function Bm(e){var n=this.__data__=new LIe(e);this.size=n.size}Bm.prototype.clear=jIe;Bm.prototype.delete=MIe;Bm.prototype.get=UIe;Bm.prototype.has=VIe;Bm.prototype.set=FIe;var SQ=Bm,BIe="__lodash_hash_undefined__";function WIe(e){return this.__data__.set(e,BIe),this}var GIe=WIe;function $Ie(e){return this.__data__.has(e)}var HIe=$Ie,zIe=a2,KIe=GIe,YIe=HIe;function gw(e){var n=-1,a=e==null?0:e.length;for(this.__data__=new zIe;++n<a;)this.add(e[n])}gw.prototype.add=gw.prototype.push=KIe;gw.prototype.has=YIe;var wQ=gw;function qIe(e,n){for(var a=-1,o=e==null?0:e.length;++a<o;)if(n(e[a],a,e))return!0;return!1}var xQ=qIe;function XIe(e,n){return e.has(n)}var TQ=XIe,JIe=wQ,QIe=xQ,ZIe=TQ,e1e=1,t1e=2;function n1e(e,n,a,o,l,p){var m=a&e1e,y=e.length,E=n.length;if(y!=E&&!(m&&E>y))return!1;var b=p.get(e),T=p.get(n);if(b&&T)return b==n&&T==e;var x=-1,A=!0,D=a&t1e?new JIe:void 0;for(p.set(e,n),p.set(n,e);++x<y;){var N=e[x],L=n[x];if(o)var P=m?o(L,N,x,n,e,p):o(N,L,x,e,n,p);if(P!==void 0){if(P)continue;A=!1;break}if(D){if(!QIe(n,function(U,V){if(!ZIe(D,V)&&(N===U||l(N,U,a,o,p)))return D.push(V)})){A=!1;break}}else if(!(N===L||l(N,L,a,o,p))){A=!1;break}}return p.delete(e),p.delete(n),A}var CQ=n1e,r1e=Mc,i1e=r1e.Uint8Array,a1e=i1e;function s1e(e){var n=-1,a=Array(e.size);return e.forEach(function(o,l){a[++n]=[l,o]}),a}var o1e=s1e;function c1e(e){var n=-1,a=Array(e.size);return e.forEach(function(o){a[++n]=o}),a}var y2=c1e,jz=T_,Mz=a1e,l1e=r2,d1e=CQ,u1e=o1e,h1e=y2,p1e=1,f1e=2,m1e="[object Boolean]",g1e="[object Date]",v1e="[object Error]",y1e="[object Map]",_1e="[object Number]",E1e="[object RegExp]",b1e="[object Set]",S1e="[object String]",w1e="[object Symbol]",x1e="[object ArrayBuffer]",T1e="[object DataView]",Uz=jz?jz.prototype:void 0,PI=Uz?Uz.valueOf:void 0;function C1e(e,n,a,o,l,p,m){switch(a){case T1e:if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)return!1;e=e.buffer,n=n.buffer;case x1e:return!(e.byteLength!=n.byteLength||!p(new Mz(e),new Mz(n)));case m1e:case g1e:case _1e:return l1e(+e,+n);case v1e:return e.name==n.name&&e.message==n.message;case E1e:case S1e:return e==n+"";case y1e:var y=u1e;case b1e:var E=o&p1e;if(y||(y=h1e),e.size!=n.size&&!E)return!1;var b=m.get(e);if(b)return b==n;o|=f1e,m.set(e,n);var T=d1e(y(e),y(n),o,l,p,m);return m.delete(e),T;case w1e:if(PI)return PI.call(e)==PI.call(n)}return!1}var R1e=C1e;function A1e(e,n){for(var a=-1,o=n.length,l=e.length;++a<o;)e[l+a]=n[a];return e}var RQ=A1e,N1e=RQ,O1e=za;function I1e(e,n,a){var o=n(e);return O1e(e)?o:N1e(o,a(e))}var P1e=I1e;function D1e(e,n){for(var a=-1,o=e==null?0:e.length,l=0,p=[];++a<o;){var m=e[a];n(m,a,e)&&(p[l++]=m)}return p}var k1e=D1e;function L1e(){return[]}var j1e=L1e,M1e=k1e,U1e=j1e,V1e=Object.prototype,F1e=V1e.propertyIsEnumerable,Vz=Object.getOwnPropertySymbols,B1e=Vz?function(e){return e==null?[]:(e=Object(e),M1e(Vz(e),function(n){return F1e.call(e,n)}))}:U1e,W1e=B1e;function G1e(e,n){for(var a=-1,o=Array(e);++a<e;)o[a]=n(a);return o}var $1e=G1e,H1e=Al,z1e=Nl,K1e="[object Arguments]";function Y1e(e){return z1e(e)&&H1e(e)==K1e}var q1e=Y1e,Fz=q1e,X1e=Nl,AQ=Object.prototype,J1e=AQ.hasOwnProperty,Q1e=AQ.propertyIsEnumerable,Z1e=Fz(function(){return arguments}())?Fz:function(e){return X1e(e)&&J1e.call(e,"callee")&&!Q1e.call(e,"callee")},_2=Z1e,vw={exports:{}};function ePe(){return!1}var tPe=ePe;vw.exports;(function(e,n){var a=Mc,o=tPe,l=n&&!n.nodeType&&n,p=l&&!0&&e&&!e.nodeType&&e,m=p&&p.exports===l,y=m?a.Buffer:void 0,E=y?y.isBuffer:void 0,b=E||o;e.exports=b})(vw,vw.exports);var NQ=vw.exports,nPe=9007199254740991,rPe=/^(?:0|[1-9]\d*)$/;function iPe(e,n){var a=typeof e;return n=n??nPe,!!n&&(a=="number"||a!="symbol"&&rPe.test(e))&&e>-1&&e%1==0&&e<n}var E2=iPe,aPe=9007199254740991;function sPe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=aPe}var b2=sPe,oPe=Al,cPe=b2,lPe=Nl,dPe="[object Arguments]",uPe="[object Array]",hPe="[object Boolean]",pPe="[object Date]",fPe="[object Error]",mPe="[object Function]",gPe="[object Map]",vPe="[object Number]",yPe="[object Object]",_Pe="[object RegExp]",EPe="[object Set]",bPe="[object String]",SPe="[object WeakMap]",wPe="[object ArrayBuffer]",xPe="[object DataView]",TPe="[object Float32Array]",CPe="[object Float64Array]",RPe="[object Int8Array]",APe="[object Int16Array]",NPe="[object Int32Array]",OPe="[object Uint8Array]",IPe="[object Uint8ClampedArray]",PPe="[object Uint16Array]",DPe="[object Uint32Array]",gr={};gr[TPe]=gr[CPe]=gr[RPe]=gr[APe]=gr[NPe]=gr[OPe]=gr[IPe]=gr[PPe]=gr[DPe]=!0;gr[dPe]=gr[uPe]=gr[wPe]=gr[hPe]=gr[xPe]=gr[pPe]=gr[fPe]=gr[mPe]=gr[gPe]=gr[vPe]=gr[yPe]=gr[_Pe]=gr[EPe]=gr[bPe]=gr[SPe]=!1;function kPe(e){return lPe(e)&&cPe(e.length)&&!!gr[oPe(e)]}var LPe=kPe;function jPe(e){return function(n){return e(n)}}var OQ=jPe,yw={exports:{}};yw.exports;(function(e,n){var a=MJ,o=n&&!n.nodeType&&n,l=o&&!0&&e&&!e.nodeType&&e,p=l&&l.exports===o,m=p&&a.process,y=function(){try{var E=l&&l.require&&l.require("util").types;return E||m&&m.binding&&m.binding("util")}catch{}}();e.exports=y})(yw,yw.exports);var MPe=yw.exports,UPe=LPe,VPe=OQ,Bz=MPe,Wz=Bz&&Bz.isTypedArray,FPe=Wz?VPe(Wz):UPe,IQ=FPe,BPe=$1e,WPe=_2,GPe=za,$Pe=NQ,HPe=E2,zPe=IQ,KPe=Object.prototype,YPe=KPe.hasOwnProperty;function qPe(e,n){var a=GPe(e),o=!a&&WPe(e),l=!a&&!o&&$Pe(e),p=!a&&!o&&!l&&zPe(e),m=a||o||l||p,y=m?BPe(e.length,String):[],E=y.length;for(var b in e)(n||YPe.call(e,b))&&!(m&&(b=="length"||l&&(b=="offset"||b=="parent")||p&&(b=="buffer"||b=="byteLength"||b=="byteOffset")||HPe(b,E)))&&y.push(b);return y}var XPe=qPe,JPe=Object.prototype;function QPe(e){var n=e&&e.constructor,a=typeof n=="function"&&n.prototype||JPe;return e===a}var ZPe=QPe;function eDe(e,n){return function(a){return e(n(a))}}var PQ=eDe,tDe=PQ,nDe=tDe(Object.keys,Object),rDe=nDe,iDe=ZPe,aDe=rDe,sDe=Object.prototype,oDe=sDe.hasOwnProperty;function cDe(e){if(!iDe(e))return aDe(e);var n=[];for(var a in Object(e))oDe.call(e,a)&&a!="constructor"&&n.push(a);return n}var lDe=cDe,dDe=n2,uDe=b2;function hDe(e){return e!=null&&uDe(e.length)&&!dDe(e)}var C_=hDe,pDe=XPe,fDe=lDe,mDe=C_;function gDe(e){return mDe(e)?pDe(e):fDe(e)}var cT=gDe,vDe=P1e,yDe=W1e,_De=cT;function EDe(e){return vDe(e,_De,yDe)}var bDe=EDe,Gz=bDe,SDe=1,wDe=Object.prototype,xDe=wDe.hasOwnProperty;function TDe(e,n,a,o,l,p){var m=a&SDe,y=Gz(e),E=y.length,b=Gz(n),T=b.length;if(E!=T&&!m)return!1;for(var x=E;x--;){var A=y[x];if(!(m?A in n:xDe.call(n,A)))return!1}var D=p.get(e),N=p.get(n);if(D&&N)return D==n&&N==e;var L=!0;p.set(e,n),p.set(n,e);for(var P=m;++x<E;){A=y[x];var U=e[A],V=n[A];if(o)var F=m?o(V,U,A,n,e,p):o(U,V,A,e,n,p);if(!(F===void 0?U===V||l(U,V,a,o,p):F)){L=!1;break}P||(P=A=="constructor")}if(L&&!P){var H=e.constructor,B=n.constructor;H!=B&&"constructor"in e&&"constructor"in n&&!(typeof H=="function"&&H instanceof H&&typeof B=="function"&&B instanceof B)&&(L=!1)}return p.delete(e),p.delete(n),L}var CDe=TDe,RDe=kh,ADe=Mc,NDe=RDe(ADe,"DataView"),ODe=NDe,IDe=kh,PDe=Mc,DDe=IDe(PDe,"Promise"),kDe=DDe,LDe=kh,jDe=Mc,MDe=LDe(jDe,"Set"),DQ=MDe,UDe=kh,VDe=Mc,FDe=UDe(VDe,"WeakMap"),BDe=FDe,OP=ODe,IP=i2,PP=kDe,DP=DQ,kP=BDe,kQ=Al,Wm=VJ,$z="[object Map]",WDe="[object Object]",Hz="[object Promise]",zz="[object Set]",Kz="[object WeakMap]",Yz="[object DataView]",GDe=Wm(OP),$De=Wm(IP),HDe=Wm(PP),zDe=Wm(DP),KDe=Wm(kP),Qu=kQ;(OP&&Qu(new OP(new ArrayBuffer(1)))!=Yz||IP&&Qu(new IP)!=$z||PP&&Qu(PP.resolve())!=Hz||DP&&Qu(new DP)!=zz||kP&&Qu(new kP)!=Kz)&&(Qu=function(e){var n=kQ(e),a=n==WDe?e.constructor:void 0,o=a?Wm(a):"";if(o)switch(o){case GDe:return Yz;case $De:return $z;case HDe:return Hz;case zDe:return zz;case KDe:return Kz}return n});var YDe=Qu,DI=SQ,qDe=CQ,XDe=R1e,JDe=CDe,qz=YDe,Xz=za,Jz=NQ,QDe=IQ,ZDe=1,Qz="[object Arguments]",Zz="[object Array]",Zb="[object Object]",eke=Object.prototype,e7=eke.hasOwnProperty;function tke(e,n,a,o,l,p){var m=Xz(e),y=Xz(n),E=m?Zz:qz(e),b=y?Zz:qz(n);E=E==Qz?Zb:E,b=b==Qz?Zb:b;var T=E==Zb,x=b==Zb,A=E==b;if(A&&Jz(e)){if(!Jz(n))return!1;m=!0,T=!1}if(A&&!T)return p||(p=new DI),m||QDe(e)?qDe(e,n,a,o,l,p):XDe(e,n,E,a,o,l,p);if(!(a&ZDe)){var D=T&&e7.call(e,"__wrapped__"),N=x&&e7.call(n,"__wrapped__");if(D||N){var L=D?e.value():e,P=N?n.value():n;return p||(p=new DI),l(L,P,a,o,p)}}return A?(p||(p=new DI),JDe(e,n,a,o,l,p)):!1}var nke=tke,rke=nke,t7=Nl;function LQ(e,n,a,o,l){return e===n?!0:e==null||n==null||!t7(e)&&!t7(n)?e!==e&&n!==n:rke(e,n,a,o,LQ,l)}var S2=LQ,ike=SQ,ake=S2,ske=1,oke=2;function cke(e,n,a,o){var l=a.length,p=l,m=!o;if(e==null)return!p;for(e=Object(e);l--;){var y=a[l];if(m&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++l<p;){y=a[l];var E=y[0],b=e[E],T=y[1];if(m&&y[2]){if(b===void 0&&!(E in e))return!1}else{var x=new ike;if(o)var A=o(b,T,E,e,n,x);if(!(A===void 0?ake(T,b,ske|oke,o,x):A))return!1}}return!0}var lke=cke,dke=Yd;function uke(e){return e===e&&!dke(e)}var jQ=uke,hke=jQ,pke=cT;function fke(e){for(var n=pke(e),a=n.length;a--;){var o=n[a],l=e[o];n[a]=[o,l,hke(l)]}return n}var mke=fke;function gke(e,n){return function(a){return a==null?!1:a[e]===n&&(n!==void 0||e in Object(a))}}var MQ=gke,vke=lke,yke=mke,_ke=MQ;function Eke(e){var n=yke(e);return n.length==1&&n[0][2]?_ke(n[0][0],n[0][1]):function(a){return a===e||vke(a,e,n)}}var bke=Eke;function Ske(e,n){return e!=null&&n in Object(e)}var wke=Ske,xke=$J,Tke=_2,Cke=za,Rke=E2,Ake=b2,Nke=Kx;function Oke(e,n,a){n=xke(n,e);for(var o=-1,l=n.length,p=!1;++o<l;){var m=Nke(n[o]);if(!(p=e!=null&&a(e,m)))break;e=e[m]}return p||++o!=l?p:(l=e==null?0:e.length,!!l&&Ake(l)&&Rke(m,l)&&(Cke(e)||Tke(e)))}var Ike=Oke,Pke=wke,Dke=Ike;function kke(e,n){return e!=null&&Dke(e,n,Pke)}var Lke=kke,jke=S2,Mke=HJ,Uke=Lke,Vke=t2,Fke=jQ,Bke=MQ,Wke=Kx,Gke=1,$ke=2;function Hke(e,n){return Vke(e)&&Fke(n)?Bke(Wke(e),n):function(a){var o=Mke(a,e);return o===void 0&&o===n?Uke(a,e):jke(n,o,Gke|$ke)}}var zke=Hke;function Kke(e){return e}var Gm=Kke;function Yke(e){return function(n){return n==null?void 0:n[e]}}var qke=Yke,Xke=c2;function Jke(e){return function(n){return Xke(n,e)}}var Qke=Jke,Zke=qke,e2e=Qke,t2e=t2,n2e=Kx;function r2e(e){return t2e(e)?Zke(n2e(e)):e2e(e)}var i2e=r2e,a2e=bke,s2e=zke,o2e=Gm,c2e=za,l2e=i2e;function d2e(e){return typeof e=="function"?e:e==null?o2e:typeof e=="object"?c2e(e)?s2e(e[0],e[1]):a2e(e):l2e(e)}var qd=d2e;function u2e(e,n,a,o){for(var l=e.length,p=a+(o?1:-1);o?p--:++p<l;)if(n(e[p],p,e))return p;return-1}var UQ=u2e;function h2e(e){return e!==e}var p2e=h2e;function f2e(e,n,a){for(var o=a-1,l=e.length;++o<l;)if(e[o]===n)return o;return-1}var m2e=f2e,g2e=UQ,v2e=p2e,y2e=m2e;function _2e(e,n,a){return n===n?y2e(e,n,a):g2e(e,v2e,a)}var E2e=_2e,b2e=E2e;function S2e(e,n){var a=e==null?0:e.length;return!!a&&b2e(e,n,0)>-1}var w2e=S2e;function x2e(e,n,a){for(var o=-1,l=e==null?0:e.length;++o<l;)if(a(n,e[o]))return!0;return!1}var T2e=x2e;function C2e(){}var R2e=C2e,kI=DQ,A2e=R2e,N2e=y2,O2e=1/0,I2e=kI&&1/N2e(new kI([,-0]))[1]==O2e?function(e){return new kI(e)}:A2e,P2e=I2e,D2e=wQ,k2e=w2e,L2e=T2e,j2e=TQ,M2e=P2e,U2e=y2,V2e=200;function F2e(e,n,a){var o=-1,l=k2e,p=e.length,m=!0,y=[],E=y;if(a)m=!1,l=L2e;else if(p>=V2e){var b=n?null:M2e(e);if(b)return U2e(b);m=!1,l=j2e,E=new D2e}else E=n?[]:y;e:for(;++o<p;){var T=e[o],x=n?n(T):T;if(T=a||T!==0?T:0,m&&x===x){for(var A=E.length;A--;)if(E[A]===x)continue e;n&&E.push(x),y.push(T)}else l(E,x,a)||(E!==y&&E.push(x),y.push(T))}return y}var B2e=F2e,W2e=qd,G2e=B2e;function $2e(e,n){return e&&e.length?G2e(e,W2e(n)):[]}var H2e=$2e;const n7=Zn(H2e);function VQ(e,n,a){return n===!0?n7(e,a):sn(n)?n7(e,n):e}function rm(e){"@babel/helpers - typeof";return rm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},rm(e)}var z2e=["ref"];function r7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function nl(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?r7(Object(a),!0).forEach(function(o){lT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function K2e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i7(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,BQ(o.key),o)}}function Y2e(e,n,a){return n&&i7(e.prototype,n),a&&i7(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function q2e(e,n,a){return n=_w(n),X2e(e,FQ()?Reflect.construct(n,a||[],_w(e).constructor):n.apply(e,a))}function X2e(e,n){if(n&&(rm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return J2e(e)}function J2e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function FQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(FQ=function(){return!!e})()}function _w(e){return _w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_w(e)}function Q2e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&LP(e,n)}function LP(e,n){return LP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},LP(e,n)}function lT(e,n,a){return n=BQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function BQ(e){var n=Z2e(e,"string");return rm(n)=="symbol"?n:n+""}function Z2e(e,n){if(rm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(rm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function eLe(e,n){if(e==null)return{};var a=tLe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function tLe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function nLe(e){return e.value}function rLe(e,n){if(me.isValidElement(e))return me.cloneElement(e,n);if(typeof e=="function")return me.createElement(e,n);n.ref;var a=eLe(n,z2e);return me.createElement(v2,a)}var a7=1,Bf=function(e){function n(){var a;K2e(this,n);for(var o=arguments.length,l=new Array(o),p=0;p<o;p++)l[p]=arguments[p];return a=q2e(this,n,[].concat(l)),lT(a,"lastBoundingBox",{width:-1,height:-1}),a}return Q2e(n,e),Y2e(n,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();return o.height=this.wrapperNode.offsetHeight,o.width=this.wrapperNode.offsetWidth,o}return null}},{key:"updateBBox",value:function(){var o=this.props.onBBoxUpdate,l=this.getBBox();l?(Math.abs(l.width-this.lastBoundingBox.width)>a7||Math.abs(l.height-this.lastBoundingBox.height)>a7)&&(this.lastBoundingBox.width=l.width,this.lastBoundingBox.height=l.height,o&&o(l)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,o&&o(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?nl({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(o){var l=this.props,p=l.layout,m=l.align,y=l.verticalAlign,E=l.margin,b=l.chartWidth,T=l.chartHeight,x,A;if(!o||(o.left===void 0||o.left===null)&&(o.right===void 0||o.right===null))if(m==="center"&&p==="vertical"){var D=this.getBBoxSnapshot();x={left:((b||0)-D.width)/2}}else x=m==="right"?{right:E&&E.right||0}:{left:E&&E.left||0};if(!o||(o.top===void 0||o.top===null)&&(o.bottom===void 0||o.bottom===null))if(y==="middle"){var N=this.getBBoxSnapshot();A={top:((T||0)-N.height)/2}}else A=y==="bottom"?{bottom:E&&E.bottom||0}:{top:E&&E.top||0};return nl(nl({},x),A)}},{key:"render",value:function(){var o=this,l=this.props,p=l.content,m=l.width,y=l.height,E=l.wrapperStyle,b=l.payloadUniqBy,T=l.payload,x=nl(nl({position:"absolute",width:m||"auto",height:y||"auto"},this.getDefaultPosition(E)),E);return me.createElement("div",{className:"recharts-legend-wrapper",style:x,ref:function(D){o.wrapperNode=D}},rLe(p,nl(nl({},this.props),{},{payload:VQ(T,b,nLe)})))}}],[{key:"getWithHeight",value:function(o,l){var p=nl(nl({},this.defaultProps),o.props),m=p.layout;return m==="vertical"&&nt(o.props.height)?{height:o.props.height}:m==="horizontal"?{width:o.props.width||l}:null}}])}(J.PureComponent);lT(Bf,"displayName","Legend");lT(Bf,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var s7=T_,iLe=_2,aLe=za,o7=s7?s7.isConcatSpreadable:void 0;function sLe(e){return aLe(e)||iLe(e)||!!(o7&&e&&e[o7])}var oLe=sLe,cLe=RQ,lLe=oLe;function WQ(e,n,a,o,l){var p=-1,m=e.length;for(a||(a=lLe),l||(l=[]);++p<m;){var y=e[p];n>0&&a(y)?n>1?WQ(y,n-1,a,o,l):cLe(l,y):o||(l[l.length]=y)}return l}var GQ=WQ;function dLe(e){return function(n,a,o){for(var l=-1,p=Object(n),m=o(n),y=m.length;y--;){var E=m[e?y:++l];if(a(p[E],E,p)===!1)break}return n}}var uLe=dLe,hLe=uLe,pLe=hLe(),fLe=pLe,mLe=fLe,gLe=cT;function vLe(e,n){return e&&mLe(e,n,gLe)}var $Q=vLe,yLe=C_;function _Le(e,n){return function(a,o){if(a==null)return a;if(!yLe(a))return e(a,o);for(var l=a.length,p=n?l:-1,m=Object(a);(n?p--:++p<l)&&o(m[p],p,m)!==!1;);return a}}var ELe=_Le,bLe=$Q,SLe=ELe,wLe=SLe(bLe),w2=wLe,xLe=w2,TLe=C_;function CLe(e,n){var a=-1,o=TLe(e)?Array(e.length):[];return xLe(e,function(l,p,m){o[++a]=n(l,p,m)}),o}var HQ=CLe;function RLe(e,n){var a=e.length;for(e.sort(n);a--;)e[a]=e[a].value;return e}var ALe=RLe,c7=km;function NLe(e,n){if(e!==n){var a=e!==void 0,o=e===null,l=e===e,p=c7(e),m=n!==void 0,y=n===null,E=n===n,b=c7(n);if(!y&&!b&&!p&&e>n||p&&m&&E&&!y&&!b||o&&m&&E||!a&&E||!l)return 1;if(!o&&!p&&!b&&e<n||b&&a&&l&&!o&&!p||y&&a&&l||!m&&l||!E)return-1}return 0}var OLe=NLe,ILe=OLe;function PLe(e,n,a){for(var o=-1,l=e.criteria,p=n.criteria,m=l.length,y=a.length;++o<m;){var E=ILe(l[o],p[o]);if(E){if(o>=y)return E;var b=a[o];return E*(b=="desc"?-1:1)}}return e.index-n.index}var DLe=PLe,LI=o2,kLe=c2,LLe=qd,jLe=HQ,MLe=ALe,ULe=OQ,VLe=DLe,FLe=Gm,BLe=za;function WLe(e,n,a){n.length?n=LI(n,function(p){return BLe(p)?function(m){return kLe(m,p.length===1?p[0]:p)}:p}):n=[FLe];var o=-1;n=LI(n,ULe(LLe));var l=jLe(e,function(p,m,y){var E=LI(n,function(b){return b(p)});return{criteria:E,index:++o,value:p}});return MLe(l,function(p,m){return VLe(p,m,a)})}var GLe=WLe;function $Le(e,n,a){switch(a.length){case 0:return e.call(n);case 1:return e.call(n,a[0]);case 2:return e.call(n,a[0],a[1]);case 3:return e.call(n,a[0],a[1],a[2])}return e.apply(n,a)}var HLe=$Le,zLe=HLe,l7=Math.max;function KLe(e,n,a){return n=l7(n===void 0?e.length-1:n,0),function(){for(var o=arguments,l=-1,p=l7(o.length-n,0),m=Array(p);++l<p;)m[l]=o[n+l];l=-1;for(var y=Array(n+1);++l<n;)y[l]=o[l];return y[n]=a(m),zLe(e,this,y)}}var YLe=KLe;function qLe(e){return function(){return e}}var XLe=qLe,JLe=kh,QLe=function(){try{var e=JLe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),zQ=QLe,ZLe=XLe,d7=zQ,eje=Gm,tje=d7?function(e,n){return d7(e,"toString",{configurable:!0,enumerable:!1,value:ZLe(n),writable:!0})}:eje,nje=tje,rje=800,ije=16,aje=Date.now;function sje(e){var n=0,a=0;return function(){var o=aje(),l=ije-(o-a);if(a=o,l>0){if(++n>=rje)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}var oje=sje,cje=nje,lje=oje,dje=lje(cje),uje=dje,hje=Gm,pje=YLe,fje=uje;function mje(e,n){return fje(pje(e,n,hje),e+"")}var gje=mje,vje=r2,yje=C_,_je=E2,Eje=Yd;function bje(e,n,a){if(!Eje(a))return!1;var o=typeof n;return(o=="number"?yje(a)&&_je(n,a.length):o=="string"&&n in a)?vje(a[n],e):!1}var dT=bje,Sje=GQ,wje=GLe,xje=gje,u7=dT,Tje=xje(function(e,n){if(e==null)return[];var a=n.length;return a>1&&u7(e,n[0],n[1])?n=[]:a>2&&u7(n[0],n[1],n[2])&&(n=[n[0]]),wje(e,Sje(n,1),[])}),Cje=Tje;const x2=Zn(Cje);function Py(e){"@babel/helpers - typeof";return Py=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Py(e)}function jP(){return jP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},jP.apply(this,arguments)}function Rje(e,n){return Ije(e)||Oje(e,n)||Nje(e,n)||Aje()}function Aje(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nje(e,n){if(e){if(typeof e=="string")return h7(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h7(e,n)}}function h7(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function Oje(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function Ije(e){if(Array.isArray(e))return e}function p7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function jI(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?p7(Object(a),!0).forEach(function(o){Pje(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Pje(e,n,a){return n=Dje(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Dje(e){var n=kje(e,"string");return Py(n)=="symbol"?n:n+""}function kje(e,n){if(Py(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Py(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Lje(e){return Array.isArray(e)&&pi(e[0])&&pi(e[1])?e.join(" ~ "):e}var jje=function(n){var a=n.separator,o=a===void 0?" : ":a,l=n.contentStyle,p=l===void 0?{}:l,m=n.itemStyle,y=m===void 0?{}:m,E=n.labelStyle,b=E===void 0?{}:E,T=n.payload,x=n.formatter,A=n.itemSorter,D=n.wrapperClassName,N=n.labelClassName,L=n.label,P=n.labelFormatter,U=n.accessibilityLayer,V=U===void 0?!1:U,F=function(){if(T&&T.length){var he={padding:0,margin:0},Re=(A?x2(T,A):T).map(function(ve,we){if(ve.type==="none")return null;var ue=jI({display:"block",paddingTop:4,paddingBottom:4,color:ve.color||"#000"},y),be=ve.formatter||x||Lje,ae=ve.value,ce=ve.name,Se=ae,je=ce;if(be&&Se!=null&&je!=null){var fe=be(ae,ce,ve,we,T);if(Array.isArray(fe)){var He=Rje(fe,2);Se=He[0],je=He[1]}else Se=fe}return me.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(we),style:ue},pi(je)?me.createElement("span",{className:"recharts-tooltip-item-name"},je):null,pi(je)?me.createElement("span",{className:"recharts-tooltip-item-separator"},o):null,me.createElement("span",{className:"recharts-tooltip-item-value"},Se),me.createElement("span",{className:"recharts-tooltip-item-unit"},ve.unit||""))});return me.createElement("ul",{className:"recharts-tooltip-item-list",style:he},Re)}return null},H=jI({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},p),B=jI({margin:0},b),z=!pn(L),Y=z?L:"",Q=Cn("recharts-default-tooltip",D),re=Cn("recharts-tooltip-label",N);z&&P&&T!==void 0&&T!==null&&(Y=P(L,T));var de=V?{role:"status","aria-live":"assertive"}:{};return me.createElement("div",jP({className:Q,style:H},de),me.createElement("p",{className:re,style:B},me.isValidElement(Y)?Y:"".concat(Y)),F())};function Dy(e){"@babel/helpers - typeof";return Dy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Dy(e)}function eS(e,n,a){return n=Mje(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Mje(e){var n=Uje(e,"string");return Dy(n)=="symbol"?n:n+""}function Uje(e,n){if(Dy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Dy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var kv="recharts-tooltip-wrapper",Vje={visibility:"hidden"};function Fje(e){var n=e.coordinate,a=e.translateX,o=e.translateY;return Cn(kv,eS(eS(eS(eS({},"".concat(kv,"-right"),nt(a)&&n&&nt(n.x)&&a>=n.x),"".concat(kv,"-left"),nt(a)&&n&&nt(n.x)&&a<n.x),"".concat(kv,"-bottom"),nt(o)&&n&&nt(n.y)&&o>=n.y),"".concat(kv,"-top"),nt(o)&&n&&nt(n.y)&&o<n.y))}function f7(e){var n=e.allowEscapeViewBox,a=e.coordinate,o=e.key,l=e.offsetTopLeft,p=e.position,m=e.reverseDirection,y=e.tooltipDimension,E=e.viewBox,b=e.viewBoxDimension;if(p&&nt(p[o]))return p[o];var T=a[o]-y-l,x=a[o]+l;if(n[o])return m[o]?T:x;if(m[o]){var A=T,D=E[o];return A<D?Math.max(x,E[o]):Math.max(T,E[o])}var N=x+y,L=E[o]+b;return N>L?Math.max(T,E[o]):Math.max(x,E[o])}function Bje(e){var n=e.translateX,a=e.translateY,o=e.useTranslate3d;return{transform:o?"translate3d(".concat(n,"px, ").concat(a,"px, 0)"):"translate(".concat(n,"px, ").concat(a,"px)")}}function Wje(e){var n=e.allowEscapeViewBox,a=e.coordinate,o=e.offsetTopLeft,l=e.position,p=e.reverseDirection,m=e.tooltipBox,y=e.useTranslate3d,E=e.viewBox,b,T,x;return m.height>0&&m.width>0&&a?(T=f7({allowEscapeViewBox:n,coordinate:a,key:"x",offsetTopLeft:o,position:l,reverseDirection:p,tooltipDimension:m.width,viewBox:E,viewBoxDimension:E.width}),x=f7({allowEscapeViewBox:n,coordinate:a,key:"y",offsetTopLeft:o,position:l,reverseDirection:p,tooltipDimension:m.height,viewBox:E,viewBoxDimension:E.height}),b=Bje({translateX:T,translateY:x,useTranslate3d:y})):b=Vje,{cssProperties:b,cssClasses:Fje({translateX:T,translateY:x,coordinate:a})}}function im(e){"@babel/helpers - typeof";return im=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},im(e)}function m7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function g7(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?m7(Object(a),!0).forEach(function(o){UP(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Gje(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function $je(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,YQ(o.key),o)}}function Hje(e,n,a){return n&&$je(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function zje(e,n,a){return n=Ew(n),Kje(e,KQ()?Reflect.construct(n,a||[],Ew(e).constructor):n.apply(e,a))}function Kje(e,n){if(n&&(im(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yje(e)}function Yje(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function KQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(KQ=function(){return!!e})()}function Ew(e){return Ew=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Ew(e)}function qje(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&MP(e,n)}function MP(e,n){return MP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},MP(e,n)}function UP(e,n,a){return n=YQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function YQ(e){var n=Xje(e,"string");return im(n)=="symbol"?n:n+""}function Xje(e,n){if(im(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(im(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var v7=1,Jje=function(e){function n(){var a;Gje(this,n);for(var o=arguments.length,l=new Array(o),p=0;p<o;p++)l[p]=arguments[p];return a=zje(this,n,[].concat(l)),UP(a,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),UP(a,"handleKeyDown",function(m){if(m.key==="Escape"){var y,E,b,T;a.setState({dismissed:!0,dismissedAtCoordinate:{x:(y=(E=a.props.coordinate)===null||E===void 0?void 0:E.x)!==null&&y!==void 0?y:0,y:(b=(T=a.props.coordinate)===null||T===void 0?void 0:T.y)!==null&&b!==void 0?b:0}})}}),a}return qje(n,e),Hje(n,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();(Math.abs(o.width-this.state.lastBoundingBox.width)>v7||Math.abs(o.height-this.state.lastBoundingBox.height)>v7)&&this.setState({lastBoundingBox:{width:o.width,height:o.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var o,l;this.props.active&&this.updateBBox(),this.state.dismissed&&(((o=this.props.coordinate)===null||o===void 0?void 0:o.x)!==this.state.dismissedAtCoordinate.x||((l=this.props.coordinate)===null||l===void 0?void 0:l.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var o=this,l=this.props,p=l.active,m=l.allowEscapeViewBox,y=l.animationDuration,E=l.animationEasing,b=l.children,T=l.coordinate,x=l.hasPayload,A=l.isAnimationActive,D=l.offset,N=l.position,L=l.reverseDirection,P=l.useTranslate3d,U=l.viewBox,V=l.wrapperStyle,F=Wje({allowEscapeViewBox:m,coordinate:T,offsetTopLeft:D,position:N,reverseDirection:L,tooltipBox:this.state.lastBoundingBox,useTranslate3d:P,viewBox:U}),H=F.cssClasses,B=F.cssProperties,z=g7(g7({transition:A&&p?"transform ".concat(y,"ms ").concat(E):void 0},B),{},{pointerEvents:"none",visibility:!this.state.dismissed&&p&&x?"visible":"hidden",position:"absolute",top:0,left:0},V);return me.createElement("div",{tabIndex:-1,className:H,style:z,ref:function(Q){o.wrapperNode=Q}},b)}}])}(J.PureComponent),Qje=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Lh={isSsr:Qje()};function am(e){"@babel/helpers - typeof";return am=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},am(e)}function y7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function _7(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?y7(Object(a),!0).forEach(function(o){T2(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Zje(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function eMe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,XQ(o.key),o)}}function tMe(e,n,a){return n&&eMe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function nMe(e,n,a){return n=bw(n),rMe(e,qQ()?Reflect.construct(n,a||[],bw(e).constructor):n.apply(e,a))}function rMe(e,n){if(n&&(am(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return iMe(e)}function iMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qQ=function(){return!!e})()}function bw(e){return bw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},bw(e)}function aMe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&VP(e,n)}function VP(e,n){return VP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},VP(e,n)}function T2(e,n,a){return n=XQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function XQ(e){var n=sMe(e,"string");return am(n)=="symbol"?n:n+""}function sMe(e,n){if(am(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(am(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function oMe(e){return e.dataKey}function cMe(e,n){return me.isValidElement(e)?me.cloneElement(e,n):typeof e=="function"?me.createElement(e,n):me.createElement(jje,n)}var us=function(e){function n(){return Zje(this,n),nMe(this,n,arguments)}return aMe(n,e),tMe(n,[{key:"render",value:function(){var o=this,l=this.props,p=l.active,m=l.allowEscapeViewBox,y=l.animationDuration,E=l.animationEasing,b=l.content,T=l.coordinate,x=l.filterNull,A=l.isAnimationActive,D=l.offset,N=l.payload,L=l.payloadUniqBy,P=l.position,U=l.reverseDirection,V=l.useTranslate3d,F=l.viewBox,H=l.wrapperStyle,B=N??[];x&&B.length&&(B=VQ(N.filter(function(Y){return Y.value!=null&&(Y.hide!==!0||o.props.includeHidden)}),L,oMe));var z=B.length>0;return me.createElement(Jje,{allowEscapeViewBox:m,animationDuration:y,animationEasing:E,isAnimationActive:A,active:p,coordinate:T,hasPayload:z,offset:D,position:P,reverseDirection:U,useTranslate3d:V,viewBox:F,wrapperStyle:H},cMe(b,_7(_7({},this.props),{},{payload:B})))}}])}(J.PureComponent);T2(us,"displayName","Tooltip");T2(us,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Lh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var lMe=Mc,dMe=function(){return lMe.Date.now()},uMe=dMe,hMe=/\s/;function pMe(e){for(var n=e.length;n--&&hMe.test(e.charAt(n)););return n}var fMe=pMe,mMe=fMe,gMe=/^\s+/;function vMe(e){return e&&e.slice(0,mMe(e)+1).replace(gMe,"")}var yMe=vMe,_Me=yMe,E7=Yd,EMe=km,b7=NaN,bMe=/^[-+]0x[0-9a-f]+$/i,SMe=/^0b[01]+$/i,wMe=/^0o[0-7]+$/i,xMe=parseInt;function TMe(e){if(typeof e=="number")return e;if(EMe(e))return b7;if(E7(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=E7(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=_Me(e);var a=SMe.test(e);return a||wMe.test(e)?xMe(e.slice(2),a?2:8):bMe.test(e)?b7:+e}var JQ=TMe,CMe=Yd,MI=uMe,S7=JQ,RMe="Expected a function",AMe=Math.max,NMe=Math.min;function OMe(e,n,a){var o,l,p,m,y,E,b=0,T=!1,x=!1,A=!0;if(typeof e!="function")throw new TypeError(RMe);n=S7(n)||0,CMe(a)&&(T=!!a.leading,x="maxWait"in a,p=x?AMe(S7(a.maxWait)||0,n):p,A="trailing"in a?!!a.trailing:A);function D(z){var Y=o,Q=l;return o=l=void 0,b=z,m=e.apply(Q,Y),m}function N(z){return b=z,y=setTimeout(U,n),T?D(z):m}function L(z){var Y=z-E,Q=z-b,re=n-Y;return x?NMe(re,p-Q):re}function P(z){var Y=z-E,Q=z-b;return E===void 0||Y>=n||Y<0||x&&Q>=p}function U(){var z=MI();if(P(z))return V(z);y=setTimeout(U,L(z))}function V(z){return y=void 0,A&&o?D(z):(o=l=void 0,m)}function F(){y!==void 0&&clearTimeout(y),b=0,o=E=l=y=void 0}function H(){return y===void 0?m:V(MI())}function B(){var z=MI(),Y=P(z);if(o=arguments,l=this,E=z,Y){if(y===void 0)return N(E);if(x)return clearTimeout(y),y=setTimeout(U,n),D(E)}return y===void 0&&(y=setTimeout(U,n)),m}return B.cancel=F,B.flush=H,B}var IMe=OMe,PMe=IMe,DMe=Yd,kMe="Expected a function";function LMe(e,n,a){var o=!0,l=!0;if(typeof e!="function")throw new TypeError(kMe);return DMe(a)&&(o="leading"in a?!!a.leading:o,l="trailing"in a?!!a.trailing:l),PMe(e,n,{leading:o,maxWait:n,trailing:l})}var jMe=LMe;const QQ=Zn(jMe);function ky(e){"@babel/helpers - typeof";return ky=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ky(e)}function w7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function tS(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?w7(Object(a),!0).forEach(function(o){MMe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function MMe(e,n,a){return n=UMe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function UMe(e){var n=VMe(e,"string");return ky(n)=="symbol"?n:n+""}function VMe(e,n){if(ky(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(ky(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function FMe(e,n){return $Me(e)||GMe(e,n)||WMe(e,n)||BMe()}function BMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WMe(e,n){if(e){if(typeof e=="string")return x7(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return x7(e,n)}}function x7(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function GMe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function $Me(e){if(Array.isArray(e))return e}var Sw=J.forwardRef(function(e,n){var a=e.aspect,o=e.initialDimension,l=o===void 0?{width:-1,height:-1}:o,p=e.width,m=p===void 0?"100%":p,y=e.height,E=y===void 0?"100%":y,b=e.minWidth,T=b===void 0?0:b,x=e.minHeight,A=e.maxHeight,D=e.children,N=e.debounce,L=N===void 0?0:N,P=e.id,U=e.className,V=e.onResize,F=e.style,H=F===void 0?{}:F,B=J.useRef(null),z=J.useRef();z.current=V,J.useImperativeHandle(n,function(){return Object.defineProperty(B.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),B.current},configurable:!0})});var Y=J.useState({containerWidth:l.width,containerHeight:l.height}),Q=FMe(Y,2),re=Q[0],de=Q[1],le=J.useCallback(function(Re,ve){de(function(we){var ue=Math.round(Re),be=Math.round(ve);return we.containerWidth===ue&&we.containerHeight===be?we:{containerWidth:ue,containerHeight:be}})},[]);J.useEffect(function(){var Re=function(ce){var Se,je=ce[0].contentRect,fe=je.width,He=je.height;le(fe,He),(Se=z.current)===null||Se===void 0||Se.call(z,fe,He)};L>0&&(Re=QQ(Re,L,{trailing:!0,leading:!1}));var ve=new ResizeObserver(Re),we=B.current.getBoundingClientRect(),ue=we.width,be=we.height;return le(ue,be),ve.observe(B.current),function(){ve.disconnect()}},[le,L]);var he=J.useMemo(function(){var Re=re.containerWidth,ve=re.containerHeight;if(Re<0||ve<0)return null;pl(oh(m)||oh(E),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,m,E),pl(!a||a>0,"The aspect(%s) must be greater than zero.",a);var we=oh(m)?Re:m,ue=oh(E)?ve:E;a&&a>0&&(we?ue=we/a:ue&&(we=ue*a),A&&ue>A&&(ue=A)),pl(we>0||ue>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,we,ue,m,E,T,x,a);var be=!Array.isArray(D)&&hl(D.type).endsWith("Chart");return me.Children.map(D,function(ae){return me.isValidElement(ae)?J.cloneElement(ae,tS({width:we,height:ue},be?{style:tS({height:"100%",width:"100%",maxHeight:ue,maxWidth:we},ae.props.style)}:{})):ae})},[a,D,E,A,x,T,re,m]);return me.createElement("div",{id:P?"".concat(P):void 0,className:Cn("recharts-responsive-container",U),style:tS(tS({},H),{},{width:m,height:E,minWidth:T,minHeight:x,maxHeight:A}),ref:B},he)}),ZQ=function(n){return null};ZQ.displayName="Cell";function Ly(e){"@babel/helpers - typeof";return Ly=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ly(e)}function T7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function FP(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?T7(Object(a),!0).forEach(function(o){HMe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function HMe(e,n,a){return n=zMe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function zMe(e){var n=KMe(e,"string");return Ly(n)=="symbol"?n:n+""}function KMe(e,n){if(Ly(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Ly(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var pf={widthCache:{},cacheCount:0},YMe=2e3,qMe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},C7="recharts_measurement_span";function XMe(e){var n=FP({},e);return Object.keys(n).forEach(function(a){n[a]||delete n[a]}),n}var ay=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n==null||Lh.isSsr)return{width:0,height:0};var o=XMe(a),l=JSON.stringify({text:n,copyStyle:o});if(pf.widthCache[l])return pf.widthCache[l];try{var p=document.getElementById(C7);p||(p=document.createElement("span"),p.setAttribute("id",C7),p.setAttribute("aria-hidden","true"),document.body.appendChild(p));var m=FP(FP({},qMe),o);Object.assign(p.style,m),p.textContent="".concat(n);var y=p.getBoundingClientRect(),E={width:y.width,height:y.height};return pf.widthCache[l]=E,++pf.cacheCount>YMe&&(pf.cacheCount=0,pf.widthCache={}),E}catch{return{width:0,height:0}}},JMe=function(n){return{top:n.top+window.scrollY-document.documentElement.clientTop,left:n.left+window.scrollX-document.documentElement.clientLeft}};function jy(e){"@babel/helpers - typeof";return jy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},jy(e)}function ww(e,n){return tUe(e)||eUe(e,n)||ZMe(e,n)||QMe()}function QMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZMe(e,n){if(e){if(typeof e=="string")return R7(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return R7(e,n)}}function R7(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function eUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n===0){if(Object(a)!==a)return;E=!1}else for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function tUe(e){if(Array.isArray(e))return e}function nUe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function A7(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,iUe(o.key),o)}}function rUe(e,n,a){return n&&A7(e.prototype,n),a&&A7(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function iUe(e){var n=aUe(e,"string");return jy(n)=="symbol"?n:n+""}function aUe(e,n){if(jy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(jy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var N7=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,O7=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,sUe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,oUe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,eZ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},cUe=Object.keys(eZ),If="NaN";function lUe(e,n){return e*eZ[n]}var nS=function(){function e(n,a){nUe(this,e),this.num=n,this.unit=a,this.num=n,this.unit=a,Number.isNaN(n)&&(this.unit=""),a!==""&&!sUe.test(a)&&(this.num=NaN,this.unit=""),cUe.includes(a)&&(this.num=lUe(n,a),this.unit="px")}return rUe(e,[{key:"add",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num+a.num,this.unit)}},{key:"subtract",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num-a.num,this.unit)}},{key:"multiply",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num*a.num,this.unit||a.unit)}},{key:"divide",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num/a.num,this.unit||a.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(a){var o,l=(o=oUe.exec(a))!==null&&o!==void 0?o:[],p=ww(l,3),m=p[1],y=p[2];return new e(parseFloat(m),y??"")}}])}();function tZ(e){if(e.includes(If))return If;for(var n=e;n.includes("*")||n.includes("/");){var a,o=(a=N7.exec(n))!==null&&a!==void 0?a:[],l=ww(o,4),p=l[1],m=l[2],y=l[3],E=nS.parse(p??""),b=nS.parse(y??""),T=m==="*"?E.multiply(b):E.divide(b);if(T.isNaN())return If;n=n.replace(N7,T.toString())}for(;n.includes("+")||/.-\d+(?:\.\d+)?/.test(n);){var x,A=(x=O7.exec(n))!==null&&x!==void 0?x:[],D=ww(A,4),N=D[1],L=D[2],P=D[3],U=nS.parse(N??""),V=nS.parse(P??""),F=L==="+"?U.add(V):U.subtract(V);if(F.isNaN())return If;n=n.replace(O7,F.toString())}return n}var I7=/\(([^()]*)\)/;function dUe(e){for(var n=e;n.includes("(");){var a=I7.exec(n),o=ww(a,2),l=o[1];n=n.replace(I7,tZ(l))}return n}function uUe(e){var n=e.replace(/\s+/g,"");return n=dUe(n),n=tZ(n),n}function hUe(e){try{return uUe(e)}catch{return If}}function UI(e){var n=hUe(e.slice(5,-1));return n===If?"":n}var pUe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],fUe=["dx","dy","angle","className","breakAll"];function BP(){return BP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},BP.apply(this,arguments)}function P7(e,n){if(e==null)return{};var a=mUe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function mUe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function D7(e,n){return _Ue(e)||yUe(e,n)||vUe(e,n)||gUe()}function gUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vUe(e,n){if(e){if(typeof e=="string")return k7(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return k7(e,n)}}function k7(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function yUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n===0){if(Object(a)!==a)return;E=!1}else for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function _Ue(e){if(Array.isArray(e))return e}var nZ=/[ \f\n\r\t\v\u2028\u2029]+/,rZ=function(n){var a=n.children,o=n.breakAll,l=n.style;try{var p=[];pn(a)||(o?p=a.toString().split(""):p=a.toString().split(nZ));var m=p.map(function(E){return{word:E,width:ay(E,l).width}}),y=o?0:ay("",l).width;return{wordsWithComputedWidth:m,spaceWidth:y}}catch{return null}},EUe=function(n,a,o,l,p){var m=n.maxLines,y=n.children,E=n.style,b=n.breakAll,T=nt(m),x=y,A=function(){var we=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return we.reduce(function(ue,be){var ae=be.word,ce=be.width,Se=ue[ue.length-1];if(Se&&(l==null||p||Se.width+ce+o<Number(l)))Se.words.push(ae),Se.width+=ce+o;else{var je={words:[ae],width:ce};ue.push(je)}return ue},[])},D=A(a),N=function(we){return we.reduce(function(ue,be){return ue.width>be.width?ue:be})};if(!T)return D;for(var L="",P=function(we){var ue=x.slice(0,we),be=rZ({breakAll:b,style:E,children:ue+L}).wordsWithComputedWidth,ae=A(be),ce=ae.length>m||N(ae).width>Number(l);return[ce,ae]},U=0,V=x.length-1,F=0,H;U<=V&&F<=x.length-1;){var B=Math.floor((U+V)/2),z=B-1,Y=P(z),Q=D7(Y,2),re=Q[0],de=Q[1],le=P(B),he=D7(le,1),Re=he[0];if(!re&&!Re&&(U=B+1),re&&Re&&(V=B-1),!re&&Re){H=de;break}F++}return H||D},L7=function(n){var a=pn(n)?[]:n.toString().split(nZ);return[{words:a}]},bUe=function(n){var a=n.width,o=n.scaleToFit,l=n.children,p=n.style,m=n.breakAll,y=n.maxLines;if((a||o)&&!Lh.isSsr){var E,b,T=rZ({breakAll:m,children:l,style:p});if(T){var x=T.wordsWithComputedWidth,A=T.spaceWidth;E=x,b=A}else return L7(l);return EUe({breakAll:m,children:l,maxLines:y,style:p},E,b,a,o)}return L7(l)},j7="#808080",xw=function(n){var a=n.x,o=a===void 0?0:a,l=n.y,p=l===void 0?0:l,m=n.lineHeight,y=m===void 0?"1em":m,E=n.capHeight,b=E===void 0?"0.71em":E,T=n.scaleToFit,x=T===void 0?!1:T,A=n.textAnchor,D=A===void 0?"start":A,N=n.verticalAnchor,L=N===void 0?"end":N,P=n.fill,U=P===void 0?j7:P,V=P7(n,pUe),F=J.useMemo(function(){return bUe({breakAll:V.breakAll,children:V.children,maxLines:V.maxLines,scaleToFit:x,style:V.style,width:V.width})},[V.breakAll,V.children,V.maxLines,x,V.style,V.width]),H=V.dx,B=V.dy,z=V.angle,Y=V.className,Q=V.breakAll,re=P7(V,fUe);if(!pi(o)||!pi(p))return null;var de=o+(nt(H)?H:0),le=p+(nt(B)?B:0),he;switch(L){case"start":he=UI("calc(".concat(b,")"));break;case"middle":he=UI("calc(".concat((F.length-1)/2," * -").concat(y," + (").concat(b," / 2))"));break;default:he=UI("calc(".concat(F.length-1," * -").concat(y,")"));break}var Re=[];if(x){var ve=F[0].width,we=V.width;Re.push("scale(".concat((nt(we)?we/ve:1)/ve,")"))}return z&&Re.push("rotate(".concat(z,", ").concat(de,", ").concat(le,")")),Re.length&&(re.transform=Re.join(" ")),me.createElement("text",BP({},un(re,!0),{x:de,y:le,className:Cn("recharts-text",Y),textAnchor:D,fill:U.includes("url")?j7:U}),F.map(function(ue,be){var ae=ue.words.join(Q?"":" ");return me.createElement("tspan",{x:de,dy:be===0?he:y,key:"".concat(ae,"-").concat(be)},ae)}))};function Md(e,n){return e==null||n==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function SUe(e,n){return e==null||n==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function C2(e){let n,a,o;e.length!==2?(n=Md,a=(y,E)=>Md(e(y),E),o=(y,E)=>e(y)-E):(n=e===Md||e===SUe?e:wUe,a=e,o=e);function l(y,E,b=0,T=y.length){if(b<T){if(n(E,E)!==0)return T;do{const x=b+T>>>1;a(y[x],E)<0?b=x+1:T=x}while(b<T)}return b}function p(y,E,b=0,T=y.length){if(b<T){if(n(E,E)!==0)return T;do{const x=b+T>>>1;a(y[x],E)<=0?b=x+1:T=x}while(b<T)}return b}function m(y,E,b=0,T=y.length){const x=l(y,E,b,T-1);return x>b&&o(y[x-1],E)>-o(y[x],E)?x-1:x}return{left:l,center:m,right:p}}function wUe(){return 0}function iZ(e){return e===null?NaN:+e}function*xUe(e,n){for(let a of e)a!=null&&(a=+a)>=a&&(yield a)}const TUe=C2(Md),R_=TUe.right;C2(iZ).center;class M7 extends Map{constructor(n,a=AUe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:a}}),n!=null)for(const[o,l]of n)this.set(o,l)}get(n){return super.get(U7(this,n))}has(n){return super.has(U7(this,n))}set(n,a){return super.set(CUe(this,n),a)}delete(n){return super.delete(RUe(this,n))}}function U7({_intern:e,_key:n},a){const o=n(a);return e.has(o)?e.get(o):a}function CUe({_intern:e,_key:n},a){const o=n(a);return e.has(o)?e.get(o):(e.set(o,a),a)}function RUe({_intern:e,_key:n},a){const o=n(a);return e.has(o)&&(a=e.get(o),e.delete(o)),a}function AUe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function NUe(e=Md){if(e===Md)return aZ;if(typeof e!="function")throw new TypeError("compare is not a function");return(n,a)=>{const o=e(n,a);return o||o===0?o:(e(a,a)===0)-(e(n,n)===0)}}function aZ(e,n){return(e==null||!(e>=e))-(n==null||!(n>=n))||(e<n?-1:e>n?1:0)}const OUe=Math.sqrt(50),IUe=Math.sqrt(10),PUe=Math.sqrt(2);function Tw(e,n,a){const o=(n-e)/Math.max(0,a),l=Math.floor(Math.log10(o)),p=o/Math.pow(10,l),m=p>=OUe?10:p>=IUe?5:p>=PUe?2:1;let y,E,b;return l<0?(b=Math.pow(10,-l)/m,y=Math.round(e*b),E=Math.round(n*b),y/b<e&&++y,E/b>n&&--E,b=-b):(b=Math.pow(10,l)*m,y=Math.round(e/b),E=Math.round(n/b),y*b<e&&++y,E*b>n&&--E),E<y&&.5<=a&&a<2?Tw(e,n,a*2):[y,E,b]}function WP(e,n,a){if(n=+n,e=+e,a=+a,!(a>0))return[];if(e===n)return[e];const o=n<e,[l,p,m]=o?Tw(n,e,a):Tw(e,n,a);if(!(p>=l))return[];const y=p-l+1,E=new Array(y);if(o)if(m<0)for(let b=0;b<y;++b)E[b]=(p-b)/-m;else for(let b=0;b<y;++b)E[b]=(p-b)*m;else if(m<0)for(let b=0;b<y;++b)E[b]=(l+b)/-m;else for(let b=0;b<y;++b)E[b]=(l+b)*m;return E}function GP(e,n,a){return n=+n,e=+e,a=+a,Tw(e,n,a)[2]}function $P(e,n,a){n=+n,e=+e,a=+a;const o=n<e,l=o?GP(n,e,a):GP(e,n,a);return(o?-1:1)*(l<0?1/-l:l)}function V7(e,n){let a;for(const o of e)o!=null&&(a<o||a===void 0&&o>=o)&&(a=o);return a}function F7(e,n){let a;for(const o of e)o!=null&&(a>o||a===void 0&&o>=o)&&(a=o);return a}function sZ(e,n,a=0,o=1/0,l){if(n=Math.floor(n),a=Math.floor(Math.max(0,a)),o=Math.floor(Math.min(e.length-1,o)),!(a<=n&&n<=o))return e;for(l=l===void 0?aZ:NUe(l);o>a;){if(o-a>600){const E=o-a+1,b=n-a+1,T=Math.log(E),x=.5*Math.exp(2*T/3),A=.5*Math.sqrt(T*x*(E-x)/E)*(b-E/2<0?-1:1),D=Math.max(a,Math.floor(n-b*x/E+A)),N=Math.min(o,Math.floor(n+(E-b)*x/E+A));sZ(e,n,D,N,l)}const p=e[n];let m=a,y=o;for(Lv(e,a,n),l(e[o],p)>0&&Lv(e,a,o);m<y;){for(Lv(e,m,y),++m,--y;l(e[m],p)<0;)++m;for(;l(e[y],p)>0;)--y}l(e[a],p)===0?Lv(e,a,y):(++y,Lv(e,y,o)),y<=n&&(a=y+1),n<=y&&(o=y-1)}return e}function Lv(e,n,a){const o=e[n];e[n]=e[a],e[a]=o}function DUe(e,n,a){if(e=Float64Array.from(xUe(e)),!(!(o=e.length)||isNaN(n=+n))){if(n<=0||o<2)return F7(e);if(n>=1)return V7(e);var o,l=(o-1)*n,p=Math.floor(l),m=V7(sZ(e,p).subarray(0,p+1)),y=F7(e.subarray(p+1));return m+(y-m)*(l-p)}}function kUe(e,n,a=iZ){if(!(!(o=e.length)||isNaN(n=+n))){if(n<=0||o<2)return+a(e[0],0,e);if(n>=1)return+a(e[o-1],o-1,e);var o,l=(o-1)*n,p=Math.floor(l),m=+a(e[p],p,e),y=+a(e[p+1],p+1,e);return m+(y-m)*(l-p)}}function LUe(e,n,a){e=+e,n=+n,a=(l=arguments.length)<2?(n=e,e=0,1):l<3?1:+a;for(var o=-1,l=Math.max(0,Math.ceil((n-e)/a))|0,p=new Array(l);++o<l;)p[o]=e+o*a;return p}function ao(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function Ol(e,n){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof n=="function"?this.interpolator(n):this.range(n);break}}return this}const HP=Symbol("implicit");function R2(){var e=new M7,n=[],a=[],o=HP;function l(p){let m=e.get(p);if(m===void 0){if(o!==HP)return o;e.set(p,m=n.push(p)-1)}return a[m%a.length]}return l.domain=function(p){if(!arguments.length)return n.slice();n=[],e=new M7;for(const m of p)e.has(m)||e.set(m,n.push(m)-1);return l},l.range=function(p){return arguments.length?(a=Array.from(p),l):a.slice()},l.unknown=function(p){return arguments.length?(o=p,l):o},l.copy=function(){return R2(n,a).unknown(o)},ao.apply(l,arguments),l}function My(){var e=R2().unknown(void 0),n=e.domain,a=e.range,o=0,l=1,p,m,y=!1,E=0,b=0,T=.5;delete e.unknown;function x(){var A=n().length,D=l<o,N=D?l:o,L=D?o:l;p=(L-N)/Math.max(1,A-E+b*2),y&&(p=Math.floor(p)),N+=(L-N-p*(A-E))*T,m=p*(1-E),y&&(N=Math.round(N),m=Math.round(m));var P=LUe(A).map(function(U){return N+p*U});return a(D?P.reverse():P)}return e.domain=function(A){return arguments.length?(n(A),x()):n()},e.range=function(A){return arguments.length?([o,l]=A,o=+o,l=+l,x()):[o,l]},e.rangeRound=function(A){return[o,l]=A,o=+o,l=+l,y=!0,x()},e.bandwidth=function(){return m},e.step=function(){return p},e.round=function(A){return arguments.length?(y=!!A,x()):y},e.padding=function(A){return arguments.length?(E=Math.min(1,b=+A),x()):E},e.paddingInner=function(A){return arguments.length?(E=Math.min(1,A),x()):E},e.paddingOuter=function(A){return arguments.length?(b=+A,x()):b},e.align=function(A){return arguments.length?(T=Math.max(0,Math.min(1,A)),x()):T},e.copy=function(){return My(n(),[o,l]).round(y).paddingInner(E).paddingOuter(b).align(T)},ao.apply(x(),arguments)}function oZ(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return oZ(n())},e}function sy(){return oZ(My.apply(null,arguments).paddingInner(1))}function A2(e,n,a){e.prototype=n.prototype=a,a.constructor=e}function cZ(e,n){var a=Object.create(e.prototype);for(var o in n)a[o]=n[o];return a}function A_(){}var Uy=.7,Cw=1/Uy,Wf="\\s*([+-]?\\d+)\\s*",Vy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jUe=/^#([0-9a-f]{3,8})$/,MUe=new RegExp(`^rgb\\(${Wf},${Wf},${Wf}\\)$`),UUe=new RegExp(`^rgb\\(${Pc},${Pc},${Pc}\\)$`),VUe=new RegExp(`^rgba\\(${Wf},${Wf},${Wf},${Vy}\\)$`),FUe=new RegExp(`^rgba\\(${Pc},${Pc},${Pc},${Vy}\\)$`),BUe=new RegExp(`^hsl\\(${Vy},${Pc},${Pc}\\)$`),WUe=new RegExp(`^hsla\\(${Vy},${Pc},${Pc},${Vy}\\)$`),B7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};A2(A_,Fy,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:W7,formatHex:W7,formatHex8:GUe,formatHsl:$Ue,formatRgb:G7,toString:G7});function W7(){return this.rgb().formatHex()}function GUe(){return this.rgb().formatHex8()}function $Ue(){return lZ(this).formatHsl()}function G7(){return this.rgb().formatRgb()}function Fy(e){var n,a;return e=(e+"").trim().toLowerCase(),(n=jUe.exec(e))?(a=n[1].length,n=parseInt(n[1],16),a===6?$7(n):a===3?new Va(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):a===8?rS(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):a===4?rS(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=MUe.exec(e))?new Va(n[1],n[2],n[3],1):(n=UUe.exec(e))?new Va(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=VUe.exec(e))?rS(n[1],n[2],n[3],n[4]):(n=FUe.exec(e))?rS(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=BUe.exec(e))?K7(n[1],n[2]/100,n[3]/100,1):(n=WUe.exec(e))?K7(n[1],n[2]/100,n[3]/100,n[4]):B7.hasOwnProperty(e)?$7(B7[e]):e==="transparent"?new Va(NaN,NaN,NaN,0):null}function $7(e){return new Va(e>>16&255,e>>8&255,e&255,1)}function rS(e,n,a,o){return o<=0&&(e=n=a=NaN),new Va(e,n,a,o)}function HUe(e){return e instanceof A_||(e=Fy(e)),e?(e=e.rgb(),new Va(e.r,e.g,e.b,e.opacity)):new Va}function zP(e,n,a,o){return arguments.length===1?HUe(e):new Va(e,n,a,o??1)}function Va(e,n,a,o){this.r=+e,this.g=+n,this.b=+a,this.opacity=+o}A2(Va,zP,cZ(A_,{brighter(e){return e=e==null?Cw:Math.pow(Cw,e),new Va(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Uy:Math.pow(Uy,e),new Va(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Va(yh(this.r),yh(this.g),yh(this.b),Rw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:H7,formatHex:H7,formatHex8:zUe,formatRgb:z7,toString:z7}));function H7(){return`#${ch(this.r)}${ch(this.g)}${ch(this.b)}`}function zUe(){return`#${ch(this.r)}${ch(this.g)}${ch(this.b)}${ch((isNaN(this.opacity)?1:this.opacity)*255)}`}function z7(){const e=Rw(this.opacity);return`${e===1?"rgb(":"rgba("}${yh(this.r)}, ${yh(this.g)}, ${yh(this.b)}${e===1?")":`, ${e})`}`}function Rw(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function yh(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ch(e){return e=yh(e),(e<16?"0":"")+e.toString(16)}function K7(e,n,a,o){return o<=0?e=n=a=NaN:a<=0||a>=1?e=n=NaN:n<=0&&(e=NaN),new Bo(e,n,a,o)}function lZ(e){if(e instanceof Bo)return new Bo(e.h,e.s,e.l,e.opacity);if(e instanceof A_||(e=Fy(e)),!e)return new Bo;if(e instanceof Bo)return e;e=e.rgb();var n=e.r/255,a=e.g/255,o=e.b/255,l=Math.min(n,a,o),p=Math.max(n,a,o),m=NaN,y=p-l,E=(p+l)/2;return y?(n===p?m=(a-o)/y+(a<o)*6:a===p?m=(o-n)/y+2:m=(n-a)/y+4,y/=E<.5?p+l:2-p-l,m*=60):y=E>0&&E<1?0:m,new Bo(m,y,E,e.opacity)}function KUe(e,n,a,o){return arguments.length===1?lZ(e):new Bo(e,n,a,o??1)}function Bo(e,n,a,o){this.h=+e,this.s=+n,this.l=+a,this.opacity=+o}A2(Bo,KUe,cZ(A_,{brighter(e){return e=e==null?Cw:Math.pow(Cw,e),new Bo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Uy:Math.pow(Uy,e),new Bo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,a=this.l,o=a+(a<.5?a:1-a)*n,l=2*a-o;return new Va(VI(e>=240?e-240:e+120,l,o),VI(e,l,o),VI(e<120?e+240:e-120,l,o),this.opacity)},clamp(){return new Bo(Y7(this.h),iS(this.s),iS(this.l),Rw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Rw(this.opacity);return`${e===1?"hsl(":"hsla("}${Y7(this.h)}, ${iS(this.s)*100}%, ${iS(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Y7(e){return e=(e||0)%360,e<0?e+360:e}function iS(e){return Math.max(0,Math.min(1,e||0))}function VI(e,n,a){return(e<60?n+(a-n)*e/60:e<180?a:e<240?n+(a-n)*(240-e)/60:n)*255}const N2=e=>()=>e;function YUe(e,n){return function(a){return e+a*n}}function qUe(e,n,a){return e=Math.pow(e,a),n=Math.pow(n,a)-e,a=1/a,function(o){return Math.pow(e+o*n,a)}}function XUe(e){return(e=+e)==1?dZ:function(n,a){return a-n?qUe(n,a,e):N2(isNaN(n)?a:n)}}function dZ(e,n){var a=n-e;return a?YUe(e,a):N2(isNaN(e)?n:e)}const q7=function e(n){var a=XUe(n);function o(l,p){var m=a((l=zP(l)).r,(p=zP(p)).r),y=a(l.g,p.g),E=a(l.b,p.b),b=dZ(l.opacity,p.opacity);return function(T){return l.r=m(T),l.g=y(T),l.b=E(T),l.opacity=b(T),l+""}}return o.gamma=e,o}(1);function JUe(e,n){n||(n=[]);var a=e?Math.min(n.length,e.length):0,o=n.slice(),l;return function(p){for(l=0;l<a;++l)o[l]=e[l]*(1-p)+n[l]*p;return o}}function QUe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ZUe(e,n){var a=n?n.length:0,o=e?Math.min(a,e.length):0,l=new Array(o),p=new Array(a),m;for(m=0;m<o;++m)l[m]=$m(e[m],n[m]);for(;m<a;++m)p[m]=n[m];return function(y){for(m=0;m<o;++m)p[m]=l[m](y);return p}}function eVe(e,n){var a=new Date;return e=+e,n=+n,function(o){return a.setTime(e*(1-o)+n*o),a}}function Aw(e,n){return e=+e,n=+n,function(a){return e*(1-a)+n*a}}function tVe(e,n){var a={},o={},l;(e===null||typeof e!="object")&&(e={}),(n===null||typeof n!="object")&&(n={});for(l in n)l in e?a[l]=$m(e[l],n[l]):o[l]=n[l];return function(p){for(l in a)o[l]=a[l](p);return o}}var KP=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,FI=new RegExp(KP.source,"g");function nVe(e){return function(){return e}}function rVe(e){return function(n){return e(n)+""}}function iVe(e,n){var a=KP.lastIndex=FI.lastIndex=0,o,l,p,m=-1,y=[],E=[];for(e=e+"",n=n+"";(o=KP.exec(e))&&(l=FI.exec(n));)(p=l.index)>a&&(p=n.slice(a,p),y[m]?y[m]+=p:y[++m]=p),(o=o[0])===(l=l[0])?y[m]?y[m]+=l:y[++m]=l:(y[++m]=null,E.push({i:m,x:Aw(o,l)})),a=FI.lastIndex;return a<n.length&&(p=n.slice(a),y[m]?y[m]+=p:y[++m]=p),y.length<2?E[0]?rVe(E[0].x):nVe(n):(n=E.length,function(b){for(var T=0,x;T<n;++T)y[(x=E[T]).i]=x.x(b);return y.join("")})}function $m(e,n){var a=typeof n,o;return n==null||a==="boolean"?N2(n):(a==="number"?Aw:a==="string"?(o=Fy(n))?(n=o,q7):iVe:n instanceof Fy?q7:n instanceof Date?eVe:QUe(n)?JUe:Array.isArray(n)?ZUe:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?tVe:Aw)(e,n)}function O2(e,n){return e=+e,n=+n,function(a){return Math.round(e*(1-a)+n*a)}}function aVe(e,n){n===void 0&&(n=e,e=$m);for(var a=0,o=n.length-1,l=n[0],p=new Array(o<0?0:o);a<o;)p[a]=e(l,l=n[++a]);return function(m){var y=Math.max(0,Math.min(o-1,Math.floor(m*=o)));return p[y](m-y)}}function sVe(e){return function(){return e}}function Nw(e){return+e}var X7=[0,1];function fa(e){return e}function YP(e,n){return(n-=e=+e)?function(a){return(a-e)/n}:sVe(isNaN(n)?NaN:.5)}function oVe(e,n){var a;return e>n&&(a=e,e=n,n=a),function(o){return Math.max(e,Math.min(n,o))}}function cVe(e,n,a){var o=e[0],l=e[1],p=n[0],m=n[1];return l<o?(o=YP(l,o),p=a(m,p)):(o=YP(o,l),p=a(p,m)),function(y){return p(o(y))}}function lVe(e,n,a){var o=Math.min(e.length,n.length)-1,l=new Array(o),p=new Array(o),m=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++m<o;)l[m]=YP(e[m],e[m+1]),p[m]=a(n[m],n[m+1]);return function(y){var E=R_(e,y,1,o)-1;return p[E](l[E](y))}}function N_(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function uT(){var e=X7,n=X7,a=$m,o,l,p,m=fa,y,E,b;function T(){var A=Math.min(e.length,n.length);return m!==fa&&(m=oVe(e[0],e[A-1])),y=A>2?lVe:cVe,E=b=null,x}function x(A){return A==null||isNaN(A=+A)?p:(E||(E=y(e.map(o),n,a)))(o(m(A)))}return x.invert=function(A){return m(l((b||(b=y(n,e.map(o),Aw)))(A)))},x.domain=function(A){return arguments.length?(e=Array.from(A,Nw),T()):e.slice()},x.range=function(A){return arguments.length?(n=Array.from(A),T()):n.slice()},x.rangeRound=function(A){return n=Array.from(A),a=O2,T()},x.clamp=function(A){return arguments.length?(m=A?!0:fa,T()):m!==fa},x.interpolate=function(A){return arguments.length?(a=A,T()):a},x.unknown=function(A){return arguments.length?(p=A,x):p},function(A,D){return o=A,l=D,T()}}function I2(){return uT()(fa,fa)}function dVe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ow(e,n){if((a=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var a,o=e.slice(0,a);return[o.length>1?o[0]+o.slice(2):o,+e.slice(a+1)]}function sm(e){return e=Ow(Math.abs(e)),e?e[1]:NaN}function uVe(e,n){return function(a,o){for(var l=a.length,p=[],m=0,y=e[0],E=0;l>0&&y>0&&(E+y+1>o&&(y=Math.max(1,o-E)),p.push(a.substring(l-=y,l+y)),!((E+=y+1)>o));)y=e[m=(m+1)%e.length];return p.reverse().join(n)}}function hVe(e){return function(n){return n.replace(/[0-9]/g,function(a){return e[+a]})}}var pVe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function By(e){if(!(n=pVe.exec(e)))throw new Error("invalid format: "+e);var n;return new P2({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}By.prototype=P2.prototype;function P2(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}P2.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function fVe(e){e:for(var n=e.length,a=1,o=-1,l;a<n;++a)switch(e[a]){case".":o=l=a;break;case"0":o===0&&(o=a),l=a;break;default:if(!+e[a])break e;o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(l+1):e}var uZ;function mVe(e,n){var a=Ow(e,n);if(!a)return e+"";var o=a[0],l=a[1],p=l-(uZ=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,m=o.length;return p===m?o:p>m?o+new Array(p-m+1).join("0"):p>0?o.slice(0,p)+"."+o.slice(p):"0."+new Array(1-p).join("0")+Ow(e,Math.max(0,n+p-1))[0]}function J7(e,n){var a=Ow(e,n);if(!a)return e+"";var o=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+o:o.length>l+1?o.slice(0,l+1)+"."+o.slice(l+1):o+new Array(l-o.length+2).join("0")}const Q7={"%":(e,n)=>(e*100).toFixed(n),b:e=>Math.round(e).toString(2),c:e=>e+"",d:dVe,e:(e,n)=>e.toExponential(n),f:(e,n)=>e.toFixed(n),g:(e,n)=>e.toPrecision(n),o:e=>Math.round(e).toString(8),p:(e,n)=>J7(e*100,n),r:J7,s:mVe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Z7(e){return e}var eK=Array.prototype.map,tK=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function gVe(e){var n=e.grouping===void 0||e.thousands===void 0?Z7:uVe(eK.call(e.grouping,Number),e.thousands+""),a=e.currency===void 0?"":e.currency[0]+"",o=e.currency===void 0?"":e.currency[1]+"",l=e.decimal===void 0?".":e.decimal+"",p=e.numerals===void 0?Z7:hVe(eK.call(e.numerals,String)),m=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"":e.minus+"",E=e.nan===void 0?"NaN":e.nan+"";function b(x){x=By(x);var A=x.fill,D=x.align,N=x.sign,L=x.symbol,P=x.zero,U=x.width,V=x.comma,F=x.precision,H=x.trim,B=x.type;B==="n"?(V=!0,B="g"):Q7[B]||(F===void 0&&(F=12),H=!0,B="g"),(P||A==="0"&&D==="=")&&(P=!0,A="0",D="=");var z=L==="$"?a:L==="#"&&/[boxX]/.test(B)?"0"+B.toLowerCase():"",Y=L==="$"?o:/[%p]/.test(B)?m:"",Q=Q7[B],re=/[defgprs%]/.test(B);F=F===void 0?6:/[gprs]/.test(B)?Math.max(1,Math.min(21,F)):Math.max(0,Math.min(20,F));function de(le){var he=z,Re=Y,ve,we,ue;if(B==="c")Re=Q(le)+Re,le="";else{le=+le;var be=le<0||1/le<0;if(le=isNaN(le)?E:Q(Math.abs(le),F),H&&(le=fVe(le)),be&&+le==0&&N!=="+"&&(be=!1),he=(be?N==="("?N:y:N==="-"||N==="("?"":N)+he,Re=(B==="s"?tK[8+uZ/3]:"")+Re+(be&&N==="("?")":""),re){for(ve=-1,we=le.length;++ve<we;)if(ue=le.charCodeAt(ve),48>ue||ue>57){Re=(ue===46?l+le.slice(ve+1):le.slice(ve))+Re,le=le.slice(0,ve);break}}}V&&!P&&(le=n(le,1/0));var ae=he.length+le.length+Re.length,ce=ae<U?new Array(U-ae+1).join(A):"";switch(V&&P&&(le=n(ce+le,ce.length?U-Re.length:1/0),ce=""),D){case"<":le=he+le+Re+ce;break;case"=":le=he+ce+le+Re;break;case"^":le=ce.slice(0,ae=ce.length>>1)+he+le+Re+ce.slice(ae);break;default:le=ce+he+le+Re;break}return p(le)}return de.toString=function(){return x+""},de}function T(x,A){var D=b((x=By(x),x.type="f",x)),N=Math.max(-8,Math.min(8,Math.floor(sm(A)/3)))*3,L=Math.pow(10,-N),P=tK[8+N/3];return function(U){return D(L*U)+P}}return{format:b,formatPrefix:T}}var aS,D2,hZ;vVe({thousands:",",grouping:[3],currency:["$",""]});function vVe(e){return aS=gVe(e),D2=aS.format,hZ=aS.formatPrefix,aS}function yVe(e){return Math.max(0,-sm(Math.abs(e)))}function _Ve(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(sm(n)/3)))*3-sm(Math.abs(e)))}function EVe(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,sm(n)-sm(e))+1}function pZ(e,n,a,o){var l=$P(e,n,a),p;switch(o=By(o??",f"),o.type){case"s":{var m=Math.max(Math.abs(e),Math.abs(n));return o.precision==null&&!isNaN(p=_Ve(l,m))&&(o.precision=p),hZ(o,m)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(p=EVe(l,Math.max(Math.abs(e),Math.abs(n))))&&(o.precision=p-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(p=yVe(l))&&(o.precision=p-(o.type==="%")*2);break}}return D2(o)}function Xd(e){var n=e.domain;return e.ticks=function(a){var o=n();return WP(o[0],o[o.length-1],a??10)},e.tickFormat=function(a,o){var l=n();return pZ(l[0],l[l.length-1],a??10,o)},e.nice=function(a){a==null&&(a=10);var o=n(),l=0,p=o.length-1,m=o[l],y=o[p],E,b,T=10;for(y<m&&(b=m,m=y,y=b,b=l,l=p,p=b);T-- >0;){if(b=GP(m,y,a),b===E)return o[l]=m,o[p]=y,n(o);if(b>0)m=Math.floor(m/b)*b,y=Math.ceil(y/b)*b;else if(b<0)m=Math.ceil(m*b)/b,y=Math.floor(y*b)/b;else break;E=b}return e},e}function Iw(){var e=I2();return e.copy=function(){return N_(e,Iw())},ao.apply(e,arguments),Xd(e)}function fZ(e){var n;function a(o){return o==null||isNaN(o=+o)?n:o}return a.invert=a,a.domain=a.range=function(o){return arguments.length?(e=Array.from(o,Nw),a):e.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return fZ(e).unknown(n)},e=arguments.length?Array.from(e,Nw):[0,1],Xd(a)}function mZ(e,n){e=e.slice();var a=0,o=e.length-1,l=e[a],p=e[o],m;return p<l&&(m=a,a=o,o=m,m=l,l=p,p=m),e[a]=n.floor(l),e[o]=n.ceil(p),e}function nK(e){return Math.log(e)}function rK(e){return Math.exp(e)}function bVe(e){return-Math.log(-e)}function SVe(e){return-Math.exp(-e)}function wVe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function xVe(e){return e===10?wVe:e===Math.E?Math.exp:n=>Math.pow(e,n)}function TVe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),n=>Math.log(n)/e)}function iK(e){return(n,a)=>-e(-n,a)}function k2(e){const n=e(nK,rK),a=n.domain;let o=10,l,p;function m(){return l=TVe(o),p=xVe(o),a()[0]<0?(l=iK(l),p=iK(p),e(bVe,SVe)):e(nK,rK),n}return n.base=function(y){return arguments.length?(o=+y,m()):o},n.domain=function(y){return arguments.length?(a(y),m()):a()},n.ticks=y=>{const E=a();let b=E[0],T=E[E.length-1];const x=T<b;x&&([b,T]=[T,b]);let A=l(b),D=l(T),N,L;const P=y==null?10:+y;let U=[];if(!(o%1)&&D-A<P){if(A=Math.floor(A),D=Math.ceil(D),b>0){for(;A<=D;++A)for(N=1;N<o;++N)if(L=A<0?N/p(-A):N*p(A),!(L<b)){if(L>T)break;U.push(L)}}else for(;A<=D;++A)for(N=o-1;N>=1;--N)if(L=A>0?N/p(-A):N*p(A),!(L<b)){if(L>T)break;U.push(L)}U.length*2<P&&(U=WP(b,T,P))}else U=WP(A,D,Math.min(D-A,P)).map(p);return x?U.reverse():U},n.tickFormat=(y,E)=>{if(y==null&&(y=10),E==null&&(E=o===10?"s":","),typeof E!="function"&&(!(o%1)&&(E=By(E)).precision==null&&(E.trim=!0),E=D2(E)),y===1/0)return E;const b=Math.max(1,o*y/n.ticks().length);return T=>{let x=T/p(Math.round(l(T)));return x*o<o-.5&&(x*=o),x<=b?E(T):""}},n.nice=()=>a(mZ(a(),{floor:y=>p(Math.floor(l(y))),ceil:y=>p(Math.ceil(l(y)))})),n}function gZ(){const e=k2(uT()).domain([1,10]);return e.copy=()=>N_(e,gZ()).base(e.base()),ao.apply(e,arguments),e}function aK(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function sK(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function L2(e){var n=1,a=e(aK(n),sK(n));return a.constant=function(o){return arguments.length?e(aK(n=+o),sK(n)):n},Xd(a)}function vZ(){var e=L2(uT());return e.copy=function(){return N_(e,vZ()).constant(e.constant())},ao.apply(e,arguments)}function oK(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function CVe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function RVe(e){return e<0?-e*e:e*e}function j2(e){var n=e(fa,fa),a=1;function o(){return a===1?e(fa,fa):a===.5?e(CVe,RVe):e(oK(a),oK(1/a))}return n.exponent=function(l){return arguments.length?(a=+l,o()):a},Xd(n)}function M2(){var e=j2(uT());return e.copy=function(){return N_(e,M2()).exponent(e.exponent())},ao.apply(e,arguments),e}function AVe(){return M2.apply(null,arguments).exponent(.5)}function cK(e){return Math.sign(e)*e*e}function NVe(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function yZ(){var e=I2(),n=[0,1],a=!1,o;function l(p){var m=NVe(e(p));return isNaN(m)?o:a?Math.round(m):m}return l.invert=function(p){return e.invert(cK(p))},l.domain=function(p){return arguments.length?(e.domain(p),l):e.domain()},l.range=function(p){return arguments.length?(e.range((n=Array.from(p,Nw)).map(cK)),l):n.slice()},l.rangeRound=function(p){return l.range(p).round(!0)},l.round=function(p){return arguments.length?(a=!!p,l):a},l.clamp=function(p){return arguments.length?(e.clamp(p),l):e.clamp()},l.unknown=function(p){return arguments.length?(o=p,l):o},l.copy=function(){return yZ(e.domain(),n).round(a).clamp(e.clamp()).unknown(o)},ao.apply(l,arguments),Xd(l)}function _Z(){var e=[],n=[],a=[],o;function l(){var m=0,y=Math.max(1,n.length);for(a=new Array(y-1);++m<y;)a[m-1]=kUe(e,m/y);return p}function p(m){return m==null||isNaN(m=+m)?o:n[R_(a,m)]}return p.invertExtent=function(m){var y=n.indexOf(m);return y<0?[NaN,NaN]:[y>0?a[y-1]:e[0],y<a.length?a[y]:e[e.length-1]]},p.domain=function(m){if(!arguments.length)return e.slice();e=[];for(let y of m)y!=null&&!isNaN(y=+y)&&e.push(y);return e.sort(Md),l()},p.range=function(m){return arguments.length?(n=Array.from(m),l()):n.slice()},p.unknown=function(m){return arguments.length?(o=m,p):o},p.quantiles=function(){return a.slice()},p.copy=function(){return _Z().domain(e).range(n).unknown(o)},ao.apply(p,arguments)}function EZ(){var e=0,n=1,a=1,o=[.5],l=[0,1],p;function m(E){return E!=null&&E<=E?l[R_(o,E,0,a)]:p}function y(){var E=-1;for(o=new Array(a);++E<a;)o[E]=((E+1)*n-(E-a)*e)/(a+1);return m}return m.domain=function(E){return arguments.length?([e,n]=E,e=+e,n=+n,y()):[e,n]},m.range=function(E){return arguments.length?(a=(l=Array.from(E)).length-1,y()):l.slice()},m.invertExtent=function(E){var b=l.indexOf(E);return b<0?[NaN,NaN]:b<1?[e,o[0]]:b>=a?[o[a-1],n]:[o[b-1],o[b]]},m.unknown=function(E){return arguments.length&&(p=E),m},m.thresholds=function(){return o.slice()},m.copy=function(){return EZ().domain([e,n]).range(l).unknown(p)},ao.apply(Xd(m),arguments)}function bZ(){var e=[.5],n=[0,1],a,o=1;function l(p){return p!=null&&p<=p?n[R_(e,p,0,o)]:a}return l.domain=function(p){return arguments.length?(e=Array.from(p),o=Math.min(e.length,n.length-1),l):e.slice()},l.range=function(p){return arguments.length?(n=Array.from(p),o=Math.min(e.length,n.length-1),l):n.slice()},l.invertExtent=function(p){var m=n.indexOf(p);return[e[m-1],e[m]]},l.unknown=function(p){return arguments.length?(a=p,l):a},l.copy=function(){return bZ().domain(e).range(n).unknown(a)},ao.apply(l,arguments)}const BI=new Date,WI=new Date;function fi(e,n,a,o){function l(p){return e(p=arguments.length===0?new Date:new Date(+p)),p}return l.floor=p=>(e(p=new Date(+p)),p),l.ceil=p=>(e(p=new Date(p-1)),n(p,1),e(p),p),l.round=p=>{const m=l(p),y=l.ceil(p);return p-m<y-p?m:y},l.offset=(p,m)=>(n(p=new Date(+p),m==null?1:Math.floor(m)),p),l.range=(p,m,y)=>{const E=[];if(p=l.ceil(p),y=y==null?1:Math.floor(y),!(p<m)||!(y>0))return E;let b;do E.push(b=new Date(+p)),n(p,y),e(p);while(b<p&&p<m);return E},l.filter=p=>fi(m=>{if(m>=m)for(;e(m),!p(m);)m.setTime(m-1)},(m,y)=>{if(m>=m)if(y<0)for(;++y<=0;)for(;n(m,-1),!p(m););else for(;--y>=0;)for(;n(m,1),!p(m););}),a&&(l.count=(p,m)=>(BI.setTime(+p),WI.setTime(+m),e(BI),e(WI),Math.floor(a(BI,WI))),l.every=p=>(p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?l.filter(o?m=>o(m)%p===0:m=>l.count(0,m)%p===0):l)),l}const Pw=fi(()=>{},(e,n)=>{e.setTime(+e+n)},(e,n)=>n-e);Pw.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?fi(n=>{n.setTime(Math.floor(n/e)*e)},(n,a)=>{n.setTime(+n+a*e)},(n,a)=>(a-n)/e):Pw);Pw.range;const cl=1e3,qs=cl*60,ll=qs*60,wl=ll*24,U2=wl*7,lK=wl*30,GI=wl*365,lh=fi(e=>{e.setTime(e-e.getMilliseconds())},(e,n)=>{e.setTime(+e+n*cl)},(e,n)=>(n-e)/cl,e=>e.getUTCSeconds());lh.range;const V2=fi(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*cl)},(e,n)=>{e.setTime(+e+n*qs)},(e,n)=>(n-e)/qs,e=>e.getMinutes());V2.range;const F2=fi(e=>{e.setUTCSeconds(0,0)},(e,n)=>{e.setTime(+e+n*qs)},(e,n)=>(n-e)/qs,e=>e.getUTCMinutes());F2.range;const B2=fi(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*cl-e.getMinutes()*qs)},(e,n)=>{e.setTime(+e+n*ll)},(e,n)=>(n-e)/ll,e=>e.getHours());B2.range;const W2=fi(e=>{e.setUTCMinutes(0,0,0)},(e,n)=>{e.setTime(+e+n*ll)},(e,n)=>(n-e)/ll,e=>e.getUTCHours());W2.range;const O_=fi(e=>e.setHours(0,0,0,0),(e,n)=>e.setDate(e.getDate()+n),(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*qs)/wl,e=>e.getDate()-1);O_.range;const hT=fi(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/wl,e=>e.getUTCDate()-1);hT.range;const SZ=fi(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/wl,e=>Math.floor(e/wl));SZ.range;function jh(e){return fi(n=>{n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},(n,a)=>{n.setDate(n.getDate()+a*7)},(n,a)=>(a-n-(a.getTimezoneOffset()-n.getTimezoneOffset())*qs)/U2)}const pT=jh(0),Dw=jh(1),OVe=jh(2),IVe=jh(3),om=jh(4),PVe=jh(5),DVe=jh(6);pT.range;Dw.range;OVe.range;IVe.range;om.range;PVe.range;DVe.range;function Mh(e){return fi(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCDate(n.getUTCDate()+a*7)},(n,a)=>(a-n)/U2)}const fT=Mh(0),kw=Mh(1),kVe=Mh(2),LVe=Mh(3),cm=Mh(4),jVe=Mh(5),MVe=Mh(6);fT.range;kw.range;kVe.range;LVe.range;cm.range;jVe.range;MVe.range;const G2=fi(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,n)=>{e.setMonth(e.getMonth()+n)},(e,n)=>n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12,e=>e.getMonth());G2.range;const $2=fi(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCMonth(e.getUTCMonth()+n)},(e,n)=>n.getUTCMonth()-e.getUTCMonth()+(n.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());$2.range;const xl=fi(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n)},(e,n)=>n.getFullYear()-e.getFullYear(),e=>e.getFullYear());xl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:fi(n=>{n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,a)=>{n.setFullYear(n.getFullYear()+a*e)});xl.range;const Tl=fi(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n)},(e,n)=>n.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Tl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:fi(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCFullYear(n.getUTCFullYear()+a*e)});Tl.range;function wZ(e,n,a,o,l,p){const m=[[lh,1,cl],[lh,5,5*cl],[lh,15,15*cl],[lh,30,30*cl],[p,1,qs],[p,5,5*qs],[p,15,15*qs],[p,30,30*qs],[l,1,ll],[l,3,3*ll],[l,6,6*ll],[l,12,12*ll],[o,1,wl],[o,2,2*wl],[a,1,U2],[n,1,lK],[n,3,3*lK],[e,1,GI]];function y(b,T,x){const A=T<b;A&&([b,T]=[T,b]);const D=x&&typeof x.range=="function"?x:E(b,T,x),N=D?D.range(b,+T+1):[];return A?N.reverse():N}function E(b,T,x){const A=Math.abs(T-b)/x,D=C2(([,,P])=>P).right(m,A);if(D===m.length)return e.every($P(b/GI,T/GI,x));if(D===0)return Pw.every(Math.max($P(b,T,x),1));const[N,L]=m[A/m[D-1][2]<m[D][2]/A?D-1:D];return N.every(L)}return[y,E]}const[UVe,VVe]=wZ(Tl,$2,fT,SZ,W2,F2),[FVe,BVe]=wZ(xl,G2,pT,O_,B2,V2);function $I(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function HI(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function jv(e,n,a){return{y:e,m:n,d:a,H:0,M:0,S:0,L:0}}function WVe(e){var n=e.dateTime,a=e.date,o=e.time,l=e.periods,p=e.days,m=e.shortDays,y=e.months,E=e.shortMonths,b=Mv(l),T=Uv(l),x=Mv(p),A=Uv(p),D=Mv(m),N=Uv(m),L=Mv(y),P=Uv(y),U=Mv(E),V=Uv(E),F={a:be,A:ae,b:ce,B:Se,c:null,d:mK,e:mK,f:u4e,g:b4e,G:w4e,H:c4e,I:l4e,j:d4e,L:xZ,m:h4e,M:p4e,p:je,q:fe,Q:yK,s:_K,S:f4e,u:m4e,U:g4e,V:v4e,w:y4e,W:_4e,x:null,X:null,y:E4e,Y:S4e,Z:x4e,"%":vK},H={a:He,A:Ye,b:gt,B:Vt,c:null,d:gK,e:gK,f:A4e,g:U4e,G:F4e,H:T4e,I:C4e,j:R4e,L:CZ,m:N4e,M:O4e,p:zn,q:_r,Q:yK,s:_K,S:I4e,u:P4e,U:D4e,V:k4e,w:L4e,W:j4e,x:null,X:null,y:M4e,Y:V4e,Z:B4e,"%":vK},B={a:de,A:le,b:he,B:Re,c:ve,d:pK,e:pK,f:i4e,g:hK,G:uK,H:fK,I:fK,j:e4e,L:r4e,m:ZVe,M:t4e,p:re,q:QVe,Q:s4e,s:o4e,S:n4e,u:KVe,U:YVe,V:qVe,w:zVe,W:XVe,x:we,X:ue,y:hK,Y:uK,Z:JVe,"%":a4e};F.x=z(a,F),F.X=z(o,F),F.c=z(n,F),H.x=z(a,H),H.X=z(o,H),H.c=z(n,H);function z(it,Nt){return function(Ut){var Pe=[],St=-1,Ot=0,Pn=it.length,wn,Oe,rt;for(Ut instanceof Date||(Ut=new Date(+Ut));++St<Pn;)it.charCodeAt(St)===37&&(Pe.push(it.slice(Ot,St)),(Oe=dK[wn=it.charAt(++St)])!=null?wn=it.charAt(++St):Oe=wn==="e"?" ":"0",(rt=Nt[wn])&&(wn=rt(Ut,Oe)),Pe.push(wn),Ot=St+1);return Pe.push(it.slice(Ot,St)),Pe.join("")}}function Y(it,Nt){return function(Ut){var Pe=jv(1900,void 0,1),St=Q(Pe,it,Ut+="",0),Ot,Pn;if(St!=Ut.length)return null;if("Q"in Pe)return new Date(Pe.Q);if("s"in Pe)return new Date(Pe.s*1e3+("L"in Pe?Pe.L:0));if(Nt&&!("Z"in Pe)&&(Pe.Z=0),"p"in Pe&&(Pe.H=Pe.H%12+Pe.p*12),Pe.m===void 0&&(Pe.m="q"in Pe?Pe.q:0),"V"in Pe){if(Pe.V<1||Pe.V>53)return null;"w"in Pe||(Pe.w=1),"Z"in Pe?(Ot=HI(jv(Pe.y,0,1)),Pn=Ot.getUTCDay(),Ot=Pn>4||Pn===0?kw.ceil(Ot):kw(Ot),Ot=hT.offset(Ot,(Pe.V-1)*7),Pe.y=Ot.getUTCFullYear(),Pe.m=Ot.getUTCMonth(),Pe.d=Ot.getUTCDate()+(Pe.w+6)%7):(Ot=$I(jv(Pe.y,0,1)),Pn=Ot.getDay(),Ot=Pn>4||Pn===0?Dw.ceil(Ot):Dw(Ot),Ot=O_.offset(Ot,(Pe.V-1)*7),Pe.y=Ot.getFullYear(),Pe.m=Ot.getMonth(),Pe.d=Ot.getDate()+(Pe.w+6)%7)}else("W"in Pe||"U"in Pe)&&("w"in Pe||(Pe.w="u"in Pe?Pe.u%7:"W"in Pe?1:0),Pn="Z"in Pe?HI(jv(Pe.y,0,1)).getUTCDay():$I(jv(Pe.y,0,1)).getDay(),Pe.m=0,Pe.d="W"in Pe?(Pe.w+6)%7+Pe.W*7-(Pn+5)%7:Pe.w+Pe.U*7-(Pn+6)%7);return"Z"in Pe?(Pe.H+=Pe.Z/100|0,Pe.M+=Pe.Z%100,HI(Pe)):$I(Pe)}}function Q(it,Nt,Ut,Pe){for(var St=0,Ot=Nt.length,Pn=Ut.length,wn,Oe;St<Ot;){if(Pe>=Pn)return-1;if(wn=Nt.charCodeAt(St++),wn===37){if(wn=Nt.charAt(St++),Oe=B[wn in dK?Nt.charAt(St++):wn],!Oe||(Pe=Oe(it,Ut,Pe))<0)return-1}else if(wn!=Ut.charCodeAt(Pe++))return-1}return Pe}function re(it,Nt,Ut){var Pe=b.exec(Nt.slice(Ut));return Pe?(it.p=T.get(Pe[0].toLowerCase()),Ut+Pe[0].length):-1}function de(it,Nt,Ut){var Pe=D.exec(Nt.slice(Ut));return Pe?(it.w=N.get(Pe[0].toLowerCase()),Ut+Pe[0].length):-1}function le(it,Nt,Ut){var Pe=x.exec(Nt.slice(Ut));return Pe?(it.w=A.get(Pe[0].toLowerCase()),Ut+Pe[0].length):-1}function he(it,Nt,Ut){var Pe=U.exec(Nt.slice(Ut));return Pe?(it.m=V.get(Pe[0].toLowerCase()),Ut+Pe[0].length):-1}function Re(it,Nt,Ut){var Pe=L.exec(Nt.slice(Ut));return Pe?(it.m=P.get(Pe[0].toLowerCase()),Ut+Pe[0].length):-1}function ve(it,Nt,Ut){return Q(it,n,Nt,Ut)}function we(it,Nt,Ut){return Q(it,a,Nt,Ut)}function ue(it,Nt,Ut){return Q(it,o,Nt,Ut)}function be(it){return m[it.getDay()]}function ae(it){return p[it.getDay()]}function ce(it){return E[it.getMonth()]}function Se(it){return y[it.getMonth()]}function je(it){return l[+(it.getHours()>=12)]}function fe(it){return 1+~~(it.getMonth()/3)}function He(it){return m[it.getUTCDay()]}function Ye(it){return p[it.getUTCDay()]}function gt(it){return E[it.getUTCMonth()]}function Vt(it){return y[it.getUTCMonth()]}function zn(it){return l[+(it.getUTCHours()>=12)]}function _r(it){return 1+~~(it.getUTCMonth()/3)}return{format:function(it){var Nt=z(it+="",F);return Nt.toString=function(){return it},Nt},parse:function(it){var Nt=Y(it+="",!1);return Nt.toString=function(){return it},Nt},utcFormat:function(it){var Nt=z(it+="",H);return Nt.toString=function(){return it},Nt},utcParse:function(it){var Nt=Y(it+="",!0);return Nt.toString=function(){return it},Nt}}}var dK={"-":"",_:" ",0:"0"},Ci=/^\s*\d+/,GVe=/^%/,$Ve=/[\\^$*+?|[\]().{}]/g;function Ln(e,n,a){var o=e<0?"-":"",l=(o?-e:e)+"",p=l.length;return o+(p<a?new Array(a-p+1).join(n)+l:l)}function HVe(e){return e.replace($Ve,"\\$&")}function Mv(e){return new RegExp("^(?:"+e.map(HVe).join("|")+")","i")}function Uv(e){return new Map(e.map((n,a)=>[n.toLowerCase(),a]))}function zVe(e,n,a){var o=Ci.exec(n.slice(a,a+1));return o?(e.w=+o[0],a+o[0].length):-1}function KVe(e,n,a){var o=Ci.exec(n.slice(a,a+1));return o?(e.u=+o[0],a+o[0].length):-1}function YVe(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.U=+o[0],a+o[0].length):-1}function qVe(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.V=+o[0],a+o[0].length):-1}function XVe(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.W=+o[0],a+o[0].length):-1}function uK(e,n,a){var o=Ci.exec(n.slice(a,a+4));return o?(e.y=+o[0],a+o[0].length):-1}function hK(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.y=+o[0]+(+o[0]>68?1900:2e3),a+o[0].length):-1}function JVe(e,n,a){var o=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(a,a+6));return o?(e.Z=o[1]?0:-(o[2]+(o[3]||"00")),a+o[0].length):-1}function QVe(e,n,a){var o=Ci.exec(n.slice(a,a+1));return o?(e.q=o[0]*3-3,a+o[0].length):-1}function ZVe(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.m=o[0]-1,a+o[0].length):-1}function pK(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.d=+o[0],a+o[0].length):-1}function e4e(e,n,a){var o=Ci.exec(n.slice(a,a+3));return o?(e.m=0,e.d=+o[0],a+o[0].length):-1}function fK(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.H=+o[0],a+o[0].length):-1}function t4e(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.M=+o[0],a+o[0].length):-1}function n4e(e,n,a){var o=Ci.exec(n.slice(a,a+2));return o?(e.S=+o[0],a+o[0].length):-1}function r4e(e,n,a){var o=Ci.exec(n.slice(a,a+3));return o?(e.L=+o[0],a+o[0].length):-1}function i4e(e,n,a){var o=Ci.exec(n.slice(a,a+6));return o?(e.L=Math.floor(o[0]/1e3),a+o[0].length):-1}function a4e(e,n,a){var o=GVe.exec(n.slice(a,a+1));return o?a+o[0].length:-1}function s4e(e,n,a){var o=Ci.exec(n.slice(a));return o?(e.Q=+o[0],a+o[0].length):-1}function o4e(e,n,a){var o=Ci.exec(n.slice(a));return o?(e.s=+o[0],a+o[0].length):-1}function mK(e,n){return Ln(e.getDate(),n,2)}function c4e(e,n){return Ln(e.getHours(),n,2)}function l4e(e,n){return Ln(e.getHours()%12||12,n,2)}function d4e(e,n){return Ln(1+O_.count(xl(e),e),n,3)}function xZ(e,n){return Ln(e.getMilliseconds(),n,3)}function u4e(e,n){return xZ(e,n)+"000"}function h4e(e,n){return Ln(e.getMonth()+1,n,2)}function p4e(e,n){return Ln(e.getMinutes(),n,2)}function f4e(e,n){return Ln(e.getSeconds(),n,2)}function m4e(e){var n=e.getDay();return n===0?7:n}function g4e(e,n){return Ln(pT.count(xl(e)-1,e),n,2)}function TZ(e){var n=e.getDay();return n>=4||n===0?om(e):om.ceil(e)}function v4e(e,n){return e=TZ(e),Ln(om.count(xl(e),e)+(xl(e).getDay()===4),n,2)}function y4e(e){return e.getDay()}function _4e(e,n){return Ln(Dw.count(xl(e)-1,e),n,2)}function E4e(e,n){return Ln(e.getFullYear()%100,n,2)}function b4e(e,n){return e=TZ(e),Ln(e.getFullYear()%100,n,2)}function S4e(e,n){return Ln(e.getFullYear()%1e4,n,4)}function w4e(e,n){var a=e.getDay();return e=a>=4||a===0?om(e):om.ceil(e),Ln(e.getFullYear()%1e4,n,4)}function x4e(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Ln(n/60|0,"0",2)+Ln(n%60,"0",2)}function gK(e,n){return Ln(e.getUTCDate(),n,2)}function T4e(e,n){return Ln(e.getUTCHours(),n,2)}function C4e(e,n){return Ln(e.getUTCHours()%12||12,n,2)}function R4e(e,n){return Ln(1+hT.count(Tl(e),e),n,3)}function CZ(e,n){return Ln(e.getUTCMilliseconds(),n,3)}function A4e(e,n){return CZ(e,n)+"000"}function N4e(e,n){return Ln(e.getUTCMonth()+1,n,2)}function O4e(e,n){return Ln(e.getUTCMinutes(),n,2)}function I4e(e,n){return Ln(e.getUTCSeconds(),n,2)}function P4e(e){var n=e.getUTCDay();return n===0?7:n}function D4e(e,n){return Ln(fT.count(Tl(e)-1,e),n,2)}function RZ(e){var n=e.getUTCDay();return n>=4||n===0?cm(e):cm.ceil(e)}function k4e(e,n){return e=RZ(e),Ln(cm.count(Tl(e),e)+(Tl(e).getUTCDay()===4),n,2)}function L4e(e){return e.getUTCDay()}function j4e(e,n){return Ln(kw.count(Tl(e)-1,e),n,2)}function M4e(e,n){return Ln(e.getUTCFullYear()%100,n,2)}function U4e(e,n){return e=RZ(e),Ln(e.getUTCFullYear()%100,n,2)}function V4e(e,n){return Ln(e.getUTCFullYear()%1e4,n,4)}function F4e(e,n){var a=e.getUTCDay();return e=a>=4||a===0?cm(e):cm.ceil(e),Ln(e.getUTCFullYear()%1e4,n,4)}function B4e(){return"+0000"}function vK(){return"%"}function yK(e){return+e}function _K(e){return Math.floor(+e/1e3)}var ff,AZ,NZ;W4e({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function W4e(e){return ff=WVe(e),AZ=ff.format,ff.parse,NZ=ff.utcFormat,ff.utcParse,ff}function G4e(e){return new Date(e)}function $4e(e){return e instanceof Date?+e:+new Date(+e)}function H2(e,n,a,o,l,p,m,y,E,b){var T=I2(),x=T.invert,A=T.domain,D=b(".%L"),N=b(":%S"),L=b("%I:%M"),P=b("%I %p"),U=b("%a %d"),V=b("%b %d"),F=b("%B"),H=b("%Y");function B(z){return(E(z)<z?D:y(z)<z?N:m(z)<z?L:p(z)<z?P:o(z)<z?l(z)<z?U:V:a(z)<z?F:H)(z)}return T.invert=function(z){return new Date(x(z))},T.domain=function(z){return arguments.length?A(Array.from(z,$4e)):A().map(G4e)},T.ticks=function(z){var Y=A();return e(Y[0],Y[Y.length-1],z??10)},T.tickFormat=function(z,Y){return Y==null?B:b(Y)},T.nice=function(z){var Y=A();return(!z||typeof z.range!="function")&&(z=n(Y[0],Y[Y.length-1],z??10)),z?A(mZ(Y,z)):T},T.copy=function(){return N_(T,H2(e,n,a,o,l,p,m,y,E,b))},T}function H4e(){return ao.apply(H2(FVe,BVe,xl,G2,pT,O_,B2,V2,lh,AZ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function z4e(){return ao.apply(H2(UVe,VVe,Tl,$2,fT,hT,W2,F2,lh,NZ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function mT(){var e=0,n=1,a,o,l,p,m=fa,y=!1,E;function b(x){return x==null||isNaN(x=+x)?E:m(l===0?.5:(x=(p(x)-a)*l,y?Math.max(0,Math.min(1,x)):x))}b.domain=function(x){return arguments.length?([e,n]=x,a=p(e=+e),o=p(n=+n),l=a===o?0:1/(o-a),b):[e,n]},b.clamp=function(x){return arguments.length?(y=!!x,b):y},b.interpolator=function(x){return arguments.length?(m=x,b):m};function T(x){return function(A){var D,N;return arguments.length?([D,N]=A,m=x(D,N),b):[m(0),m(1)]}}return b.range=T($m),b.rangeRound=T(O2),b.unknown=function(x){return arguments.length?(E=x,b):E},function(x){return p=x,a=x(e),o=x(n),l=a===o?0:1/(o-a),b}}function Jd(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function OZ(){var e=Xd(mT()(fa));return e.copy=function(){return Jd(e,OZ())},Ol.apply(e,arguments)}function IZ(){var e=k2(mT()).domain([1,10]);return e.copy=function(){return Jd(e,IZ()).base(e.base())},Ol.apply(e,arguments)}function PZ(){var e=L2(mT());return e.copy=function(){return Jd(e,PZ()).constant(e.constant())},Ol.apply(e,arguments)}function z2(){var e=j2(mT());return e.copy=function(){return Jd(e,z2()).exponent(e.exponent())},Ol.apply(e,arguments)}function K4e(){return z2.apply(null,arguments).exponent(.5)}function DZ(){var e=[],n=fa;function a(o){if(o!=null&&!isNaN(o=+o))return n((R_(e,o,1)-1)/(e.length-1))}return a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let l of o)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(Md),a},a.interpolator=function(o){return arguments.length?(n=o,a):n},a.range=function(){return e.map((o,l)=>n(l/(e.length-1)))},a.quantiles=function(o){return Array.from({length:o+1},(l,p)=>DUe(e,p/o))},a.copy=function(){return DZ(n).domain(e)},Ol.apply(a,arguments)}function gT(){var e=0,n=.5,a=1,o=1,l,p,m,y,E,b=fa,T,x=!1,A;function D(L){return isNaN(L=+L)?A:(L=.5+((L=+T(L))-p)*(o*L<o*p?y:E),b(x?Math.max(0,Math.min(1,L)):L))}D.domain=function(L){return arguments.length?([e,n,a]=L,l=T(e=+e),p=T(n=+n),m=T(a=+a),y=l===p?0:.5/(p-l),E=p===m?0:.5/(m-p),o=p<l?-1:1,D):[e,n,a]},D.clamp=function(L){return arguments.length?(x=!!L,D):x},D.interpolator=function(L){return arguments.length?(b=L,D):b};function N(L){return function(P){var U,V,F;return arguments.length?([U,V,F]=P,b=aVe(L,[U,V,F]),D):[b(0),b(.5),b(1)]}}return D.range=N($m),D.rangeRound=N(O2),D.unknown=function(L){return arguments.length?(A=L,D):A},function(L){return T=L,l=L(e),p=L(n),m=L(a),y=l===p?0:.5/(p-l),E=p===m?0:.5/(m-p),o=p<l?-1:1,D}}function kZ(){var e=Xd(gT()(fa));return e.copy=function(){return Jd(e,kZ())},Ol.apply(e,arguments)}function LZ(){var e=k2(gT()).domain([.1,1,10]);return e.copy=function(){return Jd(e,LZ()).base(e.base())},Ol.apply(e,arguments)}function jZ(){var e=L2(gT());return e.copy=function(){return Jd(e,jZ()).constant(e.constant())},Ol.apply(e,arguments)}function K2(){var e=j2(gT());return e.copy=function(){return Jd(e,K2()).exponent(e.exponent())},Ol.apply(e,arguments)}function Y4e(){return K2.apply(null,arguments).exponent(.5)}const EK=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:My,scaleDiverging:kZ,scaleDivergingLog:LZ,scaleDivergingPow:K2,scaleDivergingSqrt:Y4e,scaleDivergingSymlog:jZ,scaleIdentity:fZ,scaleImplicit:HP,scaleLinear:Iw,scaleLog:gZ,scaleOrdinal:R2,scalePoint:sy,scalePow:M2,scaleQuantile:_Z,scaleQuantize:EZ,scaleRadial:yZ,scaleSequential:OZ,scaleSequentialLog:IZ,scaleSequentialPow:z2,scaleSequentialQuantile:DZ,scaleSequentialSqrt:K4e,scaleSequentialSymlog:PZ,scaleSqrt:AVe,scaleSymlog:vZ,scaleThreshold:bZ,scaleTime:H4e,scaleUtc:z4e,tickFormat:pZ},Symbol.toStringTag,{value:"Module"}));var q4e=km;function X4e(e,n,a){for(var o=-1,l=e.length;++o<l;){var p=e[o],m=n(p);if(m!=null&&(y===void 0?m===m&&!q4e(m):a(m,y)))var y=m,E=p}return E}var MZ=X4e;function J4e(e,n){return e>n}var Q4e=J4e,Z4e=MZ,eFe=Q4e,tFe=Gm;function nFe(e){return e&&e.length?Z4e(e,tFe,eFe):void 0}var rFe=nFe;const Td=Zn(rFe);function iFe(e,n){return e<n}var aFe=iFe,sFe=MZ,oFe=aFe,cFe=Gm;function lFe(e){return e&&e.length?sFe(e,cFe,oFe):void 0}var dFe=lFe;const vT=Zn(dFe);var uFe=o2,hFe=qd,pFe=HQ,fFe=za;function mFe(e,n){var a=fFe(e)?uFe:pFe;return a(e,hFe(n))}var gFe=mFe,vFe=GQ,yFe=gFe;function _Fe(e,n){return vFe(yFe(e,n),1)}var EFe=_Fe;const bFe=Zn(EFe);var SFe=S2;function wFe(e,n){return SFe(e,n)}var xFe=wFe;const lm=Zn(xFe);var Hm=1e9,TFe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},q2,Rr=!0,no="[DecimalError] ",_h=no+"Invalid argument: ",Y2=no+"Exponent out of range: ",zm=Math.floor,Zu=Math.pow,CFe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,hs,wi=1e7,vr=7,UZ=9007199254740991,Lw=zm(UZ/vr),_t={};_t.absoluteValue=_t.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};_t.comparedTo=_t.cmp=function(e){var n,a,o,l,p=this;if(e=new p.constructor(e),p.s!==e.s)return p.s||-e.s;if(p.e!==e.e)return p.e>e.e^p.s<0?1:-1;for(o=p.d.length,l=e.d.length,n=0,a=o<l?o:l;n<a;++n)if(p.d[n]!==e.d[n])return p.d[n]>e.d[n]^p.s<0?1:-1;return o===l?0:o>l^p.s<0?1:-1};_t.decimalPlaces=_t.dp=function(){var e=this,n=e.d.length-1,a=(n-e.e)*vr;if(n=e.d[n],n)for(;n%10==0;n/=10)a--;return a<0?0:a};_t.dividedBy=_t.div=function(e){return fl(this,new this.constructor(e))};_t.dividedToIntegerBy=_t.idiv=function(e){var n=this,a=n.constructor;return ar(fl(n,new a(e),0,1),a.precision)};_t.equals=_t.eq=function(e){return!this.cmp(e)};_t.exponent=function(){return ri(this)};_t.greaterThan=_t.gt=function(e){return this.cmp(e)>0};_t.greaterThanOrEqualTo=_t.gte=function(e){return this.cmp(e)>=0};_t.isInteger=_t.isint=function(){return this.e>this.d.length-2};_t.isNegative=_t.isneg=function(){return this.s<0};_t.isPositive=_t.ispos=function(){return this.s>0};_t.isZero=function(){return this.s===0};_t.lessThan=_t.lt=function(e){return this.cmp(e)<0};_t.lessThanOrEqualTo=_t.lte=function(e){return this.cmp(e)<1};_t.logarithm=_t.log=function(e){var n,a=this,o=a.constructor,l=o.precision,p=l+5;if(e===void 0)e=new o(10);else if(e=new o(e),e.s<1||e.eq(hs))throw Error(no+"NaN");if(a.s<1)throw Error(no+(a.s?"NaN":"-Infinity"));return a.eq(hs)?new o(0):(Rr=!1,n=fl(Wy(a,p),Wy(e,p),p),Rr=!0,ar(n,l))};_t.minus=_t.sub=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?BZ(n,e):VZ(n,(e.s=-e.s,e))};_t.modulo=_t.mod=function(e){var n,a=this,o=a.constructor,l=o.precision;if(e=new o(e),!e.s)throw Error(no+"NaN");return a.s?(Rr=!1,n=fl(a,e,0,1).times(e),Rr=!0,a.minus(n)):ar(new o(a),l)};_t.naturalExponential=_t.exp=function(){return FZ(this)};_t.naturalLogarithm=_t.ln=function(){return Wy(this)};_t.negated=_t.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};_t.plus=_t.add=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?VZ(n,e):BZ(n,(e.s=-e.s,e))};_t.precision=_t.sd=function(e){var n,a,o,l=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(_h+e);if(n=ri(l)+1,o=l.d.length-1,a=o*vr+1,o=l.d[o],o){for(;o%10==0;o/=10)a--;for(o=l.d[0];o>=10;o/=10)a++}return e&&n>a?n:a};_t.squareRoot=_t.sqrt=function(){var e,n,a,o,l,p,m,y=this,E=y.constructor;if(y.s<1){if(!y.s)return new E(0);throw Error(no+"NaN")}for(e=ri(y),Rr=!1,l=Math.sqrt(+y),l==0||l==1/0?(n=Ac(y.d),(n.length+e)%2==0&&(n+="0"),l=Math.sqrt(n),e=zm((e+1)/2)-(e<0||e%2),l==1/0?n="5e"+e:(n=l.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),o=new E(n)):o=new E(l.toString()),a=E.precision,l=m=a+3;;)if(p=o,o=p.plus(fl(y,p,m+2)).times(.5),Ac(p.d).slice(0,m)===(n=Ac(o.d)).slice(0,m)){if(n=n.slice(m-3,m+1),l==m&&n=="4999"){if(ar(p,a+1,0),p.times(p).eq(y)){o=p;break}}else if(n!="9999")break;m+=4}return Rr=!0,ar(o,a)};_t.times=_t.mul=function(e){var n,a,o,l,p,m,y,E,b,T=this,x=T.constructor,A=T.d,D=(e=new x(e)).d;if(!T.s||!e.s)return new x(0);for(e.s*=T.s,a=T.e+e.e,E=A.length,b=D.length,E<b&&(p=A,A=D,D=p,m=E,E=b,b=m),p=[],m=E+b,o=m;o--;)p.push(0);for(o=b;--o>=0;){for(n=0,l=E+o;l>o;)y=p[l]+D[o]*A[l-o-1]+n,p[l--]=y%wi|0,n=y/wi|0;p[l]=(p[l]+n)%wi|0}for(;!p[--m];)p.pop();return n?++a:p.shift(),e.d=p,e.e=a,Rr?ar(e,x.precision):e};_t.toDecimalPlaces=_t.todp=function(e,n){var a=this,o=a.constructor;return a=new o(a),e===void 0?a:(Lc(e,0,Hm),n===void 0?n=o.rounding:Lc(n,0,8),ar(a,e+ri(a)+1,n))};_t.toExponential=function(e,n){var a,o=this,l=o.constructor;return e===void 0?a=Nh(o,!0):(Lc(e,0,Hm),n===void 0?n=l.rounding:Lc(n,0,8),o=ar(new l(o),e+1,n),a=Nh(o,!0,e+1)),a};_t.toFixed=function(e,n){var a,o,l=this,p=l.constructor;return e===void 0?Nh(l):(Lc(e,0,Hm),n===void 0?n=p.rounding:Lc(n,0,8),o=ar(new p(l),e+ri(l)+1,n),a=Nh(o.abs(),!1,e+ri(o)+1),l.isneg()&&!l.isZero()?"-"+a:a)};_t.toInteger=_t.toint=function(){var e=this,n=e.constructor;return ar(new n(e),ri(e)+1,n.rounding)};_t.toNumber=function(){return+this};_t.toPower=_t.pow=function(e){var n,a,o,l,p,m,y=this,E=y.constructor,b=12,T=+(e=new E(e));if(!e.s)return new E(hs);if(y=new E(y),!y.s){if(e.s<1)throw Error(no+"Infinity");return y}if(y.eq(hs))return y;if(o=E.precision,e.eq(hs))return ar(y,o);if(n=e.e,a=e.d.length-1,m=n>=a,p=y.s,m){if((a=T<0?-T:T)<=UZ){for(l=new E(hs),n=Math.ceil(o/vr+4),Rr=!1;a%2&&(l=l.times(y),SK(l.d,n)),a=zm(a/2),a!==0;)y=y.times(y),SK(y.d,n);return Rr=!0,e.s<0?new E(hs).div(l):ar(l,o)}}else if(p<0)throw Error(no+"NaN");return p=p<0&&e.d[Math.max(n,a)]&1?-1:1,y.s=1,Rr=!1,l=e.times(Wy(y,o+b)),Rr=!0,l=FZ(l),l.s=p,l};_t.toPrecision=function(e,n){var a,o,l=this,p=l.constructor;return e===void 0?(a=ri(l),o=Nh(l,a<=p.toExpNeg||a>=p.toExpPos)):(Lc(e,1,Hm),n===void 0?n=p.rounding:Lc(n,0,8),l=ar(new p(l),e,n),a=ri(l),o=Nh(l,e<=a||a<=p.toExpNeg,e)),o};_t.toSignificantDigits=_t.tosd=function(e,n){var a=this,o=a.constructor;return e===void 0?(e=o.precision,n=o.rounding):(Lc(e,1,Hm),n===void 0?n=o.rounding:Lc(n,0,8)),ar(new o(a),e,n)};_t.toString=_t.valueOf=_t.val=_t.toJSON=_t[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,n=ri(e),a=e.constructor;return Nh(e,n<=a.toExpNeg||n>=a.toExpPos)};function VZ(e,n){var a,o,l,p,m,y,E,b,T=e.constructor,x=T.precision;if(!e.s||!n.s)return n.s||(n=new T(e)),Rr?ar(n,x):n;if(E=e.d,b=n.d,m=e.e,l=n.e,E=E.slice(),p=m-l,p){for(p<0?(o=E,p=-p,y=b.length):(o=b,l=m,y=E.length),m=Math.ceil(x/vr),y=m>y?m+1:y+1,p>y&&(p=y,o.length=1),o.reverse();p--;)o.push(0);o.reverse()}for(y=E.length,p=b.length,y-p<0&&(p=y,o=b,b=E,E=o),a=0;p;)a=(E[--p]=E[p]+b[p]+a)/wi|0,E[p]%=wi;for(a&&(E.unshift(a),++l),y=E.length;E[--y]==0;)E.pop();return n.d=E,n.e=l,Rr?ar(n,x):n}function Lc(e,n,a){if(e!==~~e||e<n||e>a)throw Error(_h+e)}function Ac(e){var n,a,o,l=e.length-1,p="",m=e[0];if(l>0){for(p+=m,n=1;n<l;n++)o=e[n]+"",a=vr-o.length,a&&(p+=md(a)),p+=o;m=e[n],o=m+"",a=vr-o.length,a&&(p+=md(a))}else if(m===0)return"0";for(;m%10===0;)m/=10;return p+m}var fl=function(){function e(o,l){var p,m=0,y=o.length;for(o=o.slice();y--;)p=o[y]*l+m,o[y]=p%wi|0,m=p/wi|0;return m&&o.unshift(m),o}function n(o,l,p,m){var y,E;if(p!=m)E=p>m?1:-1;else for(y=E=0;y<p;y++)if(o[y]!=l[y]){E=o[y]>l[y]?1:-1;break}return E}function a(o,l,p){for(var m=0;p--;)o[p]-=m,m=o[p]<l[p]?1:0,o[p]=m*wi+o[p]-l[p];for(;!o[0]&&o.length>1;)o.shift()}return function(o,l,p,m){var y,E,b,T,x,A,D,N,L,P,U,V,F,H,B,z,Y,Q,re=o.constructor,de=o.s==l.s?1:-1,le=o.d,he=l.d;if(!o.s)return new re(o);if(!l.s)throw Error(no+"Division by zero");for(E=o.e-l.e,Y=he.length,B=le.length,D=new re(de),N=D.d=[],b=0;he[b]==(le[b]||0);)++b;if(he[b]>(le[b]||0)&&--E,p==null?V=p=re.precision:m?V=p+(ri(o)-ri(l))+1:V=p,V<0)return new re(0);if(V=V/vr+2|0,b=0,Y==1)for(T=0,he=he[0],V++;(b<B||T)&&V--;b++)F=T*wi+(le[b]||0),N[b]=F/he|0,T=F%he|0;else{for(T=wi/(he[0]+1)|0,T>1&&(he=e(he,T),le=e(le,T),Y=he.length,B=le.length),H=Y,L=le.slice(0,Y),P=L.length;P<Y;)L[P++]=0;Q=he.slice(),Q.unshift(0),z=he[0],he[1]>=wi/2&&++z;do T=0,y=n(he,L,Y,P),y<0?(U=L[0],Y!=P&&(U=U*wi+(L[1]||0)),T=U/z|0,T>1?(T>=wi&&(T=wi-1),x=e(he,T),A=x.length,P=L.length,y=n(x,L,A,P),y==1&&(T--,a(x,Y<A?Q:he,A))):(T==0&&(y=T=1),x=he.slice()),A=x.length,A<P&&x.unshift(0),a(L,x,P),y==-1&&(P=L.length,y=n(he,L,Y,P),y<1&&(T++,a(L,Y<P?Q:he,P))),P=L.length):y===0&&(T++,L=[0]),N[b++]=T,y&&L[0]?L[P++]=le[H]||0:(L=[le[H]],P=1);while((H++<B||L[0]!==void 0)&&V--)}return N[0]||N.shift(),D.e=E,ar(D,m?p+ri(D)+1:p)}}();function FZ(e,n){var a,o,l,p,m,y,E=0,b=0,T=e.constructor,x=T.precision;if(ri(e)>16)throw Error(Y2+ri(e));if(!e.s)return new T(hs);for(Rr=!1,y=x,m=new T(.03125);e.abs().gte(.1);)e=e.times(m),b+=5;for(o=Math.log(Zu(2,b))/Math.LN10*2+5|0,y+=o,a=l=p=new T(hs),T.precision=y;;){if(l=ar(l.times(e),y),a=a.times(++E),m=p.plus(fl(l,a,y)),Ac(m.d).slice(0,y)===Ac(p.d).slice(0,y)){for(;b--;)p=ar(p.times(p),y);return T.precision=x,n==null?(Rr=!0,ar(p,x)):p}p=m}}function ri(e){for(var n=e.e*vr,a=e.d[0];a>=10;a/=10)n++;return n}function zI(e,n,a){if(n>e.LN10.sd())throw Rr=!0,a&&(e.precision=a),Error(no+"LN10 precision limit exceeded");return ar(new e(e.LN10),n)}function md(e){for(var n="";e--;)n+="0";return n}function Wy(e,n){var a,o,l,p,m,y,E,b,T,x=1,A=10,D=e,N=D.d,L=D.constructor,P=L.precision;if(D.s<1)throw Error(no+(D.s?"NaN":"-Infinity"));if(D.eq(hs))return new L(0);if(n==null?(Rr=!1,b=P):b=n,D.eq(10))return n==null&&(Rr=!0),zI(L,b);if(b+=A,L.precision=b,a=Ac(N),o=a.charAt(0),p=ri(D),Math.abs(p)<15e14){for(;o<7&&o!=1||o==1&&a.charAt(1)>3;)D=D.times(e),a=Ac(D.d),o=a.charAt(0),x++;p=ri(D),o>1?(D=new L("0."+a),p++):D=new L(o+"."+a.slice(1))}else return E=zI(L,b+2,P).times(p+""),D=Wy(new L(o+"."+a.slice(1)),b-A).plus(E),L.precision=P,n==null?(Rr=!0,ar(D,P)):D;for(y=m=D=fl(D.minus(hs),D.plus(hs),b),T=ar(D.times(D),b),l=3;;){if(m=ar(m.times(T),b),E=y.plus(fl(m,new L(l),b)),Ac(E.d).slice(0,b)===Ac(y.d).slice(0,b))return y=y.times(2),p!==0&&(y=y.plus(zI(L,b+2,P).times(p+""))),y=fl(y,new L(x),b),L.precision=P,n==null?(Rr=!0,ar(y,P)):y;y=E,l+=2}}function bK(e,n){var a,o,l;for((a=n.indexOf("."))>-1&&(n=n.replace(".","")),(o=n.search(/e/i))>0?(a<0&&(a=o),a+=+n.slice(o+1),n=n.substring(0,o)):a<0&&(a=n.length),o=0;n.charCodeAt(o)===48;)++o;for(l=n.length;n.charCodeAt(l-1)===48;)--l;if(n=n.slice(o,l),n){if(l-=o,a=a-o-1,e.e=zm(a/vr),e.d=[],o=(a+1)%vr,a<0&&(o+=vr),o<l){for(o&&e.d.push(+n.slice(0,o)),l-=vr;o<l;)e.d.push(+n.slice(o,o+=vr));n=n.slice(o),o=vr-n.length}else o-=l;for(;o--;)n+="0";if(e.d.push(+n),Rr&&(e.e>Lw||e.e<-Lw))throw Error(Y2+a)}else e.s=0,e.e=0,e.d=[0];return e}function ar(e,n,a){var o,l,p,m,y,E,b,T,x=e.d;for(m=1,p=x[0];p>=10;p/=10)m++;if(o=n-m,o<0)o+=vr,l=n,b=x[T=0];else{if(T=Math.ceil((o+1)/vr),p=x.length,T>=p)return e;for(b=p=x[T],m=1;p>=10;p/=10)m++;o%=vr,l=o-vr+m}if(a!==void 0&&(p=Zu(10,m-l-1),y=b/p%10|0,E=n<0||x[T+1]!==void 0||b%p,E=a<4?(y||E)&&(a==0||a==(e.s<0?3:2)):y>5||y==5&&(a==4||E||a==6&&(o>0?l>0?b/Zu(10,m-l):0:x[T-1])%10&1||a==(e.s<0?8:7))),n<1||!x[0])return E?(p=ri(e),x.length=1,n=n-p-1,x[0]=Zu(10,(vr-n%vr)%vr),e.e=zm(-n/vr)||0):(x.length=1,x[0]=e.e=e.s=0),e;if(o==0?(x.length=T,p=1,T--):(x.length=T+1,p=Zu(10,vr-o),x[T]=l>0?(b/Zu(10,m-l)%Zu(10,l)|0)*p:0),E)for(;;)if(T==0){(x[0]+=p)==wi&&(x[0]=1,++e.e);break}else{if(x[T]+=p,x[T]!=wi)break;x[T--]=0,p=1}for(o=x.length;x[--o]===0;)x.pop();if(Rr&&(e.e>Lw||e.e<-Lw))throw Error(Y2+ri(e));return e}function BZ(e,n){var a,o,l,p,m,y,E,b,T,x,A=e.constructor,D=A.precision;if(!e.s||!n.s)return n.s?n.s=-n.s:n=new A(e),Rr?ar(n,D):n;if(E=e.d,x=n.d,o=n.e,b=e.e,E=E.slice(),m=b-o,m){for(T=m<0,T?(a=E,m=-m,y=x.length):(a=x,o=b,y=E.length),l=Math.max(Math.ceil(D/vr),y)+2,m>l&&(m=l,a.length=1),a.reverse(),l=m;l--;)a.push(0);a.reverse()}else{for(l=E.length,y=x.length,T=l<y,T&&(y=l),l=0;l<y;l++)if(E[l]!=x[l]){T=E[l]<x[l];break}m=0}for(T&&(a=E,E=x,x=a,n.s=-n.s),y=E.length,l=x.length-y;l>0;--l)E[y++]=0;for(l=x.length;l>m;){if(E[--l]<x[l]){for(p=l;p&&E[--p]===0;)E[p]=wi-1;--E[p],E[l]+=wi}E[l]-=x[l]}for(;E[--y]===0;)E.pop();for(;E[0]===0;E.shift())--o;return E[0]?(n.d=E,n.e=o,Rr?ar(n,D):n):new A(0)}function Nh(e,n,a){var o,l=ri(e),p=Ac(e.d),m=p.length;return n?(a&&(o=a-m)>0?p=p.charAt(0)+"."+p.slice(1)+md(o):m>1&&(p=p.charAt(0)+"."+p.slice(1)),p=p+(l<0?"e":"e+")+l):l<0?(p="0."+md(-l-1)+p,a&&(o=a-m)>0&&(p+=md(o))):l>=m?(p+=md(l+1-m),a&&(o=a-l-1)>0&&(p=p+"."+md(o))):((o=l+1)<m&&(p=p.slice(0,o)+"."+p.slice(o)),a&&(o=a-m)>0&&(l+1===m&&(p+="."),p+=md(o))),e.s<0?"-"+p:p}function SK(e,n){if(e.length>n)return e.length=n,!0}function WZ(e){var n,a,o;function l(p){var m=this;if(!(m instanceof l))return new l(p);if(m.constructor=l,p instanceof l){m.s=p.s,m.e=p.e,m.d=(p=p.d)?p.slice():p;return}if(typeof p=="number"){if(p*0!==0)throw Error(_h+p);if(p>0)m.s=1;else if(p<0)p=-p,m.s=-1;else{m.s=0,m.e=0,m.d=[0];return}if(p===~~p&&p<1e7){m.e=0,m.d=[p];return}return bK(m,p.toString())}else if(typeof p!="string")throw Error(_h+p);if(p.charCodeAt(0)===45?(p=p.slice(1),m.s=-1):m.s=1,CFe.test(p))bK(m,p);else throw Error(_h+p)}if(l.prototype=_t,l.ROUND_UP=0,l.ROUND_DOWN=1,l.ROUND_CEIL=2,l.ROUND_FLOOR=3,l.ROUND_HALF_UP=4,l.ROUND_HALF_DOWN=5,l.ROUND_HALF_EVEN=6,l.ROUND_HALF_CEIL=7,l.ROUND_HALF_FLOOR=8,l.clone=WZ,l.config=l.set=RFe,e===void 0&&(e={}),e)for(o=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<o.length;)e.hasOwnProperty(a=o[n++])||(e[a]=this[a]);return l.config(e),l}function RFe(e){if(!e||typeof e!="object")throw Error(no+"Object expected");var n,a,o,l=["precision",1,Hm,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(n=0;n<l.length;n+=3)if((o=e[a=l[n]])!==void 0)if(zm(o)===o&&o>=l[n+1]&&o<=l[n+2])this[a]=o;else throw Error(_h+a+": "+o);if((o=e[a="LN10"])!==void 0)if(o==Math.LN10)this[a]=new this(o);else throw Error(_h+a+": "+o);return this}var q2=WZ(TFe);hs=new q2(1);const Qn=q2;function AFe(e){return PFe(e)||IFe(e)||OFe(e)||NFe()}function NFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OFe(e,n){if(e){if(typeof e=="string")return qP(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return qP(e,n)}}function IFe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function PFe(e){if(Array.isArray(e))return qP(e)}function qP(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var DFe=function(n){return n},GZ={},$Z=function(n){return n===GZ},wK=function(n){return function a(){return arguments.length===0||arguments.length===1&&$Z(arguments.length<=0?void 0:arguments[0])?a:n.apply(void 0,arguments)}},kFe=function e(n,a){return n===1?a:wK(function(){for(var o=arguments.length,l=new Array(o),p=0;p<o;p++)l[p]=arguments[p];var m=l.filter(function(y){return y!==GZ}).length;return m>=n?a.apply(void 0,l):e(n-m,wK(function(){for(var y=arguments.length,E=new Array(y),b=0;b<y;b++)E[b]=arguments[b];var T=l.map(function(x){return $Z(x)?E.shift():x});return a.apply(void 0,AFe(T).concat(E))}))})},yT=function(n){return kFe(n.length,n)},XP=function(n,a){for(var o=[],l=n;l<a;++l)o[l-n]=l;return o},LFe=yT(function(e,n){return Array.isArray(n)?n.map(e):Object.keys(n).map(function(a){return n[a]}).map(e)}),jFe=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];if(!a.length)return DFe;var l=a.reverse(),p=l[0],m=l.slice(1);return function(){return m.reduce(function(y,E){return E(y)},p.apply(void 0,arguments))}},JP=function(n){return Array.isArray(n)?n.reverse():n.split("").reverse.join("")},HZ=function(n){var a=null,o=null;return function(){for(var l=arguments.length,p=new Array(l),m=0;m<l;m++)p[m]=arguments[m];return a&&p.every(function(y,E){return y===a[E]})||(a=p,o=n.apply(void 0,p)),o}};function MFe(e){var n;return e===0?n=1:n=Math.floor(new Qn(e).abs().log(10).toNumber())+1,n}function UFe(e,n,a){for(var o=new Qn(e),l=0,p=[];o.lt(n)&&l<1e5;)p.push(o.toNumber()),o=o.add(a),l++;return p}var VFe=yT(function(e,n,a){var o=+e,l=+n;return o+a*(l-o)}),FFe=yT(function(e,n,a){var o=n-+e;return o=o||1/0,(a-e)/o}),BFe=yT(function(e,n,a){var o=n-+e;return o=o||1/0,Math.max(0,Math.min(1,(a-e)/o))});const _T={rangeStep:UFe,getDigitCount:MFe,interpolateNumber:VFe,uninterpolateNumber:FFe,uninterpolateTruncation:BFe};function QP(e){return $Fe(e)||GFe(e)||zZ(e)||WFe()}function WFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GFe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function $Fe(e){if(Array.isArray(e))return ZP(e)}function Gy(e,n){return KFe(e)||zFe(e,n)||zZ(e,n)||HFe()}function HFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zZ(e,n){if(e){if(typeof e=="string")return ZP(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ZP(e,n)}}function ZP(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function zFe(e,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var a=[],o=!0,l=!1,p=void 0;try{for(var m=e[Symbol.iterator](),y;!(o=(y=m.next()).done)&&(a.push(y.value),!(n&&a.length===n));o=!0);}catch(E){l=!0,p=E}finally{try{!o&&m.return!=null&&m.return()}finally{if(l)throw p}}return a}}function KFe(e){if(Array.isArray(e))return e}function KZ(e){var n=Gy(e,2),a=n[0],o=n[1],l=a,p=o;return a>o&&(l=o,p=a),[l,p]}function YZ(e,n,a){if(e.lte(0))return new Qn(0);var o=_T.getDigitCount(e.toNumber()),l=new Qn(10).pow(o),p=e.div(l),m=o!==1?.05:.1,y=new Qn(Math.ceil(p.div(m).toNumber())).add(a).mul(m),E=y.mul(l);return n?E:new Qn(Math.ceil(E))}function YFe(e,n,a){var o=1,l=new Qn(e);if(!l.isint()&&a){var p=Math.abs(e);p<1?(o=new Qn(10).pow(_T.getDigitCount(e)-1),l=new Qn(Math.floor(l.div(o).toNumber())).mul(o)):p>1&&(l=new Qn(Math.floor(e)))}else e===0?l=new Qn(Math.floor((n-1)/2)):a||(l=new Qn(Math.floor(e)));var m=Math.floor((n-1)/2),y=jFe(LFe(function(E){return l.add(new Qn(E-m).mul(o)).toNumber()}),XP);return y(0,n)}function qZ(e,n,a,o){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-e)/(a-1)))return{step:new Qn(0),tickMin:new Qn(0),tickMax:new Qn(0)};var p=YZ(new Qn(n).sub(e).div(a-1),o,l),m;e<=0&&n>=0?m=new Qn(0):(m=new Qn(e).add(n).div(2),m=m.sub(new Qn(m).mod(p)));var y=Math.ceil(m.sub(e).div(p).toNumber()),E=Math.ceil(new Qn(n).sub(m).div(p).toNumber()),b=y+E+1;return b>a?qZ(e,n,a,o,l+1):(b<a&&(E=n>0?E+(a-b):E,y=n>0?y:y+(a-b)),{step:p,tickMin:m.sub(new Qn(y).mul(p)),tickMax:m.add(new Qn(E).mul(p))})}function qFe(e){var n=Gy(e,2),a=n[0],o=n[1],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,m=Math.max(l,2),y=KZ([a,o]),E=Gy(y,2),b=E[0],T=E[1];if(b===-1/0||T===1/0){var x=T===1/0?[b].concat(QP(XP(0,l-1).map(function(){return 1/0}))):[].concat(QP(XP(0,l-1).map(function(){return-1/0})),[T]);return a>o?JP(x):x}if(b===T)return YFe(b,l,p);var A=qZ(b,T,m,p),D=A.step,N=A.tickMin,L=A.tickMax,P=_T.rangeStep(N,L.add(new Qn(.1).mul(D)),D);return a>o?JP(P):P}function XFe(e,n){var a=Gy(e,2),o=a[0],l=a[1],p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,m=KZ([o,l]),y=Gy(m,2),E=y[0],b=y[1];if(E===-1/0||b===1/0)return[o,l];if(E===b)return[E];var T=Math.max(n,2),x=YZ(new Qn(b).sub(E).div(T-1),p,0),A=[].concat(QP(_T.rangeStep(new Qn(E),new Qn(b).sub(new Qn(.99).mul(x)),x)),[b]);return o>l?JP(A):A}var JFe=HZ(qFe),QFe=HZ(XFe),ZFe="Invariant failed";function Oh(e,n){throw new Error(ZFe)}var e5e=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function dm(e){"@babel/helpers - typeof";return dm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},dm(e)}function jw(){return jw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},jw.apply(this,arguments)}function t5e(e,n){return a5e(e)||i5e(e,n)||r5e(e,n)||n5e()}function n5e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r5e(e,n){if(e){if(typeof e=="string")return xK(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xK(e,n)}}function xK(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function i5e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function a5e(e){if(Array.isArray(e))return e}function s5e(e,n){if(e==null)return{};var a=o5e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function o5e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function c5e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function l5e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,QZ(o.key),o)}}function d5e(e,n,a){return n&&l5e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function u5e(e,n,a){return n=Mw(n),h5e(e,XZ()?Reflect.construct(n,a||[],Mw(e).constructor):n.apply(e,a))}function h5e(e,n){if(n&&(dm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return p5e(e)}function p5e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function XZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(XZ=function(){return!!e})()}function Mw(e){return Mw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Mw(e)}function f5e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&eD(e,n)}function eD(e,n){return eD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},eD(e,n)}function JZ(e,n,a){return n=QZ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function QZ(e){var n=m5e(e,"string");return dm(n)=="symbol"?n:n+""}function m5e(e,n){if(dm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(dm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var I_=function(e){function n(){return c5e(this,n),u5e(this,n,arguments)}return f5e(n,e),d5e(n,[{key:"render",value:function(){var o=this.props,l=o.offset,p=o.layout,m=o.width,y=o.dataKey,E=o.data,b=o.dataPointFormatter,T=o.xAxis,x=o.yAxis,A=s5e(o,e5e),D=un(A,!1);this.props.direction==="x"&&T.type!=="number"&&Oh();var N=E.map(function(L){var P=b(L,y),U=P.x,V=P.y,F=P.value,H=P.errorVal;if(!H)return null;var B=[],z,Y;if(Array.isArray(H)){var Q=t5e(H,2);z=Q[0],Y=Q[1]}else z=Y=H;if(p==="vertical"){var re=T.scale,de=V+l,le=de+m,he=de-m,Re=re(F-z),ve=re(F+Y);B.push({x1:ve,y1:le,x2:ve,y2:he}),B.push({x1:Re,y1:de,x2:ve,y2:de}),B.push({x1:Re,y1:le,x2:Re,y2:he})}else if(p==="horizontal"){var we=x.scale,ue=U+l,be=ue-m,ae=ue+m,ce=we(F-z),Se=we(F+Y);B.push({x1:be,y1:Se,x2:ae,y2:Se}),B.push({x1:ue,y1:ce,x2:ue,y2:Se}),B.push({x1:be,y1:ce,x2:ae,y2:ce})}return me.createElement(cr,jw({className:"recharts-errorBar",key:"bar-".concat(B.map(function(je){return"".concat(je.x1,"-").concat(je.x2,"-").concat(je.y1,"-").concat(je.y2)}))},D),B.map(function(je){return me.createElement("line",jw({},je,{key:"line-".concat(je.x1,"-").concat(je.x2,"-").concat(je.y1,"-").concat(je.y2)}))}))});return me.createElement(cr,{className:"recharts-errorBars"},N)}}])}(me.Component);JZ(I_,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});JZ(I_,"displayName","ErrorBar");function $y(e){"@babel/helpers - typeof";return $y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$y(e)}function TK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Yu(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?TK(Object(a),!0).forEach(function(o){g5e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):TK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function g5e(e,n,a){return n=v5e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function v5e(e){var n=y5e(e,"string");return $y(n)=="symbol"?n:n+""}function y5e(e,n){if($y(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if($y(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var ZZ=function(n){var a=n.children,o=n.formattedGraphicalItems,l=n.legendWidth,p=n.legendContent,m=ds(a,Bf);if(!m)return null;var y=Bf.defaultProps,E=y!==void 0?Yu(Yu({},y),m.props):{},b;return m.props&&m.props.payload?b=m.props&&m.props.payload:p==="children"?b=(o||[]).reduce(function(T,x){var A=x.item,D=x.props,N=D.sectors||D.data||[];return T.concat(N.map(function(L){return{type:m.props.iconType||A.props.legendType,value:L.name,color:L.fill,payload:L}}))},[]):b=(o||[]).map(function(T){var x=T.item,A=x.type.defaultProps,D=A!==void 0?Yu(Yu({},A),x.props):{},N=D.dataKey,L=D.name,P=D.legendType,U=D.hide;return{inactive:U,dataKey:N,type:E.iconType||P||"square",color:X2(x),value:L||N,payload:D}}),Yu(Yu(Yu({},E),Bf.getWithHeight(m,l)),{},{payload:b,item:m})};function Hy(e){"@babel/helpers - typeof";return Hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Hy(e)}function CK(e){return S5e(e)||b5e(e)||E5e(e)||_5e()}function _5e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E5e(e,n){if(e){if(typeof e=="string")return tD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return tD(e,n)}}function b5e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function S5e(e){if(Array.isArray(e))return tD(e)}function tD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function RK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Gr(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?RK(Object(a),!0).forEach(function(o){Gf(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):RK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Gf(e,n,a){return n=w5e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function w5e(e){var n=x5e(e,"string");return Hy(n)=="symbol"?n:n+""}function x5e(e,n){if(Hy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Hy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function ya(e,n,a){return pn(e)||pn(n)?a:pi(n)?Js(e,n,a):sn(n)?n(e):a}function oy(e,n,a,o){var l=bFe(e,function(y){return ya(y,n)});if(a==="number"){var p=l.filter(function(y){return nt(y)||parseFloat(y)});return p.length?[vT(p),Td(p)]:[1/0,-1/0]}var m=o?l.filter(function(y){return!pn(y)}):l;return m.map(function(y){return pi(y)||y instanceof Date?y:""})}var T5e=function(n){var a,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],l=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0,m=-1,y=(a=o==null?void 0:o.length)!==null&&a!==void 0?a:0;if(y<=1)return 0;if(p&&p.axisType==="angleAxis"&&Math.abs(Math.abs(p.range[1]-p.range[0])-360)<=1e-6)for(var E=p.range,b=0;b<y;b++){var T=b>0?l[b-1].coordinate:l[y-1].coordinate,x=l[b].coordinate,A=b>=y-1?l[0].coordinate:l[b+1].coordinate,D=void 0;if(Go(x-T)!==Go(A-x)){var N=[];if(Go(A-x)===Go(E[1]-E[0])){D=A;var L=x+E[1]-E[0];N[0]=Math.min(L,(L+T)/2),N[1]=Math.max(L,(L+T)/2)}else{D=T;var P=A+E[1]-E[0];N[0]=Math.min(x,(P+x)/2),N[1]=Math.max(x,(P+x)/2)}var U=[Math.min(x,(D+x)/2),Math.max(x,(D+x)/2)];if(n>U[0]&&n<=U[1]||n>=N[0]&&n<=N[1]){m=l[b].index;break}}else{var V=Math.min(T,A),F=Math.max(T,A);if(n>(V+x)/2&&n<=(F+x)/2){m=l[b].index;break}}}else for(var H=0;H<y;H++)if(H===0&&n<=(o[H].coordinate+o[H+1].coordinate)/2||H>0&&H<y-1&&n>(o[H].coordinate+o[H-1].coordinate)/2&&n<=(o[H].coordinate+o[H+1].coordinate)/2||H===y-1&&n>(o[H].coordinate+o[H-1].coordinate)/2){m=o[H].index;break}return m},X2=function(n){var a,o=n,l=o.type.displayName,p=(a=n.type)!==null&&a!==void 0&&a.defaultProps?Gr(Gr({},n.type.defaultProps),n.props):n.props,m=p.stroke,y=p.fill,E;switch(l){case"Line":E=m;break;case"Area":case"Radar":E=m&&m!=="none"?m:y;break;default:E=y;break}return E},C5e=function(n){var a=n.barSize,o=n.totalSize,l=n.stackGroups,p=l===void 0?{}:l;if(!p)return{};for(var m={},y=Object.keys(p),E=0,b=y.length;E<b;E++)for(var T=p[y[E]].stackGroups,x=Object.keys(T),A=0,D=x.length;A<D;A++){var N=T[x[A]],L=N.items,P=N.cateAxisId,U=L.filter(function(Y){return hl(Y.type).indexOf("Bar")>=0});if(U&&U.length){var V=U[0].type.defaultProps,F=V!==void 0?Gr(Gr({},V),U[0].props):U[0].props,H=F.barSize,B=F[P];m[B]||(m[B]=[]);var z=pn(H)?a:H;m[B].push({item:U[0],stackList:U.slice(1),barSize:pn(z)?void 0:Ah(z,o,0)})}}return m},R5e=function(n){var a=n.barGap,o=n.barCategoryGap,l=n.bandSize,p=n.sizeList,m=p===void 0?[]:p,y=n.maxBarSize,E=m.length;if(E<1)return null;var b=Ah(a,l,0,!0),T,x=[];if(m[0].barSize===+m[0].barSize){var A=!1,D=l/E,N=m.reduce(function(H,B){return H+B.barSize||0},0);N+=(E-1)*b,N>=l&&(N-=(E-1)*b,b=0),N>=l&&D>0&&(A=!0,D*=.9,N=E*D);var L=(l-N)/2>>0,P={offset:L-b,size:0};T=m.reduce(function(H,B){var z={item:B.item,position:{offset:P.offset+P.size+b,size:A?D:B.barSize}},Y=[].concat(CK(H),[z]);return P=Y[Y.length-1].position,B.stackList&&B.stackList.length&&B.stackList.forEach(function(Q){Y.push({item:Q,position:P})}),Y},x)}else{var U=Ah(o,l,0,!0);l-2*U-(E-1)*b<=0&&(b=0);var V=(l-2*U-(E-1)*b)/E;V>1&&(V>>=0);var F=y===+y?Math.min(V,y):V;T=m.reduce(function(H,B,z){var Y=[].concat(CK(H),[{item:B.item,position:{offset:U+(V+b)*z+(V-F)/2,size:F}}]);return B.stackList&&B.stackList.length&&B.stackList.forEach(function(Q){Y.push({item:Q,position:Y[Y.length-1].position})}),Y},x)}return T},A5e=function(n,a,o,l){var p=o.children,m=o.width,y=o.margin,E=m-(y.left||0)-(y.right||0),b=ZZ({children:p,legendWidth:E});if(b){var T=l||{},x=T.width,A=T.height,D=b.align,N=b.verticalAlign,L=b.layout;if((L==="vertical"||L==="horizontal"&&N==="middle")&&D!=="center"&&nt(n[D]))return Gr(Gr({},n),{},Gf({},D,n[D]+(x||0)));if((L==="horizontal"||L==="vertical"&&D==="center")&&N!=="middle"&&nt(n[N]))return Gr(Gr({},n),{},Gf({},N,n[N]+(A||0)))}return n},N5e=function(n,a,o){return pn(a)?!0:n==="horizontal"?a==="yAxis":n==="vertical"||o==="x"?a==="xAxis":o==="y"?a==="yAxis":!0},eee=function(n,a,o,l,p){var m=a.props.children,y=Qs(m,I_).filter(function(b){return N5e(l,p,b.props.direction)});if(y&&y.length){var E=y.map(function(b){return b.props.dataKey});return n.reduce(function(b,T){var x=ya(T,o);if(pn(x))return b;var A=Array.isArray(x)?[vT(x),Td(x)]:[x,x],D=E.reduce(function(N,L){var P=ya(T,L,0),U=A[0]-Math.abs(Array.isArray(P)?P[0]:P),V=A[1]+Math.abs(Array.isArray(P)?P[1]:P);return[Math.min(U,N[0]),Math.max(V,N[1])]},[1/0,-1/0]);return[Math.min(D[0],b[0]),Math.max(D[1],b[1])]},[1/0,-1/0])}return null},O5e=function(n,a,o,l,p){var m=a.map(function(y){return eee(n,y,o,p,l)}).filter(function(y){return!pn(y)});return m&&m.length?m.reduce(function(y,E){return[Math.min(y[0],E[0]),Math.max(y[1],E[1])]},[1/0,-1/0]):null},tee=function(n,a,o,l,p){var m=a.map(function(E){var b=E.props.dataKey;return o==="number"&&b&&eee(n,E,b,l)||oy(n,b,o,p)});if(o==="number")return m.reduce(function(E,b){return[Math.min(E[0],b[0]),Math.max(E[1],b[1])]},[1/0,-1/0]);var y={};return m.reduce(function(E,b){for(var T=0,x=b.length;T<x;T++)y[b[T]]||(y[b[T]]=!0,E.push(b[T]));return E},[])},nee=function(n,a){return n==="horizontal"&&a==="xAxis"||n==="vertical"&&a==="yAxis"||n==="centric"&&a==="angleAxis"||n==="radial"&&a==="radiusAxis"},ree=function(n,a,o,l){if(l)return n.map(function(E){return E.coordinate});var p,m,y=n.map(function(E){return E.coordinate===a&&(p=!0),E.coordinate===o&&(m=!0),E.coordinate});return p||y.push(a),m||y.push(o),y},dl=function(n,a,o){if(!n)return null;var l=n.scale,p=n.duplicateDomain,m=n.type,y=n.range,E=n.realScaleType==="scaleBand"?l.bandwidth()/2:2,b=(a||o)&&m==="category"&&l.bandwidth?l.bandwidth()/E:0;if(b=n.axisType==="angleAxis"&&(y==null?void 0:y.length)>=2?Go(y[0]-y[1])*2*b:b,a&&(n.ticks||n.niceTicks)){var T=(n.ticks||n.niceTicks).map(function(x){var A=p?p.indexOf(x):x;return{coordinate:l(A)+b,value:x,offset:b}});return T.filter(function(x){return!Vm(x.coordinate)})}return n.isCategorical&&n.categoricalDomain?n.categoricalDomain.map(function(x,A){return{coordinate:l(x)+b,value:x,index:A,offset:b}}):l.ticks&&!o?l.ticks(n.tickCount).map(function(x){return{coordinate:l(x)+b,value:x,offset:b}}):l.domain().map(function(x,A){return{coordinate:l(x)+b,value:p?p[x]:x,index:A,offset:b}})},KI=new WeakMap,sS=function(n,a){if(typeof a!="function")return n;KI.has(n)||KI.set(n,new WeakMap);var o=KI.get(n);if(o.has(a))return o.get(a);var l=function(){n.apply(void 0,arguments),a.apply(void 0,arguments)};return o.set(a,l),l},I5e=function(n,a,o){var l=n.scale,p=n.type,m=n.layout,y=n.axisType;if(l==="auto")return m==="radial"&&y==="radiusAxis"?{scale:My(),realScaleType:"band"}:m==="radial"&&y==="angleAxis"?{scale:Iw(),realScaleType:"linear"}:p==="category"&&a&&(a.indexOf("LineChart")>=0||a.indexOf("AreaChart")>=0||a.indexOf("ComposedChart")>=0&&!o)?{scale:sy(),realScaleType:"point"}:p==="category"?{scale:My(),realScaleType:"band"}:{scale:Iw(),realScaleType:"linear"};if(Rh(l)){var E="scale".concat(iT(l));return{scale:(EK[E]||sy)(),realScaleType:EK[E]?E:"point"}}return sn(l)?{scale:l}:{scale:sy(),realScaleType:"point"}},AK=1e-4,P5e=function(n){var a=n.domain();if(!(!a||a.length<=2)){var o=a.length,l=n.range(),p=Math.min(l[0],l[1])-AK,m=Math.max(l[0],l[1])+AK,y=n(a[0]),E=n(a[o-1]);(y<p||y>m||E<p||E>m)&&n.domain([a[0],a[o-1]])}},D5e=function(n,a){if(!n)return null;for(var o=0,l=n.length;o<l;o++)if(n[o].item===a)return n[o].position;return null},k5e=function(n,a){if(!a||a.length!==2||!nt(a[0])||!nt(a[1]))return n;var o=Math.min(a[0],a[1]),l=Math.max(a[0],a[1]),p=[n[0],n[1]];return(!nt(n[0])||n[0]<o)&&(p[0]=o),(!nt(n[1])||n[1]>l)&&(p[1]=l),p[0]>l&&(p[0]=l),p[1]<o&&(p[1]=o),p},L5e=function(n){var a=n.length;if(!(a<=0))for(var o=0,l=n[0].length;o<l;++o)for(var p=0,m=0,y=0;y<a;++y){var E=Vm(n[y][o][1])?n[y][o][0]:n[y][o][1];E>=0?(n[y][o][0]=p,n[y][o][1]=p+E,p=n[y][o][1]):(n[y][o][0]=m,n[y][o][1]=m+E,m=n[y][o][1])}},j5e=function(n){var a=n.length;if(!(a<=0))for(var o=0,l=n[0].length;o<l;++o)for(var p=0,m=0;m<a;++m){var y=Vm(n[m][o][1])?n[m][o][0]:n[m][o][1];y>=0?(n[m][o][0]=p,n[m][o][1]=p+y,p=n[m][o][1]):(n[m][o][0]=0,n[m][o][1]=0)}},M5e={sign:L5e,expand:QOe,none:tm,silhouette:ZOe,wiggle:eIe,positive:j5e},U5e=function(n,a,o){var l=a.map(function(y){return y.props.dataKey}),p=M5e[o],m=JOe().keys(l).value(function(y,E){return+ya(y,E,0)}).order(CP).offset(p);return m(n)},V5e=function(n,a,o,l,p,m){if(!n)return null;var y=m?a.reverse():a,E={},b=y.reduce(function(x,A){var D,N=(D=A.type)!==null&&D!==void 0&&D.defaultProps?Gr(Gr({},A.type.defaultProps),A.props):A.props,L=N.stackId,P=N.hide;if(P)return x;var U=N[o],V=x[U]||{hasStack:!1,stackGroups:{}};if(pi(L)){var F=V.stackGroups[L]||{numericAxisId:o,cateAxisId:l,items:[]};F.items.push(A),V.hasStack=!0,V.stackGroups[L]=F}else V.stackGroups[Fm("_stackId_")]={numericAxisId:o,cateAxisId:l,items:[A]};return Gr(Gr({},x),{},Gf({},U,V))},E),T={};return Object.keys(b).reduce(function(x,A){var D=b[A];if(D.hasStack){var N={};D.stackGroups=Object.keys(D.stackGroups).reduce(function(L,P){var U=D.stackGroups[P];return Gr(Gr({},L),{},Gf({},P,{numericAxisId:o,cateAxisId:l,items:U.items,stackedData:U5e(n,U.items,p)}))},N)}return Gr(Gr({},x),{},Gf({},A,D))},T)},F5e=function(n,a){var o=a.realScaleType,l=a.type,p=a.tickCount,m=a.originalDomain,y=a.allowDecimals,E=o||a.scale;if(E!=="auto"&&E!=="linear")return null;if(p&&l==="number"&&m&&(m[0]==="auto"||m[1]==="auto")){var b=n.domain();if(!b.length)return null;var T=JFe(b,p,y);return n.domain([vT(T),Td(T)]),{niceTicks:T}}if(p&&l==="number"){var x=n.domain(),A=QFe(x,p,y);return{niceTicks:A}}return null};function Uw(e){var n=e.axis,a=e.ticks,o=e.bandSize,l=e.entry,p=e.index,m=e.dataKey;if(n.type==="category"){if(!n.allowDuplicatedCategory&&n.dataKey&&!pn(l[n.dataKey])){var y=ow(a,"value",l[n.dataKey]);if(y)return y.coordinate+o/2}return a[p]?a[p].coordinate+o/2:null}var E=ya(l,pn(m)?n.dataKey:m);return pn(E)?null:n.scale(E)}var NK=function(n){var a=n.axis,o=n.ticks,l=n.offset,p=n.bandSize,m=n.entry,y=n.index;if(a.type==="category")return o[y]?o[y].coordinate+l:null;var E=ya(m,a.dataKey,a.domain[y]);return pn(E)?null:a.scale(E)-p/2+l},B5e=function(n){var a=n.numericAxis,o=a.scale.domain();if(a.type==="number"){var l=Math.min(o[0],o[1]),p=Math.max(o[0],o[1]);return l<=0&&p>=0?0:p<0?p:l}return o[0]},W5e=function(n,a){var o,l=(o=n.type)!==null&&o!==void 0&&o.defaultProps?Gr(Gr({},n.type.defaultProps),n.props):n.props,p=l.stackId;if(pi(p)){var m=a[p];if(m){var y=m.items.indexOf(n);return y>=0?m.stackedData[y]:null}}return null},G5e=function(n){return n.reduce(function(a,o){return[vT(o.concat([a[0]]).filter(nt)),Td(o.concat([a[1]]).filter(nt))]},[1/0,-1/0])},iee=function(n,a,o){return Object.keys(n).reduce(function(l,p){var m=n[p],y=m.stackedData,E=y.reduce(function(b,T){var x=G5e(T.slice(a,o+1));return[Math.min(b[0],x[0]),Math.max(b[1],x[1])]},[1/0,-1/0]);return[Math.min(E[0],l[0]),Math.max(E[1],l[1])]},[1/0,-1/0]).map(function(l){return l===1/0||l===-1/0?0:l})},OK=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,IK=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,nD=function(n,a,o){if(sn(n))return n(a,o);if(!Array.isArray(n))return a;var l=[];if(nt(n[0]))l[0]=o?n[0]:Math.min(n[0],a[0]);else if(OK.test(n[0])){var p=+OK.exec(n[0])[1];l[0]=a[0]-p}else sn(n[0])?l[0]=n[0](a[0]):l[0]=a[0];if(nt(n[1]))l[1]=o?n[1]:Math.max(n[1],a[1]);else if(IK.test(n[1])){var m=+IK.exec(n[1])[1];l[1]=a[1]+m}else sn(n[1])?l[1]=n[1](a[1]):l[1]=a[1];return l},Vw=function(n,a,o){if(n&&n.scale&&n.scale.bandwidth){var l=n.scale.bandwidth();if(!o||l>0)return l}if(n&&a&&a.length>=2){for(var p=x2(a,function(x){return x.coordinate}),m=1/0,y=1,E=p.length;y<E;y++){var b=p[y],T=p[y-1];m=Math.min((b.coordinate||0)-(T.coordinate||0),m)}return m===1/0?0:m}return o?void 0:0},PK=function(n,a,o){return!n||!n.length||lm(n,Js(o,"type.defaultProps.domain"))?a:n},aee=function(n,a){var o=n.type.defaultProps?Gr(Gr({},n.type.defaultProps),n.props):n.props,l=o.dataKey,p=o.name,m=o.unit,y=o.formatter,E=o.tooltipType,b=o.chartType,T=o.hide;return Gr(Gr({},un(n,!1)),{},{dataKey:l,unit:m,formatter:y,name:p||l,color:X2(n),value:ya(a,l),type:E,payload:a,chartType:b,hide:T})};function zy(e){"@babel/helpers - typeof";return zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zy(e)}function DK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function kK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?DK(Object(a),!0).forEach(function(o){$5e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):DK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function $5e(e,n,a){return n=H5e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function H5e(e){var n=z5e(e,"string");return zy(n)=="symbol"?n:n+""}function z5e(e,n){if(zy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(zy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Fw=Math.PI/180,K5e=function(n){return n*180/Math.PI},Fi=function(n,a,o,l){return{x:n+Math.cos(-Fw*l)*o,y:a+Math.sin(-Fw*l)*o}},Y5e=function(n,a){var o=n.x,l=n.y,p=a.x,m=a.y;return Math.sqrt(Math.pow(o-p,2)+Math.pow(l-m,2))},q5e=function(n,a){var o=n.x,l=n.y,p=a.cx,m=a.cy,y=Y5e({x:o,y:l},{x:p,y:m});if(y<=0)return{radius:y};var E=(o-p)/y,b=Math.acos(E);return l>m&&(b=2*Math.PI-b),{radius:y,angle:K5e(b),angleInRadian:b}},X5e=function(n){var a=n.startAngle,o=n.endAngle,l=Math.floor(a/360),p=Math.floor(o/360),m=Math.min(l,p);return{startAngle:a-m*360,endAngle:o-m*360}},J5e=function(n,a){var o=a.startAngle,l=a.endAngle,p=Math.floor(o/360),m=Math.floor(l/360),y=Math.min(p,m);return n+y*360},LK=function(n,a){var o=n.x,l=n.y,p=q5e({x:o,y:l},a),m=p.radius,y=p.angle,E=a.innerRadius,b=a.outerRadius;if(m<E||m>b)return!1;if(m===0)return!0;var T=X5e(a),x=T.startAngle,A=T.endAngle,D=y,N;if(x<=A){for(;D>A;)D-=360;for(;D<x;)D+=360;N=D>=x&&D<=A}else{for(;D>x;)D-=360;for(;D<A;)D+=360;N=D>=A&&D<=x}return N?kK(kK({},a),{},{radius:m,angle:J5e(D,a)}):null};function Ky(e){"@babel/helpers - typeof";return Ky=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ky(e)}var Q5e=["offset"];function Z5e(e){return r3e(e)||n3e(e)||t3e(e)||e3e()}function e3e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t3e(e,n){if(e){if(typeof e=="string")return rD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return rD(e,n)}}function n3e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function r3e(e){if(Array.isArray(e))return rD(e)}function rD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function i3e(e,n){if(e==null)return{};var a=a3e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function a3e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function jK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function ci(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?jK(Object(a),!0).forEach(function(o){s3e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):jK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function s3e(e,n,a){return n=o3e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o3e(e){var n=c3e(e,"string");return Ky(n)=="symbol"?n:n+""}function c3e(e,n){if(Ky(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Ky(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Yy(){return Yy=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Yy.apply(this,arguments)}var l3e=function(n){var a=n.value,o=n.formatter,l=pn(n.children)?a:n.children;return sn(o)?o(l):l},d3e=function(n,a){var o=Go(a-n),l=Math.min(Math.abs(a-n),360);return o*l},u3e=function(n,a,o){var l=n.position,p=n.viewBox,m=n.offset,y=n.className,E=p,b=E.cx,T=E.cy,x=E.innerRadius,A=E.outerRadius,D=E.startAngle,N=E.endAngle,L=E.clockWise,P=(x+A)/2,U=d3e(D,N),V=U>=0?1:-1,F,H;l==="insideStart"?(F=D+V*m,H=L):l==="insideEnd"?(F=N-V*m,H=!L):l==="end"&&(F=N+V*m,H=L),H=U<=0?H:!H;var B=Fi(b,T,P,F),z=Fi(b,T,P,F+(H?1:-1)*359),Y="M".concat(B.x,",").concat(B.y,`
    A`).concat(P,",").concat(P,",0,1,").concat(H?0:1,`,
    `).concat(z.x,",").concat(z.y),Q=pn(n.id)?Fm("recharts-radial-line-"):n.id;return me.createElement("text",Yy({},o,{dominantBaseline:"central",className:Cn("recharts-radial-bar-label",y)}),me.createElement("defs",null,me.createElement("path",{id:Q,d:Y})),me.createElement("textPath",{xlinkHref:"#".concat(Q)},a))},h3e=function(n){var a=n.viewBox,o=n.offset,l=n.position,p=a,m=p.cx,y=p.cy,E=p.innerRadius,b=p.outerRadius,T=p.startAngle,x=p.endAngle,A=(T+x)/2;if(l==="outside"){var D=Fi(m,y,b+o,A),N=D.x,L=D.y;return{x:N,y:L,textAnchor:N>=m?"start":"end",verticalAnchor:"middle"}}if(l==="center")return{x:m,y,textAnchor:"middle",verticalAnchor:"middle"};if(l==="centerTop")return{x:m,y,textAnchor:"middle",verticalAnchor:"start"};if(l==="centerBottom")return{x:m,y,textAnchor:"middle",verticalAnchor:"end"};var P=(E+b)/2,U=Fi(m,y,P,A),V=U.x,F=U.y;return{x:V,y:F,textAnchor:"middle",verticalAnchor:"middle"}},p3e=function(n){var a=n.viewBox,o=n.parentViewBox,l=n.offset,p=n.position,m=a,y=m.x,E=m.y,b=m.width,T=m.height,x=T>=0?1:-1,A=x*l,D=x>0?"end":"start",N=x>0?"start":"end",L=b>=0?1:-1,P=L*l,U=L>0?"end":"start",V=L>0?"start":"end";if(p==="top"){var F={x:y+b/2,y:E-x*l,textAnchor:"middle",verticalAnchor:D};return ci(ci({},F),o?{height:Math.max(E-o.y,0),width:b}:{})}if(p==="bottom"){var H={x:y+b/2,y:E+T+A,textAnchor:"middle",verticalAnchor:N};return ci(ci({},H),o?{height:Math.max(o.y+o.height-(E+T),0),width:b}:{})}if(p==="left"){var B={x:y-P,y:E+T/2,textAnchor:U,verticalAnchor:"middle"};return ci(ci({},B),o?{width:Math.max(B.x-o.x,0),height:T}:{})}if(p==="right"){var z={x:y+b+P,y:E+T/2,textAnchor:V,verticalAnchor:"middle"};return ci(ci({},z),o?{width:Math.max(o.x+o.width-z.x,0),height:T}:{})}var Y=o?{width:b,height:T}:{};return p==="insideLeft"?ci({x:y+P,y:E+T/2,textAnchor:V,verticalAnchor:"middle"},Y):p==="insideRight"?ci({x:y+b-P,y:E+T/2,textAnchor:U,verticalAnchor:"middle"},Y):p==="insideTop"?ci({x:y+b/2,y:E+A,textAnchor:"middle",verticalAnchor:N},Y):p==="insideBottom"?ci({x:y+b/2,y:E+T-A,textAnchor:"middle",verticalAnchor:D},Y):p==="insideTopLeft"?ci({x:y+P,y:E+A,textAnchor:V,verticalAnchor:N},Y):p==="insideTopRight"?ci({x:y+b-P,y:E+A,textAnchor:U,verticalAnchor:N},Y):p==="insideBottomLeft"?ci({x:y+P,y:E+T-A,textAnchor:V,verticalAnchor:D},Y):p==="insideBottomRight"?ci({x:y+b-P,y:E+T-A,textAnchor:U,verticalAnchor:D},Y):Lm(p)&&(nt(p.x)||oh(p.x))&&(nt(p.y)||oh(p.y))?ci({x:y+Ah(p.x,b),y:E+Ah(p.y,T),textAnchor:"end",verticalAnchor:"end"},Y):ci({x:y+b/2,y:E+T/2,textAnchor:"middle",verticalAnchor:"middle"},Y)},f3e=function(n){return"cx"in n&&nt(n.cx)};function ta(e){var n=e.offset,a=n===void 0?5:n,o=i3e(e,Q5e),l=ci({offset:a},o),p=l.viewBox,m=l.position,y=l.value,E=l.children,b=l.content,T=l.className,x=T===void 0?"":T,A=l.textBreakAll;if(!p||pn(y)&&pn(E)&&!J.isValidElement(b)&&!sn(b))return null;if(J.isValidElement(b))return J.cloneElement(b,l);var D;if(sn(b)){if(D=J.createElement(b,l),J.isValidElement(D))return D}else D=l3e(l);var N=f3e(p),L=un(l,!0);if(N&&(m==="insideStart"||m==="insideEnd"||m==="end"))return u3e(l,D,L);var P=N?h3e(l):p3e(l);return me.createElement(xw,Yy({className:Cn("recharts-label",x)},L,P,{breakAll:A}),D)}ta.displayName="Label";var see=function(n){var a=n.cx,o=n.cy,l=n.angle,p=n.startAngle,m=n.endAngle,y=n.r,E=n.radius,b=n.innerRadius,T=n.outerRadius,x=n.x,A=n.y,D=n.top,N=n.left,L=n.width,P=n.height,U=n.clockWise,V=n.labelViewBox;if(V)return V;if(nt(L)&&nt(P)){if(nt(x)&&nt(A))return{x,y:A,width:L,height:P};if(nt(D)&&nt(N))return{x:D,y:N,width:L,height:P}}return nt(x)&&nt(A)?{x,y:A,width:0,height:0}:nt(a)&&nt(o)?{cx:a,cy:o,startAngle:p||l||0,endAngle:m||l||0,innerRadius:b||0,outerRadius:T||E||y||0,clockWise:U}:n.viewBox?n.viewBox:{}},m3e=function(n,a){return n?n===!0?me.createElement(ta,{key:"label-implicit",viewBox:a}):pi(n)?me.createElement(ta,{key:"label-implicit",viewBox:a,value:n}):J.isValidElement(n)?n.type===ta?J.cloneElement(n,{key:"label-implicit",viewBox:a}):me.createElement(ta,{key:"label-implicit",content:n,viewBox:a}):sn(n)?me.createElement(ta,{key:"label-implicit",content:n,viewBox:a}):Lm(n)?me.createElement(ta,Yy({viewBox:a},n,{key:"label-implicit"})):null:null},g3e=function(n,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!n||!n.children&&o&&!n.label)return null;var l=n.children,p=see(n),m=Qs(l,ta).map(function(E,b){return J.cloneElement(E,{viewBox:a||p,key:"label-".concat(b)})});if(!o)return m;var y=m3e(n.label,a||p);return[y].concat(Z5e(m))};ta.parseViewBox=see;ta.renderCallByParent=g3e;function v3e(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}var y3e=v3e;const _3e=Zn(y3e);function qy(e){"@babel/helpers - typeof";return qy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},qy(e)}var E3e=["valueAccessor"],b3e=["data","dataKey","clockWise","id","textBreakAll"];function S3e(e){return C3e(e)||T3e(e)||x3e(e)||w3e()}function w3e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x3e(e,n){if(e){if(typeof e=="string")return iD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return iD(e,n)}}function T3e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function C3e(e){if(Array.isArray(e))return iD(e)}function iD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function Bw(){return Bw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Bw.apply(this,arguments)}function MK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function UK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?MK(Object(a),!0).forEach(function(o){R3e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):MK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function R3e(e,n,a){return n=A3e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function A3e(e){var n=N3e(e,"string");return qy(n)=="symbol"?n:n+""}function N3e(e,n){if(qy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(qy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function VK(e,n){if(e==null)return{};var a=O3e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function O3e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var I3e=function(n){return Array.isArray(n.value)?_3e(n.value):n.value};function ml(e){var n=e.valueAccessor,a=n===void 0?I3e:n,o=VK(e,E3e),l=o.data,p=o.dataKey,m=o.clockWise,y=o.id,E=o.textBreakAll,b=VK(o,b3e);return!l||!l.length?null:me.createElement(cr,{className:"recharts-label-list"},l.map(function(T,x){var A=pn(p)?a(T,x):ya(T&&T.payload,p),D=pn(y)?{}:{id:"".concat(y,"-").concat(x)};return me.createElement(ta,Bw({},un(T,!0),b,D,{parentViewBox:T.parentViewBox,value:A,textBreakAll:E,viewBox:ta.parseViewBox(pn(m)?T:UK(UK({},T),{},{clockWise:m})),key:"label-".concat(x),index:x}))}))}ml.displayName="LabelList";function P3e(e,n){return e?e===!0?me.createElement(ml,{key:"labelList-implicit",data:n}):me.isValidElement(e)||sn(e)?me.createElement(ml,{key:"labelList-implicit",data:n,content:e}):Lm(e)?me.createElement(ml,Bw({data:n},e,{key:"labelList-implicit"})):null:null}function D3e(e,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&a&&!e.label)return null;var o=e.children,l=Qs(o,ml).map(function(m,y){return J.cloneElement(m,{data:n,key:"labelList-".concat(y)})});if(!a)return l;var p=P3e(e.label,n);return[p].concat(S3e(l))}ml.renderCallByParent=D3e;function Xy(e){"@babel/helpers - typeof";return Xy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Xy(e)}function aD(){return aD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},aD.apply(this,arguments)}function FK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function BK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?FK(Object(a),!0).forEach(function(o){k3e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):FK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function k3e(e,n,a){return n=L3e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function L3e(e){var n=j3e(e,"string");return Xy(n)=="symbol"?n:n+""}function j3e(e,n){if(Xy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Xy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var M3e=function(n,a){var o=Go(a-n),l=Math.min(Math.abs(a-n),359.999);return o*l},oS=function(n){var a=n.cx,o=n.cy,l=n.radius,p=n.angle,m=n.sign,y=n.isExternal,E=n.cornerRadius,b=n.cornerIsExternal,T=E*(y?1:-1)+l,x=Math.asin(E/T)/Fw,A=b?p:p+m*x,D=Fi(a,o,T,A),N=Fi(a,o,l,A),L=b?p-m*x:p,P=Fi(a,o,T*Math.cos(x*Fw),L);return{center:D,circleTangency:N,lineTangency:P,theta:x}},oee=function(n){var a=n.cx,o=n.cy,l=n.innerRadius,p=n.outerRadius,m=n.startAngle,y=n.endAngle,E=M3e(m,y),b=m+E,T=Fi(a,o,p,m),x=Fi(a,o,p,b),A="M ".concat(T.x,",").concat(T.y,`
    A `).concat(p,",").concat(p,`,0,
    `).concat(+(Math.abs(E)>180),",").concat(+(m>b),`,
    `).concat(x.x,",").concat(x.y,`
  `);if(l>0){var D=Fi(a,o,l,m),N=Fi(a,o,l,b);A+="L ".concat(N.x,",").concat(N.y,`
            A `).concat(l,",").concat(l,`,0,
            `).concat(+(Math.abs(E)>180),",").concat(+(m<=b),`,
            `).concat(D.x,",").concat(D.y," Z")}else A+="L ".concat(a,",").concat(o," Z");return A},U3e=function(n){var a=n.cx,o=n.cy,l=n.innerRadius,p=n.outerRadius,m=n.cornerRadius,y=n.forceCornerRadius,E=n.cornerIsExternal,b=n.startAngle,T=n.endAngle,x=Go(T-b),A=oS({cx:a,cy:o,radius:p,angle:b,sign:x,cornerRadius:m,cornerIsExternal:E}),D=A.circleTangency,N=A.lineTangency,L=A.theta,P=oS({cx:a,cy:o,radius:p,angle:T,sign:-x,cornerRadius:m,cornerIsExternal:E}),U=P.circleTangency,V=P.lineTangency,F=P.theta,H=E?Math.abs(b-T):Math.abs(b-T)-L-F;if(H<0)return y?"M ".concat(N.x,",").concat(N.y,`
        a`).concat(m,",").concat(m,",0,0,1,").concat(m*2,`,0
        a`).concat(m,",").concat(m,",0,0,1,").concat(-m*2,`,0
      `):oee({cx:a,cy:o,innerRadius:l,outerRadius:p,startAngle:b,endAngle:T});var B="M ".concat(N.x,",").concat(N.y,`
    A`).concat(m,",").concat(m,",0,0,").concat(+(x<0),",").concat(D.x,",").concat(D.y,`
    A`).concat(p,",").concat(p,",0,").concat(+(H>180),",").concat(+(x<0),",").concat(U.x,",").concat(U.y,`
    A`).concat(m,",").concat(m,",0,0,").concat(+(x<0),",").concat(V.x,",").concat(V.y,`
  `);if(l>0){var z=oS({cx:a,cy:o,radius:l,angle:b,sign:x,isExternal:!0,cornerRadius:m,cornerIsExternal:E}),Y=z.circleTangency,Q=z.lineTangency,re=z.theta,de=oS({cx:a,cy:o,radius:l,angle:T,sign:-x,isExternal:!0,cornerRadius:m,cornerIsExternal:E}),le=de.circleTangency,he=de.lineTangency,Re=de.theta,ve=E?Math.abs(b-T):Math.abs(b-T)-re-Re;if(ve<0&&m===0)return"".concat(B,"L").concat(a,",").concat(o,"Z");B+="L".concat(he.x,",").concat(he.y,`
      A`).concat(m,",").concat(m,",0,0,").concat(+(x<0),",").concat(le.x,",").concat(le.y,`
      A`).concat(l,",").concat(l,",0,").concat(+(ve>180),",").concat(+(x>0),",").concat(Y.x,",").concat(Y.y,`
      A`).concat(m,",").concat(m,",0,0,").concat(+(x<0),",").concat(Q.x,",").concat(Q.y,"Z")}else B+="L".concat(a,",").concat(o,"Z");return B},V3e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},cee=function(n){var a=BK(BK({},V3e),n),o=a.cx,l=a.cy,p=a.innerRadius,m=a.outerRadius,y=a.cornerRadius,E=a.forceCornerRadius,b=a.cornerIsExternal,T=a.startAngle,x=a.endAngle,A=a.className;if(m<p||T===x)return null;var D=Cn("recharts-sector",A),N=m-p,L=Ah(y,N,0,!0),P;return L>0&&Math.abs(T-x)<360?P=U3e({cx:o,cy:l,innerRadius:p,outerRadius:m,cornerRadius:Math.min(L,N/2),forceCornerRadius:E,cornerIsExternal:b,startAngle:T,endAngle:x}):P=oee({cx:o,cy:l,innerRadius:p,outerRadius:m,startAngle:T,endAngle:x}),me.createElement("path",aD({},un(a,!0),{className:D,d:P,role:"img"}))};function Jy(e){"@babel/helpers - typeof";return Jy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Jy(e)}function sD(){return sD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},sD.apply(this,arguments)}function WK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function GK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?WK(Object(a),!0).forEach(function(o){F3e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):WK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function F3e(e,n,a){return n=B3e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function B3e(e){var n=W3e(e,"string");return Jy(n)=="symbol"?n:n+""}function W3e(e,n){if(Jy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Jy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var $K={curveBasisClosed:FOe,curveBasisOpen:BOe,curveBasis:VOe,curveBumpX:TOe,curveBumpY:COe,curveLinearClosed:WOe,curveLinear:sT,curveMonotoneX:GOe,curveMonotoneY:$Oe,curveNatural:HOe,curveStep:zOe,curveStepAfter:YOe,curveStepBefore:KOe},cS=function(n){return n.x===+n.x&&n.y===+n.y},Vv=function(n){return n.x},Fv=function(n){return n.y},G3e=function(n,a){if(sn(n))return n;var o="curve".concat(iT(n));return(o==="curveMonotone"||o==="curveBump")&&a?$K["".concat(o).concat(a==="vertical"?"Y":"X")]:$K[o]||sT},$3e=function(n){var a=n.type,o=a===void 0?"linear":a,l=n.points,p=l===void 0?[]:l,m=n.baseLine,y=n.layout,E=n.connectNulls,b=E===void 0?!1:E,T=G3e(o,y),x=b?p.filter(function(L){return cS(L)}):p,A;if(Array.isArray(m)){var D=b?m.filter(function(L){return cS(L)}):m,N=x.map(function(L,P){return GK(GK({},L),{},{base:D[P]})});return y==="vertical"?A=Qb().y(Fv).x1(Vv).x0(function(L){return L.base.x}):A=Qb().x(Vv).y1(Fv).y0(function(L){return L.base.y}),A.defined(cS).curve(T),A(N)}return y==="vertical"&&nt(m)?A=Qb().y(Fv).x1(Vv).x0(m):nt(m)?A=Qb().x(Vv).y1(Fv).y0(m):A=cQ().x(Vv).y(Fv),A.defined(cS).curve(T),A(x)},$f=function(n){var a=n.className,o=n.points,l=n.path,p=n.pathRef;if((!o||!o.length)&&!l)return null;var m=o&&o.length?$3e(n):l;return J.createElement("path",sD({},un(n,!1),cw(n),{className:Cn("recharts-curve",a),d:m,ref:p}))},lee={exports:{}},H3e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",z3e=H3e,K3e=z3e;function dee(){}function uee(){}uee.resetWarningCache=dee;var Y3e=function(){function e(o,l,p,m,y,E){if(E!==K3e){var b=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw b.name="Invariant Violation",b}}e.isRequired=e;function n(){return e}var a={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:n,element:e,elementType:e,instanceOf:n,node:e,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:uee,resetWarningCache:dee};return a.PropTypes=a,a};lee.exports=Y3e();var q3e=lee.exports;const At=Zn(q3e);var X3e=Object.getOwnPropertyNames,J3e=Object.getOwnPropertySymbols,Q3e=Object.prototype.hasOwnProperty;function HK(e,n){return function(o,l,p){return e(o,l,p)&&n(o,l,p)}}function lS(e){return function(a,o,l){if(!a||!o||typeof a!="object"||typeof o!="object")return e(a,o,l);var p=l.cache,m=p.get(a),y=p.get(o);if(m&&y)return m===o&&y===a;p.set(a,o),p.set(o,a);var E=e(a,o,l);return p.delete(a),p.delete(o),E}}function Z3e(e){return e!=null?e[Symbol.toStringTag]:void 0}function zK(e){return X3e(e).concat(J3e(e))}var eBe=Object.hasOwn||function(e,n){return Q3e.call(e,n)};function Uh(e,n){return e===n||!e&&!n&&e!==e&&n!==n}var tBe="__v",nBe="__o",rBe="_owner",KK=Object.getOwnPropertyDescriptor,YK=Object.keys;function iBe(e,n,a){var o=e.length;if(n.length!==o)return!1;for(;o-- >0;)if(!a.equals(e[o],n[o],o,o,e,n,a))return!1;return!0}function aBe(e,n){return Uh(e.getTime(),n.getTime())}function sBe(e,n){return e.name===n.name&&e.message===n.message&&e.cause===n.cause&&e.stack===n.stack}function oBe(e,n){return e===n}function qK(e,n,a){var o=e.size;if(o!==n.size)return!1;if(!o)return!0;for(var l=new Array(o),p=e.entries(),m,y,E=0;(m=p.next())&&!m.done;){for(var b=n.entries(),T=!1,x=0;(y=b.next())&&!y.done;){if(l[x]){x++;continue}var A=m.value,D=y.value;if(a.equals(A[0],D[0],E,x,e,n,a)&&a.equals(A[1],D[1],A[0],D[0],e,n,a)){T=l[x]=!0;break}x++}if(!T)return!1;E++}return!0}var cBe=Uh;function lBe(e,n,a){var o=YK(e),l=o.length;if(YK(n).length!==l)return!1;for(;l-- >0;)if(!hee(e,n,a,o[l]))return!1;return!0}function Bv(e,n,a){var o=zK(e),l=o.length;if(zK(n).length!==l)return!1;for(var p,m,y;l-- >0;)if(p=o[l],!hee(e,n,a,p)||(m=KK(e,p),y=KK(n,p),(m||y)&&(!m||!y||m.configurable!==y.configurable||m.enumerable!==y.enumerable||m.writable!==y.writable)))return!1;return!0}function dBe(e,n){return Uh(e.valueOf(),n.valueOf())}function uBe(e,n){return e.source===n.source&&e.flags===n.flags}function XK(e,n,a){var o=e.size;if(o!==n.size)return!1;if(!o)return!0;for(var l=new Array(o),p=e.values(),m,y;(m=p.next())&&!m.done;){for(var E=n.values(),b=!1,T=0;(y=E.next())&&!y.done;){if(!l[T]&&a.equals(m.value,y.value,m.value,y.value,e,n,a)){b=l[T]=!0;break}T++}if(!b)return!1}return!0}function hBe(e,n){var a=e.length;if(n.length!==a)return!1;for(;a-- >0;)if(e[a]!==n[a])return!1;return!0}function pBe(e,n){return e.hostname===n.hostname&&e.pathname===n.pathname&&e.protocol===n.protocol&&e.port===n.port&&e.hash===n.hash&&e.username===n.username&&e.password===n.password}function hee(e,n,a,o){return(o===rBe||o===nBe||o===tBe)&&(e.$$typeof||n.$$typeof)?!0:eBe(n,o)&&a.equals(e[o],n[o],o,o,e,n,a)}var fBe="[object Arguments]",mBe="[object Boolean]",gBe="[object Date]",vBe="[object Error]",yBe="[object Map]",_Be="[object Number]",EBe="[object Object]",bBe="[object RegExp]",SBe="[object Set]",wBe="[object String]",xBe="[object URL]",TBe=Array.isArray,JK=typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView:null,QK=Object.assign,CBe=Object.prototype.toString.call.bind(Object.prototype.toString);function RBe(e){var n=e.areArraysEqual,a=e.areDatesEqual,o=e.areErrorsEqual,l=e.areFunctionsEqual,p=e.areMapsEqual,m=e.areNumbersEqual,y=e.areObjectsEqual,E=e.arePrimitiveWrappersEqual,b=e.areRegExpsEqual,T=e.areSetsEqual,x=e.areTypedArraysEqual,A=e.areUrlsEqual,D=e.unknownTagComparators;return function(L,P,U){if(L===P)return!0;if(L==null||P==null)return!1;var V=typeof L;if(V!==typeof P)return!1;if(V!=="object")return V==="number"?m(L,P,U):V==="function"?l(L,P,U):!1;var F=L.constructor;if(F!==P.constructor)return!1;if(F===Object)return y(L,P,U);if(TBe(L))return n(L,P,U);if(JK!=null&&JK(L))return x(L,P,U);if(F===Date)return a(L,P,U);if(F===RegExp)return b(L,P,U);if(F===Map)return p(L,P,U);if(F===Set)return T(L,P,U);var H=CBe(L);if(H===gBe)return a(L,P,U);if(H===bBe)return b(L,P,U);if(H===yBe)return p(L,P,U);if(H===SBe)return T(L,P,U);if(H===EBe)return typeof L.then!="function"&&typeof P.then!="function"&&y(L,P,U);if(H===xBe)return A(L,P,U);if(H===vBe)return o(L,P,U);if(H===fBe)return y(L,P,U);if(H===mBe||H===_Be||H===wBe)return E(L,P,U);if(D){var B=D[H];if(!B){var z=Z3e(L);z&&(B=D[z])}if(B)return B(L,P,U)}return!1}}function ABe(e){var n=e.circular,a=e.createCustomConfig,o=e.strict,l={areArraysEqual:o?Bv:iBe,areDatesEqual:aBe,areErrorsEqual:sBe,areFunctionsEqual:oBe,areMapsEqual:o?HK(qK,Bv):qK,areNumbersEqual:cBe,areObjectsEqual:o?Bv:lBe,arePrimitiveWrappersEqual:dBe,areRegExpsEqual:uBe,areSetsEqual:o?HK(XK,Bv):XK,areTypedArraysEqual:o?Bv:hBe,areUrlsEqual:pBe,unknownTagComparators:void 0};if(a&&(l=QK({},l,a(l))),n){var p=lS(l.areArraysEqual),m=lS(l.areMapsEqual),y=lS(l.areObjectsEqual),E=lS(l.areSetsEqual);l=QK({},l,{areArraysEqual:p,areMapsEqual:m,areObjectsEqual:y,areSetsEqual:E})}return l}function NBe(e){return function(n,a,o,l,p,m,y){return e(n,a,y)}}function OBe(e){var n=e.circular,a=e.comparator,o=e.createState,l=e.equals,p=e.strict;if(o)return function(E,b){var T=o(),x=T.cache,A=x===void 0?n?new WeakMap:void 0:x,D=T.meta;return a(E,b,{cache:A,equals:l,meta:D,strict:p})};if(n)return function(E,b){return a(E,b,{cache:new WeakMap,equals:l,meta:void 0,strict:p})};var m={cache:void 0,equals:l,meta:void 0,strict:p};return function(E,b){return a(E,b,m)}}var IBe=Qd();Qd({strict:!0});Qd({circular:!0});Qd({circular:!0,strict:!0});Qd({createInternalComparator:function(){return Uh}});Qd({strict:!0,createInternalComparator:function(){return Uh}});Qd({circular:!0,createInternalComparator:function(){return Uh}});Qd({circular:!0,createInternalComparator:function(){return Uh},strict:!0});function Qd(e){e===void 0&&(e={});var n=e.circular,a=n===void 0?!1:n,o=e.createInternalComparator,l=e.createState,p=e.strict,m=p===void 0?!1:p,y=ABe(e),E=RBe(y),b=o?o(E):NBe(E);return OBe({circular:a,comparator:E,createState:l,equals:b,strict:m})}function PBe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function ZK(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=-1,o=function l(p){a<0&&(a=p),p-a>n?(e(p),a=-1):PBe(l)};requestAnimationFrame(o)}function oD(e){"@babel/helpers - typeof";return oD=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},oD(e)}function DBe(e){return MBe(e)||jBe(e)||LBe(e)||kBe()}function kBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LBe(e,n){if(e){if(typeof e=="string")return e9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e9(e,n)}}function e9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function jBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function MBe(e){if(Array.isArray(e))return e}function UBe(){var e={},n=function(){return null},a=!1,o=function l(p){if(!a){if(Array.isArray(p)){if(!p.length)return;var m=p,y=DBe(m),E=y[0],b=y.slice(1);if(typeof E=="number"){ZK(l.bind(null,b),E);return}l(E),ZK(l.bind(null,b));return}oD(p)==="object"&&(e=p,n(e)),typeof p=="function"&&p()}};return{stop:function(){a=!0},start:function(p){a=!1,o(p)},subscribe:function(p){return n=p,function(){n=function(){return null}}}}}function Qy(e){"@babel/helpers - typeof";return Qy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Qy(e)}function t9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function n9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?t9(Object(a),!0).forEach(function(o){pee(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function pee(e,n,a){return n=VBe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function VBe(e){var n=FBe(e,"string");return Qy(n)==="symbol"?n:String(n)}function FBe(e,n){if(Qy(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Qy(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var BBe=function(n,a){return[Object.keys(n),Object.keys(a)].reduce(function(o,l){return o.filter(function(p){return l.includes(p)})})},WBe=function(n){return n},GBe=function(n){return n.replace(/([A-Z])/g,function(a){return"-".concat(a.toLowerCase())})},cy=function(n,a){return Object.keys(a).reduce(function(o,l){return n9(n9({},o),{},pee({},l,n(l,a[l])))},{})},r9=function(n,a,o){return n.map(function(l){return"".concat(GBe(l)," ").concat(a,"ms ").concat(o)}).join(",")};function $Be(e,n){return KBe(e)||zBe(e,n)||fee(e,n)||HBe()}function HBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zBe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function KBe(e){if(Array.isArray(e))return e}function YBe(e){return JBe(e)||XBe(e)||fee(e)||qBe()}function qBe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fee(e,n){if(e){if(typeof e=="string")return cD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cD(e,n)}}function XBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function JBe(e){if(Array.isArray(e))return cD(e)}function cD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var Ww=1e-4,mee=function(n,a){return[0,3*n,3*a-6*n,3*n-3*a+1]},gee=function(n,a){return n.map(function(o,l){return o*Math.pow(a,l)}).reduce(function(o,l){return o+l})},i9=function(n,a){return function(o){var l=mee(n,a);return gee(l,o)}},QBe=function(n,a){return function(o){var l=mee(n,a),p=[].concat(YBe(l.map(function(m,y){return m*y}).slice(1)),[0]);return gee(p,o)}},a9=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var l=a[0],p=a[1],m=a[2],y=a[3];if(a.length===1)switch(a[0]){case"linear":l=0,p=0,m=1,y=1;break;case"ease":l=.25,p=.1,m=.25,y=1;break;case"ease-in":l=.42,p=0,m=1,y=1;break;case"ease-out":l=.42,p=0,m=.58,y=1;break;case"ease-in-out":l=0,p=0,m=.58,y=1;break;default:{var E=a[0].split("(");if(E[0]==="cubic-bezier"&&E[1].split(")")[0].split(",").length===4){var b=E[1].split(")")[0].split(",").map(function(P){return parseFloat(P)}),T=$Be(b,4);l=T[0],p=T[1],m=T[2],y=T[3]}}}var x=i9(l,m),A=i9(p,y),D=QBe(l,m),N=function(U){return U>1?1:U<0?0:U},L=function(U){for(var V=U>1?1:U,F=V,H=0;H<8;++H){var B=x(F)-V,z=D(F);if(Math.abs(B-V)<Ww||z<Ww)return A(F);F=N(F-B/z)}return A(F)};return L.isStepper=!1,L},ZBe=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.stiff,o=a===void 0?100:a,l=n.damping,p=l===void 0?8:l,m=n.dt,y=m===void 0?17:m,E=function(T,x,A){var D=-(T-x)*o,N=A*p,L=A+(D-N)*y/1e3,P=A*y/1e3+T;return Math.abs(P-x)<Ww&&Math.abs(L)<Ww?[x,0]:[P,L]};return E.isStepper=!0,E.dt=y,E},e6e=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var l=a[0];if(typeof l=="string")switch(l){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return a9(l);case"spring":return ZBe();default:if(l.split("(")[0]==="cubic-bezier")return a9(l)}return typeof l=="function"?l:null};function Zy(e){"@babel/helpers - typeof";return Zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Zy(e)}function s9(e){return r6e(e)||n6e(e)||vee(e)||t6e()}function t6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function r6e(e){if(Array.isArray(e))return dD(e)}function o9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Mi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?o9(Object(a),!0).forEach(function(o){lD(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function lD(e,n,a){return n=i6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i6e(e){var n=a6e(e,"string");return Zy(n)==="symbol"?n:String(n)}function a6e(e,n){if(Zy(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Zy(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function s6e(e,n){return l6e(e)||c6e(e,n)||vee(e,n)||o6e()}function o6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vee(e,n){if(e){if(typeof e=="string")return dD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dD(e,n)}}function dD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function c6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function l6e(e){if(Array.isArray(e))return e}var Gw=function(n,a,o){return n+(a-n)*o},uD=function(n){var a=n.from,o=n.to;return a!==o},d6e=function e(n,a,o){var l=cy(function(p,m){if(uD(m)){var y=n(m.from,m.to,m.velocity),E=s6e(y,2),b=E[0],T=E[1];return Mi(Mi({},m),{},{from:b,velocity:T})}return m},a);return o<1?cy(function(p,m){return uD(m)?Mi(Mi({},m),{},{velocity:Gw(m.velocity,l[p].velocity,o),from:Gw(m.from,l[p].from,o)}):m},a):e(n,l,o-1)};const u6e=function(e,n,a,o,l){var p=BBe(e,n),m=p.reduce(function(P,U){return Mi(Mi({},P),{},lD({},U,[e[U],n[U]]))},{}),y=p.reduce(function(P,U){return Mi(Mi({},P),{},lD({},U,{from:e[U],velocity:0,to:n[U]}))},{}),E=-1,b,T,x=function(){return null},A=function(){return cy(function(U,V){return V.from},y)},D=function(){return!Object.values(y).filter(uD).length},N=function(U){b||(b=U);var V=U-b,F=V/a.dt;y=d6e(a,y,F),l(Mi(Mi(Mi({},e),n),A())),b=U,D()||(E=requestAnimationFrame(x))},L=function(U){T||(T=U);var V=(U-T)/o,F=cy(function(B,z){return Gw.apply(void 0,s9(z).concat([a(V)]))},m);if(l(Mi(Mi(Mi({},e),n),F)),V<1)E=requestAnimationFrame(x);else{var H=cy(function(B,z){return Gw.apply(void 0,s9(z).concat([a(1)]))},m);l(Mi(Mi(Mi({},e),n),H))}};return x=a.isStepper?N:L,function(){return requestAnimationFrame(x),function(){cancelAnimationFrame(E)}}};function um(e){"@babel/helpers - typeof";return um=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},um(e)}var h6e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function p6e(e,n){if(e==null)return{};var a=f6e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function f6e(e,n){if(e==null)return{};var a={},o=Object.keys(e),l,p;for(p=0;p<o.length;p++)l=o[p],!(n.indexOf(l)>=0)&&(a[l]=e[l]);return a}function YI(e){return y6e(e)||v6e(e)||g6e(e)||m6e()}function m6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g6e(e,n){if(e){if(typeof e=="string")return hD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hD(e,n)}}function v6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function y6e(e){if(Array.isArray(e))return hD(e)}function hD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function c9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Do(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?c9(Object(a),!0).forEach(function(o){Yv(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Yv(e,n,a){return n=yee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function _6e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function E6e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,yee(o.key),o)}}function b6e(e,n,a){return n&&E6e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function yee(e){var n=S6e(e,"string");return um(n)==="symbol"?n:String(n)}function S6e(e,n){if(um(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(um(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function w6e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&pD(e,n)}function pD(e,n){return pD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},pD(e,n)}function x6e(e){var n=T6e();return function(){var o=$w(e),l;if(n){var p=$w(this).constructor;l=Reflect.construct(o,arguments,p)}else l=o.apply(this,arguments);return fD(this,l)}}function fD(e,n){if(n&&(um(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mD(e)}function mD(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T6e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function $w(e){return $w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},$w(e)}var jc=function(e){w6e(a,e);var n=x6e(a);function a(o,l){var p;_6e(this,a),p=n.call(this,o,l);var m=p.props,y=m.isActive,E=m.attributeName,b=m.from,T=m.to,x=m.steps,A=m.children,D=m.duration;if(p.handleStyleChange=p.handleStyleChange.bind(mD(p)),p.changeStyle=p.changeStyle.bind(mD(p)),!y||D<=0)return p.state={style:{}},typeof A=="function"&&(p.state={style:T}),fD(p);if(x&&x.length)p.state={style:x[0].style};else if(b){if(typeof A=="function")return p.state={style:b},fD(p);p.state={style:E?Yv({},E,b):b}}else p.state={style:{}};return p}return b6e(a,[{key:"componentDidMount",value:function(){var l=this.props,p=l.isActive,m=l.canBegin;this.mounted=!0,!(!p||!m)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(l){var p=this.props,m=p.isActive,y=p.canBegin,E=p.attributeName,b=p.shouldReAnimate,T=p.to,x=p.from,A=this.state.style;if(y){if(!m){var D={style:E?Yv({},E,T):T};this.state&&A&&(E&&A[E]!==T||!E&&A!==T)&&this.setState(D);return}if(!(IBe(l.to,T)&&l.canBegin&&l.isActive)){var N=!l.canBegin||!l.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var L=N||b?x:l.to;if(this.state&&A){var P={style:E?Yv({},E,L):L};(E&&A[E]!==L||!E&&A!==L)&&this.setState(P)}this.runAnimation(Do(Do({},this.props),{},{from:L,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var l=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),l&&l()}},{key:"handleStyleChange",value:function(l){this.changeStyle(l)}},{key:"changeStyle",value:function(l){this.mounted&&this.setState({style:l})}},{key:"runJSAnimation",value:function(l){var p=this,m=l.from,y=l.to,E=l.duration,b=l.easing,T=l.begin,x=l.onAnimationEnd,A=l.onAnimationStart,D=u6e(m,y,e6e(b),E,this.changeStyle),N=function(){p.stopJSAnimation=D()};this.manager.start([A,T,N,E,x])}},{key:"runStepAnimation",value:function(l){var p=this,m=l.steps,y=l.begin,E=l.onAnimationStart,b=m[0],T=b.style,x=b.duration,A=x===void 0?0:x,D=function(L,P,U){if(U===0)return L;var V=P.duration,F=P.easing,H=F===void 0?"ease":F,B=P.style,z=P.properties,Y=P.onAnimationEnd,Q=U>0?m[U-1]:P,re=z||Object.keys(B);if(typeof H=="function"||H==="spring")return[].concat(YI(L),[p.runJSAnimation.bind(p,{from:Q.style,to:B,duration:V,easing:H}),V]);var de=r9(re,V,H),le=Do(Do(Do({},Q.style),B),{},{transition:de});return[].concat(YI(L),[le,V,Y]).filter(WBe)};return this.manager.start([E].concat(YI(m.reduce(D,[T,Math.max(A,y)])),[l.onAnimationEnd]))}},{key:"runAnimation",value:function(l){this.manager||(this.manager=UBe());var p=l.begin,m=l.duration,y=l.attributeName,E=l.to,b=l.easing,T=l.onAnimationStart,x=l.onAnimationEnd,A=l.steps,D=l.children,N=this.manager;if(this.unSubscribe=N.subscribe(this.handleStyleChange),typeof b=="function"||typeof D=="function"||b==="spring"){this.runJSAnimation(l);return}if(A.length>1){this.runStepAnimation(l);return}var L=y?Yv({},y,E):E,P=r9(Object.keys(L),m,b);N.start([T,p,Do(Do({},L),{},{transition:P}),m,x])}},{key:"render",value:function(){var l=this.props,p=l.children;l.begin;var m=l.duration;l.attributeName,l.easing;var y=l.isActive;l.steps,l.from,l.to,l.canBegin,l.onAnimationEnd,l.shouldReAnimate,l.onAnimationReStart;var E=p6e(l,h6e),b=J.Children.count(p),T=this.state.style;if(typeof p=="function")return p(T);if(!y||b===0||m<=0)return p;var x=function(D){var N=D.props,L=N.style,P=L===void 0?{}:L,U=N.className,V=J.cloneElement(D,Do(Do({},E),{},{style:Do(Do({},P),T),className:U}));return V};return b===1?x(J.Children.only(p)):me.createElement("div",null,J.Children.map(p,function(A){return x(A)}))}}]),a}(J.PureComponent);jc.displayName="Animate";jc.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};jc.propTypes={from:At.oneOfType([At.object,At.string]),to:At.oneOfType([At.object,At.string]),attributeName:At.string,duration:At.number,begin:At.number,easing:At.oneOfType([At.string,At.func]),steps:At.arrayOf(At.shape({duration:At.number.isRequired,style:At.object.isRequired,easing:At.oneOfType([At.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),At.func]),properties:At.arrayOf("string"),onAnimationEnd:At.func})),children:At.oneOfType([At.node,At.func]),isActive:At.bool,canBegin:At.bool,onAnimationEnd:At.func,shouldReAnimate:At.bool,onAnimationStart:At.func,onAnimationReStart:At.func};function e_(e){"@babel/helpers - typeof";return e_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e_(e)}function Hw(){return Hw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Hw.apply(this,arguments)}function C6e(e,n){return O6e(e)||N6e(e,n)||A6e(e,n)||R6e()}function R6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A6e(e,n){if(e){if(typeof e=="string")return l9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return l9(e,n)}}function l9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function N6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function O6e(e){if(Array.isArray(e))return e}function d9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function u9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?d9(Object(a),!0).forEach(function(o){I6e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function I6e(e,n,a){return n=P6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function P6e(e){var n=D6e(e,"string");return e_(n)=="symbol"?n:n+""}function D6e(e,n){if(e_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(e_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var h9=function(n,a,o,l,p){var m=Math.min(Math.abs(o)/2,Math.abs(l)/2),y=l>=0?1:-1,E=o>=0?1:-1,b=l>=0&&o>=0||l<0&&o<0?1:0,T;if(m>0&&p instanceof Array){for(var x=[0,0,0,0],A=0,D=4;A<D;A++)x[A]=p[A]>m?m:p[A];T="M".concat(n,",").concat(a+y*x[0]),x[0]>0&&(T+="A ".concat(x[0],",").concat(x[0],",0,0,").concat(b,",").concat(n+E*x[0],",").concat(a)),T+="L ".concat(n+o-E*x[1],",").concat(a),x[1]>0&&(T+="A ".concat(x[1],",").concat(x[1],",0,0,").concat(b,`,
        `).concat(n+o,",").concat(a+y*x[1])),T+="L ".concat(n+o,",").concat(a+l-y*x[2]),x[2]>0&&(T+="A ".concat(x[2],",").concat(x[2],",0,0,").concat(b,`,
        `).concat(n+o-E*x[2],",").concat(a+l)),T+="L ".concat(n+E*x[3],",").concat(a+l),x[3]>0&&(T+="A ".concat(x[3],",").concat(x[3],",0,0,").concat(b,`,
        `).concat(n,",").concat(a+l-y*x[3])),T+="Z"}else if(m>0&&p===+p&&p>0){var N=Math.min(m,p);T="M ".concat(n,",").concat(a+y*N,`
            A `).concat(N,",").concat(N,",0,0,").concat(b,",").concat(n+E*N,",").concat(a,`
            L `).concat(n+o-E*N,",").concat(a,`
            A `).concat(N,",").concat(N,",0,0,").concat(b,",").concat(n+o,",").concat(a+y*N,`
            L `).concat(n+o,",").concat(a+l-y*N,`
            A `).concat(N,",").concat(N,",0,0,").concat(b,",").concat(n+o-E*N,",").concat(a+l,`
            L `).concat(n+E*N,",").concat(a+l,`
            A `).concat(N,",").concat(N,",0,0,").concat(b,",").concat(n,",").concat(a+l-y*N," Z")}else T="M ".concat(n,",").concat(a," h ").concat(o," v ").concat(l," h ").concat(-o," Z");return T},k6e=function(n,a){if(!n||!a)return!1;var o=n.x,l=n.y,p=a.x,m=a.y,y=a.width,E=a.height;if(Math.abs(y)>0&&Math.abs(E)>0){var b=Math.min(p,p+y),T=Math.max(p,p+y),x=Math.min(m,m+E),A=Math.max(m,m+E);return o>=b&&o<=T&&l>=x&&l<=A}return!1},L6e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},J2=function(n){var a=u9(u9({},L6e),n),o=J.useRef(),l=J.useState(-1),p=C6e(l,2),m=p[0],y=p[1];J.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var H=o.current.getTotalLength();H&&y(H)}catch{}},[]);var E=a.x,b=a.y,T=a.width,x=a.height,A=a.radius,D=a.className,N=a.animationEasing,L=a.animationDuration,P=a.animationBegin,U=a.isAnimationActive,V=a.isUpdateAnimationActive;if(E!==+E||b!==+b||T!==+T||x!==+x||T===0||x===0)return null;var F=Cn("recharts-rectangle",D);return V?me.createElement(jc,{canBegin:m>0,from:{width:T,height:x,x:E,y:b},to:{width:T,height:x,x:E,y:b},duration:L,animationEasing:N,isActive:V},function(H){var B=H.width,z=H.height,Y=H.x,Q=H.y;return me.createElement(jc,{canBegin:m>0,from:"0px ".concat(m===-1?1:m,"px"),to:"".concat(m,"px 0px"),attributeName:"strokeDasharray",begin:P,duration:L,isActive:U,easing:N},me.createElement("path",Hw({},un(a,!0),{className:F,d:h9(Y,Q,B,z,A),ref:o})))}):me.createElement("path",Hw({},un(a,!0),{className:F,d:h9(E,b,T,x,A)}))};function gD(){return gD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},gD.apply(this,arguments)}var ET=function(n){var a=n.cx,o=n.cy,l=n.r,p=n.className,m=Cn("recharts-dot",p);return a===+a&&o===+o&&l===+l?J.createElement("circle",gD({},un(n,!1),cw(n),{className:m,cx:a,cy:o,r:l})):null};function t_(e){"@babel/helpers - typeof";return t_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t_(e)}var j6e=["x","y","top","left","width","height","className"];function vD(){return vD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},vD.apply(this,arguments)}function p9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function M6e(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?p9(Object(a),!0).forEach(function(o){U6e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function U6e(e,n,a){return n=V6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function V6e(e){var n=F6e(e,"string");return t_(n)=="symbol"?n:n+""}function F6e(e,n){if(t_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(t_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function B6e(e,n){if(e==null)return{};var a=W6e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function W6e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var G6e=function(n,a,o,l,p,m){return"M".concat(n,",").concat(p,"v").concat(l,"M").concat(m,",").concat(a,"h").concat(o)},$6e=function(n){var a=n.x,o=a===void 0?0:a,l=n.y,p=l===void 0?0:l,m=n.top,y=m===void 0?0:m,E=n.left,b=E===void 0?0:E,T=n.width,x=T===void 0?0:T,A=n.height,D=A===void 0?0:A,N=n.className,L=B6e(n,j6e),P=M6e({x:o,y:p,top:y,left:b,width:x,height:D},L);return!nt(o)||!nt(p)||!nt(x)||!nt(D)||!nt(y)||!nt(b)?null:me.createElement("path",vD({},un(P,!0),{className:Cn("recharts-cross",N),d:G6e(o,p,x,D,y,b)}))},H6e=PQ,z6e=H6e(Object.getPrototypeOf,Object),K6e=z6e,Y6e=Al,q6e=K6e,X6e=Nl,J6e="[object Object]",Q6e=Function.prototype,Z6e=Object.prototype,_ee=Q6e.toString,e8e=Z6e.hasOwnProperty,t8e=_ee.call(Object);function n8e(e){if(!X6e(e)||Y6e(e)!=J6e)return!1;var n=q6e(e);if(n===null)return!0;var a=e8e.call(n,"constructor")&&n.constructor;return typeof a=="function"&&a instanceof a&&_ee.call(a)==t8e}var r8e=n8e;const i8e=Zn(r8e);var a8e=Al,s8e=Nl,o8e="[object Boolean]";function c8e(e){return e===!0||e===!1||s8e(e)&&a8e(e)==o8e}var l8e=c8e;const d8e=Zn(l8e);function n_(e){"@babel/helpers - typeof";return n_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n_(e)}function zw(){return zw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},zw.apply(this,arguments)}function u8e(e,n){return m8e(e)||f8e(e,n)||p8e(e,n)||h8e()}function h8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function p8e(e,n){if(e){if(typeof e=="string")return f9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return f9(e,n)}}function f9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function f8e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function m8e(e){if(Array.isArray(e))return e}function m9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function g9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?m9(Object(a),!0).forEach(function(o){g8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function g8e(e,n,a){return n=v8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function v8e(e){var n=y8e(e,"string");return n_(n)=="symbol"?n:n+""}function y8e(e,n){if(n_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(n_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var v9=function(n,a,o,l,p){var m=o-l,y;return y="M ".concat(n,",").concat(a),y+="L ".concat(n+o,",").concat(a),y+="L ".concat(n+o-m/2,",").concat(a+p),y+="L ".concat(n+o-m/2-l,",").concat(a+p),y+="L ".concat(n,",").concat(a," Z"),y},_8e={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},E8e=function(n){var a=g9(g9({},_8e),n),o=J.useRef(),l=J.useState(-1),p=u8e(l,2),m=p[0],y=p[1];J.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var F=o.current.getTotalLength();F&&y(F)}catch{}},[]);var E=a.x,b=a.y,T=a.upperWidth,x=a.lowerWidth,A=a.height,D=a.className,N=a.animationEasing,L=a.animationDuration,P=a.animationBegin,U=a.isUpdateAnimationActive;if(E!==+E||b!==+b||T!==+T||x!==+x||A!==+A||T===0&&x===0||A===0)return null;var V=Cn("recharts-trapezoid",D);return U?me.createElement(jc,{canBegin:m>0,from:{upperWidth:0,lowerWidth:0,height:A,x:E,y:b},to:{upperWidth:T,lowerWidth:x,height:A,x:E,y:b},duration:L,animationEasing:N,isActive:U},function(F){var H=F.upperWidth,B=F.lowerWidth,z=F.height,Y=F.x,Q=F.y;return me.createElement(jc,{canBegin:m>0,from:"0px ".concat(m===-1?1:m,"px"),to:"".concat(m,"px 0px"),attributeName:"strokeDasharray",begin:P,duration:L,easing:N},me.createElement("path",zw({},un(a,!0),{className:V,d:v9(Y,Q,H,B,z),ref:o})))}):me.createElement("g",null,me.createElement("path",zw({},un(a,!0),{className:V,d:v9(E,b,T,x,A)})))},b8e=["option","shapeType","propTransformer","activeClassName","isActive"];function r_(e){"@babel/helpers - typeof";return r_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},r_(e)}function S8e(e,n){if(e==null)return{};var a=w8e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function w8e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function y9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Kw(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?y9(Object(a),!0).forEach(function(o){x8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function x8e(e,n,a){return n=T8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function T8e(e){var n=C8e(e,"string");return r_(n)=="symbol"?n:n+""}function C8e(e,n){if(r_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(r_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function R8e(e,n){return Kw(Kw({},n),e)}function A8e(e,n){return e==="symbols"}function _9(e){var n=e.shapeType,a=e.elementProps;switch(n){case"rectangle":return me.createElement(J2,a);case"trapezoid":return me.createElement(E8e,a);case"sector":return me.createElement(cee,a);case"symbols":if(A8e(n))return me.createElement(g2,a);break;default:return null}}function N8e(e){return J.isValidElement(e)?e.props:e}function O8e(e){var n=e.option,a=e.shapeType,o=e.propTransformer,l=o===void 0?R8e:o,p=e.activeClassName,m=p===void 0?"recharts-active-shape":p,y=e.isActive,E=S8e(e,b8e),b;if(J.isValidElement(n))b=J.cloneElement(n,Kw(Kw({},E),N8e(n)));else if(sn(n))b=n(E);else if(i8e(n)&&!d8e(n)){var T=l(n,E);b=me.createElement(_9,{shapeType:a,elementProps:T})}else{var x=E;b=me.createElement(_9,{shapeType:a,elementProps:x})}return y?me.createElement(cr,{className:m},b):b}function bT(e,n){return n!=null&&"trapezoids"in e.props}function ST(e,n){return n!=null&&"sectors"in e.props}function i_(e,n){return n!=null&&"points"in e.props}function I8e(e,n){var a,o,l=e.x===(n==null||(a=n.labelViewBox)===null||a===void 0?void 0:a.x)||e.x===n.x,p=e.y===(n==null||(o=n.labelViewBox)===null||o===void 0?void 0:o.y)||e.y===n.y;return l&&p}function P8e(e,n){var a=e.endAngle===n.endAngle,o=e.startAngle===n.startAngle;return a&&o}function D8e(e,n){var a=e.x===n.x,o=e.y===n.y,l=e.z===n.z;return a&&o&&l}function k8e(e,n){var a;return bT(e,n)?a=I8e:ST(e,n)?a=P8e:i_(e,n)&&(a=D8e),a}function L8e(e,n){var a;return bT(e,n)?a="trapezoids":ST(e,n)?a="sectors":i_(e,n)&&(a="points"),a}function j8e(e,n){if(bT(e,n)){var a;return(a=n.tooltipPayload)===null||a===void 0||(a=a[0])===null||a===void 0||(a=a.payload)===null||a===void 0?void 0:a.payload}if(ST(e,n)){var o;return(o=n.tooltipPayload)===null||o===void 0||(o=o[0])===null||o===void 0||(o=o.payload)===null||o===void 0?void 0:o.payload}return i_(e,n)?n.payload:{}}function M8e(e){var n=e.activeTooltipItem,a=e.graphicalItem,o=e.itemData,l=L8e(a,n),p=j8e(a,n),m=o.filter(function(E,b){var T=lm(p,E),x=a.props[l].filter(function(N){var L=k8e(a,n);return L(N,n)}),A=a.props[l].indexOf(x[x.length-1]),D=b===A;return T&&D}),y=o.indexOf(m[m.length-1]);return y}var U8e=Math.ceil,V8e=Math.max;function F8e(e,n,a,o){for(var l=-1,p=V8e(U8e((n-e)/(a||1)),0),m=Array(p);p--;)m[o?p:++l]=e,e+=a;return m}var B8e=F8e,W8e=JQ,E9=1/0,G8e=17976931348623157e292;function $8e(e){if(!e)return e===0?e:0;if(e=W8e(e),e===E9||e===-E9){var n=e<0?-1:1;return n*G8e}return e===e?e:0}var Eee=$8e,H8e=B8e,z8e=dT,qI=Eee;function K8e(e){return function(n,a,o){return o&&typeof o!="number"&&z8e(n,a,o)&&(a=o=void 0),n=qI(n),a===void 0?(a=n,n=0):a=qI(a),o=o===void 0?n<a?1:-1:qI(o),H8e(n,a,o,e)}}var Y8e=K8e,q8e=Y8e,X8e=q8e(),J8e=X8e;const Yw=Zn(J8e);function a_(e){"@babel/helpers - typeof";return a_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},a_(e)}function b9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function S9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?b9(Object(a),!0).forEach(function(o){bee(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function bee(e,n,a){return n=Q8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Q8e(e){var n=Z8e(e,"string");return a_(n)=="symbol"?n:n+""}function Z8e(e,n){if(a_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(a_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var eWe=["Webkit","Moz","O","ms"],tWe=function(n,a){var o=n.replace(/(\w)/,function(p){return p.toUpperCase()}),l=eWe.reduce(function(p,m){return S9(S9({},p),{},bee({},m+o,a))},{});return l[n]=a,l};function hm(e){"@babel/helpers - typeof";return hm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},hm(e)}function qw(){return qw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},qw.apply(this,arguments)}function w9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function XI(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?w9(Object(a),!0).forEach(function(o){cs(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function nWe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function x9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,wee(o.key),o)}}function rWe(e,n,a){return n&&x9(e.prototype,n),a&&x9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function iWe(e,n,a){return n=Xw(n),aWe(e,See()?Reflect.construct(n,a||[],Xw(e).constructor):n.apply(e,a))}function aWe(e,n){if(n&&(hm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sWe(e)}function sWe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function See(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(See=function(){return!!e})()}function Xw(e){return Xw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Xw(e)}function oWe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&yD(e,n)}function yD(e,n){return yD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},yD(e,n)}function cs(e,n,a){return n=wee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function wee(e){var n=cWe(e,"string");return hm(n)=="symbol"?n:n+""}function cWe(e,n){if(hm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(hm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var lWe=function(n){var a=n.data,o=n.startIndex,l=n.endIndex,p=n.x,m=n.width,y=n.travellerWidth;if(!a||!a.length)return{};var E=a.length,b=sy().domain(Yw(0,E)).range([p,p+m-y]),T=b.domain().map(function(x){return b(x)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:b(o),endX:b(l),scale:b,scaleValues:T}},T9=function(n){return n.changedTouches&&!!n.changedTouches.length},pm=function(e){function n(a){var o;return nWe(this,n),o=iWe(this,n,[a]),cs(o,"handleDrag",function(l){o.leaveTimer&&(clearTimeout(o.leaveTimer),o.leaveTimer=null),o.state.isTravellerMoving?o.handleTravellerMove(l):o.state.isSlideMoving&&o.handleSlideDrag(l)}),cs(o,"handleTouchMove",function(l){l.changedTouches!=null&&l.changedTouches.length>0&&o.handleDrag(l.changedTouches[0])}),cs(o,"handleDragEnd",function(){o.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var l=o.props,p=l.endIndex,m=l.onDragEnd,y=l.startIndex;m==null||m({endIndex:p,startIndex:y})}),o.detachDragEndListener()}),cs(o,"handleLeaveWrapper",function(){(o.state.isTravellerMoving||o.state.isSlideMoving)&&(o.leaveTimer=window.setTimeout(o.handleDragEnd,o.props.leaveTimeOut))}),cs(o,"handleEnterSlideOrTraveller",function(){o.setState({isTextActive:!0})}),cs(o,"handleLeaveSlideOrTraveller",function(){o.setState({isTextActive:!1})}),cs(o,"handleSlideDragStart",function(l){var p=T9(l)?l.changedTouches[0]:l;o.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:p.pageX}),o.attachDragEndListener()}),o.travellerDragStartHandlers={startX:o.handleTravellerDragStart.bind(o,"startX"),endX:o.handleTravellerDragStart.bind(o,"endX")},o.state={},o}return oWe(n,e),rWe(n,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(o){var l=o.startX,p=o.endX,m=this.state.scaleValues,y=this.props,E=y.gap,b=y.data,T=b.length-1,x=Math.min(l,p),A=Math.max(l,p),D=n.getIndexInRange(m,x),N=n.getIndexInRange(m,A);return{startIndex:D-D%E,endIndex:N===T?T:N-N%E}}},{key:"getTextOfTick",value:function(o){var l=this.props,p=l.data,m=l.tickFormatter,y=l.dataKey,E=ya(p[o],y,o);return sn(m)?m(E,o):E}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(o){var l=this.state,p=l.slideMoveStartX,m=l.startX,y=l.endX,E=this.props,b=E.x,T=E.width,x=E.travellerWidth,A=E.startIndex,D=E.endIndex,N=E.onChange,L=o.pageX-p;L>0?L=Math.min(L,b+T-x-y,b+T-x-m):L<0&&(L=Math.max(L,b-m,b-y));var P=this.getIndex({startX:m+L,endX:y+L});(P.startIndex!==A||P.endIndex!==D)&&N&&N(P),this.setState({startX:m+L,endX:y+L,slideMoveStartX:o.pageX})}},{key:"handleTravellerDragStart",value:function(o,l){var p=T9(l)?l.changedTouches[0]:l;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:o,brushMoveStartX:p.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(o){var l=this.state,p=l.brushMoveStartX,m=l.movingTravellerId,y=l.endX,E=l.startX,b=this.state[m],T=this.props,x=T.x,A=T.width,D=T.travellerWidth,N=T.onChange,L=T.gap,P=T.data,U={startX:this.state.startX,endX:this.state.endX},V=o.pageX-p;V>0?V=Math.min(V,x+A-D-b):V<0&&(V=Math.max(V,x-b)),U[m]=b+V;var F=this.getIndex(U),H=F.startIndex,B=F.endIndex,z=function(){var Q=P.length-1;return m==="startX"&&(y>E?H%L===0:B%L===0)||y<E&&B===Q||m==="endX"&&(y>E?B%L===0:H%L===0)||y>E&&B===Q};this.setState(cs(cs({},m,b+V),"brushMoveStartX",o.pageX),function(){N&&z()&&N(F)})}},{key:"handleTravellerMoveKeyboard",value:function(o,l){var p=this,m=this.state,y=m.scaleValues,E=m.startX,b=m.endX,T=this.state[l],x=y.indexOf(T);if(x!==-1){var A=x+o;if(!(A===-1||A>=y.length)){var D=y[A];l==="startX"&&D>=b||l==="endX"&&D<=E||this.setState(cs({},l,D),function(){p.props.onChange(p.getIndex({startX:p.state.startX,endX:p.state.endX}))})}}}},{key:"renderBackground",value:function(){var o=this.props,l=o.x,p=o.y,m=o.width,y=o.height,E=o.fill,b=o.stroke;return me.createElement("rect",{stroke:b,fill:E,x:l,y:p,width:m,height:y})}},{key:"renderPanorama",value:function(){var o=this.props,l=o.x,p=o.y,m=o.width,y=o.height,E=o.data,b=o.children,T=o.padding,x=J.Children.only(b);return x?me.cloneElement(x,{x:l,y:p,width:m,height:y,margin:T,compact:!0,data:E}):null}},{key:"renderTravellerLayer",value:function(o,l){var p,m,y=this,E=this.props,b=E.y,T=E.travellerWidth,x=E.height,A=E.traveller,D=E.ariaLabel,N=E.data,L=E.startIndex,P=E.endIndex,U=Math.max(o,this.props.x),V=XI(XI({},un(this.props,!1)),{},{x:U,y:b,width:T,height:x}),F=D||"Min value: ".concat((p=N[L])===null||p===void 0?void 0:p.name,", Max value: ").concat((m=N[P])===null||m===void 0?void 0:m.name);return me.createElement(cr,{tabIndex:0,role:"slider","aria-label":F,"aria-valuenow":o,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[l],onTouchStart:this.travellerDragStartHandlers[l],onKeyDown:function(B){["ArrowLeft","ArrowRight"].includes(B.key)&&(B.preventDefault(),B.stopPropagation(),y.handleTravellerMoveKeyboard(B.key==="ArrowRight"?1:-1,l))},onFocus:function(){y.setState({isTravellerFocused:!0})},onBlur:function(){y.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},n.renderTraveller(A,V))}},{key:"renderSlide",value:function(o,l){var p=this.props,m=p.y,y=p.height,E=p.stroke,b=p.travellerWidth,T=Math.min(o,l)+b,x=Math.max(Math.abs(l-o)-b,0);return me.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:E,fillOpacity:.2,x:T,y:m,width:x,height:y})}},{key:"renderText",value:function(){var o=this.props,l=o.startIndex,p=o.endIndex,m=o.y,y=o.height,E=o.travellerWidth,b=o.stroke,T=this.state,x=T.startX,A=T.endX,D=5,N={pointerEvents:"none",fill:b};return me.createElement(cr,{className:"recharts-brush-texts"},me.createElement(xw,qw({textAnchor:"end",verticalAnchor:"middle",x:Math.min(x,A)-D,y:m+y/2},N),this.getTextOfTick(l)),me.createElement(xw,qw({textAnchor:"start",verticalAnchor:"middle",x:Math.max(x,A)+E+D,y:m+y/2},N),this.getTextOfTick(p)))}},{key:"render",value:function(){var o=this.props,l=o.data,p=o.className,m=o.children,y=o.x,E=o.y,b=o.width,T=o.height,x=o.alwaysShowText,A=this.state,D=A.startX,N=A.endX,L=A.isTextActive,P=A.isSlideMoving,U=A.isTravellerMoving,V=A.isTravellerFocused;if(!l||!l.length||!nt(y)||!nt(E)||!nt(b)||!nt(T)||b<=0||T<=0)return null;var F=Cn("recharts-brush",p),H=me.Children.count(m)===1,B=tWe("userSelect","none");return me.createElement(cr,{className:F,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:B},this.renderBackground(),H&&this.renderPanorama(),this.renderSlide(D,N),this.renderTravellerLayer(D,"startX"),this.renderTravellerLayer(N,"endX"),(L||P||U||V||x)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(o){var l=o.x,p=o.y,m=o.width,y=o.height,E=o.stroke,b=Math.floor(p+y/2)-1;return me.createElement(me.Fragment,null,me.createElement("rect",{x:l,y:p,width:m,height:y,fill:E,stroke:"none"}),me.createElement("line",{x1:l+1,y1:b,x2:l+m-1,y2:b,fill:"none",stroke:"#fff"}),me.createElement("line",{x1:l+1,y1:b+2,x2:l+m-1,y2:b+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(o,l){var p;return me.isValidElement(o)?p=me.cloneElement(o,l):sn(o)?p=o(l):p=n.renderDefaultTraveller(l),p}},{key:"getDerivedStateFromProps",value:function(o,l){var p=o.data,m=o.width,y=o.x,E=o.travellerWidth,b=o.updateId,T=o.startIndex,x=o.endIndex;if(p!==l.prevData||b!==l.prevUpdateId)return XI({prevData:p,prevTravellerWidth:E,prevUpdateId:b,prevX:y,prevWidth:m},p&&p.length?lWe({data:p,width:m,x:y,travellerWidth:E,startIndex:T,endIndex:x}):{scale:null,scaleValues:null});if(l.scale&&(m!==l.prevWidth||y!==l.prevX||E!==l.prevTravellerWidth)){l.scale.range([y,y+m-E]);var A=l.scale.domain().map(function(D){return l.scale(D)});return{prevData:p,prevTravellerWidth:E,prevUpdateId:b,prevX:y,prevWidth:m,startX:l.scale(o.startIndex),endX:l.scale(o.endIndex),scaleValues:A}}return null}},{key:"getIndexInRange",value:function(o,l){for(var p=o.length,m=0,y=p-1;y-m>1;){var E=Math.floor((m+y)/2);o[E]>l?y=E:m=E}return l>=o[y]?y:m}}])}(J.PureComponent);cs(pm,"displayName","Brush");cs(pm,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var dWe=w2;function uWe(e,n){var a;return dWe(e,function(o,l,p){return a=n(o,l,p),!a}),!!a}var hWe=uWe,pWe=xQ,fWe=qd,mWe=hWe,gWe=za,vWe=dT;function yWe(e,n,a){var o=gWe(e)?pWe:mWe;return a&&vWe(e,n,a)&&(n=void 0),o(e,fWe(n))}var _We=yWe;const EWe=Zn(_We);var Dc=function(n,a){var o=n.alwaysShow,l=n.ifOverflow;return o&&(l="extendDomain"),l===a},C9=zQ;function bWe(e,n,a){n=="__proto__"&&C9?C9(e,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[n]=a}var SWe=bWe,wWe=SWe,xWe=$Q,TWe=qd;function CWe(e,n){var a={};return n=TWe(n),xWe(e,function(o,l,p){wWe(a,l,n(o,l,p))}),a}var RWe=CWe;const AWe=Zn(RWe);function NWe(e,n){for(var a=-1,o=e==null?0:e.length;++a<o;)if(!n(e[a],a,e))return!1;return!0}var OWe=NWe,IWe=w2;function PWe(e,n){var a=!0;return IWe(e,function(o,l,p){return a=!!n(o,l,p),a}),a}var DWe=PWe,kWe=OWe,LWe=DWe,jWe=qd,MWe=za,UWe=dT;function VWe(e,n,a){var o=MWe(e)?kWe:LWe;return a&&UWe(e,n,a)&&(n=void 0),o(e,jWe(n))}var FWe=VWe;const xee=Zn(FWe);var BWe=["x","y"];function s_(e){"@babel/helpers - typeof";return s_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},s_(e)}function _D(){return _D=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},_D.apply(this,arguments)}function R9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Wv(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?R9(Object(a),!0).forEach(function(o){WWe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function WWe(e,n,a){return n=GWe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function GWe(e){var n=$We(e,"string");return s_(n)=="symbol"?n:n+""}function $We(e,n){if(s_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(s_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function HWe(e,n){if(e==null)return{};var a=zWe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function zWe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function KWe(e,n){var a=e.x,o=e.y,l=HWe(e,BWe),p="".concat(a),m=parseInt(p,10),y="".concat(o),E=parseInt(y,10),b="".concat(n.height||l.height),T=parseInt(b,10),x="".concat(n.width||l.width),A=parseInt(x,10);return Wv(Wv(Wv(Wv(Wv({},n),l),m?{x:m}:{}),E?{y:E}:{}),{},{height:T,width:A,name:n.name,radius:n.radius})}function A9(e){return me.createElement(O8e,_D({shapeType:"rectangle",propTransformer:KWe,activeClassName:"recharts-active-bar"},e))}var YWe=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(o,l){if(typeof n=="number")return n;var p=nt(o)||uNe(o);return p?n(o,l):(p||Oh(),a)}},qWe=["value","background"],Tee;function fm(e){"@babel/helpers - typeof";return fm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},fm(e)}function XWe(e,n){if(e==null)return{};var a=JWe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function JWe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function Jw(){return Jw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Jw.apply(this,arguments)}function N9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function ei(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?N9(Object(a),!0).forEach(function(o){Cd(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function QWe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function O9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ree(o.key),o)}}function ZWe(e,n,a){return n&&O9(e.prototype,n),a&&O9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function eGe(e,n,a){return n=Qw(n),tGe(e,Cee()?Reflect.construct(n,a||[],Qw(e).constructor):n.apply(e,a))}function tGe(e,n){if(n&&(fm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nGe(e)}function nGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cee=function(){return!!e})()}function Qw(e){return Qw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Qw(e)}function rGe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&ED(e,n)}function ED(e,n){return ED=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},ED(e,n)}function Cd(e,n,a){return n=Ree(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Ree(e){var n=iGe(e,"string");return fm(n)=="symbol"?n:n+""}function iGe(e,n){if(fm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(fm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var P_=function(e){function n(){var a;QWe(this,n);for(var o=arguments.length,l=new Array(o),p=0;p<o;p++)l[p]=arguments[p];return a=eGe(this,n,[].concat(l)),Cd(a,"state",{isAnimationFinished:!1}),Cd(a,"id",Fm("recharts-bar-")),Cd(a,"handleAnimationEnd",function(){var m=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),m&&m()}),Cd(a,"handleAnimationStart",function(){var m=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),m&&m()}),a}return rGe(n,e),ZWe(n,[{key:"renderRectanglesStatically",value:function(o){var l=this,p=this.props,m=p.shape,y=p.dataKey,E=p.activeIndex,b=p.activeBar,T=un(this.props,!1);return o&&o.map(function(x,A){var D=A===E,N=D?b:m,L=ei(ei(ei({},T),x),{},{isActive:D,option:N,index:A,dataKey:y,onAnimationStart:l.handleAnimationStart,onAnimationEnd:l.handleAnimationEnd});return me.createElement(cr,Jw({className:"recharts-bar-rectangle"},lw(l.props,x,A),{key:"rectangle-".concat(x==null?void 0:x.x,"-").concat(x==null?void 0:x.y,"-").concat(x==null?void 0:x.value,"-").concat(A)}),me.createElement(A9,L))})}},{key:"renderRectanglesWithAnimation",value:function(){var o=this,l=this.props,p=l.data,m=l.layout,y=l.isAnimationActive,E=l.animationBegin,b=l.animationDuration,T=l.animationEasing,x=l.animationId,A=this.state.prevData;return me.createElement(jc,{begin:E,duration:b,isActive:y,easing:T,from:{t:0},to:{t:1},key:"bar-".concat(x),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(D){var N=D.t,L=p.map(function(P,U){var V=A&&A[U];if(V){var F=Vi(V.x,P.x),H=Vi(V.y,P.y),B=Vi(V.width,P.width),z=Vi(V.height,P.height);return ei(ei({},P),{},{x:F(N),y:H(N),width:B(N),height:z(N)})}if(m==="horizontal"){var Y=Vi(0,P.height),Q=Y(N);return ei(ei({},P),{},{y:P.y+P.height-Q,height:Q})}var re=Vi(0,P.width),de=re(N);return ei(ei({},P),{},{width:de})});return me.createElement(cr,null,o.renderRectanglesStatically(L))})}},{key:"renderRectangles",value:function(){var o=this.props,l=o.data,p=o.isAnimationActive,m=this.state.prevData;return p&&l&&l.length&&(!m||!lm(m,l))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(l)}},{key:"renderBackground",value:function(){var o=this,l=this.props,p=l.data,m=l.dataKey,y=l.activeIndex,E=un(this.props.background,!1);return p.map(function(b,T){b.value;var x=b.background,A=XWe(b,qWe);if(!x)return null;var D=ei(ei(ei(ei(ei({},A),{},{fill:"#eee"},x),E),lw(o.props,b,T)),{},{onAnimationStart:o.handleAnimationStart,onAnimationEnd:o.handleAnimationEnd,dataKey:m,index:T,className:"recharts-bar-background-rectangle"});return me.createElement(A9,Jw({key:"background-bar-".concat(T),option:o.props.background,isActive:T===y},D))})}},{key:"renderErrorBar",value:function(o,l){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var p=this.props,m=p.data,y=p.xAxis,E=p.yAxis,b=p.layout,T=p.children,x=Qs(T,I_);if(!x)return null;var A=b==="vertical"?m[0].height/2:m[0].width/2,D=function(P,U){var V=Array.isArray(P.value)?P.value[1]:P.value;return{x:P.x,y:P.y,value:V,errorVal:ya(P,U)}},N={clipPath:o?"url(#clipPath-".concat(l,")"):null};return me.createElement(cr,N,x.map(function(L){return me.cloneElement(L,{key:"error-bar-".concat(l,"-").concat(L.props.dataKey),data:m,xAxis:y,yAxis:E,layout:b,offset:A,dataPointFormatter:D})}))}},{key:"render",value:function(){var o=this.props,l=o.hide,p=o.data,m=o.className,y=o.xAxis,E=o.yAxis,b=o.left,T=o.top,x=o.width,A=o.height,D=o.isAnimationActive,N=o.background,L=o.id;if(l||!p||!p.length)return null;var P=this.state.isAnimationFinished,U=Cn("recharts-bar",m),V=y&&y.allowDataOverflow,F=E&&E.allowDataOverflow,H=V||F,B=pn(L)?this.id:L;return me.createElement(cr,{className:U},V||F?me.createElement("defs",null,me.createElement("clipPath",{id:"clipPath-".concat(B)},me.createElement("rect",{x:V?b:b-x/2,y:F?T:T-A/2,width:V?x:x*2,height:F?A:A*2}))):null,me.createElement(cr,{className:"recharts-bar-rectangles",clipPath:H?"url(#clipPath-".concat(B,")"):null},N?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(H,B),(!D||P)&&ml.renderCallByParent(this.props,p))}}],[{key:"getDerivedStateFromProps",value:function(o,l){return o.animationId!==l.prevAnimationId?{prevAnimationId:o.animationId,curData:o.data,prevData:l.curData}:o.data!==l.curData?{curData:o.data}:null}}])}(J.PureComponent);Tee=P_;Cd(P_,"displayName","Bar");Cd(P_,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Lh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Cd(P_,"getComposedData",function(e){var n=e.props,a=e.item,o=e.barPosition,l=e.bandSize,p=e.xAxis,m=e.yAxis,y=e.xAxisTicks,E=e.yAxisTicks,b=e.stackedData,T=e.dataStartIndex,x=e.displayedData,A=e.offset,D=D5e(o,a);if(!D)return null;var N=n.layout,L=a.type.defaultProps,P=L!==void 0?ei(ei({},L),a.props):a.props,U=P.dataKey,V=P.children,F=P.minPointSize,H=N==="horizontal"?m:p,B=b?H.scale.domain():null,z=B5e({numericAxis:H}),Y=Qs(V,ZQ),Q=x.map(function(re,de){var le,he,Re,ve,we,ue;b?le=k5e(b[T+de],B):(le=ya(re,U),Array.isArray(le)||(le=[z,le]));var be=YWe(F,Tee.defaultProps.minPointSize)(le[1],de);if(N==="horizontal"){var ae,ce=[m.scale(le[0]),m.scale(le[1])],Se=ce[0],je=ce[1];he=NK({axis:p,ticks:y,bandSize:l,offset:D.offset,entry:re,index:de}),Re=(ae=je??Se)!==null&&ae!==void 0?ae:void 0,ve=D.size;var fe=Se-je;if(we=Number.isNaN(fe)?0:fe,ue={x:he,y:m.y,width:ve,height:m.height},Math.abs(be)>0&&Math.abs(we)<Math.abs(be)){var He=Go(we||be)*(Math.abs(be)-Math.abs(we));Re-=He,we+=He}}else{var Ye=[p.scale(le[0]),p.scale(le[1])],gt=Ye[0],Vt=Ye[1];if(he=gt,Re=NK({axis:m,ticks:E,bandSize:l,offset:D.offset,entry:re,index:de}),ve=Vt-gt,we=D.size,ue={x:p.x,y:Re,width:p.width,height:we},Math.abs(be)>0&&Math.abs(ve)<Math.abs(be)){var zn=Go(ve||be)*(Math.abs(be)-Math.abs(ve));ve+=zn}}return ei(ei(ei({},re),{},{x:he,y:Re,width:ve,height:we,value:b?le:le[1],payload:re,background:ue},Y&&Y[de]&&Y[de].props),{},{tooltipPayload:[aee(a,re)],tooltipPosition:{x:he+ve/2,y:Re+we/2}})});return ei({data:Q,layout:N},A)});function o_(e){"@babel/helpers - typeof";return o_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},o_(e)}function aGe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function I9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Aee(o.key),o)}}function sGe(e,n,a){return n&&I9(e.prototype,n),a&&I9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function P9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Uo(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?P9(Object(a),!0).forEach(function(o){wT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function wT(e,n,a){return n=Aee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Aee(e){var n=oGe(e,"string");return o_(n)=="symbol"?n:n+""}function oGe(e,n){if(o_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(o_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Nee=function(n,a,o,l,p){var m=n.width,y=n.height,E=n.layout,b=n.children,T=Object.keys(a),x={left:o.left,leftMirror:o.left,right:m-o.right,rightMirror:m-o.right,top:o.top,topMirror:o.top,bottom:y-o.bottom,bottomMirror:y-o.bottom},A=!!ds(b,P_);return T.reduce(function(D,N){var L=a[N],P=L.orientation,U=L.domain,V=L.padding,F=V===void 0?{}:V,H=L.mirror,B=L.reversed,z="".concat(P).concat(H?"Mirror":""),Y,Q,re,de,le;if(L.type==="number"&&(L.padding==="gap"||L.padding==="no-gap")){var he=U[1]-U[0],Re=1/0,ve=L.categoricalDomain.sort(fNe);if(ve.forEach(function(Ye,gt){gt>0&&(Re=Math.min((Ye||0)-(ve[gt-1]||0),Re))}),Number.isFinite(Re)){var we=Re/he,ue=L.layout==="vertical"?o.height:o.width;if(L.padding==="gap"&&(Y=we*ue/2),L.padding==="no-gap"){var be=Ah(n.barCategoryGap,we*ue),ae=we*ue/2;Y=ae-be-(ae-be)/ue*be}}}l==="xAxis"?Q=[o.left+(F.left||0)+(Y||0),o.left+o.width-(F.right||0)-(Y||0)]:l==="yAxis"?Q=E==="horizontal"?[o.top+o.height-(F.bottom||0),o.top+(F.top||0)]:[o.top+(F.top||0)+(Y||0),o.top+o.height-(F.bottom||0)-(Y||0)]:Q=L.range,B&&(Q=[Q[1],Q[0]]);var ce=I5e(L,p,A),Se=ce.scale,je=ce.realScaleType;Se.domain(U).range(Q),P5e(Se);var fe=F5e(Se,Uo(Uo({},L),{},{realScaleType:je}));l==="xAxis"?(le=P==="top"&&!H||P==="bottom"&&H,re=o.left,de=x[z]-le*L.height):l==="yAxis"&&(le=P==="left"&&!H||P==="right"&&H,re=x[z]-le*L.width,de=o.top);var He=Uo(Uo(Uo({},L),fe),{},{realScaleType:je,x:re,y:de,scale:Se,width:l==="xAxis"?o.width:L.width,height:l==="yAxis"?o.height:L.height});return He.bandSize=Vw(He,fe),!L.hide&&l==="xAxis"?x[z]+=(le?-1:1)*He.height:L.hide||(x[z]+=(le?-1:1)*He.width),Uo(Uo({},D),{},wT({},N,He))},{})},Oee=function(n,a){var o=n.x,l=n.y,p=a.x,m=a.y;return{x:Math.min(o,p),y:Math.min(l,m),width:Math.abs(p-o),height:Math.abs(m-l)}},cGe=function(n){var a=n.x1,o=n.y1,l=n.x2,p=n.y2;return Oee({x:a,y:o},{x:l,y:p})},Iee=function(){function e(n){aGe(this,e),this.scale=n}return sGe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=o.bandAware,p=o.position;if(a!==void 0){if(p)switch(p){case"start":return this.scale(a);case"middle":{var m=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+m}case"end":{var y=this.bandwidth?this.bandwidth():0;return this.scale(a)+y}default:return this.scale(a)}if(l){var E=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+E}return this.scale(a)}}},{key:"isInRange",value:function(a){var o=this.range(),l=o[0],p=o[o.length-1];return l<=p?a>=l&&a<=p:a>=p&&a<=l}}],[{key:"create",value:function(a){return new e(a)}}])}();wT(Iee,"EPS",1e-4);var Q2=function(n){var a=Object.keys(n).reduce(function(o,l){return Uo(Uo({},o),{},wT({},l,Iee.create(n[l])))},{});return Uo(Uo({},a),{},{apply:function(l){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=p.bandAware,y=p.position;return AWe(l,function(E,b){return a[b].apply(E,{bandAware:m,position:y})})},isInRange:function(l){return xee(l,function(p,m){return a[m].isInRange(p)})}})};function lGe(e){return(e%180+180)%180}var dGe=function(n){var a=n.width,o=n.height,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,p=lGe(l),m=p*Math.PI/180,y=Math.atan(o/a),E=m>y&&m<Math.PI-y?o/Math.sin(m):a/Math.cos(m);return Math.abs(E)},uGe=qd,hGe=C_,pGe=cT;function fGe(e){return function(n,a,o){var l=Object(n);if(!hGe(n)){var p=uGe(a);n=pGe(n),a=function(y){return p(l[y],y,l)}}var m=e(n,a,o);return m>-1?l[p?n[m]:m]:void 0}}var mGe=fGe,gGe=Eee;function vGe(e){var n=gGe(e),a=n%1;return n===n?a?n-a:n:0}var yGe=vGe,_Ge=UQ,EGe=qd,bGe=yGe,SGe=Math.max;function wGe(e,n,a){var o=e==null?0:e.length;if(!o)return-1;var l=a==null?0:bGe(a);return l<0&&(l=SGe(o+l,0)),_Ge(e,EGe(n),l)}var xGe=wGe,TGe=mGe,CGe=xGe,RGe=TGe(CGe),AGe=RGe;const NGe=Zn(AGe);var OGe=vAe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),Z2=J.createContext(void 0),eL=J.createContext(void 0),Pee=J.createContext(void 0),Dee=J.createContext({}),kee=J.createContext(void 0),Lee=J.createContext(0),jee=J.createContext(0),D9=function(n){var a=n.state,o=a.xAxisMap,l=a.yAxisMap,p=a.offset,m=n.clipPathId,y=n.children,E=n.width,b=n.height,T=OGe(p);return me.createElement(Z2.Provider,{value:o},me.createElement(eL.Provider,{value:l},me.createElement(Dee.Provider,{value:p},me.createElement(Pee.Provider,{value:T},me.createElement(kee.Provider,{value:m},me.createElement(Lee.Provider,{value:b},me.createElement(jee.Provider,{value:E},y)))))))},IGe=function(){return J.useContext(kee)},Mee=function(n){var a=J.useContext(Z2);a==null&&Oh();var o=a[n];return o==null&&Oh(),o},PGe=function(){var n=J.useContext(Z2);return Ed(n)},DGe=function(){var n=J.useContext(eL),a=NGe(n,function(o){return xee(o.domain,Number.isFinite)});return a||Ed(n)},Uee=function(n){var a=J.useContext(eL);a==null&&Oh();var o=a[n];return o==null&&Oh(),o},kGe=function(){var n=J.useContext(Pee);return n},LGe=function(){return J.useContext(Dee)},tL=function(){return J.useContext(jee)},nL=function(){return J.useContext(Lee)};function mm(e){"@babel/helpers - typeof";return mm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},mm(e)}function jGe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function MGe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Fee(o.key),o)}}function UGe(e,n,a){return n&&MGe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function VGe(e,n,a){return n=Zw(n),FGe(e,Vee()?Reflect.construct(n,a||[],Zw(e).constructor):n.apply(e,a))}function FGe(e,n){if(n&&(mm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BGe(e)}function BGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Vee=function(){return!!e})()}function Zw(e){return Zw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Zw(e)}function WGe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&bD(e,n)}function bD(e,n){return bD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},bD(e,n)}function k9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function L9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?k9(Object(a),!0).forEach(function(o){rL(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function rL(e,n,a){return n=Fee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Fee(e){var n=GGe(e,"string");return mm(n)=="symbol"?n:n+""}function GGe(e,n){if(mm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(mm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function $Ge(e,n){return YGe(e)||KGe(e,n)||zGe(e,n)||HGe()}function HGe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zGe(e,n){if(e){if(typeof e=="string")return j9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return j9(e,n)}}function j9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function KGe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function YGe(e){if(Array.isArray(e))return e}function SD(){return SD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},SD.apply(this,arguments)}var qGe=function(n,a){var o;return me.isValidElement(n)?o=me.cloneElement(n,a):sn(n)?o=n(a):o=me.createElement("line",SD({},a,{className:"recharts-reference-line-line"})),o},XGe=function(n,a,o,l,p,m,y,E,b){var T=p.x,x=p.y,A=p.width,D=p.height;if(o){var N=b.y,L=n.y.apply(N,{position:m});if(Dc(b,"discard")&&!n.y.isInRange(L))return null;var P=[{x:T+A,y:L},{x:T,y:L}];return E==="left"?P.reverse():P}if(a){var U=b.x,V=n.x.apply(U,{position:m});if(Dc(b,"discard")&&!n.x.isInRange(V))return null;var F=[{x:V,y:x+D},{x:V,y:x}];return y==="top"?F.reverse():F}if(l){var H=b.segment,B=H.map(function(z){return n.apply(z,{position:m})});return Dc(b,"discard")&&EWe(B,function(z){return!n.isInRange(z)})?null:B}return null};function JGe(e){var n=e.x,a=e.y,o=e.segment,l=e.xAxisId,p=e.yAxisId,m=e.shape,y=e.className,E=e.alwaysShow,b=IGe(),T=Mee(l),x=Uee(p),A=kGe();if(!b||!A)return null;pl(E===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var D=Q2({x:T.scale,y:x.scale}),N=pi(n),L=pi(a),P=o&&o.length===2,U=XGe(D,N,L,P,A,e.position,T.orientation,x.orientation,e);if(!U)return null;var V=$Ge(U,2),F=V[0],H=F.x,B=F.y,z=V[1],Y=z.x,Q=z.y,re=Dc(e,"hidden")?"url(#".concat(b,")"):void 0,de=L9(L9({clipPath:re},un(e,!0)),{},{x1:H,y1:B,x2:Y,y2:Q});return me.createElement(cr,{className:Cn("recharts-reference-line",y)},qGe(m,de),ta.renderCallByParent(e,cGe({x1:H,y1:B,x2:Y,y2:Q})))}var iL=function(e){function n(){return jGe(this,n),VGe(this,n,arguments)}return WGe(n,e),UGe(n,[{key:"render",value:function(){return me.createElement(JGe,this.props)}}])}(me.Component);rL(iL,"displayName","ReferenceLine");rL(iL,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function wD(){return wD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},wD.apply(this,arguments)}function gm(e){"@babel/helpers - typeof";return gm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},gm(e)}function M9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function U9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?M9(Object(a),!0).forEach(function(o){xT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):M9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function QGe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ZGe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Wee(o.key),o)}}function e$e(e,n,a){return n&&ZGe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function t$e(e,n,a){return n=ex(n),n$e(e,Bee()?Reflect.construct(n,a||[],ex(e).constructor):n.apply(e,a))}function n$e(e,n){if(n&&(gm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return r$e(e)}function r$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Bee=function(){return!!e})()}function ex(e){return ex=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ex(e)}function i$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&xD(e,n)}function xD(e,n){return xD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},xD(e,n)}function xT(e,n,a){return n=Wee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Wee(e){var n=a$e(e,"string");return gm(n)=="symbol"?n:n+""}function a$e(e,n){if(gm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(gm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var s$e=function(n){var a=n.x,o=n.y,l=n.xAxis,p=n.yAxis,m=Q2({x:l.scale,y:p.scale}),y=m.apply({x:a,y:o},{bandAware:!0});return Dc(n,"discard")&&!m.isInRange(y)?null:y},TT=function(e){function n(){return QGe(this,n),t$e(this,n,arguments)}return i$e(n,e),e$e(n,[{key:"render",value:function(){var o=this.props,l=o.x,p=o.y,m=o.r,y=o.alwaysShow,E=o.clipPathId,b=pi(l),T=pi(p);if(pl(y===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!b||!T)return null;var x=s$e(this.props);if(!x)return null;var A=x.x,D=x.y,N=this.props,L=N.shape,P=N.className,U=Dc(this.props,"hidden")?"url(#".concat(E,")"):void 0,V=U9(U9({clipPath:U},un(this.props,!0)),{},{cx:A,cy:D});return me.createElement(cr,{className:Cn("recharts-reference-dot",P)},n.renderDot(L,V),ta.renderCallByParent(this.props,{x:A-m,y:D-m,width:2*m,height:2*m}))}}])}(me.Component);xT(TT,"displayName","ReferenceDot");xT(TT,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});xT(TT,"renderDot",function(e,n){var a;return me.isValidElement(e)?a=me.cloneElement(e,n):sn(e)?a=e(n):a=me.createElement(ET,wD({},n,{cx:n.cx,cy:n.cy,className:"recharts-reference-dot-dot"})),a});function TD(){return TD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},TD.apply(this,arguments)}function vm(e){"@babel/helpers - typeof";return vm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vm(e)}function V9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function F9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?V9(Object(a),!0).forEach(function(o){CT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):V9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function o$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function c$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,$ee(o.key),o)}}function l$e(e,n,a){return n&&c$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d$e(e,n,a){return n=tx(n),u$e(e,Gee()?Reflect.construct(n,a||[],tx(e).constructor):n.apply(e,a))}function u$e(e,n){if(n&&(vm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return h$e(e)}function h$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Gee=function(){return!!e})()}function tx(e){return tx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},tx(e)}function p$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&CD(e,n)}function CD(e,n){return CD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},CD(e,n)}function CT(e,n,a){return n=$ee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function $ee(e){var n=f$e(e,"string");return vm(n)=="symbol"?n:n+""}function f$e(e,n){if(vm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(vm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var m$e=function(n,a,o,l,p){var m=p.x1,y=p.x2,E=p.y1,b=p.y2,T=p.xAxis,x=p.yAxis;if(!T||!x)return null;var A=Q2({x:T.scale,y:x.scale}),D={x:n?A.x.apply(m,{position:"start"}):A.x.rangeMin,y:o?A.y.apply(E,{position:"start"}):A.y.rangeMin},N={x:a?A.x.apply(y,{position:"end"}):A.x.rangeMax,y:l?A.y.apply(b,{position:"end"}):A.y.rangeMax};return Dc(p,"discard")&&(!A.isInRange(D)||!A.isInRange(N))?null:Oee(D,N)},RT=function(e){function n(){return o$e(this,n),d$e(this,n,arguments)}return p$e(n,e),l$e(n,[{key:"render",value:function(){var o=this.props,l=o.x1,p=o.x2,m=o.y1,y=o.y2,E=o.className,b=o.alwaysShow,T=o.clipPathId;pl(b===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var x=pi(l),A=pi(p),D=pi(m),N=pi(y),L=this.props.shape;if(!x&&!A&&!D&&!N&&!L)return null;var P=m$e(x,A,D,N,this.props);if(!P&&!L)return null;var U=Dc(this.props,"hidden")?"url(#".concat(T,")"):void 0;return me.createElement(cr,{className:Cn("recharts-reference-area",E)},n.renderRect(L,F9(F9({clipPath:U},un(this.props,!0)),P)),ta.renderCallByParent(this.props,P))}}])}(me.Component);CT(RT,"displayName","ReferenceArea");CT(RT,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});CT(RT,"renderRect",function(e,n){var a;return me.isValidElement(e)?a=me.cloneElement(e,n):sn(e)?a=e(n):a=me.createElement(J2,TD({},n,{className:"recharts-reference-area-rect"})),a});function Hee(e,n,a){if(n<1)return[];if(n===1&&a===void 0)return e;for(var o=[],l=0;l<e.length;l+=n)o.push(e[l]);return o}function g$e(e,n,a){var o={width:e.width+n.width,height:e.height+n.height};return dGe(o,a)}function v$e(e,n,a){var o=a==="width",l=e.x,p=e.y,m=e.width,y=e.height;return n===1?{start:o?l:p,end:o?l+m:p+y}:{start:o?l+m:p+y,end:o?l:p}}function nx(e,n,a,o,l){if(e*n<e*o||e*n>e*l)return!1;var p=a();return e*(n-e*p/2-o)>=0&&e*(n+e*p/2-l)<=0}function y$e(e,n){return Hee(e,n+1)}function _$e(e,n,a,o,l){for(var p=(o||[]).slice(),m=n.start,y=n.end,E=0,b=1,T=m,x=function(){var N=o==null?void 0:o[E];if(N===void 0)return{v:Hee(o,b)};var L=E,P,U=function(){return P===void 0&&(P=a(N,L)),P},V=N.coordinate,F=E===0||nx(e,V,U,T,y);F||(E=0,T=m,b+=1),F&&(T=V+e*(U()/2+l),E+=b)},A;b<=p.length;)if(A=x(),A)return A.v;return[]}function c_(e){"@babel/helpers - typeof";return c_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},c_(e)}function B9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Qi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?B9(Object(a),!0).forEach(function(o){E$e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):B9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function E$e(e,n,a){return n=b$e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function b$e(e){var n=S$e(e,"string");return c_(n)=="symbol"?n:n+""}function S$e(e,n){if(c_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(c_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function w$e(e,n,a,o,l){for(var p=(o||[]).slice(),m=p.length,y=n.start,E=n.end,b=function(A){var D=p[A],N,L=function(){return N===void 0&&(N=a(D,A)),N};if(A===m-1){var P=e*(D.coordinate+e*L()/2-E);p[A]=D=Qi(Qi({},D),{},{tickCoord:P>0?D.coordinate-P*e:D.coordinate})}else p[A]=D=Qi(Qi({},D),{},{tickCoord:D.coordinate});var U=nx(e,D.tickCoord,L,y,E);U&&(E=D.tickCoord-e*(L()/2+l),p[A]=Qi(Qi({},D),{},{isShow:!0}))},T=m-1;T>=0;T--)b(T);return p}function x$e(e,n,a,o,l,p){var m=(o||[]).slice(),y=m.length,E=n.start,b=n.end;if(p){var T=o[y-1],x=a(T,y-1),A=e*(T.coordinate+e*x/2-b);m[y-1]=T=Qi(Qi({},T),{},{tickCoord:A>0?T.coordinate-A*e:T.coordinate});var D=nx(e,T.tickCoord,function(){return x},E,b);D&&(b=T.tickCoord-e*(x/2+l),m[y-1]=Qi(Qi({},T),{},{isShow:!0}))}for(var N=p?y-1:y,L=function(V){var F=m[V],H,B=function(){return H===void 0&&(H=a(F,V)),H};if(V===0){var z=e*(F.coordinate-e*B()/2-E);m[V]=F=Qi(Qi({},F),{},{tickCoord:z<0?F.coordinate-z*e:F.coordinate})}else m[V]=F=Qi(Qi({},F),{},{tickCoord:F.coordinate});var Y=nx(e,F.tickCoord,B,E,b);Y&&(E=F.tickCoord+e*(B()/2+l),m[V]=Qi(Qi({},F),{},{isShow:!0}))},P=0;P<N;P++)L(P);return m}function aL(e,n,a){var o=e.tick,l=e.ticks,p=e.viewBox,m=e.minTickGap,y=e.orientation,E=e.interval,b=e.tickFormatter,T=e.unit,x=e.angle;if(!l||!l.length||!o)return[];if(nt(E)||Lh.isSsr)return y$e(l,typeof E=="number"&&nt(E)?E:0);var A=[],D=y==="top"||y==="bottom"?"width":"height",N=T&&D==="width"?ay(T,{fontSize:n,letterSpacing:a}):{width:0,height:0},L=function(F,H){var B=sn(b)?b(F.value,H):F.value;return D==="width"?g$e(ay(B,{fontSize:n,letterSpacing:a}),N,x):ay(B,{fontSize:n,letterSpacing:a})[D]},P=l.length>=2?Go(l[1].coordinate-l[0].coordinate):1,U=v$e(p,P,D);return E==="equidistantPreserveStart"?_$e(P,U,L,l,m):(E==="preserveStart"||E==="preserveStartEnd"?A=x$e(P,U,L,l,m,E==="preserveStartEnd"):A=w$e(P,U,L,l,m),A.filter(function(V){return V.isShow}))}var T$e=["viewBox"],C$e=["viewBox"],R$e=["ticks"];function ym(e){"@babel/helpers - typeof";return ym=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ym(e)}function Pf(){return Pf=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Pf.apply(this,arguments)}function W9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function oi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?W9(Object(a),!0).forEach(function(o){sL(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function JI(e,n){if(e==null)return{};var a=A$e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function A$e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function N$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function G9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Kee(o.key),o)}}function O$e(e,n,a){return n&&G9(e.prototype,n),a&&G9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function I$e(e,n,a){return n=rx(n),P$e(e,zee()?Reflect.construct(n,a||[],rx(e).constructor):n.apply(e,a))}function P$e(e,n){if(n&&(ym(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D$e(e)}function D$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zee=function(){return!!e})()}function rx(e){return rx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},rx(e)}function k$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&RD(e,n)}function RD(e,n){return RD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},RD(e,n)}function sL(e,n,a){return n=Kee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Kee(e){var n=L$e(e,"string");return ym(n)=="symbol"?n:n+""}function L$e(e,n){if(ym(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(ym(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Km=function(e){function n(a){var o;return N$e(this,n),o=I$e(this,n,[a]),o.state={fontSize:"",letterSpacing:""},o}return k$e(n,e),O$e(n,[{key:"shouldComponentUpdate",value:function(o,l){var p=o.viewBox,m=JI(o,T$e),y=this.props,E=y.viewBox,b=JI(y,C$e);return!Ff(p,E)||!Ff(m,b)||!Ff(l,this.state)}},{key:"componentDidMount",value:function(){var o=this.layerReference;if(o){var l=o.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];l&&this.setState({fontSize:window.getComputedStyle(l).fontSize,letterSpacing:window.getComputedStyle(l).letterSpacing})}}},{key:"getTickLineCoord",value:function(o){var l=this.props,p=l.x,m=l.y,y=l.width,E=l.height,b=l.orientation,T=l.tickSize,x=l.mirror,A=l.tickMargin,D,N,L,P,U,V,F=x?-1:1,H=o.tickSize||T,B=nt(o.tickCoord)?o.tickCoord:o.coordinate;switch(b){case"top":D=N=o.coordinate,P=m+ +!x*E,L=P-F*H,V=L-F*A,U=B;break;case"left":L=P=o.coordinate,N=p+ +!x*y,D=N-F*H,U=D-F*A,V=B;break;case"right":L=P=o.coordinate,N=p+ +x*y,D=N+F*H,U=D+F*A,V=B;break;default:D=N=o.coordinate,P=m+ +x*E,L=P+F*H,V=L+F*A,U=B;break}return{line:{x1:D,y1:L,x2:N,y2:P},tick:{x:U,y:V}}}},{key:"getTickTextAnchor",value:function(){var o=this.props,l=o.orientation,p=o.mirror,m;switch(l){case"left":m=p?"start":"end";break;case"right":m=p?"end":"start";break;default:m="middle";break}return m}},{key:"getTickVerticalAnchor",value:function(){var o=this.props,l=o.orientation,p=o.mirror,m="end";switch(l){case"left":case"right":m="middle";break;case"top":m=p?"start":"end";break;default:m=p?"end":"start";break}return m}},{key:"renderAxisLine",value:function(){var o=this.props,l=o.x,p=o.y,m=o.width,y=o.height,E=o.orientation,b=o.mirror,T=o.axisLine,x=oi(oi(oi({},un(this.props,!1)),un(T,!1)),{},{fill:"none"});if(E==="top"||E==="bottom"){var A=+(E==="top"&&!b||E==="bottom"&&b);x=oi(oi({},x),{},{x1:l,y1:p+A*y,x2:l+m,y2:p+A*y})}else{var D=+(E==="left"&&!b||E==="right"&&b);x=oi(oi({},x),{},{x1:l+D*m,y1:p,x2:l+D*m,y2:p+y})}return me.createElement("line",Pf({},x,{className:Cn("recharts-cartesian-axis-line",Js(T,"className"))}))}},{key:"renderTicks",value:function(o,l,p){var m=this,y=this.props,E=y.tickLine,b=y.stroke,T=y.tick,x=y.tickFormatter,A=y.unit,D=aL(oi(oi({},this.props),{},{ticks:o}),l,p),N=this.getTickTextAnchor(),L=this.getTickVerticalAnchor(),P=un(this.props,!1),U=un(T,!1),V=oi(oi({},P),{},{fill:"none"},un(E,!1)),F=D.map(function(H,B){var z=m.getTickLineCoord(H),Y=z.line,Q=z.tick,re=oi(oi(oi(oi({textAnchor:N,verticalAnchor:L},P),{},{stroke:"none",fill:b},U),Q),{},{index:B,payload:H,visibleTicksCount:D.length,tickFormatter:x});return me.createElement(cr,Pf({className:"recharts-cartesian-axis-tick",key:"tick-".concat(H.value,"-").concat(H.coordinate,"-").concat(H.tickCoord)},lw(m.props,H,B)),E&&me.createElement("line",Pf({},V,Y,{className:Cn("recharts-cartesian-axis-tick-line",Js(E,"className"))})),T&&n.renderTickItem(T,re,"".concat(sn(x)?x(H.value,B):H.value).concat(A||"")))});return me.createElement("g",{className:"recharts-cartesian-axis-ticks"},F)}},{key:"render",value:function(){var o=this,l=this.props,p=l.axisLine,m=l.width,y=l.height,E=l.ticksGenerator,b=l.className,T=l.hide;if(T)return null;var x=this.props,A=x.ticks,D=JI(x,R$e),N=A;return sn(E)&&(N=A&&A.length>0?E(this.props):E(D)),m<=0||y<=0||!N||!N.length?null:me.createElement(cr,{className:Cn("recharts-cartesian-axis",b),ref:function(P){o.layerReference=P}},p&&this.renderAxisLine(),this.renderTicks(N,this.state.fontSize,this.state.letterSpacing),ta.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(o,l,p){var m,y=Cn(l.className,"recharts-cartesian-axis-tick-value");return me.isValidElement(o)?m=me.cloneElement(o,oi(oi({},l),{},{className:y})):sn(o)?m=o(oi(oi({},l),{},{className:y})):m=me.createElement(xw,Pf({},l,{className:"recharts-cartesian-axis-tick-value"}),p),m}}])}(J.Component);sL(Km,"displayName","CartesianAxis");sL(Km,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var j$e=["x1","y1","x2","y2","key"],M$e=["offset"];function Ih(e){"@babel/helpers - typeof";return Ih=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ih(e)}function $9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function na(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?$9(Object(a),!0).forEach(function(o){U$e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function U$e(e,n,a){return n=V$e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function V$e(e){var n=F$e(e,"string");return Ih(n)=="symbol"?n:n+""}function F$e(e,n){if(Ih(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Ih(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function dh(){return dh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},dh.apply(this,arguments)}function H9(e,n){if(e==null)return{};var a=B$e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function B$e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var W$e=function(n){var a=n.fill;if(!a||a==="none")return null;var o=n.fillOpacity,l=n.x,p=n.y,m=n.width,y=n.height,E=n.ry;return me.createElement("rect",{x:l,y:p,ry:E,width:m,height:y,stroke:"none",fill:a,fillOpacity:o,className:"recharts-cartesian-grid-bg"})};function Yee(e,n){var a;if(me.isValidElement(e))a=me.cloneElement(e,n);else if(sn(e))a=e(n);else{var o=n.x1,l=n.y1,p=n.x2,m=n.y2,y=n.key,E=H9(n,j$e),b=un(E,!1);b.offset;var T=H9(b,M$e);a=me.createElement("line",dh({},T,{x1:o,y1:l,x2:p,y2:m,fill:"none",key:y}))}return a}function G$e(e){var n=e.x,a=e.width,o=e.horizontal,l=o===void 0?!0:o,p=e.horizontalPoints;if(!l||!p||!p.length)return null;var m=p.map(function(y,E){var b=na(na({},e),{},{x1:n,y1:y,x2:n+a,y2:y,key:"line-".concat(E),index:E});return Yee(l,b)});return me.createElement("g",{className:"recharts-cartesian-grid-horizontal"},m)}function $$e(e){var n=e.y,a=e.height,o=e.vertical,l=o===void 0?!0:o,p=e.verticalPoints;if(!l||!p||!p.length)return null;var m=p.map(function(y,E){var b=na(na({},e),{},{x1:y,y1:n,x2:y,y2:n+a,key:"line-".concat(E),index:E});return Yee(l,b)});return me.createElement("g",{className:"recharts-cartesian-grid-vertical"},m)}function H$e(e){var n=e.horizontalFill,a=e.fillOpacity,o=e.x,l=e.y,p=e.width,m=e.height,y=e.horizontalPoints,E=e.horizontal,b=E===void 0?!0:E;if(!b||!n||!n.length)return null;var T=y.map(function(A){return Math.round(A+l-l)}).sort(function(A,D){return A-D});l!==T[0]&&T.unshift(0);var x=T.map(function(A,D){var N=!T[D+1],L=N?l+m-A:T[D+1]-A;if(L<=0)return null;var P=D%n.length;return me.createElement("rect",{key:"react-".concat(D),y:A,x:o,height:L,width:p,stroke:"none",fill:n[P],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return me.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},x)}function z$e(e){var n=e.vertical,a=n===void 0?!0:n,o=e.verticalFill,l=e.fillOpacity,p=e.x,m=e.y,y=e.width,E=e.height,b=e.verticalPoints;if(!a||!o||!o.length)return null;var T=b.map(function(A){return Math.round(A+p-p)}).sort(function(A,D){return A-D});p!==T[0]&&T.unshift(0);var x=T.map(function(A,D){var N=!T[D+1],L=N?p+y-A:T[D+1]-A;if(L<=0)return null;var P=D%o.length;return me.createElement("rect",{key:"react-".concat(D),x:A,y:m,width:L,height:E,stroke:"none",fill:o[P],fillOpacity:l,className:"recharts-cartesian-grid-bg"})});return me.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},x)}var K$e=function(n,a){var o=n.xAxis,l=n.width,p=n.height,m=n.offset;return ree(aL(na(na(na({},Km.defaultProps),o),{},{ticks:dl(o,!0),viewBox:{x:0,y:0,width:l,height:p}})),m.left,m.left+m.width,a)},Y$e=function(n,a){var o=n.yAxis,l=n.width,p=n.height,m=n.offset;return ree(aL(na(na(na({},Km.defaultProps),o),{},{ticks:dl(o,!0),viewBox:{x:0,y:0,width:l,height:p}})),m.top,m.top+m.height,a)},mf={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function l_(e){var n,a,o,l,p,m,y=tL(),E=nL(),b=LGe(),T=na(na({},e),{},{stroke:(n=e.stroke)!==null&&n!==void 0?n:mf.stroke,fill:(a=e.fill)!==null&&a!==void 0?a:mf.fill,horizontal:(o=e.horizontal)!==null&&o!==void 0?o:mf.horizontal,horizontalFill:(l=e.horizontalFill)!==null&&l!==void 0?l:mf.horizontalFill,vertical:(p=e.vertical)!==null&&p!==void 0?p:mf.vertical,verticalFill:(m=e.verticalFill)!==null&&m!==void 0?m:mf.verticalFill,x:nt(e.x)?e.x:b.left,y:nt(e.y)?e.y:b.top,width:nt(e.width)?e.width:b.width,height:nt(e.height)?e.height:b.height}),x=T.x,A=T.y,D=T.width,N=T.height,L=T.syncWithTicks,P=T.horizontalValues,U=T.verticalValues,V=PGe(),F=DGe();if(!nt(D)||D<=0||!nt(N)||N<=0||!nt(x)||x!==+x||!nt(A)||A!==+A)return null;var H=T.verticalCoordinatesGenerator||K$e,B=T.horizontalCoordinatesGenerator||Y$e,z=T.horizontalPoints,Y=T.verticalPoints;if((!z||!z.length)&&sn(B)){var Q=P&&P.length,re=B({yAxis:F?na(na({},F),{},{ticks:Q?P:F.ticks}):void 0,width:y,height:E,offset:b},Q?!0:L);pl(Array.isArray(re),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Ih(re),"]")),Array.isArray(re)&&(z=re)}if((!Y||!Y.length)&&sn(H)){var de=U&&U.length,le=H({xAxis:V?na(na({},V),{},{ticks:de?U:V.ticks}):void 0,width:y,height:E,offset:b},de?!0:L);pl(Array.isArray(le),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Ih(le),"]")),Array.isArray(le)&&(Y=le)}return me.createElement("g",{className:"recharts-cartesian-grid"},me.createElement(W$e,{fill:T.fill,fillOpacity:T.fillOpacity,x:T.x,y:T.y,width:T.width,height:T.height,ry:T.ry}),me.createElement(G$e,dh({},T,{offset:b,horizontalPoints:z,xAxis:V,yAxis:F})),me.createElement($$e,dh({},T,{offset:b,verticalPoints:Y,xAxis:V,yAxis:F})),me.createElement(H$e,dh({},T,{horizontalPoints:z})),me.createElement(z$e,dh({},T,{verticalPoints:Y})))}l_.displayName="CartesianGrid";var q$e=["type","layout","connectNulls","ref"],X$e=["key"];function _m(e){"@babel/helpers - typeof";return _m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_m(e)}function z9(e,n){if(e==null)return{};var a=J$e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function J$e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function ly(){return ly=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},ly.apply(this,arguments)}function K9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function os(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?K9(Object(a),!0).forEach(function(o){Vo(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):K9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function gf(e){return tHe(e)||eHe(e)||Z$e(e)||Q$e()}function Q$e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z$e(e,n){if(e){if(typeof e=="string")return AD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return AD(e,n)}}function eHe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function tHe(e){if(Array.isArray(e))return AD(e)}function AD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function nHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Y9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Xee(o.key),o)}}function rHe(e,n,a){return n&&Y9(e.prototype,n),a&&Y9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function iHe(e,n,a){return n=ix(n),aHe(e,qee()?Reflect.construct(n,a||[],ix(e).constructor):n.apply(e,a))}function aHe(e,n){if(n&&(_m(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sHe(e)}function sHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qee=function(){return!!e})()}function ix(e){return ix=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ix(e)}function oHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&ND(e,n)}function ND(e,n){return ND=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},ND(e,n)}function Vo(e,n,a){return n=Xee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Xee(e){var n=cHe(e,"string");return _m(n)=="symbol"?n:n+""}function cHe(e,n){if(_m(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(_m(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Ym=function(e){function n(){var a;nHe(this,n);for(var o=arguments.length,l=new Array(o),p=0;p<o;p++)l[p]=arguments[p];return a=iHe(this,n,[].concat(l)),Vo(a,"state",{isAnimationFinished:!0,totalLength:0}),Vo(a,"generateSimpleStrokeDasharray",function(m,y){return"".concat(y,"px ").concat(m-y,"px")}),Vo(a,"getStrokeDasharray",function(m,y,E){var b=E.reduce(function(U,V){return U+V});if(!b)return a.generateSimpleStrokeDasharray(y,m);for(var T=Math.floor(m/b),x=m%b,A=y-m,D=[],N=0,L=0;N<E.length;L+=E[N],++N)if(L+E[N]>x){D=[].concat(gf(E.slice(0,N)),[x-L]);break}var P=D.length%2===0?[0,A]:[A];return[].concat(gf(n.repeat(E,T)),gf(D),P).map(function(U){return"".concat(U,"px")}).join(", ")}),Vo(a,"id",Fm("recharts-line-")),Vo(a,"pathRef",function(m){a.mainCurve=m}),Vo(a,"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0}),a.props.onAnimationEnd&&a.props.onAnimationEnd()}),Vo(a,"handleAnimationStart",function(){a.setState({isAnimationFinished:!1}),a.props.onAnimationStart&&a.props.onAnimationStart()}),a}return oHe(n,e),rHe(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();this.setState({totalLength:o})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();o!==this.state.totalLength&&this.setState({totalLength:o})}}},{key:"getTotalLength",value:function(){var o=this.mainCurve;try{return o&&o.getTotalLength&&o.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(o,l){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var p=this.props,m=p.points,y=p.xAxis,E=p.yAxis,b=p.layout,T=p.children,x=Qs(T,I_);if(!x)return null;var A=function(L,P){return{x:L.x,y:L.y,value:L.value,errorVal:ya(L.payload,P)}},D={clipPath:o?"url(#clipPath-".concat(l,")"):null};return me.createElement(cr,D,x.map(function(N){return me.cloneElement(N,{key:"bar-".concat(N.props.dataKey),data:m,xAxis:y,yAxis:E,layout:b,dataPointFormatter:A})}))}},{key:"renderDots",value:function(o,l,p){var m=this.props.isAnimationActive;if(m&&!this.state.isAnimationFinished)return null;var y=this.props,E=y.dot,b=y.points,T=y.dataKey,x=un(this.props,!1),A=un(E,!0),D=b.map(function(L,P){var U=os(os(os({key:"dot-".concat(P),r:3},x),A),{},{index:P,cx:L.x,cy:L.y,value:L.value,dataKey:T,payload:L.payload,points:b});return n.renderDotItem(E,U)}),N={clipPath:o?"url(#clipPath-".concat(l?"":"dots-").concat(p,")"):null};return me.createElement(cr,ly({className:"recharts-line-dots",key:"dots"},N),D)}},{key:"renderCurveStatically",value:function(o,l,p,m){var y=this.props,E=y.type,b=y.layout,T=y.connectNulls;y.ref;var x=z9(y,q$e),A=os(os(os({},un(x,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:l?"url(#clipPath-".concat(p,")"):null,points:o},m),{},{type:E,layout:b,connectNulls:T});return me.createElement($f,ly({},A,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(o,l){var p=this,m=this.props,y=m.points,E=m.strokeDasharray,b=m.isAnimationActive,T=m.animationBegin,x=m.animationDuration,A=m.animationEasing,D=m.animationId,N=m.animateNewValues,L=m.width,P=m.height,U=this.state,V=U.prevPoints,F=U.totalLength;return me.createElement(jc,{begin:T,duration:x,isActive:b,easing:A,from:{t:0},to:{t:1},key:"line-".concat(D),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(H){var B=H.t;if(V){var z=V.length/y.length,Y=y.map(function(he,Re){var ve=Math.floor(Re*z);if(V[ve]){var we=V[ve],ue=Vi(we.x,he.x),be=Vi(we.y,he.y);return os(os({},he),{},{x:ue(B),y:be(B)})}if(N){var ae=Vi(L*2,he.x),ce=Vi(P/2,he.y);return os(os({},he),{},{x:ae(B),y:ce(B)})}return os(os({},he),{},{x:he.x,y:he.y})});return p.renderCurveStatically(Y,o,l)}var Q=Vi(0,F),re=Q(B),de;if(E){var le="".concat(E).split(/[,\s]+/gim).map(function(he){return parseFloat(he)});de=p.getStrokeDasharray(re,F,le)}else de=p.generateSimpleStrokeDasharray(F,re);return p.renderCurveStatically(y,o,l,{strokeDasharray:de})})}},{key:"renderCurve",value:function(o,l){var p=this.props,m=p.points,y=p.isAnimationActive,E=this.state,b=E.prevPoints,T=E.totalLength;return y&&m&&m.length&&(!b&&T>0||!lm(b,m))?this.renderCurveWithAnimation(o,l):this.renderCurveStatically(m,o,l)}},{key:"render",value:function(){var o,l=this.props,p=l.hide,m=l.dot,y=l.points,E=l.className,b=l.xAxis,T=l.yAxis,x=l.top,A=l.left,D=l.width,N=l.height,L=l.isAnimationActive,P=l.id;if(p||!y||!y.length)return null;var U=this.state.isAnimationFinished,V=y.length===1,F=Cn("recharts-line",E),H=b&&b.allowDataOverflow,B=T&&T.allowDataOverflow,z=H||B,Y=pn(P)?this.id:P,Q=(o=un(m,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},re=Q.r,de=re===void 0?3:re,le=Q.strokeWidth,he=le===void 0?2:le,Re=qJ(m)?m:{},ve=Re.clipDot,we=ve===void 0?!0:ve,ue=de*2+he;return me.createElement(cr,{className:F},H||B?me.createElement("defs",null,me.createElement("clipPath",{id:"clipPath-".concat(Y)},me.createElement("rect",{x:H?A:A-D/2,y:B?x:x-N/2,width:H?D:D*2,height:B?N:N*2})),!we&&me.createElement("clipPath",{id:"clipPath-dots-".concat(Y)},me.createElement("rect",{x:A-ue/2,y:x-ue/2,width:D+ue,height:N+ue}))):null,!V&&this.renderCurve(z,Y),this.renderErrorBar(z,Y),(V||m)&&this.renderDots(z,we,Y),(!L||U)&&ml.renderCallByParent(this.props,y))}}],[{key:"getDerivedStateFromProps",value:function(o,l){return o.animationId!==l.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,prevPoints:l.curPoints}:o.points!==l.curPoints?{curPoints:o.points}:null}},{key:"repeat",value:function(o,l){for(var p=o.length%2!==0?[].concat(gf(o),[0]):o,m=[],y=0;y<l;++y)m=[].concat(gf(m),gf(p));return m}},{key:"renderDotItem",value:function(o,l){var p;if(me.isValidElement(o))p=me.cloneElement(o,l);else if(sn(o))p=o(l);else{var m=l.key,y=z9(l,X$e),E=Cn("recharts-line-dot",typeof o!="boolean"?o.className:"");p=me.createElement(ET,ly({key:m},y,{className:E}))}return p}}])}(J.PureComponent);Vo(Ym,"displayName","Line");Vo(Ym,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Lh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Vo(Ym,"getComposedData",function(e){var n=e.props,a=e.xAxis,o=e.yAxis,l=e.xAxisTicks,p=e.yAxisTicks,m=e.dataKey,y=e.bandSize,E=e.displayedData,b=e.offset,T=n.layout,x=E.map(function(A,D){var N=ya(A,m);return T==="horizontal"?{x:Uw({axis:a,ticks:l,bandSize:y,entry:A,index:D}),y:pn(N)?null:o.scale(N),value:N,payload:A}:{x:pn(N)?null:a.scale(N),y:Uw({axis:o,ticks:p,bandSize:y,entry:A,index:D}),value:N,payload:A}});return os({points:x,layout:T},b)});var lHe=["layout","type","stroke","connectNulls","isRange","ref"],dHe=["key"],Jee;function Em(e){"@babel/helpers - typeof";return Em=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Em(e)}function Qee(e,n){if(e==null)return{};var a=uHe(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function uHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function uh(){return uh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},uh.apply(this,arguments)}function q9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function hd(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?q9(Object(a),!0).forEach(function(o){Nc(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):q9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function hHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function X9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ete(o.key),o)}}function pHe(e,n,a){return n&&X9(e.prototype,n),a&&X9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function fHe(e,n,a){return n=ax(n),mHe(e,Zee()?Reflect.construct(n,a||[],ax(e).constructor):n.apply(e,a))}function mHe(e,n){if(n&&(Em(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gHe(e)}function gHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zee=function(){return!!e})()}function ax(e){return ax=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ax(e)}function vHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&OD(e,n)}function OD(e,n){return OD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},OD(e,n)}function Nc(e,n,a){return n=ete(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ete(e){var n=yHe(e,"string");return Em(n)=="symbol"?n:n+""}function yHe(e,n){if(Em(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Em(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Il=function(e){function n(){var a;hHe(this,n);for(var o=arguments.length,l=new Array(o),p=0;p<o;p++)l[p]=arguments[p];return a=fHe(this,n,[].concat(l)),Nc(a,"state",{isAnimationFinished:!0}),Nc(a,"id",Fm("recharts-area-")),Nc(a,"handleAnimationEnd",function(){var m=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),sn(m)&&m()}),Nc(a,"handleAnimationStart",function(){var m=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),sn(m)&&m()}),a}return vHe(n,e),pHe(n,[{key:"renderDots",value:function(o,l,p){var m=this.props.isAnimationActive,y=this.state.isAnimationFinished;if(m&&!y)return null;var E=this.props,b=E.dot,T=E.points,x=E.dataKey,A=un(this.props,!1),D=un(b,!0),N=T.map(function(P,U){var V=hd(hd(hd({key:"dot-".concat(U),r:3},A),D),{},{index:U,cx:P.x,cy:P.y,dataKey:x,value:P.value,payload:P.payload,points:T});return n.renderDotItem(b,V)}),L={clipPath:o?"url(#clipPath-".concat(l?"":"dots-").concat(p,")"):null};return me.createElement(cr,uh({className:"recharts-area-dots"},L),N)}},{key:"renderHorizontalRect",value:function(o){var l=this.props,p=l.baseLine,m=l.points,y=l.strokeWidth,E=m[0].x,b=m[m.length-1].x,T=o*Math.abs(E-b),x=Td(m.map(function(A){return A.y||0}));return nt(p)&&typeof p=="number"?x=Math.max(p,x):p&&Array.isArray(p)&&p.length&&(x=Math.max(Td(p.map(function(A){return A.y||0})),x)),nt(x)?me.createElement("rect",{x:E<b?E:E-T,y:0,width:T,height:Math.floor(x+(y?parseInt("".concat(y),10):1))}):null}},{key:"renderVerticalRect",value:function(o){var l=this.props,p=l.baseLine,m=l.points,y=l.strokeWidth,E=m[0].y,b=m[m.length-1].y,T=o*Math.abs(E-b),x=Td(m.map(function(A){return A.x||0}));return nt(p)&&typeof p=="number"?x=Math.max(p,x):p&&Array.isArray(p)&&p.length&&(x=Math.max(Td(p.map(function(A){return A.x||0})),x)),nt(x)?me.createElement("rect",{x:0,y:E<b?E:E-T,width:x+(y?parseInt("".concat(y),10):1),height:Math.floor(T)}):null}},{key:"renderClipRect",value:function(o){var l=this.props.layout;return l==="vertical"?this.renderVerticalRect(o):this.renderHorizontalRect(o)}},{key:"renderAreaStatically",value:function(o,l,p,m){var y=this.props,E=y.layout,b=y.type,T=y.stroke,x=y.connectNulls,A=y.isRange;y.ref;var D=Qee(y,lHe);return me.createElement(cr,{clipPath:p?"url(#clipPath-".concat(m,")"):null},me.createElement($f,uh({},un(D,!0),{points:o,connectNulls:x,type:b,baseLine:l,layout:E,stroke:"none",className:"recharts-area-area"})),T!=="none"&&me.createElement($f,uh({},un(this.props,!1),{className:"recharts-area-curve",layout:E,type:b,connectNulls:x,fill:"none",points:o})),T!=="none"&&A&&me.createElement($f,uh({},un(this.props,!1),{className:"recharts-area-curve",layout:E,type:b,connectNulls:x,fill:"none",points:l})))}},{key:"renderAreaWithAnimation",value:function(o,l){var p=this,m=this.props,y=m.points,E=m.baseLine,b=m.isAnimationActive,T=m.animationBegin,x=m.animationDuration,A=m.animationEasing,D=m.animationId,N=this.state,L=N.prevPoints,P=N.prevBaseLine;return me.createElement(jc,{begin:T,duration:x,isActive:b,easing:A,from:{t:0},to:{t:1},key:"area-".concat(D),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(U){var V=U.t;if(L){var F=L.length/y.length,H=y.map(function(Q,re){var de=Math.floor(re*F);if(L[de]){var le=L[de],he=Vi(le.x,Q.x),Re=Vi(le.y,Q.y);return hd(hd({},Q),{},{x:he(V),y:Re(V)})}return Q}),B;if(nt(E)&&typeof E=="number"){var z=Vi(P,E);B=z(V)}else if(pn(E)||Vm(E)){var Y=Vi(P,0);B=Y(V)}else B=E.map(function(Q,re){var de=Math.floor(re*F);if(P[de]){var le=P[de],he=Vi(le.x,Q.x),Re=Vi(le.y,Q.y);return hd(hd({},Q),{},{x:he(V),y:Re(V)})}return Q});return p.renderAreaStatically(H,B,o,l)}return me.createElement(cr,null,me.createElement("defs",null,me.createElement("clipPath",{id:"animationClipPath-".concat(l)},p.renderClipRect(V))),me.createElement(cr,{clipPath:"url(#animationClipPath-".concat(l,")")},p.renderAreaStatically(y,E,o,l)))})}},{key:"renderArea",value:function(o,l){var p=this.props,m=p.points,y=p.baseLine,E=p.isAnimationActive,b=this.state,T=b.prevPoints,x=b.prevBaseLine,A=b.totalLength;return E&&m&&m.length&&(!T&&A>0||!lm(T,m)||!lm(x,y))?this.renderAreaWithAnimation(o,l):this.renderAreaStatically(m,y,o,l)}},{key:"render",value:function(){var o,l=this.props,p=l.hide,m=l.dot,y=l.points,E=l.className,b=l.top,T=l.left,x=l.xAxis,A=l.yAxis,D=l.width,N=l.height,L=l.isAnimationActive,P=l.id;if(p||!y||!y.length)return null;var U=this.state.isAnimationFinished,V=y.length===1,F=Cn("recharts-area",E),H=x&&x.allowDataOverflow,B=A&&A.allowDataOverflow,z=H||B,Y=pn(P)?this.id:P,Q=(o=un(m,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},re=Q.r,de=re===void 0?3:re,le=Q.strokeWidth,he=le===void 0?2:le,Re=qJ(m)?m:{},ve=Re.clipDot,we=ve===void 0?!0:ve,ue=de*2+he;return me.createElement(cr,{className:F},H||B?me.createElement("defs",null,me.createElement("clipPath",{id:"clipPath-".concat(Y)},me.createElement("rect",{x:H?T:T-D/2,y:B?b:b-N/2,width:H?D:D*2,height:B?N:N*2})),!we&&me.createElement("clipPath",{id:"clipPath-dots-".concat(Y)},me.createElement("rect",{x:T-ue/2,y:b-ue/2,width:D+ue,height:N+ue}))):null,V?null:this.renderArea(z,Y),(m||V)&&this.renderDots(z,we,Y),(!L||U)&&ml.renderCallByParent(this.props,y))}}],[{key:"getDerivedStateFromProps",value:function(o,l){return o.animationId!==l.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,curBaseLine:o.baseLine,prevPoints:l.curPoints,prevBaseLine:l.curBaseLine}:o.points!==l.curPoints||o.baseLine!==l.curBaseLine?{curPoints:o.points,curBaseLine:o.baseLine}:null}}])}(J.PureComponent);Jee=Il;Nc(Il,"displayName","Area");Nc(Il,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Lh.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});Nc(Il,"getBaseValue",function(e,n,a,o){var l=e.layout,p=e.baseValue,m=n.props.baseValue,y=m??p;if(nt(y)&&typeof y=="number")return y;var E=l==="horizontal"?o:a,b=E.scale.domain();if(E.type==="number"){var T=Math.max(b[0],b[1]),x=Math.min(b[0],b[1]);return y==="dataMin"?x:y==="dataMax"||T<0?T:Math.max(Math.min(b[0],b[1]),0)}return y==="dataMin"?b[0]:y==="dataMax"?b[1]:b[0]});Nc(Il,"getComposedData",function(e){var n=e.props,a=e.item,o=e.xAxis,l=e.yAxis,p=e.xAxisTicks,m=e.yAxisTicks,y=e.bandSize,E=e.dataKey,b=e.stackedData,T=e.dataStartIndex,x=e.displayedData,A=e.offset,D=n.layout,N=b&&b.length,L=Jee.getBaseValue(n,a,o,l),P=D==="horizontal",U=!1,V=x.map(function(H,B){var z;N?z=b[T+B]:(z=ya(H,E),Array.isArray(z)?U=!0:z=[L,z]);var Y=z[1]==null||N&&ya(H,E)==null;return P?{x:Uw({axis:o,ticks:p,bandSize:y,entry:H,index:B}),y:Y?null:l.scale(z[1]),value:z,payload:H}:{x:Y?null:o.scale(z[1]),y:Uw({axis:l,ticks:m,bandSize:y,entry:H,index:B}),value:z,payload:H}}),F;return N||U?F=V.map(function(H){var B=Array.isArray(H.value)?H.value[0]:null;return P?{x:H.x,y:B!=null&&H.y!=null?l.scale(B):null}:{x:B!=null?o.scale(B):null,y:H.y}}):F=P?l.scale(L):o.scale(L),hd({points:V,baseLine:F,layout:D,isRange:U},A)});Nc(Il,"renderDotItem",function(e,n){var a;if(me.isValidElement(e))a=me.cloneElement(e,n);else if(sn(e))a=e(n);else{var o=Cn("recharts-area-dot",typeof e!="boolean"?e.className:""),l=n.key,p=Qee(n,dHe);a=me.createElement(ET,uh({},p,{key:l,className:o}))}return a});function bm(e){"@babel/helpers - typeof";return bm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},bm(e)}function _He(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function EHe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,rte(o.key),o)}}function bHe(e,n,a){return n&&EHe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function SHe(e,n,a){return n=sx(n),wHe(e,tte()?Reflect.construct(n,a||[],sx(e).constructor):n.apply(e,a))}function wHe(e,n){if(n&&(bm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xHe(e)}function xHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tte=function(){return!!e})()}function sx(e){return sx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},sx(e)}function THe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&ID(e,n)}function ID(e,n){return ID=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},ID(e,n)}function nte(e,n,a){return n=rte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function rte(e){var n=CHe(e,"string");return bm(n)=="symbol"?n:n+""}function CHe(e,n){if(bm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(bm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function PD(){return PD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},PD.apply(this,arguments)}function RHe(e){var n=e.xAxisId,a=tL(),o=nL(),l=Mee(n);return l==null?null:J.createElement(Km,PD({},l,{className:Cn("recharts-".concat(l.axisType," ").concat(l.axisType),l.className),viewBox:{x:0,y:0,width:a,height:o},ticksGenerator:function(m){return dl(m,!0)}}))}var Fd=function(e){function n(){return _He(this,n),SHe(this,n,arguments)}return THe(n,e),bHe(n,[{key:"render",value:function(){return J.createElement(RHe,this.props)}}])}(J.Component);nte(Fd,"displayName","XAxis");nte(Fd,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Sm(e){"@babel/helpers - typeof";return Sm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Sm(e)}function AHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function NHe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ste(o.key),o)}}function OHe(e,n,a){return n&&NHe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function IHe(e,n,a){return n=ox(n),PHe(e,ite()?Reflect.construct(n,a||[],ox(e).constructor):n.apply(e,a))}function PHe(e,n){if(n&&(Sm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return DHe(e)}function DHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ite(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ite=function(){return!!e})()}function ox(e){return ox=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ox(e)}function kHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&DD(e,n)}function DD(e,n){return DD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},DD(e,n)}function ate(e,n,a){return n=ste(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ste(e){var n=LHe(e,"string");return Sm(n)=="symbol"?n:n+""}function LHe(e,n){if(Sm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Sm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function kD(){return kD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},kD.apply(this,arguments)}var jHe=function(n){var a=n.yAxisId,o=tL(),l=nL(),p=Uee(a);return p==null?null:J.createElement(Km,kD({},p,{className:Cn("recharts-".concat(p.axisType," ").concat(p.axisType),p.className),viewBox:{x:0,y:0,width:o,height:l},ticksGenerator:function(y){return dl(y,!0)}}))},Bd=function(e){function n(){return AHe(this,n),IHe(this,n,arguments)}return kHe(n,e),OHe(n,[{key:"render",value:function(){return J.createElement(jHe,this.props)}}])}(J.Component);ate(Bd,"displayName","YAxis");ate(Bd,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function J9(e){return FHe(e)||VHe(e)||UHe(e)||MHe()}function MHe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UHe(e,n){if(e){if(typeof e=="string")return LD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return LD(e,n)}}function VHe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function FHe(e){if(Array.isArray(e))return LD(e)}function LD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var jD=function(n,a,o,l,p){var m=Qs(n,iL),y=Qs(n,TT),E=[].concat(J9(m),J9(y)),b=Qs(n,RT),T="".concat(l,"Id"),x=l[0],A=a;if(E.length&&(A=E.reduce(function(L,P){if(P.props[T]===o&&Dc(P.props,"extendDomain")&&nt(P.props[x])){var U=P.props[x];return[Math.min(L[0],U),Math.max(L[1],U)]}return L},A)),b.length){var D="".concat(x,"1"),N="".concat(x,"2");A=b.reduce(function(L,P){if(P.props[T]===o&&Dc(P.props,"extendDomain")&&nt(P.props[D])&&nt(P.props[N])){var U=P.props[D],V=P.props[N];return[Math.min(L[0],U,V),Math.max(L[1],U,V)]}return L},A)}return p&&p.length&&(A=p.reduce(function(L,P){return nt(P)?[Math.min(L[0],P),Math.max(L[1],P)]:L},A)),A},ote={exports:{}};(function(e){var n=Object.prototype.hasOwnProperty,a="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(a=!1));function l(E,b,T){this.fn=E,this.context=b,this.once=T||!1}function p(E,b,T,x,A){if(typeof T!="function")throw new TypeError("The listener must be a function");var D=new l(T,x||E,A),N=a?a+b:b;return E._events[N]?E._events[N].fn?E._events[N]=[E._events[N],D]:E._events[N].push(D):(E._events[N]=D,E._eventsCount++),E}function m(E,b){--E._eventsCount===0?E._events=new o:delete E._events[b]}function y(){this._events=new o,this._eventsCount=0}y.prototype.eventNames=function(){var b=[],T,x;if(this._eventsCount===0)return b;for(x in T=this._events)n.call(T,x)&&b.push(a?x.slice(1):x);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(T)):b},y.prototype.listeners=function(b){var T=a?a+b:b,x=this._events[T];if(!x)return[];if(x.fn)return[x.fn];for(var A=0,D=x.length,N=new Array(D);A<D;A++)N[A]=x[A].fn;return N},y.prototype.listenerCount=function(b){var T=a?a+b:b,x=this._events[T];return x?x.fn?1:x.length:0},y.prototype.emit=function(b,T,x,A,D,N){var L=a?a+b:b;if(!this._events[L])return!1;var P=this._events[L],U=arguments.length,V,F;if(P.fn){switch(P.once&&this.removeListener(b,P.fn,void 0,!0),U){case 1:return P.fn.call(P.context),!0;case 2:return P.fn.call(P.context,T),!0;case 3:return P.fn.call(P.context,T,x),!0;case 4:return P.fn.call(P.context,T,x,A),!0;case 5:return P.fn.call(P.context,T,x,A,D),!0;case 6:return P.fn.call(P.context,T,x,A,D,N),!0}for(F=1,V=new Array(U-1);F<U;F++)V[F-1]=arguments[F];P.fn.apply(P.context,V)}else{var H=P.length,B;for(F=0;F<H;F++)switch(P[F].once&&this.removeListener(b,P[F].fn,void 0,!0),U){case 1:P[F].fn.call(P[F].context);break;case 2:P[F].fn.call(P[F].context,T);break;case 3:P[F].fn.call(P[F].context,T,x);break;case 4:P[F].fn.call(P[F].context,T,x,A);break;default:if(!V)for(B=1,V=new Array(U-1);B<U;B++)V[B-1]=arguments[B];P[F].fn.apply(P[F].context,V)}}return!0},y.prototype.on=function(b,T,x){return p(this,b,T,x,!1)},y.prototype.once=function(b,T,x){return p(this,b,T,x,!0)},y.prototype.removeListener=function(b,T,x,A){var D=a?a+b:b;if(!this._events[D])return this;if(!T)return m(this,D),this;var N=this._events[D];if(N.fn)N.fn===T&&(!A||N.once)&&(!x||N.context===x)&&m(this,D);else{for(var L=0,P=[],U=N.length;L<U;L++)(N[L].fn!==T||A&&!N[L].once||x&&N[L].context!==x)&&P.push(N[L]);P.length?this._events[D]=P.length===1?P[0]:P:m(this,D)}return this},y.prototype.removeAllListeners=function(b){var T;return b?(T=a?a+b:b,this._events[T]&&m(this,T)):(this._events=new o,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=a,y.EventEmitter=y,e.exports=y})(ote);var BHe=ote.exports;const WHe=Zn(BHe);var QI=new WHe,ZI="recharts.syncMouseEvents";function d_(e){"@babel/helpers - typeof";return d_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},d_(e)}function GHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function $He(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,cte(o.key),o)}}function HHe(e,n,a){return n&&$He(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function e1(e,n,a){return n=cte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function cte(e){var n=zHe(e,"string");return d_(n)=="symbol"?n:n+""}function zHe(e,n){if(d_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(d_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var KHe=function(){function e(){GHe(this,e),e1(this,"activeIndex",0),e1(this,"coordinateList",[]),e1(this,"layout","horizontal")}return HHe(e,[{key:"setDetails",value:function(a){var o,l=a.coordinateList,p=l===void 0?null:l,m=a.container,y=m===void 0?null:m,E=a.layout,b=E===void 0?null:E,T=a.offset,x=T===void 0?null:T,A=a.mouseHandlerCallback,D=A===void 0?null:A;this.coordinateList=(o=p??this.coordinateList)!==null&&o!==void 0?o:[],this.container=y??this.container,this.layout=b??this.layout,this.offset=x??this.offset,this.mouseHandlerCallback=D??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(a){if(this.coordinateList.length!==0)switch(a.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(a){this.activeIndex=a}},{key:"spoofMouse",value:function(){var a,o;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var l=this.container.getBoundingClientRect(),p=l.x,m=l.y,y=l.height,E=this.coordinateList[this.activeIndex].coordinate,b=((a=window)===null||a===void 0?void 0:a.scrollX)||0,T=((o=window)===null||o===void 0?void 0:o.scrollY)||0,x=p+E+b,A=m+this.offset.top+y/2+T;this.mouseHandlerCallback({pageX:x,pageY:A})}}}])}();function YHe(e,n,a){if(a==="number"&&n===!0&&Array.isArray(e)){var o=e==null?void 0:e[0],l=e==null?void 0:e[1];if(o&&l&&nt(o)&&nt(l))return!0}return!1}function qHe(e,n,a,o){var l=o/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?n.x-l:a.left+.5,y:e==="horizontal"?a.top+.5:n.y-l,width:e==="horizontal"?o:a.width-1,height:e==="horizontal"?a.height-1:o}}function lte(e){var n=e.cx,a=e.cy,o=e.radius,l=e.startAngle,p=e.endAngle,m=Fi(n,a,o,l),y=Fi(n,a,o,p);return{points:[m,y],cx:n,cy:a,radius:o,startAngle:l,endAngle:p}}function XHe(e,n,a){var o,l,p,m;if(e==="horizontal")o=n.x,p=o,l=a.top,m=a.top+a.height;else if(e==="vertical")l=n.y,m=l,o=a.left,p=a.left+a.width;else if(n.cx!=null&&n.cy!=null)if(e==="centric"){var y=n.cx,E=n.cy,b=n.innerRadius,T=n.outerRadius,x=n.angle,A=Fi(y,E,b,x),D=Fi(y,E,T,x);o=A.x,l=A.y,p=D.x,m=D.y}else return lte(n);return[{x:o,y:l},{x:p,y:m}]}function u_(e){"@babel/helpers - typeof";return u_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},u_(e)}function Q9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function dS(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Q9(Object(a),!0).forEach(function(o){JHe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Q9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function JHe(e,n,a){return n=QHe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function QHe(e){var n=ZHe(e,"string");return u_(n)=="symbol"?n:n+""}function ZHe(e,n){if(u_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(u_(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function eze(e){var n,a,o=e.element,l=e.tooltipEventType,p=e.isActive,m=e.activeCoordinate,y=e.activePayload,E=e.offset,b=e.activeTooltipIndex,T=e.tooltipAxisBandSize,x=e.layout,A=e.chartName,D=(n=o.props.cursor)!==null&&n!==void 0?n:(a=o.type.defaultProps)===null||a===void 0?void 0:a.cursor;if(!o||!D||!p||!m||A!=="ScatterChart"&&l!=="axis")return null;var N,L=$f;if(A==="ScatterChart")N=m,L=$6e;else if(A==="BarChart")N=qHe(x,m,E,T),L=J2;else if(x==="radial"){var P=lte(m),U=P.cx,V=P.cy,F=P.radius,H=P.startAngle,B=P.endAngle;N={cx:U,cy:V,startAngle:H,endAngle:B,innerRadius:F,outerRadius:F},L=cee}else N={points:XHe(x,m,E)},L=$f;var z=dS(dS(dS(dS({stroke:"#ccc",pointerEvents:"none"},E),N),un(D,!1)),{},{payload:y,payloadIndex:b,className:Cn("recharts-tooltip-cursor",D.className)});return J.isValidElement(D)?J.cloneElement(D,z):J.createElement(L,z)}var tze=["item"],nze=["children","className","width","height","style","compact","title","desc"];function wm(e){"@babel/helpers - typeof";return wm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wm(e)}function Df(){return Df=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Df.apply(this,arguments)}function Z9(e,n){return aze(e)||ize(e,n)||ute(e,n)||rze()}function rze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ize(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,l,p,m,y=[],E=!0,b=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(E=(o=p.call(a)).done)&&(y.push(o.value),y.length!==n);E=!0);}catch(T){b=!0,l=T}finally{try{if(!E&&a.return!=null&&(m=a.return(),Object(m)!==m))return}finally{if(b)throw l}}return y}}function aze(e){if(Array.isArray(e))return e}function eY(e,n){if(e==null)return{};var a=sze(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function sze(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function oze(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function cze(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,hte(o.key),o)}}function lze(e,n,a){return n&&cze(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function dze(e,n,a){return n=cx(n),uze(e,dte()?Reflect.construct(n,a||[],cx(e).constructor):n.apply(e,a))}function uze(e,n){if(n&&(wm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hze(e)}function hze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dte=function(){return!!e})()}function cx(e){return cx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},cx(e)}function pze(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&MD(e,n)}function MD(e,n){return MD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},MD(e,n)}function xm(e){return gze(e)||mze(e)||ute(e)||fze()}function fze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ute(e,n){if(e){if(typeof e=="string")return UD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return UD(e,n)}}function mze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function gze(e){if(Array.isArray(e))return UD(e)}function UD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function tY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function Ve(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?tY(Object(a),!0).forEach(function(o){Bt(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Bt(e,n,a){return n=hte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function hte(e){var n=vze(e,"string");return wm(n)=="symbol"?n:n+""}function vze(e,n){if(wm(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(wm(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var yze={xAxis:["bottom","top"],yAxis:["left","right"]},_ze={width:"100%",height:"100%"},pte={x:0,y:0};function uS(e){return e}var Eze=function(n,a){return a==="horizontal"?n.x:a==="vertical"?n.y:a==="centric"?n.angle:n.radius},bze=function(n,a,o,l){var p=a.find(function(T){return T&&T.index===o});if(p){if(n==="horizontal")return{x:p.coordinate,y:l.y};if(n==="vertical")return{x:l.x,y:p.coordinate};if(n==="centric"){var m=p.coordinate,y=l.radius;return Ve(Ve(Ve({},l),Fi(l.cx,l.cy,y,m)),{},{angle:m,radius:y})}var E=p.coordinate,b=l.angle;return Ve(Ve(Ve({},l),Fi(l.cx,l.cy,E,b)),{},{angle:b,radius:E})}return pte},AT=function(n,a){var o=a.graphicalItems,l=a.dataStartIndex,p=a.dataEndIndex,m=(o??[]).reduce(function(y,E){var b=E.props.data;return b&&b.length?[].concat(xm(y),xm(b)):y},[]);return m.length>0?m:n&&n.length&&nt(l)&&nt(p)?n.slice(l,p+1):[]};function fte(e){return e==="number"?[0,"auto"]:void 0}var VD=function(n,a,o,l){var p=n.graphicalItems,m=n.tooltipAxis,y=AT(a,n);return o<0||!p||!p.length||o>=y.length?null:p.reduce(function(E,b){var T,x=(T=b.props.data)!==null&&T!==void 0?T:a;x&&n.dataStartIndex+n.dataEndIndex!==0&&n.dataEndIndex-n.dataStartIndex>=o&&(x=x.slice(n.dataStartIndex,n.dataEndIndex+1));var A;if(m.dataKey&&!m.allowDuplicatedCategory){var D=x===void 0?y:x;A=ow(D,m.dataKey,l)}else A=x&&x[o]||y[o];return A?[].concat(xm(E),[aee(b,A)]):E},[])},nY=function(n,a,o,l){var p=l||{x:n.chartX,y:n.chartY},m=Eze(p,o),y=n.orderedTooltipTicks,E=n.tooltipAxis,b=n.tooltipTicks,T=T5e(m,y,b,E);if(T>=0&&b){var x=b[T]&&b[T].value,A=VD(n,a,T,x),D=bze(o,y,T,p);return{activeTooltipIndex:T,activeLabel:x,activePayload:A,activeCoordinate:D}}return null},Sze=function(n,a){var o=a.axes,l=a.graphicalItems,p=a.axisType,m=a.axisIdKey,y=a.stackGroups,E=a.dataStartIndex,b=a.dataEndIndex,T=n.layout,x=n.children,A=n.stackOffset,D=nee(T,p);return o.reduce(function(N,L){var P,U=L.type.defaultProps!==void 0?Ve(Ve({},L.type.defaultProps),L.props):L.props,V=U.type,F=U.dataKey,H=U.allowDataOverflow,B=U.allowDuplicatedCategory,z=U.scale,Y=U.ticks,Q=U.includeHidden,re=U[m];if(N[re])return N;var de=AT(n.data,{graphicalItems:l.filter(function(fe){var He,Ye=m in fe.props?fe.props[m]:(He=fe.type.defaultProps)===null||He===void 0?void 0:He[m];return Ye===re}),dataStartIndex:E,dataEndIndex:b}),le=de.length,he,Re,ve;YHe(U.domain,H,V)&&(he=nD(U.domain,null,H),D&&(V==="number"||z!=="auto")&&(ve=oy(de,F,"category")));var we=fte(V);if(!he||he.length===0){var ue,be=(ue=U.domain)!==null&&ue!==void 0?ue:we;if(F){if(he=oy(de,F,V),V==="category"&&D){var ae=pNe(he);B&&ae?(Re=he,he=Yw(0,le)):B||(he=PK(be,he,L).reduce(function(fe,He){return fe.indexOf(He)>=0?fe:[].concat(xm(fe),[He])},[]))}else if(V==="category")B?he=he.filter(function(fe){return fe!==""&&!pn(fe)}):he=PK(be,he,L).reduce(function(fe,He){return fe.indexOf(He)>=0||He===""||pn(He)?fe:[].concat(xm(fe),[He])},[]);else if(V==="number"){var ce=O5e(de,l.filter(function(fe){var He,Ye,gt=m in fe.props?fe.props[m]:(He=fe.type.defaultProps)===null||He===void 0?void 0:He[m],Vt="hide"in fe.props?fe.props.hide:(Ye=fe.type.defaultProps)===null||Ye===void 0?void 0:Ye.hide;return gt===re&&(Q||!Vt)}),F,p,T);ce&&(he=ce)}D&&(V==="number"||z!=="auto")&&(ve=oy(de,F,"category"))}else D?he=Yw(0,le):y&&y[re]&&y[re].hasStack&&V==="number"?he=A==="expand"?[0,1]:iee(y[re].stackGroups,E,b):he=tee(de,l.filter(function(fe){var He=m in fe.props?fe.props[m]:fe.type.defaultProps[m],Ye="hide"in fe.props?fe.props.hide:fe.type.defaultProps.hide;return He===re&&(Q||!Ye)}),V,T,!0);if(V==="number")he=jD(x,he,re,p,Y),be&&(he=nD(be,he,H));else if(V==="category"&&be){var Se=be,je=he.every(function(fe){return Se.indexOf(fe)>=0});je&&(he=Se)}}return Ve(Ve({},N),{},Bt({},re,Ve(Ve({},U),{},{axisType:p,domain:he,categoricalDomain:ve,duplicateDomain:Re,originalDomain:(P=U.domain)!==null&&P!==void 0?P:we,isCategorical:D,layout:T})))},{})},wze=function(n,a){var o=a.graphicalItems,l=a.Axis,p=a.axisType,m=a.axisIdKey,y=a.stackGroups,E=a.dataStartIndex,b=a.dataEndIndex,T=n.layout,x=n.children,A=AT(n.data,{graphicalItems:o,dataStartIndex:E,dataEndIndex:b}),D=A.length,N=nee(T,p),L=-1;return o.reduce(function(P,U){var V=U.type.defaultProps!==void 0?Ve(Ve({},U.type.defaultProps),U.props):U.props,F=V[m],H=fte("number");if(!P[F]){L++;var B;return N?B=Yw(0,D):y&&y[F]&&y[F].hasStack?(B=iee(y[F].stackGroups,E,b),B=jD(x,B,F,p)):(B=nD(H,tee(A,o.filter(function(z){var Y,Q,re=m in z.props?z.props[m]:(Y=z.type.defaultProps)===null||Y===void 0?void 0:Y[m],de="hide"in z.props?z.props.hide:(Q=z.type.defaultProps)===null||Q===void 0?void 0:Q.hide;return re===F&&!de}),"number",T),l.defaultProps.allowDataOverflow),B=jD(x,B,F,p)),Ve(Ve({},P),{},Bt({},F,Ve(Ve({axisType:p},l.defaultProps),{},{hide:!0,orientation:Js(yze,"".concat(p,".").concat(L%2),null),domain:B,originalDomain:H,isCategorical:N,layout:T})))}return P},{})},xze=function(n,a){var o=a.axisType,l=o===void 0?"xAxis":o,p=a.AxisComp,m=a.graphicalItems,y=a.stackGroups,E=a.dataStartIndex,b=a.dataEndIndex,T=n.children,x="".concat(l,"Id"),A=Qs(T,p),D={};return A&&A.length?D=Sze(n,{axes:A,graphicalItems:m,axisType:l,axisIdKey:x,stackGroups:y,dataStartIndex:E,dataEndIndex:b}):m&&m.length&&(D=wze(n,{Axis:p,graphicalItems:m,axisType:l,axisIdKey:x,stackGroups:y,dataStartIndex:E,dataEndIndex:b})),D},Tze=function(n){var a=Ed(n),o=dl(a,!1,!0);return{tooltipTicks:o,orderedTooltipTicks:x2(o,function(l){return l.coordinate}),tooltipAxis:a,tooltipAxisBandSize:Vw(a,o)}},rY=function(n){var a=n.children,o=n.defaultShowTooltip,l=ds(a,pm),p=0,m=0;return n.data&&n.data.length!==0&&(m=n.data.length-1),l&&l.props&&(l.props.startIndex>=0&&(p=l.props.startIndex),l.props.endIndex>=0&&(m=l.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:p,dataEndIndex:m,activeTooltipIndex:-1,isTooltipActive:!!o}},Cze=function(n){return!n||!n.length?!1:n.some(function(a){var o=hl(a&&a.type);return o&&o.indexOf("Bar")>=0})},iY=function(n){return n==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:n==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:n==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Rze=function(n,a){var o=n.props,l=n.graphicalItems,p=n.xAxisMap,m=p===void 0?{}:p,y=n.yAxisMap,E=y===void 0?{}:y,b=o.width,T=o.height,x=o.children,A=o.margin||{},D=ds(x,pm),N=ds(x,Bf),L=Object.keys(E).reduce(function(B,z){var Y=E[z],Q=Y.orientation;return!Y.mirror&&!Y.hide?Ve(Ve({},B),{},Bt({},Q,B[Q]+Y.width)):B},{left:A.left||0,right:A.right||0}),P=Object.keys(m).reduce(function(B,z){var Y=m[z],Q=Y.orientation;return!Y.mirror&&!Y.hide?Ve(Ve({},B),{},Bt({},Q,Js(B,"".concat(Q))+Y.height)):B},{top:A.top||0,bottom:A.bottom||0}),U=Ve(Ve({},P),L),V=U.bottom;D&&(U.bottom+=D.props.height||pm.defaultProps.height),N&&a&&(U=A5e(U,l,o,a));var F=b-U.left-U.right,H=T-U.top-U.bottom;return Ve(Ve({brushBottom:V},U),{},{width:Math.max(F,0),height:Math.max(H,0)})},Aze=function(n,a){if(a==="xAxis")return n[a].width;if(a==="yAxis")return n[a].height},mte=function(n){var a=n.chartName,o=n.GraphicalChild,l=n.defaultTooltipEventType,p=l===void 0?"axis":l,m=n.validateTooltipEventTypes,y=m===void 0?["axis"]:m,E=n.axisComponents,b=n.legendContent,T=n.formatAxisMap,x=n.defaultProps,A=function(U,V){var F=V.graphicalItems,H=V.stackGroups,B=V.offset,z=V.updateId,Y=V.dataStartIndex,Q=V.dataEndIndex,re=U.barSize,de=U.layout,le=U.barGap,he=U.barCategoryGap,Re=U.maxBarSize,ve=iY(de),we=ve.numericAxisName,ue=ve.cateAxisName,be=Cze(F),ae=[];return F.forEach(function(ce,Se){var je=AT(U.data,{graphicalItems:[ce],dataStartIndex:Y,dataEndIndex:Q}),fe=ce.type.defaultProps!==void 0?Ve(Ve({},ce.type.defaultProps),ce.props):ce.props,He=fe.dataKey,Ye=fe.maxBarSize,gt=fe["".concat(we,"Id")],Vt=fe["".concat(ue,"Id")],zn={},_r=E.reduce(function(Ka,so){var Pl=V["".concat(so.axisType,"Map")],Je=fe["".concat(so.axisType,"Id")];Pl&&Pl[Je]||so.axisType==="zAxis"||Oh();var Pt=Pl[Je];return Ve(Ve({},Ka),{},Bt(Bt({},so.axisType,Pt),"".concat(so.axisType,"Ticks"),dl(Pt)))},zn),it=_r[ue],Nt=_r["".concat(ue,"Ticks")],Ut=H&&H[gt]&&H[gt].hasStack&&W5e(ce,H[gt].stackGroups),Pe=hl(ce.type).indexOf("Bar")>=0,St=Vw(it,Nt),Ot=[],Pn=be&&C5e({barSize:re,stackGroups:H,totalSize:Aze(_r,ue)});if(Pe){var wn,Oe,rt=pn(Ye)?Re:Ye,Qt=(wn=(Oe=Vw(it,Nt,!0))!==null&&Oe!==void 0?Oe:rt)!==null&&wn!==void 0?wn:0;Ot=R5e({barGap:le,barCategoryGap:he,bandSize:Qt!==St?Qt:St,sizeList:Pn[Vt],maxBarSize:rt}),Qt!==St&&(Ot=Ot.map(function(Ka){return Ve(Ve({},Ka),{},{position:Ve(Ve({},Ka.position),{},{offset:Ka.position.offset-Qt/2})})}))}var Ri=ce&&ce.type&&ce.type.getComposedData;Ri&&ae.push({props:Ve(Ve({},Ri(Ve(Ve({},_r),{},{displayedData:je,props:U,dataKey:He,item:ce,bandSize:St,barPosition:Ot,offset:B,stackedData:Ut,layout:de,dataStartIndex:Y,dataEndIndex:Q}))),{},Bt(Bt(Bt({key:ce.key||"item-".concat(Se)},we,_r[we]),ue,_r[ue]),"animationId",z)),childIndex:TNe(ce,U.children),item:ce})}),ae},D=function(U,V){var F=U.props,H=U.dataStartIndex,B=U.dataEndIndex,z=U.updateId;if(!Cz({props:F}))return null;var Y=F.children,Q=F.layout,re=F.stackOffset,de=F.data,le=F.reverseStackOrder,he=iY(Q),Re=he.numericAxisName,ve=he.cateAxisName,we=Qs(Y,o),ue=V5e(de,we,"".concat(Re,"Id"),"".concat(ve,"Id"),re,le),be=E.reduce(function(fe,He){var Ye="".concat(He.axisType,"Map");return Ve(Ve({},fe),{},Bt({},Ye,xze(F,Ve(Ve({},He),{},{graphicalItems:we,stackGroups:He.axisType===Re&&ue,dataStartIndex:H,dataEndIndex:B}))))},{}),ae=Rze(Ve(Ve({},be),{},{props:F,graphicalItems:we}),V==null?void 0:V.legendBBox);Object.keys(be).forEach(function(fe){be[fe]=T(F,be[fe],ae,fe.replace("Map",""),a)});var ce=be["".concat(ve,"Map")],Se=Tze(ce),je=A(F,Ve(Ve({},be),{},{dataStartIndex:H,dataEndIndex:B,updateId:z,graphicalItems:we,stackGroups:ue,offset:ae}));return Ve(Ve({formattedGraphicalItems:je,graphicalItems:we,offset:ae,stackGroups:ue},Se),be)},N=function(P){function U(V){var F,H,B;return oze(this,U),B=dze(this,U,[V]),Bt(B,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Bt(B,"accessibilityManager",new KHe),Bt(B,"handleLegendBBoxUpdate",function(z){if(z){var Y=B.state,Q=Y.dataStartIndex,re=Y.dataEndIndex,de=Y.updateId;B.setState(Ve({legendBBox:z},D({props:B.props,dataStartIndex:Q,dataEndIndex:re,updateId:de},Ve(Ve({},B.state),{},{legendBBox:z}))))}}),Bt(B,"handleReceiveSyncEvent",function(z,Y,Q){if(B.props.syncId===z){if(Q===B.eventEmitterSymbol&&typeof B.props.syncMethod!="function")return;B.applySyncEvent(Y)}}),Bt(B,"handleBrushChange",function(z){var Y=z.startIndex,Q=z.endIndex;if(Y!==B.state.dataStartIndex||Q!==B.state.dataEndIndex){var re=B.state.updateId;B.setState(function(){return Ve({dataStartIndex:Y,dataEndIndex:Q},D({props:B.props,dataStartIndex:Y,dataEndIndex:Q,updateId:re},B.state))}),B.triggerSyncEvent({dataStartIndex:Y,dataEndIndex:Q})}}),Bt(B,"handleMouseEnter",function(z){var Y=B.getMouseInfo(z);if(Y){var Q=Ve(Ve({},Y),{},{isTooltipActive:!0});B.setState(Q),B.triggerSyncEvent(Q);var re=B.props.onMouseEnter;sn(re)&&re(Q,z)}}),Bt(B,"triggeredAfterMouseMove",function(z){var Y=B.getMouseInfo(z),Q=Y?Ve(Ve({},Y),{},{isTooltipActive:!0}):{isTooltipActive:!1};B.setState(Q),B.triggerSyncEvent(Q);var re=B.props.onMouseMove;sn(re)&&re(Q,z)}),Bt(B,"handleItemMouseEnter",function(z){B.setState(function(){return{isTooltipActive:!0,activeItem:z,activePayload:z.tooltipPayload,activeCoordinate:z.tooltipPosition||{x:z.cx,y:z.cy}}})}),Bt(B,"handleItemMouseLeave",function(){B.setState(function(){return{isTooltipActive:!1}})}),Bt(B,"handleMouseMove",function(z){z.persist(),B.throttleTriggeredAfterMouseMove(z)}),Bt(B,"handleMouseLeave",function(z){B.throttleTriggeredAfterMouseMove.cancel();var Y={isTooltipActive:!1};B.setState(Y),B.triggerSyncEvent(Y);var Q=B.props.onMouseLeave;sn(Q)&&Q(Y,z)}),Bt(B,"handleOuterEvent",function(z){var Y=xNe(z),Q=Js(B.props,"".concat(Y));if(Y&&sn(Q)){var re,de;/.*touch.*/i.test(Y)?de=B.getMouseInfo(z.changedTouches[0]):de=B.getMouseInfo(z),Q((re=de)!==null&&re!==void 0?re:{},z)}}),Bt(B,"handleClick",function(z){var Y=B.getMouseInfo(z);if(Y){var Q=Ve(Ve({},Y),{},{isTooltipActive:!0});B.setState(Q),B.triggerSyncEvent(Q);var re=B.props.onClick;sn(re)&&re(Q,z)}}),Bt(B,"handleMouseDown",function(z){var Y=B.props.onMouseDown;if(sn(Y)){var Q=B.getMouseInfo(z);Y(Q,z)}}),Bt(B,"handleMouseUp",function(z){var Y=B.props.onMouseUp;if(sn(Y)){var Q=B.getMouseInfo(z);Y(Q,z)}}),Bt(B,"handleTouchMove",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.throttleTriggeredAfterMouseMove(z.changedTouches[0])}),Bt(B,"handleTouchStart",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.handleMouseDown(z.changedTouches[0])}),Bt(B,"handleTouchEnd",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.handleMouseUp(z.changedTouches[0])}),Bt(B,"handleDoubleClick",function(z){var Y=B.props.onDoubleClick;if(sn(Y)){var Q=B.getMouseInfo(z);Y(Q,z)}}),Bt(B,"handleContextMenu",function(z){var Y=B.props.onContextMenu;if(sn(Y)){var Q=B.getMouseInfo(z);Y(Q,z)}}),Bt(B,"triggerSyncEvent",function(z){B.props.syncId!==void 0&&QI.emit(ZI,B.props.syncId,z,B.eventEmitterSymbol)}),Bt(B,"applySyncEvent",function(z){var Y=B.props,Q=Y.layout,re=Y.syncMethod,de=B.state.updateId,le=z.dataStartIndex,he=z.dataEndIndex;if(z.dataStartIndex!==void 0||z.dataEndIndex!==void 0)B.setState(Ve({dataStartIndex:le,dataEndIndex:he},D({props:B.props,dataStartIndex:le,dataEndIndex:he,updateId:de},B.state)));else if(z.activeTooltipIndex!==void 0){var Re=z.chartX,ve=z.chartY,we=z.activeTooltipIndex,ue=B.state,be=ue.offset,ae=ue.tooltipTicks;if(!be)return;if(typeof re=="function")we=re(ae,z);else if(re==="value"){we=-1;for(var ce=0;ce<ae.length;ce++)if(ae[ce].value===z.activeLabel){we=ce;break}}var Se=Ve(Ve({},be),{},{x:be.left,y:be.top}),je=Math.min(Re,Se.x+Se.width),fe=Math.min(ve,Se.y+Se.height),He=ae[we]&&ae[we].value,Ye=VD(B.state,B.props.data,we),gt=ae[we]?{x:Q==="horizontal"?ae[we].coordinate:je,y:Q==="horizontal"?fe:ae[we].coordinate}:pte;B.setState(Ve(Ve({},z),{},{activeLabel:He,activeCoordinate:gt,activePayload:Ye,activeTooltipIndex:we}))}else B.setState(z)}),Bt(B,"renderCursor",function(z){var Y,Q=B.state,re=Q.isTooltipActive,de=Q.activeCoordinate,le=Q.activePayload,he=Q.offset,Re=Q.activeTooltipIndex,ve=Q.tooltipAxisBandSize,we=B.getTooltipEventType(),ue=(Y=z.props.active)!==null&&Y!==void 0?Y:re,be=B.props.layout,ae=z.key||"_recharts-cursor";return me.createElement(eze,{key:ae,activeCoordinate:de,activePayload:le,activeTooltipIndex:Re,chartName:a,element:z,isActive:ue,layout:be,offset:he,tooltipAxisBandSize:ve,tooltipEventType:we})}),Bt(B,"renderPolarAxis",function(z,Y,Q){var re=Js(z,"type.axisType"),de=Js(B.state,"".concat(re,"Map")),le=z.type.defaultProps,he=le!==void 0?Ve(Ve({},le),z.props):z.props,Re=de&&de[he["".concat(re,"Id")]];return J.cloneElement(z,Ve(Ve({},Re),{},{className:Cn(re,Re.className),key:z.key||"".concat(Y,"-").concat(Q),ticks:dl(Re,!0)}))}),Bt(B,"renderPolarGrid",function(z){var Y=z.props,Q=Y.radialLines,re=Y.polarAngles,de=Y.polarRadius,le=B.state,he=le.radiusAxisMap,Re=le.angleAxisMap,ve=Ed(he),we=Ed(Re),ue=we.cx,be=we.cy,ae=we.innerRadius,ce=we.outerRadius;return J.cloneElement(z,{polarAngles:Array.isArray(re)?re:dl(we,!0).map(function(Se){return Se.coordinate}),polarRadius:Array.isArray(de)?de:dl(ve,!0).map(function(Se){return Se.coordinate}),cx:ue,cy:be,innerRadius:ae,outerRadius:ce,key:z.key||"polar-grid",radialLines:Q})}),Bt(B,"renderLegend",function(){var z=B.state.formattedGraphicalItems,Y=B.props,Q=Y.children,re=Y.width,de=Y.height,le=B.props.margin||{},he=re-(le.left||0)-(le.right||0),Re=ZZ({children:Q,formattedGraphicalItems:z,legendWidth:he,legendContent:b});if(!Re)return null;var ve=Re.item,we=eY(Re,tze);return J.cloneElement(ve,Ve(Ve({},we),{},{chartWidth:re,chartHeight:de,margin:le,onBBoxUpdate:B.handleLegendBBoxUpdate}))}),Bt(B,"renderTooltip",function(){var z,Y=B.props,Q=Y.children,re=Y.accessibilityLayer,de=ds(Q,us);if(!de)return null;var le=B.state,he=le.isTooltipActive,Re=le.activeCoordinate,ve=le.activePayload,we=le.activeLabel,ue=le.offset,be=(z=de.props.active)!==null&&z!==void 0?z:he;return J.cloneElement(de,{viewBox:Ve(Ve({},ue),{},{x:ue.left,y:ue.top}),active:be,label:we,payload:be?ve:[],coordinate:Re,accessibilityLayer:re})}),Bt(B,"renderBrush",function(z){var Y=B.props,Q=Y.margin,re=Y.data,de=B.state,le=de.offset,he=de.dataStartIndex,Re=de.dataEndIndex,ve=de.updateId;return J.cloneElement(z,{key:z.key||"_recharts-brush",onChange:sS(B.handleBrushChange,z.props.onChange),data:re,x:nt(z.props.x)?z.props.x:le.left,y:nt(z.props.y)?z.props.y:le.top+le.height+le.brushBottom-(Q.bottom||0),width:nt(z.props.width)?z.props.width:le.width,startIndex:he,endIndex:Re,updateId:"brush-".concat(ve)})}),Bt(B,"renderReferenceElement",function(z,Y,Q){if(!z)return null;var re=B,de=re.clipPathId,le=B.state,he=le.xAxisMap,Re=le.yAxisMap,ve=le.offset,we=z.type.defaultProps||{},ue=z.props,be=ue.xAxisId,ae=be===void 0?we.xAxisId:be,ce=ue.yAxisId,Se=ce===void 0?we.yAxisId:ce;return J.cloneElement(z,{key:z.key||"".concat(Y,"-").concat(Q),xAxis:he[ae],yAxis:Re[Se],viewBox:{x:ve.left,y:ve.top,width:ve.width,height:ve.height},clipPathId:de})}),Bt(B,"renderActivePoints",function(z){var Y=z.item,Q=z.activePoint,re=z.basePoint,de=z.childIndex,le=z.isRange,he=[],Re=Y.props.key,ve=Y.item.type.defaultProps!==void 0?Ve(Ve({},Y.item.type.defaultProps),Y.item.props):Y.item.props,we=ve.activeDot,ue=ve.dataKey,be=Ve(Ve({index:de,dataKey:ue,cx:Q.x,cy:Q.y,r:4,fill:X2(Y.item),strokeWidth:2,stroke:"#fff",payload:Q.payload,value:Q.value},un(we,!1)),cw(we));return he.push(U.renderActiveDot(we,be,"".concat(Re,"-activePoint-").concat(de))),re?he.push(U.renderActiveDot(we,Ve(Ve({},be),{},{cx:re.x,cy:re.y}),"".concat(Re,"-basePoint-").concat(de))):le&&he.push(null),he}),Bt(B,"renderGraphicChild",function(z,Y,Q){var re=B.filterFormatItem(z,Y,Q);if(!re)return null;var de=B.getTooltipEventType(),le=B.state,he=le.isTooltipActive,Re=le.tooltipAxis,ve=le.activeTooltipIndex,we=le.activeLabel,ue=B.props.children,be=ds(ue,us),ae=re.props,ce=ae.points,Se=ae.isRange,je=ae.baseLine,fe=re.item.type.defaultProps!==void 0?Ve(Ve({},re.item.type.defaultProps),re.item.props):re.item.props,He=fe.activeDot,Ye=fe.hide,gt=fe.activeBar,Vt=fe.activeShape,zn=!!(!Ye&&he&&be&&(He||gt||Vt)),_r={};de!=="axis"&&be&&be.props.trigger==="click"?_r={onClick:sS(B.handleItemMouseEnter,z.props.onClick)}:de!=="axis"&&(_r={onMouseLeave:sS(B.handleItemMouseLeave,z.props.onMouseLeave),onMouseEnter:sS(B.handleItemMouseEnter,z.props.onMouseEnter)});var it=J.cloneElement(z,Ve(Ve({},re.props),_r));function Nt(so){return typeof Re.dataKey=="function"?Re.dataKey(so.payload):null}if(zn)if(ve>=0){var Ut,Pe;if(Re.dataKey&&!Re.allowDuplicatedCategory){var St=typeof Re.dataKey=="function"?Nt:"payload.".concat(Re.dataKey.toString());Ut=ow(ce,St,we),Pe=Se&&je&&ow(je,St,we)}else Ut=ce==null?void 0:ce[ve],Pe=Se&&je&&je[ve];if(Vt||gt){var Ot=z.props.activeIndex!==void 0?z.props.activeIndex:ve;return[J.cloneElement(z,Ve(Ve(Ve({},re.props),_r),{},{activeIndex:Ot})),null,null]}if(!pn(Ut))return[it].concat(xm(B.renderActivePoints({item:re,activePoint:Ut,basePoint:Pe,childIndex:ve,isRange:Se})))}else{var Pn,wn=(Pn=B.getItemByXY(B.state.activeCoordinate))!==null&&Pn!==void 0?Pn:{graphicalItem:it},Oe=wn.graphicalItem,rt=Oe.item,Qt=rt===void 0?z:rt,Ri=Oe.childIndex,Ka=Ve(Ve(Ve({},re.props),_r),{},{activeIndex:Ri});return[J.cloneElement(Qt,Ka),null,null]}return Se?[it,null,null]:[it,null]}),Bt(B,"renderCustomized",function(z,Y,Q){return J.cloneElement(z,Ve(Ve({key:"recharts-customized-".concat(Q)},B.props),B.state))}),Bt(B,"renderMap",{CartesianGrid:{handler:uS,once:!0},ReferenceArea:{handler:B.renderReferenceElement},ReferenceLine:{handler:uS},ReferenceDot:{handler:B.renderReferenceElement},XAxis:{handler:uS},YAxis:{handler:uS},Brush:{handler:B.renderBrush,once:!0},Bar:{handler:B.renderGraphicChild},Line:{handler:B.renderGraphicChild},Area:{handler:B.renderGraphicChild},Radar:{handler:B.renderGraphicChild},RadialBar:{handler:B.renderGraphicChild},Scatter:{handler:B.renderGraphicChild},Pie:{handler:B.renderGraphicChild},Funnel:{handler:B.renderGraphicChild},Tooltip:{handler:B.renderCursor,once:!0},PolarGrid:{handler:B.renderPolarGrid,once:!0},PolarAngleAxis:{handler:B.renderPolarAxis},PolarRadiusAxis:{handler:B.renderPolarAxis},Customized:{handler:B.renderCustomized}}),B.clipPathId="".concat((F=V.id)!==null&&F!==void 0?F:Fm("recharts"),"-clip"),B.throttleTriggeredAfterMouseMove=QQ(B.triggeredAfterMouseMove,(H=V.throttleDelay)!==null&&H!==void 0?H:1e3/60),B.state={},B}return pze(U,P),lze(U,[{key:"componentDidMount",value:function(){var F,H;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(F=this.props.margin.left)!==null&&F!==void 0?F:0,top:(H=this.props.margin.top)!==null&&H!==void 0?H:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var F=this.props,H=F.children,B=F.data,z=F.height,Y=F.layout,Q=ds(H,us);if(Q){var re=Q.props.defaultIndex;if(!(typeof re!="number"||re<0||re>this.state.tooltipTicks.length-1)){var de=this.state.tooltipTicks[re]&&this.state.tooltipTicks[re].value,le=VD(this.state,B,re,de),he=this.state.tooltipTicks[re].coordinate,Re=(this.state.offset.top+z)/2,ve=Y==="horizontal",we=ve?{x:he,y:Re}:{y:he,x:Re},ue=this.state.formattedGraphicalItems.find(function(ae){var ce=ae.item;return ce.type.name==="Scatter"});ue&&(we=Ve(Ve({},we),ue.props.points[re].tooltipPosition),le=ue.props.points[re].tooltipPayload);var be={activeTooltipIndex:re,isTooltipActive:!0,activeLabel:de,activePayload:le,activeCoordinate:we};this.setState(be),this.renderCursor(Q),this.accessibilityManager.setIndex(re)}}}},{key:"getSnapshotBeforeUpdate",value:function(F,H){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==H.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==F.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==F.margin){var B,z;this.accessibilityManager.setDetails({offset:{left:(B=this.props.margin.left)!==null&&B!==void 0?B:0,top:(z=this.props.margin.top)!==null&&z!==void 0?z:0}})}return null}},{key:"componentDidUpdate",value:function(F){vP([ds(F.children,us)],[ds(this.props.children,us)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var F=ds(this.props.children,us);if(F&&typeof F.props.shared=="boolean"){var H=F.props.shared?"axis":"item";return y.indexOf(H)>=0?H:p}return p}},{key:"getMouseInfo",value:function(F){if(!this.container)return null;var H=this.container,B=H.getBoundingClientRect(),z=JMe(B),Y={chartX:Math.round(F.pageX-z.left),chartY:Math.round(F.pageY-z.top)},Q=B.width/H.offsetWidth||1,re=this.inRange(Y.chartX,Y.chartY,Q);if(!re)return null;var de=this.state,le=de.xAxisMap,he=de.yAxisMap,Re=this.getTooltipEventType(),ve=nY(this.state,this.props.data,this.props.layout,re);if(Re!=="axis"&&le&&he){var we=Ed(le).scale,ue=Ed(he).scale,be=we&&we.invert?we.invert(Y.chartX):null,ae=ue&&ue.invert?ue.invert(Y.chartY):null;return Ve(Ve({},Y),{},{xValue:be,yValue:ae},ve)}return ve?Ve(Ve({},Y),ve):null}},{key:"inRange",value:function(F,H){var B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,z=this.props.layout,Y=F/B,Q=H/B;if(z==="horizontal"||z==="vertical"){var re=this.state.offset,de=Y>=re.left&&Y<=re.left+re.width&&Q>=re.top&&Q<=re.top+re.height;return de?{x:Y,y:Q}:null}var le=this.state,he=le.angleAxisMap,Re=le.radiusAxisMap;if(he&&Re){var ve=Ed(he);return LK({x:Y,y:Q},ve)}return null}},{key:"parseEventsOfWrapper",value:function(){var F=this.props.children,H=this.getTooltipEventType(),B=ds(F,us),z={};B&&H==="axis"&&(B.props.trigger==="click"?z={onClick:this.handleClick}:z={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var Y=cw(this.props,this.handleOuterEvent);return Ve(Ve({},Y),z)}},{key:"addListener",value:function(){QI.on(ZI,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){QI.removeListener(ZI,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(F,H,B){for(var z=this.state.formattedGraphicalItems,Y=0,Q=z.length;Y<Q;Y++){var re=z[Y];if(re.item===F||re.props.key===F.key||H===hl(re.item.type)&&B===re.childIndex)return re}return null}},{key:"renderClipPath",value:function(){var F=this.clipPathId,H=this.state.offset,B=H.left,z=H.top,Y=H.height,Q=H.width;return me.createElement("defs",null,me.createElement("clipPath",{id:F},me.createElement("rect",{x:B,y:z,height:Y,width:Q})))}},{key:"getXScales",value:function(){var F=this.state.xAxisMap;return F?Object.entries(F).reduce(function(H,B){var z=Z9(B,2),Y=z[0],Q=z[1];return Ve(Ve({},H),{},Bt({},Y,Q.scale))},{}):null}},{key:"getYScales",value:function(){var F=this.state.yAxisMap;return F?Object.entries(F).reduce(function(H,B){var z=Z9(B,2),Y=z[0],Q=z[1];return Ve(Ve({},H),{},Bt({},Y,Q.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(F){var H;return(H=this.state.xAxisMap)===null||H===void 0||(H=H[F])===null||H===void 0?void 0:H.scale}},{key:"getYScaleByAxisId",value:function(F){var H;return(H=this.state.yAxisMap)===null||H===void 0||(H=H[F])===null||H===void 0?void 0:H.scale}},{key:"getItemByXY",value:function(F){var H=this.state,B=H.formattedGraphicalItems,z=H.activeItem;if(B&&B.length)for(var Y=0,Q=B.length;Y<Q;Y++){var re=B[Y],de=re.props,le=re.item,he=le.type.defaultProps!==void 0?Ve(Ve({},le.type.defaultProps),le.props):le.props,Re=hl(le.type);if(Re==="Bar"){var ve=(de.data||[]).find(function(ae){return k6e(F,ae)});if(ve)return{graphicalItem:re,payload:ve}}else if(Re==="RadialBar"){var we=(de.data||[]).find(function(ae){return LK(F,ae)});if(we)return{graphicalItem:re,payload:we}}else if(bT(re,z)||ST(re,z)||i_(re,z)){var ue=M8e({graphicalItem:re,activeTooltipItem:z,itemData:he.data}),be=he.activeIndex===void 0?ue:he.activeIndex;return{graphicalItem:Ve(Ve({},re),{},{childIndex:be}),payload:i_(re,z)?he.data[ue]:re.props.data[ue]}}}return null}},{key:"render",value:function(){var F=this;if(!Cz(this))return null;var H=this.props,B=H.children,z=H.className,Y=H.width,Q=H.height,re=H.style,de=H.compact,le=H.title,he=H.desc,Re=eY(H,nze),ve=un(Re,!1);if(de)return me.createElement(D9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},me.createElement(_P,Df({},ve,{width:Y,height:Q,title:le,desc:he}),this.renderClipPath(),Az(B,this.renderMap)));if(this.props.accessibilityLayer){var we,ue;ve.tabIndex=(we=this.props.tabIndex)!==null&&we!==void 0?we:0,ve.role=(ue=this.props.role)!==null&&ue!==void 0?ue:"application",ve.onKeyDown=function(ae){F.accessibilityManager.keyboardEvent(ae)},ve.onFocus=function(){F.accessibilityManager.focus()}}var be=this.parseEventsOfWrapper();return me.createElement(D9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},me.createElement("div",Df({className:Cn("recharts-wrapper",z),style:Ve({position:"relative",cursor:"default",width:Y,height:Q},re)},be,{ref:function(ce){F.container=ce}}),me.createElement(_P,Df({},ve,{width:Y,height:Q,title:le,desc:he,style:_ze}),this.renderClipPath(),Az(B,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(J.Component);Bt(N,"displayName",a),Bt(N,"defaultProps",Ve({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},x)),Bt(N,"getDerivedStateFromProps",function(P,U){var V=P.dataKey,F=P.data,H=P.children,B=P.width,z=P.height,Y=P.layout,Q=P.stackOffset,re=P.margin,de=U.dataStartIndex,le=U.dataEndIndex;if(U.updateId===void 0){var he=rY(P);return Ve(Ve(Ve({},he),{},{updateId:0},D(Ve(Ve({props:P},he),{},{updateId:0}),U)),{},{prevDataKey:V,prevData:F,prevWidth:B,prevHeight:z,prevLayout:Y,prevStackOffset:Q,prevMargin:re,prevChildren:H})}if(V!==U.prevDataKey||F!==U.prevData||B!==U.prevWidth||z!==U.prevHeight||Y!==U.prevLayout||Q!==U.prevStackOffset||!Ff(re,U.prevMargin)){var Re=rY(P),ve={chartX:U.chartX,chartY:U.chartY,isTooltipActive:U.isTooltipActive},we=Ve(Ve({},nY(U,F,Y)),{},{updateId:U.updateId+1}),ue=Ve(Ve(Ve({},Re),ve),we);return Ve(Ve(Ve({},ue),D(Ve({props:P},ue),U)),{},{prevDataKey:V,prevData:F,prevWidth:B,prevHeight:z,prevLayout:Y,prevStackOffset:Q,prevMargin:re,prevChildren:H})}if(!vP(H,U.prevChildren)){var be,ae,ce,Se,je=ds(H,pm),fe=je&&(be=(ae=je.props)===null||ae===void 0?void 0:ae.startIndex)!==null&&be!==void 0?be:de,He=je&&(ce=(Se=je.props)===null||Se===void 0?void 0:Se.endIndex)!==null&&ce!==void 0?ce:le,Ye=fe!==de||He!==le,gt=!pn(F),Vt=gt&&!Ye?U.updateId:U.updateId+1;return Ve(Ve({updateId:Vt},D(Ve(Ve({props:P},U),{},{updateId:Vt,dataStartIndex:fe,dataEndIndex:He}),U)),{},{prevChildren:H,dataStartIndex:fe,dataEndIndex:He})}return null}),Bt(N,"renderActiveDot",function(P,U,V){var F;return J.isValidElement(P)?F=J.cloneElement(P,U):sn(P)?F=P(U):F=me.createElement(ET,U),me.createElement(cr,{className:"recharts-active-dot",key:V},F)});var L=J.forwardRef(function(U,V){return me.createElement(N,Df({},U,{ref:V}))});return L.displayName=N.displayName,L},gte=mte({chartName:"LineChart",GraphicalChild:Ym,axisComponents:[{axisType:"xAxis",AxisComp:Fd},{axisType:"yAxis",AxisComp:Bd}],formatAxisMap:Nee}),vte=mte({chartName:"AreaChart",GraphicalChild:Il,axisComponents:[{axisType:"xAxis",AxisComp:Fd},{axisType:"yAxis",AxisComp:Bd}],formatAxisMap:Nee});const yte={vitaminD:{name:"Vitamin D",icon:DJ,color:"amber",unit:"ng/mL",normalRange:"30-100",lowExplanation:"When Vitamin D is low, you may feel tired all the time, have weak bones that break easily, feel sad or depressed, get sick often, and have muscle pain. Your body needs sunlight and certain foods to make Vitamin D.",tips:["Get 15-20 minutes of sunlight daily","Eat eggs, fish, and fortified milk","Consider supplements if advised by doctor"]},vitaminB12:{name:"Vitamin B12",icon:e2,color:"red",unit:"pg/mL",normalRange:"300-900",lowExplanation:"Low Vitamin B12 makes you feel very tired and weak. You might feel dizzy, have trouble thinking clearly, feel numbness in hands or feet, and look pale. Your body needs B12 to make healthy blood cells.",tips:["Eat meat, fish, eggs, and dairy","Vegetarians may need supplements","Get tested if you feel constantly tired"]},iron:{name:"Iron",icon:Jk,color:"rose",unit:"mcg/dL",normalRange:"60-170",lowExplanation:"Low iron means your blood cannot carry enough oxygen. You will feel very tired, look pale, feel short of breath, have cold hands and feet, and may have headaches. Women often have low iron.",tips:["Eat red meat, spinach, and beans","Take iron with Vitamin C for better absorption","Avoid tea/coffee with iron-rich meals"]},hemoglobin:{name:"Hemoglobin",icon:Yo,color:"red",unit:"g/dL",normalRange:"12-17",lowExplanation:"Low hemoglobin means anemia - your blood cannot carry enough oxygen to your body. You will feel extremely tired, weak, dizzy, and may have pale skin. Your heart has to work harder.",tips:["Eat iron-rich foods","Include Vitamin C in your diet","See a doctor if symptoms persist"]},calcium:{name:"Calcium",icon:qxe,color:"slate",unit:"mg/dL",normalRange:"8.5-10.5",lowExplanation:"Low calcium weakens your bones and teeth. You may have muscle cramps, numbness in fingers, brittle nails, and bones that break easily. Long-term low calcium can cause osteoporosis.",tips:["Drink milk and eat dairy products","Eat leafy green vegetables","Get enough Vitamin D for calcium absorption"]},vitaminC:{name:"Vitamin C",icon:Ny,color:"orange",unit:"mg/dL",normalRange:"0.6-2.0",lowExplanation:"Low Vitamin C means your body cannot heal wounds properly. You may have bleeding gums, bruise easily, feel tired, have dry skin, and get sick often. Your immune system becomes weak.",tips:["Eat citrus fruits like oranges and lemons","Include tomatoes and bell peppers","Eat fresh fruits and vegetables daily"]},cholesterol:{name:"Cholesterol",icon:ni,color:"yellow",unit:"mg/dL",normalRange:"<200",lowExplanation:"While high cholesterol is usually the concern, very low cholesterol can affect hormone production and brain function. However, most people need to focus on keeping cholesterol in healthy range.",tips:["Limit fried and fatty foods","Exercise regularly","Eat more fiber and vegetables"]},bloodSugar:{name:"Blood Sugar",icon:Bx,color:"purple",unit:"mg/dL",normalRange:"70-100",lowExplanation:"Low blood sugar (hypoglycemia) makes you feel shaky, sweaty, confused, and very hungry. You may feel dizzy or faint. High blood sugar over time can lead to diabetes and damage organs.",tips:["Eat regular meals","Limit sugary foods and drinks","Exercise helps control blood sugar"]},thyroid:{name:"Thyroid (TSH)",icon:_J,color:"indigo",unit:"mIU/L",normalRange:"0.4-4.0",lowExplanation:"Thyroid problems affect your energy and weight. Low thyroid makes you tired, gain weight, feel cold, and have dry skin. High thyroid makes you anxious, lose weight, and feel hot.",tips:["Get thyroid checked if you have unexplained weight changes","Iodine in salt helps thyroid function","Take thyroid medicine as prescribed"]},heartRate:{name:"Heart Rate",icon:Yo,color:"red",unit:"bpm",normalRange:"60-100",lowExplanation:"Very low heart rate can mean your heart is not pumping enough blood. You may feel dizzy, tired, or faint. Athletes often have lower heart rates which is normal for them.",tips:["Regular exercise strengthens your heart","Reduce stress and anxiety","Limit caffeine and alcohol"]},sleep:{name:"Sleep",icon:Fx,color:"indigo",unit:"hours",normalRange:"7-9",lowExplanation:"Not enough sleep makes you tired, irritable, and unable to think clearly. Long-term poor sleep increases risk of heart disease, diabetes, and weight gain. Your body heals during sleep.",tips:["Sleep 7-9 hours every night","Keep a regular sleep schedule","Avoid screens before bedtime"]},steps:{name:"Daily Steps",icon:wJ,color:"cyan",unit:"steps",normalRange:"8,000-10,000",lowExplanation:"Not walking enough means less exercise for your body. This can lead to weight gain, weak muscles, poor heart health, and low energy. Walking is the easiest exercise for everyone.",tips:["Aim for 8,000-10,000 steps daily","Take stairs instead of elevator","Walk after meals for better digestion"]}},Nze=({metric:e,onClose:n})=>{if(!e)return null;const a=yte[e];if(!a)return null;const o=a.icon;return h.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",onClick:n,children:h.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md max-h-[85vh] overflow-y-auto p-5 sm:p-6 relative animate-slide-up sm:animate-fade-in shadow-xl",onClick:l=>l.stopPropagation(),children:[h.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full mx-auto mb-4 sm:hidden"}),h.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-1",children:h.jsx(zo,{className:"w-5 h-5"})}),h.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[h.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-${a.color}-100 flex items-center justify-center`,children:h.jsx(o,{className:`w-5 h-5 sm:w-6 sm:h-6 text-${a.color}-500`})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-lg sm:text-xl font-bold text-slate-800",children:a.name}),h.jsxs("p",{className:"text-slate-500 text-xs sm:text-sm",children:["Normal: ",a.normalRange," ",a.unit]})]})]}),h.jsxs("div",{className:"mb-4",children:[h.jsx("h4",{className:"text-cyan-600 font-medium mb-2 text-sm sm:text-base",children:"What happens when it's low?"}),h.jsx("p",{className:"text-slate-600 text-xs sm:text-sm leading-relaxed",children:a.lowExplanation})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"text-emerald-600 font-medium mb-2 text-sm sm:text-base",children:"Simple Tips to Improve"}),h.jsx("ul",{className:"space-y-2",children:a.tips.map((l,p)=>h.jsxs("li",{className:"flex items-start gap-2 text-slate-600 text-xs sm:text-sm",children:[h.jsx("span",{className:"text-emerald-500 mt-0.5",children:""}),l]},p))})]}),h.jsx("button",{onClick:n,className:"w-full mt-5 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors sm:hidden",children:"Got it"})]})})},Hs=({metricKey:e,value:n,unit:a,status:o,subtitle:l,onInfoClick:p})=>{const m=yte[e];if(!m)return null;const y=m.icon,b={normal:"emerald",low:"amber",high:"red",critical:"red"}[o]||"slate",T=n!=null&&n!=="";return h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm group relative p-3 sm:p-5 hover:shadow-md transition-shadow",children:[h.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[h.jsx("span",{className:"text-slate-500 text-xs sm:text-sm truncate pr-2",children:m.name}),h.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 shrink-0",children:[h.jsx("button",{onClick:()=>p(e),className:"w-5 h-5 sm:w-6 sm:h-6 rounded-lg bg-slate-100 flex items-center justify-center opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity hover:bg-slate-200",title:"Learn more",children:h.jsx(Ux,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-cyan-500"})}),h.jsx("div",{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-lg bg-${m.color}-100 flex items-center justify-center`,children:h.jsx(y,{className:`w-3 h-3 sm:w-4 sm:h-4 text-${m.color}-500`})})]})]}),h.jsx("div",{className:"flex items-baseline gap-1 sm:gap-2 flex-wrap",children:T?h.jsxs(h.Fragment,{children:[h.jsx("span",{className:"text-xl sm:text-3xl font-bold text-slate-800",children:n}),h.jsx("span",{className:"text-slate-400 text-xs sm:text-sm",children:a||m.unit}),o&&h.jsx("span",{className:`text-${b}-600 text-[10px] sm:text-xs ml-auto px-1.5 sm:px-2 py-0.5 bg-${b}-100 rounded-full`,children:o.toUpperCase()})]}):h.jsx("span",{className:"text-slate-400 text-sm",children:"No data"})}),l&&h.jsx("p",{className:"text-slate-400 text-[10px] sm:text-xs mt-1 sm:mt-2 truncate",children:l})]})};function Oze(){var ue,be,ae,ce,Se,je;const{user:e}=Ha(),[n,a]=J.useState(null),[o,l]=J.useState(null),[p,m]=J.useState(!0),[y,E]=J.useState(null),[b,T]=J.useState(!1),[x,A]=J.useState(null),D=async()=>{var fe,He;try{E(null);const[Ye,gt]=await Promise.all([mh.getDashboard(),_d.getDashboard().catch(()=>({data:{connected:!1}}))]);a(Ye.data),l(gt.data)}catch(Ye){console.error("Failed to fetch dashboard:",Ye),E(((He=(fe=Ye.response)==null?void 0:fe.data)==null?void 0:He.message)||"Failed to load dashboard data")}finally{m(!1)}};J.useEffect(()=>{D()},[]);const N=async()=>{T(!0);try{await _d.connectDevice("smartwatch","Demo Smartwatch"),await _d.generateDemoData("smartwatch"),await D()}catch(fe){console.error("Failed to generate demo data:",fe)}finally{T(!1)}};if(p)return h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),h.jsx("p",{className:"text-slate-500",children:"Loading your health data..."})]})});if(y)return h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-red-500 mb-4",children:y}),h.jsx("button",{onClick:D,className:"px-6 py-2 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600",children:"Try Again"})]})});const{user:L,healthScores:P,latestAnalysis:U,recentReports:V}=n||{},F=V&&V.length>0,H=((ue=L==null?void 0:L.healthMetrics)==null?void 0:ue.healthScore)||(U==null?void 0:U.healthScore)||null,B=(U==null?void 0:U.metrics)||{},z=fe=>fe==null?null:typeof fe=="object"&&fe.value!==void 0?fe.value:fe,Y={vitaminD:z(B.vitaminD),vitaminB12:z(B.vitaminB12),iron:z(B.iron),calcium:z(B.calcium),hemoglobin:z(B.hemoglobin),bloodSugar:z(B.bloodSugar)||z(B.glucose),tsh:z(B.tsh)||z(B.thyroid),vitaminC:z(B.vitaminC),cholesterol:z(B.cholesterol)||z(B.totalCholesterol)},Q=(o==null?void 0:o.connected)&&(o==null?void 0:o.todayMetrics),re=(o==null?void 0:o.todayMetrics)||{steps:0,caloriesBurned:0},de=(o==null?void 0:o.recentHeartRate)||[],le=(o==null?void 0:o.recentSleep)||[],he=de.length>0?Math.round(de.reduce((fe,He)=>fe+He.bpm,0)/de.length):null,Re=le.length>0?(le.reduce((fe,He)=>fe+He.totalSleepMinutes,0)/le.length/60).toFixed(1):null,ve=(P==null?void 0:P.length)>0?P.map(fe=>({date:new Date(fe.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:fe.score,type:fe.type})):[],we=(fe,He,Ye)=>{if(!fe)return null;const gt=parseFloat(fe);return gt<He*.7?"critical":gt<He?"low":gt>Ye*1.3||gt>Ye?"high":"normal"};return h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[x&&h.jsx(Nze,{metric:x,onClose:()=>A(null)}),h.jsxs("div",{className:"flex flex-col gap-4",children:[h.jsxs("div",{children:[h.jsxs("h1",{className:"text-xl sm:text-3xl font-bold text-slate-800",children:["Welcome back, ",h.jsx("span",{className:"text-cyan-600",children:(be=e==null?void 0:e.name)==null?void 0:be.split(" ")[0]})]}),h.jsx("p",{className:"text-slate-500 mt-1 text-sm sm:text-base",children:"Your complete health overview. Tap the eye icon to learn more."})]}),h.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[h.jsxs(Tn,{to:"/upload",className:"px-3 sm:px-6 py-2 sm:py-3 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50 flex items-center gap-1 sm:gap-2 text-xs sm:text-base",children:[h.jsx(Wo,{className:"w-3 h-3 sm:w-4 sm:h-4"}),h.jsx("span",{className:"hidden sm:inline",children:"Upload Records"}),h.jsx("span",{className:"sm:hidden",children:"Upload"})]}),h.jsxs("button",{className:"px-3 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-1 sm:gap-2 text-xs sm:text-base",children:[h.jsx(Wx,{className:"w-3 h-3 sm:w-4 sm:h-4"}),h.jsx("span",{className:"hidden sm:inline",children:"Log Symptoms"}),h.jsx("span",{className:"sm:hidden",children:"Log"})]})]})]}),h.jsx("div",{className:"relative rounded-2xl overflow-hidden shadow-lg bg-gradient-to-r from-cyan-500 to-blue-500 p-6 sm:p-8",children:h.jsxs("div",{className:"text-white max-w-2xl",children:[h.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"AI-Powered Health Insights"}),h.jsx("p",{className:"text-white/90 text-sm sm:text-base",children:"Get personalized health recommendations based on your medical reports and wearable data"})]})}),F&&H?h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 sm:p-6",children:[h.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-4 mb-4",children:[h.jsxs("div",{children:[h.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-800",children:"Health Score Trend"}),h.jsx("p",{className:"text-slate-500 text-xs sm:text-sm",children:"Your overall health progress"})]}),h.jsxs("div",{className:"flex items-baseline gap-2",children:[h.jsx("span",{className:"text-2xl sm:text-4xl font-bold text-slate-800",children:H}),h.jsx("span",{className:"text-slate-400 text-sm",children:"/100"}),ve.length>1&&h.jsxs("span",{className:"text-emerald-500 text-xs sm:text-sm ml-2",children:[ve[ve.length-1].score>ve[ve.length-2].score?"+":"",ve[ve.length-1].score-ve[ve.length-2].score,"%"]})]})]}),ve.length>0&&h.jsx(Sw,{width:"100%",height:140,children:h.jsxs(vte,{data:ve,children:[h.jsx("defs",{children:h.jsxs("linearGradient",{id:"scoreGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[h.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),h.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),h.jsx(l_,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),h.jsx(Fd,{dataKey:"date",stroke:"#94a3b8",fontSize:10,tickLine:!1,axisLine:!1}),h.jsx(Bd,{stroke:"#94a3b8",fontSize:10,tickLine:!1,axisLine:!1,domain:[50,100],hide:!0}),h.jsx(us,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"12px"},labelStyle:{color:"#64748b"},formatter:fe=>[`${fe}/100`,"Score"]}),h.jsx(Il,{type:"monotone",dataKey:"score",stroke:"#10b981",strokeWidth:2,fill:"url(#scoreGradient)"})]})})]}):h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-8 text-center",children:[h.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:h.jsx(em,{className:"w-8 h-8 text-slate-400"})}),h.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"No Health Data Yet"}),h.jsx("p",{className:"text-slate-500 mb-4",children:"Upload your first health report to see your personalized health score and track your progress over time."}),h.jsxs(Tn,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all",children:[h.jsx(Wo,{className:"w-4 h-4"}),"Upload Your First Report"]})]}),h.jsxs("div",{children:[h.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[h.jsx(ni,{className:"w-4 h-4 sm:w-5 sm:h-5 text-cyan-500"}),"Vital Signs & Activity"]}),h.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[h.jsx(Hs,{metricKey:"heartRate",value:he,status:we(he,60,100),subtitle:Q?"From wearable":"Connect device",onInfoClick:A}),h.jsx(Hs,{metricKey:"sleep",value:Re,status:Re?we(parseFloat(Re),7,9):null,subtitle:le.length>0?`${le.length} nights avg`:"Track sleep",onInfoClick:A}),h.jsx(Hs,{metricKey:"steps",value:re.steps>0?re.steps.toLocaleString():null,unit:"steps",status:re.steps>=8e3?"normal":re.steps>=5e3?"low":re.steps>0?"critical":null,subtitle:Q?`${re.caloriesBurned} cal`:"Today",onInfoClick:A}),h.jsx(Hs,{metricKey:"cholesterol",value:Y.cholesterol,status:we(Y.cholesterol,0,200),subtitle:"From blood work",onInfoClick:A})]})]}),h.jsxs("div",{children:[h.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[h.jsx(Bx,{className:"w-4 h-4 sm:w-5 sm:h-5 text-amber-500"}),"Vitamins & Minerals"]}),h.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[h.jsx(Hs,{metricKey:"vitaminD",value:Y.vitaminD,status:we(Y.vitaminD,30,100),subtitle:"Bone & immune health",onInfoClick:A}),h.jsx(Hs,{metricKey:"vitaminB12",value:Y.vitaminB12,status:we(Y.vitaminB12,300,900),subtitle:"Energy & nerves",onInfoClick:A}),h.jsx(Hs,{metricKey:"iron",value:Y.iron,status:we(Y.iron,60,170),subtitle:"Blood oxygen",onInfoClick:A}),h.jsx(Hs,{metricKey:"calcium",value:Y.calcium,status:we(Y.calcium,8.5,10.5),subtitle:"Bones & teeth",onInfoClick:A})]})]}),h.jsxs("div",{children:[h.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[h.jsx(Jk,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-500"}),"Blood & Hormones"]}),h.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[h.jsx(Hs,{metricKey:"hemoglobin",value:Y.hemoglobin,status:we(Y.hemoglobin,12,17),subtitle:"Oxygen carrier",onInfoClick:A}),h.jsx(Hs,{metricKey:"bloodSugar",value:Y.bloodSugar,status:we(Y.bloodSugar,70,100),subtitle:"Fasting glucose",onInfoClick:A}),h.jsx(Hs,{metricKey:"thyroid",value:Y.tsh,status:we(Y.tsh,.4,4),subtitle:"Metabolism control",onInfoClick:A}),h.jsx(Hs,{metricKey:"vitaminC",value:Y.vitaminC,status:we(Y.vitaminC,.6,2),subtitle:"Immune & healing",onInfoClick:A})]})]}),F&&ve.length>1&&h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[h.jsx(em,{className:"w-5 h-5 text-cyan-500"}),"Health Improvement Tracking"]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[h.jsx(gs,{className:"w-4 h-4"}),"Last updated: ",new Date().toLocaleDateString()]})]}),h.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[h.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx("span",{className:"text-slate-600 text-sm",children:"Overall Trend"}),h.jsx(Kxe,{className:"w-4 h-4 text-green-500"})]}),h.jsxs("div",{className:"flex items-baseline gap-2",children:[h.jsx("span",{className:"text-2xl font-bold text-green-500",children:"Improved"}),h.jsx("span",{className:"text-xs text-slate-400",children:"vs last month"})]}),h.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Based on lab values and wearable data"})]}),h.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx("span",{className:"text-slate-600 text-sm",children:"Stable Metrics"}),h.jsx(AJ,{className:"w-4 h-4 text-blue-500"})]}),h.jsxs("div",{className:"flex items-baseline gap-2",children:[h.jsx("span",{className:"text-2xl font-bold text-blue-500",children:"6"}),h.jsx("span",{className:"text-xs text-slate-400",children:"out of 12"})]}),h.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Maintaining healthy ranges"})]}),h.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx("span",{className:"text-slate-600 text-sm",children:"Needs Attention"}),h.jsx(Mx,{className:"w-4 h-4 text-yellow-500"})]}),h.jsxs("div",{className:"flex items-baseline gap-2",children:[h.jsx("span",{className:"text-2xl font-bold text-yellow-500",children:"2"}),h.jsx("span",{className:"text-xs text-slate-400",children:"metrics"})]}),h.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Vitamin D, Iron levels"})]})]}),h.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("h4",{className:"text-slate-800 font-medium",children:"Lab Values Trend"}),h.jsxs("select",{className:"bg-slate-50 border border-slate-200 rounded-lg px-3 py-1 text-slate-700 text-sm",children:[h.jsx("option",{children:"Vitamin D"}),h.jsx("option",{children:"Iron"}),h.jsx("option",{children:"B12"}),h.jsx("option",{children:"Hemoglobin"})]})]}),h.jsx(Sw,{width:"100%",height:200,children:h.jsxs(gte,{data:ve.map((fe,He)=>({date:fe.date,score:fe.score})),children:[h.jsx(l_,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),h.jsx(Fd,{dataKey:"date",stroke:"#94a3b8",fontSize:12}),h.jsx(Bd,{stroke:"#94a3b8",fontSize:12}),h.jsx(us,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px"},labelStyle:{color:"#64748b"}}),h.jsx(Ym,{type:"monotone",dataKey:"score",stroke:"#f59e0b",strokeWidth:2,dot:{fill:"#f59e0b",strokeWidth:2}})]})}),h.jsxs("div",{className:"flex items-center gap-4 mt-4 text-sm",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),h.jsx("span",{className:"text-slate-600",children:"Health Score Trend"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(uTe,{className:"w-4 h-4 text-green-500"}),h.jsx("span",{className:"text-slate-500",children:"Target: 80+ score"})]})]})]}),(U==null?void 0:U.recommendations)&&h.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[h.jsxs("h4",{className:"text-slate-800 font-medium mb-4 flex items-center gap-2",children:[h.jsx(vJ,{className:"w-5 h-5 text-cyan-500"}),"Personalized Recommendations"]}),h.jsx("div",{className:"space-y-3",children:(ae=U.recommendations.lifestyle)==null?void 0:ae.slice(0,3).map((fe,He)=>h.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-lg",children:[h.jsx(va,{className:"w-5 h-5 text-green-500 mt-0.5 shrink-0"}),h.jsx("div",{children:h.jsx("p",{className:"text-slate-800 font-medium text-sm",children:fe})})]},He))})]})]}),h.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[h.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[h.jsxs("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl border border-cyan-200 p-6",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("div",{className:"flex items-center gap-2",children:h.jsxs("div",{className:"px-3 py-1 bg-cyan-100 rounded-full flex items-center gap-2",children:[h.jsx(pP,{className:"w-4 h-4 text-cyan-600"}),h.jsx("span",{className:"text-cyan-700 text-sm font-medium",children:"AI ANALYSIS"})]})}),h.jsx("span",{className:"text-slate-500 text-sm",children:U?"Based on your reports":"No reports yet"})]}),h.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-3",children:((ce=U==null?void 0:U.summary)==null?void 0:ce.split(".")[0])||"Upload a health report to get AI insights"}),h.jsx("p",{className:"text-slate-600 mb-6",children:U?U.summary:"Our AI will analyze your health reports and provide personalized insights, recommendations, and track your health trends over time."}),h.jsxs("div",{className:"flex flex-wrap gap-3",children:[n!=null&&n.latestReportId?h.jsxs(Tn,{to:`/reports/${n.latestReportId}`,className:"px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-2",children:[h.jsx(Vx,{className:"w-4 h-4"}),"Chat with AI Assistant"]}):h.jsxs(Tn,{to:"/upload",className:"px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-2",children:[h.jsx(Wo,{className:"w-4 h-4"}),"Upload Your First Report"]}),!Q&&h.jsxs("button",{onClick:N,disabled:b,className:"px-6 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50 flex items-center gap-2",children:[h.jsx(NJ,{className:`w-4 h-4 ${b?"animate-spin":""}`}),b?"Generating...":"Generate Demo Data"]}),Q&&h.jsx(Tn,{to:"/wearables",className:"px-6 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50",children:"View Wearable Data"})]})]}),((Se=U==null?void 0:U.keyFindings)==null?void 0:Se.length)>0&&h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[h.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Key Findings from Your Reports"}),h.jsx("div",{className:"space-y-3",children:U.keyFindings.slice(0,4).map((fe,He)=>{const Ye=typeof fe=="string"?fe:fe.title||fe.finding||JSON.stringify(fe),gt=typeof fe=="object"?fe.description:null,Vt=typeof fe=="object"?fe.severity:"low";return h.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-xl",children:[h.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${Vt==="high"?"bg-red-500":Vt==="medium"?"bg-amber-500":"bg-emerald-500"}`}),h.jsxs("div",{children:[h.jsx("p",{className:"text-slate-800 font-medium",children:Ye}),gt&&h.jsx("p",{className:"text-slate-500 text-sm mt-1",children:gt})]})]},He)})})]})]}),h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("h3",{className:"font-semibold text-slate-800",children:"Connected Devices"}),h.jsx(Tn,{to:"/wearables",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"Manage"})]}),h.jsx("div",{className:"space-y-3",children:((je=o==null?void 0:o.devices)==null?void 0:je.length)>0?o.devices.map((fe,He)=>h.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center",children:h.jsx(Rc,{className:"w-5 h-5 text-cyan-500"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-slate-800 font-medium",children:fe.name||fe.type}),h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),h.jsx("span",{className:"text-emerald-600 text-xs",children:"Connected"})]})]})]}),h.jsxs("div",{className:"flex items-center gap-1 text-slate-500",children:[h.jsx(yJ,{className:"w-4 h-4"}),h.jsx("span",{className:"text-sm",children:"82%"})]})]},He)):h.jsxs("div",{className:"text-center py-4",children:[h.jsx(Rc,{className:"w-10 h-10 text-slate-300 mx-auto mb-2"}),h.jsx("p",{className:"text-slate-500 text-sm",children:"No devices connected"}),h.jsx(Tn,{to:"/wearables",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"+ Connect Device"})]})})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("h3",{className:"font-semibold text-slate-800",children:"Recent Reports"}),h.jsx(Tn,{to:"/profile",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"View All"})]}),h.jsx("div",{className:"space-y-3",children:(V==null?void 0:V.length)>0?V.slice(0,3).map(fe=>h.jsxs(Tn,{to:`/reports/${fe._id}`,className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center",children:h.jsx(hi,{className:"w-5 h-5 text-red-500"})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"text-slate-800 font-medium truncate",children:fe.reportType}),h.jsx("p",{className:"text-slate-400 text-sm",children:new Date(fe.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),h.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${fe.status==="completed"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:fe.status==="completed"?"ANALYZED":"PENDING"})]},fe._id)):h.jsxs("div",{className:"text-center py-4",children:[h.jsx(hi,{className:"w-10 h-10 text-slate-300 mx-auto mb-2"}),h.jsx("p",{className:"text-slate-500 text-sm",children:"No reports uploaded yet"}),h.jsx(Tn,{to:"/upload",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"+ Upload Report"})]})})]})]})]})]})}function Ize(){var b,T;const{user:e}=Ha(),[n,a]=J.useState(null),[o,l]=J.useState(!0);if(J.useEffect(()=>{(async()=>{try{const{data:A}=await Ua.getDashboard();a(A)}catch(A){console.error("Failed to fetch dashboard:",A)}finally{l(!1)}})()},[]),o)return h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),h.jsx("p",{className:"text-slate-500",children:"Loading dashboard..."})]})});const{doctor:p,stats:m,todaySchedule:y,upcomingSchedule:E}=n||{};return(p==null?void 0:p.approvalStatus)==="pending"?h.jsx("div",{className:"max-w-lg mx-auto mt-20",children:h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[h.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:h.jsx(gs,{className:"w-8 h-8 text-amber-500"})}),h.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Approval Pending"}),h.jsx("p",{className:"text-slate-500 mb-4",children:"Your profile is under review. You'll be notified once approved."}),h.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium",children:[h.jsx(kc,{className:"w-4 h-4"})," Pending Review"]})]})}):(p==null?void 0:p.approvalStatus)==="rejected"?h.jsx("div",{className:"max-w-lg mx-auto mt-20",children:h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[h.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:h.jsx(LJ,{className:"w-8 h-8 text-red-500"})}),h.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Application Rejected"}),h.jsx("p",{className:"text-slate-500",children:"Please contact support for more information."})]})}):h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[h.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["Welcome, Dr. ",(b=p==null?void 0:p.name)==null?void 0:b.split(" ")[0],"! "]}),h.jsx("p",{className:"text-slate-500 mt-1",children:p==null?void 0:p.specialization})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsxs(Tn,{to:"/doctor/availability",className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium transition-all",children:[h.jsx(x_,{className:"w-4 h-4"})," Manage Slots"]}),p!=null&&p.isListed?h.jsxs("span",{className:"px-3 py-2 bg-green-100 text-green-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[h.jsx(va,{className:"w-4 h-4"})," Listed"]}):h.jsxs("span",{className:"px-3 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[h.jsx(kc,{className:"w-4 h-4"})," Not Listed"]})]})]}),h.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:h.jsx(ga,{className:"w-5 h-5 text-blue-600"})}),h.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(m==null?void 0:m.todayAppointments)||0}),h.jsx("p",{className:"text-sm text-slate-500",children:"Today"})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:h.jsx(em,{className:"w-5 h-5 text-green-600"})}),h.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(m==null?void 0:m.upcomingAppointments)||0}),h.jsx("p",{className:"text-sm text-slate-500",children:"Upcoming"})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:h.jsx(Ch,{className:"w-5 h-5 text-purple-600"})}),h.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(m==null?void 0:m.totalPatients)||0}),h.jsx("p",{className:"text-sm text-slate-500",children:"Patients"})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:h.jsx(to,{className:"w-5 h-5 text-amber-600"})}),h.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((T=p==null?void 0:p.rating)==null?void 0:T.toFixed(1))||"0.0"}),h.jsx("p",{className:"text-sm text-slate-500",children:"Rating"})]})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsx("div",{className:"flex items-center justify-between mb-4",children:h.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[h.jsx(ni,{className:"w-5 h-5 text-cyan-500"})," Today's Schedule"]})}),(y==null?void 0:y.length)>0?h.jsx("div",{className:"space-y-3",children:y.map(x=>{var A,D,N,L,P;return h.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center text-cyan-600 font-bold",children:((N=(D=(A=x.patient)==null?void 0:A.name)==null?void 0:D[0])==null?void 0:N.toUpperCase())||"P"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-slate-800",children:(L=x.patient)==null?void 0:L.name}),h.jsx("p",{className:"text-sm text-slate-500",children:x.timeSlot})]})]}),h.jsxs(Tn,{to:`/patient/${(P=x.patient)==null?void 0:P._id}?appointmentId=${x._id}`,className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-xl hover:bg-slate-200 transition-all text-sm flex items-center gap-1",children:[h.jsx(Ux,{className:"w-4 h-4"})," View"]})]},x._id)})}):h.jsxs("div",{className:"text-center py-8 text-slate-500",children:[h.jsx(ga,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),h.jsx("p",{children:"No appointments today"})]})]}),(E==null?void 0:E.length)>0&&h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[h.jsx(gs,{className:"w-5 h-5 text-green-500"})," Upcoming Appointments"]}),h.jsx("div",{className:"space-y-3",children:E.slice(0,5).map(x=>{var A,D,N,L;return h.jsx("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center text-green-600 font-bold",children:((N=(D=(A=x.patient)==null?void 0:A.name)==null?void 0:D[0])==null?void 0:N.toUpperCase())||"P"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-slate-800",children:(L=x.patient)==null?void 0:L.name}),h.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(x.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",x.timeSlot]})]})]})},x._id)})})]})]})}function Vh(e,n,a,o){function l(p){return p instanceof a?p:new a(function(m){m(p)})}return new(a||(a=Promise))(function(p,m){function y(T){try{b(o.next(T))}catch(x){m(x)}}function E(T){try{b(o.throw(T))}catch(x){m(x)}}function b(T){T.done?p(T.value):l(T.value).then(y,E)}b((o=o.apply(e,n||[])).next())})}const Pze=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Tm(e,n,a){const o=Dze(e),{webkitRelativePath:l}=e,p=typeof n=="string"?n:typeof l=="string"&&l.length>0?l:`./${e.name}`;return typeof o.path!="string"&&aY(o,"path",p),aY(o,"relativePath",p),o}function Dze(e){const{name:n}=e;if(n&&n.lastIndexOf(".")!==-1&&!e.type){const o=n.split(".").pop().toLowerCase(),l=Pze.get(o);l&&Object.defineProperty(e,"type",{value:l,writable:!1,configurable:!1,enumerable:!0})}return e}function aY(e,n,a){Object.defineProperty(e,n,{value:a,writable:!1,configurable:!1,enumerable:!0})}const kze=[".DS_Store","Thumbs.db"];function Lze(e){return Vh(this,void 0,void 0,function*(){return lx(e)&&jze(e.dataTransfer)?Fze(e.dataTransfer,e.type):Mze(e)?Uze(e):Array.isArray(e)&&e.every(n=>"getFile"in n&&typeof n.getFile=="function")?Vze(e):[]})}function jze(e){return lx(e)}function Mze(e){return lx(e)&&lx(e.target)}function lx(e){return typeof e=="object"&&e!==null}function Uze(e){return FD(e.target.files).map(n=>Tm(n))}function Vze(e){return Vh(this,void 0,void 0,function*(){return(yield Promise.all(e.map(a=>a.getFile()))).map(a=>Tm(a))})}function Fze(e,n){return Vh(this,void 0,void 0,function*(){if(e.items){const a=FD(e.items).filter(l=>l.kind==="file");if(n!=="drop")return a;const o=yield Promise.all(a.map(Bze));return sY(_te(o))}return sY(FD(e.files).map(a=>Tm(a)))})}function sY(e){return e.filter(n=>kze.indexOf(n.name)===-1)}function FD(e){if(e===null)return[];const n=[];for(let a=0;a<e.length;a++){const o=e[a];n.push(o)}return n}function Bze(e){if(typeof e.webkitGetAsEntry!="function")return oY(e);const n=e.webkitGetAsEntry();return n&&n.isDirectory?Ete(n):oY(e,n)}function _te(e){return e.reduce((n,a)=>[...n,...Array.isArray(a)?_te(a):[a]],[])}function oY(e,n){return Vh(this,void 0,void 0,function*(){var a;if(globalThis.isSecureContext&&typeof e.getAsFileSystemHandle=="function"){const p=yield e.getAsFileSystemHandle();if(p===null)throw new Error(`${e} is not a File`);if(p!==void 0){const m=yield p.getFile();return m.handle=p,Tm(m)}}const o=e.getAsFile();if(!o)throw new Error(`${e} is not a File`);return Tm(o,(a=n==null?void 0:n.fullPath)!==null&&a!==void 0?a:void 0)})}function Wze(e){return Vh(this,void 0,void 0,function*(){return e.isDirectory?Ete(e):Gze(e)})}function Ete(e){const n=e.createReader();return new Promise((a,o)=>{const l=[];function p(){n.readEntries(m=>Vh(this,void 0,void 0,function*(){if(m.length){const y=Promise.all(m.map(Wze));l.push(y),p()}else try{const y=yield Promise.all(l);a(y)}catch(y){o(y)}}),m=>{o(m)})}p()})}function Gze(e){return Vh(this,void 0,void 0,function*(){return new Promise((n,a)=>{e.file(o=>{const l=Tm(o,e.fullPath);n(l)},o=>{a(o)})})})}var t1=function(e,n){if(e&&n){var a=Array.isArray(n)?n:n.split(",");if(a.length===0)return!0;var o=e.name||"",l=(e.type||"").toLowerCase(),p=l.replace(/\/.*$/,"");return a.some(function(m){var y=m.trim().toLowerCase();return y.charAt(0)==="."?o.toLowerCase().endsWith(y):y.endsWith("/*")?p===y.replace(/\/.*$/,""):l===y})}return!0};function cY(e){return zze(e)||Hze(e)||Ste(e)||$ze()}function $ze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function zze(e){if(Array.isArray(e))return BD(e)}function lY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function dY(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?lY(Object(a),!0).forEach(function(o){bte(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):lY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function bte(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function h_(e,n){return qze(e)||Yze(e,n)||Ste(e,n)||Kze()}function Kze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ste(e,n){if(e){if(typeof e=="string")return BD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return BD(e,n)}}function BD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function Yze(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o=[],l=!0,p=!1,m,y;try{for(a=a.call(e);!(l=(m=a.next()).done)&&(o.push(m.value),!(n&&o.length===n));l=!0);}catch(E){p=!0,y=E}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw y}}return o}}function qze(e){if(Array.isArray(e))return e}var Xze=typeof t1=="function"?t1:t1.default,Jze="file-invalid-type",Qze="file-too-large",Zze="file-too-small",e7e="too-many-files",t7e=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=n.split(","),o=a.length>1?"one of ".concat(a.join(", ")):a[0];return{code:Jze,message:"File type must be ".concat(o)}},uY=function(n){return{code:Qze,message:"File is larger than ".concat(n," ").concat(n===1?"byte":"bytes")}},hY=function(n){return{code:Zze,message:"File is smaller than ".concat(n," ").concat(n===1?"byte":"bytes")}},n7e={code:e7e,message:"Too many files"};function wte(e,n){var a=e.type==="application/x-moz-file"||Xze(e,n);return[a,a?null:t7e(n)]}function xte(e,n,a){if(th(e.size))if(th(n)&&th(a)){if(e.size>a)return[!1,uY(a)];if(e.size<n)return[!1,hY(n)]}else{if(th(n)&&e.size<n)return[!1,hY(n)];if(th(a)&&e.size>a)return[!1,uY(a)]}return[!0,null]}function th(e){return e!=null}function r7e(e){var n=e.files,a=e.accept,o=e.minSize,l=e.maxSize,p=e.multiple,m=e.maxFiles,y=e.validator;return!p&&n.length>1||p&&m>=1&&n.length>m?!1:n.every(function(E){var b=wte(E,a),T=h_(b,1),x=T[0],A=xte(E,o,l),D=h_(A,1),N=D[0],L=y?y(E):null;return x&&N&&!L})}function dx(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function hS(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(n){return n==="Files"||n==="application/x-moz-file"}):!!e.target&&!!e.target.files}function pY(e){e.preventDefault()}function i7e(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function a7e(e){return e.indexOf("Edge/")!==-1}function s7e(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return i7e(e)||a7e(e)}function wc(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return function(o){for(var l=arguments.length,p=new Array(l>1?l-1:0),m=1;m<l;m++)p[m-1]=arguments[m];return n.some(function(y){return!dx(o)&&y&&y.apply(void 0,[o].concat(p)),dx(o)})}}function o7e(){return"showOpenFilePicker"in window}function c7e(e){if(th(e)){var n=Object.entries(e).filter(function(a){var o=h_(a,2),l=o[0],p=o[1],m=!0;return Tte(l)||(console.warn('Skipped "'.concat(l,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),m=!1),(!Array.isArray(p)||!p.every(Cte))&&(console.warn('Skipped "'.concat(l,'" because an invalid file extension was provided.')),m=!1),m}).reduce(function(a,o){var l=h_(o,2),p=l[0],m=l[1];return dY(dY({},a),{},bte({},p,m))},{});return[{description:"Files",accept:n}]}return e}function l7e(e){if(th(e))return Object.entries(e).reduce(function(n,a){var o=h_(a,2),l=o[0],p=o[1];return[].concat(cY(n),[l],cY(p))},[]).filter(function(n){return Tte(n)||Cte(n)}).join(",")}function d7e(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function u7e(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function Tte(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||e==="application/*"||/\w+\/[-+.\w]+/g.test(e)}function Cte(e){return/^.*\.[\w]+$/.test(e)}var h7e=["children"],p7e=["open"],f7e=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],m7e=["refKey","onChange","onClick"];function g7e(e){return _7e(e)||y7e(e)||Rte(e)||v7e()}function v7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _7e(e){if(Array.isArray(e))return WD(e)}function n1(e,n){return S7e(e)||b7e(e,n)||Rte(e,n)||E7e()}function E7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rte(e,n){if(e){if(typeof e=="string")return WD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return WD(e,n)}}function WD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function b7e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o=[],l=!0,p=!1,m,y;try{for(a=a.call(e);!(l=(m=a.next()).done)&&(o.push(m.value),!(n&&o.length===n));l=!0);}catch(E){p=!0,y=E}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw y}}return o}}function S7e(e){if(Array.isArray(e))return e}function fY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,o)}return a}function kr(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?fY(Object(a),!0).forEach(function(o){GD(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function GD(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ux(e,n){if(e==null)return{};var a=w7e(e,n),o,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(l=0;l<p.length;l++)o=p[l],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function w7e(e,n){if(e==null)return{};var a={},o=Object.keys(e),l,p;for(p=0;p<o.length;p++)l=o[p],!(n.indexOf(l)>=0)&&(a[l]=e[l]);return a}var oL=J.forwardRef(function(e,n){var a=e.children,o=ux(e,h7e),l=Nte(o),p=l.open,m=ux(l,p7e);return J.useImperativeHandle(n,function(){return{open:p}},[p]),me.createElement(J.Fragment,null,a(kr(kr({},m),{},{open:p})))});oL.displayName="Dropzone";var Ate={disabled:!1,getFilesFromEvent:Lze,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};oL.defaultProps=Ate;oL.propTypes={children:At.func,accept:At.objectOf(At.arrayOf(At.string)),multiple:At.bool,preventDropOnDocument:At.bool,noClick:At.bool,noKeyboard:At.bool,noDrag:At.bool,noDragEventsBubbling:At.bool,minSize:At.number,maxSize:At.number,maxFiles:At.number,disabled:At.bool,getFilesFromEvent:At.func,onFileDialogCancel:At.func,onFileDialogOpen:At.func,useFsAccessApi:At.bool,autoFocus:At.bool,onDragEnter:At.func,onDragLeave:At.func,onDragOver:At.func,onDrop:At.func,onDropAccepted:At.func,onDropRejected:At.func,onError:At.func,validator:At.func};var $D={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Nte(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=kr(kr({},Ate),e),a=n.accept,o=n.disabled,l=n.getFilesFromEvent,p=n.maxSize,m=n.minSize,y=n.multiple,E=n.maxFiles,b=n.onDragEnter,T=n.onDragLeave,x=n.onDragOver,A=n.onDrop,D=n.onDropAccepted,N=n.onDropRejected,L=n.onFileDialogCancel,P=n.onFileDialogOpen,U=n.useFsAccessApi,V=n.autoFocus,F=n.preventDropOnDocument,H=n.noClick,B=n.noKeyboard,z=n.noDrag,Y=n.noDragEventsBubbling,Q=n.onError,re=n.validator,de=J.useMemo(function(){return l7e(a)},[a]),le=J.useMemo(function(){return c7e(a)},[a]),he=J.useMemo(function(){return typeof P=="function"?P:mY},[P]),Re=J.useMemo(function(){return typeof L=="function"?L:mY},[L]),ve=J.useRef(null),we=J.useRef(null),ue=J.useReducer(x7e,$D),be=n1(ue,2),ae=be[0],ce=be[1],Se=ae.isFocused,je=ae.isFileDialogActive,fe=J.useRef(typeof window<"u"&&window.isSecureContext&&U&&o7e()),He=function(){!fe.current&&je&&setTimeout(function(){if(we.current){var Pt=we.current.files;Pt.length||(ce({type:"closeDialog"}),Re())}},300)};J.useEffect(function(){return window.addEventListener("focus",He,!1),function(){window.removeEventListener("focus",He,!1)}},[we,je,Re,fe]);var Ye=J.useRef([]),gt=function(Pt){ve.current&&ve.current.contains(Pt.target)||(Pt.preventDefault(),Ye.current=[])};J.useEffect(function(){return F&&(document.addEventListener("dragover",pY,!1),document.addEventListener("drop",gt,!1)),function(){F&&(document.removeEventListener("dragover",pY),document.removeEventListener("drop",gt))}},[ve,F]),J.useEffect(function(){return!o&&V&&ve.current&&ve.current.focus(),function(){}},[ve,V,o]);var Vt=J.useCallback(function(Je){Q?Q(Je):console.error(Je)},[Q]),zn=J.useCallback(function(Je){Je.preventDefault(),Je.persist(),Ri(Je),Ye.current=[].concat(g7e(Ye.current),[Je.target]),hS(Je)&&Promise.resolve(l(Je)).then(function(Pt){if(!(dx(Je)&&!Y)){var Ar=Pt.length,Kn=Ar>0&&r7e({files:Pt,accept:de,minSize:m,maxSize:p,multiple:y,maxFiles:E,validator:re}),Gi=Ar>0&&!Kn;ce({isDragAccept:Kn,isDragReject:Gi,isDragActive:!0,type:"setDraggedFiles"}),b&&b(Je)}}).catch(function(Pt){return Vt(Pt)})},[l,b,Vt,Y,de,m,p,y,E,re]),_r=J.useCallback(function(Je){Je.preventDefault(),Je.persist(),Ri(Je);var Pt=hS(Je);if(Pt&&Je.dataTransfer)try{Je.dataTransfer.dropEffect="copy"}catch{}return Pt&&x&&x(Je),!1},[x,Y]),it=J.useCallback(function(Je){Je.preventDefault(),Je.persist(),Ri(Je);var Pt=Ye.current.filter(function(Kn){return ve.current&&ve.current.contains(Kn)}),Ar=Pt.indexOf(Je.target);Ar!==-1&&Pt.splice(Ar,1),Ye.current=Pt,!(Pt.length>0)&&(ce({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),hS(Je)&&T&&T(Je))},[ve,T,Y]),Nt=J.useCallback(function(Je,Pt){var Ar=[],Kn=[];Je.forEach(function(Gi){var Uc=wte(Gi,de),Vc=n1(Uc,2),Fh=Vc[0],Bh=Vc[1],Wh=xte(Gi,m,p),_s=n1(Wh,2),Gh=_s[0],qm=_s[1],Xm=re?re(Gi):null;if(Fh&&Gh&&!Xm)Ar.push(Gi);else{var Jo=[Bh,qm];Xm&&(Jo=Jo.concat(Xm)),Kn.push({file:Gi,errors:Jo.filter(function(D_){return D_})})}}),(!y&&Ar.length>1||y&&E>=1&&Ar.length>E)&&(Ar.forEach(function(Gi){Kn.push({file:Gi,errors:[n7e]})}),Ar.splice(0)),ce({acceptedFiles:Ar,fileRejections:Kn,isDragReject:Kn.length>0,type:"setFiles"}),A&&A(Ar,Kn,Pt),Kn.length>0&&N&&N(Kn,Pt),Ar.length>0&&D&&D(Ar,Pt)},[ce,y,de,m,p,E,A,D,N,re]),Ut=J.useCallback(function(Je){Je.preventDefault(),Je.persist(),Ri(Je),Ye.current=[],hS(Je)&&Promise.resolve(l(Je)).then(function(Pt){dx(Je)&&!Y||Nt(Pt,Je)}).catch(function(Pt){return Vt(Pt)}),ce({type:"reset"})},[l,Nt,Vt,Y]),Pe=J.useCallback(function(){if(fe.current){ce({type:"openDialog"}),he();var Je={multiple:y,types:le};window.showOpenFilePicker(Je).then(function(Pt){return l(Pt)}).then(function(Pt){Nt(Pt,null),ce({type:"closeDialog"})}).catch(function(Pt){d7e(Pt)?(Re(Pt),ce({type:"closeDialog"})):u7e(Pt)?(fe.current=!1,we.current?(we.current.value=null,we.current.click()):Vt(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Vt(Pt)});return}we.current&&(ce({type:"openDialog"}),he(),we.current.value=null,we.current.click())},[ce,he,Re,U,Nt,Vt,le,y]),St=J.useCallback(function(Je){!ve.current||!ve.current.isEqualNode(Je.target)||(Je.key===" "||Je.key==="Enter"||Je.keyCode===32||Je.keyCode===13)&&(Je.preventDefault(),Pe())},[ve,Pe]),Ot=J.useCallback(function(){ce({type:"focus"})},[]),Pn=J.useCallback(function(){ce({type:"blur"})},[]),wn=J.useCallback(function(){H||(s7e()?setTimeout(Pe,0):Pe())},[H,Pe]),Oe=function(Pt){return o?null:Pt},rt=function(Pt){return B?null:Oe(Pt)},Qt=function(Pt){return z?null:Oe(Pt)},Ri=function(Pt){Y&&Pt.stopPropagation()},Ka=J.useMemo(function(){return function(){var Je=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Pt=Je.refKey,Ar=Pt===void 0?"ref":Pt,Kn=Je.role,Gi=Je.onKeyDown,Uc=Je.onFocus,Vc=Je.onBlur,Fh=Je.onClick,Bh=Je.onDragEnter,Wh=Je.onDragOver,_s=Je.onDragLeave,Gh=Je.onDrop,qm=ux(Je,f7e);return kr(kr(GD({onKeyDown:rt(wc(Gi,St)),onFocus:rt(wc(Uc,Ot)),onBlur:rt(wc(Vc,Pn)),onClick:Oe(wc(Fh,wn)),onDragEnter:Qt(wc(Bh,zn)),onDragOver:Qt(wc(Wh,_r)),onDragLeave:Qt(wc(_s,it)),onDrop:Qt(wc(Gh,Ut)),role:typeof Kn=="string"&&Kn!==""?Kn:"presentation"},Ar,ve),!o&&!B?{tabIndex:0}:{}),qm)}},[ve,St,Ot,Pn,wn,zn,_r,it,Ut,B,z,o]),so=J.useCallback(function(Je){Je.stopPropagation()},[]),Pl=J.useMemo(function(){return function(){var Je=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Pt=Je.refKey,Ar=Pt===void 0?"ref":Pt,Kn=Je.onChange,Gi=Je.onClick,Uc=ux(Je,m7e),Vc=GD({accept:de,multiple:y,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Oe(wc(Kn,Ut)),onClick:Oe(wc(Gi,so)),tabIndex:-1},Ar,we);return kr(kr({},Vc),Uc)}},[we,a,y,Ut,o]);return kr(kr({},ae),{},{isFocused:Se&&!o,getRootProps:Ka,getInputProps:Pl,rootRef:ve,inputRef:we,open:Oe(Pe)})}function x7e(e,n){switch(n.type){case"focus":return kr(kr({},e),{},{isFocused:!0});case"blur":return kr(kr({},e),{},{isFocused:!1});case"openDialog":return kr(kr({},$D),{},{isFileDialogActive:!0});case"closeDialog":return kr(kr({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return kr(kr({},e),{},{isDragActive:n.isDragActive,isDragAccept:n.isDragAccept,isDragReject:n.isDragReject});case"setFiles":return kr(kr({},e),{},{acceptedFiles:n.acceptedFiles,fileRejections:n.fileRejections,isDragReject:n.isDragReject});case"reset":return kr({},$D);default:return e}}function mY(){}const T7e=[{value:"Blood Test",label:"Blood Test"},{value:"X-Ray",label:"X-Ray"},{value:"MRI",label:"MRI"},{value:"CT Scan",label:"CT Scan"},{value:"ECG",label:"ECG"},{value:"Ultrasound",label:"Ultrasound"},{value:"General Checkup",label:"General Checkup"},{value:"Other",label:"Other"}];function C7e(){const[e,n]=J.useState([]),[a,o]=J.useState(!1),[l,p]=J.useState(0),m=ro(),y=J.useCallback(U=>{const V=U.map(F=>({file:F,id:Math.random().toString(36).substr(2,9),reportType:"Blood Test",name:F.name,size:F.size}));n(F=>[...F,...V])},[]),{getRootProps:E,getInputProps:b,isDragActive:T}=Nte({onDrop:y,accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]},maxSize:10*1024*1024}),x=(U,V)=>{n(F=>F.map(H=>H.id===U?{...H,reportType:V}:H))},A=U=>{n(V=>V.filter(F=>F.id!==U))},D=async U=>{var F,H;if(U.preventDefault(),e.length===0){bt.error("Please select at least one file");return}o(!0),p(0);const V=setInterval(()=>{p(B=>B>=90?(clearInterval(V),90):B+10)},500);try{const B=new FormData;B.append("report",e[0].file),B.append("reportType",e[0].reportType);const{data:z}=await mh.uploadReport(B);clearInterval(V),p(100),bt.success("Report analyzed successfully!"),setTimeout(()=>m(`/reports/${z.report._id}`),500)}catch(B){clearInterval(V),bt.error(((H=(F=B.response)==null?void 0:F.data)==null?void 0:H.message)||"Failed to analyze report"),p(0)}finally{o(!1)}},L=(e.reduce((U,V)=>U+V.size,0)/(1024*1024)).toFixed(1),P=100;return h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Upload Medical Reports"}),h.jsx("p",{className:"text-slate-500 mt-1",children:"Upload your medical documents for AI-powered analysis"})]}),h.jsx("div",{className:"relative rounded-2xl overflow-hidden shadow-lg bg-gradient-to-r from-cyan-500 to-blue-500 p-6 sm:p-8",children:h.jsxs("div",{className:"text-white max-w-2xl",children:[h.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",children:"How It Works"}),h.jsx("p",{className:"text-white/90 text-sm",children:"Upload your medical reports and get instant AI-powered analysis with personalized health insights"})]})}),h.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[h.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[h.jsxs("div",{...E(),className:`relative border-2 border-dashed rounded-2xl p-12 text-center cursor-pointer transition-all ${T?"border-cyan-500 bg-cyan-50":"border-slate-300 hover:border-cyan-400 bg-white"}`,children:[h.jsx("input",{...b()}),h.jsx("div",{className:"w-16 h-16 rounded-2xl bg-cyan-100 flex items-center justify-center mx-auto mb-4",children:h.jsx(Wo,{className:"w-8 h-8 text-cyan-600"})}),h.jsx("p",{className:"text-lg font-semibold text-slate-800 mb-2",children:T?"Drop your files here":"Drag & drop files here"}),h.jsx("p",{className:"text-slate-500 mb-4",children:"or click to browse from your device"}),h.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-slate-600",children:[h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(va,{className:"w-4 h-4 text-emerald-500"})," PDF"]}),h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(va,{className:"w-4 h-4 text-emerald-500"})," PNG"]}),h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(va,{className:"w-4 h-4 text-emerald-500"})," JPG"]}),h.jsx("span",{children:"Max 10MB per file"})]})]}),e.length>0&&h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm",children:[h.jsx("div",{className:"p-4 border-b border-slate-200",children:h.jsxs("h3",{className:"font-semibold text-slate-800",children:["Uploaded Files (",e.length,")"]})}),h.jsx("div",{className:"divide-y divide-slate-200",children:e.map(U=>h.jsxs("div",{className:"p-4 flex items-center gap-4",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center",children:h.jsx(hi,{className:"w-5 h-5 text-cyan-600"})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"font-medium text-slate-800 truncate",children:U.name}),h.jsxs("p",{className:"text-sm text-slate-500",children:[(U.size/1024/1024).toFixed(2)," MB"]})]}),h.jsxs("div",{className:"relative",children:[h.jsx("select",{value:U.reportType,onChange:V=>x(U.id,V.target.value),className:"appearance-none bg-white text-slate-800 text-sm px-4 py-2 pr-8 rounded-xl border border-slate-300 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none cursor-pointer",children:T7e.map(V=>h.jsx("option",{value:V.value,children:V.label},V.value))}),h.jsx(Xk,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]}),h.jsx("button",{onClick:()=>A(U.id),className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",children:h.jsx(hTe,{className:"w-5 h-5"})})]},U.id))})]}),a&&h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center",children:h.jsx(uz,{className:"w-5 h-5 text-cyan-600 animate-spin"})}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-slate-800",children:"Analyzing your report..."}),h.jsx("p",{className:"text-sm text-slate-500",children:"AI is extracting health insights"})]})]}),h.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:h.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full transition-all duration-500",style:{width:`${l}%`}})}),h.jsxs("p",{className:"text-sm text-slate-500 mt-2 text-right",children:[l,"%"]})]}),h.jsx("div",{className:"relative rounded-2xl overflow-hidden shadow-lg bg-gradient-to-br from-purple-500 to-pink-500 p-6",children:h.jsxs("div",{className:"text-white",children:[h.jsx("h3",{className:"text-lg font-bold mb-1",children:"AI-Powered Analysis"}),h.jsx("p",{className:"text-white/90 text-sm",children:"Get detailed insights, health scores, and personalized recommendations"})]})}),h.jsx("button",{onClick:D,disabled:a||e.length===0,className:"w-full py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:a?h.jsxs(h.Fragment,{children:[h.jsx(uz,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):h.jsxs(h.Fragment,{children:[h.jsx(Wo,{className:"w-5 h-5"}),"Upload & Analyze"]})})]}),h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center",children:h.jsx(Zxe,{className:"w-5 h-5 text-blue-600"})}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-slate-800",children:"Storage"}),h.jsxs("p",{className:"text-sm text-slate-500",children:[L," MB of ",P," MB"]})]})]}),h.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:h.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full",style:{width:`${parseFloat(L)/P*100}%`}})})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsx("h3",{className:"font-semibold text-slate-800 mb-4",children:"Recent Uploads"}),h.jsx("div",{className:"space-y-3",children:e.length===0?h.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No files uploaded yet"}):e.slice(0,3).map(U=>h.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[h.jsx(hi,{className:"w-5 h-5 text-cyan-600"}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"text-sm text-slate-800 truncate",children:U.name}),h.jsx("p",{className:"text-xs text-slate-500",children:U.reportType})]})]},U.id))})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[h.jsx(Ny,{className:"w-5 h-5 text-emerald-500"}),h.jsx("span",{className:"font-semibold text-slate-800",children:"Secure Upload"})]}),h.jsx("p",{className:"text-sm text-slate-600",children:"Your files are encrypted end-to-end and stored securely. We comply with HIPAA regulations."})]})]})]}),h.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-slate-500 pt-4",children:[h.jsx(Ny,{className:"w-4 h-4"}),h.jsx("span",{children:"End-to-end Encrypted & HIPAA Compliant"})]})]})}function R7e(){var de,le,he,Re,ve,we,ue,be,ae;const{id:e}=Nx(),[n,a]=J.useState(null),[o,l]=J.useState([]),[p,m]=J.useState(!0),[y,E]=J.useState(null),[b,T]=J.useState(!1),[x,A]=J.useState(!1),[D,N]=J.useState(!1),[L,P]=J.useState([]),[U,V]=J.useState(""),[F,H]=J.useState(!1),B=J.useRef(null);J.useEffect(()=>{(async()=>{try{const{data:Se}=await mh.getReport(e);a(Se.report),l(Se.recommendedDoctors||[])}catch{bt.error("Failed to load report")}finally{m(!1)}})()},[e]),J.useEffect(()=>{var ce;(ce=B.current)==null||ce.scrollIntoView({behavior:"smooth"})},[L]);const z=async()=>{var ce,Se;if(y){A(!x);return}T(!0);try{const{data:je}=await mh.compareReport(e);E(je),A(!0)}catch(je){bt.error(((Se=(ce=je.response)==null?void 0:ce.data)==null?void 0:Se.message)||"No previous report found")}finally{T(!1)}},Y=async ce=>{if(ce.preventDefault(),!U.trim()||F)return;const Se=U.trim();V(""),P(je=>[...je,{role:"user",content:Se}]),H(!0);try{const{data:je}=await mh.chatAboutReport(e,Se,L);P(fe=>[...fe,{role:"assistant",content:je.response}])}catch{bt.error("Failed to get response"),P(fe=>fe.slice(0,-1))}finally{H(!1)}};if(p)return h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),h.jsx("p",{className:"text-slate-400",children:"Loading report..."})]})});if(!n)return h.jsx("div",{className:"text-center py-12 text-slate-400",children:"Report not found"});const{aiAnalysis:Q}=n,re=(Q==null?void 0:Q.healthScore)||0;return h.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in",children:[h.jsxs(Tn,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[h.jsx(bl,{className:"w-4 h-4"})," Back to Dashboard"]}),h.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[h.jsx("div",{className:"absolute inset-0 opacity-10",children:h.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),h.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-6",children:[h.jsxs("div",{className:"flex items-center gap-5",children:[h.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:h.jsx(hi,{className:"w-8 h-8"})}),h.jsxs("div",{children:[h.jsxs("h1",{className:"text-2xl font-bold",children:[n.reportType," Report"]}),h.jsxs("p",{className:"text-white/70",children:["Analyzed on ",new Date(n.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]}),h.jsxs("div",{className:"text-center p-4 bg-white/10 backdrop-blur-sm rounded-xl",children:[h.jsx("p",{className:"text-4xl font-bold",children:re}),h.jsx("p",{className:"text-sm text-white/70",children:"Health Score"})]})]}),h.jsxs("div",{className:"relative flex gap-3 mt-6 pt-6 border-t border-white/20",children:[h.jsxs("button",{onClick:z,disabled:b,className:"flex items-center gap-2 px-4 py-2.5 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 transition-all font-medium",children:[h.jsx(aw,{className:"w-4 h-4"}),b?"Loading...":x?"Hide Comparison":"Compare with Previous"]}),h.jsxs("button",{onClick:()=>N(!D),className:"flex items-center gap-2 px-4 py-2.5 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 transition-all font-medium",children:[h.jsx(hP,{className:"w-4 h-4"}),"Ask AI Questions"]})]})]}),x&&y&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-blue-500/30 p-6",children:[h.jsxs("div",{className:"flex items-center justify-between mb-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[h.jsx(aw,{className:"w-5 h-5 text-blue-400"})," Health Comparison"]}),h.jsx("span",{className:`px-3 py-1 rounded-lg text-sm font-medium ${y.comparison.overallTrend==="improved"?"bg-emerald-500/20 text-emerald-400":y.comparison.overallTrend==="declined"?"bg-red-500/20 text-red-400":"bg-slate-700 text-slate-400"}`,children:y.comparison.overallTrend==="improved"?" Improved":y.comparison.overallTrend==="declined"?" Declined":" Stable"})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[h.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700",children:[h.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Previous Report"}),h.jsx("p",{className:"font-medium text-white",children:new Date(y.previousReport.createdAt).toLocaleDateString()}),h.jsxs("p",{className:"text-2xl font-bold text-slate-400",children:[y.previousReport.healthScore,"/100"]})]}),h.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-cyan-500/30",children:[h.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Current Report"}),h.jsx("p",{className:"font-medium text-white",children:new Date(y.currentReport.createdAt).toLocaleDateString()}),h.jsxs("p",{className:"text-2xl font-bold text-cyan-400",children:[y.currentReport.healthScore,"/100"]})]})]}),h.jsx("p",{className:"text-slate-400",children:y.comparison.summary})]}),D&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-violet-500/30 p-6",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[h.jsx(pP,{className:"w-5 h-5 text-violet-400"})," Ask About Your Report"]}),h.jsx("button",{onClick:()=>N(!1),className:"p-2 text-slate-400 hover:text-white rounded-lg",children:h.jsx(zo,{className:"w-5 h-5"})})]}),h.jsxs("div",{className:"h-64 overflow-y-auto mb-4 space-y-3 p-4 bg-slate-800 rounded-xl",children:[L.length===0&&h.jsxs("p",{className:"text-slate-500 text-center py-8",children:["Ask any questions about your health report.",h.jsx("br",{}),'"What does my hemoglobin level mean?"']}),L.map((ce,Se)=>h.jsx("div",{className:`flex ${ce.role==="user"?"justify-end":"justify-start"}`,children:h.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${ce.role==="user"?"bg-violet-600 text-white":"bg-slate-700 text-slate-200"}`,children:ce.content})},Se)),F&&h.jsx("div",{className:"flex justify-start",children:h.jsx("div",{className:"bg-slate-700 p-3 rounded-xl",children:h.jsx("span",{className:"animate-pulse text-slate-400",children:"Thinking..."})})}),h.jsx("div",{ref:B})]}),h.jsxs("form",{onSubmit:Y,className:"flex gap-2",children:[h.jsx("input",{type:"text",value:U,onChange:ce=>V(ce.target.value),placeholder:"Ask a question...",className:"flex-1 bg-slate-800 border border-slate-700 rounded-xl py-3 px-4 text-white placeholder-slate-500 focus:border-violet-500 focus:outline-none",disabled:F}),h.jsx("button",{type:"submit",disabled:F||!U.trim(),className:"px-4 py-3 bg-violet-600 text-white rounded-xl hover:bg-violet-700 transition-all disabled:opacity-50",children:h.jsx(Dm,{className:"w-5 h-5"})})]})]}),(Q==null?void 0:Q.summary)&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[h.jsx(ni,{className:"w-5 h-5 text-cyan-400"})," Summary"]}),h.jsx("p",{className:"text-slate-400 leading-relaxed",children:Q.summary})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[((de=Q==null?void 0:Q.keyFindings)==null?void 0:de.length)>0&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(Yo,{className:"w-5 h-5 text-blue-400"})," Key Findings"]}),h.jsx("ul",{className:"space-y-2",children:Q.keyFindings.map((ce,Se)=>h.jsxs("li",{className:"flex items-start gap-3 text-sm text-slate-400",children:[h.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),ce]},Se))})]}),((le=Q==null?void 0:Q.riskFactors)==null?void 0:le.length)>0&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border-l-4 border-amber-500 border-t border-r border-b border-slate-700 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(Mx,{className:"w-5 h-5 text-amber-400"})," Risk Factors"]}),h.jsx("ul",{className:"space-y-2",children:Q.riskFactors.map((ce,Se)=>h.jsxs("li",{className:"flex items-start gap-3 text-sm text-slate-400",children:[h.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full mt-2 flex-shrink-0"}),ce]},Se))})]})]}),(Q==null?void 0:Q.metrics)&&Object.keys(Q.metrics).length>0&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Health Metrics"}),h.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(Q.metrics).map(([ce,Se])=>h.jsxs("div",{className:`p-4 rounded-xl border ${Se.status==="normal"?"bg-emerald-500/10 border-emerald-500/30":Se.status==="borderline"?"bg-amber-500/10 border-amber-500/30":"bg-red-500/10 border-red-500/30"}`,children:[h.jsx("p",{className:"text-sm text-slate-400 capitalize mb-1",children:ce.replace(/([A-Z])/g," $1")}),h.jsxs("p",{className:"text-2xl font-bold text-white",children:[Se.value," ",h.jsx("span",{className:"text-sm font-normal text-slate-500",children:Se.unit})]}),h.jsxs("div",{className:"flex items-center justify-between mt-2",children:[h.jsxs("span",{className:"text-xs text-slate-500",children:["Normal: ",Se.normalRange]}),h.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Se.status==="normal"?"bg-emerald-500/20 text-emerald-400":Se.status==="borderline"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}`,children:Se.status})]})]},ce))})]}),((he=Q==null?void 0:Q.deficiencies)==null?void 0:he.length)>0&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border-l-4 border-amber-500 border-t border-r border-b border-slate-700 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-6 flex items-center gap-2",children:[h.jsx(Jk,{className:"w-5 h-5 text-amber-400"})," Detected Deficiencies"]}),h.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Q.deficiencies.map((ce,Se)=>{var je;return h.jsxs("div",{className:`p-4 rounded-xl ${ce.severity==="severe"?"bg-red-500/10 border border-red-500/30":ce.severity==="moderate"?"bg-amber-500/10 border border-amber-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx("span",{className:"font-bold text-white",children:ce.name}),h.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${ce.severity==="severe"?"bg-red-500/20 text-red-400":ce.severity==="moderate"?"bg-amber-500/20 text-amber-400":"bg-yellow-500/20 text-yellow-400"}`,children:ce.severity})]}),h.jsxs("p",{className:"text-sm text-slate-400",children:["Current: ",ce.currentValue]}),h.jsxs("p",{className:"text-sm text-slate-500",children:["Normal: ",ce.normalRange]}),((je=ce.symptoms)==null?void 0:je.length)>0&&h.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Symptoms: ",ce.symptoms.join(", ")]})]},Se)})})]}),((Re=Q==null?void 0:Q.supplements)==null?void 0:Re.length)>0&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-2 flex items-center gap-2",children:[h.jsx(Bx,{className:"w-5 h-5 text-violet-400"})," Supplement Recommendations"]}),h.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"General supplement categories (not brand-specific)"}),h.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Q.supplements.map((ce,Se)=>h.jsxs("div",{className:"p-4 bg-gradient-to-r from-violet-500/10 to-purple-500/10 rounded-xl border border-violet-500/20",children:[h.jsx("p",{className:"font-bold text-violet-300",children:ce.category}),h.jsx("p",{className:"text-sm text-violet-400/80 mt-1",children:ce.reason}),h.jsx("p",{className:"text-xs text-violet-400 mt-2 font-medium",children:ce.generalDosage}),ce.note&&h.jsx("p",{className:"text-xs text-violet-400/60 mt-1 italic",children:ce.note})]},Se))})]}),(Q==null?void 0:Q.dietPlan)&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-2 flex items-center gap-2",children:[h.jsx(gh,{className:"w-5 h-5 text-emerald-400"})," Personalized Diet Plan"]}),Q.dietPlan.overview&&h.jsx("p",{className:"text-slate-400 mb-6",children:Q.dietPlan.overview}),h.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[{key:"breakfast",label:"Breakfast",icon:"",color:"emerald"},{key:"lunch",label:"Lunch",icon:"",color:"blue"},{key:"dinner",label:"Dinner",icon:"",color:"violet"},{key:"snacks",label:"Snacks",icon:"",color:"amber"}].map(({key:ce,label:Se,icon:je,color:fe})=>{var He;return((He=Q.dietPlan[ce])==null?void 0:He.length)>0&&h.jsxs("div",{className:`p-4 rounded-xl bg-${fe}-500/10 border border-${fe}-500/20`,children:[h.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[h.jsx("span",{className:"text-xl",children:je}),h.jsx("span",{className:`font-bold text-${fe}-400`,children:Se})]}),Q.dietPlan[ce].map((Ye,gt)=>h.jsxs("div",{className:"mb-2",children:[h.jsx("p",{className:`text-sm text-${fe}-300`,children:Ye.meal}),Ye.tip&&h.jsx("p",{className:`text-xs text-${fe}-400/60 italic`,children:Ye.tip})]},gt))]},ce)})}),(((ve=Q.dietPlan.foodsToIncrease)==null?void 0:ve.length)>0||((we=Q.dietPlan.foodsToLimit)==null?void 0:we.length)>0)&&h.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[((ue=Q.dietPlan.foodsToIncrease)==null?void 0:ue.length)>0&&h.jsxs("div",{className:"p-4 bg-emerald-500/10 rounded-xl border border-emerald-500/20",children:[h.jsx("h3",{className:"font-bold text-emerald-400 mb-3",children:" Foods to Increase"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:Q.dietPlan.foodsToIncrease.map((ce,Se)=>h.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-full",children:ce},Se))})]}),((be=Q.dietPlan.foodsToLimit)==null?void 0:be.length)>0&&h.jsxs("div",{className:"p-4 bg-red-500/10 rounded-xl border border-red-500/20",children:[h.jsx("h3",{className:"font-bold text-red-400 mb-3",children:" Foods to Limit"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:Q.dietPlan.foodsToLimit.map((ce,Se)=>h.jsx("span",{className:"text-xs bg-red-500/20 text-red-400 px-3 py-1 rounded-full",children:ce},Se))})]})]}),((ae=Q.dietPlan.tips)==null?void 0:ae.length)>0&&h.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[h.jsxs("h3",{className:"font-bold text-white mb-3 flex items-center gap-2",children:[h.jsx(pP,{className:"w-4 h-4 text-amber-400"})," Diet Tips"]}),h.jsx("ul",{className:"space-y-2",children:Q.dietPlan.tips.map((ce,Se)=>h.jsxs("li",{className:"text-sm text-slate-400 flex items-start gap-2",children:[h.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full mt-2"}),ce]},Se))})]})]}),o.length>0&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-cyan-500/30 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-6 flex items-center gap-2",children:[h.jsx(Ch,{className:"w-5 h-5 text-cyan-400"})," Recommended Doctors"]}),h.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:o.map(ce=>{var Se,je,fe,He,Ye;return h.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[h.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center text-lg font-bold text-white",children:(fe=(je=ce.name||((Se=ce.user)==null?void 0:Se.name))==null?void 0:je[0])==null?void 0:fe.toUpperCase()}),h.jsxs("div",{children:[h.jsxs("p",{className:"font-bold text-white",children:["Dr. ",ce.name||((He=ce.user)==null?void 0:He.name)]}),h.jsx("p",{className:"text-sm text-cyan-400",children:ce.specialization})]})]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400 mb-3",children:[h.jsx(to,{className:"w-4 h-4 text-amber-400 fill-amber-400"}),h.jsx("span",{children:(Ye=ce.rating)==null?void 0:Ye.toFixed(1)}),h.jsx("span",{children:""}),h.jsx(gs,{className:"w-4 h-4"}),h.jsxs("span",{children:[ce.experience," yrs"]})]}),h.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-700",children:[h.jsxs("span",{className:"font-bold text-white",children:["",ce.consultationFee||0]}),h.jsx(Tn,{to:"/doctors",className:"text-sm bg-cyan-600 text-white px-4 py-2 rounded-lg hover:bg-cyan-700 transition-colors",children:"Book Now"})]})]},ce._id)})})]}),h.jsx("div",{className:"p-4 bg-blue-500/10 rounded-xl border border-blue-500/20",children:h.jsxs("p",{className:"text-sm text-blue-400",children:[h.jsx("strong",{children:"Disclaimer:"})," This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider for medical decisions."]})})]})}const A7e=["All","General Physician","Nutritionist","Cardiologist","Dermatologist","Endocrinologist","Neurologist"];function N7e(){var he,Re,ve,we;const e=ro(),[n,a]=J.useState([]),[o,l]=J.useState([]),[p,m]=J.useState(!0),[y,E]=J.useState("All"),[b,T]=J.useState(""),[x,A]=J.useState(null),[D,N]=J.useState({date:"",timeSlot:"",symptoms:""}),[L,P]=J.useState(!1),[U,V]=J.useState("doctors"),[F,H]=J.useState([]),[B,z]=J.useState(!1);J.useEffect(()=>{Y()},[y]);const Y=async()=>{try{const ue={};y!=="All"&&(ue.specialization=y);const[be,ae]=await Promise.all([Ua.getAll(ue),Ua.getAppointments()]);a(be.data),l(ae.data)}catch(ue){console.error("Failed to fetch data:",ue)}finally{m(!1)}};J.useEffect(()=>{x&&D.date&&Q()},[x,D.date]);const Q=async()=>{var ue;if(!(!x||!D.date)){z(!0);try{const{data:be}=await Ua.getDoctorAvailableSlots(x._id);console.log("Slots response:",be);const ae=new Date(D.date).toDateString();console.log("Looking for dateKey:",ae),console.log("Available keys:",Object.keys(be.slotsByDate||{})),H(((ue=be.slotsByDate)==null?void 0:ue[ae])||[])}catch(be){console.error("Failed to fetch slots:",be),H([])}finally{z(!1)}}},re=n.filter(ue=>{var be,ae,ce;return((ae=ue.name||((be=ue.user)==null?void 0:be.name))==null?void 0:ae.toLowerCase().includes(b.toLowerCase()))||((ce=ue.specialization)==null?void 0:ce.toLowerCase().includes(b.toLowerCase()))}),de=async ue=>{var be,ae;if(ue.preventDefault(),!D.date||!D.timeSlot){bt.error("Please select date and time");return}P(!0);try{await Ua.bookAppointment({doctorId:x._id,...D,type:"video"}),bt.success("Appointment booked successfully!"),A(null),N({date:"",timeSlot:"",symptoms:""}),H([]),Y()}catch(ce){bt.error(((ae=(be=ce.response)==null?void 0:be.data)==null?void 0:ae.message)||"Failed to book appointment")}finally{P(!1)}},le=()=>{const ue=[];for(let be=0;be<7;be++){const ae=new Date;ae.setDate(ae.getDate()+be),ue.push({value:ae.toISOString().split("T")[0],label:ae.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:be===0})}return ue};return h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Find Doctors"}),h.jsx("p",{className:"text-slate-500 mt-1",children:"Book video consultations with healthcare specialists"})]}),h.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:[h.jsxs("button",{onClick:()=>V("doctors"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${U==="doctors"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[h.jsx(Sl,{className:"w-4 h-4"})," Find Doctors"]}),h.jsxs("button",{onClick:()=>V("appointments"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${U==="appointments"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[h.jsx(ga,{className:"w-4 h-4"})," My Appointments",o.length>0&&h.jsx("span",{className:"ml-1 px-2 py-0.5 bg-cyan-100 text-cyan-600 text-xs rounded-full",children:o.length})]})]}),U==="doctors"&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-4 shadow-sm",children:h.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[h.jsxs("div",{className:"relative flex-1",children:[h.jsx(sw,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"text",placeholder:"Search doctors...",value:b,onChange:ue=>T(ue.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"})]}),h.jsx("select",{value:y,onChange:ue=>E(ue.target.value),className:"px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:A7e.map(ue=>h.jsx("option",{value:ue,children:ue},ue))})]})}),p?h.jsxs("div",{className:"text-center py-12",children:[h.jsx("div",{className:"w-10 h-10 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto"}),h.jsx("p",{className:"text-slate-500 mt-4",children:"Loading doctors..."})]}):re.length>0?h.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:re.map(ue=>{var ae,ce,Se;const be=ue.name||((ae=ue.user)==null?void 0:ae.name)||"Doctor";return h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[h.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[h.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-xl font-bold text-white",children:(ce=be[0])==null?void 0:ce.toUpperCase()}),h.jsxs("div",{className:"flex-1",children:[h.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",be]}),h.jsx("p",{className:"text-sm text-cyan-600 font-medium",children:ue.specialization}),h.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[h.jsx(to,{className:"w-4 h-4 text-amber-400 fill-amber-400"}),h.jsx("span",{className:"text-sm text-slate-600",children:((Se=ue.rating)==null?void 0:Se.toFixed(1))||"4.5"}),h.jsx("span",{className:"text-slate-300",children:""}),h.jsxs("span",{className:"text-sm text-slate-500",children:[ue.experience||5,"+ yrs"]})]})]})]}),h.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[h.jsxs("div",{children:[h.jsxs("span",{className:"text-xl font-bold text-slate-800",children:["",ue.consultationFee||500]}),h.jsx("span",{className:"text-sm text-slate-500",children:" / session"})]}),h.jsx("button",{onClick:()=>A(ue),className:"px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium rounded-xl hover:shadow-lg transition-all",children:"Book Now"})]})]},ue._id)})}):h.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl border border-slate-200",children:[h.jsx(sw,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),h.jsx("p",{className:"text-slate-500",children:"No doctors found"})]})]}),U==="appointments"&&h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsx("h2",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Your Appointments"}),o.length>0?h.jsx("div",{className:"space-y-3",children:o.map(ue=>{var be,ae,ce,Se,je,fe,He,Ye;return h.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:((je=(Se=((be=ue.doctor)==null?void 0:be.name)||((ce=(ae=ue.doctor)==null?void 0:ae.user)==null?void 0:ce.name))==null?void 0:Se[0])==null?void 0:je.toUpperCase())||"D"}),h.jsxs("div",{children:[h.jsxs("p",{className:"font-medium text-slate-800",children:["Dr. ",((fe=ue.doctor)==null?void 0:fe.name)||((Ye=(He=ue.doctor)==null?void 0:He.user)==null?void 0:Ye.name)]}),h.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(ue.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",ue.timeSlot]})]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${ue.status==="completed"?"bg-green-100 text-green-600":ue.status==="scheduled"?"bg-amber-100 text-amber-600":"bg-red-100 text-red-600"}`,children:ue.status}),ue.status==="scheduled"&&h.jsx("button",{onClick:()=>e(`/consultation/${ue._id}`),className:"px-3 py-1 bg-cyan-500 text-white text-sm font-medium rounded-lg hover:bg-cyan-600",children:"Join Call"})]})]})},ue._id)})}):h.jsxs("div",{className:"text-center py-8",children:[h.jsx(ga,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),h.jsx("p",{className:"text-slate-500",children:"No appointments yet"}),h.jsx("button",{onClick:()=>V("doctors"),className:"mt-3 text-cyan-600 font-medium hover:text-cyan-700",children:"Book your first appointment "})]})]}),x&&h.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:h.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up max-h-[90vh] overflow-y-auto",children:[h.jsxs("div",{className:"flex items-center justify-between mb-6",children:[h.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Book Appointment"}),h.jsx("button",{onClick:()=>{A(null),H([]),N({date:"",timeSlot:"",symptoms:""})},className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg",children:h.jsx(zo,{className:"w-5 h-5"})})]}),h.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-xl mb-6",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(ve=(Re=x.name||((he=x.user)==null?void 0:he.name))==null?void 0:Re[0])==null?void 0:ve.toUpperCase()}),h.jsxs("div",{children:[h.jsxs("p",{className:"font-semibold text-slate-800",children:["Dr. ",x.name||((we=x.user)==null?void 0:we.name)]}),h.jsx("p",{className:"text-sm text-cyan-600",children:x.specialization})]})]}),h.jsxs("form",{onSubmit:de,className:"space-y-5",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Date"}),h.jsx("div",{className:"grid grid-cols-4 gap-2",children:le().map(ue=>h.jsxs("button",{type:"button",onClick:()=>N({...D,date:ue.value,timeSlot:""}),className:`p-2 rounded-xl text-center transition-all ${D.date===ue.value?"bg-cyan-500 text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200"}`,children:[h.jsx("div",{className:"text-xs font-medium",children:ue.label.split(" ")[0]}),h.jsx("div",{className:"text-sm font-bold",children:ue.label.split(" ")[2]})]},ue.value))})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Time"}),B?h.jsxs("div",{className:"flex items-center justify-center py-6",children:[h.jsx("div",{className:"w-6 h-6 border-2 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"}),h.jsx("span",{className:"ml-2 text-slate-500 text-sm",children:"Loading slots..."})]}):F.length>0?h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:F.map(ue=>{const be=D.timeSlot===ue.timeSlot,ae=ue.status==="passed",ce=ue.status==="booked",Se=ue.status==="blocked",je=ue.status==="available";return h.jsxs("button",{type:"button",onClick:()=>je&&N({...D,timeSlot:ue.timeSlot}),disabled:!je,className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${be?"bg-cyan-500 text-white ring-2 ring-cyan-300":ae?"bg-slate-100 text-slate-400 cursor-not-allowed line-through":ce?"bg-red-50 text-red-400 cursor-not-allowed border border-red-200":Se?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200 cursor-pointer"}`,title:ae?"Time passed":ce?"Already booked":Se?"Not available":"Available",children:[ue.timeSlot,ce&&h.jsx("span",{className:"ml-1 text-xs",children:"(Booked)"})]},ue.timeSlot)})}),h.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-slate-500",children:[h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-100 border border-emerald-300"})," Available"]}),h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx("span",{className:"w-3 h-3 rounded-full bg-red-50 border border-red-200"})," Booked"]}),h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx("span",{className:"w-3 h-3 rounded-full bg-slate-100 border border-slate-200"})," Passed/Unavailable"]})]})]}):D.date?h.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[h.jsx(gs,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),h.jsx("p",{className:"text-slate-500 text-sm",children:"No slots available for this date"})]}):h.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[h.jsx(ga,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),h.jsx("p",{className:"text-slate-500 text-sm",children:"Select a date first"})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Symptoms (Optional)"}),h.jsx("textarea",{value:D.symptoms,onChange:ue=>N({...D,symptoms:ue.target.value}),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none resize-none",rows:3,placeholder:"Describe your symptoms..."})]}),h.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-xl",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(jd,{className:"w-5 h-5 text-cyan-600"}),h.jsx("span",{className:"font-medium text-cyan-700",children:"Video Consultation"})]}),h.jsx("p",{className:"text-xs text-cyan-600 mt-1",children:"You'll receive a video call link via email"})]}),h.jsxs("div",{className:"flex gap-3 pt-2",children:[h.jsx("button",{type:"button",onClick:()=>{A(null),H([])},className:"flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 transition-all",children:"Cancel"}),h.jsx("button",{type:"submit",disabled:L||!D.date||!D.timeSlot,className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:L?"Booking...":`Confirm  ${x.consultationFee||500}`})]})]})]})})]})}function O7e(){var H,B,z,Y,Q,re,de,le,he,Re,ve,we,ue,be,ae,ce,Se,je;const{user:e,updateUser:n}=Ha(),[a,o]=J.useState(!1),[l,p]=J.useState(null),[m,y]=J.useState(""),[E,b]=J.useState("profile"),[T,x]=J.useState({name:(e==null?void 0:e.name)||"",profile:{age:((H=e==null?void 0:e.profile)==null?void 0:H.age)||"",gender:((B=e==null?void 0:e.profile)==null?void 0:B.gender)||"",dietaryPreference:((z=e==null?void 0:e.profile)==null?void 0:z.dietaryPreference)||"non-vegetarian",height:((Y=e==null?void 0:e.profile)==null?void 0:Y.height)||"",weight:((Q=e==null?void 0:e.profile)==null?void 0:Q.weight)||"",bloodGroup:((re=e==null?void 0:e.profile)==null?void 0:re.bloodGroup)||"",allergies:((le=(de=e==null?void 0:e.profile)==null?void 0:de.allergies)==null?void 0:le.join(", "))||"",chronicConditions:((Re=(he=e==null?void 0:e.profile)==null?void 0:he.chronicConditions)==null?void 0:Re.join(", "))||""}});J.useEffect(()=>{(async()=>{try{const{data:He}=await mh.getHistory();p(He);const Ye=Object.keys(He.history||{});Ye.length>0&&y(Ye[0])}catch(He){console.error("Failed to fetch health history:",He)}})()},[]);const A=fe=>{const{name:He,value:Ye}=fe.target;if(He.startsWith("profile.")){const gt=He.split(".")[1];x(Vt=>({...Vt,profile:{...Vt.profile,[gt]:Ye}}))}else x(gt=>({...gt,[He]:Ye}))},D=async fe=>{var He,Ye;fe.preventDefault(),o(!0);try{const gt={name:T.name,profile:{...T.profile,age:T.profile.age?Number(T.profile.age):void 0,height:T.profile.height?Number(T.profile.height):void 0,weight:T.profile.weight?Number(T.profile.weight):void 0,allergies:T.profile.allergies?T.profile.allergies.split(",").map(zn=>zn.trim()).filter(Boolean):[],chronicConditions:T.profile.chronicConditions?T.profile.chronicConditions.split(",").map(zn=>zn.trim()).filter(Boolean):[]}},{data:Vt}=await ct.put("/auth/profile",gt);n(Vt),bt.success("Profile updated successfully!")}catch(gt){bt.error(((Ye=(He=gt.response)==null?void 0:He.data)==null?void 0:Ye.message)||"Failed to update profile")}finally{o(!1)}},N=T.profile.height&&T.profile.weight?(T.profile.weight/Math.pow(T.profile.height/100,2)).toFixed(1):null,P=(fe=>fe?fe<18.5?{label:"Underweight",color:"blue"}:fe<25?{label:"Normal",color:"emerald"}:fe<30?{label:"Overweight",color:"amber"}:{label:"Obese",color:"red"}:{label:"N/A",color:"slate"})(parseFloat(N)),U=((we=(ve=l==null?void 0:l.history)==null?void 0:ve[m])==null?void 0:we.map(fe=>({date:new Date(fe.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:fe.healthScore||0})).reverse())||[],V=Object.keys((l==null?void 0:l.history)||{});return(()=>{var gt,Vt;if(!U||U.length<2)return null;const fe=((gt=U[U.length-1])==null?void 0:gt.score)||0,He=((Vt=U[U.length-2])==null?void 0:Vt.score)||0,Ye=fe-He;return{diff:Ye,trend:Ye>0?"improved":Ye<0?"declined":"stable"}})(),h.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fade-in",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"My Profile"}),h.jsx("p",{className:"text-slate-500 mt-1",children:"Manage your information and track health progress"})]}),h.jsxs("div",{className:"bg-gradient-to-r from-cyan-500 to-blue-500 rounded-2xl p-6 text-white relative overflow-hidden shadow-lg",children:[h.jsx("div",{className:"absolute inset-0 opacity-10",children:h.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),h.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center gap-6",children:[h.jsxs("div",{className:"relative",children:[h.jsx("div",{className:"w-20 h-20 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-3xl font-bold",children:(be=(ue=e==null?void 0:e.name)==null?void 0:ue[0])==null?void 0:be.toUpperCase()}),h.jsx("button",{className:"absolute -bottom-2 -right-2 w-8 h-8 bg-white rounded-full flex items-center justify-center text-cyan-600 shadow-lg hover:scale-110 transition-transform",children:h.jsx(EJ,{className:"w-4 h-4"})})]}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h2",{className:"text-2xl font-bold",children:e==null?void 0:e.name}),h.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-2 text-white/90",children:[h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(w_,{className:"w-4 h-4"})," ",e==null?void 0:e.email]}),(e==null?void 0:e.phone)&&h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(Zk,{className:"w-4 h-4"})," ",e==null?void 0:e.phone]})]})]}),h.jsxs("div",{className:"flex gap-4",children:[h.jsxs("div",{className:"text-center p-4 bg-white/10 backdrop-blur-sm rounded-xl",children:[h.jsx("p",{className:"text-3xl font-bold",children:((ae=e==null?void 0:e.healthMetrics)==null?void 0:ae.healthScore)||"--"}),h.jsx("p",{className:"text-sm text-white/80",children:"Health Score"})]}),N&&h.jsxs("div",{className:"text-center p-4 bg-white/10 backdrop-blur-sm rounded-xl",children:[h.jsx("p",{className:"text-3xl font-bold",children:N}),h.jsx("p",{className:"text-sm text-white/80",children:"BMI"})]})]})]})]}),h.jsx("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:[{id:"profile",label:"Edit Profile",icon:Sl},{id:"history",label:"Health History",icon:ni}].map(fe=>h.jsxs("button",{onClick:()=>b(fe.id),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${E===fe.id?"bg-white text-slate-800 shadow-sm":"text-slate-600 hover:text-slate-800"}`,children:[h.jsx(fe.icon,{className:"w-4 h-4"}),fe.label]},fe.id))}),E==="profile"&&h.jsxs("form",{onSubmit:D,className:"grid lg:grid-cols-3 gap-6",children:[h.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[h.jsx(Sl,{className:"w-5 h-5 text-cyan-500"}),"Basic Information"]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-5",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),h.jsx("input",{type:"text",name:"name",value:T.name,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),h.jsx("input",{type:"email",value:e==null?void 0:e.email,className:"w-full bg-slate-50 border border-slate-200 rounded-xl py-3 px-4 text-slate-500",disabled:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),h.jsx("input",{type:"number",name:"profile.age",value:T.profile.age,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"1",max:"120",placeholder:"Enter your age"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),h.jsxs("select",{name:"profile.gender",value:T.profile.gender,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[h.jsx("option",{value:"",children:"Select gender"}),h.jsx("option",{value:"male",children:"Male"}),h.jsx("option",{value:"female",children:"Female"}),h.jsx("option",{value:"other",children:"Other"})]})]}),h.jsxs("div",{className:"md:col-span-2",children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),h.jsxs("select",{name:"profile.dietaryPreference",value:T.profile.dietaryPreference,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[h.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),h.jsx("option",{value:"vegetarian",children:"Vegetarian"}),h.jsx("option",{value:"vegan",children:"Vegan"}),h.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[h.jsx(Yo,{className:"w-5 h-5 text-red-500"}),"Health Information"]}),h.jsxs("div",{className:"grid md:grid-cols-3 gap-5",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),h.jsx("input",{type:"number",name:"profile.height",value:T.profile.height,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"50",max:"300",placeholder:"170"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Weight (kg)"}),h.jsx("input",{type:"number",name:"profile.weight",value:T.profile.weight,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"10",max:"500",placeholder:"70"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Blood Group"}),h.jsxs("select",{name:"profile.bloodGroup",value:T.profile.bloodGroup,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[h.jsx("option",{value:"",children:"Select"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(fe=>h.jsx("option",{value:fe,children:fe},fe))]})]})]})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[h.jsx(kc,{className:"w-5 h-5 text-amber-500"}),"Medical History"]}),h.jsxs("div",{className:"space-y-5",children:[h.jsxs("div",{children:[h.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Allergies ",h.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),h.jsx("input",{type:"text",name:"profile.allergies",value:T.profile.allergies,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Penicillin, Peanuts"})]}),h.jsxs("div",{children:[h.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Chronic Conditions ",h.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),h.jsx("input",{type:"text",name:"profile.chronicConditions",value:T.profile.chronicConditions,onChange:A,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),h.jsx("button",{type:"submit",disabled:a,className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:a?h.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):h.jsxs(h.Fragment,{children:[h.jsx(OJ,{className:"w-5 h-5"}),"Save Changes"]})})]}),h.jsxs("div",{className:"space-y-6",children:[N&&h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"BMI Calculator"}),h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:`w-24 h-24 rounded-full bg-${P.color}-100 flex items-center justify-center mx-auto mb-4`,children:h.jsx("span",{className:`text-3xl font-bold text-${P.color}-600`,children:N})}),h.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium bg-${P.color}-100 text-${P.color}-700`,children:P.label})]})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Quick Stats"}),h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[h.jsx("span",{className:"text-slate-600",children:"Total Reports"}),h.jsx("span",{className:"font-bold text-slate-800",children:(l==null?void 0:l.totalReports)||0})]}),h.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[h.jsx("span",{className:"text-slate-600",children:"Report Types"}),h.jsx("span",{className:"font-bold text-slate-800",children:V.length})]}),h.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[h.jsx("span",{className:"text-slate-600",children:"Subscription"}),h.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-medium capitalize",children:((ce=e==null?void 0:e.subscription)==null?void 0:ce.plan)||"Free"})]})]})]})]})]}),E==="history"&&h.jsx("div",{className:"space-y-6",children:V.length>0?h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[h.jsxs("div",{children:[h.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Health Score Trend"}),h.jsx("p",{className:"text-sm text-slate-500",children:"Track your progress over time"})]}),h.jsx("select",{value:m,onChange:fe=>y(fe.target.value),className:"bg-white border border-slate-300 rounded-xl py-2 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:V.map(fe=>h.jsx("option",{value:fe,children:fe},fe))})]}),U.length>1?h.jsx(Sw,{width:"100%",height:300,children:h.jsxs(vte,{data:U,children:[h.jsx("defs",{children:h.jsxs("linearGradient",{id:"historyGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[h.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.3}),h.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:0})]})}),h.jsx(l_,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),h.jsx(Fd,{dataKey:"date",stroke:"#64748b",fontSize:12}),h.jsx(Bd,{domain:[0,100],stroke:"#64748b",fontSize:12}),h.jsx(us,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"12px"},labelStyle:{color:"#475569"}}),h.jsx(Il,{type:"monotone",dataKey:"score",stroke:"#06b6d4",strokeWidth:3,fill:"url(#historyGradient)"})]})}):h.jsxs("div",{className:"text-center py-12 text-slate-500",children:[h.jsx(hi,{className:"w-12 h-12 mx-auto mb-3 text-slate-300"}),h.jsx("p",{children:"Upload more reports to see your health trend"})]})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6",children:["Recent ",m," Reports"]}),h.jsx("div",{className:"space-y-3",children:(je=(Se=l==null?void 0:l.history)==null?void 0:Se[m])==null?void 0:je.slice(0,5).map((fe,He)=>{var Vt;const Ye=l.history[m][He+1],gt=Ye?fe.healthScore-Ye.healthScore:null;return h.jsxs(Tn,{to:`/reports/${fe._id}`,className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition-all group border border-slate-200",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-cyan-100 flex items-center justify-center",children:h.jsx(hi,{className:"w-6 h-6 text-cyan-600"})}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-slate-800",children:new Date(fe.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),h.jsx("p",{className:"text-sm text-slate-500",children:((Vt=fe.keyFindings)==null?void 0:Vt.slice(0,2).join(", "))||"View details"})]})]}),h.jsxs("div",{className:"flex items-center gap-4",children:[gt!==null&&h.jsxs("span",{className:`text-sm font-semibold ${gt>0?"text-emerald-600":gt<0?"text-red-600":"text-slate-500"}`,children:[gt>0?"+":"",gt]}),h.jsx("span",{className:"text-2xl font-bold text-cyan-600",children:fe.healthScore||"--"}),h.jsx(Jxe,{className:"w-5 h-5 text-slate-400 group-hover:text-cyan-500 transition-colors"})]})]},fe._id)})})]})]}):h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 text-center py-16 shadow-sm",children:[h.jsx(hi,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),h.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"No Health History Yet"}),h.jsx("p",{className:"text-slate-500 mb-6",children:"Upload health reports to track your progress over time"}),h.jsxs(Tn,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:[h.jsx(Wo,{className:"w-5 h-5"}),"Upload Your First Report"]})]})})]})}const r1={name:"John Doe",email:"john@example.com",profile:{age:32,gender:"male",height:175,weight:72,bloodGroup:"O+",allergies:["Penicillin"],chronicConditions:["None"]}},I7e=[{date:"Jul",score:65},{date:"Aug",score:68},{date:"Sep",score:72},{date:"Oct",score:70},{date:"Nov",score:75},{date:"Dec",score:78}],ko={summary:"Overall health is good with some areas needing attention. Blood sugar levels are slightly elevated.",keyFindings:["Hemoglobin levels are normal at 14.2 g/dL","Cholesterol is borderline high at 210 mg/dL","Vitamin D deficiency detected"],riskFactors:["Pre-diabetic blood sugar levels","Sedentary lifestyle indicators"],metrics:{hemoglobin:{value:14.2,unit:"g/dL",status:"normal",normalRange:"12-16"},bloodSugar:{value:115,unit:"mg/dL",status:"borderline",normalRange:"70-100"},cholesterol:{value:210,unit:"mg/dL",status:"borderline",normalRange:"<200"}},recommendations:{diet:[{item:"Leafy Greens",reason:"Rich in iron and vitamins",priority:"high"},{item:"Fatty Fish",reason:"Omega-3 helps reduce cholesterol",priority:"high"},{item:"Nuts & Seeds",reason:"Good fats for heart health",priority:"medium"}],exercise:[{activity:"Brisk Walking",duration:"30 mins",frequency:"daily",reason:"Improves cardiovascular health"},{activity:"Strength Training",duration:"20 mins",frequency:"3x/week",reason:"Builds muscle"}]},doctorConsultation:{specializations:["Endocrinologist","Cardiologist"],reason:"Blood sugar and cholesterol need monitoring"}},HD=[{_id:"1",name:"Dr. Sarah Johnson",specialization:"Cardiologist",experience:12,fee:800,rating:4.8,reviews:124,hospital:"City Heart Hospital",available:!0,slots:["09:00 AM","10:00 AM","11:00 AM","02:00 PM","03:00 PM"]},{_id:"2",name:"Dr. Raj Patel",specialization:"Endocrinologist",experience:15,fee:900,rating:4.9,reviews:89,hospital:"Diabetes Care Center",available:!0,slots:["10:00 AM","11:00 AM","04:00 PM","05:00 PM"]},{_id:"3",name:"Dr. Emily Chen",specialization:"General Physician",experience:8,fee:500,rating:4.7,reviews:156,hospital:"Family Health Clinic",available:!0,slots:["09:00 AM","10:00 AM","02:00 PM","03:00 PM","04:00 PM"]},{_id:"4",name:"Dr. Michael Brown",specialization:"Neurologist",experience:18,fee:1200,rating:4.9,reviews:67,hospital:"Neuro Care Institute",available:!0,slots:["11:00 AM","02:00 PM","03:00 PM"]},{_id:"5",name:"Dr. Priya Sharma",specialization:"Dermatologist",experience:10,fee:600,rating:4.6,reviews:203,hospital:"Skin & Care Clinic",available:!1,slots:[]}],P7e=[{_id:"apt1",doctor:HD[1],date:"2024-12-15",timeSlot:"10:00 AM",status:"confirmed",type:"online",meetLink:"https://meet.healthai.com/apt-xyz123",amountPaid:450}],gY={summary:"Your health has improved since your last checkup.",metricChanges:[{metric:"Health Score",previous:"72",current:"78",change:"improved"},{metric:"Blood Sugar",previous:"125 mg/dL",current:"115 mg/dL",change:"improved"}]},i1={cholesterol:"Your cholesterol level of 210 mg/dL is borderline high. Focus on reducing saturated fats and increasing fiber. Regular exercise helps too.",worried:"No immediate alarm, but attention needed. Blood sugar is pre-diabetic and cholesterol borderline. Lifestyle changes can help. Follow up with specialists.",default:"Your health score is 78/100. Key areas: managing blood sugar and cholesterol through diet and exercise. Ask me anything specific!"},vY=["All","Cardiologist","Endocrinologist","General Physician","Neurologist","Dermatologist","Orthopedic","Pediatrician"],D7e=["Blood Test","X-Ray","MRI","CT Scan","ECG","General Checkup"];function k7e(){const[e,n]=J.useState("dashboard"),[a,o]=J.useState(!1),[l,p]=J.useState([]),[m,y]=J.useState(""),[E,b]=J.useState(!1),[T,x]=J.useState(!1),[A,D]=J.useState(null),[N,L]=J.useState(0),[P,U]=J.useState({date:"",slot:"",type:"online"}),[V,F]=J.useState(HD),[H,B]=J.useState(P7e),[z,Y]=J.useState("All"),[Q,re]=J.useState(""),[de,le]=J.useState(0),[he,Re]=J.useState(null),[ve,we]=J.useState(!1),[ue,be]=J.useState({name:"",specialization:"",experience:"",fee:"",hospital:""}),[ae,ce]=J.useState(!1),[Se,je]=J.useState(r1.profile),fe=J.useRef(null);J.useEffect(()=>{var Oe;(Oe=fe.current)==null||Oe.scrollIntoView({behavior:"smooth"})},[l]);const He=Oe=>{if(Oe.preventDefault(),!m.trim())return;const rt=m.toLowerCase();p(Qt=>[...Qt,{role:"user",content:m}]),y(""),setTimeout(()=>{const Qt=Object.keys(i1).find(Ri=>rt.includes(Ri));p(Ri=>[...Ri,{role:"assistant",content:i1[Qt]||i1.default}])},800)},Ye=()=>{if(N===0)L(1);else if(N===1&&P.date&&P.slot)L(2);else if(N===2){const Oe={_id:`apt${Date.now()}`,doctor:A,date:P.date,timeSlot:P.slot,status:"confirmed",type:P.type,meetLink:`https://meet.healthai.com/apt-${Math.random().toString(36).substr(2,9)}`,amountPaid:A.fee/2};B(rt=>[Oe,...rt]),L(3)}},gt=()=>{D(null),L(0),U({date:"",slot:"",type:"online"})},Vt=()=>{de===0&&he&&(le(1),we(!0),setTimeout(()=>{we(!1),le(2)},2500))},zn=()=>{ue.name&&ue.specialization&&ue.fee&&(F(Oe=>[...Oe,{...ue,_id:`doc${Date.now()}`,rating:4.5,reviews:0,available:!0,slots:["10:00 AM","02:00 PM","04:00 PM"]}]),be({name:"",specialization:"",experience:"",fee:"",hospital:""}),ce(!1))},_r=V.filter(Oe=>(z==="All"||Oe.specialization===z)&&Oe.name.toLowerCase().includes(Q.toLowerCase())),it=({trend:Oe})=>Oe==="improved"?h.jsx(em,{className:"w-4 h-4 text-green-600"}):Oe==="declined"?h.jsx(pTe,{className:"w-4 h-4 text-red-600"}):h.jsx(AJ,{className:"w-4 h-4 text-gray-400"}),Nt=()=>h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome back, John!"}),h.jsx("p",{className:"text-gray-600",children:"Here's your health overview"})]}),h.jsxs("button",{onClick:()=>n("upload"),className:"btn-primary flex items-center gap-2",children:[h.jsx(Wo,{className:"w-4 h-4"})," Upload Report"]})]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{icon:ni,color:"primary",label:"Health Score",value:"78/100"},{icon:hi,color:"blue",label:"Total Reports",value:"6"},{icon:em,color:"green",label:"BMI",value:"23.5"},{icon:ga,color:"purple",label:"Last Checkup",value:"Dec 5"}].map((Oe,rt)=>h.jsx("div",{className:"card",children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:`w-12 h-12 bg-${Oe.color}-100 rounded-xl flex items-center justify-center`,children:h.jsx(Oe.icon,{className:`w-6 h-6 text-${Oe.color}-600`})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-gray-500",children:Oe.label}),h.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Oe.value})]})]})},rt))}),H.length>0&&h.jsxs("div",{className:"card border-2 border-green-200 bg-green-50/30",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[h.jsx(ga,{className:"w-5 h-5 text-green-600"})," Upcoming Appointments"]}),H.filter(Oe=>Oe.status==="confirmed").map(Oe=>h.jsxs("div",{className:"bg-white p-4 rounded-xl flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:Oe.doctor.name[4]}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium",children:Oe.doctor.name}),h.jsxs("p",{className:"text-sm text-gray-500",children:[Oe.doctor.specialization,"  ",Oe.date," at ",Oe.timeSlot]})]})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[Oe.type==="online"&&Oe.meetLink&&h.jsxs("a",{href:Oe.meetLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:[h.jsx(jd,{className:"w-4 h-4"})," Join Call"]}),h.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:"Confirmed"})]})]},Oe._id))]}),h.jsxs("div",{className:"card",children:[h.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Score Trend"}),h.jsx(Sw,{width:"100%",height:200,children:h.jsxs(gte,{data:I7e,children:[h.jsx(l_,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),h.jsx(Fd,{dataKey:"date"}),h.jsx(Bd,{domain:[0,100]}),h.jsx(us,{}),h.jsx(Ym,{type:"monotone",dataKey:"score",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"}})]})})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[h.jsxs("div",{className:"card",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[h.jsx(gh,{className:"w-5 h-5 text-green-600"}),h.jsx("h3",{className:"font-semibold",children:"Diet Recommendations"})]}),h.jsx("ul",{className:"space-y-2",children:ko.recommendations.diet.map((Oe,rt)=>h.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[h.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-2"}),h.jsxs("span",{children:[h.jsx("strong",{children:Oe.item})," - ",Oe.reason]})]},rt))})]}),h.jsxs("div",{className:"card",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[h.jsx(lz,{className:"w-5 h-5 text-blue-600"}),h.jsx("h3",{className:"font-semibold",children:"Exercise Plan"})]}),h.jsx("ul",{className:"space-y-2",children:ko.recommendations.exercise.map((Oe,rt)=>h.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[h.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),h.jsxs("span",{children:[h.jsx("strong",{children:Oe.activity})," - ",Oe.duration,", ",Oe.frequency]})]},rt))})]})]}),h.jsx("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx(kc,{className:"w-5 h-5 text-orange-600 mt-0.5"}),h.jsxs("div",{children:[h.jsx("h3",{className:"font-semibold",children:"Doctor Consultation Recommended"}),h.jsx("p",{className:"text-sm text-gray-600 mt-1",children:ko.doctorConsultation.reason}),h.jsxs("p",{className:"text-sm mt-2",children:[h.jsx("strong",{children:"Specialists:"})," ",ko.doctorConsultation.specializations.join(", ")]}),h.jsx("button",{onClick:()=>n("doctors"),className:"btn-primary mt-3 text-sm",children:"Find Doctors"})]})]})})]}),Ut=()=>h.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Upload Health Report"}),h.jsx("p",{className:"text-gray-600",children:"Upload your medical report for AI-powered analysis"})]}),de===0&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"card",children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Report Type"}),h.jsx("select",{className:"input",children:D7e.map(Oe=>h.jsx("option",{children:Oe},Oe))})]}),h.jsxs("div",{className:"card",children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Upload File"}),he?h.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(hi,{className:"w-10 h-10 text-primary-600"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium",children:he.name}),h.jsxs("p",{className:"text-sm text-gray-500",children:[he.size," MB"]})]})]}),h.jsx("button",{onClick:()=>Re(null),className:"p-2 text-gray-400 hover:text-red-500",children:h.jsx(zo,{className:"w-5 h-5"})})]}):h.jsxs("div",{onClick:()=>Re({name:"blood_test_report.pdf",size:2.4}),className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center cursor-pointer hover:border-primary-400 transition-colors",children:[h.jsx(Wo,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),h.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop or click to upload"}),h.jsx("p",{className:"text-sm text-gray-500",children:"PDF, PNG, JPG - max 10MB"})]})]}),h.jsxs("button",{onClick:Vt,disabled:!he,className:"btn-primary w-full flex items-center justify-center gap-2",children:[h.jsx(Wo,{className:"w-5 h-5"})," Analyze Report"]})]}),de===1&&h.jsxs("div",{className:"card text-center py-12",children:[h.jsx("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),h.jsx("h3",{className:"text-lg font-semibold",children:"Analyzing Your Report..."}),h.jsx("p",{className:"text-gray-600 mt-2",children:"Our AI is extracting insights from your report"}),h.jsx("div",{className:"mt-6 space-y-2 text-left max-w-xs mx-auto",children:["Extracting text from PDF...","Analyzing health metrics...","Generating recommendations..."].map((Oe,rt)=>h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(sh,{className:"w-4 h-4 text-green-600"}),h.jsx("span",{children:Oe})]},rt))})]}),de===2&&h.jsxs("div",{className:"space-y-6",children:[h.jsx("div",{className:"card bg-green-50 border-2 border-green-200",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(sh,{className:"w-8 h-8 text-green-600"}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Analysis Complete!"}),h.jsx("p",{className:"text-green-700",children:"Your report has been analyzed successfully"})]})]})}),h.jsx("button",{onClick:()=>n("report"),className:"btn-primary w-full",children:"View Full Analysis"})]}),h.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl text-sm text-blue-800",children:[h.jsx("strong",{children:"Note:"})," AI analysis is for informational purposes only. Always consult a healthcare provider."]})]}),Pe=()=>h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a?"Manage Doctors":"Find Doctors"}),h.jsx("p",{className:"text-gray-600",children:a?"Add and manage platform doctors":"Book consultations with specialists"})]}),a&&h.jsxs("button",{onClick:()=>ce(!0),className:"btn-primary flex items-center gap-2",children:[h.jsx(Wx,{className:"w-4 h-4"})," Add Doctor"]})]}),h.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[h.jsxs("div",{className:"relative flex-1",children:[h.jsx(sw,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),h.jsx("input",{type:"text",placeholder:"Search doctors...",value:Q,onChange:Oe=>re(Oe.target.value),className:"input pl-12"})]}),h.jsx("div",{className:"flex gap-2 flex-wrap",children:vY.slice(0,5).map(Oe=>h.jsx("button",{onClick:()=>Y(Oe),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${z===Oe?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:Oe},Oe))})]}),h.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:_r.map(Oe=>{var rt;return h.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[h.jsxs("div",{className:"flex items-start gap-4",children:[h.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-xl flex items-center justify-center text-2xl font-bold text-primary-600",children:((rt=Oe.name.split(" ")[1])==null?void 0:rt[0])||Oe.name[0]}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h3",{className:"font-semibold text-gray-900",children:Oe.name}),h.jsx("p",{className:"text-sm text-primary-600",children:Oe.specialization}),h.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[h.jsx(to,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),h.jsx("span",{className:"text-sm font-medium",children:Oe.rating}),h.jsxs("span",{className:"text-sm text-gray-500",children:["(",Oe.reviews,")"]})]})]})]}),h.jsxs("div",{className:"mt-4 space-y-2 text-sm text-gray-600",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(gs,{className:"w-4 h-4"}),h.jsxs("span",{children:[Oe.experience," years experience"]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(uP,{className:"w-4 h-4"}),h.jsx("span",{children:Oe.hospital})]})]}),h.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["",Oe.fee]}),h.jsx("span",{className:"text-sm text-gray-500",children:" / session"})]}),Oe.available?h.jsx("button",{onClick:()=>{D(Oe),L(0)},className:"btn-primary text-sm",children:"Book Now"}):h.jsx("span",{className:"px-3 py-1.5 bg-gray-100 text-gray-500 rounded-xl text-sm",children:"Unavailable"})]})]},Oe._id)})}),ae&&h.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:h.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("h2",{className:"text-xl font-bold",children:"Add New Doctor"}),h.jsx("button",{onClick:()=>ce(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:h.jsx(zo,{className:"w-5 h-5"})})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Doctor Name"}),h.jsx("input",{type:"text",value:ue.name,onChange:Oe=>be({...ue,name:Oe.target.value}),className:"input",placeholder:"Dr. John Smith"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specialization"}),h.jsxs("select",{value:ue.specialization,onChange:Oe=>be({...ue,specialization:Oe.target.value}),className:"input",children:[h.jsx("option",{value:"",children:"Select"}),vY.slice(1).map(Oe=>h.jsx("option",{children:Oe},Oe))]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Experience (yrs)"}),h.jsx("input",{type:"number",value:ue.experience,onChange:Oe=>be({...ue,experience:Oe.target.value}),className:"input"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fee ()"}),h.jsx("input",{type:"number",value:ue.fee,onChange:Oe=>be({...ue,fee:Oe.target.value}),className:"input"})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hospital/Clinic"}),h.jsx("input",{type:"text",value:ue.hospital,onChange:Oe=>be({...ue,hospital:Oe.target.value}),className:"input"})]}),h.jsx("button",{onClick:zn,className:"btn-primary w-full",children:"Add Doctor"})]})]})})]}),St=()=>{var Oe;return A&&h.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:h.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[N<3&&h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("h2",{className:"text-xl font-bold",children:N===0?"Book Appointment":N===1?"Select Slot":"Payment"}),h.jsx("button",{onClick:gt,className:"p-2 hover:bg-gray-100 rounded-lg",children:h.jsx(zo,{className:"w-5 h-5"})})]}),N===0&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[h.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-full flex items-center justify-center text-xl font-bold text-primary-600",children:(Oe=A.name.split(" ")[1])==null?void 0:Oe[0]}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold",children:A.name}),h.jsx("p",{className:"text-sm text-primary-600",children:A.specialization}),h.jsx("p",{className:"text-sm text-gray-500",children:A.hospital})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consultation Type"}),h.jsx("div",{className:"flex gap-4",children:["online","in-person"].map(rt=>h.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[h.jsx("input",{type:"radio",name:"type",checked:P.type===rt,onChange:()=>U({...P,type:rt}),className:"text-primary-600"}),rt==="online"?h.jsxs(h.Fragment,{children:[h.jsx(jd,{className:"w-4 h-4"})," Online"]}):h.jsxs(h.Fragment,{children:[h.jsx(uP,{className:"w-4 h-4"})," In-Person"]})]},rt))})]}),h.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl",children:[h.jsxs("p",{className:"text-sm text-blue-800",children:[h.jsx("strong",{children:"Consultation Fee:"})," ",A.fee]}),h.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Pay ",A.fee/2," now to confirm (50% advance)"]})]}),h.jsx("button",{onClick:Ye,className:"btn-primary w-full",children:"Select Date & Time"})]}),N===1&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date"}),h.jsx("input",{type:"date",value:P.date,onChange:rt=>U({...P,date:rt.target.value}),min:new Date().toISOString().split("T")[0],className:"input"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Slots"}),h.jsx("div",{className:"grid grid-cols-3 gap-2",children:A.slots.map(rt=>h.jsx("button",{onClick:()=>U({...P,slot:rt}),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${P.slot===rt?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:rt},rt))})]}),h.jsxs("div",{className:"flex gap-3",children:[h.jsx("button",{onClick:()=>L(0),className:"flex-1 py-2.5 border border-gray-300 rounded-xl font-medium",children:"Back"}),h.jsx("button",{onClick:Ye,disabled:!P.date||!P.slot,className:"flex-1 btn-primary",children:"Continue to Payment"})]})]}),N===2&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl space-y-2",children:[h.jsxs("div",{className:"flex justify-between",children:[h.jsx("span",{className:"text-gray-600",children:"Doctor"}),h.jsx("span",{className:"font-medium",children:A.name})]}),h.jsxs("div",{className:"flex justify-between",children:[h.jsx("span",{className:"text-gray-600",children:"Date"}),h.jsx("span",{className:"font-medium",children:P.date})]}),h.jsxs("div",{className:"flex justify-between",children:[h.jsx("span",{className:"text-gray-600",children:"Time"}),h.jsx("span",{className:"font-medium",children:P.slot})]}),h.jsxs("div",{className:"flex justify-between",children:[h.jsx("span",{className:"text-gray-600",children:"Type"}),h.jsx("span",{className:"font-medium capitalize",children:P.type})]}),h.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between",children:[h.jsx("span",{className:"font-semibold",children:"Amount to Pay"}),h.jsxs("span",{className:"font-bold text-primary-600",children:["",A.fee/2]})]})]}),h.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[h.jsx(bJ,{className:"w-5 h-5 text-gray-600"}),h.jsx("span",{className:"font-medium",children:"Payment Method"})]}),h.jsx("div",{className:"space-y-2",children:["UPI","Credit/Debit Card","Net Banking"].map(rt=>h.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[h.jsx("input",{type:"radio",name:"payment",defaultChecked:rt==="UPI"}),h.jsx("span",{children:rt})]},rt))})]}),h.jsxs("button",{onClick:Ye,className:"btn-primary w-full flex items-center justify-center gap-2",children:[h.jsx(Ny,{className:"w-4 h-4"})," Pay ",A.fee/2," Securely"]})]}),N===3&&h.jsxs("div",{className:"text-center py-6",children:[h.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:h.jsx(sh,{className:"w-8 h-8 text-green-600"})}),h.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),h.jsx("p",{className:"text-gray-600 mb-4",children:"Your appointment has been scheduled"}),h.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-left space-y-2 mb-4",children:[h.jsxs("p",{children:[h.jsx("strong",{children:"Doctor:"})," ",A.name]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Date:"})," ",P.date," at ",P.slot]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Type:"})," ",P.type==="online"?"Video Consultation":"In-Person"]}),P.type==="online"&&h.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[h.jsxs("p",{className:"text-sm text-blue-800 font-medium flex items-center gap-2",children:[h.jsx(jd,{className:"w-4 h-4"})," Video Call Link"]}),h.jsxs("p",{className:"text-sm text-blue-600 mt-1 break-all",children:["https://meet.healthai.com/apt-",Math.random().toString(36).substr(2,6)]}),h.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Link will be available in your dashboard"})]})]}),h.jsx("button",{onClick:()=>{gt(),n("dashboard")},className:"btn-primary w-full",children:"Go to Dashboard"})]})]})})},Ot=()=>{var Oe,rt;return h.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),h.jsx("p",{className:"text-gray-600",children:"Manage your personal and health information"})]}),h.jsx("div",{className:"card gradient-bg text-white",children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center",children:h.jsx(ni,{className:"w-8 h-8"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-lg font-semibold",children:"Health Score"}),h.jsx("p",{className:"text-3xl font-bold",children:"78/100"})]}),h.jsxs("div",{className:"ml-auto text-right",children:[h.jsx("p",{className:"text-sm opacity-80",children:"BMI"}),h.jsx("p",{className:"text-2xl font-bold",children:"23.5"})]})]})}),h.jsxs("div",{className:"card",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[h.jsx(Sl,{className:"w-5 h-5 text-primary-600"})," Basic Information"]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),h.jsx("input",{type:"text",value:r1.name,className:"input",readOnly:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),h.jsx("input",{type:"email",value:r1.email,className:"input bg-gray-50",disabled:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Age"}),h.jsx("input",{type:"number",value:Se.age,onChange:Qt=>je({...Se,age:Qt.target.value}),className:"input"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender"}),h.jsxs("select",{value:Se.gender,onChange:Qt=>je({...Se,gender:Qt.target.value}),className:"input",children:[h.jsx("option",{value:"male",children:"Male"}),h.jsx("option",{value:"female",children:"Female"}),h.jsx("option",{value:"other",children:"Other"})]})]})]})]}),h.jsxs("div",{className:"card",children:[h.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Information"}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Height (cm)"}),h.jsx("input",{type:"number",value:Se.height,onChange:Qt=>je({...Se,height:Qt.target.value}),className:"input"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight (kg)"}),h.jsx("input",{type:"number",value:Se.weight,onChange:Qt=>je({...Se,weight:Qt.target.value}),className:"input"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blood Group"}),h.jsx("select",{value:Se.bloodGroup,onChange:Qt=>je({...Se,bloodGroup:Qt.target.value}),className:"input",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(Qt=>h.jsx("option",{children:Qt},Qt))})]})]})]}),h.jsxs("div",{className:"card",children:[h.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Medical History"}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allergies"}),h.jsx("input",{type:"text",value:(Oe=Se.allergies)==null?void 0:Oe.join(", "),className:"input",placeholder:"e.g., Penicillin, Peanuts"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chronic Conditions"}),h.jsx("input",{type:"text",value:(rt=Se.chronicConditions)==null?void 0:rt.join(", "),className:"input",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),h.jsxs("button",{className:"btn-primary w-full flex items-center justify-center gap-2",onClick:()=>alert("Profile saved!"),children:[h.jsx(sh,{className:"w-5 h-5"})," Save Changes"]})]})},Pn=()=>h.jsxs("div",{className:"space-y-6",children:[h.jsxs("button",{onClick:()=>n("dashboard"),className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[h.jsx(bl,{className:"w-4 h-4"})," Back to Dashboard"]}),h.jsxs("div",{className:"card",children:[h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-xl flex items-center justify-center",children:h.jsx(hi,{className:"w-7 h-7 text-primary-600"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Blood Test Report"}),h.jsx("p",{className:"text-gray-500",children:"Analyzed on Dec 5, 2024"})]})]}),h.jsxs("div",{className:"text-right",children:[h.jsx("div",{className:"text-3xl font-bold text-primary-600",children:"78"}),h.jsx("div",{className:"text-sm text-gray-500",children:"Health Score"})]})]}),h.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-100",children:[h.jsxs("button",{onClick:()=>b(!E),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-xl hover:bg-blue-100",children:[h.jsx(aw,{className:"w-4 h-4"}),E?"Hide":"Compare"]}),h.jsxs("button",{onClick:()=>x(!T),className:"flex items-center gap-2 px-4 py-2 bg-purple-50 text-purple-700 rounded-xl hover:bg-purple-100",children:[h.jsx(hP,{className:"w-4 h-4"}),"Ask AI"]})]})]}),E&&h.jsxs("div",{className:"card border-2 border-blue-200 bg-blue-50/50",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[h.jsx(aw,{className:"w-5 h-5 text-blue-600"})," Health Comparison"]}),h.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-700",children:" Improved"})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[h.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[h.jsx("p",{className:"text-sm text-gray-500",children:"Previous (Oct)"}),h.jsx("p",{className:"text-2xl font-bold text-gray-400",children:"72/100"})]}),h.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[h.jsx("p",{className:"text-sm text-gray-500",children:"Current (Dec)"}),h.jsx("p",{className:"text-2xl font-bold text-primary-600",children:"78/100"})]})]}),h.jsx("p",{className:"text-gray-700 mb-4",children:gY.summary}),h.jsx("div",{className:"space-y-2 mb-4",children:gY.metricChanges.map((Oe,rt)=>h.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(it,{trend:Oe.change}),h.jsx("span",{className:"font-medium",children:Oe.metric})]}),h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"text-gray-500",children:Oe.previous}),"  ",h.jsx("span",{className:"font-medium",children:Oe.current})]})]},rt))})]}),T&&h.jsxs("div",{className:"card border-2 border-purple-200",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[h.jsx(hP,{className:"w-5 h-5 text-purple-600"})," Ask About Your Report"]}),h.jsxs("div",{className:"h-48 overflow-y-auto mb-4 space-y-3 p-3 bg-gray-50 rounded-xl",children:[l.length===0&&h.jsx("p",{className:"text-gray-500 text-center py-6",children:'Try: "What does my cholesterol mean?" or "Should I be worried?"'}),l.map((Oe,rt)=>h.jsx("div",{className:`flex ${Oe.role==="user"?"justify-end":"justify-start"}`,children:h.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${Oe.role==="user"?"bg-purple-600 text-white":"bg-white border"}`,children:Oe.content})},rt)),h.jsx("div",{ref:fe})]}),h.jsxs("form",{onSubmit:He,className:"flex gap-2",children:[h.jsx("input",{type:"text",value:m,onChange:Oe=>y(Oe.target.value),placeholder:"Ask a question...",className:"input flex-1"}),h.jsx("button",{type:"submit",className:"btn-primary px-4",children:h.jsx(Dm,{className:"w-5 h-5"})})]})]}),h.jsxs("div",{className:"card",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[h.jsx(ni,{className:"w-5 h-5 text-primary-600"})," Summary"]}),h.jsx("p",{className:"text-gray-700",children:ko.summary})]}),h.jsxs("div",{className:"card",children:[h.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Metrics"}),h.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(ko.metrics).map(([Oe,rt])=>h.jsxs("div",{className:`p-4 rounded-xl ${rt.status==="normal"?"bg-green-50":"bg-yellow-50"}`,children:[h.jsx("p",{className:"text-sm text-gray-600 capitalize",children:Oe.replace(/([A-Z])/g," $1")}),h.jsxs("p",{className:"text-xl font-bold",children:[rt.value," ",rt.unit]}),h.jsxs("p",{className:"text-xs text-gray-500",children:["Normal: ",rt.normalRange]}),h.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${rt.status==="normal"?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,children:rt.status})]},Oe))})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[h.jsxs("div",{className:"card",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[h.jsx(Yo,{className:"w-5 h-5 text-blue-600"})," Key Findings"]}),h.jsx("ul",{className:"space-y-2",children:ko.keyFindings.map((Oe,rt)=>h.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[h.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),Oe]},rt))})]}),h.jsxs("div",{className:"card border-l-4 border-orange-400",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[h.jsx(Mx,{className:"w-5 h-5 text-orange-600"})," Risk Factors"]}),h.jsx("ul",{className:"space-y-2",children:ko.riskFactors.map((Oe,rt)=>h.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[h.jsx("span",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full mt-2"}),Oe]},rt))})]})]}),h.jsxs("div",{className:"card",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[h.jsx(gh,{className:"w-5 h-5 text-green-600"})," Diet"]}),h.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:ko.recommendations.diet.map((Oe,rt)=>h.jsxs("div",{className:"p-4 bg-green-50 rounded-xl",children:[h.jsxs("div",{className:"flex justify-between mb-2",children:[h.jsx("span",{className:"font-medium text-green-800",children:Oe.item}),h.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${Oe.priority==="high"?"bg-green-200 text-green-800":"bg-gray-200"}`,children:Oe.priority})]}),h.jsx("p",{className:"text-sm text-green-700",children:Oe.reason})]},rt))})]}),h.jsxs("div",{className:"card",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[h.jsx(lz,{className:"w-5 h-5 text-blue-600"})," Exercise"]}),ko.recommendations.exercise.map((Oe,rt)=>h.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl mb-3",children:[h.jsxs("div",{className:"flex justify-between mb-2",children:[h.jsx("span",{className:"font-medium text-blue-800",children:Oe.activity}),h.jsxs("span",{className:"text-sm text-blue-600",children:[Oe.duration,"  ",Oe.frequency]})]}),h.jsx("p",{className:"text-sm text-blue-700",children:Oe.reason})]},rt))]}),h.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[h.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[h.jsx(Ch,{className:"w-5 h-5 text-primary-600"})," Recommended Doctors"]}),h.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:HD.filter(Oe=>ko.doctorConsultation.specializations.includes(Oe.specialization)).map(Oe=>h.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[h.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:Oe.name.split(" ")[1][0]}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium",children:Oe.name}),h.jsx("p",{className:"text-sm text-primary-600",children:Oe.specialization})]})]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[h.jsx(to,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),Oe.rating,"  ",h.jsx(gs,{className:"w-4 h-4"}),Oe.experience," yrs"]}),h.jsxs("div",{className:"flex justify-between mt-3 pt-3 border-t",children:[h.jsxs("span",{className:"font-semibold",children:["",Oe.fee]}),h.jsx("button",{onClick:()=>{D(Oe),n("doctors")},className:"text-sm bg-primary-600 text-white px-3 py-1.5 rounded-lg hover:bg-primary-700",children:"Book Now"})]})]},Oe._id))})]})]}),wn=()=>h.jsxs("aside",{className:"w-64 bg-white border-r border-gray-200 fixed h-full flex flex-col",children:[h.jsxs("div",{className:"p-6",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-10 h-10 gradient-bg rounded-xl flex items-center justify-center",children:h.jsx(ni,{className:"w-6 h-6 text-white"})}),h.jsx("span",{className:"text-xl font-bold text-gray-900",children:"HealthAI"})]}),h.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Demo Mode"})]}),h.jsx("nav",{className:"px-4 space-y-1 flex-1",children:[{id:"dashboard",icon:rTe,label:"Dashboard"},{id:"upload",icon:Wo,label:"Upload Report"},{id:"report",icon:hi,label:"Report & Chat"},{id:"doctors",icon:Ch,label:"Doctors"},{id:"profile",icon:Sl,label:"Profile"}].map(Oe=>h.jsxs("button",{onClick:()=>n(Oe.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${e===Oe.id?"bg-primary-50 text-primary-600":"text-gray-600 hover:bg-gray-50"}`,children:[h.jsx(Oe.icon,{className:"w-5 h-5"}),h.jsx("span",{className:"font-medium",children:Oe.label})]},Oe.id))}),h.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:h.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[h.jsx("input",{type:"checkbox",checked:a,onChange:Oe=>o(Oe.target.checked),className:"w-4 h-4 text-primary-600 rounded"}),h.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Admin Mode"}),h.jsx(x_,{className:"w-4 h-4 text-gray-400"})]})}),h.jsx("div",{className:"p-4 border-t border-gray-100",children:h.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[h.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:h.jsx("span",{className:"text-primary-600 font-semibold",children:"J"})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a?"Admin User":"John Doe"}),h.jsx("p",{className:"text-xs text-gray-500 truncate",children:a?"admin@healthai.com":"john@example.com"})]}),h.jsx(xJ,{className:"w-5 h-5 text-gray-400"})]})})]});return h.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[h.jsx(wn,{}),h.jsxs("main",{className:"flex-1 ml-64 p-8",children:[e==="dashboard"&&h.jsx(Nt,{}),e==="upload"&&h.jsx(Ut,{}),e==="report"&&h.jsx(Pn,{}),e==="doctors"&&h.jsx(Pe,{}),e==="profile"&&h.jsx(Ot,{})]}),h.jsx(St,{})]})}function L7e(){const[e,n]=J.useState(null),[a,o]=J.useState(!0),[l,p]=J.useState("overview");J.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:E}=await OS.getStats();n(E)}catch{bt.error("Failed to load stats")}finally{o(!1)}};if(a)return h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"})});const y=[{id:"overview",label:"Overview",icon:ni},{id:"doctors",label:"Doctors",icon:kJ}];return h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Admin Dashboard"}),h.jsx("p",{className:"text-slate-500 mt-1",children:"Manage platform settings and monitor activity"})]}),h.jsx("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:y.map(({id:E,label:b,icon:T})=>h.jsxs("button",{onClick:()=>p(E),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${l===E?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[h.jsx(T,{className:"w-4 h-4"}),h.jsx("span",{children:b})]},E))}),l==="overview"&&h.jsx(j7e,{stats:e}),l==="doctors"&&h.jsx(M7e,{})]})}function j7e({stats:e}){var n,a,o,l;return e?h.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:h.jsx(Ch,{className:"w-5 h-5 text-blue-600"})}),h.jsx("p",{className:"text-sm text-slate-500",children:"Total Patients"}),h.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((n=e.stats)==null?void 0:n.totalUsers)||0})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:h.jsx(va,{className:"w-5 h-5 text-green-600"})}),h.jsx("p",{className:"text-sm text-slate-500",children:"Active Users"}),h.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((a=e.stats)==null?void 0:a.activeUsers)||0})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:h.jsx(hi,{className:"w-5 h-5 text-purple-600"})}),h.jsx("p",{className:"text-sm text-slate-500",children:"Total Reports"}),h.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((o=e.stats)==null?void 0:o.totalReports)||0})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:h.jsx(kc,{className:"w-5 h-5 text-amber-600"})}),h.jsx("p",{className:"text-sm text-slate-500",children:"Pending Doctors"}),h.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((l=e.stats)==null?void 0:l.pendingDoctors)||0})]})]}):null}function M7e(){const[e,n]=J.useState([]),[a,o]=J.useState(!0),[l,p]=J.useState("all");J.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:x}=await OS.getDoctors();n(x.doctors||[])}catch{bt.error("Failed to load doctors")}finally{o(!1)}},y=async x=>{try{await OS.approveDoctor(x),n(e.map(A=>A._id===x?{...A,approvalStatus:"approved",isListed:!0}:A)),bt.success("Doctor approved!")}catch{bt.error("Failed to approve")}},E=async x=>{try{await OS.rejectDoctor(x),n(e.map(A=>A._id===x?{...A,approvalStatus:"rejected",isListed:!1}:A)),bt.success("Doctor rejected")}catch{bt.error("Failed to reject")}},b=e.filter(x=>l==="all"?!0:x.approvalStatus===l),T=e.filter(x=>x.approvalStatus==="pending").length;return a?h.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 animate-pulse h-64"}):h.jsxs("div",{className:"space-y-4",children:[T>0&&h.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-center gap-4",children:[h.jsx(kc,{className:"w-6 h-6 text-amber-500"}),h.jsx("div",{className:"flex-1",children:h.jsxs("p",{className:"font-medium text-amber-800",children:[T," Doctor(s) Pending Approval"]})}),h.jsx("button",{onClick:()=>p("pending"),className:"px-4 py-2 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600",children:"Review"})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex items-center justify-between mb-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Doctor Management"}),h.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(x=>h.jsx("button",{onClick:()=>p(x),className:`px-3 py-1.5 rounded-lg text-sm font-medium capitalize ${l===x?"bg-cyan-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:x},x))})]}),h.jsxs("div",{className:"space-y-3",children:[b.map(x=>{var A,D;return h.jsx("div",{className:`p-4 rounded-xl border ${x.approvalStatus==="pending"?"bg-amber-50 border-amber-200":x.approvalStatus==="rejected"?"bg-red-50 border-red-200":"bg-slate-50 border-slate-200"}`,children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(D=(A=x.name)==null?void 0:A[0])==null?void 0:D.toUpperCase()}),h.jsxs("div",{children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",x.name]}),h.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${x.approvalStatus==="approved"?"bg-green-100 text-green-700":x.approvalStatus==="rejected"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:x.approvalStatus})]}),h.jsx("p",{className:"text-sm text-cyan-600",children:x.specialization}),h.jsxs("p",{className:"text-xs text-slate-500",children:[x.experience," yrs  ",x.consultationFee||0]})]})]}),h.jsx("div",{className:"flex items-center gap-2",children:x.approvalStatus==="pending"&&h.jsxs(h.Fragment,{children:[h.jsxs("button",{onClick:()=>y(x._id),className:"px-3 py-1.5 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 flex items-center gap-1",children:[h.jsx(va,{className:"w-4 h-4"})," Approve"]}),h.jsxs("button",{onClick:()=>E(x._id),className:"px-3 py-1.5 bg-slate-200 text-red-600 text-sm font-medium rounded-lg hover:bg-slate-300 flex items-center gap-1",children:[h.jsx(LJ,{className:"w-4 h-4"})," Reject"]})]})})]})},x._id)}),b.length===0&&h.jsxs("div",{className:"text-center py-8 text-slate-500",children:[h.jsx(kJ,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),h.jsx("p",{children:"No doctors found"})]})]})]})]})}const U7e=[{id:"free",name:"Free",price:0,period:"forever",features:["1 Report analysis per month","Basic AI insights","View doctor listings","Email support"],color:"slate",icon:to},{id:"basic",name:"Basic",price:0,period:"month",features:["5 Report analyses per month","Full AI analysis with deficiencies","Personalized diet plans","Supplement recommendations","Health trend tracking","Priority support"],color:"cyan",icon:e2,popular:!0},{id:"premium",name:"Premium",price:0,period:"month",features:["Unlimited report analyses","Advanced AI insights","Personalized diet & exercise plans","Supplement recommendations","Health trend analytics","Chat with AI about reports","Doctor recommendations","24/7 Priority support"],color:"violet",icon:lP}];function V7e(){var b;const{user:e}=Ha(),[n,a]=J.useState(null),[o,l]=J.useState(!0),[p,m]=J.useState("monthly");J.useEffect(()=>{y()},[]);const y=async()=>{try{const{data:T}=await Gxe.getSubscription();a(T)}catch{console.error("Failed to fetch subscription")}finally{l(!1)}},E=(n==null?void 0:n.plan)||((b=e==null?void 0:e.subscription)==null?void 0:b.plan)||"free";return o?h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"})}):h.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-fade-in",children:[h.jsxs("div",{className:"text-center",children:[h.jsxs("div",{className:"inline-flex items-center gap-2 bg-violet-500/20 text-violet-400 px-4 py-2 rounded-full text-sm font-semibold mb-4",children:[h.jsx(lP,{className:"w-4 h-4"}),"Subscription Plans"]}),h.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Choose Your Plan"}),h.jsx("p",{className:"text-slate-400 max-w-lg mx-auto",children:"Unlock the full potential of AI-powered health insights with our premium plans"})]}),h.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[h.jsx("div",{className:"absolute inset-0 opacity-10",children:h.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),h.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:h.jsx(lP,{className:"w-7 h-7"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-white/70 text-sm",children:"Current Plan"}),h.jsx("h2",{className:"text-2xl font-bold capitalize",children:E})]})]}),h.jsxs("div",{className:"flex items-center gap-6",children:[(n==null?void 0:n.endDate)&&h.jsxs("div",{className:"text-right",children:[h.jsx("p",{className:"text-white/70 text-sm",children:"Renewal Date"}),h.jsx("p",{className:"font-semibold",children:new Date(n.endDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),h.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl",children:[h.jsx(ga,{className:"w-4 h-4"}),h.jsx("span",{className:"font-medium capitalize",children:(n==null?void 0:n.status)||"Active"})]})]})]})]}),h.jsx("div",{className:"flex justify-center",children:h.jsxs("div",{className:"flex items-center gap-3 p-1 bg-slate-800 rounded-xl",children:[h.jsx("button",{onClick:()=>m("monthly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all ${p==="monthly"?"bg-slate-700 text-white":"text-slate-400"}`,children:"Monthly"}),h.jsxs("button",{onClick:()=>m("yearly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2 ${p==="yearly"?"bg-slate-700 text-white":"text-slate-400"}`,children:["Yearly",h.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded-full",children:"Save 20%"})]})]})}),h.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:U7e.map(T=>{const x=T.icon,A=E===T.id,D=p==="yearly"?Math.round(T.price*12*.8):T.price;return h.jsxs("div",{className:`bg-[#111827] rounded-2xl border p-6 relative ${T.popular?"border-cyan-500":"border-slate-700"} ${A?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-[#0a0f1a]":""}`,children:[T.popular&&h.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:h.jsx("span",{className:"bg-cyan-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg",children:"Most Popular"})}),h.jsxs("div",{className:"text-center mb-6 pt-2",children:[h.jsx("div",{className:`w-14 h-14 rounded-2xl mx-auto mb-4 flex items-center justify-center bg-${T.color}-500/20`,children:h.jsx(x,{className:`w-7 h-7 text-${T.color}-400`})}),h.jsx("h3",{className:"text-xl font-bold text-white",children:T.name}),h.jsxs("div",{className:"mt-4",children:[h.jsxs("span",{className:"text-4xl font-bold text-white",children:["",D]}),h.jsxs("span",{className:"text-slate-400",children:["/",p==="yearly"?"year":T.period]})]})]}),h.jsx("ul",{className:"space-y-3 mb-8",children:T.features.map((N,L)=>h.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[h.jsx("div",{className:`w-5 h-5 rounded-full bg-${T.color}-500/20 flex items-center justify-center flex-shrink-0 mt-0.5`,children:h.jsx(sh,{className:`w-3 h-3 text-${T.color}-400`})}),h.jsx("span",{className:"text-slate-400",children:N})]},L))}),h.jsx("button",{className:`w-full py-3 rounded-xl font-semibold transition-all ${A?"bg-slate-800 text-slate-500 cursor-default":T.popular?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:opacity-90":"border-2 border-slate-700 text-slate-300 hover:border-cyan-500 hover:text-cyan-400"}`,disabled:A,children:A?"Current Plan":T.price===0?"Downgrade":"Upgrade Now"})]},T.id)})}),h.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:h.jsxs("div",{className:"flex items-start gap-4",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:h.jsx(bJ,{className:"w-6 h-6 text-blue-400"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"font-bold text-white mb-2",children:"Secure Payment"}),h.jsx("p",{className:"text-slate-400 text-sm",children:"All payments are processed securely. You can upgrade, downgrade, or cancel your subscription at any time. Changes take effect immediately and unused time is prorated."})]})]})})]})}const Gv=[{id:"apple_watch",name:"Apple Watch",icon:Rc,description:"Sync health data from your Apple Watch and iPhone",tags:["Heart Rate","Activity","Sleep"],color:"bg-slate-800",textColor:"text-slate-800"},{id:"google_fit",name:"Google Fit",icon:ni,description:"Aggregates data from Android devices and apps",tags:["Activity","Nutrition","Weight"],color:"bg-blue-500",textColor:"text-blue-600"},{id:"fitbit",name:"Fitbit",icon:e2,description:"Track steps, heart rate, and sleep patterns",tags:["Steps","Heart","Sleep"],color:"bg-cyan-500",textColor:"text-cyan-600"},{id:"garmin",name:"Garmin Connect",icon:em,description:"High-fidelity GPS and heart rate data",tags:["Cardio","GPS","Training"],color:"bg-indigo-600",textColor:"text-indigo-600"},{id:"samsung",name:"Samsung Health",icon:IJ,description:"Galaxy Watch and phone health data",tags:["Activity","Sleep","Stress"],color:"bg-purple-600",textColor:"text-purple-600"},{id:"oura",name:"Oura Ring",icon:Fx,description:"Advanced sleep and recovery tracking",tags:["Sleep","Recovery","HRV"],color:"bg-slate-700",textColor:"text-slate-700"}];function F7e(){const[e,n]=J.useState([]),[a,o]=J.useState(!0),[l,p]=J.useState(!1),[m,y]=J.useState(!1),[E,b]=J.useState(null);J.useEffect(()=>{T()},[]);const T=async()=>{try{const{data:P}=await _d.getDashboard();P.devices&&n(P.devices)}catch(P){console.error("Failed to fetch devices:",P)}finally{o(!1)}},x=async()=>{p(!0);try{e.length>0?(await _d.generateDemoData(e[0].type),await T(),bt.success("All devices synced successfully!")):bt.error("No devices connected")}catch(P){console.error("Sync failed:",P),bt.error("Failed to sync devices")}finally{p(!1)}},A=async P=>{try{const U=Gv.find(V=>V.id===P);await _d.connectDevice(P,U==null?void 0:U.name),await _d.generateDemoData(P),await T(),y(!1),bt.success(`${U==null?void 0:U.name} connected successfully!`)}catch(U){console.error("Failed to connect:",U),bt.error("Failed to connect device")}},D=async P=>{try{await _d.disconnectDevice(P),await T(),bt.success("Device disconnected")}catch(U){console.error("Failed to disconnect:",U),bt.error("Failed to disconnect device")}},N=P=>{const U=Gv.find(V=>V.id===P);return(U==null?void 0:U.icon)||Rc},L=P=>{const U=Gv.find(V=>V.id===P);return(U==null?void 0:U.color)||"bg-slate-600"};return a?h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),h.jsx("p",{className:"text-slate-500",children:"Loading devices..."})]})}):h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[h.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Connected Devices"}),h.jsxs("p",{className:"text-slate-500 mt-1 flex items-center gap-2",children:[h.jsx(gs,{className:"w-4 h-4"}),"Last synced: ",new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]}),h.jsxs("div",{className:"flex gap-3",children:[h.jsxs("button",{onClick:x,disabled:l||e.length===0,className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl hover:bg-slate-50 transition-all disabled:opacity-50",children:[h.jsx(NJ,{className:`w-4 h-4 ${l?"animate-spin":""}`}),"Sync All"]}),h.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl hover:shadow-lg transition-all",children:[h.jsx(Wx,{className:"w-4 h-4"}),"Add Device"]})]})]}),e.length===0&&h.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 flex items-start gap-3",children:[h.jsx("div",{className:"w-6 h-6 rounded-full bg-cyan-100 flex items-center justify-center shrink-0 mt-0.5",children:h.jsx(kc,{className:"w-4 h-4 text-cyan-600"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-cyan-900 font-medium",children:"No devices connected yet"}),h.jsx("p",{className:"text-cyan-700 text-sm mt-1",children:"Connect your wearable devices to automatically track your health metrics and get personalized insights."})]})]}),e.length>0&&h.jsxs("div",{children:[h.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[h.jsx(sTe,{className:"w-5 h-5 text-slate-600"}),h.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Your Devices"}),h.jsxs("span",{className:"px-2 py-0.5 bg-cyan-100 text-cyan-700 rounded-full text-xs font-medium",children:[e.length," connected"]})]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map((P,U)=>{const V=N(P.type),F=L(P.type),H=Math.floor(Math.random()*50)+50;return h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[h.jsxs("div",{className:"flex items-start justify-between mb-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:`w-12 h-12 rounded-xl ${F} flex items-center justify-center`,children:h.jsx(V,{className:"w-6 h-6 text-white"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-slate-800 font-semibold",children:P.name}),h.jsx("p",{className:"text-slate-500 text-sm",children:P.type})]})]}),h.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:[h.jsx(va,{className:"w-3 h-3"}),"Active"]})]}),h.jsx("div",{className:"flex gap-1 mb-4 h-16 bg-slate-50 rounded-lg p-2",children:[...Array(7)].map((B,z)=>{const Y=30+Math.random()*70;return h.jsx("div",{className:"flex-1 bg-gradient-to-t from-cyan-500 to-blue-500 rounded-sm",style:{height:`${Y}%`,marginTop:"auto"}},z)})}),h.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-200",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[h.jsx(Yo,{className:"w-4 h-4"}),h.jsx("span",{className:"text-xs",children:"Heart"})]}),h.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[h.jsx(wJ,{className:"w-4 h-4"}),h.jsx("span",{className:"text-xs",children:"Steps"})]}),h.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[h.jsx(Fx,{className:"w-4 h-4"}),h.jsx("span",{className:"text-xs",children:"Sleep"})]})]}),h.jsxs("div",{className:"flex items-center gap-1 text-slate-500 text-xs",children:[h.jsx(yJ,{className:"w-4 h-4"}),H,"%"]})]}),h.jsxs("div",{className:"mt-4 flex gap-2",children:[h.jsx("button",{onClick:()=>x(),className:"flex-1 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm font-medium",children:"Sync Now"}),h.jsx("button",{onClick:()=>D(P.type),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm",children:"Disconnect"})]})]},U)})})]}),h.jsxs("div",{children:[h.jsx("div",{className:"flex items-center justify-between mb-4",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Rc,{className:"w-5 h-5 text-slate-600"}),h.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Available Integrations"})]})}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Gv.map(P=>{const U=P.icon,V=e.some(F=>F.type===P.id);return h.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[h.jsx("div",{className:`w-12 h-12 rounded-xl ${P.color} flex items-center justify-center shrink-0`,children:h.jsx(U,{className:"w-6 h-6 text-white"})}),h.jsxs("div",{className:"flex-1",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[h.jsx("p",{className:"text-slate-800 font-semibold",children:P.name}),V&&h.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:"Connected"})]}),h.jsx("p",{className:"text-slate-500 text-sm mb-3",children:P.description}),h.jsx("div",{className:"flex flex-wrap gap-2",children:P.tags.map(F=>h.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded-lg text-slate-600 text-xs",children:F},F))})]})]}),h.jsx("button",{onClick:()=>V?D(P.id):A(P.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${V?"bg-slate-100 text-slate-700 hover:bg-slate-200":"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:shadow-lg"}`,children:V?"Disconnect":"Connect"})]})},P.id)})})]}),m&&h.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-fade-in",children:h.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Connect a Device"}),h.jsx("button",{onClick:()=>y(!1),className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-slate-200 transition-colors",children:h.jsx(zo,{className:"w-5 h-5"})})]}),h.jsx("p",{className:"text-slate-500 mb-6",children:"Select a device or service to connect"}),h.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:Gv.map(P=>{const U=P.icon,V=e.some(F=>F.type===P.id);return h.jsxs("button",{onClick:()=>!V&&A(P.id),disabled:V,className:`w-full p-4 border rounded-xl transition-all flex items-center gap-4 text-left ${V?"bg-slate-50 border-slate-200 opacity-60 cursor-not-allowed":"bg-white border-slate-200 hover:border-cyan-500 hover:shadow-sm"}`,children:[h.jsx("div",{className:`w-10 h-10 rounded-xl ${P.color} flex items-center justify-center shrink-0`,children:h.jsx(U,{className:"w-5 h-5 text-white"})}),h.jsxs("div",{className:"flex-1",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("p",{className:"text-slate-800 font-medium",children:P.name}),V&&h.jsx(va,{className:"w-4 h-4 text-emerald-500"})]}),h.jsx("p",{className:"text-slate-500 text-sm",children:P.description})]})]},P.id)})})]})})]})}function B7e(){var L,P,U,V,F,H,B,z,Y,Q,re,de,le,he,Re,ve,we,ue,be;const{patientId:e}=Nx(),[n]=TSe(),a=n.get("appointmentId"),[o,l]=J.useState(null),[p,m]=J.useState(!0),[y,E]=J.useState("overview");if(J.useEffect(()=>{(async()=>{try{const{data:ce}=await Ua.getPatientProfile(e,a);l(ce)}catch(ce){console.error("Failed to fetch patient profile:",ce)}finally{m(!1)}})()},[e,a]),p)return h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),h.jsx("p",{className:"text-slate-400",children:"Loading patient profile..."})]})});if(!o)return h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 text-center py-16",children:[h.jsx("p",{className:"text-slate-400",children:"Patient not found or access denied."}),h.jsx(Tn,{to:"/doctors",className:"mt-4 inline-block px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl",children:"Go Back"})]});const{patient:b,healthSummary:T,healthReports:x,wearableSummary:A,appointmentHistory:D}=o,N=[{id:"overview",label:"Overview",icon:Sl},{id:"reports",label:"Health Reports",icon:hi},{id:"wearables",label:"Wearable Data",icon:Rc},{id:"history",label:"Appointment History",icon:ga}];return h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[h.jsxs(Tn,{to:"/doctor/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors",children:[h.jsx(bl,{className:"w-4 h-4"}),"Back to Dashboard"]}),h.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:h.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-6",children:[h.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-white text-3xl font-bold",children:(P=(L=b.name)==null?void 0:L.charAt(0))==null?void 0:P.toUpperCase()}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h1",{className:"text-2xl font-bold text-white",children:b.name}),h.jsxs("div",{className:"flex flex-wrap gap-4 mt-2 text-sm text-slate-400",children:[b.email&&h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(w_,{className:"w-4 h-4"})," ",b.email]}),b.phone&&h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(Zk,{className:"w-4 h-4"})," ",b.phone]}),((U=b.profile)==null?void 0:U.age)&&h.jsxs("span",{children:[b.profile.age," years old"]}),((V=b.profile)==null?void 0:V.gender)&&h.jsx("span",{className:"capitalize",children:b.profile.gender})]})]}),(T==null?void 0:T.healthScore)&&h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:`text-4xl font-bold ${T.healthScore>=80?"text-emerald-400":T.healthScore>=60?"text-amber-400":"text-red-400"}`,children:T.healthScore}),h.jsx("p",{className:"text-sm text-slate-400",children:"Health Score"})]})]})}),h.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:N.map(ae=>h.jsxs("button",{onClick:()=>E(ae.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all whitespace-nowrap ${y===ae.id?"bg-cyan-500 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:[h.jsx(ae.icon,{className:"w-4 h-4"}),ae.label]},ae.id))}),y==="overview"&&h.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(Sl,{className:"w-5 h-5 text-cyan-400"})," Basic Information"]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[((F=b.profile)==null?void 0:F.height)&&h.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[h.jsx("p",{className:"text-sm text-slate-400",children:"Height"}),h.jsxs("p",{className:"font-semibold text-white",children:[b.profile.height," cm"]})]}),((H=b.profile)==null?void 0:H.weight)&&h.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[h.jsx("p",{className:"text-sm text-slate-400",children:"Weight"}),h.jsxs("p",{className:"font-semibold text-white",children:[b.profile.weight," kg"]})]}),((B=b.profile)==null?void 0:B.bloodGroup)&&h.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[h.jsx("p",{className:"text-sm text-slate-400",children:"Blood Group"}),h.jsx("p",{className:"font-semibold text-white",children:b.profile.bloodGroup})]}),((z=b.healthMetrics)==null?void 0:z.bmi)&&h.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[h.jsx("p",{className:"text-sm text-slate-400",children:"BMI"}),h.jsx("p",{className:"font-semibold text-white",children:b.healthMetrics.bmi.toFixed(1)})]})]}),((Q=(Y=b.profile)==null?void 0:Y.allergies)==null?void 0:Q.length)>0&&h.jsxs("div",{className:"mt-4",children:[h.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Allergies"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:b.profile.allergies.map((ae,ce)=>h.jsx("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:ae},ce))})]}),((de=(re=b.profile)==null?void 0:re.chronicConditions)==null?void 0:de.length)>0&&h.jsxs("div",{className:"mt-4",children:[h.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Chronic Conditions"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:b.profile.chronicConditions.map((ae,ce)=>h.jsx("span",{className:"px-3 py-1 bg-amber-500/20 text-amber-400 rounded-full text-sm",children:ae},ce))})]})]}),T&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(Yo,{className:"w-5 h-5 text-red-400"})," Health Summary"]}),((le=T.deficiencies)==null?void 0:le.length)>0&&h.jsxs("div",{className:"mb-4",children:[h.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["Deficiencies (",T.deficiencies.length,")"]}),h.jsx("div",{className:"space-y-2",children:T.deficiencies.slice(0,3).map((ae,ce)=>{var fe,He,Ye;const Se=typeof ae.currentValue=="object"?((fe=ae.currentValue)==null?void 0:fe.value)||JSON.stringify(ae.currentValue):ae.currentValue,je=typeof ae.normalRange=="object"?((He=ae.normalRange)==null?void 0:He.value)||JSON.stringify(ae.normalRange):ae.normalRange;return h.jsxs("div",{className:`p-3 rounded-xl ${ae.severity==="severe"?"bg-red-500/10 border border-red-500/30":ae.severity==="moderate"?"bg-amber-500/10 border border-amber-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[h.jsxs("div",{className:"flex justify-between items-center",children:[h.jsx("span",{className:"font-medium text-white",children:typeof ae.name=="object"?((Ye=ae.name)==null?void 0:Ye.value)||"Unknown":ae.name}),h.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${ae.severity==="severe"?"bg-red-500/20 text-red-400":ae.severity==="moderate"?"bg-amber-500/20 text-amber-400":"bg-yellow-500/20 text-yellow-400"}`,children:ae.severity})]}),h.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Current: ",Se," | Normal: ",je]})]},ce)})})]}),((he=T.riskFactors)==null?void 0:he.length)>0&&h.jsxs("div",{className:"mb-4",children:[h.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Risk Factors"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:T.riskFactors.map((ae,ce)=>h.jsx("span",{className:"px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm",children:typeof ae=="object"?(ae==null?void 0:ae.name)||(ae==null?void 0:ae.value)||JSON.stringify(ae):ae},ce))})]}),((Re=T.keyFindings)==null?void 0:Re.length)>0&&h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Key Findings"}),h.jsx("ul",{className:"space-y-1",children:T.keyFindings.slice(0,4).map((ae,ce)=>{const Se=typeof ae=="object"?(ae==null?void 0:ae.title)||(ae==null?void 0:ae.finding)||(ae==null?void 0:ae.value)||JSON.stringify(ae):ae;return h.jsxs("li",{className:"text-sm text-slate-300 flex items-start gap-2",children:[h.jsx("span",{className:"text-cyan-400 mt-1",children:""}),Se]},ce)})})]})]}),A&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 lg:col-span-2",children:[h.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(Rc,{className:"w-5 h-5 text-blue-400"})," Wearable Data Summary"]}),h.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[h.jsxs("div",{className:"p-4 bg-blue-500/10 rounded-xl text-center border border-blue-500/20",children:[h.jsx(ni,{className:"w-6 h-6 text-blue-400 mx-auto mb-2"}),h.jsx("p",{className:"text-2xl font-bold text-white",children:((ve=A.avgSteps)==null?void 0:ve.toLocaleString())||"N/A"}),h.jsx("p",{className:"text-sm text-slate-400",children:"Avg Steps/Day"})]}),h.jsxs("div",{className:"p-4 bg-red-500/10 rounded-xl text-center border border-red-500/20",children:[h.jsx(Yo,{className:"w-6 h-6 text-red-400 mx-auto mb-2"}),h.jsx("p",{className:"text-2xl font-bold text-white",children:A.avgHeartRate||"N/A"}),h.jsx("p",{className:"text-sm text-slate-400",children:"Avg Heart Rate"})]}),h.jsxs("div",{className:"p-4 bg-indigo-500/10 rounded-xl text-center border border-indigo-500/20",children:[h.jsx(gs,{className:"w-6 h-6 text-indigo-400 mx-auto mb-2"}),h.jsx("p",{className:"text-2xl font-bold text-white",children:A.avgSleepHours||"N/A"}),h.jsx("p",{className:"text-sm text-slate-400",children:"Avg Sleep (hrs)"})]}),h.jsxs("div",{className:"p-4 bg-emerald-500/10 rounded-xl text-center border border-emerald-500/20",children:[h.jsx(Rc,{className:"w-6 h-6 text-emerald-400 mx-auto mb-2"}),h.jsx("p",{className:"text-2xl font-bold text-white",children:((we=A.devices)==null?void 0:we.length)||0}),h.jsx("p",{className:"text-sm text-slate-400",children:"Connected Devices"})]})]})]})]}),y==="reports"&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Health Reports"}),(x==null?void 0:x.length)>0?h.jsx("div",{className:"space-y-3",children:x.map(ae=>h.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-700 flex items-center justify-center",children:h.jsx(hi,{className:"w-6 h-6 text-slate-400"})}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-white",children:ae.reportType}),h.jsx("p",{className:"text-sm text-slate-400",children:new Date(ae.createdAt).toLocaleDateString()})]})]}),h.jsxs("div",{className:"flex items-center gap-4",children:[ae.healthScore&&h.jsxs("span",{className:`font-bold ${ae.healthScore>=80?"text-emerald-400":ae.healthScore>=60?"text-amber-400":"text-red-400"}`,children:["Score: ",ae.healthScore]}),h.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${ae.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,children:ae.status})]})]},ae._id))}):h.jsx("p",{className:"text-slate-400 text-center py-8",children:"No health reports available"})]}),y==="wearables"&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Wearable Device Data"}),A?h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Connected Devices"}),h.jsx("div",{className:"flex flex-wrap gap-3",children:(ue=A.devices)==null?void 0:ue.map((ae,ce)=>h.jsxs("div",{className:"px-4 py-2 bg-cyan-500/10 border border-cyan-500/20 rounded-xl flex items-center gap-2",children:[h.jsx(Rc,{className:"w-4 h-4 text-cyan-400"}),h.jsx("span",{className:"font-medium text-cyan-300",children:ae.name||ae.type})]},ce))})]}),((be=A.recentMetrics)==null?void 0:be.length)>0&&h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Recent Activity (Last 7 Days)"}),h.jsx("div",{className:"overflow-x-auto",children:h.jsxs("table",{className:"w-full text-sm",children:[h.jsx("thead",{children:h.jsxs("tr",{className:"border-b border-slate-700",children:[h.jsx("th",{className:"text-left py-2 text-slate-400 font-medium",children:"Date"}),h.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Steps"}),h.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Calories"}),h.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Active Min"}),h.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Distance"})]})}),h.jsx("tbody",{children:A.recentMetrics.map((ae,ce)=>{var Se,je;return h.jsxs("tr",{className:"border-b border-slate-700/50",children:[h.jsx("td",{className:"py-2 text-white",children:new Date(ae.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),h.jsx("td",{className:"py-2 text-right text-slate-300",children:(Se=ae.steps)==null?void 0:Se.toLocaleString()}),h.jsx("td",{className:"py-2 text-right text-slate-300",children:ae.caloriesBurned}),h.jsx("td",{className:"py-2 text-right text-slate-300",children:ae.activeMinutes}),h.jsxs("td",{className:"py-2 text-right text-slate-300",children:[(je=ae.distance)==null?void 0:je.toFixed(1)," km"]})]},ce)})})]})})]})]}):h.jsx("p",{className:"text-slate-400 text-center py-8",children:"No wearable data available"})]}),y==="history"&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Appointment History"}),(D==null?void 0:D.length)>0?h.jsx("div",{className:"space-y-3",children:D.map(ae=>h.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(ga,{className:"w-5 h-5 text-slate-400"}),h.jsx("span",{className:"font-semibold text-white",children:new Date(ae.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),h.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${ae.status==="completed"?"bg-emerald-500/20 text-emerald-400":ae.status==="scheduled"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}`,children:ae.status})]}),ae.doctor&&h.jsxs("p",{className:"text-sm text-slate-400",children:["Dr. ",ae.doctor.name," - ",ae.doctor.specialization]}),ae.symptoms&&h.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:[h.jsx("span",{className:"font-medium text-slate-400",children:"Symptoms:"})," ",ae.symptoms]}),ae.notes&&h.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[h.jsx("span",{className:"font-medium text-slate-400",children:"Notes:"})," ",ae.notes]})]},ae._id))}):h.jsx("p",{className:"text-slate-400 text-center py-8",children:"No appointment history"})]})]})}var Ote={exports:{}};(function(e,n){(function(a,o){e.exports=o()})(bd,function(){function a(t,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(s){if(s!=="default"&&!(s in t)){var c=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(t,s,c.get?c:{enumerable:!0,get:function(){return i[s]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof bd<"u"?bd:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var p=function(t){try{return!!t()}catch{return!0}},m=!p(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),y=m,E=Function.prototype,b=E.call,T=y&&E.bind.bind(b,b),x=y?T:function(t){return function(){return b.apply(t,arguments)}},A=x({}.isPrototypeOf),D=function(t){return t&&t.Math===Math&&t},N=D(typeof globalThis=="object"&&globalThis)||D(typeof window=="object"&&window)||D(typeof self=="object"&&self)||D(typeof o=="object"&&o)||D(typeof o=="object"&&o)||function(){return this}()||Function("return this")(),L=m,P=Function.prototype,U=P.apply,V=P.call,F=typeof Reflect=="object"&&Reflect.apply||(L?V.bind(U):function(){return V.apply(U,arguments)}),H=x,B=H({}.toString),z=H("".slice),Y=function(t){return z(B(t),8,-1)},Q=Y,re=x,de=function(t){if(Q(t)==="Function")return re(t)},le=typeof document=="object"&&document.all,he=le===void 0&&le!==void 0?function(t){return typeof t=="function"||t===le}:function(t){return typeof t=="function"},Re={},ve=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),we=m,ue=Function.prototype.call,be=we?ue.bind(ue):function(){return ue.apply(ue,arguments)},ae={},ce={}.propertyIsEnumerable,Se=Object.getOwnPropertyDescriptor,je=Se&&!ce.call({1:2},1);ae.f=je?function(t){var r=Se(this,t);return!!r&&r.enumerable}:ce;var fe,He,Ye=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},gt=p,Vt=Y,zn=Object,_r=x("".split),it=gt(function(){return!zn("z").propertyIsEnumerable(0)})?function(t){return Vt(t)==="String"?_r(t,""):zn(t)}:zn,Nt=function(t){return t==null},Ut=Nt,Pe=TypeError,St=function(t){if(Ut(t))throw new Pe("Can't call method on "+t);return t},Ot=it,Pn=St,wn=function(t){return Ot(Pn(t))},Oe=he,rt=function(t){return typeof t=="object"?t!==null:Oe(t)},Qt={},Ri=Qt,Ka=N,so=he,Pl=function(t){return so(t)?t:void 0},Je=function(t,r){return arguments.length<2?Pl(Ri[t])||Pl(Ka[t]):Ri[t]&&Ri[t][r]||Ka[t]&&Ka[t][r]},Pt=N.navigator,Ar=Pt&&Pt.userAgent,Kn=Ar?String(Ar):"",Gi=N,Uc=Kn,Vc=Gi.process,Fh=Gi.Deno,Bh=Vc&&Vc.versions||Fh&&Fh.version,Wh=Bh&&Bh.v8;Wh&&(He=(fe=Wh.split("."))[0]>0&&fe[0]<4?1:+(fe[0]+fe[1])),!He&&Uc&&(!(fe=Uc.match(/Edge\/(\d+)/))||fe[1]>=74)&&(fe=Uc.match(/Chrome\/(\d+)/))&&(He=+fe[1]);var _s=He,Gh=_s,qm=p,Xm=N.String,Jo=!!Object.getOwnPropertySymbols&&!qm(function(){var t=Symbol("symbol detection");return!Xm(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Gh&&Gh<41}),D_=Jo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Dte=Je,kte=he,Lte=A,jte=Object,Jm=D_?function(t){return typeof t=="symbol"}:function(t){var r=Dte("Symbol");return kte(r)&&Lte(r.prototype,jte(t))},Mte=String,$h=function(t){try{return Mte(t)}catch{return"Object"}},Ute=he,Vte=$h,Fte=TypeError,ba=function(t){if(Ute(t))return t;throw new Fte(Vte(t)+" is not a function")},Bte=ba,Wte=Nt,Qm=function(t,r){var i=t[r];return Wte(i)?void 0:Bte(i)},cL=be,lL=he,dL=rt,Gte=TypeError,uL={exports:{}},hL=N,$te=Object.defineProperty,Hte=N,zte=function(t,r){try{$te(hL,t,{value:r,configurable:!0,writable:!0})}catch{hL[t]=r}return r},pL="__core-js_shared__",fL=uL.exports=Hte[pL]||zte(pL,{});(fL.versions||(fL.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var NT=uL.exports,mL=NT,Hh=function(t,r){return mL[t]||(mL[t]=r||{})},Kte=St,Yte=Object,Qo=function(t){return Yte(Kte(t))},qte=Qo,Xte=x({}.hasOwnProperty),Xr=Object.hasOwn||function(t,r){return Xte(qte(t),r)},Jte=x,Qte=0,Zte=Math.random(),ene=Jte(1.1.toString),OT=function(t){return"Symbol("+(t===void 0?"":t)+")_"+ene(++Qte+Zte,36)},tne=Hh,gL=Xr,nne=OT,rne=Jo,ine=D_,zh=N.Symbol,IT=tne("wks"),ane=ine?zh.for||zh:zh&&zh.withoutSetter||nne,Yn=function(t){return gL(IT,t)||(IT[t]=rne&&gL(zh,t)?zh[t]:ane("Symbol."+t)),IT[t]},sne=be,vL=rt,yL=Jm,one=Qm,cne=function(t,r){var i,s;if(lL(i=t.toString)&&!dL(s=cL(i,t))||lL(i=t.valueOf)&&!dL(s=cL(i,t)))return s;throw new Gte("Can't convert object to primitive value")},lne=TypeError,dne=Yn("toPrimitive"),une=function(t,r){if(!vL(t)||yL(t))return t;var i,s=one(t,dne);if(s){if(i=sne(s,t,r),!vL(i)||yL(i))return i;throw new lne("Can't convert object to primitive value")}return cne(t)},hne=Jm,PT=function(t){var r=une(t,"string");return hne(r)?r:r+""},_L=rt,DT=N.document,pne=_L(DT)&&_L(DT.createElement),kT=function(t){return pne?DT.createElement(t):{}},fne=kT,EL=!ve&&!p(function(){return Object.defineProperty(fne("div"),"a",{get:function(){return 7}}).a!==7}),mne=ve,gne=be,vne=ae,yne=Ye,_ne=wn,Ene=PT,bne=Xr,Sne=EL,bL=Object.getOwnPropertyDescriptor;Re.f=mne?bL:function(t,r){if(t=_ne(t),r=Ene(r),Sne)try{return bL(t,r)}catch{}if(bne(t,r))return yne(!gne(vne.f,t,r),t[r])};var wne=p,xne=he,Tne=/#|\.prototype\./,Zm=function(t,r){var i=Rne[Cne(t)];return i===Nne||i!==Ane&&(xne(r)?wne(r):!!r)},Cne=Zm.normalize=function(t){return String(t).replace(Tne,".").toLowerCase()},Rne=Zm.data={},Ane=Zm.NATIVE="N",Nne=Zm.POLYFILL="P",SL=Zm,One=ba,Ine=m,Pne=de(de.bind),Dl=function(t,r){return One(t),r===void 0?t:Ine?Pne(t,r):function(){return t.apply(r,arguments)}},Es={},wL=ve&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Dne=rt,kne=String,Lne=TypeError,aa=function(t){if(Dne(t))return t;throw new Lne(kne(t)+" is not an object")},jne=ve,Mne=EL,Une=wL,k_=aa,xL=PT,Vne=TypeError,LT=Object.defineProperty,Fne=Object.getOwnPropertyDescriptor,jT="enumerable",MT="configurable",UT="writable";Es.f=jne?Une?function(t,r,i){if(k_(t),r=xL(r),k_(i),typeof t=="function"&&r==="prototype"&&"value"in i&&UT in i&&!i[UT]){var s=Fne(t,r);s&&s[UT]&&(t[r]=i.value,i={configurable:MT in i?i[MT]:s[MT],enumerable:jT in i?i[jT]:s[jT],writable:!1})}return LT(t,r,i)}:LT:function(t,r,i){if(k_(t),r=xL(r),k_(i),Mne)try{return LT(t,r,i)}catch{}if("get"in i||"set"in i)throw new Vne("Accessors not supported");return"value"in i&&(t[r]=i.value),t};var Bne=Es,Wne=Ye,Zd=ve?function(t,r,i){return Bne.f(t,r,Wne(1,i))}:function(t,r,i){return t[r]=i,t},eg=N,Gne=F,$ne=de,Hne=he,zne=Re.f,Kne=SL,Kh=Qt,Yne=Dl,Yh=Zd,TL=Xr,qne=function(t){var r=function(i,s,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(i);case 2:return new t(i,s)}return new t(i,s,c)}return Gne(t,this,arguments)};return r.prototype=t.prototype,r},zt=function(t,r){var i,s,c,d,u,f,g,v,_,S=t.target,w=t.global,C=t.stat,M=t.proto,I=w?eg:C?eg[S]:eg[S]&&eg[S].prototype,k=w?Kh:Kh[S]||Yh(Kh,S,{})[S],G=k.prototype;for(d in r)s=!(i=Kne(w?d:S+(C?".":"#")+d,t.forced))&&I&&TL(I,d),f=k[d],s&&(g=t.dontCallGetSet?(_=zne(I,d))&&_.value:I[d]),u=s&&g?g:r[d],(i||M||typeof f!=typeof u)&&(v=t.bind&&s?Yne(u,eg):t.wrap&&s?qne(u):M&&Hne(u)?$ne(u):u,(t.sham||u&&u.sham||f&&f.sham)&&Yh(v,"sham",!0),Yh(k,d,v),M&&(TL(Kh,c=S+"Prototype")||Yh(Kh,c,{}),Yh(Kh[c],d,u),t.real&&G&&(i||!G[d])&&Yh(G,d,u)))},Xne=Math.ceil,Jne=Math.floor,Qne=Math.trunc||function(t){var r=+t;return(r>0?Jne:Xne)(r)},Zne=Qne,VT=function(t){var r=+t;return r!=r||r===0?0:Zne(r)},ere=VT,tre=Math.max,nre=Math.min,FT=function(t,r){var i=ere(t);return i<0?tre(i+r,0):nre(i,r)},rre=VT,ire=Math.min,CL=function(t){var r=rre(t);return r>0?ire(r,9007199254740991):0},are=CL,kl=function(t){return are(t.length)},sre=wn,ore=FT,cre=kl,RL=function(t){return function(r,i,s){var c=sre(r),d=cre(c);if(d===0)return!t&&-1;var u,f=ore(s,d);if(t&&i!=i){for(;d>f;)if((u=c[f++])!=u)return!0}else for(;d>f;f++)if((t||f in c)&&c[f]===i)return t||f||0;return!t&&-1}},BT={includes:RL(!0),indexOf:RL(!1)},lre=BT.includes;zt({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(t){return lre(this,t,arguments.length>1?arguments[1]:void 0)}});var dre=N,ure=Qt,Ya=function(t,r){var i=ure[t+"Prototype"],s=i&&i[r];if(s)return s;var c=dre[t],d=c&&c.prototype;return d&&d[r]},hre=Ya("Array","includes"),pre=rt,fre=Y,mre=Yn("match"),WT=function(t){var r;return pre(t)&&((r=t[mre])!==void 0?!!r:fre(t)==="RegExp")},gre=WT,vre=TypeError,AL={};AL[Yn("toStringTag")]="z";var GT=String(AL)==="[object z]",yre=GT,_re=he,L_=Y,Ere=Yn("toStringTag"),bre=Object,Sre=L_(function(){return arguments}())==="Arguments",Ll=yre?L_:function(t){var r,i,s;return t===void 0?"Undefined":t===null?"Null":typeof(i=function(c,d){try{return c[d]}catch{}}(r=bre(t),Ere))=="string"?i:Sre?L_(r):(s=L_(r))==="Object"&&_re(r.callee)?"Arguments":s},wre=Ll,xre=String,sa=function(t){if(wre(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return xre(t)},Tre=Yn("match"),Cre=zt,Rre=function(t){if(gre(t))throw new vre("The method doesn't accept regular expressions");return t},Are=St,NL=sa,Nre=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[Tre]=!1,"/./"[t](r)}catch{}}return!1},Ore=x("".indexOf);Cre({target:"String",proto:!0,forced:!Nre("includes")},{includes:function(t){return!!~Ore(NL(Are(this)),NL(Rre(t)),arguments.length>1?arguments[1]:void 0)}});var Ire=Ya("String","includes"),OL=A,Pre=hre,Dre=Ire,$T=Array.prototype,HT=String.prototype,kre=function(t){var r=t.includes;return t===$T||OL($T,t)&&r===$T.includes?Pre:typeof t=="string"||t===HT||OL(HT,t)&&r===HT.includes?Dre:r},xe=l(kre),Lre=ba,jre=Qo,Mre=it,Ure=kl,IL=TypeError,PL="Reduce of empty array with no initial value",Vre=function(t){return function(r,i,s,c){var d=jre(r),u=Mre(d),f=Ure(d);if(Lre(i),f===0&&s<2)throw new IL(PL);var g=t?f-1:0,v=t?-1:1;if(s<2)for(;;){if(g in u){c=u[g],g+=v;break}if(g+=v,t?g<0:f<=g)throw new IL(PL)}for(;t?g>=0:f>g;g+=v)g in u&&(c=i(c,u[g],g,d));return c}},Fre={left:Vre(!1)},Bre=p,j_=function(t,r){var i=[][t];return!!i&&Bre(function(){i.call(null,r||function(){return 1},1)})},tg=N,Wre=Kn,Gre=Y,M_=function(t){return Wre.slice(0,t.length)===t},zT=M_("Bun/")?"BUN":M_("Cloudflare-Workers")?"CLOUDFLARE":M_("Deno/")?"DENO":M_("Node.js/")?"NODE":tg.Bun&&typeof Bun.version=="string"?"BUN":tg.Deno&&typeof Deno.version=="object"?"DENO":Gre(tg.process)==="process"?"NODE":tg.window&&tg.document?"BROWSER":"REST",U_=zT==="NODE",$re=Fre.left;zt({target:"Array",proto:!0,forced:!U_&&_s>79&&_s<83||!j_("reduce")},{reduce:function(t){var r=arguments.length;return $re(this,t,r,r>1?arguments[1]:void 0)}});var Hre=Ya("Array","reduce"),zre=A,Kre=Hre,KT=Array.prototype,Yre=function(t){var r=t.reduce;return t===KT||zre(KT,t)&&r===KT.reduce?Kre:r},DL=Yre,qa=l(DL),qre=Y,ng=Array.isArray||function(t){return qre(t)==="Array"},Xre=zt,Jre=ng,Qre=x([].reverse),kL=[1,2];Xre({target:"Array",proto:!0,forced:String(kL)===String(kL.reverse())},{reverse:function(){return Jre(this)&&(this.length=this.length),Qre(this)}});var Zre=Ya("Array","reverse"),eie=A,tie=Zre,YT=Array.prototype,nie=function(t){var r=t.reverse;return t===YT||eie(YT,t)&&r===YT.reverse?tie:r},LL=nie,jL=l(LL),rie=OT,ML=Hh("keys"),V_=function(t){return ML[t]||(ML[t]=rie(t))},iie=!p(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),aie=Xr,sie=he,oie=Qo,cie=iie,UL=V_("IE_PROTO"),qT=Object,lie=qT.prototype,XT=cie?qT.getPrototypeOf:function(t){var r=oie(t);if(aie(r,UL))return r[UL];var i=r.constructor;return sie(i)&&r instanceof i?i.prototype:r instanceof qT?lie:null},die=x,uie=ba,hie=rt,pie=function(t){return hie(t)||t===null},fie=String,mie=TypeError,gie=function(t,r,i){try{return die(uie(Object.getOwnPropertyDescriptor(t,r)[i]))}catch{}},vie=rt,yie=St,_ie=function(t){if(pie(t))return t;throw new mie("Can't set "+fie(t)+" as a prototype")},Eie=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,i={};try{(t=gie(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(s,c){return yie(s),_ie(c),vie(s)&&(r?t(s,c):s.__proto__=c),s}}():void 0),F_={},B_={},JT=Xr,bie=wn,Sie=BT.indexOf,wie=B_,VL=x([].push),FL=function(t,r){var i,s=bie(t),c=0,d=[];for(i in s)!JT(wie,i)&&JT(s,i)&&VL(d,i);for(;r.length>c;)JT(s,i=r[c++])&&(~Sie(d,i)||VL(d,i));return d},QT=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],xie=FL,Tie=QT.concat("length","prototype");F_.f=Object.getOwnPropertyNames||function(t){return xie(t,Tie)};var rg={};rg.f=Object.getOwnPropertySymbols;var Cie=Je,Rie=F_,Aie=rg,Nie=aa,Oie=x([].concat),Iie=Cie("Reflect","ownKeys")||function(t){var r=Rie.f(Nie(t)),i=Aie.f;return i?Oie(r,i(t)):r},BL=Xr,Pie=Iie,Die=Re,kie=Es,ZT={},Lie=FL,jie=QT,W_=Object.keys||function(t){return Lie(t,jie)},Mie=ve,Uie=wL,Vie=Es,Fie=aa,Bie=wn,Wie=W_;ZT.f=Mie&&!Uie?Object.defineProperties:function(t,r){Fie(t);for(var i,s=Bie(r),c=Wie(r),d=c.length,u=0;d>u;)Vie.f(t,i=c[u++],s[i]);return t};var G_,WL=Je("document","documentElement"),Gie=aa,$ie=ZT,GL=QT,Hie=B_,zie=WL,Kie=kT,eC="prototype",tC="script",$L=V_("IE_PROTO"),nC=function(){},HL=function(t){return"<"+tC+">"+t+"</"+tC+">"},zL=function(t){t.write(HL("")),t.close();var r=t.parentWindow.Object;return t=null,r},$_=function(){try{G_=new ActiveXObject("htmlfile")}catch{}var t,r,i;$_=typeof document<"u"?document.domain&&G_?zL(G_):(r=Kie("iframe"),i="java"+tC+":",r.style.display="none",zie.appendChild(r),r.src=String(i),(t=r.contentWindow.document).open(),t.write(HL("document.F=Object")),t.close(),t.F):zL(G_);for(var s=GL.length;s--;)delete $_[eC][GL[s]];return $_()};Hie[$L]=!0;var ig=Object.create||function(t,r){var i;return t!==null?(nC[eC]=Gie(t),i=new nC,nC[eC]=null,i[$L]=t):i=$_(),r===void 0?i:$ie.f(i,r)},Yie=rt,qie=Zd,KL=Error,Xie=x("".replace),Jie=String(new KL("zxcasd").stack),YL=/\n\s*at [^:]*:[^\n]*/,Qie=YL.test(Jie),Zie=Ye,eae=!p(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Zie(1,7)),t.stack!==7)}),tae=Zd,nae=function(t,r){if(Qie&&typeof t=="string"&&!KL.prepareStackTrace)for(;r--;)t=Xie(t,YL,"");return t},rae=eae,qL=Error.captureStackTrace,qh={},iae=qh,aae=Yn("iterator"),sae=Array.prototype,XL=function(t){return t!==void 0&&(iae.Array===t||sae[aae]===t)},oae=Ll,JL=Qm,cae=Nt,lae=qh,dae=Yn("iterator"),H_=function(t){if(!cae(t))return JL(t,dae)||JL(t,"@@iterator")||lae[oae(t)]},uae=be,hae=ba,pae=aa,fae=$h,mae=H_,gae=TypeError,rC=function(t,r){var i=arguments.length<2?mae(t):r;if(hae(i))return pae(uae(i,t));throw new gae(fae(t)+" is not iterable")},vae=be,QL=aa,yae=Qm,ZL=function(t,r,i){var s,c;QL(t);try{if(!(s=yae(t,"return"))){if(r==="throw")throw i;return i}s=vae(s,t)}catch(d){c=!0,s=d}if(r==="throw")throw i;if(c)throw s;return QL(s),i},_ae=Dl,Eae=be,bae=aa,Sae=$h,wae=XL,xae=kl,ej=A,Tae=rC,Cae=H_,tj=ZL,Rae=TypeError,z_=function(t,r){this.stopped=t,this.result=r},nj=z_.prototype,ag=function(t,r,i){var s,c,d,u,f,g,v,_=i&&i.that,S=!(!i||!i.AS_ENTRIES),w=!(!i||!i.IS_RECORD),C=!(!i||!i.IS_ITERATOR),M=!(!i||!i.INTERRUPTED),I=_ae(r,_),k=function(K){return s&&tj(s,"normal"),new z_(!0,K)},G=function(K){return S?(bae(K),M?I(K[0],K[1],k):I(K[0],K[1])):M?I(K,k):I(K)};if(w)s=t.iterator;else if(C)s=t;else{if(!(c=Cae(t)))throw new Rae(Sae(t)+" is not iterable");if(wae(c)){for(d=0,u=xae(t);u>d;d++)if((f=G(t[d]))&&ej(nj,f))return f;return new z_(!1)}s=Tae(t,c)}for(g=w?t.next:s.next;!(v=Eae(g,s)).done;){try{f=G(v.value)}catch(K){tj(s,"throw",K)}if(typeof f=="object"&&f&&ej(nj,f))return f}return new z_(!1)},Aae=sa,Nae=zt,Oae=A,Iae=XT,K_=Eie,Pae=function(t,r,i){for(var s=Pie(r),c=kie.f,d=Die.f,u=0;u<s.length;u++){var f=s[u];BL(t,f)||i&&BL(i,f)||c(t,f,d(r,f))}},rj=ig,iC=Zd,aC=Ye,Dae=function(t,r){Yie(r)&&"cause"in r&&qie(t,"cause",r.cause)},kae=function(t,r,i,s){rae&&(qL?qL(t,r):tae(t,"stack",nae(i,s)))},Lae=ag,jae=function(t,r){return t===void 0?arguments.length<2?"":r:Aae(t)},Mae=Yn("toStringTag"),Y_=Error,Uae=[].push,Xh=function(t,r){var i,s=Oae(sC,this);K_?i=K_(new Y_,s?Iae(this):sC):(i=s?this:rj(sC),iC(i,Mae,"Error")),r!==void 0&&iC(i,"message",jae(r)),kae(i,Xh,i.stack,1),arguments.length>2&&Dae(i,arguments[2]);var c=[];return Lae(t,Uae,{that:c}),iC(i,"errors",c),i};K_?K_(Xh,Y_):Pae(Xh,Y_,{name:!0});var sC=Xh.prototype=rj(Y_.prototype,{constructor:aC(1,Xh),message:aC(1,""),name:aC(1,"AggregateError")});Nae({global:!0},{AggregateError:Xh});var q_,sg,X_,Vae=he,ij=N.WeakMap,Fae=Vae(ij)&&/native code/.test(String(ij)),aj=N,Bae=rt,Wae=Zd,oC=Xr,cC=NT,Gae=V_,$ae=B_,sj="Object already initialized",lC=aj.TypeError,Hae=aj.WeakMap;if(Fae||cC.state){var Zo=cC.state||(cC.state=new Hae);Zo.get=Zo.get,Zo.has=Zo.has,Zo.set=Zo.set,q_=function(t,r){if(Zo.has(t))throw new lC(sj);return r.facade=t,Zo.set(t,r),r},sg=function(t){return Zo.get(t)||{}},X_=function(t){return Zo.has(t)}}else{var Jh=Gae("state");$ae[Jh]=!0,q_=function(t,r){if(oC(t,Jh))throw new lC(sj);return r.facade=t,Wae(t,Jh,r),r},sg=function(t){return oC(t,Jh)?t[Jh]:{}},X_=function(t){return oC(t,Jh)}}var eu,oj,cj,tu={set:q_,get:sg,has:X_,enforce:function(t){return X_(t)?sg(t):q_(t,{})},getterFor:function(t){return function(r){var i;if(!Bae(r)||(i=sg(r)).type!==t)throw new lC("Incompatible receiver, "+t+" required");return i}}},dC=ve,zae=Xr,lj=Function.prototype,Kae=dC&&Object.getOwnPropertyDescriptor,dj=zae(lj,"name"),uj={PROPER:dj&&(function(){}).name==="something",CONFIGURABLE:dj&&(!dC||dC&&Kae(lj,"name").configurable)},Yae=Zd,jl=function(t,r,i,s){return s&&s.enumerable?t[r]=i:Yae(t,r,i),t},qae=p,Xae=he,Jae=rt,Qae=ig,hj=XT,Zae=jl,uC=Yn("iterator"),pj=!1;[].keys&&("next"in(cj=[].keys())?(oj=hj(hj(cj)))!==Object.prototype&&(eu=oj):pj=!0);var ese=!Jae(eu)||qae(function(){var t={};return eu[uC].call(t)!==t});Xae((eu=ese?{}:Qae(eu))[uC])||Zae(eu,uC,function(){return this});var fj={IteratorPrototype:eu,BUGGY_SAFARI_ITERATORS:pj},tse=Ll,nse=GT?{}.toString:function(){return"[object "+tse(this)+"]"},rse=GT,ise=Es.f,ase=Zd,sse=Xr,ose=nse,mj=Yn("toStringTag"),Fc=function(t,r,i,s){var c=i?t:t&&t.prototype;c&&(sse(c,mj)||ise(c,mj,{configurable:!0,value:r}),s&&!rse&&ase(c,"toString",ose))},cse=fj.IteratorPrototype,lse=ig,dse=Ye,use=Fc,hse=qh,pse=function(){return this},hC=function(t,r,i,s){var c=r+" Iterator";return t.prototype=lse(cse,{next:dse(+!s,i)}),use(t,c,!1,!0),hse[c]=pse,t},fse=zt,mse=be,gse=uj,vse=hC,yse=XT,_se=Fc,gj=jl,vj=qh,Ese=fj,bse=gse.PROPER,J_=Ese.BUGGY_SAFARI_ITERATORS,pC=Yn("iterator"),yj="keys",Q_="values",_j="entries",Sse=function(){return this},Ej=function(t,r,i,s,c,d,u){vse(i,r,s);var f,g,v,_=function(G){if(G===c&&I)return I;if(!J_&&G&&G in C)return C[G];switch(G){case yj:case Q_:case _j:return function(){return new i(this,G)}}return function(){return new i(this)}},S=r+" Iterator",w=!1,C=t.prototype,M=C[pC]||C["@@iterator"]||c&&C[c],I=!J_&&M||_(c),k=r==="Array"&&C.entries||M;if(k&&(f=yse(k.call(new t)))!==Object.prototype&&f.next&&(_se(f,S,!0,!0),vj[S]=Sse),bse&&c===Q_&&M&&M.name!==Q_&&(w=!0,I=function(){return mse(M,this)}),c)if(g={values:_(Q_),keys:d?I:_(yj),entries:_(_j)},u)for(v in g)(J_||w||!(v in C))&&gj(C,v,g[v]);else fse({target:r,proto:!0,forced:J_||w},g);return u&&C[pC]!==I&&gj(C,pC,I,{}),vj[r]=I,g},Z_=function(t,r){return{value:t,done:r}},wse=wn,bj=qh,Sj=tu;Es.f;var xse=Ej,e0=Z_,wj="Array Iterator",Tse=Sj.set,Cse=Sj.getterFor(wj);xse(Array,"Array",function(t,r){Tse(this,{type:wj,target:wse(t),index:0,kind:r})},function(){var t=Cse(this),r=t.target,i=t.index++;if(!r||i>=r.length)return t.target=null,e0(void 0,!0);switch(t.kind){case"keys":return e0(i,!1);case"values":return e0(r[i],!1)}return e0([i,r[i]],!1)},"values"),bj.Arguments=bj.Array;var Rse=Es,t0=function(t,r,i){return Rse.f(t,r,i)},Ase=Je,Nse=t0,Ose=ve,xj=Yn("species"),Ise=A,Pse=TypeError,fC=function(t,r){if(Ise(r,t))return t;throw new Pse("Incorrect invocation")},Dse=he,mC=NT,kse=x(Function.toString);Dse(mC.inspectSource)||(mC.inspectSource=function(t){return kse(t)});var Tj=mC.inspectSource,Lse=x,jse=p,Cj=he,Mse=Ll,Use=Tj,Rj=function(){},Aj=Je("Reflect","construct"),gC=/^\s*(?:class|function)\b/,Vse=Lse(gC.exec),Fse=!gC.test(Rj),og=function(t){if(!Cj(t))return!1;try{return Aj(Rj,[],t),!0}catch{return!1}},Nj=function(t){if(!Cj(t))return!1;switch(Mse(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Fse||!!Vse(gC,Use(t))}catch{return!0}};Nj.sham=!0;var cg,Qh,Oj,vC,n0=!Aj||jse(function(){var t;return og(og.call)||!og(Object)||!og(function(){t=!0})||t})?Nj:og,Bse=n0,Wse=$h,Gse=TypeError,Ij=aa,$se=function(t){if(Bse(t))return t;throw new Gse(Wse(t)+" is not a constructor")},Hse=Nt,zse=Yn("species"),yC=function(t,r){var i,s=Ij(t).constructor;return s===void 0||Hse(i=Ij(s)[zse])?r:$se(i)},Ml=x([].slice),Kse=TypeError,nu=function(t,r){if(t<r)throw new Kse("Not enough arguments");return t},Pj=/(?:ipad|iphone|ipod).*applewebkit/i.test(Kn),Xa=N,Yse=F,qse=Dl,Dj=he,Xse=Xr,kj=p,Lj=WL,Jse=Ml,jj=kT,Qse=nu,Zse=Pj,eoe=U_,_C=Xa.setImmediate,EC=Xa.clearImmediate,toe=Xa.process,bC=Xa.Dispatch,noe=Xa.Function,Mj=Xa.MessageChannel,roe=Xa.String,SC=0,lg={},Uj="onreadystatechange";kj(function(){cg=Xa.location});var wC=function(t){if(Xse(lg,t)){var r=lg[t];delete lg[t],r()}},xC=function(t){return function(){wC(t)}},Vj=function(t){wC(t.data)},Fj=function(t){Xa.postMessage(roe(t),cg.protocol+"//"+cg.host)};_C&&EC||(_C=function(t){Qse(arguments.length,1);var r=Dj(t)?t:noe(t),i=Jse(arguments,1);return lg[++SC]=function(){Yse(r,void 0,i)},Qh(SC),SC},EC=function(t){delete lg[t]},eoe?Qh=function(t){toe.nextTick(xC(t))}:bC&&bC.now?Qh=function(t){bC.now(xC(t))}:Mj&&!Zse?(vC=(Oj=new Mj).port2,Oj.port1.onmessage=Vj,Qh=qse(vC.postMessage,vC)):Xa.addEventListener&&Dj(Xa.postMessage)&&!Xa.importScripts&&cg&&cg.protocol!=="file:"&&!kj(Fj)?(Qh=Fj,Xa.addEventListener("message",Vj,!1)):Qh=Uj in jj("script")?function(t){Lj.appendChild(jj("script"))[Uj]=function(){Lj.removeChild(this),wC(t)}}:function(t){setTimeout(xC(t),0)});var r0={set:_C,clear:EC},Bj=N,ioe=ve,aoe=Object.getOwnPropertyDescriptor,Wj=function(t){if(!ioe)return Bj[t];var r=aoe(Bj,t);return r&&r.value},Gj=function(){this.head=null,this.tail=null};Gj.prototype={add:function(t){var r={item:t,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Zh,TC,CC,RC,$j,Hj=Gj,soe=/ipad|iphone|ipod/i.test(Kn)&&typeof Pebble<"u",ooe=/web0s(?!.*chrome)/i.test(Kn),ep=N,coe=Wj,zj=Dl,AC=r0.set,loe=Hj,doe=Pj,uoe=soe,hoe=ooe,NC=U_,Kj=ep.MutationObserver||ep.WebKitMutationObserver,Yj=ep.document,qj=ep.process,i0=ep.Promise,OC=coe("queueMicrotask");if(!OC){var a0=new loe,s0=function(){var t,r;for(NC&&(t=qj.domain)&&t.exit();r=a0.get();)try{r()}catch(i){throw a0.head&&Zh(),i}t&&t.enter()};doe||NC||hoe||!Kj||!Yj?!uoe&&i0&&i0.resolve?((RC=i0.resolve(void 0)).constructor=i0,$j=zj(RC.then,RC),Zh=function(){$j(s0)}):NC?Zh=function(){qj.nextTick(s0)}:(AC=zj(AC,ep),Zh=function(){AC(s0)}):(TC=!0,CC=Yj.createTextNode(""),new Kj(s0).observe(CC,{characterData:!0}),Zh=function(){CC.data=TC=!TC}),OC=function(t){a0.head||Zh(),a0.add(t)}}var Xj=OC,tp=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},ru=N.Promise,poe=N,dg=ru,foe=he,moe=SL,goe=Tj,voe=Yn,Jj=zT,IC=_s,Qj=dg&&dg.prototype,yoe=voe("species"),Zj=foe(poe.PromiseRejectionEvent),_oe=moe("Promise",function(){var t=goe(dg),r=t!==String(dg);if(!r&&IC===66||!Qj.catch||!Qj.finally)return!0;if(!IC||IC<51||!/native code/.test(t)){var i=new dg(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((i.constructor={})[yoe]=s,!(i.then(function(){})instanceof s))return!0}return!(r||Jj!=="BROWSER"&&Jj!=="DENO"||Zj)}),ug={CONSTRUCTOR:_oe,REJECTION_EVENT:Zj},ec={},eM=ba,Eoe=TypeError,boe=function(t){var r,i;this.promise=new t(function(s,c){if(r!==void 0||i!==void 0)throw new Eoe("Bad Promise constructor");r=s,i=c}),this.resolve=eM(r),this.reject=eM(i)};ec.f=function(t){return new boe(t)};var PC,tM,nM,Soe=zt,o0=U_,Ul=N,woe=Qt,hg=be,xoe=jl,Toe=Fc,Coe=function(t){var r=Ase(t);Ose&&r&&!r[xj]&&Nse(r,xj,{configurable:!0,get:function(){return this}})},Roe=ba,DC=he,Aoe=rt,Noe=fC,Ooe=yC,rM=r0.set,kC=Xj,Ioe=function(t,r){try{arguments.length===1?console.error(t):console.error(t,r)}catch{}},Poe=tp,Doe=Hj,iM=tu,LC=ru,aM=ug,sM=ec,c0="Promise",oM=aM.CONSTRUCTOR,koe=aM.REJECTION_EVENT,jC=iM.getterFor(c0),Loe=iM.set,joe=LC&&LC.prototype,pg=LC,MC=joe,cM=Ul.TypeError,UC=Ul.document,VC=Ul.process,FC=sM.f,Moe=FC,Uoe=!!(UC&&UC.createEvent&&Ul.dispatchEvent),lM="unhandledrejection",dM=function(t){var r;return!(!Aoe(t)||!DC(r=t.then))&&r},uM=function(t,r){var i,s,c,d=r.value,u=r.state===1,f=u?t.ok:t.fail,g=t.resolve,v=t.reject,_=t.domain;try{f?(u||(r.rejection===2&&Foe(r),r.rejection=1),f===!0?i=d:(_&&_.enter(),i=f(d),_&&(_.exit(),c=!0)),i===t.promise?v(new cM("Promise-chain cycle")):(s=dM(i))?hg(s,i,g,v):g(i)):v(d)}catch(S){_&&!c&&_.exit(),v(S)}},hM=function(t,r){t.notified||(t.notified=!0,kC(function(){for(var i,s=t.reactions;i=s.get();)uM(i,t);t.notified=!1,r&&!t.rejection&&Voe(t)}))},pM=function(t,r,i){var s,c;Uoe?((s=UC.createEvent("Event")).promise=r,s.reason=i,s.initEvent(t,!1,!0),Ul.dispatchEvent(s)):s={promise:r,reason:i},!koe&&(c=Ul["on"+t])?c(s):t===lM&&Ioe("Unhandled promise rejection",i)},Voe=function(t){hg(rM,Ul,function(){var r,i=t.facade,s=t.value;if(fM(t)&&(r=Poe(function(){o0?VC.emit("unhandledRejection",s,i):pM(lM,i,s)}),t.rejection=o0||fM(t)?2:1,r.error))throw r.value})},fM=function(t){return t.rejection!==1&&!t.parent},Foe=function(t){hg(rM,Ul,function(){var r=t.facade;o0?VC.emit("rejectionHandled",r):pM("rejectionhandled",r,t.value)})},np=function(t,r,i){return function(s){t(r,s,i)}},rp=function(t,r,i){t.done||(t.done=!0,i&&(t=i),t.value=r,t.state=2,hM(t,!0))},BC=function(t,r,i){if(!t.done){t.done=!0,i&&(t=i);try{if(t.facade===r)throw new cM("Promise can't be resolved itself");var s=dM(r);s?kC(function(){var c={done:!1};try{hg(s,r,np(BC,c,t),np(rp,c,t))}catch(d){rp(c,d,t)}}):(t.value=r,t.state=1,hM(t,!1))}catch(c){rp({done:!1},c,t)}}};oM&&(MC=(pg=function(t){Noe(this,MC),Roe(t),hg(PC,this);var r=jC(this);try{t(np(BC,r),np(rp,r))}catch(i){rp(r,i)}}).prototype,(PC=function(t){Loe(this,{type:c0,done:!1,notified:!1,parent:!1,reactions:new Doe,rejection:!1,state:0,value:null})}).prototype=xoe(MC,"then",function(t,r){var i=jC(this),s=FC(Ooe(this,pg));return i.parent=!0,s.ok=!DC(t)||t,s.fail=DC(r)&&r,s.domain=o0?VC.domain:void 0,i.state===0?i.reactions.add(s):kC(function(){uM(s,i)}),s.promise}),tM=function(){var t=new PC,r=jC(t);this.promise=t,this.resolve=np(BC,r),this.reject=np(rp,r)},sM.f=FC=function(t){return t===pg||t===nM?new tM(t):Moe(t)}),Soe({global:!0,wrap:!0,forced:oM},{Promise:pg}),nM=woe.Promise,Toe(pg,c0,!1,!0),Coe(c0);var mM=Yn("iterator"),gM=!1;try{var Boe=0,vM={next:function(){return{done:!!Boe++}},return:function(){gM=!0}};vM[mM]=function(){return this},Array.from(vM,function(){throw 2})}catch{}var Woe=ru,Goe=function(t,r){try{if(!r&&!gM)return!1}catch{return!1}var i=!1;try{var s={};s[mM]=function(){return{next:function(){return{done:i=!0}}}},t(s)}catch{}return i},l0=ug.CONSTRUCTOR||!Goe(function(t){Woe.all(t).then(void 0,function(){})}),$oe=be,Hoe=ba,zoe=ec,Koe=tp,Yoe=ag;zt({target:"Promise",stat:!0,forced:l0},{all:function(t){var r=this,i=zoe.f(r),s=i.resolve,c=i.reject,d=Koe(function(){var u=Hoe(r.resolve),f=[],g=0,v=1;Yoe(t,function(_){var S=g++,w=!1;v++,$oe(u,r,_).then(function(C){w||(w=!0,f[S]=C,--v||s(f))},c)}),--v||s(f)});return d.error&&c(d.value),i.promise}});var qoe=zt,Xoe=ug.CONSTRUCTOR;ru&&ru.prototype,qoe({target:"Promise",proto:!0,forced:Xoe,real:!0},{catch:function(t){return this.then(void 0,t)}});var Joe=be,Qoe=ba,Zoe=ec,ece=tp,tce=ag;zt({target:"Promise",stat:!0,forced:l0},{race:function(t){var r=this,i=Zoe.f(r),s=i.reject,c=ece(function(){var d=Qoe(r.resolve);tce(t,function(u){Joe(d,r,u).then(i.resolve,s)})});return c.error&&s(c.value),i.promise}});var nce=ec;zt({target:"Promise",stat:!0,forced:ug.CONSTRUCTOR},{reject:function(t){var r=nce.f(this);return(0,r.reject)(t),r.promise}});var rce=aa,ice=rt,ace=ec,yM=function(t,r){if(rce(t),ice(r)&&r.constructor===t)return r;var i=ace.f(t);return(0,i.resolve)(r),i.promise},sce=zt,oce=ru,cce=ug.CONSTRUCTOR,lce=yM,dce=Je("Promise"),uce=!cce;sce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return lce(uce&&this===dce?oce:this,t)}});var hce=be,pce=ba,fce=ec,mce=tp,gce=ag;zt({target:"Promise",stat:!0,forced:l0},{allSettled:function(t){var r=this,i=fce.f(r),s=i.resolve,c=i.reject,d=mce(function(){var u=pce(r.resolve),f=[],g=0,v=1;gce(t,function(_){var S=g++,w=!1;v++,hce(u,r,_).then(function(C){w||(w=!0,f[S]={status:"fulfilled",value:C},--v||s(f))},function(C){w||(w=!0,f[S]={status:"rejected",reason:C},--v||s(f))})}),--v||s(f)});return d.error&&c(d.value),i.promise}});var vce=be,yce=ba,_ce=Je,Ece=ec,bce=tp,Sce=ag,_M="No one promise resolved";zt({target:"Promise",stat:!0,forced:l0},{any:function(t){var r=this,i=_ce("AggregateError"),s=Ece.f(r),c=s.resolve,d=s.reject,u=bce(function(){var f=yce(r.resolve),g=[],v=0,_=1,S=!1;Sce(t,function(w){var C=v++,M=!1;_++,vce(f,r,w).then(function(I){M||S||(S=!0,c(I))},function(I){M||S||(M=!0,g[C]=I,--_||d(new i(g,_M)))})}),--_||d(new i(g,_M))});return u.error&&d(u.value),s.promise}});var wce=zt,xce=F,Tce=Ml,Cce=ec,Rce=ba,EM=tp,WC=N.Promise,bM=!1;wce({target:"Promise",stat:!0,forced:!WC||!WC.try||EM(function(){WC.try(function(t){bM=t===8},8)}).error||!bM},{try:function(t){var r=arguments.length>1?Tce(arguments,1):[],i=Cce.f(this),s=EM(function(){return xce(Rce(t),void 0,r)});return(s.error?i.reject:i.resolve)(s.value),i.promise}});var Ace=ec;zt({target:"Promise",stat:!0},{withResolvers:function(){var t=Ace.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Nce=zt,GC=ru,Oce=p,Ice=Je,Pce=he,Dce=yC,SM=yM,kce=GC&&GC.prototype;Nce({target:"Promise",proto:!0,real:!0,forced:!!GC&&Oce(function(){kce.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=Dce(this,Ice("Promise")),i=Pce(t);return this.then(i?function(s){return SM(r,t()).then(function(){return s})}:t,i?function(s){return SM(r,t()).then(function(){throw s})}:t)}});var $C=x,Lce=VT,jce=sa,Mce=St,Uce=$C("".charAt),wM=$C("".charCodeAt),Vce=$C("".slice),xM=function(t){return function(r,i){var s,c,d=jce(Mce(r)),u=Lce(i),f=d.length;return u<0||u>=f?t?"":void 0:(s=wM(d,u))<55296||s>56319||u+1===f||(c=wM(d,u+1))<56320||c>57343?t?Uce(d,u):s:t?Vce(d,u,u+2):c-56320+(s-55296<<10)+65536}},HC={codeAt:xM(!1),charAt:xM(!0)},Fce=HC.charAt,Bce=sa,TM=tu,Wce=Ej,CM=Z_,RM="String Iterator",Gce=TM.set,$ce=TM.getterFor(RM);Wce(String,"String",function(t){Gce(this,{type:RM,string:Bce(t),index:0})},function(){var t,r=$ce(this),i=r.string,s=r.index;return s>=i.length?CM(void 0,!0):(t=Fce(i,s),r.index+=t.length,CM(t,!1))});var Hce=Qt.Promise,zce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Kce=N,Yce=Fc,AM=qh;for(var zC in zce)Yce(Kce[zC],zC),AM[zC]=AM.Array;var NM=Hce,Ie=l(NM),qce=Ya("Array","values"),Xce=Ll,Jce=Xr,Qce=A,Zce=qce,KC=Array.prototype,ele={DOMTokenList:!0,NodeList:!0},tle=function(t){var r=t.values;return t===KC||Qce(KC,t)&&r===KC.values||Jce(ele,Xce(t))?Zce:r},oa=l(tle),OM=$h,nle=TypeError,IM=Ml,rle=Math.floor,YC=function(t,r){var i=t.length;if(i<8)for(var s,c,d=1;d<i;){for(c=d,s=t[d];c&&r(t[c-1],s)>0;)t[c]=t[--c];c!==d++&&(t[c]=s)}else for(var u=rle(i/2),f=YC(IM(t,0,u),r),g=YC(IM(t,u),r),v=f.length,_=g.length,S=0,w=0;S<v||w<_;)t[S+w]=S<v&&w<_?r(f[S],g[w])<=0?f[S++]:g[w++]:S<v?f[S++]:g[w++];return t},PM=YC,DM=Kn.match(/firefox\/(\d+)/i),ile=!!DM&&+DM[1],ale=/MSIE|Trident/.test(Kn),kM=Kn.match(/AppleWebKit\/(\d+)\./),sle=!!kM&&+kM[1],ole=zt,LM=x,cle=ba,lle=Qo,jM=kl,dle=function(t,r){if(!delete t[r])throw new nle("Cannot delete property "+OM(r)+" of "+OM(t))},MM=sa,qC=p,ule=PM,hle=j_,UM=ile,ple=ale,VM=_s,FM=sle,Vl=[],BM=LM(Vl.sort),fle=LM(Vl.push),mle=qC(function(){Vl.sort(void 0)}),gle=qC(function(){Vl.sort(null)}),vle=hle("sort"),WM=!qC(function(){if(VM)return VM<70;if(!(UM&&UM>3)){if(ple)return!0;if(FM)return FM<603;var t,r,i,s,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)Vl.push({k:r+s,v:i})}for(Vl.sort(function(d,u){return u.v-d.v}),s=0;s<Vl.length;s++)r=Vl[s].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});ole({target:"Array",proto:!0,forced:mle||!gle||!vle||!WM},{sort:function(t){t!==void 0&&cle(t);var r=lle(this);if(WM)return t===void 0?BM(r):BM(r,t);var i,s,c=[],d=jM(r);for(s=0;s<d;s++)s in r&&fle(c,r[s]);for(ule(c,function(u){return function(f,g){return g===void 0?-1:f===void 0?1:u!==void 0?+u(f,g)||0:MM(f)>MM(g)?1:-1}}(t)),i=jM(c),s=0;s<i;)r[s]=c[s++];for(;s<d;)dle(r,s++);return r}});var yle=Ya("Array","sort"),_le=A,Ele=yle,XC=Array.prototype,ble=function(t){var r=t.sort;return t===XC||_le(XC,t)&&r===XC.sort?Ele:r},iu=l(ble),Sle=zt,wle=x,xle=FT,Tle=RangeError,GM=String.fromCharCode,$M=String.fromCodePoint,Cle=wle([].join);Sle({target:"String",stat:!0,forced:!!$M&&$M.length!==1},{fromCodePoint:function(t){for(var r,i=[],s=arguments.length,c=0;s>c;){if(r=+arguments[c++],xle(r,1114111)!==r)throw new Tle(r+" is not a valid code point");i[c]=r<65536?GM(r):GM(55296+((r-=65536)>>10),r%1024+56320)}return Cle(i,"")}});var Rle=p,Ale=Yn("iterator"),d0=!Rle(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),s="";return t.pathname="c%20d",r.forEach(function(c,d){r.delete("b"),s+=d+c}),i.delete("a",2),i.delete("b",void 0),!t.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!r.size&&!0||!r.sort||t.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Ale]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Nle=jl,JC=zt,HM=N,QC=Wj,Ole=Je,u0=be,oo=x,fg=ve,zM=d0,KM=jl,Ile=t0,Ple=function(t,r,i){for(var s in r)i&&i.unsafe&&t[s]?t[s]=r[s]:Nle(t,s,r[s],i);return t},Dle=Fc,kle=hC,ZC=tu,YM=fC,eR=he,Lle=Xr,jle=Dl,Mle=Ll,Ule=aa,qM=rt,ca=sa,Vle=ig,XM=Ye,JM=rC,Fle=H_,h0=Z_,ip=nu,Ble=PM,Wle=Yn("iterator"),ap="URLSearchParams",QM=ap+"Iterator",ZM=ZC.set,bs=ZC.getterFor(ap),Gle=ZC.getterFor(QM),eU=QC("fetch"),p0=QC("Request"),mg=QC("Headers"),tR=p0&&p0.prototype,tU=mg&&mg.prototype,$le=HM.TypeError,Hle=HM.encodeURIComponent,zle=String.fromCharCode,Kle=Ole("String","fromCodePoint"),Yle=parseInt,f0=oo("".charAt),nU=oo([].join),Fl=oo([].push),rU=oo("".replace),qle=oo([].shift),iU=oo([].splice),aU=oo("".split),sU=oo("".slice),Xle=oo(/./.exec),Jle=/\+/g,Qle=/^[0-9a-f]+$/i,oU=function(t,r){var i=sU(t,r,r+2);return Xle(Qle,i)?Yle(i,16):NaN},Zle=function(t){for(var r=0,i=128;i>0&&t&i;i>>=1)r++;return r},ede=function(t){var r=null;switch(t.length){case 1:r=t[0];break;case 2:r=(31&t[0])<<6|63&t[1];break;case 3:r=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:r=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return r>1114111?null:r},cU=function(t){for(var r=(t=rU(t,Jle," ")).length,i="",s=0;s<r;){var c=f0(t,s);if(c==="%"){if(f0(t,s+1)==="%"||s+3>r){i+="%",s++;continue}var d=oU(t,s+1);if(d!=d){i+=c,s++;continue}s+=2;var u=Zle(d);if(u===0)c=zle(d);else{if(u===1||u>4){i+="",s++;continue}for(var f=[d],g=1;g<u&&!(++s+3>r||f0(t,s)!=="%");){var v=oU(t,s+1);if(v!=v){s+=3;break}if(v>191||v<128)break;Fl(f,v),s+=2,g++}if(f.length!==u){i+="";continue}var _=ede(f);_===null?i+="":c=Kle(_)}}i+=c,s++}return i},tde=/[!'()~]|%20/g,nde={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},rde=function(t){return nde[t]},lU=function(t){return rU(Hle(t),tde,rde)},nR=kle(function(t,r){ZM(this,{type:QM,target:bs(t).entries,index:0,kind:r})},ap,function(){var t=Gle(this),r=t.target,i=t.index++;if(!r||i>=r.length)return t.target=null,h0(void 0,!0);var s=r[i];switch(t.kind){case"keys":return h0(s.key,!1);case"values":return h0(s.value,!1)}return h0([s.key,s.value],!1)},!0),dU=function(t){this.entries=[],this.url=null,t!==void 0&&(qM(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?f0(t,0)==="?"?sU(t,1):t:ca(t)))};dU.prototype={type:ap,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,i,s,c,d,u,f,g=this.entries,v=Fle(t);if(v)for(i=(r=JM(t,v)).next;!(s=u0(i,r)).done;){if(d=(c=JM(Ule(s.value))).next,(u=u0(d,c)).done||(f=u0(d,c)).done||!u0(d,c).done)throw new $le("Expected sequence with length 2");Fl(g,{key:ca(u.value),value:ca(f.value)})}else for(var _ in t)Lle(t,_)&&Fl(g,{key:_,value:ca(t[_])})},parseQuery:function(t){if(t)for(var r,i,s=this.entries,c=aU(t,"&"),d=0;d<c.length;)(r=c[d++]).length&&(i=aU(r,"="),Fl(s,{key:cU(qle(i)),value:cU(nU(i,"="))}))},serialize:function(){for(var t,r=this.entries,i=[],s=0;s<r.length;)t=r[s++],Fl(i,lU(t.key)+"="+lU(t.value));return nU(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var m0=function(){YM(this,sp);var t=ZM(this,new dU(arguments.length>0?arguments[0]:void 0));fg||(this.size=t.entries.length)},sp=m0.prototype;if(Ple(sp,{append:function(t,r){var i=bs(this);ip(arguments.length,2),Fl(i.entries,{key:ca(t),value:ca(r)}),fg||this.length++,i.updateURL()},delete:function(t){for(var r=bs(this),i=ip(arguments.length,1),s=r.entries,c=ca(t),d=i<2?void 0:arguments[1],u=d===void 0?d:ca(d),f=0;f<s.length;){var g=s[f];if(g.key!==c||u!==void 0&&g.value!==u)f++;else if(iU(s,f,1),u!==void 0)break}fg||(this.size=s.length),r.updateURL()},get:function(t){var r=bs(this).entries;ip(arguments.length,1);for(var i=ca(t),s=0;s<r.length;s++)if(r[s].key===i)return r[s].value;return null},getAll:function(t){var r=bs(this).entries;ip(arguments.length,1);for(var i=ca(t),s=[],c=0;c<r.length;c++)r[c].key===i&&Fl(s,r[c].value);return s},has:function(t){for(var r=bs(this).entries,i=ip(arguments.length,1),s=ca(t),c=i<2?void 0:arguments[1],d=c===void 0?c:ca(c),u=0;u<r.length;){var f=r[u++];if(f.key===s&&(d===void 0||f.value===d))return!0}return!1},set:function(t,r){var i=bs(this);ip(arguments.length,1);for(var s,c=i.entries,d=!1,u=ca(t),f=ca(r),g=0;g<c.length;g++)(s=c[g]).key===u&&(d?iU(c,g--,1):(d=!0,s.value=f));d||Fl(c,{key:u,value:f}),fg||(this.size=c.length),i.updateURL()},sort:function(){var t=bs(this);Ble(t.entries,function(r,i){return r.key>i.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,i=bs(this).entries,s=jle(t,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)s((r=i[c++]).value,r.key,this)},keys:function(){return new nR(this,"keys")},values:function(){return new nR(this,"values")},entries:function(){return new nR(this,"entries")}},{enumerable:!0}),KM(sp,Wle,sp.entries,{}),KM(sp,"toString",function(){return bs(this).serialize()},{enumerable:!0}),fg&&Ile(sp,"size",{get:function(){return bs(this).entries.length},configurable:!0,enumerable:!0}),Dle(m0,ap),JC({global:!0,forced:!zM},{URLSearchParams:m0}),!zM&&eR(mg)){var ide=oo(tU.has),ade=oo(tU.set),uU=function(t){if(qM(t)){var r,i=t.body;if(Mle(i)===ap)return r=t.headers?new mg(t.headers):new mg,ide(r,"content-type")||ade(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Vle(t,{body:XM(0,ca(i)),headers:XM(0,r)})}return t};if(eR(eU)&&JC({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return eU(t,arguments.length>1?uU(arguments[1]):{})}}),eR(p0)){var rR=function(t){return YM(this,tR),new p0(t,arguments.length>1?uU(arguments[1]):{})};tR.constructor=rR,rR.prototype=tR,JC({global:!0,dontCallGetSet:!0,forced:!0},{Request:rR})}}var Ss,sde={URLSearchParams:m0,getState:bs},ode=Qt.URLSearchParams,hU=ve,cde=x,lde=be,dde=p,iR=W_,ude=rg,hde=ae,pde=Qo,fde=it,op=Object.assign,pU=Object.defineProperty,mde=cde([].concat),gde=!op||dde(function(){if(hU&&op({b:1},op(pU({},"a",{enumerable:!0,get:function(){pU(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},i=Symbol("assign detection"),s="abcdefghijklmnopqrst";return t[i]=7,s.split("").forEach(function(c){r[c]=c}),op({},t)[i]!==7||iR(op({},r)).join("")!==s})?function(t,r){for(var i=pde(t),s=arguments.length,c=1,d=ude.f,u=hde.f;s>c;)for(var f,g=fde(arguments[c++]),v=d?mde(iR(g),d(g)):iR(g),_=v.length,S=0;_>S;)f=v[S++],hU&&!lde(u,g,f)||(i[f]=g[f]);return i}:op,vde=aa,yde=ZL,_de=ve,Ede=Es,bde=Ye,aR=function(t,r,i){_de?Ede.f(t,r,bde(0,i)):t[r]=i},Sde=Dl,wde=be,xde=Qo,Tde=function(t,r,i,s){try{return s?r(vde(i)[0],i[1]):r(i)}catch(c){yde(t,"throw",c)}},Cde=XL,Rde=n0,Ade=kl,fU=aR,Nde=rC,Ode=H_,mU=Array,au=x,sR=2147483647,Ide=/[^\0-\u007E]/,gU=/[.\u3002\uFF0E\uFF61]/g,vU="Overflow: input needs wider integers to process",yU=RangeError,Pde=au(gU.exec),cp=Math.floor,oR=String.fromCharCode,_U=au("".charCodeAt),EU=au([].join),Bl=au([].push),Dde=au("".replace),kde=au("".split),Lde=au("".toLowerCase),bU=function(t){return t+22+75*(t<26)},jde=function(t,r,i){var s=0;for(t=i?cp(t/700):t>>1,t+=cp(t/r);t>455;)t=cp(t/35),s+=36;return cp(s+36*t/(t+38))},Mde=function(t){var r=[];t=function(G){for(var K=[],X=0,te=G.length;X<te;){var ne=_U(G,X++);if(ne>=55296&&ne<=56319&&X<te){var Z=_U(G,X++);(64512&Z)==56320?Bl(K,((1023&ne)<<10)+(1023&Z)+65536):(Bl(K,ne),X--)}else Bl(K,ne)}return K}(t);var i,s,c=t.length,d=128,u=0,f=72;for(i=0;i<t.length;i++)(s=t[i])<128&&Bl(r,oR(s));var g=r.length,v=g;for(g&&Bl(r,"-");v<c;){var _=sR;for(i=0;i<t.length;i++)(s=t[i])>=d&&s<_&&(_=s);var S=v+1;if(_-d>cp((sR-u)/S))throw new yU(vU);for(u+=(_-d)*S,d=_,i=0;i<t.length;i++){if((s=t[i])<d&&++u>sR)throw new yU(vU);if(s===d){for(var w=u,C=36;;){var M=C<=f?1:C>=f+26?26:C-f;if(w<M)break;var I=w-M,k=36-M;Bl(r,oR(bU(M+I%k))),w=cp(I/k),C+=36}Bl(r,oR(bU(w))),f=jde(u,S,v===g),u=0,v++}}u++,d++}return EU(r,"")},Ude=zt,cR=ve,Vde=d0,lR=N,SU=Dl,ws=x,g0=jl,xs=t0,Fde=fC,dR=Xr,uR=gde,lp=function(t){var r=xde(t),i=Rde(this),s=arguments.length,c=s>1?arguments[1]:void 0,d=c!==void 0;d&&(c=Sde(c,s>2?arguments[2]:void 0));var u,f,g,v,_,S,w=Ode(r),C=0;if(!w||this===mU&&Cde(w))for(u=Ade(r),f=i?new this(u):mU(u);u>C;C++)S=d?c(r[C],C):r[C],fU(f,C,S);else for(f=i?new this:[],_=(v=Nde(r,w)).next;!(g=wde(_,v)).done;C++)S=d?Tde(v,c,[g.value,C],!0):g.value,fU(f,C,S);return f.length=C,f},co=Ml,Bde=HC.codeAt,Wde=function(t){var r,i,s=[],c=kde(Dde(Lde(t),gU,"."),".");for(r=0;r<c.length;r++)i=c[r],Bl(s,Pde(Ide,i)?"xn--"+Mde(i):i);return EU(s,".")},Bc=sa,Gde=Fc,$de=nu,wU=sde,xU=tu,Hde=xU.set,v0=xU.getterFor("URL"),zde=wU.URLSearchParams,Kde=wU.getState,gg=lR.URL,hR=lR.TypeError,y0=lR.parseInt,Yde=Math.floor,TU=Math.pow,Ts=ws("".charAt),lo=ws(/./.exec),vg=ws([].join),qde=ws(1.1.toString),Xde=ws([].pop),dp=ws([].push),pR=ws("".replace),Jde=ws([].shift),Qde=ws("".split),yg=ws("".slice),_0=ws("".toLowerCase),Zde=ws([].unshift),fR="Invalid scheme",su="Invalid host",CU="Invalid port",RU=/[a-z]/i,eue=/[\d+-.a-z]/i,mR=/\d/,tue=/^0x/i,nue=/^[0-7]+$/,rue=/^\d+$/,AU=/^[\da-f]+$/i,iue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,aue=/[\0\t\n\r #/:<>?@[\\\]^|]/,sue=/^[\u0000-\u0020]+/,oue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,cue=/[\t\n\r]/g,_g=function(t){var r,i,s,c;if(typeof t=="number"){for(r=[],i=0;i<4;i++)Zde(r,t%256),t=Yde(t/256);return vg(r,".")}if(typeof t=="object"){for(r="",s=function(d){for(var u=null,f=1,g=null,v=0,_=0;_<8;_++)d[_]!==0?(v>f&&(u=g,f=v),g=null,v=0):(g===null&&(g=_),++v);return v>f?g:u}(t),i=0;i<8;i++)c&&t[i]===0||(c&&(c=!1),s===i?(r+=i?":":"::",c=!0):(r+=qde(t[i],16),i<7&&(r+=":")));return"["+r+"]"}return t},E0={},NU=uR({},E0,{" ":1,'"':1,"<":1,">":1,"`":1}),OU=uR({},NU,{"#":1,"?":1,"{":1,"}":1}),gR=uR({},OU,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Wl=function(t,r){var i=Bde(t,0);return i>32&&i<127&&!dR(r,t)?t:encodeURIComponent(t)},b0={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Eg=function(t,r){var i;return t.length===2&&lo(RU,Ts(t,0))&&((i=Ts(t,1))===":"||!r&&i==="|")},IU=function(t){var r;return t.length>1&&Eg(yg(t,0,2))&&(t.length===2||(r=Ts(t,2))==="/"||r==="\\"||r==="?"||r==="#")},lue=function(t){return t==="."||_0(t)==="%2e"},vR={},PU={},yR={},DU={},kU={},_R={},LU={},jU={},S0={},w0={},ER={},bR={},SR={},wR={},MU={},xR={},up={},tc={},UU={},ou={},Wc={},TR=function(t,r,i){var s,c,d,u=Bc(t);if(r){if(c=this.parse(u))throw new hR(c);this.searchParams=null}else{if(i!==void 0&&(s=new TR(i,!0)),c=this.parse(u,null,s))throw new hR(c);(d=Kde(new zde)).bindURL(this),this.searchParams=d}};TR.prototype={type:"URL",parse:function(t,r,i){var s,c,d,u,f,g=this,v=r||vR,_=0,S="",w=!1,C=!1,M=!1;for(t=Bc(t),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,t=pR(t,sue,""),t=pR(t,oue,"$1")),t=pR(t,cue,""),s=lp(t);_<=s.length;){switch(c=s[_],v){case vR:if(!c||!lo(RU,c)){if(r)return fR;v=yR;continue}S+=_0(c),v=PU;break;case PU:if(c&&(lo(eue,c)||c==="+"||c==="-"||c==="."))S+=_0(c);else{if(c!==":"){if(r)return fR;S="",v=yR,_=0;continue}if(r&&(g.isSpecial()!==dR(b0,S)||S==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=S,r)return void(g.isSpecial()&&b0[g.scheme]===g.port&&(g.port=null));S="",g.scheme==="file"?v=wR:g.isSpecial()&&i&&i.scheme===g.scheme?v=DU:g.isSpecial()?v=jU:s[_+1]==="/"?(v=kU,_++):(g.cannotBeABaseURL=!0,dp(g.path,""),v=UU)}break;case yR:if(!i||i.cannotBeABaseURL&&c!=="#")return fR;if(i.cannotBeABaseURL&&c==="#"){g.scheme=i.scheme,g.path=co(i.path),g.query=i.query,g.fragment="",g.cannotBeABaseURL=!0,v=Wc;break}v=i.scheme==="file"?wR:_R;continue;case DU:if(c!=="/"||s[_+1]!=="/"){v=_R;continue}v=S0,_++;break;case kU:if(c==="/"){v=w0;break}v=tc;continue;case _R:if(g.scheme=i.scheme,c===Ss)g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=co(i.path),g.query=i.query;else if(c==="/"||c==="\\"&&g.isSpecial())v=LU;else if(c==="?")g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=co(i.path),g.query="",v=ou;else{if(c!=="#"){g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=co(i.path),g.path.length--,v=tc;continue}g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=co(i.path),g.query=i.query,g.fragment="",v=Wc}break;case LU:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,v=tc;continue}v=w0}else v=S0;break;case jU:if(v=S0,c!=="/"||Ts(S,_+1)!=="/")continue;_++;break;case S0:if(c!=="/"&&c!=="\\"){v=w0;continue}break;case w0:if(c==="@"){w&&(S="%40"+S),w=!0,d=lp(S);for(var I=0;I<d.length;I++){var k=d[I];if(k!==":"||M){var G=Wl(k,gR);M?g.password+=G:g.username+=G}else M=!0}S=""}else if(c===Ss||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(w&&S==="")return"Invalid authority";_-=lp(S).length+1,S="",v=ER}else S+=c;break;case ER:case bR:if(r&&g.scheme==="file"){v=xR;continue}if(c!==":"||C){if(c===Ss||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&S==="")return su;if(r&&S===""&&(g.includesCredentials()||g.port!==null))return;if(u=g.parseHost(S))return u;if(S="",v=up,r)return;continue}c==="["?C=!0:c==="]"&&(C=!1),S+=c}else{if(S==="")return su;if(u=g.parseHost(S))return u;if(S="",v=SR,r===bR)return}break;case SR:if(!lo(mR,c)){if(c===Ss||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(S!==""){var K=y0(S,10);if(K>65535)return CU;g.port=g.isSpecial()&&K===b0[g.scheme]?null:K,S=""}if(r)return;v=up;continue}return CU}S+=c;break;case wR:if(g.scheme="file",c==="/"||c==="\\")v=MU;else{if(!i||i.scheme!=="file"){v=tc;continue}switch(c){case Ss:g.host=i.host,g.path=co(i.path),g.query=i.query;break;case"?":g.host=i.host,g.path=co(i.path),g.query="",v=ou;break;case"#":g.host=i.host,g.path=co(i.path),g.query=i.query,g.fragment="",v=Wc;break;default:IU(vg(co(s,_),""))||(g.host=i.host,g.path=co(i.path),g.shortenPath()),v=tc;continue}}break;case MU:if(c==="/"||c==="\\"){v=xR;break}i&&i.scheme==="file"&&!IU(vg(co(s,_),""))&&(Eg(i.path[0],!0)?dp(g.path,i.path[0]):g.host=i.host),v=tc;continue;case xR:if(c===Ss||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&Eg(S))v=tc;else if(S===""){if(g.host="",r)return;v=up}else{if(u=g.parseHost(S))return u;if(g.host==="localhost"&&(g.host=""),r)return;S="",v=up}continue}S+=c;break;case up:if(g.isSpecial()){if(v=tc,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Ss&&(v=tc,c!=="/"))continue}else g.fragment="",v=Wc;else g.query="",v=ou;break;case tc:if(c===Ss||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((f=_0(f=S))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||dp(g.path,"")):lue(S)?c==="/"||c==="\\"&&g.isSpecial()||dp(g.path,""):(g.scheme==="file"&&!g.path.length&&Eg(S)&&(g.host&&(g.host=""),S=Ts(S,0)+":"),dp(g.path,S)),S="",g.scheme==="file"&&(c===Ss||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)Jde(g.path);c==="?"?(g.query="",v=ou):c==="#"&&(g.fragment="",v=Wc)}else S+=Wl(c,OU);break;case UU:c==="?"?(g.query="",v=ou):c==="#"?(g.fragment="",v=Wc):c!==Ss&&(g.path[0]+=Wl(c,E0));break;case ou:r||c!=="#"?c!==Ss&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":Wl(c,E0)):(g.fragment="",v=Wc);break;case Wc:c!==Ss&&(g.fragment+=Wl(c,NU))}_++}},parseHost:function(t){var r,i,s;if(Ts(t,0)==="["){if(Ts(t,t.length-1)!=="]"||(r=function(c){var d,u,f,g,v,_,S,w=[0,0,0,0,0,0,0,0],C=0,M=null,I=0,k=function(){return Ts(c,I)};if(k()===":"){if(Ts(c,1)!==":")return;I+=2,M=++C}for(;k();){if(C===8)return;if(k()!==":"){for(d=u=0;u<4&&lo(AU,k());)d=16*d+y0(k(),16),I++,u++;if(k()==="."){if(u===0||(I-=u,C>6))return;for(f=0;k();){if(g=null,f>0){if(!(k()==="."&&f<4))return;I++}if(!lo(mR,k()))return;for(;lo(mR,k());){if(v=y0(k(),10),g===null)g=v;else{if(g===0)return;g=10*g+v}if(g>255)return;I++}w[C]=256*w[C]+g,++f!=2&&f!==4||C++}if(f!==4)return;break}if(k()===":"){if(I++,!k())return}else if(k())return;w[C++]=d}else{if(M!==null)return;I++,M=++C}}if(M!==null)for(_=C-M,C=7;C!==0&&_>0;)S=w[C],w[C--]=w[M+_-1],w[M+--_]=S;else if(C!==8)return;return w}(yg(t,1,-1)),!r))return su;this.host=r}else if(this.isSpecial()){if(t=Wde(t),lo(iue,t)||(r=function(c){var d,u,f,g,v,_,S,w=Qde(c,".");if(w.length&&w[w.length-1]===""&&w.length--,(d=w.length)>4)return c;for(u=[],f=0;f<d;f++){if((g=w[f])==="")return c;if(v=10,g.length>1&&Ts(g,0)==="0"&&(v=lo(tue,g)?16:8,g=yg(g,v===8?1:2)),g==="")_=0;else{if(!lo(v===10?rue:v===8?nue:AU,g))return c;_=y0(g,v)}dp(u,_)}for(f=0;f<d;f++)if(_=u[f],f===d-1){if(_>=TU(256,5-d))return null}else if(_>255)return null;for(S=Xde(u),f=0;f<u.length;f++)S+=u[f]*TU(256,3-f);return S}(t),r===null))return su;this.host=r}else{if(lo(aue,t))return su;for(r="",i=lp(t),s=0;s<i.length;s++)r+=Wl(i[s],E0);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return dR(b0,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme==="file"&&r===1&&Eg(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,i=t.username,s=t.password,c=t.host,d=t.port,u=t.path,f=t.query,g=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=i+(s?":"+s:"")+"@"),v+=_g(c),d!==null&&(v+=":"+d)):r==="file"&&(v+="//"),v+=t.cannotBeABaseURL?u[0]:u.length?"/"+vg(u,"/"):"",f!==null&&(v+="?"+f),g!==null&&(v+="#"+g),v},setHref:function(t){var r=this.parse(t);if(r)throw new hR(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t==="blob")try{return new hp(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+_g(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Bc(t)+":",vR)},getUsername:function(){return this.username},setUsername:function(t){var r=lp(Bc(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=Wl(r[i],gR)}},getPassword:function(){return this.password},setPassword:function(t){var r=lp(Bc(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=Wl(r[i],gR)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?_g(t):_g(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,ER)},getHostname:function(){var t=this.host;return t===null?"":_g(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,bR)},getPort:function(){var t=this.port;return t===null?"":Bc(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Bc(t))===""?this.port=null:this.parse(t,SR))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+vg(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,up))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Bc(t))===""?this.query=null:(Ts(t,0)==="?"&&(t=yg(t,1)),this.query="",this.parse(t,ou)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Bc(t))!==""?(Ts(t,0)==="#"&&(t=yg(t,1)),this.fragment="",this.parse(t,Wc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var hp=function(t){var r=Fde(this,la),i=$de(arguments.length,1)>1?arguments[1]:void 0,s=Hde(r,new TR(t,!1,i));cR||(r.href=s.serialize(),r.origin=s.getOrigin(),r.protocol=s.getProtocol(),r.username=s.getUsername(),r.password=s.getPassword(),r.host=s.getHost(),r.hostname=s.getHostname(),r.port=s.getPort(),r.pathname=s.getPathname(),r.search=s.getSearch(),r.searchParams=s.getSearchParams(),r.hash=s.getHash())},la=hp.prototype,Cs=function(t,r){return{get:function(){return v0(this)[t]()},set:r&&function(i){return v0(this)[r](i)},configurable:!0,enumerable:!0}};if(cR&&(xs(la,"href",Cs("serialize","setHref")),xs(la,"origin",Cs("getOrigin")),xs(la,"protocol",Cs("getProtocol","setProtocol")),xs(la,"username",Cs("getUsername","setUsername")),xs(la,"password",Cs("getPassword","setPassword")),xs(la,"host",Cs("getHost","setHost")),xs(la,"hostname",Cs("getHostname","setHostname")),xs(la,"port",Cs("getPort","setPort")),xs(la,"pathname",Cs("getPathname","setPathname")),xs(la,"search",Cs("getSearch","setSearch")),xs(la,"searchParams",Cs("getSearchParams")),xs(la,"hash",Cs("getHash","setHash"))),g0(la,"toJSON",function(){return v0(this).serialize()},{enumerable:!0}),g0(la,"toString",function(){return v0(this).serialize()},{enumerable:!0}),gg){var VU=gg.createObjectURL,FU=gg.revokeObjectURL;VU&&g0(hp,"createObjectURL",SU(VU,gg)),FU&&g0(hp,"revokeObjectURL",SU(FU,gg))}Gde(hp,"URL"),Ude({global:!0,forced:!Vde,sham:!cR},{URL:hp});var due=zt,BU=p,uue=nu,WU=sa,hue=d0,CR=Je("URL"),pue=hue&&BU(function(){CR.canParse()}),fue=BU(function(){return CR.canParse.length!==1});due({target:"URL",stat:!0,forced:!pue||fue},{canParse:function(t){var r=uue(arguments.length,1),i=WU(t),s=r<2||arguments[1]===void 0?void 0:WU(arguments[1]);try{return!!new CR(i,s)}catch{return!1}}});var mue=zt,gue=nu,GU=sa,vue=d0,yue=Je("URL");mue({target:"URL",stat:!0,forced:!vue},{parse:function(t){var r=gue(arguments.length,1),i=GU(t),s=r<2||arguments[1]===void 0?void 0:GU(arguments[1]);try{return new yue(i,s)}catch{return null}}});var x0=l(Qt.URL);let $U=!0,HU=!0;function T0(t,r,i){const s=t.match(r);return s&&s.length>=i&&parseInt(s[i],10)}function cu(t,r,i){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(u,f){if(u!==r)return c.apply(this,arguments);const g=v=>{const _=i(v);_&&(f.handleEvent?f.handleEvent(_):f(_))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(f,g),c.apply(this,[u,g])};const d=s.removeEventListener;s.removeEventListener=function(u,f){if(u!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(f))return d.apply(this,arguments);const g=this._eventMap[r].get(f);return this._eventMap[r].delete(f),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[u,g])},Object.defineProperty(s,"on"+r,{get(){return this["_on"+r]},set(u){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),u&&this.addEventListener(r,this["_on"+r]=u)},enumerable:!0,configurable:!0})}function _ue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):($U=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Eue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(HU=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function zU(){if(typeof window=="object"){if($U)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function RR(t,r){HU&&console.warn(t+" is deprecated, please use "+r+" instead.")}function KU(t){return Object.prototype.toString.call(t)==="[object Object]"}function YU(t){var r;return KU(t)?qa(r=Object.keys(t)).call(r,function(i,s){const c=KU(t[s]),d=c?YU(t[s]):t[s],u=c&&!Object.keys(d).length;return d===void 0||u?i:Object.assign(i,{[s]:d})},{}):t}function AR(t,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(s=>{s.endsWith("Id")?AR(t,t.get(r[s]),i):s.endsWith("Ids")&&r[s].forEach(c=>{AR(t,t.get(c),i)})}))}function qU(t,r,i){const s=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach(u=>{u.type==="track"&&u.trackIdentifier===r.id&&d.push(u)}),d.forEach(u=>{t.forEach(f=>{f.type===s&&f.trackId===u.id&&AR(t,f,c)})}),c}const XU=zU;function JU(t,r){const i=t&&t.navigator;if(!i.mediaDevices)return;const s=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const f={};return Object.keys(u).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const v=typeof u[g]=="object"?u[g]:{ideal:u[g]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const _=function(S,w){return S?S+w.charAt(0).toUpperCase()+w.slice(1):w==="deviceId"?"sourceId":w};if(v.ideal!==void 0){f.optional=f.optional||[];let S={};typeof v.ideal=="number"?(S[_("min",g)]=v.ideal,f.optional.push(S),S={},S[_("max",g)]=v.ideal,f.optional.push(S)):(S[_("",g)]=v.ideal,f.optional.push(S))}v.exact!==void 0&&typeof v.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[_("",g)]=v.exact):["min","max"].forEach(S=>{v[S]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[_(S,g)]=v[S])})}),u.advanced&&(f.optional=(f.optional||[]).concat(u.advanced)),f},c=function(u,f){if(r.version>=61)return f(u);if((u=JSON.parse(JSON.stringify(u)))&&typeof u.audio=="object"){const g=function(v,_,S){_ in v&&!(S in v)&&(v[S]=v[_],delete v[_])};g((u=JSON.parse(JSON.stringify(u))).audio,"autoGainControl","googAutoGainControl"),g(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=s(u.audio)}if(u&&typeof u.video=="object"){let g=u.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const v=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||v)){let _;if(delete u.video.facingMode,g.exact==="environment"||g.ideal==="environment"?_=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(_=["front"]),_)return i.mediaDevices.enumerateDevices().then(S=>{S=S.filter(C=>C.kind==="videoinput");let w=S.find(C=>_.some(M=>{var I;return xe(I=C.label.toLowerCase()).call(I,M)}));return!w&&S.length&&xe(_).call(_,"back")&&(w=S[S.length-1]),w&&(u.video.deviceId=g.exact?{exact:w.deviceId}:{ideal:w.deviceId}),u.video=s(u.video),XU("chrome: "+JSON.stringify(u)),f(u)})}u.video=s(u.video)}return XU("chrome: "+JSON.stringify(u)),f(u)},d=function(u){return r.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(u,f,g){c(u,v=>{i.webkitGetUserMedia(v,f,_=>{g&&g(d(_))})})}).bind(i),i.mediaDevices.getUserMedia){const u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(f){return c(f,g=>u(g).then(v=>{if(g.audio&&!v.getAudioTracks().length||g.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return v},v=>Ie.reject(d(v))))}}}function QU(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function ZU(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===s.track.id):{track:s.track};const d=new Event("track");d.track=s.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[i.stream],this.dispatchEvent(d)}),i.stream.getTracks().forEach(s=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===s.id):{track:s};const d=new Event("track");d.track=s,d.receiver=c,d.transceiver={receiver:c},d.streams=[i.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else cu(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function eV(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,f){let g=c.apply(this,arguments);return g||(g=r(this,u),this._senders.push(g)),g};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){d.apply(this,arguments);const f=this._senders.indexOf(u);f!==-1&&this._senders.splice(f,1)}}const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{const u=this._senders.find(f=>f.track===d);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function tV(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,s,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const d=function(f){const g={};return f.result().forEach(v=>{const _={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(S=>{_[S]=v.stat(S)}),g[_.id]=_}),g},u=function(f){return new Map(Object.keys(f).map(g=>[g,f[g]]))};if(arguments.length>=2){const f=function(g){s(u(d(g)))};return r.apply(this,[f,i])}return new Ie((f,g)=>{r.apply(this,[function(v){f(u(d(v)))},g])}).then(s,c)}}function nV(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(d=>d._pc=this),c});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>qU(d,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s}),cu(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>qU(c,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let s,c,d;return this.getSenders().forEach(u=>{u.track===i&&(s?d=!0:s=u)}),this.getReceivers().forEach(u=>(u.track===i&&(c?d=!0:c=u),u.track===i)),d||s&&c?Ie.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():Ie.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function rV(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,u){if(!u)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=r.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(f)===-1&&this._shimmedLocalStreams[u.id].push(f):this._shimmedLocalStreams[u.id]=[u,f],f};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(g=>{if(this.getSenders().find(_=>_.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();i.apply(this,arguments);const f=this.getSenders().filter(g=>u.indexOf(g)===-1);this._shimmedLocalStreams[d.id]=[d].concat(f)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],s.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const f=this._shimmedLocalStreams[u].indexOf(d);f!==-1&&this._shimmedLocalStreams[u].splice(f,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),c.apply(this,arguments)}}function iV(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return rV(t);const i=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(v=>this._reverseStreams[v.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(v=>{if(this.getSenders().find(S=>S.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const v=new t.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}s.apply(this,[g])};const c=t.RTCPeerConnection.prototype.removeStream;function d(g,v){let _=v.sdp;return Object.keys(g._reverseStreams||[]).forEach(S=>{const w=g._reverseStreams[S],C=g._streams[w.id];_=_.replace(new RegExp(C.id,"g"),w.id)}),new RTCSessionDescription({type:v.type,sdp:_})}t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(C=>C===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const w=this._streams[v.id];if(w)w.addTrack(g),Ie.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new t.MediaStream([g]);this._streams[v.id]=C,this._reverseStreams[C.id]=v,this.addStream(C)}return this.getSenders().find(C=>C.track===g)},["createOffer","createAnswer"].forEach(function(g){const v=t.RTCPeerConnection.prototype[g],_={[g](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[w=>{const C=d(this,w);S[0].apply(null,[C])},w=>{S[1]&&S[1].apply(null,w)},arguments[2]]):v.apply(this,arguments).then(w=>d(this,w))}};t.RTCPeerConnection.prototype[g]=_[g]});const u=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(g,v){let _=v.sdp;return Object.keys(g._reverseStreams||[]).forEach(S=>{const w=g._reverseStreams[S],C=g._streams[w.id];_=_.replace(new RegExp(w.id,"g"),C.id)}),new RTCSessionDescription({type:v.type,sdp:_})}(this,arguments[0]),u.apply(this,arguments)):u.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const g=f.get.apply(this);return g.type===""?g:d(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(S=>g.track===S)&&(v=this._streams[_])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function NR(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=c[i]})}function aV(t,r){cu(t,"negotiationneeded",i=>{const s=i.target;if(!(r.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return i})}var sV=Object.freeze({__proto__:null,fixNegotiationNeeded:aV,shimAddTrackRemoveTrack:iV,shimAddTrackRemoveTrackWithNative:rV,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(s=>{const c=i.video&&i.video.width,d=i.video&&i.video.height,u=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:u||3}},c&&(i.video.mandatory.maxWidth=c),d&&(i.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:eV,shimGetStats:tV,shimGetUserMedia:JU,shimMediaStream:QU,shimOnTrack:ZU,shimPeerConnection:NR,shimSenderReceiverGetStats:nV});function oV(t,r){const i=t&&t.navigator,s=t&&t.MediaStreamTrack;if(i.getUserMedia=function(c,d,u){RR("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(d,u)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(u,f,g){f in u&&!(g in u)&&(u[g]=u[f],delete u[f])},d=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),c(u.audio,"autoGainControl","mozAutoGainControl"),c(u.audio,"noiseSuppression","mozNoiseSuppression")),d(u)},s&&s.prototype.getSettings){const u=s.prototype.getSettings;s.prototype.getSettings=function(){const f=u.apply(this,arguments);return c(f,"mozAutoGainControl","autoGainControl"),c(f,"mozNoiseSuppression","noiseSuppression"),f}}if(s&&s.prototype.applyConstraints){const u=s.prototype.applyConstraints;s.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f,"autoGainControl","mozAutoGainControl"),c(f,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[f])}}}}function cV(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function OR(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=t.RTCPeerConnection.prototype[c],u={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=u[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,u]=arguments;return s.apply(this,[c||null]).then(f=>{if(r.version<53&&!d)try{f.forEach(g=>{g.type=i[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;f.forEach((v,_)=>{f.set(_,Object.assign({},v,{type:i[v.type]||v.type}))})}return f}).then(d,u)}}function lV(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(c=>c._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ie.resolve(new Map)}}function dV(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i}),cu(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function uV(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){RR("removeStream","removeTrack"),this.getSenders().forEach(i=>{var s;i.track&&xe(s=r.getTracks()).call(s,i.track)&&this.removeTrack(i)})})}function hV(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function pV(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(s){const{sender:d}=c,u=d.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=i,d.sendEncodings=i,this.setParametersPromises.push(d.setParameters(u).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function fV(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function mV(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ie.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function gV(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ie.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var vV=Object.freeze({__proto__:null,shimAddTransceiver:pV,shimCreateAnswer:gV,shimCreateOffer:mV,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Ie.reject(s)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:fV,shimGetUserMedia:oV,shimOnTrack:cV,shimPeerConnection:OR,shimRTCDataChannel:hV,shimReceiverGetStats:dV,shimRemoveStream:uV,shimSenderGetStats:lV});function yV(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){var s;this._localStreams||(this._localStreams=[]),xe(s=this._localStreams).call(s,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];return c&&c.forEach(u=>{var f;this._localStreams?xe(f=this._localStreams).call(f,u)||this._localStreams.push(u):this._localStreams=[u]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const s=r.getTracks();this.getSenders().forEach(c=>{xe(s).call(s,c.track)&&this.removeTrack(c)})})}}function _V(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),xe(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,this.dispatchEvent(u)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,i.dispatchEvent(d)})}),r.apply(i,arguments)}}}function EV(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.createOffer,s=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,u=r.addIceCandidate;r.createOffer=function(g,v){const _=arguments.length>=2?arguments[2]:arguments[0],S=i.apply(this,[_]);return v?(S.then(g,v),Ie.resolve()):S},r.createAnswer=function(g,v){const _=arguments.length>=2?arguments[2]:arguments[0],S=s.apply(this,[_]);return v?(S.then(g,v),Ie.resolve()):S};let f=function(g,v,_){const S=c.apply(this,[g]);return _?(S.then(v,_),Ie.resolve()):S};r.setLocalDescription=f,f=function(g,v,_){const S=d.apply(this,[g]);return _?(S.then(v,_),Ie.resolve()):S},r.setRemoteDescription=f,f=function(g,v,_){const S=u.apply(this,[g]);return _?(S.then(v,_),Ie.resolve()):S},r.addIceCandidate=f}function bV(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,s=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>s(SV(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,s,c){r.mediaDevices.getUserMedia(i).then(s,c)}).bind(r))}function SV(t){return t&&t.video!==void 0?Object.assign({},t,{video:YU(t.video)}):t}function wV(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const c=[];for(let d=0;d<i.iceServers.length;d++){let u=i.iceServers[d];!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(RR("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,c.push(u)):c.push(i.iceServers[d])}i.iceServers=c}return new r(i,s)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function xV(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function TV(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function CV(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var RV=Object.freeze({__proto__:null,shimAudioContext:CV,shimCallbacksAPI:EV,shimConstraints:SV,shimCreateOfferLegacy:TV,shimGetUserMedia:bV,shimLocalStreamsAPI:yV,shimRTCIceServerUrls:wV,shimRemoteStreamsAPI:_V,shimTrackEventTransceiver:xV}),AV=`	
\v\f\r \u2028\u2029\uFEFF`,bue=St,Sue=sa,IR=AV,NV=x("".replace),wue=RegExp("^["+IR+"]+"),xue=RegExp("(^|[^"+IR+"])["+IR+"]+$"),Tue=function(t){return function(r){var i=Sue(bue(r));return 1&t&&(i=NV(i,wue,"")),2&t&&(i=NV(i,xue,"$1")),i}},Cue={trim:Tue(3)},Rue=uj.PROPER,Aue=p,OV=AV,Nue=Cue.trim;zt({target:"String",proto:!0,forced:function(t){return Aue(function(){return!!OV[t]()||""[t]()!==""||Rue&&OV[t].name!==t})}("trim")},{trim:function(){return Nue(this)}});var Oue=Ya("String","trim"),Iue=A,Pue=Oue,PR=String.prototype,Due=function(t){var r=t.trim;return typeof t=="string"||t===PR||Iue(PR,t)&&r===PR.trim?Pue:r},mi=l(Due),IV={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(s=>s.trim())},r.splitSections=function(i){return i.split(`
m=`).map((s,c)=>(c>0?"m="+s:s).trim()+`\r
`)},r.getDescription=function(i){const s=r.splitSections(i);return s&&s[0]},r.getMediaSections=function(i){const s=r.splitSections(i);return s.shift(),s},r.matchPrefix=function(i,s){return r.splitLines(i).filter(c=>c.indexOf(s)===0)},r.parseCandidate=function(i){let s;s=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let d=8;d<s.length;d+=2)switch(s[d]){case"raddr":c.relatedAddress=s[d+1];break;case"rport":c.relatedPort=parseInt(s[d+1],10);break;case"tcptype":c.tcpType=s[d+1];break;case"ufrag":c.ufrag=s[d+1],c.usernameFragment=s[d+1];break;default:c[s[d]]===void 0&&(c[s[d]]=s[d+1])}return c},r.writeCandidate=function(i){const s=[];s.push(i.foundation);const c=i.component;c==="rtp"?s.push(1):c==="rtcp"?s.push(2):s.push(c),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const d=i.type;return s.push("typ"),s.push(d),d!=="host"&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let s=i.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=s.length===3?parseInt(s[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let s=i.payloadType;i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const s=i.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const s={};let c;const d=i.substring(i.indexOf(" ")+1).split(";");for(let u=0;u<d.length;u++)c=d[u].trim().split("="),s[c[0].trim()]=c[1];return s},r.writeFmtp=function(i){let s="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const d=[];Object.keys(i.parameters).forEach(u=>{i.parameters[u]!==void 0?d.push(u+"="+i.parameters[u]):d.push(u)}),s+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return s},r.parseRtcpFb=function(i){const s=i.substring(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},r.writeRtcpFb=function(i){let s="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(d=>{s+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),s},r.parseSsrcMedia=function(i){const s=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,s),10)},d=i.indexOf(":",s);return d>-1?(c.attribute=i.substring(s+1,d),c.value=i.substring(d+1)):c.attribute=i.substring(s+1),c},r.parseSsrcGroup=function(i){const s=i.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},r.getMid=function(i){const s=r.matchPrefix(i,"a=mid:")[0];if(s)return s.substring(6)},r.parseFingerprint=function(i){const s=i.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},r.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:r.matchPrefix(i+s,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,s){let c="a=setup:"+s+`\r
`;return i.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},r.parseCryptoLine=function(i){const s=i.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const s=i.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,s){return r.matchPrefix(i+s,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,s){const c=r.matchPrefix(i+s,"a=ice-ufrag:")[0],d=r.matchPrefix(i+s,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(s+=`a=ice-lite\r
`),s},r.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");s.profile=c[2];for(let u=3;u<c.length;u++){const f=c[u],g=r.matchPrefix(i,"a=rtpmap:"+f+" ")[0];if(g){const v=r.parseRtpMap(g),_=r.matchPrefix(i,"a=fmtp:"+f+" ");switch(v.parameters=_.length?r.parseFmtp(_[0]):{},v.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+f+" ").map(r.parseRtcpFb),s.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(u=>{s.headerExtensions.push(r.parseExtmap(u))});const d=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return s.codecs.forEach(u=>{d.forEach(f=>{u.rtcpFeedback.find(g=>g.type===f.type&&g.parameter===f.parameter)||u.rtcpFeedback.push(f)})}),s},r.writeRtpDescription=function(i,s){let c="";c+="m="+i+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(u=>{c+=r.writeRtpMap(u),c+=r.writeFmtp(u),c+=r.writeRtcpFb(u)});let d=0;return s.codecs.forEach(u=>{u.maxptime>d&&(d=u.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(u=>{c+=r.writeExtmap(u)}),c},r.parseRtpEncodingParameters=function(i){const s=[],c=r.parseRtpParameters(i),d=c.fecMechanisms.indexOf("RED")!==-1,u=c.fecMechanisms.indexOf("ULPFEC")!==-1,f=r.matchPrefix(i,"a=ssrc:").map(w=>r.parseSsrcMedia(w)).filter(w=>w.attribute==="cname"),g=f.length>0&&f[0].ssrc;let v;const _=r.matchPrefix(i,"a=ssrc-group:FID").map(w=>w.substring(17).split(" ").map(C=>parseInt(C,10)));_.length>0&&_[0].length>1&&_[0][0]===g&&(v=_[0][1]),c.codecs.forEach(w=>{if(w.name.toUpperCase()==="RTX"&&w.parameters.apt){let C={ssrc:g,codecPayloadType:parseInt(w.parameters.apt,10)};g&&v&&(C.rtx={ssrc:v}),s.push(C),d&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:g,mechanism:u?"red+ulpfec":"red"},s.push(C))}}),s.length===0&&g&&s.push({ssrc:g});let S=r.matchPrefix(i,"b=");return S.length&&(S=S[0].indexOf("b=TIAS:")===0?parseInt(S[0].substring(7),10):S[0].indexOf("b=AS:")===0?1e3*parseInt(S[0].substring(5),10)*.95-16e3:void 0,s.forEach(w=>{w.maxBitrate=S})),s},r.parseRtcpParameters=function(i){const s={},c=r.matchPrefix(i,"a=ssrc:").map(f=>r.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const d=r.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=d.length>0,s.compound=d.length===0;const u=r.matchPrefix(i,"a=rtcp-mux");return s.mux=u.length>0,s},r.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+=`a=rtcp-rsize\r
`),i.mux&&(s+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),s},r.parseMsid=function(i){let s;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const d=r.matchPrefix(i,"a=ssrc:").map(u=>r.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");return d.length>0?(s=d[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},r.parseSctpDescription=function(i){const s=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const u=r.matchPrefix(i,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:s.fmt,maxMessageSize:d};const f=r.matchPrefix(i,"a=sctpmap:");if(f.length>0){const g=f[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:d}}},r.writeSctpDescription=function(i,s){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&c.push("a=max-message-size:"+s.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,s,c){let d;const u=s!==void 0?s:2;return d=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,s){const c=r.splitLines(i);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return s?r.getDirection(s):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const s=r.splitLines(i)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},r.parseOLine=function(i){const s=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const s=r.splitLines(i);for(let c=0;c<s.length;c++)if(s[c].length<2||s[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(IV);var PV=IV.exports,pp=l(PV),kue=a({__proto__:null,default:pp},[PV]);function C0(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new r(i),c=pp.parseCandidate(i.candidate),d=Object.assign(s,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(i)},t.RTCIceCandidate.prototype=r.prototype,cu(t,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new t.RTCIceCandidate(i.candidate),writable:"false"}),i))}function DR(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||cu(t,"icecandidate",r=>{if(r.candidate){const i=pp.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function R0(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(f){if(!f||!f.sdp)return!1;const g=pp.splitSections(f.sdp);return g.shift(),g.some(v=>{const _=pp.parseMLine(v);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},s=function(f){const g=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const v=parseInt(g[1],10);return v!=v?-1:v},c=function(f){let g=65536;return r.browser==="firefox"&&(g=r.version<57?f===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},d=function(f,g){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const _=pp.matchPrefix(f.sdp,"a=max-message-size:");return _.length>0?v=parseInt(_[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(v=2147483637),v},u=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const f=s(arguments[0]),g=c(f),v=d(arguments[0],f);let _;_=g===0&&v===0?Number.POSITIVE_INFINITY:g===0||v===0?Math.max(g,v):Math.min(g,v);const S={};Object.defineProperty(S,"maxMessageSize",{get:()=>_}),this._sctp=S}return u.apply(this,arguments)}}function A0(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(s,c){const d=s.send;s.send=function(){const u=arguments[0],f=u.length||u.size||u.byteLength;if(s.readyState==="open"&&c.sctp&&f>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(s,arguments)}}const i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return r(s,this),s},cu(t,"datachannel",s=>(r(s.channel,s.target),s))}function kR(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const u=new Event("connectionstatechange",c);d.dispatchEvent(u)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function LR(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=s.sdp.split(`
`).filter(d=>mi(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return i.apply(this,arguments)}}function N0(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ie.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ie.resolve())})}function O0(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?i.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Lue=Object.freeze({__proto__:null,removeExtmapAllowMixed:LR,shimAddIceCandidateNullOrEmpty:N0,shimConnectionState:kR,shimMaxMessageSize:R0,shimParameterlessSetLocalDescription:O0,shimRTCIceCandidate:C0,shimRTCIceCandidateRelayProtocol:DR,shimSendThrowTypeError:A0});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=zU,s=function(d){const u={browser:null,version:null};if(d===void 0||!d.navigator)return u.browser="Not a browser.",u;const{navigator:f}=d;if(f.mozGetUserMedia)u.browser="firefox",u.version=T0(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)u.browser="chrome",u.version=T0(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return u.browser="Not a supported browser.",u;u.browser="safari",u.version=T0(f.userAgent,/AppleWebKit\/(\d+)\./,1),u.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return u}(t),c={browserDetails:s,commonShim:Lue,extractVersion:T0,disableLog:_ue,disableWarnings:Eue,sdp:kue};switch(s.browser){case"chrome":if(!sV||!NR||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(s.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=sV,N0(t,s),O0(t),JU(t,s),QU(t),NR(t,s),ZU(t),iV(t,s),eV(t),tV(t),nV(t),aV(t,s),C0(t),DR(t),kR(t),R0(t,s),A0(t),LR(t,s);break;case"firefox":if(!vV||!OR||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=vV,N0(t,s),O0(t),oV(t,s),OR(t,s),cV(t),uV(t),lV(t),dV(t),hV(t),pV(t),fV(t),mV(t),gV(t),C0(t),kR(t),R0(t,s),A0(t);break;case"safari":if(!RV||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=RV,N0(t,s),O0(t),wV(t),TV(t),EV(t),yV(t),_V(t),xV(t),bV(t),CV(t),C0(t),DR(t),R0(t,s),A0(t),LR(t,s);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var jue=p,DV=N.RegExp,Mue=!jue(function(){var t=!0;try{DV(".","d")}catch{t=!1}var r={},i="",s=t?"dgimsy":"gimsy",c=function(f,g){Object.defineProperty(r,f,{get:function(){return i+=g,!0}})},d={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var u in t&&(d.hasIndices="d"),d)c(u,d[u]);return Object.getOwnPropertyDescriptor(DV.prototype,"flags").get.call(r)!==s||i!==s}),Uue=aa,Vue=be,Fue=Xr,Bue=A,kV={correct:Mue},Wue=function(){var t=Uue(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},Gue=RegExp.prototype,jR=kV.correct?function(t){return t.flags}:function(t){return kV.correct||!Bue(Gue,t)||Fue(t,"flags")?t.flags:Vue(Wue,t)},MR=x,$ue=Math.floor,UR=MR("".charAt),Hue=MR("".replace),VR=MR("".slice),zue=/\$([$&'`]|\d{1,2})/g,Kue=zt,Yue=be,FR=x,LV=St,que=he,Xue=rt,Jue=WT,fp=sa,Que=Qm,Zue=jR,ehe=function(t,r,i,s,c,d){var u=i+t.length,f=s.length,g=zue;return Hue(d,g,function(v,_){var S;switch(UR(_,0)){case"$":return"$";case"&":return t;case"`":return VR(r,0,i);case"'":return VR(r,u);case"<":S=c[VR(_,1,-1)];break;default:var w=+_;if(w===0)return v;if(w>f){var C=$ue(w/10);return C===0?v:C<=f?s[C-1]===void 0?UR(_,1):s[C-1]+UR(_,1):v}S=s[w-1]}return S===void 0?"":S})},the=Yn("replace"),nhe=TypeError,BR=FR("".indexOf),rhe=FR("".replace),jV=FR("".slice),ihe=Math.max;Kue({target:"String",proto:!0},{replaceAll:function(t,r){var i,s,c,d,u,f,g,v,_,S,w=LV(this),C=0,M="";if(Xue(t)){if((i=Jue(t))&&(s=fp(LV(Zue(t))),!~BR(s,"g")))throw new nhe("`.replaceAll` does not allow non-global regexes");if(c=Que(t,the))return Yue(c,t,w,r);if(i)return rhe(fp(w),t,r)}for(d=fp(w),u=fp(t),(f=que(r))||(r=fp(r)),g=u.length,v=ihe(1,g),_=BR(d,u);_!==-1;)S=f?fp(r(u,_,d)):ehe(u,d,_,[],void 0,r),M+=jV(d,C,_)+S,C=_+g,_=_+v>d.length?-1:BR(d,u,_+v);return C<d.length&&(M+=jV(d,C)),M}});var ahe=Ya("String","replaceAll"),she=A,ohe=ahe,WR=String.prototype,che=function(t){var r=t.replaceAll;return typeof t=="string"||t===WR||she(WR,t)&&r===WR.replaceAll?ohe:r},lhe=l(che),GR=N;zt({global:!0,forced:GR.globalThis!==GR},{globalThis:GR});var MV=l(N),$R={exports:{}};(function(t,r){(function(i,s){var c="function",d="undefined",u="object",f="string",g="major",v="model",_="name",S="type",w="vendor",C="version",M="architecture",I="console",k="mobile",G="tablet",K="smarttv",X="wearable",te="embedded",ne="Amazon",Z="Apple",ie="ASUS",ge="BlackBerry",Ee="Browser",Me="Chrome",at="Firefox",tt="Google",mt="Honor",ht="Huawei",Wt="LG",En="Microsoft",ye="Motorola",Ne="Nvidia",Be="OnePlus",_e="Opera",O="OPPO",q="Samsung",ee="Sharp",Ce="Sony",lt="Xiaomi",dn="Zebra",fr="Facebook",ss="Chromium OS",ld="Mac OS",Ob=" Browser",df=function(Jn){for(var ir={},vn=0;vn<Jn.length;vn++)ir[Jn[vn].toUpperCase()]=Jn[vn];return ir},Ib=function(Jn,ir){return typeof Jn===f&&Hu(ir).indexOf(Hu(Jn))!==-1},Hu=function(Jn){return Jn.toLowerCase()},wv=function(Jn,ir){if(typeof Jn===f)return Jn=Jn.replace(/^\s\s*/,""),typeof ir===d?Jn:Jn.substring(0,500)},zu=function(Jn,ir){for(var vn,qi,Oo,Vn,el,Lt,Io=0;Io<ir.length&&!el;){var Ku=ir[Io],Ec=ir[Io+1];for(vn=qi=0;vn<Ku.length&&!el&&Ku[vn];)if(el=Ku[vn++].exec(Jn))for(Oo=0;Oo<Ec.length;Oo++)Lt=el[++qi],typeof(Vn=Ec[Oo])===u&&Vn.length>0?Vn.length===2?typeof Vn[1]==c?this[Vn[0]]=Vn[1].call(this,Lt):this[Vn[0]]=Vn[1]:Vn.length===3?typeof Vn[1]!==c||Vn[1].exec&&Vn[1].test?this[Vn[0]]=Lt?Lt.replace(Vn[1],Vn[2]):s:this[Vn[0]]=Lt?Vn[1].call(this,Lt,Vn[2]):s:Vn.length===4&&(this[Vn[0]]=Lt?Vn[3].call(this,Lt.replace(Vn[1],Vn[2])):s):this[Vn]=Lt||s;Io+=2}},dd=function(Jn,ir){for(var vn in ir)if(typeof ir[vn]===u&&ir[vn].length>0){for(var qi=0;qi<ir[vn].length;qi++)if(Ib(ir[vn][qi],Jn))return vn==="?"?s:vn}else if(Ib(ir[vn],Jn))return vn==="?"?s:vn;return ir.hasOwnProperty("*")?ir["*"]:Jn},C$={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},R$={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,C],[/opios[\/ ]+([\w\.]+)/i],[C,[_,_e+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[C,[_,_e+" GX"]],[/\bopr\/([\w\.]+)/i],[C,[_,_e]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[C,[_,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[C,[_,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_,C],[/quark(?:pc)?\/([-\w\.]+)/i],[C,[_,"Quark"]],[/\bddg\/([\w\.]+)/i],[C,[_,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[_,"UC"+Ee]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[C,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[_,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[C,[_,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[C,[_,"Smart Lenovo "+Ee]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+Ee],C],[/\bfocus\/([\w\.]+)/i],[C,[_,at+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[_,_e+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[_,_e+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[_,"MIUI"+Ob]],[/fxios\/([\w\.-]+)/i],[C,[_,at]],[/\bqihoobrowser\/?([\w\.]*)/i],[C,[_,"360"]],[/\b(qq)\/([\w\.]+)/i],[[_,/(.+)/,"$1Browser"],C],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1"+Ob],C],[/samsungbrowser\/([\w\.]+)/i],[C,[_,q+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[C,[_,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_,"Sogou Mobile"],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[_,C],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[_],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[C,_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,fr],C],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[_,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[C,[_,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[_,Me+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,Me+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[_,"Android "+Ee]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[C,dd,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],C],[/(wolvic|librewolf)\/([\w\.]+)/i],[_,C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[_,at+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[_,[C,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[_,[C,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[M,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[M,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[M,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[M,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[M,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[M,/ower/,"",Hu]],[/ sun4\w[;\)]/i],[[M,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[M,Hu]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[w,q],[S,G]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[w,q],[S,k]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[w,Z],[S,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[w,Z],[S,G]],[/(macintosh);/i],[v,[w,Z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[w,ee],[S,k]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[v,[w,mt],[S,G]],[/honor([-\w ]+)[;\)]/i],[v,[w,mt],[S,k]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[v,[w,ht],[S,G]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[w,ht],[S,k]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[v,/_/g," "],[w,lt],[S,G]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[v,/_/g," "],[w,lt],[S,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[w,O],[S,k]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[v,[w,dd,{OnePlus:["304","403","203"],"*":O}],[S,G]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[w,"Vivo"],[S,k]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[w,"Realme"],[S,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[w,ye],[S,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[w,ye],[S,G]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[w,Wt],[S,G]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[w,Wt],[S,k]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[v,[w,"Lenovo"],[S,G]],[/(nokia) (t[12][01])/i],[w,v,[S,G]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[v,/_/g," "],[S,k],[w,"Nokia"]],[/(pixel (c|tablet))\b/i],[v,[w,tt],[S,G]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[w,tt],[S,k]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[w,Ce],[S,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[w,Ce],[S,G]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[w,Be],[S,k]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[w,ne],[S,G]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[w,ne],[S,k]],[/(playbook);[-\w\),; ]+(rim)/i],[v,w,[S,G]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[w,ge],[S,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[w,ie],[S,G]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[w,ie],[S,k]],[/(nexus 9)/i],[v,[w,"HTC"],[S,G]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[w,[v,/_/g," "],[S,k]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[w,"TCL"],[S,G]],[/(itel) ((\w+))/i],[[w,Hu],v,[S,dd,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[w,"Acer"],[S,G]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[w,"Meizu"],[S,k]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[w,"Ulefone"],[S,k]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[w,"Energizer"],[S,k]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[w,"Cat"],[S,k]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[w,"Smartfren"],[S,k]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[w,"Nothing"],[S,k]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[v,[w,"Archos"],[S,G]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[v,[w,"Archos"],[S,k]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[w,v,[S,G]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[w,v,[S,k]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[w,v,[S,G]],[/(surface duo)/i],[v,[w,En],[S,G]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[w,"Fairphone"],[S,k]],[/(u304aa)/i],[v,[w,"AT&T"],[S,k]],[/\bsie-(\w*)/i],[v,[w,"Siemens"],[S,k]],[/\b(rct\w+) b/i],[v,[w,"RCA"],[S,G]],[/\b(venue[\d ]{2,7}) b/i],[v,[w,"Dell"],[S,G]],[/\b(q(?:mv|ta)\w+) b/i],[v,[w,"Verizon"],[S,G]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[w,"Barnes & Noble"],[S,G]],[/\b(tm\d{3}\w+) b/i],[v,[w,"NuVision"],[S,G]],[/\b(k88) b/i],[v,[w,"ZTE"],[S,G]],[/\b(nx\d{3}j) b/i],[v,[w,"ZTE"],[S,k]],[/\b(gen\d{3}) b.+49h/i],[v,[w,"Swiss"],[S,k]],[/\b(zur\d{3}) b/i],[v,[w,"Swiss"],[S,G]],[/\b((zeki)?tb.*\b) b/i],[v,[w,"Zeki"],[S,G]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[w,"Dragon Touch"],v,[S,G]],[/\b(ns-?\w{0,9}) b/i],[v,[w,"Insignia"],[S,G]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[w,"NextBook"],[S,G]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[w,"Voice"],v,[S,k]],[/\b(lvtel\-)?(v1[12]) b/i],[[w,"LvTel"],v,[S,k]],[/\b(ph-1) /i],[v,[w,"Essential"],[S,k]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[w,"Envizen"],[S,G]],[/\b(trio[-\w\. ]+) b/i],[v,[w,"MachSpeed"],[S,G]],[/\btu_(1491) b/i],[v,[w,"Rotor"],[S,G]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[v,[w,Ne],[S,G]],[/(sprint) (\w+)/i],[w,v,[S,k]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[w,En],[S,k]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[w,dn],[S,G]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[w,dn],[S,k]],[/smart-tv.+(samsung)/i],[w,[S,K]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[w,q],[S,K]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[w,Wt],[S,K]],[/(apple) ?tv/i],[w,[v,Z+" TV"],[S,K]],[/crkey/i],[[v,Me+"cast"],[w,tt],[S,K]],[/droid.+aft(\w+)( bui|\))/i],[v,[w,ne],[S,K]],[/(shield \w+ tv)/i],[v,[w,Ne],[S,K]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[w,ee],[S,K]],[/(bravia[\w ]+)( bui|\))/i],[v,[w,Ce],[S,K]],[/(mi(tv|box)-?\w+) bui/i],[v,[w,lt],[S,K]],[/Hbbtv.*(technisat) (.*);/i],[w,v,[S,K]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[w,wv],[v,wv],[S,K]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[v,[S,K]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[S,K]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[w,v,[S,I]],[/droid.+; (shield)( bui|\))/i],[v,[w,Ne],[S,I]],[/(playstation \w+)/i],[v,[w,Ce],[S,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[w,En],[S,I]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[v,[w,q],[S,X]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[w,v,[S,X]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[v,[w,O],[S,X]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[w,Z],[S,X]],[/(opwwe\d{3})/i],[v,[w,Be],[S,X]],[/(moto 360)/i],[v,[w,ye],[S,X]],[/(smartwatch 3)/i],[v,[w,Ce],[S,X]],[/(g watch r)/i],[v,[w,Wt],[S,X]],[/droid.+; (wt63?0{2,3})\)/i],[v,[w,dn],[S,X]],[/droid.+; (glass) \d/i],[v,[w,tt],[S,X]],[/(pico) (4|neo3(?: link|pro)?)/i],[w,v,[S,X]],[/; (quest( \d| pro)?)/i],[v,[w,fr],[S,X]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[w,[S,te]],[/(aeobc)\b/i],[v,[w,ne],[S,te]],[/(homepod).+mac os/i],[v,[w,Z],[S,te]],[/windows iot/i],[[S,te]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[S,k]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[S,G]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[S,G]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[S,k]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[v,[w,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[_,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[_,C],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_,C],[/ladybird\//i],[[_,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,C],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[_,[C,dd,C$]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[C,dd,C$],[_,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,ld],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,_],[/(ubuntu) ([\w\.]+) like android/i],[[_,/(.+)/,"$1 Touch"],C],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[_,C],[/\(bb(10);/i],[C,[_,ge]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[C,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[_,at+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[_,Me+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,ss],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,C],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_,C]]},No=function(Jn,ir){if(typeof Jn===u&&(ir=Jn,Jn=s),!(this instanceof No))return new No(Jn,ir).getResult();var vn=typeof i!==d&&i.navigator?i.navigator:s,qi=Jn||(vn&&vn.userAgent?vn.userAgent:""),Oo=vn&&vn.userAgentData?vn.userAgentData:s,Vn=ir?function(Lt,Io){var Ku={};for(var Ec in Lt)Io[Ec]&&Io[Ec].length%2==0?Ku[Ec]=Io[Ec].concat(Lt[Ec]):Ku[Ec]=Lt[Ec];return Ku}(R$,ir):R$,el=vn&&vn.userAgent==qi;return this.getBrowser=function(){var Lt={};return Lt[_]=s,Lt[C]=s,zu.call(Lt,qi,Vn.browser),Lt[g]=function(Io){return typeof Io===f?Io.replace(/[^\d\.]/g,"").split(".")[0]:s}(Lt[C]),el&&vn&&vn.brave&&typeof vn.brave.isBrave==c&&(Lt[_]="Brave"),Lt},this.getCPU=function(){var Lt={};return Lt[M]=s,zu.call(Lt,qi,Vn.cpu),Lt},this.getDevice=function(){var Lt={};return Lt[w]=s,Lt[v]=s,Lt[S]=s,zu.call(Lt,qi,Vn.device),el&&!Lt[S]&&Oo&&Oo.mobile&&(Lt[S]=k),el&&Lt[v]=="Macintosh"&&vn&&typeof vn.standalone!==d&&vn.maxTouchPoints&&vn.maxTouchPoints>2&&(Lt[v]="iPad",Lt[S]=G),Lt},this.getEngine=function(){var Lt={};return Lt[_]=s,Lt[C]=s,zu.call(Lt,qi,Vn.engine),Lt},this.getOS=function(){var Lt={};return Lt[_]=s,Lt[C]=s,zu.call(Lt,qi,Vn.os),el&&!Lt[_]&&Oo&&Oo.platform&&Oo.platform!="Unknown"&&(Lt[_]=Oo.platform.replace(/chrome os/i,ss).replace(/macos/i,ld)),Lt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return qi},this.setUA=function(Lt){return qi=typeof Lt===f&&Lt.length>500?wv(Lt,500):Lt,this},this.setUA(qi),this};No.VERSION="0.7.41",No.BROWSER=df([_,C,g]),No.CPU=df([M]),No.DEVICE=df([v,w,S,I,k,K,G,X,te]),No.ENGINE=No.OS=df([_,C]),t.exports&&(r=t.exports=No),r.UAParser=No;var uf=typeof i!==d&&(i.jQuery||i.Zepto);if(uf&&!uf.ua){var Pb=new No;uf.ua=Pb.getResult(),uf.ua.get=function(){return Pb.getUA()},uf.ua.set=function(Jn){Pb.setUA(Jn);var ir=Pb.getResult();for(var vn in ir)uf.ua[vn]=ir[vn]}}})(typeof window=="object"?window:o)})($R,$R.exports);var dhe=l($R.exports),UV=r0.clear;zt({global:!0,bind:!0,forced:N.clearImmediate!==UV},{clearImmediate:UV});var VV=N,uhe=F,hhe=he,phe=zT,fhe=Kn,mhe=Ml,ghe=nu,vhe=VV.Function,yhe=/MSIE .\./.test(fhe)||phe==="BUN"&&function(){var t=VV.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),_he=zt,FV=N,BV=r0.set,Ehe=function(t,r){var i=1;return yhe?function(s,c){var d=ghe(arguments.length,1)>i,u=hhe(s)?s:vhe(s),f=d?mhe(arguments,i):[],g=d?function(){uhe(u,this,f)}:u;return t(g)}:t},WV=FV.setImmediate?Ehe(BV):BV;_he({global:!0,bind:!0,forced:FV.setImmediate!==WV},{setImmediate:WV});var GV=l(Qt.setImmediate),bhe=N,She=Xj,whe=ba,xhe=nu,The=ve;zt({global:!0,dontCallGetSet:!0,forced:p(function(){return The&&Object.getOwnPropertyDescriptor(bhe,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){xhe(arguments.length,1),She(whe(t))}});var $V=l(Qt.queueMicrotask);function HV(t,r){return function(){return t.apply(r,arguments)}}const{toString:Che}=Object.prototype,{getPrototypeOf:HR}=Object,{iterator:I0,toStringTag:zV}=Symbol,P0=(zR=Object.create(null),t=>{const r=Che.call(t);return zR[r]||(zR[r]=r.slice(8,-1).toLowerCase())});var zR;const uo=t=>(t=t.toLowerCase(),r=>P0(r)===t),D0=t=>r=>typeof r===t,{isArray:mp}=Array,gp=D0("undefined");function bg(t){return t!==null&&!gp(t)&&t.constructor!==null&&!gp(t.constructor)&&Sa(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const KV=uo("ArrayBuffer"),Rhe=D0("string"),Sa=D0("function"),YV=D0("number"),Sg=t=>t!==null&&typeof t=="object",k0=t=>{if(P0(t)!=="object")return!1;const r=HR(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||zV in t||I0 in t)},Ahe=uo("Date"),Nhe=uo("File"),Ohe=uo("Blob"),Ihe=uo("FileList"),Phe=uo("URLSearchParams"),[Dhe,khe,Lhe,jhe]=["ReadableStream","Request","Response","Headers"].map(uo);function wg(t,r){let i,s,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),mp(t))for(i=0,s=t.length;i<s;i++)r.call(null,t[i],i,t);else{if(bg(t))return;const d=c?Object.getOwnPropertyNames(t):Object.keys(t),u=d.length;let f;for(i=0;i<u;i++)f=d[i],r.call(null,t[f],f,t)}}function qV(t,r){if(bg(t))return null;r=r.toLowerCase();const i=Object.keys(t);let s,c=i.length;for(;c-- >0;)if(s=i[c],r===s.toLowerCase())return s;return null}const lu=MV!==void 0?MV:typeof self<"u"?self:typeof window<"u"?window:bd,XV=t=>!gp(t)&&t!==lu,Mhe=(KR=typeof Uint8Array<"u"&&HR(Uint8Array),t=>KR&&t instanceof KR);var KR;const Uhe=uo("HTMLFormElement"),JV=(t=>{let{hasOwnProperty:r}=t;return(i,s)=>r.call(i,s)})(Object.prototype),Vhe=uo("RegExp"),QV=(t,r)=>{const i=Object.getOwnPropertyDescriptors(t),s={};wg(i,(c,d)=>{let u;(u=r(c,d,t))!==!1&&(s[d]=u||c)}),Object.defineProperties(t,s)},Fhe=uo("AsyncFunction"),ZV=(e4=typeof GV=="function",t4=Sa(lu.postMessage),e4?GV:t4?(YR="axios@".concat(Math.random()),L0=[],lu.addEventListener("message",t=>{let{source:r,data:i}=t;r===lu&&i===YR&&L0.length&&L0.shift()()},!1),t=>{L0.push(t),lu.postMessage(YR,"*")}):t=>setTimeout(t));var e4,t4,YR,L0;const Bhe=$V!==void 0?$V.bind(lu):typeof process<"u"&&process.nextTick||ZV;var ke={isArray:mp,isArrayBuffer:KV,isBuffer:bg,isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Sa(t.append)&&((r=P0(t))==="formdata"||r==="object"&&Sa(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&KV(t.buffer),r},isString:Rhe,isNumber:YV,isBoolean:t=>t===!0||t===!1,isObject:Sg,isPlainObject:k0,isEmptyObject:t=>{if(!Sg(t)||bg(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},isReadableStream:Dhe,isRequest:khe,isResponse:Lhe,isHeaders:jhe,isUndefined:gp,isDate:Ahe,isFile:Nhe,isBlob:Ohe,isRegExp:Vhe,isFunction:Sa,isStream:t=>Sg(t)&&Sa(t.pipe),isURLSearchParams:Phe,isTypedArray:Mhe,isFileList:Ihe,forEach:wg,merge:function t(){const{caseless:r,skipUndefined:i}=XV(this)&&this||{},s={},c=(d,u)=>{const f=r&&qV(s,u)||u;k0(s[f])&&k0(d)?s[f]=t(s[f],d):k0(d)?s[f]=t({},d):mp(d)?s[f]=d.slice():i&&gp(d)||(s[f]=d)};for(let d=0,u=arguments.length;d<u;d++)arguments[d]&&wg(arguments[d],c);return s},extend:function(t,r,i){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return wg(r,(c,d)=>{i&&Sa(c)?t[d]=HV(c,i):t[d]=c},{allOwnKeys:s}),t},trim:t=>mi(t)?mi(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,i,s)=>{t.prototype=Object.create(r.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),i&&Object.assign(t.prototype,i)},toFlatObject:(t,r,i,s)=>{let c,d,u;const f={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)u=c[d],s&&!s(u,t,r)||f[u]||(r[u]=t[u],f[u]=!0);t=i!==!1&&HR(t)}while(t&&(!i||i(t,r))&&t!==Object.prototype);return r},kindOf:P0,kindOfTest:uo,endsWith:(t,r,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=r.length;const s=t.indexOf(r,i);return s!==-1&&s===i},toArray:t=>{if(!t)return null;if(mp(t))return t;let r=t.length;if(!YV(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=t[r];return i},forEachEntry:(t,r)=>{const i=(t&&t[I0]).call(t);let s;for(;(s=i.next())&&!s.done;){const c=s.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let i;const s=[];for(;(i=t.exec(r))!==null;)s.push(i);return s},isHTMLForm:Uhe,hasOwnProperty:JV,hasOwnProp:JV,reduceDescriptors:QV,freezeMethods:t=>{QV(t,(r,i)=>{if(Sa(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const s=t[i];Sa(s)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(t,r)=>{const i={},s=c=>{c.forEach(d=>{i[d]=!0})};return mp(t)?s(t):s(String(t).split(r)),i},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,s){return i.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:qV,global:lu,isContextDefined:XV,isSpecCompliantForm:function(t){return!!(t&&Sa(t.append)&&t[zV]==="FormData"&&t[I0])},toJSONObject:t=>{const r=new Array(10),i=(s,c)=>{if(Sg(s)){if(r.indexOf(s)>=0)return;if(bg(s))return s;if(!("toJSON"in s)){r[c]=s;const d=mp(s)?[]:{};return wg(s,(u,f)=>{const g=i(u,c+1);!gp(g)&&(d[f]=g)}),r[c]=void 0,d}}return s};return i(t,0)},isAsyncFn:Fhe,isThenable:t=>t&&(Sg(t)||Sa(t))&&Sa(t.then)&&Sa(t.catch),setImmediate:ZV,asap:Bhe,isIterable:t=>t!=null&&Sa(t[I0])};function tn(t,r,i,s,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),s&&(this.request=s),c&&(this.response=c,this.status=c.status?c.status:null)}ke.inherits(tn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ke.toJSONObject(this.config),code:this.code,status:this.status}}});const n4=tn.prototype,r4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{r4[t]={value:t}}),Object.defineProperties(tn,r4),Object.defineProperty(n4,"isAxiosError",{value:!0}),tn.from=(t,r,i,s,c,d)=>{const u=Object.create(n4);ke.toFlatObject(t,u,function(v){return v!==Error.prototype},v=>v!=="isAxiosError");const f=t&&t.message?t.message:"Error",g=r==null&&t?t.code:r;return tn.call(u,f,g,i,s,c),t&&u.cause==null&&Object.defineProperty(u,"cause",{value:t,configurable:!0}),u.name=t&&t.name||"Error",d&&Object.assign(u,d),u};function qR(t){return ke.isPlainObject(t)||ke.isArray(t)}function i4(t){return ke.endsWith(t,"[]")?t.slice(0,-2):t}function a4(t,r,i){return t?t.concat(r).map(function(s,c){return s=i4(s),!i&&c?"["+s+"]":s}).join(i?".":""):r}const Whe=ke.toFlatObject(ke,{},null,function(t){return/^is[A-Z]/.test(t)});function j0(t,r,i){if(!ke.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const s=(i=ke.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,C){return!ke.isUndefined(C[w])})).metaTokens,c=i.visitor||v,d=i.dots,u=i.indexes,f=(i.Blob||typeof Blob<"u"&&Blob)&&ke.isSpecCompliantForm(r);if(!ke.isFunction(c))throw new TypeError("visitor must be a function");function g(w){if(w===null)return"";if(ke.isDate(w))return w.toISOString();if(ke.isBoolean(w))return w.toString();if(!f&&ke.isBlob(w))throw new tn("Blob is not supported. Use a Buffer instead.");return ke.isArrayBuffer(w)||ke.isTypedArray(w)?f&&typeof Blob=="function"?new Blob([w]):Buffer.from(w):w}function v(w,C,M){let I=w;if(w&&!M&&typeof w=="object"){if(ke.endsWith(C,"{}"))C=s?C:C.slice(0,-2),w=JSON.stringify(w);else if(ke.isArray(w)&&function(k){return ke.isArray(k)&&!k.some(qR)}(w)||(ke.isFileList(w)||ke.endsWith(C,"[]"))&&(I=ke.toArray(w)))return C=i4(C),I.forEach(function(k,G){!ke.isUndefined(k)&&k!==null&&r.append(u===!0?a4([C],G,d):u===null?C:C+"[]",g(k))}),!1}return!!qR(w)||(r.append(a4(M,C,d),g(w)),!1)}const _=[],S=Object.assign(Whe,{defaultVisitor:v,convertValue:g,isVisitable:qR});if(!ke.isObject(t))throw new TypeError("data must be an object");return function w(C,M){if(!ke.isUndefined(C)){if(_.indexOf(C)!==-1)throw Error("Circular reference detected in "+M.join("."));_.push(C),ke.forEach(C,function(I,k){(!(ke.isUndefined(I)||I===null)&&c.call(r,I,ke.isString(k)?mi(k).call(k):k,M,S))===!0&&w(I,M?M.concat(k):[k])}),_.pop()}}(t),r}function s4(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function XR(t,r){this._pairs=[],t&&j0(t,this,r)}const o4=XR.prototype;function Ghe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function c4(t,r,i){if(!r)return t;const s=i&&i.encode||Ghe;ke.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let d;if(d=c?c(r,i):ke.isURLSearchParams(r)?r.toString():new XR(r,i).toString(s),d){const u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}o4.append=function(t,r){this._pairs.push([t,r])},o4.toString=function(t){const r=t?function(i){return t.call(this,i,s4)}:s4;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var l4=class{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ke.forEach(this.handlers,function(r){r!==null&&t(r)})}},d4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},u4={exports:{}},$he=zt,Hhe=ve,h4=Es.f;$he({target:"Object",stat:!0,forced:Object.defineProperty!==h4,sham:!Hhe},{defineProperty:h4});var p4=Qt.Object,zhe=u4.exports=function(t,r,i){return p4.defineProperty(t,r,i)};p4.defineProperty.sham&&(zhe.sham=!0);var f4=l(u4.exports),Khe=TypeError,m4=ng,Yhe=n0,qhe=rt,Xhe=Yn("species"),g4=Array,Jhe=function(t){var r;return m4(t)&&(r=t.constructor,(Yhe(r)&&(r===g4||m4(r.prototype))||qhe(r)&&(r=r[Xhe])===null)&&(r=void 0)),r===void 0?g4:r},v4=function(t,r){return new(Jhe(t))(r===0?0:r)},Qhe=p,Zhe=_s,epe=Yn("species"),y4=function(t){return Zhe>=51||!Qhe(function(){var r=[];return(r.constructor={})[epe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},tpe=zt,npe=p,rpe=ng,ipe=rt,ape=Qo,spe=kl,_4=function(t){if(t>9007199254740991)throw Khe("Maximum allowed index exceeded");return t},E4=aR,ope=v4,cpe=y4,lpe=_s,b4=Yn("isConcatSpreadable"),dpe=lpe>=51||!npe(function(){var t=[];return t[b4]=!1,t.concat()[0]!==t}),upe=function(t){if(!ipe(t))return!1;var r=t[b4];return r!==void 0?!!r:rpe(t)};tpe({target:"Array",proto:!0,forced:!dpe||!cpe("concat")},{concat:function(t){var r,i,s,c,d,u=ape(this),f=ope(u,0),g=0;for(r=-1,s=arguments.length;r<s;r++)if(upe(d=r===-1?u:arguments[r]))for(c=spe(d),_4(g+c),i=0;i<c;i++,g++)i in d&&E4(f,g,d[i]);else _4(g+1),E4(f,g++,d);return f.length=g,f}});var S4={},hpe=Y,ppe=wn,w4=F_.f,fpe=Ml,x4=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];S4.f=function(t){return x4&&hpe(t)==="Window"?function(r){try{return w4(r)}catch{return fpe(x4)}}(t):w4(ppe(t))};var vp={},mpe=Yn;vp.f=mpe;var T4=Qt,gpe=Xr,vpe=vp,ype=Es.f,Nr=function(t){var r=T4.Symbol||(T4.Symbol={});gpe(r,t)||ype(r,t,{value:vpe.f(t)})},_pe=be,Epe=Je,bpe=Yn,Spe=jl,C4=function(){var t=Epe("Symbol"),r=t&&t.prototype,i=r&&r.valueOf,s=bpe("toPrimitive");r&&!r[s]&&Spe(r,s,function(c){return _pe(i,this)},{})},wpe=Dl,xpe=it,Tpe=Qo,Cpe=kl,Rpe=v4,R4=x([].push),Ape=function(t){var r=t===1,i=t===2,s=t===3,c=t===4,d=t===6,u=t===7,f=t===5||d;return function(g,v,_,S){for(var w,C,M=Tpe(g),I=xpe(M),k=Cpe(I),G=wpe(v,_),K=0,X=S||Rpe,te=r?X(g,k):i||u?X(g,0):void 0;k>K;K++)if((f||K in I)&&(C=G(w=I[K],K,M),t))if(r)te[K]=C;else if(C)switch(t){case 3:return!0;case 5:return w;case 6:return K;case 2:R4(te,w)}else switch(t){case 4:return!1;case 7:R4(te,w)}return d?-1:s||c?c:te}},A4={forEach:Ape(0)},M0=zt,xg=N,JR=be,Npe=x,yp=ve,_p=Jo,Ope=p,gi=Xr,Ipe=A,QR=aa,U0=wn,ZR=PT,Ppe=sa,eA=Ye,Ep=ig,N4=W_,Dpe=F_,O4=S4,kpe=rg,I4=Re,P4=Es,Lpe=ZT,D4=ae,k4=jl,jpe=t0,tA=Hh,L4=B_,j4=OT,Mpe=Yn,Upe=vp,Vpe=Nr,Fpe=C4,Bpe=Fc,M4=tu,V0=A4.forEach,wa=V_("hidden"),F0="Symbol",Tg="prototype",Wpe=M4.set,U4=M4.getterFor(F0),ho=Object[Tg],du=xg.Symbol,B0=du&&du[Tg],Gpe=xg.RangeError,$pe=xg.TypeError,nA=xg.QObject,V4=I4.f,uu=P4.f,F4=O4.f,Hpe=D4.f,B4=Npe([].push),Gc=tA("symbols"),Cg=tA("op-symbols"),zpe=tA("wks"),rA=!nA||!nA[Tg]||!nA[Tg].findChild,W4=function(t,r,i){var s=V4(ho,r);s&&delete ho[r],uu(t,r,i),s&&t!==ho&&uu(ho,r,s)},iA=yp&&Ope(function(){return Ep(uu({},"a",{get:function(){return uu(this,"a",{value:7}).a}})).a!==7})?W4:uu,aA=function(t,r){var i=Gc[t]=Ep(B0);return Wpe(i,{type:F0,tag:t,description:r}),yp||(i.description=r),i},W0=function(t,r,i){t===ho&&W0(Cg,r,i),QR(t);var s=ZR(r);return QR(i),gi(Gc,s)?(i.enumerable?(gi(t,wa)&&t[wa][s]&&(t[wa][s]=!1),i=Ep(i,{enumerable:eA(0,!1)})):(gi(t,wa)||uu(t,wa,eA(1,Ep(null))),t[wa][s]=!0),iA(t,s,i)):uu(t,s,i)},sA=function(t,r){QR(t);var i=U0(r),s=N4(i).concat(z4(i));return V0(s,function(c){yp&&!JR(G4,i,c)||W0(t,c,i[c])}),t},G4=function(t){var r=ZR(t),i=JR(Hpe,this,r);return!(this===ho&&gi(Gc,r)&&!gi(Cg,r))&&(!(i||!gi(this,r)||!gi(Gc,r)||gi(this,wa)&&this[wa][r])||i)},$4=function(t,r){var i=U0(t),s=ZR(r);if(i!==ho||!gi(Gc,s)||gi(Cg,s)){var c=V4(i,s);return!c||!gi(Gc,s)||gi(i,wa)&&i[wa][s]||(c.enumerable=!0),c}},H4=function(t){var r=F4(U0(t)),i=[];return V0(r,function(s){gi(Gc,s)||gi(L4,s)||B4(i,s)}),i},z4=function(t){var r=t===ho,i=F4(r?Cg:U0(t)),s=[];return V0(i,function(c){!gi(Gc,c)||r&&!gi(ho,c)||B4(s,Gc[c])}),s};_p||(du=function(){if(Ipe(B0,this))throw new $pe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?Ppe(arguments[0]):void 0,r=j4(t),i=function(s){var c=this===void 0?xg:this;c===ho&&JR(i,Cg,s),gi(c,wa)&&gi(c[wa],r)&&(c[wa][r]=!1);var d=eA(1,s);try{iA(c,r,d)}catch(u){if(!(u instanceof Gpe))throw u;W4(c,r,d)}};return yp&&rA&&iA(ho,r,{configurable:!0,set:i}),aA(r,t)},k4(B0=du[Tg],"toString",function(){return U4(this).tag}),k4(du,"withoutSetter",function(t){return aA(j4(t),t)}),D4.f=G4,P4.f=W0,Lpe.f=sA,I4.f=$4,Dpe.f=O4.f=H4,kpe.f=z4,Upe.f=function(t){return aA(Mpe(t),t)},yp&&jpe(B0,"description",{configurable:!0,get:function(){return U4(this).description}})),M0({global:!0,wrap:!0,forced:!_p,sham:!_p},{Symbol:du}),V0(N4(zpe),function(t){Vpe(t)}),M0({target:F0,stat:!0,forced:!_p},{useSetter:function(){rA=!0},useSimple:function(){rA=!1}}),M0({target:"Object",stat:!0,forced:!_p,sham:!yp},{create:function(t,r){return r===void 0?Ep(t):sA(Ep(t),r)},defineProperty:W0,defineProperties:sA,getOwnPropertyDescriptor:$4}),M0({target:"Object",stat:!0,forced:!_p},{getOwnPropertyNames:H4}),Fpe(),Bpe(du,F0),L4[wa]=!0;var K4=Jo&&!!Symbol.for&&!!Symbol.keyFor,Kpe=zt,Ype=Je,qpe=Xr,Xpe=sa,Y4=Hh,Jpe=K4,oA=Y4("string-to-symbol-registry"),Qpe=Y4("symbol-to-string-registry");Kpe({target:"Symbol",stat:!0,forced:!Jpe},{for:function(t){var r=Xpe(t);if(qpe(oA,r))return oA[r];var i=Ype("Symbol")(r);return oA[r]=i,Qpe[i]=r,i}});var Zpe=zt,efe=Xr,tfe=Jm,nfe=$h,rfe=K4,q4=Hh("symbol-to-string-registry");Zpe({target:"Symbol",stat:!0,forced:!rfe},{keyFor:function(t){if(!tfe(t))throw new TypeError(nfe(t)+" is not a symbol");if(efe(q4,t))return q4[t]}});var X4=ng,ife=he,J4=Y,afe=sa,Q4=x([].push),sfe=zt,Z4=Je,eF=F,ofe=be,Rg=x,tF=p,nF=he,rF=Jm,iF=Ml,cfe=function(t){if(ife(t))return t;if(X4(t)){for(var r=t.length,i=[],s=0;s<r;s++){var c=t[s];typeof c=="string"?Q4(i,c):typeof c!="number"&&J4(c)!=="Number"&&J4(c)!=="String"||Q4(i,afe(c))}var d=i.length,u=!0;return function(f,g){if(u)return u=!1,g;if(X4(this))return g;for(var v=0;v<d;v++)if(i[v]===f)return g}}},lfe=Jo,dfe=String,Gl=Z4("JSON","stringify"),G0=Rg(/./.exec),aF=Rg("".charAt),ufe=Rg("".charCodeAt),hfe=Rg("".replace),pfe=Rg(1.1.toString),ffe=/[\uD800-\uDFFF]/g,sF=/^[\uD800-\uDBFF]$/,oF=/^[\uDC00-\uDFFF]$/,cF=!lfe||tF(function(){var t=Z4("Symbol")("stringify detection");return Gl([t])!=="[null]"||Gl({a:t})!=="{}"||Gl(Object(t))!=="{}"}),lF=tF(function(){return Gl("\uDF06\uD834")!=='"\\udf06\\ud834"'||Gl("\uDEAD")!=='"\\udead"'}),mfe=function(t,r){var i=iF(arguments),s=cfe(r);if(nF(s)||t!==void 0&&!rF(t))return i[1]=function(c,d){if(nF(s)&&(d=ofe(s,this,dfe(c),d)),!rF(d))return d},eF(Gl,null,i)},gfe=function(t,r,i){var s=aF(i,r-1),c=aF(i,r+1);return G0(sF,t)&&!G0(oF,c)||G0(oF,t)&&!G0(sF,s)?"\\u"+pfe(ufe(t,0),16):t};Gl&&sfe({target:"JSON",stat:!0,forced:cF||lF},{stringify:function(t,r,i){var s=iF(arguments),c=eF(cF?mfe:Gl,null,s);return lF&&typeof c=="string"?hfe(c,ffe,gfe):c}});var dF=rg,vfe=Qo;zt({target:"Object",stat:!0,forced:!Jo||p(function(){dF.f(1)})},{getOwnPropertySymbols:function(t){var r=dF.f;return r?r(vfe(t)):[]}}),Nr("asyncDispose"),Nr("asyncIterator"),Nr("dispose"),Nr("hasInstance"),Nr("isConcatSpreadable"),Nr("iterator"),Nr("match"),Nr("matchAll"),Nr("replace"),Nr("search"),Nr("species"),Nr("split");var yfe=C4;Nr("toPrimitive"),yfe();var _fe=Je,Efe=Fc;Nr("toStringTag"),Efe(_fe("Symbol"),"Symbol"),Nr("unscopables"),Fc(N.JSON,"JSON",!0);var bfe=Qt.Symbol,Sfe=Yn,wfe=Es.f,uF=Sfe("metadata"),hF=Function.prototype;hF[uF]===void 0&&wfe(hF,uF,{value:null}),Nr("metadata");var xfe=bfe,Tfe=x,cA=Je("Symbol"),Cfe=cA.keyFor,Rfe=Tfe(cA.prototype.valueOf),pF=cA.isRegisteredSymbol||function(t){try{return Cfe(Rfe(t))!==void 0}catch{return!1}};zt({target:"Symbol",stat:!0},{isRegisteredSymbol:pF});for(var Afe=Hh,fF=Je,Nfe=x,Ofe=Jm,Ife=Yn,$0=fF("Symbol"),mF=$0.isWellKnownSymbol,gF=fF("Object","getOwnPropertyNames"),Pfe=Nfe($0.prototype.valueOf),vF=Afe("wks"),lA=0,yF=gF($0),Dfe=yF.length;lA<Dfe;lA++)try{var _F=yF[lA];Ofe($0[_F])&&Ife(_F)}catch{}var EF=function(t){if(mF&&mF(t))return!0;try{for(var r=Pfe(t),i=0,s=gF(vF),c=s.length;i<c;i++)if(vF[s[i]]==r)return!0}catch{}return!1};zt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:EF}),Nr("customMatcher"),Nr("observable"),zt({target:"Symbol",stat:!0},{isRegistered:pF}),zt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:EF}),Nr("matcher"),Nr("metadataKey"),Nr("patternMatch"),Nr("replaceAll");var bp=l(xfe),bF=l(vp.f("iterator"));function Ag(t){return Ag=typeof bp=="function"&&typeof bF=="symbol"?function(r){return typeof r}:function(r){return r&&typeof bp=="function"&&r.constructor===bp&&r!==bp.prototype?"symbol":typeof r},Ag(t)}var kfe=l(vp.f("toPrimitive"));function Lfe(t){var r=function(i,s){if(Ag(i)!="object"||!i)return i;var c=i[kfe];if(c!==void 0){var d=c.call(i,s);if(Ag(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(i)}(t,"string");return Ag(r)=="symbol"?r:r+""}function j(t,r,i){return(r=Lfe(r))in t?f4(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}var SF=l(ode),jfe={isBrowser:!0,classes:{URLSearchParams:SF!==void 0?SF:XR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const dA=typeof window<"u"&&typeof document<"u",uA=typeof navigator=="object"&&navigator||void 0,Mfe=dA&&(!uA||["ReactNative","NativeScript","NS"].indexOf(uA.product)<0),Ufe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Vfe=dA&&window.location.href||"http://localhost";function wF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function xF(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?wF(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):wF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}var $i=xF(xF({},Object.freeze({__proto__:null,hasBrowserEnv:dA,hasStandardBrowserEnv:Mfe,hasStandardBrowserWebWorkerEnv:Ufe,navigator:uA,origin:Vfe})),jfe);function TF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ffe(t,r){return j0(t,new $i.classes.URLSearchParams,function(i){for(var s=1;s<arguments.length;s++){var c=arguments[s]!=null?arguments[s]:{};s%2?TF(Object(c),!0).forEach(function(d){j(i,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(c)):TF(Object(c)).forEach(function(d){Object.defineProperty(i,d,Object.getOwnPropertyDescriptor(c,d))})}return i}({visitor:function(i,s,c,d){return $i.isNode&&ke.isBuffer(i)?(this.append(s,i.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)}},r))}var Bfe=HC.charAt,CF=be,Wfe=aa,Gfe=he,$fe=Y,Hfe=/./.exec,zfe=TypeError,Kfe=zt,RF=be,AF=de,Yfe=hC,H0=Z_,NF=St,OF=CL,Ng=sa,qfe=aa,Xfe=rt,Jfe=Y,Qfe=WT,IF=jR,Zfe=Qm,eme=p,tme=yC,nme=function(t,r,i){return r+(i?Bfe(t,r).length:1)},rme=function(t,r){var i=t.exec;if(Gfe(i)){var s=CF(i,t,r);return s!==null&&Wfe(s),s}if($fe(t)==="RegExp")return CF(Hfe,t,r);throw new zfe("RegExp#exec called on incompatible receiver")},PF=tu,ime=Yn("matchAll"),DF="RegExp String",kF=DF+" Iterator",ame=PF.set,sme=PF.getterFor(kF),ome=TypeError,hA=AF("".indexOf),z0=AF("".matchAll),pA=!!z0&&!eme(function(){z0("a",/./)}),cme=Yfe(function(t,r,i,s){ame(this,{type:kF,regexp:t,string:r,global:i,unicode:s,done:!1})},DF,function(){var t=sme(this);if(t.done)return H0(void 0,!0);var r=t.regexp,i=t.string,s=rme(r,i);return s===null?(t.done=!0,H0(void 0,!0)):t.global?(Ng(s[0])===""&&(r.lastIndex=nme(i,OF(r.lastIndex),t.unicode)),H0(s,!1)):(t.done=!0,H0(s,!1))}),LF=function(t){var r,i,s,c=qfe(this),d=Ng(t),u=tme(c,RegExp),f=Ng(IF(c));return r=new u(u===RegExp?c.source:c,f),i=!!~hA(f,"g"),s=!!~hA(f,"u"),r.lastIndex=OF(c.lastIndex),new cme(r,d,i,s)};Kfe({target:"String",proto:!0,forced:pA},{matchAll:function(t){var r,i,s,c,d=NF(this);if(Xfe(t)){if(Qfe(t)&&(r=Ng(NF(IF(t))),!~hA(r,"g")))throw new ome("`.matchAll` does not allow non-global regexes");if(pA)return z0(d,t);if((s=Zfe(t,ime))===void 0&&Jfe(t)==="RegExp"&&(s=LF),s)return RF(s,t,d)}else if(pA)return z0(d,t);return i=Ng(d),c=new RegExp(t,"g"),RF(LF,c,i)}});var lme=Ya("String","matchAll"),dme=A,ume=lme,fA=String.prototype,hme=function(t){var r=t.matchAll;return typeof t=="string"||t===fA||dme(fA,t)&&r===fA.matchAll?ume:r},pme=l(hme);function jF(t){function r(i,s,c,d){let u=i[d++];if(u==="__proto__")return!0;const f=Number.isFinite(+u),g=d>=i.length;return u=!u&&ke.isArray(c)?c.length:u,g?(ke.hasOwnProp(c,u)?c[u]=[c[u],s]:c[u]=s,!f):(c[u]&&ke.isObject(c[u])||(c[u]=[]),r(i,s,c[u],d)&&ke.isArray(c[u])&&(c[u]=function(v){const _={},S=Object.keys(v);let w;const C=S.length;let M;for(w=0;w<C;w++)M=S[w],_[M]=v[M];return _}(c[u])),!f)}if(ke.isFormData(t)&&ke.isFunction(t.entries)){const i={};return ke.forEachEntry(t,(s,c)=>{r(function(d){return pme(ke).call(ke,/\w+|\[(\w*)]/g,d).map(u=>u[0]==="[]"?"":u[1]||u[0])}(s),c,i,0)}),i}return null}const mA={transitional:d4,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const i=r.getContentType()||"",s=i.indexOf("application/json")>-1,c=ke.isObject(t);if(c&&ke.isHTMLForm(t)&&(t=new FormData(t)),ke.isFormData(t))return s?JSON.stringify(jF(t)):t;if(ke.isArrayBuffer(t)||ke.isBuffer(t)||ke.isStream(t)||ke.isFile(t)||ke.isBlob(t)||ke.isReadableStream(t))return t;if(ke.isArrayBufferView(t))return t.buffer;if(ke.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return Ffe(t,this.formSerializer).toString();if((d=ke.isFileList(t))||i.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return j0(d?{"files[]":t}:t,u&&new u,this.formSerializer)}}return c||s?(r.setContentType("application/json",!1),function(u,f,g){if(ke.isString(u))try{return(f||JSON.parse)(u),mi(ke).call(ke,u)}catch(v){if(v.name!=="SyntaxError")throw v}return(g||JSON.stringify)(u)}(t)):t}],transformResponse:[function(t){const r=this.transitional||mA.transitional,i=r&&r.forcedJSONParsing,s=this.responseType==="json";if(ke.isResponse(t)||ke.isReadableStream(t))return t;if(t&&ke.isString(t)&&(i&&!this.responseType||s)){const c=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(t,this.parseReviver)}catch(d){if(c)throw d.name==="SyntaxError"?tn.from(d,tn.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$i.classes.FormData,Blob:$i.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ke.forEach(["delete","get","head","post","put","patch"],t=>{mA.headers[t]={}});var gA=mA;const fme=ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),MF=Symbol("internals");function Og(t){var r;return t&&mi(r=String(t)).call(r).toLowerCase()}function K0(t){return t===!1||t==null?t:ke.isArray(t)?t.map(K0):String(t)}function vA(t,r,i,s,c){return ke.isFunction(s)?s.call(this,r,i):(c&&(r=i),ke.isString(r)?ke.isString(s)?r.indexOf(s)!==-1:ke.isRegExp(s)?s.test(r):void 0:void 0)}class Y0{constructor(r){r&&this.set(r)}set(r,i,s){const c=this;function d(g,v,_){const S=Og(v);if(!S)throw new Error("header name must be a non-empty string");const w=ke.findKey(c,S);(!w||c[w]===void 0||_===!0||_===void 0&&c[w]!==!1)&&(c[w||v]=K0(g))}const u=(g,v)=>ke.forEach(g,(_,S)=>d(_,S,v));if(ke.isPlainObject(r)||r instanceof this.constructor)u(r,i);else if(ke.isString(r)&&(r=mi(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(mi(f=r).call(f)))u((g=>{const v={};let _,S,w;return g&&g.split(`
`).forEach(function(C){var M,I;w=C.indexOf(":"),_=mi(M=C.substring(0,w)).call(M).toLowerCase(),S=mi(I=C.substring(w+1)).call(I),!_||v[_]&&fme[_]||(_==="set-cookie"?v[_]?v[_].push(S):v[_]=[S]:v[_]=v[_]?v[_]+", "+S:S)}),v})(r),i);else if(ke.isObject(r)&&ke.isIterable(r)){let g,v,_={};for(const S of r){if(!ke.isArray(S))throw TypeError("Object iterator must return a key-value pair");_[v=S[0]]=(g=_[v])?ke.isArray(g)?[...g,S[1]]:[g,S[1]]:S[1]}u(_,i)}else r!=null&&d(i,r,s);var f;return this}get(r,i){if(r=Og(r)){const s=ke.findKey(this,r);if(s){const c=this[s];if(!i)return c;if(i===!0)return function(d){const u=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=f.exec(d);)u[g[1]]=g[2];return u}(c);if(ke.isFunction(i))return i.call(this,c,s);if(ke.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=Og(r)){const s=ke.findKey(this,r);return!(!s||this[s]===void 0||i&&!vA(0,this[s],s,i))}return!1}delete(r,i){const s=this;let c=!1;function d(u){if(u=Og(u)){const f=ke.findKey(s,u);!f||i&&!vA(0,s[f],f,i)||(delete s[f],c=!0)}}return ke.isArray(r)?r.forEach(d):d(r),c}clear(r){const i=Object.keys(this);let s=i.length,c=!1;for(;s--;){const d=i[s];r&&!vA(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const i=this,s={};return ke.forEach(this,(c,d)=>{var u;const f=ke.findKey(s,d);if(f)return i[f]=K0(c),void delete i[d];const g=r?function(v){return mi(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,S,w)=>S.toUpperCase()+w)}(d):mi(u=String(d)).call(u);g!==d&&delete i[d],i[g]=K0(c),s[g]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return ke.forEach(this,(s,c)=>{s!=null&&s!==!1&&(i[c]=r&&ke.isArray(s)?s.join(", "):s)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,s]=r;return i+": "+s}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];return c.forEach(u=>i.set(u)),i}static accessor(r){const i=(this[MF]=this[MF]={accessors:{}}).accessors,s=this.prototype;function c(d){const u=Og(d);i[u]||(function(f,g){const v=ke.toCamelCase(" "+g);["get","set","has"].forEach(_=>{Object.defineProperty(f,_+v,{value:function(S,w,C){return this[_].call(this,g,S,w,C)},configurable:!0})})}(s,d),i[u]=!0)}return ke.isArray(r)?r.forEach(c):c(r),this}}Y0.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ke.reduceDescriptors(Y0.prototype,(t,r)=>{let{value:i}=t,s=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[s]=c}}}),ke.freezeMethods(Y0);var po=Y0;function yA(t,r){const i=this||gA,s=r||i,c=po.from(s.headers);let d=s.data;return ke.forEach(t,function(u){d=u.call(i,d,c.normalize(),r?r.status:void 0)}),c.normalize(),d}function UF(t){return!(!t||!t.__CANCEL__)}function Sp(t,r,i){tn.call(this,t??"canceled",tn.ERR_CANCELED,r,i),this.name="CanceledError"}function VF(t,r,i){const s=i.config.validateStatus;i.status&&s&&!s(i.status)?r(new tn("Request failed with status code "+i.status,[tn.ERR_BAD_REQUEST,tn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}ke.inherits(Sp,tn,{__CANCEL__:!0});const q0=function(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0;const c=function(d,u){d=d||10;const f=new Array(d),g=new Array(d);let v,_=0,S=0;return u=u!==void 0?u:1e3,function(w){const C=Date.now(),M=g[S];v||(v=C),f[_]=w,g[_]=C;let I=S,k=0;for(;I!==_;)k+=f[I++],I%=d;if(_=(_+1)%d,_===S&&(S=(S+1)%d),C-v<u)return;const G=M&&C-M;return G?Math.round(1e3*k/G):void 0}}(50,250);return function(d,u){let f,g,v=0,_=1e3/u;const S=function(w){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),f=null,g&&(clearTimeout(g),g=null),d(...w)};return[function(){const w=Date.now(),C=w-v;for(var M=arguments.length,I=new Array(M),k=0;k<M;k++)I[k]=arguments[k];C>=_?S(I,w):(f=I,g||(g=setTimeout(()=>{g=null,S(f)},_-C)))},()=>f&&S(f)]}(d=>{const u=d.loaded,f=d.lengthComputable?d.total:void 0,g=u-s,v=c(g);s=u,t({loaded:u,total:f,progress:f?u/f:void 0,bytes:g,rate:v||void 0,estimated:v&&f&&u<=f?(f-u)/v:void 0,event:d,lengthComputable:f!=null,[r?"download":"upload"]:!0})},i)},FF=(t,r)=>{const i=t!=null;return[s=>r[0]({lengthComputable:i,total:t,loaded:s}),r[1]]},BF=t=>function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return ke.asap(()=>t(...i))};var mme=$i.hasStandardBrowserEnv?((t,r)=>i=>(i=new x0(i,$i.origin),t.protocol===i.protocol&&t.host===i.host&&(r||t.port===i.port)))(new x0($i.origin),$i.navigator&&/(msie|trident)/i.test($i.navigator.userAgent)):()=>!0,gme=$i.hasStandardBrowserEnv?{write(t,r,i,s,c,d,u){if(typeof document>"u")return;const f=["".concat(t,"=").concat(encodeURIComponent(r))];ke.isNumber(i)&&f.push("expires=".concat(new Date(i).toUTCString())),ke.isString(s)&&f.push("path=".concat(s)),ke.isString(c)&&f.push("domain=".concat(c)),d===!0&&f.push("secure"),ke.isString(u)&&f.push("SameSite=".concat(u)),document.cookie=f.join("; ")},read(t){if(typeof document>"u")return null;const r=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return r?decodeURIComponent(r[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function WF(t,r,i){let s=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(r);return t&&(s||i==0)?function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}(t,r):r}function GF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function _A(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?GF(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):GF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const $F=t=>t instanceof po?_A({},t):t;function hu(t,r){r=r||{};const i={};function s(v,_,S,w){return ke.isPlainObject(v)&&ke.isPlainObject(_)?ke.merge.call({caseless:w},v,_):ke.isPlainObject(_)?ke.merge({},_):ke.isArray(_)?_.slice():_}function c(v,_,S,w){return ke.isUndefined(_)?ke.isUndefined(v)?void 0:s(void 0,v,0,w):s(v,_,0,w)}function d(v,_){if(!ke.isUndefined(_))return s(void 0,_)}function u(v,_){return ke.isUndefined(_)?ke.isUndefined(v)?void 0:s(void 0,v):s(void 0,_)}function f(v,_,S){return S in r?s(v,_):S in t?s(void 0,v):void 0}const g={url:d,method:d,data:d,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:f,headers:(v,_,S)=>c($F(v),$F(_),0,!0)};return ke.forEach(Object.keys(_A(_A({},t),r)),function(v){const _=g[v]||c,S=_(t[v],r[v],v);ke.isUndefined(S)&&_!==f||(i[v]=S)}),i}var HF=t=>{const r=hu({},t);let{data:i,withXSRFToken:s,xsrfHeaderName:c,xsrfCookieName:d,headers:u,auth:f}=r;if(r.headers=u=po.from(u),r.url=c4(WF(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),f&&u.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):""))),ke.isFormData(i)){if($i.hasStandardBrowserEnv||$i.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if(ke.isFunction(i.getHeaders)){const g=i.getHeaders(),v=["content-type","content-length"];Object.entries(g).forEach(_=>{let[S,w]=_;xe(v).call(v,S.toLowerCase())&&u.set(S,w)})}}if($i.hasStandardBrowserEnv&&(s&&ke.isFunction(s)&&(s=s(r)),s||s!==!1&&mme(r.url))){const g=c&&d&&gme.read(d);g&&u.set(c,g)}return r},vme=typeof XMLHttpRequest<"u"&&function(t){return new Ie(function(r,i){const s=HF(t);let c=s.data;const d=po.from(s.headers).normalize();let u,f,g,v,_,{responseType:S,onUploadProgress:w,onDownloadProgress:C}=s;function M(){v&&v(),_&&_(),s.cancelToken&&s.cancelToken.unsubscribe(u),s.signal&&s.signal.removeEventListener("abort",u)}let I=new XMLHttpRequest;function k(){if(!I)return;const K=po.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());VF(function(X){r(X),M()},function(X){i(X),M()},{data:S&&S!=="text"&&S!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:K,config:t,request:I}),I=null}I.open(s.method.toUpperCase(),s.url,!0),I.timeout=s.timeout,"onloadend"in I?I.onloadend=k:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(k)},I.onabort=function(){I&&(i(new tn("Request aborted",tn.ECONNABORTED,t,I)),I=null)},I.onerror=function(K){const X=new tn(K&&K.message?K.message:"Network Error",tn.ERR_NETWORK,t,I);X.event=K||null,i(X),I=null},I.ontimeout=function(){let K=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const X=s.transitional||d4;s.timeoutErrorMessage&&(K=s.timeoutErrorMessage),i(new tn(K,X.clarifyTimeoutError?tn.ETIMEDOUT:tn.ECONNABORTED,t,I)),I=null},c===void 0&&d.setContentType(null),"setRequestHeader"in I&&ke.forEach(d.toJSON(),function(K,X){I.setRequestHeader(X,K)}),ke.isUndefined(s.withCredentials)||(I.withCredentials=!!s.withCredentials),S&&S!=="json"&&(I.responseType=s.responseType),C&&([g,_]=q0(C,!0),I.addEventListener("progress",g)),w&&I.upload&&([f,v]=q0(w),I.upload.addEventListener("progress",f),I.upload.addEventListener("loadend",v)),(s.cancelToken||s.signal)&&(u=K=>{I&&(i(!K||K.type?new Sp(null,t,I):K),I.abort(),I=null)},s.cancelToken&&s.cancelToken.subscribe(u),s.signal&&(s.signal.aborted?u():s.signal.addEventListener("abort",u)));const G=function(K){const X=/^([-+\w]{1,25})(:?\/\/|:)/.exec(K);return X&&X[1]||""}(s.url);G&&$i.protocols.indexOf(G)===-1?i(new tn("Unsupported protocol "+G+":",tn.ERR_BAD_REQUEST,t)):I.send(c||null)})},yme=(t,r)=>{const{length:i}=t=t?t.filter(Boolean):[];if(r||i){let s,c=new AbortController;const d=function(v){if(!s){s=!0,f();const _=v instanceof Error?v:this.reason;c.abort(_ instanceof tn?_:new Sp(_ instanceof Error?_.message:_))}};let u=r&&setTimeout(()=>{u=null,d(new tn("timeout ".concat(r," of ms exceeded"),tn.ETIMEDOUT))},r);const f=()=>{t&&(u&&clearTimeout(u),u=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(d):v.removeEventListener("abort",d)}),t=null)};t.forEach(v=>v.addEventListener("abort",d));const{signal:g}=c;return g.unsubscribe=()=>ke.asap(f),g}},EA=l(NM),zF=vp.f("asyncIterator"),_me=l(zF);function bA(t,r){this.v=t,this.k=r}function Ai(t){return function(){return new Ig(t.apply(this,arguments))}}function Ig(t){var r,i;function s(d,u){try{var f=t[d](u),g=f.value,v=g instanceof bA;EA.resolve(v?g.v:g).then(function(_){if(v){var S=d==="return"?"return":"next";if(!g.k||_.done)return s(S,_);_=t[S](_).value}c(f.done?"return":"normal",_)},function(_){s("throw",_)})}catch(_){c("throw",_)}}function c(d,u){switch(d){case"return":r.resolve({value:u,done:!0});break;case"throw":r.reject(u);break;default:r.resolve({value:u,done:!1})}(r=r.next)?s(r.key,r.arg):i=null}this._invoke=function(d,u){return new EA(function(f,g){var v={key:d,arg:u,resolve:f,reject:g,next:null};i?i=i.next=v:(r=i=v,s(d,u))})},typeof t.return!="function"&&(this.return=void 0)}function vt(t){return new bA(t,0)}function wp(t){var r={},i=!1;function s(c,d){return i=!0,d=new EA(function(u){u(t[c](d))}),{done:!1,value:new bA(d,1)}}return r[bp!==void 0&&bF||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):s("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return s("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return i?(i=!1,c):s("return",c)}),r}Ig.prototype[typeof bp=="function"&&_me||"@@asyncIterator"]=function(){return this},Ig.prototype.next=function(t){return this._invoke("next",t)},Ig.prototype.throw=function(t){return this._invoke("throw",t)},Ig.prototype.return=function(t){return this._invoke("return",t)};var X0=l(zF);function SA(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=X0,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new J0(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function J0(t){function r(i){if(Object(i)!==i)return Ie.reject(new TypeError(i+" is not an object."));var s=i.done;return Ie.resolve(i.value).then(function(c){return{value:c,done:s}})}return J0=function(i){this.s=i,this.n=i.next},J0.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Ie.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Ie.reject(i):r(s.apply(this.s,arguments))}},new J0(t)}const Eme=function*(t,r){let i=t.byteLength;if(!r||i<r)return void(yield t);let s,c=0;for(;c<i;)s=c+r,yield t.slice(c,s),c=s},bme=function(){var t=Ai(function*(r,i){var s,c=!1,d=!1;try{for(var u,f=SA(Sme(r));c=!(u=yield vt(f.next())).done;c=!1){const g=u.value;yield*wp(SA(Eme(g,i)))}}catch(g){d=!0,s=g}finally{try{c&&f.return!=null&&(yield vt(f.return()))}finally{if(d)throw s}}});return function(r,i){return t.apply(this,arguments)}}(),Sme=function(){var t=Ai(function*(r){if(r[X0])return void(yield*wp(SA(r)));const i=r.getReader();try{for(;;){const{done:s,value:c}=yield vt(i.read());if(s)break;yield c}}finally{yield vt(i.cancel())}});return function(r){return t.apply(this,arguments)}}(),KF=(t,r,i,s)=>{const c=bme(t,r);let d,u=0,f=g=>{d||(d=!0,s&&s(g))};return new ReadableStream({async pull(g){try{const{done:v,value:_}=await c.next();if(v)return f(),void g.close();let S=_.byteLength;if(i){let w=u+=S;i(w)}g.enqueue(new Uint8Array(_))}catch(v){throw f(v),v}},cancel:g=>(f(g),c.return())},{highWaterMark:2})};function YF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function qF(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?YF(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):YF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const{isFunction:Q0}=ke,wme=(t=>{let{Request:r,Response:i}=t;return{Request:r,Response:i}})(ke.global),{ReadableStream:XF,TextEncoder:JF}=ke.global,QF=function(t){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return!!t(...i)}catch{return!1}},xme=t=>{t=ke.merge.call({skipUndefined:!0},wme,t);const{fetch:r,Request:i,Response:s}=t,c=r?Q0(r):typeof fetch=="function",d=Q0(i),u=Q0(s);if(!c)return!1;const f=c&&Q0(XF),g=c&&(typeof JF=="function"?(v=new JF,M=>v.encode(M)):async M=>new Uint8Array(await new i(M).arrayBuffer()));var v;const _=d&&f&&QF(()=>{let M=!1;const I=new i($i.origin,{body:new XF,method:"POST",get duplex(){return M=!0,"half"}}).headers.has("Content-Type");return M&&!I}),S=u&&f&&QF(()=>ke.isReadableStream(new s("").body)),w={stream:S&&(M=>M.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(M=>{!w[M]&&(w[M]=(I,k)=>{let G=I&&I[M];if(G)return G.call(I);throw new tn("Response type '".concat(M,"' is not supported"),tn.ERR_NOT_SUPPORT,k)})});const C=async(M,I)=>{const k=ke.toFiniteNumber(M.getContentLength());return k??(async G=>G==null?0:ke.isBlob(G)?G.size:ke.isSpecCompliantForm(G)?(await new i($i.origin,{method:"POST",body:G}).arrayBuffer()).byteLength:ke.isArrayBufferView(G)||ke.isArrayBuffer(G)?G.byteLength:(ke.isURLSearchParams(G)&&(G+=""),ke.isString(G)?(await g(G)).byteLength:void 0))(I)};return async M=>{let{url:I,method:k,data:G,signal:K,cancelToken:X,timeout:te,onDownloadProgress:ne,onUploadProgress:Z,responseType:ie,headers:ge,withCredentials:Ee="same-origin",fetchOptions:Me}=HF(M),at=r||fetch;ie=ie?(ie+"").toLowerCase():"text";let tt=yme([K,X&&X.toAbortSignal()],te),mt=null;const ht=tt&&tt.unsubscribe&&(()=>{tt.unsubscribe()});let Wt;try{if(Z&&_&&k!=="get"&&k!=="head"&&(Wt=await C(ge,G))!==0){let O,q=new i(I,{method:"POST",body:G,duplex:"half"});if(ke.isFormData(G)&&(O=q.headers.get("content-type"))&&ge.setContentType(O),q.body){const[ee,Ce]=FF(Wt,q0(BF(Z)));G=KF(q.body,65536,ee,Ce)}}ke.isString(Ee)||(Ee=Ee?"include":"omit");const En=d&&"credentials"in i.prototype,ye=qF(qF({},Me),{},{signal:tt,method:k.toUpperCase(),headers:ge.normalize().toJSON(),body:G,duplex:"half",credentials:En?Ee:void 0});mt=d&&new i(I,ye);let Ne=await(d?at(mt,Me):at(I,ye));const Be=S&&(ie==="stream"||ie==="response");if(S&&(ne||Be&&ht)){const O={};["status","statusText","headers"].forEach(lt=>{O[lt]=Ne[lt]});const q=ke.toFiniteNumber(Ne.headers.get("content-length")),[ee,Ce]=ne&&FF(q,q0(BF(ne),!0))||[];Ne=new s(KF(Ne.body,65536,ee,()=>{Ce&&Ce(),ht&&ht()}),O)}ie=ie||"text";let _e=await w[ke.findKey(w,ie)||"text"](Ne,M);return!Be&&ht&&ht(),await new Ie((O,q)=>{VF(O,q,{data:_e,headers:po.from(Ne.headers),status:Ne.status,statusText:Ne.statusText,config:M,request:mt})})}catch(En){throw ht&&ht(),En&&En.name==="TypeError"&&/Load failed|fetch/i.test(En.message)?Object.assign(new tn("Network Error",tn.ERR_NETWORK,M,mt),{cause:En.cause||En}):tn.from(En,En&&En.code,M,mt)}}},Tme=new Map,ZF=t=>{let r=t&&t.env||{};const{fetch:i,Request:s,Response:c}=r,d=[s,c,i];let u,f,g=d.length,v=Tme;for(;g--;)u=d[g],f=v.get(u),f===void 0&&v.set(u,f=g?new Map:xme(r)),v=f;return f};ZF();const wA={http:null,xhr:vme,fetch:{get:ZF}};ke.forEach(wA,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const e5=t=>"- ".concat(t),Cme=t=>ke.isFunction(t)||t===null||t===!1;var t5={getAdapter:function(t,r){t=ke.isArray(t)?t:[t];const{length:i}=t;let s,c;const d={};for(let u=0;u<i;u++){let f;if(s=t[u],c=s,!Cme(s)&&(c=wA[(f=String(s)).toLowerCase()],c===void 0))throw new tn("Unknown adapter '".concat(f,"'"));if(c&&(ke.isFunction(c)||(c=c.get(r))))break;d[f||"#"+u]=c}if(!c){const u=Object.entries(d).map(f=>{let[g,v]=f;return"adapter ".concat(g," ")+(v===!1?"is not supported by the environment":"is not available in the build")});throw new tn("There is no suitable adapter to dispatch the request "+(i?u.length>1?`since :
`+u.map(e5).join(`
`):" "+e5(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return c},adapters:wA};function xA(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Sp(null,t)}function n5(t){return xA(t),t.headers=po.from(t.headers),t.data=yA.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),t5.getAdapter(t.adapter||gA.adapter,t)(t).then(function(r){return xA(t),r.data=yA.call(t,t.transformResponse,r),r.headers=po.from(r.headers),r},function(r){return UF(r)||(xA(t),r&&r.response&&(r.response.data=yA.call(t,t.transformResponse,r.response),r.response.headers=po.from(r.response.headers))),Ie.reject(r)})}const r5="1.13.2",Z0={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{Z0[t]=function(i){return typeof i===t||"a"+(r<1?"n ":" ")+t}});const i5={};Z0.transitional=function(t,r,i){function s(c,d){return"[Axios v"+r5+"] Transitional option '"+c+"'"+d+(i?". "+i:"")}return(c,d,u)=>{if(t===!1)throw new tn(s(d," has been removed"+(r?" in "+r:"")),tn.ERR_DEPRECATED);return r&&!i5[d]&&(i5[d]=!0,console.warn(s(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,u)}},Z0.spelling=function(t){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(t)),!0)};var eE={assertOptions:function(t,r,i){if(typeof t!="object")throw new tn("options must be an object",tn.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let c=s.length;for(;c-- >0;){const d=s[c],u=r[d];if(u){const f=t[d],g=f===void 0||u(f,d,t);if(g!==!0)throw new tn("option "+d+" must be "+g,tn.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new tn("Unknown option "+d,tn.ERR_BAD_OPTION)}},validators:Z0};const nc=eE.validators;let tE=class{constructor(t){this.defaults=t||{},this.interceptors={request:new l4,response:new l4}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const c=s.stack?s.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=hu(this.defaults,r);const{transitional:i,paramsSerializer:s,headers:c}=r;i!==void 0&&eE.assertOptions(i,{silentJSONParsing:nc.transitional(nc.boolean),forcedJSONParsing:nc.transitional(nc.boolean),clarifyTimeoutError:nc.transitional(nc.boolean)},!1),s!=null&&(ke.isFunction(s)?r.paramsSerializer={serialize:s}:eE.assertOptions(s,{encode:nc.function,serialize:nc.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),eE.assertOptions(r,{baseUrl:nc.spelling("baseURL"),withXsrfToken:nc.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&ke.merge(c.common,c[r.method]);c&&ke.forEach(["delete","get","head","post","put","patch","common"],C=>{delete c[C]}),r.headers=po.concat(d,c);const u=[];let f=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(r)===!1||(f=f&&C.synchronous,u.unshift(C.fulfilled,C.rejected))});const g=[];let v;this.interceptors.response.forEach(function(C){g.push(C.fulfilled,C.rejected)});let _,S=0;if(!f){const C=[n5.bind(this),void 0];for(C.unshift(...u),C.push(...g),_=C.length,v=Ie.resolve(r);S<_;)v=v.then(C[S++],C[S++]);return v}_=u.length;let w=r;for(;S<_;){const C=u[S++],M=u[S++];try{w=C(w)}catch(I){M.call(this,I);break}}try{v=n5.call(this,w)}catch(C){return Ie.reject(C)}for(S=0,_=g.length;S<_;)v=v.then(g[S++],g[S++]);return v}getUri(t){return c4(WF((t=hu(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};ke.forEach(["delete","get","head","options"],function(t){tE.prototype[t]=function(r,i){return this.request(hu(i||{},{method:t,url:r,data:(i||{}).data}))}}),ke.forEach(["post","put","patch"],function(t){function r(i){return function(s,c,d){return this.request(hu(d||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}tE.prototype[t]=r(),tE.prototype[t+"Form"]=r(!0)});var nE=tE;class TA{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Ie(function(c){i=c});const s=this;this.promise.then(c=>{if(!s._listeners)return;let d=s._listeners.length;for(;d-- >0;)s._listeners[d](c);s._listeners=null}),this.promise.then=c=>{let d;const u=new Ie(f=>{s.subscribe(f),d=f}).then(c);return u.cancel=function(){s.unsubscribe(d)},u},r(function(c,d,u){s.reason||(s.reason=new Sp(c,d,u),i(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=s=>{r.abort(s)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new TA(function(s){r=s}),cancel:r}}}var Rme=TA;const CA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(CA).forEach(t=>{let[r,i]=t;CA[i]=r});var Ame=CA;const Jr=function t(r){const i=new nE(r),s=HV(nE.prototype.request,i);return ke.extend(s,nE.prototype,i,{allOwnKeys:!0}),ke.extend(s,i,null,{allOwnKeys:!0}),s.create=function(c){return t(hu(r,c))},s}(gA);Jr.Axios=nE,Jr.CanceledError=Sp,Jr.CancelToken=Rme,Jr.isCancel=UF,Jr.VERSION=r5,Jr.toFormData=j0,Jr.AxiosError=tn,Jr.Cancel=Jr.CanceledError,Jr.all=function(t){return Ie.all(t)},Jr.spread=function(t){return function(r){return t.apply(null,r)}},Jr.isAxiosError=function(t){return ke.isObject(t)&&t.isAxiosError===!0},Jr.mergeConfig=hu,Jr.AxiosHeaders=po,Jr.formToJSON=t=>jF(ke.isHTMLForm(t)?new FormData(t):t),Jr.getAdapter=t5.getAdapter,Jr.HttpStatusCode=Ame,Jr.default=Jr;var Ni=Jr;const Nme=()=>{};function Pg(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Nme};return t.promise=new Ie((r,i)=>{t.resolve=s=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(s),t.value=s)},t.reject=s=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,i(s))}}),t}const rE=new Map,iE=new Map,rc=new Map;let lr=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Ft=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const a5=new dhe;let fo=a5.getResult(),RA=null;function jt(t){if(!RA){fo=a5.getResult();const r=function(f){if(f.engine.name==="Blink"&&f.browser.name!=="WeChat")return Ft.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ft.CHROME;case"Safari":case"Mobile Safari":return Ft.SAFARI;case"Edge":return Ft.EDGE;case"Firefox":return Ft.FIREFOX;case"QQ":case"QQBrowser":return Ft.QQ;case"Opera":return Ft.OPERA;case"WeChat":return Ft.WECHAT;default:return f.browser.name||""}}(fo),i=s5(fo),s=function(f){return f.os.name==="Windows"?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||""}(fo),c=fo.os.version,d=s5(fo,!1),u=fo.device.type;if(!(r&&i&&s&&c))return{name:r,version:i,os:s,osVersion:c,browserVersion:d,deviceType:u};RA={name:r,version:i,os:s,osVersion:c,browserVersion:d,deviceType:u}}return RA}function s5(t){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",i?r.split(".")[0]:r}function aE(){return jt().os}function o5(){const t=jt();return"".concat(t.os," ").concat(t.osVersion)}function sE(){const t=jt();return!!(fo.engine.name==="WebKit"&&t.os===lr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Ft.SAFARI||Qr()&&t.name!==Ft.SAFARI)}function $c(){return jt().name===Ft.CHROME}function Er(){return jt().name===Ft.SAFARI}function c5(){const t=jt();if(t.name!==Ft.SAFARI||!t.browserVersion)return!1;const r=t.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function l5(){return jt().name===Ft.EDGE}function fn(){return jt().name===Ft.FIREFOX}function Qr(){return jt().os===lr.IOS}function mo(t){const r=jt();return!(r.name!==Ft.CHROME||!r.osVersion)&&Number(r.version)>=t}function d5(t){const r=jt();return!(r.name!==Ft.CHROME||!r.osVersion)&&Number(r.version)<t}function AA(t,r,i){const s=jt();return!(s.name!==t||!s.osVersion)&&(i?Number(s.version)>=r&&Number(s.version)<=i:Number(s.version)===r)}function $l(t){const r=jt();return!(r.name!==Ft.EDGE||!r.osVersion)&&Number(r.version)>=t}function NA(t){const r=jt();return!(r.name!==Ft.FIREFOX||!r.osVersion)&&Number(r.version)>=t}function u5(t){const r=jt();return!(r.name!==Ft.SAFARI||!r.osVersion)&&Number(r.version)>=t}function h5(t,r,i){const s=jt();if(s.os!==lr.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])>r||Number(c[0])>t:r?Number(c[0])===t&&Number(c[1])>=r||Number(c[0])>t:Number(c[0])>=t}function p5(t,r,i){const s=jt();if(s.os!==lr.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function OA(t,r,i){const s=jt();if(s.name!==Ft.SAFARI||!s.osVersion||!s.browserVersion)return!1;const c=s.browserVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function pu(t){const r=jt();return!(r.name!==Ft.OPERA||!r.osVersion)&&Number(r.version)>=t}function f5(){const t=jt();if(t.os!==lr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function xp(){const t=jt();if(t.os!==lr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function IA(){const t=jt();if(t.os!==lr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function m5(){const t=jt();if(t.os!==lr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Rs(){return Er()&&navigator.maxTouchPoints>0}function g5(){return jt().name===Ft.WECHAT}function v5(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function y5(){const t=aE();return function(){const{deviceType:r}=jt();return r==="mobile"||r==="tablet"}()||t===lr.ANDROID||t===lr.IOS||t===lr.HARMONY_OS}function ic(){const t=jt();return t.name!==Ft.EDGE&&t.name!==Ft.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Dg(){return aE()===lr.ANDROID}function kg(){const t=jt();return Dg()&&(t.name===Ft.CHROME||t.name===Ft.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function dt(t,r,i){return(r=function(s){var c=function(d,u){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var g=f.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function _5(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ae(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?_5(Object(i),!0).forEach(function(s){dt(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_5(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let $=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),pe=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),dt(this,"code",void 0),dt(this,"message",void 0),dt(this,"data",void 0),dt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function As(t,r){if(typeof t!="boolean")throw new pe($.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Fn(t,r,i){if(!xe(i).call(i,t))throw new pe($.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function nn(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<i||t>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new pe($.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(s,"]. integer only"))}function PA(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new pe($.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&nn(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&nn(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&nn(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&nn(t.ideal,"".concat(r,".ideal"),1,1/0)}else nn(t,r,1,1/0)}function Or(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new pe($.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!E5(t,i,s,c))throw new pe($.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function Hc(t,r){if(!Array.isArray(t))throw new pe($.INVALID_PARAMS,"".concat(r," should be an array"))}function An(t){return t==null}function E5(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=i&&t.length>=r&&(!s||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const u=c.charCodeAt(d);if(u<0||u>255)return!1}return!0}(t))}function b5(t,r,i){if("getBigUint64"in DataView.prototype)return t.getBigUint64(r,i);const s=t.getUint32(r,i),c=t.getUint32(r+4,i),d=0,u=+!i;return BigInt(s*u+c*d)<<BigInt(32)|BigInt(s*d+c*u)}function S5(t,r,i,s){if("setBigUint64"in DataView.prototype)return t.setBigUint64(r,i,s);const c=Number(i>>BigInt(32)),d=Number(i&BigInt(4294967295));t.setUint32(r,c,s),t.setUint32(r+4,d,s)}var Lg=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Lg||{}),DA=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(DA||{});const w5=new class{constructor(){dt(this,"_clientSize",null),dt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),dt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),dt(this,"getStyle",t=>window.getComputedStyle(t,null)),dt(this,"checkCssVisibleProperty",t=>{var r;let i=!0;const s=this.getStyle(t),{display:c,visibility:d,opacity:u,filter:f}=s;return(c==="none"||xe(r=["hidden","collapse"]).call(r,d)||Number(u)<.1)&&(i=!1),!!i&&(f&&f.split(" ").filter(g=>{var v;const _=g.split("(")[0];return xe(v=["brightness","blur","opacity"]).call(v,_)}).map(g=>{const[v,_]=g.split(/\(|\)/);return[v,Number(_.match(/^[0-9\.]+/))]}).forEach(g=>{const[v,_]=g;switch(v){case"brightness":(_<.1||_>3)&&(i=!1);break;case"blur":_>3&&(i=!1);break;case"opacity":_<.1&&(i=!1)}}),i)}),dt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let i=!0,s=!0;const c=u=>r(u);let d=t;for(;d&&s;)c(d)||(i=!1,s=!1),d=d.parentElement,d||(s=!1);return i}),dt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),dt(this,"getSizeAboutClient",t=>{const{width:r,height:i,left:s,right:c,top:d,bottom:u}=t.getBoundingClientRect(),f=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:i,left:s,right:c,top:d,bottom:u,clientWidth:f,clientHeight:g,clientMin:Math.min(f,g)}}),dt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(t,r,i)}),dt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),dt(this,"checkCoverForAPoint",(t,r,i)=>{const s=this.elementFromPoint(t,r);return s!==null&&s!==i}),dt(this,"getPointPositionList",()=>{const{width:t,height:r,left:i,top:s}=this._clientSize,c=t/6,d=r/6,u=[],f=10**6;for(let g=0;g<5;g++)for(let v=0;v<5;v++){const _=(i*f+(g===0?.1:g===4?(c*g*f-1e5)/f:c*g)*f)/f,S=(s*f+(v===0?.1:v===4?(d*v*f-1e5)/f:d*v)*f)/f;u.push({x:_,y:S})}return[...u]}),dt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),dt(this,"checkSizeIsVisible",(t,r,i)=>(t>50||i/t<=10)&&(r>50||i/r<=10)),dt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:i,bottom:s,clientHeight:c,clientWidth:d,clientMin:u}=this._clientSize;let f,g,v,_;if(t<0)f=0;else{if(!(t<d))return!1;f=t}if(r<0)return!1;if(g=r<d?r:d,i<0)v=0;else{if(!(i<c))return!1;v=i}if(s<0)return!1;_=s<c?s:c;const S=g-f,w=_-v;return this.checkSizeIsVisible(S,w,u)}),dt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),dt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Lg.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(Lg.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Lg.SIZE)}}return this.returnHiddenResult(Lg.STYLE)}return this.returnHiddenResult(DA.UNMOUNTED)}return this.returnHiddenResult(DA.INVALID_HTML_ELEMENT)}),dt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function kA(t){return new TextEncoder().encode(t)}const x5=function(t,r){const i=new Uint8Array(t.byteLength+r.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(r),t.byteLength),i},LA=async t=>function(r,i){let s="";return new Uint8Array(r).forEach(c=>{s+=c.toString(i).padStart(2,"0")}),s}(await crypto.subtle.digest("SHA-256",kA(t)),16);let Sn=class{constructor(){dt(this,"_events",{}),dt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,r);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(d=>d);for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];for(let d=0;d<r.length;d+=1){const u=r[d];u.once&&this.off(t,u.listener),u.listener.apply(this,s||[])}}safeEmit(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,i)}catch(d){console.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,r){let i=t.length;for(;i--;)if(t[i].listener===r)return i;return-1}},jg=null;function T5(){if(jg)return jg;if(window.electron)return jg=window.electron;if(!window.require)return null;try{return jg=window.require("electron"),jg}catch{return null}}let yn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t.VOS_FALLBACK_CN="vosFallbackCN",t.DATACHANNEL_FAILBACK="datachannelFailback",t}({}),rn=function(t){return t.TRACER="tracer",t}({});function C5(t){return nn(t.timeout,"config.timeout",0,1e5),nn(t.timeoutFactor,"config.timeoutFactor",0,100,!1),nn(t.maxRetryCount,"config.maxRetryConfig",0,1/0),nn(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Ome=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Ct=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.FALLBACK_TO_HLS="FALLBACK_TO_HLS",t.UID_CONFLICT="UID_CONFLICT",t}({});function fu(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function R5(t){return Or(t.turnServerURL,"turnServerURL"),Or(t.username,"username"),Or(t.password,"password"),t.udpport&&nn(t.udpport,"udpport",1,99999,!0),t.forceturn&&As(t.forceturn,"forceturn"),t.security&&As(t.security,"security"),t.tcpport&&nn(t.tcpport,"tcpport",1,99999,!0),!0}let Tp=function(t){return t[t.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",t[t.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",t[t.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",t}({});function jA(t){return t.level!==void 0&&Fn(t.level,"level",[1,2,3]),t.delay!==void 0&&nn(t.delay,"delay",0,3e3,!0),!0}let Et=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t.FALLBACK_TO_HLS="fallback-to-hls",t.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",t.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",t.AV1_DECODABLE_RESULT="av1-decodable-result",t}({}),MA=function(t){return t.CONFIG="config",t.VOSERROR="vos_error",t.AP_ERROR="ap_error",t}({}),Ur=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),vi=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),mu=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function qn(t,r){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return t.getListeners(r).length===0?Ie.reject(new pe($.UNEXPECTED_ERROR,"can not emit promise")):new Ie((d,u)=>{t.emit(r,...s,d,u)})}function cn(t,r){if(t.getListeners(r).length===0)return Ie.resolve();for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return qn(t,r,...s)}function da(t,r){if(t.getListeners(r).length===0)return null;for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return gu(t,r,...s)}function gu(t,r){let i=null,s=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),u=2;u<c;u++)d[u-2]=arguments[u];if(t.emit(r,...d,f=>{i=f},f=>{s=f}),s!==null)throw s;if(i===null)throw new pe($.UNEXPECTED_ERROR,"handler is not sync");return i}const Nn=new class extends Sn{set networkState(t){this.emit(mu.NETWORK_STATE_CHANGE,t,this._networkState),t===vi.ONLINE?this.emit(mu.ONLINE):t===vi.OFFLINE&&(this.onlineWaiter=new Ie(r=>{this.once(mu.ONLINE,()=>{this.onlineWaiter=void 0,r(vi.ONLINE)})}),this.emit(mu.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===vi.ONLINE}constructor(){super(),dt(this,"_moduleName","network-indicator"),dt(this,"_networkState",vi.ONLINE),dt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=vi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=vi.OFFLINE})}},Oi=[];for(let t=0;t<256;++t)Oi.push((t+256).toString(16).slice(1));const A5=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let UA;const Ime=new Uint8Array(16);function Pme(){return A5?A5():function(i,s,c){var d,u,f,g;const v=(d=(u=(i=i||{}).random)!==null&&u!==void 0?u:(f=(g=i).rng)===null||f===void 0?void 0:f.call(g))!==null&&d!==void 0?d:function(){if(!UA){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");UA=crypto.getRandomValues.bind(crypto)}return UA(Ime)}();if(v.length<16)throw new Error("Random bytes length must be >= 16");if(v[6]=15&v[6]|64,v[8]=63&v[8]|128,s){if((c=c||0)<0||c+16>s.length)throw new RangeError("UUID byte range ".concat(c,":").concat(c+15," is out of buffer bounds"));for(let _=0;_<16;++_)s[c+_]=v[_];return s}return function(_){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Oi[_[S+0]]+Oi[_[S+1]]+Oi[_[S+2]]+Oi[_[S+3]]+"-"+Oi[_[S+4]]+Oi[_[S+5]]+"-"+Oi[_[S+6]]+Oi[_[S+7]]+"-"+Oi[_[S+8]]+Oi[_[S+9]]+"-"+Oi[_[S+10]]+Oi[_[S+11]]+Oi[_[S+12]]+Oi[_[S+13]]+Oi[_[S+14]]+Oi[_[S+15]]).toLowerCase()}(v)}(t,r,void 0);var t,r}function oE(t,r){const i=t.indexOf(r);i!==-1&&t.splice(i,1)}function Cp(t){const r=[];return t.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function cE(t){Ie!==void 0?Ie.resolve().then(t):setTimeout(t,0)}function mn(t){return JSON.parse(JSON.stringify(t))}function vu(t){try{return mn(t)}catch{return t}}const N5={};function Hl(t,r){N5[r]||(N5[r]=!0,t())}function yu(t){const r=window.atob(t),i=new Uint8Array(new ArrayBuffer(r.length));for(let s=0;s<r.length;s+=1)i[s]=r.charCodeAt(s);return i}function zl(t){let r="";for(let i=0;i<t.length;i+=1)r+=String.fromCharCode(t[i]);return window.btoa(r)}function O5(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(t);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const s=new Uint8Array(r);s.set(i),i=s}return i}function I5(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=qa(r).call(r,(u,f)=>u+f.length,0),c=new Uint8Array(new ArrayBuffer(s));let d=0;return r.forEach(u=>{c.set(u,d),d+=u.length}),c}function ac(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function P5(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(i=>{r+=typeof i=="string"?ac(i):i.size}),r+138}function Dme(t){const r=new pe($.TIMEOUT,"timeout");return new Ie((i,s)=>{window.setTimeout(()=>s(r),t)})}function dr(t){return new Ie(r=>{window.setTimeout(r,t)})}function Kt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,t).toLowerCase();return i.length===t?"".concat(r).concat(i):"".concat(r).concat(i)+Kt(t-i.length,"")}function _u(){let t,r=!1;try{var i;t=lhe(i=Pme()).call(i,"-","")}catch{r=!0}return!r&&t&&t.length===32||(t=Kt(32,"")),t.toUpperCase()}const Mg=()=>{},D5=new class{constructor(){dt(this,"fnMap",new Map)}throttleByKey(t,r,i,s){for(var c=arguments.length,d=new Array(c>4?c-4:0),u=4;u<c;u++)d[u-4]=arguments[u];if(this.fnMap.has(r)){const f=this.fnMap.get(r);if(f.threshold!==i){f.fn(...f.args),clearTimeout(f.timer);const g=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:t,threshold:i,timer:g,args:d,skipFn:s})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(r,Ae(Ae({},f),{},{fn:t,args:d,skipFn:s}))}else{const f=window.setTimeout(()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:t,threshold:i,timer:f,args:d,skipFn:s})}}},k5=D5.throttleByKey.bind(D5);function L5(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function VA(t,r){if(!L5(t)||!L5(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const i=[...t];for(let s=0;s<r.length;s++)i[s]=VA(t[s],r[s]);return i}{const i=Ae({},t);for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&(Object.prototype.hasOwnProperty.call(t,s)?i[s]=VA(t[s],r[s]):i[s]=r[s]);return i}}function j5(t,r){let i=[0];if(i=new Array(r).fill(0),t===0)return i;let s=0;for(;t>0&&(i[s]=255&t,t>>=8,s++,s!==r););return i}function Rp(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function FA(t,r){try{return typeof t=="object"&&typeof r=="object"&&JSON.stringify(t)===JSON.stringify(r)}catch{return!1}}function BA(t){return qa(t).call(t,(r,i)=>r+i,0)}function M5(t){const r="0123456789abcdef";function i(X){let te,ne="";for(te=0;te<=3;te++)ne+=r.charAt(X>>8*te+4&15)+r.charAt(X>>8*te&15);return ne}function s(X,te){const ne=(65535&X)+(65535&te);return(X>>16)+(te>>16)+(ne>>16)<<16|65535&ne}function c(X,te,ne,Z,ie,ge){return s(function(Ee,Me){return Ee<<Me|Ee>>>32-Me}(s(s(te,X),s(Z,ge)),ie),ne)}function d(X,te,ne,Z,ie,ge,Ee){return c(te&ne|~te&Z,X,te,ie,ge,Ee)}function u(X,te,ne,Z,ie,ge,Ee){return c(te&Z|ne&~Z,X,te,ie,ge,Ee)}function f(X,te,ne,Z,ie,ge,Ee){return c(te^ne^Z,X,te,ie,ge,Ee)}function g(X,te,ne,Z,ie,ge,Ee){return c(ne^(te|~Z),X,te,ie,ge,Ee)}const v=function(X){let te;const ne=1+(X.length+8>>6),Z=new Array(16*ne);for(te=0;te<16*ne;te++)Z[te]=0;for(te=0;te<X.length;te++)Z[te>>2]|=X.charCodeAt(te)<<te%4*8;return Z[te>>2]|=128<<te%4*8,Z[16*ne-2]=8*X.length,Z}(t);let _,S,w,C,M,I=1732584193,k=-271733879,G=-1732584194,K=271733878;for(_=0;_<v.length;_+=16)S=I,w=k,C=G,M=K,I=d(I,k,G,K,v[_+0],7,-680876936),K=d(K,I,k,G,v[_+1],12,-389564586),G=d(G,K,I,k,v[_+2],17,606105819),k=d(k,G,K,I,v[_+3],22,-1044525330),I=d(I,k,G,K,v[_+4],7,-176418897),K=d(K,I,k,G,v[_+5],12,1200080426),G=d(G,K,I,k,v[_+6],17,-1473231341),k=d(k,G,K,I,v[_+7],22,-45705983),I=d(I,k,G,K,v[_+8],7,1770035416),K=d(K,I,k,G,v[_+9],12,-1958414417),G=d(G,K,I,k,v[_+10],17,-42063),k=d(k,G,K,I,v[_+11],22,-1990404162),I=d(I,k,G,K,v[_+12],7,1804603682),K=d(K,I,k,G,v[_+13],12,-40341101),G=d(G,K,I,k,v[_+14],17,-1502002290),k=d(k,G,K,I,v[_+15],22,1236535329),I=u(I,k,G,K,v[_+1],5,-165796510),K=u(K,I,k,G,v[_+6],9,-1069501632),G=u(G,K,I,k,v[_+11],14,643717713),k=u(k,G,K,I,v[_+0],20,-373897302),I=u(I,k,G,K,v[_+5],5,-701558691),K=u(K,I,k,G,v[_+10],9,38016083),G=u(G,K,I,k,v[_+15],14,-660478335),k=u(k,G,K,I,v[_+4],20,-405537848),I=u(I,k,G,K,v[_+9],5,568446438),K=u(K,I,k,G,v[_+14],9,-1019803690),G=u(G,K,I,k,v[_+3],14,-187363961),k=u(k,G,K,I,v[_+8],20,1163531501),I=u(I,k,G,K,v[_+13],5,-1444681467),K=u(K,I,k,G,v[_+2],9,-51403784),G=u(G,K,I,k,v[_+7],14,1735328473),k=u(k,G,K,I,v[_+12],20,-1926607734),I=f(I,k,G,K,v[_+5],4,-378558),K=f(K,I,k,G,v[_+8],11,-2022574463),G=f(G,K,I,k,v[_+11],16,1839030562),k=f(k,G,K,I,v[_+14],23,-35309556),I=f(I,k,G,K,v[_+1],4,-1530992060),K=f(K,I,k,G,v[_+4],11,1272893353),G=f(G,K,I,k,v[_+7],16,-155497632),k=f(k,G,K,I,v[_+10],23,-1094730640),I=f(I,k,G,K,v[_+13],4,681279174),K=f(K,I,k,G,v[_+0],11,-358537222),G=f(G,K,I,k,v[_+3],16,-722521979),k=f(k,G,K,I,v[_+6],23,76029189),I=f(I,k,G,K,v[_+9],4,-640364487),K=f(K,I,k,G,v[_+12],11,-421815835),G=f(G,K,I,k,v[_+15],16,530742520),k=f(k,G,K,I,v[_+2],23,-995338651),I=g(I,k,G,K,v[_+0],6,-198630844),K=g(K,I,k,G,v[_+7],10,1126891415),G=g(G,K,I,k,v[_+14],15,-1416354905),k=g(k,G,K,I,v[_+5],21,-57434055),I=g(I,k,G,K,v[_+12],6,1700485571),K=g(K,I,k,G,v[_+3],10,-1894986606),G=g(G,K,I,k,v[_+10],15,-1051523),k=g(k,G,K,I,v[_+1],21,-2054922799),I=g(I,k,G,K,v[_+8],6,1873313359),K=g(K,I,k,G,v[_+15],10,-30611744),G=g(G,K,I,k,v[_+6],15,-1560198380),k=g(k,G,K,I,v[_+13],21,1309151649),I=g(I,k,G,K,v[_+4],6,-145523070),K=g(K,I,k,G,v[_+11],10,-1120210379),G=g(G,K,I,k,v[_+2],15,718787259),k=g(k,G,K,I,v[_+9],21,-343485551),I=s(I,S),k=s(k,w),G=s(G,C),K=s(K,M);return i(I)+i(k)+i(G)+i(K)}let kme=1,U5=console,br=class{static setLogger(t){U5=t}constructor(t,r){dt(this,"id",void 0),dt(this,"lockingPromise",Ie.resolve()),dt(this,"locks",0),dt(this,"name",""),dt(this,"lockId",void 0),this.lockId=kme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");U5.debug("".concat(i," ").concat(s))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const i=new Ie(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),s=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),s}};function Ap(t,r){return function(i,s,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const u=this[r];if(!u)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const f=await u.lock("From ".concat(t,".").concat(s));try{for(var g=arguments.length,v=new Array(g),_=0;_<g;_++)v[_]=arguments[_];return await d.apply(this,v)}finally{f()}},c}}const Bn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function lE(t,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,i)}function go(t,r,i,s){const c=Object.assign({},Bn,s);let d=c.timeout;const u=async()=>{await function(v){return new Ie(_=>{window.setTimeout(_,v)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let f=!1;const g=new Ie(async(v,_)=>{r=r||(()=>!1),i=i||(()=>!0);for(let S=0;S<c.maxRetryCount;S+=1){if(f)return _(new pe($.OPERATION_ABORTED));try{const w=await t();if(!r(w,S)||S+1===c.maxRetryCount)return v(w);await u()}catch(w){if(!i(w,S)||S+1===c.maxRetryCount)return _(w);await u()}}});return g.cancel=()=>f=!0,g}let dE,WA=class{constructor(t){dt(this,"input",[]),dt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:qa(t=this.input).call(t,(r,i)=>r+i)/this.input.length}},uE=0,GA=0;function $A(t,r,i,s){return new Ie((c,d)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),uE+=ac(r.data)):i&&(r.data.size?uE+=r.data.size:r.data instanceof FormData?uE+=P5(r.data):uE+=ac(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Ni.request(r).then(u=>{typeof u.data=="string"?GA+=ac(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?GA+=u.data.byteLength:GA+=ac(JSON.stringify(u.data)),c(u.data)}).catch(u=>{Ni.isCancel(u)?d(new pe($.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?d(new pe($.NETWORK_TIMEOUT,u.message)):u.response?d(new pe($.NETWORK_RESPONSE_ERROR,u.response.status)):d(new pe($.NETWORK_ERROR,u.message))})})}async function Lme(t,r){const i=new Blob([r.data],{type:"buffer"});return await $A(t,Ae(Ae({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const V5=()=>window.isSecureContext!==void 0;function Ns(t){if(Array.isArray(t))return t.map(i=>i);if(!F5(t))return t;const r={};for(const i in t){const s=t[i];F5(s)||Array.isArray(s)?r[i]=Ns(s):r[i]=s}return r}function F5(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let HA=class{constructor(t){dt(this,"input",[]),dt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Os={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Ug={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Os,remoteCandidate:Os},updateInterval:0},B5={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},W5={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},G5={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},$5={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let zA=class{constructor(t,r){dt(this,"onFirstVideoReceived",void 0),dt(this,"onFirstVideoDecoded",void 0),dt(this,"onFirstAudioReceived",void 0),dt(this,"onFirstVideoDecodedTimeout",void 0),dt(this,"onFirstAudioDecoded",void 0),dt(this,"onSelectedLocalCandidateChanged",void 0),dt(this,"onSelectedRemoteCandidateChanged",void 0),dt(this,"videoIsReady",!1),dt(this,"videoIsReady2",{}),dt(this,"pc",void 0),dt(this,"options",void 0),dt(this,"intervalTimer",void 0),dt(this,"stats",Ns(Ug)),dt(this,"isFirstVideoReceived",{}),dt(this,"isFirstVideoDecoded",{}),dt(this,"isFirstAudioReceived",{}),dt(this,"isFirstAudioDecoded",{}),dt(this,"isFirstVideoDecodedTimeout",{}),dt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ie(t=>{t({local:Ae({},Os),remote:Ae({},Os)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,c=0,d=0,u=0;for(const f of i)t[f].forEach((g,v)=>{if(!this.lossRateWindowStats[r-1][f][v]||!this.lossRateWindowStats[0][f][v])return;const _=this.lossRateWindowStats[r-1][f][v].packets-this.lossRateWindowStats[0][f][v].packets,S=this.lossRateWindowStats[r-1][f][v].packetsLost-this.lossRateWindowStats[0][f][v].packetsLost;f==="videoSend"||f==="audioSend"?(s+=_,d+=S):(c+=_,u+=S),Number.isNaN(_)||Number.isNaN(_)?g.packetLostRate=0:g.packetLostRate=_<=0||S<=0?0:S/(_+S)});t.sendPacketLossRate=s<=0||d<=0?0:d/(s+d),t.recvPacketLossRate=c<=0||u<=0?0:u/(c+u)}},jme=class extends zA{constructor(){super(...arguments),dt(this,"_stats",Ug),dt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Ns(Ug);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const s=r.find(c=>c.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var i;const s=xe(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const c=Ns(W5);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Ns(B5),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const u=d.stats,f=Date.now()-d.lts;c.framesDecodeFreezeTime=u.framesDecodeFreezeTime,c.framesDecodeInterval=u.framesDecodeInterval,c.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=f,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Ae({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Ns($5);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Ns(G5);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new Ie((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{s[c]=i.stat(c)}),r.push(s)}),r}},Np=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),hE=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),KA=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),xa=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Op=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Op||{});function Vg(t,r,i,s){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Op.kNone;if(!r)return;const d=Number(r[i]);if(typeof d!="number")return;const u=Number(r[s]);if(typeof u!="number")return;if(!t)return u?d/u*c:void 0;const f=Number(t[i]);if(typeof f!="number")return;const g=Number(t[s]);if(typeof g!="number")return;const v=u-g;return v?(d-f)/v*c:void 0}let H5=class extends zA{constructor(){super(...arguments),dt(this,"_stats",Ug),dt(this,"report",void 0),dt(this,"lastDecodeVideoReceiverStats",new Map),dt(this,"lastVideoFramesRecv",new Map),dt(this,"lastVideoFramesSent",new Map),dt(this,"lastVideoFramesDecode",new Map),dt(this,"lastVideoFramesOutput",new Map),dt(this,"lastVideoJBDelay",new Map),dt(this,"lastAudioJBDelay",new Map),dt(this,"mediaBytesSent",new Map),dt(this,"mediaBytesRetransmit",new Map),dt(this,"mediaBytesTargetEncode",new Map),dt(this,"lastDecodeAudioReceiverStats",new Map),dt(this,"lastAudioConcealment",new Map),dt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ns(Ug),this.report.forEach(t=>{switch(t.type){case xa.OUTBOUND:case xa.INBOUND:{const r=t.mediaType||t.kind,i=!r&&"frameWidth"in t,s=!r&&!("frameWidth"in t);t.type===xa.OUTBOUND?r==="audio"||s?this.processAudioOutboundStats(t):(r==="video"||i)&&this.processVideoOutboundStats(t):t.type===xa.INBOUND&&(r==="audio"||s?this.processAudioInboundStats(t):(r==="video"||i)&&this.processVideoInboundStats(t));break}case xa.TRANSPORT:{this.processTransportStats(t);const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case xa.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:Ae({},Os),remote:Ae({},Os)};return t.forEach(i=>{let s;if(i.type===xa.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===xa.CANDIDATE_PAIR&&i.selected&&(s=i),s){const c=(d,u)=>{d.type=u.type,d.id=u.id,u.address&&(d.address=u.address),u.candidateType&&(d.candidateType=u.candidateType),u.port&&(d.port=u.port),u.priority&&(d.priority=u.priority),u.protocol&&(d.protocol=u.protocol),u.relayProtocol&&(d.relayProtocol=u.relayProtocol)};if(s.localCandidateId){const d=t.get(s.localCandidateId);d&&c(r.local,d)}if(s.remoteCandidateId){const d=t.get(s.remoteCandidateId);d&&c(r.remote,d)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===xa.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===xa.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===xa.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ae({},r),Ae({},this.stats.selectedCandidatePair.localCandidate)),t.type===xa.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ae({},r),Ae({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(s=>s.ssrc===t.ssrc);r||(r=Ns($5),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount,r.estimatedPlayoutTimestamp=t.estimatedPlayoutTimestamp;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=Vg(i,r,"totalProcessingDelay","jitterBufferEmittedCount",Op.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),this.calculateAudioFreeze(r,i,t),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,Ae({},r))}calculateAudioFreeze(t,r,i){const s=this.lastAudioConcealment.get(t.ssrc);if(r!=null&&s!=null){const c=s.lts,d=i.timestamp,u=d-c;if(u<=0)return;const f=t.concealedSamples-r.concealedSamples-0,g=s.nonSilent+f,v=t.totalSamplesReceived-r.totalSamplesReceived;if(v<=0)return;const _=80*v/u,S=200*v/u,w=u/v;let C=0;t.freezeSamples80=r.freezeSamples80,t.freezeMs80=r.freezeMs80,g>_&&(s.plc80>0?(t.freezeSamples80+=f,t.freezeMs80+=Math.round(f*w)):(t.freezeSamples80+=g,t.freezeMs80+=Math.round(g*w)),C=s.plc80+1);let M=0;t.freezeSamples200=r.freezeSamples200,t.freezeMs200=r.freezeMs200,g>S&&(s.plc200>0?(t.freezeSamples200+=f,t.freezeMs200+=Math.round(f*w)):(t.freezeSamples200+=g,t.freezeMs200+=Math.round(g*w)),M=s.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:f,lts:d,plc80:C,plc200:M})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:i.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let r=this._stats.videoRecv.find(u=>u.ssrc===t.ssrc);r||(r=Ns(B5),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.estimatedPlayoutTimestamp=t.estimatedPlayoutTimestamp;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),s=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const u=r.decodedFrame?r.decodedFrame.width:0,f=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,u,f),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const u=i.stats,f=d-i.lts;r.framesDecodeFreezeTime=u.framesDecodeFreezeTime,r.framesDecodeInterval=u.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=f,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<u.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=Vg(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=Vg(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",Op.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=Vg(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Op.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=Vg(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",Op.kMillisecondsFromSeconds),s&&d-s.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-s.count)/((d-s.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):s?r.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Ae({},r),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);r||(r=Ns(W5),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const s=new HA(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{const c=new HA(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{const c=new HA(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,r.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-s.lastFrameCount,d=t.totalEncodeTime-s.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,xa.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(r||(r=Ns(G5),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const i=this.findRemoteStatsId(t.ssrc,xa.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}processTransportStats(t){this._stats.transport.bytesReceived=t.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=t.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=t.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=t.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(t,r){var i;const s=Array.from(oa(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===t);return s?s.id:null}processVideoMediaSource(t,r){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,r){const i=this.report.get(t);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,r,i){var s,c,d,u;const f=r?this.report.get(r):void 0,g=(s=f==null?void 0:f.framesSent)!==null&&s!==void 0?s:t.framesSent;if(typeof g!="number")return;let v=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:t.frameWidth,_=(d=f==null?void 0:f.frameHeight)!==null&&d!==void 0?d:t.frameHeight,S=(u=f==null?void 0:f.framesPerSecond)!==null&&u!==void 0?u:t.framesPerSecond;if(typeof v=="number"&&typeof _=="number"||(v=0,_=0),S==null){const w=Date.now(),C=this.lastVideoFramesSent.get(i.ssrc);C&&w-C.lts>=800?(S=Math.round((g-C.count)/((w-C.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:g,lts:w,rate:S})):C?S=C.rate:this.lastVideoFramesSent.set(i.ssrc,{count:g,lts:w,rate:0})}i.sentFrame={width:v,height:_,frameRate:Math.max(0,S)}}processVideoTrackReceiverStats(t,r,i){var s,c,d,u,f;const g=r?this.report.get(r):void 0,v=(s=g==null?void 0:g.framesReceived)!==null&&s!==void 0?s:t.framesReceived,_=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:t.frameWidth,S=(d=g==null?void 0:g.frameHeight)!==null&&d!==void 0?d:t.frameHeight,w=(u=g==null?void 0:g.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,C=(f=g==null?void 0:g.jitterBufferEmittedCount)!==null&&f!==void 0?f:t.jitterBufferEmittedCount;if(typeof v=="number"){const M=this.lastVideoFramesRecv.get(i.ssrc),I=Date.now();i.framesReceivedCount=v;let k=0;M&&I-M.lts>=800?(k=Math.round((v-M.count)/((I-M.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:I,rate:k})):M?k=M.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:I,rate:0}),i.receivedFrame={width:_||0,height:S||0,frameRate:k||0},i.decodedFrame={width:_||0,height:S||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:_||0,height:S||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(w&&C){const M=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=M.jitterBufferMs;const k=C-M.jitterBufferEmittedCount;k>0&&(I=1e3*(w-M.jitterBufferDelay)/k),i.jitterBufferMs=I,i.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:C,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,r,i){var s,c,d,u;const f=r?this.report.get(r):void 0,g=(s=(c=f==null?void 0:f.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&s!==void 0?s:0,v=(d=(u=f==null?void 0:f.echoReturnLossEnhancement)!==null&&u!==void 0?u:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;i.aecReturnLoss=g,i.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,i){var s,c,d,u,f,g,v,_,S;const w=r?this.report.get(r):void 0,C=(s=w==null?void 0:w.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,M=(c=w==null?void 0:w.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,I=(d=w==null?void 0:w.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,k=(u=w==null?void 0:w.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount,G=(f=w==null?void 0:w.audioLevel)!==null&&f!==void 0?f:t==null?void 0:t.audioLevel,K=(g=w==null?void 0:w.totalSamplesDuration)!==null&&g!==void 0?g:t==null?void 0:t.totalSamplesDuration,X=(v=w==null?void 0:w.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples,te=(_=w==null?void 0:w.silentConcealedSamples)!==null&&_!==void 0?_:t.silentConcealedSamples,ne=(S=w==null?void 0:w.concealmentEvents)!==null&&S!==void 0?S:t.concealmentEvents;if(typeof M=="number"&&(i.totalSamplesReceived=M),typeof te=="number"&&(i.silentConcealedSamples=te),typeof ne=="number"&&(i.concealmentEvents=ne),typeof X=="number"&&(i.concealedSamples=X),C&&M&&(i.accelerateRate=C/M),I&&k){const ie=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ge=ie.jitterBufferMs;const Ee=k-ie.jitterBufferEmittedCount;Ee>0&&(ge=1e3*(I-ie.jitterBufferDelay)/Ee),i.jitterBufferMs=Math.round(ge),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:k,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=G;let Z=1920;K&&M&&(Z=M/K/50,i.receivedFrames=Math.round(M/Z)),X&&(i.droppedFrames=Math.round(X/Z))}processRemoteInboundStats(t,r){const i=this.report.get(t);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const s=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Mme=class extends zA{updateStats(){return Ie.resolve()}};function pE(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const u=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return u&&u[0]?Number(u[0].split("/")[1]):null}();return d?d<76?new jme(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new H5(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):function(u){if(!window.RTCStatsReport)return!1;const f=u.getStats();return!!(f instanceof Ie||function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"}(f))}(t)?new H5(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new Mme(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c})}const z5="websdk_ng_install_id";function YA(){try{if(W("INSTALL_ID"))return W("INSTALL_ID");let t=window.localStorage.getItem(z5);return t||(t=_u(),window.localStorage.setItem(z5,t)),Zt("INSTALL_ID",t),t}catch{return}}const Ja=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],s=r[2];return"".concat(i,".").concat(s)}return"4.0.0.999"}("4.24.2"),qA=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Eu=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Vr=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const s=i.join(""),c=[];for(let f=0;f<6;f++)c.push("1");const d=c.join(""),u={};return u[t]=s,u[r]=d,Object.assign(u,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Vr;const fE={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},XA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},JA="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",QA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},Yt=Ae(Ae(Ae(Ae({},QA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:XA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},fE),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function Zt(t,r,i){var s,c,d;xe(s=Object.keys(Yt)).call(s,t)&&(!i&&xe(c=Object.keys(Ta)).call(c,t)||(Yt[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||r!==!0||(Yt.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,Yt.USE_NEW_NETWORK_CONFIG=d,d&&(Yt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Yt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Yt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Yt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Yt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Yt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Yt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(Yt.ENABLE_INSTANT_VIDEO=!0,Yt.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(Yt.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(Yt.NEW_TURN_MODE||(Yt.NEW_TURN_MODE=4))))}function W(t){if(t==="TURN_DOMAINS"){const r=Yt.TURN_DOMAINS;return xe(r).call(r,W("TURN_DOMAIN"))?r:[W("TURN_DOMAIN")].concat(r)}return Yt[t]}qA||(Yt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Yt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Yt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Yt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Yt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Yt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Yt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Yt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Yt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Yt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Yt.AREAS=["NORTH_AMERICA","OVERSEA"]);let K5=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Ta={};var st=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_RTE_URL="SET_RTE_URL",t.SET_RTE_SID="SET_RTE_SID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(st||{});let bu=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const Y5=128,Ume=96,q5=1e3,Ip=10;let Vme=0;var X5=(()=>{var t={8:(s,c,d)=>{d.r(c),d.d(c,{Parser:()=>Ee,Printer:()=>ht,parse:()=>Ne,print:()=>Be});const u=`
`,f="".concat("\r").concat(u),g=" ";let v;function _(_e){return _e>="0"&&_e<="9"}function S(_e){return _e>="!"&&_e<="~"}function w(_e){return S(_e)||_e>=""&&_e<=""}function C(_e){return _e==="!"||_e>="#"&&_e<="'"||_e>="*"&&_e<="+"||_e>="-"&&_e<="."||_e>="0"&&_e<="9"||_e>="A"&&_e<="Z"||_e>="^"&&_e<="~"}function M(_e){return _e>="1"&&_e<="9"}function I(_e){return _e>="A"&&_e<="Z"||_e>="a"&&_e<="z"}function k(_e){return _e==="d"||_e==="h"||_e==="m"||_e==="s"}function G(_e){return _e>""&&_e<"	"||_e>"\v"&&_e<"\f"||_e>""&&_e<""}function K(_e){return I(_e)||_(_e)||_e==="+"||_e==="/"}function X(_e){return _(_e)||I(_e)||_e==="+"||_e==="/"||_e==="-"||_e==="_"}function te(_e){return I(_e)||_(_e)||_e==="+"||_e==="/"}function ne(_e,O){var q=Object.keys(_e);if(Object.getOwnPropertySymbols){var ee=Object.getOwnPropertySymbols(_e);O&&(ee=ee.filter(function(Ce){return Object.getOwnPropertyDescriptor(_e,Ce).enumerable})),q.push.apply(q,ee)}return q}function Z(_e){for(var O=1;O<arguments.length;O++){var q=arguments[O]!=null?arguments[O]:{};O%2?ne(Object(q),!0).forEach(function(ee){ie(_e,ee,q[ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(q)):ne(Object(q)).forEach(function(ee){Object.defineProperty(_e,ee,Object.getOwnPropertyDescriptor(q,ee))})}return _e}function ie(_e,O,q){return O in _e?Object.defineProperty(_e,O,{value:q,enumerable:!0,configurable:!0,writable:!0}):_e[O]=q,_e}(function(_e){_e.VERSION="v",_e.ORIGIN="o",_e.SESSION_NAME="s",_e.INFORMATION="i",_e.URI="u",_e.EMAIL="e",_e.PHONE="p",_e.CONNECTION="c",_e.BANDWIDTH="b",_e.TIME="t",_e.REPEAT="r",_e.ZONE_ADJUSTMENTS="z",_e.KEY="k",_e.ATTRIBUTE="a",_e.MEDIA="m"})(v||(v={}));class ge{consumeText(O,q){let ee=q;for(;ee<O.length;){const Ce=O[ee];if(Ce==="\0"||Ce==="\r"||Ce===u)break;ee+=1}if(ee-q==0)throw new Error("Invalid text, at ".concat(O));return ee}consumeUnicastAddress(O,q,ee){return this.consumeTill(O,q,g)}consumeOneOrMore(O,q,ee){let Ce=q;for(;ee(O[Ce]);)Ce++;if(Ce-q==0)throw new Error("Invalid rule at ".concat(q,"."));return Ce}consumeSpace(O,q){if(O[q]===g)return q+1;throw new Error("Invalid space at ".concat(q,"."))}consumeIP4Address(O,q){let ee=q;for(let Ce=0;Ce<4;Ce++)if(ee=this.consumeDecimalUChar(O,ee),Ce!==3){if(O[ee]!==".")throw new Error("Invalid IP4 address.");ee++}return ee}consumeDecimalUChar(O,q){let ee=q;for(let lt=0;lt<3&&_(O[ee]);lt++,ee++);if(ee-q==0)throw new Error("Invalid decimal uchar.");const Ce=parseInt(O.slice(q,ee));if(Ce>=0&&Ce<=255)return ee;throw new Error("Invalid decimal uchar")}consumeIP6Address(O,q){let ee=this.consumeHexpart(O,q);return O[ee]===":"&&(ee+=1,ee=this.consumeIP4Address(O,ee)),ee}consumeHexpart(O,q){let ee=q;if(O[ee]===":"&&O[ee+1]===":"){ee+=2;try{ee=this.consumeHexseq(O,ee)}catch{}return ee}if(ee=this.consumeHexseq(O,ee),O[ee]===":"&&O[ee+1]===":"){ee+=2;try{ee=this.consumeHexseq(O,ee)}catch{}return ee}return ee}consumeHexseq(O,q){let ee=q;for(;ee=this.consumeHex4(O,ee),O[ee]===":"&&O[ee+1]!==":";)ee+=1;return ee}consumeHex4(O,q){let ee=0;for(;ee<4;ee++)if(!((Ce=O[q+ee])>="0"&&Ce<="9"||Ce>="a"&&Ce<="f"||Ce>="A"&&Ce<="F")){if(ee===0)throw new Error("Invalid hex 4");break}var Ce;return q+ee}consumeFQDN(O,q){let ee=q;for(;_(O[ee])||I(O[ee])||O[ee]==="-"||O[ee]===".";)ee+=1;if(ee-q<4)throw new Error("Invalid FQDN");return ee}consumeExtnAddr(O,q){return this.consumeOneOrMore(O,q,w)}consumeMulticastAddress(O,q,ee){switch(ee){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(O,q);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(O,q);default:try{return this.consumeFQDN(O,q)}catch{return this.consumeExtnAddr(O,q)}}}consumeIP6MulticastAddress(O,q){const ee=this.consumeHexpart(O,q);return O[ee]==="/"?this.consumeInteger(O,ee+1):ee}consumeIP4MulticastAddress(O,q){let ee=q+3;const Ce=O.slice(q,ee),lt=parseInt(Ce);if(lt<224||lt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dn=0;dn<3;dn++){if(O[ee]!==".")throw new Error("Invalid IP4 multicast address.");ee+=1,ee=this.consumeDecimalUChar(O,ee)}return O[ee]==="/"&&(ee+=1),ee=this.consumeTTL(O,ee),O[ee]==="/"&&(ee=this.consumeInteger(O,ee)),ee}consumeInteger(O,q){if(!M(O[q]))throw new Error("Invalid integer.");for(q+=1;_(O[q]);)q+=1;return q}consumeTTL(O,q){if(O[q]==="0")return q+1;if(!M(O[q]))throw new Error("Invalid TTL.");q+=1;for(let ee=0;ee<2&&_(O[q]);ee++)q+=1;return q}consumeToken(O,q){return this.consumeOneOrMore(O,q,C)}consumeTime(O,q){let ee=q;if(O[ee]==="0")return ee+1;for(M(O[ee])&&(ee+=1);_(O[ee]);)ee++;if(ee-q<10)throw new Error("Invalid time");return ee}consumeAddress(O,q){return this.consumeTill(O,q,g)}consumeTypedTime(O,q){let ee=q;return ee=this.consumeOneOrMore(O,ee,_),k(O[ee])?ee+1:ee}consumeRepeatInterval(O,q){if(!M(O[q]))throw new Error("Invalid repeat interval");for(q+=1;_(O[q]);)q+=1;return k(O[q])&&(q+=1),q}consumePort(O,q){return this.consumeOneOrMore(O,q,_)}consume(O,q,ee){for(let Ce=0;Ce<ee.length;Ce++){if(q+Ce>=O.length)throw new Error("consume exceeding value length");if(O[q+Ce]!==ee[Ce])throw new Error("consume ".concat(ee," failed at ").concat(Ce))}return q+ee.length}consumeTill(O,q,ee){let Ce=q;for(;Ce<O.length&&(typeof ee!="string"||O[Ce]!==ee)&&(typeof ee!="function"||!ee(O[Ce]));)Ce++;return Ce}}class Ee extends ge{constructor(){super(),ie(this,"records",[]),ie(this,"currentLine",0)}parse(O){const q=this.probeEOL(O);this.records=O.split(q).filter(dd=>!!mi(dd).call(dd)).map(this.parseLine),this.currentLine=0;const ee=this.parseVersion(),Ce=this.parseOrigin(),lt=this.parseSessionName(),dn=this.parseInformation(),fr=this.parseUri(),ss=this.parseEmail(),ld=this.parsePhone(),Ob=this.parseConnection(),df=this.parseBandWidth(),Ib=this.parseTimeFields(),Hu=this.parseKey(),wv=this.parseSessionAttribute(),zu=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ee,origin:Ce,sessionName:lt,information:dn,uri:fr,emails:ss,phones:ld,connection:Ob,bandwidths:df,timeFields:Ib,key:Hu,attributes:wv,mediaDescriptions:zu}}getCurrentRecord(){const O=this.records[this.currentLine];if(!O)throw new Error("Record doesn't exit.");return O}probeEOL(O){for(let q=0;q<O.length;q++)if(O[q]===u)return O[q-1]==="\r"?f:u;throw new Error("Invalid newline character.")}parseLine(O,q){if(O.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ee=O[0];if(O[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ee,value:O.slice(2),line:q,cur:0}}parseSessionAttribute(){const O=new at;for(;this.currentLine<this.records.length;){const q=this.getCurrentRecord();if(q.type!==v.ATTRIBUTE)break;const ee={attField:this.extractOneOrMore(q,Ce=>C(Ce)&&Ce!==":"),_cur:0};q.value[q.cur]===":"&&(q.cur+=1,ee.attValue=this.extractOneOrMore(q,G)),O.parse(ee),this.currentLine++}return O.digest()}parseMediaAttributes(O){const q=new tt(O);for(;this.currentLine<this.records.length;){const ee=this.getCurrentRecord();if(ee.type!==v.ATTRIBUTE)break;const Ce={attField:this.extractOneOrMore(ee,lt=>C(lt)&&lt!==":"),_cur:0};ee.value[ee.cur]===":"&&(ee.cur+=1,Ce.attValue=this.extractOneOrMore(ee,G)),q.parse(Ce),this.currentLine++}return q.digest()}parseKey(){const O=this.getCurrentRecord();if(O.type===v.KEY){if(O.value==="prompt"||O.value==="clear:"||O.value==="base64:"||O.value==="uri:")return O.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const O=this.getCurrentRecord();if(O.type===v.ZONE_ADJUSTMENTS){const q=[];for(;;)try{const ee=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);let Ce=!1;O.value[O.cur]==="-"&&(Ce=!0,O.cur+=1);const lt=this.extract(O,this.consumeTypedTime);q.push({time:ee,typedTime:lt,back:Ce})}catch{break}if(q.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,q}return[]}parseRepeat(){const O=[];for(;;){const q=this.getCurrentRecord();if(q.type!==v.REPEAT)break;{const ee=this.extract(q,this.consumeRepeatInterval),Ce=this.parseTypedTime(q);O.push({repeatInterval:ee,typedTimes:Ce}),this.currentLine++}}return O}parseTypedTime(O){const q=[];for(;;)try{this.consumeSpaceForRecord(O),q.push(this.extract(O,this.consumeTypedTime))}catch{break}if(q.length===0)throw new Error("Invalid typed time.");return q}parseTime(){const O=this.getCurrentRecord(),q=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);const ee=this.extract(O,this.consumeTime);return this.currentLine++,{startTime:q,stopTime:ee}}parseBandWidth(){const O=[];for(;this.currentLine<this.records.length;){const q=this.getCurrentRecord();if(q.type!==v.BANDWIDTH)break;{const ee=this.extractOneOrMore(q,C);if(q.value[q.cur]!==":")throw new Error("Invalid bandwidth field.");q.cur++;const Ce=this.extractOneOrMore(q,_);O.push({bwtype:ee,bandwidth:Ce}),this.currentLine++}}return O}parseVersion(){const O=this.getCurrentRecord();if(O.type!==v.VERSION)throw new Error("first sdp record must be version");const q=O.value.slice(0,this.consumeOneOrMore(O.value,0,_));if(q.length!==O.value.length)throw new Error('invalid proto version, "v='.concat(O.value,'"'));return this.currentLine++,q}parseOrigin(){const O=this.getCurrentRecord();if(O.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const q=this.extractOneOrMore(O,w);this.consumeSpaceForRecord(O);const ee=this.extractOneOrMore(O,_);this.consumeSpaceForRecord(O);const Ce=this.extractOneOrMore(O,_);this.consumeSpaceForRecord(O);const lt=this.extractOneOrMore(O,C);this.consumeSpaceForRecord(O);const dn=this.extractOneOrMore(O,C);this.consumeSpaceForRecord(O);const fr=this.extract(O,this.consumeUnicastAddress);return this.currentLine++,{username:q,sessId:ee,sessVersion:Ce,nettype:lt,addrtype:dn,unicastAddress:fr}}parseSessionName(){const O=this.getCurrentRecord();if(O.type===v.SESSION_NAME){const q=this.extract(O,this.consumeText);return this.currentLine++,q}}parseInformation(){const O=this.getCurrentRecord();if(O.type!==v.INFORMATION)return;const q=this.extract(O,this.consumeText);return this.currentLine++,q}parseUri(){const O=this.getCurrentRecord();if(O.type===v.URI)return this.currentLine++,O.value}parseEmail(){const O=[];for(;;){const q=this.getCurrentRecord();if(q.type!==v.EMAIL)break;O.push(q.value),this.currentLine++}return O}parsePhone(){const O=[];for(;;){const q=this.getCurrentRecord();if(q.type!==v.PHONE)break;O.push(q.value),this.currentLine++}return O}parseConnection(){const O=this.getCurrentRecord();if(O.type===v.CONNECTION){const q=this.extractOneOrMore(O,C);this.consumeSpaceForRecord(O);const ee=this.extractOneOrMore(O,C);this.consumeSpaceForRecord(O);const Ce=this.extract(O,this.consumeAddress);return this.currentLine++,{nettype:q,addrtype:ee,address:Ce}}}parseMedia(){const O=this.getCurrentRecord(),q=this.extract(O,this.consumeToken);this.consumeSpaceForRecord(O);let ee=this.extract(O,this.consumePort);O.value[O.cur]==="/"&&(O.cur+=1,ee+=this.extract(O,this.consumeInteger)),this.consumeSpaceForRecord(O);const Ce=[];for(Ce.push(this.extract(O,this.consumeToken));O.value[O.cur]==="/";)O.cur+=1,Ce.push(this.extract(O,this.consumeToken));if(Ce.length===0)throw new Error("Invalid proto");const lt=this.parseFmt(O);return this.currentLine++,{mediaType:q,port:ee,protos:Ce,fmts:lt}}parseTimeFields(){const O=[];for(;this.getCurrentRecord().type===v.TIME;){const q=this.parseTime(),ee=this.parseRepeat(),Ce=this.parseZone();O.push({time:q,repeats:ee,zones:Ce})}return O}parseMediaDescription(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const q=this.parseMedia(),ee=this.parseInformation(),Ce=this.parseConnections(),lt=this.parseBandWidth(),dn=this.parseKey(),fr=this.parseMediaAttributes(q);O.push({media:q,information:ee,connections:Ce,bandwidths:lt,key:dn,attributes:fr})}return O}parseConnections(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)O.push(this.parseConnection());return O}parseFmt(O){const q=[];for(;;)try{this.consumeSpaceForRecord(O),q.push(this.extract(O,this.consumeToken))}catch{break}if(q.length===0)throw new Error("Invalid fmts");return q}extract(O,q){for(var ee=arguments.length,Ce=new Array(ee>2?ee-2:0),lt=2;lt<ee;lt++)Ce[lt-2]=arguments[lt];const dn=q.call(this,O.value,O.cur,...Ce),fr=O.value.slice(O.cur,dn);return O.cur=dn,fr}extractOneOrMore(O,q){const ee=this.consumeOneOrMore(O.value,O.cur,q),Ce=O.value.slice(O.cur,ee);return O.cur=ee,Ce}consumeSpaceForRecord(O){if(O.value[O.cur]!==g)throw new Error("Invalid space at ".concat(O.cur,"."));O.cur+=1}}class Me extends ge{constructor(){super(...arguments),ie(this,"attributes",void 0),ie(this,"digested",!1)}extractOneOrMore(O,q,ee){const Ce=this.consumeOneOrMore(O.attValue,O._cur,q),lt=O.attValue.slice(O._cur,Ce),[dn,fr]=ee||[];if(typeof dn=="number"&&lt.length<dn)throw new Error("error in length, should be more or equal than ".concat(dn," characters."));if(typeof fr=="number"&&lt.length>fr)throw new Error("error in length, should be less or equal than ".concat(fr," characters."));return O._cur=Ce,lt}consumeAttributeSpace(O){if(O.attValue[O._cur]!==g)throw new Error("Invalid space at ".concat(O._cur,"."));O._cur+=1}extract(O,q){if(!O.attValue)throw new Error("Nothing to extract from attValue.");for(var ee=arguments.length,Ce=new Array(ee>2?ee-2:0),lt=2;lt<ee;lt++)Ce[lt-2]=arguments[lt];const dn=q.call(this,O.attValue,O._cur,...Ce),fr=O.attValue.slice(O._cur,dn);return O._cur=dn,fr}atEnd(O){if(!O.attValue)throw new Error;return O._cur>=O.attValue.length}peekChar(O){if(!O.attValue)throw new Error;return O.attValue[O._cur]}peek(O,q){if(!O.attValue)throw new Error;for(let ee=0;ee<q.length;ee++)if(q[ee]!==O.attValue[O._cur+ee])return!1;return!0}parseIceUfrag(O){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(O,K,[4,256])}parseIcePwd(O){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(O,K,[22,256])}parseIceOptions(O){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const q=[];for(;!this.atEnd(O);){q.push(this.extractOneOrMore(O,K));try{this.consumeAttributeSpace(O)}catch(ee){if(this.atEnd(O))break;throw ee}}this.attributes.iceOptions=q}parseFingerprint(O){const q=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill);this.attributes.fingerprints.push({hashFunction:q,fingerprint:ee})}parseExtmap(O){const q=this.extractOneOrMore(O,_);let ee;this.peekChar(O)==="/"&&(this.extract(O,this.consume,"/"),ee=this.extract(O,this.consumeToken)),this.consumeAttributeSpace(O);const Ce=this.extract(O,this.consumeTill,g),lt=Z(Z({entry:parseInt(q,10)},ee&&{direction:ee}),{},{extensionName:Ce});this.peekChar(O)===g&&(this.consumeAttributeSpace(O),lt.extensionAttributes=this.extract(O,this.consumeTill)),this.attributes.extmaps.push(lt)}parseSetup(O){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const q=this.extract(O,this.consumeTill);if(q!=="active"&&q!=="passive"&&q!=="actpass"&&q!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=q}}class at extends Me{constructor(){super(...arguments),ie(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"group":this.parseGroup(O);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"fingerprint":this.parseFingerprint(O);break;case"setup":this.parseSetup(O);break;case"tls-id":this.parseTlsId(O);break;case"identity":this.parseIdentity(O);break;case"extmap":this.parseExtmap(O);break;case"msid-semantic":this.parseMsidSemantic(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(q){throw console.error("parsing session attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),q}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(O){const q=this.extract(O,this.consumeToken),ee=[];for(;!this.atEnd(O)&&this.peekChar(O)===g;)this.consumeAttributeSpace(O),ee.push(this.extract(O,this.consumeToken));this.attributes.groups.push({semantic:q,identificationTag:ee})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(O){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(O,X)}parseIdentity(O){const q=this.extractOneOrMore(O,te),ee=[];for(;!this.atEnd(O)&&this.peekChar(O)===g;){this.consumeAttributeSpace(O);const Ce=this.extract(O,this.consumeToken);this.extract(O,this.consume,"=");const lt=this.extractOneOrMore(O,dn=>dn!==g&&G(dn));ee.push({name:Ce,value:lt})}this.attributes.identities.push({assertionValue:q,extensions:ee})}parseMsidSemantic(O){this.peekChar(O)===g&&this.consumeAttributeSpace(O);const q={semantic:this.extract(O,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(O)}catch{break}if(this.peekChar(O)==="*"){this.extract(O,this.consume,"*"),q.applyForAll=!0;break}{const ee=this.extract(O,this.consumeTill,g);q.identifierList.push(ee)}}this.attributes.msidSemantic=q}}class tt extends Me{constructor(O){super(),ie(this,"attributes",void 0),O.protos.indexOf("RTP")!==-1||O.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"extmap":this.parseExtmap(O);break;case"setup":this.parseSetup(O);break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"candidate":this.parseCandidate(O);break;case"remote-candidate":this.parseRemoteCandidate(O);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(O);break;case"rtpmap":this.parseRtpmap(O);break;case"ptime":this.parsePtime(O);break;case"maxptime":this.parseMaxPtime(O);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(O);break;case"ssrc":this.parseSSRC(O);break;case"fmtp":this.parseFmtp(O);break;case"rtcp-fb":this.parseRtcpFb(O);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(O);break;case"mid":this.parseMid(O);break;case"msid":this.parseMsid(O);break;case"imageattr":this.parseImageAttr(O);break;case"rid":this.parseRid(O);break;case"simulcast":this.parseSimulcast(O);break;case"sctp-port":this.parseSctpPort(O);break;case"max-message-size":this.parseMaxMessageSize(O);break;case"ssrc-group":this.parseSSRCGroup(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(q){throw console.error("parsing media attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),q}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}parseCandidate(O){const q=this.extractOneOrMore(O,K,[1,32]);this.consumeAttributeSpace(O);const ee=this.extractOneOrMore(O,_,[1,5]);this.consumeAttributeSpace(O);const Ce=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const lt=this.extractOneOrMore(O,_,[1,10]);this.consumeAttributeSpace(O);const dn=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const fr=this.extract(O,this.consumePort);this.consumeAttributeSpace(O),this.extract(O,this.consume,"typ"),this.consumeAttributeSpace(O);const ss={foundation:q,componentId:ee,transport:Ce,priority:lt,connectionAddress:dn,port:fr,type:this.extract(O,this.consumeToken),extension:{}};for(this.peek(O," raddr")&&(this.extract(O,this.consume," raddr"),this.consumeAttributeSpace(O),ss.relAddr=this.extract(O,this.consumeAddress)),this.peek(O," rport")&&(this.extract(O,this.consume," rport"),this.consumeAttributeSpace(O),ss.relPort=this.extract(O,this.consumePort));this.peekChar(O)===g;){this.consumeAttributeSpace(O);const ld=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O),ss.extension[ld]=this.extractOneOrMore(O,S)}this.attributes.candidates.push(ss)}parseRemoteCandidate(O){const q=[];for(;;){const ee=this.extractOneOrMore(O,_,[1,5]);this.consumeAttributeSpace(O);const Ce=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const lt=this.extract(O,this.consumePort);q.push({componentId:ee,connectionAddress:Ce,port:lt});try{this.consumeAttributeSpace(O)}catch{break}}this.attributes.remoteCandidatesList.push(q)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(O){const q=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill,"/");this.extract(O,this.consume,"/");const Ce={encodingName:ee,clockRate:this.extractOneOrMore(O,_)};this.atEnd(O)||this.peekChar(O)!=="/"||(this.extract(O,this.consume,"/"),Ce.encodingParameters=parseInt(this.extract(O,this.consumeTill),10));const lt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(q,10));lt?lt.rtpMap=Ce:this.attributes.payloads.push({payloadType:parseInt(q,10),rtpMap:Ce,rtcpFeedbacks:[]})}parsePtime(O){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(O,this.consumeTill)}parseMaxPtime(O){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(O,this.consumeTill)}parseDirection(O){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=O.attField}parseSSRC(O){const q=this.extractOneOrMore(O,_);this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill,":");let Ce;this.peekChar(O)===":"&&(this.extract(O,this.consume,":"),Ce=this.extract(O,this.consumeTill));const lt=this.attributes.ssrcs.find(dn=>dn.ssrcId===parseInt(q,10));lt?lt.attributes[ee]=Ce:this.attributes.ssrcs.push({ssrcId:parseInt(q,10),attributes:{[ee]:Ce}})}parseFmtp(O){const q=this.extract(O,this.consumeTill,g);this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill),Ce={};ee.split(";").forEach(dn=>{let[fr,ss]=dn.split("=");fr=mi(fr).call(fr);const ld=typeof ss=="string"?mi(ss).call(ss):null;typeof fr=="string"&&fr.length>0&&(Ce[fr]=ld)});const lt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(q,10));lt?lt.fmtp={parameters:Ce}:this.attributes.payloads.push({payloadType:parseInt(q,10),rtcpFeedbacks:[],fmtp:{parameters:Ce}})}parseFmtParameters(O){const q={},ee=this.extract(O,this.consumeTill,"=");O._cur++;const Ce=this.extract(O,this.consumeTill,";");for(q[ee]=Ce;O.attValue[O._cur]===";";){const lt=this.extract(O,this.consumeTill,"=");O._cur++;const dn=this.extract(O,this.consumeTill,";");q[lt]=dn}return q}parseRtcpFb(O){let q="";q=this.peekChar(O)==="*"?this.extract(O,this.consume,"*"):this.extract(O,this.consumeTill,g),this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill,g);let Ce;if(ee==="trr-int")Ce={type:ee,interval:this.extract(O,this.consumeTill)};else{const lt={type:ee};this.peekChar(O)===g&&(this.consumeAttributeSpace(O),lt.parameter=this.extract(O,this.consumeToken),this.peekChar(O)===g&&(lt.additional=this.extract(O,this.consumeTill))),Ce=lt}if(q==="*")this.attributes.rtcpFeedbackWildcards.push(Ce);else{const lt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(q,10));lt?lt.rtcpFeedbacks.push(Ce):this.attributes.payloads.push({payloadType:parseInt(q,10),rtcpFeedbacks:[Ce]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(O){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const q={port:this.extract(O,this.consumePort)};this.peekChar(O)===g&&(this.consumeAttributeSpace(O),q.netType=this.extractOneOrMore(O,C),this.consumeAttributeSpace(O),q.addressType=this.extractOneOrMore(O,C),this.consumeAttributeSpace(O),q.address=this.extract(O,this.consumeAddress)),this.attributes.rtcp=q}parseMsid(O){const q={id:this.extractOneOrMore(O,C,[1,64])};this.peekChar(O)===g&&(this.consumeAttributeSpace(O),q.appdata=this.extractOneOrMore(O,C,[1,64])),this.attributes.msids.push(q)}parseImageAttr(O){this.attributes.imageattr.push(O.attValue)}parseRid(O){const q=this.extractOneOrMore(O,Ce=>I(Ce)||_(Ce)||Ce==="_"||Ce==="-");this.consumeAttributeSpace(O);const ee={id:q,direction:this.extract(O,this.consumeToken),params:[]};if(this.peekChar(O)===g){if(this.consumeAttributeSpace(O),this.peek(O,"pt=")){this.extract(O,this.consume,"pt=");const Ce=[];for(;;){const lt=this.extract(O,this.consumeToken);Ce.push(lt);try{this.extract(O,this.consume,",")}catch{break}}ee.payloads=Ce,this.peekChar(O)===g&&this.extract(O,this.consume,g)}for(;;){const Ce=this.extract(O,this.consumeToken);switch(Ce){case"depend":{const lt={type:Ce,rids:this.extract(O,this.consume,"=").split(",")};ee.params.push(lt);break}default:{const lt={type:Ce};this.peekChar(O)==="="&&(this.extract(O,this.consume,"="),lt.val=this.extract(O,this.consumeTill,";")),ee.params.push(lt)}}try{this.extract(O,this.consume,";")}catch{break}}}this.attributes.rids.push(ee)}parseSimulcast(O){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=O.attValue,this.extract(O,this.consumeTill)}parseSctpPort(O){this.attributes.sctpPort=this.extractOneOrMore(O,_,[1,5])}parseMaxMessageSize(O){this.attributes.maxMessageSize=this.extractOneOrMore(O,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(O){this.attributes.mid=this.extract(O,this.consumeToken)}parseSSRCGroup(O){const q=this.extract(O,this.consumeToken),ee=[];for(;;)try{this.consumeAttributeSpace(O);const Ce=this.extract(O,this.consumeInteger);ee.push(parseInt(Ce,10))}catch{break}this.attributes.ssrcGroups.push({semantic:q,ssrcIds:ee})}}function mt(_e,O,q){return O in _e?Object.defineProperty(_e,O,{value:q,enumerable:!0,configurable:!0,writable:!0}):_e[O]=q,_e}class ht{constructor(){mt(this,"eol",f)}print(O,q){let ee="";return q&&(this.eol=q),ee+=this.printVersion(O.version),ee+=this.printOrigin(O.origin),ee+=this.printSessionName(O.sessionName),ee+=this.printInformation(O.information),ee+=this.printUri(O.uri),ee+=this.printEmail(O.emails),ee+=this.printPhone(O.phones),ee+=this.printConnection(O.connection),ee+=this.printBandwidth(O.bandwidths),ee+=this.printTimeFields(O.timeFields),ee+=this.printKey(O.key),ee+=this.printSessionAttributes(O.attributes),ee+=this.printMediaDescription(O.mediaDescriptions),ee}printVersion(O){return"v=".concat(O).concat(this.eol)}printOrigin(O){return"o=".concat(O.username," ").concat(O.sessId," ").concat(O.sessVersion," ").concat(O.nettype," ").concat(O.addrtype," ").concat(O.unicastAddress).concat(this.eol)}printSessionName(O){return O?"s=".concat(O).concat(this.eol):""}printInformation(O){return O?"i=".concat(O).concat(this.eol):""}printUri(O){return O?"u=".concat(O).concat(this.eol):""}printEmail(O){let q="";for(const ee of O)q+="e=".concat(ee).concat(this.eol);return q}printPhone(O){let q="";for(const ee of O)q+="e=".concat(ee).concat(this.eol);return q}printConnection(O){return O?"c=".concat(O.nettype," ").concat(O.addrtype," ").concat(O.address).concat(this.eol):""}printBandwidth(O){let q="";for(const ee of O)q+="b=".concat(ee.bwtype,":").concat(ee.bandwidth).concat(this.eol);return q}printTimeFields(O){let q="";for(const ee of O){q+="t=".concat(ee.time.startTime," ").concat(ee.time.startTime).concat(this.eol);for(const Ce of ee.repeats)q+="r=".concat(Ce.repeatInterval," ").concat(Ce.typedTimes.join(" ")).concat(this.eol);ee.zoneAdjustments&&(q+="z=",q+="z=".concat(ee.zoneAdjustments.map(Ce=>"".concat(Ce.time," ").concat(Ce.back?"-":""," ").concat(Ce.typedTime)).join(" ")).concat(this.eol),q+=this.eol)}return q}printKey(O){return O?"k=".concat(O).concat(this.eol):""}printAttributes(O){let q="";for(const ee of O)q+="a=".concat(ee.attField).concat(ee.attValue?":".concat(ee.attValue):"").concat(this.eol);return q}printMediaDescription(O){let q="";for(const ee of O)q+=this.printMedia(ee.media),q+=this.printInformation(ee.information),q+=this.printConnections(ee.connections),q+=this.printBandwidth(ee.bandwidths),q+=this.printKey(ee.key),q+=this.printMediaAttributes(ee);return q}printConnections(O){let q="";for(const ee of O)q+=this.printConnection(ee);return q}printMedia(O){return"m=".concat(O.mediaType," ").concat(O.port," ").concat(O.protos.join("/")," ").concat(O.fmts.join(" ")).concat(this.eol)}printSessionAttributes(O){return new En(this.eol).print(O)}printMediaAttributes(O){return new ye(this.eol).print(O)}}class Wt{constructor(O){mt(this,"eol",void 0),this.eol=O}printIceUfrag(O){return O===void 0?"":"a=ice-ufrag:".concat(O).concat(this.eol)}printIcePwd(O){return O===void 0?"":"a=ice-pwd:".concat(O).concat(this.eol)}printIceOptions(O){return O===void 0?"":"a=ice-options:".concat(O.join(g)).concat(this.eol)}printFingerprints(O){return O.length>0?O.map(q=>"a=fingerprint:".concat(q.hashFunction).concat(g).concat(q.fingerprint)).join(this.eol)+this.eol:""}printExtmap(O){return O.map(q=>"a=extmap:".concat(q.entry).concat(q.direction?"/".concat(q.direction):"").concat(g).concat(q.extensionName).concat(q.extensionAttributes?"".concat(g).concat(q.extensionAttributes):"").concat(this.eol)).join("")}printSetup(O){return O===void 0?"":"a=setup:".concat(O).concat(this.eol)}printUnrecognized(O){return O.map(q=>"a=".concat(q.attField).concat(q.attValue?":".concat(q.attValue):"").concat(this.eol)).join("")}}class En extends Wt{print(O){let q="";return q+=this.printGroups(O.groups),q+=this.printMsidSemantic(O.msidSemantic),q+=this.printIceLite(O.iceLite),q+=this.printIceUfrag(O.iceUfrag),q+=this.printIcePwd(O.icePwd),q+=this.printIceOptions(O.iceOptions),q+=this.printFingerprints(O.fingerprints),q+=this.printSetup(O.setup),q+=this.printTlsId(O.tlsId),q+=this.printIdentity(O.identities),q+=this.printExtmap(O.extmaps),q+=this.printUnrecognized(O.unrecognized),q}printGroups(O){let q="";return O.length>0&&(q+=O.map(ee=>"a=group:".concat(ee.semantic).concat(ee.identificationTag.map(Ce=>"".concat(g).concat(Ce)).join("")).concat(this.eol)).join("")),q}printIceLite(O){return O===void 0?"":"a=ice-lite"+this.eol}printTlsId(O){return O?"a=tls-id:".concat(O).concat(this.eol):""}printIdentity(O){return O.length===0?"":O.map(q=>"a=identity:".concat(q.assertionValue).concat(q.extensions.map(ee=>"".concat(g).concat(ee.name).concat(ee.value?"=".concat(ee.value):"")))).join(this.eol)+this.eol}printMsidSemantic(O){if(!O)return"";let q="a=msid-semantic:".concat(O.semantic);return O.applyForAll?q+="".concat(g,"*"):O.identifierList.length>0&&(q+=O.identifierList.map(ee=>"".concat(g).concat(ee))),q+this.eol}}class ye extends Wt{print(O){const q=O.attributes;let ee="";return ee+=this.printRTCP(q.rtcp),ee+=this.printIceUfrag(q.iceUfrag),ee+=this.printIcePwd(q.icePwd),ee+=this.printIceOptions(q.iceOptions),ee+=this.printCandidates(q.candidates),ee+=this.printRemoteCandidatesList(q.remoteCandidatesList),ee+=this.printEndOfCandidates(q.endOfCandidates),ee+=this.printFingerprints(q.fingerprints),ee+=this.printSetup(q.setup),ee+=this.printMid(q.mid),ee+=this.printExtmap(q.extmaps),ee+=this.printRTPRelated(q),ee+=this.printPtime(q.ptime),ee+=this.printMaxPtime(q.maxPtime),ee+=this.printDirection(q.direction),ee+=this.printSSRCGroups(q.ssrcGroups),ee+=this.printSSRC(q.ssrcs),ee+=this.printRTCPMux(q.rtcpMux),ee+=this.printRTCPMuxOnly(q.rtcpMuxOnly),ee+=this.printRTCPRsize(q.rtcpRsize),ee+=this.printMSId(q.msids),ee+=this.printImageattr(q.imageattr),ee+=this.printRid(q.rids),ee+=this.printSimulcast(q.simulcast),ee+=this.printSCTPPort(q.sctpPort),ee+=this.printMaxMessageSize(q.maxMessageSize),ee+=this.printUnrecognized(q.unrecognized),ee}printCandidates(O){return O.map(q=>"a=candidate:".concat(q.foundation).concat(g).concat(q.componentId).concat(g).concat(q.transport).concat(g).concat(q.priority).concat(g).concat(q.connectionAddress).concat(g).concat(q.port).concat(g,"typ").concat(g).concat(q.type).concat(q.relAddr?"".concat(g,"raddr").concat(g).concat(q.relAddr):"").concat(q.relPort?"".concat(g,"rport").concat(g).concat(q.relPort):"").concat(Object.keys(q.extension).map(ee=>"".concat(g).concat(ee).concat(g).concat(q.extension[ee])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(O){return O.map(q=>"a=remote-candidates:".concat(q.join(g)).concat(this.eol)).join("")}printEndOfCandidates(O){return O===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(O){if(!O.payloads)return"";const q=O.payloads;let ee="";ee+=O.rtcpFeedbackWildcards.map(Ce=>this.printRTCPFeedback("*",Ce)).join("");for(const Ce of q)ee+=this.printRtpMap(Ce.payloadType,Ce.rtpMap),ee+=this.printFmtp(Ce.payloadType,Ce.fmtp),ee+=Ce.rtcpFeedbacks.map(lt=>this.printRTCPFeedback(Ce.payloadType,lt)).join("");return ee}printFmtp(O,q){if(!q)return"";const ee=Object.keys(q.parameters);return ee.length===1&&q.parameters[ee[0]]===null?"a=fmtp:".concat(O).concat(g).concat(ee[0]).concat(this.eol):"a=fmtp:".concat(O).concat(g).concat(Object.keys(q.parameters).map(Ce=>"".concat(Ce,"=").concat(q.parameters[Ce])).join(";")).concat(this.eol)}printRtpMap(O,q){return q?"a=rtpmap:".concat(O).concat(g).concat(q.encodingName,"/").concat(q.clockRate).concat(q.encodingParameters?"/".concat(q.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(O,q){let ee="a=rtcp-fb:".concat(O).concat(g),Ce=q;return Ce.type==="trr-int"?ee+="ttr-int".concat(g).concat(Ce.interval):(ee+="".concat(Ce.type),Ce.parameter&&(ee+="".concat(g).concat(Ce.parameter),Ce.additional&&(ee+="".concat(g).concat(Ce.additional)))),ee+this.eol}printPtime(O){return O===void 0?"":"a=ptime:".concat(O).concat(this.eol)}printMaxPtime(O){return O===void 0?"":"a=maxptime:".concat(O).concat(this.eol)}printDirection(O){return O===void 0?"":"a=".concat(O).concat(this.eol)}printSSRC(O){return O.map(q=>Object.keys(q.attributes).map(ee=>"a=ssrc:".concat(q.ssrcId.toString(10)).concat(g).concat(ee).concat(q.attributes[ee]?":".concat(q.attributes[ee]):"").concat(this.eol)).join("")).join("")}printRTCPMux(O){return O===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(O){return O===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(O){return O===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(O){if(O===void 0)return"";let q="a=rtcp:".concat(O.port);return O.netType&&(q+="".concat(g).concat(O.netType)),O.addressType&&(q+="".concat(g).concat(O.addressType)),O.address&&(q+="".concat(g).concat(O.address)),q+this.eol}printMSId(O){return O.map(q=>"a=msid:".concat(q.id).concat(q.appdata?"".concat(g).concat(q.appdata):"").concat(this.eol)).join("")}printImageattr(O){return O.map(q=>"a=imageattr:".concat(q).concat(this.eol)).join("")}printRid(O){return O.map(q=>{let ee="a=rid:".concat(q.id).concat(g).concat(q.direction);return q.payloads&&(ee+="".concat(g,"pt=").concat(q.payloads.join(","))),q.params.length>0&&(ee+="".concat(g).concat(q.params.map(Ce=>Ce.type==="depend"?"depend=".concat(Ce.rids.join(",")):"".concat(Ce.type,"=").concat(Ce.val)).join(";"))),ee+this.eol}).join("")}printSimulcast(O){return O===void 0?"":"a=simulcast:".concat(O).concat(this.eol)}printSCTPPort(O){return O===void 0?"":"a=sctp-port:".concat(O).concat(this.eol)}printMaxMessageSize(O){return O===void 0?"":"a=max-message-size:".concat(O).concat(this.eol)}printMid(O){return O===void 0?"":"a=mid:".concat(O).concat(this.eol)}printSSRCGroups(O){return O.map(q=>"a=ssrc-group:".concat(q.semantic).concat(q.ssrcIds.map(ee=>"".concat(g).concat(ee.toString(10))).join("")).concat(this.eol)).join("")}}function Ne(_e){return new Ee().parse(_e)}function Be(_e,O){return new ht().print(_e,O)}}},r={};function i(s){if(r[s])return r[s].exports;var c=r[s]={exports:{}};return t[s](c,c.exports,i),c.exports}return i.d=(s,c)=>{for(var d in c)i.o(c,d)&&!i.o(s,d)&&Object.defineProperty(s,d,{enumerable:!0,get:c[d]})},i.o=(s,c)=>Object.prototype.hasOwnProperty.call(s,c),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i(8)})();function yi(t){return X5.parse(t)}function zc(t,r){return X5.print(t,r)}var Fme=Ya("Array","keys"),Bme=Ll,Wme=Xr,Gme=A,$me=Fme,ZA=Array.prototype,Hme={DOMTokenList:!0,NodeList:!0},zme=function(t){var r=t.keys;return t===ZA||Gme(ZA,t)&&r===ZA.keys||Wme(Hme,Bme(t))?$me:r},Zr=l(zme);function On(t,r,i){return(r=function(s){var c=function(d,u){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var g=f.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function J5(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ft(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?J5(Object(i),!0).forEach(function(s){On(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):J5(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function mE(t,r){return mE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},mE(t,r)}function eN(){eN=function(c,d){return new i(c,void 0,d)};var t=RegExp.prototype,r=new WeakMap;function i(c,d,u){var f=RegExp(c,d);return r.set(f,u||r.get(c)),mE(f,i.prototype)}function s(c,d){var u,f=r.get(d);return qa(u=Object.keys(f)).call(u,function(g,v){var _=f[v];if(typeof _=="number")g[v]=c[_];else{for(var S=0;c[_[S]]===void 0&&S+1<_.length;)S++;g[v]=c[_[S]]}return g},Object.create(null))}return function(c,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(d&&d.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),d&&mE(c,d)}(i,RegExp),i.prototype.exec=function(c){var d=t.exec.call(this,c);if(d){d.groups=s(d,this);var u=d.indices;u&&(u.groups=s(u,this))}return d},i.prototype[Symbol.replace]=function(c,d){if(typeof d=="string"){var u=r.get(this);return t[Symbol.replace].call(this,c,d.replace(/\$<([^>]+)(>|$)/g,function(g,v,_){if(_==="")return g;var S=u[v];return Array.isArray(S)?"$"+S.join("$"):typeof S=="number"?"$"+S:""}))}if(typeof d=="function"){var f=this;return t[Symbol.replace].call(this,c,function(){var g=arguments;return typeof g[g.length-1]!="object"&&(g=[].slice.call(g)).push(s(g,f)),d.apply(this,g)})}return t[Symbol.replace].call(this,c,d)},eN.apply(this,arguments)}const Q5=new class extends Sn{constructor(){super(...arguments),On(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class Kme{constructor(r){On(this,"logger",void 0),On(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function tN(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function Z5(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Qa={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},gE=Date.now(),Fg=t=>{for(const r in Qa)if(Object.prototype.hasOwnProperty.call(Qa,r)&&Qa[r]===t)return r;return"DEFAULT"},R=new class{constructor(){On(this,"proxyServerURL",void 0),On(this,"logLevel",Qa.DEBUG),On(this,"uploadState","collecting"),On(this,"uploadLogWaitingList",[]),On(this,"uploadLogUploadingList",[]),On(this,"uploadErrorCount",0),On(this,"currentLogID",0),On(this,"url",void 0),On(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[Qa.DEBUG].concat(r);this.log.apply(this,s)}info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[Qa.INFO].concat(r);this.log.apply(this,s)}warning(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[Qa.WARNING].concat(r);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[Qa.ERROR].concat(r);this.log.apply(this,s)}upload(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[Qa.DEBUG].concat(r);this.uploadLog.apply(this,s)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Zt("UPLOAD_LOG",!0)}disableLogUpload(){Zt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new Kme(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-gE<100)return void setTimeout(()=>{this.log(...r)},Date.now()-gE);const s=Math.max(0,Math.min(4,r[0]));if(r[0]=tN()+" Agora-SDK [".concat(Fg(s),"]:"),this.appendLogToWaitingList(s,...r),s<this.logLevel)return;const c=tN()+" %cAgora-SDK [".concat(Fg(s),"]:");let d=[];if(!W("USE_NEW_LOG"))switch(s){case Qa.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Qa.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Qa.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Qa.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-gE<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-gE);const s=Math.max(0,Math.min(4,r[0]));r[0]=tN()+" Agora-SDK [".concat(Fg(s),"]:"),this.appendLogToWaitingList(s,...r)}appendLogToWaitingList(t){if(!W("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];Array.isArray(i[0])?i[0][0]=Z5()+" Agora-SDK [".concat(Fg(t),"]:"):i[0]=Z5()+" Agora-SDK [".concat(Fg(t),"]:");let c="";i.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Ja,process_id:W("PROCESS_ID"),payload:JSON.stringify(t)};return go(async()=>{const i=await Ni.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(W("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(W("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const s=new Error("unexpected upload log response");throw s.response=i,s}},()=>(this.uploadLogUploadingList=[],!1),i=>{const s={status:-1,message:i.message,errorRange:t.map(c=>c.log_item_id)};return i.response?(s.status=i.response.status,s.data=i.response.data,s.headers=i.response.headers):i.request&&(s.status=i.request.status),Q5.reportLogUploadError(s),!0},{timeout:W("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:W("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,W("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var e3;function Yme(t){return Or(t.reportId,"params.reportId",0,100,!1),Or(t.category,"params.category",0,100,!1),Or(t.event,"params.event",0,100,!1),Or(t.label,"params.label",0,100,!1),nn(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(e3={}).FREE="free",e3.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const qme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let er=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.RTE_DETAIL="rte_detail_stats",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),_n=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Xme=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Qe(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,s){const c=s.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);s.value=function(){for(var u,f=arguments.length,g=new Array(f),v=0;v<f;v++)g[v]=arguments[v];let _=g;if(t.argsMap)try{_=t.argsMap(this,...g)}catch(w){R.warning(w),_=[]}try{JSON.stringify(_)}catch{R.warning("arguments for method ".concat(d,".").concat(String(i)," not serializable for apiInvoke.")),_=[]}const S=(t.report||We).reportApiInvoke(this._sessionId||null,{id:this._clientId||((u=this.store)===null||u===void 0?void 0:u.clientId)||this._ID,name:"".concat(d,".").concat(String(i)),options:_,tag:rn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const w=c.apply(this,g);return w instanceof Ie?w.then(C=>(S.onSuccess(t.reportResult&&C),C)).catch(C=>{throw S.onError(C),C}):(S.onSuccess(t.reportResult&&w),w)}catch(w){throw S.onError(w),w}}}return s}}const We=new class{constructor(){On(this,"baseInfoMap",new Map),On(this,"proxyServer",void 0),On(this,"eventUploadTimer",void 0),On(this,"setSessionIdTimer",void 0),On(this,"url",void 0),On(this,"sids",new Set),On(this,"backupUrl",void 0),On(this,"_appId",void 0),On(this,"_aid",0),On(this,"keyEventUploadPendingItems",[]),On(this,"normalEventUploadPendingItems",[]),On(this,"apiInvokeUploadPendingItems",[]),On(this,"apiInvokeCount",0),On(this,"apiInvokeLoggedCount",0),On(this,"ltsList",[]),On(this,"lastSendNormalEventTime",Date.now()),On(this,"customReportCounterTimer",void 0),On(this,"customReportCount",0),On(this,"extApiInvoke",async t=>{for(const r of t){const i=ft(ft({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:rn.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),W("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),W("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,s]=r;return i+s}),16)||0}reportApiInvoke(t,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const s=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!W("SHOW_REPORT_INVOKER_LOG"),u=!!W("SHOW_REPORT_USER_INVOKER_LOG"),f=d||u&&r.id;f&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function v(C,M){if(f){let I="[apiInvoke-".concat(g,"]");if(r.id&&(I+="[".concat(r.id,"]")),r.name&&(I+="[".concat(r.name,"]"),r.name===yn.JOIN))return R.info("".concat(I," ").concat(C));R.info("".concat(I," ").concat(C),C==="start"?r.options:M||"")}}const _=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:s,options:r.options,states:r.states||null});v("start");let S=!1;dr(r.timeout).then(()=>{S||(this.sendApiInvoke(ft(ft({},_()),{},{error:$.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const w=new pe($.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:C=>{const M=()=>{if(S)throw w;return S=!0,this.sendApiInvoke(ft(ft({},_()),{},{success:!0},r.reportResult&&{result:C})),v("onSuccess"),C};return i?k5(M,r.name+"Success",i,()=>S=!0):M()},onError:C=>{const M=()=>{if(S)throw C;S=!0,this.sendApiInvoke(ft(ft({},_()),{},{success:!1,error:C})),v("onFailure",C.toString())};return i?k5(M,r.name+"Error",i,()=>S=!0):M()}}}_send(t,r,i){this.send({type:t,data:r},i)}_sendApiInvoke(t){return this.sendApiInvoke(t)}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const i=Date.now(),s=this.createBaseInfo(t,i);s.cname=r.cname,s.rteUrl=r.rteUrl;const c=Object.assign({},{willUploadConsoleLog:W("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:qA?"global":"oversea",areas:W("AREAS")&&W("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:u,channelMode:f,isABTestSuccess:g,lsid:v,clientRole:_}=r,S=Date.now(),w=ft(ft({},s),{},{eventType:er.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:JA,lts:S,elapse:S-i,extend:JSON.stringify(c),mode:r.mode,process:W("PROCESS_ID"),appType:W("APP_TYPE"),success:!0,version:Ja,stringUid:d,channelProfile:u,channelMode:f,isABTestSuccess:g,lsid:v,clientType:xe(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:_,serviceId:W("PROCESS_ID"),extensionID:W("PLUGIN_INFO").join(",")||"",rteUrl:r.rteUrl,rteSid:r.rteSid});var C;this.send({type:_n.SESSION,data:w},!0)}reportRteDetail(t){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,s=Date.now(),c=ft(ft({},i),{},{eventType:er.RTE_DETAIL,lts:s,success:!0,elapse:s-r.startTime,vid:i.vid===void 0?0:Number(i.vid),ua:navigator.userAgent});this.send({type:_n.RTE_DETAIL,data:c},!0)}joinChooseServer(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid);const c=Date.now(),d=ft(ft({},s),{},{role:r.role,eventType:er.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:_n.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft({},s),{},{eventType:er.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:_n.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid),s.uid=r.uid,s.cid=r.cid;const c=Date.now(),{firstSuccess:d,addr:u,isProxy:f}=r,g=c-i.startTime,v=ft(ft({},s),{},{eventType:er.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:YA(),isABTestSuccess:r.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:f?1:0}),_=v.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),u)if(v.signalChannel==="1"){const S=eN(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),w=u.match(S);v.gatewayIp=w&&w.groups?w.groups.ip:"",v.gatewayPort=w&&w.groups?w.groups.port:""}else if(f){const S=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),w=u.match(/p=[0-9]{1,6}/g);v.gatewayIp=S&&S.length?S[0].split("=")[1].replace(/-/g,"."):"",v.gatewayPort=w&&w.length?w[0].split("=")[1]:""}else{const S=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),w=u.match(/(:|p=)[0-9]{1,6}/g);v.gatewayIp=S&&S.length?S[0].split("//")[1].replace(/-/g,"."):"",v.gatewayPort=w&&w.length?w[0].split(/:|p=/g)[1]:""}if(d)this.send({type:_n.JOIN_GATEWAY,data:v},!0);else{let S={isSuccess:_,port:v.gatewayPort};delete v.success,delete v.eventType,delete v.firstSuccess,delete v.gatewayPort,v.vid=Number(v.vid);const w=Object.assign({},v,S,{eventType:er.REJOIN_GATEWAY});this.send({type:_n.RE_JOIN_GATEWAY,data:w},!0)}}joinChannelTimeout(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=Date.now(),c=ft(ft({},i.info),{},{lts:s,timeout:r,elapse:s-i.startTime});this.send({type:_n.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft({},s),{},{eventType:er.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:_n.PUBLISH,data:d},!0)}subscribe(t,r,i){const s=this.baseInfoMap.get(t);if(!s)return;const c=s.info,d=Date.now(),u=ft(ft({},c),{},{eventType:er.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-s.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?u.peerSuid=r.peerid:u.peer=r.peerid,this.send({type:_n.SUBSCRIBE,data:u},!0)}wsCompressorInit(t){var r;const i=[...Zr(r=this.baseInfoMap).call(r)],s=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;const d=c.info,u=Date.now(),f=ft(ft({},d),{},{eventType:er.WS_COMPRESSOR_INIT,lts:u,eventElapse:t.eventElapse,elapse:u-c.startTime,status:t.status?1:2});this.send({type:_n.WS_COMPRESSOR_INIT,data:f},!0)}firstXLAPeerFirstVideoFrame(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=r.peerPubStatusMs-(i.lastJoinSuccessTime||c),u=ft(ft({},s),{},{elapse:c-i.startTime,eventType:er.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>d?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0,firstReceivedEncodedFrame:r.firstReceivedEncodedFrame?Math.max(r.firstReceivedEncodedFrame-r.joinChannelStart,0):void 0,frameType:r.frameType||"",rtpTimestamp:r.rtpTimestamp||0,framePayloadType:r.framePayloadType||0,frameDataLength:r.frameDataLength||0,mimeType:r.mimeType||""});this.send({type:_n.XLA_PEER_FIRST_VIDEO_FRAME,data:u},!0)}firstRemoteVideoDecode(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,u=Date.now(),f=ft(ft(ft({},d),s),{},{elapse:u-c.startTime,eventType:r,lts:u,firstDecodeFrame:Math.max((s.firstFrame||u)-c.startTime,0),apEnd:Math.max(s.apEnd-c.startTime,0),apStart:Math.max(s.apStart-c.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-c.startTime,0),joinGwStart:Math.max(s.joinGwStart-c.startTime,0),pcEnd:Math.max(s.pcEnd-c.startTime,0),pcStart:Math.max(s.pcStart-c.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-c.startTime,0),subscriberStart:Math.max(s.subscriberStart-c.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-c.startTime,0)});this.send({type:i,data:f},!0)}firstRemoteFrame(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,u=Date.now(),f=ft(ft(ft({},d),s),{},{elapse:u-c.startTime,eventType:r,lts:u});this.send({type:i,data:f},!0)}abTest(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft(ft({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:er.AB_TEST,lts:c});this.send({type:_n.AB_TEST,data:d},!0)}pcStats(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft(ft({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:er.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:_n.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft(ft({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:er.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:_n.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,u=Date.now(),f=ft(ft(ft({},d),s),{},{eventType:r,lts:u});this.send({type:i,data:f},!0)}streamSwitch(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft({},s),{},{eventType:er.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:_n.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft({},s),{},{eventType:er.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:_n.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft({},s),{},{eventType:er.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:_n.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?R.debug("reportProxyServerurl: ".concat(t)):R.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft({},s),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:_n.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now();(function(d,u,f){const g=d[u];if(!g||typeof g!="string")return[d];d[u]="";const v=ac(JSON.stringify(d));let _=0;const S=[];let w=0;for(let C=0;C<g.length;C++)w+=g.charCodeAt(C)<=127?1:3,w<=f-v||(S[S.length]=Ae(Ae({},d),{},{[u]:g.substring(_,C)}),_=C,w=g.charCodeAt(C)<=127?1:3);return _!==g.length-1&&(S[S.length]=Ae(Ae({},d),{},{[u]:g.substring(_)})),S})(ft(ft(ft({},s),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:_n.WORKER_EVENT,data:d},!0))}apworkerEvent(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft(ft({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:_n.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft(ft({},s),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:_n.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),d=ft(ft(ft({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:_n.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>W("CUSTOM_REPORT_LIMIT"))throw new pe($.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=r.map(c=>({type:_n.USER_ANALYTICS,data:ft(ft({sid:t},c),{},{lts:i})}));try{W("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(c){throw R.error("send custom report message failed",c.toString()),new pe($.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=W("NOT_REPORT_EVENT");if(t.tag&&xe(r)&&xe(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:s,uid:c,cid:d}=i.info;let u;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof pe){const{code:g,message:v}=t.error;u=g||v||t.error.toString()}else u=t.error.toString();const f={invokeId:t.invokeId,sid:t.sid,cname:s,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?u:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:_n.API_INVOKE,data:f},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&t.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const i=[],s=[];for(;t.length;){const d=t.shift();i.length<20?i.push(d):s.push(d)}t.push(...s);for(const d of[...i]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),iu(c=this.ltsList).call(c,(u,f)=>u-f))}return r||(this.lastSendNormalEventTime=Date.now()),W("ENABLE_EVENT_REPORT")&&i.length&&(W("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((d=>u=>{W("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-W("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){Nn.networkState===vi.OFFLINE&&await Ie.race([Nn.onlineWaiter,dr(2*Bn.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach(u=>{const f=kA(JSON.stringify(u.data)),g=new ArrayBuffer(5),v=(S=>{let w=0;return Object.entries(_n).forEach(C=>{let[M,I]=C;I===S.type&&(w=Xme[M])}),w})(u),_=new DataView(g);_.setUint16(0,f.byteLength,!0),_.setUint8(2,255&v),_.setUint8(3,v>>>8&255),_.setUint8(4,v>>>16&255),d=x5(d,new Uint8Array(g)),d=x5(d,f)}),d},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await $A(s,{timeout:1e4,data:r(t),headers:ft(ft({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(f=>{const g=f&&f.data.sid&&this.baseInfoMap.get(f.data.sid);return g&&g.info.vid&&+g.info.vid||0})(t[0]),s=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(f=>JSON.stringify(f)),vid:i,aid:s};Nn.networkState===vi.OFFLINE&&await Ie.race([Nn.onlineWaiter,dr(2*Bn.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let u=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(W("EVENT_REPORT_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(d));for(let f=0;f<2;f+=1){f===1&&(u=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(W("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(d)));try{r?await Lme(u,{timeout:1e4,data:c}):await $A(u,{timeout:1e4,data:c})}catch(g){if(f===1)throw g;continue}return}}createBaseInfo(t,r){const i=Object.assign({},qme);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:r}),i}reportResourceTiming(t,r){const i=performance.getEntriesByName(t),s=i[i.length-1];s&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:s,tag:rn.TRACER}).onSuccess()}};Q5.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Nn.networkState,We.reportApiInvoke(null,{name:"logUploadError",options:t,tag:rn.TRACER}).onSuccess("logUploadError")});let se=class extends pe{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),On(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}};const ur={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function wt(){return ur}function t3(){return"setSinkId"in HTMLAudioElement.prototype&&(!W("RESTRICTION_SET_PLAYBACK_DEVICE")||($c()||l5())&&!y5())}function vE(){return!ur.supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&ic()}function Bg(t){return!(fn()||d5(87)||vE()||!W("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}function n3(t){return W("ENABLE_INSTANT_VIDEO")?W("ENABLE_INSTANT_VIDEO"):!(t==null||!t.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB"))}function r3(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function i3(){if(r3()){const t=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in t)||!t.suppressLocalAudioPlayback)}return mo(141)||$l(141)||pu(141)}function a3(){if(r3()){const t=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in t)||!t.restrictOwnAudio)}return mo(141)||$l(141)||pu(125)}let Ir=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Pp(t,r,i){return{sampleRate:t,stereo:r,bitrate:i}}function Mt(t,r,i,s,c){return{width:t,height:r,frameRate:i,bitrateMin:s,bitrateMax:c}}function Is(t,r,i,s,c){return{width:{max:t},height:{max:r},frameRate:i,bitrateMin:s,bitrateMax:c}}function nN(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Jme={"90p":Mt(160,90),"90p_1":Mt(160,90),"120p":Mt(160,120,15,30,65),"120p_1":Mt(160,120,15,30,65),"120p_3":Mt(120,120,15,30,50),"120p_4":Mt(212,120),"180p":Mt(320,180,15,30,140),"180p_1":Mt(320,180,15,30,140),"180p_3":Mt(180,180,15,30,100),"180p_4":Mt(240,180,15,30,120),"240p":Mt(320,240,15,40,200),"240p_1":Mt(320,240,15,40,200),"240p_3":Mt(240,240,15,40,140),"240p_4":Mt(424,240,15,40,220),"360p":Mt(640,360,15,80,400),"360p_1":Mt(640,360,15,80,400),"360p_3":Mt(360,360,15,80,260),"360p_4":Mt(640,360,30,80,600),"360p_6":Mt(360,360,30,80,400),"360p_7":Mt(480,360,15,80,320),"360p_8":Mt(480,360,30,80,490),"360p_9":Mt(640,360,15,80,800),"360p_10":Mt(640,360,24,80,800),"360p_11":Mt(640,360,24,80,1e3),"480p":Mt(640,480,15,100,500),"480p_1":Mt(640,480,15,100,500),"480p_2":Mt(640,480,30,100,1e3),"480p_3":Mt(480,480,15,100,400),"480p_4":Mt(640,480,30,100,750),"480p_6":Mt(480,480,30,100,600),"480p_8":Mt(848,480,15,100,610),"480p_9":Mt(848,480,30,100,930),"480p_10":Mt(640,480,10,100,400),"720p":Mt(1280,720,15,120,1130),"720p_auto":Mt(1280,720,30,900,3e3),"720p_1":Mt(1280,720,15,120,1130),"720p_2":Mt(1280,720,30,120,2e3),"720p_3":Mt(1280,720,30,120,1710),"720p_5":Mt(960,720,15,120,910),"720p_6":Mt(960,720,30,120,1380),"1080p":Mt(1920,1080,15,120,2080),"1080p_1":Mt(1920,1080,15,120,2080),"1080p_2":Mt(1920,1080,30,120,3e3),"1080p_3":Mt(1920,1080,30,120,3150),"1080p_5":Mt(1920,1080,60,120,4780),"1440p":Mt(2560,1440,30,120,4850),"1440p_1":Mt(2560,1440,30,120,4850),"1440p_2":Mt(2560,1440,60,120,7350),"4k":Mt(3840,2160,30,120,8910),"4k_1":Mt(3840,2160,30,120,8910),"4k_3":Mt(3840,2160,60,120,13500)},Qme={"480p":Is(640,480,5),"480p_1":Is(640,480,5),"480p_2":Is(640,480,30),"480p_3":Is(640,480,15),"720p":Is(1280,720,5),"720p_auto":Mt(1280,720,30,900,3e3),"720p_1":Is(1280,720,5),"720p_2":Is(1280,720,30),"720p_3":Is(1280,720,15),"1080p":Is(1920,1080,5),"1080p_1":Is(1920,1080,5),"1080p_2":Is(1920,1080,30),"1080p_3":Is(1920,1080,15)},Zme={"1SL1TL":nN(1,1),"3SL3TL":nN(3,3),"2SL3TL":nN(2,3)};function Ps(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Jme[t]):t}function rN(t){return typeof t=="string"?Object.assign({},Qme[t]):t}function yE(t){return typeof t=="string"?Object.assign({},Zme[t]):t}const ege={speech_low_quality:Pp(16e3,!1),speech_standard:Pp(32e3,!1,18),music_standard:Pp(48e3,!1),standard_stereo:Pp(48e3,!0,56),high_quality:Pp(48e3,!1,128),high_quality_stereo:Pp(48e3,!0,192)};function _E(t){return typeof t=="string"?Object.assign({},ege[t]):t}const Su=[];function s3(t){return Fn(t,"mediaSource",["screen","window","application"]),!0}let Ge=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Ht=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Dp=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),tge=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),nge=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),wu=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),kp=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Za=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),Lp=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Ca=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const iN={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},aN={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},o3={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},rge={uplinkNetworkQuality:0,downlinkNetworkQuality:0},c3={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let _i=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Ra=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),Wg=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),xu=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),$r=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),sc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const sN={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let EE=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function It(t,r,i,s,c){var d,u,f={};return Object.keys(s).forEach(function(g){f[g]=s[g]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=qa(d=jL(u=i.slice()).call(u)).call(d,function(g,v){return v(t,r,g)||g},f),c&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(c):void 0,f.initializer=void 0),f.initializer===void 0?(Object.defineProperty(t,r,f),null):f}function oe(t,r,i){return(r=function(s){var c=function(d,u){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var g=f.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function l3(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function hn(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?l3(Object(i),!0).forEach(function(s){oe(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l3(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class d3 extends Sn{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(wu.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),oe(this,"trackMediaType",void 0),oe(this,"_ID",void 0),oe(this,"_rtpTransceiver",void 0),oe(this,"_lowRtpTransceiver",void 0),oe(this,"_hints",[]),oe(this,"_isClosed",!1),oe(this,"_originMediaStreamTrack",void 0),oe(this,"mediaStreamTrack",void 0),oe(this,"_external",{}),this._ID=i||Kt(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(s){xe(Su).call(Su,s)||Su.push(s)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Hl(()=>{var i;We.reportApiInvoke(null,{name:yn.GET_MEDIA_STREAM_TRACK,options:[],tag:rn.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Dp.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=Su.indexOf(r);i!==-1&&Su.splice(i,1)}(this),this.emit(kp.CLOSED),this.removeAllListeners(wu.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Dp.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(wu.TRANSCEIVER_UPDATED,r,i)}}class jp extends d3{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),oe(this,"_enabled",!0),oe(this,"_muted",!1),oe(this,"_isExternalTrack",!1),oe(this,"_isClosed",!1),oe(this,"_enabledMutex",void 0),oe(this,"processor",void 0),oe(this,"_processorContext",void 0),oe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new br("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ge.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Ge.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(kp.TRACK_ENDED)}stateCheck(r,i){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),As(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new pe($.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new pe($.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ie.resolve([])}}const u3=window.AudioContext||window.webkitAudioContext;let oN,Aa=null;const en=new class extends Sn{constructor(){super(...arguments),oe(this,"prevState",void 0),oe(this,"curState",void 0),oe(this,"currentTime",void 0),oe(this,"currentTimeStuckAt",void 0),oe(this,"interruptDetectorTrack",void 0),oe(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Ir.IOS_15_16_INTERRUPTION_START)}),oe(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Aa&&await Aa.suspend(),this.emit(Ir.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){R.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){R.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Mp(){if(!Aa){if(function(){if(!u3)return void R.error("your browser is not support web audio");R.info("create audio context");const t=hn({},W("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(t)),Aa=new u3(t),en.curState=Aa.state,Aa.onstatechange=()=>{en.prevState=en.curState,en.curState=Aa?Aa.state:void 0;const{prevState:r,curState:i}=en,s=i==="running",c=i==="interrupted",d=r==="running",u=r==="suspended",f=r==="interrupted",g=jt().osVersion;(Qr()||Rs())&&d&&c&&(R.info("ios".concat(g,"-interruption-start")),en.emit(Ir.IOS_INTERRUPTION_START)),(Qr()||Rs())&&(u||f)&&s&&(R.info("ios".concat(g,"-interruption-end")),en.emit(Ir.IOS_INTERRUPTION_END)),r!==i&&en.emit(Ir.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Aa)===null||r===void 0?void 0:r.currentTime;en.currentTime!==i?(en.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(i)),en.currentTimeStuckAt=void 0),en.currentTime=i):(i!==en.currentTimeStuckAt&&(We.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:rn.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(i))),en.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,c,d=!1,u=!1,f=!1;function g(G){r.state==="running"?v(!1):Qr()||Rs()?r.state==="suspended"&&(v(!0),G&&r.resume().then(_,_)):r.state!=="closed"&&(v(!0),G&&r.resume().then(_,_))}function v(G){if(d!==G){d=G;for(let K=0,X=i;K<X.length;K+=1){const te=X[K];G?window.addEventListener(te,S,{capture:!0,passive:!0}):window.removeEventListener(te,S,{capture:!0,passive:!0})}}}function _(){g(!1)}function S(){g(!0)}function w(){let G;try{G=s.play(),G?G.then(I,I):(s.addEventListener("playing",I),s.addEventListener("abort",I),s.addEventListener("error",I))}catch{I()}}function C(G){f||(s.paused?G?(M(!1),f=!0,w()):M(!0):M(!1))}function M(G){if(u!==G){u=G;for(let K=0,X=i;K<X.length;K++){const te=X[K];G?window.addEventListener(te,k,{capture:!0,passive:!0}):window.removeEventListener(te,k,{capture:!0,passive:!0})}}}function I(){s.removeEventListener("playing",I),s.removeEventListener("abort",I),s.removeEventListener("error",I),f=!1,C(!1)}function k(){C(!0)}if(Qr()&&W("IOS_BG_TAG")){const G=r.createMediaStreamDestination(),K=document.createElement("div");K.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=K.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=G.stream,c=()=>{if(W("IOS_AUTO_RESTART_BG_TAG")&&s&&s.srcObject&&!f&&(!s.paused||u!==!0)){s.paused||s.pause();try{f=!0,w()}catch{f=!1}return!0}},C(!0)}return en.on(Ir.STATE_CHANGE,function(){g(!0)}),g(!1),c}(Aa).then(r=>{oN=r})}(),!Aa)throw new pe($.NOT_SUPPORTED,"can not create audio context");return Aa}return Aa}function Tu(t){if(function(){if(cN!==null)return cN;const s=Mp(),c=s.createBufferSource(),d=s.createGain(),u=s.createGain();c.connect(d),c.connect(u),c.disconnect(d);let f=!1;try{c.disconnect(d)}catch{f=!0}return c.disconnect(),cN=f,f}())return;const r=t.connect,i=t.disconnect;t.connect=(s,c,d)=>{var u;return t._inputNodes||(t._inputNodes=[]),xe(u=t._inputNodes).call(u,s)||(s instanceof AudioNode?(t._inputNodes.push(s),r.call(t,s,c,d)):r.call(t,s,c)),t},t.disconnect=(s,c,d)=>{i.call(t),s?oE(t._inputNodes,s):t._inputNodes=[];for(const u of t._inputNodes)r.call(t,u)}}let cN=null;function lN(t,r){let i=!1;const s=1/r;if(W("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):t(performance.now()/1e3)},1e3*s)}else{const c=Mp();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const u=()=>{if(i)return void(d=null);const f=c.createOscillator();f.onended=u,f.connect(d),f.start(0),f.stop(c.currentTime+s),t(c.currentTime)};u()}return()=>{i=!0}}class h3{constructor(){oe(this,"context",void 0),oe(this,"analyserNode",void 0),oe(this,"sourceNode",void 0),this.context=Mp(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Qr()||Rs()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<r.length;++c)r[c]=s[c]/128-1}const i=qa(r).call(r,(s,c)=>s+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class p3 extends Sn{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),oe(this,"outputNode",void 0),oe(this,"outputTrack",void 0),oe(this,"isPlayed",!1),oe(this,"sourceNode",void 0),oe(this,"context",void 0),oe(this,"audioBufferNode",void 0),oe(this,"destNode",void 0),oe(this,"audioOutputLevel",0),oe(this,"volumeLevelAnalyser",void 0),oe(this,"_processedNode",void 0),oe(this,"playNode",void 0),oe(this,"isDestroyed",!1),oe(this,"onNoAudioInput",void 0),oe(this,"isNoAudioInput",!1),oe(this,"_noAudioInputCount",0),this.context=Mp(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Tu(this.outputNode),this.volumeLevelAnalyser=new h3}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Ca.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const d=s.outputBuffer.getChannelData(c);for(let u=0;u<d.length;u+=1)d[u]=0}return s.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!wt().webAudioMediaStreamDest)throw new pe($.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&cE(()=>{en.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Qr()||Rs()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let s;i.getFloatTimeDomainData?(s=new Float32Array(i.fftSize),i.getFloatTimeDomainData(s)):(s=new Uint8Array(i.fftSize),i.getByteTimeDomainData(s));let c=!1;for(let d=0;d<s.length;d++)s[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await dr(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class dN extends p3{get isFreeze(){return!1}constructor(r,i,s){var c;if(super(),oe(this,"sourceNode",void 0),oe(this,"track",void 0),oe(this,"clonedTrack",void 0),oe(this,"audioElement",void 0),oe(this,"isCurrentTrackCloned",!1),oe(this,"isRemoteTrack",!1),oe(this,"originVolumeLevelAnalyser",void 0),oe(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const f=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?f.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),Tu(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Tu(this.outputNode),this.emit(Ca.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new pe($.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(d),Tu(this.sourceNode),s){const f=s.clone();f.enabled=!0,this.clonedTrack=f,R.debug("create an unmuted track ".concat(f.id," from the original track ").concat(s.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([f]));Tu(g),this.originVolumeLevelAnalyser=new h3,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const u=jt();i&&u.os===lr.IOS&&Number((c=u.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(en.on(Ir.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(f=>{f||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),Tu(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ca.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),en.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),R.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([i]));Tu(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function f3(t,r,i){const s=(d,u)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||u:d:u,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:s(r.height,1080),maxWidth:s(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function ige(t,r){const i=await m3(t.mediaSource),{sourceId:s,audio:c}=await function(d){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ie((f,g)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const S=document.createElement("div");S.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",S.setAttribute("style","height: 12%;");const w=document.createElement("div");w.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const M=document.createElement("button");M.innerHTML="cancel",M.setAttribute("style","width: 85px;"),M.onclick=()=>{document.body.removeChild(G);const K=new Error("NotAllowedError");K.name="NotAllowedError",g(K)};let I=u;const k=document.createElement("div");if(u){const K=document.createElement("input");K.setAttribute("type","checkbox");const X=document.createElement("span");K.setAttribute("style","margin-right: 6px;"),X.innerText="Share audio",K.checked=I,K.onchange=()=>{I=K.checked},k.appendChild(K),k.appendChild(X)}C.appendChild(k),C.appendChild(M),_.appendChild(S),_.appendChild(w),_.appendChild(C);const G=document.createElement("div");G.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),G.appendChild(v),G.appendChild(_),document.body.appendChild(G),d.map(K=>{if(K.id){const X=document.createElement("div");X.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let te=K.thumbnail;try{const{width:ne}=te.getSize();ne>1920&&(te=te.resize({width:1920}))}catch(ne){throw ne&&ne.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ne}X.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+te.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+K.name.replace(/[\u00A0-\u9999<>\&]/g,function(ne){return"&#"+ne.charCodeAt(0)+";"})+"</span>",X.onclick=()=>{document.body.removeChild(G),f({sourceId:K.id,audio:I})},w.appendChild(X)}})})}(i,r);return await f3(s,t,c)}async function m3(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const i=T5();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new pe($.ELECTRON_IS_NULL);let s=null;try{var c;s=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{s=null}s&&s.then||(s=new Ie((d,u)=>{i.desktopCapturer.getSources({types:r},(f,g)=>{f?u(f):d(g)})}));try{return await s}catch(d){throw new pe($.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const uN=new br("safari");let g3=!1,v3=!1;async function Na(t,r){let i=0,s=null;for(;i<2;)try{s=await age(t,r,i>0);break}catch(c){if(c instanceof pe)throw R.error("[".concat(r,"] ").concat(c.toString())),c;const d=bE(c.name||c.code||c,c.message);if(d.code===$.MEDIA_OPTION_INVALID){R.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await dr(500);continue}throw R.error("[".concat(r,"] ").concat(d.toString())),d}if(!s)throw new pe($.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function age(t,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new pe($.NOT_SUPPORTED,"can not find getUserMedia");i&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const s=wt(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return R.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(T5())t.screen.sourceId?Up(c,await f3(t.screen.sourceId,t.screen,!!t.screenAudio)):Up(c,await ige(t.screen,!!t.screenAudio));else if($c()&&t.screen.extensionId&&t.screen.mandatory){if(!s.getStreamFromExtension)throw new pe($.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const w=await(u=t.screen.extensionId,f=r,new Ie((C,M)=>{try{chrome.runtime.sendMessage(u,{getStream:!0},I=>{if(!I||!I.streamId)return R.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),I),void M(new pe($.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(I.streamId)})}catch(I){R.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(u,")"),I.toString()),M(new pe($.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=w,Up(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(s.getDisplayMedia){var d;t.screen.mediaSource&&s3(t.screen.mediaSource);const w={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:M,systemAudio:I,preferCurrentTab:k,windowAudio:G,monitorTypeSurfaces:K}=t.screen,X={selfBrowserSurface:C,surfaceSwitching:M,systemAudio:I,preferCurrentTab:k,windowAudio:G,monitorTypeSurfaces:K};!C&&delete X.selfBrowserSurface,!M&&delete X.surfaceSwitching,!I&&delete X.systemAudio,!k&&delete X.preferCurrentTab,!G&&delete X.windowAudio,!K&&delete X.monitorTypeSurfaces,R.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:w,audio:t.screenAudio,controls:X})),Up(c,await navigator.mediaDevices.getDisplayMedia(hn({video:w,audio:t.screenAudio},X)))}else{if(!fn())throw R.error("[".concat(r,"] This browser does not support screenSharing")),new pe($.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&s3(t.screen.mediaSource);const w={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};R.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(w))),Up(c,await navigator.mediaDevices.getUserMedia(w))}}var u,f;if(!t.video&&!t.audio)return c;let g={video:t.video,audio:t.audio},v=W("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),g=VA(g,v)}catch{}R.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),jt();let _,S=null;(Er()||Qr()||sE())&&(S=await uN.lock());try{_=await navigator.mediaDevices.getUserMedia(g)}catch(w){throw S&&S(),w}return g.audio&&(g3=!0),g.video&&(v3=!0),Up(c,_),S&&S(),c}function bE(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new pe($.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new pe($.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new pe($.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new pe($.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new pe($.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new pe($.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return R.error("getUserMedia unexpected error",t),new pe($.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function Up(t,r){const i=t.getVideoTracks()[0],s=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(s&&t.removeTrack(s),t.addTrack(d)),c&&(i&&t.removeTrack(i),t.addTrack(c))}const Oa=new class extends Sn{get state(){return this._state}set state(t){t!==this._state&&(this.emit(xu.STATE_CHANGE,t),this._state=t)}constructor(){super(),oe(this,"_state",Wg.IDLE),oe(this,"isAccessMicrophonePermission",!1),oe(this,"isAccessCameraPermission",!1),oe(this,"lastAccessMicrophonePermission",!1),oe(this,"lastAccessCameraPermission",!1),oe(this,"checkdeviceMatched",!1),oe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(W("ENUMERATE_DEVICES_INTERVAL")||(Dg()||aE()===lr.HARMONY_OS)&&ic())&&this.updateDevicesInfo()},W("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>R.error(t.toString()))}async enumerateDevices(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new pe($.NOT_SUPPORTED,"enumerateDevices() not supported.");const s=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(s);let d=!this.isAccessMicrophonePermission&&t,u=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(u=!1);let f=null,g=null,v=null;if(!i&&(d||u)){if(uN.isLocked&&(R.debug("[device manager] wait GUM lock"),(await uN.lock())(),R.debug("[device manager] GUM unlock")),g3&&(d=!1,this.isAccessMicrophonePermission=!0),v3&&(u=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",t,r,d,u),d&&u){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const S=bE(_.name||_.code||_,_.message);if(S.code===$.PERMISSION_DENIED)throw S;R.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{f=await navigator.mediaDevices.getUserMedia({audio:t})}catch(_){const S=bE(_.name||_.code||_,_.message);if(S.code===$.PERMISSION_DENIED)throw S;R.warning("getUserMedia failed in getDevices",S)}this.isAccessMicrophonePermission=!0}else if(u){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(_){const S=bE(_.name||_.code||_,_.message);if(S.code===$.PERMISSION_DENIED)throw S;R.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",t,"cam permission",r)}try{const _=await navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(S=>S.stop()),g&&g.getTracks().forEach(S=>S.stop()),v&&v.getTracks().forEach(S=>S.stop()),f=null,g=null,v=null,_}catch(_){return f&&f.getTracks().forEach(S=>S.stop()),g&&g.getTracks().forEach(S=>S.stop()),v&&v.getTracks().forEach(S=>S.stop()),f=null,g=null,v=null,new pe($.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===t&&(r=i.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===t);if(!r)throw new pe($.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=Wg.INITING;try{await this.updateDevicesInfo(),this.state=Wg.INITEND}catch(t){throw this.state=Wg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(R.warning("Device Detection functionality cannot start properly.",t.toString()),t):new pe($.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(u=>u.kind==="audioinput"&&u.deviceId==="default"),d=t.find(u=>u.kind==="audiooutput"&&u.deviceId==="default");c&&d?d.groupId===c.groupId?R.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):R.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):R.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const u={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),u),i.push(u)}d&&(d.updateAt=r)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==Wg.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(xu.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(xu.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(xu.PLAYOUT_DEVICE_CHANGED,c)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),i=t.filter(c=>c.kind==="videoinput"),s={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};let hN=!1;const Ii=new class extends Sn{constructor(){super(...arguments),oe(this,"onAutoplayFailed",void 0),oe(this,"onAudioAutoplayFailed",void 0)}};function y3(){if(hN)return W("FLS_AUTOPLAY_EMITS")?(Ii.onAutoplayFailed&&Ii.onAutoplayFailed(),Ii.emit("autoplay-failed")):void 0;{const t=r=>{r.preventDefault(),hN=!1,kg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};hN=!0,kg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ii.onAutoplayFailed?Ii.onAutoplayFailed():Ii.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ii.emit("autoplay-failed")}}function _3(t,r,i,s){if(!t)return;const c=We.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,u=Date.now(),f=hn(hn({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:u,elapse:u-c.startTime,cbRegistered:Ii.onAutoplayFailed||Ii.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:s,extend:void 0});We.send({type:_n.AUTOPLAY_FAILED,data:f},!0)}const sge=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ii=new class{constructor(){oe(this,"onAutoplayFailed",void 0),oe(this,"elementMap",new Map),oe(this,"elementStateMap",new Map),oe(this,"elementsNeedToResume",[]),oe(this,"sinkIdMap",new Map),oe(this,"autoResumeAfterInterruption",t=>Ie.all(Array.from(this.elementMap.entries()).map(async r=>{let[i,s]=r;const c=this.elementStateMap.get(i),d=s.srcObject.getAudioTracks()[0],u=d&&d.readyState;if(R.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(u," ").concat(t)),u==="live"){if(t)return s.pause(),s.play();if(en.curState==="running")return xp()?(s.pause(),s.play()):c&&c==="paused"?s.play():void 0}}))),oe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t;const s=i.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),en.on(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),en.on(Ir.STATE_CHANGE,()=>{Qr()&&en.prevState==="suspended"&&en.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const i=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),i)try{await i.setSinkId(r)}catch(s){throw new pe($.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(t,r,i,s){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,$r.INIT),this.setVolume(r,i);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch(f=>{R.warning("[".concat(r,"] set sink id failed"),f.toString())})}catch(f){R.warning("[".concat(r,"] set sink id failed"),f.toString())}const u=c.play();u&&u.then&&u.catch(f=>{s&&_3(s,"audio",f.message,r),R.warning("audio element play warning",f.toString()),this.elementMap.has(r)&&f.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),cE(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),y3()}))})}updateTrack(t,r){const i=this.elementMap.get(t);i&&(i.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const i=this.elementMap.get(t);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}getVolume(t){const r=this.elementMap.get(t);return r?r.volume:0}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){sge.forEach(i=>{r.addEventListener(i,s=>{const c=this.elementStateMap.get(t),d=s.type==="pause"?"paused":s.type;if(R.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),s.type==="error"){const u=r==null?void 0:r.error;u&&R.error("[".concat(t,"] media error, code: ").concat(u.code,", message: ").concat(u.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{R.debug("Auto resume audio element success")}).catch(i=>{R.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new Ie(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{kg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Dn(){return function(t,r,i){const s=i.value;return typeof s=="function"&&(i.value=function(){this._isClosed&&new pe($.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];const f=s.apply(this,d);return f instanceof Ie?new Ie((g,v)=>{f.then(g).catch(v)}):f}),i}}class E3 extends Sn{constructor(r){super(),oe(this,"name","VideoProcessorDestination"),oe(this,"ID","0"),oe(this,"_source",void 0),oe(this,"videoContext",void 0),oe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new pe($.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new pe($.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(_i.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(_i.ON_TRACK,void 0)}}class b3 extends Sn{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),oe(this,"constraintsMap",new Map),oe(this,"statsRegistry",[]),oe(this,"usageRegistry",[]),oe(this,"trackId",void 0),oe(this,"direction",void 0),oe(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await qn(this,Ra.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var s;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),cn(this,Ra.REQUEST_UPDATE_CONSTRAINTS,Array.from(oa(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return R.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),cn(this,Ra.REQUEST_UPDATE_CONSTRAINTS,Array.from(oa(i=this.constraintsMap).call(i)))}registerStats(r,i,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:c,cb:d}of this.statsRegistry)try{const u=d();r.push({processorID:i,processorName:s,type:c,stats:u})}catch(u){R.error(new pe($.UNEXPECTED_ERROR,u.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof Ie&&(s=await s),r.push(hn(hn({},s),{},{direction:this.direction}))}catch(s){R.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class S3 extends Sn{constructor(r){super(),oe(this,"name","AudioProcessorDestination"),oe(this,"ID","0"),oe(this,"inputTrack",void 0),oe(this,"inputNode",void 0),oe(this,"audioProcessorContext",void 0),oe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new pe($.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new pe($.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(_i.ON_TRACK,void 0),this.emit(_i.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(_i.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(_i.ON_NODE,this.inputNode))}}class w3 extends Sn{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,s){super(),oe(this,"constraintsMap",new Map),oe(this,"statsRegistry",[]),oe(this,"audioContext",void 0),oe(this,"trackId",void 0),oe(this,"direction",void 0),oe(this,"usageRegistry",[]),oe(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=s}async getConstraints(){return qn(this,Ra.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var s;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),cn(this,Ra.REQUEST_UPDATE_CONSTRAINTS,Array.from(oa(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),cn(this,Ra.REQUEST_UPDATE_CONSTRAINTS,Array.from(oa(i=this.constraintsMap).call(i)))}registerStats(r,i,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:c,cb:d}of this.statsRegistry)try{const u=d();r.push({processorID:i,processorName:s,type:c,stats:u})}catch(u){R.error(new pe($.UNEXPECTED_ERROR,u.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof Ie&&(s=await s),r.push(hn(hn({},s),{},{direction:this.direction}))}catch(s){R.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class pN extends Sn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),oe(this,"context",void 0),oe(this,"processSourceNode",void 0),oe(this,"outputTrack",void 0),oe(this,"processedNode",void 0),oe(this,"clonedTrack",void 0),oe(this,"outputNode",void 0),this.outputNode=new oge}setVolume(){}createOutputTrack(){throw new pe($.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class oge{disconnect(){}connect(){}}function x3(t){return new Ie((r,i)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=Qr()?"canplay":"playing";c.addEventListener(d,()=>{const u=c.videoWidth,f=c.videoHeight;!u&&fn()||(s=!0,c.srcObject=null,c.remove(),r([u,f]))}),c.srcObject=new MediaStream([t]),c.play().catch(Mg),setTimeout(()=>{s||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function SE(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const i=Ps(t.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!v5()&&i.frameRate&&(r.frameRate=i.frameRate),l5()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),fn()&&(r.frameRate={ideal:30,max:30}),r}function T3(t){const r={};return v5()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,$c()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function C3(t){const r=T3(t);if(t.encoderConfig){const i=_E(t.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),Dg()&&(r.sampleRate=void 0),r}const R3=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:i,width:s,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=i,width:u=s,height:f=c}=r;if(!d||!u||!f)return;u=Rp(u),f=Rp(f),d=Rp(d);const{max:g,min:v}=function(C,M,I){const k=200*Math.pow(I/15,.6)*Math.pow(C*M/640/360,.75);return{min:Math.floor(k),max:Math.floor(4*k)}}(u,f,d),{bitrateMax:_,bitrateMin:S}=r||{};_||R.debug("calculate bitrate: [w: ".concat(u,", h: ").concat(f,", fps: ").concat(d,"] => [brMax: ").concat(_,", brMin: ").concat(S,"]"));const{maxFramerate:w}=W("ENCODER_CONFIG_LIMIT");return w&&typeof w=="number"&&(d=Math.min(d,w)),{frameRate:d,bitrateMax:_||g,bitrateMin:S||v,scaleResolutionDownBy:1,scale:0}},A3=async(t,r,i)=>await(async(s,c,d)=>{const u=function(v){const _=[];for(let S=0;S<v.length;S+=2)_.push(parseInt(v.slice(S,S+2),16));return Uint8Array.from(_)}(M5(""+c+d)).slice(0,16),f=u.slice(0,12),g=await window.crypto.subtle.importKey("raw",u,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},g,s))})(t.buffer,r,i),fN=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new Ie((i,s)=>{r.toBlob(async c=>{if(r.remove(),c){const d=await N3(c);i({buffer:d,width:r.width,height:r.height})}else s(new pe($.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},N3=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var O3,I3,P3,D3,k3,L3,j3,M3,U3,V3,F3,B3,W3,G3,$3,H3,z3,K3,Rn,Y3,q3,X3,J3,Q3,Z3,oc,eB,tB,nB,rB,iB,aB,sB,oB,cB,lB,dB,uB,hB,Fr;let kn=(O3=Qe({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),I3=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),P3=Dn(),D3=Ap("LocalAudioTrack","_enabledMutex"),k3=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),L3=Dn(),j3=Ap("LocalAudioTrack","_enabledMutex"),M3=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),U3=Dn(),V3=Dn(),F3=Dn(),B3=Qe({argsMap:t=>[t.getTrackId()]}),W3=Dn(),G3=Qe({argsMap:t=>[t.getTrackId()]}),$3=Dn(),H3=Qe({argsMap:t=>[t.getTrackId()]}),z3=Qe({argsMap:(t,r)=>[t.getTrackId(),r.name]}),K3=Qe({argsMap:t=>[t.getTrackId()]}),It((Rn=class extends jp{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ii.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,i,s){super(t,i),oe(this,"trackMediaType",Lp.AUDIO),oe(this,"_encoderConfig",void 0),oe(this,"_trackSource",void 0),oe(this,"metadata",[]),oe(this,"_enabled",!0),oe(this,"_volume",100),oe(this,"_useAudioElement",!0),oe(this,"_bypassWebAudio",!1),oe(this,"processor",void 0),oe(this,"_processorContext",void 0),oe(this,"_processorDestination",void 0),oe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!s,this._trackSource=new pN,W("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),W("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Er()&&!Aa?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){nn(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&ii.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,cn(this,Ge.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!t3())throw new pe($.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ii.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,i){return this._setEnabled(t,r,i)}async _setEnabled(t,r,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await cn(this,Ge.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(s){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await cn(this,Ge.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await cn(this,Ge.NEED_MUTE_TRACK,this):await cn(this,Ge.NEED_UNMUTE_TRACK,this))}getStats(){return Hl(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),da(this,Ge.GET_STATS)||hn({},iN)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Ca.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Ca.ON_AUDIO_BUFFER),this._source.on(Ca.ON_AUDIO_BUFFER,i=>t(i))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ii.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ii.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ii.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Ge.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return Ie.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new pe($.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new pe($.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(_i.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await cn(this,Ge.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Ge.NEED_REPLACE_TRACK,this))}),t.on(_i.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(_i.ON_TRACK),t.removeAllListeners(_i.ON_NODE)}bindProcessorContextEvents(t){t.on(Ra.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Ra.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof pN&&(this._trackSource=new dN(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new w3(this._source.context,this.getTrackId(),"local"),r=new S3(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(Ca.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ii.stop(this.getTrackId()),this._source.play()),cn(this,Ge.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[O3],Object.getOwnPropertyDescriptor(Rn.prototype,"setVolume"),Rn.prototype),It(Rn.prototype,"setPlaybackDevice",[I3,P3],Object.getOwnPropertyDescriptor(Rn.prototype,"setPlaybackDevice"),Rn.prototype),It(Rn.prototype,"setEnabled",[D3,k3,L3],Object.getOwnPropertyDescriptor(Rn.prototype,"setEnabled"),Rn.prototype),It(Rn.prototype,"setMuted",[j3,M3,U3],Object.getOwnPropertyDescriptor(Rn.prototype,"setMuted"),Rn.prototype),It(Rn.prototype,"getStats",[V3],Object.getOwnPropertyDescriptor(Rn.prototype,"getStats"),Rn.prototype),It(Rn.prototype,"setAudioFrameCallback",[F3],Object.getOwnPropertyDescriptor(Rn.prototype,"setAudioFrameCallback"),Rn.prototype),It(Rn.prototype,"play",[B3,W3],Object.getOwnPropertyDescriptor(Rn.prototype,"play"),Rn.prototype),It(Rn.prototype,"stop",[G3,$3],Object.getOwnPropertyDescriptor(Rn.prototype,"stop"),Rn.prototype),It(Rn.prototype,"close",[H3],Object.getOwnPropertyDescriptor(Rn.prototype,"close"),Rn.prototype),It(Rn.prototype,"pipe",[z3],Object.getOwnPropertyDescriptor(Rn.prototype,"pipe"),Rn.prototype),It(Rn.prototype,"unpipe",[K3],Object.getOwnPropertyDescriptor(Rn.prototype,"unpipe"),Rn.prototype),Rn),Gg=(Y3=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),q3=Dn(),X3=Ap("MicrophoneAudioTrack","_enabledMutex"),J3=Qe({argsMap:(t,r,i)=>[t.getTrackId(),r,i]}),Q3=Dn(),Z3=Qe({argsMap:t=>[t.getTrackId()]}),It((oc=class extends kn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,i,s){super(t,r.encoderConfig?_E(r.encoderConfig):{},s,W("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),oe(this,"_config",void 0),oe(this,"_deviceName","default"),oe(this,"_constraints",void 0),oe(this,"_originalConstraints",void 0),oe(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(xp()||IA())&&en.bindInterruptDetectorTrack(this)}async setDevice(t){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await Oa.getDeviceById(t),i={};i.audio=hn({},this._constraints),i.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let s=null;try{s=await Na(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await Na({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Oa.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,i){if(r)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),W("AUTO_RESET_AUDIO_ROUTE")&&(Qr()||Rs())){const u=navigator.audioSession;u&&(t||(u.type="playback"),u.type="auto")}if(!t){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await cn(this,Ge.NEED_DISABLE_TRACK,this)}catch(u){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),u}return}const c=hn({},this._constraints),d=Oa.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{i||(this._enabled=!0);const u=await Na({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),await cn(this,Ge.NEED_ENABLE_TRACK,this)}catch(u){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),u}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(xp()||IA())&&en.unbindInterruptDetectorTrack(this),Su.some(t=>function(r){return"__className__"in r&&r.__className__==="MicrophoneAudioTrack"}(t))||oN&&oN()&&(We.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:rn.TRACER}).onSuccess(),R.debug("restart background audio tag success"))}onTrackEnded(){if((Qr()||Rs())&&this._enabled&&!this._isClosed&&en.duringInterruption){const t=async()=>{en.off(Ir.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(Ir.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(kp.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,i=Oa.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const s=await Na({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Ra.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Ra.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Y3,q3],Object.getOwnPropertyDescriptor(oc.prototype,"setDevice"),oc.prototype),It(oc.prototype,"setEnabled",[X3,J3,Q3],Object.getOwnPropertyDescriptor(oc.prototype,"setEnabled"),oc.prototype),It(oc.prototype,"close",[Z3],Object.getOwnPropertyDescriptor(oc.prototype,"close"),oc.prototype),oc),cge=(eB=Qe({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),tB=Dn(),nB=Qe({argsMap:t=>[t.getTrackId()]}),rB=Dn(),iB=Qe({argsMap:t=>[t.getTrackId()]}),aB=Dn(),sB=Qe({argsMap:t=>[t.getTrackId()]}),oB=Dn(),cB=Qe({argsMap:t=>[t.getTrackId()]}),lB=Dn(),dB=Qe({argsMap:t=>[t.getTrackId()]}),uB=Qe({argsMap:t=>[t.getTrackId()]}),hB=Dn(),It((Fr=class extends kn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,i,s){super(r.createOutputTrack(),i,s),oe(this,"source",void 0),oe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(Ca.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(kp.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){nn(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[eB,tB],Object.getOwnPropertyDescriptor(Fr.prototype,"startProcessAudioBuffer"),Fr.prototype),It(Fr.prototype,"pauseProcessAudioBuffer",[nB,rB],Object.getOwnPropertyDescriptor(Fr.prototype,"pauseProcessAudioBuffer"),Fr.prototype),It(Fr.prototype,"seekAudioBuffer",[iB,aB],Object.getOwnPropertyDescriptor(Fr.prototype,"seekAudioBuffer"),Fr.prototype),It(Fr.prototype,"resumeProcessAudioBuffer",[sB,oB],Object.getOwnPropertyDescriptor(Fr.prototype,"resumeProcessAudioBuffer"),Fr.prototype),It(Fr.prototype,"stopProcessAudioBuffer",[cB,lB],Object.getOwnPropertyDescriptor(Fr.prototype,"stopProcessAudioBuffer"),Fr.prototype),It(Fr.prototype,"close",[dB],Object.getOwnPropertyDescriptor(Fr.prototype,"close"),Fr.prototype),It(Fr.prototype,"setAudioBufferPlaybackSpeed",[uB,hB],Object.getOwnPropertyDescriptor(Fr.prototype,"setAudioBufferPlaybackSpeed"),Fr.prototype),Fr);class tr extends kn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Mp().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,Kt(8,"track-mix-")),oe(this,"trackList",void 0),oe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(R.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):R.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){R.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}oE(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof tr?i.emit(wu.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class lge extends p3{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Ca.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),oe(this,"audioBuffer",void 0),oe(this,"sourceNode",void 0),oe(this,"startPlayTime",0),oe(this,"startPlayOffset",0),oe(this,"pausePlayTime",0),oe(this,"options",void 0),oe(this,"currentLoopCount",0),oe(this,"currentPlaybackSpeed",100),oe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const pB=new Map;function fB(t,r){if(t.length===0||r.length===0)return 1/0;const i=BA(t),s=BA(r);return Math.floor(s/i)}class mN{get rendFrameRate(){const r=Math.max(1,fB(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:$r.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){oe(this,"trackId",void 0),oe(this,"config",void 0),oe(this,"onFirstVideoFrameDecoded",void 0),oe(this,"onFirstVideoFrameRender",void 0),oe(this,"onVideoBufferReady",void 0),oe(this,"onVideoStateChanged",void 0),oe(this,"freezeTimeCounterList",[]),oe(this,"renderFreezeAccTime",0),oe(this,"renderFreezeAccTime2",0),oe(this,"isKeepLastFrame",!1),oe(this,"isDestroyed",!1),oe(this,"timeUpdatedCount",0),oe(this,"freezeTime",0),oe(this,"playbackTime",0),oe(this,"lastTimeUpdatedTime",0),oe(this,"autoplayFailed",!1),oe(this,"videoTrack",void 0),oe(this,"videoElement",void 0),oe(this,"cacheVideoElement",void 0),oe(this,"cancelRVFId",void 0),oe(this,"internal",!1),oe(this,"_render_interframe_delays",[]),oe(this,"_render_interframe_delays_sizes",[]),oe(this,"_videoState",sc.VideoStateStopped),oe(this,"videoElementCheckInterval",void 0),oe(this,"videoElementFreezeTimeout",void 0),oe(this,"_videoElementStatus",$r.NONE),oe(this,"_isInPage",!0),oe(this,"isGettingVideoDimensions",!1),oe(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),oe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&en.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(o5())),m5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),oe(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":i.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=$r.PLAYING;break;case"loadeddata":if(this.videoState=sc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=$r.CANPLAY;break;case"stalled":this.videoElementStatus=$r.STALLED;break;case"suspend":this.videoElementStatus=$r.SUSPEND;break;case"pause":this.videoElementStatus=$r.PAUSED,Qr()||Rs()||Er()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=$r.WAITING;break;case"abort":this.videoElementStatus=$r.ABORT;break;case"ended":this.videoElementStatus=$r.ENDED;break;case"emptied":this.videoElementStatus=$r.EMPTIED;break;case"error":{const s=this.videoElement.error;s&&(this.videoElementStatus=$r.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>W("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,ua.lastVisibleTime<ua.lastHiddenTime||d<ua.lastHiddenTime||d<ua.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>W("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const u=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(u),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),oe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(o5())),m5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),en.on(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&_3(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),c)});const s=jt();if((s.name==="Safari"&&Number(s.version)===15||xp())&&i&&i.then){const c=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return R.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const s=i.getImageData(0,0,r.width,r.height);return r.remove(),s}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const c=s.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,s.width,s.height),new Ie((d,u)=>{s.toBlob(async f=>{if(s.remove(),f){const g=await N3(f);d({buffer:g,width:s.width,height:s.height})}else u(new pe($.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await fN(r)}destroy(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,en.off(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.off(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),r?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=sc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=$r.INIT,!this.videoElementCheckInterval&&(mB.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(d){return d!==document.body&&document.body.contains(d)}(this.videoElement)},1e3),W("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let d;const u=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",u),this.videoElementFreezeTimeout=window.setTimeout(f,W("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===sc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=sc.VideoStateFrozen:document.addEventListener("visibilitychange",u))},g=(v,_)=>{if(this.videoElementStatus===$r.PLAYING){if(d){const C=_.presentationTime-d.presentationTime,M=_.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(M),this._render_interframe_delays.push(C);const I=BA(this._render_interframe_delays_sizes),k=I-this._render_interframe_delays_sizes[0];if(I>30&&k>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===sc.VideoStateStarting&&(this.videoState=sc.VideoStateDecoding),this.videoState===sc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,W("VIDEO_FREEZE_DURATION"))),C<W("VIDEO_FREEZE_DURATION")&&this.videoState===sc.VideoStateFrozen&&(this.videoState=sc.VideoStateDecoding),C>W("VIDEO_FREEZE_DURATION")&&ua.lastVisibleTime>=ua.lastHiddenTime&&d.timestamp>ua.lastVisibleTime&&d.timestamp>ua.lastHiddenTime){const G=Math.min(66,fB(this._render_interframe_delays_sizes,this._render_interframe_delays)),K=Math.max(0,C-(M-1)*G);this.renderFreezeAccTime2+=K>G?K:0,this.renderFreezeAccTime+=C}}d=hn(hn({},_),{},{timestamp:v})}else this.isSkipCalcRenderFreezeTime()&&(d=hn(hn({},_),{},{timestamp:v}));var S,w;W("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(S=(w=this.videoElement).requestVideoFrameCallback)===null||S===void 0?void 0:S.call(w,g))};this.cancelRVFId=(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0?void 0:r.call(i,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Dg()&&!W("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=jt();this.config.noStyle||(s.name==="Safari"&&Number(s.version)===15||xp()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,fn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,fn()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(d=>{R.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){var r,i;mB.forEach(s=>{this.videoElement&&this.videoElement.removeEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((r=(i=this.videoElement).cancelVideoFrameCallback)===null||r===void 0||r.call(i,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=$r.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===$r.DESTROYED||this.internal}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{R.error(s)}),this.autoplayFailed=!1,kg()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};kg()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),y3()}}const mB=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class wE extends mN{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),oe(this,"container",void 0),oe(this,"slot",void 0),this.slot=r.element,this.internal=i,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;var s;!this.internal||this.slot?(i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()):(this.slot=i,i&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(s=this.slot)===null||s===void 0||s.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,s):await fN(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",W("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var gB,vB,yB,_B,EB,bB,SB,wB,xB,TB,CB,RB,AB,NB,OB,IB,PB,DB,kB,LB,jB,MB,UB,VB,FB,BB,WB,GB,xt,$B,HB,zB,KB,YB,qB,XB,JB,Ia;let an=(gB=Qe({argsMap:(t,r,i)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),vB=Dn(),yB=Qe({argsMap:t=>[t.getTrackId()]}),_B=Ap("LocalVideoTrack","_enabledMutex"),EB=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),bB=Dn(),SB=Ap("LocalVideoTrack","_enabledMutex"),wB=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),xB=Dn(),TB=Qe({argsMap:(t,r)=>[t.getTrackId(),r,t._saveEncodeBitrateRatio]}),CB=Dn(),RB=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),AB=Dn(),NB=Dn(),OB=Qe({argsMap:(t,r,i)=>[t.getTrackId(),r,i]}),IB=Dn(),PB=Dn(),DB=Dn(),kB=Qe({argsMap:t=>[t.getTrackId()]}),LB=Dn(),jB=Dn(),MB=Dn(),UB=Dn(),VB=Dn(),FB=Qe({argsMap:(t,r)=>[t.getTrackId(),r.name]}),BB=Qe({argsMap:t=>[t.getTrackId()]}),WB=Qe({argsMap:t=>[t.getTrackId()]}),GB=Qe({argsMap:(t,r,i)=>[t.getTrackId(),r.label,i]}),xt=class Ite extends jp{get videoHeight(){if(Er()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Er()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==$r.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,s,c,d,u){if(super(r,d),oe(this,"trackMediaType",Lp.VIDEO),oe(this,"_player",void 0),oe(this,"isUseScaleResolutionDownBy",!1),oe(this,"_videoVisibleTimer",null),oe(this,"_previousVideoVisibleStatus",void 0),oe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oe(this,"_encoderConfig",void 0),oe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),oe(this,"_optimizationMode",void 0),oe(this,"_saveEncodeBitrateRatio",1),oe(this,"_videoHeight",void 0),oe(this,"_videoWidth",void 0),oe(this,"_forceBitrateLimit",void 0),oe(this,"_enabled",!0),oe(this,"_processorDestination",void 0),oe(this,"_processorContext",void 0),Er()){const{width:f,height:g}=r.getSettings();this._videoWidth=f,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=s,this._optimizationMode=c,this._hints=u||[],i&&this._hints.indexOf(Ht.CUSTOM_TRACK)!==-1?this._encoderConfig=mn(i):this._encoderConfig=i,this._hints.indexOf(Ht.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(AA(Ft.CHROME,115)&&aE().indexOf("Windows")!==-1){const f=function(g,v){if("VideoFrame"in window&&"TransformStream"in window&&wt().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(g),S=new MediaStreamTrackGenerator({kind:"video"});let w,C,M=Date.now();const I=()=>{k&&(clearInterval(k),k=void 0),w&&(w.close(),w=void 0),g.stop(),C=void 0,S.removeEventListener("ended",I)};let k=window.setInterval(()=>{if(C&&w&&Date.now()-M>1e3)try{S.readyState==="live"?C.enqueue(w.clone()):I()}catch{I()}},1e3);const G=new TransformStream({transform:(K,X)=>{S.readyState==="live"?(C=X,M=Date.now(),w===void 0?(w=K,X.enqueue(K.clone())):(X.enqueue(w),w=K)):K.close()}});return S.addEventListener("ended",I),_.readable.pipeThrough(G).pipeTo(S.writable),S}}(r);f&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}i&&this._hints.indexOf(Ht.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new b3(this.getTrackId(),"local"),this._processorDestination=new E3(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=hn(hn(hn({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(s):(r instanceof HTMLVideoElement?this._player=new mN(s):this._player=new wE(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(kp.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await cn(this,Ge.NEED_DISABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return i||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await cn(this,Ge.NEED_ENABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await cn(this,Ge.NEED_MUTE_TRACK,this):await cn(this,Ge.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await cn(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new pe($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Ps(r),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const s=SE({encoderConfig:r});(Er()||Qr()||Rs())&&(s.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){const d=new pe($.UNEXPECTED_ERROR,c.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(Ht.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(R)}}getStats(){return Hl(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),da(this,Ge.GET_STATS)||hn({},aN)}async setBeautyEffect(r){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await fN(r)}async findClosestProfile(){const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:u}=this._encoderConfig||{},f=Rp(this._videoWidth||r||c||0),g=Rp(this._videoHeight||i||d||0),v=function(_,S,w){if(!Array.isArray(W("VIDEO_ENCODER_CONFIG_LIST"))||W("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const C=Math.min(_,S);return!(C>=480)&&hn(hn({},W("VIDEO_ENCODER_CONFIG_LIST").find(M=>M.height>C)),{},{frameRate:w})}(f,g,Rp(s||u||15));if(v)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(f,"x").concat(g," => ").concat(JSON.stringify(v))),this.setEncoderConfiguration(v)}async setBitrateLimit(r){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void R.error($.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await cn(this,Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=i,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return R.error($.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){x3(this._originMediaStreamTrack).then(r=>{let[i,s]=r;this._videoHeight=s,this._videoWidth=i}).catch(Mg)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new pe($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Ps(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(Ht.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings();if(!r||!i||!s)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:u,min:f}=function(g,v,_,S,w){const C=W("BITRATE_ADAPTER_TYPE");if(C==="DEFAULT_BITRATE")return{min:S,max:w};if(w===void 0){const M=Math.floor(200*Math.pow(_/15,.6)*Math.pow(g*v/640/360,.75));w=C==="STANDARD_BITRATE"?4*M:2*M,S=S??M}else S=S??Math.floor(w/10);return{min:S,max:w}}(r,i,s,d,c);if(this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=u,W("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){const[g,v]=function(_,S,w){const C=4*Math.floor(2e5*Math.pow(w/15,.6)*Math.pow(_*S/230400,.75)),M=_*S,I=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),k=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let G=oa(I).call(I).next().value,K=1;if(I.has(M))G=I.get(M);else{var X;const Me=iu(X=Array.from(I.entries())).call(X,(tt,mt)=>{let[ht]=tt,[Wt]=mt;return ht-Wt}),at=Me.find(tt=>{let[mt]=tt;return mt>M});if(at){const tt=Me.indexOf(at);if(tt>0){const mt=Me[tt-1],ht=(M-mt[0])/(at[0]-mt[0]);G=mt[1]+ht*(at[1]-mt[1])}else G=at[1]}else G=Me[Me.length-1][1]}if(k.has(M))K=k.get(M);else{var te;const Me=iu(te=Array.from(k.entries())).call(te,(tt,mt)=>{let[ht]=tt,[Wt]=mt;return ht-Wt}),at=Me.find(tt=>{let[mt]=tt;return mt>M});if(at){const tt=Me.indexOf(at);if(tt>0){const mt=Me[tt-1],ht=(M-mt[0])/(at[0]-mt[0]);K=mt[1]+ht*(at[1]-mt[1])}else K=at[1]}else K=Me[Me.length-1][1]}const ne=W("VIDEO_NEW_BITRATE_RATIO");ne&&ne>0&&(G=ne/100);const Z=Math.floor(C*G),ie=Math.floor(65e4*Math.pow(_*S/230400,.5)*Math.pow(w/15,.69));let ge=Z;const Ee=W("VIDEO_STANDARD_BITRATE_VERSION");return Ee&&Ee>0&&(Ee===1?ge=C:Ee===2?ge=Z:Ee===3&&(ge=ie)),[Math.floor(ge/1e3),K]}(r,i,s);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=f?Math.min(f,g):g,this._saveEncodeBitrateRatio=v,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(u,", brMin: ").concat(f,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,i;const s=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:d,slot:u}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&u instanceof HTMLElement){const f=w5.checkOneElementVisible(d),g=Object.assign({},f);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const v=We.reportApiInvoke(null,{tag:rn.TRACER,name:yn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(s){throw new pe($.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new pe($.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=hn(hn({},s),Ps(r))),s=vu(s);const c=Kt(8,"track-video-cloned-"),d=new Ite(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,vu(this._scalabilityMode),this._optimizationMode,c,vu(this._hints));return r&&s&&d.setEncoderConfiguration(s),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),d}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new pe($.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new pe($.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Hl(()=>{We.reportApiInvoke(null,{name:yn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:rn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!W("ENABLE_VIDEO_SEI")||!W("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new pe($.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void R.warning("Video track is not published, SEI can not be send");const s=i.sender.getParameters();if(s.codecs.length===0)return;const c=s.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):R.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await cn(this,Ge.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await cn(this,Ge.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ra.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ra.REQUEST_CONSTRAINTS)}},It(xt.prototype,"play",[gB,vB],Object.getOwnPropertyDescriptor(xt.prototype,"play"),xt.prototype),It(xt.prototype,"stop",[yB],Object.getOwnPropertyDescriptor(xt.prototype,"stop"),xt.prototype),It(xt.prototype,"setEnabled",[_B,EB,bB],Object.getOwnPropertyDescriptor(xt.prototype,"setEnabled"),xt.prototype),It(xt.prototype,"setMuted",[SB,wB,xB],Object.getOwnPropertyDescriptor(xt.prototype,"setMuted"),xt.prototype),It(xt.prototype,"setSaveEncodeBitrateRatio",[TB,CB],Object.getOwnPropertyDescriptor(xt.prototype,"setSaveEncodeBitrateRatio"),xt.prototype),It(xt.prototype,"setEncoderConfiguration",[RB,AB],Object.getOwnPropertyDescriptor(xt.prototype,"setEncoderConfiguration"),xt.prototype),It(xt.prototype,"getStats",[NB],Object.getOwnPropertyDescriptor(xt.prototype,"getStats"),xt.prototype),It(xt.prototype,"setBeautyEffect",[OB,IB],Object.getOwnPropertyDescriptor(xt.prototype,"setBeautyEffect"),xt.prototype),It(xt.prototype,"getCurrentFrameData",[PB],Object.getOwnPropertyDescriptor(xt.prototype,"getCurrentFrameData"),xt.prototype),It(xt.prototype,"getCurrentFrameImage",[DB],Object.getOwnPropertyDescriptor(xt.prototype,"getCurrentFrameImage"),xt.prototype),It(xt.prototype,"findClosestProfile",[kB,LB],Object.getOwnPropertyDescriptor(xt.prototype,"findClosestProfile"),xt.prototype),It(xt.prototype,"setBitrateLimit",[jB],Object.getOwnPropertyDescriptor(xt.prototype,"setBitrateLimit"),xt.prototype),It(xt.prototype,"setOptimizationMode",[MB],Object.getOwnPropertyDescriptor(xt.prototype,"setOptimizationMode"),xt.prototype),It(xt.prototype,"setScalabiltyMode",[UB],Object.getOwnPropertyDescriptor(xt.prototype,"setScalabiltyMode"),xt.prototype),It(xt.prototype,"updateMediaStreamTrackResolution",[VB],Object.getOwnPropertyDescriptor(xt.prototype,"updateMediaStreamTrackResolution"),xt.prototype),It(xt.prototype,"pipe",[FB],Object.getOwnPropertyDescriptor(xt.prototype,"pipe"),xt.prototype),It(xt.prototype,"unpipe",[BB],Object.getOwnPropertyDescriptor(xt.prototype,"unpipe"),xt.prototype),It(xt.prototype,"close",[WB],Object.getOwnPropertyDescriptor(xt.prototype,"close"),xt.prototype),It(xt.prototype,"replaceTrack",[GB],Object.getOwnPropertyDescriptor(xt.prototype,"replaceTrack"),xt.prototype),xt),xE=($B=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),HB=Dn(),zB=Ap("CameraVideoTrack","_enabledMutex"),KB=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),YB=Dn(),qB=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),XB=Dn(),JB=Qe({argsMap:t=>[t.getTrackId()]}),Ia=class Pte extends an{get __className__(){return"CameraVideoTrack"}constructor(r,i,s,c,d,u){super(r,Ps(i.encoderConfig),c,d,u),oe(this,"_config",void 0),oe(this,"_originalConstraints",void 0),oe(this,"_constraints",void 0),oe(this,"_enabled",!0),oe(this,"_deviceName","default"),oe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(xp()||IA())&&!function(){const f=jt();if(f.os!==lr.IOS||!f.osVersion)return!1;const g=f.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2}()&&g5()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=r.label,this._encoderConfig=Ps(this._config.encoderConfig),en.on(Ir.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.on(Ir.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await Oa.getDeviceById(r),s={};s.video=hn({},this._constraints),s.video.deviceId={exact:r},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Na(s,this.getTrackId())}catch(d){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await Na({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Oa.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:hn(hn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Na(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),s=await Na({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=hn({},i.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await Na({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await cn(this,Ge.NEED_ENABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await cn(this,Ge.NEED_DISABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new pe($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Ps(r),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const s=mn(this._config);s.encoderConfig=r;const c=SE(s);(Er()||Qr()||Rs())&&(c.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const u=new pe($.UNEXPECTED_ERROR,d.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}this._config=s,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(Ht.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await cn(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Qr()||Rs())&&this._enabled&&!this._isClosed&&en.duringInterruption){const r=async()=>{en.off(Ir.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(Ir.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(kp.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,s=Oa.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId={exact:s}),this._enabled){const c=await Na({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),en.off(Ir.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.off(Ir.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=hn(hn({},s),Ps(r))),s=vu(s);const c=Kt(8,"track-cam-cloned-"),d=new Pte(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,vu(hn(hn({},this._config),{},{encoderConfig:s})),vu(this._constraints),vu(this._scalabilityMode),this._optimizationMode,c);return r&&s&&d.setEncoderConfiguration(s),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),d}bindProcessorContextEvents(){this.processorContext.on(Ra.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}}),this.processorContext.on(Ra.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},It(Ia.prototype,"setDevice",[$B,HB],Object.getOwnPropertyDescriptor(Ia.prototype,"setDevice"),Ia.prototype),It(Ia.prototype,"setEnabled",[zB,KB,YB],Object.getOwnPropertyDescriptor(Ia.prototype,"setEnabled"),Ia.prototype),It(Ia.prototype,"setEncoderConfiguration",[qB,XB],Object.getOwnPropertyDescriptor(Ia.prototype,"setEncoderConfiguration"),Ia.prototype),It(Ia.prototype,"close",[JB],Object.getOwnPropertyDescriptor(Ia.prototype,"close"),Ia.prototype),Ia);function QB(t){const r=Kt(8,"track-cus-"),i=We.reportApiInvoke(null,{id:r,tag:rn.TRACER,name:yn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),s=new kn(t.mediaStreamTrack,t.encoderConfig?_E(t.encoderConfig):{},r,!1);return R.info("create custom audio track success with config",t,"trackId",s.getTrackId()),i.onSuccess(s.getTrackId()),s}function gN(t,r,i,s){i.optimizationMode&&(s&&s.width&&s.height?(i.encoderConfig=hn(hn({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?R.debug("[".concat(t,"] set content hint to"),i.optimizationMode):R.debug("[".concat(t,"] set content hint failed")))):R.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var ZB,e6,t6,n6,es,r6,i6,a6,s6,o6,c6,l6,Br;class d6 extends d3{getUserId(){return this._userId}constructor(r,i,s,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(Kt(5,""))),oe(this,"_userId",void 0),oe(this,"_uintId",void 0),oe(this,"_isDestroyed",!1),oe(this,"store",void 0),oe(this,"processor",void 0),oe(this,"processorContext",void 0),this._userId=i,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Vp=(ZB=Qe({argsMap:(t,r,i)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),e6=Qe({argsMap:t=>[t.getTrackId()]}),t6=Qe({argsMap:(t,r)=>[t.getTrackId(),r.name]}),n6=Qe({argsMap:t=>[t.getTrackId()]}),It((es=class extends d6{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==$r.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,i,s,c){super(t,r,i,s),oe(this,"_videoVisibleTimer",null),oe(this,"_previousVideoVisibleStatus",void 0),oe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),oe(this,"trackMediaType",Lp.VIDEO),oe(this,"_videoWidth",void 0),oe(this,"_videoHeight",void 0),oe(this,"_player",void 0),oe(this,"_prePlayer",void 0),oe(this,"processorDestination",void 0),oe(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new b3(this.getTrackId(),"remote"),this.processorDestination=new E3(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Hl(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),da(this,Ge.GET_STATS)||hn({},c3)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Za.PLAY_START),typeof t=="string"){const s=document.getElementById(t);s?t=s:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=hn(hn({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(i);else{let s=!1,c=!1;t instanceof HTMLVideoElement?(this._player=new mN(i),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,s=this._player.videoState>0,this._player.updateConfig(i)):this._player=new wE(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Za.FIRST_FRAME_DECODED),c&&this.safeEmit(Za.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Za.VIDEO_STATE_CHANGED,d)},s&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(Za.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Za.PLAY_END)}stop(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(t),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){x3(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(Mg)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:d}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const u=w5.checkOneElementVisible(c),f=Object.assign({},u);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;const g=We.reportApiInvoke(null,{tag:rn.TRACER,name:yn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(i){throw new pe($.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new pe($.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(wu.SEI_RECEIVED,t)}}).prototype,"play",[ZB],Object.getOwnPropertyDescriptor(es.prototype,"play"),es.prototype),It(es.prototype,"stop",[e6],Object.getOwnPropertyDescriptor(es.prototype,"stop"),es.prototype),It(es.prototype,"pipe",[t6],Object.getOwnPropertyDescriptor(es.prototype,"pipe"),es.prototype),It(es.prototype,"unpipe",[n6],Object.getOwnPropertyDescriptor(es.prototype,"unpipe"),es.prototype),es),Fp=(r6=Qe({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),i6=Qe({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),a6=Qe({argsMap:(t,r)=>[t.getTrackId(),r]}),s6=Qe({argsMap:t=>[t.getTrackId()]}),o6=Qe({argsMap:t=>[t.getTrackId()]}),c6=Qe({argsMap:(t,r)=>[t.getTrackId(),r.name]}),l6=Qe({argsMap:t=>[t.getTrackId()]}),It((Br=class extends d6{get isPlaying(){return this._useAudioElement?ii.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,i,s){super(t,r,i,s),oe(this,"trackMediaType",Lp.AUDIO),oe(this,"_source",void 0),oe(this,"_useAudioElement",!0),oe(this,"_volume",100),oe(this,"processorContext",void 0),oe(this,"processorDestination",void 0),oe(this,"_played",!1),oe(this,"_bypassWebAudio",!1),W("DISABLE_WEBAUDIO")?(this._source=new pN,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new dN(t,!0),W("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ca.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Za.FIRST_FRAME_DECODED)}),this.processorContext=new w3(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new S3(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ca.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Ca.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Ca.ON_AUDIO_BUFFER),this._source.on(Ca.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){this._volume=t,this._useAudioElement?ii.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}setAmplifiedVolume(t){this._useAudioElement&&this._played&&(ii.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,t=Math.min(t,W("MAX_WEBAUDIO_VOLUME")),this._volume=t,this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!t3())throw new pe($.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ii.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?ii.getVolume(this.getTrackId()):this._source instanceof dN?this._source.getAudioVolume():0}getStats(){return Hl(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),da(this,Ge.GET_STATS)||hn({},o3)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),ii.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(R.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ii.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ii.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new pe($.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new pe($.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new pe($.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(_i.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK),this.processorDestination.removeAllListeners(_i.ON_NODE)}}).prototype,"setVolume",[r6],Object.getOwnPropertyDescriptor(Br.prototype,"setVolume"),Br.prototype),It(Br.prototype,"setAmplifiedVolume",[i6],Object.getOwnPropertyDescriptor(Br.prototype,"setAmplifiedVolume"),Br.prototype),It(Br.prototype,"setPlaybackDevice",[a6],Object.getOwnPropertyDescriptor(Br.prototype,"setPlaybackDevice"),Br.prototype),It(Br.prototype,"play",[s6],Object.getOwnPropertyDescriptor(Br.prototype,"play"),Br.prototype),It(Br.prototype,"stop",[o6],Object.getOwnPropertyDescriptor(Br.prototype,"stop"),Br.prototype),It(Br.prototype,"pipe",[c6],Object.getOwnPropertyDescriptor(Br.prototype,"pipe"),Br.prototype),It(Br.prototype,"unpipe",[l6],Object.getOwnPropertyDescriptor(Br.prototype,"unpipe"),Br.prototype),Br);const ua=new class extends Sn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),oe(this,"_lastHiddenTime",0),oe(this,"_lastVisibleTime",0),oe(this,"needUploadStats",[]),oe(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class u6 extends Sn{constructor(r,i){super(),oe(this,"trackMediaType",Lp.DATA),oe(this,"_version",1),oe(this,"_type",3),oe(this,"_config",void 0),oe(this,"_originDataChannel",void 0),oe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),oe(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),oe(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return W("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ie((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const s=setTimeout(()=>{var c;i(new pe($.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new pe($.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new pe($.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[EE.OPEN,EE.CLOSE,EE.ERROR].forEach(i=>{const s=()=>{this.emit(i)};this._datachannelEventMap.set(i,s),r.addEventListener(i,s)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[s,c]=i;r.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class dge extends u6{constructor(r){super(r),oe(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(s).getUint8(3);if(c!==this.id)return void(W("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=i.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(EE.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class uge extends u6{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function TE(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>x0.revokeObjectURL(t),0),new Worker(x0.createObjectURL(t))}const h6=71,vN=1,yN=2,_N=1,p6=2;var Kl=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(Kl||{});function EN(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=t.getUint8(0);if(i!==h6)return;const s=t.getUint16(1),c=vN+yN+s,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const u={m:i,tlvLen:s,tlv:[],frame:d};let f=vN+yN;for(;f<c;){const g=t.getUint8(f),v=t.getUint16(f+_N),_=_N+p6;if(g===Kl.AUDIO_LEVEL){let S=t.getUint8(f+_);for(let w=1;w<v;w++)S=S<<8|t.getUint8(f+_+w);u.tlv.push({tag:g,length:v,value:r?127^S>>1:127&S})}else if(g===Kl.METADATA||g===Kl.AUDIO_64_BIT_PTS){const S=new Uint8Array(v);for(let w=0;w<v;w++)S[w]=t.getUint8(f+_+w);u.tlv.push({tag:g,length:v,value:S})}f+=_+v}return u}const CE=new Map,RE=127,Cu=1e-10,bN=139/13,AE=new Map;function SN(t,r,i){const s="".concat(t,"-").concat(r,"-").concat(i);let c=0;return AE.has(s)?c=AE.get(s):(c=Math.log(function(u,f){const g=u-f;f<g&&(f=g);let v=1;for(let _=u,S=1;_>f;_--,S++)v=v*_/S;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(i)+i*t,AE.set(s,c)),c<Cu&&(c=Cu),c}function f6(t,r,i){const s=r.length,c=t.length/s;let d=!1;for(let u=0,f=0;u<s;u++){let g=0;for(let v=f+c;f<v;f++)t[f]>i&&g++;r[u]!==g&&(r[u]=g,d=!0)}return d}window.cache=AE;let hge=0;class m6{constructor(r){oe(this,"id",void 0),oe(this,"immediates",[]),oe(this,"lastNonSilence",-1),oe(this,"immediateSpeechActivityScore",Cu),oe(this,"lastLevelChangedTime",Date.now()),oe(this,"levels",[]),oe(this,"longs",[]),oe(this,"longSpeechActivityScore",Cu),oe(this,"mediums",[]),oe(this,"mediumSpeechActivityScore",Cu),oe(this,"minLevel",0),oe(this,"nextMinLevel",0),oe(this,"nextMinLevelWindowLength",0),oe(this,"energyScore",0),this.id=r||"".concat(hge++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,s=this.minLevel+bN;let c=!1;for(let d=0;d<r.length;++d){let u=i[d];u<s&&(u=0);const f=Math.floor(u/bN);r[d]!==f&&(r[d]=f,c=!0)}return c}computeLongs(){return f6(this.mediums,this.longs,4)}computeMediums(){return f6(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=SN(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=SN(this.longs[0],10,47),this.longSpeechActivityScore>Cu&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=SN(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(jL(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let s=r;return r<0&&(s=0),r>RE&&(s=RE),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+bN?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>RE&&(i=RE),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class pge{constructor(r){oe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class wN{constructor(r,i,s){oe(this,"isDominant",void 0),oe(this,"energyRanking",void 0),oe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=s}}class fge extends Sn{constructor(r){super(),oe(this,"dominantId",null),oe(this,"lastDecisionTime",0),oe(this,"lastLevelChangedTime",0),oe(this,"lastLevelIdleTime",0),oe(this,"relativeSpeechActivities",[]),oe(this,"speakers",new Map),oe(this,"enableSilence",!1),oe(this,"timeoutToSilenceInterval",0),oe(this,"decisionMaker",null),oe(this,"loudest",[]),oe(this,"numLoudestToTrack",3),oe(this,"energyExpireTimeMs",250),oe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),s!=null&&(this.energyAlphaPct=s),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const s=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const d=c.levelChanged(i,s);return this.updateLoudestList(c,d,s)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new m6(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,s){const c=r.id===this.dominantId;if(i<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new wN(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new wN(c,0,r.energyScore);const d=s-this.energyExpireTimeMs;let u=0;for(;u<this.loudest.length;){const g=this.loudest[u];if(g.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(u,1);else if(g.id!==r.id)++u;else if(this.loudest.splice(u,1),this.loudest.length<this.numLoudestToTrack)break}let f=0;for(;f<this.loudest.length&&!(this.loudest[f].energyScore<r.energyScore);)++f;return f<this.numLoudestToTrack&&(this.loudest.splice(f,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new wN(c,f,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new pge(this),this.decisionMaker.execute())}makeDecision(r){let i=null,s=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var u;const f=oa(u=this.speakers).call(u).next().value;this.enableSilence&&f&&(d=f.id,f.evaluateSpeechActivityScores(r),r-f.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let f=this.dominantId==null?null:this.speakers.get(this.dominantId);if(f==null){const _=this.speakers.entries().next();_.value&&(d=_.value[0],f=_.value[1])}else d=f.id;f!=null&&f.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let v=2;for(const _ of this.speakers.entries()){const[S,w]=_;if(w===f)continue;w.evaluateSpeechActivityScores(r);for(let k=0;k<g.length;++k){const G=f==null?Cu:f.getSpeechActivityScore(k);g[k]=Math.log(w.getSpeechActivityScore(k)/G)}const C=g[0],M=g[1],I=g[2];C>3&&M>2&&I>0&&M>v&&(v=M,d=S)}this.enableSilence&&f!=null&&d===f.id&&r-f.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(i=this.dominantId,this.dominantId=d,s=this.dominantId),s==null&&!this.enableSilence||s===i||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let s=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):s=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&s>c&&(s=c),s}timeoutIdleLevels(r){const i=[];for(const c of oa(s=this.speakers).call(s)){var s;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<d&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Bp=new Map;let vo=null,NE=null;const g6=3;let Ru=[];const yo=new Map,OE=new Map;class mge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){oe(this,"id",void 0),oe(this,"track",void 0),oe(this,"score",0),oe(this,"active",!0),oe(this,"muted",!1),oe(this,"timer",0),oe(this,"actives",0),oe(this,"inactives",0),this.id=r,this.track=i,this.setActive(yo.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:s}=function(){const c=[],d=[];return Array.from(oa(yo).call(yo)).forEach(u=>{u.active?c.push(u):d.push(u)}),{actives:c,inactives:d}}();if(i.length>3){let c;i.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(i.length<3&&s.length>0){let c;s.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let s;return Array.from(oa(yo).call(yo)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!s||c.score<s.score)&&(s=c)}),s}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let s;return Array.from(oa(yo).call(yo)).forEach(c=>{c.active||c.id===i||c.samples<40||(!s||c.score>s.score)&&(s=c)}),s}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let IE;function v6(t){const r=yo.get(t);r&&(yo.delete(t),r.clearTimer())}const PE=new Map,gge=new Map,xN="video/h264",TN="video/h265";function y6(t,r,i){let s=new Uint8Array(t,r,i),c=[],d=0;for(;c.length<i;)d+3<i&&s[d]===0&&s[d+1]===0&&s[d+2]===3&&(s[d+3]===0||s[d+3]===1||s[d+3]===2||s[d+3]===3)?(c.push(s[d],s[d+1],s[d+3]),d+=4):(c.push(s[d]),d++);return new Uint8Array(c)}function _6(t){const r=t.length;let i=[],s=0;for(;s<r;)s+2<r&&t[s]===0&&t[s+1]===0&&(t[s+2]===0||t[s+2]===1||t[s+2]===2||t[s+2]===3)?(i.push(t[s],t[s+1],3,t[s+2]),s+=3):(i.push(t[s]),s++);return new Uint8Array(i)}function E6(t){if(t.length<5)return"";let r=-1;for(let c=0;c<t.length-3;c++){if(t[c]===0&&t[c+1]===0&&t[c+2]===1){r=c;break}if(c<t.length-4&&t[c]===0&&t[c+1]===0&&t[c+2]===0&&t[c+3]===1){r=c;break}}if(r===-1)return"";const i=r+(t[r+2]===0?4:3);if(i>=t.length)return"";const s=t[i];return 128&s?"":(s>>1&63)>=32||i+1<t.length&&!(248&t[i+1])?TN:(31&s)<=31?xN:""}const DE=new Map,$g=new Map;(function(){const t=jt();ur.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ur.getStreamFromExtension=t.name===Ft.CHROME&&Number(t.version)>34,ur.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),ur.supportMinBitrate=t.name===Ft.CHROME||t.name===Ft.EDGE,ur.supportSetRtpSenderParameters=function(){const r=jt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ic()||!(!Er()&&!sE())||r.name===Ft.FIREFOX&&Number(r.version)>=64)}(),t.name===Ft.SAFARI&&(Number(t.version)>=14?ur.supportDualStream=!0:ur.supportDualStream=!1),ur.webAudioMediaStreamDest=function(){const r=jt();return!(r.name===Ft.SAFARI&&Number(r.version)<12)}(),ur.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ur.supportWebGL=typeof WebGLRenderingContext<"u",ur.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ic()||(ur.webAudioWithAEC=!0),ur.supportShareAudio=function(){const r=jt();return(r.os===lr.WIN_10||r.os===lr.WIN_81||r.os===lr.WIN_7||r.os===lr.LINUX||r.os===lr.MAC_OS||r.os===lr.CHROMIUM_OS)&&r.name===Ft.CHROME&&Number(r.version)>=74}(),ur.supportDataChannel=!!(mo(76)||NA(68)||u5(14)),ur.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!fn()&&!!r&&r.prototype.setConfiguration instanceof Function}(),ur.supportWebRTCEncodedTransform=mo(87)||c5()||NA(117),ur.supportWebRTCInsertableStream=function(){const r=jt();return(r.name===Ft.CHROME||r.name===Ft.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ur.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ur.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,ur.supportSuppressLocalAudioPlayback=i3(),ur.supportRestrictOwnAudio=a3(),cE(()=>{ur.supportDualStreamEncoding=function(){const r=jt();return!!W("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&W("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",t),R.info("browser compatibility: ",ur)})})();const vge=["CHINA","GLOBAL"],b6=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Au=[],Wp=[];function Nu(t,r){return!!r&&Au.some(i=>i.uid===t&&i.channelName===r)}function CN(){return Wp.length>0}var yge=A4.forEach,S6=j_("forEach")?[].forEach:function(t){return yge(this,t,arguments.length>1?arguments[1]:void 0)};zt({target:"Array",proto:!0,forced:[].forEach!==S6},{forEach:S6});var _ge=Ya("Array","forEach"),Ege=Ll,bge=Xr,Sge=A,wge=_ge,RN=Array.prototype,xge={DOMTokenList:!0,NodeList:!0},Tge=function(t){var r=t.forEach;return t===RN||Sge(RN,t)&&r===RN.forEach||bge(xge,Ege(t))?wge:r},Cge=l(Tge),Rge=Qo,w6=W_;zt({target:"Object",stat:!0,forced:p(function(){w6(1)})},{keys:function(t){return w6(Rge(t))}});var Age=l(Qt.Object.keys),Nge=l(DL),Oge=l(LL),Ige=zt,x6=ng,Pge=n0,Dge=rt,T6=FT,kge=kl,Lge=wn,jge=aR,Mge=Yn,Uge=Ml,Vge=y4("slice"),Fge=Mge("species"),AN=Array,Bge=Math.max;Ige({target:"Array",proto:!0,forced:!Vge},{slice:function(t,r){var i,s,c,d=Lge(this),u=kge(d),f=T6(t,u),g=T6(r===void 0?u:r,u);if(x6(d)&&(i=d.constructor,(Pge(i)&&(i===AN||x6(i.prototype))||Dge(i)&&(i=i[Fge])===null)&&(i=void 0),i===AN||i===void 0))return Uge(d,f,g);for(s=new(i===void 0?AN:i)(Bge(g-f,0)),c=0;f<g;f++,c++)f in d&&jge(s,c,d[f]);return s.length=c,s}});var Wge=Ya("Array","slice"),Gge=A,$ge=Wge,NN=Array.prototype,Hge=function(t){var r=t.slice;return t===NN||Gge(NN,t)&&r===NN.slice?$ge:r},zge=l(Hge);function De(t,r,i,s,c){var d,u,f,g={};return Cge(d=Age(s)).call(d,function(v){g[v]=s[v]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Nge(u=Oge(f=zge(i).call(i)).call(f)).call(u,function(v,_){return _(t,r,v)||v},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(f4(t,r,g),null):g}let kE=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),ON=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),ts=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t[t.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",t}({}),Ei=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),qe=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Rt=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),$e=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.DATACHANNEL_PRECONNECT="datachannel_preconnect",t.DATACHANNEL_CONNECTING="datachannel_connecting",t.DATACHANNEL_FAILBACK="datachannel_failback",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t.VOS_FALLBACK="vos_fallback",t.VOS_FALLBACK_PROMISE="vos_fallback_promise",t}({}),ze=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SET_DUAL_STREAM_MODE="set_dual_stream_mode",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.CONFIGURE="configure",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),Ou=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),ot=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t.ENABLE_MULTI_STREAM="enable_multi_stream",t}({}),bi=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),pt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t.ON_FALLBACK="websocket:on_fallback",t}({});function LE(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw R.error("Invalid Channel Name ".concat(t)),new se($.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function jE(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||E5(t,1,255)))throw new se($.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Kc=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Kge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},IN={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function PN(t,r){Or(t.url,"".concat(r,".url"),1,1e3,!1),An(t.x)||nn(t.x,"".concat(r,".x"),0,1e4),An(t.y)||nn(t.y,"".concat(r,".y"),0,1e4),An(t.width)||nn(t.width,"".concat(r,".width"),0,1e4),An(t.height)||nn(t.height,"".concat(r,".height"),0,1e4),An(t.zOrder)||nn(t.zOrder,"".concat(r,".zOrder"),0,255),An(t.alpha)||nn(t.alpha,"".concat(r,".alpha"),0,1,!1)}const Yge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Yl=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),DN=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),nr=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function C6(t){if(!t.channelName)throw new se($.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new se($.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Or(t.token,"info.token",1,2047),jE(t.uid),LE(t.channelName),!0}let Pi=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Yc=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Hi=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Gp=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),qt=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),Mn=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t.VOS_FALLBACK="vos-fallback",t.VOS_FALLBACK_PROMISE="vos-fallback-promise",t.RESET_SIGNAL="reset-signal",t.DATACHANNEL_FAILBACK="datachannel-failback",t}({}),ME=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),hr=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Gt=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const R6=[Gt.AFRICA,Gt.ASIA,Gt.CHINA,Gt.EUROPE,Gt.GLOBAL,Gt.INDIA,Gt.JAPAN,Gt.NORTH_AMERICA,Gt.OCEANIA,Gt.OVERSEA,Gt.SOUTH_AMERICA];let Hr=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const UE={CHINA:{},ASIA:{CODE:Hr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Hr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Hr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Hr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Hr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Hr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Hr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Hr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Hr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Hr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Hr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Hr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Hr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};qA&&(UE.CHINA={CODE:Hr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let _o=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",t.FALLBACK_TO_HLS="fallback_to_hls",t.UPDATE_VOS_CONFIGURE="update_vos_configure",t}({});function A6(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class N6 extends Sn{constructor(r,i){super(),j(this,"onICEConnectionStateChange",void 0),j(this,"onConnectionStateChange",void 0),j(this,"onDTLSTransportStateChange",void 0),j(this,"onDTLSTransportError",void 0),j(this,"onICETransportStateChange",void 0),j(this,"onFirstAudioReceived",void 0),j(this,"onFirstVideoReceived",void 0),j(this,"onFirstAudioDecoded",void 0),j(this,"onFirstVideoDecoded",void 0),j(this,"onFirstVideoRender",void 0),j(this,"onFirstVideoBufferReady",void 0),j(this,"onFirstVideoDecodedTimeout",void 0),j(this,"onSelectedLocalCandidateChanged",void 0),j(this,"onSelectedRemoteCandidateChanged",void 0),j(this,"onICECandidateError",void 0),j(this,"getLocalVideoStats",void 0)}}class VE extends N6{constructor(r,i){super(r,i),j(this,"establishPromise",void 0)}}let Fe=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Sr=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),qc=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const O6=["disconnected","failed"];let Te=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),$t=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Ke=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t.FirstVideoPreRender="FirstVideoPreRender",t.FirstVideoBufferReady="FirstVideoBufferReady",t}({}),Ds=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),ks=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),wr=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),ql=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),rr=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),cc=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),ns=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Eo=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),$p=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Un=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Hp=function(t){return t.ABORT="abort",t}({}),Xl=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),qge=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Xge={[kE.ACCESS_POINT]:{[Ei.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ei.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ei.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ei.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ei.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ei.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ei.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[kE.UNILBS]:{[ts.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ts.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ts.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ts.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ts.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ts.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ts.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ts.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ts.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ts.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ts.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ts.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[ts.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[kE.STRING_UID_ALLOCATOR]:{[ON.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[ON.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[ON.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function zp(t){const r=Xge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[t%1e4];if(!i){if(Math.floor(t/1e4)===kE.ACCESS_POINT){const s=t%1e4;if(s.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Jge={[qe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[qe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[qe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[qe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[qe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[qe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[qe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[qe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[qe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[qe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[qe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[qe.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[qe.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[qe.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[qe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[qe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[qe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[qe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[qe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[qe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[qe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[qe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[qe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[qe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[qe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[qe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[qe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[qe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[qe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[qe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[qe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[qe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[qe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[qe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[qe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[qe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[qe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[qe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[qe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[qe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[qe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[qe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[qe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[qe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[qe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[qe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[qe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[qe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[qe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[qe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[qe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[qe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[qe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[qe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[qe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[qe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[qe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[qe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[qe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[qe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[qe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[qe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[qe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[qe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[qe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Iu(t){return Jge[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function I6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function kN(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?I6(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):I6(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function LN(t,r){if(typeof t=="string")return t;const{proxy:i,host:s,port:c}=t;if(r){const d=W("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const Qge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Zge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,eve=/wss:\/\/(.+):([0-9]+)\/?/,tve=/wss:\/\/(.[^\/]+)\/?/;let nve=0;class rve{constructor(r,i){j(this,"id",0),j(this,"store",void 0),j(this,"recordIndex",void 0),j(this,"websockets",[]),j(this,"try443PortDuration",2e3),j(this,"forceCloseWSDuration",5e3),j(this,"try443PortTimeout",null),j(this,"forceCloseTimeout",null),j(this,"isTry443PortFailed",!1),j(this,"isNormalPortFailed",!1),j(this,"useDoubleDomain",!1),j(this,"useProxy",!1),j(this,"startTime",Date.now()),this.id=++nve,this.try443PortDuration=W("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];R.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,s){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:s});const c=W("GATEWAY_DOMAINS"),d=Date.now(),u=[],f=c.find(w=>{var C;return xe(C=r.host).call(C,w)});f||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach(w=>{g.push(LN(kN(kN({},r),{},{host:r.host.replace(f,w)}),i))});else{const w=kN({},r);if(i&&f){const C=c.find(M=>M!==f);C&&(w.host=w.host.replace(f,C))}g.push(LN(w,i))}try{g.forEach(w=>{const C=new WebSocket(w);C.binaryType="arraybuffer",u.push(C),this.logger("ws is connecting:",C.url)})}catch(w){if(this.logger("ws create failed"),u.forEach(C=>C.close()),u.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,s);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,s);throw new se($.WS_ERR,"init websocket failed! Error: ".concat(w.toString()))}const v=Pg();this.store&&this.store.recordJoinChannelService({urls:u.map(w=>w.url),service:"gateway"},this.recordIndex),u.forEach(w=>{w.onopen=()=>{this.logger("onopen: ws ".concat(w.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(C=>{C!==w&&(C.onopen=null,C.onclose=null,C.onmessage=null,C.close(),this.logger("close backup websocket: ".concat(C.url)))}),this.websockets.length=0,v.resolve(w)},w.onclose=C=>{this.logger("onclose: ws ".concat(w.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(w.readyState));const M=u.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(M)),M&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(C.reason)),v.reject({code:C.code,reason:ME.A_ROUND_WS_FAILED})):!i&&M&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),S()),i?this.isTry443PortFailed=M:this.isNormalPortFailed=M},w.onmessage=C=>this.logger("".concat(w.url," onmessage: ").concat(C.data))}),this.websockets.push(...u);const _=()=>{this.websockets.forEach(w=>w.readyState!==WebSocket.OPEN&&w.close())},S=()=>{if(v.isResolved)return _();jt().os===lr.MAC_OS&&fn()&&_(),this.createWebSocket(r,!0,!0).then(w=>{v.resolve(w)}).catch(w=>{this.isNormalPortFailed&&v.reject(w),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return s||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,S()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,i,s,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(d){let u,f,g;return[,u,f,g]=d.match(Qge)||[],u||([,f,g]=d.match(Zge)||[]),f&&g||([,f,g]=d.match(eve)||[]),f&&g||([,f]=d.match(tve)||[]),f||R.warning("un-destructible url: ",d),{proxy:u,host:f,port:g||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,s&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(r,!!s,!1).finally(()=>this.clearTimeout())}}function P6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class D6 extends Sn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;xe(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(pt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pt.CONNECTED):this._state==="closed"?this.emit(pt.CLOSED):this._state==="failed"&&this.emit(pt.FAILED))}resetReconnectCount(r){R.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],u=arguments.length>5?arguments[5]:void 0;super(),j(this,"_websocketUrl",null),j(this,"connectionID",0),j(this,"currentURLIndex",0),j(this,"urls",[]),j(this,"_reconnectMode","tryNext"),j(this,"reconnectReason",void 0),j(this,"_initMutex",void 0),j(this,"name",void 0),j(this,"_state","closed"),j(this,"reconnectInterrupter",void 0),j(this,"websocket",void 0),j(this,"retryConfig",void 0),j(this,"reconnectCount",0),j(this,"forceCloseTimeout",5e3),j(this,"onlineReconnectListener",void 0),j(this,"useCompress",void 0),j(this,"tryDoubleDomain",!1),j(this,"use443PortOnly",!1),j(this,"wsInflateLength",0),j(this,"wsDeflateLength",0),j(this,"closeEstablishingWs",()=>{}),j(this,"store",void 0),j(this,"joinGatewayRecordIndex",void 0),this.store=u,this.name=r,this.retryConfig=function(S){for(var w=1;w<arguments.length;w++){var C=arguments[w]!=null?arguments[w]:{};w%2?P6(Object(C),!0).forEach(function(M){j(S,M,C[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(C)):P6(Object(C)).forEach(function(M){Object.defineProperty(S,M,Object.getOwnPropertyDescriptor(C,M))})}return S}({},i),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new br("websocket",u?u.clientId:void 0);const{timeout:f,timeoutFactor:g}=i,v=Math.max(300,Math.floor(3*f/5)),_=Math.max(1.2,Math.floor(8*g)/10);vi.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=_),Nn.on(mu.NETWORK_STATE_CHANGE,(S,w)=>{S!==w&&(this.resetReconnectCount("network state change: ".concat(w," -> ").concat(S)),S===vi.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{var c;const d=Pg(),u=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(f){return!(vE()||W("USE_NEW_TOKEN")||!W("ENABLE_PREALLOC_PC")&&(f==null||!f.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(rr.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(d.resolve).catch(d.reject),this.once(pt.CLOSED,()=>{d.reject(new pe($.WS_DISCONNECT))}),this.once(pt.CONNECTED,d.resolve),await d.promise}catch{}finally{s()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;i?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new pe($.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(s){throw new pe($.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const s=Pg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=_=>{var S;(S=this.store)===null||S===void 0||S.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},d=async _=>{var S;if(R.debug("[".concat(this.name,"] websocket close ").concat((S=this.websocket)===null||S===void 0?void 0:S.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new pe($.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const w=da(this,pt.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,C=await this.reconnectWithAction(w);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!C)return s.reject(new pe($.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);s.resolve()}},u=_=>{this.emit(pt.ON_MESSAGE,_)},f=_=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),W("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=W("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),r);const g=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=LN(r);const _=await this.chooseBestWebsocketConnection(r);this.websocket=_,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=u,this.websocket.onerror=f,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(_){const S=this.state==="closed",w=_ instanceof pe,C=w&&_.code===$.WS_ABORT,M=w&&_.code===$.WS_ERR,I=w?_.message:_&&(_.reason||_.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:C?"aborted":"error",errors:[_]},g),S||M?(s.reject(S?new pe($.WS_DISCONNECT,"websocket is closed: ".concat(I)):new pe($.WS_ERR,"init websocket failed: ".concat(I))),M&&R.error("[".concat(this.name,"] init websocket failed: ").concat(I))):d&&d(_)}return s.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Nn.isOnline||!Nn.onlineWaiter||(this.onlineReconnectListener=Nn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,i){const u=lE(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(u,"ms to reconnect websocket, mode: ").concat(r)),await Ie.race([dr(u),this.onlineReconnectListener||new Ie(()=>{})])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;const c=async(u,f)=>{this.emit(pt.RECONNECT_CREATE_CONNECTION,f),await this.createWebSocketConnection(u)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await qn(this,pt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(u){var d;R.error("[".concat(this.name,"] reconnect failed ").concat(u&&u.toString()));const f=u==null||(d=u.data)===null||d===void 0?void 0:d.desc;if(Array.isArray(f)){if(xe(f).call(f,"dynamic key expired"))return this.emit(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(xe(f).call(f,"request downgrade fallback"))return this.emit(pt.ON_FALLBACK),!1}return this.reconnectWithAction(r,i)}return!0}}class jN extends D6{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const s=Pg(),c=function(u,f){return new rve(u,f)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),s.reject(new pe($.WS_ABORT,"choose best websocket aborted"))};const d=W("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Hg extends D6{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new Ie((s,c)=>{let d=!1;const u=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),u.forEach(M=>{M.onclose=null,M.onopen=null,M.onmessage=null,M.close()}),c(new pe($.WS_ABORT,"choose best websocket aborted"))};const f=W("GATEWAY_DOMAINS");let g;const v=r.indexOf("?h="),_=f.find(M=>v!==-1?xe(r).call(r,M,v):xe(r).call(r,M));R.debug("[choose-best-ws] currentDomain: ",_,", domains: ",f);let S=!this.tryDoubleDomain||!_;if(!S&&_){var w;const M=Date.now();try{f.forEach(I=>{const k=v===-1?r.replace(_,I):r.substr(0,v)+r.substr(v).replace(_,I),G=new WebSocket(k);G.binaryType="arraybuffer",u.push(G),R.debug("[choose-best-ws] ws is connecting:",G.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),u.forEach(k=>k.close());u.length;)u.pop();S=!0}(w=this.store)===null||w===void 0||w.recordJoinChannelService({urls:u.map(I=>I.url),service:"gateway"},i),u.forEach(I=>{I.onopen=()=>{if(d)return;const k=Date.now()-M;R.debug("[choose-best-ws] ws open cost ".concat(k,"ms")),u.filter(G=>G!==I).forEach(G=>{R.debug("[choose-best-ws]close backup websocket: ".concat(G.url)),G.close()}),d=!0,s(I)},I.onclose=k=>{g=k,!d&&(u.find(G=>!(G.readyState===WebSocket.CLOSED||G.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),d=!0,c(g)))},I.onmessage=k=>{R.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(k.data))}}),dr(this.forceCloseTimeout).then(()=>{u.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(S){var C;let M;R.debug("[choose-best-ws] use single url: ",r),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[r],service:"gateway"},i);try{M=new WebSocket(r),u.push(M),M.binaryType="arraybuffer"}catch(I){const k=new pe($.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return R.error("[".concat(this.name,"]").concat(k)),void c(k)}M.onopen=()=>{s(M)},M.onclose=I=>{c(I)},M.onmessage=I=>{R.debug("[choose-best-ws]".concat(M.url," onmessage: ").concat(I.data))},dr(this.forceCloseTimeout).then(()=>{M&&M.readyState!==WebSocket.OPEN&&M.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class k6 extends Sn{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Rt.CONNECTED?this.emit($e.WS_CONNECTED):r===Rt.RECONNECTING?this.emit($e.WS_RECONNECTING,this._websocketReconnectReason):r===Rt.CLOSED&&this.emit($e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),j(this,"__name__","AgoraRTCSignal"),j(this,"_disconnectedReason",void 0),j(this,"_websocketReconnectReason",void 0),j(this,"_connectionState",Rt.CLOSED),j(this,"reconnectToken",void 0),j(this,"websocket",void 0),j(this,"openConnectionTime",void 0),j(this,"clientId",void 0),j(this,"lastMsgTime",Date.now()),j(this,"uploadCache",[]),j(this,"uploadCacheInterval",void 0),j(this,"rttRolling",new WA(5)),j(this,"pingpongTimer",void 0),j(this,"wsInflateDataTimer",void 0),j(this,"pingpongTimeoutCount",0),j(this,"ortc",void 0),j(this,"joinResponse",void 0),j(this,"multiIpOption",void 0),j(this,"initError",void 0),j(this,"spec",void 0),j(this,"store",void 0),j(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit($e.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===ot.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ot.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}if(c._type===ot.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case qe.ERR_LICENSE_MISSING:this.close(Ct.LICENSE_MISSING);break;case qe.ERR_LICENSE_EXPIRED:this.close(Ct.LICENSE_EXPIRED);break;case qe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ct.LICENSE_MINUTES_EXCEEDED);break;case qe.ERR_LICENSE_PERIOD_INVALID:this.close(Ct.LICENSE_PERIOD_INVALID);break;case qe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case qe.ERR_LICENSE_ILLEGAL:this.close(Ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new jN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Rt.CONNECTED&&this.reconnect("retry",Ur.OFFLINE)})}async request(r,i,s,c){const d=Kt(6,""),u={_id:d,_type:r,_message:i},f=this.websocket.connectionID,g=()=>new Ie((M,I)=>{if(this.connectionState===Rt.CONNECTED)return M();const k=()=>{this.off($e.WS_CLOSED,G),M()},G=()=>{this.off($e.WS_CONNECTED,k),I(new se($.WS_ABORT))};this.once($e.WS_CONNECTED,k),this.once($e.WS_CLOSED,G),r!==ze.PUBLISH&&r!==ze.PUBLISH_DATASTREAM&&r!==ze.SUBSCRIBE&&r!==ze.SUBSCRIBE_DATASTREAM&&r!==ze.UNSUBSCRIBE&&r!==ze.UNSUBSCRIBE_DATASTREAM&&r!==ze.UNPUBLISH&&r!==ze.UNPUBLISH_DATASTREAM&&r!==ze.CONTROL&&r!==ze.RESTART_ICE||this.once($e.DISCONNECT_P2P,()=>{I(new se($.DISCONNECT_P2P))}),r!==ze.PUBLISH&&r!==ze.RESTART_ICE||this.once($e.ABORT_P2P_EXECUTION,()=>{I(new se($.DISCONNECT_P2P))})});if(this.connectionState!==Rt.CONNECTING&&this.connectionState!==Rt.RECONNECTING||r===ze.JOIN||r===ze.REJOIN||await g(),this.websocket.sendMessage(u,!0),c)return;const v=new Ie((M,I)=>{let k=!1;const G=(X,te)=>{k=!0,M({isSuccess:X==="success",message:te||{}}),this.off($e.WS_CLOSED,K),this.off($e.WS_RECONNECTING,K),this.emit($e.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(d),G);const K=()=>{I(new se($.WS_ABORT,"type: ".concat(r))),this.off($e.WS_CLOSED,K),this.off($e.WS_RECONNECTING,K),this.off("res-@".concat(d),G)};this.once($e.WS_CLOSED,K),this.once($e.WS_RECONNECTING,K),dr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||k||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit($e.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(M){if(this.connectionState===Rt.CLOSED||r===ze.LEAVE)throw new se($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?M.throw():r===ze.JOIN||r===ze.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const S=Number(_.message.error_code||_.message.code),w=Iu(S),C=new se($.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(_.message.error_str),{code:S,data:_.message,desc:w.desc});return w.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(S,", message: ").concat(w.desc,", action: ").concat(w.action)),S===qe.ERR_TOO_MANY_BROADCASTERS?((r===ze.JOIN||r===ze.REJOIN)&&(this.initError=C,this.close()),C.throw()):w.action==="failed"?C.throw():w.action==="quit"?(this.initError=C,this.close(),C.throw()):(S===qe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ur.MULTI_IP)):this.reconnect(w.action,Ur.SERVER_ERROR),r===ze.JOIN||r===ze.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new Ie(s=>{const c=d=>{(!i||i(d))&&(this.off(r,c),s(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Ou.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const d=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Rt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const s={_type:r,_message:i};this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ie((i,s)=>{this.once($e.WS_CONNECTED,()=>i(this.joinResponse)),this.once($e.WS_CLOSED,c=>s(this.initError||new se($.WS_ABORT,c))),this.connectionState=Rt.CONNECTING,this.websocket.init(r).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Ct.LEAVE,this.connectionState=Rt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit($e.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await qn(this,$e.REQUEST_JOIN_INFO);this.store.joinReq();const i=await this.request(ze.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!i)return this.emit($e.REPORT_JOIN_GATEWAY,ME.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit($e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Rt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new se($.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=gu(this,$e.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(ze.REJOIN,r);return!!i&&(this.connectionState=Rt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(s=>{this.emit(ot.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(ot.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(ot.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(ot.MUTE_AUDIO,{uid:s.uid}):this.emit(ot.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(ot.MUTE_VIDEO,{uid:s.uid}):this.emit(ot.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(ot.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(ot.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(ot.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(ot.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(ot.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(ze.DOWNGRADE_CODEC,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Iu(r.code);if(r.code===28&&"detail"in r&&(R.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit($e.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?r.code===qe.ERR_REPEAT_JOIN_CHANNEL&&W("IGNORE_UID_CHECK")?void this.close(Ct.UID_CONFLICT):(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):r.code===qe.K_VOS_FALLBACK&&"detail"in r?(R.info("[".concat(this.clientId,"] receive vos fallback notification: "),r.detail),r.detail==="FALLBACKCN"&&W("ENABLE_QUALITY_FALLBACK")?void qn(this,$e.VOS_FALLBACK_PROMISE,r.detail).then(()=>{this.reconnect("recover",i.desc)}).catch(s=>{R.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),s)}):r.detail==="fallback_hls"&&W("ENABLE_FALLBACK_TO_HLS")?(this.emit($e.VOS_FALLBACK,r.detail),void this.close(Ct.FALLBACK_TO_HLS)):this.reconnect(i.action,i.desc)):void this.reconnect(i.action,Ur.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=W("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ur.TIMEOUT):this.request(ze.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),W("REPORT_STATS")&&this.send(ze.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(Ou.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(pt.RECONNECT_CREATE_CONNECTION,r=>{this.emit($e.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(pt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pt.CLOSED,()=>{this.connectionState=Rt.CLOSED}),this.websocket.on(pt.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=Rt.CLOSED}),this.websocket.on(pt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Rt.CONNECTED?this.connectionState=Rt.RECONNECTING:this.connectionState=Rt.CONNECTING}),this.websocket.on(pt.WILL_RECONNECT,(r,i,s)=>{const c=gu(this,$e.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=ME.P2P_DISCONNECTED),d&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit($e.REPORT_JOIN_GATEWAY,i||ME.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit($e.DISCONNECT_P2P)),s(r)}),this.websocket.on(pt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Ur.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit($e.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof se){if(r.code===$.UNEXPECTED_RESPONSE&&r.data.code===qe.ERR_NO_AUTHORIZED)return this.initError=new se($.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ct.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ur.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(pt.REQUEST_NEW_URLS,(r,i)=>{qn(this,$e.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(rr.PRE_CONNECT_PC,()=>{this.emit($e.PRE_CONNECT_PC)}),this.websocket.on(pt.ON_FALLBACK,()=>{W("ENABLE_FALLBACK_TO_HLS")&&this.emit($e.VOS_FALLBACK,"fallback_hls")})}}let ive=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Wn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function L6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function FE(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?L6(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):L6(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let MN=0;function Ls(t){const r=W("TURN_DOMAINS");MN=(MN+1)%r.length;const i=r[MN]||"edge.agora.io";return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(i):(R.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function BE(t){try{const r=W("TURN_DOMAINS"),i=W("GATEWAY_DOMAINS").concat(r).find(s=>xe(t).call(t,s));return i?t.split(".".concat(i))[0].replace(/-/g,"."):t}catch{return R.debug("serverUrlToIp error, fallback to url",t),t}}function UN(t,r){t.addresses||(t.addresses=[]);const i=function(f,g){if(W("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return f.map(S=>{let{ip:w,port:C}=S;return{address:"".concat(w,":").concat(C)}});const v=W("GATEWAY_DOMAINS");let _=v[1]&&xe(g).call(g,v[1])?1:0;return f.map(S=>{let{domain_prefix:w,port:C,ip:M}=S;if(w)return{address:"".concat(w,".").concat(v[_++%v.length],":").concat(C)};const I=/^[\.\:\d]+$/.test(M),k=I?"".concat(M.replace(/[^\d]/g,"-"),".").concat(v[_++%v.length],":").concat(C):"".concat(M,":").concat(C);return I||R.debug("Cannot recognized as ip address: ".concat(M,", use as host3")),{ip:M,port:C,address:k}})}(t.addresses,r),s=Array.isArray(t.detail)&&t.detail[18];if(s&&typeof s=="string"){const f=s.split(";");for(let g=0;g<f.length;g++){var c;const v=mi(c=f[g]).call(c);i[g]&&v&&(i[g].ip6=v)}}const d=t.detail&&t.detail.candidate;let u;if(d){const[f,g]=d.split(":");f&&g&&(u={port:Number(g),ip:f,address:"".concat(f,":").concat(g)})}return{gatewayAddrs:i,apGatewayAddress:u,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Di(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function j6(t){const r=t._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(Di(r.width),"x").concat(Di(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function WE(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function zg(t,r){let i,s,c;switch(r){case Wn.CHOOSE_SERVER:s=4096,c="choose server";break;case Wn.CLOUD_PROXY:s=1048576,c="proxy";break;case Wn.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case Wn.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new se($.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===s&&(i={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(u=>FE(FE({},u),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:FE(FE({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!i)throw new se($.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return i}async function M6(t,r){return await Ie.all(t.addresses.map(async i=>({address:Ls(i.ip),tcpport:i.port,udpport:i.port,username:r&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Vr.username,password:r&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await LA(r.toString()):Vr.password})))}function VN(t,r){const i=r.getMediaStreamTrack(!0).getSettings(),s=r.videoHeight||i.height,c=r.videoWidth||i.width;return s&&c?Math.max(Math.min(s,c)/Math.min(Di(t.height),Di(t.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Jl(t){let{candidateType:r,relayProtocol:i,type:s,address:c,port:d,protocol:u}=t;const f={candidateType:r,relayProtocol:i,protocol:u};if(s!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),f.address=g.join("."),f.port=d}return f}function lc(t){const r=t.split(":"),i=t.split(/[-.]/),s=xe(t).call(t,"-")?"-":".";let c=t;return r.length>1?i.length>1?(i[1]="**",c=i[0]+s+"**:"+r[r.length-1]):c=r.length>2?r[0]+s+"**:"+r[r.length-1]:"**:"+r[r.length-1]:i.length>1&&(c=i[0]+s+"**"),c}function U6(t,r){return t.getTransceivers().find(i=>i.sender.track===r||i.receiver.track===r)}function Kg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W("SVC_MODE");if(W("ENABLE_SVC"))return function(r){return r in hE}(t)?t:hE.L1T3}const V6={[Fe.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Fe.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function F6(t){t.send&&(Kp(Fe.VIDEO,t.send.videoExtensions),Kp(Fe.AUDIO,t.send.audioExtensions)),t.recv&&(Kp(Fe.VIDEO,t.recv.videoExtensions),Kp(Fe.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(Kp(Fe.VIDEO,t.sendrecv.videoExtensions),Kp(Fe.AUDIO,t.sendrecv.audioExtensions))}function B6(t,r){t.send&&(GE(Fe.VIDEO,t.send.videoExtensions,r.send.videoExtensions),GE(Fe.AUDIO,t.send.audioExtensions,r.send.audioExtensions)),t.recv&&(GE(Fe.VIDEO,t.recv.videoExtensions,r.recv.videoExtensions),GE(Fe.AUDIO,t.recv.audioExtensions,r.recv.audioExtensions))}function GE(t,r,i){r.forEach(s=>{var c;const d=V6[t].find(f=>{var g;let{key:v}=f;return xe(g=s.extensionName).call(g,v)});if(!d)return;const u=i.find(f=>{let{extensionName:g}=f;return xe(g).call(g,d.key)});u&&xe(c=u.extensionName).call(c,"gdpr_forbidden")&&(s.extensionName=u.extensionName)})}function Kp(t,r){r.forEach(i=>{var s;const c=V6[t].find(d=>{var u;let{key:f}=d;return xe(u=i.extensionName).call(u,f)});xe(s=i.extensionName).call(s,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function W6(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||xe(t).call(t,"abs-send-time")}function $E(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||xe(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function G6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function $6(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?G6(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):G6(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function Yg(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:u,filterAudioCodec:f,filterVideoCodec:g,unsupportedVideoUplinkCodec:v,unsupportedVideoDownlinkCodec:_}=r,{useXR:S}=i;let w=[],C=[],M=[],I=[],k=!1,G=!1;if(yi(t).mediaDescriptions.forEach(X=>{s&&s!==X.attributes.direction||(X.media.mediaType!=="video"||k||(C=X.attributes.payloads,I=X.attributes.extmaps,k=!0),X.media.mediaType!=="audio"||G||(w=X.attributes.payloads,M=X.attributes.extmaps,G=!0))}),!I||C.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!M||w.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(C.forEach(X=>{var te;(te=X.rtpMap)!==null&&te!==void 0&&te.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),S&&X.rtcpFeedbacks.push({type:"rrtr"})}),w.forEach(X=>{var te;(te=X.rtpMap)!==null&&te!==void 0&&te.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),S&&X.rtcpFeedbacks.push({type:"rrtr"})}),c&&(w=w.filter(X=>{var te;return((te=X.rtpMap)===null||te===void 0?void 0:te.encodingName.toLowerCase())!=="rtx"}),C=C.filter(X=>{var te;return((te=X.rtpMap)===null||te===void 0?void 0:te.encodingName.toLowerCase())!=="rtx"})),d){const X=C.filter(Z=>{var ie;return/(red)|(ulpfec)|(flexfec)/i.test(((ie=Z.rtpMap)===null||ie===void 0?void 0:ie.encodingName)||"")}),te=Ql(X,C).map(Z=>Z.payloadType),ne=[...X.map(Z=>Z.payloadType),...te];C=C.filter(Z=>!xe(ne).call(ne,Z.payloadType))}if(u&&(w=w.filter(X=>{var te;return!/(red)|(ulpfec)|(flexfec)/i.test(((te=X.rtpMap)===null||te===void 0?void 0:te.encodingName)||"")})),f&&(f==null?void 0:f.length)>0&&(w=w.filter(X=>{var te;return xe(f).call(f,((te=X.rtpMap)===null||te===void 0?void 0:te.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0){const X=C.filter(te=>{var ne;return xe(g).call(g,((ne=te.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLowerCase())||"")});C=X.concat(c?[]:Ql(X,C))}const K=W("UNSUPPORTED_VIDEO_CODEC");if(K&&K.length>0){const X=C.filter(Z=>Z.rtpMap&&xe(K).call(K,Z.rtpMap.encodingName.toLowerCase())),te=Ql(X,C),ne=X.concat(te).map(Z=>Z.payloadType);C=C.filter(Z=>!xe(ne).call(ne,Z.payloadType)),R.debug("unsupportedVideoCodec: ".concat(K,", toBeRemoved: ").concat(ne))}if(v&&v.length>0&&s==="sendonly"){const X=C.filter(Z=>Z.rtpMap&&xe(v).call(v,Z.rtpMap.encodingName.toLowerCase())),te=Ql(X,C),ne=X.concat(te).map(Z=>Z.payloadType);C=C.filter(Z=>!xe(ne).call(ne,Z.payloadType)),R.debug("unsupportedVideoUplinkCodec: ".concat(v,", toBeRemoved: ").concat(ne))}if(_&&_.length>0&&s==="recvonly"){const X=C.filter(Z=>Z.rtpMap&&xe(_).call(_,Z.rtpMap.encodingName.toLowerCase())),te=Ql(X,C),ne=X.concat(te).map(Z=>Z.payloadType);C=C.filter(Z=>!xe(ne).call(ne,Z.payloadType)),R.debug("unsupportedVideoDownlinkCodec: ".concat(_,", toBeRemoved: ").concat(ne))}return{audioCodecs:w,videoCodecs:C,audioExtensions:M,videoExtensions:I}}function dc(t){const r=yi(t);let i,s;for(const c of r.mediaDescriptions){if(!i){const d=c.attributes.iceUfrag,u=c.attributes.icePwd;if(!d||!u)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:d,icePwd:u}}if(!s){const d=c.attributes.fingerprints;d.length>0&&(s={fingerprints:d})}}if(!s&&r.attributes.fingerprints.length>0&&(s={fingerprints:r.attributes.fingerprints}),!s||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:s}}function FN(t,r){const i=[],s=t.attributes.ssrcGroups.filter(u=>u.semantic==="FID"),c=t.attributes.ssrcGroups.find(u=>u.semantic==="SIM"),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(u=>{var f;const g=(f=s.find(v=>v.ssrcIds[0]===u))===null||f===void 0?void 0:f.ssrcIds[1];i.push({ssrcId:u,rtx:r?g:void 0})});else if(s.length>0){const u=s[0].ssrcIds[0],f=s[0].ssrcIds[1];i.push({ssrcId:u,rtx:r?f:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:d[0].ssrcId})}return i}function H6(t,r,i){const{cname:s}=t;let c=[];r&&(c=z6(r)),c.length===0&&(c=t.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),R.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},u={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let f;switch(t.dtlsParameters.role){case"server":f="passive";break;case"client":f="active";break;case"auto":f="actpass"}const g=Xg(t.rtpCapabilities),v=[];return Array.isArray(i)&&i.length>0&&i.forEach(_=>{v.push({kind:Fe.VIDEO,ssrcMsg:[{ssrcId:_.v,rtx:_.v_rtx}],mslabel:"".concat(_.v,"_").concat(_.a)},{kind:Fe.AUDIO,ssrcMsg:[{ssrcId:_.a}],mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:d,iceParameters:u,candidates:c,rtpCapabilities:g,setup:f,cname:s,preSSRCs:v}}function z6(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(lc(t.ip),":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(lc(t.ip6),":").concat(t.port)))),r}function qg(t,r,i){const s=[],c=[];return t.forEach(d=>{let{ssrcId:u,rtx:f}=d;const g=Kt(8,"track-"),v={ssrcId:u,attributes:$6({label:g,mslabel:i=i||Kt(10,""),msid:"".concat(i," ").concat(g)},r&&{cname:r})};if(s.push(v),f!==void 0){const _={ssrcId:f,attributes:$6({label:g,mslabel:i,msid:"".concat(i," ").concat(g)},r&&{cname:r})};s.push(_),c.push({semantic:"FID",ssrcIds:[u,f]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:u}=d;return u})}),{ssrcs:s,ssrcGroups:c}}function Pu(t,r){r instanceof kn&&t.attributes.payloads.forEach(i=>{var s;const c=(s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),c==="opus"&&typeof W("OPUS_PTIME")=="number"?i.fmtp.parameters.ptime=W("OPUS_PTIME"):i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!fn()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1")),r instanceof Gg&&c==="opus"&&r._config.DTX&&(i.fmtp.parameters.usedtx="1"))})}function BN(t){const r=t.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function WN(t,r){var i;if(t.attributes.payloads.forEach(c=>{var d;((d=c.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())==="h264"&&c.fmtp&&c.fmtp.parameters&&W("ENABLE_UP_SPS_PPS")&&(c.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(r instanceof an&&r._encoderConfig&&r._hints.indexOf(Ht.SCREEN_TRACK)===-1))return;const s=r._encoderConfig;wt().supportMinBitrate&&s.bitrateMin&&t.attributes.payloads.forEach(c=>{var d,u;xe(d=["h264","h265","vp8","vp9","av1"]).call(d,((u=c.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),wt().supportMinBitrate&&!xe(i=r._hints).call(i,Ht.LOW_STREAM)&&s.bitrateMax&&t.attributes.payloads.forEach(c=>{var d,u;xe(d=["h264","h265","vp8","vp9","av1"]).call(d,((u=c.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(W("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function K6(t){if(t.media.mediaType!=="video")return;const r=jt();if(r.name!==Ft.SAFARI&&r.os!==lr.IOS)return;const i=t.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));i!==-1&&t.attributes.extmaps.splice(i,1)}function HE(t,r,i){if(!r)return;let s,c;if(t.media.mediaType==="video"?(s=i.videoExtensions,c=i.videoCodecs):(s=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const d=s.find(u=>$E(u.extensionName));if(d){const u=d.extensionName;t.attributes.extmaps.find(g=>$E(g.extensionName))||t.attributes.extmaps.push({entry:d.entry,extensionName:u}),function(g,v){return v.filter(_=>!!g.find(S=>S.payloadType===_.payloadType&&!!S.rtcpFeedbacks.find(w=>w.type==="transport-cc")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(v=>v.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex(u=>$E(u.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(u=>{const f=u.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");f!==-1&&u.rtcpFeedbacks.splice(f,1)})}if(r.remb===!0){const d=s.find(u=>W6(u.extensionName));if(d){const u=d.extensionName;t.attributes.extmaps.find(g=>g.extensionName===u)||t.attributes.extmaps.push({entry:d.entry,extensionName:u}),function(g,v){return v.filter(_=>!!g.find(S=>S.payloadType===_.payloadType&&!!S.rtcpFeedbacks.find(w=>w.type==="goog-remb")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(v=>v.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex(u=>W6(u.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(u=>{const f=u.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");f!==-1&&u.rtcpFeedbacks.splice(f,1)})}}function GN(t,r,i){if(fn()||t.media.mediaType!=="video"||!(r instanceof an)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!W("SIMULCAST")||i==="vp9"&&W("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const s=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(f=>f.semantic==="FID"&&f.ssrcIds[0]===c.ssrcId),u={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let f=1;f<s;f++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+f,attributes:mn(c.attributes)}),u.ssrcIds.push(c.ssrcId+f),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+f,attributes:mn(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+f,d.ssrcIds[1]+f]}));t.attributes.ssrcGroups.unshift(u)}async function Y6(){try{const t=new RTCPeerConnection;t.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:hE.L1T3}]});const r=await t.createOffer();if(!r.sdp)return void t.close();const i=yi(r.sdp).mediaDescriptions[0];if(!i)return;const s=i.attributes.extmaps.find(c=>c.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return t.close(),s}catch{return}}async function $N(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(await i.createOffer()).sdp,{send:c,recv:d,sendrecv:u}=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const _=Yg(v,f,g,"sendonly"),S=Yg(v,f,g,"recvonly"),w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},M={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(js(_,S,"videoExtensions",w,C,M),js(_,S,"videoCodecs",w,C,M),js(_,S,"audioExtensions",w,C,M),js(_,S,"audioCodecs",w,C,M),W("RAISE_H264_BASELINE_PRIORITY")){const I=[],k=[];if(M.videoCodecs.forEach((G,K)=>{var X;if(((X=G.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"){var te,ne;const Z=M.videoCodecs[K+1],ie=Z&&Q6(G,Z),ge=(te=G.fmtp)===null||te===void 0?void 0:te.parameters["profile-level-id"],Ee=(ne=G.fmtp)===null||ne===void 0?void 0:ne.parameters["packetization-mode"];!ge||ge!==W("FIRST_H264_PROFILE_LEVEL_ID")||W("FIRST_PACKETIZATION_MODE")&&Ee!==W("FIRST_PACKETIZATION_MODE")?ie?k.push([G,Z]):k.push([G]):ie?I.push([G,Z]):I.push([G])}}),I.length>0&&k.length>0){R.debug("raising H264 baseline profile priority"),M.videoCodecs.forEach((K,X)=>{var te;if(((te=K.rtpMap)===null||te===void 0?void 0:te.encodingName.toLocaleLowerCase())==="h264"){const ne=Q6(K,M.videoCodecs[X+1]),Z=I.shift()||k.shift()||[];Z.length>0&&(ne?M.videoCodecs.splice(X,2,...Z):M.videoCodecs.splice(X,1,...Z))}});const G=C.videoCodecs.filter(K=>{var X,te;return((X=K.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((te=K.fmtp)===null||te===void 0?void 0:te.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID")});if(G.length>0){const K=Ql(G,C.videoCodecs).map(te=>te.payloadType),X=[...G.map(te=>te.payloadType),...K];C.videoCodecs=C.videoCodecs.filter(te=>!xe(X).call(X,te.payloadType))}W("FILTER_SEND_H264_BASELINE")&&(w.videoCodecs=w.videoCodecs.filter(K=>{var X,te;return!(((X=K.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((te=K.fmtp)===null||te===void 0?void 0:te.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:w,recv:C,sendrecv:M}}return{send:w,recv:C,sendrecv:M}}(t,r,s);try{i.close()}catch{}return{send:c,recv:d,sendrecv:u}}function q6(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=Yg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(js(t,r,"videoExtensions",i,s,c),js(t,r,"videoCodecs",i,s,c),js(t,r,"audioExtensions",i,s,c),js(t,r,"audioCodecs",i,s,c),W("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const u=c.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(u<d){R.debug("raising H264 baseline profile priority");const f=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(u,0,f)}u!==-1&&(s.videoCodecs=s.videoCodecs.filter(f=>!(f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:s,sendrecv:c}}function js(t,r,i,s,c,d){if(i==="videoExtensions"||i==="audioExtensions"){const u=[];return t[i].forEach(f=>{r[i].some((g,v)=>{if(f.entry===g.entry&&f.extensionName===g.extensionName)return u.push(v),!0})?d[i].push(f):s[i].push(f)}),void r[i].forEach((f,g)=>{u.indexOf(g)===-1&&c[i].push(f)})}if(i==="videoCodecs"||i==="audioCodecs"){const u=[];return t[i].forEach(f=>{r[i].some((g,v)=>{if(f.payloadType===g.payloadType&&JSON.stringify(f)===JSON.stringify(g))return u.push(v),!0})?d[i].push(f):s[i].push(f)}),void r[i].forEach((f,g)=>{u.indexOf(g)===-1&&c[i].push(f)})}}function Xg(t){const{send:r,recv:i,sendrecv:s}=t;if(!s){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...s.audioCodecs],c.videoCodecs=[...r.videoCodecs,...s.videoCodecs],c.audioExtensions=[...r.audioExtensions,...s.audioExtensions],c.videoExtensions=[...r.videoExtensions,...s.videoExtensions]):c=mn(s),i?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...i.audioCodecs,...s.audioCodecs],d.videoCodecs=[...i.videoCodecs,...s.videoCodecs],d.audioExtensions=[...i.audioExtensions,...s.audioExtensions],d.videoExtensions=[...i.videoExtensions,...s.videoExtensions]):d=mn(s),{send:c,recv:d}}function Yp(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function Jg(t,r,i,s){let c=[];if(t===Fe.VIDEO){if(W("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(c=r.videoCodecs.filter(d=>{var u;return xe(u=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(u,s)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===W("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[];const u=[],f=[],g=[];if(i.videoCodecs.forEach(v=>{const _=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";xe(_).call(_,s)?d.push(v):xe(_).call(_,"vp9")?u.push(v):xe(_).call(_,"vp8")?f.push(v):xe(_).call(_,"h264")&&g.push(v)}),d.length===0){let v="";u.length!==0?(d=u,v="vp9"):f.length!==0?(d=f,v="vp8"):g.length!==0&&(d=g,v="h264"),R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}d.length!==0&&(c=r.videoCodecs.filter(v=>d.some(_=>_.payloadType===v.payloadType)))}if(c.length===0&&(R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),W("USE_PUB_RTX")||W("USE_SUB_RTX")){const d=Ql(c,r.videoCodecs);c=[...c,...d]}}else{c=r.audioCodecs.filter(u=>{var f;return xe(f=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(f,s)});const d=r.audioCodecs.filter(u=>{var f;return xe(f=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(f,"red")});c.length===0&&(R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var f;return xe(f=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(f,"opus")})),W("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function Ql(t,r){const i=t.map(s=>s.payloadType.toString());return r.filter(s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&xe(i).call(i,s.fmtp&&s.fmtp.parameters.apt))}async function zi(t,r,i){const s=r.toString(),c=X6(s,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:s});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let u=d.sdp;u=HN(u,i||{}),c==null||c(u||""),await t.setLocalDescription({type:"answer",sdp:u})}function HN(t,r,i){if(W("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const s=yi(t),{useXR:c}=r;return s.mediaDescriptions.forEach(d=>{var u;d.attributes.mid&&(Array.isArray(i)&&!xe(i).call(i,d.attributes.mid)||(d.media.mediaType==="audio"&&Yp(d),d.media.mediaType==="video"&&function(f){f.media.mediaType==="video"&&W("ENABLE_DOWN_SPS_PPS")&&f.attributes.payloads.filter(g=>{var v;return((v=g.rtpMap)===null||v===void 0?void 0:v.encodingName.toLowerCase())==="h264"}).forEach(g=>{g.fmtp||(g.fmtp={parameters:{}}),g.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(d),c&&xe(u=["audio","video"]).call(u,d.media.mediaType)&&d.attributes.payloads.forEach(f=>{f.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&f.rtcpFeedbacks.push({type:"rrtr"})})))}),zc(s)}function X6(t,r,i,s){if(W("SDP_LOGGING"))return R.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(s,`
`),t),r==="offer"?c=>{X6(c,"answer",i==="local"?"remote":"local",s)}:void 0}async function J6(t,r,i){try{var s;if(!wt().supportSetRtpSenderParameters||!function(g){return g==="vp9"||g==="av1"}(t)||!W("ENABLE_SVC"))return;const c={},d={},u=r.getParameters(),f=(s=u.encodings)===null||s===void 0?void 0:s[0];d.scalabilityMode=Kg(i),f&&Object.assign(f,d),Object.assign(u,c),await r.setParameters(u),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(u.encodings)))}catch(c){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",c)}}function zE(t){const r=W("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>xe(t).call(t,i))}function Q6(t,r){try{var i;return((i=t.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function Z6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ha(t,r){return typeof W(t)===r?W(t):void 0}function ave(){try{const t=W("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Z6(Object(s),!0).forEach(function(c){j(r,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):Z6(Object(s)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(s,c))})}return r}({},t)}catch(t){return R.debug("handle gateway attributes failed: ",t),{}}}const e8={};function uc(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(t.name)),e8[t.name]=t}function bo(t){const r=e8[t];if(!r)throw new pe($.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function t8(t,r){return bo("DataStream").create(t,r)}function KE(){return bo("InterceptFrame").create()}function n8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function xr(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?n8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const zN=new Map;class sve extends Sn{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(Mn.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(Mn.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var s,c,d;super(),j(this,"store",void 0),j(this,"joinInfo",void 0),j(this,"key",void 0),j(this,"ntpOffset",0),j(this,"usingProxy",!1),j(this,"signal",void 0),j(this,"role",void 0),j(this,"isPreallocation",void 0),j(this,"isPreSub",void 0),j(this,"inChannelInfo",{joinAt:null,duration:0}),j(this,"spec",void 0),j(this,"_state","DISCONNECTED"),j(this,"_statsCollector",void 0),j(this,"_disconnectedReason",void 0),j(this,"isSignalRecover",!1),j(this,"hasChangeBGPAddress",!1),j(this,"trafficStatsInterval",void 0),j(this,"networkQualityInterval",void 0),j(this,"_joinGatewayStartTime",0),j(this,"_signalTimeout",!1),j(this,"_clientRoleOptions",void 0),j(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(s={spec:xr(xr({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(d=bo("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,s)):this.store.useDcSignal?function(u){return bo("DataChannelSignal").create(u)}({spec:xr(xr({},i),{},{retryConfig:i.websocketRetryConfig}),store:r}):new k6(xr(xr({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(r){this.usingProxy=r}async join(r,i,s){if(this.store.useDcSignal){let _=!1;r.cloudProxyServer!=="disabled"?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(r.cloudProxyServer,")")),_=!0):"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length>255||"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length<22?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):r.apResponse.addresses.some(S=>S.fingerprint)||W("FINGERPRINT")||(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&this.resetSignal()}this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=zN.get(r.cname);if(d||(d=new Map,zN.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const _=new se($.UID_CONFLICT);throw We.joinGateway(r.sid,{lts:c,succ:!1,ec:_.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:r.preload}),_}d.set(r.uid,!0),this.joinInfo=r,this.key=i;let u=0;this.joinGatewayStartTime=c;const f=r.proxyServer,g=this.store.useDcSignal?"datachannel":"websocket";try{R.debug("[".concat(this.store.clientId,"] use ").concat(g," join uid ").concat(u));const _=r.gatewayAddrs.map(w=>{let{address:C}=w;const[M,I]=C.split(":"),k={host:M,port:I};return r.proxyServer&&(k.proxy=r.proxyServer),k});let S;S=this.store.useDcSignal?await this.signal.init(r.apResponse.addresses):await this.signal.init(_),u=S.uid,R.debug("[".concat(this.store.clientId,"] ").concat(g," join uid ").concat(u," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var v;throw _.code===$.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||We.joinGateway(r.sid,{lts:c,succ:!1,ec:((v=_.data)===null||v===void 0?void 0:v.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!f||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:r.preload}),_&&_.code===$.INIT_DATACHANNEL_TIMEOUT?(R.warning("[".concat(this.store.clientId,"] User join datachannel failed"),_.toString()),this.resetSignal(),_):(R.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),d.delete(r.uid),this.signal.close(),_)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Mn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Mn.NETWORK_QUALITY,{uplinkNetworkQuality:WE(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:WE(this._statsCollector.trafficStats.B_dnq)}):this.emit(Mn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),u}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Ct.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Rt.CONNECTED||await function(s,c){return c===1/0?s:Ie.race([s,Dme(c)])}(this.signal.request(ze.LEAVE,void 0,!0),3e3)}catch(s){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(i),i!==Ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:W("PUB_EXTEND"),twcc:!!W("PUBLISH_TWCC"),rtx:!!W("USE_PUB_RTX")};try{return(await this.signal.request(ze.PUBLISH,c,!0))._message}catch(d){if(s&&d.data&&d.data.code===qe.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw d}}async publishDataChannel(r,i,s){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(ze.PUBLISH_DATASTREAM,d,!0)}catch(u){if(s&&u.data&&u.data.code===qe.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),u.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw u}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ze.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(s){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ie.all(r.map(i=>this.signal.request(ze.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){R.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX")||void 0,extend:W("SUB_EXTEND"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(ze.PRE_SUBSCRIBE,c,!0)}catch(d){if(s&&d.data&&d.data.code===qe.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,i,!1);throw d}}async subscribe(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX"),extend:W("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return(await this.signal.request(ze.SUBSCRIBE,c,!0))._message}catch(d){if(s&&d.data&&d.data.code===qe.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw d}}async subscribeDataChannel(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(ze.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(s&&d.data&&d.data.code===qe.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw d}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!W("USE_SUB_RTX"),twcc:!!W("SUBSCRIBE_TWCC"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(ze.SUBSCRIBE_STREAMS,s,!0)}catch(c){if(i&&c.data&&c.data.code===qe.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let c=s.frameRate,d=s.width,u=s.height,f=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(f=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(f=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,c||(f=!1)),f?{stream_type:0,width:d,height:u,fps:c,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0}(r);if(i)return this.signal.request(ze.SET_VIDEO_PROFILE,i);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(ze.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(s){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ie.all(r.map(s=>this.signal.request(ze.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:i},!0)))}catch(s){R.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(r){try{await this.signal.request(ze.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(ze.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ze.GATEWAY_INFO)}async renewToken(r){await this.signal.request(ze.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),W("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),W("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let s,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const d=Object.assign({},i);delete d.delay,delete d.level,await this.signal.request(ze.SET_CLIENT_ROLE,xr(xr({role:r,level:c,delay:s},d),{},{client_ts:Date.now()})),this.role=r}async setDualStreamMode(r,i,s){await this.signal.request(ze.SET_DUAL_STREAM_MODE,{mode:r},s,i)}async setRemoteVideoStreamType(r,i){await this.signal.request(ze.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(ze.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(ze.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(ze.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(ze.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),xr({},this.inChannelInfo)}async setConfigure(r){if(r&&Array.isArray(r)&&r.length!==0)return this.signal.request(ze.CONFIGURE,r)}async getGatewayVersion(){return(await this.signal.request(ze.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=zN.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let s;return s=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:Vr.username,password:Vr.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(xr(xr({},Vr),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(ze.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);s&&s.B_st!==i.B_st&&cE(()=>{this.emit(Mn.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var i,s,c,d;if(!this.joinInfo||!this.key)throw new se($.UNEXPECTED_ERROR,"can not generate join message, no join info");const u=Object.assign({},this.joinInfo.apResponse);let f=W("REPORT_APP_SCENARIO");if(typeof f!="string")try{f=JSON.stringify(f)}catch{f=void 0}var g;f&&f.length>128&&(f=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Mn.UPDATE_GATEWAY_CONFIG),g=this.store.clientId,xe(Wp).call(Wp,g)||Wp.push(g);const v=Bg(this.store),_=!((i=this.isPreallocation)===null||i===void 0||!i.call(this)),S=n3(this.store),w=ave(),C=mo(87)||c5()||NA(117),M=(function(){const K=jt();if(K.name!==Ft.SAFARI||!K.browserVersion)return!1;const X=K.browserVersion.split(".");return Number(X[0])>18||Number(X[0])===18&&Number(X[1])>=4}()||h5(18,4,!1))&&OA(18,6,!0)&&this.spec.codec==="h264"&&W("ENABLE_ABSSENDTIME_AS_SENTTS"),I=!(((s=u.detail)===null||s===void 0?void 0:s[3])!=="CN"||!W("ENABLE_QUALITY_FALLBACK"))&&W("ENABLE_QUALITY_FALLBACK"),k=!!W("ENABLE_AP_MULTI_IP")&&((c=u.detail)===null||c===void 0?void 0:c[5])==="multi-ip",G=xr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ja,browser:navigator.userAgent,process_id:W("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:k||this.hasChangeBGPAddress,ap_response:u,extend:W("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:f,attributes:{userAttributes:xr(xr({enableEncodedTransform:(!!W("ENABLE_AUDIO_METADATA")||!!W("ENABLE_AUDIO_PTS"))&&C||!!W("ENABLE_AUDIO_TOPN")&&AA(Ft.CHROME,87,116)||void 0,enableAudioMetadata:!!W("ENABLE_AUDIO_METADATA")&&C,enableAudioPts:!!W("ENABLE_AUDIO_PTS")&&C,topnSmoothLevel:W("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:W("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:W("TOPN_SWITCH_HOLD_MS"),topnAudioGain:W("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:W("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:W("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:ha("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:ha("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:ha("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:W("USE_PUB_RTX")===!0||W("USE_SUB_RTX")===!0||void 0,disableFEC:W("DISABLE_FEC"),enableNTPReport:!!W("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:S,enableFulllinkAvSync:!!W("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ha("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!W("FORCE_ENABLE_AUT_CC")||!vE()&&(!!W("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!W("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ha("USE_XR","boolean"),enableLossbasedBwe:ha("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!W("FORCE_ENABLE_AUT_CC")||!vE()&&(!!W("ENABLE_AUT_CC")||void 0),enableCCFallback:ha("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:_,preSubNum:v?ha("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ha("PUBLISH_TWCC","boolean"),enableSubTWCC:ha("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ha("USE_PUB_RTX","boolean"),enableSubRTX:ha("USE_SUB_RTX","boolean"),enableSubSVC:W("ENABLE_SVC")?W("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0,enableSvcExtended:W("ENABLE_SVC")&&Array.isArray(W("SVC_EXTENDED"))&&W("SVC_EXTENDED").length!==0?W("SVC_EXTENDED"):void 0,enableVosFallback:W("ENABLE_VOS_FALLBACK"),enableQualityFallback:I},w),{},{audioDuplicate:ha("ENABLE_AUDIO_RED","boolean")?(d=ha("AUDIO_DUPLICATE_NUM","number"))!==null&&d!==void 0?d:2:void 0,senttsUsesAbsSendTime:!!M||void 0,enableDualStreamFlag:ha("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(G.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(G.aes_mode=this.joinInfo.aesmode,W("ENCRYPT_AES")?(G.aes_secret=this.joinInfo.aespassword,G.aes_encrypt=!0):G.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(G.aes_salt=this.joinInfo.aessalt)),u.addresses[this.signal.websocket.currentURLIndex]&&(G.ap_response.ticket=u.addresses[this.signal.websocket.currentURLIndex].ticket,delete u.addresses),this.joinInfo.defaultVideoStream!==void 0&&(G.default_video_stream=this.joinInfo.defaultVideoStream),G}getRejoinMessage(){if(!this.joinInfo)throw new se($.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on($e.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on($e.WS_RECONNECTING,r=>{this.joinInfo&&We.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Ur.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",We.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on($e.WS_CLOSED,r=>{let i;switch(r){case Ct.LEAVE:i=Ur.LEAVE;break;case Ct.UID_BANNED:case Ct.IP_BANNED:case Ct.CHANNEL_BANNED:case Ct.SERVER_ERROR:i=Ur.SERVER_ERROR;break;case Ct.FALLBACK:i=Ur.FALLBACK;break;case Ct.LICENSE_MISSING:case Ct.LICENSE_EXPIRED:case Ct.LICENSE_MINUTES_EXCEEDED:case Ct.LICENSE_PERIOD_INVALID:case Ct.LICENSE_MULTIPLE_SDK_SERVICE:case Ct.LICENSE_ILLEGAL:case Ct.TOKEN_EXPIRE:i=r;break;default:i=Ur.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+Ur.NETWORK_ERROR)),this.joinInfo&&We.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Ct.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==Ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on($e.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=W("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(We.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));Zt("EVENT_REPORT_DOMAIN",r[1]),Zt("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Zt("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(ot.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on($e.REQUEST_RECOVER,(r,i,s)=>{if(!this.joinInfo)return s(new se($.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,qn(this,Mn.REQUEST_NEW_GATEWAY_LIST).then(i).catch(s)}),this.signal.on($e.REQUEST_JOIN_INFO,async(r,i,s)=>{var c,d,u;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const f=mn((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(W("NEW_TURN_MODE")&&f&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var g;let w=f.servers.map(I=>"turnServerURL"in I&&W("USE_TURN_IP")?xr(xr({},I),{},{turnServerURL:BE(I.turnServerURL)}):I),C=(g=f.serversFromGateway)===null||g===void 0?void 0:g.map(I=>W("USE_TURN_IP")?xr(xr({},I),{},{turnServerURL:BE(I.turnServerURL)}):I);const M=this.signal.currentURLIndex;w.length>0&&(w=[w[M%w.length]],f.servers=w),Array.isArray(C)&&C.length>0&&(C=[C[0]],f.serversFromGateway=C),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(M))}const{iceParameters:v,dtlsParameters:_,rtpCapabilities:S}=await qn(this,Mn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:f,cloudProxyServer:(u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:v,dtlsParameters:_,rtpCapabilities:S,version:"2"}}))}catch(w){i(w)}}),this.signal.on($e.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on($e.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let s,c="";var d;r instanceof se?(s=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):s=r,We.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on($e.IS_P2P_DISCONNECTED,r=>{r(gu(this,Mn.IS_P2P_DISCONNECTED))}),this.signal.on($e.DISCONNECT_P2P,()=>{this.emit(Mn.DISCONNECT_P2P)}),this.signal.on($e.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on($e.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on($e.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit(Mn.JOIN_RESPONSE,r,i)}),this.signal.on($e.PRE_CONNECT_PC,async(r,i)=>{if(this.joinInfo){var s,c;this.updateTurnConfigFromSignal();const u=this.getCurrentGatewayAddress(),f=mn((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(W("NEW_TURN_MODE")&&f&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var d;let v=f.servers.map(w=>"turnServerURL"in w&&W("USE_TURN_IP")?xr(xr({},w),{},{turnServerURL:BE(w.turnServerURL)}):w),_=(d=f.serversFromGateway)===null||d===void 0?void 0:d.map(w=>W("USE_TURN_IP")?xr(xr({},w),{},{turnServerURL:BE(w.turnServerURL)}):w);const S=this.signal.currentURLIndex;v.length>0&&(v=[v[S%v.length]],f.servers=v),Array.isArray(_)&&_.length>0&&(_=[_[0]],f.serversFromGateway=_),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(S,",in pre pc"))}const g=W("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(u&&g){const v=z6(u);qn(this,Mn.PRE_CONNECT_PC,{candidates:v,fingerprint:g,turnServer:f}).then(_=>{r==null||r(_)}).catch(i||(()=>{}))}}}),this.signal.on($e.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof W("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(W("AP_REQUEST_DETAIL"),";").concat(r))}),this.signal.on($e.VOS_FALLBACK,r=>{this.emit(Mn.VOS_FALLBACK,r)}),this.signal.on($e.DATACHANNEL_FAILBACK,r=>{R.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Mn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(ze.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(ze.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(s){throw R.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(ze.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(ze.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(s){throw R.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(r){const i={users:r.map(s=>({stream_id:s.stream_id,stream_type:s.stream_type}))};try{await this.signal.request(ze.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(r,i){const s={action:r.find(c=>c.stream_type===qt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(ze.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const s={action:r.find(c=>c.stream_type===qt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(ze.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const s={action:r===Fe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(ze.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const s={action:r===Fe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(ze.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(ze.RESTART_ICE,i,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||Ur.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!W("GATEWAY_WSS_ADDRESS"))return W("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(ze.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ct.FALLBACK)),this.store.useDcSignal=!1,this.signal=new k6(xr(xr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Mn.RESET_SIGNAL)}}let YE=0,KN=0;function So(t,r,i,s){return new Ie((c,d)=>{r.timeout=r.timeout||W("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),YE+=ac(r.data)):i&&(r.data.size?YE+=r.data.size:r.data instanceof FormData?YE+=P5(r.data):YE+=ac(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Ni.request(r).then(u=>{typeof u.data=="string"?KN+=ac(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?KN+=u.data.byteLength:KN+=ac(JSON.stringify(u.data)),s&&c({data:u.data,headers:u.headers}),c(u.data)}).catch(u=>{Ni.isCancel(u)?d(new se($.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?d(new se($.NETWORK_TIMEOUT,u.message)):u.response?d(new se($.NETWORK_RESPONSE_ERROR,u.response.status)):d(new se($.NETWORK_ERROR,u.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(ye){var Ne=0;return function(){return Ne<ye.length?{done:!1,value:ye[Ne++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(ye,Ne,Be){return ye==Array.prototype||ye==Object.prototype||(ye[Ne]=Be.value),ye},s,c=function(ye){ye=[typeof globalThis=="object"&&globalThis,ye,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var Ne=0;Ne<ye.length;++Ne){var Be=ye[Ne];if(Be&&Be.Math==Math)return Be}throw Error("Cannot find global object")}(this);function d(ye,Ne){if(Ne)e:{var Be=c;ye=ye.split(".");for(var _e=0;_e<ye.length-1;_e++){var O=ye[_e];if(!(O in Be))break e;Be=Be[O]}(Ne=Ne(_e=Be[ye=ye[ye.length-1]]))!=_e&&Ne!=null&&i(Be,ye,{configurable:!0,writable:!0,value:Ne})}}function u(ye){return(ye={next:ye})[Symbol.iterator]=function(){return this},ye}function f(ye){var Ne=typeof Symbol<"u"&&Symbol.iterator&&ye[Symbol.iterator];return Ne?Ne.call(ye):{next:r(ye)}}if(d("Symbol",function(ye){function Ne(O,q){this.A=O,i(this,"description",{configurable:!0,writable:!0,value:q})}if(ye)return ye;Ne.prototype.toString=function(){return this.A};var Be="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",_e=0;return function O(q){if(this instanceof O)throw new TypeError("Symbol is not a constructor");return new Ne(Be+(q||"")+"_"+_e++,q)}}),d("Symbol.iterator",function(ye){if(ye)return ye;ye=Symbol("Symbol.iterator");for(var Ne="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Be=0;Be<Ne.length;Be++){var _e=c[Ne[Be]];typeof _e=="function"&&typeof _e.prototype[ye]!="function"&&i(_e.prototype,ye,{configurable:!0,writable:!0,value:function(){return u(r(this))}})}return ye}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var g;e:{var v={};try{v.__proto__={a:!0},g=v.a;break e}catch{}g=!1}s=g?function(ye,Ne){if(ye.__proto__=Ne,ye.__proto__!==Ne)throw new TypeError(ye+" is not extensible");return ye}:null}var _=s;function S(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function w(ye){if(ye.m)throw new TypeError("Generator is already running");ye.m=!0}function C(ye,Ne){return ye.h=3,{value:Ne}}function M(ye){this.g=new S,this.G=ye}function I(ye,Ne,Be,_e){try{var O=Ne.call(ye.g.j,Be);if(!(O instanceof Object))throw new TypeError("Iterator result "+O+" is not an object");if(!O.done)return ye.g.m=!1,O;var q=O.value}catch(ee){return ye.g.j=null,ye.g.s(ee),k(ye)}return ye.g.j=null,_e.call(ye.g,q),k(ye)}function k(ye){for(;ye.g.h;)try{var Ne=ye.G(ye.g);if(Ne)return ye.g.m=!1,{value:Ne.value,done:!1}}catch(Be){ye.g.v=void 0,ye.g.s(Be)}if(ye.g.m=!1,ye.g.l){if(Ne=ye.g.l,ye.g.l=null,Ne.F)throw Ne.D;return{value:Ne.return,done:!0}}return{value:void 0,done:!0}}function G(ye){this.next=function(Ne){return ye.o(Ne)},this.throw=function(Ne){return ye.s(Ne)},this.return=function(Ne){return function(Be,_e){w(Be.g);var O=Be.g.j;return O?I(Be,"return"in O?O.return:function(q){return{value:q,done:!0}},_e,Be.g.return):(Be.g.return(_e),k(Be))}(ye,Ne)},this[Symbol.iterator]=function(){return this}}function K(ye,Ne){return Ne=new G(new M(Ne)),_&&ye.prototype&&_(Ne,ye.prototype),Ne}if(S.prototype.o=function(ye){this.v=ye},S.prototype.s=function(ye){this.l={D:ye,F:!0},this.h=this.C||this.u},S.prototype.return=function(ye){this.l={return:ye},this.h=this.u},M.prototype.o=function(ye){return w(this.g),this.g.j?I(this,this.g.j.next,ye,this.g.o):(this.g.o(ye),k(this))},M.prototype.s=function(ye){return w(this.g),this.g.j?I(this,this.g.j.throw,ye,this.g.o):(this.g.s(ye),k(this))},d("Array.prototype.entries",function(ye){return ye||function(){return function(Ne,Be){Ne instanceof String&&(Ne+="");var _e=0,O=!1,q={next:function(){if(!O&&_e<Ne.length){var ee=_e++;return{value:Be(ee,Ne[ee]),done:!1}}return O=!0,{done:!0,value:void 0}}};return q[Symbol.iterator]=function(){return q},q}(this,function(Ne,Be){return[Ne,Be]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var X=function(ye,Ne){for(var Be=0;Be<ye.length;Be++)Ne(ye[Be])},te=function(ye){return ye.replace(/\r?\n|\r/g,`\r
`)},ne=function(ye,Ne,Be){return Ne instanceof Blob?(Be=Be!==void 0?Be+"":typeof Ne.name=="string"?Ne.name:"blob",Ne.name===Be&&Object.prototype.toString.call(Ne)!=="[object Blob]"||(Ne=new File([Ne],Be)),[String(ye),Ne]):[String(ye),String(Ne)]},Z=function(ye,Ne){if(ye.length<Ne)throw new TypeError(Ne+" argument required, but only "+ye.length+" present.")},ie=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ge=ie.FormData,Ee=ie.XMLHttpRequest&&ie.XMLHttpRequest.prototype.send,Me=ie.Request&&ie.fetch,at=ie.navigator&&ie.navigator.sendBeacon,tt=ie.Element&&ie.Element.prototype,mt=ie.Symbol&&Symbol.toStringTag;mt&&(Blob.prototype[mt]||(Blob.prototype[mt]="Blob"),"File"in ie&&!File.prototype[mt]&&(File.prototype[mt]="File"));try{new File([],"")}catch{ie.File=function(Ne,Be,_e){return Ne=new Blob(Ne,_e||{}),Object.defineProperties(Ne,{name:{value:Be},lastModified:{value:+(_e&&_e.lastModified!==void 0?new Date(_e.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),mt&&Object.defineProperty(Ne,mt,{value:"File"}),Ne}}var ht=function(ye){return ye.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Wt=function(ye){this.i=[];var Ne=this;ye&&X(ye.elements,function(Be){if(Be.name&&!Be.disabled&&Be.type!=="submit"&&Be.type!=="button"&&!Be.matches("form fieldset[disabled] *"))if(Be.type==="file"){var _e=Be.files&&Be.files.length?Be.files:[new File([],"",{type:"application/octet-stream"})];X(_e,function(O){Ne.append(Be.name,O)})}else Be.type==="select-multiple"||Be.type==="select-one"?X(Be.options,function(O){!O.disabled&&O.selected&&Ne.append(Be.name,O.value)}):Be.type==="checkbox"||Be.type==="radio"?Be.checked&&Ne.append(Be.name,Be.value):(_e=Be.type==="textarea"?te(Be.value):Be.value,Ne.append(Be.name,_e))})};if((t=Wt.prototype).append=function(ye,Ne,Be){Z(arguments,2),this.i.push(ne(ye,Ne,Be))},t.delete=function(ye){Z(arguments,1);var Ne=[];ye=String(ye),X(this.i,function(Be){Be[0]!==ye&&Ne.push(Be)}),this.i=Ne},t.entries=function ye(){var Ne,Be=this;return K(ye,function(_e){if(_e.h==1&&(Ne=0),_e.h!=3)return Ne<Be.i.length?_e=C(_e,Be.i[Ne]):(_e.h=0,_e=void 0),_e;Ne++,_e.h=2})},t.forEach=function(ye,Ne){Z(arguments,1);for(var Be=f(this),_e=Be.next();!_e.done;_e=Be.next()){var O=f(_e.value);_e=O.next().value,O=O.next().value,ye.call(Ne,O,_e,this)}},t.get=function(ye){Z(arguments,1);var Ne=this.i;ye=String(ye);for(var Be=0;Be<Ne.length;Be++)if(Ne[Be][0]===ye)return Ne[Be][1];return null},t.getAll=function(ye){Z(arguments,1);var Ne=[];return ye=String(ye),X(this.i,function(Be){Be[0]===ye&&Ne.push(Be[1])}),Ne},t.has=function(ye){Z(arguments,1),ye=String(ye);for(var Ne=0;Ne<this.i.length;Ne++)if(this.i[Ne][0]===ye)return!0;return!1},t.keys=function ye(){var Ne,Be,_e,O,q=this;return K(ye,function(ee){if(ee.h==1&&(Ne=f(q),Be=Ne.next()),ee.h!=3)return Be.done?void(ee.h=0):(_e=Be.value,O=f(_e),C(ee,O.next().value));Be=Ne.next(),ee.h=2})},t.set=function(ye,Ne,Be){Z(arguments,2),ye=String(ye);var _e=[],O=ne(ye,Ne,Be),q=!0;X(this.i,function(ee){ee[0]===ye?q&&(q=!_e.push(O)):_e.push(ee)}),q&&_e.push(O),this.i=_e},t.values=function ye(){var Ne,Be,_e,O,q=this;return K(ye,function(ee){if(ee.h==1&&(Ne=f(q),Be=Ne.next()),ee.h!=3)return Be.done?void(ee.h=0):(_e=Be.value,(O=f(_e)).next(),C(ee,O.next().value));Be=Ne.next(),ee.h=2})},Wt.prototype._asNative=function(){for(var ye=new ge,Ne=f(this),Be=Ne.next();!Be.done;Be=Ne.next()){var _e=f(Be.value);Be=_e.next().value,_e=_e.next().value,ye.append(Be,_e)}return ye},Wt.prototype._blob=function(){var ye="----formdata-polyfill-"+Math.random(),Ne=[],Be="--"+ye+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(_e,O){return typeof _e=="string"?Ne.push(Be+ht(te(O))+`"\r
\r
`+te(_e)+`\r
`):Ne.push(Be+ht(te(O))+'"; filename="'+ht(_e.name)+`"\r
Content-Type: `+(_e.type||"application/octet-stream")+`\r
\r
`,_e,`\r
`)}),Ne.push("--"+ye+"--"),new Blob(Ne,{type:"multipart/form-data; boundary="+ye})},Wt.prototype[Symbol.iterator]=function(){return this.entries()},Wt.prototype.toString=function(){return"[object FormData]"},tt&&!tt.matches&&(tt.matches=tt.matchesSelector||tt.mozMatchesSelector||tt.msMatchesSelector||tt.oMatchesSelector||tt.webkitMatchesSelector||function(ye){for(var Ne=(ye=(this.document||this.ownerDocument).querySelectorAll(ye)).length;0<=--Ne&&ye.item(Ne)!==this;);return-1<Ne}),mt&&(Wt.prototype[mt]="FormData"),Ee){var En=ie.XMLHttpRequest.prototype.setRequestHeader;ie.XMLHttpRequest.prototype.setRequestHeader=function(ye,Ne){En.call(this,ye,Ne),ye.toLowerCase()==="content-type"&&(this.B=!0)},ie.XMLHttpRequest.prototype.send=function(ye){ye instanceof Wt?(ye=ye._blob(),this.B||this.setRequestHeader("Content-Type",ye.type),Ee.call(this,ye)):Ee.call(this,ye)}}Me&&(ie.fetch=function(ye,Ne){return Ne&&Ne.body&&Ne.body instanceof Wt&&(Ne.body=Ne.body._blob()),Me.call(this,ye,Ne)}),at&&(ie.navigator.sendBeacon=function(ye,Ne){return Ne instanceof Wt&&(Ne=Ne._asNative()),at.call(this,ye,Ne)}),ie.FormData=Wt}})();const Qg=()=>{const t=W("AREAS");return t.length===0&&t.push(Gt.GLOBAL),qa(t).call(t,(r,i,s)=>{const c=r8(i);return c?s===0?c:"".concat(r,",").concat(c):r},"")},r8=t=>t===Gt.OVERSEA?"".concat(Hr.ASIA,",").concat(Hr.EUROPE,",").concat(Hr.AFRICA,",").concat(Hr.NORTH_AMERICA,",").concat(Hr.SOUTH_AMERICA,",").concat(Hr.OCEANIA):Hr[t],ove=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(i=>{const s=UE[i],c=Object.keys(s);c&&c.map(d=>{d!=="CODE"&&(r[d]=r[d].concat(s[d]))})}),r},qE={GLOBAL:{ASIA:[Gt.CHINA,Gt.JAPAN,Gt.INDIA,Gt.KOREA,Gt.HKMC],EUROPE:[],NORTH_AMERICA:[Gt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},XE=Object.keys(qE[Gt.GLOBAL]),YN=[Gt.CHINA,Gt.NORTH_AMERICA,Gt.EUROPE,Gt.ASIA,Gt.JAPAN,Gt.INDIA,Gt.OCEANIA,Gt.SOUTH_AMERICA,Gt.AFRICA,Gt.KOREA,Gt.HKMC,Gt.US],cve=function(t,r){let i=[];if(xe(t).call(t,Gt.GLOBAL)){const d=[Gt.GLOBAL,Gt.OVERSEA],u=Object.keys(UE);if(r===Gt.GLOBAL)throw new se($.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Gt.CHINA)i=[Gt.OVERSEA];else if(c=r,xe(XE).call(XE,c)){const f=(s=r,qE[Gt.GLOBAL][s]||[]),g=[...d,r,...f];i=u.filter(v=>!xe(g).call(g,v))}else if(function(f){let g=!1;return XE.forEach(v=>{var _;xe(_=qE[Gt.GLOBAL][v]).call(_,f)&&(g=!0)}),g}(r)){const f=function(v){let _;return XE.forEach(S=>{var w;xe(w=qE[Gt.GLOBAL][S]).call(w,v)&&(_=S)}),_}(r),g=[...d,f,r];i=u.filter(v=>!xe(g).call(g,v))}else i=t;i=function(f){const g=[];return YN.forEach(v=>{xe(f).call(f,v)&&g.push(v)}),g.concat(f.filter(v=>!xe(YN).call(YN,v)))}(i)}else i=t;var s,c;return i};function i8(t){var r,i;if(!t&&xe(r=W("AREAS")).call(r,Gt.EXTENSIONS))return R.debug("update area from ap : reset"),void qN(vge,!0);if(!xe(i=W("AREAS")).call(i,Gt.GLOBAL)||!t)return;let s=UE.EXTENSIONS;s&&(s={CODE:r8(Gt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},R.debug("update area from ap success: ".concat(t,",config is "),s),Zt("AREAS",[Gt.EXTENSIONS],!0),Object.keys(s).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Zt(c,s[c][0]):Zt(c,s[c])}))}function qN(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=We.reportApiInvoke(null,{name:yn.SET_AREA,options:t,tag:rn.TRACER});try{let s=[];if(typeof t=="string"&&(s=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!xe(R6).call(R6,d))throw new se($.INVALID_PARAMS,"invalid area code")}),s=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:u}=t;if(!d)throw new se($.INVALID_PARAMS,"area code is needed");let f=d;typeof d=="string"&&(f=[d]),s=u?cve(f,u):f}if(!r){if(Ta.AREAS){const d=new se($.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(d),void R.warning("setArea is prohibited because of config-distribute")}if(xe(s).call(s,Gt.GLOBAL)&&W("AREAS")===Gt.EXTENSIONS){const d=new se($.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(d),void R.warning("setArea is prohibited because of ap extensions")}}Zt("AREAS",s,r);const c=ove(s);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?Zt(d,c[d][0]):Zt(d,c[d])}),R.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()}function a8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function hc(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?a8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let XN=1;function lve(t,r,i,s,c){XN+=1;const d={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:XN,requestId:XN,version:Ja,cname:i.cname},u={service_name:r,json_body:JSON.stringify(d)};let f,g,v=t[0];return go(async()=>{f=Date.now();const _=await So(v,{data:u,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-f,_.code!==0){const C=new se($.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:g});throw R.error(C.toString()),C}const S=JSON.parse(_.json_body);if(S.code!==200){const C=new se($.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(S.code,", reason: ").concat(S.reason),{code:S.code,responseTime:g});throw R.error(C.toString()),C}if(!S.servers||S.servers.length===0){const C=new se($.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:S.code,responseTime:g});throw R.error(C.toString()),C}const w=function(C,M){return{addressList:C.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(M))),workerToken:C.workerToken,vid:C.vid}}(S,r);return W("LIVE_STREAMING_ADDRESS")&&(w.addressList=W("LIVE_STREAMING_ADDRESS")instanceof Array?W("LIVE_STREAMING_ADDRESS"):[W("LIVE_STREAMING_ADDRESS")]),hc(hc({},w),{},{responseTime:g})},(_,S)=>(We.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(_.addressList),firstSuccess:S===0,responseTime:g,serverIp:t[S%t.length]}),!1),(_,S)=>(We.apworkerEvent(i.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:r,responseTime:g,serverIp:t[S%t.length]}),!!(_.code!==$.OPERATION_ABORTED&&_.code!==$.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(v=t[(S+1)%t.length],!0)),c)}let JN=1;function s8(t,r,i,s){let{url:c,areaCode:d}=t;const{clientId:u,sid:f}=r,g=Date.now();let v;const _=r.role,[S,w]=ZN(r,d,[Wn.CHOOSE_SERVER]);let C=Nn.networkState;return go(async()=>{C&&Nn.networkState===vi.OFFLINE&&Nn.onlineWaiter&&await Ie.race([Nn.onlineWaiter,dr(s&&s.maxRetryTimeout||Bn.maxRetryTimeout)]),C=Nn.networkState;const{data:M,headers:I}=await So(c,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=I.http3==="1"?1:-1,We.reportResourceTiming(c,f),c8(M,c,r,g,[Wn.CHOOSE_SERVER],v);const k=zg(M,Wn.CHOOSE_SERVER);return QN(k),UN(k,c)},M=>(M&&We.joinChooseServer(f,{role:_,lts:g,succ:!0,csAddr:c,opid:w,serverList:M.gatewayAddrs.map(I=>I.address),ec:null,cid:M.cid.toString(),uid:M.uid.toString(),csIp:M.csIp,unilbsServerIds:[Wn.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:M.res.detail&&M.res.detail[38],vid:M.vid}),!1),M=>M.code!==$.OPERATION_ABORTED&&(M.code===$.CAN_NOT_GET_GATEWAY_SERVER?M.data.retry:(We.joinChooseServer(f,{role:_,lts:g,succ:!1,csAddr:c,serverList:null,opid:w,ec:M.code,csIp:M.data&&M.data.csIp,unilbsServerIds:[Wn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:C}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),R.warning("[".concat(u||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),M),!0)),s)}function o8(t,r,i,s){let c,{url:d,areaCode:u,serviceIds:f}=t;const g=Date.now(),v=r.role,[_,S]=ZN(r,u,f);let w;return go(async()=>{w&&Nn.networkState===vi.OFFLINE&&Nn.onlineWaiter&&await Ie.race([Nn.onlineWaiter,dr(s&&s.maxRetryTimeout||Bn.maxRetryTimeout)]),w=Nn.networkState;const{data:C,headers:M}=await So(d,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=M.http3==="1"?1:-1,We.reportResourceTiming(d,r.sid),c8(C,d,r,g,f,c);const I=zg(C,Wn.CHOOSE_SERVER),k=zg(C,r.cloudProxyServer==="proxy5"?Wn.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Wn.CLOUD_PROXY:Wn.CLOUD_PROXY_FALLBACK),G=performance.getEntriesByName(d),K=G[G.length-1];let X;return K&&(X={name:K.name,protocol:"nextHopProtocol"in K?K.nextHopProtocol:"",dnscost:"domainLookupEnd"in K&&"domainLookupStart"in K&&typeof K.domainLookupEnd=="number"&&typeof K.domainLookupStart=="number"?K.domainLookupEnd-K.domainLookupStart:-1,tcpTlsCost:"connectEnd"in K&&"connectStart"in K&&typeof K.connectEnd=="number"&&typeof K.connectStart=="number"?K.connectEnd-K.connectStart:-1,reqCost:"requestStart"in K&&typeof K.requestStart=="number"&&"responseEnd"in K&&typeof K.responseEnd=="number"?K.responseEnd-K.requestStart:-1,handleCost:"leave_ts"in C&&"enter_ts"in C&&typeof C.leave_ts=="number"&&typeof C.enter_ts=="number"?C.leave_ts-C.enter_ts:-1}),QN(I),{gatewayInfo:UN(I,d),proxyInfo:k,url:d,resourceTimingInfo:X}},C=>{var M;return C.gatewayInfo&&We.joinChooseServer(r.sid,{role:v,lts:g,succ:!0,csAddr:d,serverList:C.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:S,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:C.gatewayInfo.res.detail&&C.gatewayInfo.res.detail[38],vid:(M=C.gatewayInfo)===null||M===void 0?void 0:M.vid,resourceTimingInfo:C.resourceTimingInfo?JSON.stringify(C.resourceTimingInfo):void 0}),C.proxyInfo&&We.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:d,turnServerAddrList:C.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:f.toString()}),!1},C=>C.code!==$.OPERATION_ABORTED&&(C.code===$.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(We.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:C.code,eventType:r.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:w})}),R.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),C),!0)),s)}const c8=(t,r,i,s,c,d)=>{const{sid:u,clientId:f,cloudProxyServer:g}=i,v=[],_=S=>{S.flag===4096?We.joinChooseServer(u,{role:i.role,lts:s,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:S.error.message,csIp:S.error.data&&S.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:i.apRequestDetail}):S.flag!==1048576&&S.flag!==4194304&&S.flag!==4194310||We.joinWebProxyAP(u,{lts:s,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:S.error.code,eventType:g,unilbsServerIds:c.toString()})};if(t.response_body.forEach(S=>{const w=S.buffer.code;if(S.uri===23&&w===0&&!S.buffer.edges_services)if(S.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),S.buffer.edges_services=[];else{const C={error:new se($.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:W("NO_EDGES_RETRY"),csIp:t.detail[502]}),flag:S.buffer.flag};v.push(C),_(C)}if(w!==0){const C=zp(w),M={error:new se($.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:t.detail[502]}),flag:S.buffer.flag};S.buffer.flag===4194310?R.warning(M.error.toString()):v.push(M),_(M)}}),v.length)throw R.warning("[".concat(f||"sid-".concat(u.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message,", retry: ").concat(S.error.data.retry)).join(" | "))),new se($.CAN_NOT_GET_GATEWAY_SERVER,v.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message)).join(" | "),{retry:!!v.find(S=>S.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(S=>{var w;return S==null||(w=S.error)===null||w===void 0||(w=w.data)===null||w===void 0?void 0:w.desc}).filter(S=>!!S))]})},QN=t=>{var r,i,s,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new se($.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(W("AP_AREA")&&((s=t.detail)!==null&&s!==void 0&&s[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?i8(t.detail[23].toLowerCase()):i8()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((i=t.detail)===null||i===void 0?void 0:i[19])=="string"){const u=t.detail[19],f=u==null?void 0:u.split(";");for(let g=0;g<f.length;g++){var d;const v=mi(d=f[g]).call(d);t.addresses[g]&&f&&(t.addresses[g].fingerprint=v)}}if(W("GATEWAY_ADDRESS")&&W("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",W("GATEWAY_ADDRESS"));const u=W("GATEWAY_ADDRESS").map(f=>{var g,v;const _=(g=(v=t.addresses.find(S=>S.ip===f.ip&&S.port===f.port))===null||v===void 0?void 0:v.fingerprint)!==null&&g!==void 0?g:"";return{ip:f.ip,port:f.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:f.fingerprint||_}});t.addresses=u}},dve=(t,r)=>{if(t.response_body&&t.response_body.length){const i=t.response_body[0];if(i.buffer.code!==0){const s=zp(i.buffer.code);throw new se($.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return i.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",r),new se($.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},ZN=(t,r,i)=>{const s=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:hc(hc(hc({6:t.stringUid,11:r,12:W("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:i,uid:t.uid||0}}]};d.request_bodies.forEach(f=>{t.multiIP&&t.multiIP.gateway_ip&&(f.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const u=new FormData;return u.append("request",JSON.stringify(d)),[u,s]},uve=(t,r)=>{const i=Math.floor(Math.random()*1e12),s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]};let qp=0;function Xp(t){return Ie.all(t.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const Zg=async t=>{let{fragementLength:r,referenceList:i,asyncMapHandler:s,allFailedhandler:c,promisesCollector:d}=t,u=0;const f=r;let g,v=0;const _=async()=>{const S=(()=>{const w=u*f,C=w+f;return i.slice(w,C).map(s)})();d&&d.push(...S);try{g=await Xp(S)}catch(w){if(v+=f,u++,!(v>=i.length))return void await _();c(w)}S.forEach(w=>w.cancel())};return await _(),g},l8=async t=>{let{referenceList:r,asyncMapHandler:i,closeFn:s}=t;const c=r.length;let d=0;const u=async()=>{const f=i(r.shift());try{return await f}catch(g){if(d++,d>=c||s!=null&&s(g))throw g;return u()}};return u()};async function hve(){if(typeof VideoDecoder>"u")return!0;let t;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],u=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Ie((g,v)=>{let _;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:w=>{w.close(),clearTimeout(_),g(!0)},error:w=>{clearTimeout(_),g(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const S=[r,i,s,c,d,u];for(let w=0;w<S.length;w++){const C=new EncodedVideoChunk({type:w==0?"key":"delta",timestamp:33333*w,duration:33333,data:new Uint8Array(S[w])});try{await t.decode(C)}catch{return void g(!1)}}})(),_=setTimeout(()=>{g(!1)},5e3)})}async function JE(t,r,i,s){return{gatewayInfo:await async function(d,u,f,g){let v=null;const _=[],S=async()=>{const C=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(k=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Qg()})),M=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(k=>k.url)}),I=await Zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:k=>(R.debug("[".concat(d.clientId,"] Connect to choose_server:"),k.url),s8(k,d,u,f)),allFailedhandler:k=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},M),k[0]},promisesCollector:_});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},M),I},w=async()=>{if(await dr(1e3),v!==null)return v;const C=W("WEBCS_DOMAIN_BACKUP_LIST").map(k=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Qg()})),M=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(k=>k.url)}),I=await Zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:k=>(R.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),k.url),s8(k,d,u,f)),allFailedhandler:k=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},M),k[0]},promisesCollector:_});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},M),I};try{return v=await Xp([S(),w()]),_.length&&_.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),v}catch(C){throw C[0]}}(t,r,i,s)}}async function d8(t,r,i,s,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await JE(t,r,i,c);if(W("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:w,proxyInfo:C}=await p8(t,r,i,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:w};const M=C.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||Vr.tcpport,udpport:I.udpport||Vr.udpport,username:I.username||Vr.username,password:I.password||Vr.password,forceturn:!1,security:!0}));if(c.useP2P){var u;const I=(u=t.uid)!==null&&u!==void 0?u:w.uid,k="glb:".concat(I.toString()),G=await LA(k),K=C.map(X=>({turnServerURL:X.address,tcpport:X.tcpport||Vr.tcpport,udpport:X.udpport||Vr.udpport,username:k,password:G,forceturn:!1,security:!0}));M.push(...K)}return t.turnServer={mode:"manual",servers:M},{gatewayInfo:w}}return await JE(t,r,i,c)}const{proxyInfo:f,gatewayInfo:g}=await p8(t,r,i,c),v={gatewayInfo:g},_=f.map(w=>({turnServerURL:w.address,tcpport:d==="proxy3"?void 0:w.tcpport?w.tcpport:Vr.tcpport,udpport:d==="proxy4"?void 0:w.udpport?w.udpport:Vr.udpport,username:w.username||Vr.username,password:w.password||Vr.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var S;const w=(S=t.uid)!==null&&S!==void 0?S:g.uid,C="glb:".concat(w.toString()),M=await LA(C),I=f.map(k=>({turnServerURL:k.address,tcpport:d==="proxy3"?void 0:k.tcpport||Vr.tcpport,udpport:d==="proxy4"?void 0:k.udpport||Vr.udpport,username:C,password:M,forceturn:d!=="proxy4",security:d==="proxy5"}));_.push(...I)}return t.turnServer={mode:"manual",servers:_},R.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),v}async function u8(t,r,i,s,c){const d=W("ACCOUNT_REGISTER").slice(0,W("AJAX_REQUEST_CONCURRENT"));let u=[];u=r.proxyServer?d.map(g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1")):d.map(g=>"https://".concat(g,"/api/v1"));const f=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:u});try{const g=await async function(v,_,S,w,C){const M=Date.now(),I={sid:S.sid,opid:10,appid:S.appId,string_uid:_};let k=v[0];const G=await go(()=>So(k+"".concat(k.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(K,X)=>{if(K.code===0){if(K.uid<=0||K.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(_," => ").concat(K.uid),K),We.reqUserAccount(I.sid,{lts:M,success:!1,serverAddr:k,stringUid:I.string_uid,uid:K.uid,errorCode:$.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new se($.INVALID_UINT_UID_FROM_STRING_UID);return We.reqUserAccount(I.sid,{lts:M,success:!0,serverAddr:k,stringUid:I.string_uid,uid:K.uid,errorCode:null,extend:I}),!1}const te=zp(K.code);return te.retry&&(k=v[(X+1)%v.length]),We.reqUserAccount(I.sid,{lts:M,success:!1,serverAddr:k,stringUid:I.string_uid,uid:K.uid,errorCode:te.desc,extend:I}),te.retry},(K,X)=>K.code!==$.OPERATION_ABORTED&&(We.reqUserAccount(I.sid,{lts:M,success:!1,serverAddr:k,stringUid:I.string_uid,uid:null,errorCode:K.code,extend:I}),k=v[(X+1)%v.length],!0),C);if(G.code!==0){const K=zp(G.code);throw new se($.UNEXPECTED_RESPONSE,K.desc)}return G}(u,t,r,i,s);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},f),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},f),g}}async function pve(t,r,i){const s=W("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?s.map(d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1")):s.map(d=>"https://".concat(d,"/api/v1"));try{return await l8({referenceList:c,asyncMapHandler:u=>async function(f,g,v,_){const S=Date.now(),w={sid:v.sid,opid:10,appid:v.appId,string_uid:g};try{const C=await So(f+"".concat(f.indexOf("?")===-1?"?":"&","action=stringuid"),{data:w,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(C.code!==0){const M=zp(C.code);throw new se($.UNEXPECTED_RESPONSE,"preload sua error:".concat(M.desc),M)}if(C.uid<=0||C.uid>=Math.pow(2,32))throw new se($.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:S,url:f,req:w,uid:C.uid,elapse:Date.now()-S}}catch(C){throw C}}(u,t,r,i),closeFn:u=>u.code===$.OPERATION_ABORTED||u.code===$.UNEXPECTED_RESPONSE&&!u.data.retry})}catch(d){throw d}}async function fve(t,r,i){const s=W("CDS_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=s.map(g=>function(v,_,S,w){const C=jt(),M={flag:64,cipher_method:0,features:hc(hc(hc(hc(hc({install_id:YA(),device:C.name,system:C.os,system_general:navigator.userAgent,vendor:_.appId,version:Ja,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:ive.WEB_RTC,browser_name:C.name,browser_version:C.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),C.os&&{os_name:C.os}),C.osVersion&&{os_version:C.osVersion}),{},{detail:""})};return go(()=>So(v,{data:M,timeout:1e3,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==$.OPERATION_ABORTED,w)}(g,t,r,i));let d=null,u=null,f={};try{d=await Xp(c)}catch(g){if(g.code===$.OPERATION_ABORTED)throw g;u=g}if(c.forEach(g=>g.cancel()),We.reportApiInvoke(t.sid,{name:yn.REQUEST_CONFIG_DISTRIBUTE,options:{error:u,res:d}}).onSuccess(),d&&d.test_tags)try{f=function(g){if(!g.test_tags)return{};const v=g.test_tags,_=Object.keys(v),S={};return _.forEach(w=>{var C;const M=mi(C=w.slice(4)).call(C),I=JSON.parse(v[w]),k=I[1];S[M]={tag:I[0]||"",value:k}}),S}(d)}catch{}return f}async function h8(t,r){const i=W("WEBCS_DOMAIN").concat(W("WEBCS_DOMAIN_BACKUP_LIST")).map(s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:Qg(),serviceIds:[Wn.CHOOSE_SERVER,Wn.CLOUD_PROXY_FALLBACK]}));try{return await l8({referenceList:i,asyncMapHandler:c=>async function(d,u,f){let g,{url:v,areaCode:_,serviceIds:S}=d;const w=Date.now(),[C,M]=ZN(u,_,S);let I=Nn.networkState;try{I&&Nn.networkState===vi.OFFLINE&&Nn.onlineWaiter&&await Ie.race([Nn.onlineWaiter,dr(Bn.maxRetryTimeout)]),I=Nn.networkState;const{data:k,headers:G}=await So(v,{data:C,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=G.http3==="1"?1:-1,(ne=>{const Z=[];if(ne.response_body.forEach(ie=>{const ge=ie.buffer.code;if(ie.uri===23&&ge===0&&!ie.buffer.edges_services)if(ie.buffer.flag===4194310)ie.buffer.edges_services=[];else{const Ee={error:new se($.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:W("NO_EDGES_RETRY"),csIp:ne.detail[502]}),flag:ie.buffer.flag};Z.push(Ee)}if(ge!==0){const Ee=zp(ge),Me={error:new se($.CAN_NOT_GET_GATEWAY_SERVER,Ee.desc,{desc:Ee.desc,retry:Ee.retry,csIp:ne.detail[502]}),flag:ie.buffer.flag};ie.buffer.flag===4194310?R.warning(Me.error.toString()):Z.push(Me)}}),Z.length)throw new se($.CAN_NOT_GET_GATEWAY_SERVER,Z.map(ie=>"flag: ".concat(ie.flag,", message: ").concat(ie.error.message)).join(" | "),{retry:!!Z.find(ie=>ie.error.data.retry),csIp:ne.detail[502],desc:[...new Set(Z.map(ie=>{var ge;return ie==null||(ge=ie.error)===null||ge===void 0||(ge=ge.data)===null||ge===void 0?void 0:ge.desc}).filter(ie=>!!ie))]})})(k);const X=zg(k,Wn.CHOOSE_SERVER),te=zg(k,Wn.CLOUD_PROXY_FALLBACK);return QN(X),{gatewayInfo:UN(X,v),proxyInfo:te,opid:M,requestTime:w,url:v,isHttp3:g,elapse:Date.now()-w}}catch(k){throw k}}(c,t,r),closeFn:c=>c.code===$.OPERATION_ABORTED||c.code===$.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(s){throw s}}async function p8(t,r,i,s){const c=W("PROXY_SERVER_TYPE3"),d=(C,M,I)=>{let k=I||c;return Array.isArray(k)&&(k=M%2==0&&c[1]||c[0]),"https://".concat(k,"/ap/?url=").concat(C)};let u=null;const f=[],g=async()=>{const C=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map((k,G)=>{let K;return K=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(k,"/api/v2/transpond/webrtc?v=2"),G,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):d("".concat(k,"/api/v2/transpond/webrtc?v=2"),G),{url:K,areaCode:Qg(),serviceIds:[Wn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Wn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Wn.CLOUD_PROXY:Wn.CLOUD_PROXY_FALLBACK]}}),M=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(k=>k.url)}),I=await Zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:k=>(R.debug("[".concat(t.clientId,"] Connect to choose_server:"),k.url),o8(k,t,r,i)),allFailedhandler:k=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},M),k[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},M),I},v=async()=>{if(await dr(1e3),u!==null)return u;const C=W("WEBCS_DOMAIN_BACKUP_LIST").map((k,G)=>{let K;return K=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(k,"/api/v2/transpond/webrtc?v=2"),G,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):d("".concat(k,"/api/v2/transpond/webrtc?v=2"),G),{url:K,areaCode:Qg(),serviceIds:[Wn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Wn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Wn.CLOUD_PROXY:Wn.CLOUD_PROXY_FALLBACK]}}),M=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(k=>k.url)}),I=await Zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:k=>(R.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),k.url),o8(k,t,r,i)),allFailedhandler:k=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},M),k[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},M),I};let _,S,w;try{({gatewayInfo:_,proxyInfo:S,url:w}=await Xp([g(),v()]))}catch(C){throw C[0]}if(f.length&&f.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),!_||!S)throw new se($.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=w,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&w){const C=/^https?:\/\/(.+?)(\/.*)?$/.exec(w)[1];xe(c).call(c,C)&&(t.proxyServer=C,R.setProxyServer(C),We.setProxyServer(C))}return u={gatewayInfo:_,proxyInfo:await M6(S,_.uid)},u}async function mve(t,r,i){const s=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=s.map(d=>function(u,f,g,v){const _={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:Ja,cname:f.cname,uid:f.uid.toString(),requestId:JN,seq:JN};JN+=1;const S={service_name:"tele_channel",json_body:JSON.stringify(_)};return go(async()=>{const w=await So(u,{data:S,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(w.code!==0){const M=new se($.UNEXPECTED_RESPONSE,"cross channel ap error, code"+w.code,{retry:!0});throw R.error(M.toString()),M}const C=JSON.parse(w.json_body);if(C.code!==200){const M=new se($.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw R.error(M.toString()),M}if(!C.servers||C.servers.length===0){const M=new se($.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(M.toString()),M}return{vid:C.vid,workerToken:C.workerToken,addressList:(W("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(M=>"wss://".concat(M.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(M.wss))}},void 0,w=>!!(w.code!==$.OPERATION_ABORTED&&w.code!==$.UNEXPECTED_RESPONSE||w.data&&w.data.retry),v)}(d,t,r,i));try{const d=await Xp(c);return c.forEach(u=>u.cancel()),d}catch(d){throw d[0]}}async function gve(t,r,i){let s=null;const c=[],d=async u=>{const f=W(u?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return u&&(await dr(1e3),s!==null)?s:await Zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:g=>(R.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(u?"backup":""," choose_server:"),g),function(v,_,S,w){const[C]=uve(_,[Wn.CHOOSE_SERVER]);let M=Nn.networkState;return go(async()=>{M&&Nn.networkState===vi.OFFLINE&&Nn.onlineWaiter&&await Ie.race([Nn.onlineWaiter,dr(w&&w.maxRetryTimeout||Bn.maxRetryTimeout)]),M=Nn.networkState;const I=await So(v,{data:C,cancelToken:S,headers:{"Content-Type":"multipart/form-data;"}},!0);return dve(I,v)},()=>!1,I=>I.code!==$.OPERATION_ABORTED&&(I.code===$.UPDATE_TICKET_FAILED?I.data.retry:(R.warning("[".concat(_.clientId,"] update ticket network error, retry"),I),!0)),w)}(g,t,r,i)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return s=await Xp([d(!1),d(!0)]),c.length&&c.forEach(u=>u.cancel&&typeof u.cancel=="function"&&u.cancel()),s}catch(u){throw u[0]}}function f8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function eO(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?f8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):f8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class vve extends Sn{get isSuccess(){return!!this.configs}constructor(r,i){super(),j(this,"configs",void 0),j(this,"store",void 0),j(this,"joinInfo",void 0),j(this,"cancelToken",void 0),j(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),j(this,"interval",void 0),j(this,"mutex",void 0),j(this,"mutableParamsRead",!1),j(this,"configCache",{}),j(this,"limit_bitrate",void 0),this.mutex=new br("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),W("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},W("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,We.reportApiInvoke(null,{options:void 0,name:yn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:rn.TRACER}).onSuccess(JSON.stringify(Ta))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await fve(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(r));const s=function(c){var d;const u=iu(d=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(d);for(let v=0;v<u.length;v++)for(let _=u.length-1;_>v;_--){const S=u[_],w=c[S].value;if(typeof w.__priority=="number"){const C=w.__priority,M=u[_-1],I=c[M].value;if(typeof I.__priority=="number"){if(!(C>I.__priority))continue;{const k=S;u[_]=u[_-1],u[_-1]=k}}else{const k=S;u[_]=u[_-1],u[_-1]=k}}}const f=Date.now(),g={};return u.forEach(v=>{const _=c[v].value.__expires;_&&_<=f||(g[v]=c[v])}),g}(r);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){const c=new se($.NETWORK_RESPONSE_ERROR,s);R.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){A6(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(_o.UPDATE_BITRATE_LIMIT,r):this.emit(_o.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&eO({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},s=Object.keys(r),c=[];s.forEach(d=>{const u=r[d].value;i[d]=u;const f=u.__id;if(f&&this.configCache[d]&&this.configCache[d].__id===f)return;const g=u.__type,v=r[d].value,_=r[d].tag;let S=0;g?g===K5.REALTIME&&(S=1):Object.keys(v).some(w=>Object.prototype.hasOwnProperty.call(QA,w)||!CN()&&Object.prototype.hasOwnProperty.call(fE,w)?(S=1,!0):void 0),c.push({tag:_,isApplied:S,feature:d,params:JSON.stringify(u)})}),c.forEach(d=>{let{tag:u,feature:f,params:g,isApplied:v}=d;this.store.sessionId&&We.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:u,feature:f,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){R.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const d={};return Object.keys(c).forEach(u=>{const f=c[u].value,g=f.__expires,v=f.__type;Object.keys(f).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(d,_)||(d[_]=eO(eO({value:f[_]},g&&{expires:g}),v&&{type:v}))})}),d}(r);try{var s;const c=(s=i.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete i.LIMIT_BITRATE,c&&A6(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(f){try{const g=Date.now();Object.keys(f).forEach(v=>{const{value:_,type:S,expires:w}=f[v];w&&w<=g||((S===K5.REALTIME||Object.prototype.hasOwnProperty.call(QA,v))&&(Ta[v]=_,Yt[v]=_,R.debug("Update realtime parameters from config distribute",v,_)),S||CN()||!Object.prototype.hasOwnProperty.call(fE,v)||(Ta[v]=_,Yt[v]=_,R.debug("Update gateway parameters from config distribute",v,_)))})}catch(g){R.error("Error update config immediately: ".concat(f),g.message)}}(i);const d=JSON.stringify(i),u=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",u),R.debug("Caching global parameters ".concat(d))}catch(c){R.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(s=>{switch(s){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(Yt,s)){const{value:d,expires:u}=r[s];if(u&&u<=i)return;FA(Yt[s],d)||(Ta[s]=d,Yt[s]=d,this.emit(_o.UPDATE_CLIENT_ROLE_OPTIONS,d),R.debug("Updating client role options: ".concat(JSON.stringify(d))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(Yt,s)){var c;const{value:d,expires:u}=r[s];if(u&&u<=i)return;typeof d=="number"&&xe(c=[0,1,4,5,6,7,8,9]).call(c,d)&&(Ta[s]={value:d},Yt[s]=d,this.emit(_o.UPDATE_REMOTE_VIDEO_STREAM_TYPE,d),R.debug("Updating client remote stream type: ".concat(JSON.stringify(d))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(Yt,s)){const{value:d,expires:u}=r[s];if(u&&u<=i)return;FA(Yt[s],d)||(Ta[s]=d,Yt[s]=d,this.emit(_o.FALLBACK_TO_HLS,d),R.debug("Updating enable force hls: ".concat(JSON.stringify(d))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(Yt,s)){const{value:d,expires:u}=r[s];if(u&&u<=i)return;FA(Yt[s],d)||(Ta[s]=d,Yt[s]=d,this.emit(_o.UPDATE_VOS_CONFIGURE,d),R.debug("Updating vos configure: ".concat(JSON.stringify(d))))}}})}catch(i){R.error("Error handling global parameter config:",i.message)}}}class yve extends Sn{constructor(){super(...arguments),j(this,"resultStorage",new Map)}setLocalAudioStats(r,i,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(s,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(s,i))}setLocalVideoStats(r,i,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(s,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(s,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(s)),!i.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(s))}setRemoteAudioStats(r,i){const s=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const s=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(i))}record(r,i,s){if(W("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(s);const d=r==="VIDEO_ENCODE_FAILED"?W("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var u;const f=xe(u=c.result).call(u,!0);c.isPrevNormal&&!f&&this.emit("exception",tO[r],r,i),!c.isPrevNormal&&f&&this.emit("exception",tO[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=f,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof tr&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let s=null;i._encoderConfig&&i._encoderConfig.frameRate&&(s=Di(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var i;return!(!r.codecType||xe(i=W("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(i,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof tr&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const tO={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},zr=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(t,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function m8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Du(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?m8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class ev{constructor(r){j(this,"store",void 0),j(this,"onStatsException",void 0),j(this,"onUploadPublishDuration",void 0),j(this,"onStatsChanged",void 0),j(this,"onVideoCodecChanged",void 0),j(this,"localStats",new Map),j(this,"remoteStats",new Map),j(this,"updateStatsInterval",void 0),j(this,"trafficStats",void 0),j(this,"trafficStatsPeerList",[]),j(this,"uplinkStats",void 0),j(this,"exceptionMonitor",void 0),j(this,"p2pChannel",void 0),j(this,"scalabilityMode",hE.L1T1),j(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new yve,this.exceptionMonitor.on("exception",(i,s,c)=>{this.onStatsException&&this.onStatsException(i,s,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Te.LocalAudioTrack)||Du({},iN)}getLocalVideoTrackStats(){return this.localStats.get(Te.LocalVideoTrack)||Du({},aN)}getRemoteAudioTrackStats(r){const i=(d,u)=>{if(!this.trafficStats)return u;const f=this.trafficStats.peer_delay.find(g=>g.peer_uid===d);return f&&(u.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),u},s={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(s[r]=i(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[u,{audioStats:f}]=d;f&&(s[u]=i(u,f))});return s}getRemoteNetworkQualityStats(r){const i={};if(r){var s;const c=(s=this.remoteStats.get(r))===null||s===void 0?void 0:s.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:u}]=c;u&&(i[d]=u)});return i}getNetworkQuality(){let r=0,i=0;return this.trafficStats&&(r=WE(this.trafficStats.B_unq),i=WE(this.trafficStats.B_dnq)),{uplinkNetworkQuality:r,downlinkNetworkQuality:i}}getRemoteVideoTrackStats(r){const i=(d,u)=>{if(!this.trafficStats)return u;const f=this.trafficStats.peer_delay.find(g=>g.peer_uid===d);return f&&(u.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),u},s={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(s[r]=i(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[u,{videoStats:f}]=d;f&&(s[u]=i(u,f))});return s}getRTCStats(){let r=0,i=0,s=0,c=0;const d=this.localStats.get(Te.LocalAudioTrack);d&&(r+=d.sendBytes,i+=d.sendBitrate);const u=this.localStats.get(Te.LocalVideoTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const f=this.localStats.get(Te.LocalVideoLowTrack);f&&(r+=f.sendBytes,i+=f.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:_,videoStats:S}=v;_&&(s+=_.receiveBytes,c+=_.receiveBitrate),S&&(s+=S.receiveBytes,c+=S.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:i,SendBytes:r,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var s;const c=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(i.peer_uid),d=c!=null&&c.videoSSRC?zr.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,u=c!=null&&c.audioSSRC?zr.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,d>u?d:u),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,s){if(!r)return!1;const c=!!s&&i.framesDecodeFreezeTime>s.framesDecodeFreezeTime,d=!s||i.framesDecodeCount>s.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[s,c]=i;switch(s){case Te.LocalVideoTrack:case Te.LocalVideoLowTrack:{const f=c,g=Du({},aN),v=r.getStats(),_=r.getLocalMedia(s);if(v){const S=v.videoSend.find(w=>w.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(S){const w=r.getLocalVideoSize(),C=r.getEncoderConfig(Te.LocalVideoTrack);var d;(S.codec==="H264"||S.codec==="H265"||S.codec==="VP8"||S.codec==="VP9"||S.codec==="AV1X"||S.codec==="AV1")&&(g.codecType=S.codec,(f==null?void 0:f.codecType)!==S.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,S.codec.toLocaleLowerCase()))),g.sendBytes=S.bytes,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0,S.inputFrame?(g.captureFrameRate=S.inputFrame.frameRate,g.captureResolutionHeight=S.inputFrame.height,g.captureResolutionWidth=S.inputFrame.width):w&&(g.captureResolutionWidth=w.width,g.captureResolutionHeight=w.height),S.sentFrame?(g.sendFrameRate=S.sentFrame.frameRate,g.sendResolutionHeight=S.sentFrame.height,g.sendResolutionWidth=S.sentFrame.width):w&&(g.sendResolutionWidth=w.width,g.sendResolutionHeight=w.height),S.avgEncodeMs&&(g.encodeDelay=S.avgEncodeMs),C&&C.bitrateMax?g.targetSendBitrate=1e3*C.bitrateMax:S.targetBitrate&&(g.targetSendBitrate=S.targetBitrate),g.sendPackets=S.packets,g.sendPacketsLost=S.packetsLost,g.sendJitterMs=S.jitterMs,g.sendRttMs=S.rttMs,g.totalDuration=f?f.totalDuration+1:1,g.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(g.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(s,g),((f==null?void 0:f.sendResolutionWidth)!==g.sendResolutionWidth||(f==null?void 0:f.sendResolutionHeight)!==g.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,g);break}case Te.LocalAudioTrack:{const f=c,g=Du({},iN),v=r.getStats(),_=r.getLocalMedia(s);if(v){const S=v.audioSend.find(w=>w.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(g.codecType=S.codec),S.inputLevel)g.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const w=r.getLocalAudioVolume();w&&(g.sendVolumeLevel=Math.round(32767*w))}g.sendBytes=S.bytes,g.sendPackets=S.packets,g.sendPacketsLost=S.packetsLost,g.sendJitterMs=S.jitterMs,g.sendRttMs=S.rttMs,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Te.LocalAudioTrack,g),g&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,g);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var s,c;let[d,{videoStats:u,audioStats:f,videoPcStats:g}]=i;const v=f,_=u,S=g,w=Du({},o3),C=Du({},c3),M=Du({},rge),{audioTrack:I,videoTrack:k,audioSSRC:G,videoSSRC:K}=r.getRemoteMedia(d);let X;X=this.store.useP2P?r.getStats(!0):r.getStats();const te=(s=X)===null||s===void 0?void 0:s.audioRecv.find(ge=>ge.ssrc===G),ne=(c=X)===null||c===void 0?void 0:c.videoRecv.find(ge=>ge.ssrc===K),Z=this.trafficStats&&this.trafficStats.peer_delay.find(ge=>ge.peer_uid===d);if(te&&(te.codec!=="opus"&&te.codec!=="aac"&&te.codec!=="PCMU"&&te.codec!=="PCMA"&&te.codec!=="G722"||(w.codecType=te.codec),te.outputLevel?w.receiveLevel=Math.round(32767*te.outputLevel):I&&(w.receiveLevel=Math.round(32767*I.getVolumeLevel())),w.receiveBytes=te.bytes,w.receivePackets=te.packets,w.receivePacketsLost=te.packetsLost,w.receivePacketsDiscarded=te.packetsDiscarded,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost),w.receiveBitrate=v?8*Math.max(0,w.receiveBytes-v.receiveBytes):0,w.totalDuration=v?v.totalDuration+1:1,w.totalFreezeTime=v?v.totalFreezeTime:0,w.freezeRate=w.totalFreezeTime/w.totalDuration,w.receiveDelay=te.jitterBufferMs,w.totalDuration>10&&ev.isRemoteAudioFreeze(I)&&(w.totalFreezeTime+=1)),ne){var ie;ne.codec!=="H264"&&ne.codec!=="H265"&&ne.codec!=="VP8"&&ne.codec!=="VP9"&&ne.codec!=="AV1X"&&ne.codec!=="AV1"||(C.codecType=ne.codec),C.receiveBytes=ne.bytes,C.receiveBitrate=_?8*Math.max(0,C.receiveBytes-_.receiveBytes):0,C.decodeFrameRate=ne.decodeFrameRate<0?0:ne.decodeFrameRate,C.renderFrameRate=ne.decodeFrameRate<0?0:ne.decodeFrameRate,ne.outputFrame&&(C.renderFrameRate=ne.outputFrame.frameRate),ne.receivedFrame?(C.receiveFrameRate=ne.receivedFrame.frameRate,C.receiveResolutionHeight=ne.receivedFrame.height,C.receiveResolutionWidth=ne.receivedFrame.width):k&&(C.receiveResolutionHeight=k._videoHeight||0,C.receiveResolutionWidth=k._videoWidth||0),ne.framesRateFirefox!==void 0&&(C.receiveFrameRate=Math.round(ne.framesRateFirefox)),C.receivePackets=ne.packets,C.receivePacketsLost=ne.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost);const ge=_?_.totalFreezeTime:0,Ee=_?_.totalDuration:0;C.totalDuration=_?_.totalDuration+1:1,C.totalFreezeTime=(ie=ne.totalFreezesDuration)!==null&&ie!==void 0?ie:ge||0,C.receiveDelay=ne.jitterBufferMs||0;const Me=!!K&&r.getRemoteVideoIsReady(K);ne.totalFreezesDuration===void 0&&k&&Me&&ev.isRemoteVideoFreeze(k,ne,S)&&(C.totalFreezeTime+=1),C.freezeRate=Math.max(0,Math.min((C.totalFreezeTime-ge)/(C.totalDuration-Ee),1))}Z&&(w.end2EndDelay=Z.B_ad,C.end2EndDelay=Z.B_vd,w.transportDelay=Z.B_ed,C.transportDelay=Z.B_ed,w.currentPacketLossRate=Z.B_ealr4/100,C.currentPacketLossRate=Z.B_evlr4/100,M.uplinkNetworkQuality=Z.B_punq?Z.B_punq:0,M.downlinkNetworkQuality=Z.B_pdnq?Z.B_pdnq:0),this.remoteStats.set(d,{audioStats:w,videoStats:C,videoPcStats:ne,networkStats:M}),I&&this.exceptionMonitor.setRemoteAudioStats(I,w),k&&this.exceptionMonitor.setRemoteVideoStats(k,C)})}}class g8{constructor(){j(this,"destChannelMediaInfos",new Map),j(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){C6(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){C6(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){LE(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function v8(t){if(!(t instanceof g8))return new se($.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),i=t.getDestChannelMediaInfo();if(!r)return new se($.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new se($.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Zl{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){j(this,"uid",void 0),j(this,"_uintid",void 0),j(this,"_trust_in_room_",!0),j(this,"_trust_audio_enabled_state_",!0),j(this,"_trust_video_enabled_state_",!0),j(this,"_trust_audio_mute_state_",!0),j(this,"_trust_video_mute_state_",!0),j(this,"_audio_muted_",!1),j(this,"_video_muted_",!1),j(this,"_audio_enabled_",!0),j(this,"_video_enabled_",!0),j(this,"_audio_added_",!1),j(this,"_video_added_",!1),j(this,"_is_pre_created",!1),j(this,"_video_pre_subscribed",!1),j(this,"_audio_pre_subscribed",!1),j(this,"_trust_video_stream_added_state_",!0),j(this,"_trust_audio_stream_added_state_",!0),j(this,"_audioTrack",void 0),j(this,"_videoTrack",void 0),j(this,"_dataChannels",[]),j(this,"_audioSSRC",void 0),j(this,"_videoSSRC",void 0),j(this,"_audioOrtc",void 0),j(this,"_videoOrtc",void 0),j(this,"_cname",void 0),j(this,"_rtxSsrcId",void 0),j(this,"_videoMid",void 0),j(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function y8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function nO(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?y8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):y8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const _ve=t=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(t?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),QE="9",rO=2e4,ZE=4e4;let _8=class{get localCapabilities(){return mn(this._localCapabilities)}get rtpCapabilities(){return mn(this._rtpCapabilities)}get candidates(){return mn(this._candidates)}get iceParameters(){return mn(this._iceParameters)}get dtlsParameters(){return mn(this._dtlsParameters)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3];j(this,"sessionDesc",void 0),j(this,"_localCapabilities",void 0),j(this,"_rtpCapabilities",void 0),j(this,"_candidates",void 0),j(this,"_originCandidates",void 0),j(this,"_iceParameters",void 0),j(this,"_isUseExtmapAllowMixed",void 0),j(this,"_isUseLocalCodecs",void 0),j(this,"_isUseDataChannel",void 0),j(this,"_dtlsParameters",void 0),j(this,"setup",void 0),j(this,"currentMidIndex",void 0),j(this,"cname",void 0),j(this,"useLocalCodecsMids",[]),j(this,"preloadSsrcs",[]),j(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=r,this._isUseLocalCodecs=i,this._isUseDataChannel=s,t=mn(t);const{iceParameters:c,dtlsParameters:d,candidates:u,rtpCapabilities:f,setup:g,localCapabilities:v,cname:_}=t;this._rtpCapabilities=f,this._candidates=u,this._originCandidates=mn(u),this._iceParameters=c,this._dtlsParameters=d,this._localCapabilities=v,this.setup=g,this.cname=_,[this.sessionDesc]=this.updateRemoteRTPCapabilities(f),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(t){return t.length===this.preloadSsrcs.length&&t.every(r=>{var i;return xe(i=this.preloadSsrcs).call(i,r)})}preloadRemoteMedia(t){let r=0;const i=[],s=[];for(;t>0;){const c=[nO({ssrcId:ZE+r},W("USE_SUB_RTX")?{rtx:ZE+r+1}:{})],d="".concat(ZE+r,"_").concat(rO+r),{ssrcs:u,ssrcGroups:f}=qg(c,this.cname,W("SYNC_GROUP")?d:void 0),g=this.preCreateOrRecycleSendMedia("video",u,f,void 0),v=[{ssrcId:rO+r}],_="".concat(ZE+r,"_").concat(rO+r),{ssrcs:S,ssrcGroups:w}=qg(v,this.cname,W("SYNC_GROUP")?_:void 0),C=this.preCreateOrRecycleSendMedia("audio",S,w,void 0);t--,r+=2,i.push(g,C),s.push(u[0].ssrcId,S[0].ssrcId)}return this.useLocalCodecsMids.push(...i),this.preloadSsrcs=s,{mids:i,preSSRCs:s,isAvailable:!0}}preCreateOrRecycleSendMedia(t,r,i,s){const c=this.rtpCapabilities.send.videoCodecs,d=this._isUseLocalCodecs||c.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",r[0].ssrcId);const u=t===Fe.VIDEO?d.videoCodecs:d.audioCodecs,f=t===Fe.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let v={media:{mediaType:t,port:QE,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};return v=this.mungSendMediaDesc(v,s),this.sessionDesc.mediaDescriptions.push(v),this.updateBundleMids(),g}toString(){return zc(this.sessionDesc)}send(t,r,i,s){const{ssrcs:c,ssrcGroups:d}=qg(r,this.cname,W("SYNC_GROUP")?i:void 0),u=this.findPreloadMediaDesc(c);if(u){if(fn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,u.attributes.mid),s&&(s.twcc||s.remb)){const f=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(u,s),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const f=this.findAvailableMediaIndex(t,c);let g;return f===-1||f===1&&(Er()||function(){const v=jt();return!(v.name!==Ft.CHROME||!v.osVersion)&&Number(v.version)<=90}()||mo(143)||$l(143)||W("RESERVE_MID_1_MLINE")||W("ENABLE_ENCODED_TRANSFORM")&&$c())||f===0&&!function(v){const _=jt();return!(_.name!==Ft.FIREFOX||!_.osVersion)&&Number(_.version)===v}(138)&&W("USE_SUB_RTX")||f5()?(g=this.createOrRecycleSendMedia(t,c,d,"sendonly",s),this.updateBundleMids()):(g=mn(this.sessionDesc.mediaDescriptions[f]),g.attributes.direction="sendonly",g.attributes.ssrcs=c,g.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(g,s)),fn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:r}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:r}}batchSend(t){const r=t.map(c=>{let{kind:d,ssrcMsg:u,mslabel:f}=c;return this.send(d,u,f)}),i=[];let s=!1;return r.forEach(c=>{let{mid:d,needExchangeSDP:u}=c;u&&(s=!0),i.push(d)}),{mids:i,needExchangeSDP:s}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.mid==="0"||fn()||f5()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>xe(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>xe(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,r,i,s){t.forEach((c,d)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",r,i,s[d])}),this.updateBundleMids()}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const r=this.sessionDesc||yi((i=this._isUseExtmapAllowMixed,this._isUseDataChannel?_ve(i):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(i?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var i;this._rtpCapabilities=t;let s=!1;const c=this.rtpCapabilities.send,d=this.localCapabilities.send,u=this.localCapabilities.recv,f=u.videoCodecs,g=u.audioCodecs,v=u.videoExtensions,_=u.audioExtensions;for(const M of r.mediaDescriptions){var S;if(M.attributes.direction!=="sendonly"||typeof M.attributes.mid!="string"||!xe(S=this.useLocalCodecsMids).call(S,M.attributes.mid)){if(s=!0,M.attributes.iceUfrag=this._iceParameters.iceUfrag,M.attributes.icePwd=this._iceParameters.icePwd,M.attributes.fingerprints=this._dtlsParameters.fingerprints,M.attributes.candidates=this._candidates,M.attributes.setup=this.setup,M.media.mediaType==="application"&&(M.attributes.sctpPort="5000"),M.media.mediaType==="video")if(this._isUseLocalCodecs&&M.attributes.direction==="sendonly"){var w;M.media.fmts=f.map(k=>k.payloadType.toString(10)),M.attributes.payloads=f,M.attributes.extmaps=v;const I=M.attributes.mid;typeof I!="string"||xe(w=this.useLocalCodecsMids).call(w,I)||this.useLocalCodecsMids.push(I)}else if(c.videoCodecs.length===0){const I=d.videoCodecs.filter(k=>{var G,K;return(G=k.rtpMap)===null||G===void 0?void 0:xe(K=G.encodingName.toLowerCase()).call(K,"vp8")});I.length===0&&I.push(d.videoCodecs[0]),M.media.fmts=I.map(k=>k.payloadType.toString(10)),M.attributes.payloads=I,M.attributes.extmaps=[]}else M.media.fmts=c.videoCodecs.map(I=>I.payloadType.toString(10)),M.attributes.payloads=c.videoCodecs,M.attributes.extmaps=c.videoExtensions;if(M.media.mediaType==="audio")if(this._isUseLocalCodecs&&M.attributes.direction==="sendonly"){var C;M.media.fmts=g.map(k=>k.payloadType.toString(10)),M.attributes.payloads=g,M.attributes.extmaps=_;const I=M.attributes.mid;typeof I!="string"||xe(C=this.useLocalCodecsMids).call(C,I)||this.useLocalCodecsMids.push(I)}else if(c.audioCodecs.length===0){const I=d.audioCodecs.filter(k=>{var G,K;return(G=k.rtpMap)===null||G===void 0?void 0:xe(K=G.encodingName.toLowerCase()).call(K,"opus")})||[d.audioCodecs[0]];M.media.fmts=I.map(k=>k.payloadType.toString(10)),M.attributes.payloads=I,M.attributes.extmaps=[]}else M.media.fmts=c.audioCodecs.map(I=>I.payloadType.toString(10)),M.attributes.payloads=c.audioCodecs,M.attributes.extmaps=c.audioExtensions,Yp(M)}}return this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1,[this.sessionDesc,s]}updateCandidates(t){const r=this._originCandidates.filter(s=>s.transport==="udp"),i=[];if(r.forEach(s=>{i.push(nO(nO({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),r.length!==0){switch(t){case Sr.TCP_RELAY:this._candidates=i;break;case Sr.UDP_TCP_RELAY:case Sr.RELAY:this._candidates=[...r,...i];break;default:this._candidates=r}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(t){t=mn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}findAvailableMediaIndex(t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(fn()){if(s){const c=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return s})}createOrRecycleDataChannel(){for(const i of this.sessionDesc.mediaDescriptions)if(i.media.mediaType==="application")return{mediaDesc:i,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),r={media:{mediaType:"application",port:QE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(r),{mediaDesc:r,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,r,i,s,c,d){const u=t._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,g=Jg(u,f,this.localCapabilities.send,u===Fe.VIDEO?s:c),v=u===Fe.VIDEO?f.videoExtensions:f.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let S={media:{mediaType:u,port:QE,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};S=this.mungRecvMediaDsec(S,t,d);const w=this.findFirstClosedMedia(u);if(w){const C=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[C]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}updateRemoteDtlsParameters(t){const r=new Set(this._dtlsParameters.fingerprints.map(c=>c.fingerprint)),i=new Set(t.map(c=>c.fingerprint));let s=!1;r.size!==i.size&&(s=!0);for(const c of r)i.has(c)||(s=!0);return s}updateRemoteCodec(t,r,i){const s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").filter(S=>{var w;return xe(w=Object.keys(bu)).call(w,S)}))],c=new Set(r);if(s.every(S=>c.has(S)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const d=this._rtpCapabilities.recv.videoCodecs.filter(S=>r.some(w=>{var C;return xe(C=S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").call(C,w)}));if(d.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(r)),!1;const u=[...new Set(d.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||""))];let f;if(R.debug("updateRemoteCodec, from ".concat(s," to ").concat(u)),t.length===0)f=this.sessionDesc.mediaDescriptions.filter(S=>S.media.mediaType==="video"&&S.attributes.direction==="recvonly");else if(f=this.sessionDesc.mediaDescriptions.filter(S=>S.attributes.mid&&S.media.mediaType==="video"&&xe(t).call(t,S.attributes.mid)&&S.attributes.direction==="recvonly"),f.length!==t.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(r)),!1;if(W("USE_PUB_RTX")||W("USE_SUB_RTX")){const S=Ql(d,this.rtpCapabilities.recv.videoCodecs);d.push(...S)}this._rtpCapabilities.recv.videoCodecs=d;const g=this.localCapabilities.send,v=this.rtpCapabilities.recv,_=Jg(Fe.VIDEO,v,g,i);return f.forEach(S=>{const w=_.map(C=>C.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(S.attributes.mid,", from"),S.attributes.payloads,"to",_),S.attributes.payloads=_,S.media.fmts=w}),R.debug("updateRemoteCodec success, mids: ".concat(t,", codecs: ").concat(r,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(t,r,i,s,c){const d=this.rtpCapabilities.send.videoCodecs,u=this._isUseLocalCodecs||d.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,f=t===Fe.VIDEO?u.videoCodecs:u.audioCodecs,g=t===Fe.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const v="".concat(this.currentMidIndex);let _={media:{mediaType:t,port:QE,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};_=this.mungSendMediaDesc(_,c);const S=this.findFirstClosedMedia(t);if(S){const w=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[w]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,r,i){const s=mn(t);return BN(s),Pu(s,r),WN(s,r),K6(s),HE(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){const i=mn(t);return i.attributes&&i.attributes.payloads&&Array.isArray(i.attributes.payloads)&&i.attributes.payloads.length>0&&i.attributes.payloads.forEach(s=>{s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W("ENABLE_DOWN_SPS_PPS")&&(s.fmtp&&s.fmtp.parameters||(s.fmtp={parameters:{}}),s.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),HE(i,r,this.localCapabilities.recv),Yp(i),i}updateRecvMedia(t,r){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>fn()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var r;return(r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs}};function E8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Xc(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?E8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):E8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}var Jp=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(Jp||{});const eb=new Map;function b8(t,r,i,s){let{scale:c}=t;if(c===0&&s===Jp.UP||c>=r.length-1&&s===Jp.DOWN)return t;let d=Xc(Xc({},t),{},{scale:s===Jp.DOWN?++c:--c});switch(i){case"maintain-framerate":d=Xc(Xc({},d),r[c].motion);break;case"maintain-resolution":d=Xc(Xc({},d),r[c].detail);break;case"balanced":d=Xc(Xc({},d),r[c].balanced)}return d}function S8(t,r){if(r){const i={overUse:0,underUse:0,adaptationList:w8(r)};eb.set(t,i)}else eb.delete(t)}function w8(t){const r=Xc({},t),{bitrateMax:i,frameRate:s,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:u,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:S,BWE_SCALE_DOWN_THRESHOLD:w,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:M,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:k,BALANCE_RESOLUTION_FACTOR:G,MOTION_RESOLUTION_FACTOR:K,MOTION_BITRATE_FACTOR:X,DETAIL_FRAMERATE_FACTOR:te,DETAIL_BITRATE_FACTOR:ne}=XA,Z=Math.min(r.frameRate,f),ie=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(w,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(C,1)*Z),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:d}}];for(let ge=1;ge<=g;ge++){const Ee={bwe_up:Math.round(Math.pow(S,ge)*i),bwe_down:Math.round(Math.pow(w,ge+1)*i),fps_up:Math.round(Math.pow(M,ge)*Z),fps_down:Math.round(Math.pow(C,ge+1)*Z)},Me={scaleResolutionDownBy:c/Math.pow(G,ge),frameRate:Math.max(Math.round(Math.pow(k,ge)*s),u),bitrateMax:Math.max(Math.round(Math.pow(I,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(I,ge)*d),v)},at={scaleResolutionDownBy:c/Math.pow(K,ge),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(X,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(X,ge)*d),v)},tt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(te,ge)*s),u),bitrateMax:Math.max(Math.round(Math.pow(ne,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(ne,ge)*d),v)};ie.push({scale:ge,threshold:Ee,balanced:Me,motion:at,detail:tt})}return ie}function Eve(t,r,i,s,c,d){const u=eb.get(t)||{overUse:0,underUse:0,adaptationList:w8(c)},{adaptationList:f}=u;eb.set(t,u);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:v}=XA,{scale:_}=s;let S,w;return typeof r=="number"&&r>0&&function(C,M,I,k){if(M>=I.length)return!1;let{threshold:{fps_down:G}}=I[M];return W("FORCE_AG_HIGH_FRAMERATE")&&k==="maintain-framerate"&&(G=I[0].threshold.fps_down),C<G}(r,_,f,d)&&(u.overUse++,w=Np.CPU,u.overUse>g)||typeof i=="number"&&i>0&&function(C,M,I){if(M>=I.length)return!1;const{threshold:{bwe_down:k}}=I[M];return C<k}(i,_,f)&&(u.overUse++,w=Np.BANDWIDTH,u.overUse>g)?(u.overUse=0,u.underUse=0,S=b8(s,f,d,Jp.DOWN),[S,w]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(C,M,I,k){if(M===0)return;let{threshold:{fps_up:G}}=I[M];return W("FORCE_AG_HIGH_FRAMERATE")&&k==="maintain-framerate"&&(G=I[1].threshold.fps_up),C>G}(r,_,f,d)&&function(C,M,I){if(M===0)return;const{threshold:{bwe_up:k}}=I[M];return C>k}(i,_,f)&&(u.underUse++,u.underUse>v&&(u.overUse=0,u.underUse=0,S=b8(s,f,d,Jp.UP),S.scale===0&&(w=Np.NONE))),[S,w])}function x8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function iO(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?x8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):x8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function T8(t){var r;return!!W("ENABLE_AG_ADAPTATION")&&!!(t instanceof xE||xe(r=t._hints).call(r,Ht.CUSTOM_TRACK))&&(!!W("FORCE_SUPPORT_AG_ADAPTATION")||!!(h5(14,0,!1)&&p5(17,4,!0)||u5(14)&&OA(17,4,!0)))}const tb=new Map;function C8(t,r,i,s,c,d){if(Qp(t,i),c(r),s!=="balanced"&&s!=="maintain-framerate"&&s!=="maintain-resolution")return;let u=-1;S8(t,r);const f=window.setInterval(()=>{const v=tb.get(t);if(!W("ENABLE_AG_ADAPTATION")||!v)return Qp(t,i),void c(r);const _=d();if(_.sendPackets>0&&_.OutgoingAvailableBandwidth>0){if(u===-1)return void(u=Date.now());if(Date.now()-u<1e3)return;const S=_.sendFrameRate,w=_.OutgoingAvailableBandwidth,[C,M]=Eve(t,S,w,v.adaptationConfig,r,s);M&&(i.qualityLimitationReason=M),C&&v.adaptationConfig.scale!==C.scale&&(R.debug("[".concat(t,"] applyAdaptation: ").concat(i.qualityLimitationReason,`
           sendFps `).concat(S,", bwe ").concat(w,", switch from ").concat(v.adaptationConfig.scale," to ").concat(C.scale," ")),v.adaptationConfig=iO(iO({},v.adaptationConfig),C),c(C))}},W("CHECK_LOCAL_STATS_INTERVAL")),g=iO({},r);tb.set(t,{timer:f,adaptationConfig:g,originConfig:r,adaptationFunc:c}),R.debug("[".concat(t,"] start adaptation, originConfig: ").concat(JSON.stringify(r),", degradationPreference: ").concat(s))}function Qp(t,r){const i=tb.get(t);if(i){const{timer:s}=i;window.clearTimeout(s),tb.delete(t)}r.qualityLimitationReason=Np.NONE,S8(t)}function bve(t,r){var i;let s;switch(r){case Te.LocalAudioTrack:s=qt.Audio;break;case Te.LocalVideoTrack:s=xe(i=t._hints).call(i,Ht.SCREEN_TRACK)?qt.Screen:qt.High;break;case Te.LocalVideoLowTrack:s=qt.Low}return s}function aO(t){const r=wt();if(t.some(i=>i._bypassWebAudio))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function sO(t,r){aO(t);const i=new tr;return t.forEach(s=>i.addAudioTrack(s)),i}const Sve=!wt().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&ic();function tv(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.useDcSignal)return i={spec:r,store:t},bo("DataChannelConnection").create(i);var i;return Sve?function(c){return bo("PlanBConnection").create(c)}({spec:r,store:t}):new Pa(r,t)}function oO(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function cO(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(fu(t.turnServer.servers))return!1;if(W("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Dt;function R8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function wo(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?R8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):R8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let Pa=(Dt=class eh extends VE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return xe(i=Object.keys(bu)).call(i,r)}))]}constructor(r,i){super(r,i),j(this,"id",Kt(5,"connection-")),j(this,"store",void 0),j(this,"peerConnection",void 0),j(this,"forceTurn",!1),j(this,"remoteSDP",void 0),j(this,"initialOffer",void 0),j(this,"transportEventReceiver",void 0),j(this,"statsFilter",void 0),j(this,"extension",{useXR:W("USE_XR")}),j(this,"localCapabilities",void 0),j(this,"remoteCodecs",void 0),j(this,"localCandidateCount",0),j(this,"allCandidatesReceived",!1),j(this,"isPreallocation",!1),j(this,"isPreRender",!1),j(this,"preMediaMap",new Map),j(this,"dataStreamChannelMap",new Map),j(this,"establishPromise",void 0),j(this,"recoveredDataChannelIds",[]),j(this,"currentDataChannelId",1),j(this,"supportAV1RtpSpec",!1),j(this,"mutex",void 0),j(this,"qualityLimitationReason",Np.NONE),j(this,"isFirstConnected",!1),this.store=i,this.forceTurn=cO(r),this.mutex=new br("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(eh.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=pE(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,fn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=dc(i.sdp),c=await $N({filterRTX:!W("USE_PUB_RTX")&&!W("USE_SUB_RTX"),filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterVideoCodec:W("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:W("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:W("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Xg(c),this.initialOffer=i,W("ENABLE_SVC")&&this.store.codec=="av1"){const u=await Y6();var r;u&&(this.supportAV1RtpSpec=!0,(r=c.send)===null||r===void 0||r.videoExtensions.push(u))}let d;return i.sdp&&zE(i.sdp)&&(d=mn(c),F6(d)),wo(wo({},s),{},{rtpCapabilities:d||c,offerSDP:i.sdp})}catch(i){throw new pe($.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&zE(this.initialOffer.sdp)&&B6(r.rtpCapabilities,this.localCapabilities),this.remoteSDP=new _8(wo(wo({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!W("ENABLE_PRE_SUB_WITH_PRE_PC")||!W("PRE_USE_LOCAL_CODECS"))&&Bg(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=HN(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const d=this.peerConnection.getTransceivers()[0];if(d!=null&&d.receiver&&this.tryBindTransportEvents(d.receiver),Bg(this.store))if(r.preallocation&&W("ENABLE_PRE_SUB_WITH_PRE_PC")){const u=W("PRE_SUB_NUM"),{mids:f,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(u);await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(f,g)}else{const{preSSRCs:u=[]}=r,f=u.map(v=>v.ssrcMsg[0].ssrcId);if(u.length===0)return;const{mids:g}=this.remoteSDP.batchSend(u.map(v=>Object.assign({},v)));await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(g,f)}}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}presetMedia(r,i){r.forEach((s,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&s===d.mid&&d.receiver.track){const u=d.receiver.track;let f;u.kind==="video"&&W("ENABLE_PRE_RENDER")&&(f=new wE({trackId:"track-".concat(u.kind,"-unknown-").concat(this.store.clientId,"_").concat(Kt(5,""))},!0),f.updateVideoTrack(u),f.onFirstVideoFrameRender=()=>{var g;const v=this.preMediaMap.get(i[c]);v&&(v.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,i[c])},f.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,i[c])},f.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(i[c],{mid:s,track:u,player:f,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:s}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const u=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||u}const{preSSRCs:c=[]}=r,d=c.map(u=>u.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){const u=[],f=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[v,{mid:_,player:S,track:w}]=g;return u.push(_),f.push(v),this.preMediaMap.delete(v),S&&S.destroy(),!0}),u.length>0&&(this.remoteSDP.stopSending(u),await zi(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),We.reportApiInvoke(this.store.sessionId,{name:yn.PRELOAD_MEDIA_FAILED,options:[c,f],tag:rn.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(v=>Object.assign({},v)));await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(g,d)}}i?(await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Ai(function*(){const d=yield vt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[],f=Kg();r.forEach(k=>{const G=c.peerConnection.addTransceiver(k._mediaStreamTrack,wo({direction:"sendonly"},k.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));u.push(G),k._updateRtpTransceiver(G)}),fn()&&W("SIMULCAST")===!0&&(yield vt(c.applySimulcastForFirefox(u,r)));const g=yield vt(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),_=c.mungSendOfferSDP(g.sdp,r,v),S=yi(_),w=v.map(k=>{const G=S.mediaDescriptions.find(K=>K.attributes.mid===k);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return FN(G,W("USE_PUB_RTX"))});let C;try{C=yield w}catch(k){C=[],c.remoteSDP.receive(r,i,s,C);const G=c.remoteSDP.toString();throw yield vt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield vt(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),yield vt(c.stopSending(v,!0)),k}c.remoteSDP.receive(r,i,s,C);const M=c.remoteSDP.toString(),I=c.logSDPExchange(_,"offer","local","send");return yield vt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield vt(c.applySimulcastEncodings(u,r)),yield vt(c.applySendEncodings(u,r)),I==null||I(M),yield vt(c.peerConnection.setRemoteDescription({type:"answer",sdp:M})),u.map((k,G)=>{const K=v[G];return{localSSRC:w[G],id:K,transceiver:k}})}catch(u){throw u instanceof pe?u:new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{d()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:W("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}i.forEach(d=>{d._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof pe?s:new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof pe?i:new pe($.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var v;Qp(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const d=await this.peerConnection.createOffer(),u=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const f=this.remoteSDP.toString();u==null||u(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:u}=this.remoteSDP.send(r,i,s,c);u&&(await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:d,transceiver:f}}catch(d){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const d=this.peerConnection.getTransceivers().find(u=>u.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(d=>{Array.from(this.preMediaMap.entries()).some(u=>{let[f,{mid:g,player:v}]=u;if(g===d)return this.preMediaMap.delete(f),v&&v.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(u=>u.mid&&r.indexOf(u.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(u=>{u.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(u=>u.mid&&r.indexOf(u.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(u,f)=>{u.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Ai(function*(){const s=yield vt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=wt().supportPCSetConfiguration,d=W("FORCE_TURN_TCP")||i.forceTurn;if(r===Sr.RELAY&&!c)return;if(c&&!d){const S=r===Sr.RELAY?"relay":"all",w=i.peerConnection.getConfiguration();w.iceTransportPolicy!==S&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(w.iceTransportPolicy,"] to [").concat(S,"]")),w.iceTransportPolicy=S,i.peerConnection.setConfiguration(w))}i.remoteSDP.updateCandidates(r);const u=yield vt(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=dc(u.sdp),{remoteIceParameters:g}=yield f.iceParameters;i.remoteSDP.restartICE(g);const v=i.remoteSDP.toString(),_=i.logSDPExchange(u.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield vt(i.peerConnection.setLocalDescription(u)),_==null||_(v),yield vt(i.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Sr.TCP_RELAY),await zi(this.peerConnection,this.remoteSDP,this.extension)}catch(i){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{Qp(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:s}=i;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return wo(wo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const d=this.remoteSDP.toString(),u=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),u==null||u(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new pe($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?fn()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:wo(wo({},Os),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:wo(wo({},Os),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",d=lc(r.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(d||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},s=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(fu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:W("NEW_TURN_MODE")&&i.iceServers&&s==="disabled"?(W("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...eh.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...eh.newTurnServerConfigToIceServers(r.turnServer.servers)),W("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...eh.turnServerConfigToIceServers(r.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...eh.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Ls(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!W("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{const c=W("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Ls(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Ls(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair()||{};if(c&&d){const u=c.address+":"+c.port,f=d.address+":"+d.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(lc(u)),", remote ").concat(JSON.stringify(lc(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(k=>k.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},u={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const f=U6(this.peerConnection,r._mediaStreamTrack),g=R3(r);if(T8(r)&&f&&i&&g&&this.getLocalVideoStats&&xe(s=["vp8","vp9"]).call(s,this.store.codec)){var v;const I=d.degradationPreference||(xe(v=r._hints).call(v,Ht.CUSTOM_TRACK)?W("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");C8(this.id+f.mid,g,this,I,k=>{i&&this.updateAdaptation(i,k)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;const{bitrateMax:I,frameRate:k,scaleResolutionDownBy:G}=r._encoderConfig;I&&(u.maxBitrate=1e3*I),(xe(_=r._hints).call(_,Ht.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(k&&(u.maxFramerate=Di(k)),G&&G>=1&&(u.scaleResolutionDownBy=G))}const{maxFramerate:S}=W("ENCODER_CONFIG_LIMIT");if(S&&typeof S=="number"&&(u.maxFramerate=u.maxFramerate?Math.min(u.maxFramerate,S):S),W("DSCP_TYPE")&&ic()){var w;const I=W("DSCP_TYPE");xe(w=["very-low","low","medium","high"]).call(w,I)&&(u.networkPriority=I)}const C=i.getParameters(),M=(c=C.encodings)===null||c===void 0?void 0:c[0];fn()&&!M&&(d.encodings=[u]),M&&Object.assign(M,u),Object.assign(C,d),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await J6(this.store.codec,i,W("SVC_MODE"))}async updateAdaptation(r,i){var s,c;if(!r)return R.debug("[updateAdaptation] no rtpSender found");if(!wt().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:u,frameRate:f,scaleResolutionDownBy:g}=i;u&&(d.maxBitrate=1e3*u),f&&(d.maxFramerate=Di(f)),g&&g>=1&&xe(s=["vp8","vp9"]).call(s,this.store.codec)&&(d.scaleResolutionDownBy=g);const v=r.getParameters(),_=(c=v.encodings)===null||c===void 0?void 0:c[0];_&&Object.assign(_,d),Object.assign(v,{});try{await r.setParameters(v),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(S){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",S):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!wt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],d=i[s];d instanceof an&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){if(W("FORBID_MODIFY_LOCAL_OFFER_SDP"))return r;const c=yi(r);return i.forEach((d,u)=>{const f=s[u],g=c.mediaDescriptions.find(v=>v.attributes.mid===f);g&&(Pu(g,d),GN(g,d,this.store.codec))}),zc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,d,u,f;const v=r[g],_=i[g];if(_ instanceof an&&!xe(s=_._hints).call(s,Ht.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=_._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(u=_._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=_._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},w={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,S))}}}async applySimulcastEncodings(r,i){if(!fn()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof an&&this.isVP8Simulcast(c)){const d=r[s],u={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,u))}}}isVP8Simulcast(r){var i,s,c,d,u;return!!(r instanceof an&&W("SIMULCAST")&&this.store.codec==="vp8"&&!xe(i=r._hints).call(i,Ht.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((u=r._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?d=>{this.logSDPExchange(d,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(wt().supportPCSetConfiguration){const i=eh.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},De(Dt.prototype,"updateRemoteRTPCapabilities",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"updateRemoteRTPCapabilities"),Dt.prototype),De(Dt.prototype,"connect",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"connect"),Dt.prototype),De(Dt.prototype,"updateRemoteConnect",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"updateRemoteConnect"),Dt.prototype),De(Dt.prototype,"createDataChannels",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"createDataChannels"),Dt.prototype),De(Dt.prototype,"receive",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"receive"),Dt.prototype),De(Dt.prototype,"batchReceive",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"batchReceive"),Dt.prototype),De(Dt.prototype,"stopReceiving",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"stopReceiving"),Dt.prototype),De(Dt.prototype,"muteRemote",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"muteRemote"),Dt.prototype),De(Dt.prototype,"unmuteRemote",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"unmuteRemote"),Dt.prototype),De(Dt.prototype,"muteLocal",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"muteLocal"),Dt.prototype),De(Dt.prototype,"unmuteLocal",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"unmuteLocal"),Dt.prototype),De(Dt.prototype,"close",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"close"),Dt.prototype),De(Dt.prototype,"updateEncoderConfig",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"updateEncoderConfig"),Dt.prototype),De(Dt.prototype,"updateSendParameters",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"updateSendParameters"),Dt.prototype),De(Dt.prototype,"replaceTrack",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"replaceTrack"),Dt.prototype),De(Dt.prototype,"updateAdaptation",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"updateAdaptation"),Dt.prototype),De(Dt.prototype,"getRemoteSSRC",[ki],Object.getOwnPropertyDescriptor(Dt.prototype,"getRemoteSSRC"),Dt.prototype),Dt);function ki(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},i}function lO(t,r){let i=document.createElement("video"),s=document.createElement("canvas");i.setAttribute("style","display:none"),s.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),s.width=Di(r.width),s.height=Di(r.height);const c=Di(r.framerate||15);document.body.append(i),document.body.append(s);let d=t._mediaStreamTrack;i.srcObject=new MediaStream([d]),i.play().catch(Mg);const u=s.getContext("2d");if(!u)throw new se($.UNEXPECTED_ERROR,"can not get canvas context");const f=wt(),g=s.captureStream(f.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=s),s.startCapture=()=>{if(!i)return s.stopCapture&&s.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const _=i.videoWidth,S=i.videoHeight/_,w=s.width*S;Math.abs(w-s.height)>=2&&(R.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(w)),s.height=w)}u.drawImage(i,0,0,s.width,s.height),g.requestFrame&&g.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,i.srcObject=new MediaStream([d]))},s.stopCapture=lN(()=>s.startCapture&&s.startCapture(),c);const v=g.stop;return g.stop=()=>{v.call(g),i&&(i.remove(),i.srcObject=null,i=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),R.debug("clean low stream renderer")},g}var A8=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(A8||{}),xo=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(xo||{}),ut=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(ut||{}),pr=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t[t.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",t}(pr||{}),Pr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Pr||{}),Zp=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t[t.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",t}(Zp||{}),dO=function(t){return t[t.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",t[t.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",t}(dO||{});const ku=1e3,nb=6,nv=3,wve=Math.max(nb,nv,60);function et(t,r,i){i!=null&&Number.isFinite(i)&&(t[r]=Math.round(Math.max(0,i)))}function N8(t){const r={[Pr.CONN_TYPE]:0,[Pr.RTT]:t.rtt,[Pr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=t.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[Pr.CONN_TYPE]=1),i==="tcp"&&(r[Pr.CONN_TYPE]=3),i==="tls"&&(r[Pr.CONN_TYPE]=4);break}case"srflx":r[Pr.CONN_TYPE]=2;break;case"unknown":r[Pr.CONN_TYPE]=5;break;default:r[Pr.CONN_TYPE]=0}return r}function O8(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class I8 extends Sn{constructor(r){super(),j(this,"store",void 0),j(this,"uploadWRTCStatsTimer",void 0),j(this,"uploadOutboundDenoiserStatsTimer",void 0),j(this,"uploadExtStatsTimer",void 0),j(this,"uploadExtUsageStatsTimer",void 0),j(this,"uploadInboundExtStatsTimer",void 0),j(this,"requestStats",void 0),j(this,"requestTransportStats",void 0),j(this,"requestLocalMedia",void 0),j(this,"requestRemoteMedia",void 0),j(this,"requestAllTracks",void 0),j(this,"requestVideoIsReady",void 0),j(this,"requestUploadStats",void 0),j(this,"requestUpload",void 0),j(this,"uploadOutboundStarted",!1),j(this,"uploadInboundStarted",!1),j(this,"uploadTransportStarted",!1),j(this,"uploadBaseStatsStarted",!1),j(this,"uploadExtensionUsageStarted",!1),j(this,"lastRecvStats",void 0),j(this,"lastSendStats",void 0),j(this,"lastRefRecvStats",void 0),j(this,"lastRefSendStats",void 0),j(this,"lastNormalRecvStats",void 0),j(this,"lastNormalSendStats",void 0),j(this,"lastExtendStats",{}),j(this,"needUploadStats",{}),j(this,"needUploadRenderFreezeTime",!0),j(this,"lastUploadCompensateTime",-1),j(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%nv==0,s=r%nb==0,c=r%60==0;let d,u;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),d||u){var f;const g={};if(this.uploadTransportStarted&&d){const _=this.getTransportStats(d,i?this.lastRefSendStats:void 0,u,i);_&&(g.misc=[_])}if(this.uploadOutboundStarted&&d){const _=this.getOutboundStats(d,s?this.lastNormalSendStats:void 0,i?this.lastRefSendStats:void 0,this.lastSendStats,c);_&&(g.outbound=[_])}if(this.uploadInboundStarted&&u){this.uploadCompensateStats(r);const _=this.getInboundStats(u,s?this.lastNormalRecvStats:void 0,i?this.lastRefRecvStats:void 0,this.lastRecvStats);_&&(g.inbound=_)}const v=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;if(v&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[Zp.RTC_PEER_CONNECTION_STATE]=KA[v]):g.misc=[{addition:{[Zp.RTC_PEER_CONNECTION_STATE]:KA[v]}}]),ua.needUploadStats.length>0||s){const _=ua.needUploadStats.shift()||(ua.visibility==="visible"?1:0);Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[Zp.PAGE_VISIBILITY]=_):g.misc=[{addition:{[Zp.PAGE_VISIBILITY]:_}}]}this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[A8.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=u,this.lastSendStats=d,s&&(this.lastNormalRecvStats=u,this.lastNormalSendStats=d),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,ua.startCollectStats();let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,s;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[Zp.RTC_PEER_CONNECTION_STATE]:KA[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===wve+1&&(r=1)},ku)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const i=r%nv==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!i)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const s=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=s,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const d=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const u={};if(this.uploadInboundStarted&&d){const f=this.requestRemoteMedia()||[],g=[];f.forEach(v=>{let[_,S]=v;const w={peer:_.uid};if(_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)&&S.has(Fe.VIDEO)&&_.videoTrack){const C=function(M,I,k){if(!I.videoRecv.find(K=>K.ssrc===M))return;const G={};if(k&&k._player){const K=k._player,{renderFreezeAccTime2:X,videoElementStatus:te}=K;if(ua.visibility==="visible"&&te===$r.PLAYING&&wt().supportRequestVideoFrameCallback){const ne=Math.min(6e3,X);K.renderFreezeAccTime2=Math.max(0,X-ne),et(G,xo.Video_Render_Freeze_Time_Render2,ne),W("USE_NEW_RENDER_FREEZE_TIME")&&et(G,xo.Video_Render_Freeze_Time_Render,ne)}}return G}(_._videoSSRC,d,_.videoTrack);C&&(w.video=C)}w.video&&g.push(w)}),g.length>0&&(u.inbound=g,this.requestUploadStats(u))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,i,s,c){if(!this.requestStats)return;if(!c)return r.rtt==null?void 0:{addition:{[Pr.RTT]:r.rtt,[Pr.CONN_TYPE]:void 0,[Pr.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const d=N8(r);if(this.store.useP2P){if(s){const u=N8(s);d[Pr.CONN_TYPE]&&u[Pr.CONN_TYPE]&&(d[Pr.CONN_TYPE]+=u[Pr.CONN_TYPE]<<3)}d[Pr.CONN_TYPE]?d[Pr.CONN_TYPE]+=110:d[Pr.CONN_TYPE]=110}else{d[Pr.CONN_TYPE]?d[Pr.CONN_TYPE]+=100:d[Pr.CONN_TYPE]=100;const u=function(f,g){return g?[Math.ceil(8*(f.transport.bytesSent-g.transport.bytesSent)/(f.timestamp-g.timestamp)),Math.ceil(8*(f.transport.bytesReceived-g.transport.bytesReceived)/(f.timestamp-g.timestamp))]:[0,0]}(r,i);d[dO.Transport_Send_Bitrate]=u[0],d[dO.Transport_Recv_Bitrate]=u[1]}return{addition:d}}getOutboundStats(r,i,s,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let f,g,v;return u.forEach(_=>{let[S,{track:w,ssrcs:C}]=_;switch(S){case Te.LocalVideoLowTrack:case Te.LocalVideoTrack:if(S===Te.LocalVideoTrack){var M;const I=function(X,te,ne,Z,ie,ge){const Ee=te.videoSend.find(mt=>mt.ssrc===X);if(!Ee)return;const Me={},{sentFrame:at,inputFrame:tt}=Ee;if(Z&&(et(Me,xo.Video_Send_Qp_Sum,Ee.qpSumPerFrame),tt&&at)){const mt=tt.frameRate,ht=at.frameRate;Me[xo.Video_Send_Freeze]=function(Wt,En){let ye=!0;return ye=!(Wt<=5)&&(Wt<=10?En<3:Wt<=20?En<4:En<5),ye}(mt,ht)?1:0}if(ie){switch(at&&(et(Me,ut.Video_Send_Height,at.height),et(Me,ut.Video_Send_Width,at.width),et(Me,ut.Video_Send_Frame_Rate,at.frameRate)),Me[ut.Video_Send_Disabled]=ne._originMediaStreamTrack&&!ne._originMediaStreamTrack.enabled||ne._mediaStreamTrack&&!ne._mediaStreamTrack.enabled?1:0,Ee.adaptionChangeReason){case"none":Me[ut.Video_Send_Adaptation]=0;break;case"cpu":Me[ut.Video_Send_Adaptation]=1;break;case"bandwidth":Me[ut.Video_Send_Adaptation]=2;break;case"other":Me[ut.Video_Send_Adaptation]=3}let mt=0;Ee.adaptionChangeReason&&(mt+=O8(Ee.adaptionChangeReason)),te.qualityLimitationReason&&(mt+=O8(te.qualityLimitationReason)<<3),Me[ut.Video_Send_Adaptation]=mt,Me[ut.Video_Send_Player_Status]=sN[ne._player?ne._player.videoElementStatus:"uninit"],et(Me,ut.Video_Send_Nacks,Ee.nacksCount),et(Me,ut.Video_Send_Plis,Ee.plisCount),et(Me,ut.Video_Send_Firs,Ee.firsCount),et(Me,ut.Video_Send_Avg_Encode,Ee.avgEncodeMs),et(Me,ut.Video_Send_Huge_Frame_Sent,Ee.hugeFramesSent),et(Me,ut.Video_Send_Bytes_Retransmit,Ee.retransmittedBytesSent),et(Me,ut.Video_Send_Packages_Retransmit,Ee.retransmittedPacketsSent),et(Me,ut.Video_Send_Key_Frames_Encoded,Ee.keyFramesEncoded);const ht=ie.videoSend.find(Wt=>Wt.ssrc===X);if(ht){let Wt=ku*nv;ht.timestamp&&Ee.timestamp&&(Wt=Ee.timestamp-ht.timestamp),ht.packets!=null&&Ee.packets!=null&&et(Me,ut.Video_Send_Package_Rate,1e3*(Ee.packets-ht.packets)/Wt),Ee.packetsLost!=null&&ht.packetsLost!=null&&et(Me,ut.Video_Send_Package_Lost,Ee.packetsLost-ht.packetsLost),ht.bytes!=null&&Ee.bytes!=null&&et(Me,ut.Video_Send_Bitrate,8*(Ee.bytes-ht.bytes)/Wt)}}return Me}(C[0].ssrcId,r,w,i,s),k=w.__className__==="CameraVideoTrack"?3:xe(M=w._hints).call(M,Ht.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==k||d)&&(this.needUploadStats={sendType:k},this.lastExtendStats.sendType=k);const G=w&&function(X,te,ne,Z){const ie=te.videoSend.find(Ee=>Ee.ssrc===X);if(!ie)return null;const ge={};if(Z){const Ee=ie.inputFrame,Me=Ee&&Ee.height||ne.videoHeight||0,at=Ee&&Ee.width||ne.videoWidth||0,tt=Ee&&Ee.frameRate||0;et(ge,ut.Video_Capture_Height,Me),et(ge,ut.Video_Capture_Width,at),et(ge,ut.Video_Capture_Frame_Rate,tt)}return ge}(C[0].ssrcId,r,w,!!s),K=function(X,te){const ne={};return te&&(et(ne,ut.Video_Send_Retransmit,X.bitrate.retransmit),et(ne,ut.Video_Send_Target_Encoded,X.bitrate.targetEncoded),et(ne,ut.Video_Send_Actual_Encoded,X.bitrate.actualEncoded),et(ne,ut.Video_Send_Transmit,X.bitrate.transmit),et(ne,ut.Video_Send_Bandwidth,X.sendBandwidth)),ne}(r,!!s);g=Object.assign({},I,G,K)}else v=function(I,k,G,K,X){const te=k.videoSend.find(Z=>Z.ssrc===I);if(!te)return;const ne={};if(K){const Z=te.sentFrame;Z&&(et(ne,ut.Video_Send_Low_Height,Z.height),et(ne,ut.Video_Send_Low_Width,Z.width),et(ne,ut.Video_Send_Low_Frame_Rate,Z.frameRate));const ie=K.videoSend.find(ge=>ge.ssrc===I);if(ie){let ge=ku*nb;ie.timestamp&&te.timestamp&&(ge=te.timestamp-ie.timestamp),ie.packets!=null&&te.packets!=null&&et(ne,ut.Video_Send_Low_Package_Rate,1e3*(te.packets-ie.packets)/ge),te.packetsLost!=null&&ie.packetsLost!=null&&et(ne,ut.Video_Send_Low_Package_Lost,te.packetsLost-ie.packetsLost),ie.bytes!=null&&te.bytes!=null&&et(ne,ut.Video_Send_Low_Bitrate,8*(te.bytes-ie.bytes)/ge)}}return ne}(C[0].ssrcId,r,0,s);break;case Te.LocalAudioTrack:f=w&&function(I,k,G,K,X,te){const ne=k.audioSend.find(ie=>ie.ssrc===I);if(!ne)return;const Z={};if(X){Z[ut.Audio_Send_Disabled]=G._originMediaStreamTrack&&!G._originMediaStreamTrack.enabled||G._mediaStreamTrack&&!G._mediaStreamTrack.enabled?1:0;const ie=100*G._source.getAccurateVolumeLevel(),ge=ne.inputLevel;if(ge!=null){const Me=Math.ceil(50*Math.log10(100*ge+1));et(Z,ut.Audio_Send_Level,Me)}et(Z,ut.Audio_Capture_PCM_Level,ie),et(Z,ut.Audio_Send_AEC_Return_Loss,ne.aecReturnLoss),et(Z,ut.Audio_Send_AEC_Return_Loss_Enhancement,ne.aecReturnLossEnhancement),et(Z,ut.Audio_Send_Bytes_Retransmit,ne.retransmittedBytesSent),et(Z,ut.Audio_Send_Packages_Retransmit,ne.retransmittedPacketsSent),Z[ut.Audio_Send_Freeze]=0;const Ee=X.audioSend.find(Me=>Me.ssrc===I);if(Ee){let Me=ku*nb;Ee.timestamp&&ne.timestamp&&(Me=ne.timestamp-Ee.timestamp),Ee.bytes!=null&&ne.bytes!=null&&et(Z,ut.Audio_Send_Bitrate,8*(ne.bytes-Ee.bytes)/Me),Ee.packets!=null&&ne.packets!=null&&et(Z,ut.Audio_Send_Package_Rate,1e3*(ne.packets-Ee.packets)/Me)}}return Z}(C[0].ssrcId,r,w,0,s)}}),{high:g,low:v,audio:f}}getInboundStats(r,i,s,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],u=[];return d.forEach(f=>{let[g,v]=f;const _={peer:g.uid};let S;if(v.has(Fe.VIDEO)&&g.videoTrack){const w=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,C=g.videoTrack?function(M,I,k,G,K,X,te,ne){const Z=I.videoRecv.find(ht=>ht.ssrc===M);if(!Z)return;const ie={},{receivedFrame:ge,outputFrame:Ee,decodeFrameRate:Me}=Z;et(ie,pr.Video_Render_Frame_Rate_Decode,Me),Z.framesRateFirefox&&et(ie,pr.Video_Recv_Frame_Rate,Z.framesRateFirefox),ge&&et(ie,pr.Video_Recv_Frame_Rate,ge.frameRate),et(ie,pr.Video_Recv_Frame_Dropped,Z.framesDroppedCount),et(ie,pr.Video_Recv_Bytes_Retransmit,Z.retransmittedBytesReceived),et(ie,pr.Video_Recv_Packages_Retransmit,Z.retransmittedPacketsReceived),et(ie,pr.Video_Recv_Packages_Discarded,Z.packetsDiscarded),et(ie,pr.Video_Recv_Avg_Decode,Z.avgDecodeMs),et(ie,pr.Video_Recv_Avg_Processing_Delay,Z.avgProcessingDelayMs),et(ie,pr.Video_Recv_Avg_Assembly_Time,Z.avgFramesAssembledFromMultiplePacketsMs),et(ie,pr.Video_Recv_Avg_Inter_Frame_Delay,Z.avgInterFrameDelayMs),et(ie,pr.Video_Recv_Key_Frames_Decoded,Z.keyFramesDecoded);const at=ne&&ne.videoRecv.find(ht=>ht.ssrc===M);if(at){const ht=I.timestamp-ne.timestamp||ku;Z.packetsLost!=null&&at.packetsLost!=null&&et(ie,pr.Video_Recv_Package_Lost,Z.packetsLost-at.packetsLost),at.bytes!=null&&Z.bytes!=null&&et(ie,pr.Video_Recv_Bitrate,8*(Z.bytes-at.bytes)/ht),at.packets!=null&&Z.packets!=null&&et(ie,pr.Video_Recv_Package_Rate,1e3*(Z.packets-at.packets)/ht)}const tt=X&&X.videoRecv.find(ht=>ht.ssrc===M);if(tt&&(et(ie,xo.Video_Recv_Qp_Sum,Z.qpSumPerFrame),ie[xo.Video_Recv_Freeze]=G&&ev.isRemoteVideoFreeze(k,Z,tt)?1:0),te){var mt;const ht=te.videoRecv.find(En=>En.ssrc===M);ge?(et(ie,ut.Video_Recv_Height,ge.height),et(ie,ut.Video_Recv_Width,ge.width)):k&&(et(ie,ut.Video_Recv_Height,k._videoHeight||0),et(ie,ut.Video_Recv_Width,k._videoWidth||0)),Ee&&et(ie,ut.Video_Recv_Frame_Rate_Output,Ee.frameRate);const Wt=(mt=k._player)===null||mt===void 0?void 0:mt.rendFrameRate.toFixed(0);if(Wt&&et(ie,ut.Video_Render_Frame_Rate_Render,+Wt),et(ie,ut.Video_Recv_Jitter_Buffer,Z.jitterBufferMs),et(ie,ut.Video_Recv_Current_Delay,Z.currentDelayMs),et(ie,ut.Video_Recv_Firs,Z.firsCount),et(ie,ut.Video_Recv_Nacks,Z.nacksCount),et(ie,ut.Video_Recv_Plis,Z.plisCount),k){ie[ut.Video_Recv_Disabled]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1;const En=k._player;if(En){const{freezeTimeCounterList:ye,renderFreezeAccTime:Ne,renderFreezeAccTime2:Be,videoElementStatus:_e}=En;if(ye&&ye.length>0&&et(ie,xo.Video_Render_Freeze_Time,ye.splice(0,1)[0]),K&&ua.visibility==="visible"&&_e===$r.PLAYING&&wt().supportRequestVideoFrameCallback){const O=Math.min(6e3,Be);En.renderFreezeAccTime2=Math.max(0,Be-O),et(ie,xo.Video_Render_Freeze_Time_Render2,O);const q=Math.min(6e3,Ne);En.renderFreezeAccTime=Math.max(0,Ne-q),et(ie,xo.Video_Render_Freeze_Time_Render,W("USE_NEW_RENDER_FREEZE_TIME")?O:q)}if(typeof Z.totalFreezesDuration=="number"){const O=ht&&ht.totalFreezesDuration?Z.totalFreezesDuration-ht.totalFreezesDuration:Z.totalFreezesDuration;et(ie,ut.Video_Render_Freeze_Duration,1e3*O)}}}if(ie[ut.Video_Recv_Player_Status]=sN[k._player?k._player.videoElementStatus:"uninit"],ht&&Z.totalInterFrameDelay!==void 0&&Z.totalSquaredInterFrameDelay!==void 0&&ht.totalInterFrameDelay!==void 0&&ht.totalSquaredInterFrameDelay!==void 0){const En=Z.totalInterFrameDelay-ht.totalInterFrameDelay,ye=Z.totalSquaredInterFrameDelay-ht.totalSquaredInterFrameDelay,Ne=Z.framesDecodeCount-ht.framesDecodeCount,Be=En/Ne*1e3,_e=Math.round(1e3*Math.sqrt((ye-Math.pow(En,2)/Ne)/Ne));!isNaN(_e)&&Be+_e>Math.max(3*Be,Be+150)&&(ie[ut.Video_Recv_I_Frame_Delay]=_e)}}return ie}(g._videoSSRC,r,g.videoTrack,w===!0,this.needUploadRenderFreezeTime,i,s,c):void 0;if(C&&(_.video=C),g.videoTrack){const M=r.videoRecv.find(I=>I.ssrc===g._videoSSRC);M&&M.estimatedPlayoutTimestamp&&(S=M.estimatedPlayoutTimestamp)}}if(v.has(Fe.AUDIO)&&g.audioTrack){const w=g.audioTrack?function(C,M,I,k,G,K){const X=M.audioRecv.find(ie=>ie.ssrc===C);if(!X)return;const te={};et(te,pr.Audio_Recv_Jitter,X.jitterMs),et(te,pr.Audio_Recv_Bytes_Retransmit,X.retransmittedBytesReceived),et(te,pr.Audio_Recv_Packages_Retransmit,X.retransmittedPacketsReceived),et(te,pr.Audio_Recv_Packages_Discarded,X.packetsDiscarded),et(te,pr.Audio_Recv_Avg_Processing_Delay,X.avgProcessingDelayMs);const ne=K&&K.audioRecv.find(ie=>ie.ssrc===C);if(ne){const ie=ku;X.packets!=null&&ne.packets!=null&&et(te,pr.Audio_Recv_Package_Rate,1e3*(X.packets-ne.packets)/ie),X.packetsLost!=null&&ne.packetsLost!=null&&et(te,pr.Audio_Recv_Package_Lost,X.packetsLost-ne.packetsLost)}if(k){const{receivedFrames:ie,droppedFrames:ge}=X;ie!=null&&ge!=null&&(te[xo.Audio_Recv_Freeze]=(Z=ie)===0||100*ge/Z>20?1:0)}var Z;if(G){const ie=100*I._source.getAccurateVolumeLevel(),ge=X.outputLevel;if(ge!=null){const Me=Math.ceil(50*Math.log10(100*ge+1));et(te,ut.Audio_Render_Level,Me)}et(te,ut.Audio_Recv_PCM_Level,ie),I&&(te[ut.Audio_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),et(te,ut.Audio_Recv_Jitter_Buffer,X.jitterBufferMs),et(te,ut.Audio_Recv_Current_Delay,X.jitterBufferMs),te[ut.Audio_Recv_Player_Status]=sN[ii.getPlayerState(I.getTrackId())];const Ee=G.audioRecv.find(Me=>Me.ssrc===C);if(Ee){Ee.bytes!=null&&X.bytes!=null&&et(te,ut.Audio_Recv_Bitrate,8*(X.bytes-Ee.bytes)/(ku*nv));const Me=X.concealedSamples-Ee.concealedSamples;Me>0&&et(te,ut.Audio_Recv_Concealed_Samples,Me);const at=X.totalSamplesReceived-Ee.totalSamplesReceived;at>0&&et(te,ut.Audio_Recv_Total_Samples_Received,at);const tt=X.freezeSamples80-Ee.freezeSamples80;tt>0&&et(te,ut.Audio_Render_Freeze_Samples_80ms,tt);const mt=X.freezeSamples200-Ee.freezeSamples200;mt>0&&et(te,ut.Audio_Render_Freeze_Samples_200ms,mt);const ht=X.freezeMs80-Ee.freezeMs80;et(te,ut.Audio_Render_Freeze_Time_80ms,ht<0?0:ht);const Wt=X.freezeMs200-Ee.freezeMs200;et(te,ut.Audio_Render_Freeze_Time_200ms,Wt<0?0:Wt)}}return te}(g._audioSSRC,r,g.audioTrack,i,s,c):void 0;if(w&&(_.audio=w),g.audioTrack&&S){const C=r.audioRecv.find(M=>M.ssrc===g._audioSSRC);if(C&&C.estimatedPlayoutTimestamp){const M=C.estimatedPlayoutTimestamp-S;_.audio?_.audio[pr.Audio_Recv_AV_Sync_TIME]=M:_.audio={[pr.Audio_Recv_AV_Sync_TIME]:M}}}}(_.video||_.audio)&&u.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,u}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof Gg);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(Ou.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,s]=r;s.has(Fe.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),s.has(Fe.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),s={connectionInterval:W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of d)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const u=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,_]of u)_.has(Fe.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),_.has(Fe.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;s.details=function(v,_){const S={};for(const{id:I,value:k,level:G,direction:K}of v){var w;const X=(w=_.get(I))!==null&&w!==void 0?w:0,te=k===2?X+W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:X;var C,M;_.set(I,te),S[I]?(k===2&&(S[I].value=k),G>S[I].level&&(S[I].level=G),K==="remote"&&(S[I].remoteUidCount+=1),S[I].totalTs=(C=_.get(I))!==null&&C!==void 0?C:0):S[I]={value:k,level:G,remoteUidCount:K==="local"?0:1,totalTs:(M=_.get(I))!==null&&M!==void 0?M:0}}return Object.keys(S).map(I=>{const{level:k,value:G,totalTs:K}=S[I];return{id:I,level:k,value:G,totalTs:K}})}(c,r);const f=Date.now(),g=f>i?f:i+1;this.requestUpload&&this.requestUpload(Ou.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:g})},W("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,ua.stopCollectStats()}}const xve=W("ICE_RESTART_INTERVAL");let rb=new Map,ef=new Map,ed=[Sr.UDP_TCP_RELAY,Sr.TCP_RELAY,Sr.RELAY],uO=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&wt().supportPCSetConfiguration;function P8(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=rb.get(t.id);i&&(window.clearTimeout(i),rb.delete(t.id));const s=ef.get(t.id);r&&s&&s.index===ed.length-1&&(R.debug("[".concat(t.id,"] reset ICE restart policy")),ef.delete(t.id))}function D8(t,r,i){if(rb.size===0&&ef.size===0&&(Array.isArray(W("RESTART_SEQUENCE"))&&W("RESTART_SEQUENCE").length>0&&!function(f,g){if(f.length!==g.length)return!1;for(let v=0;v<f.length;v+=1){const _=f[v];if(f.filter(S=>S===_).length!==g.filter(S=>S===_).length)return!1}return!0}(ed,W("RESTART_SEQUENCE"))&&(ed=W("RESTART_SEQUENCE").filter(f=>{var g;if(xe(g=Object.values(Sr)).call(g,f))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(ed.join(" => ")))),uO=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&wt().supportPCSetConfiguration),ed.length===0)return void i();let s,{index:c=0,type:d}=ef.get(t.id)||{};if(uO&&d===Sr.RELAY)return void i();let u=d&&c>=ed.length-1;if(uO)d=Sr.RELAY;else{if(u)return void i();d?(c++,d=ed[c]):(d=ed[0],c=0)}R.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),ef.set(t.id,{index:c,type:d}),s=window.setTimeout(()=>D8(t,r,i),xve),rb.set(t.id,s)}var Tt;function k8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function pc(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?k8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function L8(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=X0,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new ib(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function ib(t){function r(i){if(Object(i)!==i)return Ie.reject(new TypeError(i+" is not an object."));var s=i.done;return Ie.resolve(i.value).then(function(c){return{value:c,done:s}})}return ib=function(i){this.s=i,this.n=i.next},ib.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Ie.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Ie.reject(i):r(s.apply(this.s,arguments))}},new ib(t)}let Lu=(Tt=class extends Sn{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Ke.StateChange,r,this._state)}constructor(t,r){super(),j(this,"isPlanB",void 0),j(this,"store",void 0),j(this,"statsUploader",void 0),j(this,"connection",void 0),j(this,"localTrackMap",new Map),j(this,"remoteUserMap",new Map),j(this,"localDataChannels",[]),j(this,"remoteDataChannelMap",new Map),j(this,"pendingLocalTracks",[]),j(this,"pendingRemoteTracks",[]),j(this,"pendingLocalDataChannels",[]),j(this,"pendingRemoteDataChannels",[]),j(this,"statsCollector",void 0),j(this,"shouldForwardP2PCreation",void 0),j(this,"iceFailedCount",0),j(this,"dtlsFailedCount",0),j(this,"mutex",void 0),j(this,"_state",$t.Disconnected),j(this,"_pcStatsUploadType",W("NEW_ICE_RESTART")?qc.FIRST_CONNECTION:qc.OLD_FIRST_CONNECTION),j(this,"_isStartRestartIce",!1),j(this,"_restartTimer",void 0),j(this,"_isTryConnecting",!1),j(this,"_iceError",null),j(this,"_forceTurn",!1),j(this,"_isWaitPcToRePub",!1),j(this,"handleMuteLocalTrack",async(i,s,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==$t.Connected)return void c(new pe($.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const u=this.filterTobeMutedTracks(i);if(u.length===0)return void s();const f=u.find(v=>v[0]==="videoLowTrack");if(f){const v=f[1];this.store.enableInstantMuteRestore?(v.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):v.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(u.map(v=>{let[,{id:_}]=v;return _}));const g=this.createMuteMessage(u);await cn(this,Ke.RequestMuteLocal,g),s()}catch(u){c(u)}finally{d()}}),j(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==$t.Connected)return void c(new pe($.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const u=this.filterTobeUnmutedTracks(i);if(u.length===0)return void s();const f=u.find(v=>v[0]==="videoLowTrack");if(f){const v=f[1];if(this.store.enableInstantMuteRestore)v.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(v.track._originMediaStreamTrack.stop(),!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const _=i._mediaStreamTrack.clone();v.track._mediaStreamTrack=_,v.track._originMediaStreamTrack=_}else{const _=lO(i,gu(this,Ke.RequestLowStreamParameter));v.track._mediaStreamTrack=_,v.track._originMediaStreamTrack=_}await new Ie((_,S)=>{this.handleReplaceTrack(v.track,_,S,!0)})}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(u.map(v=>{let[,{id:_}]=v;return _}));const g=this.createUnmuteMessage(u);await cn(this,Ke.RequestUnmuteLocal,g),s()}catch(u){c(u)}finally{d()}}),j(this,"handleUpdateVideoEncoder",async(i,s,c,d)=>{let u;d||(u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!g||g.track!==i||this.state!==$t.Connected)return void s();const{id:v,track:_}=g;await this.connection.updateSendParameters(v,_),await this.connection.updateEncoderConfig(v,_),this.emit(Ke.UpdateVideoEncoder,_),s()}catch(g){c(g)}finally{var f;(f=u)===null||f===void 0||f()}}),j(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const u=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!u||u.track!==i||this.state!==$t.Connected)return void s();const{id:f,track:g}=u;await this.connection.updateSendParameters(f,g),s()}catch(u){c(u)}finally{d()}}),j(this,"handleReplaceMixingTrack",async(i,s,c,d)=>{if(!this.connection||this.state!==$t.Connected)return void s();const u=sO([i]);let f;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(u.getTrackId(),"]")),typeof d=="boolean"&&d||(f=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,u),s()}catch(v){c(v)}finally{var g;(g=f)===null||g===void 0||g()}}),j(this,"handleReplaceTrack",async(i,s,c,d)=>{let u;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof d=="boolean"&&d||(u=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:S}]=_;return i===S});if(!this.connection||!v||this.state!==$t.Connected)return void s();if(await((f=this.connection)===null||f===void 0?void 0:f.replaceTrack(i,v[1].id)),this.isPlanB){const _=v[1];_.id=i._mediaStreamTrack.id,this.localTrackMap.set(v[0],_)}if(v[0]===Te.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const _=this.localTrackMap.get(Te.LocalVideoLowTrack);if(_){const S=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=S,_.track._originMediaStreamTrack=S,await new Ie((w,C)=>{this.handleReplaceTrack(_.track,w,C,!0)})}}s()}catch(v){c(v)}finally{var g;(g=u)===null||g===void 0||g()}}),j(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),j(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),j(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),j(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),j(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new I8(this.store),this.bindStatsUploaderEvents(),this.mutex=new br("P2PChannel-mutex",this.store.clientId),this.isPlanB=!wt().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&ic(),this.shouldForwardP2PCreation=W("FORWARD_P2P_CREATION")&&wt().supportPCSetConfiguration&&y5(),this.shouldForwardP2PCreation&&(this.connection=tv(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,r){var i;this.state=$t.New,this._forceTurn=cO(t),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||s||r)&&((s||r)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=tv(this.store,t),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=W("NEW_ICE_RESTART")?qc.FIRST_CONNECTION:qc.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==$t.Connected){this.store.peerConnectionStart();const r=await this.connection.connect(t);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$t.Connected,r}if(this.connection instanceof Pa&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),We.reportApiInvoke(this.store.sessionId,{name:yn.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:rn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Ke.RequestReconnect)});await this.connection.updateRemoteConnect(t)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[u]=c;return xe(d=[Te.LocalVideoLowTrack,Te.LocalVideoTrack]).call(d,u)}),i=r.map(c=>{let[,{id:d}]=c;return d}),s=r.map(c=>{let[d]=c;return d});if(this.connection instanceof Pa||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(We.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!xe(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(d=>xe(t).call(t,d));c&&(this.store.codec=c,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,t)}}async getEstablishParams(){var t;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Pa&&this.connection.peerConnectionState!=="closed"&&xe(t=[$t.New,$t.Connected]).call(t,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(t){if(!this.connection||this.state!==$t.Connected){if(this.state===$t.Disconnected)throw new pe($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(i=>{var s;xe(s=this.pendingLocalDataChannels).call(s,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}),t.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(t,r,i){var s=this;return Ai(function*(){const c=yield vt(s.mutex.lock("From P2PChannel.publish"));try{var d;const u=s.connection&&xe(d=["disconnected","failed"]).call(d,s.connection.peerConnectionState);if(!s.connection||s.state!==$t.Connected||u){if(s.state===$t.Disconnected)throw new pe($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(t);const g=t.filter(v=>s.pendingLocalTracks.indexOf(v)===-1);return s.pendingLocalTracks=s.pendingLocalTracks.concat(g),void(u&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,zr.markPublishStart(s.store.clientId,s.store.pubId);const f=s.filterTobePublishedTracks(t,r,i);if(f.length===0)return void(yield vt(s.tryToUnmuteAudio(t)));yield*wp(L8(s.doPublish(s.connection,f)))}finally{c()}})()}doPublish(t,r){var i=this;return Ai(function*(){r.forEach(w=>{let{track:C,type:M}=w;const I=Date.now();i.store.publish(C.getTrackId(),M===Te.LocalAudioTrack?"audio":"video",I)}),i.bindLocalTrackEvents(r);const s=r.map(w=>{let{track:C}=w;return C}),c=yield vt(t.send(s,i.store.codec,i.store.audioCodec)),d=(yield vt(c.next())).value,u=i.createGatewayPublishMessage(r,d);let f;try{f=yield u}catch(w){throw c.throw(w),(w==null?void 0:w.code)===$.WS_ABORT&&r.forEach(C=>{let{track:M}=C;i.pendingLocalTracks.indexOf(M)===-1&&i.pendingLocalTracks.push(M)}),i.unbindLocalTrackEvents(r),w}const g=i.mapPubResToRemoteConfig(u,f,s),v=(yield vt(c.next(g))).value;if(i.state===$t.Disconnected)throw new pe($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");W("ENABLE_VIDEO_SEI");const _=W("ENABLE_ENCODED_TRANSFORM"),S=W("ENABLE_AUDIO_METADATA");s.forEach(async w=>{const C=w.getRTCRtpTransceiver();if(!C||!_)return;const{interceptLocalVideoFrame:M,interceptLocalAudioFrame:I}=KE();w.trackMediaType===Fe.VIDEO?await M(C.sender,w):w.trackMediaType===Fe.AUDIO&&await I(C.sender,{metadata:S?()=>{const k=w.metadata.shift();return k&&k.value}:void 0})}),r.forEach(w=>{let{type:C}=w;i.statsCollector.addLocalStats(C)}),i.assignLocalTracks(r,v),i.statsUploader.startUploadOutboundStats(),r.forEach(w=>{let{track:C,type:M}=w;const I=Date.now();i.store.publish(C.getTrackId(),M===Te.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(t,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof an))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=i,c=function(d,u){const f={};return d.height&&d.width&&(f.scaleResolutionDownBy=VN(d,u)),f.maxFramerate=d.framerate?Di(d.framerate):void 0,f.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,f}(t,s);if(s._encoderConfig||(s._encoderConfig={}),r!==Te.LocalVideoLowTrack||!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=s._originMediaStreamTrack;if(!d.canvas)return R.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(u,f){const g=u.canvas;f.width&&(g.width=Di(f.width)),f.height&&(g.height=Di(f.height)),f.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=lN(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Di(f.framerate)))})(d,t)}c.maxBitrate!=null&&(s._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=c.maxFramerate:s._encoderConfig.frameRate={max:c.maxFramerate}),R.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(t){var r=this;return Ai(function*(){if(!r.connection||r.state!==$t.Connected)return;const i=yield vt(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Te.LocalVideoTrack);if(!c)throw new pe($.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Te.LocalVideoLowTrack))throw new pe($.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:Te.LocalVideoLowTrack}];if(yield*wp(L8(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var s;const u=(s=r.localTrackMap.get(Te.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;u!==void 0&&(yield vt(r.connection.muteLocal([u])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await qn(this,Ke.RequestRePublish,this.pendingLocalTracks),this.emit(Ke.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await qn(this,Ke.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:s}=this.pendingRemoteTracks[r];(s!==Fe.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==Fe.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await qn(this,Ke.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===Fe.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(Ke.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==$t.Connected)return void t.forEach(s=>{const c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const i=r.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==$t.Connected)return void t.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==$t.Connected)return;const t=this.localTrackMap.get(Te.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Te.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const i=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(s=>{let[c,{track:d}]=s;return{type:c,track:d}})),r.forEach(s=>{let[c]=s;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(t,r){if(!this.connection||this.state!==$t.Connected)throw new pe($.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(s=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(t.uid,i),i.forEach(s=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(s.id,s):this.remoteDataChannelMap.set(t,new Map([[s.id,s]]));const d=this.pendingRemoteDataChannels.findIndex(u=>{let{user:f,id:g}=u;return f.uid===t.uid&&g===s.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),i.map(s=>s.id)}async subscribe(t,r,i,s,c){var d;if(!this.connection||this.state!==$t.Connected)throw new pe($.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let u,f,g,v;const _=this.connection.getPreMedia(i);if(_)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),g=_.transceiver,u=_.track,f=_.mid,v=_.player,_.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:_.firstVideoRender});else if(c){const C=c.find(I=>{let{stream_type:k}=I;return k===r});if(!C)throw new pe($.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const M=await this.connection.receive(r,C.ssrcs,String(t._uintid),C.attributes);(this.connection instanceof Pa||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=M.transceiver),u=M.track,f=M.id}else{const C=await this.connection.receive(r,[{ssrcId:i,rtx:s}],String(t._uintid),void 0);(this.connection instanceof Pa||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=C.transceiver),u=C.track,f=C.id}if(r===Fe.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new Fp(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),g&&t._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new Vp(u,t.uid,t._uintid,this.store,v),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(Za.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(Za.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),v?t._videoTrack.once(Za.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(Za.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),g&&t._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._videoTrack)),g&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:M}=KE();r==Fe.VIDEO?await C(g.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(I=>{var k;return(k=t._videoTrack)===null||k===void 0?void 0:k._onSei(I)}),onFirstFrame:I=>{var k;const G=Array.from(Zr(k=this.remoteUserMap).call(k)).find(K=>K._videoSSRC===I.ssrc);G&&this.store.firstVideoFrameDecoded(G.uid,{firstReceivedEncodedFrame:Date.now(),frameType:I.type,rtpTimestamp:I.rtpTimestamp,framePayloadType:I.payloadType,frameDataLength:I.length,mimeType:I.mimeType})}}):r==Fe.AUDIO&&await M(g.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(Ke.AudioMetadata,I)},onPts:I=>{this.safeEmit(Ke.AudioPts,I)}})}const S=this.remoteUserMap.get(t);S?S.set(r,f):this.remoteUserMap.set(t,new Map([[r,f]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(C=>{let{user:M,kind:I}=C;return M.uid===t.uid&&r===I});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(Ke.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==$t.Connected)throw new pe($.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var d;let{user:u,mediaType:f}=c;return!((d=this.remoteUserMap.get(u))!==null&&d!==void 0&&d.has(f))});const r=[],i=new Map;t.forEach(c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);if(d){const{track:u,mid:f,transceiver:g,player:v}=d;i.set(c.ssrcId,{track:u,id:f,transceiver:g,player:v})}else r.push(c)});const s=await this.connection.batchReceive(r.map(c=>{let{user:d,mediaType:u,ssrcId:f,rtxSsrcId:g}=c;return{kind:u,ssrcMsg:[{ssrcId:f,rtx:g}],mslabel:String(d._uintid)}}));r.forEach((c,d)=>{i.set(c.ssrcId,s[d])});for(const{user:c,mediaType:d,ssrcId:u}of t){const f=i.get(u);if(!f)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(u));const{track:g,id:v,transceiver:_,player:S}=f;if(_&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:M,interceptRemoteAudioFrame:I}=KE();d==Fe.VIDEO?await M(_.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(k=>{var G;return(G=c._videoTrack)===null||G===void 0?void 0:G._onSei(k)}),onFirstFrame:k=>{var G;const K=Array.from(Zr(G=this.remoteUserMap).call(G)).find(X=>X._videoSSRC===k.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:k.type,rtpTimestamp:k.rtpTimestamp,framePayloadType:k.payloadType,frameDataLength:k.length,mimeType:k.mimeType})}}):d==Fe.AUDIO&&await I(_.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:k=>{this.safeEmit(Ke.AudioMetadata,k)},onPts:k=>{this.safeEmit(Ke.AudioPts,k)}})}if(d===Fe.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new Fp(g,c.uid,c._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),_&&c._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new Vp(g,c.uid,c._uintid,this.store,S),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),_&&c._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(c,c._videoTrack)),W("ENABLE_VIDEO_SEI")&&_){const{interceptRemoteVideoFrame:M,interceptRemoteAudioFrame:I}=KE();d==Fe.VIDEO?await M(_.receiver,{onSei:k=>{var G;(G=c._videoTrack)===null||G===void 0||G._onSei(k)},onFirstFrame:k=>{var G;const K=Array.from(Zr(G=this.remoteUserMap).call(G)).find(X=>X._videoSSRC===k.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:k.type,rtpTimestamp:k.rtpTimestamp,framePayloadType:k.payloadType,frameDataLength:k.length,mimeType:k.mimeType})}}):d==Fe.AUDIO&&await I(_.receiver)}const w=this.remoteUserMap.get(c);w?w.set(d,v):this.remoteUserMap.set(c,new Map([[d,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const C=this.pendingRemoteTracks.findIndex(M=>{let{user:I,kind:k}=M;return I.uid===c.uid&&d===k});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(Ke.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,i){const s=this.pendingRemoteTracks.filter(u=>{let{user:f,kind:g}=u;return r!==void 0?f.uid===t.uid&&r===g:f.uid===t.uid});if(s.forEach(u=>{const f=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(f,1)}),this.connection&&this.state===$t.Connected||i||s.forEach(u=>{let{kind:f}=u;var g;if(f===Fe.AUDIO)(g=t._audioTrack)===null||g===void 0||g._destroy(),t._audioTrack=void 0;else if(f===Fe.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==$t.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(u=>{let[,{id:f}]=u;return f}));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(u=>{let[f,{kind:g}]=u;var v,_;if(g===Fe.VIDEO&&f._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),g===Fe.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),i||((_=f._videoTrack)===null||_===void 0||_._destroy(),f._videoTrack=void 0);else if(g===Fe.AUDIO){var S;this.unbindRemoteTrackEvents(f._audioTrack),!i&&((S=f._audioTrack)===null||S===void 0||S._destroy(),f._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const d=this.pendingRemoteDataChannels.findIndex(u=>u.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(t,r);if(i.length===0)return;r.forEach(c=>{c._close()});const s=this.remoteDataChannelMap.get(t);return i.forEach(c=>{s&&s.delete(c.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),i.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const u=this.pendingRemoteTracks.filter(f=>{let{user:g,kind:v}=f;return d!==void 0?g.uid===c.uid&&d===v:g.uid===c.uid});u.forEach(f=>{const g=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(g,1)}),r=r.concat(u)}if(!this.connection||this.state!==$t.Connected)return void r.forEach(c=>{let{user:d,kind:u}=c;var f;if(u===Fe.AUDIO)(f=d._audioTrack)===null||f===void 0||f._destroy(),d._audioTrack=void 0;else if(u===Fe.VIDEO){var g;(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0}});const i=qa(t).call(t,(c,d)=>{let{user:u,mediaType:f}=d;const g=this.filterTobeUnSubscribedTracks(u,f);return c.concat(g)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:d}]=c;return d}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[d,{kind:u}]=c;var f,g;if(u===Fe.VIDEO&&d._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),u===Fe.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0;else if(u===Fe.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),(v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0}}),s}isPreSubScribe(t){return!this.connection||this.state!==$t.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(r))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const s=r===Fe.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(r)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Te.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Te.LocalAudioTrack);if((r==null?void 0:r.track)instanceof tr){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==Te.LocalAudioTrack}).filter(s=>{let[c]=s;return!(t&&c===Te.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Te.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,i,s,c){if(t){const u=this.localTrackMap.get(Te.LocalAudioTrack),f=s?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);We.publish(this.store.sessionId,{eventElapse:zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(Ht.SCREEN_TRACK))!==-1,audio:!!u,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;i||(i=[]);const u=i.find(g=>g instanceof kn),f=s?(d=this.localTrackMap.get(Te.LocalVideoTrack))===null||d===void 0?void 0:d.track:i.find(g=>g instanceof an);We.publish(this.store.sessionId,{eventElapse:zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:u==null?void 0:u.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(Ht.SCREEN_TRACK))!==-1,audio:!!u,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,i,s){const c=s===Fe.VIDEO?i._videoSSRC:i._audioSSRC;c&&We.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===Fe.VIDEO,audio:s===Fe.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:zr.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new br("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=tv(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Te.LocalAudioTrack);if((t==null?void 0:t.track)instanceof tr){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=$t.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Te.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Te.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof an||r&&r.track instanceof kn?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r;const i=Array.from(Zr(r=this.remoteUserMap).call(r)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Te.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=iu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=$t.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=tv(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[i,{track:s}]=t;switch(i){case Te.LocalVideoTrack:xe(r=s._hints).call(r,Ht.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Te.LocalAudioTrack:s instanceof tr?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Te.LocalVideoLowTrack:}}),this.emit(Ke.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;Array.from(Zr(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(Ke.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,i]=t;Array.from(Zr(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(r,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const i of this.pendingRemoteDataChannels){const{user:s,id:c}=i;if((t instanceof Zl?t.uid:t)===s.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((t instanceof Zl?t.uid:t)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Ai(function*(){if(!r.connection||r.state!==$t.Connected)return;const i=yield vt(r.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield vt(r.connection.restartICE(t));const d=yield vt(s.next());if(d.done)return;const u=d.value,f=yield u;switch(oO(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Sr.UDP_TCP_RELAY:r._pcStatsUploadType=qc.UDP_TCP_RESTART;break;case Sr.TCP_RELAY:r._pcStatsUploadType=qc.TCP_RESTART;break;case Sr.RELAY:r._pcStatsUploadType=qc.RELAY_RESTART;break;default:r._pcStatsUploadType=qc.OLD_RESTART}r._isTryConnecting=!0,s.next(f)}catch(d){var c;(c=s)===null||c===void 0||c.throw(d)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Te.LocalVideoTrack),i=this.localTrackMap.get(Te.LocalAudioTrack),s=t.videoSend.find(C=>C.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(C=>C.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!c)return 1;const d=da(this,Ke.NeedSignalRTT),u=s?s.rttMs:void 0,f=c?c.rttMs:void 0,g=u&&f?(u+f)/2:u||f,v=(g&&d?(g+d)/2:g||d)||0,_=100*t.sendPacketLossRate*.7/50+.3*v/1500,S=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,w=r==null?void 0:r.track;if(w&&w._encoderConfig&&w._hints.indexOf(Ht.SCREEN_TRACK)===-1){const C=w._encoderConfig.bitrateMax,M=t.bitrate.actualEncoded;if(C&&M){const I=(1e3*C-M)/(1e3*C);return b6[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,d=s._videoSSRC,u=t.audioRecv.find(M=>M.ssrc===c),f=t.videoRecv.find(M=>M.ssrc===d);if(!u&&!f)return void(r+=1);const g=da(this,Ke.NeedSignalRTT),v=t.rtt,_=(v&&g?(v+g)/2:v||g)||0,S=u?u.jitterMs:void 0,w=t.recvPacketLossRate;let C=.7*w*100/50+.3*_/1500;S&&(C=.6*w*100/50+.2*_/1500+.2*S/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new Ie((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}async replaceTrack(t,r){var i;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==$t.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:u}]=d;return t===u});if(!s)return;const c=s[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),s[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,s[1].id)),this.isPlanB){const d=s[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Te.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const d=this.localTrackMap.get(Te.LocalVideoLowTrack);if(d){const u=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=u,d.track._originMediaStreamTrack=u,await new Ie((f,g)=>{this.handleReplaceTrack(d.track,f,g,!0)})}}}filterTobePublishedTracks(t,r,i){const s=[],c=this.getAllTracks();t=Cp(t=t.filter(g=>c.indexOf(g)===-1));let d,u=!1;const f=this.localTrackMap.get(Te.LocalAudioTrack);for(const g of t){if(g instanceof an&&(this.localTrackMap.has(Te.LocalVideoTrack)||u?new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:Te.LocalVideoTrack}),u=!0),r)){const v=this.getLowVideoTrack(g,i);s.push({track:v,type:Te.LocalVideoLowTrack})}if(g instanceof kn)if(f){const v=f.track;if(v instanceof tr)aO([g]),v.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const _=sO([v,g]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(v,_)}}else d instanceof tr?(aO([g]),d.addAudioTrack(g)):d||!g._useAudioElement&&wt().webAudioMediaStreamDest&&!g._bypassWebAudio?d=sO(d?[g,d]:[g]):d=g}return d&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),s.push({track:d,type:Te.LocalAudioTrack})),s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Cp(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof kn){const c=this.localTrackMap.get(Te.LocalAudioTrack);if(!c)continue;c.track instanceof tr?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([Te.LocalAudioTrack,c]),c.track.close())):r.push([Te.LocalAudioTrack,c])}if(s instanceof an){const c=this.localTrackMap.get(Te.LocalVideoTrack);if(!c)continue;r.push([Te.LocalVideoTrack,c]);const d=this.localTrackMap.get(Te.LocalVideoLowTrack);d&&r.push([Te.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=Cp(t)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Cp(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Te.LocalVideoTrack:i.addListener(Ge.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Ge.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof tr?t.trackList.forEach(i=>{i.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Te.LocalVideoTrack:i.off(Ge.GET_STATS,this.handleGetLocalVideoStats),i.off(Ge.GET_RTC_STATS,this.handleGetRTCStats),i.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof tr?t.trackList.forEach(r=>{r.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ge.GET_STATS,this.handleGetLocalAudioStats),r.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ge.GET_STATS,this.handleGetLocalAudioStats),t.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Vp&&r.addListener(Ge.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof Fp&&r.addListener(Ge.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;i.has(Fe.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(Fe.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((i,s)=>{var c;let d,u,{track:f,type:g}=i;switch(g){case Te.LocalAudioTrack:d=qt.Audio,u={dtx:f instanceof Gg&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Te.LocalVideoTrack:d=xe(c=f._hints).call(c,Ht.SCREEN_TRACK)?qt.Screen:qt.High,u=pc(pc({},j6(f)),{},{codec:this.store.codec,svc_mode:Kg()});break;case Te.LocalVideoLowTrack:d=qt.Low,u=pc(pc({},j6(f)),{},{codec:this.store.codec,svc_mode:Kg()})}return{stream_type:d,attributes:u,ssrcs:r[s]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var i;let s,[c,{track:d,ssrcs:u,id:f}]=r;switch(c){case Te.LocalVideoTrack:s=xe(i=d._hints).call(i,Ht.SCREEN_TRACK)?qt.Screen:qt.High;break;case Te.LocalAudioTrack:s=qt.Audio;break;case Te.LocalVideoLowTrack:s=qt.Low}return{stream_type:s,ssrcs:u,mid:f}})}assignLocalTracks(t,r){t.forEach((i,s)=>{let{track:c,type:d}=i;this.localTrackMap.set(d,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Ke.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Pa&&!fn()&&W("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},W("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Pa&&P8(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=qc.DISCONNECTED_OR_FAILED,da(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),s=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));We.reportApiInvoke(this.store.sessionId,{name:yn.REPUB_AFTER_PC_CONNECTED,options:i.concat(s),tag:rn.TRACER}).onSuccess(),this.republish()}if(W("NEW_ICE_RESTART")&&t instanceof Pa&&!fn()&&!this._forceTurn&&!this.store.useDcSignal){if(xe(O6).call(O6,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{oO(t)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),da(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ke.RequestRestartICE,c))},s=()=>{oO(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{D8(t,i,s)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&W("ICE_RESTART")&&da(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ke.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),We.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:rn.TRACER}).onSuccess(),this.emit(Ke.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var i;const s=Array.from(Zr(i=this.remoteUserMap).call(i)).find(d=>d._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(Za.FIRST_FRAME_DECODED),We.firstRemoteFrame(this.store.sessionId,er.FIRST_AUDIO_DECODE,_n.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i;const s=Array.from(Zr(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);s&&We.firstRemoteFrame(this.store.sessionId,er.FIRST_AUDIO_RECEIVED,_n.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{var c;const d=Array.from(Zr(c=this.remoteUserMap).call(c)).find(u=>u._videoSSRC===r);d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,i,s)},t.onFirstVideoRender=r=>{var i;const s=Array.from(Zr(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(s),this.emit(Ke.FirstVideoPreRender,s.uid,r))},t.onFirstVideoReceived=r=>{var i;const s=Array.from(Zr(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstReceived:Date.now()}),We.firstRemoteFrame(this.store.sessionId,er.FIRST_VIDEO_RECEIVED,_n.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstVideoBufferReady=r=>{var i;const s=Array.from(Zr(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&this.emit(Ke.FirstVideoBufferReady,s.uid,r)},t.onSelectedLocalCandidateChanged=(r,i)=>{const s=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(Ke.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Jl(i))," -> ").concat(JSON.stringify(Jl(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Jl(i))," -> ").concat(JSON.stringify(Jl(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return pc(pc({},r),i)},t.onICECandidateError=r=>{this._iceError=r}}fallbackConnection(){R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===$t.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=tv(this.store),this.emit(Ke.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(t){t instanceof Pa&&function(r){ef.delete(r.id),P8(r)}(t),t.close(),this.emit(Ke.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const i=this.localTrackMap.get(Te.LocalAudioTrack);if(t instanceof kn&&(i==null?void 0:i.track)instanceof tr)return i.track.isActive||r.push([Te.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(s&&(r.push(s),s[0]===Te.LocalVideoTrack)){const c=this.localTrackMap.get(Te.LocalVideoLowTrack);c&&r.push([Te.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],i=this.localTrackMap.get(Te.LocalAudioTrack);if(t instanceof kn&&(i==null?void 0:i.track)instanceof tr)return i.track.isActive&&r.push([Te.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(s)if(s[0]===Te.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get(Te.LocalVideoLowTrack);c&&r.push([Te.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(t){return t.map(r=>{var i;let s,[c,{track:d,ssrcs:u,id:f}]=r;switch(c){case Te.LocalAudioTrack:s=qt.Audio;break;case Te.LocalVideoTrack:s=xe(i=d._hints).call(i,Ht.SCREEN_TRACK)?qt.Screen:qt.High;break;case Te.LocalVideoLowTrack:s=qt.Low}return{stream_type:s,ssrcs:u,mid:f}})}createUnmuteMessage(t){return t.map(r=>{var i;let s,[c,{track:d,ssrcs:u,id:f}]=r;switch(c){case Te.LocalAudioTrack:s=qt.Audio;break;case Te.LocalVideoTrack:s=xe(i=d._hints).call(i,Ht.SCREEN_TRACK)?qt.Screen:qt.High;break;case Te.LocalVideoLowTrack:s=qt.Low}return{stream_type:s,ssrcs:u,mid:f}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const c=s.get(r);if(!c)return i;i.push([t,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[d,u]=c;i.push([t,{kind:d,id:u}])});return i}filterTobeUnSubscribedDataChannels(t,r){const i=[];return r.forEach(s=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(t){const r=[];return t.forEach(i=>{let[s,{kind:c,id:d}]=i;switch(c){case Fe.VIDEO:return void(s._videoSSRC&&r.push({stream_type:Fe.VIDEO,ssrcId:s._videoSSRC}));case Fe.AUDIO:return void(s._audioSSRC&&r.push({stream_type:Fe.AUDIO,ssrcId:s._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(i=>{let[s,{kind:c}]=i;if(r.has(s)){let d=r.get(s);c===Fe.VIDEO?d|=hr.Video:d|=hr.Audio,r.set(s,d)}else c===Fe.VIDEO?r.set(s,hr.Video):r.set(s,hr.Audio)}),{users:Array.from(r.entries()).map(i=>{let[s,c]=i;return{stream_id:s.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[i,{kind:s}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Te.LocalVideoTrack),i=this.localTrackMap.get(Te.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new Ie((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),i&&t.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Ie((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof Pa&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Pa)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof Pa&&this.connection.isPreRender}mapPubResToRemoteConfig(t,r,i){return t.map((s,c)=>{var d;let{stream_type:u}=s;const f=(d=r.find(g=>{let{stream_type:v}=g;return u===v}))===null||d===void 0?void 0:d.attributes;if(f&&W("DISABLE_SCREEN_SHARE_REMB")){const g=i[c]._hints;(xe(g).call(g,Ht.SCREEN_TRACK)||xe(g).call(g,Ht.SCREEN_LOW_TRACK))&&(f.remb=!1,R.debug("disable remb for screen share, hints:",g))}return f})}async tryToUnmuteAudio(t){for(let i=0;i<t.length;i++)if(t[i]instanceof kn){var r;const s=this.filterTobeUnmutedTracks(t[i]);if(s.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(s.map(d=>{let[,{id:u}]=d;return u})));const c=this.createUnmuteMessage(s);return void await cn(this,Ke.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Ke.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Ke.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await dr(lE(this.dtlsFailedCount,Bn)),this.emit(Ke.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await qn(this,Ke.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Ke.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof an)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof an).length>1)throw new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof kn).length>1&&(t.some(r=>r instanceof kn&&r._bypassWebAudio)||!wt().webAudioMediaStreamDest))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof an&&this.pendingLocalTracks.some(i=>i instanceof an))throw new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof kn&&this.pendingLocalTracks.some(i=>i instanceof kn)&&(!wt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof kn&&i._bypassWebAudio)))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var i;const s=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding,c=pc(pc({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=s?t._mediaStreamTrack.clone():lO(t,c);const u=Kt(8,"track-low-"),f=new an(d,pc(pc({},s&&{scaleResolutionDownBy:VN(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,u);return f.on(wu.TRANSCEIVER_UPDATED,g=>{t._updateRtpTransceiver(g,Dp.LOW_STREAM)}),f._hints.push(Ht.LOW_STREAM),xe(i=t._hints).call(i,Ht.SCREEN_TRACK)&&f._hints.push(Ht.SCREEN_LOW_TRACK),t.on("sei-to-send",g=>{f.emit("sei-to-send",g)}),t.addListener(Ge.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Pa){var c,d,u,f;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:_,peerConnectionState:S}=this.connection,{local:w,remote:C}=await this.connection.getSelectedCandidatePair();We.pcStats(this.store.sessionId,{startTime:g,eventElapse:t-g||0,iceconnectionsate:v,dtlsstate:_,connectionstate:S,intSucc:r?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(c=w==null?void 0:w.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=w.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(w.address,":").concat(w.port),selectedRemoteCandidateProtocol:(u=C.protocol)!==null&&u!==void 0?u:"",selectedRemoteCandidateType:(f=C.candidateType)!==null&&f!==void 0?f:"",selectedRemoteCandidateAddress:"".concat(C.address,":").concat(C.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const r=this.store.keyMetrics,i=r.firstVideoFrameDecoded.find(_=>_.userId===t.uid);if(!i)return;const{isInternalUpload:s,isExternalUpload:c}=i;if(s&&c)return;const{subscribeEnd:d,firstPreRender:u,peerPublishDuration:f,peerPubStatusMs:g}=i;let{firstRender:v=0}=i;if(d&&(v||u)&&f&&g){i.isInternalUpload=!0;const{playEnd:_}=i;_&&(i.isExternalUpload=!0);const{firstPreRender:S=0}=i;v=S||v;const w=t.videoTrack,C={peer:t._uintid,width:(w==null?void 0:w._videoWidth)||0,height:(w==null?void 0:w._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:f,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:i.userJoinNotify||0,videoAddNotify:i.videoAddNotify||0,subscribeStart:i.subscribeStart||0,subscribeEnd:i.subscribeEnd||0,firstReceived:i.firstReceived||0,firstDecoded:i.firstDecoded||0,firstPreRender:S||0,firstRender:_?Math.max(v,_):Math.max(v,d),playStart:i.playStart||0,playEnd:i.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:n3(this.store),firstReceivedEncodedFrame:i.firstReceivedEncodedFrame||0,frameType:i.frameType||"",rtpTimestamp:i.rtpTimestamp||0,framePayloadType:i.framePayloadType||0,frameDataLength:i.frameDataLength||0,mimeType:i.mimeType||""};We.firstXLAPeerFirstVideoFrame(this.store.sessionId,C)}}reportVideoFirstFrameDecoded(t,r,i,s){var c;const d=Array.from(Zr(c=this.remoteUserMap).call(c)).find(u=>u._videoSSRC===t);if(d){s||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,f=u.subscribe.find(g=>g.userId===d.uid&&g.type==="video");We.firstRemoteVideoDecode(this.store.sessionId,er.FIRST_VIDEO_DECODE,_n.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:i,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:s?1:0,firstFrame:(f==null?void 0:f.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const c=s.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:i}]=t;r===Te.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Dp.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},De(Tt.prototype,"startP2PConnection",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"startP2PConnection"),Tt.prototype),De(Tt.prototype,"connect",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"connect"),Tt.prototype),De(Tt.prototype,"updateRemoteRTPCapabilities",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"updateRemoteRTPCapabilities"),Tt.prototype),De(Tt.prototype,"publishDataChannel",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"publishDataChannel"),Tt.prototype),De(Tt.prototype,"unpublish",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"unpublish"),Tt.prototype),De(Tt.prototype,"unpublishDataChannel",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"unpublishDataChannel"),Tt.prototype),De(Tt.prototype,"unpublishLowStream",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"unpublishLowStream"),Tt.prototype),De(Tt.prototype,"subscribeDataChannel",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"subscribeDataChannel"),Tt.prototype),De(Tt.prototype,"subscribe",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"subscribe"),Tt.prototype),De(Tt.prototype,"massSubscribe",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"massSubscribe"),Tt.prototype),De(Tt.prototype,"unsubscribe",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"unsubscribe"),Tt.prototype),De(Tt.prototype,"unsubscribeDataChannel",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"unsubscribeDataChannel"),Tt.prototype),De(Tt.prototype,"massUnsubscribe",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"massUnsubscribe"),Tt.prototype),De(Tt.prototype,"muteRemote",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"muteRemote"),Tt.prototype),De(Tt.prototype,"unmuteRemote",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"unmuteRemote"),Tt.prototype),De(Tt.prototype,"hasRemoteMediaWithLock",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"hasRemoteMediaWithLock"),Tt.prototype),De(Tt.prototype,"disconnectForReconnect",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"disconnectForReconnect"),Tt.prototype),De(Tt.prototype,"updateBitrateLimit",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"updateBitrateLimit"),Tt.prototype),De(Tt.prototype,"remoteMediaSsrcChanged",[ai],Object.getOwnPropertyDescriptor(Tt.prototype,"remoteMediaSsrcChanged"),Tt.prototype),Tt);function ai(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},i}function j8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function M8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?j8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):j8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const Tve=Date.now(),Cve=20,hO=new Map,ab=new Map;async function U8(t){const r=hO.get(t),i=Array.isArray(r)&&r[r.length-1],s=ab.get(t);if(!i)return void(s.isSyncing=!1);const c={uid:i.uid,payload:i.payload};s.firstRecvTs===0&&(s.firstRecvTs=i.recvTs,s.firstSendTs=i.sendTs);const d=i.sendTs-s.firstSendTs,u=d-(Date.now()-s.firstRecvTs);u>0&&(s.firstRecvTs=Date.now()-d);let f=i.mediaDelay+u;f<=0?(r.pop(),V8(i.context,c),f=0):f=Math.min(f,Cve),setTimeout(()=>r.length&&U8(t),f)}function V8(t,r){t.safeEmit(Et.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function Rve(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return V8(i,{uid:t.uid,payload:t.payload});const s="".concat(i.id,"-").concat(t.uid),c=hO.get(s)||[],d=c.findIndex(v=>t.sendTs>=v.sendTs),u=M8(M8({},t),{},{context:i,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(u):c.splice(d,0,u),hO.set(s,c);let f=!1;var g;ab.has(s)?f=!((g=ab.get(s))===null||g===void 0||!g.isSyncing):ab.set(s,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||U8(s)}const Ave=jt().name;function F8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function B8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?F8(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):F8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const tf="websdk_ng_cache_parameter",Nve=W("MAX_PRELOAD_ASYNC_LENGTH"),Ove=1e4,ju=new Map,Mu=[];let pO=null,fO=0,mO=0;const sb=new Map,W8=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),Ive=function(t,r){const i=[];let s=0;const c=async()=>{const d=i.shift();d&&await d(),i.length>0&&s<r?c():s--};return async function(){for(var d=arguments.length,u=new Array(d),f=0;f<d;f++)u[f]=arguments[f];return new Ie(async(g,v)=>{i.push(async()=>{try{const _=await t(...u);g(_)}catch(_){v(_)}}),s<r&&(s++,c())})}}(vO,Nve),gO=Ni.CancelToken.source();class Pve{constructor(){j(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const r=this._audioContext.sampleRate,i=10*r,s=this._audioContext.createBuffer(2,i,r),c=this._audioContext.createBufferSource();c.buffer=s;const d=this._audioContext.createMediaStreamDestination();return c.connect(d),c.start(),d.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function vO(t,r,i,s,c,d,u){try{if(!W("ENABLE_PRELOAD"))return;if(!wt().supportWebCrypto)return void Hl(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new pe($.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Or(i,"token",1,2047),Or(t,"appid",1,2047),LE(r),s&&jE(s);const f=_u();R.debug("preload channel ".concat(r,", uid is ").concat(s));const g={appId:t,cname:r,token:i||t,uid:typeof s!="string"?s:null,sid:f,proxyServer:c,role:u};let v,_;typeof s=="string"?(g.stringUid=s,[_,v]=await Ie.all([pve(s,{sid:f,appId:t},gO.token),h8(B8(B8({},g),{},{token:i||t,uid:0}),gO.token)]),g.uid=_.uid,v.gatewayInfo.uid=g.uid,v.gatewayInfo.res.uid=g.uid):(d&&(g.stringUid=d),v=await h8(g,gO.token));const S={sid:f,appId:t,cname:r,token:i||t,uid:g.stringUid||s,intUid:g.uid||v.gatewayInfo.uid,stringUid:g.stringUid,ts:Date.now(),sua:_,ap:v};await _O(S),fO++}catch(f){throw mO++,function(g){pO||(pO=window.setTimeout(()=>{let _="";sb.forEach((S,w)=>{_+="".concat(w,": ").concat(S," ;")}),We.reportApiInvoke(null,{name:yn.PRELOAD,options:{success:fO,failed:mO,err:_}}).onError(g),fO=0,mO=0,sb.clear(),pO=null},Ove));const v=sb.get(g.code)||0;sb.set(g.code,v+1)}(f),f}}async function yO(t){try{if(W("AP_REQUEST_DETAIL")||W("ENABLE_ROLE_SELECT_EDGE"))return;const r=G8(t);if(!r||t.cloudProxyServer!=="disabled")return;const i=await async function(s,c){try{const d=await window.crypto.subtle.importKey("raw",O5(c),"AES-GCM",!1,["decrypt"]),u=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:W8},d,yu(s));return JSON.parse(window.atob(zl(new Uint8Array(u))))}catch{return}}(r,t.token||t.appId);if(!i||!function(s,c){return s.cname===c.cname&&s.appId===c.appId&&s.token===c.token?c.stringUid?s.stringUid===c.stringUid:typeof c.uid=="number"?s.uid===c.uid:s.uid==c.uid:!1}(i,t))return;if(i&&Date.now()-i.ts<W("AP_CACHE_LIFETIME"))return i}catch(r){R.warn("Error get preloadInfo",r.message)}}function G8(t){let r;try{if(r=z8(tf),!r)return;const i=JSON.parse(r),s=K8(t),c=function(u,f){for(let g=u.length-1;g>=0;g--)if(f(u[g]))return g;return-1}(i,u=>s in u);if(c===-1)return;const d=i.splice(c,1)[0];return ob(tf,JSON.stringify(i)),d[s]}catch(i){R.warn("Error delete preload info: ".concat(r),i.message),ob(tf,"")}}async function _O(t){let r;try{t.uid&&G8({appId:t.appId,cname:t.cname,token:t.token,uid:t.uid,stringUid:t.stringUid});const i=K8(t),s=await async function(d,u){try{const f=await window.crypto.subtle.importKey("raw",O5(u),"AES-GCM",!1,["encrypt"]),g=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:W8},f,yu(window.btoa(JSON.stringify(d))));return zl(new Uint8Array(g))}catch{return}}(t,t.token||t.appId);if(!s)return;r=z8(tf);const c=r?JSON.parse(r):[];c.push({[i]:s}),c.length>W("AP_CACHE_NUM")&&c.shift(),ob(tf,JSON.stringify(c))}catch(i){R.warn("Error caching server parameters:",i.message),ob(tf,"")}}function EO(t){if(t){let r=ju.get(t);r&&(window.clearTimeout(r),r=null,ju.delete(t)),xe(Mu).call(Mu,t)||t.cloudProxyServer!=="disabled"||Mu.push(t)}if(ju.size<W("AP_CACHE_NUM")&&Mu.length>0){const r=Mu.shift();ju.set(r,window.setTimeout(async()=>{const{appId:i,cname:s,token:c,stringUid:d,uid:u,proxyServer:f,role:g}=r;try{await Ive(i,s,c,u,f,d,g),ju.has(r)&&EO(r)}catch(v){R.warn("update preload failed",v.message),$8(r)}},W("AP_UPDATE_INTERVAL")))}}function $8(t){const r=Mu.indexOf(t);r!==-1&&Mu.splice(r,1);let i=ju.get(t);i&&(window.clearTimeout(i),i=null,ju.delete(t),EO())}function H8(t,r){const i=t.sua,s=t.ap;r&&i&&We.reqUserAccount(t.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:t.intUid,errorCode:null,extend:i.req}),We.reportResourceTiming(t.ap.url,t.sid),We.joinWebProxyAP(t.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Wn.CHOOSE_SERVER,Wn.CLOUD_PROXY_FALLBACK].toString()}),We.joinChooseServer(t.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[Wn.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function z8(t){return window.atob(window.localStorage.getItem(t)||"")}function ob(t,r){window.localStorage.setItem(t,window.btoa(r))}function K8(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),M5(r)}function Dve(t){let r=function(){const i=jve.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,s){let c=i.appId;c!==void 0&&(Gn(s,10),td(s,c));let d=i.cid;d!==void 0&&(Gn(s,16),Gn(s,d));let u=i.cname;u!==void 0&&(Gn(s,26),td(s,u));let f=i.deviceId;f!==void 0&&(Gn(s,34),td(s,f));let g=i.elapse;g!==void 0&&(Gn(s,40),nd(s,g));let v=i.fileSize;v!==void 0&&(Gn(s,48),nd(s,nf(v)));let _=i.height;_!==void 0&&(Gn(s,56),nd(s,nf(_)));let S=i.jpg;S!==void 0&&(Gn(s,66),Gn(s,S.length),q8(s,S));let w=i.networkType;w!==void 0&&(Gn(s,72),nd(s,nf(w)));let C=i.osType;C!==void 0&&(Gn(s,80),nd(s,nf(C)));let M=i.requestId;M!==void 0&&(Gn(s,90),td(s,M));let I=i.sdkVersion;I!==void 0&&(Gn(s,98),td(s,I));let k=i.sequence;k!==void 0&&(Gn(s,104),nd(s,nf(k)));let G=i.sid;G!==void 0&&(Gn(s,114),td(s,G));let K=i.timestamp;K!==void 0&&(Gn(s,120),nd(s,K));let X=i.uid;X!==void 0&&(Gn(s,128),Gn(s,X));let te=i.vid;te!==void 0&&(Gn(s,136),Gn(s,te));let ne=i.width;ne!==void 0&&(Gn(s,144),nd(s,nf(ne)));let Z=i.service;Z!==void 0&&(Gn(s,152),Gn(s,Z));let ie=i.callbackData;ie!==void 0&&(Gn(s,162),Gn(s,ie.length),q8(s,ie));let ge=i.ticket;ge!==void 0&&(Gn(s,170),td(s,ge));let Ee=i.vendorConfigs;Ee!==void 0&&(Gn(s,178),td(s,Ee))}(t,r),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(r)}function kve(t){return function(i){let s={};e:for(;!Mve(i);){let c=rv(i);switch(c>>>3){case 0:break e;case 1:s.code=rv(i);break;case 2:s.msg=X8(i,rv(i));break;case 3:s.requestId=X8(i,rv(i));break;case 4:s.timestamp=Uve(i,!1);break;default:Lve(i,7&c)}}return s}({bytes:r=t,offset:0,limit:r.length});var r}function Lve(t,r){switch(r){case 0:for(;128&Ms(t););break;case 2:bO(t,rv(t));break;case 5:bO(t,4);break;case 1:bO(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function nf(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let jve=[];function bO(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function Mve(t){return t.offset>=t.limit}function cb(t,r){let i=t.bytes,s=t.offset,c=t.limit,d=s+r;if(d>i.length){let u=new Uint8Array(2*d);u.set(i),t.bytes=u}return t.offset=d,d>c&&(t.limit=d),s}function Y8(t,r){let i=t.offset;if(i+r>t.limit)throw new Error("Read past limit");return t.offset+=r,i}function q8(t,r){let i=cb(t,r.length);t.bytes.set(r,i)}function X8(t,r){let i=Y8(t,r),s=String.fromCharCode,c=t.bytes,d="",u="";for(let f=0;f<r;f++){let g,v,_,S,w=c[f+i];128&w?(224&w)==192?f+1>=r?u+=d:(g=c[f+i+1],(192&g)!=128?u+=d:(S=(31&w)<<6|63&g,S<128?u+=d:(u+=s(S),f++))):(240&w)==224?f+2>=r?u+=d:(g=c[f+i+1],v=c[f+i+2],(49344&(g|v<<8))!=32896?u+=d:(S=(15&w)<<12|(63&g)<<6|63&v,S<2048||S>=55296&&S<=57343?u+=d:(u+=s(S),f+=2))):(248&w)==240?f+3>=r?u+=d:(g=c[f+i+1],v=c[f+i+2],_=c[f+i+3],(12632256&(g|v<<8|_<<16))!=8421504?u+=d:(S=(7&w)<<18|(63&g)<<12|(63&v)<<6|63&_,S<65536||S>1114111?u+=d:(S-=65536,u+=s(55296+(S>>10),56320+(1023&S)),f+=3))):u+=d:u+=s(w)}return u}function td(t,r){let i=r.length,s=0;for(let u=0;u<i;u++){let f=r.charCodeAt(u);f>=55296&&f<=56319&&u+1<i&&(f=(f<<10)+r.charCodeAt(++u)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}Gn(t,s);let c=cb(t,s),d=t.bytes;for(let u=0;u<i;u++){let f=r.charCodeAt(u);f>=55296&&f<=56319&&u+1<i&&(f=(f<<10)+r.charCodeAt(++u)-56613888),f<128?d[c++]=f:(f<2048?d[c++]=f>>6&31|192:(f<65536?d[c++]=f>>12&15|224:(d[c++]=f>>18&7|240,d[c++]=f>>12&63|128),d[c++]=f>>6&63|128),d[c++]=63&f|128)}}function Ms(t){return t.bytes[Y8(t,1)]}function J8(t,r){let i=cb(t,1);t.bytes[i]=r}function rv(t){let r,i=0,s=0;do r=Ms(t),i<32&&(s|=(127&r)<<i),i+=7;while(128&r);return s}function Gn(t,r){for(r>>>=0;r>=128;)J8(t,127&r|128),r>>>=7;J8(t,r)}function Uve(t,r){let i,s=0,c=0,d=0;return i=Ms(t),s=127&i,128&i&&(i=Ms(t),s|=(127&i)<<7,128&i&&(i=Ms(t),s|=(127&i)<<14,128&i&&(i=Ms(t),s|=(127&i)<<21,128&i&&(i=Ms(t),c=127&i,128&i&&(i=Ms(t),c|=(127&i)<<7,128&i&&(i=Ms(t),c|=(127&i)<<14,128&i&&(i=Ms(t),c|=(127&i)<<21,128&i&&(i=Ms(t),d=127&i,128&i&&(i=Ms(t),d|=(127&i)<<7))))))))),{low:s|c<<28,high:c>>>4|d<<24,unsigned:r}}function nd(t,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,u=cb(t,d),f=t.bytes;switch(d){case 10:f[u+9]=c>>>7&1;case 9:f[u+8]=d!==9?128|c:127&c;case 8:f[u+7]=d!==8?s>>>21|128:s>>>21&127;case 7:f[u+6]=d!==7?s>>>14|128:s>>>14&127;case 6:f[u+5]=d!==6?s>>>7|128:s>>>7&127;case 5:f[u+4]=d!==5?128|s:127&s;case 4:f[u+3]=d!==4?i>>>21|128:i>>>21&127;case 3:f[u+2]=d!==3?i>>>14|128:i>>>14&127;case 2:f[u+1]=d!==2?i>>>7|128:i>>>7&127;case 1:f[u]=d!==1?128|i:127&i}}const Q8={},Z8={},lb=4294967296,Vve=lb*lb,eW=Vve/2;nW(0,!0);const tW=nW(0),Fve=iv(0,-2147483648,!1),Bve=iv(-1,2147483647,!1);function nW(t,r){let i,s,c;return r?(c=0<=(t>>>=0)&&t<256)&&(s=Z8[t],s)?s:(i=iv(t,0,!0),c&&(Z8[t]=i),i):(c=-128<=(t|=0)&&t<128)&&(s=Q8[t],s)?s:(i=iv(t,t<0?-1:0,!1),c&&(Q8[t]=i),i)}function iv(t,r,i){return{low:0|t,high:0|r,unsigned:!!i}}function rW(t,r){if(isNaN(t))return tW;{if(t<=-eW)return Fve;if(t+1>=eW)return Bve}return t<0?tW:iv(t%lb|0,t/lb|0,r)}function iW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class SO extends Sn{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Eo.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),j(this,"name","AgoraRTCImageModeration"),j(this,"_connectionState",ns.CONNECTING),j(this,"_sequence",0),j(this,"_moderationStartTime",void 0),j(this,"_workerConnection",void 0),j(this,"_workerMessageLengthLimit",void 0),j(this,"_qualityRatio",void 0),j(this,"_connectInfo",void 0),j(this,"_cancelTokenSource",Ni.CancelToken.source()),j(this,"_retryConfig",void 0),j(this,"_moderationInterval",void 0),j(this,"_moderationTimer",null),j(this,"_moderationMode",1),j(this,"_quality",1),j(this,"_qualityTimer",null),j(this,"_ticket",void 0),j(this,"_moderationIntervalMinimum",void 0),j(this,"_uploadFailedNum",0),j(this,"_uploadNum",0),j(this,"_uploadTimer",null),j(this,"_extraInfo",void 0),j(this,"_vendor",""),j(this,"_encoder",new TextEncoder),j(this,"_moderationId",void 0),j(this,"inspectImage",()=>{if(this.connectionState!==ns.CONNECTED)throw new se($.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ns.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Kt(5,"image-moderation-"),this._workerMessageLengthLimit=W("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=W("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=W("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Hg("worker-"+this._moderationId,Bn),this.on(Eo.STATE_CHANGE,(s,c)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat($p[s]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(Eo.STATE_CHANGE,$p.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=i,new Ie((c,d)=>{this.on(Eo.CONNECTION_STATE_CHANGE,(u,f)=>{u===ns.CONNECTED&&c()}),this.requestAP(r,s,i).then(u=>{this.connectWorker(u)}).catch(u=>{d(u)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===ns.CONNECTED&&this.inspectImage()}async requestAP(r,i,s){const c=W("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),d=await function(g,v,_,S){let{appId:w,areaCode:C,cname:M,sid:I,token:k,uid:G}=v;qp++;const K="moderation_plugin",X={service_name:K,json_body:JSON.stringify({appId:w,areaCode:C,cname:M,command:"allocateEdge",requestId:qp,seq:qp,sid:I,appToken:k,ts:Date.now(),uid:G+""})};let te,ne,Z=g[0];return go(async()=>{te=Date.now();const ie=await So(Z,{data:X,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ne=Date.now()-te,ie.code!==0){const tt=new se($.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ie.code,{retry:!0,responseTime:ne});throw R.error(tt.toString()),tt}const ge=JSON.parse(ie.json_body);if(ge.code!==200){const tt=new se($.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ge.code,", reason: ").concat(ge.reason),{code:ge.code,responseTime:ne});throw R.error(tt.toString()),tt}if(!ge.servers||!Array.isArray(ge.servers)||ge.servers.length===0){const tt=new se($.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ge.code,responseTime:ne});throw R.error(tt.toString()),tt}if(!ge.servers.some(tt=>!!tt.wss)){const tt=new se($.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ge.code,responseTime:ne});throw R.error(tt.toString()),tt}const Ee=W("IMAGE_MODERATION_WORKER_WSS");if(Ee)return{addressList:[Ee],workerToken:ge.workerToken,vid:ge.vid,responseTime:ne};const Me=W("IMAGE_MODERATION_WORKER_HOST");return{addressList:ge.servers.map(tt=>{let{address:mt,wss:ht}=tt;if(mt&&ht)return"wss://".concat(mt.replace(/\./g,"-"),".").concat(Me,":").concat(ht,"/moderation")}).filter(tt=>!!tt),workerToken:ge.workerToken,vid:ge.vid,ticket:ge.appTicket,responseTime:ne}},(ie,ge)=>(We.apworkerEvent(I,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(ie.addressList),firstSuccess:ge===0,responseTime:ne,serverIp:g[ge%g.length]}),!1),(ie,ge)=>(We.apworkerEvent(I,{success:!1,sc:ie.data&&ie.data.code||200,serviceName:K,responseTime:ne,serverIp:g[ge%g.length]}),!!(ie.code!==$.OPERATION_ABORTED&&ie.code!==$.UNEXPECTED_RESPONSE||ie.data&&ie.data.retry)&&(Z=g[(ge+1)%g.length],!0)),S)}(c,r,i,s);this.emit(Eo.STATE_CHANGE,$p.AP_CONNECTED);const{addressList:u,ticket:f}=d;return this._ticket=f,u}async connectWorker(r){this.emit(Eo.STATE_CHANGE,$p.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(pt.CONNECTED,async()=>{this.emit(Eo.STATE_CHANGE,$p.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ns.CONNECTED}),this._workerConnection.on(pt.CLOSED,()=>{this.connectionState=ns.CLOSED}),this._workerConnection.on(pt.FAILED,()=>{this.connectionState=ns.CLOSED}),this._workerConnection.on(pt.RECONNECTING,()=>{this.connectionState=this.connectionState===ns.CONNECTED?ns.RECONNECTING:ns.CONNECTING}),this._workerConnection.on(pt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=kve(new Uint8Array(r.data));W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{We.reportApiInvoke(this._connectInfo.sid||null,{name:yn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:rn.TRACER}).onError(new se($.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},W("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(pt.WILL_RECONNECT,(r,i,s)=>{r==="recover"&&s(r),s("tryNext")}),this._workerConnection.on(pt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=da(this,Eo.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(r,i);this._workerConnection.sendMessage(s,!0,!0)}else W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:s,cname:c,cid:d,vid:u,sid:f,uid:g}=i;const v=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),S=await A3(_,s,c),w=this._sequence+"-"+d+"-"+g+"-"+v+"-"+Kt(12,""),C={appId:s,cid:d,cname:c,deviceId:"",elapse:SO.intToLong(Number(v-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:S,networkType:6,osType:7,requestId:w,sdkVersion:"4.24.2",sequence:this._sequence,sid:f,timestamp:rW(v),uid:g,vid:u,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete C.callbackData;const M=Dve(C);if(M.byteLength<this._workerMessageLengthLimit){if(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(k){for(var G=1;G<arguments.length;G++){var K=arguments[G]!=null?arguments[G]:{};G%2?iW(Object(K),!0).forEach(function(X){j(k,X,K[X])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(K)):iW(Object(K)).forEach(function(X){Object.defineProperty(k,X,Object.getOwnPropertyDescriptor(K,X))})}return k}({},C);delete I.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return M}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(r,{appId:s,cname:c,cid:d,vid:u,sid:f,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ni.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ns.CLOSED,this.emit(Eo.STATE_CHANGE,$p.CLOSED)}}function aW(t){if(nn(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new se($.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new se($.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Wve={name:"ImageModeration",create:function(t){let{config:r}=t;return aW(r),new SO(r)}};var sW,oW,cW,lW,dW,uW,hW,pW,fW,mW,gW,vW,yW,_W,EW,bW,SW,wW,xW,TW,CW,RW,AW,NW,OW,IW,PW,DW,kW,LW,jW,MW,UW,VW,FW,BW,WW,GW,$W,HW,zW,KW,Ue;function YW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Us(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?YW(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):YW(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}br.setLogger(R);let Gve=(sW=Qe(),oW=Qe({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof jp))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),cW=Qe({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Lp.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),lW=Qe({argsMap:(t,r,i,s)=>[typeof r=="object"?r.uid:r,i,s]}),dW=Qe({argsMap:(t,r,i)=>[r,i]}),uW=Qe({argsMap:(t,r)=>r.map(i=>{let{user:s,mediaType:c}=i;return[s==null?void 0:s.uid,c]})}),hW=Qe({argsMap:(t,r,i,s)=>[typeof r=="object"?r.uid:r,i,s]}),pW=Qe({argsMap:(t,r)=>r.map(i=>{let{user:s,mediaType:c}=i;return{uid:s==null?void 0:s.uid,mediaType:c}})}),fW=Qe(),mW=Qe(),gW=Qe(),vW=Qe(),yW=Qe(),_W=Qe(),EW=Qe(),bW=Qe(),SW=Qe(),wW=Qe(),xW=Qe(),TW=Qe(),CW=Qe(),RW=Qe(),AW=Qe(),NW=Qe(),OW=Qe({argsMap:(t,r)=>[r]}),IW=Qe(),PW=Qe(),DW=Qe(),kW=Qe(),LW=Qe(),jW=Qe(),MW=Qe(),UW=Qe(),VW=Qe({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),FW=Qe(),BW=Qe(),WW=Qe(),GW=Qe(),$W=Qe(),HW=Qe(),zW=Qe({reportResult:!0}),KW=Qe(),Ue=class extends Sn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let i;if(super(),j(this,"store",void 0),j(this,"_uid",void 0),j(this,"_channelName",void 0),j(this,"_uintUid",void 0),j(this,"_users",[]),j(this,"_config",void 0),j(this,"_clientId",void 0),j(this,"_appId",void 0),j(this,"_sessionId",null),j(this,"_key",void 0),j(this,"_rtmConfig",{}),j(this,"_joinInfo",void 0),j(this,"_gateway",void 0),j(this,"_statsCollector",void 0),j(this,"_configDistribute",void 0),j(this,"_leaveMutex",void 0),j(this,"_publishMutex",void 0),j(this,"_renewTokenMutex",void 0),j(this,"_subscribeMutex",void 0),j(this,"_encryptionMode","none"),j(this,"_encryptionSecret",null),j(this,"_encryptionSalt",null),j(this,"_encryptDataStream",!1),j(this,"_encryptDataStreamKey",null),j(this,"_encryptDataStreamIv",null),j(this,"_proxyServer",void 0),j(this,"_turnServer",{servers:[],mode:"auto"}),j(this,"_cloudProxyServerMode","disabled"),j(this,"_isDualStreamEnabled",!1),j(this,"_defaultStreamFallbackType",void 0),j(this,"_lowStreamParameter",void 0),j(this,"_streamFallbackTypeCacheMap",new Map),j(this,"_remoteStreamTypeCacheMap",new Map),j(this,"_axiosCancelSource",Ni.CancelToken.source()),j(this,"_audioVolumeIndicationInterval",void 0),j(this,"_networkQualityInterval",void 0),j(this,"_userOfflineTimeout",void 0),j(this,"_streamRemovedTimeout",void 0),j(this,"_rteDetailInterval",void 0),j(this,"_liveTranscodeStreamingClient",void 0),j(this,"_liveRawStreamingClient",void 0),j(this,"_channelMediaRelayClient",void 0),j(this,"_networkQualitySensitivity","normal"),j(this,"_p2pChannel",void 0),j(this,"_useLocalAccessPoint",!1),j(this,"_setLocalAPVersion",void 0),j(this,"_joinAndNotLeaveYet",!1),j(this,"_numberOfJoinCount",0),j(this,"_joinResponse",null),j(this,"_remoteDefaultVideoStreamType",void 0),j(this,"_inspect",void 0),j(this,"_moderation",void 0),j(this,"_license",void 0),j(this,"_pendingPublishedUsers",[]),j(this,"ntpAlignErrorCount",0),j(this,"remoteInboundOffset",0),j(this,"_peerConnectionState",void 0),j(this,"_pendingRtpCapabilityChange",void 0),j(this,"_fallbackServerInfo",void 0),j(this,"_dualStreamMode",void 0),j(this,"_handleLocalTrackEnable",(c,d,u)=>{this.publish(c,!1).then(d).catch(u)}),j(this,"_handleLocalTrackDisable",(c,d,u)=>{this.unpublish(c).then(d).catch(u)}),j(this,"_handleUserOnline",c=>{if(W("BLOCK_LOCAL_CLIENT")&&Nu(c.uid,this.channelName))return void R.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(u=>u.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Et.USER_JOINED,d));else{const u=new Zl(c.uid,c.uint_id||c.uid);this._users.push(u),R.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(u.uid,{userJoinNotify:Date.now()}),this.safeEmit(Et.USER_JOINED,u)}}),j(this,"_handleUserOffline",c=>{if(W("BLOCK_LOCAL_CLIENT")&&Nu(c.uid,this.channelName))return;const d=this._users.find(u=>u.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:oE(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),R.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Et.USER_LEAVED,d,c.reason))}),j(this,"_handleAddAudioOrVideoStream",(c,d,u,f,g,v,_,S)=>{if(W("BLOCK_LOCAL_CLIENT")&&Nu(d,this.channelName))return;const w=this._users.find(I=>I.uid===d);if(!w)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(w.uid,{videoAddNotify:Date.now()});const C=c==="audio"?w.hasAudio:w.hasVideo;w._uintid||(w._uintid=v||d),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,u!==void 0&&(w._audioSSRC=u),f!==void 0&&(w._cname=f),_&&(w._audioOrtc=_)):(w._video_added_=!0,u!==void 0&&(w._videoSSRC=u),f!==void 0&&(w._cname=f),S!==void 0&&(w._rtxSsrcId=S),_&&(w._videoOrtc=_)),(c==="audio"?w.hasAudio:w.hasVideo)&&!C&&(R.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(Et.USER_PUBLISHED,w,c)),c==="video"?We.onGatewayStream(this._sessionId,er.ON_ADD_VIDEO_STREAM,_n.ON_ADD_VIDEO_STREAM,{peer:v||d,ssrc:w._videoSSRC}):We.onGatewayStream(this._sessionId,er.ON_ADD_AUDIO_STREAM,_n.ON_ADD_AUDIO_STREAM,{peer:v||d,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,u).then(I=>{if(I&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Lu))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(k=>{R.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(I=>{R.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}));const M=this._getEncodingName(g);c==="video"&&(M==="unknown"?this.safeEmit(Et.AV1_DECODABLE_RESULT,!1):Er()||Qr()||(M==null?void 0:M.toLocaleLowerCase())!==bu.av1||hve().then(I=>{W("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Et.AV1_DECODABLE_RESULT,I),I||this._gateway.downgradeCodec(M)}))}),j(this,"_handleRemoveStream",c=>{if(W("BLOCK_LOCAL_CLIENT")&&Nu(c.uid,this.channelName))return;const d=this._users.find(f=>f.uid===c.uid);if(!d)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let u=()=>{};d.hasAudio&&d.hasVideo?u=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Et.USER_UNPUBLISHED,d,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Et.USER_UNPUBLISHED,d,"video")}:d.hasVideo?u=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Et.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(u=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Et.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof Lu&&this._p2pChannel.unsubscribe(d).then(f=>{if(f)return this._gateway.unsubscribe(f,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),We.onGatewayStream(this._sessionId,er.ON_REMOVE_STREAM,_n.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),u()}),j(this,"_handleSetStreamLocalEnable",(c,d,u)=>{if(W("BLOCK_LOCAL_CLIENT")&&Nu(d,this.channelName))return;const f=this._users.find(_=>_.uid===d);if(!f)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(u?"enabled":"disabled"," with uid ").concat(d));const g=c==="audio"?f.hasAudio:f.hasVideo;if(c==="audio"){f._trust_audio_enabled_state_=!0;const _=f._audio_enabled_;if(f._audio_enabled_=u,f._audio_enabled_===_)return;{const S=f._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(S)),this.safeEmit(Et.USER_INFO_UPDATED,d,S)}}else{f._trust_video_enabled_state_=!0;const _=f._video_enabled_;if(f._video_enabled_=u,f._video_enabled_===_)return;{const S=f._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(S)),this.safeEmit(Et.USER_INFO_UPDATED,d,S)}}const v=c==="audio"?f.hasAudio:f.hasVideo;return g!==v?!g&&v?(R.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(Et.USER_PUBLISHED,f,c)):(c==="video"&&f._videoTrack&&f._videoTrack._destroy(),c==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,c),R.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(Et.USER_UNPUBLISHED,f,c)):void 0}),j(this,"_handleMuteStream",(c,d,u)=>{if(W("BLOCK_LOCAL_CLIENT")&&Nu(c,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),c,d,u);const f=this._users.find(_=>_.uid===c);if(!f)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=d==="audio"?f.hasAudio:f.hasVideo;if(d==="audio"){f._trust_audio_mute_state_=!0;const _=f._audio_muted_;if(f._audio_muted_=u,f._audio_muted_===_)return;{const S=f._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(S)),this.safeEmit(Et.USER_INFO_UPDATED,c,S)}}else{f._trust_video_mute_state_=!0;const _=f._video_muted_;if(f._video_muted_=u,f._video_muted_===_)return;{const S=f._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(S)),this.safeEmit(Et.USER_INFO_UPDATED,c,S)}}const v=d==="audio"?f.hasAudio:f.hasVideo;if(g!==v){if(!g&&v)return(d==="audio"?f._audioSSRC:f._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(Et.USER_PUBLISHED,f,d)):void R.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),d==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,d),R.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(Et.USER_UNPUBLISHED,f,d)}}),j(this,"_handleP2PLost",async c=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),j(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Et.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),j(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),j(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Et.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Et.NETWORK_QUALITY,c)}),j(this,"_handleP2PAddAudioOrVideoStream",(c,d,u,f)=>{const g=this._users.find(_=>_.uid===d);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,u!==void 0&&(g._audioSSRC=u),f!==void 0&&(g._audioMid=f)):(g._video_added_=!0,u!==void 0&&(g._videoSSRC=u),f!==void 0&&(g._videoMid=f)),(c==="audio"?g.hasAudio:g.hasVideo)&&!v&&(R.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Et.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(_=>{R.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=t,this._clientId=r||Kt(5,"client-"),this.store=new class{constructor(c,d,u,f,g){dt(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:u,clientId:f,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Eu.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!g}}dispatch(c){this.state=function(d,u){switch(u.type){case st.SET_SESSION_ID:return Ae(Ae({},d),{},{sessionId:u.sessionId});case st.SET_P2P_ID:return Ae(Ae({},d),{},{p2pId:u.p2pId});case st.SET_UID:return Ae(Ae({},d),{},{uid:u.uid});case st.SET_INT_UID:return Ae(Ae({},d),{},{intUid:u.intUid});case st.SET_PUB_ID:return Ae(Ae({},d),{},{pubId:u.pubId});case st.KEY_METRIC_CLIENT_CREATED:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{clientCreated:u.metric})});case st.KEY_METRIC_JOIN_START:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{joinStart:u.metric})});case st.KEY_METRIC_PRELOAD_START:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{preloadStart:u.metric})});case st.KEY_METRIC_PRELOAD_END:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{preloadEnd:u.metric})});case st.KEY_METRIC_JOIN_END:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{joinEnd:u.metric})});case st.KEY_METRIC_REQUEST_AP_START:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{requestAPStart:u.metric})});case st.KEY_METRIC_REQUEST_AP_END:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{requestAPEnd:u.metric})});case st.KEY_METRIC_REQUEST_SUA_END:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{requestSUAEnd:u.metric})});case st.KEY_METRIC_BEFORE_CONNECT:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{beforeConnect:u.metric})});case st.KEY_METRIC_PEER_RECEIVER:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{peerReceiver:u.metric})});case st.KEY_METRIC_SIGNAL_CONNECTED:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{signalConnected:u.metric})});case st.KEY_METRIC_JOIN_REQ:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{joinReq:u.metric})});case st.KEY_METRIC_JOIN_REP:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{joinRep:u.metric})});case st.KEY_METRIC_JOIN_GATEWAY_START:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{joinGatewayStart:u.metric})});case st.KEY_METRIC_JOIN_GATEWAY_END:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{joinGatewayEnd:u.metric})});case st.KEY_METRIC_PEER_CONNECTION_START:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{peerConnectionStart:u.metric})});case st.KEY_METRIC_PEER_CONNECTION_END:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{peerConnectionEnd:u.metric})});case st.KEY_METRIC_DESCRIPTION_START:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{descriptionStart:u.metric})});case st.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{signalChannelOpen:u.metric})});case st.KEY_METRIC_ICE_CONNECTION_END:return Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{iceConnectionEnd:u.metric})});case st.KEY_METRIC_PUBLISH:{const f=d.keyMetrics.publish,g=f.findIndex(v=>v.trackId===u.metric.trackId);return g!==-1?(f[g]=Ae(Ae({},f[g]),u.metric),Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{publish:[...f]})})):Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,u.metric]})})}case st.KEY_METRIC_SUBSCRIBE:{const f=d.keyMetrics.subscribe,g=f.findIndex(v=>v.userId===u.metric.userId&&v.type===u.metric.type);return g!==-1?(f[g]=Ae(Ae({},f[g]),u.metric),Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{subscribe:[...f]})})):Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,u.metric]})})}case st.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const f=d.keyMetrics.firstVideoFrameDecoded,g=f.findIndex(v=>v.userId===u.metric.userId);return g!==-1?(f[g]=Ae(Ae({},f[g]),u.metric),Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{firstVideoFrameDecoded:[...f]})})):Ae(Ae({},d),{},{keyMetrics:Ae(Ae({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,u.metric]})})}case st.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case st.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=u.mode,d;case st.RECORD_JOIN_CHANNEL_SERVICE:return typeof u.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,u.record]:(d.joinChannelServiceRecords[u.index]=Ae(Ae({},d.joinChannelServiceRecords[u.index]),u.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case st.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case st.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case st.SET_USE_P2P:return Ae(Ae({},d),{},{useP2P:u.val});case st.SET_TRANSPORT_TYPE:return Ae(Ae({},d),{},{p2pTransport:u.val});case st.SET_RTE_URL:return Ae(Ae({},d),{},{rteUrl:u.rteUrl});case st.SET_RTE_SID:return Ae(Ae({},d),{},{rteSid:u.rteSid});default:return d}}(this.state,c)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(c){this.state.useDcSignal=c}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(c){this.state.networkQualityProbe=c}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(c){this.dispatch({type:st.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set rteUrl(c){this.dispatch({type:st.SET_RTE_URL,rteUrl:c})}get rteUrl(){return this.state.rteUrl}set rteSid(c){this.dispatch({type:st.SET_RTE_SID,rteSid:c})}get rteSid(){return this.state.rteSid}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:st.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:st.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:st.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:st.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:st.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:st.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:st.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:st.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:st.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:st.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:st.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:st.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:st.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:st.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:st.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:st.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:st.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:st.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:st.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:st.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:st.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:st.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:st.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:st.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:st.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:st.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Ae({userId:c},d)})}descriptionStart(){this.dispatch({type:st.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:st.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:st.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,u,f){this.dispatch({type:st.KEY_METRIC_PUBLISH,metric:Ae(Ae({trackId:c,type:d},u&&{publishStart:u}),f&&{publishEnd:f})})}subscribe(c,d,u,f,g,v,_){this.dispatch({type:st.KEY_METRIC_SUBSCRIBE,metric:Ae(Ae(Ae(Ae(Ae({userId:c,type:d},u&&{subscribeStart:u}),f&&{subscribeEnd:f}),g&&{firstFrame:g}),v&&{streamAdded:v}),_&&{firstDecoded:_})})}massSubscribe(c,d,u,f){c.forEach(g=>{this.dispatch({type:st.KEY_METRIC_SUBSCRIBE,metric:Ae(Ae(Ae({userId:g.userId,type:g.type},d&&{subscribeStart:d}),u&&{subscribeEnd:u}),f&&{firstFrame:f})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(u=>u.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:st.RECORD_JOIN_CHANNEL_SERVICE,record:Ae(Ae({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:st.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:st.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:st.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:st.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId,W("SIGNAL_CHANNEL")===1),this._leaveMutex=new br("client-leave",this._clientId),this._publishMutex=new br("client-publish",this._clientId),this._renewTokenMutex=new br("client-renewtoken",this._clientId),this._subscribeMutex=new br("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ja," build: ").concat(JA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{jA(t.clientRoleOptions),i=Object.assign({},t.clientRoleOptions)}catch(c){R.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var s;this._statsCollector=new ev(this.store),this._statsCollector.onStatsException=(c,d,u)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(u)),c===tO.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(f=>{f instanceof xE&&W("ENABLE_ENCODE_EXCEPTION")&&f.findClosestProfile()}),this.safeEmit(Et.EXCEPTION,{code:c,msg:d,uid:u})},this._statsCollector.onUploadPublishDuration=(c,d,u,f)=>{const g=this._users.find(v=>v.uid===c);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g.uid,{peerPublishDuration:u,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),We.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:d,videoPublishDuration:u,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(W("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const d=this.localTracks.find(u=>u instanceof an);d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?W("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new sve(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Bn,httpRetryConfig:t.httpRetryConfig||Bn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:i}),this._configDistribute=new vve(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},bo("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new Lu(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,i,s,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],u=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Zt("JOIN_GATEWAY_USE_443PORT_ONLY",d),Zt("JOIN_GATEWAY_USE_DUAL_DOMAIN",u);const f=this._gateway.signal.websocket;return f instanceof jN&&(f.use443PortOnly=d,f.tryDoubleDomain=u),async function(g,v,_){rE.get(g)||rE.set(g,[]),iE.get(g)||iE.set(g,v),rc.get(g)||rc.set(g,0);const S=rE.get(g),w=iE.get(g);if(!S||!w)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(rc.get(g)===w){const G=Pg();S.push(G),await G.promise}rc.set(g,rc.get(g)+1);for(var C=arguments.length,M=new Array(C>3?C-3:0),I=3;I<C;I++)M[I-3]=arguments[I];const k=await _(...M);return rc.set(g,rc.get(g)-1),rc.get(g)===w-1&&S.length>0&&(S[0].resolve(),S.shift()),rc.get(g)===0&&(rE.set(g,[]),iE.set(g,0),rc.set(g,0)),k}("client.join",W("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,i,s,c)}async join(t,r,i,s,c){const d=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const u=(dE||dE||(dE=(window.location.protocol.split(":")[0]||"").toUpperCase(),dE))==="HTTPS",f=V5()?window.isSecureContext:"Browser Not Support";(!V5()&&!u||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;We.setAppId(t);try{if(!i&&i!==null)throw new se($.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));if(i&&Or(i,"token",1,2047),Or(t,"appid",1,2047),LE(r),s&&jE(s),c)if(typeof c=="string")Or(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new se($.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:k,enableInstantMuteRestore:G,networkQualityProbe:K}=c;k&&(As(k,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(k)),this.store.autoSubscribe=k),G&&(As(G,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(G)),this.store.enableInstantMuteRestore=G),K&&(As(K,"networkQualityProbe"),R.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(K)),this.store.networkQualityProbe=K)}}}catch(k){throw We.reportApiInvoke(_u(),{name:yn.JOIN,options:[t,r,i,s],states:{isHttps:u,isSecureContext:f},tag:rn.TRACER}).onError(k),k}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const k=new se($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw We.reportApiInvoke(_u(),{name:yn.JOIN,options:[t,r,i,s],states:{isHttps:u,isSecureContext:f},tag:rn.TRACER}).onError(k),k}this._gateway.state="CONNECTING",this.store.preloadStart();const v=await yO({appId:t,cname:r,uid:s,stringUid:typeof s=="string"?s:void 0,token:i||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new se($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const _=(v==null?void 0:v.sid)||_u();R.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId);const S=We.reportApiInvoke(this._sessionId,{id:this._clientId,name:yn.JOIN,options:[t,r,i,s],states:{isHttps:u,isSecureContext:f},tag:rn.TRACER}),w=Us(Us(Us({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!v},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:W("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(w.stringUid=s,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async k=>{const G=function(ne){const Z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ie=new Uint8Array(new ArrayBuffer(Z.length));for(let ge=0;ge<Z.length;ge+=1)ie[ge]=Z.charCodeAt(ge);return ie}(),K=await window.crypto.subtle.importKey("spki",G,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),X=kA(k),te=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},K,X);return function(ne){let Z="";for(let ie=0;ie<ne.length;ie+=1)Z+=String.fromCharCode(ne[ie]);return window.btoa(Z)}(new Uint8Array(te))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new se($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const k=new TextEncoder,G=W("USE_PURE_ENCRYPTION_MASTER_KEY")?k.encode(w.appId+this._encryptionSecret+this._encryptionSecret):k.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(K,X,te){const ne=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=K==="aes-128-gcm2"?128:256,ie=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:q5,hash:"SHA-256",salt:te},ne,Z+Ume);return new Uint8Array(ie).subarray(Z/8)}(this._encryptionMode,G,yu(this._encryptionSalt)),this._encryptDataStreamKey=await async function(K,X,te){const ne=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=K==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:q5,hash:"SHA-256",salt:te},ne,{name:"AES-GCM",length:Z},!0,["encrypt","decrypt"])}(this._encryptionMode,G,yu(this._encryptionSalt))}else f?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:w.stringUid});const C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&We.joinChannelTimeout(this._sessionId,5)},5e3);try{var M;let k;const G=w.cloudProxyServer;if(xe(M=["proxy3","proxy4","proxy5"]).call(M,G)){const Z=W("PROXY_SERVER_TYPE3");Array.isArray(Z)?w.proxyServer=Z[0]:w.proxyServer=Z}if(We.setProxyServer(w.proxyServer),R.setProxyServer(w.proxyServer),this.store.requestAPStart(),v){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(v.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=v.intUid),k={gatewayInfo:v.ap.gatewayInfo},W("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(v.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Z=(await M6(v.ap.proxyInfo,v.ap.gatewayInfo.uid)).map(ie=>({turnServerURL:ie.address,tcpport:ie.tcpport||Vr.tcpport,udpport:ie.udpport||Vr.udpport,username:ie.username||Vr.username,password:ie.password||Vr.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:Z}}H8(v,w.stringUid)}else{if(w.stringUid&&!w.uid){let Z;[Z,k]=await Ie.all([u8(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||Bn,this.store).finally(()=>{this.store.requestSUAEnd()}),d8(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Bn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(Z)),w.uid=Z,k.gatewayInfo.uid=Z,k.gatewayInfo.res.uid=Z}else k=await d8(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Bn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new se($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(_o.UPDATE_BITRATE_LIMIT,Z=>{this._p2pChannel.updateBitrateLimit(Z)}),this._configDistribute.on(_o.UPDATE_CLIENT_ROLE_OPTIONS,Z=>{this._setClientRoleOptions(Z)}),this._configDistribute.on(_o.UPDATE_REMOTE_VIDEO_STREAM_TYPE,Z=>{var ie;xe(ie=[0,1,4,5,6,7,8,9]).call(ie,Z)&&(this.remoteUsers.forEach(ge=>{this._remoteStreamTypeCacheMap.get(ge.uid)!==Z&&this.setRemoteVideoStreamType(ge.uid,Z)}),this.setRemoteDefaultVideoStreamType(Z))}),this._configDistribute.on(_o.FALLBACK_TO_HLS,Z=>{Z&&this.safeEmit(Et.FALLBACK_TO_HLS,MA.CONFIG)}),this._configDistribute.on(_o.UPDATE_VOS_CONFIGURE,Z=>{this._gateway.setConfigure(Z).catch(ie=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),ie)})})},0),this._key=i||t;const K=k.gatewayInfo,X=w.uid?w.uid:K.uid;this._joinInfo=Us(Us({},w),{},{cid:K.cid,uid:X,vid:K.vid,apResponse:K.res,apGatewayAddress:K.apGatewayAddress,uni_lbs_ip:K.uni_lbs_ip,gatewayAddrs:K.gatewayAddrs}),this.store.intUid=X,this.store.cid=K.cid;const te=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new se($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(te),this._appId=t,this._channelName=w.cname,this._uid=te,this.store.uid=te,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Er()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Er()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ne=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ne)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),I=this,xe(Au).call(Au,I)||Au.push(I),this._cloudProxyServerMode==="disabled"&&wt().supportWebCrypto&&W("ENABLE_PRELOAD")&&EO(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&We.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&We.reportRteDetail(this._sessionId)},W("RTE_DETAIL_REPORT_INTERVAL")||6e4),te}catch(k){const G=Array.isArray(k)?k[0]:k;throw G&&G.code===$.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),G):R.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),G),G.code!==$.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(G),G}var I}async _joinGateway(){if(!this._joinInfo||!this._key)throw new se($.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!W("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(t){if(t.code===$.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Ct.FALLBACK),R.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new se($.INVALID_OPERATION);return We.reportApiInvoke(this._sessionId,{name:yn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:rn.TRACER}).onSuccess(),await this._joinGateway()}throw t}}async leave(){R.info("[".concat(this._clientId,"] Leaving channel"));const t=()=>{!Er()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Er()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(i){const s=Au.indexOf(i);s!==-1&&Au.splice(s,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||t();const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void r();await this._gateway.leave(this.connectionState!=="CONNECTED",Ct.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),r(),this.store.useDcSignal&&t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof jp))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new se($.INVALID_PARAMS,"param list is empty");const i=t;if(this._gateway.role==="audience")throw new se($.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof jp))throw new se($.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new se($.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const d=this._configDistribute.getBitrateLimit();c instanceof an&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(i),R.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw R.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{s()}}async _publishDataChannel(t){if(t==null)throw new se($.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));nn(t.id,"id",0,65535,!0),As(t.ordered,"ordered"),Or(t.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new se($.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new se($.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new se($.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return t8(c,!1)}(t),s=await this._p2pChannel.publishDataChannel([i]);if(s.length>0){if(typeof i._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new se($.CREATE_DATACHANNEL_ERROR);try{await Ie.all(s.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==$.DISCONNECT_P2P)throw c}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw R.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new se($.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof jp))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.sendExtensionMessage(Un.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.unpublish(s,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(s){throw R.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(t);i&&await this._gateway.unpublishDataChannel(i),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(s=>"".concat(s.id))))}catch(i){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(t,r,i){if(!(t instanceof Zl)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new se($.INVALID_REMOTE_USER,"user is not in the channel");t=s}return r==="datachannel"?this._subscribeDataChannel(t,i):this._subscribe(t,r)}async presubscribe(t,r){if(Fn(r,"mediaType",["audio","video"]),this.store.useP2P)throw new se($.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new se($.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===Fe.AUDIO,s=r===Fe.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:u,rtxSsrcId:f,cname:g,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new se($.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(w=>w.uid===t);_||(_=new Zl(t,v||t),_._is_pre_created=!0,this._users.push(_)),g&&(_._cname=g),_._uintid||(_._uintid=v||t),i&&(_._audioSSRC=d,_._audio_pre_subscribed=!0,u&&(_._audioOrtc=u)),s&&(_._videoSSRC=d,_._video_pre_subscribed=!0,u&&(_._videoOrtc=u),f!=null&&(_._rtxSsrcId=f)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(_,r,d,f,u);const S=i?_._audioTrack:_._videoTrack;if(!S)throw new se($.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),s&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),S}catch(d){throw R.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var i;if(nn(r,"channelId",0,65535,!0),!this._joinInfo)throw new se($.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se($.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===t))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new se($.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new se($.INVALID_REMOTE_USER,"user is not published");const c=(i=t._dataChannels)===null||i===void 0?void 0:i.find(f=>f.id===r);if(!c)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new se($.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const f=await this._p2pChannel.subscribeDataChannel(t,[c]);if(f&&xe(f).call(f,c.id))try{var u;if(typeof c._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new se($.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(u=c.metadata)!==null&&u!==void 0?u:""};await this._gateway.subscribeDataChannel(t.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==$.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),g;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,i){if(Fn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new se($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new se($.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new se($.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!i&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new se($.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const u=r==="audio"?t._audioSSRC:t._videoSSRC,f=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,u,f)}catch(u){throw u}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(u=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new se($.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,i){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Fn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new se($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new se($.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new se($.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(i||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new se($.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,u=r==="video"?t._rtxSsrcId:void 0,f={stream_type:r==="audio"?Fe.AUDIO:Fe.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const _=r==="audio"?t._audioSSRC:t._videoSSRC;_!==void 0&&_!==c&&(c=_,d=r==="audio"?t._audioOrtc:t._videoOrtc,u=r==="video"?t._rtxSsrcId:void 0,f={stream_type:r==="audio"?Fe.AUDIO:Fe.VIDEO,ssrcId:c}),zr.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,u,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,f,!0)}catch(S){if((S==null?void 0:S.code)!==$.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),S;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,t,r),_}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(_=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new se($.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),v}catch(v){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{g()}}async massSubscribe(t){if(Hc(t,"subscribeList"),!this._joinInfo)throw new se($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(f=>{let{user:g,mediaType:v}=f;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(f=>{let{user:g,mediaType:v}=f;return{user:g,mediaType:v}}),d=await this._p2pChannel.globalLock();try{var u;for(let g=t.length-1;g>=0;g--){const v=t[g],{user:_,mediaType:S}=v;if(Fn(S,"mediaType",["audio","video"]),!_){const I=new se($.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===_)){const I=new se($.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),c[g].error=I,t.splice(g,1);continue}if(S==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||S==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const I=new se($.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(S,", remote user is not published")),c[g].error=I,t.splice(g,1);continue}const C=hr.Video|hr.LwoVideo,M=i.get(_);if(M){if(S==="video"?M&C:M&hr.Audio){t.splice(g,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(S," twice"));continue}i.set(_,M|(S==="video"?C:hr.Audio))}else i.set(_,S==="video"?C:hr.Audio)}for(let g=t.length-1;g>=0;g--){const v=t[g],{user:_,mediaType:S}=v,w=hr.Video|hr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,S)){await this._p2pChannel.unmuteRemoteNoLock(_,S);const C=i.get(_);i.set(_,S==="video"?C^w:C^hr.Audio),t.splice(g,1)}}this.store.massSubscribe(t.map(g=>({userId:g.user.uid,type:g.mediaType})),r);let f=qa(u=Array.from(i.entries())).call(u,(g,v)=>{let[_,S]=v;if(S===0)return g;const w={stream_id:_.uid,stream_type:S};return S&hr.Audio&&(w.audio_ssrc=_._audioSSRC),S&hr.Video&&(w.video_ssrc=_._videoSSRC),g.push(w),g},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:_,mediaType:S}=v;return{user:_,mediaType:S,ssrcId:S===Fe.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:S===Fe.VIDEO?_._rtxSsrcId:void 0}}));const g=new Map;if(f=f.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),f.length>0){const v=await this._gateway.subscribeAll(f,!0);((v==null?void 0:v.users)||[]).forEach(_=>{let{stream_id:S,video_error_code:w,audio_error_code:C,error_code:M}=_;(w||C||M)&&g.set(S,{video_error_code:w,audio_error_code:C,error_code:M})})}if(Array.from(g.entries()).length>0){const v=[];Array.from(g.entries()).forEach(_=>{let[S,w]=_;const C=this.remoteUsers.find(M=>M.uid===S);if(C){let M;w.error_code||w.video_error_code&&w.audio_error_code?M=void 0:w.video_error_code?M=Fe.VIDEO:w.audio_error_code&&(M=Fe.AUDIO),v.push({user:C,mediaType:M})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const _=g.get(v.user.uid);if(_){const S=_.error_code||v.mediaType==="audio"&&_.audio_error_code||v.mediaType==="video"&&_.video_error_code;if(S){const w=Iu(S);R.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(w.desc)),v.error=new se($.SUBSCRIBE_FAILED,"code ".concat(S,": ").concat(w.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var _;We.subscribe(this.store.sessionId,{succ:!!v.error,ec:((_=v.error)===null||_===void 0?void 0:_.code)||null,video:v.mediaType===Fe.VIDEO,audio:v.mediaType===Fe.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===Fe.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:_,mediaType:S}=v;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(S)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(t),g}}finally{d(),s()}}async unsubscribe(t,r,i){if(!(t instanceof Zl)){const d=this.remoteUsers.find(u=>u.uid===t);if(!d)throw new se($.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,i)}else await this._unsubscribeDataChannel(t,i);if(r&&Fn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new se($.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new se($.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&oE(this._users,t),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===$.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&nn(r,"id",0,65535,!0),!this._joinInfo)throw new se($.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new se($.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let s;if(typeof r=="number"){const c=t._dataChannels.find(d=>d.id===r);c&&(s=[c])}else s=t._dataChannels;if(s===void 0){const c=new se($.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,s);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===$.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(Hc(t,"unsubscribeList"),!this._joinInfo)throw new se($.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(i=>{let{user:s,mediaType:c}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let i=t.length-1;i>=0;i--){const{user:s,mediaType:c}=t[i];if(!s){const f=new se($.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),f}if(Fn(c,"mediaType",["video","audio",void 0]),!this._users.find(f=>f===s)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),t.splice(i,1);continue}const u=hr.Video|hr.LwoVideo;if(r.has(s)){const f=r.get(s);let g;switch(c){case"video":g=f&u;break;case"audio":g=f&hr.Audio;break;default:g=f&(hr.Audio|u)}if(g){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(c," twice.")),t.splice(i,1);continue}c?c==="audio"?r.set(s,f|hr.Audio):c==="video"&&r.set(s,f|u):r.set(s,f|hr.Audio|u)}else c?c==="audio"?r.set(s,hr.Audio):c==="video"&&r.set(s,u):r.set(s,hr.Audio|u)}try{const i=await this._p2pChannel.massUnsubscribe(t);i&&await this._gateway.massUnsubscribe(i),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(s=>{let{user:c,mediaType:d}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(i){if(i.code===$.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(t){(function(i){if(!i)throw new pe($.INVALID_PARAMS);An(i.width)||PA(i.width,"streamParameter.width"),An(i.height)||PA(i.height,"streamParameter.height"),An(i.framerate)||PA(i.framerate,"streamParameter.framerate"),An(i.bitrate)||nn(i.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Te.LocalVideoLowTrack)}async setDualStreamMode(t,r){Fn(t,"mode",[0,1,-1]);try{switch(r&&await this.setLowStreamParameter(r),this._dualStreamMode=t,this._joinInfo?this._gateway.setDualStreamMode(t).catch(i=>{R.warning("[".concat(this._clientId,"] set dual stream mode failed"),i.toString())}):R.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(t)),t){case Tp.AUTO_SIMULCAST_STREAM:R.info("[".concat(this._clientId,"] set dual stream mode to ").concat(t));break;case Tp.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case Tp.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(i){throw R.error("[".concat(this._clientId,"] set dual stream mode error"),i.toString()),i}}async enableDualStream(){if(!wt().supportDualStream)throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new se($.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new se($.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,this._dualStreamMode=Tp.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(t=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),t.toString())}),We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void R.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(Te.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,this._dualStreamMode=Tp.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(t=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),t.toString())}),We.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(s){Fn(s,"role",["audience","host"])}(t),r&&jA(r),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new se($.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new se($.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new se($.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;if(this._joinInfo&&(this._joinInfo.role=t),t!==i&&W("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Ur.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),R.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level)),i==="audience"&&t!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Lu){const{video_codec:s}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(s.map(c=>c.toLowerCase()).filter(c=>{var d;return xe(d=Object.keys(bu)).call(d,c)}))}}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&jA(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Or(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new se($.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se($.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,We.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new se($.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se($.INVALID_OPERATION,"You have already set the proxy")}if(fu(t))return this._turnServer={servers:t,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(i=>i.urls).join(","),"."));t.forEach(i=>R5(i)),this._turnServer={servers:t,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new se($.INVALID_OPERATION,"you should set license before join channel");if(Or(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new se($.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,R.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new se($.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new se($.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(t===void 0&&(t=3),t){case 1:case 2:throw new se($.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new se($.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new se($.INVALID_OPERATION,"Stop proxy server after leave channel");We.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new se($.INVALID_PARAMS,"accessPoints is required.");Hc(t.accessPoints.serverList,"accessPoints.serverList"),Or(t.accessPoints.domain,"accessPoints.domain");const r=(w,C)=>{nn(w,C,0,65535,!0)};let i=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),i=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se($.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");W("CLOSE_AFB_FOR_LOCAL_AP")&&(Zt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Zt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map(w=>s.test(w)?"".concat(w.replace(/\./g,"-"),".").concat(c):w),u=d.map(w=>"".concat(w,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Zt("WEBCS_DOMAIN",u),Zt("WEBCS_DOMAIN_BACKUP_LIST",u),Zt("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Hc(t.report.hostname,"report.hostname"),Zt("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Zt("EVENT_REPORT_DOMAIN",d[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let f=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),f=t.report.port),Zt("STATS_COLLECTOR_PORT",f),t.report?Zt("ENABLE_EVENT_REPORT",!0):Zt("ENABLE_EVENT_REPORT",!1);let g="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Hc(t.log.hostname,"log.hostname"),g=t.log.hostname[0]):g=d[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),Zt("LOG_UPLOAD_SERVER","".concat(g,":").concat(v));let _=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Hc(t.cds.hostname,"cds.hostname"),_=t.cds.hostname):_=d;let S=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),S=t.cds.port),Zt("CDS_AP",_.map(w=>"".concat(w,":").concat(S))),t.cds?Zt("ENABLE_CONFIG_DISTRIBUTE",!0):Zt("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(Hc(t,"serverList"),Or(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se($.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(r):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Zt("WEBCS_DOMAIN",t),Zt("WEBCS_DOMAIN_BACKUP_LIST",t),Zt("GATEWAY_DOMAINS",[r]),Zt("EVENT_REPORT_DOMAIN",t[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Zt("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Fn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Fn(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const i=this._users.find(s=>s.uid===t);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Fn(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(i){throw R.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,i,s){(function(d){Fn(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Or(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(xe(c).call(c,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new se($.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new se($.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(As(s,"encryptDataStream"),!xe(c).call(c,t))throw new se($.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,i&&(this._encryptionSalt=zl(i))}async renewToken(t){if(Or(t,"token",1,2047),!this._key||!this._joinInfo)throw new se($.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const i=await this._renewTokenMutex.lock();try{if(W("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await gve(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Bn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:s})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=r,this._joinInfo.token=r,R.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Et.VOLUME_INDICATOR,t)},W("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new se($.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new se($.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new se($.LIVE_STREAMING_TASK_CONFLICT);const i=r?Kc.TRANSCODE:Kc.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(t,i)}setLiveTranscoding(t){return this._createLiveStreamingClient(Kc.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(t));if(!r.length)throw new se($.INVALID_PARAMS,"can not find live streaming url to stop");await Ie.all(r.map(i=>i&&i.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){v8(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){v8(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Lu&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new se($.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&xe(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(s=!0,t.payload=await async function(c,d,u){var f;const g=qa(f=Array.from(u)).call(f,(I,k)=>I+k,0),v={serverTs:0,seq:Vme++,length:u.length,checkSum:g},_=new Uint8Array(j5(g,2)),S=new ArrayBuffer(Ip),w=new DataView(S);w.setUint32(0,v.serverTs),w.setUint16(4,v.seq),w.setUint16(6,v.length),w.setUint16(8,v.checkSum);const C=16-u.length%16;u=I5(u,new Uint8Array(C));const M=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:Y5,additionalData:_},d,u);return I5(new Uint8Array(S),new Uint8Array(M))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new se($.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ze.DATA_STREAM,{payload:zl(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-Tve},!i)}sendMetadata(t){if(!this._joinInfo)throw new se($.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new se($.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ze.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:zl(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Yme),!this._joinInfo)throw new se($.INVALID_OPERATION,"can not send custom report, not joined");await We.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(W("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map(i=>i.uid+"");Object.keys(t).forEach(i=>{xe(r).call(r,i)||delete t[i]})}return t}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(t,r){Fn(r.spatialLayer,"spatialLayer",[0,1,2,3]),Fn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(i){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:i}=t;if(As(r,"apRTM"),nn(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(t){const r=Wp.indexOf(t);r!==-1&&Wp.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ni.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&$8(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&We.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&We.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new br("client-publish",this._clientId),this._subscribeMutex=new br("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var i;const s=t||_u();t?R.debug("[".concat(this._clientId,"] new Session ").concat(s)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const c=t?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,We.addSid(s);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};We.sessionInit(this._sessionId,Us({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new se($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new se($.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const s=(await i.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Un.PUBLISH,s,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await i.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(d){if(d.code!==$.DISCONNECT_P2P)throw i.throw(d),d}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof an&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,t),(i==null?void 0:i.code)===$.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new se($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se($.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(d){if(d.code!==$.DISCONNECT_P2P)throw i.throw(d),d}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===$.WS_ABORT)return;throw i}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new se($.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},bo("LiveStreaming").create(s));var s;return i.onLiveStreamError=(c,d)=>{We.reportApiInvoke(this._sessionId,{name:yn.ON_LIVE_STREAM_ERROR,options:[c,d],tag:rn.TRACER}).onSuccess(),this.safeEmit(Et.LIVE_STREAMING_ERROR,c,d)},i.onLiveStreamWarning=(c,d)=>{We.reportApiInvoke(this._sessionId,{name:yn.ON_LIVE_STREAM_WARNING,options:[c,d],tag:rn.TRACER}).onSuccess(),this.safeEmit(Et.LIVE_STREAMING_WARNING,c,d)},i.on(DN.REQUEST_WORKER_MANAGER_LIST,(c,d,u)=>{if(!this._joinInfo)return u(new se($.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(f,g,v,_){const S=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(w=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(w+"/api/v1?action=uap"):"https://".concat(w,"/api/v1?action=uap"));return await lve(S,f,g,v,_)})(c,this._joinInfo,this._axiosCancelSource.token,Bn).then(d).catch(u)}),i};return t===Kc.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new se($.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),s=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},bo("ChannelMediaRelay").create(t));s.on("state",c=>{c===Hi.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(Et.CHANNEL_MEDIA_RELAY_STATE,c)}),s.on("event",c=>{this.safeEmit(Et.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(c,d)=>{var u;c==="resolution"&&((u=this._channelMediaRelayClient)===null||u===void 0||u.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:i,deleted:s}=t,c=[];if(r){const d=[];this._users.forEach(u=>{u._dataChannels.forEach(f=>{i.every(g=>g.uid!==u._uintid||g.stream_id!==f.id)&&d.push({uid:u._uintid,stream_id:f.id,ordered:f.ordered,max_retrans_times:f.maxRetransmits,metadata:f.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(i)&&i.length>0&&i.forEach(d=>{const{uid:u,stream_id:f,ordered:g,max_retrans_times:v,metadata:_}=d,S=this._users.find(w=>w._uintid===u);if(!S)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(u)),xe(c).call(c,S)||c.push(S),S._uintid||(S._uintid=u),S._dataChannels.findIndex(w=>w.id===d.stream_id)===-1){const w={id:f,ordered:!!g,maxRetransmits:v,metadata:_},C=function(M){return t8(M,!0)}(w);S._dataChannels.push(C),R.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published datachannel")),r||this.safeEmit(Et.USER_PUBLISHED,S,"datachannel",w)}this._p2pChannel.hasPendingRemoteDataChannel(S,d.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(S.uid," after reconnect.")),this._subscribeDataChannel(S,d.stream_id).catch(w=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),w.toString())}))}),r&&(this.safeEmit(Et.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(d=>{const{uid:u,stream_id:f}=d,g=this._users.find(_=>_._uintid===u);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=g._dataChannels.find(_=>_.id===d.stream_id);v&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(u)),this._p2pChannel.unsubscribeDataChannel(g,[v]).then(_=>{if(g._dataChannels=g._dataChannels.filter(S=>S!==v),_)return this._gateway.unsubscribeDataChannel(_,g.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(Et.USER_UNPUBLISHED,g,"datachannel",v._config))})}_getEncodingName(t){var r,i;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(!s)return;for(const f of s){var c;if(f.payloadType===t)return f==null||(c=f.rtpMap)===null||c===void 0?void 0:c.encodingName}const d=(i=this._joinResponse.ortc.rtpCapabilities.recv)===null||i===void 0?void 0:i.videoCodecs;if(d)for(const f of d){var u;if(f.payloadType===t)return f==null||(u=f.rtpMap)===null||u===void 0?void 0:u.encodingName}return t===0?"unknown":void 0}_handleRemoveDataChannels(t){const r=this._users.find(i=>i.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const i=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(s=>{this.safeEmit(Et.USER_UNPUBLISHED,r,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,r.uid)}),i()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Mn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),i=Date.now();Object.keys(r).forEach(s=>{const{value:c,type:d,expires:u}=r[s];u&&u<=i||d||CN()||!Object.prototype.hasOwnProperty.call(fE,s)||(Ta[s]=c,Yt[s]=c,R.debug("Update gateway parameters from config distribute",s,c))})}catch(r){R.error("Error update config from local cache",r.message)}})()}),this._gateway.on(Mn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Mn.CONNECTION_STATE_CHANGE,(t,r,i)=>{var s;if(i===Ct.FALLBACK)return;const c=()=>{this.safeEmit(Et.CONNECTION_STATE_CHANGE,t,r,i)};if(We.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:yn.CONNECTION_STATE_CHANGE,options:[t,r,i],tag:rn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:i})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(u=>{u._trust_in_room_=!1,u._trust_audio_enabled_state_=!1,u._trust_video_enabled_state_=!1,u._trust_audio_mute_state_=!1,u._trust_video_mute_state_=!1,u._trust_audio_stream_added_state_=!1,u._trust_video_stream_added_state_=!1,u._is_pre_created||(u._audio_pre_subscribed||(u._audioSSRC=void 0,u._audioOrtc=void 0),u._video_pre_subscribed||(u._videoSSRC=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),u._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((u,f)=>{this._gateway.setStreamFallbackOption(f,u).catch(g=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((u,f)=>{this._gateway.setRemoteVideoStreamType(f,u).catch(g=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),W("VOS_CONFIGURE")&&Array.isArray(W("VOS_CONFIGURE"))&&W("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(W("VOS_CONFIGURE")).catch(u=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),u)}),R.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(u=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(u))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(u=>{R.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),u)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(u=>!u._trust_in_room_).forEach(u=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(u.uid)),this._handleUserOffline({uid:u.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(u=>{u._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,Fe.AUDIO,!1)),u._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,Fe.VIDEO,!1)),u._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(u.uid)),this._handleSetStreamLocalEnable("audio",u.uid,!0)),u._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(u.uid)),this._handleSetStreamLocalEnable("video",u.uid,!0)),u._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(u.uid)),this._handleResetAddStream(u,"video")),u._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(u.uid)),this._handleResetAddStream(u,"audio")),u._video_added_||u._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(u.uid)),this._handleRemoveStream({uid:u.uid,uint_id:u._uintid}))}))},1e3))}c()}),this._gateway.on(Mn.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new se($.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;if(this._fallbackServerInfo)i=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,We.reportApiInvoke(this._sessionId,{name:yn.VOS_FALLBACK_CN,options:{cur:i.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:rn.TRACER}).onSuccess(),R.info("[".concat(this._clientId,"] use fallback cn server info"));else{const c=await yO(Us(Us({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));c?(i=c.ap,H8(c),this._joinInfo.preload=!0):(i=await JE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Bn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const s=[];i.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:d}=c;const[u,f]=d.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:u,port:f}):s.push({host:u,port:f})}),t(s)}catch(i){r(i)}}),this._gateway.on(Mn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Et.NETWORK_QUALITY,t)}),this._gateway.on(Mn.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(Et.STREAM_TYPE_CHANGED,t,r),We.reportApiInvoke(this._sessionId,{name:yn.STREAM_TYPE_CHANGE,options:[t,r],tag:rn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Mn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(Mn.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,i)=>{try{let s=await this._p2pChannel.getEstablishParams();s&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(s=await this._p2pChannel.startP2PConnection(t)),r(s)}catch(s){i(s)}}),this._gateway.on(Mn.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let i;this._joinResponse=t,t.attributes?i=t.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const s=H6(t.ortc,r,i);this._p2pChannel.connect(s)}),this._gateway.on(Mn.PRE_CONNECT_PC,async(t,r,i)=>{const{candidates:s,fingerprint:c,turnServer:d}=t;if(this._joinInfo&&s.length>0&&!this._p2pChannel.isPlanB){const{cert:f,cid:g}=this._joinInfo.apResponse,v="".concat(g,"_").concat(f);if(v.length<4||v.length>256)return void R.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(v.length));await this._p2pChannel.startP2PConnection({turnServer:d,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var u;r(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(g,"_").concat(f),icePwd:"".concat(g,"_").concat(f)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(u=W("FINGERPRINT"))!==null&&u!==void 0?u:c}]},candidates:s,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(_){_.code&&_.code===$.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:d,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),i(_)}}}),this._gateway.on(Mn.VOS_FALLBACK,t=>{t==="fallback_hls"&&this.safeEmit(Et.FALLBACK_TO_HLS,MA.VOSERROR)}),this._gateway.on(Mn.RESET_SIGNAL,()=>{this._p2pChannel instanceof Lu&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Mn.DATACHANNEL_FAILBACK,()=>{We.reportApiInvoke(this._sessionId,{name:yn.DATACHANNEL_FAILBACK,options:{},tag:rn.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(ot.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ot.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ot.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(ot.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(ot.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(ot.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ot.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ot.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ot.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Fe.AUDIO,!0)),this._gateway.signal.on(ot.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Fe.AUDIO,!1)),this._gateway.signal.on(ot.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Fe.VIDEO,!0)),this._gateway.signal.on(ot.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Fe.VIDEO,!1)),this._gateway.signal.on(ot.RECEIVE_METADATA,t=>{const r=yu(t.metadata);this.safeEmit(Et.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(ot.ON_DATA_STREAM,async t=>{var r;if(!t)return;let i=yu(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&xe(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Ip)throw new se($.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Ip));i=await async function(d,u,f){const g=f.subarray(0,Ip),v=g.slice(8,Ip),_=(v[0]<<8)+v[1],S=(g[6]<<8)+g[7],w=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:Y5,additionalData:new Uint8Array(j5(_,2))},u,f.subarray(Ip));return new Uint8Array(w).subarray(0,S)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let s=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find(f=>f.uid===t.uid),u=c==null?void 0:c.audioRecv.find(f=>f.ssrc===(d==null?void 0:d._audioSSRC));s=u==null?void 0:u.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),Rve(Us(Us({},t),{},{payload:i}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ot.ON_CRYPT_ERROR,()=>{Hl(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Et.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ot.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ct.TOKEN_EXPIRE),this.safeEmit(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ot.ON_STREAM_FALLBACK_UPDATE,t=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Et.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ot.ENABLE_MULTI_STREAM,t=>{this._dualStreamMode===Tp.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(r=>{R.debug("[".concat(this._clientId,"] set dual stream mode error"),r.toString())})}),this._gateway.signal.on(ot.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(ot.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(ot.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on($e.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case ze.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,s;const d=c.some(g=>{let{stream_type:v}=g;return v===qt.Audio}),u=c.some(g=>{let{stream_type:v}=g;return v!==qt.Audio}),f=c.some(g=>{let{stream_type:v}=g;return v===qt.Screen||v===qt.ScreenLow});r.state==="offer"&&We.publish(this._joinInfo.sid,{eventElapse:zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:$.TIMEOUT,audio:d,video:u,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:d?(i=c.find(g=>{let{stream_type:v}=g;return v===qt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:u?(s=c.find(g=>{let{stream_type:v}=g;return v!==qt.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case ze.SUBSCRIBE:r&&We.subscribe(this._joinInfo.sid,{succ:!1,ec:$.TIMEOUT,audio:r.stream_type===Fe.AUDIO,video:r.stream_type===Fe.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:zr.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(ot.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(ot.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;W("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(s=>!Nu(s.string_id||s.stream_id,this.channelName)));const r=[],i=[];for(const s of t.users){let c=this._users.find(_=>_._uintid===s.stream_id);c?c._trust_in_room_=!0:(c=new Zl(s.string_id||s.stream_id,s.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Et.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(Et.USER_JOINED,c)));const d=hr.Audio&s.stream_type,u=(hr.Video|hr.LwoVideo)&s.stream_type,f=(65280&s.stream_type)!=0,g=d&&c.hasAudio,v=u&&c.hasVideo;u&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=s.video_ssrc,c._rtxSsrcId=s.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=s.audio_ssrc),d&&!g&&this.getListeners(Et.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Et.USER_PUBLISHED,c,"audio")),u&&!v&&this.getListeners(Et.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Et.USER_PUBLISHED,c,"video")),(d&&!g||u&&!v||f)&&r.push(c),u&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(Et.PUBLISHED_USER_LIST).length>0?W("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(s=>s.uid).join(", "))),this.safeEmit(Et.PUBLISHED_USER_LIST,r)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(ot.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;if(this._p2pChannel instanceof Lu){if(this.role==="audience"&&W("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=t,void R.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(t)));this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var s;return xe(s=Object.keys(bu)).call(s,i)}))}}),this._gateway.signal.on($e.VOS_FALLBACK_PROMISE,async(t,r,i)=>{if(t==="FALLBACKCN"&&W("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return i(new se($.UNEXPECTED_ERROR,"can not recover, no join info"));R.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const c=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=t;const d=await JE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Bn,this.store);if(W("QUALITY_FALLBACK_REHEARSAL"))return We.reportApiInvoke(this._sessionId,{name:yn.VOS_FALLBACK_CN,options:{cur:d.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:rn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c,void i();this._fallbackServerInfo=d,r()}catch(d){var s;const u=d==null||(s=d.data)===null||s===void 0?void 0:s.desc;W("QUALITY_FALLBACK_REHEARSAL")?(We.reportApiInvoke(this._sessionId,{name:yn.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+u||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:rn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c):Array.isArray(u)&&xe(u).call(u,"request downgrade fallback")&&this.safeEmit(Et.FALLBACK_TO_HLS,MA.AP_ERROR),i(d)}}else i()})}_handleP2PEvents(){this._gateway.signal.on(ot.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Un.PUBLISH,(t,r,i)=>{const{uid:s}=t;t.forEach(c=>{const{kind:d,ssrcs:u,mid:f,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(d,s,u[0].ssrcId,f);const v=this._users.find(_=>_.uid===s);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,d,u[0].ssrcId,f).then(()=>{r()}).catch(i):r(),this._handleMuteStream(s,d,!!g)})}),this._gateway.signal.on(Un.CALL,async(t,r,i)=>{if(this.store.useP2P)try{var s;r(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},t))}catch(c){i(c)}}),this._gateway.signal.on($e.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Un.UNPUBLISH,async(t,r,i)=>{if(this.store.useP2P){const{unpubMsg:s,uid:c}=t,d=this._users.find(u=>u.uid===c);if(!d)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{s.forEach(async u=>{let{stream_type:f}=u;const g=f===qt.Audio?Fe.AUDIO:Fe.VIDEO;await this._p2pChannel.unsubscribe(d,g),this._handleMuteStream(c,g,!0)}),r()}catch(u){i(u)}}}),this._gateway.signal.on(Un.CONTROL,async(t,r)=>{const{action:i}=t;switch(i){case Xl.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Fe.VIDEO,!0);break;case Xl.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Fe.AUDIO,!0);break;case Xl.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Fe.VIDEO,!1);break;case Xl.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Fe.AUDIO,!1)}}),this._gateway.signal.on(Un.RESTART_ICE,async(t,r,i)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:c}=t;s!==bi.SEND_ONLY||c?r(await this._p2pChannel.restartICE(s,c)):(this._p2pChannel.handleDisconnect(s),r())}catch(s){i(s)}}),this._gateway.signal.on(Un.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:i}=t;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(Ke.RequestP2PRestartICE,async(t,r,i)=>{try{const{direction:s}=t;r(await this._gateway.sendExtensionMessage(Un.RESTART_ICE,t,s===bi.SEND_ONLY))}catch(s){i(s)}}),this._p2pChannel.on(Ke.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Un.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Ke.RequestP2PMuteLocal,async(t,r,i)=>{try{await this._gateway.sendExtensionMessage(Un.CONTROL,t,!0),r()}catch(s){i(s)}}),this._p2pChannel.on(Ke.RequestP2PUnmuteRemote,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===$.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Ke.RequestP2PMuteRemote,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===$.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Ke.StateChange,(t,r)=>{r===$t.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ke.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(Et.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Ke.RequestMuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===$.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Ke.RequestUnmuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===$.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Ke.RequestRePublish,(t,r,i)=>{this.publish(t,!1).then(r).catch(i)}),this._p2pChannel.on(Ke.RequestRePublishDataChannel,(t,r,i)=>{Ie.all(t.map(async s=>{const c=await this._p2pChannel.publishDataChannel([s]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==$.DISCONNECT_P2P)throw d}})).then(r).catch(i)}),this._p2pChannel.on(Ke.RequestReSubscribe,async(t,r,i)=>{try{for(const{user:s,kind:c}of t)c===Fe.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");r()}catch(s){i(s)}}),this._p2pChannel.on(Ke.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Ke.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Ke.MediaReconnectStart,t=>{this.safeEmit(Et.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Ke.MediaReconnectEnd,t=>{this.safeEmit(Et.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Ke.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ke.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),i=await r.next();if(i.done)return;const s=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:s})}catch(u){return void r.throw(u)}const{iceParameters:d}=function(u){const f=u.iceParameters;return{iceParameters:{iceUfrag:f.iceUfrag,icePwd:f.icePwd}}}(c);await r.next({remoteIceParameters:d})}),this._p2pChannel.on(Ke.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ke.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:s}),u=H6(c,d);await this._p2pChannel.connect(u),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ke.RequestUnpublishForReconnectPC,async(t,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):i()}),this._p2pChannel.on(Ke.P2PLost,()=>{this.safeEmit(Et.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ke.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Ke.ConnectionTypeChange,t=>{this.safeEmit(Et.IS_USING_CLOUD_PROXY,t),this._gateway.setUsingProxy(t)}),this._p2pChannel.on(Ke.FirstVideoBufferReady,(t,r)=>{this.safeEmit(Et.FIRST_VIDEO_BUFFER_READY,t,r)}),this._p2pChannel.on(Ke.FirstVideoPreRender,(t,r)=>{this.safeEmit(Et.FIRST_VIDEO_PRE_RENDER,t,r)}),this._p2pChannel.on(Ke.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ke.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Ke.AudioMetadata,t=>{this.safeEmit(Et.AUDIO_METADATA,t)}),this._p2pChannel.on(Ke.AudioPts,t=>{this.safeEmit(Et.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new se($.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new se($.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:t},bo("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:s,cname:c,sid:d,token:u,uid:f,cid:g,vid:v}=this._joinInfo;await i.init({appId:s,areaCode:"",cname:c,sid:d,token:u,uid:f,cid:g,vid:v?Number(v):0},Bn)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(t){t.on(wr.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(Et.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===Ds.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Et.CONTENT_INSPECT_ERROR,new se($.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(wr.INSPECT_RESULT,(r,i)=>{var s;if((i==null?void 0:i.code)===$.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(Et.CONTENT_INSPECT_RESULT,r,i)}),t.on(wr.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new se($.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(As(t,"enabled"),t){if(!r)throw new se($.INVALID_PARAMS,"config is required");if(aW(r),!this._joinInfo)throw new se($.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const s=(i={config:r},bo("ImageModeration").create(i));this._moderation=s,this.handleImageModerationEvents(s);const{appId:c,cname:d,sid:u,token:f,uid:g,cid:v,vid:_}=this._joinInfo;await s.init({appId:c,areaCode:"",cname:d,sid:u,token:f,uid:g,cid:v,vid:_?Number(_):0},Bn)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var i;if(!this._moderation)throw new se($.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(t){t.on(Eo.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(Et.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===ns.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new se($.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Eo.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Fn(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new se($.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){As(t,"enabled"),Zt("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_setRteInfo(t,r){this.store.rteUrl=t,this.store.rteSid=r}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},De(Ue.prototype,"leave",[sW],Object.getOwnPropertyDescriptor(Ue.prototype,"leave"),Ue.prototype),De(Ue.prototype,"publish",[oW],Object.getOwnPropertyDescriptor(Ue.prototype,"publish"),Ue.prototype),De(Ue.prototype,"unpublish",[cW],Object.getOwnPropertyDescriptor(Ue.prototype,"unpublish"),Ue.prototype),De(Ue.prototype,"subscribe",[lW],Object.getOwnPropertyDescriptor(Ue.prototype,"subscribe"),Ue.prototype),De(Ue.prototype,"presubscribe",[dW],Object.getOwnPropertyDescriptor(Ue.prototype,"presubscribe"),Ue.prototype),De(Ue.prototype,"massSubscribe",[uW],Object.getOwnPropertyDescriptor(Ue.prototype,"massSubscribe"),Ue.prototype),De(Ue.prototype,"unsubscribe",[hW],Object.getOwnPropertyDescriptor(Ue.prototype,"unsubscribe"),Ue.prototype),De(Ue.prototype,"massUnsubscribe",[pW],Object.getOwnPropertyDescriptor(Ue.prototype,"massUnsubscribe"),Ue.prototype),De(Ue.prototype,"setLowStreamParameter",[fW],Object.getOwnPropertyDescriptor(Ue.prototype,"setLowStreamParameter"),Ue.prototype),De(Ue.prototype,"setDualStreamMode",[mW],Object.getOwnPropertyDescriptor(Ue.prototype,"setDualStreamMode"),Ue.prototype),De(Ue.prototype,"enableDualStream",[gW],Object.getOwnPropertyDescriptor(Ue.prototype,"enableDualStream"),Ue.prototype),De(Ue.prototype,"disableDualStream",[vW],Object.getOwnPropertyDescriptor(Ue.prototype,"disableDualStream"),Ue.prototype),De(Ue.prototype,"setClientRole",[yW],Object.getOwnPropertyDescriptor(Ue.prototype,"setClientRole"),Ue.prototype),De(Ue.prototype,"_setClientRoleOptions",[_W],Object.getOwnPropertyDescriptor(Ue.prototype,"_setClientRoleOptions"),Ue.prototype),De(Ue.prototype,"setProxyServer",[EW],Object.getOwnPropertyDescriptor(Ue.prototype,"setProxyServer"),Ue.prototype),De(Ue.prototype,"setTurnServer",[bW],Object.getOwnPropertyDescriptor(Ue.prototype,"setTurnServer"),Ue.prototype),De(Ue.prototype,"setLicense",[SW],Object.getOwnPropertyDescriptor(Ue.prototype,"setLicense"),Ue.prototype),De(Ue.prototype,"startProxyServer",[wW],Object.getOwnPropertyDescriptor(Ue.prototype,"startProxyServer"),Ue.prototype),De(Ue.prototype,"stopProxyServer",[xW],Object.getOwnPropertyDescriptor(Ue.prototype,"stopProxyServer"),Ue.prototype),De(Ue.prototype,"setLocalAccessPointsV2",[TW],Object.getOwnPropertyDescriptor(Ue.prototype,"setLocalAccessPointsV2"),Ue.prototype),De(Ue.prototype,"setLocalAccessPoints",[CW],Object.getOwnPropertyDescriptor(Ue.prototype,"setLocalAccessPoints"),Ue.prototype),De(Ue.prototype,"setRemoteDefaultVideoStreamType",[RW],Object.getOwnPropertyDescriptor(Ue.prototype,"setRemoteDefaultVideoStreamType"),Ue.prototype),De(Ue.prototype,"setRemoteVideoStreamType",[AW],Object.getOwnPropertyDescriptor(Ue.prototype,"setRemoteVideoStreamType"),Ue.prototype),De(Ue.prototype,"setStreamFallbackOption",[NW],Object.getOwnPropertyDescriptor(Ue.prototype,"setStreamFallbackOption"),Ue.prototype),De(Ue.prototype,"setEncryptionConfig",[OW],Object.getOwnPropertyDescriptor(Ue.prototype,"setEncryptionConfig"),Ue.prototype),De(Ue.prototype,"renewToken",[IW],Object.getOwnPropertyDescriptor(Ue.prototype,"renewToken"),Ue.prototype),De(Ue.prototype,"enableAudioVolumeIndicator",[PW],Object.getOwnPropertyDescriptor(Ue.prototype,"enableAudioVolumeIndicator"),Ue.prototype),De(Ue.prototype,"startLiveStreaming",[DW],Object.getOwnPropertyDescriptor(Ue.prototype,"startLiveStreaming"),Ue.prototype),De(Ue.prototype,"setLiveTranscoding",[kW],Object.getOwnPropertyDescriptor(Ue.prototype,"setLiveTranscoding"),Ue.prototype),De(Ue.prototype,"stopLiveStreaming",[LW],Object.getOwnPropertyDescriptor(Ue.prototype,"stopLiveStreaming"),Ue.prototype),De(Ue.prototype,"startChannelMediaRelay",[jW],Object.getOwnPropertyDescriptor(Ue.prototype,"startChannelMediaRelay"),Ue.prototype),De(Ue.prototype,"updateChannelMediaRelay",[MW],Object.getOwnPropertyDescriptor(Ue.prototype,"updateChannelMediaRelay"),Ue.prototype),De(Ue.prototype,"stopChannelMediaRelay",[UW],Object.getOwnPropertyDescriptor(Ue.prototype,"stopChannelMediaRelay"),Ue.prototype),De(Ue.prototype,"sendCustomReportMessage",[VW],Object.getOwnPropertyDescriptor(Ue.prototype,"sendCustomReportMessage"),Ue.prototype),De(Ue.prototype,"pickSVCLayer",[FW],Object.getOwnPropertyDescriptor(Ue.prototype,"pickSVCLayer"),Ue.prototype),De(Ue.prototype,"setRTMConfig",[BW],Object.getOwnPropertyDescriptor(Ue.prototype,"setRTMConfig"),Ue.prototype),De(Ue.prototype,"enableContentInspect",[WW],Object.getOwnPropertyDescriptor(Ue.prototype,"enableContentInspect"),Ue.prototype),De(Ue.prototype,"disableContentInspect",[GW],Object.getOwnPropertyDescriptor(Ue.prototype,"disableContentInspect"),Ue.prototype),De(Ue.prototype,"setImageModeration",[$W],Object.getOwnPropertyDescriptor(Ue.prototype,"setImageModeration"),Ue.prototype),De(Ue.prototype,"setP2PTransport",[HW],Object.getOwnPropertyDescriptor(Ue.prototype,"setP2PTransport"),Ue.prototype),De(Ue.prototype,"getJoinChannelServiceRecords",[zW],Object.getOwnPropertyDescriptor(Ue.prototype,"getJoinChannelServiceRecords"),Ue.prototype),De(Ue.prototype,"setPublishAudioFilterEnabled",[KW],Object.getOwnPropertyDescriptor(Ue.prototype,"setPublishAudioFilterEnabled"),Ue.prototype),Ue);function qW(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=Kt(5,"client-"),s=We.reportApiInvoke(null,{id:i,name:yn.CREATE_CLIENT,options:[r],tag:rn.TRACER});try{(function(c){Fn(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Fn(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Fn(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Or(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&R5(c.turnServer),c.httpRetryConfig!==void 0&&C5(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&C5(c.websocketRetryConfig)})(r)}catch(c){throw s.onError(c),c}return(p5(16,0,!0)||OA(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",R.debug("browser not support vp9, force use vp8")),Zt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),s.onSuccess(),new Gve(Us(Us({forceWaitGatewayResponse:!0},r),{},{role:xe(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),i)}function $ve(){let t=!1;const r=jt();return(r.name===Ft.CHROME&&Number(r.version)>=58&&(fo.engine.name!=="WebKit"||function(){const i=jt();if(sE()){if(i.os===lr.MAC_OS)return!0;if(i.os===lr.IOS){const s=fo.os.version&&fo.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1}())||r.name===Ft.FIREFOX&&Number(r.version)>=56||r.name===Ft.OPERA&&Number(r.version)>=45||r.name===Ft.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Qr()||Rs())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||g5()||jt().name===Ft.QQ)&&(t=!0),t}class av{constructor(r,i){j(this,"id",0),j(this,"element",void 0),j(this,"peerPair",void 0),j(this,"context",void 0),j(this,"audioPlayerElement",void 0),j(this,"audioTrack",void 0),av.count+=1,this.id=av.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(s,c)=>{const d=c==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(d),s.iceGatheringState==="complete"?s.localDescription:new Ie(u=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&u(s.localDescription)}})},i=async(s,c)=>await s.setRemoteDescription(c);try{const s=await r(this.peerPair[0],"offer");await i(this.peerPair[1],s);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(s){throw new se($.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new se($.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new se($.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=i.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var XW,db;j(av,"count",0);const Hve=window.AudioContext||window.webkitAudioContext,zve=new(XW=Qe({report:We}),De((db=class{constructor(){j(this,"units",[]),j(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Hve);let r=this.units.find(i=>i&&i.getElement()===t);return r||(r=new av(t,this.context),this.units.push(r)),r.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return jt().name!==Ft.SAFARI}}).prototype,"processExternalMediaAEC",[XW],Object.getOwnPropertyDescriptor(db.prototype,"processExternalMediaAEC"),db.prototype),db);function JW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function QW(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?JW(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):JW(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const wO=window||document;function ZW(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!wO)return;const i=Xn._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const s=c=>{if(!(c&&c.blockedURI&&(Xn.onSecurityPolicyViolation||Xn.getListeners(cc.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;W("CSP_DETECTED_HOSTNAME_LIST").some(u=>xe(d).call(d,u))&&(Xn.onSecurityPolicyViolation&&typeof Xn.onSecurityPolicyViolation=="function"&&Xn.onSecurityPolicyViolation(c),Xn.getListeners(cc.SECURITY_POLICY_VIOLATION).length>0&&Xn.safeEmit(cc.SECURITY_POLICY_VIOLATION,c))};i&&wO.removeEventListener("securitypolicyviolation",i),(r||t&&typeof t=="function"||Xn.getListeners(cc.SECURITY_POLICY_VIOLATION).length>0)&&wO.addEventListener("securitypolicyviolation",s),Xn._cspEventHandlerPointer=s}var Kve=A,Yve=jR,eG=RegExp.prototype,qve=function(t){return t===eG||Kve(eG,t)?Yve(t):t.flags},si=l(qve);function rf(t){let r=t.length;for(;--r>=0;)t[r]=0}const xO=256,tG=286,sv=30,ov=15,TO=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ub=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Xve=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),nG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Jc=new Array(576);rf(Jc);const cv=new Array(60);rf(cv);const lv=new Array(512);rf(lv);const dv=new Array(256);rf(dv);const CO=new Array(29);rf(CO);const hb=new Array(sv);function RO(t,r,i,s,c){this.static_tree=t,this.extra_bits=r,this.extra_base=i,this.elems=s,this.max_length=c,this.has_stree=t&&t.length}let rG,iG,aG;function AO(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}rf(hb);const sG=t=>t<256?lv[t]:lv[256+(t>>>7)],uv=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},Da=(t,r,i)=>{t.bi_valid>16-i?(t.bi_buf|=r<<t.bi_valid&65535,uv(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=i)},fc=(t,r,i)=>{Da(t,i[2*r],i[2*r+1])},oG=(t,r)=>{let i=0;do i|=1&t,t>>>=1,i<<=1;while(--r>0);return i>>>1},cG=(t,r,i)=>{const s=new Array(16);let c,d,u=0;for(c=1;c<=ov;c++)u=u+i[c-1]<<1,s[c]=u;for(d=0;d<=r;d++){let f=t[2*d+1];f!==0&&(t[2*d]=oG(s[f]++,f))}},lG=t=>{let r;for(r=0;r<tG;r++)t.dyn_ltree[2*r]=0;for(r=0;r<sv;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},dG=t=>{t.bi_valid>8?uv(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},uG=(t,r,i,s)=>{const c=2*r,d=2*i;return t[c]<t[d]||t[c]===t[d]&&s[r]<=s[i]},NO=(t,r,i)=>{const s=t.heap[i];let c=i<<1;for(;c<=t.heap_len&&(c<t.heap_len&&uG(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!uG(r,s,t.heap[c],t.depth));)t.heap[i]=t.heap[c],i=c,c<<=1;t.heap[i]=s},hG=(t,r,i)=>{let s,c,d,u,f=0;if(t.sym_next!==0)do s=255&t.pending_buf[t.sym_buf+f++],s+=(255&t.pending_buf[t.sym_buf+f++])<<8,c=t.pending_buf[t.sym_buf+f++],s===0?fc(t,c,r):(d=dv[c],fc(t,d+xO+1,r),u=TO[d],u!==0&&(c-=CO[d],Da(t,c,u)),s--,d=sG(s),fc(t,d,i),u=ub[d],u!==0&&(s-=hb[d],Da(t,s,u)));while(f<t.sym_next);fc(t,256,r)},OO=(t,r)=>{const i=r.dyn_tree,s=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let u,f,g,v=-1;for(t.heap_len=0,t.heap_max=573,u=0;u<d;u++)i[2*u]!==0?(t.heap[++t.heap_len]=v=u,t.depth[u]=0):i[2*u+1]=0;for(;t.heap_len<2;)g=t.heap[++t.heap_len]=v<2?++v:0,i[2*g]=1,t.depth[g]=0,t.opt_len--,c&&(t.static_len-=s[2*g+1]);for(r.max_code=v,u=t.heap_len>>1;u>=1;u--)NO(t,i,u);g=d;do u=t.heap[1],t.heap[1]=t.heap[t.heap_len--],NO(t,i,1),f=t.heap[1],t.heap[--t.heap_max]=u,t.heap[--t.heap_max]=f,i[2*g]=i[2*u]+i[2*f],t.depth[g]=(t.depth[u]>=t.depth[f]?t.depth[u]:t.depth[f])+1,i[2*u+1]=i[2*f+1]=g,t.heap[1]=g++,NO(t,i,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((_,S)=>{const w=S.dyn_tree,C=S.max_code,M=S.stat_desc.static_tree,I=S.stat_desc.has_stree,k=S.stat_desc.extra_bits,G=S.stat_desc.extra_base,K=S.stat_desc.max_length;let X,te,ne,Z,ie,ge,Ee=0;for(Z=0;Z<=ov;Z++)_.bl_count[Z]=0;for(w[2*_.heap[_.heap_max]+1]=0,X=_.heap_max+1;X<573;X++)te=_.heap[X],Z=w[2*w[2*te+1]+1]+1,Z>K&&(Z=K,Ee++),w[2*te+1]=Z,te>C||(_.bl_count[Z]++,ie=0,te>=G&&(ie=k[te-G]),ge=w[2*te],_.opt_len+=ge*(Z+ie),I&&(_.static_len+=ge*(M[2*te+1]+ie)));if(Ee!==0){do{for(Z=K-1;_.bl_count[Z]===0;)Z--;_.bl_count[Z]--,_.bl_count[Z+1]+=2,_.bl_count[K]--,Ee-=2}while(Ee>0);for(Z=K;Z!==0;Z--)for(te=_.bl_count[Z];te!==0;)ne=_.heap[--X],ne>C||(w[2*ne+1]!==Z&&(_.opt_len+=(Z-w[2*ne+1])*w[2*ne],w[2*ne+1]=Z),te--)}})(t,r),cG(i,v,t.bl_count)},pG=(t,r,i)=>{let s,c,d=-1,u=r[1],f=0,g=7,v=4;for(u===0&&(g=138,v=3),r[2*(i+1)+1]=65535,s=0;s<=i;s++)c=u,u=r[2*(s+1)+1],++f<g&&c===u||(f<v?t.bl_tree[2*c]+=f:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):f<=10?t.bl_tree[34]++:t.bl_tree[36]++,f=0,d=c,u===0?(g=138,v=3):c===u?(g=6,v=3):(g=7,v=4))},fG=(t,r,i)=>{let s,c,d=-1,u=r[1],f=0,g=7,v=4;for(u===0&&(g=138,v=3),s=0;s<=i;s++)if(c=u,u=r[2*(s+1)+1],!(++f<g&&c===u)){if(f<v)do fc(t,c,t.bl_tree);while(--f!=0);else c!==0?(c!==d&&(fc(t,c,t.bl_tree),f--),fc(t,16,t.bl_tree),Da(t,f-3,2)):f<=10?(fc(t,17,t.bl_tree),Da(t,f-3,3)):(fc(t,18,t.bl_tree),Da(t,f-11,7));f=0,d=c,u===0?(g=138,v=3):c===u?(g=6,v=3):(g=7,v=4)}};let mG=!1;const gG=(t,r,i,s)=>{Da(t,0+(s?1:0),3),dG(t),uv(t,i),uv(t,~i),i&&t.pending_buf.set(t.window.subarray(r,r+i),t.pending),t.pending+=i};var Jve=t=>{mG||((()=>{let r,i,s,c,d;const u=new Array(16);for(s=0,c=0;c<28;c++)for(CO[c]=s,r=0;r<1<<TO[c];r++)dv[s++]=c;for(dv[s-1]=c,d=0,c=0;c<16;c++)for(hb[c]=d,r=0;r<1<<ub[c];r++)lv[d++]=c;for(d>>=7;c<sv;c++)for(hb[c]=d<<7,r=0;r<1<<ub[c]-7;r++)lv[256+d++]=c;for(i=0;i<=ov;i++)u[i]=0;for(r=0;r<=143;)Jc[2*r+1]=8,r++,u[8]++;for(;r<=255;)Jc[2*r+1]=9,r++,u[9]++;for(;r<=279;)Jc[2*r+1]=7,r++,u[7]++;for(;r<=287;)Jc[2*r+1]=8,r++,u[8]++;for(cG(Jc,287,u),r=0;r<sv;r++)cv[2*r+1]=5,cv[2*r]=oG(r,5);rG=new RO(Jc,TO,257,tG,ov),iG=new RO(cv,ub,0,sv,ov),aG=new RO(new Array(0),Xve,0,19,7)})(),mG=!0),t.l_desc=new AO(t.dyn_ltree,rG),t.d_desc=new AO(t.dyn_dtree,iG),t.bl_desc=new AO(t.bl_tree,aG),t.bi_buf=0,t.bi_valid=0,lG(t)},Qve=(t,r,i,s)=>{let c,d,u=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(f=>{let g,v=4093624447;for(g=0;g<=31;g++,v>>>=1)if(1&v&&f.dyn_ltree[2*g]!==0)return 0;if(f.dyn_ltree[18]!==0||f.dyn_ltree[20]!==0||f.dyn_ltree[26]!==0)return 1;for(g=32;g<xO;g++)if(f.dyn_ltree[2*g]!==0)return 1;return 0})(t)),OO(t,t.l_desc),OO(t,t.d_desc),u=(f=>{let g;for(pG(f,f.dyn_ltree,f.l_desc.max_code),pG(f,f.dyn_dtree,f.d_desc.max_code),OO(f,f.bl_desc),g=18;g>=3&&f.bl_tree[2*nG[g]+1]===0;g--);return f.opt_len+=3*(g+1)+5+5+4,g})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=i+5,i+4<=c&&r!==-1?gG(t,r,i,s):t.strategy===4||d===c?(Da(t,2+(s?1:0),3),hG(t,Jc,cv)):(Da(t,4+(s?1:0),3),((f,g,v,_)=>{let S;for(Da(f,g-257,5),Da(f,v-1,5),Da(f,_-4,4),S=0;S<_;S++)Da(f,f.bl_tree[2*nG[S]+1],3);fG(f,f.dyn_ltree,g-1),fG(f,f.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,u+1),hG(t,t.dyn_ltree,t.dyn_dtree)),lG(t),s&&dG(t)},Zve=(t,r,i)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=i,r===0?t.dyn_ltree[2*i]++:(t.matches++,r--,t.dyn_ltree[2*(dv[i]+xO+1)]++,t.dyn_dtree[2*sG(r)]++),t.sym_next===t.sym_end),eye=t=>{Da(t,2,3),fc(t,256,Jc),(r=>{r.bi_valid===16?(uv(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},tye={_tr_init:Jve,_tr_stored_block:gG,_tr_flush_block:Qve,_tr_tally:Zve,_tr_align:eye},hv=(t,r,i,s)=>{let c=65535&t|0,d=t>>>16&65535|0,u=0;for(;i!==0;){u=i>2e3?2e3:i,i-=u;do c=c+r[s++]|0,d=d+c|0;while(--u);c%=65521,d%=65521}return c|d<<16|0};const nye=new Uint32Array((()=>{let t,r=[];for(var i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;r[i]=t}return r})());var Si=(t,r,i,s)=>{const c=nye,d=s+i;t^=-1;for(let u=s;u<d;u++)t=t>>>8^c[255&(t^r[u])];return-1^t},Uu={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},pb={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:rye,_tr_stored_block:IO,_tr_flush_block:iye,_tr_tally:rd,_tr_align:aye}=tye,{Z_NO_FLUSH:id,Z_PARTIAL_FLUSH:sye,Z_FULL_FLUSH:oye,Z_FINISH:Vs,Z_BLOCK:vG,Z_OK:Li,Z_STREAM_END:yG,Z_STREAM_ERROR:mc,Z_DATA_ERROR:cye,Z_BUF_ERROR:PO,Z_DEFAULT_COMPRESSION:lye,Z_FILTERED:dye,Z_HUFFMAN_ONLY:fb,Z_RLE:uye,Z_FIXED:hye,Z_DEFAULT_STRATEGY:pye,Z_UNKNOWN:fye,Z_DEFLATED:mb}=pb,DO=286,mye=30,gye=19,vye=2*DO+1,yye=15,Vu=258,gc=262,af=42,Fu=113,pv=666,Bu=(t,r)=>(t.msg=Uu[r],r),_G=t=>2*t-(t>4?9:0),ad=t=>{let r=t.length;for(;--r>=0;)t[r]=0},_ye=t=>{let r,i,s,c=t.w_size;r=t.hash_size,s=r;do i=t.head[--s],t.head[s]=i>=c?i-c:0;while(--r);r=c,s=r;do i=t.prev[--s],t.prev[s]=i>=c?i-c:0;while(--r)};let sd=(t,r,i)=>(r<<t.hash_shift^i)&t.hash_mask;const rs=t=>{const r=t.state;let i=r.pending;i>t.avail_out&&(i=t.avail_out),i!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),t.next_out),t.next_out+=i,r.pending_out+=i,t.total_out+=i,t.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},is=(t,r)=>{iye(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,rs(t.strm)},jn=(t,r)=>{t.pending_buf[t.pending++]=r},fv=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},kO=(t,r,i,s)=>{let c=t.avail_in;return c>s&&(c=s),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),i),t.state.wrap===1?t.adler=hv(t.adler,r,c,i):t.state.wrap===2&&(t.adler=Si(t.adler,r,c,i)),t.next_in+=c,t.total_in+=c,c)},EG=(t,r)=>{let i,s,c=t.max_chain_length,d=t.strstart,u=t.prev_length,f=t.nice_match;const g=t.strstart>t.w_size-gc?t.strstart-(t.w_size-gc):0,v=t.window,_=t.w_mask,S=t.prev,w=t.strstart+Vu;let C=v[d+u-1],M=v[d+u];t.prev_length>=t.good_match&&(c>>=2),f>t.lookahead&&(f=t.lookahead);do if(i=r,v[i+u]===M&&v[i+u-1]===C&&v[i]===v[d]&&v[++i]===v[d+1]){d+=2,i++;do;while(v[++d]===v[++i]&&v[++d]===v[++i]&&v[++d]===v[++i]&&v[++d]===v[++i]&&v[++d]===v[++i]&&v[++d]===v[++i]&&v[++d]===v[++i]&&v[++d]===v[++i]&&d<w);if(s=Vu-(w-d),d=w-Vu,s>u){if(t.match_start=r,u=s,s>=f)break;C=v[d+u-1],M=v[d+u]}}while((r=S[r&_])>g&&--c!=0);return u<=t.lookahead?u:t.lookahead},sf=t=>{const r=t.w_size;let i,s,c;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-gc)&&(t.window.set(t.window.subarray(r,r+r-s),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),_ye(t),s+=r),t.strm.avail_in===0)break;if(i=kO(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=i,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=sd(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=sd(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<gc&&t.strm.avail_in!==0)},bG=(t,r)=>{let i,s,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,u=0,f=t.strm.avail_in;do{if(i=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,s=t.strstart-t.block_start,i>s+t.strm.avail_in&&(i=s+t.strm.avail_in),i>c&&(i=c),i<d&&(i===0&&r!==Vs||r===id||i!==s+t.strm.avail_in)))break;u=r===Vs&&i===s+t.strm.avail_in?1:0,IO(t,0,0,u),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,rs(t.strm),s&&(s>i&&(s=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,i-=s),i&&(kO(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(u===0);return f-=t.strm.avail_in,f&&(f>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=f&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-f,t.strm.next_in),t.strstart),t.strstart+=f,t.insert+=f>t.w_size-t.insert?t.w_size-t.insert:f),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),u?4:r!==id&&r!==Vs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(kO(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,s=t.strstart-t.block_start,(s>=d||(s||r===Vs)&&r!==id&&t.strm.avail_in===0&&s<=c)&&(i=s>c?c:s,u=r===Vs&&t.strm.avail_in===0&&i===s?1:0,IO(t,t.block_start,i,u),t.block_start+=i,rs(t.strm)),u?3:1)},LO=(t,r)=>{let i,s;for(;;){if(t.lookahead<gc){if(sf(t),t.lookahead<gc&&r===id)return 1;if(t.lookahead===0)break}if(i=0,t.lookahead>=3&&(t.ins_h=sd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),i!==0&&t.strstart-i<=t.w_size-gc&&(t.match_length=EG(t,i)),t.match_length>=3)if(s=rd(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=sd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=sd(t,t.ins_h,t.window[t.strstart+1]);else s=rd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(is(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Vs?(is(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(is(t,!1),t.strm.avail_out===0)?1:2},of=(t,r)=>{let i,s,c;for(;;){if(t.lookahead<gc){if(sf(t),t.lookahead<gc&&r===id)return 1;if(t.lookahead===0)break}if(i=0,t.lookahead>=3&&(t.ins_h=sd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,i!==0&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-gc&&(t.match_length=EG(t,i),t.match_length<=5&&(t.strategy===dye||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,s=rd(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=sd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(is(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(s=rd(t,0,t.window[t.strstart-1]),s&&is(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=rd(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Vs?(is(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(is(t,!1),t.strm.avail_out===0)?1:2};function vc(t,r,i,s,c){this.good_length=t,this.max_lazy=r,this.nice_length=i,this.max_chain=s,this.func=c}const mv=[new vc(0,0,0,0,bG),new vc(4,4,8,4,LO),new vc(4,5,16,8,LO),new vc(4,6,32,32,LO),new vc(4,4,16,16,of),new vc(8,16,32,32,of),new vc(8,16,128,128,of),new vc(8,32,128,256,of),new vc(32,128,258,1024,of),new vc(32,258,258,4096,of)];function Eye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=mb,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*vye),this.dyn_dtree=new Uint16Array(2*(2*mye+1)),this.bl_tree=new Uint16Array(2*(2*gye+1)),ad(this.dyn_ltree),ad(this.dyn_dtree),ad(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(yye+1),this.heap=new Uint16Array(2*DO+1),ad(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*DO+1),ad(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const gv=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==af&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Fu&&r.status!==pv?1:0},SG=t=>{if(gv(t))return Bu(t,mc);t.total_in=t.total_out=0,t.data_type=fye;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?af:Fu,t.adler=r.wrap===2?0:1,r.last_flush=-2,rye(r),Li},wG=t=>{const r=SG(t);return r===Li&&(i=>{i.window_size=2*i.w_size,ad(i.head),i.max_lazy_match=mv[i.level].max_lazy,i.good_match=mv[i.level].good_length,i.nice_match=mv[i.level].nice_length,i.max_chain_length=mv[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(t.state),r},xG=(t,r,i,s,c,d)=>{if(!t)return mc;let u=1;if(r===lye&&(r=6),s<0?(u=0,s=-s):s>15&&(u=2,s-=16),c<1||c>9||i!==mb||s<8||s>15||r<0||r>9||d<0||d>hye||s===8&&u!==1)return Bu(t,mc);s===8&&(s=9);const f=new Eye;return t.state=f,f.strm=t,f.status=af,f.wrap=u,f.gzhead=null,f.w_bits=s,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=c+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<c+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=r,f.strategy=d,f.method=i,wG(t)};var bye=(t,r)=>{if(gv(t)||r>vG||r<0)return t?Bu(t,mc):mc;const i=t.state;if(!t.output||t.avail_in!==0&&!t.input||i.status===pv&&r!==Vs)return Bu(t,t.avail_out===0?PO:mc);const s=i.last_flush;if(i.last_flush=r,i.pending!==0){if(rs(t),t.avail_out===0)return i.last_flush=-1,Li}else if(t.avail_in===0&&_G(r)<=_G(s)&&r!==Vs)return Bu(t,PO);if(i.status===pv&&t.avail_in!==0)return Bu(t,PO);if(i.status===af&&i.wrap===0&&(i.status=Fu),i.status===af){let c=mb+(i.w_bits-8<<4)<<8,d=-1;if(d=i.strategy>=fb||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=d<<6,i.strstart!==0&&(c|=32),c+=31-c%31,fv(i,c),i.strstart!==0&&(fv(i,t.adler>>>16),fv(i,65535&t.adler)),t.adler=1,i.status=Fu,rs(t),i.pending!==0)return i.last_flush=-1,Li}if(i.status===57){if(t.adler=0,jn(i,31),jn(i,139),jn(i,8),i.gzhead)jn(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),jn(i,255&i.gzhead.time),jn(i,i.gzhead.time>>8&255),jn(i,i.gzhead.time>>16&255),jn(i,i.gzhead.time>>24&255),jn(i,i.level===9?2:i.strategy>=fb||i.level<2?4:0),jn(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(jn(i,255&i.gzhead.extra.length),jn(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Si(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(jn(i,0),jn(i,0),jn(i,0),jn(i,0),jn(i,0),jn(i,i.level===9?2:i.strategy>=fb||i.level<2?4:0),jn(i,3),i.status=Fu,rs(t),i.pending!==0)return i.last_flush=-1,Li}if(i.status===69){if(i.gzhead.extra){let c=i.pending,d=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+d>i.pending_buf_size;){let f=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+f),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(t.adler=Si(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=f,rs(t),i.pending!==0)return i.last_flush=-1,Li;c=0,d-=f}let u=new Uint8Array(i.gzhead.extra);i.pending_buf.set(u.subarray(i.gzindex,i.gzindex+d),i.pending),i.pending+=d,i.gzhead.hcrc&&i.pending>c&&(t.adler=Si(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,d=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d&&(t.adler=Si(t.adler,i.pending_buf,i.pending-d,d)),rs(t),i.pending!==0)return i.last_flush=-1,Li;d=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,jn(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>d&&(t.adler=Si(t.adler,i.pending_buf,i.pending-d,d)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,d=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d&&(t.adler=Si(t.adler,i.pending_buf,i.pending-d,d)),rs(t),i.pending!==0)return i.last_flush=-1,Li;d=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,jn(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>d&&(t.adler=Si(t.adler,i.pending_buf,i.pending-d,d))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(rs(t),i.pending!==0))return i.last_flush=-1,Li;jn(i,255&t.adler),jn(i,t.adler>>8&255),t.adler=0}if(i.status=Fu,rs(t),i.pending!==0)return i.last_flush=-1,Li}if(t.avail_in!==0||i.lookahead!==0||r!==id&&i.status!==pv){let c=i.level===0?bG(i,r):i.strategy===fb?((d,u)=>{let f;for(;;){if(d.lookahead===0&&(sf(d),d.lookahead===0)){if(u===id)return 1;break}if(d.match_length=0,f=rd(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,f&&(is(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,u===Vs?(is(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(is(d,!1),d.strm.avail_out===0)?1:2})(i,r):i.strategy===uye?((d,u)=>{let f,g,v,_;const S=d.window;for(;;){if(d.lookahead<=Vu){if(sf(d),d.lookahead<=Vu&&u===id)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(v=d.strstart-1,g=S[v],g===S[++v]&&g===S[++v]&&g===S[++v])){_=d.strstart+Vu;do;while(g===S[++v]&&g===S[++v]&&g===S[++v]&&g===S[++v]&&g===S[++v]&&g===S[++v]&&g===S[++v]&&g===S[++v]&&v<_);d.match_length=Vu-(_-v),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(f=rd(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(f=rd(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),f&&(is(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,u===Vs?(is(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(is(d,!1),d.strm.avail_out===0)?1:2})(i,r):mv[i.level].func(i,r);if(c!==3&&c!==4||(i.status=pv),c===1||c===3)return t.avail_out===0&&(i.last_flush=-1),Li;if(c===2&&(r===sye?aye(i):r!==vG&&(IO(i,0,0,!1),r===oye&&(ad(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),rs(t),t.avail_out===0))return i.last_flush=-1,Li}return r!==Vs?Li:i.wrap<=0?yG:(i.wrap===2?(jn(i,255&t.adler),jn(i,t.adler>>8&255),jn(i,t.adler>>16&255),jn(i,t.adler>>24&255),jn(i,255&t.total_in),jn(i,t.total_in>>8&255),jn(i,t.total_in>>16&255),jn(i,t.total_in>>24&255)):(fv(i,t.adler>>>16),fv(i,65535&t.adler)),rs(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Li:yG)},Sye=(t,r)=>{let i=r.length;if(gv(t))return mc;const s=t.state,c=s.wrap;if(c===2||c===1&&s.status!==af||s.lookahead)return mc;if(c===1&&(t.adler=hv(t.adler,r,i,0)),s.wrap=0,i>=s.w_size){c===0&&(ad(s.head),s.strstart=0,s.block_start=0,s.insert=0);let g=new Uint8Array(s.w_size);g.set(r.subarray(i-s.w_size,i),0),r=g,i=s.w_size}const d=t.avail_in,u=t.next_in,f=t.input;for(t.avail_in=i,t.next_in=0,t.input=r,sf(s);s.lookahead>=3;){let g=s.strstart,v=s.lookahead-2;do s.ins_h=sd(s,s.ins_h,s.window[g+3-1]),s.prev[g&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=g,g++;while(--v);s.strstart=g,s.lookahead=2,sf(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=u,t.input=f,t.avail_in=d,s.wrap=c,Li},vv={deflateInit:(t,r)=>xG(t,r,mb,15,8,pye),deflateInit2:xG,deflateReset:wG,deflateResetKeep:SG,deflateSetHeader:(t,r)=>gv(t)||t.state.wrap!==2?mc:(t.state.gzhead=r,Li),deflate:bye,deflateEnd:t=>{if(gv(t))return mc;const r=t.state.status;return t.state=null,r===Fu?Bu(t,cye):Li},deflateSetDictionary:Sye,deflateInfo:"pako deflate (from Nodeca project)"};const wye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var gb={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const s in i)wye(i,s)&&(t[s]=i[s])}}return t},flattenChunks:t=>{let r=0;for(let s=0,c=t.length;s<c;s++)r+=t[s].length;const i=new Uint8Array(r);for(let s=0,c=0,d=t.length;s<d;s++){let u=t[s];i.set(u,c),c+=u.length}return i}};let TG=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{TG=!1}const yv=new Uint8Array(256);for(let t=0;t<256;t++)yv[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;yv[254]=yv[254]=1;var _v={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,i,s,c,d,u=t.length,f=0;for(c=0;c<u;c++)i=t.charCodeAt(c),(64512&i)==55296&&c+1<u&&(s=t.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(f),d=0,c=0;d<f;c++)i=t.charCodeAt(c),(64512&i)==55296&&c+1<u&&(s=t.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),i<128?r[d++]=i:i<2048?(r[d++]=192|i>>>6,r[d++]=128|63&i):i<65536?(r[d++]=224|i>>>12,r[d++]=128|i>>>6&63,r[d++]=128|63&i):(r[d++]=240|i>>>18,r[d++]=128|i>>>12&63,r[d++]=128|i>>>6&63,r[d++]=128|63&i);return r},buf2string:(t,r)=>{const i=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let s,c;const d=new Array(2*i);for(c=0,s=0;s<i;){let u=t[s++];if(u<128){d[c++]=u;continue}let f=yv[u];if(f>4)d[c++]=65533,s+=f-1;else{for(u&=f===2?31:f===3?15:7;f>1&&s<i;)u=u<<6|63&t[s++],f--;f>1?d[c++]=65533:u<65536?d[c++]=u:(u-=65536,d[c++]=55296|u>>10&1023,d[c++]=56320|1023&u)}}return((u,f)=>{if(f<65534&&u.subarray&&TG)return String.fromCharCode.apply(null,u.length===f?u:u.subarray(0,f));let g="";for(let v=0;v<f;v++)g+=String.fromCharCode(u[v]);return g})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let i=r-1;for(;i>=0&&(192&t[i])==128;)i--;return i<0||i===0?r:i+yv[t[i]]>r?i:r}},CG=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const RG=Object.prototype.toString,{Z_NO_FLUSH:xye,Z_SYNC_FLUSH:Tye,Z_FULL_FLUSH:Cye,Z_FINISH:Rye,Z_OK:vb,Z_STREAM_END:Aye,Z_DEFAULT_COMPRESSION:Nye,Z_DEFAULT_STRATEGY:Oye,Z_DEFLATED:Iye}=pb;function yb(t){this.options=gb.assign({level:Nye,method:Iye,chunkSize:16384,windowBits:15,memLevel:8,strategy:Oye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new CG,this.strm.avail_out=0;let i=vv.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==vb)throw new Error(Uu[i]);if(r.header&&vv.deflateSetHeader(this.strm,r.header),r.dictionary){let s;if(s=typeof r.dictionary=="string"?_v.string2buf(r.dictionary):RG.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=vv.deflateSetDictionary(this.strm,s),i!==vb)throw new Error(Uu[i]);this._dict_set=!0}}function AG(t,r){const i=new yb(r);if(i.push(t,!0),i.err)throw i.msg||Uu[i.err];return i.result}yb.prototype.push=function(t,r){const i=this.strm,s=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?Rye:xye,typeof t=="string"?i.input=_v.string2buf(t):RG.call(t)==="[object ArrayBuffer]"?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(d===Tye||d===Cye)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=vv.deflate(i,d),c===Aye)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=vv.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===vb;if(i.avail_out!==0){if(d>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},yb.prototype.onData=function(t){this.chunks.push(t)},yb.prototype.onEnd=function(t){t===vb&&(this.result=gb.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Pye={deflate:AG,deflateRaw:function(t,r){return(r=r||{}).raw=!0,AG(t,r)}};const _b=16209;var Dye=function(t,r){let i,s,c,d,u,f,g,v,_,S,w,C,M,I,k,G,K,X,te,ne,Z,ie,ge,Ee;const Me=t.state;i=t.next_in,ge=t.input,s=i+(t.avail_in-5),c=t.next_out,Ee=t.output,d=c-(r-t.avail_out),u=c+(t.avail_out-257),f=Me.dmax,g=Me.wsize,v=Me.whave,_=Me.wnext,S=Me.window,w=Me.hold,C=Me.bits,M=Me.lencode,I=Me.distcode,k=(1<<Me.lenbits)-1,G=(1<<Me.distbits)-1;e:do{C<15&&(w+=ge[i++]<<C,C+=8,w+=ge[i++]<<C,C+=8),K=M[w&k];t:for(;;){if(X=K>>>24,w>>>=X,C-=X,X=K>>>16&255,X===0)Ee[c++]=65535&K;else{if(!(16&X)){if(!(64&X)){K=M[(65535&K)+(w&(1<<X)-1)];continue t}if(32&X){Me.mode=16191;break e}t.msg="invalid literal/length code",Me.mode=_b;break e}te=65535&K,X&=15,X&&(C<X&&(w+=ge[i++]<<C,C+=8),te+=w&(1<<X)-1,w>>>=X,C-=X),C<15&&(w+=ge[i++]<<C,C+=8,w+=ge[i++]<<C,C+=8),K=I[w&G];n:for(;;){if(X=K>>>24,w>>>=X,C-=X,X=K>>>16&255,!(16&X)){if(!(64&X)){K=I[(65535&K)+(w&(1<<X)-1)];continue n}t.msg="invalid distance code",Me.mode=_b;break e}if(ne=65535&K,X&=15,C<X&&(w+=ge[i++]<<C,C+=8,C<X&&(w+=ge[i++]<<C,C+=8)),ne+=w&(1<<X)-1,ne>f){t.msg="invalid distance too far back",Me.mode=_b;break e}if(w>>>=X,C-=X,X=c-d,ne>X){if(X=ne-X,X>v&&Me.sane){t.msg="invalid distance too far back",Me.mode=_b;break e}if(Z=0,ie=S,_===0){if(Z+=g-X,X<te){te-=X;do Ee[c++]=S[Z++];while(--X);Z=c-ne,ie=Ee}}else if(_<X){if(Z+=g+_-X,X-=_,X<te){te-=X;do Ee[c++]=S[Z++];while(--X);if(Z=0,_<te){X=_,te-=X;do Ee[c++]=S[Z++];while(--X);Z=c-ne,ie=Ee}}}else if(Z+=_-X,X<te){te-=X;do Ee[c++]=S[Z++];while(--X);Z=c-ne,ie=Ee}for(;te>2;)Ee[c++]=ie[Z++],Ee[c++]=ie[Z++],Ee[c++]=ie[Z++],te-=3;te&&(Ee[c++]=ie[Z++],te>1&&(Ee[c++]=ie[Z++]))}else{Z=c-ne;do Ee[c++]=Ee[Z++],Ee[c++]=Ee[Z++],Ee[c++]=Ee[Z++],te-=3;while(te>2);te&&(Ee[c++]=Ee[Z++],te>1&&(Ee[c++]=Ee[Z++]))}break}}break}}while(i<s&&c<u);te=C>>3,i-=te,C-=te<<3,w&=(1<<C)-1,t.next_in=i,t.next_out=c,t.avail_in=i<s?s-i+5:5-(i-s),t.avail_out=c<u?u-c+257:257-(c-u),Me.hold=w,Me.bits=C};const Eb=15,kye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Lye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),jye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Mye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ev=(t,r,i,s,c,d,u,f)=>{const g=f.bits;let v,_,S,w,C,M,I=0,k=0,G=0,K=0,X=0,te=0,ne=0,Z=0,ie=0,ge=0,Ee=null;const Me=new Uint16Array(16),at=new Uint16Array(16);let tt,mt,ht,Wt=null;for(I=0;I<=Eb;I++)Me[I]=0;for(k=0;k<s;k++)Me[r[i+k]]++;for(X=g,K=Eb;K>=1&&Me[K]===0;K--);if(X>K&&(X=K),K===0)return c[d++]=20971520,c[d++]=20971520,f.bits=1,0;for(G=1;G<K&&Me[G]===0;G++);for(X<G&&(X=G),Z=1,I=1;I<=Eb;I++)if(Z<<=1,Z-=Me[I],Z<0)return-1;if(Z>0&&(t===0||K!==1))return-1;for(at[1]=0,I=1;I<Eb;I++)at[I+1]=at[I]+Me[I];for(k=0;k<s;k++)r[i+k]!==0&&(u[at[r[i+k]]++]=k);if(t===0?(Ee=Wt=u,M=20):t===1?(Ee=kye,Wt=Lye,M=257):(Ee=jye,Wt=Mye,M=0),ge=0,k=0,I=G,C=d,te=X,ne=0,S=-1,ie=1<<X,w=ie-1,t===1&&ie>852||t===2&&ie>592)return 1;for(;;){tt=I-ne,u[k]+1<M?(mt=0,ht=u[k]):u[k]>=M?(mt=Wt[u[k]-M],ht=Ee[u[k]-M]):(mt=96,ht=0),v=1<<I-ne,_=1<<te,G=_;do _-=v,c[C+(ge>>ne)+_]=tt<<24|mt<<16|ht|0;while(_!==0);for(v=1<<I-1;ge&v;)v>>=1;if(v!==0?(ge&=v-1,ge+=v):ge=0,k++,--Me[I]==0){if(I===K)break;I=r[i+u[k]]}if(I>X&&(ge&w)!==S){for(ne===0&&(ne=X),C+=G,te=I-ne,Z=1<<te;te+ne<K&&(Z-=Me[te+ne],!(Z<=0));)te++,Z<<=1;if(ie+=1<<te,t===1&&ie>852||t===2&&ie>592)return 1;S=ge&w,c[S]=X<<24|te<<16|C-d|0}}return ge!==0&&(c[C+ge]=I-ne<<24|64<<16|0),f.bits=X,0};const{Z_FINISH:NG,Z_BLOCK:Uye,Z_TREES:bb,Z_OK:Wu,Z_STREAM_END:Vye,Z_NEED_DICT:Fye,Z_STREAM_ERROR:Fs,Z_DATA_ERROR:OG,Z_MEM_ERROR:IG,Z_BUF_ERROR:Bye,Z_DEFLATED:PG}=pb,Sb=16180,wb=16190,Qc=16191,jO=16192,MO=16194,xb=16199,Tb=16200,UO=16206,Tr=16209,DG=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Wye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Gu=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<Sb||r.mode>16211?1:0},kG=t=>{if(Gu(t))return Fs;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=Sb,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Wu},LG=t=>{if(Gu(t))return Fs;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,kG(t)},jG=(t,r)=>{let i;if(Gu(t))return Fs;const s=t.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Fs:(s.window!==null&&s.wbits!==r&&(s.window=null),s.wrap=i,s.wbits=r,LG(t))},MG=(t,r)=>{if(!t)return Fs;const i=new Wye;t.state=i,i.strm=t,i.window=null,i.mode=Sb;const s=jG(t,r);return s!==Wu&&(t.state=null),s};let VO,FO,UG=!0;const Gye=t=>{if(UG){VO=new Int32Array(512),FO=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(Ev(1,t.lens,0,288,VO,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;Ev(2,t.lens,0,32,FO,0,t.work,{bits:5}),UG=!1}t.lencode=VO,t.lenbits=9,t.distcode=FO,t.distbits=5},VG=(t,r,i,s)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),s>=d.wsize?(d.window.set(r.subarray(i-d.wsize,i),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>s&&(c=s),d.window.set(r.subarray(i-s,i-s+c),d.wnext),(s-=c)?(d.window.set(r.subarray(i-s,i),0),d.wnext=s,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var $ye=(t,r)=>{let i,s,c,d,u,f,g,v,_,S,w,C,M,I,k,G,K,X,te,ne,Z,ie,ge=0;const Ee=new Uint8Array(4);let Me,at;const tt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Gu(t)||!t.output||!t.input&&t.avail_in!==0)return Fs;i=t.state,i.mode===Qc&&(i.mode=jO),u=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,s=t.input,f=t.avail_in,v=i.hold,_=i.bits,S=f,w=g,ie=Wu;e:for(;;)switch(i.mode){case Sb:if(i.wrap===0){i.mode=jO;break}for(;_<16;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(2&i.wrap&&v===35615){i.wbits===0&&(i.wbits=15),i.check=0,Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Si(i.check,Ee,2,0),v=0,_=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",i.mode=Tr;break}if((15&v)!==PG){t.msg="unknown compression method",i.mode=Tr;break}if(v>>>=4,_-=4,Z=8+(15&v),i.wbits===0&&(i.wbits=Z),Z>15||Z>i.wbits){t.msg="invalid window size",i.mode=Tr;break}i.dmax=1<<i.wbits,i.flags=0,t.adler=i.check=1,i.mode=512&v?16189:Qc,v=0,_=0;break;case 16181:for(;_<16;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(i.flags=v,(255&si(i))!==PG){t.msg="unknown compression method",i.mode=Tr;break}if(57344&si(i)){t.msg="unknown header flags set",i.mode=Tr;break}i.head&&(i.head.text=v>>8&1),512&si(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Si(i.check,Ee,2,0)),v=0,_=0,i.mode=16182;case 16182:for(;_<32;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}i.head&&(i.head.time=v),512&si(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,Ee[2]=v>>>16&255,Ee[3]=v>>>24&255,i.check=Si(i.check,Ee,4,0)),v=0,_=0,i.mode=16183;case 16183:for(;_<16;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}i.head&&(i.head.xflags=255&v,i.head.os=v>>8),512&si(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Si(i.check,Ee,2,0)),v=0,_=0,i.mode=16184;case 16184:if(1024&si(i)){for(;_<16;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}i.length=v,i.head&&(i.head.extra_len=v),512&si(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Si(i.check,Ee,2,0)),v=0,_=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&si(i)&&(C=i.length,C>f&&(C=f),C&&(i.head&&(Z=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(d,d+C),Z)),512&si(i)&&4&i.wrap&&(i.check=Si(i.check,s,C,d)),f-=C,d+=C,i.length-=C),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&si(i)){if(f===0)break e;C=0;do Z=s[d+C++],i.head&&Z&&i.length<65536&&(i.head.name+=String.fromCharCode(Z));while(Z&&C<f);if(512&si(i)&&4&i.wrap&&(i.check=Si(i.check,s,C,d)),f-=C,d+=C,Z)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&si(i)){if(f===0)break e;C=0;do Z=s[d+C++],i.head&&Z&&i.length<65536&&(i.head.comment+=String.fromCharCode(Z));while(Z&&C<f);if(512&si(i)&&4&i.wrap&&(i.check=Si(i.check,s,C,d)),f-=C,d+=C,Z)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&si(i)){for(;_<16;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(4&i.wrap&&v!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Tr;break}v=0,_=0}i.head&&(i.head.hcrc=si(i)>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=Qc;break;case 16189:for(;_<32;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}t.adler=i.check=DG(v),v=0,_=0,i.mode=wb;case wb:if(i.havedict===0)return t.next_out=u,t.avail_out=g,t.next_in=d,t.avail_in=f,i.hold=v,i.bits=_,Fye;t.adler=i.check=1,i.mode=Qc;case Qc:if(r===Uye||r===bb)break e;case jO:if(i.last){v>>>=7&_,_-=7&_,i.mode=UO;break}for(;_<3;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}switch(i.last=1&v,v>>>=1,_-=1,3&v){case 0:i.mode=16193;break;case 1:if(Gye(i),i.mode=xb,r===bb){v>>>=2,_-=2;break e}break;case 2:i.mode=16196;break;case 3:t.msg="invalid block type",i.mode=Tr}v>>>=2,_-=2;break;case 16193:for(v>>>=7&_,_-=7&_;_<32;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Tr;break}if(i.length=65535&v,v=0,_=0,i.mode=MO,r===bb)break e;case MO:i.mode=16195;case 16195:if(C=i.length,C){if(C>f&&(C=f),C>g&&(C=g),C===0)break e;c.set(s.subarray(d,d+C),u),f-=C,d+=C,g-=C,u+=C,i.length-=C;break}i.mode=Qc;break;case 16196:for(;_<14;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(i.nlen=257+(31&v),v>>>=5,_-=5,i.ndist=1+(31&v),v>>>=5,_-=5,i.ncode=4+(15&v),v>>>=4,_-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Tr;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;_<3;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}i.lens[tt[i.have++]]=7&v,v>>>=3,_-=3}for(;i.have<19;)i.lens[tt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Me={bits:i.lenbits},ie=Ev(0,i.lens,0,19,i.lencode,0,i.work,Me),i.lenbits=Me.bits,ie){t.msg="invalid code lengths set",i.mode=Tr;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;ge=i.lencode[v&(1<<i.lenbits)-1],k=ge>>>24,G=ge>>>16&255,K=65535&ge,!(k<=_);){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(K<16)v>>>=k,_-=k,i.lens[i.have++]=K;else{if(K===16){for(at=k+2;_<at;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(v>>>=k,_-=k,i.have===0){t.msg="invalid bit length repeat",i.mode=Tr;break}Z=i.lens[i.have-1],C=3+(3&v),v>>>=2,_-=2}else if(K===17){for(at=k+3;_<at;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}v>>>=k,_-=k,Z=0,C=3+(7&v),v>>>=3,_-=3}else{for(at=k+7;_<at;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}v>>>=k,_-=k,Z=0,C=11+(127&v),v>>>=7,_-=7}if(i.have+C>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Tr;break}for(;C--;)i.lens[i.have++]=Z}}if(i.mode===Tr)break;if(i.lens[256]===0){t.msg="invalid code -- missing end-of-block",i.mode=Tr;break}if(i.lenbits=9,Me={bits:i.lenbits},ie=Ev(1,i.lens,0,i.nlen,i.lencode,0,i.work,Me),i.lenbits=Me.bits,ie){t.msg="invalid literal/lengths set",i.mode=Tr;break}if(i.distbits=6,i.distcode=i.distdyn,Me={bits:i.distbits},ie=Ev(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Me),i.distbits=Me.bits,ie){t.msg="invalid distances set",i.mode=Tr;break}if(i.mode=xb,r===bb)break e;case xb:i.mode=Tb;case Tb:if(f>=6&&g>=258){t.next_out=u,t.avail_out=g,t.next_in=d,t.avail_in=f,i.hold=v,i.bits=_,Dye(t,w),u=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,s=t.input,f=t.avail_in,v=i.hold,_=i.bits,i.mode===Qc&&(i.back=-1);break}for(i.back=0;ge=i.lencode[v&(1<<i.lenbits)-1],k=ge>>>24,G=ge>>>16&255,K=65535&ge,!(k<=_);){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(G&&!(240&G)){for(X=k,te=G,ne=K;ge=i.lencode[ne+((v&(1<<X+te)-1)>>X)],k=ge>>>24,G=ge>>>16&255,K=65535&ge,!(X+k<=_);){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}v>>>=X,_-=X,i.back+=X}if(v>>>=k,_-=k,i.back+=k,i.length=K,G===0){i.mode=16205;break}if(32&G){i.back=-1,i.mode=Qc;break}if(64&G){t.msg="invalid literal/length code",i.mode=Tr;break}i.extra=15&G,i.mode=16201;case 16201:if(i.extra){for(at=i.extra;_<at;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}i.length+=v&(1<<i.extra)-1,v>>>=i.extra,_-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;ge=i.distcode[v&(1<<i.distbits)-1],k=ge>>>24,G=ge>>>16&255,K=65535&ge,!(k<=_);){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(!(240&G)){for(X=k,te=G,ne=K;ge=i.distcode[ne+((v&(1<<X+te)-1)>>X)],k=ge>>>24,G=ge>>>16&255,K=65535&ge,!(X+k<=_);){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}v>>>=X,_-=X,i.back+=X}if(v>>>=k,_-=k,i.back+=k,64&G){t.msg="invalid distance code",i.mode=Tr;break}i.offset=K,i.extra=15&G,i.mode=16203;case 16203:if(i.extra){for(at=i.extra;_<at;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}i.offset+=v&(1<<i.extra)-1,v>>>=i.extra,_-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Tr;break}i.mode=16204;case 16204:if(g===0)break e;if(C=w-g,i.offset>C){if(C=i.offset-C,C>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Tr;break}C>i.wnext?(C-=i.wnext,M=i.wsize-C):M=i.wnext-C,C>i.length&&(C=i.length),I=i.window}else I=c,M=u-i.offset,C=i.length;C>g&&(C=g),g-=C,i.length-=C;do c[u++]=I[M++];while(--C);i.length===0&&(i.mode=Tb);break;case 16205:if(g===0)break e;c[u++]=i.length,g--,i.mode=Tb;break;case UO:if(i.wrap){for(;_<32;){if(f===0)break e;f--,v|=s[d++]<<_,_+=8}if(w-=g,t.total_out+=w,i.total+=w,4&i.wrap&&w&&(t.adler=i.check=si(i)?Si(i.check,c,w,u-w):hv(i.check,c,w,u-w)),w=g,4&i.wrap&&(si(i)?v:DG(v))!==i.check){t.msg="incorrect data check",i.mode=Tr;break}v=0,_=0}i.mode=16207;case 16207:if(i.wrap&&si(i)){for(;_<32;){if(f===0)break e;f--,v+=s[d++]<<_,_+=8}if(4&i.wrap&&v!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Tr;break}v=0,_=0}i.mode=16208;case 16208:ie=Vye;break e;case Tr:ie=OG;break e;case 16210:return IG;default:return Fs}return t.next_out=u,t.avail_out=g,t.next_in=d,t.avail_in=f,i.hold=v,i.bits=_,(i.wsize||w!==t.avail_out&&i.mode<Tr&&(i.mode<UO||r!==NG))&&VG(t,t.output,t.next_out,w-t.avail_out),S-=t.avail_in,w-=t.avail_out,t.total_in+=S,t.total_out+=w,i.total+=w,4&i.wrap&&w&&(t.adler=i.check=si(i)?Si(i.check,c,w,t.next_out-w):hv(i.check,c,w,t.next_out-w)),t.data_type=i.bits+(i.last?64:0)+(i.mode===Qc?128:0)+(i.mode===xb||i.mode===MO?256:0),(S===0&&w===0||r===NG)&&ie===Wu&&(ie=Bye),ie},Zc={inflateReset:LG,inflateReset2:jG,inflateResetKeep:kG,inflateInit:t=>MG(t,15),inflateInit2:MG,inflate:$ye,inflateEnd:t=>{if(Gu(t))return Fs;let r=t.state;return r.window&&(r.window=null),t.state=null,Wu},inflateGetHeader:(t,r)=>{if(Gu(t))return Fs;const i=t.state;return 2&i.wrap?(i.head=r,r.done=!1,Wu):Fs},inflateSetDictionary:(t,r)=>{const i=r.length;let s,c,d;return Gu(t)?Fs:(s=t.state,s.wrap!==0&&s.mode!==wb?Fs:s.mode===wb&&(c=1,c=hv(c,r,i,0),c!==s.check)?OG:(d=VG(t,r,i,i),d?(s.mode=16210,IG):(s.havedict=1,Wu)))},inflateInfo:"pako inflate (from Nodeca project)"},Hye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const FG=Object.prototype.toString,{Z_NO_FLUSH:zye,Z_FINISH:Kye,Z_OK:bv,Z_STREAM_END:BO,Z_NEED_DICT:WO,Z_STREAM_ERROR:Yye,Z_DATA_ERROR:BG,Z_MEM_ERROR:qye}=pb;function Cb(t){this.options=gb.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&!(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new CG,this.strm.avail_out=0;let i=Zc.inflateInit2(this.strm,r.windowBits);if(i!==bv)throw new Error(Uu[i]);if(this.header=new Hye,Zc.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=_v.string2buf(r.dictionary):FG.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=Zc.inflateSetDictionary(this.strm,r.dictionary),i!==bv)))throw new Error(Uu[i])}function WG(t,r){const i=new Cb(r);if(i.push(t),i.err)throw i.msg||Uu[i.err];return i.result}Cb.prototype.push=function(t,r){const i=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let d,u,f;if(this.ended)return!1;for(u=r===~~r?r:r===!0?Kye:zye,FG.call(t)==="[object ArrayBuffer]"?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),d=Zc.inflate(i,u),d===WO&&c&&(d=Zc.inflateSetDictionary(i,c),d===bv?d=Zc.inflate(i,u):d===BG&&(d=WO));i.avail_in>0&&d===BO&&i.state.wrap>0&&t[i.next_in]!==0;)Zc.inflateReset(i),d=Zc.inflate(i,u);switch(d){case Yye:case BG:case WO:case qye:return this.onEnd(d),this.ended=!0,!1}if(f=i.avail_out,i.next_out&&(i.avail_out===0||d===BO))if(this.options.to==="string"){let g=_v.utf8border(i.output,i.next_out),v=i.next_out-g,_=_v.buf2string(i.output,g);i.next_out=v,i.avail_out=s-v,v&&i.output.set(i.output.subarray(g,g+v),0),this.onData(_)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(d!==bv||f!==0){if(d===BO)return d=Zc.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},Cb.prototype.onData=function(t){this.chunks.push(t)},Cb.prototype.onEnd=function(t){t===bv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=gb.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Xye={inflate:WG,inflateRaw:function(t,r){return(r=r||{}).raw=!0,WG(t,r)}};const{deflate:Jye,deflateRaw:Qye}=Pye,{inflate:Zye,inflateRaw:e_e}=Xye;var t_e=Jye,n_e=Qye,r_e=Zye,i_e=e_e,GG=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(GG||{});class a_e{constructor(){j(this,"_sequence",0),j(this,"_startTime",Date.now()),j(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const g={id:0,length:4,data:f.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};i.commonPacketHeader.extension=1,i.extension=v,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;W("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const s=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(s),d=new DataView(s);let u=0;if(d.setUint16(u,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),u+=2,d.setUint32(u,i.commonPacketHeader.sequence,!0),u+=4,d.setUint16(u,i.commonStreamHeader,!0),u+=2,i.extension){const f=this.serializeExtension(i.extension);c.set(new Uint8Array(f),u),u+=f.byteLength}if(c.set(new Uint8Array(i.payload),u),u+=i.payload.byteLength,u!==i.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let s=0;const c=i.getUint16(s,!0);s+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(s+2,!0)<<16|i.getUint16(s,!0)};let u,f;if(s+=4,W("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(d))),i.getUint16(s,!0),s+=2,d.extension){f=this.deserializeExtension(r.slice(s)),s+=2+f.length,u=r.slice(s);let g=!1;if(f.datas.length>0){const v=f.datas.find(_=>_.id===0);v&&(g=(1&new DataView(v.data).getUint32(0,!0))==1)}u=g?this.decompress(u):u}else u=r.slice(8);return u}serializeExtension(r){const{profile:i,length:s,datas:c}=r,d=new ArrayBuffer(s+2),u=new Uint8Array(d),f=new DataView(d);let g=0;if(f.setUint8(g++,i),f.setUint8(g++,s),c.forEach(v=>{i?(f.setUint8(g++,v.id),f.setUint8(g++,v.length),u.set(new Uint8Array(v.data),g),g+=v.data.byteLength):(f.setUint8(g++,v.id|v.length<<4),u.set(new Uint8Array(v.data),g),g+=v.data.byteLength)}),g!==s+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(s+2));return d}deserializeExtension(r){const i=new DataView(r);let s=0;const c=i.getUint8(s);s++;const d=i.getUint8(s);s++;const u=c===GG.TWO_BYTE,f=[],g=new DataView(r,2);let v=0;for(;v<d;){let _=0,S=0,w=new ArrayBuffer(0);u?(_=g.getUint8(v),v++,S=g.getUint8(v),v++):(_=15&g.getUint8(v),S=g.getUint8(v)>>4,v++),S>0&&(w=g.buffer.slice(v+2,v+2+S),v+=w.byteLength),f.push({id:_,length:S,data:w})}if(v!==d)throw Error("parse error");return{profile:c,length:d,datas:f}}decompress(r){return r_e(new Uint8Array(r))}compress(r){return t_e(new Uint8Array(r))}}const s_e={name:"DataStream",create:(t,r)=>{const i=r?new dge(t):new uge(t);return i.useDataStream(new a_e),i}};class o_e extends Sn{constructor(r,i,s){super(),j(this,"ws",void 0),j(this,"requestId",1),j(this,"heartBeatTimer",void 0),j(this,"joinInfo",void 0),j(this,"clientId",void 0),j(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),j(this,"onClose",c=>{this.emit("close"),this.dispose()}),j(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=i,this.ws=new Hg("cross-channel-".concat(this.clientId),s),this.ws.on(pt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(pt.CONNECTED,this.onOpen),this.ws.on(pt.ON_MESSAGE,this.onMessage),this.ws.on(pt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new Ie((i,s)=>{const c=window.setTimeout(()=>{s(new se($.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(c),d.state&&d.state!==0?s(new se($.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new se($.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new se($.WS_DISCONNECT);const i=()=>new Ie((u,f)=>{this.ws.once(pt.CLOSED,()=>f(new se($.WS_ABORT))),this.ws.once(pt.CONNECTED,u)});this.ws.state!=="connected"&&await i();const s=this.sendMessage(r),c=new Ie((u,f)=>{const g=()=>{f(new se($.WS_ABORT))};this.ws.once(pt.RECONNECTING,g),this.ws.once(pt.CLOSED,g),this.once("req_".concat(s),u),dr(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(pt.RECONNECTING,g),this.ws.off(pt.CLOSED,g),f(new se($.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new se($.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(pt.REQUEST_NEW_URLS),this.ws.on(pt.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class c_e extends Sn{set state(r){r!==this._state&&(r!==Hi.RELAY_STATE_FAILURE&&(this.errorCode=Gp.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,s,c,d){super(),j(this,"joinInfo",void 0),j(this,"sid",void 0),j(this,"clientId",void 0),j(this,"cancelToken",Ni.CancelToken.source()),j(this,"workerToken",void 0),j(this,"requestId",0),j(this,"signal",void 0),j(this,"prevChannelMediaConfig",void 0),j(this,"httpRetryConfig",void 0),j(this,"_resolution",void 0),j(this,"_state",Hi.RELAY_STATE_IDLE),j(this,"errorCode",Gp.RELAY_OK),j(this,"onStatus",u=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(u))),u&&u.command&&(u.command==="onAudioPacketReceived"&&this.emit("event",Yc.PACKET_RECEIVED_AUDIO_FROM_SRC),u.command==="onVideoPacketReceived"&&this.emit("event",Yc.PACKET_RECEIVED_VIDEO_FROM_SRC),u.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Gp.SRC_TOKEN_EXPIRED,this.state=Hi.RELAY_STATE_FAILURE),u.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Gp.DEST_TOKEN_EXPIRED,this.state=Hi.RELAY_STATE_FAILURE))}),j(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Yc.NETWORK_DISCONNECTED),this.state=Hi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(u=>{this.state!==Hi.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",u.toString()),this.errorCode=Gp.SERVER_CONNECTION_LOST,this.state=Hi.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=_u(),this.signal=new o_e(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==Hi.RELAY_STATE_IDLE)throw new se($.INVALID_OPERATION);this.state=Hi.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new se($.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new se($.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new se($.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Hi.RELAY_STATE_RUNNING)throw new se($.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Hi.RELAY_STATE_RUNNING)throw new se($.INVALID_OPERATION);const i=this.genMessage(Pi.SetVideoProfile);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Hi.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ni.CancelToken.source(),this.state=Hi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await mve(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",Yc.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(Pi.SetSdkProfile,r);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Pi.SetSourceChannel,r);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Yc.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const c=this.genMessage(Pi.SetSourceUserId,r);await this.signal.request(c),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(Pi.SetDestChannel,r);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Yc.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(Pi.StartPacketTransfer,r);await this.signal.request(u),this.emit("event",Yc.PACKET_SENT_TO_DEST_CHANNEL),this.state=Hi.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(Pi.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",Yc.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Pi.StopPacketTransfer);await this.signal.request(r),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const s=[],c=[],d=[];this.requestId+=1;const u={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ja,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};u.sdkVersion==="4.24.2"&&(u.sdkVersion="0.0.1");let f=null,g=null;switch(r){case Pi.SetSdkProfile:return u.clientRequest={command:"SetSdkProfile",type:"multi_channel"},u;case Pi.SetSourceChannel:if(g=i&&i.getSrcChannelMediaInfo(),!g)throw new se($.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},u;case Pi.SetSourceUserId:if(g=i&&i.getSrcChannelMediaInfo(),!g)throw new se($.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceUserId",uid:g.uid+""},u;case Pi.SetDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new se($.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{s.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),u.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:d},u;case Pi.StartPacketTransfer:return u.clientRequest={command:"StartPacketTransfer"},u;case Pi.Reconnect:return u.clientRequest={command:"Reconnect"},u;case Pi.StopPacketTransfer:return u.clientRequest={command:"StopPacketTransfer"},u;case Pi.UpdateDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new se($.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{s.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),u.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:d},u;case Pi.SetVideoProfile:u.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return u}}const l_e={name:"ChannelMediaRelay",create:function(t){return new c_e(t.joinInfo,t.clientId,t.websocketRetryConfig||Bn,t.httpRetryConfig||Bn,t.resolution)}};function $G(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Sv(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?$G(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$G(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class d_e extends Sn{constructor(r,i,s,c){super(),j(this,"spec",void 0),j(this,"token",void 0),j(this,"websocket",void 0),j(this,"pingpongTimer",void 0),j(this,"reconnectMode","retry"),j(this,"serviceMode",void 0),j(this,"reqId",0),j(this,"commandReqId",0),j(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),j(this,"handleWebSocketMessage",d=>{if(!d.data)return;const u=JSON.parse(d.data);u.requestId?this.emit("@".concat(u.requestId,"-").concat(u.sid),u):(We.workerEvent(this.spec.sid,{actionType:"status",serverCode:u.code,workerType:this.serviceMode===Kc.TRANSCODE?1:2}),this.emit(Yl.PUBLISH_STREAM_STATUS,u))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new Hg("live-streaming",s),this.websocket.on(pt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pt.REQUEST_NEW_URLS,(d,u)=>{qn(this,Yl.REQUEST_NEW_ADDRESS).then(d).catch(u)}),this.websocket.on(pt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,s,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,u=this.reqId;if(!u||!this.websocket)throw new se($.UNEXPECTED_ERROR);const f=Sv({command:r,sdkVersion:Ja==="4.24.2"?"0.0.1":Ja,seq:u,requestId:u,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new se($.WS_DISCONNECT);const g=()=>new Ie((w,C)=>{this.websocket.once(pt.CLOSED,()=>C(new se($.WS_ABORT))),this.websocket.once(pt.CONNECTED,w)});this.websocket.state!=="connected"&&await g(),f.clientRequest&&(f.clientRequest.workerToken=this.token);const v=new Ie((w,C)=>{const M=()=>{C(new se($.WS_ABORT))};this.websocket.once(pt.RECONNECTING,M),this.websocket.once(pt.CLOSED,M),this.once("@".concat(u,"-").concat(this.spec.sid),I=>{w(I)})});c&&We.workerEvent(this.spec.sid,Sv(Sv({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(f);let S=null;try{S=await v}catch(w){if(this.websocket.state==="closed")throw w;return await g(),await this.request(r,i,s)}return c&&We.workerEvent(this.spec.sid,Sv(Sv({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(S.serverResponse),serverCode:S.code,success:S.code===200,responseTime:Date.now()-_})),S.code!==200&&this.handleResponseError(S),S}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Ja==="4.24.2"?"0.0.1":Ja;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case nr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case nr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case nr.LIVE_STREAM_RESPONSE_BAD_STREAM:case nr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new se($.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case nr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new se($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case nr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new se($.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case nr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new se($.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Yl.WARNING,i,r.serverResponse.url)}case nr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new se($.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Yl.WARNING,i,r.serverResponse.url)}case nr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new se($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case nr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new se($.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case nr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new se($.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Yl.WARNING,i,r.serverResponse.url)}case nr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new se($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case nr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new se($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case nr.LIVE_STREAM_RESPONSE_WORKER_LOST:case nr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new se($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case nr.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new se($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new se($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case nr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case nr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case nr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case nr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new se($.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Mg)},6e3)}}function HG(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ki(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?HG(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):HG(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class u_e extends Sn{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Bn,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Bn;super(),j(this,"onLiveStreamWarning",void 0),j(this,"onLiveStreamError",void 0),j(this,"spec",void 0),j(this,"retryTimeout",1e4),j(this,"connection",void 0),j(this,"httpRetryConfig",void 0),j(this,"wsRetryConfig",void 0),j(this,"streamingTasks",new Map),j(this,"isStartingStreamingTask",!1),j(this,"taskMutex",new br("live-streaming")),j(this,"cancelToken",Ni.CancelToken.source()),j(this,"transcodingConfig",void 0),j(this,"uapResponse",void 0),j(this,"lastTaskId",1),j(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=s,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=Ki(Ki({},Yge),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(u=>Ki(Ki(Ki({},Kge),u),{},{zOrder:u.zOrder?u.zOrder+1:1}))),function(u){An(u.width)||nn(u.width,"config.width",0,1e4),An(u.height)||nn(u.height,"config.height",0,1e4),An(u.videoBitrate)||nn(u.videoBitrate,"config.videoBitrate",1,1e6),An(u.videoFrameRate)||nn(u.videoFrameRate,"config.videoFrameRate"),An(u.lowLatency)||As(u.lowLatency,"config.lowLatency"),An(u.audioSampleRate)||Fn(u.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),An(u.audioBitrate)||nn(u.audioBitrate,"config.audioBitrate",1,128),An(u.audioChannels)||Fn(u.audioChannels,"config.audioChannels",[1,2,3,4,5]),An(u.videoGop)||nn(u.videoGop,"config.videoGop"),An(u.videoCodecProfile)||Fn(u.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),An(u.userCount)||nn(u.userCount,"config.userCount",0,17),An(u.backgroundColor)||nn(u.backgroundColor,"config.backgroundColor",0,16777215),An(u.userConfigExtraInfo)||Or(u.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),u.transcodingUsers&&!An(u.transcodingUsers)&&(Hc(u.transcodingUsers,"config.transcodingUsers"),u.transcodingUsers.forEach((f,g)=>{jE(f.uid),An(f.x)||nn(f.x,"transcodingUser[".concat(g,"].x"),0,1e4),An(f.y)||nn(f.y,"transcodingUser[".concat(g,"].y"),0,1e4),An(f.width)||nn(f.width,"transcodingUser[".concat(g,"].width"),0,1e4),An(f.height)||nn(f.height,"transcodingUser[".concat(g,"].height"),0,1e4),An(f.zOrder)||nn(f.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),An(f.alpha)||nn(f.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),An(u.watermark)||PN(u.watermark,"watermark"),An(u.backgroundImage)||PN(u.backgroundImage,"backgroundImage"),u.images&&!An(u.images)&&(Hc(u.images,"config.images"),u.images.forEach((f,g)=>{PN(f,"images[".concat(g,"]"))}))}(i);const s=[];i.images&&s.push(...i.images.map(u=>Ki(Ki(Ki({},IN),u),{},{zOrder:255}))),i.backgroundImage&&(s.push(Ki(Ki(Ki({},IN),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(s.push(Ki(Ki(Ki({},IN),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=s,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(u=>Ki({},u)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(u=>typeof u.uid=="number"?Ie.resolve(u.uid):u8(u.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ie.all(c)).forEach((u,f)=>{i.userConfigs&&i.userConfigs[f]&&(i.userConfigs[f].uid=u)}),this.transcodingConfig=i,this.connection)try{var d;const u=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(oa(d=this.streamingTasks).call(d)).map(f=>f.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(u.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(u){if(!u.data||!u.data.retry)throw u;u.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(f=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),u.toString(),"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,u).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(f.url," success"))}).catch(g=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),f.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,g)})})}}async startLiveStreamingTask(r,i,s){if(!this.transcodingConfig&&i===Kc.TRANSCODE)throw new se($.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const d=await this.taskMutex.lock();if(!this.connection&&s)return void d();if(this.streamingTasks.get(r)&&!s)return d(),new se($.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(f){throw d(),f}switch(i){case Kc.TRANSCODE:c.transcodingConfig=Ki({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const f=new Ie((v,_)=>{dr(this.retryTimeout).then(()=>{if(s)return _(s);const S=this.statusError.get(r);return S?(this.statusError.delete(r),_(S)):void 0})}),g=await Ie.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===Kc.TRANSCODE?1:2,requestByUser:!s,tid:u.toString()}),f]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:u}),d()}catch(f){if(d(),this.isStartingStreamingTask=!1,!f.data||!f.data.retry||s)throw f;return f.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,f)):await this.startLiveStreamingTask(r,i,f)}}stopLiveStreamingTask(r){return new Ie((i,s)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new se($.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===Kc.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(u=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(u.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(s)})}resetAllTask(){var r;const i=Array.from(oa(r=this.streamingTasks).call(r));this.terminate();for(const s of i)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ni.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new se($.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await qn(this,DN.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new d_e(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Yl.WARNING,(s,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,s)),this.connection.on(Yl.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(Yl.REQUEST_NEW_ADDRESS,(s,c)=>{if(!this.connection)return c(new se($.UNEXPECTED_ERROR,"can not get new live streaming address list"));qn(this,DN.REQUEST_WORKER_MANAGER_LIST,r).then(d=>{this.uapResponse=d,s(d.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",s=this.streamingTasks.get(i),c=r.reason;switch(r.code){case nr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case nr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case nr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case nr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const u=new se($.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(s)return R.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,u);if(!this.isStartingStreamingTask)return;this.statusError.set(i,u)}case nr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const u=new se($.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,u)}case nr.LIVE_STREAM_RESPONSE_WORKER_LOST:case nr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const u=Array.from(oa(d=this.streamingTasks).call(d));for(const f of u)f.abortTask?f.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new se($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(g=>{R.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,g)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const h_e={name:"LiveStreaming",create:function(t){return new u_e(t.joinInfo,t.websocketRetryConfig||Bn,t.httpRetryConfig||Bn)}};function p_e(t){let r=YG();return function(i,s){let c=i.appId;c!==void 0&&(Xt(s,10),yc(s,c));let d=i.cid;d!==void 0&&(Xt(s,16),Xt(s,d));let u=i.cname;u!==void 0&&(Xt(s,26),yc(s,u));let f=i.deviceId;f!==void 0&&(Xt(s,34),yc(s,f));let g=i.elapse;g!==void 0&&(Xt(s,40),od(s,g));let v=i.fileSize;v!==void 0&&(Xt(s,48),od(s,cf(v)));let _=i.height;_!==void 0&&(Xt(s,56),od(s,cf(_)));let S=i.jpg;S!==void 0&&(Xt(s,66),Xt(s,S.length),function(En,ye){let Ne=lf(En,ye.length);En.bytes.set(ye,Ne)}(s,S));let w=i.networkType;w!==void 0&&(Xt(s,72),od(s,cf(w)));let C=i.osType;C!==void 0&&(Xt(s,80),od(s,cf(C)));let M=i.requestId;M!==void 0&&(Xt(s,90),yc(s,M));let I=i.sdkVersion;I!==void 0&&(Xt(s,98),yc(s,I));let k=i.sequence;k!==void 0&&(Xt(s,104),od(s,cf(k)));let G=i.sid;G!==void 0&&(Xt(s,114),yc(s,G));let K=i.timestamp;K!==void 0&&(Xt(s,120),od(s,K));let X=i.uid;X!==void 0&&(Xt(s,128),Xt(s,X));let te=i.vid;te!==void 0&&(Xt(s,136),Xt(s,te));let ne=i.width;ne!==void 0&&(Xt(s,144),od(s,cf(ne)));let Z=i.service;Z!==void 0&&(Xt(s,152),Xt(s,Z));let ie=i.callbackData;ie!==void 0&&(Xt(s,162),yc(s,ie));let ge=i.jpgEncryption;ge!==void 0&&(Xt(s,168),Xt(s,ge));let Ee=i.requestType;Ee!==void 0&&(Xt(s,176),Xt(s,Ee));let Me=i.scorePorn;Me!==void 0&&(Xt(s,185),KO(s,Me));let at=i.scoreSexy;at!==void 0&&(Xt(s,193),KO(s,at));let tt=i.scoreNeutral;tt!==void 0&&(Xt(s,201),KO(s,tt));let mt=i.scene;mt!==void 0&&(Xt(s,208),Xt(s,mt));let ht=i.ossFilePrefix;ht!==void 0&&(Xt(s,218),yc(s,ht));let Wt=i.serviceVendor;if(Wt!==void 0)for(let En of Wt){Xt(s,226);let ye=YG();g_e(En,ye),Xt(s,ye.limit),E_e(s,ye),__e(ye)}}(t,r),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(r)}function f_e(t){return function(i){let s={};e:for(;!qG(i);){let c=_c(i);switch(c>>>3){case 0:break e;case 1:s.code=_c(i);break;case 2:s.msg=XG(i,_c(i));break;case 3:{let d=v_e(i);s.data=m_e(i),i.limit=d;break}default:zG(i,7&c)}}return s}({bytes:r=t,offset:0,limit:r.length});var r}function m_e(t){let r={};e:for(;!qG(t);){let i=_c(t);switch(i>>>3){case 0:break e;case 1:r.requestId=XG(t,_c(t));break;case 2:r.requestType=_c(t)>>>0;break;case 3:r.scorePorn=zO(t);break;case 4:r.scoreSexy=zO(t);break;case 5:r.scoreNeutral=zO(t);break;case 6:r.requestScene=_c(t)>>>0;break;case 7:r.scene=_c(t)>>>0;break;default:zG(t,7&i)}}return r}function g_e(t,r){let i=t.service;i!==void 0&&(Xt(r,8),Xt(r,i));let s=t.vendor;s!==void 0&&(Xt(r,16),Xt(r,s));let c=t.token;c!==void 0&&(Xt(r,26),yc(r,c));let d=t.callbackUrl;d!==void 0&&(Xt(r,34),yc(r,d))}function v_e(t){let r=_c(t),i=t.limit;return t.limit=t.offset+r,i}function zG(t,r){switch(r){case 0:for(;128&JG(t););break;case 2:$O(t,_c(t));break;case 5:$O(t,4);break;case 1:$O(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let y_e=new Float32Array(1);new Uint8Array(y_e.buffer);let GO=new Float64Array(1),Yi=new Uint8Array(GO.buffer);function cf(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let KG=[];function YG(){const t=KG.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function __e(t){KG.push(t)}function $O(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function qG(t){return t.offset>=t.limit}function lf(t,r){let i=t.bytes,s=t.offset,c=t.limit,d=s+r;if(d>i.length){let u=new Uint8Array(2*d);u.set(i),t.bytes=u}return t.offset=d,d>c&&(t.limit=d),s}function HO(t,r){let i=t.offset;if(i+r>t.limit)throw new Error("Read past limit");return t.offset+=r,i}function XG(t,r){let i=HO(t,r),s=String.fromCharCode,c=t.bytes,d="",u="";for(let f=0;f<r;f++){let g,v,_,S,w=c[f+i];128&w?(224&w)==192?f+1>=r?u+=d:(g=c[f+i+1],(192&g)!=128?u+=d:(S=(31&w)<<6|63&g,S<128?u+=d:(u+=s(S),f++))):(240&w)==224?f+2>=r?u+=d:(g=c[f+i+1],v=c[f+i+2],(49344&(g|v<<8))!=32896?u+=d:(S=(15&w)<<12|(63&g)<<6|63&v,S<2048||S>=55296&&S<=57343?u+=d:(u+=s(S),f+=2))):(248&w)==240?f+3>=r?u+=d:(g=c[f+i+1],v=c[f+i+2],_=c[f+i+3],(12632256&(g|v<<8|_<<16))!=8421504?u+=d:(S=(7&w)<<18|(63&g)<<12|(63&v)<<6|63&_,S<65536||S>1114111?u+=d:(S-=65536,u+=s(55296+(S>>10),56320+(1023&S)),f+=3))):u+=d:u+=s(w)}return u}function yc(t,r){let i=r.length,s=0;for(let u=0;u<i;u++){let f=r.charCodeAt(u);f>=55296&&f<=56319&&u+1<i&&(f=(f<<10)+r.charCodeAt(++u)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}Xt(t,s);let c=lf(t,s),d=t.bytes;for(let u=0;u<i;u++){let f=r.charCodeAt(u);f>=55296&&f<=56319&&u+1<i&&(f=(f<<10)+r.charCodeAt(++u)-56613888),f<128?d[c++]=f:(f<2048?d[c++]=f>>6&31|192:(f<65536?d[c++]=f>>12&15|224:(d[c++]=f>>18&7|240,d[c++]=f>>12&63|128),d[c++]=f>>6&63|128),d[c++]=63&f|128)}}function E_e(t,r){let i=lf(t,r.limit),s=t.bytes,c=r.bytes;for(let d=0,u=r.limit;d<u;d++)s[d+i]=c[d]}function JG(t){return t.bytes[HO(t,1)]}function QG(t,r){let i=lf(t,1);t.bytes[i]=r}function zO(t){let r=HO(t,8),i=t.bytes;return Yi[0]=i[r++],Yi[1]=i[r++],Yi[2]=i[r++],Yi[3]=i[r++],Yi[4]=i[r++],Yi[5]=i[r++],Yi[6]=i[r++],Yi[7]=i[r++],GO[0]}function KO(t,r){let i=lf(t,8),s=t.bytes;GO[0]=r,s[i++]=Yi[0],s[i++]=Yi[1],s[i++]=Yi[2],s[i++]=Yi[3],s[i++]=Yi[4],s[i++]=Yi[5],s[i++]=Yi[6],s[i++]=Yi[7]}function _c(t){let r,i=0,s=0;do r=JG(t),i<32&&(s|=(127&r)<<i),i+=7;while(128&r);return s}function Xt(t,r){for(r>>>=0;r>=128;)QG(t,127&r|128),r>>>=7;QG(t,r)}function od(t,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,u=lf(t,d),f=t.bytes;switch(d){case 10:f[u+9]=c>>>7&1;case 9:f[u+8]=d!==9?128|c:127&c;case 8:f[u+7]=d!==8?s>>>21|128:s>>>21&127;case 7:f[u+6]=d!==7?s>>>14|128:s>>>14&127;case 6:f[u+5]=d!==6?s>>>7|128:s>>>7&127;case 5:f[u+4]=d!==5?128|s:127&s;case 4:f[u+3]=d!==4?i>>>21|128:i>>>21&127;case 3:f[u+2]=d!==3?i>>>14|128:i>>>14&127;case 2:f[u+1]=d!==2?i>>>7|128:i>>>7&127;case 1:f[u]=d!==1?128|i:127&i}}function ZG(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}const b_e=new Map([["moderation",1],["supervise",2]]);class S_e extends Sn{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(wr.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=qa(i=r.map(s=>b_e.get(s)||0)).call(i,(s,c)=>s+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),j(this,"name","AgoraRTCVideoContentInspect"),j(this,"_connectionState",Ds.CONNECTING),j(this,"_innerConnectionState",void 0),j(this,"sequence",0),j(this,"inspectStartTime",void 0),j(this,"workerManagerConnection",void 0),j(this,"workerConnection",void 0),j(this,"workerMessageLengthLimit",void 0),j(this,"inspectIntervalMinimum",void 0),j(this,"qualityRatio",void 0),j(this,"_connectInfo",void 0),j(this,"_cancelTokenSource",Ni.CancelToken.source()),j(this,"_retryConfig",void 0),j(this,"wmSequence",0),j(this,"inspectInterval",void 0),j(this,"inspectTimer",null),j(this,"ossFilePrefix",void 0),j(this,"extraInfo",void 0),j(this,"_inspectType",void 0),j(this,"_inspectMode",void 0),j(this,"_quality",1),j(this,"qualityTimer",null),j(this,"_inspectId",void 0),j(this,"_needWorkUrlOnly",!1),j(this,"inspectImage",()=>{if(this.connectionState!==Ds.CONNECTED)throw new se($.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ds.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Kt(5,"inspect-"),this.workerMessageLengthLimit=W("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=W("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=W("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Hg("worker-manager-"+this._inspectId,Bn),this.on(wr.STATE_CHANGE,(i,s)=>{this._innerConnectionState=i,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ks[i]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Hg("worker-"+this._inspectId,Bn),this.handleWorkerEvents()}async init(r,i){this.emit(wr.STATE_CHANGE,ks.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=i,new Ie((c,d)=>{this.on(wr.CONNECTION_STATE_CHANGE,(u,f)=>{f===Ds.CONNECTED&&c()}),this.requestAP(r,s,i).then(u=>{this.connectWorkerManager(u)}).catch(u=>{d(u)})})}async requestAP(r,i,s){const c=W("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),d=await function(f,g,v,_){let{appId:S,areaCode:w,cname:C,sid:M,token:I,uid:k}=g;qp++;const G="image_moderation_api",K={service_name:G,json_body:JSON.stringify({appId:S,areaCode:w,cname:C,command:"allocateEdge",requestId:qp,seq:qp,sid:M,token:I,ts:Date.now(),uid:k+""})};let X,te,ne=f[0];return go(async()=>{X=Date.now();const Z=await So(ne,{data:K,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(te=Date.now()-X,Z.code!==0){const tt=new se($.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Z.code,{retry:!0,responseTime:te});throw R.error(tt.toString()),tt}const ie=JSON.parse(Z.json_body);if(ie.code!==200){const tt=new se($.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ie.code,", reason: ").concat(ie.reason),{code:ie.code,responseTime:te});throw R.error(tt.toString()),tt}if(!ie.servers||!Array.isArray(ie.servers)||ie.servers.length===0){const tt=new se($.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ie.code,responseTime:te});throw R.error(tt.toString()),tt}const ge=W("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(ge)return{addressList:[ge],workerToken:ie.workerToken,vid:ie.vid,responseTime:te};const Ee=W("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Me=W("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ie.servers.map(tt=>{let{address:mt,wss:ht}=tt;if(mt&&ht)return"wss://".concat(mt.replace(/\./g,"-"),".").concat(Ee,":").concat(Me||ht)}).filter(tt=>!!tt),workerToken:ie.workerToken,vid:ie.vid,responseTime:te}},(Z,ie)=>(We.apworkerEvent(M,{success:!0,sc:200,serviceName:G,responseDetail:JSON.stringify(Z.addressList),firstSuccess:ie===0,responseTime:te,serverIp:f[ie%f.length]}),!1),(Z,ie)=>(We.apworkerEvent(M,{success:!1,sc:Z.data&&Z.data.code||200,serviceName:G,responseTime:te,serverIp:f[ie%f.length]}),!!(Z.code!==$.OPERATION_ABORTED&&Z.code!==$.UNEXPECTED_RESPONSE||Z.data&&Z.data.retry)&&(ne=f[(ie+1)%f.length],!0)),_)}(c,r,i,s);this.emit(wr.STATE_CHANGE,ks.AP_CONNECTED);const{addressList:u}=d;return this.wmSequence++,u}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(wr.STATE_CHANGE,ks.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(pt.CONNECTED,async()=>{this.emit(wr.STATE_CHANGE,ks.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(pt.CLOSED,()=>{this._innerConnectionState<ks.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(pt.FAILED,()=>{this._innerConnectionState<ks.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(pt.RECONNECTING,()=>{this._innerConnectionState<ks.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(pt.ON_MESSAGE,async r=>{this.emit(wr.STATE_CHANGE,ks.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(r.data);if(s.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new se($.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&i))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new se($.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const c=W("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,d=i.replace(/:\d+\/?$/,":".concat(c));this.emit(wr.STATE_CHANGE,ks.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(wr.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(pt.WILL_RECONNECT,(r,i,s)=>{s(r)}),this.workerManagerConnection.on(pt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(pt.CONNECTED,async()=>{this.emit(wr.STATE_CHANGE,ks.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ds.CONNECTED}),this.workerConnection.on(pt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=f_e(new Uint8Array(r.data));if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(wr.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var i;const c={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},d=qa(i=Object.keys(c)).call(i,(f,g)=>c[f]>c[g]?f:g,"porn"),u=Object.keys(c).find(f=>f===d);this.emit(wr.INSPECT_RESULT,u)}else this.emit(wr.INSPECT_RESULT,void 0,new se($.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(wr.INSPECT_RESULT,void 0,new se($.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(wr.INSPECT_RESULT,void 0,new se($.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(pt.CLOSED,()=>{this.connectionState=Ds.CLOSED}),this.workerConnection.on(pt.FAILED,()=>{this.connectionState=Ds.CLOSED}),this.workerConnection.on(pt.RECONNECTING,()=>{this.connectionState=this.connectionState===Ds.CONNECTED?Ds.RECONNECTING:Ds.CONNECTING}),this.workerConnection.on(pt.WILL_RECONNECT,(r,i,s)=>{r==="recover"&&s(r),s("tryNext")}),this.workerConnection.on(pt.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(wr.REQUEST_NEW_WORKER_URL,s=>{r([s])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s=>{this.connectWorkerManager(s,!0)}).catch(s=>{i(s)})})}async requestToInspectImage(){this.sequence++;const r=da(this,wr.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(wr.INSPECT_RESULT,void 0,new se($.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(r,i);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(wr.INSPECT_RESULT,void 0,new se($.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:s,cname:c,cid:d,vid:u,sid:f,uid:g}=i;const v=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),S=await A3(_,s,c),w=this.sequence+"-"+d+"-"+g+"-"+v+"-"+Kt(12,""),C={appId:s,cid:d,cname:c,deviceId:"",elapse:(M=Number(v-this.inspectStartTime),{low:M|=0,high:M>>31,unsigned:M>=0}),fileSize:S.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:S,networkType:6,osType:7,requestId:w,sdkVersion:"4.24.2",sequence:this.sequence,sid:f,timestamp:rW(v),uid:g,vid:u,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var M;this.extraInfo===void 0&&delete C.callbackData,this.ossFilePrefix===void 0&&delete C.ossFilePrefix;const I=p_e(C);if(I.byteLength<this.workerMessageLengthLimit){if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const k=function(G){for(var K=1;K<arguments.length;K++){var X=arguments[K]!=null?arguments[K]:{};K%2?ZG(Object(X),!0).forEach(function(te){j(G,te,X[te])}):Object.getOwnPropertyDescriptors?Object.defineProperties(G,Object.getOwnPropertyDescriptors(X)):ZG(Object(X)).forEach(function(te){Object.defineProperty(G,te,Object.getOwnPropertyDescriptor(X,te))})}return G}({},C);delete k.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(k))}return I}{const k=this.quality*this.qualityRatio;return this.quality=k,await this.generateRequestData(r,{appId:s,cname:c,cid:d,vid:u,sid:f,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ni.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ds.CLOSED,this.emit(wr.STATE_CHANGE,ks.CLOSED)}}const w_e={name:"ContentInspect",create:function(t){let{config:r}=t;return function(i){if(!i)throw new se($.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new se($.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const s=[...new Set(i.inspectType)];s.forEach(c=>{var d;if(!xe(d=["supervise","moderation"]).call(d,c))throw new se($.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=s}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new se($.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new S_e(r)}};var e$=l(Qt.Object.getOwnPropertySymbols),x_e=zt,T_e=BT.indexOf,C_e=j_,YO=de([].indexOf),t$=!!YO&&1/YO([1],1,-0)<0;x_e({target:"Array",proto:!0,forced:t$||!C_e("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return t$?YO(this,t,r)||0:T_e(this,t,r)}});var R_e=Ya("Array","indexOf"),A_e=A,N_e=R_e,qO=Array.prototype,O_e=function(t){var r=t.indexOf;return t===qO||A_e(qO,t)&&r===qO.indexOf?N_e:r},n$=l(O_e);function I_e(t,r){if(t==null)return{};var i,s,c=function(u,f){if(u==null)return{};var g={};for(var v in u)if({}.hasOwnProperty.call(u,v)){if(n$(f).call(f,v)!==-1)continue;g[v]=u[v]}return g}(t,r);if(e$){var d=e$(t);for(s=0;s<d.length;s++)i=d[s],n$(r).call(r,i)===-1&&{}.propertyIsEnumerable.call(t,i)&&(c[i]=t[i])}return c}let r$=class{get localCapabilities(){return mn(this._localCapabilities)}get rtpCapabilities(){return mn(this._rtpCapabilities)}get candidates(){return mn(this._candidates)}get iceParameters(){return mn(this._iceParameters)}get dtlsParameters(){return mn(this._dtlsParameters)}constructor(t){j(this,"sessionDesc",void 0),j(this,"_localCapabilities",void 0),j(this,"_rtpCapabilities",void 0),j(this,"_candidates",void 0),j(this,"_iceParameters",void 0),j(this,"_dtlsParameters",void 0),j(this,"setup",void 0),j(this,"currentMidIndex",void 0),j(this,"cname","o/i14u9pJrxRKAsu"),j(this,"firefoxSsrcMidMap",new Map),t=mn(t);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,localCapabilities:d,direction:u,setup:f,videoCodec:g,audioCodec:v}=t;let _;this.setup=f,_=u===bi.RECEIVE_ONLY?yi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):yi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=s,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=d;const S=u===bi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,w=u===bi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=u===bi.RECEIVE_ONLY?c.send.videoCodecs:Jg(Fe.VIDEO,S,w,g),M=u===bi.RECEIVE_ONLY?c.send.audioCodecs:Jg(Fe.AUDIO,S,w,v);for(const I of _.mediaDescriptions)I.attributes.iceUfrag=r.iceUfrag,I.attributes.icePwd=r.icePwd,I.attributes.fingerprints=i.fingerprints,I.attributes.candidates=s,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=C.map(k=>k.payloadType.toString(10)),I.attributes.payloads=C,I.attributes.extmaps=S.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=M.map(k=>k.payloadType.toString(10)),I.attributes.payloads=M,I.attributes.extmaps=S.audioExtensions,Yp(I));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return zc(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,i,s,c){i=i.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:u}=qg(r,this.cname,W("SYNC_GROUP")?i:void 0),f=this.findPreloadMediaDesc(d);if(f){if(fn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(f,c),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(t,d,s);let v;return g===-1?(v=this.createOrRecycleSendMedia(t,d,u,"sendonly",s,c),this.updateBundleMids()):(v=mn(this.sessionDesc.mediaDescriptions[g]),v.attributes.direction="sendonly",v.attributes.ssrcs=d,v.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(v,c)),fn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,i){const s=[];return t.forEach(c=>{const d=c._mediaStreamTrack.kind,u=this.findAvailableRecvMediaIndex(d);let f,g=!1;u===-1?(g=!0,f=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(f=mn(this.sessionDesc.mediaDescriptions[u]),f.attributes.direction="recvonly"),s.push({mid:f.attributes.mid,needCreateTransceiver:g})}),s}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:i,address:s,port:c,type:d,relatedAddress:u,relatedPort:f,priority:g}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:i??"",priority:g?g+"":"",connectionAddress:s??"",port:c?c+"":"",type:d?d+"":"",relAddr:u??"",relPort:f?f+"":"",extension:{}};this.candidates.some(_=>_.priority===v.priority&&_.connectionAddress===v.connectionAddress&&_.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,i,s,c){const d=t._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,f=Jg(d,u,this.localCapabilities.send,d===Fe.AUDIO?c:s),g=d===Fe.VIDEO?u.videoExtensions:u.audioExtensions,v="".concat(++this.currentMidIndex);let _={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};_=this.mungRecvMediaDsec(_,t);const S=this.findFirstClosedMedia(d);if(S){const w=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[w]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>xe(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>xe(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===t&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(fn()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!d||d!==s.attributes.mid)}return!1}return c&&s.attributes.mid===i})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(t){t=mn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,i,s,c,d){const u=this.rtpCapabilities.send,f=t===Fe.VIDEO?u.videoCodecs:u.audioCodecs,g=t===Fe.VIDEO?u.videoExtensions:u.audioExtensions;fn()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,d);const _=this.findFirstClosedMedia(t);if(_){const S=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[S]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,i){const s=mn(t);return BN(s),Pu(s,r),WN(s,r),K6(s),HE(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){const i=mn(t);return HE(i,r,this.localCapabilities.recv),Yp(i),i}updateRecvMedia(t,r){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>fn()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const P_e=["sdp"];var gn;function i$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function cd(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?i$(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):i$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let a$=(gn=class vf extends N6{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,s){super(r,i),j(this,"direction",void 0),j(this,"name",void 0),j(this,"store",void 0),j(this,"spec",void 0),j(this,"peerConnection",void 0),j(this,"initialOffer",void 0),j(this,"transport",void 0),j(this,"statsFilter",void 0),j(this,"localCandidateCount",0),j(this,"_isInRestartIce",!1),j(this,"mutex",void 0),j(this,"onLocalCandidate",void 0),j(this,"remoteSDP",void 0),j(this,"pendingCandidates",[]),j(this,"localCapabilities",void 0),j(this,"isReady",!1),j(this,"restartCnt",0),j(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new br("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(vf.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??bi.SEND_ONLY,this.name=this.direction===bi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=pE(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,fn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await $N();if(this.localCapabilities=Xg(i),r){const{sdp:s}=r,c=I_e(r,P_e),d=function(){const _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},S=Yg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},M={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(js(S,_,"videoExtensions",w,C,M),js(S,_,"videoCodecs",w,C,M),js(S,_,"audioExtensions",w,C,M),js(S,_,"audioCodecs",w,C,M),W("RAISE_H264_BASELINE_PRIORITY")){const I=M.videoCodecs.findIndex(k=>k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&k.fmtp&&k.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){const k=M.videoCodecs.findIndex(G=>G.rtpMap&&G.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(k<I){R.debug("raising H264 baseline profile priority");const G=M.videoCodecs[I];M.videoCodecs.splice(I,1),M.videoCodecs.splice(k,0,G)}k!==-1&&W("FILTER_SEND_H264_BASELINE")&&(w.videoCodecs=w.videoCodecs.filter(G=>!(G.rtpMap&&G.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&G.fmtp&&G.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:w,recv:C,sendrecv:M}}({},{},s);this.remoteSDP=new r$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const u=await this.peerConnection.createAnswer();if(!u.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const f=dc(u.sdp);await this.peerConnection.setLocalDescription(u);const g=await q6({},{},u.sdp);this.localCapabilities=Xg(g);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),cd(cd({},f),{},{sdp:u.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=dc(s.sdp);return this.initialOffer=s,cd(cd({},c),{},{sdp:s.sdp})}}catch(i){throw new pe($.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:s,dtlsParameters:c}=r,d=await q6({},{},i);this.remoteSDP=new r$({remoteIceParameters:s,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const u=this.peerConnection.getTransceivers()[0];u!=null&&u.sender&&u.sender.transport&&this.tryBindTransportEvents(u.sender.transport)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new pe($.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Ai(function*(){const d=yield vt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[],f=c.remoteSDP.receive(r,i,s);r.forEach((k,G)=>{if(f[G].needCreateTransceiver){const K=c.peerConnection.addTransceiver(k._mediaStreamTrack,{direction:"sendonly"});u.push(K),k._updateRtpTransceiver(K)}else{const K=c.peerConnection.getTransceivers().find(X=>X.mid===f[G].mid);if(!K)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[G].mid));u.push(K),k._updateRtpTransceiver(K)}}),fn()&&W("SIMULCAST")===!0&&(yield vt(c.applySimulcastForFirefox(u,r)));const g=f.map(k=>k.mid),v=yield vt(c.peerConnection.createOffer()),_=c.mungSendOfferSDP(v.sdp,r,g),S=yi(_),w=g.map(k=>{const G=S.mediaDescriptions.find(K=>K.attributes.mid===k);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return FN(G,W("USE_PUB_RTX"))}),C=u.map((k,G)=>{const K=g[G];return{localSSRC:w[G],id:K}});yield vt(c.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield C}catch(k){const G=c.remoteSDP.toString();throw yield vt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield vt(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),yield vt(c.stopSending(g,!0)),k}yield vt(c.applySimulcastEncodings(u,r)),yield vt(c.applySendEncodings(u,r));const M=c.remoteSDP.toString(),I=c.logSDPExchange(_,"offer","local","send");return I==null||I(M),yield vt(c.setRemoteDescription({type:"answer",sdp:M})),u.map((k,G)=>{const K=g[G];return{localSSRC:w[G],id:K}})}catch(u){throw u instanceof pe?u:new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{d()}})()}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var v;g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const d=await this.peerConnection.createOffer(),u=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const f=this.remoteSDP.toString();u==null||u(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:u}=this.remoteSDP.send(r,i,s,c);if(u){const g=this.remoteSDP.toString(),v=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const _=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(_.sdp,d,r);v==null||v(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const f=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!f||f.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,transceiver:f}}catch(d){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:u}=this.remoteSDP.send(r,i,s,c);if(u){const f=this.remoteSDP.toString(),g=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});const v=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(v.sdp,d,r);g==null||g(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===Eu.Auto&&(this.store.p2pTransport=Eu.SdRtn,wt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(vf.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,wt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(vf.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:s}=dc(i.sdp);return this.store.descriptionStart(),this.direction===bi.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===bi.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:s}=dc(i.sdp);return await this.peerConnection.setLocalDescription(i),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const d=this.remoteSDP.toString(),u=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),u==null||u(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new pe($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?fn()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:cd(cd({},Os),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:cd(cd({},Os),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;xe(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(fu(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...vf.turnServerConfigToIceServers(r.turnServer.servers,i,s)),W("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...vf.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,s)),xe(d=[Eu.Relay,Eu.SdRtn]).call(d,i)&&(c.iceTransportPolicy="relay"),W("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(c.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter(f=>f.tcpport);R.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(s));const u=d.length>s?d[s]:d[0];switch(i){case Eu.SdRtn:const f=r.filter(v=>{var _;return xe(_=v.username).call(_,"glb:")&&v.turnServerURL==v.turnServerURL}),g=f.length>s?f[s]:f[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Ls(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Ls(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case Eu.Relay:u&&(c.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),c.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Ls(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;default:u&&(c.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),c.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Ls(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}),c.push({username:u.username,credential:u.password,credentialType:"password",urls:"stun:".concat(u.turnServerURL,":").concat(u.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var s;r!=null&&r.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,r.state))},r.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const s=r==null?void 0:r.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:c}=i.getSelectedCandidatePair()||{};if(s&&c){const d=s.address+":"+s.port,u=c.address+":"+c.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(lc(d)),", remote ").concat(JSON.stringify(lc(u))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s;if(i||(i=this.peerConnection.getSenders().find(_=>_.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var u;const{bitrateMax:_,frameRate:S,scaleResolutionDownBy:w}=r._encoderConfig;_&&(d.maxBitrate=1e3*_),xe(u=r._hints).call(u,Ht.LOW_STREAM)&&(S&&(d.maxFramerate=Di(S)),w&&w>=1&&(d.scaleResolutionDownBy=w))}if(W("DSCP_TYPE")&&ic()){var f;const _=W("DSCP_TYPE");xe(f=["very-low","low","medium","high"]).call(f,_)&&(d.networkPriority=_)}const g=i.getParameters(),v=(s=g.encodings)===null||s===void 0?void 0:s[0];fn()&&!v&&(c.encodings=[d]),v&&Object.assign(v,d),Object.assign(g,c),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await i.setParameters(g)}async applySendEncodings(r,i){try{if(!wt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],d=i[s];d instanceof an&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){const c=yi(r);return i.forEach((d,u)=>{const f=s[u],g=c.mediaDescriptions.find(v=>v.attributes.mid===f);g&&(Pu(g,d),GN(g,d,this.store.codec))}),zc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,d,u,f;const v=r[g],_=i[g];if(_ instanceof an&&!xe(s=_._hints).call(s,Ht.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=_._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(u=_._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=_._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},w={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,S))}}}async applySimulcastEncodings(r,i){if(!fn()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof an&&this.isVP8Simulcast(c)){const d=r[s],u={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,u))}}}isVP8Simulcast(r){var i,s,c,d,u;return!!(r instanceof an&&W("SIMULCAST")&&this.store.codec==="vp8"&&!xe(i=r._hints).call(i,Ht.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((u=r._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?d=>{this.logSDPExchange(d,"answer",s==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(u=>u.mid&&r.indexOf(u.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(u=>{u.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(u=>u.mid&&r.indexOf(u.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async u=>{u.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var s;if(i=i??((s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp)){var c;const d=(c=yi(i).mediaDescriptions.find(u=>u.attributes.mid===r))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),xe(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,s){const c=yi(r),d=c.mediaDescriptions.find(u=>u.attributes.mid===i);return d&&s===Fe.AUDIO&&d.media.mediaType==="audio"&&Yp(d),zc(c)}},De(gn.prototype,"establish",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"establish"),gn.prototype),De(gn.prototype,"connect",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"connect"),gn.prototype),De(gn.prototype,"receive",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"receive"),gn.prototype),De(gn.prototype,"mockReceive",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"mockReceive"),gn.prototype),De(gn.prototype,"stopReceiving",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"stopReceiving"),gn.prototype),De(gn.prototype,"restartICE",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"restartICE"),gn.prototype),De(gn.prototype,"close",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"close"),gn.prototype),De(gn.prototype,"updateEncoderConfig",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"updateEncoderConfig"),gn.prototype),De(gn.prototype,"updateSendParameters",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"updateSendParameters"),gn.prototype),De(gn.prototype,"replaceTrack",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"replaceTrack"),gn.prototype),De(gn.prototype,"muteLocal",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"muteLocal"),gn.prototype),De(gn.prototype,"unmuteLocal",[Bs],Object.getOwnPropertyDescriptor(gn.prototype,"unmuteLocal"),gn.prototype),gn);function Bs(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},i}let To=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var s$,o$,c$,l$,d$,u$,h$,p$,f$,m$,g$,xn;function v$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Rb(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?v$(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):v$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let D_e=(s$=Co(To.SEND_ONLY),o$=Co(To.SEND_ONLY),c$=Co(),l$=Co(To.RECEIVE_ONLY),d$=Co(To.RECEIVE_ONLY),u$=Co(To.RECEIVE_ONLY),h$=Co(To.RECEIVE_ONLY),p$=Co(To.RECEIVE_ONLY),f$=Co(To.RECEIVE_ONLY),m$=Co(),g$=Co(To.RECEIVE_ONLY),xn=class extends Sn{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Ke.StateChange,r,this._state)}constructor(t,r){super(),j(this,"isPlanB",!1),j(this,"store",void 0),j(this,"statsUploader",void 0),j(this,"sendConnection",void 0),j(this,"recvConnection",void 0),j(this,"localTrackMap",new Map),j(this,"remoteUserMap",new Map),j(this,"localDataChannels",[]),j(this,"pendingLocalTracks",[]),j(this,"pendingRemoteTracks",[]),j(this,"statsCollector",void 0),j(this,"dtlsFailedCount",0),j(this,"sendMutex",void 0),j(this,"recvMutex",void 0),j(this,"_state",$t.Disconnected),j(this,"_restartStates",["disconnected","failed"]),j(this,"reconnectInterval",void 0),j(this,"uploadUnplinkStarted",!1),j(this,"uploadDownlinkStarted",!1),j(this,"uplinkStateUploadInterval",void 0),j(this,"downlinkStatsUploadInterval",void 0),j(this,"handleMuteLocalTrack",async(i,s,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==$t.Connected)return void c(new pe($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(i);if(g.length===0)return void s();const v=g.find(C=>C[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(C=>{let[,{id:M}]=C;return M}));let _=!1;var u,f;i.trackMediaType==="video"?_=!((u=this.localTrackMap.get(Te.LocalAudioTrack))===null||u===void 0||!u.track._muted):_=((f=this.localTrackMap.get(Te.LocalVideoTrack))===null||f===void 0?void 0:f.id)===void 0;const S=this.createMuteMessage(g);await cn(this,Ke.RequestMuteLocal,S);const w=i.trackMediaType==="video"?Xl.MUTE_LOCAL_VIDEO:Xl.MUTE_LOCAL_AUDIO;await cn(this,Ke.RequestP2PMuteLocal,{action:w,message:S,isMuteAll:_}),s()}catch(g){c(g)}finally{d()}}),j(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==$t.Connected)return void c(new pe($.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const u=this.filterTobeUnmutedTracks(i);if(u.length===0)return void s();await this.sendConnection.unmuteLocal(u.map(v=>{let[,{id:_}]=v;return _}));const f=this.createUnmuteMessage(u),g=i.trackMediaType==="video"?Xl.UNMUTE_LOCAL_VIDEO:Xl.UNMUTE_LOCAL_AUDIO;await cn(this,Ke.RequestP2PMuteLocal,{action:g,message:f}),s()}catch(u){c(u)}finally{d()}}),j(this,"handleUpdateVideoEncoder",async(i,s,c,d)=>{let u;typeof d=="boolean"&&d||(u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==i||this.state!==$t.Connected)return void s();const{id:v,track:_}=g;v&&(await this.sendConnection.updateSendParameters(v,_),await this.sendConnection.updateEncoderConfig(v,_),this.emit(Ke.UpdateVideoEncoder,_)),s()}catch(g){c(g)}finally{var f;(f=u)===null||f===void 0||f()}}),j(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const u=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==i||this.state!==$t.Connected)return void s();const{id:f,track:g}=u;f&&await this.sendConnection.updateSendParameters(f,g),s()}catch(u){c(u)}finally{d()}}),j(this,"handleReplaceTrack",async(i,s,c,d)=>{let u;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof d=="boolean"&&d||(u=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:S}]=_;return i===S});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==$t.Connected)return void s();if(await((f=this.sendConnection)===null||f===void 0?void 0:f.replaceTrack(i,v[1].id)),v[0]===Te.LocalVideoTrack&&wt().supportDualStreamEncoding){const _=this.localTrackMap.get(Te.LocalVideoLowTrack);if(_){const S=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=S,_.track._originMediaStreamTrack=S,await new Ie((w,C)=>{this.handleReplaceTrack(_.track,w,C,!0)})}}s()}catch(v){c(v)}finally{var g;(g=u)===null||g===void 0||g()}}),j(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),j(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),j(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),j(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new I8(t),this.bindStatsUploaderEvents(),this.sendMutex=new br("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new br("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},W("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new pe($.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let i;try{if(r){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new a$(t,this.store,bi.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(r);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=$t.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new a$(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{i&&i()}}async p2pConnect(t){if(!this.sendConnection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$t.Connected}async addRemoteCandidate(t,r){if(r===bi.RECEIVE_ONLY){if(!this.sendConnection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new pe($.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,i){var s=this;return Ai(function*(){const c=yield vt(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==$t.Connected){s.throwIfTrackTypeNotMatch(t);const v=t.filter(_=>s.pendingLocalTracks.indexOf(_)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(v))}s.store.pubId=s.store.pubId+1,zr.markPublishStart(s.store.clientId,s.store.pubId);const d=s.filterTobePublishedTracks(t,r,i);if(d.length===0)return void(yield vt(s.tryToUnmuteAudio(t)));d.forEach(v=>{let{track:_,type:S}=v;const w=Date.now();s.store.publish(_.getTrackId(),S===Te.LocalAudioTrack?"audio":"video",w)}),s.bindLocalTrackEvents(d);const u=yield vt(s.sendConnection.send(d.map(v=>{let{track:_}=v;return _}),s.store.codec,s.store.audioCodec)),f=(yield vt(u.next())).value,g=s.createGatewayPublishMessage(d,f);try{yield g}catch(v){throw u.throw(v),(v==null?void 0:v.code)===$.WS_ABORT&&d.forEach(_=>{let{track:S}=_;s.pendingLocalTracks.indexOf(S)===-1&&s.pendingLocalTracks.push(S)}),s.unbindLocalTrackEvents(d),v}yield vt(u.next()),d.forEach(v=>{let{type:_}=v;s.statsCollector.addLocalStats(_)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(d,f),d.forEach(v=>{let{track:_,type:S}=v;const w=Date.now();s.store.publish(_.getTrackId(),S===Te.LocalAudioTrack?"audio":"video",void 0,w)}),s.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==$t.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!xe(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const s=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[d,{track:u}]=c;return{type:d,track:u}})),r.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===$t.Connected)return i&&i[1].track.close(),s;t.forEach(c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[c,{track:d,ssrcs:u}]=s;const f={stream_type:bve(d,c),ssrcs:u};d._muted||!d._enabled?r.push(f):i.push(f)}),r.length>0&&r.forEach(s=>{cn(this,Ke.RequestMuteLocal,[s])}),i.length>0&&i.forEach(s=>{cn(this,Ke.RequestUnmuteLocal,[s])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Ai(function*(){throw new pe($.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await qn(this,Ke.RequestRePublish,this.pendingLocalTracks),this.emit(Ke.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new pe($.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,i,s){var c;if(!this.recvConnection)throw new pe($.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:u,transceiver:f}=await this.recvConnection.receive(r,[{ssrcId:i}],String(t.uid),s);r===Fe.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new Fp(d,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),f&&t._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=i,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new Vp(d,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),f&&t._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(t,t._videoTrack));const g=this.remoteUserMap.get(t);g?g.set(r,u):this.remoteUserMap.set(t,new Map([[r,u]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(_=>{let{user:S,kind:w}=_;return S.uid===t.uid&&r===w});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Ke.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,i,s){if(!this.recvConnection)throw new pe($.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(t.uid),s)}async unsubscribe(t,r,i){const s=this.pendingRemoteTracks.filter(d=>{let{user:u,kind:f}=d;return r!==void 0?u.uid===t.uid&&r===f:u.uid===t.uid});if(s.forEach(d=>{const u=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(u,1)}),this.recvConnection||i||s.forEach(d=>{let{kind:u}=d;var f;if(u===Fe.AUDIO)(f=t._audioTrack)===null||f===void 0||f._destroy(),t._audioTrack=void 0;else if(u===Fe.VIDEO){var g;(g=t._videoTrack)===null||g===void 0||g._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:u}]=d;return u})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[u,{kind:f}]=d;var g,v;if(f===Fe.VIDEO&&u._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),f===Fe.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),i||((v=u._videoTrack)===null||v===void 0||v._destroy(),u._videoTrack=void 0);else if(f===Fe.AUDIO){var _;this.unbindRemoteTrackEvents(u._audioTrack),!i&&((_=u._audioTrack)===null||_===void 0||_._destroy(),u._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:u}]=d;cn(this,Ke.RequestP2PMuteRemote,u)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[Fe.VIDEO,Fe.AUDIO].forEach(s=>{i.has(s)?cn(this,Ke.RequestP2PUnmuteRemote,s):cn(this,Ke.RequestP2PMuteRemote,s)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new pe($.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(r))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const s=r===Fe.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(r)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Te.LocalAudioTrack);if((r==null?void 0:r.track)instanceof tr){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==Te.LocalAudioTrack}).filter(s=>{let[c]=s;return!(t&&c===Te.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Te.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(t,r,i,s,c){if(t){const u=this.localTrackMap.get(Te.LocalAudioTrack),f=s?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);We.publish(this.store.sessionId,{eventElapse:zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(Ht.SCREEN_TRACK))!==-1,audio:!!u,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;i||(i=[]);const u=i.find(g=>g instanceof kn),f=s?(d=this.localTrackMap.get(Te.LocalVideoTrack))===null||d===void 0?void 0:d.track:i.find(g=>g instanceof an);We.publish(this.store.sessionId,{eventElapse:zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:u==null?void 0:u.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(Ht.SCREEN_TRACK))!==-1,audio:!!u,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,i,s){const c=s===Fe.VIDEO?i._videoSSRC:i._audioSSRC;c&&We.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===Fe.VIDEO,audio:s===Fe.AUDIO,peerid:i.uid,subscribeRequestid:s===Fe.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:zr.measureFromSubscribeStart(this.store.clientId,c)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new br("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new br("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Te.LocalAudioTrack);if((t==null?void 0:t.track)instanceof tr){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=$t.Disconnected}getStats(t){var r,i;return t?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Te.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Te.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof an||r&&r.track instanceof kn?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r;const i=Array.from(Zr(r=this.remoteUserMap).call(r)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Te.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=iu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=$t.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[i,{track:s}]=t;switch(i){case Te.LocalVideoTrack:xe(r=s._hints).call(r,Ht.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Te.LocalAudioTrack:s instanceof tr?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Te.LocalVideoLowTrack:}}),this.emit(Ke.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;Array.from(Zr(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(Ke.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((t instanceof Zl?t.uid:t)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let i,s;if(t===bi.SEND_ONLY){if(!this.sendConnection)throw new pe($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new pe($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(r){const c=await s.restartICE(r);return s.isInRestartIce=!1,c}{const c=await s.restartICE();if(c){const d=await qn(this,Ke.RequestP2PRestartICE,{direction:bi.RECEIVE_ONLY,iceParameter:c});await s.restartICE(d),s.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Te.LocalVideoTrack),i=this.localTrackMap.get(Te.LocalAudioTrack),s=t.videoSend.find(C=>{var M;return C.ssrc===(r==null||(M=r.ssrcs)===null||M===void 0?void 0:M[0].ssrcId)}),c=t.audioSend.find(C=>{var M;return C.ssrc===(i==null||(M=i.ssrcs)===null||M===void 0?void 0:M[0].ssrcId)});if(!s||!c)return 1;const d=da(this,Ke.NeedSignalRTT),u=s?s.rttMs:void 0,f=c?c.rttMs:void 0,g=u&&f?(u+f)/2:u||f,v=(g&&d?(g+d)/2:g||d)||0,_=100*t.sendPacketLossRate*.7/50+.3*v/1500,S=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,w=r==null?void 0:r.track;if(w&&w._encoderConfig&&w._hints.indexOf(Ht.SCREEN_TRACK)===-1){const C=w._encoderConfig.bitrateMax,M=t.bitrate.actualEncoded;if(C&&M){const I=(1e3*C-M)/(1e3*C);return b6[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,d=s._videoSSRC,u=t.audioRecv.find(M=>M.ssrc===c),f=t.videoRecv.find(M=>M.ssrc===d);if(!u&&!f)return void(r+=1);const g=da(this,Ke.NeedSignalRTT),v=t.rtt,_=(v&&g?(v+g)/2:v||g)||0,S=u?u.jitterMs:void 0,w=t.recvPacketLossRate;let C=.7*w*100/50+.3*_/1500;S&&(C=.6*w*100/50+.2*_/1500+.2*S/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new Ie((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}filterTobePublishedTracks(t,r,i){const s=[],c=wt(),d=this.getAllTracks();t=Cp(t=t.filter(g=>d.indexOf(g)===-1));let u=!1,f=!1;for(const g of t){if(g instanceof an&&(this.localTrackMap.has(Te.LocalVideoTrack)||u?new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:Te.LocalVideoTrack}),u=!0),r)){const v=this.getLowVideoTrack(g,i);s.push({track:v,type:Te.LocalVideoLowTrack})}if(g instanceof kn){const v=this.localTrackMap.get(Te.LocalAudioTrack);if(v){if(!(v.track instanceof tr))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(f){const _=s.find(S=>{let{type:w}=S;return w===Te.LocalAudioTrack});if(!(_.track instanceof tr))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof tr||g._bypassWebAudio)s.push({track:g,type:Te.LocalAudioTrack});else{const _=new tr;_.addAudioTrack(g),s.push({track:_,type:Te.LocalAudioTrack})}f=!0}}}return s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Cp(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof kn){const c=this.localTrackMap.get(Te.LocalAudioTrack);if(!c)continue;c.track instanceof tr?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([Te.LocalAudioTrack,c]),c.track.close())):r.push([Te.LocalAudioTrack,c])}if(s instanceof an){const c=this.localTrackMap.get(Te.LocalVideoTrack);if(!c)continue;r.push([Te.LocalVideoTrack,c]);const d=this.localTrackMap.get(Te.LocalVideoLowTrack);d&&r.push([Te.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Te.LocalVideoTrack:i.addListener(Ge.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof tr?t.trackList.forEach(i=>{i.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Te.LocalVideoTrack:i.off(Ge.GET_STATS,this.handleGetLocalVideoStats),i.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof tr?t.trackList.forEach(r=>{r.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ge.GET_STATS,this.handleGetLocalAudioStats),r.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ge.GET_STATS,this.handleGetLocalAudioStats),t.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Vp&&r.addListener(Ge.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof Fp&&r.addListener(Ge.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;i.has(Fe.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(Fe.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((i,s)=>{var c;let d,{track:u,type:f}=i;switch(f){case Te.LocalAudioTrack:d=qt.Audio;break;case Te.LocalVideoTrack:d=xe(c=u._hints).call(c,Ht.SCREEN_TRACK)?qt.Screen:qt.High;break;case Te.LocalVideoLowTrack:d=qt.Low}return{kind:f===Te.LocalAudioTrack?Fe.AUDIO:Fe.VIDEO,stream_type:d,mid:r[s].id,ssrcs:r[s].localSSRC,isMuted:u.muted||!u.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var i;let s,[c,{track:d,ssrcs:u,id:f}]=r;switch(c){case Te.LocalVideoTrack:s=xe(i=d._hints).call(i,Ht.SCREEN_TRACK)?qt.Screen:qt.High;break;case Te.LocalAudioTrack:s=qt.Audio;break;case Te.LocalVideoLowTrack:s=qt.Low}return{stream_type:s,ssrcs:u,mid:f}})}assignLocalTracks(t,r){t.forEach((i,s)=>{let{track:c,type:d}=i;this.localTrackMap.set(d,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var i;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Ke.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),xe(i=this._restartStates).call(i,r)&&!t.isInRestartIce&&(r==="disconnected"&&await dr(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),We.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:rn.TRACER}).onSuccess(),this.emit(Ke.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var i;const s=Array.from(Zr(i=this.remoteUserMap).call(i)).find(d=>d._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(Za.FIRST_FRAME_DECODED),We.firstRemoteFrame(this.store.sessionId,er.FIRST_AUDIO_DECODE,_n.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i;const s=Array.from(Zr(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);s&&We.firstRemoteFrame(this.store.sessionId,er.FIRST_AUDIO_RECEIVED,_n.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{this.reportVideoFirstFrameDecoded(r,i,s)},t.onFirstVideoReceived=r=>{var i;const s=Array.from(Zr(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&We.firstRemoteFrame(this.store.sessionId,er.FIRST_VIDEO_RECEIVED,_n.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,i)=>{const s=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(Ke.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Jl(i))," -> ").concat(JSON.stringify(Jl(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Jl(i))," -> ").concat(JSON.stringify(Jl(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Ke.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===bi.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===bi.SEND_ONLY?this.restartICE(t):qn(this,Ke.RequestP2PRestartICE,{direction:bi.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const i=this.localTrackMap.get(Te.LocalAudioTrack);if(t instanceof kn&&(i==null?void 0:i.track)instanceof tr)return i.track.isActive||r.push([Te.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(s&&(r.push(s),s[0]===Te.LocalVideoTrack)){const c=this.localTrackMap.get(Te.LocalVideoLowTrack);c&&r.push([Te.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],i=this.localTrackMap.get(Te.LocalAudioTrack);if(t instanceof kn&&(i==null?void 0:i.track)instanceof tr)return i.track.isActive&&r.push([Te.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(s)if(s[0]===Te.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get(Te.LocalVideoLowTrack);c&&r.push([Te.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(t){return t.map(r=>{var i;let s,[c,{track:d,ssrcs:u,id:f}]=r;switch(c){case Te.LocalAudioTrack:s=qt.Audio;break;case Te.LocalVideoTrack:s=xe(i=d._hints).call(i,Ht.SCREEN_TRACK)?qt.Screen:qt.High;break;case Te.LocalVideoLowTrack:s=qt.Low}return{stream_type:s,ssrcs:u,mid:f}})}createUnmuteMessage(t){return t.map(r=>{var i;let s,[c,{track:d,ssrcs:u,id:f}]=r;switch(c){case Te.LocalAudioTrack:s=qt.Audio;break;case Te.LocalVideoTrack:s=xe(i=d._hints).call(i,Ht.SCREEN_TRACK)?qt.Screen:qt.High;break;case Te.LocalVideoLowTrack:s=qt.Low}return{stream_type:s,ssrcs:u,mid:f}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const c=s.get(r);if(!c)return i;i.push([t,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[d,u]=c;i.push([t,{kind:d,id:u}])});return i}createUnsubscribeMessage(t){const r=[];return t.forEach(i=>{let[s,{kind:c,id:d}]=i;switch(c){case Fe.VIDEO:return void(s._videoSSRC&&r.push({stream_type:Fe.VIDEO,ssrcId:s._videoSSRC}));case Fe.AUDIO:return void(s._audioSSRC&&r.push({stream_type:Fe.AUDIO,ssrcId:s._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[i,{kind:s}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Te.LocalVideoTrack),i=this.localTrackMap.get(Te.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new Ie((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),i&&t.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Ie((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof kn){const i=this.filterTobeUnmutedTracks(t[r]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await cn(this,Ke.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Ke.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Ke.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await dr(lE(this.dtlsFailedCount,Bn)),this.emit(Ke.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof an)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof an).length>1)throw new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof kn).length>1&&(t.some(r=>r instanceof kn&&r._bypassWebAudio)||!wt().webAudioMediaStreamDest))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof an&&this.pendingLocalTracks.some(i=>i instanceof an))throw new pe($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof kn&&this.pendingLocalTracks.some(i=>i instanceof kn)&&(!wt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof kn&&i._bypassWebAudio)))throw new pe($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const i=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding,s=Rb(Rb({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?t._mediaStreamTrack.clone():lO(t,s);const d=Kt(8,"track-low-"),u=new an(c,Rb(Rb({},i&&{scaleResolutionDownBy:VN(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,d);return u.on(wu.TRANSCEIVER_UPDATED,f=>{t._updateRtpTransceiver(f,Dp.LOW_STREAM)}),u._hints.push(Ht.LOW_STREAM),t.addListener(Ge.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,i,s){var c;const d=Array.from(Zr(c=this.remoteUserMap).call(c)).find(u=>u._videoSSRC===t);if(d){s||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,f=u.subscribe.find(g=>g.userId===d.uid&&g.type==="video");We.firstRemoteVideoDecode(this.store.sessionId,er.FIRST_VIDEO_DECODE,_n.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:i,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,r,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const c=s.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==i}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new pe($.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new pe($.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new pe($.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new pe($.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new pe($.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new pe($.NOT_SUPPORTED)}async preConnect(t){throw new pe($.NOT_SUPPORTED)}getEstablishParams(){throw new pe($.NOT_SUPPORTED)}async reSubscribe(t){throw new pe($.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,r){throw new pe($.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:i}]=t;r===Te.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Dp.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},De(xn.prototype,"p2pConnect",[s$],Object.getOwnPropertyDescriptor(xn.prototype,"p2pConnect"),xn.prototype),De(xn.prototype,"unpublish",[o$],Object.getOwnPropertyDescriptor(xn.prototype,"unpublish"),xn.prototype),De(xn.prototype,"unpublishLowStream",[c$],Object.getOwnPropertyDescriptor(xn.prototype,"unpublishLowStream"),xn.prototype),De(xn.prototype,"subscribe",[l$],Object.getOwnPropertyDescriptor(xn.prototype,"subscribe"),xn.prototype),De(xn.prototype,"mockSubscribe",[d$],Object.getOwnPropertyDescriptor(xn.prototype,"mockSubscribe"),xn.prototype),De(xn.prototype,"unsubscribe",[u$],Object.getOwnPropertyDescriptor(xn.prototype,"unsubscribe"),xn.prototype),De(xn.prototype,"muteRemote",[h$],Object.getOwnPropertyDescriptor(xn.prototype,"muteRemote"),xn.prototype),De(xn.prototype,"unmuteRemote",[p$],Object.getOwnPropertyDescriptor(xn.prototype,"unmuteRemote"),xn.prototype),De(xn.prototype,"hasRemoteMediaWithLock",[f$],Object.getOwnPropertyDescriptor(xn.prototype,"hasRemoteMediaWithLock"),xn.prototype),De(xn.prototype,"disconnectForReconnect",[m$],Object.getOwnPropertyDescriptor(xn.prototype,"disconnectForReconnect"),xn.prototype),De(xn.prototype,"remoteMediaSsrcChanged",[g$],Object.getOwnPropertyDescriptor(xn.prototype,"remoteMediaSsrcChanged"),xn.prototype),xn);function Co(t){return function(r,i,s){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var d=arguments.length,u=new Array(d),f=0;f<d;f++)u[f]=arguments[f];switch(t){case To.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,u)}finally{g()}}case To.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,u)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(i)),v=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,u)}finally{g(),v()}}}},s}}class $u extends Sn{constructor(r,i){super(),j(this,"signal",void 0),j(this,"token",void 0),j(this,"tokenTimeout",void 0),j(this,"tokenInterval",void 0),j(this,"_sequence",0),j(this,"userMap",new Map),j(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const s=()=>{this.signal.connectionState===Rt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*W("P2P_TOKEN_INTERVAL"))};s()}async send(r,i,s,c,d){var u;if(this.userMap.size===0)return;const f=Array.from(oa(u=this.userMap).call(u))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=c??Kt(6,""),d=d??this._sequence++;const g={_id:c,_type:r,_seq:d,_message:i,token:"".concat(this.token,"_").concat(f)};W("SHOW_P2P_LOG")&&R.debug("send message",g,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(g)).forEach(_=>{this.signal.request(ze.DATA_STREAM,{payload:zl(this.encoder.encode(_))})});const v=new Ie((_,S)=>{const w=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),I),this.off(Hp.ABORT,M),R.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?S(new pe($.INVALID_REMOTE_USER)):S(new pe($.TIMEOUT))},W("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{w&&window.clearTimeout(w),this.off(Hp.ABORT,M),s&&_()},M=()=>{w&&window.clearTimeout(w),this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),I),S(new pe($.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Hp.ABORT,M),this.once("res-@".concat(c,"_ack"),C);const I=(G,K)=>{k=!0,w&&window.clearTimeout(w),this.off("res-@".concat(c,"_ack"),C),this.off(Hp.ABORT,M),G==="success"?_(K):S(new pe($.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let k=!1;s||(this.once("res-@".concat(c),I),dr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{k||R.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))}))});try{return await v}catch(_){if(_.code===$.TIMEOUT)return await this.send(r,i,s,c,d);throw _}}onMessage(r){var i;const{_uid:s}=r;let c,d=this.userMap.get(s);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Un.CHECK)return;const{token:v}=r;c=new Map,d={uid:s,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,d),this.signal.emit(ot.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in r&&"total"in r){var u;const{id:v,total:_}=r,S=(u=c.get(v))!==null&&u!==void 0?u:[];if(S.push(r),c.has(v)||c.set(v,S),S.length!==_)return;{const w=iu(S).call(S,(C,M)=>C.index-M.index).map(C=>C.payload).join("");c.delete(v),(r=JSON.parse(w))._uid=s}}const{_type:f,token:g}=r;if(xe(i=[Un.ACK,Un.CHECK]).call(i,f))return f===Un.CHECK&&this.handleCheckToken(d,g),void this.receiveMessage(r);g==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):R.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:Kt(6,""),token:this.token,_type:Un.CHECK};W("SHOW_P2P_LOG")&&R.debug("send message",r),this.signal.request(ze.DATA_STREAM,{payload:zl(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:Un.ACK,token:this.token};W("SHOW_P2P_LOG")&&R.debug("send message",i),this.signal.request(ze.DATA_STREAM,{payload:zl(this.encoder.encode(JSON.stringify(i)))})}response(r,i,s){this.send(Un.RESPONSE,JSON.stringify({success:!s,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:S}=v;for(;_.has(S);){const w=_.get(S);_.delete(S),this.receiveMessage(w),v.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:s,_seq:c}=r,d=this.userMap.get(s),{receivedMessagesMap:u,isStart:f,nextExpectedSequenceNumber:g}=d;if(c<g)return this.ack(r._id),void R.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));u.set(c,r),f&&c===g&&(this.receiveMessage(r),u.delete(g),d.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:s,_message:c,_uid:d}=r;if(W("SHOW_P2P_LOG")&&R.debug("receive message",r),i){let u;switch(r._type!==Un.ACK&&(c&&(u=JSON.parse(c)),this.ack(r._id)),r._type){case Un.CANDIDATE:case Un.CONTROL:this.signal.emit(s,u,d);break;case Un.PUBLISH:case Un.UNPUBLISH:case Un.RESTART_ICE:case Un.CALL:u.uid=d,qn(this.signal,s,u).then(f=>{this.response(r._id,f)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Un.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Un.RESPONSE:{const{success:f,message:g}=u;this.emit("res-@".concat(i),f?"success":"failed",g);break}}}}splitMessage(r){if(r.length<$u.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:s}=JSON.parse(r),c=Kt(6,"");let d=0,u=800;const f=Math.ceil(r.length/u);for(;r.length>0;){d++;const g={id:c,index:d,total:f,payload:r.slice(0,u),token:"".concat(this.token,"_").concat(s)};JSON.stringify(g).length>$u.MAX_MESSAGE_SIZE?u-=50:(i.push(g),r=r.slice(u))}return i.map(g=>JSON.stringify(g))}handleCheckToken(r,i){return r.token!==i?(R.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(i)),this.reset(r.uid)},W("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await qn(this.signal,Un.CALL,void 0),i=await this.send(Un.CALL,r);this.signal.emit($e.P2P_CONNECTION,i,!0)}async reset(r,i){const s=this.userMap.get(r);s&&(this.emit(Hp.ABORT),this.signal.emit(ot.ON_USER_OFFLINE,{uid:s.uid,reason:qge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(R.debug("change local token from ".concat(i," to ").concat(i)),this.token=Kt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Hp.ABORT)}}j($u,"MAX_SIZE",1),j($u,"MAX_MESSAGE_SIZE",1024);class k_e extends Sn{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Rt.CONNECTED?this.emit($e.WS_CONNECTED):r===Rt.RECONNECTING?this.emit($e.WS_RECONNECTING,this._websocketReconnectReason):r===Rt.CLOSED&&this.emit($e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),j(this,"__name__","P2PSignal"),j(this,"_disconnectedReason",void 0),j(this,"_websocketReconnectReason",void 0),j(this,"_connectionState",Rt.CLOSED),j(this,"reconnectToken",void 0),j(this,"p2pToken",void 0),j(this,"websocket",void 0),j(this,"openConnectionTime",void 0),j(this,"clientId",void 0),j(this,"lastMsgTime",Date.now()),j(this,"uploadCache",[]),j(this,"uploadCacheInterval",void 0),j(this,"rttRolling",new WA(5)),j(this,"pingpongTimer",void 0),j(this,"pingpongTimeoutCount",0),j(this,"joinResponse",void 0),j(this,"multiIpOption",void 0),j(this,"initError",void 0),j(this,"spec",void 0),j(this,"store",void 0),j(this,"_external_signal",void 0),j(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit($e.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case ot.ON_DATA_STREAM:return void this.handleDataStream(c._message);case ot.MUTE_AUDIO:case ot.MUTE_VIDEO:case ot.ON_P2P_LOST:case ot.ON_USER_ONLINE:return;case ot.ON_USER_OFFLINE:const{uid:d}=c._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===ot.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ot.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}if(c._type===ot.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case qe.ERR_LICENSE_MISSING:this.close(Ct.LICENSE_MISSING);break;case qe.ERR_LICENSE_EXPIRED:this.close(Ct.LICENSE_EXPIRED);break;case qe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ct.LICENSE_MINUTES_EXCEEDED);break;case qe.ERR_LICENSE_PERIOD_INVALID:this.close(Ct.LICENSE_PERIOD_INVALID);break;case qe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case qe.ERR_LICENSE_ILLEGAL:this.close(Ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new jN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Rt.CONNECTED&&this.reconnect("retry",Ur.OFFLINE)}),this.p2pToken=Kt(6,""),this._external_signal=new $u(this,this.p2pToken)}async request(r,i,s,c){const d=Kt(6,""),u={_id:d,_type:r,_message:i},f=this.websocket.connectionID,g=()=>new Ie((M,I)=>{if(this.connectionState===Rt.CONNECTED)return M();const k=()=>{this.off($e.WS_CLOSED,G),M()},G=()=>{this.off($e.WS_CONNECTED,k),I(new pe($.WS_ABORT))};this.once($e.WS_CONNECTED,k),this.once($e.WS_CLOSED,G)});if(this.connectionState!==Rt.CONNECTING&&this.connectionState!==Rt.RECONNECTING||r===ze.JOIN||r===ze.REJOIN||await g(),this.websocket.sendMessage(u,!0),c)return;const v=new Ie((M,I)=>{let k=!1;const G=(X,te)=>{k=!0,M({isSuccess:X==="success",message:te||{}}),this.off($e.WS_CLOSED,K),this.off($e.WS_RECONNECTING,K),this.emit($e.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(d),G);const K=()=>{I(new pe($.WS_ABORT,"type: ".concat(r))),this.off($e.WS_CLOSED,K),this.off($e.WS_RECONNECTING,K),this.off("res-@".concat(d),G)};this.once($e.WS_CLOSED,K),this.once($e.WS_RECONNECTING,K),dr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||k||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit($e.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(M){if(this.connectionState===Rt.CLOSED||r===ze.LEAVE)throw new pe($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?M.throw():r===ze.JOIN||r===ze.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const S=Number(_.message.error_code||_.message.code),w=Iu(S),C=new pe($.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(_.message.error_str),{code:S,data:_.message,desc:w.desc});return w.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(S,", message: ").concat(w.desc,", action: ").concat(w.action)),S===qe.ERR_TOO_MANY_BROADCASTERS?((r===ze.JOIN||r===ze.REJOIN)&&(this.initError=C,this.close()),C.throw()):w.action==="failed"?C.throw():w.action==="quit"?(this.initError=C,this.close(),C.throw()):(S===qe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ur.MULTI_IP)):this.reconnect(w.action,Ur.SERVER_ERROR),r===ze.JOIN||r===ze.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new Ie(s=>{const c=d=>{(!i||i(d))&&(this.off(r,c),s(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Ou.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const d=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Rt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const s={_type:r,_message:i};this.websocket.sendMessage(s)}async sendExtensionMessage(r,i,s){return await this._external_signal.send(r,i,s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ie((i,s)=>{this.once($e.WS_CONNECTED,()=>i(this.joinResponse)),this.once($e.WS_CLOSED,()=>s(this.initError||new pe($.WS_ABORT))),this.connectionState=Rt.CONNECTING,this.websocket.init(r).catch(s)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Ct.LEAVE,this.connectionState=Rt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Kt(6,""),this._external_signal.clear(),this._external_signal=new $u(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit($e.ABORT_P2P_EXECUTION);const r=await qn(this,$e.REQUEST_JOIN_INFO),i=await this.request(ze.JOIN,r);if(!i)return this.emit($e.REPORT_JOIN_GATEWAY,$.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit($e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Rt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){return!1}handleDataStream(r){try{var i;const s=yu(r.payload),c=new TextDecoder().decode(s),d=JSON.parse(c);"total"in d&&"id"in d||xe(i=Object.values(Un)).call(i,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(ot.ON_DATA_STREAM,r)}catch{this.emit(ot.ON_DATA_STREAM,r)}}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Iu(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?r.code===qe.ERR_REPEAT_JOIN_CHANNEL&&W("IGNORE_UID_CHECK")?void this.close(Ct.UID_CONFLICT):(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(i.action,Ur.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=W("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ur.TIMEOUT):this.request(ze.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),W("REPORT_STATS")&&this.send(ze.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWebsocketEvents(){this.websocket.on(pt.RECONNECT_CREATE_CONNECTION,r=>{this.emit($e.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(pt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pt.CLOSED,()=>{this.connectionState=Rt.CLOSED}),this.websocket.on(pt.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=Rt.CLOSED}),this.websocket.on(pt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Rt.CONNECTED?this.connectionState=Rt.RECONNECTING:this.connectionState=Rt.CONNECTING}),this.websocket.on(pt.WILL_RECONNECT,(r,i,s)=>{r!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(r)}),this.websocket.on(pt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit($e.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof pe&&r.code===$.UNEXPECTED_RESPONSE&&r.data.code===qe.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ur.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ur.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(pt.REQUEST_NEW_URLS,(r,i)=>{qn(this,$e.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const L_e={name:"P2PChannel",create:function(t){let{store:r,statsCollector:i}=t;return new D_e(r,i)},createSubmodule:function(t){let{store:r,spec:i}=t;return new k_e(i,r)}};function y$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function _$(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?y$(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):y$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class j_e{constructor(r){j(this,"sessionDesc",void 0),j(this,"localCapabilities",void 0),j(this,"rtpCapabilities",void 0),j(this,"candidates",void 0),j(this,"_originCandidates",void 0),j(this,"iceParameters",void 0),j(this,"dtlsParameters",void 0),j(this,"setup",void 0),j(this,"currentMidIndex",void 0),j(this,"cname",void 0),r=mn(r);const{iceParameters:i,dtlsParameters:s,candidates:c,rtpCapabilities:d,setup:u,localCapabilities:f,sdkCodec:g,cname:v}=r,_=yi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=mn(c),this.iceParameters=i,this.dtlsParameters=s,this.setup=u,this.localCapabilities=f,this.cname=v;for(let S=0;S<_.mediaDescriptions.length;S++){const w=_.mediaDescriptions[S];if(w.attributes.iceUfrag=i.iceUfrag,w.attributes.icePwd=i.icePwd,w.attributes.fingerprints=s.fingerprints,w.attributes.candidates=c,w.attributes.setup=u,w.media.mediaType==="video"){w.media.fmts=d.videoCodecs.map(I=>I.payloadType.toString(10));const C=d.videoCodecs.filter(I=>{var k,G;return(k=I.rtpMap)===null||k===void 0?void 0:xe(G=k.encodingName.toLowerCase()).call(G,g)}),M=d.videoCodecs.filter(I=>!xe(C).call(C,I));w.attributes.payloads=[...C,...M],w.attributes.extmaps=d.videoExtensions}w.media.mediaType==="audio"&&(w.media.fmts=d.audioCodecs.map(C=>C.payloadType.toString(10)),w.attributes.payloads=d.audioCodecs,w.attributes.extmaps=d.audioExtensions),_.mediaDescriptions[S]=this.mungMediaDesc(w)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return zc(this.sessionDesc)}send(r,i,s){const{ssrcs:c,ssrcGroups:d}=qg(i,this.cname),u=this.sessionDesc.mediaDescriptions.find(v=>r===Fe.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),f=c[0].attributes.label,g=c[0].attributes.mslabel;return u.attributes.ssrcs=u.attributes.ssrcs.concat(c),u.attributes.ssrcGroups=u.attributes.ssrcGroups.concat(d),{id:f,mslabel:g}}batchSend(r){return r.map(i=>{let{kind:s,ssrcMsg:c}=i;return this.send(s,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],c=[],d=[];i.attributes.ssrcs.forEach(u=>{xe(r).call(r,u.attributes.label||"")?d.push(u):s.push(u)}),i.attributes.ssrcGroups.forEach(u=>{var f;xe(f=d.map(g=>g.ssrcId)).call(f,u.ssrcIds[0])||c.push(u)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,s){r.forEach((c,d)=>{const u=c._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===u.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],c);this.sessionDesc.mediaDescriptions[f]=g})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),s=[];if(i.forEach(c=>{s.push(_$(_$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case Sr.TCP_RELAY:this.candidates=s;break;case Sr.UDP_TCP_RELAY:case Sr.RELAY:this.candidates=[...i,...s];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=mn(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(r,i){const s=mn(r);return Pu(s,i),WN(s,i),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(s!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,s){const c=this.sessionDesc.mediaDescriptions.find(u=>r===Fe.VIDEO?u.attributes.mid==="video":u.attributes.mid==="audio");if(c){const u=c.attributes.ssrcs.find(f=>f.attributes.label===i);var d;u&&(u.attributes.label=s,(d=u.attributes.msid)===null||d===void 0||d.replace(i,s))}}mungMediaDesc(r){const i=mn(r);return BN(i),function(s){const c=s.attributes.extmaps.find(d=>$E(d.extensionName));c&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(c),1),s.attributes.payloads.forEach(d=>{const u=d.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");u!==-1&&d.rtcpFeedbacks.splice(u,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===r)return[s]}}var ln;function E$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ab(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?E$(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):E$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let M_e=(ln=class qv extends VE{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return xe(i=Object.keys(bu)).call(i,r)}))]}constructor(r,i){super(r,i),j(this,"store",void 0),j(this,"peerConnection",void 0),j(this,"remoteSDP",void 0),j(this,"initialOffer",void 0),j(this,"statsFilter",void 0),j(this,"useRTX",!1),j(this,"localCapabilities",void 0),j(this,"localCandidateCount",0),j(this,"allCandidatesReceived",!1),j(this,"establishPromise",void 0),j(this,"mutex",void 0),this.store=i,this.mutex=new br("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(qv.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=pE(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,fn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=dc(r.sdp),s=Yg(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=r,Ab(Ab({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:r.sdp})}catch(r){throw new pe($.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new j_e(Ab(Ab({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new pe($.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var s=this;return Ai(function*(){const c=yield vt(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(w=>s.peerConnection.addTrack(w._mediaStreamTrack)),u=yield vt(s.peerConnection.createOffer()),f=yi(u.sdp),g=r.map(w=>{const C=w._mediaStreamTrack,M=f.mediaDescriptions.find(I=>I.attributes.mid===C.kind);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,k,G){const K=I.attributes.ssrcs.filter(te=>te.attributes.label===k),X=I.attributes.ssrcGroups;if(K.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(X&&K.length>1){const te=X.find(ne=>ne.ssrcIds.indexOf(K[0].ssrcId)!==-1);return te?[{ssrcId:te.ssrcIds[0],rtx:G?te.ssrcIds[1]:void 0}]:[{ssrcId:K[0].ssrcId}]}return[{ssrcId:K[0].ssrcId}]}(M,C.id,s.useRTX)});let v;try{v=yield g}catch(w){throw d.forEach(C=>{Er()&&C.replaceTrack(null),s.peerConnection.removeTrack(C)}),w}const _=s.mungSendOfferSDP(u.sdp,r);s.remoteSDP.receive(r,i,v);const S=s.remoteSDP.toString();return yield vt(s.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield vt(s.applySendEncodings(d,r)),yield vt(s.peerConnection.setRemoteDescription({type:"answer",sdp:S})),r.map((w,C)=>{const M=w._mediaStreamTrack.id;return{localSSRC:g[C],id:M}})}catch(d){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(d=>{var u;return r.indexOf(((u=d.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(d=>{Er()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:u}=this.remoteSDP.send(r,i,c),f=new Ie((_,S)=>{const w=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(d)))},1e4),C=M=>{const I=jt();if((I.name==="Safari"&&Number(I.version)===11||Qr())&&M.track.id!==d&&M.streams[0].id===u){var k;const G=M.streams[0].getTracks()[0];return(k=this.remoteSDP)===null||k===void 0||k.updateTrackLabel(r,d,M.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(w),void _(G)}if(M.track.id===d)return this.peerConnection.removeEventListener("track",C),clearTimeout(w),void _(M.track)};this.peerConnection.addEventListener("track",C)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await f,id:d}}catch(d){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(s=>{var c;return r.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(s=>{if(Er()&&s.track)s.track.enabled=!1;else{const c=s.getParameters();c.encodings.forEach(d=>d.active=!1),s.setParameters(c)}})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(d=>{var u;return r.indexOf(((u=d.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async d=>{if(Er()&&d.track)d.track.enabled=!0;else{const u=d.getParameters();u.encodings.forEach(f=>f.active=!0),await d.setParameters(u)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Ai(function*(){const s=yield vt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=wt().supportPCSetConfiguration;if(r===Sr.RELAY&&!c)return;if(c){const v=i.peerConnection.getConfiguration(),_=r===Sr.RELAY?"relay":"all";v.iceTransportPolicy!==_&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(_,"]")),v.iceTransportPolicy=_,i.peerConnection.setConfiguration(v))}r!==Sr.RELAY&&i.remoteSDP.updateCandidates(r);const d=yield vt(i.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=dc(d.sdp),{remoteIceParameters:f}=yield u.iceParameters;i.remoteSDP.restartICE(f);const g=i.remoteSDP.toString();yield vt(i.peerConnection.setLocalDescription(d)),yield vt(i.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new pe($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});s.length===1&&await this.applySendEncodings(s,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===i});s&&await s.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new pe($.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new pe($.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(fu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...qv.turnServerConfigToIceServers(r.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...qv.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var s;if(i||(i=this.peerConnection.getSenders().find(v=>{var _;return((_=v.track)===null||_===void 0?void 0:_.id)===r._mediaStreamTrack.id})),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!wt().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof an)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(W("DSCP_TYPE")&&ic()){var u;const v=W("DSCP_TYPE");xe(u=["very-low","low","medium","high"]).call(u,v)&&(d.networkPriority=v)}const f=i.getParameters(),g=(s=f.encodings)===null||s===void 0?void 0:s[0];g&&Object.assign(g,d),Object.assign(f,c),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await i.setParameters(f)}async applySendEncodings(r,i){try{if(!wt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],d=i[s];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const s=yi(r);return i.forEach((c,d)=>{const u=c._mediaStreamTrack,f=s.mediaDescriptions.find(g=>g.attributes.mid===u.kind);f&&Pu(f,c)}),zc(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((d,u)=>{let{id:f,mslabel:g}=d;const{kind:v}=r[u];return new Ie((_,S)=>{const w=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(f)))},1e4),C=M=>{const I=jt();if(I.name==="Safari"&&Number(I.version)===11&&M.track.id!==f&&M.streams[0].id===g){var k;const G=M.streams[0].getTracks()[0];return(k=this.remoteSDP)===null||k===void 0||k.updateTrackLabel(v,f,M.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(w),void _({track:G,id:f})}if(M.track.id===f)return this.peerConnection.removeEventListener("track",C),clearTimeout(w),void _({track:M.track,id:f})};this.peerConnection.addEventListener("track",C)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await Ie.all(i)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(wt().supportPCSetConfiguration){const i=qv.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},De(ln.prototype,"connect",[as],Object.getOwnPropertyDescriptor(ln.prototype,"connect"),ln.prototype),De(ln.prototype,"stopSending",[as],Object.getOwnPropertyDescriptor(ln.prototype,"stopSending"),ln.prototype),De(ln.prototype,"receive",[as],Object.getOwnPropertyDescriptor(ln.prototype,"receive"),ln.prototype),De(ln.prototype,"stopReceiving",[as],Object.getOwnPropertyDescriptor(ln.prototype,"stopReceiving"),ln.prototype),De(ln.prototype,"muteRemote",[as],Object.getOwnPropertyDescriptor(ln.prototype,"muteRemote"),ln.prototype),De(ln.prototype,"unmuteRemote",[as],Object.getOwnPropertyDescriptor(ln.prototype,"unmuteRemote"),ln.prototype),De(ln.prototype,"muteLocal",[as],Object.getOwnPropertyDescriptor(ln.prototype,"muteLocal"),ln.prototype),De(ln.prototype,"unmuteLocal",[as],Object.getOwnPropertyDescriptor(ln.prototype,"unmuteLocal"),ln.prototype),De(ln.prototype,"close",[as],Object.getOwnPropertyDescriptor(ln.prototype,"close"),ln.prototype),De(ln.prototype,"updateEncoderConfig",[as],Object.getOwnPropertyDescriptor(ln.prototype,"updateEncoderConfig"),ln.prototype),De(ln.prototype,"updateSendParameters",[as],Object.getOwnPropertyDescriptor(ln.prototype,"updateSendParameters"),ln.prototype),De(ln.prototype,"replaceTrack",[as],Object.getOwnPropertyDescriptor(ln.prototype,"replaceTrack"),ln.prototype),De(ln.prototype,"getRemoteSSRC",[as],Object.getOwnPropertyDescriptor(ln.prototype,"getRemoteSSRC"),ln.prototype),ln);function as(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},i}const U_e={name:"PlanBConnection",create:function(t){let{store:r,spec:i}=t;return new M_e(i,r)}},V_e={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(CE.has(t)||!t.track)return;const i={track:t.track};if($c()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(u){return void R.error("create audio-encoded-streams error",u&&u.message)}const d=new TransformStream({transform(u,f){i.controller||(i.controller=f),t.track&&t.track.id!==i.track.id&&(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const g=r.metadata&&r.metadata();g?function(v,_){const{chunk:S,controller:w}=_,C=Kl.METADATA;S.data=function(M,I,k){const G=k.byteLength,K=G+_N+p6,X=vN+yN+K,te=new ArrayBuffer(M.byteLength+X),ne=new DataView(te);ne.setUint8(0,h6),ne.setUint16(1,K),ne.setUint8(3,I),ne.setUint16(4,G);for(let ie=0;ie<G;ie++)ne.setUint8(6+ie,k[ie]);const Z=new Uint8Array(ne.buffer);return Z.set(new Uint8Array(M),X),Z.buffer}(S.data,C,v),w.enqueue(S)}(g,{chunk:u,controller:f}):f.enqueue(u)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Er()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=TE(),d=new MessageChannel;await new Ie(f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)});const u=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=u,await new Ie(f=>c.onmessage=g=>{g.data==="started"&&f(void 0)}),d.port1.onmessage=f=>{var g;if(f.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id)R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s);else if(f.data.getMetadata){const v=r.metadata&&r.metadata();v&&d.port1.postMessage({metadata:v})}},i.worker=c}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}const c=CE.get(t);if(c){CE.delete(t);try{var d,u;(d=c.controller)===null||d===void 0||d.terminate(),(u=c.worker)===null||u===void 0||u.terminate()}catch(f){R.warning(f&&f.message)}}}CE.set(t,i),t.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(PE.has(t))return;const i={track:t.track,onMetadata:r.onMetadata,onPts:r.onPts};if($c()&&!Qr()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");AA(Ft.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(u){return void R.error("create audio-encoded-streams error",u&&u.message)}const d=new TransformStream({transform(u,f){i.controller||(i.controller=f),t.track&&t.track.id!==i.track.id&&(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s)),r.enableTopn?function(g,v,_){var S;const w=EN(new DataView(v.data));if(!w)return _.enqueue(v);const C=g.track.id;gge.set(C,g.track);const M=(S=w.tlv.find(te=>te.tag===Kl.AUDIO_LEVEL))===null||S===void 0?void 0:S.value;let I=0;typeof M=="number"&&(I=127-M);const k=Math.round(Math.pow(10,I/60)-1),{selected:G,speaker:K}=function(te,ne){let Z=Bp.get(te);if(Z||(Z=function(ie){const ge=new m6;return Bp.set(ie,ge),vo||(vo=new fge(W("TOPN_SILENCE_THRESHOLD")||500),vo.on("ActiveSpeakerChanged",Ee=>{Ee!=null&&(NE=Ee)})),vo.addSpeakers([ge]),ge}(te)),Bp.size<=g6)return{selected:!0,speaker:Z};if(!vo)throw new Error("no active speaker detector");return vo.levelChanged(Z.id,ne),Ru=vo.loudest.map(ie=>ie.id),NE&&!xe(Ru).call(Ru,NE)&&Ru.length>=g6&&Ru.pop(),{selected:xe(Ru).call(Ru,Z.id)||Z.id===NE,speaker:Z}}(g,k),X=function(te,ne,Z){const ie=yo.get(te)||new mge(te,ne);return ie.score=Z,yo.set(te,ie),function(ge){if(OE.set(ge,!0),!IE)return void(IE=Date.now());const Ee=Date.now();Ee-IE>1e3&&(OE.get(ge)?OE.set(ge,!1):(v6(ge),OE.delete(ge)),IE=Ee)}(te),ie}(C,g.track,K.energyScore);X.addSample(G),X.active&&(v.data=w.frame.buffer,_.enqueue(v))}(t,u,f):r.enableMetadata||r.enablePts?function(g,v,_,S){const w=new DataView(g.data),C=w.getUint8(0);let M;if(128&C&&C!==71){const G=function(K){if(K.byteLength<=0)return[];const X=[];let te=0;for(;te<K.byteLength;){const Z=(128&K.getUint8(te))>>7,ie=127&K.getUint8(te);if(!(Z&&te+4<=K.byteLength)){te++;break}{const ge=K.getUint32(te,!1),Ee=(16776192&ge)>>10,Me=1023&ge;X.push({pt:ie,ts_offset:Ee,length:Me,data:new Uint8Array}),te+=4}}let ne=K.byteLength-te;for(const Z of X){if(Z.length>ne)return console.warn("Broken red payload"),[];Z.length>0&&(Z.data=new Uint8Array(K.buffer,K.byteOffset+te,Z.length),te+=Z.length,ne-=Z.length)}if(ne>0){const Z={pt:X.length>0?X[X.length-1].pt:0,ts_offset:0,length:ne,data:new Uint8Array(K.buffer,K.byteOffset+te,ne)};X.push(Z)}return X}(w);if(G.length>0){const K=function(X){let te=0;for(let ie=0;ie<X.length;ie++)te+=ie<X.length-1?4:1,te+=X[ie].length;const ne=new Uint8Array(te);let Z=0;for(let ie=0;ie<X.length;ie++)if(ie<X.length-1){const ge=(2147483648|(127&X[ie].pt)<<24|(262143&X[ie].ts_offset)<<10|1023&X[ie].length)>>>0;ne[Z++]=ge>>24&255,ne[Z++]=ge>>16&255,ne[Z++]=ge>>8&255,ne[Z++]=255&ge}else ne[Z++]=127&X[ie].pt;for(const ie of X)ne.set(ie.data,Z),Z+=ie.length;return ne}(G.map(X=>{const te=new Uint8Array(X.length);te.set(X.data);const ne=EN(new DataView(te.buffer));return ne!=null&&ne.frame&&(X.data=ne==null?void 0:ne.frame),M=ne,X}));g.data=K.buffer}}else M=EN(w),M&&(g.data=M.frame.buffer);if(v.enqueue(g),!M)return;const I=M.tlv.find(G=>G.tag===Kl.METADATA);I&&_&&I.value instanceof Uint8Array&&_(I.value);const k=M.tlv.find(G=>G.tag===Kl.AUDIO_64_BIT_PTS);k&&S&&k.value instanceof Uint8Array&&k.value.length==8&&S(new DataView(k.value.buffer).getBigUint64(0,!0))}(u,f,r.onMetadata,r.onPts):f.enqueue(u)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=TE(),d=new MessageChannel;await new Ie(f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)});const u=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=u,await new Ie(f=>c.onmessage=g=>{g.data==="started"&&f(void 0)}),d.port1.onmessage=f=>{var g;f.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id?(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s)):f.data.metadata&&i.onMetadata?i.onMetadata(f.data.metadata):f.data.pts&&i.onPts&&i.onPts(f.data.pts)},i.worker=c}function s(){t.track.removeEventListener("ended",s),function(c){const d=PE.get(c);if(d){(function(g){const v=Bp.get(g);v&&(Bp.delete(g),vo&&(vo.removeSpeakers([v]),Bp.size===0&&(vo.destroy(),vo=null)))})(c),v6(c.track.id),PE.delete(c);try{var u,f;(u=d.controller)===null||u===void 0||u.terminate(),(f=d.worker)===null||f===void 0||f.terminate()}catch(g){R.warning(g&&g.message)}}}(t)}PE.set(t,i),t.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(t,r){if(!wt().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(DE.has(t)||!t.track)return;const i={track:t.track};if($c()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(f){return void R.error("create video-encoded-streams error",f&&f.message)}const d=[];r.on("sei-to-send",f=>{d.push(f)});const u=new TransformStream({transform(f,g){i.controller||(i.controller=g),t.track&&t.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const v=E6(new Uint8Array(f.data)),_=d.shift();if(_){const S=function(w,C,M){switch(M){case xN:return function(I,k){const G=_6(k),K=G.length,X=Math.floor(K/255),te=K%255,ne=new Uint8Array(6+X+1+K+I.byteLength);ne[0]=0,ne[1]=0,ne[2]=0,ne[3]=1,ne[4]=6,ne[5]=101;let Z=0;for(;Z<X;)ne[6+Z]=255,Z++;return ne[6+Z]=te,Z++,ne.set(G,6+Z),ne.set(new Uint8Array(I),6+Z+K),ne.buffer}(w,C);case TN:return function(I,k){const G=_6(k),K=G.length,X=Math.floor(K/255),te=K%255,ne=new Uint8Array(7+X+1+K+1+I.byteLength);ne[0]=0,ne[1]=0,ne[2]=0,ne[3]=1,ne[4]=78,ne[5]=1,ne[6]=101;let Z=0;for(;Z<X;)ne[7+Z]=255,Z++;return ne[7+Z]=te,Z++,ne.set(G,7+Z),Z+=K,ne[7+Z]=128,Z++,ne.set(new Uint8Array(I),7+Z),ne.buffer}(w,C);default:return null}}(f.data,_,v);S&&(f.data=S)}g.enqueue(f)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else{if(!Er())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=TE(),d=new MessageChannel;await new Ie(f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)});const u=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=u,await new Ie(f=>c.onmessage=g=>{g.data==="started"&&f(void 0)}),r.on("sei-to-send",f=>{d.port1.postMessage({sei:f})}),d.port1.onmessage=f=>{var g;f.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s))},i.worker=c}}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}const c=DE.get(t);if(c){DE.delete(t);try{var d,u;(d=c.controller)===null||d===void 0||d.terminate(),(u=c.worker)===null||u===void 0||u.terminate()}catch(f){R.warning(f&&f.message)}}}DE.set(t,i),t.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!t.track)return;if($g.has(t)){const c=$g.get(t);return void(c&&(c.onSei=r.onSei))}const i={track:t.track,onSei:r.onSei};if($c()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(u){return void R.error("create video-encoded-streams error",u&&u.message)}const d=new TransformStream({transform(u,f){if(i.controller||(i.controller=f),!i.firstFrameInfo){var g;const _=u.getMetadata()||{};i.firstFrameInfo=hn({type:u.type,rtpTimestamp:u.timestamp,payloadType:_.payloadType||0,ssrc:_.synchronizationSource||0,length:u.data.byteLength},"mimeType"in _?{mimeType:_.mimeType}:{}),(g=r.onFirstFrame)===null||g===void 0||g.call(r,i.firstFrameInfo)}t.track&&t.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const v=function(_,S){switch(S){case xN:return function(w){const C=new DataView(w.data);let M=0;for(;M+4<w.data.byteLength;){if(C.getUint8(M+0)===0&&C.getUint8(M+1)===0&&C.getUint8(M+2)===0&&C.getUint8(M+3)===1&&C.getUint8(M+4)===6){let I=M+6,k=0,G=0;for(;(G=C.getUint8(I++))===255;)k+=255;k+=G;const K=y6(w.data,I,k);return new Uint8Array(K)}M++}return null}(_);case TN:return function(w){const C=new DataView(w.data);let M=0;for(;M+5<w.data.byteLength;){if(C.getUint8(M+0)===0&&C.getUint8(M+1)===0&&C.getUint8(M+2)===0&&C.getUint8(M+3)===1&&C.getUint8(M+4)===78&&C.getUint8(M+5)===1&&C.getUint8(M+6)===101){let I=M+7,k=0,G=0;for(;(G=C.getUint8(I++))===255;)k+=255;k+=G;const K=y6(w.data,I,k);return new Uint8Array(K)}M++}return null}(_);default:return null}}(u,E6(new Uint8Array(u.data)));v&&i.onSei&&i.onSei(v),f.enqueue(u)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Er()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=TE(),d=new MessageChannel;await new Ie(f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)});const u=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=u,await new Ie(f=>c.onmessage=g=>{g.data==="started"&&f(void 0)}),d.port1.onmessage=f=>{var g;if(f.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id)R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s);else if(f.data.sei&&i.onSei)i.onSei(f.data.sei);else if(f.data.firstFrameInfo&&r.onFirstFrame){var v;(v=r.onFirstFrame)===null||v===void 0||v.call(r,f.data.firstFrameInfo)}},i.worker=c}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}(function(c){const d=$g.get(c);if(d){$g.delete(c);try{var u,f;(u=d.controller)===null||u===void 0||u.terminate(),(f=d.worker)===null||f===void 0||f.terminate()}catch(g){R.warning(g&&g.message)}}})(t)}$g.set(t,i),t.track.addEventListener("ended",s)}},F_e={name:"InterceptFrame",create:()=>V_e};var kt;function b$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ro(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?b$(Object(i),!0).forEach(function(s){j(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):b$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let B_e=(kt=class yf extends VE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return xe(i=Object.keys(bu)).call(i,r)}))]}constructor(r,i,s){super(r,i),j(this,"id",Kt(5,"connection-")),j(this,"store",void 0),j(this,"peerConnection",void 0),j(this,"forceTurn",!1),j(this,"remoteSDP",void 0),j(this,"initialOffer",void 0),j(this,"transportEventReceiver",void 0),j(this,"statsFilter",void 0),j(this,"extension",{useXR:W("USE_XR")}),j(this,"localCapabilities",void 0),j(this,"remoteCodecs",void 0),j(this,"localCandidateCount",0),j(this,"allCandidatesReceived",!1),j(this,"isPreallocation",!1),j(this,"preMediaMap",new Map),j(this,"dataStreamChannelMap",new Map),j(this,"establishPromise",void 0),j(this,"recoveredDataChannelIds",[]),j(this,"currentDataChannelId",1),j(this,"supportAV1RtpSpec",!1),j(this,"mutex",void 0),j(this,"qualityLimitationReason",Np.NONE),j(this,"isFirstConnected",!1),this.store=i,this.forceTurn=cO(r),this.mutex=new br("NVConnectionExtension-mutex",i.clientId),this.peerConnection=s,this.isFirstConnected=!1,this.statsFilter=pE(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,fn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else R.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=dc(i.sdp),c=await $N({filterRTX:!W("USE_PUB_RTX")&&!W("USE_SUB_RTX"),filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterVideoCodec:W("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:W("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:W("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Xg(c),this.initialOffer=i,W("ENABLE_SVC")&&this.store.codec=="av1"){const u=await Y6();var r;u&&(this.supportAV1RtpSpec=!0,(r=c.send)===null||r===void 0||r.videoExtensions.push(u))}let d;return i.sdp&&zE(i.sdp)&&(d=mn(c),F6(d)),Ro(Ro({},s),{},{rtpCapabilities:d||c,offerSDP:i.sdp})}catch(i){throw new pe($.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&zE(this.initialOffer.sdp)&&B6(r.rtpCapabilities,this.localCapabilities),this.remoteSDP=new _8(Ro(Ro({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!W("ENABLE_PRE_SUB_WITH_PRE_PC")||!W("PRE_USE_LOCAL_CODECS"))&&Bg(this.store),!0),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=HN(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const d=this.peerConnection.getTransceivers()[0];if(d!=null&&d.receiver&&this.tryBindTransportEvents(d.receiver),Bg(this.store))if(r.preallocation&&W("ENABLE_PRE_SUB_WITH_PRE_PC")){const u=W("PRE_SUB_NUM"),{mids:f,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(u);await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(f,g)}else{const{preSSRCs:u=[]}=r,f=u.map(v=>v.ssrcMsg[0].ssrcId);if(u.length===0)return;const{mids:g}=this.remoteSDP.batchSend(u.map(v=>Object.assign({},v)));await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(g,f)}}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(i.toString()))}}presetMedia(r,i){r.forEach((s,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&s===d.mid&&d.receiver.track){const u=d.receiver.track;let f;u.kind==="video"&&W("ENABLE_PRE_RENDER")&&(f=new wE({trackId:"track-".concat(u.kind,"-unknown-").concat(this.store.clientId,"_").concat(Kt(5,""))},!0),f.updateVideoTrack(u),f.onFirstVideoFrameRender=()=>{var g;const v=this.preMediaMap.get(i[c]);v&&(v.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,i[c])},f.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,i[c])},f.play(this.store.sessionId||void 0)),this.preMediaMap.set(i[c],{mid:s,track:u,player:f,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:s}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const u=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||u}const{preSSRCs:c=[]}=r,d=c.map(u=>u.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){const u=[],f=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[v,{mid:_,player:S,track:w}]=g;return u.push(_),f.push(v),this.preMediaMap.delete(v),S&&S.destroy(),!0}),u.length>0&&(this.remoteSDP.stopSending(u),await zi(this.peerConnection,this.remoteSDP,this.extension),R.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),We.reportApiInvoke(this.store.sessionId,{name:yn.PRELOAD_MEDIA_FAILED,options:[c,f],tag:rn.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(v=>Object.assign({},v)));await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(g,d)}}i?(await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):R.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Ai(function*(){const d=yield vt(c.mutex.lock("From NVConnectionExtension.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const u=[],f=Kg();r.forEach(k=>{const G=c.peerConnection.addTransceiver(k._mediaStreamTrack,Ro({direction:"sendonly"},k.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));u.push(G),k._updateRtpTransceiver(G)}),fn()&&W("SIMULCAST")===!0&&(yield vt(c.applySimulcastForFirefox(u,r)));const g=yield vt(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),_=c.mungSendOfferSDP(g.sdp,r,v),S=yi(_),w=v.map(k=>{const G=S.mediaDescriptions.find(K=>K.attributes.mid===k);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return FN(G,W("USE_PUB_RTX"))});let C;try{C=yield w}catch(k){C=[],c.remoteSDP.receive(r,i,s,C);const G=c.remoteSDP.toString();throw yield vt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield vt(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),yield vt(c.stopSending(v,!0)),k}c.remoteSDP.receive(r,i,s,C);const M=c.remoteSDP.toString(),I=c.logSDPExchange(_,"offer","local","send");return yield vt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield vt(c.applySimulcastEncodings(u,r)),yield vt(c.applySendEncodings(u,r)),I==null||I(M),yield vt(c.peerConnection.setRemoteDescription({type:"answer",sdp:M})),u.map((k,G)=>{const K=v[G];return{localSSRC:w[G],id:K,transceiver:k}})}catch(u){throw u instanceof pe?u:new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(u.toString()))}finally{d()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")R.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:W("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}i.forEach(d=>{d._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),R.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else R.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof pe?s:new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof pe?i:new pe($.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");c.map(g=>{var v;Qp(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const d=await this.peerConnection.createOffer(),u=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const f=this.remoteSDP.toString();u==null||u(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:u}=this.remoteSDP.send(r,i,s,c);u&&(await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(r," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:d,transceiver:f}}catch(d){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await zi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),i.map(c=>{const d=this.peerConnection.getTransceivers().find(u=>u.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");r.forEach(d=>{Array.from(this.preMediaMap.entries()).some(u=>{let[f,{mid:g,player:v}]=u;if(g===d)return this.preMediaMap.delete(f),v&&v.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(u=>u.mid&&r.indexOf(u.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(u=>{u.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(u=>u.mid&&r.indexOf(u.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(u,f)=>{u.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new pe($.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Ai(function*(){const s=yield vt(i.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=wt().supportPCSetConfiguration,d=W("FORCE_TURN_TCP")||i.forceTurn;if(r===Sr.RELAY&&!c)return;if(c&&!d){const S=r===Sr.RELAY?"relay":"all",w=i.peerConnection.getConfiguration();w.iceTransportPolicy!==S&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(w.iceTransportPolicy,"] to [").concat(S,"]")),w.iceTransportPolicy=S,i.peerConnection.setConfiguration(w))}i.remoteSDP.updateCandidates(r);const u=yield vt(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=dc(u.sdp),{remoteIceParameters:g}=yield f.iceParameters;i.remoteSDP.restartICE(g);const v=i.remoteSDP.toString(),_=i.logSDPExchange(u.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield vt(i.peerConnection.setLocalDescription(u)),_==null||_(v),yield vt(i.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Sr.TCP_RELAY),await zi(this.peerConnection,this.remoteSDP,this.extension)}catch(i){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{Qp(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:s}=i;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ro(Ro({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const d=this.remoteSDP.toString(),u=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),u==null||u(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new pe($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?fn()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:Ro(Ro({},Os),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Ro(Ro({},Os),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",d=lc(r.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(s,"), url: ").concat(d||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},s=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(fu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:W("NEW_TURN_MODE")&&i.iceServers&&s==="disabled"?(W("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...yf.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...yf.newTurnServerConfigToIceServers(r.turnServer.servers)),W("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...yf.turnServerConfigToIceServers(r.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...yf.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Ls(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!W("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{const c=W("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Ls(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Ls(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair()||{};if(c&&d){const u=c.address+":"+c.port,f=d.address+":"+d.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(lc(u)),", remote ").concat(JSON.stringify(lc(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(k=>k.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},u={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const f=U6(this.peerConnection,r._mediaStreamTrack),g=R3(r);if(T8(r)&&f&&i&&g&&this.getLocalVideoStats&&xe(s=["vp8","vp9"]).call(s,this.store.codec)){var v;const I=d.degradationPreference||(xe(v=r._hints).call(v,Ht.CUSTOM_TRACK)?W("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");C8(this.id+f.mid,g,this,I,k=>{i&&this.updateAdaptation(i,k)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;const{bitrateMax:I,frameRate:k,scaleResolutionDownBy:G}=r._encoderConfig;I&&(u.maxBitrate=1e3*I),(xe(_=r._hints).call(_,Ht.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(k&&(u.maxFramerate=Di(k)),G&&G>=1&&(u.scaleResolutionDownBy=G))}const{maxFramerate:S}=W("ENCODER_CONFIG_LIMIT");if(S&&typeof S=="number"&&(u.maxFramerate=u.maxFramerate?Math.min(u.maxFramerate,S):S),W("DSCP_TYPE")&&ic()){var w;const I=W("DSCP_TYPE");xe(w=["very-low","low","medium","high"]).call(w,I)&&(u.networkPriority=I)}const C=i.getParameters(),M=(c=C.encodings)===null||c===void 0?void 0:c[0];fn()&&!M&&(d.encodings=[u]),M&&Object.assign(M,u),Object.assign(C,d),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await J6(this.store.codec,i,W("SVC_MODE"))}async updateAdaptation(r,i){var s,c;if(!r)return R.debug("[updateAdaptation] no rtpSender found");if(!wt().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:u,frameRate:f,scaleResolutionDownBy:g}=i;u&&(d.maxBitrate=1e3*u),f&&(d.maxFramerate=Di(f)),g&&g>=1&&xe(s=["vp8","vp9"]).call(s,this.store.codec)&&(d.scaleResolutionDownBy=g);const v=r.getParameters(),_=(c=v.encodings)===null||c===void 0?void 0:c[0];_&&Object.assign(_,d),Object.assign(v,{});try{await r.setParameters(v),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(S){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",S):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!wt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],d=i[s];d instanceof an&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){const c=yi(r);return i.forEach((d,u)=>{const f=s[u],g=c.mediaDescriptions.find(v=>v.attributes.mid===f);g&&(Pu(g,d),GN(g,d,this.store.codec))}),zc(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,d,u,f;const v=r[g],_=i[g];if(_ instanceof an&&!xe(s=_._hints).call(s,Ht.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=_._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(u=_._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=_._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},w={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,S))}}}async applySimulcastEncodings(r,i){if(!fn()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof an&&this.isVP8Simulcast(c)){const d=r[s],u={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,u))}}}isVP8Simulcast(r){var i,s,c,d,u;return!!(r instanceof an&&W("SIMULCAST")&&this.store.codec==="vp8"&&!xe(i=r._hints).call(i,Ht.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((u=r._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during NVConnectionExtension.").concat(c,`
`),r),i==="offer"?d=>{this.logSDPExchange(d,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(wt().supportPCSetConfiguration){const i=yf.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},De(kt.prototype,"updateRemoteRTPCapabilities",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"updateRemoteRTPCapabilities"),kt.prototype),De(kt.prototype,"connect",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"connect"),kt.prototype),De(kt.prototype,"updateRemoteConnect",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"updateRemoteConnect"),kt.prototype),De(kt.prototype,"createDataChannels",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"createDataChannels"),kt.prototype),De(kt.prototype,"receive",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"receive"),kt.prototype),De(kt.prototype,"batchReceive",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"batchReceive"),kt.prototype),De(kt.prototype,"stopReceiving",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"stopReceiving"),kt.prototype),De(kt.prototype,"muteRemote",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"muteRemote"),kt.prototype),De(kt.prototype,"unmuteRemote",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"unmuteRemote"),kt.prototype),De(kt.prototype,"muteLocal",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"muteLocal"),kt.prototype),De(kt.prototype,"unmuteLocal",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"unmuteLocal"),kt.prototype),De(kt.prototype,"close",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"close"),kt.prototype),De(kt.prototype,"updateEncoderConfig",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"updateEncoderConfig"),kt.prototype),De(kt.prototype,"updateSendParameters",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"updateSendParameters"),kt.prototype),De(kt.prototype,"replaceTrack",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"replaceTrack"),kt.prototype),De(kt.prototype,"updateAdaptation",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"updateAdaptation"),kt.prototype),De(kt.prototype,"getRemoteSSRC",[ji],Object.getOwnPropertyDescriptor(kt.prototype,"getRemoteSSRC"),kt.prototype),kt);function ji(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,d=await c.lock("From NVConnectionExtension.".concat(r));try{for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},i}var Jt;function S$(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=X0,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new Nb(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Nb(t){function r(i){if(Object(i)!==i)return Ie.reject(new TypeError(i+" is not an object."));var s=i.done;return Ie.resolve(i.value).then(function(c){return{value:c,done:s}})}return Nb=function(i){this.s=i,this.n=i.next},Nb.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Ie.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Ie.reject(i):r(s.apply(this.s,arguments))}},new Nb(t)}let W_e=(Jt=class IS extends VE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(r,i){super(r,i),j(this,"name","DataChannelConnection"),j(this,"store",void 0),j(this,"peerConnection",void 0),j(this,"cname",void 0),j(this,"mutex",new br("DataChannelConnection-mutex")),j(this,"dataChannel",void 0),j(this,"_p2pConnection",void 0),j(this,"establishPromise",void 0),j(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(IS.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new B_e(r,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(r){var i;return(i=this._p2pConnection)===null||i===void 0?void 0:i.getPreMedia(r)}isPreSub(){var r,i;return(r=(i=this._p2pConnection)===null||i===void 0?void 0:i.isPreSub())!==null&&r!==void 0&&r}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(r){return this._p2pConnection.updateRtpSenderEncodings(r)}async connect(r){return this.cname=r.cname,await this._p2pConnection.connect(r),await new Ie((i,s)=>{const c=setTimeout(()=>{this.closeSignal(),s(new se($.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r.candidates))))},W("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(c),void i()},this.dataChannel.onerror=d=>{this.closeSignal(),s(d)},this.dataChannel.addEventListener("close",()=>{s(new se($.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(r,i){return this._p2pConnection.updateRemoteRTPCapabilities(r,i)}send(r,i,s){var c=this;return Ai(function*(){const d=yield vt(c.mutex.lock("From DataChannelConnection.send"));try{return yield*wp(S$(c._p2pConnection.send(r,i,s)))}finally{d()}})()}async stopSending(r,i){return this._p2pConnection.stopSending(r,i)}async createDataChannels(r,i){return this._p2pConnection.createDataChannels(r,i)}async stopDataChannels(r){return this._p2pConnection.stopDataChannels(r)}async receive(r,i,s,c){return this._nvMedia?(R.debug("[DataChannelConnection] receive ".concat(r," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(r,i,this.cname)):(R.debug("[DataChannelConnection] receive ".concat(r," by WebRTC.")),await this._p2pConnection.receive(r,i,s,c))}async batchReceive(r){return[...await this._p2pConnection.batchReceive(r)]}async stopReceiving(r){return await this._p2pConnection.stopReceiving(r)}async muteRemote(r){return await this._p2pConnection.muteRemote(r)}async unmuteRemote(r){return await this._p2pConnection.unmuteRemote(r)}async muteLocal(r){return await this._p2pConnection.muteLocal(r)}async unmuteLocal(r){return await this._p2pConnection.unmuteLocal(r)}restartICE(r){var i=this;return Ai(function*(){return yield*wp(S$(i._p2pConnection.restartICE(r)))})()}close(){var r;(r=this._nvMedia)===null||r===void 0||r.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(r){return this._p2pConnection.getRemoteVideoIsReady(r)}updateRemoteConnect(r){var i;return(i=this._nvMedia)===null||i===void 0||i.setRemoteRtpCapabilities(r),this._p2pConnection.updateRemoteConnect(r)}async updateEncoderConfig(r,i){return await this._p2pConnection.updateEncoderConfig(r,i)}async updateSendParameters(r,i){return await this._p2pConnection.updateSendParameters(r,i)}setStatsRemoteVideoIsReady(r,i){this._p2pConnection.setStatsRemoteVideoIsReady(r,i)}async replaceTrack(r,i){return await this._p2pConnection.replaceTrack(r,i)}async getRemoteSSRC(r){return this._p2pConnection.getRemoteSSRC(r)}logSDPExchange(r,i,s,c){if(W("SDP_LOGGING"))return R.upload("exchanging ".concat(s," ").concat(i," SDP during DataChannelConnection.").concat(c,`
`),r),i==="offer"?d=>{this.logSDPExchange(d,"answer",s==="local"?"remote":"local",c)}:void 0}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(fu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...IS.turnServerConfigToIceServers(r.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...IS.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Ls(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!W("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=r=>{var i;return(i=this.onICEConnectionStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onConnectionStateChange=r=>{var i;return(i=this.onConnectionStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportStateChange=r=>{var i;return(i=this.onDTLSTransportStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportError=r=>{var i;return(i=this.onDTLSTransportError)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onICETransportStateChange=r=>{var i;return(i=this.onICETransportStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioReceived=r=>{var i;return(i=this.onFirstAudioReceived)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoReceived=r=>{var i;return(i=this.onFirstVideoReceived)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioDecoded=r=>{var i;return(i=this.onFirstAudioDecoded)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoRender=r=>{var i;return(i=this.onFirstVideoRender)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoBufferReady=r=>{var i;return(i=this.onFirstVideoBufferReady)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoDecoded=(r,i,s)=>{var c;return(c=this.onFirstVideoDecoded)===null||c===void 0?void 0:c.call(this,r,i,s)},this._p2pConnection.onFirstVideoDecodedTimeout=r=>{var i;return(i=this.onFirstVideoDecodedTimeout)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onSelectedLocalCandidateChanged=(r,i)=>{var s;return(s=this.onSelectedLocalCandidateChanged)===null||s===void 0?void 0:s.call(this,r,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(r,i)=>{var s;return(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0?void 0:s.call(this,r,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0}setConfiguration(r){this._p2pConnection.setConfiguration(r)}},De(Jt.prototype,"connect",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"connect"),Jt.prototype),De(Jt.prototype,"updateRemoteRTPCapabilities",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"updateRemoteRTPCapabilities"),Jt.prototype),De(Jt.prototype,"createDataChannels",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"createDataChannels"),Jt.prototype),De(Jt.prototype,"receive",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"receive"),Jt.prototype),De(Jt.prototype,"stopReceiving",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"stopReceiving"),Jt.prototype),De(Jt.prototype,"muteRemote",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"muteRemote"),Jt.prototype),De(Jt.prototype,"unmuteRemote",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"unmuteRemote"),Jt.prototype),De(Jt.prototype,"muteLocal",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"muteLocal"),Jt.prototype),De(Jt.prototype,"unmuteLocal",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"unmuteLocal"),Jt.prototype),De(Jt.prototype,"close",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"close"),Jt.prototype),De(Jt.prototype,"updateEncoderConfig",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"updateEncoderConfig"),Jt.prototype),De(Jt.prototype,"updateSendParameters",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"updateSendParameters"),Jt.prototype),De(Jt.prototype,"replaceTrack",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"replaceTrack"),Jt.prototype),De(Jt.prototype,"getRemoteSSRC",[ka],Object.getOwnPropertyDescriptor(Jt.prototype,"getRemoteSSRC"),Jt.prototype),Jt);function ka(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,d=await c.lock("From DataChannelConnection.".concat(r));try{for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},i}function w$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class G_e extends Sn{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;xe(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(rr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(rr.CONNECTED):this._state==="closed"?this.emit(rr.CLOSED):this._state==="failed"&&this.emit(rr.FAILED))}constructor(r,i,s,c){super(),j(this,"connectionID",0),j(this,"currentURLIndex",0),j(this,"reconnectReason",void 0),j(this,"_reconnectMode","tryNext"),j(this,"_initMutex",void 0),j(this,"_name",void 0),j(this,"_state","closed"),j(this,"_reconnectInterrupter",void 0),j(this,"_url",void 0),j(this,"_retryConfig",void 0),j(this,"_reconnectCount",0),j(this,"_forceCloseTimeout",5e3),j(this,"_onlineReconnectListener",void 0),j(this,"_closeEstablishingTransmitter",()=>{}),j(this,"_store",void 0),j(this,"_joinChannelServiceRecordIndex",void 0),j(this,"_transmitter",void 0),j(this,"_useCompress",void 0),j(this,"_inflateLength",0),j(this,"_deflateLength",0),this._store=c,this._name=r,this._retryConfig=function(d){for(var u=1;u<arguments.length;u++){var f=arguments[u]!=null?arguments[u]:{};u%2?w$(Object(f),!0).forEach(function(g){j(d,g,f[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(f)):w$(Object(f)).forEach(function(g){Object.defineProperty(d,g,Object.getOwnPropertyDescriptor(f,g))})}return d}({},i),this._useCompress=s}resetReconnectCount(r){R.debug("".concat(this._name," reset reconnect count, reason: ").concat(r)),this._reconnectCount=0}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const s=this._transmitter;i?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=r?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(r,i){if(!this._transmitter)return void R.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((s=this._store)===null||s===void 0||s.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));const c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){const r=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:r,deflateLength:i}}setInflateData(r){this._deflateLength=this._deflateLength+r.originLength,this._inflateLength=this._inflateLength+r.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Ao=function(t){return t[t.Default=0]="Default",t[t.Ack=1]="Ack",t}({});class $_e{constructor(r,i,s){j(this,"version",1),j(this,"initialRTO",void 0),j(this,"maxBatchAckCount",void 0),j(this,"maxRTO",void 0),j(this,"initialRTT",void 0),j(this,"ID",void 0),j(this,"rtt",void 0),j(this,"packetNumber",1),j(this,"rtoRatioMap",new Map),j(this,"timeoutMap",new Map),j(this,"unorderedPacketQueue",[]),j(this,"batchAckPacketQueue",[]),j(this,"lastOrderedPacketNumber",0),j(this,"batchAckTimer",void 0),j(this,"sendImpl",void 0),j(this,"receiveImpl",void 0),this.sendImpl=r,this.receiveImpl=i,this.ID=Kt(7,"transmitter-"),this.initialRTO=(s==null?void 0:s.initialRTO)!==void 0?s.initialRTO:W("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(s==null?void 0:s.initialRTT)!==void 0?s.initialRTT:W("TRANSMITTER_INITIAL_RTT"),this.rtt=(s==null?void 0:s.initialRTT)!==void 0?s.initialRTT:W("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(s==null?void 0:s.maxBatchAckCount)!==void 0?s.maxBatchAckCount:W("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(s==null?void 0:s.maxRTO)!==void 0?s.maxRTO:W("TRANSMITTER_MAX_RTO")}packetize(r,i){return{type:Ao.Default,version:this.version,packetNumber:i,payload:r}}serialize(r){switch(r.type){case Ao.Default:{let i;typeof r.payload=="string"?i=new TextEncoder().encode(r.payload):i=r.payload;const s=new ArrayBuffer(i.length+15),c=new DataView(s);return c.setUint16(0,r.version),c.setUint8(2,r.type),c.setUint32(3,r.packetNumber),S5(c,7,BigInt(r.sendTs)),new Uint8Array(c.buffer).set(i,15),s}case Ao.Ack:{const i=new ArrayBuffer(16),s=new DataView(i);return s.setUint16(0,r.version),s.setUint8(2,r.type),s.setUint32(3,r.maxAckPacketNumber),s.setUint8(7,r.shift),S5(s,8,BigInt(r.ackSendTs)),i}}}deserialize(r){const i=new DataView(r),s=i.getUint16(0),c=i.getUint8(2);switch(c){case Ao.Default:{const d=i.getUint32(3),u=b5(i,7),f=r.slice(15),g=new Uint8Array(f);return{version:s,type:c,packetNumber:d,sendTs:Number(u),payload:g}}case Ao.Ack:{const d=i.getUint32(3),u=i.getUint8(7),f=b5(i,8);return{version:s,type:c,maxAckPacketNumber:d,shift:u,ackSendTs:Number(f)}}default:throw R.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(r){W("DC_DEBUG_LOG")&&typeof r=="string"&&R.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(r));const i=this.packetize(r,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const s=this.calculateRTO(i),c=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,c),this.sendPacket(i)}onData(r){const i=this.deserialize(r);i.type===Ao.Default?this.ack(i):i.type===Ao.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(r=>{let[i,s]=r;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(r){const i=this.calculateRTO(r),s=window.setTimeout(()=>{W("DC_DEBUG_LOG")&&typeof r.payload=="string"&&R.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(r.payload),"timeout: ".concat(i)),this.resendMessage(r)},i);this.timeoutMap.set(r.packetNumber,s),this.sendPacket(r)}calculateRTO(r){const i=this.rtoRatioMap.get(r.packetNumber);if(i===void 0)return this.rtoRatioMap.set(r.packetNumber,1),this.initialRTO;{const s=9*this.rtt/8*i;return this.rtoRatioMap.set(r.packetNumber,i+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(r,i){const s=r.ackSendTs;this.rtt=this.rtt*(7/8)+(i-s-this.rtt)/8}ack(r){if(r.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(r):(this.batchAckPacketQueue.push(r),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(r.payload);;){const i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(r.packetNumber<=this.lastOrderedPacketNumber){const i={ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Ao.Ack,version:this.version};W("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),i,"packetNumber: ".concat(r.packetNumber)),this.sendPacket(i)}else if(r.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[r.packetNumber-this.lastOrderedPacketNumber-2]=r;const i={ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Ao.Ack,version:this.version};W("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),i,"packetNumber: ".concat(r.packetNumber)),this.sendPacket(i)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const r={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Ao.Ack,version:this.version};W("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending batch ack packet"),r,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(r),this.batchAckPacketQueue=[]}sendPacket(r){r.type===Ao.Default&&(r.sendTs=Math.round(performance.now()));const i=this.serialize(r);this.sendImpl(i)}clearRTO(r){for(let i=r.maxAckPacketNumber-r.shift;i<=r.maxAckPacketNumber;i++){const s=this.timeoutMap.get(i);s!==void 0&&window.clearTimeout(s),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class x$ extends G_e{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),j(this,"_initMutex",void 0),j(this,"_reconnectInterrupter",void 0),j(this,"_url",void 0),j(this,"_transmitter",void 0),j(this,"_addresses",void 0),j(this,"_reliableTransmission",void 0),j(this,"_textEncoder",void 0),j(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new br("datachannel");const{timeout:s,timeoutFactor:c}=i,d=Math.max(300,Math.floor(3*s/5)),u=Math.max(1.2,Math.floor(8*c)/10);vi.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=u),Nn.on(mu.NETWORK_STATE_CHANGE,(f,g)=>{f!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(f)),f===vi.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=u):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=i;const s=(c,d)=>{this._addresses=r,this.currentURLIndex=this._addresses.findIndex(f=>f.fingerprint||W("FINGERPRINT"));const u=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(u).then(c).catch(d),this.once(rr.CLOSED,()=>d(new se($.WS_DISCONNECT))),this.once(rr.CONNECTED,()=>c())};return this._initMutex.lock().then(c=>new Ie((d,u)=>{s(d,u)}).then(()=>{c()}).catch(()=>{c()}))}async sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new se($.WS_ABORT,"datachannel is not ready");try{i||(r=JSON.stringify(r));const s=this._textEncoder.encode(r),c=n_e(s,{raw:!0});this._reliableTransmission.sendMessage(c)}catch(s){throw new se($.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(r){const i=JSON.stringify(r);return{compressed:i,compressedLength:i.length,origin:r}}sendMessageWithUint8Array(r){return{compressed:r,compressedLength:r.byteLength,origin:r}}createTransmitterConnection(r){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(r.ip,":").concat(r.port),new Ie((i,s)=>{var c;const d=()=>{R.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),i()},u=async _=>{var S;if((S=this._closeEstablishingTransmitter)===null||S===void 0||S.call(this),R.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const w=da(this,rr.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,C=await this.reconnectWithAction(w);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!C)return s(new se($.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);i()}else s(new se($.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},f=async _=>{try{var S;(S=this._reliableTransmission)===null||S===void 0||S.onData(_.data)}catch(w){console.log(w)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),R.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(r)));const g=(c=this._store)===null||c===void 0?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),v=Date.now();qn(this,rr.TO_CONNECT_DATACHANNEL).then(_=>{var S,w;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:C,close:M}=_;this._transmitter=C,(S=this._store)===null||S===void 0||S.signalChannelOpen();const I=Date.now()-v;R.debug("[choose dc] dc open cost ".concat(I,"ms")),this._reliableTransmission=new $_e(k=>{var G;this._transmitter&&this._transmitter.readyState==="open"&&((G=this._transmitter)===null||G===void 0||G.send(k))},k=>{if(typeof k=="string")this.emit(rr.ON_MESSAGE,k);else{const G=i_e(k,{raw:!0}).buffer,K=this._textDecoder.decode(G);this.emit(rr.ON_MESSAGE,K)}}),this._closeEstablishingTransmitter=()=>{var k;(k=this._reliableTransmission)===null||k===void 0||k.close(),this._reliableTransmission=void 0,M()},d&&d(),C.onclose=u,C.onmessage=f,(w=this._store)===null||w===void 0||w.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(_=>{var S;if((S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:_ instanceof se&&_.code===$.WS_ABORT?"aborted":"error",errors:[_]},g),this.state!=="closed"){if(_ instanceof se&&_.code===$.WS_ERR){const w=new se($.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return R.error("[".concat(this._name,"]").concat(w)),void s(w)}u&&u(_)}else s(new se($.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Nn.networkState!==vi.OFFLINE||(this._onlineReconnectListener=Nn.onlineWaiter&&Nn.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let s=!0;if(this._reconnectInterrupter=()=>{s=!1},i){const f=lE(this._reconnectCount,this._retryConfig);R.debug("[".concat(this._name,"] wait ").concat(f,"ms to reconnect datachannel, mode: ").concat(r)),await Ie.race([dr(f),this._onlineReconnectListener||new Ie(()=>{})])}if(this.state==="closed"||!s)return!1;this._reconnectCount+=1;const c=async(f,g)=>{this.emit(rr.RECONNECT_CREATE_CONNECTION,g),await this.createTransmitterConnection(f)};try{if(r==="retry"){const f=this._addresses[this.currentURLIndex];await c(f,r)}else if(r==="tryNext"){this.currentURLIndex+=1;for(let g=this.currentURLIndex;g<this._addresses.length;g++){if(this._addresses[g].fingerprint||W("FINGERPRINT")){this.currentURLIndex=g;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return R.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);R.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const f=this._addresses[this.currentURLIndex];await c(f,r)}else r==="recover"&&(R.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(rr.FAILBACK));return!0}catch(f){var d,u;return R.error("[".concat(this._name,"] reconnect failed"),f.toString()),f!=null&&(d=f.data)!==null&&d!==void 0&&d.desc&&Array.isArray(f.data.desc)&&f.data.desc.length&&xe(u=f.data.desc).call(u,"dynamic key expired")?(this.emit(rr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(r,i)}}}class H_e extends Sn{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Rt.CONNECTED?this.emit($e.WS_CONNECTED):r===Rt.RECONNECTING?this.emit($e.WS_RECONNECTING,this._websocketReconnectReason):r===Rt.CLOSED&&this.emit($e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(R.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(r=>{let{type:i,message:s}=r;this.emit(i,s),i===ot.ON_NOTIFICATION&&this.handleNotification(s),i===ot.ON_USER_BANNED&&this.handleUserBanned(s)}),this.pendingNotifications=[])}handleUserBanned(r){switch(r.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}}constructor(r,i){super(),j(this,"__name__","DataChannelSignal"),j(this,"_disconnectedReason",void 0),j(this,"_websocketReconnectReason",void 0),j(this,"_connectionState",Rt.CLOSED),j(this,"reconnectToken",void 0),j(this,"websocket",void 0),j(this,"openConnectionTime",void 0),j(this,"clientId",void 0),j(this,"lastMsgTime",Date.now()),j(this,"uploadCache",[]),j(this,"uploadCacheInterval",void 0),j(this,"rttRolling",new WA(5)),j(this,"pingpongTimer",void 0),j(this,"inflateDataTimer",void 0),j(this,"pingpongTimeoutCount",0),j(this,"ortc",void 0),j(this,"joinResponse",void 0),j(this,"multiIpOption",void 0),j(this,"initError",void 0),j(this,"spec",void 0),j(this,"store",void 0),j(this,"isJoining",!1),j(this,"pendingNotifications",[]),j(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit($e.ON_BINARY_DATA,s);const c=JSON.parse(s);if(W("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] received packet",c),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else Object.prototype.hasOwnProperty.call(c,"_type")&&(this.isJoining?c._type===ot.ON_NOTIFICATION||c._type===ot.ON_USER_BANNED?(this.emit(c._type,c._message),c._type===ot.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ot.ON_USER_BANNED&&this.handleUserBanned(c._message)):(this.pendingNotifications.push({type:c._type,message:c._message}),R.debug("[".concat(this.clientId,"] cached notification during join: ").concat(c._type))):(this.emit(c._type,c._message),c._type===ot.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ot.ON_USER_BANNED&&this.handleUserBanned(c._message)))}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new x$("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Rt.CONNECTED&&this.reconnect("retry",ql.OFFLINE)})}async request(r,i,s,c){const d=Kt(6,""),u={_id:d,_type:r,_message:i},f=this.websocket.connectionID,g=()=>new Ie((M,I)=>{if(this.connectionState===Rt.CONNECTED)return M();const k=()=>{this.off($e.WS_CLOSED,G),M()},G=()=>{this.off($e.WS_CONNECTED,k),I(new se($.WS_ABORT))};this.once($e.WS_CONNECTED,k),this.once($e.WS_CLOSED,G),r!==ze.PUBLISH&&r!==ze.SUBSCRIBE&&r!==ze.UNSUBSCRIBE&&r!==ze.UNPUBLISH&&r!==ze.CONTROL&&r!==ze.RESTART_ICE||this.once($e.DISCONNECT_P2P,()=>{I(new se($.DISCONNECT_P2P))}),r!==ze.PUBLISH&&r!==ze.RESTART_ICE||this.once($e.ABORT_P2P_EXECUTION,()=>{I(new se($.DISCONNECT_P2P))})});if(this.connectionState!==Rt.CONNECTING&&this.connectionState!==Rt.RECONNECTING||r===ze.JOIN||r===ze.REJOIN||await g(),r===ze.LEAVE&&(this.websocket.unbindDcCloseEventListener(),c=!0),W("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] sendMessage",u),await this.websocket.sendMessage(u,!0,!1),c)return;const v=new Ie((M,I)=>{let k=!1;const G=(X,te)=>{k=!0,M({isSuccess:X==="success",message:te||{}}),this.off($e.WS_CLOSED,K),this.off($e.WS_RECONNECTING,K),this.emit($e.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(d),G);const K=()=>{I(new se($.WS_ABORT,"type: ".concat(r))),this.off($e.WS_CLOSED,K),this.off($e.WS_RECONNECTING,K),this.off("res-@".concat(d),G)};this.once($e.WS_CLOSED,K),this.once($e.WS_RECONNECTING,K),dr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||k||(R.warning("dc request timeout, type: ".concat(r)),this.emit($e.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(M){if(this.connectionState===Rt.CLOSED||r===ze.LEAVE)throw new se($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?M.throw():r===ze.JOIN||r===ze.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const S=Number(_.message.error_code||_.message.code),w=Iu(S),C=new se($.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(_.message.error_str),{code:S,data:_.message});return w.action==="success"?_.message:(R.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(S,", message: ").concat(w.desc,", action: ").concat(w.action)),S===qe.ERR_TOO_MANY_BROADCASTERS?((r===ze.JOIN||r===ze.REJOIN)&&(this.initError=C,this.close()),C.throw()):w.action==="failed"?C.throw():w.action==="quit"?(this.initError=C,this.close(),C.throw()):(S===qe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ql.MULTI_IP)):this.reconnect(w.action,ql.SERVER_ERROR),r===ze.JOIN||r===ze.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new Ie(s=>{const c=d=>{(!i||i(d))&&(this.off(r,c),s(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Ou.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const d=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Rt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(r,i){const s={_type:r,_message:i};await this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ie((i,s)=>{this.once($e.WS_CONNECTED,()=>i(this.joinResponse)),this.once($e.WS_CLOSED,()=>s(this.initError||new se($.WS_ABORT))),this.connectionState=Rt.CONNECTING,this.websocket.init(r).catch(s),this.websocket.once(rr.FAILBACK,()=>{s(new se($.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(R.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new se($.INIT_DATACHANNEL_TIMEOUT)))},W("DC_JOIN_WITH_FAILBACK"))})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=r||Ct.LEAVE,this.connectionState=Rt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),r===Ct.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new x$("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),W("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit($e.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await qn(this,$e.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const i=await this.request(ze.JOIN,r);if(this.store.joinRep(),this.ortc=r==null?void 0:r.ortc,!i)return this.emit($e.REPORT_JOIN_GATEWAY,$.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit($e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Rt.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new se($.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=gu(this,$e.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(ze.REJOIN,r);return!!i&&(this.connectionState=Rt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),W("DC_PINGPONG_INTERVAL")),i.peers&&i.peers.forEach(s=>{this.emit(ot.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(ot.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(ot.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(ot.MUTE_AUDIO,{uid:s.uid}):this.emit(ot.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(ot.MUTE_VIDEO,{uid:s.uid}):this.emit(ot.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(ot.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(ot.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(ot.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(ot.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(ot.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(ze.DOWNGRADE_CODEC,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Iu(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(i.action,ql.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,W("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const r=W("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",ql.FALLBACK):this.request(ze.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),W("REPORT_STATS")&&this.send(ze.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){const{inflateLength:r,deflateLength:i}=this.websocket.getInflateData();r!==0&&i!==0&&this.upload(Ou.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(rr.RECONNECT_CREATE_CONNECTION,r=>{this.emit($e.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(rr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(rr.CLOSED,()=>{this.connectionState=Rt.CLOSED}),this.websocket.on(rr.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=Rt.CLOSED}),this.websocket.on(rr.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Rt.CONNECTED?this.connectionState=Rt.RECONNECTING:this.connectionState=Rt.CONNECTING}),this.websocket.on(rr.WILL_RECONNECT,(r,i)=>{if(gu(this,$e.IS_P2P_DISCONNECTED)&&r==="retry")return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit($e.NEED_RENEW_SESSION),this.emit($e.DISCONNECT_P2P),i("tryNext");r!=="retry"&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit($e.NEED_RENEW_SESSION),this.emit($e.DISCONNECT_P2P)),i(r)}),this.websocket.on(rr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",ql.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit($e.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof se&&r.code===$.UNEXPECTED_RESPONSE&&r.data.code===qe.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ql.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ql.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(rr.REQUEST_NEW_URLS,(r,i)=>{qn(this,$e.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(rr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(rr.TO_CONNECT_DATACHANNEL,(r,i)=>{qn(this,$e.PRE_CONNECT_PC).then(r).catch(i)}),this.websocket.on(rr.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit($e.DATACHANNEL_FAILBACK)})}}const z_e={name:"DataChannelConnection",create:function(t){let{store:r,spec:i}=t;return new W_e(i,r)}},K_e={name:"DataChannelSignal",create:function(t){let{store:r,spec:i}=t;return new H_e(i,r)}};YA(),Zt("PROCESS_ID","process-".concat(Kt(8,""),"-").concat(Kt(4,""),"-").concat(Kt(4,""),"-").concat(Kt(4,""),"-").concat(Kt(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),i=Date.now();R.debug("Loading global parameters from cache",r),Object.keys(r).forEach(s=>{if(Object.prototype.hasOwnProperty.call(Yt,s)){const{value:c,expires:d}=r[s];if(d&&d<=i)return;Ta[s]=c,Yt[s]=c}})}catch(r){R.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Ta.AREAS)&&Ta.AREAS.length>0&&qN(Ta.AREAS,!0);const T$=(t,r,i)=>{R.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),Zt(t,r,i)};uc(l_e,!1),uc(h_e,!1),uc(Wve,!1),uc(w_e,!1),uc(s_e,!1),uc(L_e,!1),uc(U_e,!1),uc(F_e,!1),uc(z_e,!1),uc(K_e,!1);const Xn=function(t){const r=new Sn,i=t,s={getListeners:r.getListeners.bind(r),on:(c,d)=>(function(u,f){u===cc.SECURITY_POLICY_VIOLATION&&ZW(f,!0)}(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return QW(QW({},i),s)}({__TRACK_LIST__:Su,VERSION:Ja,BUILD:JA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:T$,getParameter:W,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(s){let c;return wt().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),c=(await s.createOffer()).sdp):c=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return t;r.close(),r=null,t=function(s){const c={video:[],audio:[]};return s.match(/ VP8/i)&&c.video.push("VP8"),s.match(/ VP9/i)&&c.video.push("VP9"),s.match(/ AV1/i)&&c.video.push("AV1"),s.match(/ H264/i)&&c.video.push("H264"),s.match(/ H265/i)&&c.video.push("H265"),s.match(/ opus/i)&&c.audio.push("OPUS"),s.match(/ PCMU/i)&&c.audio.push("PCMU"),s.match(/ PCMA/i)&&c.audio.push("PCMA"),s.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new se($.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const r=We.reportApiInvoke(null,{name:yn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:rn.TRACER}),i=function(){let d=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],u=!1;try{const f=window.RTCPeerConnection,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,v=window.WebSocket;u=!(!f||!v),d&&!g&&(u=!1),u&&Dg()&&d5(75)&&new f().close()}catch(f){R.error("check system requirement failed: ",f),u=!1}return u}(t),s=$ve();R.debug("checkSystemRequirements, api:",i,"browser",s);const c=i&&s;return r.onSuccess(c),W("IGNORE_RTC_DEVICE_CHECK")?i:c},getDevices:function(t){return Oa.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Oa.getRecordingDevices(t)},getCameras:function(t){return Oa.getCamerasDevices(t)},getElectronScreenSources:m3,getPlaybackDevices:function(t){return Oa.getSpeakers(t)},createClient:qW,createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=W("CAMERA_CAPTURE_CONFIG"),i=Kt(8,"track-cam-"),s=We.reportApiInvoke(null,{id:i,tag:rn.TRACER,name:yn.CREATE_CAM_VIDEO_TRACK,options:[hn({},t),r]});r&&(t.encoderConfig=r);const c=SE(t);let d=null;R.info("start create camera video track with config",JSON.stringify(t),"trackId",i);try{d=(await Na({video:c},i)).getVideoTracks()[0]||null}catch(f){throw s.onError(f),f}if(!d){const f=new pe($.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(f),f.throw(R)}if(t.optimizationMode&&gN(i,d,t,Ps(t.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const f=Ps(t.encoderConfig);t.encoderConfig=f,delete f.bitrateMax,delete f.bitrateMin}const u=new xE(d,t,c,t.scalabiltyMode?yE(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess(u.getTrackId()),R.info("create camera video success, trackId:",i),u},createCustomVideoTrack:function(t){const r=Kt(8,"track-cus-"),i=We.reportApiInvoke(null,{id:r,tag:rn.TRACER,name:yn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});W("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const s=new an(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?yE(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[Ht.CUSTOM_TRACK]);return i.onSuccess(s.getTrackId()),R.info("create custom video track success with config",t,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(w){const C=T3(w);return i3()&&w.suppressLocalAudioPlayback&&(C.suppressLocalAudioPlayback=w.suppressLocalAudioPlayback),a3()&&w.restrictOwnAudio&&(C.restrictOwnAudio=!0),C}(r):void 0;i&&(r="auto");const s=Kt(8,"track-scr-v-"),c=We.reportApiInvoke(null,{id:s,tag:rn.TRACER,name:yn.CREATE_SCREEN_VIDEO_TRACK,options:[hn({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=function(w){const C={};w.screenSourceType&&(C.mediaSource=w.screenSourceType),w.extensionId&&$c()&&(C.extensionId=w.extensionId);const{displaySurface:M,selfBrowserSurface:I,surfaceSwitching:k,systemAudio:G,preferCurrentTab:K,windowAudio:X,monitorTypeSurfaces:te}=w;(mo(107)||$l(107)||pu(93))&&(M&&(Fn(M,"displaySurface",["browser","window","monitor"]),C.displaySurface=M),I?(Fn(I,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=I):C.selfBrowserSurface="include",k&&(Fn(k,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=k)),(mo(105)||$l(105)||pu(91))&&G&&(Fn(G,"systemAudio",["exclude","include"]),C.systemAudio=G),(mo(94)||$l(94)||pu(80))&&K&&(C.preferCurrentTab=!0),(mo(141)||$l(141)||pu(125))&&X&&(Fn(X,"windowAudio",["exclude","system"]),C.windowAudio=X),(mo(119)||$l(119)||pu(105))&&te&&(Fn(te,"monitorTypeSurfaces",["exclude","include"]),C.monitorTypeSurfaces=te),w.electronScreenSourceId&&(C.sourceId=w.electronScreenSourceId);const ne=w.encoderConfig?rN(w.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:ne?ne.width:void 0,maxHeight:ne?ne.height:void 0},ne&&(ne.frameRate&&(typeof ne.frameRate=="number"?(C.mandatory.maxFrameRate=ne.frameRate,C.mandatory.minFrameRate=ne.frameRate):(C.mandatory.maxFrameRate=ne.frameRate.max||ne.frameRate.ideal||ne.frameRate.exact||void 0,C.mandatory.minFrameRate=ne.frameRate.min||ne.frameRate.ideal||ne.frameRate.exact||void 0),C.frameRate=ne.frameRate),ne.width&&(C.width=ne.width),ne.height&&(C.height=ne.height)),C}(t);let u=null,f=null;const g=wt();if(!g.supportShareAudio&&r==="enable"){const w=new pe($.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(w),w.throw(R)}R.info("start create screen video track with config",t,"withAudio",r,"trackId",s);const v=g.supportShareAudio&&r!=="disable";try{const w=await Na({screen:d,screenAudio:v?i||!0:void 0},s);u=w.getVideoTracks()[0]||null,f=w.getAudioTracks()[0]||null}catch(w){throw c.onError(w),w}if(!u){const w=new pe($.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(w),w.throw(R)}if(!f&&r==="enable"){u&&u.stop();const w=new pe($.SHARE_AUDIO_NOT_ALLOWED);return c.onError(w),w.throw(R)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(gN(s,u,t,t.encoderConfig&&rN(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const _=new an(u,t.encoderConfig?rN(t.encoderConfig):{},t.scalabiltyMode?yE(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s,[Ht.SCREEN_TRACK]);if(!f)return c.onSuccess(_.getTrackId()),R.info("create screen video track success","video:",_.getTrackId()),_;const S=new kn(f,void 0,Kt(8,"track-scr-a-"),!1);return c.onSuccess([_.getTrackId(),S.getTrackId()]),R.info("create screen video track success","video:",_.getTrackId(),"audio:",S.getTrackId()),[_,S]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=W("CAMERA_CAPTURE_CONFIG"),s=Kt(8,"track-mic-"),c=Kt(8,"track-cam-"),d=We.reportApiInvoke(null,{id:"".concat(s,"-").concat(c),tag:rn.TRACER,name:yn.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,i]});i&&(r.encoderConfig=i);const u=SE(r),f=C3(t);let g=null,v=null;R.info("start create camera video track(".concat(c,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const w=await Na({audio:f,video:u},"".concat(s,"-").concat(c));g=w.getAudioTracks()[0],v=w.getVideoTracks()[0]}catch(w){throw d.onError(w),w}if(!g||!v){const w=new pe($.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(w),w.throw(R)}if(r.optimizationMode&&gN(c,v,r,Ps(r.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const w=Ps(r.encoderConfig);r.encoderConfig=w,delete w.bitrateMax,delete w.bitrateMin}const _=new Gg(g,t,f,s),S=new xE(v,r,u,r.scalabiltyMode?yE(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([_.getTrackId(),S.getTrackId()]),R.info("create camera video track(".concat(c,") and microphone audio track(").concat(s,") success")),[_,S]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Kt(8,"track-mic-"),i=We.reportApiInvoke(null,{id:r,tag:rn.TRACER,name:yn.CREATE_MIC_AUDIO_TRACK,options:[t]}),s=C3(t);let c=null;R.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Na({audio:s},r)).getAudioTracks()[0]||null}catch(u){throw i.onError(u),u}if(!c){const u=new pe($.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(u),u.throw(R)}const d=new Gg(c,t,s,r);return i.onSuccess(d.getTrackId()),R.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:QB,createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:i,encoderConfig:s}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:s},u=Kt(8,"track-buf-"),f=We.reportApiInvoke(null,{id:u,tag:rn.TRACER,name:yn.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(W("DISABLE_WEBAUDIO"))throw new pe($.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",u);const g=c;if(!(c instanceof AudioBuffer))try{c=await async function(S,w){let C=null;if(typeof S=="string"){const I=pB.get(S);if(I)return R.debug("use cached audio resource: ",S),I;try{C=(await go(()=>Ni.get(S,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(k){throw new pe($.FETCH_AUDIO_FILE_FAILED,k.toString())}}else C=await new Ie((k,G)=>{const K=new FileReader;K.onload=X=>{X.target?k(X.target.result):G(new pe($.READ_LOCAL_AUDIO_FILE_ERROR))},K.onerror=()=>{G(new pe($.READ_LOCAL_AUDIO_FILE_ERROR))},K.readAsArrayBuffer(S)});const M=await function(I){const k=Mp();return new Ie((G,K)=>{k.decodeAudioData(I,X=>{G(X)},X=>{K(new pe($.DECODE_AUDIO_FILE_FAILED,X.toString()))})})}(C);return typeof S=="string"&&w&&pB.set(S,M),M}(c,i)}catch(S){return f.onError(S),S.throw(R)}const v=new lge(c),_=new cge(g,v,s?_E(s):{},u);return R.info("create buffer source audio track success, trackId:",u),f.onSuccess(_.getTrackId()),_},setAppType:function(t){if(R.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw R.debug("Invalid appType"),new se($.INVALID_PARAMS,"invalid app type",t);Zt("APP_TYPE",Math.floor(t))},setLogLevel:function(t){R.setLogLevel(t)},enableLogUpload:function(){W("USE_NEW_LOG")?Zt("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){W("USE_NEW_LOG")?Zt("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new g8},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=We.reportApiInvoke(null,{tag:rn.TRACER,name:yn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof kn||t instanceof Fp)){const g=new se($.INVALID_TRACK,"the parameter is not a audio track");return i.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const s=t instanceof kn?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,u=c;const f=Date.now();return new Ie(g=>{const v=setInterval(()=>{const _=t.getVolumeLevel();d=_>d?_:d,u=_<u?_:u;const S=d-u>1e-4,w=Date.now()-f;if(S||w>r){clearInterval(v);const C=S,M={duration:w,deviceLabel:s,maxVolumeLevel:d,result:C};R.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(M))),i.onSuccess(M),g(C)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=We.reportApiInvoke(null,{tag:rn.TRACER,name:yn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof an||t instanceof Vp)){const S=new se($.INVALID_TRACK,"the parameter is not a video track");return i.onError(S),S.throw()}r&&r<1e3&&(r=1e3);const s=t instanceof an?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Er()||sE())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const u=document.createElement("canvas");u.width=160,u.height=120;let f=0,g=0;try{const S=Date.now();f=await function(w,C,M,I){let k,G=0,K=null;return new Ie((X,te)=>{function ne(){G>I&&k&&(k(),X(G));const Z=M.getContext("2d");if(!Z){const Ee=new se($.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(Ee.toString()),void te(Ee)}Z.drawImage(w,0,0,160,120);const ie=Z.getImageData(0,0,M.width,M.height),ge=Math.floor(ie.data.length/3);if(K){for(let Ee=0;Ee<ge;Ee+=3)if(ie.data[Ee]!==K[Ee])return G+=1,void(K=ie.data);K=ie.data}else K=ie.data}setTimeout(()=>{k&&(k(),X(G))},C),k=lN(()=>{ne()},30)})}(d,r,u,4),g=Date.now()-S}catch(S){throw i.onError(S),S}Ave===Ft.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const v=f>4,_={duration:g,changedPicNum:f,deviceLabel:s,result:v};return R.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),i.onSuccess(_),v},setArea:qN,audioElementPlayCenter:ii,resumeAudioContext:function(){return ii.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){zve.processExternalMediaAEC(t)},registerExtensions:function(t){const r=W("PLUGIN_INFO")||[];t.forEach(i=>{"name"in i&&!xe(r).call(r,i.name)&&r.push(i.name);const s=i;s.__registered__=!0,s.logger.hookLog=R.extLog,s.reporter.hookApiInvoke=We.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(c=>{s.parameters[c]=W(c)})}),T$("PLUGIN_INFO",r)},ChannelMediaRelayError:Gp,ChannelMediaRelayEvent:Yc,ChannelMediaRelayState:Hi,RemoteStreamFallbackType:nge,RemoteStreamType:tge,ConnectionDisconnectedReason:Ct,AudienceLatencyLevelType:Ome,AREAS:Gt,preload:async function(t,r,i,s){return vO(t,r,i,s)},startLastmileProbeTest:async function(t,r,i,s){let c={state:"unavailable"};await vO(t,r,i,s);const d=await yO({appId:t,cname:r,token:i||t,uid:s,cloudProxyServer:"disabled"});if(!d)return c;await _O(d);let u,f=qW({mode:"rtc",codec:"vp8"});try{u=await f.join(t,r,i,s,{networkQualityProbe:!0})}catch{return c}const g=new Pve,v=g.createMuteAudioTrack();let _=await QB({mediaStreamTrack:v});await f.publish([_]);let[S,w,C]=await new Ie((X,te)=>{const ne=setTimeout(()=>{clearTimeout(ne),X([!0,null,"audio"])},5e3);f.on("user-published",async(Z,ie)=>{Z.uid===u&&(clearTimeout(ne),X([!1,Z,ie]))})});if(S||!w)return await f.unpublish([_]),await f.leave(),_.close(),g.close(),c;await f.subscribe(w,C),await new Ie((X,te)=>{const ne=setTimeout(()=>{clearTimeout(ne),X(null)},5e3)});let M=f.getRTCStats(),I=f.getLocalAudioStats();const k=M.RTT,G=I.sendJitterMs,K=I.currentPacketLossRate;return c={state:"complete",rtt:k,packetLossRate:K,jitter:G,networkQuality:((X,te,ne)=>{let Z=1;if(ne>0){let at=Math.log(100*ne)/Math.log(2)+1;at=Math.min(5,Math.max(0,at)),Z=1-at/5}let ie=1;if(X>0){let at=Math.log(X/40)/Math.log(2)+1;at=Math.min(5,Math.max(0,at)),ie=1-at/5}let ge=1;if(te>0){let at=Math.log(te/10)/Math.log(2.5)+1;at=Math.min(5,Math.max(0,at)),ge=1-at/5}const Ee=.5*Z+.3*ie+.2*ge;let Me=0;return Me=Ee>=.8?1:Ee>=.6?2:Ee>=.4?3:Ee>=.2?4:5,Me})(k,G,K)},await f.unsubscribe(w),await f.unpublish([_]),await f.leave(),_.close(),g.close(),await _O(d),c}});return Object.defineProperties(Xn,{onAudioAutoplayFailed:{get:()=>Ii.onAudioAutoplayFailed,set:t=>{Ii.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Ii.onAutoplayFailed,set:t=>{Ii.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Xn._onSecurityPolicyViolation,set(t){Xn._onSecurityPolicyViolation=t,ZW(t)}},__CLIENT_LIST__:{get:()=>W("SHOW_GLOBAL_CLIENT_LIST")?Au:[]}}),Oa.on(xu.CAMERA_DEVICE_CHANGED,t=>{R.info("camera device changed",JSON.stringify(t)),Xn.onCameraChanged&&Xn.onCameraChanged(t),Xn.safeEmit(cc.CAMERA_CHANGED,t)}),Oa.on(xu.RECORDING_DEVICE_CHANGED,t=>{R.info("microphone device changed",JSON.stringify(t)),Xn.onMicrophoneChanged&&Xn.onMicrophoneChanged(t),Xn.safeEmit(cc.MICROPHONE_CHANGED,t)}),Oa.on(xu.PLAYOUT_DEVICE_CHANGED,t=>{R.debug("playout device changed",JSON.stringify(t)),Xn.onPlaybackDeviceChanged&&Xn.onPlaybackDeviceChanged(t),Xn.safeEmit(cc.PLAYBACK_DEVICE_CHANGED,t)}),ii.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Ii.onAudioAutoplayFailed&&Ii.onAudioAutoplayFailed()},en.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),Ii.onAudioAutoplayFailed&&Ii.onAudioAutoplayFailed(),Xn.safeEmit(cc.AUTOPLAY_FAILED)}),en.on(Ir.STATE_CHANGE,(t,r)=>{R.info("audio context state changed: ".concat(r," => ").concat(t)),Xn.onAudioContextStateChanged&&Xn.onAudioContextStateChanged(t,r),Xn.safeEmit(cc.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),Nn.on(mu.NETWORK_STATE_CHANGE,(t,r)=>{R.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Xn),Xn})})(Ote);var W7e=Ote.exports;const Hf=Zn(W7e);function G7e(){var je,fe,He,Ye,gt,Vt,zn,_r,it,Nt,Ut;const{appointmentId:e}=Nx(),n=ro(),[a,o]=J.useState(null),[l,p]=J.useState(!0),[m,y]=J.useState(!1),[E,b]=J.useState("video"),[T,x]=J.useState([]),[A,D]=J.useState(""),[N,L]=J.useState({video:!0,audio:!0,speaker:!0}),[P,U]=J.useState(null),[V,F]=J.useState(null),[H,B]=J.useState(null),[z,Y]=J.useState([]),[Q,re]=J.useState(!1),de=J.useRef(null),le=J.useRef(null);J.useEffect(()=>(ve(),he(),()=>{Re()}),[e]);const he=()=>{const Pe=Hf.createClient({mode:"rtc",codec:"vp8"});Pe.on("user-published",async(St,Ot)=>{await Pe.subscribe(St,Ot),Ot==="video"&&(Y(Pn=>[...Pn.filter(wn=>wn.uid!==St.uid),St]),le.current&&St.videoTrack.play(le.current)),Ot==="audio"&&St.audioTrack.play()}),Pe.on("user-unpublished",St=>{Y(Ot=>Ot.filter(Pn=>Pn.uid!==St.uid))}),Pe.on("user-left",St=>{Y(Ot=>Ot.filter(Pn=>Pn.uid!==St.uid))}),U(Pe)},Re=async()=>{V&&(V.stop(),V.close()),H&&(H.stop(),H.close()),P&&Q&&await P.leave()},ve=async()=>{try{const{data:Pe}=await Ua.getAppointmentDetails(e);o(Pe)}catch{bt.error("Failed to load appointment details"),n("/doctors")}finally{p(!1)}},we=async()=>{if(!P||!(a!=null&&a.videoRoom)){bt.error("Video call not available");return}try{const{config:Pe}=a.videoRoom;if(Pe.type==="agora"&&Pe.appId&&Pe.token){await P.join(Pe.appId,Pe.channelName,Pe.token,Pe.uid);const St=await Hf.createCameraVideoTrack(),Ot=await Hf.createMicrophoneAudioTrack();F(St),B(Ot),de.current&&St.play(de.current),await P.publish([St,Ot]),re(!0),bt.success("Joined video call successfully")}else bt.error("Video call configuration not available")}catch(Pe){console.error("Error joining video call:",Pe),bt.error("Failed to join video call")}},ue=async()=>{try{await Re(),re(!1),Y([]),bt.success("Left video call")}catch(Pe){console.error("Error leaving video call:",Pe)}},be=async()=>{try{await Ua.startConsultation(e),y(!0),(a==null?void 0:a.type)==="video"&&await we(),bt.success("Consultation started")}catch{bt.error("Failed to start consultation")}},ae=async()=>{try{Q&&await ue(),await Ua.endConsultation(e),y(!1),bt.success("Consultation ended"),n("/consultation-summary/"+e)}catch{bt.error("Failed to end consultation")}},ce=()=>{if(!A.trim())return;const Pe={id:Date.now(),text:A,sender:"patient",timestamp:new Date};x([...T,Pe]),D("")},Se=async Pe=>{if(Pe==="video"&&V){const St=!N.video;await V.setEnabled(St),L(Ot=>({...Ot,video:St}))}else if(Pe==="audio"&&H){const St=!N.audio;await H.setEnabled(St),L(Ot=>({...Ot,audio:St}))}else Pe==="speaker"&&L(St=>({...St,speaker:!St.speaker}))};return l?h.jsx("div",{className:"flex items-center justify-center min-h-screen",children:h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})}):a?h.jsxs("div",{className:"min-h-screen bg-[#0a0f1a]",children:[h.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:h.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("button",{onClick:()=>n("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:h.jsx(bl,{className:"w-5 h-5 text-slate-400"})}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:((He=(fe=(je=a.doctor)==null?void 0:je.name)==null?void 0:fe[0])==null?void 0:He.toUpperCase())||"D"}),h.jsxs("div",{children:[h.jsxs("h1",{className:"text-lg font-bold text-white",children:["Dr. ",(Ye=a.doctor)==null?void 0:Ye.name]}),h.jsx("p",{className:"text-sm text-slate-400",children:(gt=a.doctor)==null?void 0:gt.specialization})]})]})]}),h.jsx("div",{className:"flex items-center gap-2",children:h.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.status==="confirmed"?"bg-green-500/20 text-green-400":a.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-slate-500/20 text-slate-400"}`,children:a.status})})]})}),m?h.jsxs("div",{className:"h-[calc(100vh-80px)] flex",children:[h.jsxs("div",{className:"flex-1 bg-slate-900 relative",children:[E==="video"&&h.jsxs("div",{className:"h-full relative",children:[h.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:z.length>0?h.jsx("div",{ref:le,className:"w-full h-full",style:{background:"#1e293b"}}):h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-4xl font-bold text-white mx-auto mb-4",children:((Nt=(it=(_r=a.doctor)==null?void 0:_r.name)==null?void 0:it[0])==null?void 0:Nt.toUpperCase())||"D"}),h.jsxs("p",{className:"text-white text-lg",children:["Dr. ",(Ut=a.doctor)==null?void 0:Ut.name]}),h.jsx("p",{className:"text-slate-400",children:Q?"Waiting for doctor to join...":"Video consultation ready"})]})}),Q&&h.jsxs("div",{className:"absolute top-4 right-4 w-48 h-36 bg-slate-800 rounded-lg overflow-hidden border-2 border-slate-600",children:[h.jsx("div",{ref:de,className:"w-full h-full",style:{background:"#1e293b"}}),h.jsx("div",{className:"absolute bottom-2 left-2 text-white text-xs bg-black/50 px-2 py-1 rounded",children:"You"})]}),h.jsx("div",{className:"absolute top-4 left-4",children:h.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${Q?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:[h.jsx("div",{className:`w-2 h-2 rounded-full ${Q?"bg-green-400":"bg-yellow-400"} animate-pulse`}),Q?"Connected":"Connecting..."]})}),Q&&h.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:h.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/90 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm",children:[h.jsx(Ch,{className:"w-4 h-4"}),z.length+1," participants"]})})]}),h.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2",children:h.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/90 backdrop-blur-sm rounded-full px-6 py-3",children:[h.jsx("button",{onClick:()=>Se("audio"),className:`p-3 rounded-full transition-colors ${N.audio?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:N.audio?"Mute microphone":"Unmute microphone",children:N.audio?h.jsx(RJ,{className:"w-5 h-5"}):h.jsx(CJ,{className:"w-5 h-5"})}),h.jsx("button",{onClick:()=>Se("video"),className:`p-3 rounded-full transition-colors ${N.video?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:N.video?"Turn off camera":"Turn on camera",children:N.video?h.jsx(EJ,{className:"w-5 h-5"}):h.jsx(fP,{className:"w-5 h-5"})}),h.jsx("button",{onClick:()=>Se("speaker"),className:`p-3 rounded-full transition-colors ${N.speaker?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:N.speaker?"Mute speaker":"Unmute speaker",children:N.speaker?h.jsx(mTe,{className:"w-5 h-5"}):h.jsx(gTe,{className:"w-5 h-5"})}),h.jsx("button",{className:"p-3 rounded-full bg-slate-700 text-white hover:bg-slate-600 transition-colors",title:"Share screen",children:h.jsx(oTe,{className:"w-5 h-5"})}),h.jsx("button",{onClick:ae,className:"p-3 rounded-full bg-red-500 hover:bg-red-600 text-white transition-colors",title:"End consultation",children:h.jsx(zo,{className:"w-5 h-5"})})]})})]}),h.jsxs("div",{className:"w-80 bg-[#111827] border-l border-slate-700 flex flex-col",children:[h.jsx("div",{className:"p-4 border-b border-slate-700",children:h.jsx("h3",{className:"text-white font-medium",children:"Chat"})}),h.jsx("div",{className:"flex-1 p-4 overflow-y-auto space-y-3",children:T.map(Pe=>h.jsx("div",{className:`flex ${Pe.sender==="patient"?"justify-end":"justify-start"}`,children:h.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${Pe.sender==="patient"?"bg-cyan-500 text-white":"bg-slate-700 text-white"}`,children:Pe.text})},Pe.id))}),h.jsx("div",{className:"p-4 border-t border-slate-700",children:h.jsxs("div",{className:"flex gap-2",children:[h.jsx("input",{type:"text",value:A,onChange:Pe=>D(Pe.target.value),onKeyPress:Pe=>Pe.key==="Enter"&&ce(),placeholder:"Type a message...",className:"flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500"}),h.jsx("button",{onClick:ce,className:"bg-cyan-500 hover:bg-cyan-600 text-white p-2 rounded-lg transition-colors",children:h.jsx(Dm,{className:"w-4 h-4"})})]})})]})]}):h.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[h.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Appointment Details"}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(ga,{className:"w-5 h-5 text-cyan-400"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-white font-medium",children:"Date & Time"}),h.jsxs("p",{className:"text-slate-400 text-sm",children:[new Date(a.date).toLocaleDateString()," at ",a.timeSlot]})]})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(jd,{className:"w-5 h-5 text-cyan-400"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-white font-medium",children:"Consultation Type"}),h.jsx("p",{className:"text-slate-400 text-sm capitalize",children:a.type})]})]}),a.symptoms&&h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx(hi,{className:"w-5 h-5 text-cyan-400 mt-0.5"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-white font-medium",children:"Symptoms"}),h.jsx("p",{className:"text-slate-400 text-sm",children:a.symptoms})]})]})]})]}),h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Doctor Information"}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(vJ,{className:"w-5 h-5 text-cyan-400"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-white font-medium",children:"Experience"}),h.jsxs("p",{className:"text-slate-400 text-sm",children:[((Vt=a.doctor)==null?void 0:Vt.experience)||"5+"," years"]})]})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(uP,{className:"w-5 h-5 text-cyan-400"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-white font-medium",children:"Location"}),h.jsx("p",{className:"text-slate-400 text-sm",children:((zn=a.doctor)==null?void 0:zn.location)||"Online"})]})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(to,{className:"w-5 h-5 text-cyan-400"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-white font-medium",children:"Rating"}),h.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(Pe=>h.jsx(to,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},Pe)),h.jsx("span",{className:"text-slate-400 text-sm ml-1",children:"(4.8)"})]})]})]})]})]})]}),h.jsx("div",{className:"mt-8 text-center",children:h.jsxs("button",{onClick:be,className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white px-8 py-4 rounded-xl font-medium transition-all inline-flex items-center gap-2",children:[h.jsx(jd,{className:"w-5 h-5"}),"Start Consultation"]})})]})]}):h.jsxs("div",{className:"text-center py-12",children:[h.jsx(kc,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),h.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Appointment Not Found"}),h.jsx("p",{className:"text-slate-400",children:"The appointment you're looking for doesn't exist."})]})}function $7e(){const{appointmentId:e}=Nx(),n=ro(),[a,o]=J.useState(null),[l,p]=J.useState(!0),[m,y]=J.useState(0),[E,b]=J.useState(""),[T,x]=J.useState(!1),[A,D]=J.useState("summary");J.useEffect(()=>{N()},[e]);const N=async()=>{try{const{data:F}=await Ua.getConsultationSummary(e);o(F)}catch{bt.error("Failed to load consultation summary"),n("/doctors")}finally{p(!1)}},L=async()=>{if(m===0){bt.error("Please provide a rating");return}x(!0);try{await Ua.submitReview(e,{rating:m,review:E}),bt.success("Review submitted successfully"),o(F=>({...F,reviewSubmitted:!0}))}catch{bt.error("Failed to submit review")}finally{x(!1)}},P=async()=>{try{const F=await Ua.downloadPrescription(e),H=new Blob([F.data],{type:"application/pdf"}),B=window.URL.createObjectURL(H),z=document.createElement("a");z.href=B,z.download=`prescription-${e}.pdf`,z.click(),window.URL.revokeObjectURL(B)}catch{bt.error("Failed to download prescription")}};if(l)return h.jsx("div",{className:"flex items-center justify-center min-h-screen",children:h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})});const U={doctor:{name:"Dr. Sarah Johnson",specialization:"General Physician"},date:new Date().toISOString(),duration:"30 minutes",diagnosis:"Vitamin D deficiency with mild fatigue symptoms",prescription:[{medication:"Vitamin D3 Supplement",dosage:"1000 IU daily",duration:"3 months",instructions:"Take with food, preferably in the morning"},{medication:"Multivitamin",dosage:"1 tablet daily",duration:"1 month",instructions:"Take after breakfast"}],recommendations:["Get 15-20 minutes of sunlight exposure daily","Include vitamin D rich foods like fatty fish, eggs, and fortified milk","Regular exercise to improve energy levels","Follow-up blood test in 3 months"],followUp:{date:new Date(Date.now()+90*24*60*60*1e3).toISOString(),type:"Blood test review"},notes:"Patient reported fatigue and low energy levels. Blood work shows vitamin D deficiency at 18 ng/mL (normal: 30-100). Recommended supplementation and lifestyle changes.",reviewSubmitted:!1},V=a||U;return h.jsxs("div",{className:"min-h-screen bg-[#0a0f1a] pb-8",children:[h.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:h.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("button",{onClick:()=>n("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:h.jsx(bl,{className:"w-5 h-5 text-slate-400"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-lg font-bold text-white",children:"Consultation Summary"}),h.jsxs("p",{className:"text-sm text-slate-400",children:[new Date(V.date).toLocaleDateString(),"  ",V.duration]})]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[h.jsx(nTe,{className:"w-4 h-4"}),"Download"]}),h.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg transition-colors",children:[h.jsx(dTe,{className:"w-4 h-4"}),"Share"]})]})]})}),h.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[h.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 mb-6",children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-xl font-bold text-white",children:V.doctor.name[0]}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h2",{className:"text-xl font-bold text-white",children:V.doctor.name}),h.jsx("p",{className:"text-slate-400",children:V.doctor.specialization})]}),h.jsxs("div",{className:"text-right",children:[h.jsx("div",{className:"flex items-center gap-1 mb-1",children:[1,2,3,4,5].map(F=>h.jsx(to,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},F))}),h.jsx("p",{className:"text-sm text-slate-400",children:"4.8 rating"})]})]})}),h.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-xl w-fit mb-6",children:[h.jsx("button",{onClick:()=>D("summary"),className:`px-4 py-2 rounded-lg font-medium transition-all ${A==="summary"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Summary"}),h.jsx("button",{onClick:()=>D("prescription"),className:`px-4 py-2 rounded-lg font-medium transition-all ${A==="prescription"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Prescription"}),h.jsx("button",{onClick:()=>D("followup"),className:`px-4 py-2 rounded-lg font-medium transition-all ${A==="followup"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Follow-up"})]}),h.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[h.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[A==="summary"&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:h.jsx(ni,{className:"w-5 h-5 text-blue-400"})}),h.jsx("h3",{className:"text-lg font-bold text-white",children:"Diagnosis"})]}),h.jsx("p",{className:"text-slate-300 leading-relaxed",children:V.diagnosis})]}),h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:h.jsx(hi,{className:"w-5 h-5 text-green-400"})}),h.jsx("h3",{className:"text-lg font-bold text-white",children:"Doctor's Notes"})]}),h.jsx("p",{className:"text-slate-300 leading-relaxed",children:V.notes})]}),h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center",children:h.jsx(va,{className:"w-5 h-5 text-cyan-400"})}),h.jsx("h3",{className:"text-lg font-bold text-white",children:"Recommendations"})]}),h.jsx("ul",{className:"space-y-3",children:V.recommendations.map((F,H)=>h.jsxs("li",{className:"flex items-start gap-3",children:[h.jsx(va,{className:"w-5 h-5 text-green-400 mt-0.5 shrink-0"}),h.jsx("span",{className:"text-slate-300",children:F})]},H))})]})]}),A==="prescription"&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center",children:h.jsx(Bx,{className:"w-5 h-5 text-purple-400"})}),h.jsx("h3",{className:"text-lg font-bold text-white",children:"Prescription"})]}),h.jsx("div",{className:"space-y-4",children:V.prescription.map((F,H)=>h.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[h.jsxs("div",{className:"flex items-start justify-between mb-2",children:[h.jsx("h4",{className:"font-bold text-white",children:F.medication}),h.jsx("span",{className:"text-sm text-slate-400",children:F.duration})]}),h.jsx("p",{className:"text-cyan-400 font-medium mb-2",children:F.dosage}),h.jsx("p",{className:"text-slate-300 text-sm",children:F.instructions})]},H))}),h.jsx("div",{className:"mt-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx(Mx,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-yellow-400 font-medium mb-1",children:"Important"}),h.jsx("p",{className:"text-slate-300 text-sm",children:"Take medications as prescribed. Do not stop or change dosage without consulting your doctor."})]})]})})]}),A==="followup"&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center",children:h.jsx(ga,{className:"w-5 h-5 text-orange-400"})}),h.jsx("h3",{className:"text-lg font-bold text-white",children:"Follow-up Care"})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[h.jsx(gs,{className:"w-5 h-5 text-cyan-400"}),h.jsx("h4",{className:"font-bold text-white",children:"Next Appointment"})]}),h.jsxs("p",{className:"text-slate-300",children:[new Date(V.followUp.date).toLocaleDateString()," - ",V.followUp.type]})]}),h.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[h.jsx("h4",{className:"font-bold text-white mb-2",children:"Health Tracking"}),h.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"Monitor your progress and upload follow-up reports to track improvements."}),h.jsx("button",{className:"bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"Upload Report"})]})]})]})]}),h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Quick Actions"}),h.jsxs("div",{className:"space-y-3",children:[h.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[h.jsx(ga,{className:"w-5 h-5 text-cyan-400"}),h.jsx("span",{className:"text-white",children:"Book Follow-up"})]}),h.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[h.jsx(Vx,{className:"w-5 h-5 text-cyan-400"}),h.jsx("span",{className:"text-white",children:"Message Doctor"})]}),h.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[h.jsx(Xxe,{className:"w-5 h-5 text-cyan-400"}),h.jsx("span",{className:"text-white",children:"Save to Health Records"})]})]})]}),!V.reviewSubmitted&&h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Rate this Consultation"}),h.jsxs("div",{className:"mb-4",children:[h.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"How was your experience?"}),h.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(F=>h.jsx("button",{onClick:()=>y(F),className:`p-1 transition-colors ${F<=m?"text-yellow-400":"text-slate-600 hover:text-slate-400"}`,children:h.jsx(to,{className:"w-6 h-6 fill-current"})},F))})]}),h.jsx("textarea",{value:E,onChange:F=>b(F.target.value),placeholder:"Share your feedback (optional)",className:"w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-400 resize-none h-20 focus:outline-none focus:border-cyan-500"}),h.jsx("button",{onClick:L,disabled:T||m===0,className:"w-full mt-4 bg-cyan-500 hover:bg-cyan-600 disabled:bg-slate-600 text-white py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:T?h.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):h.jsxs(h.Fragment,{children:[h.jsx(Dm,{className:"w-4 h-4"}),"Submit Review"]})})]}),h.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[h.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Health Tracking"}),h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-slate-300",children:"Vitamin D Level"}),h.jsx("span",{className:"text-yellow-400",children:"Improving"})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-slate-300",children:"Energy Level"}),h.jsx("span",{className:"text-green-400",children:"Stable"})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-slate-300",children:"Sleep Quality"}),h.jsx("span",{className:"text-cyan-400",children:"Good"})]})]})]})]})]})]})]})}function H7e(){const[e,n]=J.useState(null),[a,o]=J.useState(null),[l,p]=J.useState(null),[m,y]=J.useState([]),[E,b]=J.useState(!1),[T,x]=J.useState(!0),[A,D]=J.useState(!0),N=J.useRef(null),L=J.useRef(null),P="e788e8f838484d4dafe4705d682df57c",U="healthai-test";J.useEffect(()=>(V(),()=>{B()}),[]);const V=()=>{const Q=Hf.createClient({mode:"rtc",codec:"vp8"});Q.on("user-published",async(re,de)=>{await Q.subscribe(re,de),de==="video"&&(y(le=>[...le.filter(he=>he.uid!==re.uid),re]),L.current&&re.videoTrack.play(L.current)),de==="audio"&&re.audioTrack.play()}),Q.on("user-unpublished",re=>{y(de=>de.filter(le=>le.uid!==re.uid))}),Q.on("user-left",re=>{y(de=>de.filter(le=>le.uid!==re.uid))}),n(Q)},F=async()=>{if(e)try{const Q=Math.floor(Math.random()*1e4);let re=null;try{const Re=await(await fetch("/api/doctors/generate-video-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelName:U,uid:Q})})).json();Re.success&&(re=Re.token,console.log("Generated token:",re?"Token received":"No token (testing mode)"))}catch(he){console.log("Failed to get token from server, using null token:",he)}await e.join(P,U,re,Q);const de=await Hf.createCameraVideoTrack(),le=await Hf.createMicrophoneAudioTrack();o(de),p(le),N.current&&de.play(N.current),await e.publish([de,le]),b(!0),bt.success("Joined video call successfully!")}catch(Q){console.error("Error joining channel:",Q),bt.error("Failed to join video call: "+Q.message)}},H=async()=>{if(e)try{await B(),b(!1),y([]),bt.success("Left video call")}catch(Q){console.error("Error leaving channel:",Q),bt.error("Failed to leave video call")}},B=async()=>{a&&(a.stop(),a.close(),o(null)),l&&(l.stop(),l.close(),p(null)),e&&E&&await e.leave()},z=async()=>{if(a){const Q=!T;await a.setEnabled(Q),x(Q)}},Y=async()=>{if(l){const Q=!A;await l.setEnabled(Q),D(Q)}};return h.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:h.jsxs("div",{className:"max-w-6xl mx-auto",children:[h.jsxs("div",{className:"text-center mb-8",children:[h.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Video Call Test"}),h.jsx("p",{className:"text-slate-400",children:"Test your Agora.io video calling setup"}),h.jsx("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:h.jsxs("p",{className:"text-sm text-slate-300",children:[h.jsx("strong",{children:"Channel:"})," ",U," | ",h.jsx("strong",{children:"App ID:"})," ",P.substring(0,8),"..."]})})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[h.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[h.jsx("div",{ref:N,className:"w-full h-full bg-slate-800"}),h.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:["You ",E?"(Live)":"(Preview)"]}),!T&&h.jsx("div",{className:"absolute inset-0 bg-slate-800 flex items-center justify-center",children:h.jsx(fP,{className:"w-16 h-16 text-slate-400"})})]}),h.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[m.length>0?h.jsx("div",{ref:L,className:"w-full h-full bg-slate-800"}):h.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx(jd,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),h.jsx("p",{className:"text-slate-400",children:E?"Waiting for others to join...":"Remote participant will appear here"})]})}),m.length>0&&h.jsx("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:"Remote User"})]})]}),h.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[h.jsx("button",{onClick:Y,className:`p-4 rounded-full transition-colors ${A?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!E,children:A?h.jsx(RJ,{className:"w-6 h-6"}):h.jsx(CJ,{className:"w-6 h-6"})}),h.jsx("button",{onClick:z,className:`p-4 rounded-full transition-colors ${T?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!E,children:T?h.jsx(jd,{className:"w-6 h-6"}):h.jsx(fP,{className:"w-6 h-6"})}),E?h.jsxs("button",{onClick:H,className:"bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[h.jsx(cTe,{className:"w-5 h-5"}),"Leave Call"]}):h.jsxs("button",{onClick:F,className:"bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[h.jsx(Zk,{className:"w-5 h-5"}),"Join Call"]})]}),h.jsx("div",{className:"text-center",children:h.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${E?"bg-green-500/20 text-green-400":"bg-slate-500/20 text-slate-400"}`,children:[h.jsx("div",{className:`w-2 h-2 rounded-full ${E?"bg-green-400 animate-pulse":"bg-slate-400"}`}),E?`Connected (${m.length+1} participants)`:"Not connected"]})}),h.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[h.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Testing Instructions:"}),h.jsxs("ol",{className:"text-slate-300 space-y-2 list-decimal list-inside",children:[h.jsx("li",{children:'Click "Join Call" to start the video call'}),h.jsx("li",{children:"Allow camera and microphone permissions when prompted"}),h.jsx("li",{children:"Open this page in another browser tab/window to test with multiple participants"}),h.jsx("li",{children:"Test the mute/unmute and video on/off controls"}),h.jsx("li",{children:"Check that you can see and hear other participants"})]}),h.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:h.jsxs("p",{className:"text-blue-400 text-sm",children:[h.jsx("strong",{children:"Note:"})," This is using your Agora.io free tier (10,000 minutes/month). Perfect for testing and development!"]})}),h.jsxs("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[h.jsx("h4",{className:"text-yellow-400 font-medium mb-2",children:" Troubleshooting"}),h.jsxs("div",{className:"text-yellow-300 text-sm space-y-1",children:[h.jsx("p",{children:h.jsx("strong",{children:"If video call fails:"})}),h.jsx("p",{children:" Check browser console for error messages"}),h.jsx("p",{children:" Ensure camera/microphone permissions are granted"}),h.jsx("p",{children:" Try disabling token authentication in Agora Console"}),h.jsx("p",{children:" Check server logs for token generation issues"})]})]}),h.jsxs("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[h.jsx("h4",{className:"text-green-400 font-medium mb-2",children:" Quick Fix"}),h.jsx("div",{className:"text-green-300 text-sm",children:h.jsxs("p",{children:[h.jsx("strong",{children:"Easiest solution:"}),' Go to Agora Console  Project Settings  Change Authentication from "App ID + Token" to "App ID only"']})})]})]})]})})}function z7e(){const[e,n]=J.useState(""),[a,o]=J.useState(!1),[l,p]=J.useState(null),m=async y=>{if(y.preventDefault(),!e){bt.error("Please enter an email address");return}o(!0),p(null);try{const b=await(await fetch("/api/doctors/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})})).json();b.success?(p({success:!0,message:b.message}),bt.success("Test email sent successfully!")):(p({success:!1,message:b.message}),bt.error("Failed to send email"))}catch(E){console.error("Email test error:",E),p({success:!1,message:E.message}),bt.error("Failed to send email")}finally{o(!1)}};return h.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:h.jsxs("div",{className:"max-w-2xl mx-auto",children:[h.jsxs("div",{className:"text-center mb-8",children:[h.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Email Test"}),h.jsx("p",{className:"text-slate-400",children:"Test your SMTP email configuration"})]}),h.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[h.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(w_,{className:"w-5 h-5 text-cyan-400"}),"Current SMTP Configuration"]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[h.jsxs("div",{children:[h.jsx("span",{className:"text-slate-400",children:"Host:"}),h.jsx("span",{className:"text-white ml-2",children:"smtp.gmail.com"})]}),h.jsxs("div",{children:[h.jsx("span",{className:"text-slate-400",children:"Port:"}),h.jsx("span",{className:"text-white ml-2",children:"587"})]}),h.jsxs("div",{children:[h.jsx("span",{className:"text-slate-400",children:"User:"}),h.jsx("span",{className:"text-white ml-2",children:"tech@colabplatforms.com"})]}),h.jsxs("div",{children:[h.jsx("span",{className:"text-slate-400",children:"From:"}),h.jsx("span",{className:"text-white ml-2",children:"HealthAI <tech@colabplatforms.com>"})]})]})]}),h.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[h.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Send Test Email"}),h.jsxs("form",{onSubmit:m,className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Test Email Address"}),h.jsx("input",{type:"email",value:e,onChange:y=>n(y.target.value),placeholder:"Enter email to receive test appointment confirmation",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500",required:!0})]}),h.jsx("button",{type:"submit",disabled:a,className:"w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-slate-600 disabled:to-slate-600 text-white py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2",children:a?h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Sending..."]}):h.jsxs(h.Fragment,{children:[h.jsx(Dm,{className:"w-5 h-5"}),"Send Test Email"]})})]})]}),l&&h.jsxs("div",{className:`rounded-2xl p-6 ${l.success?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"}`,children:[h.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.success?h.jsx(va,{className:"w-6 h-6 text-green-400"}):h.jsx(kc,{className:"w-6 h-6 text-red-400"}),h.jsx("h3",{className:`text-lg font-bold ${l.success?"text-green-400":"text-red-400"}`,children:l.success?"Email Sent Successfully!":"Email Failed"})]}),h.jsx("p",{className:`${l.success?"text-green-300":"text-red-300"}`,children:l.message}),l.success&&h.jsxs("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:[h.jsx("h4",{className:"text-white font-medium mb-2",children:"What to expect:"}),h.jsxs("ul",{className:"text-slate-300 text-sm space-y-1",children:[h.jsx("li",{children:' Check your inbox for "Appointment Confirmation - HealthAI"'}),h.jsx("li",{children:" The email will contain appointment details and a join link"}),h.jsx("li",{children:" It may take a few minutes to arrive"}),h.jsx("li",{children:" Check spam folder if not received"})]})]})]}),h.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[h.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Email Features"}),h.jsxs("div",{className:"space-y-4 text-slate-300",children:[h.jsxs("div",{children:[h.jsx("h4",{className:"text-white font-medium mb-2",children:" Appointment Confirmation"}),h.jsx("p",{className:"text-sm",children:"Professional HTML email with appointment details, doctor info, and video call join link."})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"text-white font-medium mb-2",children:" Automated Reminders"}),h.jsx("p",{className:"text-sm",children:"System sends reminders 24 hours before and 30 minutes before appointments."})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"text-white font-medium mb-2",children:" Mobile Responsive"}),h.jsx("p",{className:"text-sm",children:"Emails look great on all devices with touch-friendly buttons and responsive design."})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"text-white font-medium mb-2",children:" Professional Design"}),h.jsx("p",{className:"text-sm",children:"Branded emails with HealthAI colors, gradients, and professional layout."})]})]})]}),h.jsxs("div",{className:"mt-8 bg-yellow-500/10 border border-yellow-500/20 rounded-2xl p-6",children:[h.jsx("h3",{className:"text-lg font-bold text-yellow-400 mb-4",children:"Troubleshooting"}),h.jsxs("div",{className:"space-y-2 text-yellow-300 text-sm",children:[h.jsxs("p",{children:[" ",h.jsx("strong",{children:"Gmail App Password:"})," Make sure you're using an app password, not your regular Gmail password"]}),h.jsxs("p",{children:[" ",h.jsx("strong",{children:"2FA Required:"})," Gmail requires 2-factor authentication to generate app passwords"]}),h.jsxs("p",{children:[" ",h.jsx("strong",{children:"Less Secure Apps:"}),' App passwords bypass the need for "less secure apps" setting']}),h.jsxs("p",{children:[" ",h.jsx("strong",{children:"Rate Limits:"})," Gmail has sending limits (500 emails/day for free accounts)"]}),h.jsxs("p",{children:[" ",h.jsx("strong",{children:"Spam Filters:"})," Test emails might go to spam initially"]})]})]})]})})}const K7e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],rl={startTime:"09:00",endTime:"18:00",slotDuration:30};function Y7e(){const[e,n]=J.useState(rl),[a,o]=J.useState({}),[l,p]=J.useState({}),[m,y]=J.useState(!1),[E,b]=J.useState(!0),T=()=>{const H=[],B=new Date;for(let z=0;z<7;z++){const Y=new Date(B);Y.setDate(B.getDate()+z),H.push({date:Y.toISOString().split("T")[0],dayName:K7e[Y.getDay()],displayDate:Y.toLocaleDateString("en-US",{month:"short",day:"numeric"}),isToday:z===0})}return H},[x]=J.useState(T());J.useEffect(()=>{A()},[]);const A=async()=>{var H,B,z,Y,Q,re,de;try{const{data:le}=await Ua.getMyAvailability(),he={startTime:((B=(H=le.availability)==null?void 0:H.settings)==null?void 0:B.startTime)||rl.startTime,endTime:((Y=(z=le.availability)==null?void 0:z.settings)==null?void 0:Y.endTime)||rl.endTime,slotDuration:((re=(Q=le.availability)==null?void 0:Q.settings)==null?void 0:re.slotDuration)||rl.slotDuration};n(he),(de=le.availability)!=null&&de.blockedSlots&&p(le.availability.blockedSlots),D(he)}catch(le){console.error("Failed to fetch availability:",le),D(rl)}finally{b(!1)}},D=H=>{H||(H=rl);const B={},z=H.startTime||rl.startTime,Y=H.endTime||rl.endTime,Q=H.slotDuration||rl.slotDuration,re=z.split(":"),de=Y.split(":");if(re.length<2||de.length<2){console.error("Invalid time format");return}const le=parseInt(re[0],10),he=parseInt(re[1],10),Re=parseInt(de[0],10),ve=parseInt(de[1],10);x.forEach(we=>{B[we.date]=[];let ue=le*60+he;const be=Re*60+ve;for(;ue<be;){const ae=Math.floor(ue/60),ce=ue%60,Se=`${ae.toString().padStart(2,"0")}:${ce.toString().padStart(2,"0")}`,je=new Date(`2000-01-01T${Se}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});B[we.date].push({time:Se,display:je}),ue+=Q}}),o(B)},N=(H,B)=>{const z={...e,[H]:B};n(z),D(z)},L=(H,B)=>{p(z=>{const Y=z[H]||[];return Y.includes(B)?{...z,[H]:Y.filter(Q=>Q!==B)}:{...z,[H]:[...Y,B]}})},P=H=>{const B=a[H]||[];(l[H]||[]).length===B.length?p(Y=>({...Y,[H]:[]})):p(Y=>({...Y,[H]:B.map(Q=>Q.time)}))},U=(H,B)=>(l[H]||[]).includes(B),V=H=>{const B=a[H]||[],z=l[H]||[];return B.length>0&&z.length===B.length},F=async()=>{var H,B;y(!0);try{const z=await Ua.updateMyAvailability({settings:e,blockedSlots:l});console.log("Save response:",z.data),bt.success("Availability saved successfully!")}catch(z){console.error("Failed to save:",z),bt.error(((B=(H=z.response)==null?void 0:H.data)==null?void 0:B.message)||"Failed to save availability")}finally{y(!1)}};return E?h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),h.jsx("p",{className:"text-slate-500",children:"Loading availability..."})]})}):h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[h.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Manage Your Slots"}),h.jsx("p",{className:"text-slate-500 mt-1",children:"Set your operating hours and block unavailable times"})]}),h.jsxs("button",{onClick:F,disabled:m,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50",children:[m?h.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):h.jsx(OJ,{className:"w-5 h-5"}),"Save Changes"]})]}),h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[h.jsx(gs,{className:"w-5 h-5 text-cyan-500"}),"Operating Hours"]}),h.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Start Time"}),h.jsx("select",{value:e.startTime,onChange:H=>N("startTime",H.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(H,B)=>{const z=`${B.toString().padStart(2,"0")}:00`,Y=new Date(`2000-01-01T${z}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return h.jsx("option",{value:z,children:Y},z)})})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"End Time"}),h.jsx("select",{value:e.endTime,onChange:H=>N("endTime",H.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(H,B)=>{const z=`${B.toString().padStart(2,"0")}:00`,Y=new Date(`2000-01-01T${z}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return h.jsx("option",{value:z,children:Y},z)})})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Slot Duration"}),h.jsxs("select",{value:e.slotDuration,onChange:H=>N("slotDuration",parseInt(H.target.value)),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:[h.jsx("option",{value:15,children:"15 minutes"}),h.jsx("option",{value:30,children:"30 minutes"}),h.jsx("option",{value:45,children:"45 minutes"}),h.jsx("option",{value:60,children:"60 minutes"})]})]})]}),h.jsxs("p",{className:"text-sm text-slate-400 mt-3",children:["Current: ",e.startTime," to ",e.endTime,", ",e.slotDuration," min slots"]})]}),h.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-100 border-2 border-emerald-300"}),h.jsx("span",{className:"text-slate-600",children:"Available"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-4 h-4 rounded-full bg-red-100 border-2 border-red-300"}),h.jsx("span",{className:"text-slate-600",children:"Blocked"})]}),h.jsx("p",{className:"text-slate-400 ml-auto",children:"Click on slots to block/unblock"})]}),h.jsx("div",{className:"space-y-4",children:x.map(H=>{const B=a[H.date]||[],z=V(H.date);return h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(ga,{className:"w-5 h-5 text-cyan-500"}),h.jsxs("div",{children:[h.jsxs("h3",{className:"font-semibold text-slate-800",children:[H.dayName,H.isToday&&h.jsx("span",{className:"ml-2 text-xs bg-cyan-100 text-cyan-600 px-2 py-0.5 rounded-full",children:"Today"})]}),h.jsx("p",{className:"text-sm text-slate-500",children:H.displayDate})]})]}),h.jsx("button",{onClick:()=>P(H.date),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${z?"bg-emerald-100 text-emerald-600 hover:bg-emerald-200":"bg-red-100 text-red-600 hover:bg-red-200"}`,children:z?h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(sh,{className:"w-4 h-4"})," Unblock All"]}):h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(zo,{className:"w-4 h-4"})," Block Day"]})})]}),h.jsxs("div",{className:"flex flex-wrap gap-2",children:[B.map(Y=>{const Q=U(H.date,Y.time);return h.jsx("button",{onClick:()=>L(H.date,Y.time),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${Q?"bg-red-100 text-red-600 border border-red-200 hover:bg-red-200":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200"}`,children:Y.display},Y.time)}),B.length===0&&h.jsx("p",{className:"text-slate-400 text-sm py-2",children:"No slots - check your operating hours"})]})]},H.date)})}),h.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4",children:[h.jsx("h3",{className:"font-medium text-cyan-800 mb-2",children:" Quick Tips"}),h.jsxs("ul",{className:"text-sm text-cyan-700 space-y-1",children:[h.jsx("li",{children:" Set your operating hours above to auto-generate time slots"}),h.jsx("li",{children:" Click individual slots to block specific times"}),h.jsx("li",{children:' Use "Block Day" to mark entire days as unavailable'}),h.jsx("li",{children:" Don't forget to save your changes!"})]})]})]})}const q7e={"Vitamin D":{foods:[{name:"Fish (salmon, mackerel, rohu)",diet:["non-vegetarian"]},{name:"Egg yolks",diet:["eggetarian","non-vegetarian"]},{name:"Fortified milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushrooms",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Egg bhurji with paneer",diet:["eggetarian","non-vegetarian"]},{name:"Dalia with milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushroom omelette",diet:["eggetarian","non-vegetarian"]},{name:"Almond milk smoothie",diet:["vegan"]}],lunch:[{name:"Fish fry with salad",diet:["non-vegetarian"]},{name:"Fish curry with rice",diet:["non-vegetarian"]},{name:"Egg curry with rice",diet:["eggetarian","non-vegetarian"]},{name:"Mushroom pulao",diet:["vegan","vegetarian"]}],dinner:[{name:"Tandoori fish with vegetables",diet:["non-vegetarian"]},{name:"Paneer tikka",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushroom masala",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Paneer cubes",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Boiled eggs",diet:["eggetarian","non-vegetarian"]},{name:"Orange juice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Get 15-20 minutes of morning sunlight daily","Include fortified foods in your diet"]},"Vitamin B12":{foods:[{name:"Chicken, mutton",diet:["non-vegetarian"]},{name:"Fish",diet:["non-vegetarian"]},{name:"Eggs",diet:["eggetarian","non-vegetarian"]},{name:"Yogurt, milk, paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified cereals",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Nutritional yeast",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Eggs with whole wheat bread",diet:["eggetarian","non-vegetarian"]},{name:"Yogurt with muesli",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Milk smoothie",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified dalia with almond milk",diet:["vegan"]}],lunch:[{name:"Chicken with rice",diet:["non-vegetarian"]},{name:"Fish curry",diet:["non-vegetarian"]},{name:"Paneer salad",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu bhurji",diet:["vegan"]}],dinner:[{name:"Tandoori chicken",diet:["non-vegetarian"]},{name:"Mutton curry",diet:["non-vegetarian"]},{name:"Paneer butter masala",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Soya chunks curry",diet:["vegan"]}],snacks:[{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Almond milk",diet:["vegan"]}],tips:["Vegetarians and vegans should consider B12 supplements","Include fortified foods in every meal"]},Iron:{foods:[{name:"Red meat",diet:["non-vegetarian"]},{name:"Spinach (palak)",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Rajma, chana",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified cereals",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pumpkin seeds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Spinach smoothie",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified dalia",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Poha with peanuts",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],lunch:[{name:"Dal rice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Palak paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Liver curry",diet:["non-vegetarian"]},{name:"Rajma rice",diet:["vegan"]}],dinner:[{name:"Dal soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Grilled meat with vegetables",diet:["non-vegetarian"]}],snacks:[{name:"Pumpkin seeds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dried apricots",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Eat iron-rich foods with Vitamin C for better absorption","Avoid tea/coffee with meals"]},Calcium:{foods:[{name:"Milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Leafy green vegetables",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Almonds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified almond milk",diet:["vegan"]}],breakfast:[{name:"Milk with dalia",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt with fruits",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer paratha",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Almond milk smoothie",diet:["vegan"]}],lunch:[{name:"Paneer curry",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu bhurji",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],dinner:[{name:"Palak paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fish curry",diet:["non-vegetarian"]},{name:"Broccoli soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Almonds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]}],tips:["Include calcium-rich foods in every meal","Get adequate Vitamin D for calcium absorption"]},Hemoglobin:{foods:[{name:"Red meat",diet:["non-vegetarian"]},{name:"Liver",diet:["non-vegetarian"]},{name:"Spinach (palak)",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Beetroot",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Beetroot juice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach paratha",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate smoothie",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],lunch:[{name:"Liver curry",diet:["non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Beetroot salad",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],dinner:[{name:"Grilled meat",diet:["non-vegetarian"]},{name:"Spinach soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dal curry",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Jaggery",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Eat iron-rich foods with Vitamin C","Avoid calcium with iron-rich meals"]}},X7e={"Vitamin D":{category:"Vitamin D3 Supplements",description:"Vitamin D3 (cholecalciferol) supplements can help maintain healthy vitamin D levels, especially for those with limited sun exposure.",note:"Consult your doctor for appropriate dosage based on your deficiency level."},"Vitamin B12":{category:"Vitamin B12 Supplements",description:"B12 supplements are available as tablets, sublingual forms, or injections. Methylcobalamin is a well-absorbed form.",note:"Especially important for vegetarians and vegans who may not get enough from diet."},Iron:{category:"Iron Supplements",description:"Iron supplements (ferrous sulfate, ferrous gluconate) can help address iron deficiency anemia.",note:"Take with Vitamin C for better absorption. May cause stomach upset - take with food if needed."},Calcium:{category:"Calcium Supplements",description:"Calcium carbonate or calcium citrate supplements can help meet daily calcium requirements.",note:"Best absorbed when taken in smaller doses throughout the day with food."}};function J7e(){var B,z,Y,Q;const{user:e}=Ha(),[n,a]=J.useState(!0),[o,l]=J.useState([]),[p,m]=J.useState(""),[y,E]=J.useState(!1),[b,T]=J.useState(null),[x,A]=J.useState(!0);J.useEffect(()=>{D()},[]);const D=async()=>{var re;try{const{data:de}=await mh.getDashboard(),le=((re=de.latestAnalysis)==null?void 0:re.deficiencies)||[];l(le.map(he=>typeof he=="string"?he:he.name||he.nutrient))}catch(de){console.error("Failed to fetch health data:",de)}finally{a(!1)}},N=()=>{if(p.trim()){const re=p.split(",").map(de=>de.trim()).filter(Boolean);l([...new Set([...o,...re])]),m(""),E(!1),bt.success("Deficiencies added")}},L=re=>{l(o.filter(de=>de!==re))},P=()=>{var le;const re={breakfast:[],lunch:[],dinner:[],snacks:[],tips:[],foods:[]},de=((le=e==null?void 0:e.profile)==null?void 0:le.dietaryPreference)||"non-vegetarian";return o.forEach(he=>{const Re=Object.entries(q7e).find(([ve])=>he.toLowerCase().includes(ve.toLowerCase())||ve.toLowerCase().includes(he.toLowerCase()));if(Re){const[,ve]=Re,we=ue=>ue.filter(be=>be.diet.includes(de)).map(be=>be.name);re.breakfast.push(...we(ve.breakfast||[])),re.lunch.push(...we(ve.lunch||[])),re.dinner.push(...we(ve.dinner||[])),re.snacks.push(...we(ve.snacks||[])),re.foods.push(...we(ve.foods||[])),re.tips.push(...ve.tips||[])}}),Object.keys(re).forEach(he=>{re[he]=[...new Set(re[he])]}),re},U=()=>o.map(re=>{const de=Object.entries(X7e).find(([le])=>re.toLowerCase().includes(le.toLowerCase())||le.toLowerCase().includes(re.toLowerCase()));return de?{deficiency:re,...de[1]}:null}).filter(Boolean);if(n)return h.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),h.jsx("p",{className:"text-slate-500",children:"Loading your personalized plan..."})]})});const V=P(),F=U(),H=o.length>0&&(V.breakfast.length>0||V.lunch.length>0);return h.jsxs("div",{className:"space-y-6 animate-fade-in",children:[h.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Personalized Diet Plan"}),h.jsxs("p",{className:"text-slate-500 mt-1",children:["AI-generated nutrition guidance based on your health data",((B=e==null?void 0:e.profile)==null?void 0:B.age)&&`  ${e.profile.age} years`,((z=e==null?void 0:e.profile)==null?void 0:z.gender)&&`  ${e.profile.gender}`,((Y=e==null?void 0:e.profile)==null?void 0:Y.dietaryPreference)&&`  ${e.profile.dietaryPreference.charAt(0).toUpperCase()+e.profile.dietaryPreference.slice(1)}`]})]}),h.jsx("div",{className:"flex items-center gap-3",children:h.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[h.jsx("input",{type:"checkbox",checked:x,onChange:re=>A(re.target.checked),className:"w-4 h-4 rounded border-slate-300 text-cyan-500 focus:ring-cyan-500"}),h.jsx("span",{className:"text-sm text-slate-600",children:"Enable diet recommendations"})]})})]}),x?h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[h.jsx(kc,{className:"w-5 h-5 text-amber-500"}),"Detected Deficiencies"]}),h.jsxs("button",{onClick:()=>E(!y),className:"flex items-center gap-1 text-sm text-cyan-600 hover:text-cyan-700",children:[h.jsx(Wx,{className:"w-4 h-4"})," Add Manually"]})]}),((Q=e==null?void 0:e.profile)==null?void 0:Q.dietaryPreference)&&h.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-xl",children:h.jsxs("p",{className:"text-sm text-green-700",children:[h.jsx("strong",{children:"Dietary Preference:"})," ",e.profile.dietaryPreference.charAt(0).toUpperCase()+e.profile.dietaryPreference.slice(1)," ","- All recommendations are filtered to match your preference.",h.jsx(Tn,{to:"/profile",className:"ml-2 text-cyan-600 hover:text-cyan-700 underline",children:"Change in Profile"})]})}),y&&h.jsxs("div",{className:"mb-4 p-4 bg-slate-50 rounded-xl",children:[h.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Don't have reports? Add your known deficiencies manually:"}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx("input",{type:"text",value:p,onChange:re=>m(re.target.value),placeholder:"e.g., Vitamin D, Iron, B12",className:"flex-1 px-4 py-2 bg-white border border-slate-200 rounded-lg text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"}),h.jsx("button",{onClick:N,className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600",children:"Add"})]})]}),o.length>0?h.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((re,de)=>h.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-amber-100 text-amber-700 rounded-full text-sm",children:[re,h.jsx("button",{onClick:()=>L(re),className:"hover:text-amber-900",children:""})]},de))}):h.jsx("p",{className:"text-slate-500 text-sm",children:"No deficiencies detected. Upload a health report or add deficiencies manually to get personalized recommendations."})]}),H&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[h.jsx(iTe,{className:"w-5 h-5 text-green-500"}),"Recommended Foods"]}),h.jsx("div",{className:"flex flex-wrap gap-2",children:V.foods.slice(0,15).map((re,de)=>h.jsx("span",{className:"px-3 py-1.5 bg-green-50 text-green-700 rounded-full text-sm border border-green-200",children:re},de))})]}),h.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[h.jsx(pS,{icon:eTe,title:"Breakfast",color:"amber",items:V.breakfast,expanded:b==="breakfast",onToggle:()=>T(b==="breakfast"?null:"breakfast")}),h.jsx(pS,{icon:DJ,title:"Lunch",color:"orange",items:V.lunch,expanded:b==="lunch",onToggle:()=>T(b==="lunch"?null:"lunch")}),h.jsx(pS,{icon:Fx,title:"Dinner",color:"indigo",items:V.dinner,expanded:b==="dinner",onToggle:()=>T(b==="dinner"?null:"dinner")}),h.jsx(pS,{icon:gh,title:"Snacks",color:"green",items:V.snacks,expanded:b==="snacks",onToggle:()=>T(b==="snacks"?null:"snacks")})]}),V.tips.length>0&&h.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-2xl p-6",children:[h.jsxs("h2",{className:"text-lg font-semibold text-cyan-800 mb-4 flex items-center gap-2",children:[h.jsx(aTe,{className:"w-5 h-5"}),"Nutritional Tips"]}),h.jsx("ul",{className:"space-y-2",children:V.tips.map((re,de)=>h.jsxs("li",{className:"flex items-start gap-2 text-cyan-700",children:[h.jsx(va,{className:"w-4 h-4 mt-0.5 text-cyan-500 shrink-0"}),re]},de))})]}),F.length>0&&h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[h.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[h.jsx(fTe,{className:"w-5 h-5 text-purple-500"}),"Supplement Recommendations"]}),h.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"General wellness guidance based on your deficiencies. Always consult a healthcare provider before starting supplements."}),h.jsx("div",{className:"space-y-4",children:F.map((re,de)=>h.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:[h.jsx("h3",{className:"font-medium text-purple-800",children:re.category}),h.jsx("p",{className:"text-sm text-purple-700 mt-1",children:re.description}),h.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:re.note})]},de))})]})]}),!H&&o.length===0&&h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center",children:[h.jsx(gh,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),h.jsx("h3",{className:"text-xl font-semibold text-slate-800 mb-2",children:"No Diet Plan Available"}),h.jsx("p",{className:"text-slate-500 mb-4",children:"Upload a health report to get AI-analyzed deficiencies and personalized diet recommendations, or add your known deficiencies manually."}),h.jsx("button",{onClick:()=>E(!0),className:"px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all",children:"Add Deficiencies Manually"})]}),h.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm text-slate-500",children:[h.jsx("strong",{children:"Disclaimer:"})," This diet plan is AI-generated for informational purposes only. It is not a substitute for professional medical advice. Please consult a healthcare provider or registered dietitian before making significant changes to your diet."]})]}):h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center",children:[h.jsx(gh,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),h.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"Diet Recommendations Disabled"}),h.jsx("p",{className:"text-slate-500",children:"Enable diet recommendations to see your personalized plan."})]})]})}function pS({icon:e,title:n,color:a,items:o,expanded:l,onToggle:p}){const m={amber:"bg-amber-100 text-amber-600",orange:"bg-orange-100 text-orange-600",indigo:"bg-indigo-100 text-indigo-600",green:"bg-green-100 text-green-600"};return h.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[h.jsxs("button",{onClick:p,className:"w-full flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:`w-10 h-10 rounded-xl ${m[a]} flex items-center justify-center`,children:h.jsx(e,{className:"w-5 h-5"})}),h.jsx("h3",{className:"font-semibold text-slate-800",children:n})]}),l?h.jsx(Qxe,{className:"w-5 h-5 text-slate-400"}):h.jsx(Xk,{className:"w-5 h-5 text-slate-400"})]}),l&&o.length>0&&h.jsx("ul",{className:"mt-4 space-y-2",children:o.map((y,E)=>h.jsxs("li",{className:"flex items-center gap-2 text-slate-600 text-sm",children:[h.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"}),y]},E))}),!l&&o.length>0&&h.jsxs("p",{className:"mt-2 text-sm text-slate-500",children:[o.length," options available"]})]})}function Q7e(){const{user:e}=Ha(),n=zd(),[a,o]=J.useState([]),[l,p]=J.useState(""),[m,y]=J.useState(!1),[E,b]=J.useState(null),T=J.useRef(null);J.useEffect(()=>{var L;if(o([{role:"assistant",content:`Hello ${(e==null?void 0:e.name)||"there"}!  I'm your AI health assistant. I can help you understand your health reports, answer questions about your symptoms, and provide general health guidance. How can I assist you today?`,timestamp:new Date}]),(L=n.state)!=null&&L.selectedText){const P=n.state.selectedText;p(`Can you explain this: "${P}"`)}},[n.state,e]),J.useEffect(()=>{x()},[a]);const x=()=>{var L;(L=T.current)==null||L.scrollIntoView({behavior:"smooth"})},A=async L=>{if(L.preventDefault(),!l.trim()||m)return;const P={role:"user",content:l,timestamp:new Date};o(V=>[...V,P]);const U=l;p(""),y(!0);try{const V=`${window.location.origin}/api/chat`,F=await fetch(V,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:U,conversationHistory:a.filter(B=>!B.content.includes("Hello")).slice(-10)})});if(!F.ok){const B=await F.json().catch(()=>({}));throw console.error("API Error:",F.status,B),new Error(B.message||"Failed to get AI response")}const H=await F.json();if(H.success&&H.response){const B={role:"assistant",content:H.response,timestamp:new Date};o(z=>[...z,B]);try{const z=JSON.parse(localStorage.getItem("aiChatHistory")||"[]");z.push({query:U,response:H.response,timestamp:new Date().toISOString()}),localStorage.setItem("aiChatHistory",JSON.stringify(z.slice(-50)))}catch(z){console.error("Failed to save chat history:",z)}}else throw new Error("Invalid response from AI")}catch(V){console.error("AI Chat error:",V);const F={role:"assistant",content:D(U),timestamp:new Date};o(H=>[...H,F]),bt.error("Using offline mode - AI service unavailable")}finally{y(!1)}},D=L=>{const P=L.toLowerCase();return P.includes("vitamin d")||P.includes("vitamin-d")?`Based on your query about Vitamin D:

**What is Vitamin D?**
Vitamin D is essential for bone health, immune function, and overall wellbeing.

**Normal Range:** 30-100 ng/mL

**If Low:**
 Get 15-20 minutes of morning sunlight daily
 Eat fish, eggs, fortified milk
 Consider supplements (consult your doctor)

**Symptoms of Deficiency:**
 Fatigue and tiredness
 Bone pain or weakness
 Frequent infections
 Mood changes

Would you like more specific information about your levels?`:P.includes("iron")||P.includes("hemoglobin")?`Regarding Iron and Hemoglobin:

**Importance:**
Iron is crucial for producing hemoglobin, which carries oxygen in your blood.

**Normal Hemoglobin:** 12-17 g/dL
**Normal Iron:** 60-170 mcg/dL

**To Increase Iron:**
 Red meat, spinach, dal
 Eat with Vitamin C foods
 Avoid tea/coffee with meals

**Symptoms of Low Iron:**
 Extreme fatigue
 Pale skin
 Shortness of breath
 Cold hands and feet

Consult your doctor if symptoms persist.`:P.includes("diet")||P.includes("food")?`For a healthy diet plan:

**General Guidelines:**
 Eat balanced meals with proteins, carbs, and healthy fats
 Include plenty of fruits and vegetables
 Stay hydrated (8-10 glasses of water daily)
 Limit processed foods and sugar

**Based on Your Health Data:**
I can provide personalized diet recommendations based on your deficiencies. Check your Diet Plan page for detailed meal suggestions.

Would you like specific recommendations for any nutrient?`:`Thank you for your question. I'm here to help with:

 Understanding your health reports
 Explaining medical terms and values
 Providing general health guidance
 Diet and lifestyle recommendations
 Symptom information

**Important:** I provide general information only. For medical diagnosis and treatment, please consult with a healthcare professional.

Could you please provide more details about what you'd like to know?`},N=(L,P)=>{navigator.clipboard.writeText(L),b(P),setTimeout(()=>b(null),2e3),bt.success("Copied to clipboard")};return h.jsxs("div",{className:"h-[calc(100vh-4rem)] flex flex-col bg-slate-50",children:[h.jsx("div",{className:"bg-white border-b border-slate-200 px-4 sm:px-6 py-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center",children:h.jsx(CI,{className:"w-6 h-6 text-white"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-lg font-bold text-slate-800",children:"AI Health Assistant"}),h.jsx("p",{className:"text-sm text-slate-500",children:"Ask me anything about your health"})]})]})}),h.jsxs("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-6 space-y-4",children:[a.map((L,P)=>h.jsxs("div",{className:`flex gap-3 ${L.role==="user"?"justify-end":"justify-start"}`,children:[L.role==="assistant"&&h.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center shrink-0",children:h.jsx(CI,{className:"w-5 h-5 text-white"})}),h.jsxs("div",{className:`max-w-[80%] sm:max-w-[70%] rounded-2xl px-4 py-3 ${L.role==="user"?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white":"bg-white border border-slate-200 text-slate-800"}`,children:[h.jsx("div",{className:"whitespace-pre-wrap break-words text-sm sm:text-base",children:L.content}),h.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[h.jsx("span",{className:`text-xs ${L.role==="user"?"text-white/70":"text-slate-400"}`,children:L.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),L.role==="assistant"&&h.jsx("button",{onClick:()=>N(L.content,P),className:"text-slate-400 hover:text-slate-600 transition-colors",children:E===P?h.jsx(sh,{className:"w-4 h-4 text-green-500"}):h.jsx(tTe,{className:"w-4 h-4"})})]})]}),L.role==="user"&&h.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center shrink-0",children:h.jsx(Sl,{className:"w-5 h-5 text-slate-600"})})]},P)),m&&h.jsxs("div",{className:"flex gap-3 justify-start",children:[h.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center shrink-0",children:h.jsx(CI,{className:"w-5 h-5 text-white"})}),h.jsx("div",{className:"bg-white border border-slate-200 rounded-2xl px-4 py-3",children:h.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[h.jsx(dz,{className:"w-4 h-4 animate-spin"}),h.jsx("span",{className:"text-sm",children:"Thinking..."})]})})]}),h.jsx("div",{ref:T})]}),h.jsxs("div",{className:"bg-white border-t border-slate-200 px-4 sm:px-6 py-4",children:[h.jsxs("form",{onSubmit:A,className:"flex gap-2",children:[h.jsx("input",{type:"text",value:l,onChange:L=>p(L.target.value),placeholder:"Ask about your health, symptoms, or reports...",className:"flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/20",disabled:m}),h.jsx("button",{type:"submit",disabled:!l.trim()||m,className:"px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:m?h.jsx(dz,{className:"w-5 h-5 animate-spin"}):h.jsxs(h.Fragment,{children:[h.jsx(Dm,{className:"w-5 h-5"}),h.jsx("span",{className:"hidden sm:inline",children:"Send"})]})})]}),h.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[h.jsx("button",{onClick:()=>p("What do my vitamin levels mean?"),className:"px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-xs transition-colors",children:"Explain my vitamins"}),h.jsx("button",{onClick:()=>p("How can I improve my iron levels?"),className:"px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-xs transition-colors",children:"Improve iron levels"}),h.jsx("button",{onClick:()=>p("What foods should I eat?"),className:"px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-xs transition-colors",children:"Diet suggestions"})]})]})]})}const Lo=({children:e,allowedRoles:n})=>{const{user:a,loading:o}=Ha();return o?h.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):a?n&&!n.includes(a.role)?a.role==="admin"?h.jsx(Zi,{to:"/admin"}):a.role==="doctor"?h.jsx(Zi,{to:"/doctor/dashboard"}):h.jsx(Zi,{to:"/dashboard"}):e:h.jsx(Zi,{to:"/login"})},Z7e=({children:e})=>{const{user:n,loading:a,isAdmin:o}=Ha();return a?h.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n?o()?e:h.jsx(Zi,{to:"/dashboard"}):h.jsx(Zi,{to:"/login"})},a1=({children:e})=>{const{user:n,loading:a,isDoctor:o}=Ha();return a?h.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n?o()?e:h.jsx(Zi,{to:"/dashboard"}):h.jsx(Zi,{to:"/login"})};function eKe(){const{user:e,isAdmin:n,isDoctor:a}=Ha(),o=()=>e?n()?h.jsx(Zi,{to:"/admin"}):a()?h.jsx(Zi,{to:"/doctor/dashboard"}):h.jsx(Zi,{to:"/dashboard"}):h.jsx(OTe,{}),l=()=>e?n()?h.jsx(Zi,{to:"/admin"}):a()?h.jsx(Zi,{to:"/doctor/dashboard"}):h.jsx(Zi,{to:"/dashboard"}):h.jsx(ITe,{});return h.jsxs(pSe,{children:[h.jsx(Dr,{path:"/",element:o()}),h.jsx(Dr,{path:"/login",element:l()}),h.jsx(Dr,{path:"/register",element:e?h.jsx(Zi,{to:"/dashboard"}):h.jsx(PTe,{})}),h.jsx(Dr,{path:"/register/doctor",element:e?h.jsx(Zi,{to:"/doctor/dashboard"}):h.jsx(kTe,{})}),h.jsx(Dr,{path:"/dashboard",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx(Oze,{})})})}),h.jsx(Dr,{path:"/upload",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx(C7e,{})})})}),h.jsx(Dr,{path:"/reports/:id",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx(R7e,{})})})}),h.jsx(Dr,{path:"/doctors",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx(N7e,{})})})}),h.jsx(Dr,{path:"/consultation/:appointmentId",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(G7e,{})})}),h.jsx(Dr,{path:"/consultation-summary/:appointmentId",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx($7e,{})})})}),h.jsx(Dr,{path:"/wearables",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx(F7e,{})})})}),h.jsx(Dr,{path:"/subscription",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx(V7e,{})})})}),h.jsx(Dr,{path:"/diet-plan",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx(J7e,{})})})}),h.jsx(Dr,{path:"/ai-chat",element:h.jsx(Lo,{allowedRoles:["patient","client"],children:h.jsx(La,{children:h.jsx(Q7e,{})})})}),h.jsx(Dr,{path:"/doctor/dashboard",element:h.jsx(a1,{children:h.jsx(La,{isDoctor:!0,children:h.jsx(Ize,{})})})}),h.jsx(Dr,{path:"/doctor/availability",element:h.jsx(a1,{children:h.jsx(La,{isDoctor:!0,children:h.jsx(Y7e,{})})})}),h.jsx(Dr,{path:"/patient/:patientId",element:h.jsx(a1,{children:h.jsx(La,{isDoctor:!0,children:h.jsx(B7e,{})})})}),h.jsx(Dr,{path:"/profile",element:h.jsx(Lo,{children:h.jsx(La,{children:h.jsx(O7e,{})})})}),h.jsx(Dr,{path:"/admin",element:h.jsx(Z7e,{children:h.jsx(La,{isAdmin:!0,children:h.jsx(L7e,{})})})}),h.jsx(Dr,{path:"/demo",element:h.jsx(k7e,{})}),h.jsx(Dr,{path:"/video-test",element:h.jsx(H7e,{})}),h.jsx(Dr,{path:"/email-test",element:h.jsx(z7e,{})})]})}s1.createRoot(document.getElementById("root")).render(h.jsx(me.StrictMode,{children:h.jsx(bSe,{children:h.jsxs($xe,{children:[h.jsx(eKe,{}),h.jsx(pwe,{position:"top-right"})]})})}));
